000100200529     H        1
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas PM Reset base currency')
000500200529     F*****************************************************************
000600200529     F*                                                               *
000700200529     F*  Midas - Portfolio Management Module                          *
000800200529     F*                                                               *
000900200529     F*  PM6420 - RESET BASE CURRENCY                                 *
001000200529     F*                                                               *
001100200529      *  (c) Finastra International Limited 2001                      *
001200200529     F*                                                               *
001300200604     F*  Last Amend No. 250228             Date 22May20               *
001400200529      *  Prev Amend No. MD046248           Date 27Oct17               *
001500200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
001600200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
001700200529      * Midas Plus 1.4 Base ------------------------------------------*
001800200529      * Midas Plus 1.3 ----------- Base ------------------------------*
001900200529      *                 234300             Date 22Sep06               *
002000200529      *                 CSD031             Date 10Apr06               *
002100200529      *                 CSD027             Date 09Dec05               *
002200200529      *                 CSE071             Date 19Jul05               *
002300200529      *                 CGL029             Date 01Sep03               *
002400200529      *                 222727             Date 05Nov03               *
002500200529      *                 CAS006             Date 21Jan03               *
002600200529      * Midas Release 4.01.01 ----------------------------------------*
002700200529      *                 207006             Date 18Jun02               *
002800200529      * Midas Release 4 --------------- Base -------------------------*
002900200529      * Midas DBA 3.04 -----------------------------------------------*
003000200529      *                 CSE023             Date 12Jul00               *
003100200529      * Midas DBA 3.02 -----------------------------------------------*
003200200529      *                 CSE015             Date 06Dec99               *
003300200529      *                 CSE017             Date 20Oct99               *
003400200529      *                 CSE012             Date 16Aug99               *
003500200529     F*                 160446             Date 11May99               *
003600200529     F*                 158524             Date 20Apr99               *
003700200529      * Midas DBA 3.00 ---------------- Base -------------------------*
003800200529     F*                 CAC003             Date 25Feb97               *
003900200529     F*                 CPM005             Date 19JUN96               *
004000200529     F*                 S01124             Date 20JUN94               *
004100200529     F*                                                               *
004200200529     F*---------------------------------------------------------------*
004300200529     F*                                                               *
004400200529      *  250228 - Recompile due to field change in PMPSTMQ0.          *
004500200529      *  MD046248 - Finastra Rebranding                               *
004600200529      *  234300 - Recompiled over changed in PF/HSTTRD.               *
004700200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
004800200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
004900200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
005000200529      *  CGL029 - Increase Account Code to 10 digits                  *
005100200529      *  222727 - Release 5.0 errors  (Recompile)                     *
005200200529      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
005300200529      *  207006 - Add Counterparty & Market Centre to SSI (Recompile) *
005400200529      *  CSE023 - Treaty Withholding Tax (Recompiled)                 *
005500200529      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
005600200529      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
005700200529      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
005800200529     F*  160446 - Modify DUMP run in  *PSSR to have full details in   *
005900200529     F*           case if DECIMAL DATA ERROR.                         *
006000200529     F*  158524 - If the two currencies are in the Euroland, the      *
006100200529     F*           new EMU fields in SDCURRPD must be taken.           *
006200200529     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
006300200529     F*         - Recompiled due to changes in PF/PMPORTPD.           *
006400200529     F*  CPM005 - Private Banking Phase 2                             *
006500200529     F*           Focus Group Changes upgraded to DBA                 *
006600200529     F*  S01124  -  PBFG/1 - CHANGE CUSTOMER/PORTFOLIO BASE CURRENCY  *
006700200529     F*                                                               *
006800200529     F*****************************************************************
006900200529     FPMPCBCL1IF  E           K        DISK
007000200529     F                                              KINFSR *PSSR
007100200529     FPMPCBCL0UF  E           K        DISK
007200200529     F            PMPCBCD0                          KRENAMEPMPCBCDD
007300200529     F                                              KINFSR *PSSR
007400200529     F***SDBANKL1IF**E           K        DISK                            CPM005
007500200529     F***********                                   KINFSR *PSSR          CPM005
007600200529     F***SDCURRL1IF**E           K        DISK                            CPM005
007700200529     F***********                                   KINFSR *PSSR          CPM005
007800200529     F***SDPLCSLLUF**E           K        DISK                            CPM005
007900200529     FSDPLCSL1UF  E           K        DISK                               CPM005
008000200529     F                                              KINFSR *PSSR
008100200529     FPMCNSDLLUF  E           K        DISK
008200200529     F                                              KINFSR *PSSR
008300200529     F***PMPORTPPUF**E           K        DISK                            CPM005
008400200529     FPMPORTPDUF  E           K        DISK                               CPM005
008500200529     F                                              KINFSR *PSSR
008600200529     FPMCPOSLLIF  E           K        DISK
008700200529     F                                              KINFSR *PSSR
008800200529     FSECTY   IF  E           K        DISK
008900200529     F                                              KINFSR *PSSR
009000200529     FCAPRHD  O   E           K        DISK
009100200529     F                                              KINFSR *PSSR
009200200529     F***PMPSTMPPUF**E           K        DISK                            CPM005
009300200529     FPMPSTMQ0UF  E           K        DISK                               CPM005
009400200529     F                                              KINFSR *PSSR
009500200529     FPMPTRALLUF  E           K        DISK
009600200529     F                                              KINFSR *PSSR
009700200529     FPMPCAAL7UF  E           K        DISK
009800200529     F                                              KINFSR *PSSR
009900200529     FPMAPOSLLUF  E           K        DISK                      A
010000200529     F                                              KINFSR *PSSR
010100200529     F            PMCPOSP0                          KRENAMEPMAPOSD0
010200200529     F***PORTMT**UF**E           K        DISK                            CPM005
010300200529     FPMTRMVL0UF  E           K        DISK                               CPM005
010400200529     F            CAPRHDF                           KIGNORE
010500200529     F                                              KINFDS FDS1
010600200529     F                                              KINFSR *PSSR
010700200529     F***CAPRHP**UF**E           K        DISK                            CPM005
010800200529     FPMCAPRL5UF  E           K        DISK                               CPM005
010900200529     F            CAPRHDF                           KRENAMECAPRHD0
011000200529     F                                              KINFSR *PSSR
011100200529      *****************************************************************
011200200529      /COPY ZSRSRC,ZPOWERZ1
011300200529      *
011400200529     E                    CPY@    1   1 80
011500200529      *****************************************************************
011600200529     IPMCNSDD0
011700200529     I              PNRECI                          XPNREC
011800200529     I              PNLUID                          XPNLUI
011900200529     I              PNCHTP                          XPNCHT
012000200529     I              PNLCD                           XPNLCD
012100200529     I              PNTNLU                          XPNTNL
012200200529     I              PNCNUM                          XPNCNU
012300200529     I              PNPTFR                          XPNPTF
012400200529     I              PNVLFQ                          XPNVLF
012500200529     I              PNVLDM                          XPNVLD
012600200529     I              PNVLND                          XPNVLN
012700200529     I              PNS1VR                          XPNS1V
012800200529     I              PNS2VR                          XPNS2V
012900200529     I              PNS3VR                          XPNS3V
013000200529     I              PNS4VR                          XPNS4V
013100200529     I              PNS5VR                          XPNS5V
013200200529     I              PNS6VR                          XPNS6V
013300200529     I              PNS7VR                          XPNS7V
013400200529     I              PNS8VR                          XPNS8V
013500200529     I              PNS9VR                          XPNS9V
013600200529     I              PNS0VR                          XPNS0V
013700200529     I              PNRPYP                          XPNRPY
013800200529     I              PNTYSM                          XPNTYS
013900200529     I              PNADPP                          XPNADP
014000200529     I              PNPSDT                          XPNPSD
014100200529     I              PNPMNG                          XPNPMN
014200200529     I              PNPTCY                          XPNPTC
014300200529     I              PNPCDP                          XPNPCD
014400200529     IPMAPOSD0
014500200529     I              QAAPNM                          YAAPNM
014600200529     I              QATNMC                          YATNMC
014700200529     I              QAAYNM                          YAAYNM
014800200529      *
014900200529      **  LOCAL DATA AREA FOR DATA BASE ERRORS:
015000200529     ILDA         DS                            256
015100200529     I***********                           132 183 DBLOT                 CPM005
015200200529     I***********                           132 141 DBFILE                CPM005
015300200529     I                                      134 183 DBLOT                 CPM005
015400200529     I                                      134 141 DBFILE                CPM005
015500200529     I                                      142 170 DBKEY
015600200529     I                                      171 180 DBPGM
015700200529     I                                      181 1830DBASE
015800200529     I*
015900200529     IPMSTAT    E DS
016000200529     I                                        1   50WWECD
016100200529     I                                        1 256 WWSTAT
016200200529      *
016300200529      **  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION:
016400200529     ICPYR@#      DS
016500200529     I                                        1  80 CPY@
016600200529     I                                        1  20 CPY@##
016700200529     IWKEY1       DS
016800200529     I**********                              1   60KCNUM                                     CSD027
016900200529     I                                        1   6 KCNUM                                     CSD027
017000200529     I                                        7  10 KPTFR
017100200529     IWKEY2       DS
017200200529     I**********                              1   60KCNUM2                                    CSD027
017300200529     I                                        1   6 KCNUM2                                    CSD027
017400200529     I                                        7  10 KPTFR2
017500200529     I                                       11  150KTNLU2
017600200529      *
017700200529      ** FILE STATUS DATA STRUCTURE - RECORD FORMAT
017800200529     IFDS1        DS
017900200529     I                                     *RECORD  @FORM
018000200529     I*                                                                   CPM005
018100200529     ISDCURR    E DSSDCURRPD                                              CPM005
018200200529     I* DS FOR CURRENCIES DETAILS                                         CPM005
018300200529     I*                                                                   CPM005
018400200529     ISDBANK    E DSSDBANKPD                                              CPM005
018500200529     I** EXTERNAL DS FOR BANK DETAILS                                     CPM005
018600200529     ISDGELR    E DSSDGELRPD                                              158524
018700200529     I** General ledger details                                           158524
018800200529     I*                                                                   CPM005
018900200529     IDSFDY     E DSDSFDY                                                 CPM005
019000200529     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                CPM005
019100200529     I*                                                                   CPM005
019200200529     IDSSDY     E DSDSSDY                                                 CPM005
019300200529     I* Second DS For Access Programs, Long Data Structure                CPM005
019400200529      ********************************************************************
019500200529      /EJECT
019600200529      ********************************************************************
019700200529      *                                                                  *
019800200529      * INDEX OF SUBROUTINES                                             *
019900200529      * MAIN     -                                                       *
020000200529      * #INIT    - INITIAL PROCESSING                                    *
020100200529      * #MAIN    - MAIN PROCESSING                                       *
020200200529      * #POSI    - RESET ALL POSITIONS                                   *
020300200529      * #TRAD    - RESET ALL TRANSACTIONS                                *
020400200529      * #ACTI    - RESET ALL ACTIONS                                     *
020500200529      * #TERM    - TERMINATION PROCESSING                                *
020600200529      * *PSSR    - ERROR IN FILE                                         *
020700200529      *                                                                  *
020800200529      * EXTERNAL ROUTINES CALLED                                         *
020900200529      *                                                                  *
021000200529      ********************************************************************
021100200529     C                     EXSR #INIT
021200200529      *
021300200529     C                     EXSR #MAIN
021400200529      *
021500200529     C                     EXSR #TERM
021600200529      ********************************************************************
021700200529      /EJECT
021800200529      ********************************************************************
021900200529      *                                                                  *
022000200529      * #INIT    - INITIAL PROCESSING                                    *
022100200529      *                                                                  *
022200200529      * SUBROUTINE CALLS:                                                *
022300200529      * *PSSR    - ERROR IN FILE                                         *
022400200529      *                                                                  *
022500200529      * SUBROUTINE CALLED FROM:                                          *
022600200529      * MAIN     -                                                       *
022700200529      *                                                                  *
022800200529      * ROUTINE USES VARIABLES:                                          *
022900200529      *                                                                  *
023000200529      ********************************************************************
023100200529     C           #INIT     BEGSR
023200200529      *
023300200529      **  PREPARE LDA:
023400200529     C           *NAMVAR   DEFN           LDA
023500200529     C                     MOVEL*BLANK    DBLOT
023600200529     C                     MOVEL'PM6420'  DBPGM
023700200529     C*
023800200529     C** DEFINE DATA AREA PMSTAT
023900200529     C           *NAMVAR   DEFN           PMSTAT
024000200529     C                     IN   PMSTAT
024100200529     C*
024200200529     C           KEY1      KLIST
024300200529     C**********           KFLD           KCNUM   60                                          CSD027
024400200529     C                     KFLD           KCNUM   6                                           CSD027
024500200529     C                     KFLD           KPTFR   4
024600200529     C*
024700200529     C           KEY2      KLIST
024800200529     C**********           KFLD           KCNUM2  60                                          CSD027
024900200529     C                     KFLD           KCNUM2  6                                           CSD027
025000200529     C                     KFLD           KPTFR2  4
025100200529     C                     KFLD           KTNLU2  50
025200200529     C*
025300200529     C           KEY3      KLIST
025400200529     C**********           KFLD           KYCUST  60                                          CSD027
025500200529     C                     KFLD           KYCUST  6                                           CSD027
025600200529     C                     KFLD           KYPTFR  4
025700200529      *
025800200529      **  GET INSTALLATION CONTROL DATA RECORD 1:
025900200529     C************LOVAL    SETLLSDBANKL1                                  CPM005
026000200529     C***********          READ SDBANKL1                 71               CPM005
026100200529     C                     CALL 'AOBANKR0'                                CPM005
026200200529     C                     PARM *BLANKS   WWRTCD  7                       CPM005
026300200529     C                     PARM '*FIRST ' WWOPTN  7                       CPM005
026400200529     C           SDBANK    PARM SDBANK    DSFDY                           CPM005
026500200529      *
026600200529      **  IF RECORD NOT FOUND, DB ERROR
026700200529     C************IN71     IFEQ '1'                        *B1            CPM005
026800200529     C           WWRTCD    IFNE *BLANKS                    *B1            CPM005
026900200529     C                     Z-ADD1         DBASE            ***************
027000200529     C***********          MOVEL'SDBANKL1'DBFILE           * DB ERROR 01 *CPM005
027100200529     C                     MOVE 'SDBANKPD'DBFILE           * DB ERROR 01 *CPM005
027200200529     C                     MOVEL*BLANKS   DBKEY            ***************
027300200529     C                     EXSR *PSSR
027400200529     C                     END                             *E1
027500200529      *
027600200529     C** Call access object : General Ledger                              158524
027700200529     C*                                                                   158524
027800200529     C**********           CALL 'AOGELRR0'                                             158524 CGL029
027900200529     C                     CALL 'AOGELRR1'                                                    CGL029
028000200529     C                     PARM '*DBERR ' WWRTCD                          158524
028100200529     C                     PARM '*FIRST ' WWOPTN                          158524
028200200529     C********** SDGELR    PARM SDGELR    DSFDY                                        158524 CGL029
028300200529     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
028400200529     C*                                                                   158524
028500200529      **  If record not found, DB error                                   158524
028600200529     C           WWRTCD    IFNE *BLANKS                    *B1            158524
028700200529     C                     Z-ADD20        DBASE            ***************158524
028800200529     C                     MOVE 'SDGELRPD'DBFILE           * DB ERROR 20 *158524
028900200529     C                     MOVEL*BLANKS   DBKEY            ***************158524
029000200529     C                     EXSR *PSSR                                     158524
029100200529     C                     END                             *E1            158524
029200200529     C*                                                                   158524
029300200529     C**********           Z-ADD*ZEROS    WWCUST  60                                          CSD027
029400200529     C                     MOVE *BLANKS   WWCUST  6                                           CSD027
029500200529     C                     MOVE *BLANKS   WWPTFR  4
029600200529      *
029700200529     C                     ENDSR
029800200529      ********************************************************************
029900200529      /EJECT
030000200529      ********************************************************************
030100200529      *                                                                  *
030200200529      * #MAIN    - MAIN PROCESSING                                       *
030300200529      *                                                                  *
030400200529      * SUBROUTINE CALLS:                                                *
030500200529      * ZDATE2   -                                                       *
030600200529      *                                                                  *
030700200529      * SUBROUTINE CALLED FROM:                                          *
030800200529      * MAIN     -                                                       *
030900200529      *                                                                  *
031000200529      * ROUTINE USES VARIABLES:                                          *
031100200529      *                                                                  *
031200200529      ********************************************************************
031300200529     C           #MAIN     BEGSR
031400200529      *
031500200529     C           *LOVAL    SETLLPMPCBCL1
031600200529     C                     READ PMPCBCL1                 72
031700200529      *
031800200529     C           *IN72     DOWEQ'0'                        *BW1
031900200529      *
032000200529     C           FMCUST    IFNE WWCUST                     *B1
032100200529     C           FMPTFR    ORNE WWPTFR
032200200529      *
032300200529     C**********           Z-ADDFMCUST    WWCUST                                              CSD027
032400200529     C                     MOVE FMCUST    WWCUST                                              CSD027
032500200529     C                     MOVE FMPTFR    WWPTFR
032600200529      *
032700200529      **  ACCESS CURRENCY DETAILS FILE TO RETRIEVE NEW CURRENCY DETAILS
032800200529     C***********FMNBCY    CHAINSDCURRL1             71                   CPM005
032900200529     C                     CALL 'AOCURRR0'                                CPM005
033000200529     C                     PARM *BLANKS   WWRTCD                          CPM005
033100200529     C                     PARM '*KEY   ' WWOPTN                          CPM005
033200200529     C                     PARM FMNBCY    WWKEYC  3                       CPM005
033300200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
033400200529      *
033500200529      **  IF RECORD NOT FOUND, DB ERROR
033600200529     C************IN71     IFEQ '1'                        *B2            CPM005
033700200529     C           WWRTCD    IFNE *BLANKS                                   CPM005
033800200529     C                     Z-ADD2         DBASE            ***************
033900200529     C***********          MOVEL'SDCURRL1'DBFILE           * DB ERROR 02 *CPM005
034000200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 02 *CPM005
034100200529     C                     MOVELFMNBCY    DBKEY            ***************
034200200529     C                     EXSR *PSSR
034300200529     C                     END                             *E2
034400200529      *
034500200529     C                     Z-ADDA6SPRT    W2SPRT 138
034600200529     C                     MOVELA6MDIN    W2MDIN  1
034700200529     C                     Z-ADDA6NBDP    W2NBDP  10
034800200529     C                     MOVELA6INCY    W2INCY  1                       158524
034900200529     C                     Z-ADDA6EUER    W2EUER 138                      158524
035000200529     C                     MOVELA6EUMD    W2EUMD  1                       158524
035100200529      *
035200200529      ****IF*PORTFOLIO*REFERENCE*FROM*PF/PMPCBCPP*IS*EQUAL*TO*BLANKS******CPM005
035300200529      **  IF PORTFOLIO REFERENCE FROM PF/PMPCBCPD IS EQUAL TO BLANKS      CPM005
035400200529      **  (CUSTOMER BASE CURRENCY CHANGE)
035500200529     C           FMPTFR    IFEQ *BLANKS                    *B2
035600200529      *
035700200529      **  CHANGE CUSTOMER BASE CURRENCY
035800200529     C                     EXSR #CHGBC
035900200529     C                     MOVEL'9997'    KYPTFR
036000200529      *
036100200529      **  (PORTFOLIO BASE CURRENCY CHANGE)
036200200529     C                     ELSE                            *X2
036300200529      *
036400200529      **  CHANGE PORTFOLIO BASE CURRENCY
036500200529     C                     EXSR #CHGPC
036600200529     C                     MOVELFMPTFR    KYPTFR
036700200529     C                     END                             *E2
036800200529      *
036900200529      **  SETUP CUSTOMER
037000200529     C                     MOVE FMCUST    KYCUST
037100200529      *
037200200529      **  PORTFOLIO POSITIONS PROCESSING
037300200529     C                     EXSR #PORTF
037400200529      *
037500200529      ****RESET*ALL*POSITIONS*IN*PMCPOSPP*********************************CPM005
037600200529      **  RESET ALL POSITIONS IN PMCPOSPD                                 CPM005
037700200529     C                     EXSR #POSI
037800200529      *
037900200529      ****RESET*ALL*TRANSACTIONS*IN*PORTMT********************************CPM005
038000200529      **  RESET ALL TRANSACTIONS IN PMTRMVL0                              CPM005
038100200529     C                     EXSR #TRAD
038200200529      *
038300200529      **  RESET ALL ACTIONS IN CAPRHP
038400200529     C                     EXSR #ACTI
038500200529     C                     END                             *E1
038600200529      *
038700200529      **  'MATURED' PROCESSING
038800200529     C                     EXSR #MATUR
038900200529      *
039000200529     C                     READ PMPCBCL1                 72
039100200529     C                     END                             *EW1
039200200529      *
039300200529     C                     ENDSR
039400200529      ********************************************************************
039500200529      /EJECT
039600200529      ********************************************************************
039700200529      *                                                                  *
039800200529      * #POSI    - RESET ALL POSITIONS                                   *
039900200529      *                                                                  *
040000200529      * SUBROUTINE CALLS:                                                *
040100200529      *                                                                  *
040200200529      * SUBROUTINE CALLED FROM:                                          *
040300200529      * MAIN     -                                                       *
040400200529      *                                                                  *
040500200529      * ROUTINE USES VARIABLES:                                          *
040600200529      *                                                                  *
040700200529      ********************************************************************
040800200529     C           #POSI     BEGSR
040900200529      *
041000200529      **  IF CHANGE OF BASE CURRENCY
041100200529     C           KYPTFR    IFEQ '9997'                     *B0
041200200529     C           KYCUST    SETLLPMAPOSLL
041300200529     C           KYCUST    READEPMAPOSLL                 73
041400200529     C                     ELSE                            *X0
041500200529     C           KEY3      SETLLPMAPOSLL
041600200529     C           KEY3      READEPMAPOSLL                 73
041700200529     C                     END                             *E0
041800200529      *
041900200529     C           *IN73     DOWEQ*OFF                       *BW1
042000200529      *
042100200529      **  ACCESS CURRENCY DETAILS FILE TO RETRIEVE NOMINAL CCY DETAILS
042200200529     C***********YATNMC    CHAINSDCURRL1             71                   CPM005
042300200529     C                     CALL 'AOCURRR0'                                CPM005
042400200529     C                     PARM *BLANKS   WWRTCD                          CPM005
042500200529     C                     PARM '*KEY   ' WWOPTN                          CPM005
042600200529     C                     PARM YATNMC    WWKEYC                          CPM005
042700200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
042800200529      *
042900200529      **  IF RECORD NOT FOUND, DB ERROR
043000200529     C************IN71     IFEQ '1'                        *B2            CPM005
043100200529     C           WWRTCD    IFNE *BLANKS                                   CPM005
043200200529     C                     Z-ADD8         DBASE            ***************
043300200529     C***********          MOVEL'SDCURRL1'DBFILE           * DB ERROR 08 *CPM005
043400200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 08 *CPM005
043500200529     C                     MOVELYATNMC    DBKEY            ***************
043600200529     C                     EXSR *PSSR
043700200529     C                     END                             *E2
043800200529      *
043900200529      **  CONVERT AP NUMERATOR FROM NOMINAL CCY TO NEW CCY
044000200529     C                     Z-ADDYAAPNM    ZAMTF
044100200529     C                     MOVELYATNMC    ZCCYF
044200200529     C                     Z-ADDA6SPRT    ZRATEF
044300200529     C                     MOVELA6MDIN    ZMDINF
044400200529     C                     Z-ADDA6NBDP    ZCDPF
044500200529      *
044600200529     C                     MOVELFMNBCY    ZCCYT
044700200529     C                     Z-ADDW2SPRT    ZRATET
044800200529     C                     MOVELW2MDIN    ZMDINT
044900200529     C                     Z-ADDW2NBDP    ZCDPT
045000200529     C*                                                                   158524
045100200529     C           YATNMC    IFEQ BKEURO                     B2             158524
045200200529     C           W2INCY    ANDEQ'Y'                                       158524
045300200529     C           FMNBCY    OREQ BKEURO                                    158524
045400200529     C           A6INCY    ANDEQ'Y'                                       158524
045500200529     C           A6INCY    OREQ 'Y'                                       158524
045600200529     C           W2INCY    ANDEQ'Y'                                       158524
045700200529     C*                                                                   158524
045800200529     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       158524
045900200529     C           YATNMC    IFEQ BKEURO                     B3             158524
046000200529     C                     MOVE 'M'       ZMDINF                          158524
046100200529     C                     Z-ADD1         ZRATEF                          158524
046200200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
046300200529     C                     ELSE                            X3             158524
046400200529     C                     Z-ADDA6EUER    ZRATEF                          158524
046500200529     C                     MOVE A6EUMD    ZMDINF                          158524
046600200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
046700200529     C                     END                             E3             158524
046800200529     C*                                                                   158524
046900200529     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       158524
047000200529     C           FMNBCY    IFEQ BKEURO                     B3             158524
047100200529     C                     MOVE 'M'       ZMDINT                          158524
047200200529     C                     Z-ADD1         ZRATET                          158524
047300200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
047400200529     C                     ELSE                            X3             158524
047500200529     C                     Z-ADDW2EUER    ZRATET                          158524
047600200529     C                     MOVE W2EUMD    ZMDINT                          158524
047700200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
047800200529     C                     END                             E3             158524
047900200529     C*                                                                   158524
048000200529     C                     END                             E2             158524
048100200529     C*                                                                   158524
048200200529     C                     EXSR ZCCYCN
048300200529      *
048400200529     C                     Z-ADDZAMTT     QAFXAP
048500200529      *
048600200529      **  IF CHANGE OF PORTFOLIO CURRENCY
048700200529     C           FMPTFR    IFNE *BLANKS
048800200529     C                     MOVE FMNBCY    QAPTCY
048900200529     C                     Z-ADDW2NBDP    QAPCDP
049000200529      *
049100200529      **  IF CHANGE OF BASE CURRENCY
049200200529     C                     ELSE
049300200529      *
049400200529      **  IF RECORD READ HAS A PORTFOLIO REFERENCE EQUAL TO '9997'
049500200529      **  CHANGE THE PORTFOLIO AND THE BASE CURRENCIES + NUMBER OF DEC. PLACES
049600200529     C           QAPTFR    IFEQ '9997'
049700200529     C                     MOVE FMNBCY    QAPTCY
049800200529     C                     Z-ADDW2NBDP    QAPCDP
049900200529     C                     MOVE FMNBCY    QACSBY
050000200529     C                     Z-ADDW2NBDP    QABYDP
050100200529     C                     ELSE
050200200529      *
050300200529      **  IF RECORD READ HAS A PORTFOLIO REFERENCE *NOT* EQUAL TO '9997'
050400200529      **  CHANGE *ONLY* THE BASE CURRENCY + NUMBER OF DECIMAL PLACES
050500200529     C                     MOVE FMNBCY    QACSBY
050600200529     C                     Z-ADDW2NBDP    QABYDP
050700200529     C                     END
050800200529      *
050900200529     C                     END
051000200529      *
051100200529     C                     MOVE 'N'       WWNEWR  1
051200200529      *
051300200529     C           QARECI    IFEQ 'D'
051400200529     C           QAPDAT    ANDNEFMCDAT
051500200529     C                     MOVE 'Y'       WWNEWR
051600200529     C                     MOVE 'I'       QARECI
051700200529     C                     END
051800200529      *
051900200529     C                     EXCPTPMAPOU
052000200529      *
052100200529     C           WWNEWR    IFEQ 'Y'
052200200529     C                     MOVE 'D'       QARECI
052300200529     C                     Z-ADDFMCDAT    QAPDAT
052400200529     C                     WRITEPMAPOSD0
052500200529     C                     READ PMAPOSD0                 73
052600200529     C                     END
052700200529      *
052800200529     C           *IN73     IFEQ '0'
052900200529      *
053000200529      **  IF CHANGE OF BASE CURRENCY
053100200529     C           KYPTFR    IFEQ '9997'
053200200529     C           KYCUST    READEPMAPOSLL                 73
053300200529     C                     ELSE
053400200529     C           KEY3      READEPMAPOSLL                 73
053500200529     C                     END
053600200529      *
053700200529     C                     END
053800200529      *
053900200529     C                     ENDDO                           *EW1
054000200529      *
054100200529     C                     ENDSR
054200200529      ********************************************************************
054300200529      /EJECT
054400200529      ********************************************************************
054500200529      *                                                                  *
054600200529      * #TRAD    - RESET ALL TRANSACTIONS                                *
054700200529      *                                                                  *
054800200529      * SUBROUTINE CALLS:                                                *
054900200529      *                                                                  *
055000200529      * SUBROUTINE CALLED FROM:                                          *
055100200529      * MAIN     -                                                       *
055200200529      *                                                                  *
055300200529      * ROUTINE USES VARIABLES:                                          *
055400200529      *                                                                  *
055500200529      ********************************************************************
055600200529     C           #TRAD     BEGSR
055700200529      *
055800200529     C***********KEY3      SETLLPORTMT                                    CPM005
055900200529     C***********KEY3      READEPORTMT                   73               CPM005
056000200529     C           KEY3      SETLLPMTRMVL0                                  CPM005
056100200529     C           KEY3      READEPMTRMVL0                 73               CPM005
056200200529      *
056300200529     C           *IN73     DOWEQ*OFF                       *BW1
056400200529      *
056500200529      **  RECORD COMES FROM DPTMVD
056600200529     C           @FORM     IFEQ 'DPTMVDF'                  *B1
056700200529     C           @FORM     OREQ 'DPTMVTF'
056800200529      *
056900200529      **  ACCESS SECURITY TO RETRIEVE NOMINAL CCY
057000200529     C           DPSS      CHAINSECTY                71
057100200529      *
057200200529      **  IF RECORD NOT FOUND, DB ERROR
057300200529     C           *IN71     IFEQ '1'                        *B2
057400200529     C                     Z-ADD9         DBASE            ***************
057500200529     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 09 *
057600200529     C                     MOVELDPSS      DBKEY            ***************
057700200529     C                     EXSR *PSSR
057800200529     C                     END                             *E2
057900200529      *
058000200529      **  ACCESS CURRENCY FILE TO RETRIEVE DETAILS
058100200529     C***********NMCY      CHAINSDCURRL1             71                   CPM005
058200200529     C                     CALL 'AOCURRR0'                                CPM005
058300200529     C                     PARM *BLANKS   WWRTCD                          CPM005
058400200529     C                     PARM '*KEY   ' WWOPTN                          CPM005
058500200529     C                     PARM NMCY      WWKEYC  3                       CPM005
058600200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
058700200529      *
058800200529      **  IF RECORD NOT FOUND, DB ERROR
058900200529     C************IN71     IFEQ '1'                        *B2            CPM005
059000200529     C           WWRTCD    IFNE *BLANKS                                   CPM005
059100200529     C                     Z-ADD10        DBASE            ***************
059200200529     C***********          MOVEL'SDCURRL1'DBFILE           * DB ERROR 02 *CPM005
059300200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 02 *CPM005
059400200529     C                     MOVELNMCY      DBKEY            ***************
059500200529     C                     EXSR *PSSR
059600200529     C                     END                             *E2
059700200529      *
059800200529      **  CONVERT SPOT RATE FROM NOMINAL CCY TO NEW CCY
059900200529     C                     Z-ADD1         ZAMTF
060000200529     C                     MOVELNMCY      ZCCYF
060100200529     C                     Z-ADDA6SPRT    ZRATEF
060200200529     C                     MOVELA6MDIN    ZMDINF
060300200529     C                     Z-ADDA6NBDP    ZCDPF
060400200529      *
060500200529     C                     MOVELFMNBCY    ZCCYT
060600200529     C                     Z-ADDW2SPRT    ZRATET
060700200529     C                     MOVELW2MDIN    ZMDINT
060800200529     C                     Z-ADDW2NBDP    ZCDPT
060900200529     C*                                                                   158524
061000200529     C           NMCY      IFEQ BKEURO                     B2             158524
061100200529     C           W2INCY    ANDEQ'Y'                                       158524
061200200529     C           FMNBCY    OREQ BKEURO                                    158524
061300200529     C           A6INCY    ANDEQ'Y'                                       158524
061400200529     C           A6INCY    OREQ 'Y'                                       158524
061500200529     C           W2INCY    ANDEQ'Y'                                       158524
061600200529     C*                                                                   158524
061700200529     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       158524
061800200529     C           NMCY      IFEQ BKEURO                     B3             158524
061900200529     C                     MOVE 'M'       ZMDINF                          158524
062000200529     C                     Z-ADD1         ZRATEF                          158524
062100200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
062200200529     C                     ELSE                            X3             158524
062300200529     C                     Z-ADDA6EUER    ZRATEF                          158524
062400200529     C                     MOVE A6EUMD    ZMDINF                          158524
062500200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
062600200529     C                     END                             E3             158524
062700200529     C*                                                                   158524
062800200529     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       158524
062900200529     C           FMNBCY    IFEQ BKEURO                     B3             158524
063000200529     C                     MOVE 'M'       ZMDINT                          158524
063100200529     C                     Z-ADD1         ZRATET                          158524
063200200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
063300200529     C                     ELSE                            X3             158524
063400200529     C                     Z-ADDW2EUER    ZRATET                          158524
063500200529     C                     MOVE W2EUMD    ZMDINT                          158524
063600200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
063700200529     C                     END                             E3             158524
063800200529     C*                                                                   158524
063900200529     C                     END                             E2             158524
064000200529     C*                                                                   158524
064100200529     C                     EXSR ZCCYCN
064200200529      *
064300200529     C                     Z-ADDZCRSRT    SPXR
064400200529      *
064500200529     C           @FORM     IFEQ 'DPTMVDF'                  *B2
064600200529     C                     EXCPTDPTMDU
064700200529     C                     ELSE                            *X2
064800200529     C                     EXCPTDPTMTU
064900200529     C                     END                             *E2
065000200529      *
065100200529     C                     END                             *E1
065200200529      *
065300200529      **  RECORD COMES FROM TRADSD OR HSTTRD
065400200529     C           @FORM     IFEQ 'TRADSDF'                  *B1
065500200529     C           @FORM     OREQ 'HSTTRDF'
065600200529      *
065700200529      **  ACCESS CURRENCY FILE TO RETRIEVE DETAILS
065800200529     C***********TNMC      CHAINSDCURRL1             71                   CPM005
065900200529     C                     CALL 'AOCURRR0'                                CPM005
066000200529     C                     PARM *BLANKS   WWRTCD                          CPM005
066100200529     C                     PARM '*KEY   ' WWOPTN                          CPM005
066200200529     C                     PARM TNMC      WWKEYC  3                       CPM005
066300200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
066400200529      *
066500200529      **  IF RECORD NOT FOUND, DB ERROR
066600200529     C************IN71     IFEQ '1'                        *B2            CPM005
066700200529     C           WWRTCD    IFNE *BLANKS                                   CPM005
066800200529     C                     Z-ADD11        DBASE            ***************
066900200529     C***********          MOVEL'SDCURRL1'DBFILE           * DB ERROR 02 *CPM005
067000200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 02 *CPM005
067100200529     C                     MOVELTNMC      DBKEY            ***************
067200200529     C                     EXSR *PSSR
067300200529     C                     END                             *E2
067400200529      *
067500200529      **  CONVERT SPOT RATE FROM NOMINAL CCY TO NEW CCY
067600200529     C                     Z-ADD1         ZAMTF
067700200529     C                     MOVELTNMC      ZCCYF
067800200529     C                     Z-ADDA6SPRT    ZRATEF
067900200529     C                     MOVELA6MDIN    ZMDINF
068000200529     C                     Z-ADDA6NBDP    ZCDPF
068100200529      *
068200200529     C                     MOVELFMNBCY    ZCCYT
068300200529     C                     Z-ADDW2SPRT    ZRATET
068400200529     C                     MOVELW2MDIN    ZMDINT
068500200529     C                     Z-ADDW2NBDP    ZCDPT
068600200529     C*                                                                   158524
068700200529     C           TNMC      IFEQ BKEURO                     B2             158524
068800200529     C           W2INCY    ANDEQ'Y'                                       158524
068900200529     C           FMNBCY    OREQ BKEURO                                    158524
069000200529     C           A6INCY    ANDEQ'Y'                                       158524
069100200529     C           A6INCY    OREQ 'Y'                                       158524
069200200529     C           W2INCY    ANDEQ'Y'                                       158524
069300200529     C*                                                                   158524
069400200529     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       158524
069500200529     C           TNMC      IFEQ BKEURO                     B3             158524
069600200529     C                     MOVE 'M'       ZMDINF                          158524
069700200529     C                     Z-ADD1         ZRATEF                          158524
069800200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
069900200529     C                     ELSE                            X3             158524
070000200529     C                     Z-ADDA6EUER    ZRATEF                          158524
070100200529     C                     MOVE A6EUMD    ZMDINF                          158524
070200200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
070300200529     C                     END                             E3             158524
070400200529     C*                                                                   158524
070500200529     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       158524
070600200529     C           FMNBCY    IFEQ BKEURO                     B3             158524
070700200529     C                     MOVE 'M'       ZMDINT                          158524
070800200529     C                     Z-ADD1         ZRATET                          158524
070900200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
071000200529     C                     ELSE                            X3             158524
071100200529     C                     Z-ADDW2EUER    ZRATET                          158524
071200200529     C                     MOVE W2EUMD    ZMDINT                          158524
071300200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
071400200529     C                     END                             E3             158524
071500200529     C*                                                                   158524
071600200529     C                     END                             E2             158524
071700200529     C*                                                                   158524
071800200529     C                     EXSR ZCCYCN
071900200529      *
072000200529     C           @FORM     IFEQ 'TRADSDF'                  *B2
072100200529      *
072200200529     C                     Z-ADD*ZEROS    WTDER  138
072300200529     C           TMDI      IFEQ 'D'                        *B3
072400200529     C           1         DIV  TDER      WTDER
072500200529     C           ZCRSRT    DIV  WTDER     SPXR
072600200529     C                     MOVEL'M'       SPMD
072700200529     C                     ELSE                            *X3
072800200529     C           ZCRSRT    DIV  TDER      SPXR
072900200529     C                     MOVEL'M'       SPMD
073000200529     C                     END                             *E3
073100200529      *
073200200529     C                     EXCPTTRADSU
073300200529     C                     ELSE                            *X2
073400200529      *
073500200529     C           SPMD      IFEQ 'D'                        *B3
073600200529     C           1         DIV  TDER      WTDER
073700200529     C           ZCRSRT    DIV  WTDER     SPXR
073800200529     C                     MOVEL'M'       SPMD
073900200529     C                     ELSE                            *X3
074000200529     C           ZCRSRT    DIV  TDER      SPXR
074100200529     C                     MOVEL'M'       SPMD
074200200529     C                     END                             *E3
074300200529      *
074400200529     C                     EXCPTHSTTRU
074500200529     C                     END                             *E2
074600200529      *
074700200529     C                     END                             *E1
074800200529      *
074900200529     C***********KEY3      READEPORTMT                   73               CPM005
075000200529     C           KEY3      READEPMTRMVL0                 73               CPM005
075100200529      *
075200200529     C                     ENDDO                           *EW1
075300200529      *
075400200529     C                     ENDSR
075500200529      ********************************************************************
075600200529      /EJECT
075700200529      ********************************************************************
075800200529      *                                                                  *
075900200529      * #ACTI    - RESET ALL ACTIONS                                     *
076000200529      *                                                                  *
076100200529      * SUBROUTINE CALLS:                                                *
076200200529      *                                                                  *
076300200529      * SUBROUTINE CALLED FROM:                                          *
076400200529      * MAIN     -                                                       *
076500200529      *                                                                  *
076600200529      * ROUTINE USES VARIABLES:                                          *
076700200529      *                                                                  *
076800200529      ********************************************************************
076900200529     C           #ACTI     BEGSR
077000200529      *
077100200529     C***********KEY3      SETLLCAPRHP                                    CPM005
077200200529     C***********KEY3      READECAPRHP                   73               CPM005
077300200529     C           KEY3      SETLLPMCAPRL5                                  CPM005
077400200529     C           KEY3      READEPMCAPRL5                 73               CPM005
077500200529      *
077600200529     C           *IN73     DOWEQ*OFF                       *BW1
077700200529      *
077800200529     C           PMTI      IFEQ 'H'                        *B1
077900200529      *
078000200529      **  ACCESS SECURITY TO RETRIEVE NOMINAL CCY
078100200529     C           CSSC      CHAINSECTY                71
078200200529      *
078300200529      **  IF RECORD NOT FOUND, DB ERROR
078400200529     C           *IN71     IFEQ '1'                        *B2
078500200529     C                     Z-ADD12        DBASE            ***************
078600200529     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 12 *
078700200529     C                     MOVELCSSC      DBKEY            ***************
078800200529     C                     EXSR *PSSR
078900200529     C                     END                             *E2
079000200529      *
079100200529      **  ACCESS CURRENCY FILE TO RETRIEVE DETAILS
079200200529     C***********NMCY      CHAINSDCURRL1             71                   CPM005
079300200529     C                     CALL 'AOCURRR0'                                CPM005
079400200529     C                     PARM *BLANKS   WWRTCD                          CPM005
079500200529     C                     PARM '*KEY   ' WWOPTN                          CPM005
079600200529     C                     PARM NMCY      WWKEYC  3                       CPM005
079700200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
079800200529      *
079900200529      **  IF RECORD NOT FOUND, DB ERROR
080000200529     C************IN71     IFEQ '1'                        *B2            CPM005
080100200529     C           WWRTCD    IFNE *BLANKS                                   CPM005
080200200529     C                     Z-ADD13        DBASE            ***************
080300200529     C***********          MOVEL'SDCURRL1'DBFILE           * DB ERROR 02 *CPM005
080400200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 02 *CPM005
080500200529     C                     MOVELNMCY      DBKEY            ***************
080600200529     C                     EXSR *PSSR
080700200529     C                     END                             *E2
080800200529      *
080900200529      **  CONVERT SPOT RATE FROM NOMINAL CCY TO NEW CCY
081000200529     C                     Z-ADDCSTB      ZAMTF
081100200529     C                     MOVELNMCY      ZCCYF
081200200529     C                     Z-ADDA6SPRT    ZRATEF
081300200529     C                     MOVELA6MDIN    ZMDINF
081400200529     C                     Z-ADDA6NBDP    ZCDPF
081500200529      *
081600200529     C                     MOVELFMNBCY    ZCCYT
081700200529     C                     Z-ADDW2SPRT    ZRATET
081800200529     C                     MOVELW2MDIN    ZMDINT
081900200529     C                     Z-ADDW2NBDP    ZCDPT
082000200529     C*                                                                   158524
082100200529     C           NMCY      IFEQ BKEURO                     B2             158524
082200200529     C           W2INCY    ANDEQ'Y'                                       158524
082300200529     C           FMNBCY    OREQ BKEURO                                    158524
082400200529     C           A6INCY    ANDEQ'Y'                                       158524
082500200529     C           A6INCY    OREQ 'Y'                                       158524
082600200529     C           W2INCY    ANDEQ'Y'                                       158524
082700200529     C*                                                                   158524
082800200529     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       158524
082900200529     C           NMCY      IFEQ BKEURO                     B3             158524
083000200529     C                     MOVE 'M'       ZMDINF                          158524
083100200529     C                     Z-ADD1         ZRATEF                          158524
083200200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
083300200529     C                     ELSE                            X3             158524
083400200529     C                     Z-ADDA6EUER    ZRATEF                          158524
083500200529     C                     MOVE A6EUMD    ZMDINF                          158524
083600200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
083700200529     C                     END                             E3             158524
083800200529     C*                                                                   158524
083900200529     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       158524
084000200529     C           FMNBCY    IFEQ BKEURO                     B3             158524
084100200529     C                     MOVE 'M'       ZMDINT                          158524
084200200529     C                     Z-ADD1         ZRATET                          158524
084300200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
084400200529     C                     ELSE                            X3             158524
084500200529     C                     Z-ADDW2EUER    ZRATET                          158524
084600200529     C                     MOVE W2EUMD    ZMDINT                          158524
084700200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
084800200529     C                     END                             E3             158524
084900200529     C*                                                                   158524
085000200529     C                     END                             E2             158524
085100200529     C*                                                                   158524
085200200529     C                     EXSR ZCCYCN
085300200529      *
085400200529     C                     Z-ADDZAMTT     CFAP
085500200529      *
085600200529     C                     END                             *E1
085700200529      *
085800200529     C           PMVI      IFEQ 'H'                        *B1
085900200529      *
086000200529      **  ACCESS SECURITY TO RETRIEVE NOMINAL CCY
086100200529     C           CSSC      CHAINSECTY                71
086200200529      *
086300200529      **  IF RECORD NOT FOUND, DB ERROR
086400200529     C           *IN71     IFEQ '1'                        *B2
086500200529     C                     Z-ADD14        DBASE            ***************
086600200529     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 14 *
086700200529     C                     MOVELCSSC      DBKEY            ***************
086800200529     C                     EXSR *PSSR
086900200529     C                     END                             *E2
087000200529      *
087100200529      **  ACCESS CURRENCY FILE TO RETRIEVE DETAILS
087200200529     C***********NMCY      CHAINSDCURRL1             71                   CPM005
087300200529     C                     CALL 'AOCURRR0'                                CPM005
087400200529     C                     PARM *BLANKS   WWRTCD                          CPM005
087500200529     C                     PARM '*KEY   ' WWOPTN                          CPM005
087600200529     C                     PARM NMCY      WWKEYC  3                       CPM005
087700200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
087800200529      *
087900200529      **  IF RECORD NOT FOUND, DB ERROR
088000200529     C************IN71     IFEQ '1'                        *B2            CPM005
088100200529     C           WWRTCD    IFNE *BLANKS                                   CPM005
088200200529     C                     Z-ADD15        DBASE            ***************
088300200529     C***********          MOVEL'SDCURRL1'DBFILE           * DB ERROR 02 *CPM005
088400200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 02 *CPM005
088500200529     C                     MOVELNMCY      DBKEY            ***************
088600200529     C                     EXSR *PSSR
088700200529     C                     END                             *E2
088800200529      *
088900200529      **  CONVERT SPOT RATE FROM NOMINAL CCY TO NEW CCY
089000200529     C                     Z-ADDCSVB      ZAMTF
089100200529     C                     MOVELNMCY      ZCCYF
089200200529     C                     Z-ADDA6SPRT    ZRATEF
089300200529     C                     MOVELA6MDIN    ZMDINF
089400200529     C                     Z-ADDA6NBDP    ZCDPF
089500200529      *
089600200529     C                     MOVELFMNBCY    ZCCYT
089700200529     C                     Z-ADDW2SPRT    ZRATET
089800200529     C                     MOVELW2MDIN    ZMDINT
089900200529     C                     Z-ADDW2NBDP    ZCDPT
090000200529     C*                                                                   158524
090100200529     C           NMCY      IFEQ BKEURO                     B2             158524
090200200529     C           W2INCY    ANDEQ'Y'                                       158524
090300200529     C           FMNBCY    OREQ BKEURO                                    158524
090400200529     C           A6INCY    ANDEQ'Y'                                       158524
090500200529     C           A6INCY    OREQ 'Y'                                       158524
090600200529     C           W2INCY    ANDEQ'Y'                                       158524
090700200529     C*                                                                   158524
090800200529     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       158524
090900200529     C           NMCY      IFEQ BKEURO                     B3             158524
091000200529     C                     MOVE 'M'       ZMDINF                          158524
091100200529     C                     Z-ADD1         ZRATEF                          158524
091200200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
091300200529     C                     ELSE                            X3             158524
091400200529     C                     Z-ADDA6EUER    ZRATEF                          158524
091500200529     C                     MOVE A6EUMD    ZMDINF                          158524
091600200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
091700200529     C                     END                             E3             158524
091800200529     C*                                                                   158524
091900200529     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       158524
092000200529     C           FMNBCY    IFEQ BKEURO                     B3             158524
092100200529     C                     MOVE 'M'       ZMDINT                          158524
092200200529     C                     Z-ADD1         ZRATET                          158524
092300200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
092400200529     C                     ELSE                            X3             158524
092500200529     C                     Z-ADDW2EUER    ZRATET                          158524
092600200529     C                     MOVE W2EUMD    ZMDINT                          158524
092700200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
092800200529     C                     END                             E3             158524
092900200529     C*                                                                   158524
093000200529     C                     END                             E2             158524
093100200529     C*                                                                   158524
093200200529     C                     EXSR ZCCYCN
093300200529      *
093400200529     C                     Z-ADDZAMTT     CFAP
093500200529      *
093600200529     C                     END                             *E1
093700200529      *
093800200529     C           PMTI      IFEQ 'H'                        *B1
093900200529     C           PMVI      OREQ 'H'
094000200529      *
094100200529     C                     Z-ADDZCRSRT    CAVR
094200200529     C                     Z-ADDZCRSRT    CFXR
094300200529      *
094400200529     C                     END                             *E1
094500200529      *
094600200529     C                     EXCPTCAPRHU
094700200529      *
094800200529     C***********KEY3      READECAPRHP                   73               CPM005
094900200529     C           KEY3      READEPMCAPRL5                 73               CPM005
095000200529      *
095100200529     C                     ENDDO                           *EW1
095200200529      *
095300200529     C                     ENDSR
095400200529      ********************************************************************
095500200529      /EJECT
095600200529      ********************************************************************
095700200529      *                                                                  *
095800200529      * #CHGBC   - CHANGE CUSTOMER BASE CURRENCY                         *
095900200529      *                                                                  *
096000200529      * SUBROUTINE CALLS:                                                *
096100200529      *                                                                  *
096200200529      * SUBROUTINE CALLED FROM:                                          *
096300200529      * MAIN     -                                                       *
096400200529      *                                                                  *
096500200529      * ROUTINE USES VARIABLES:                                          *
096600200529      *                                                                  *
096700200529      ********************************************************************
096800200529     C           #CHGBC    BEGSR
096900200529      *
097000200529      **  ACCESS PM CUSTOMER DETAILS
097100200529     C                     MOVE FMCUST    KCUST   6
097200200529     C***********KCUST     CHAINSDPLCSLL             71                   CPM005
097300200529     C           KCUST     CHAINSDPLCSL1             71                   CPM005
097400200529      *
097500200529      **  IF RECORD NOT FOUND, DB ERROR
097600200529     C           *IN71     IFEQ '1'                        *B1
097700200529     C                     Z-ADD3         DBASE            ***************
097800200529     C***********          MOVEL'SDPLCSLL'DBFILE           * DB ERROR 03 *CPM005
097900200529     C                     MOVEL'SDPLCSL1'DBFILE           * DB ERROR 03 *CPM005
098000200529     C                     MOVELFMCUST    DBKEY            ***************
098100200529     C                     EXSR *PSSR
098200200529     C                     END                             *E1
098300200529      *
098400200529     C                     MOVE FMNBCY    QBCSBY
098500200529     C                     Z-ADDA6NBDP    QBBYDP
098600200529     C***********          UPDATSDPLCSP0                                  CPM005
098700200529     C                     UPDAT@PLCSL1                                   CPM005
098800200529      *
098900200529     C**********           Z-ADDFMCUST    KCNUM                                               CSD027
099000200529     C                     MOVE FMCUST    KCNUM                                               CSD027
099100200529     C                     MOVE '9997'    KPTFR
099200200529      *
099300200529      **  ACCESS CONSOLIDATED PORTFOLIO DETAILS FILE
099400200529     C           KEY1      CHAINPMCNSDLL             71
099500200529      *
099600200529      **  IF RECORD FOUND
099700200529     C           *IN71     IFEQ '0'                        *B1
099800200529     C           XPNPSD    IFLE WWECD
099900200529     C                     Z-ADDWWECD     XPNPSD
100000200529     C                     END
100100200529     C                     MOVE FMNBCY    XPNPTC
100200200529     C                     Z-ADDA6NBDP    XPNPCD
100300200529     C                     UPDATPMCNSDD0
100400200529     C                     END                             *E1
100500200529      *
100600200529     C                     MOVE '9998'    KPTFR
100700200529      *
100800200529      **  ACCESS CONSOLIDATED PORTFOLIO DETAILS FILE
100900200529     C           KEY1      CHAINPMCNSDLL             71
101000200529      *
101100200529      **  IF RECORD FOUND
101200200529     C           *IN71     IFEQ '0'                        *B1
101300200529     C           XPNPSD    IFLE WWECD
101400200529     C                     Z-ADDWWECD     XPNPSD
101500200529     C                     END
101600200529     C                     MOVE FMNBCY    XPNPTC
101700200529     C                     Z-ADDA6NBDP    XPNPCD
101800200529     C                     UPDATPMCNSDD0
101900200529     C                     END                             *E1
102000200529      *
102100200529     C                     MOVE '9999'    KPTFR
102200200529      *
102300200529      **  ACCESS CONSOLIDATED PORTFOLIO DETAILS FILE
102400200529     C           KEY1      CHAINPMCNSDLL             71
102500200529      *
102600200529      **  IF RECORD FOUND
102700200529     C           *IN71     IFEQ '0'                        *B1
102800200529     C           XPNPSD    IFLE WWECD
102900200529     C                     Z-ADDWWECD     XPNPSD
103000200529     C                     END
103100200529     C                     MOVE FMNBCY    XPNPTC
103200200529     C                     Z-ADDA6NBDP    XPNPCD
103300200529     C                     UPDATPMCNSDD0
103400200529     C                     END                             *E1
103500200529      *
103600200529     C                     ENDSR
103700200529      ********************************************************************
103800200529      /EJECT
103900200529      ********************************************************************
104000200529      *                                                                  *
104100200529      * #CHGPC   - CHANGE PORTFOLIO BASE CURRENCY                        *
104200200529      *                                                                  *
104300200529      * SUBROUTINE CALLS:                                                *
104400200529      *                                                                  *
104500200529      * SUBROUTINE CALLED FROM:                                          *
104600200529      * MAIN     -                                                       *
104700200529      *                                                                  *
104800200529      * ROUTINE USES VARIABLES:                                          *
104900200529      *                                                                  *
105000200529      ********************************************************************
105100200529     C           #CHGPC    BEGSR
105200200529      *
105300200529      **  ACCESS PM CUSTOMER DETAILS
105400200529     C**********           Z-ADDFMCUST    KCNUM                                               CSD027
105500200529     C                     MOVE FMCUST    KCNUM                                               CSD027
105600200529     C                     MOVE FMPTFR    KPTFR
105700200529     C***********KEY1      CHAINPMPORTPP             71                   CPM005
105800200529     C           KEY1      CHAINPMPORTPD             71                   CPM005
105900200529      *
106000200529      **  IF RECORD NOT FOUND, DB ERROR
106100200529     C           *IN71     IFEQ '1'                        *B1
106200200529     C                     Z-ADD4         DBASE            ***************
106300200529     C***********          MOVEL'PMPORTPP'DBFILE           * DB ERROR 04 *CPM005
106400200529     C                     MOVEL'PMPORTPD'DBFILE           * DB ERROR 04 *CPM005
106500200529     C                     MOVELWKEY1     DBKEY            ***************
106600200529     C                     EXSR *PSSR
106700200529     C                     END                             *E1
106800200529      *
106900200529     C           PNPSDT    IFLE WWECD
107000200529     C                     Z-ADDWWECD     PNPSDT
107100200529     C                     END
107200200529     C                     MOVE FMNBCY    PNPTCY
107300200529     C                     Z-ADDA6NBDP    PNPCDP
107400200529     C                     UPDATPMPORTP0
107500200529      *
107600200529     C                     ENDSR
107700200529      ********************************************************************
107800200529      /EJECT
107900200529      ********************************************************************
108000200529      *                                                                  *
108100200529      * #PORTF   - PORTFOLIO POSITIONS PROCESSING                        *
108200200529      *                                                                  *
108300200529      * SUBROUTINE CALLS:                                                *
108400200529      *                                                                  *
108500200529      * SUBROUTINE CALLED FROM:                                          *
108600200529      * MAIN     -                                                       *
108700200529      *                                                                  *
108800200529      * ROUTINE USES VARIABLES:                                          *
108900200529      *                                                                  *
109000200529      ********************************************************************
109100200529     C           #PORTF    BEGSR
109200200529      *
109300200529     C**********           Z-ADDFMCUST    KCNUM                                               CSD027
109400200529     C                     MOVE FMCUST    KCNUM                                               CSD027
109500200529      *
109600200529      ****IF*PORTFOLIO*REFERENCE*FROM*PF/PMPCBCPP*IS*EQUAL*TO*BLANKS******CPM005
109700200529      **  IF PORTFOLIO REFERENCE FROM PF/PMPCBCPD IS EQUAL TO BLANKS      CPM005
109800200529     C           FMPTFR    IFEQ *BLANKS                    *B1
109900200529     C                     MOVE '9997'    KPTFR
110000200529     C                     ELSE                            *X1
110100200529     C                     MOVE FMPTFR    KPTFR
110200200529     C                     END                             *E1
110300200529      *
110400200529     C           KEY1      SETLLPMCPOSLL
110500200529     C           KEY1      READEPMCPOSLL                 71
110600200529      *
110700200529     C           *IN71     DOWEQ'0'
110800200529      *
110900200529      **  IF TRADE DATE RECORD READ OUTPUT CHANGE TO TRADE DATE PRICE
111000200529     C           QATVDA    IFEQ 'T'                        *B2
111100200529     C                     MOVE 'XT'      CSOA
111200200529     C                     MOVE 'H'       PMTI
111300200529     C                     MOVE '*'       PMVI
111400200529      *
111500200529      **  WRITE A RECORD ON PF/CAPRHD
111600200529     C                     EXSR #WRITE
111700200529     C                     END                             *E2
111800200529      *
111900200529      **  IF TRADE DATE RECORD READ OUTPUT CHANGE TO TRADE DATE PRICE
112000200529     C           QATVDA    IFEQ 'V'                        *B2
112100200529     C                     MOVE 'XV'      CSOA
112200200529     C                     MOVE '*'       PMTI
112300200529     C                     MOVE 'H'       PMVI
112400200529      *
112500200529      **  WRITE A RECORD ON PF/CAPRHD
112600200529     C                     EXSR #WRITE
112700200529     C                     END                             *E2
112800200529      *
112900200529     C           KEY1      READEPMCPOSLL                 71
113000200529     C                     END                             *E1
113100200529      *
113200200529     C                     ENDSR
113300200529      ********************************************************************
113400200529      /EJECT
113500200529      ********************************************************************
113600200529      *                                                                  *
113700200529      * #WRITE   - WRITE A RECORD ON PF/CAPRHD                           *
113800200529      *                                                                  *
113900200529      * SUBROUTINE CALLS:                                                *
114000200529      *                                                                  *
114100200529      * SUBROUTINE CALLED FROM:                                          *
114200200529      * #PORTF   -                                                       *
114300200529      *                                                                  *
114400200529      * ROUTINE USES VARIABLES:                                          *
114500200529      *                                                                  *
114600200529      ********************************************************************
114700200529     C           #WRITE    BEGSR
114800200529      *
114900200529     C                     MOVE 'H'       RECI             Record Id
115000200529     C**********           Z-ADDFMCUST    CSCN             Customer                           CSD027
115100200529     C                     MOVE FMCUST    CSCN             Customer                           CSD027
115200200529     C***********          Z-ADD*ZEROS    CSBR             Branch         CPM005
115300200529     C                     MOVEL*BLANKS   CSBA             Branch         CPM005
115400200529     C                     MOVE QATDSS    CSSC             Security
115500200529     C                     Z-ADDBJRDNB    CSDA             Date
115600200529     C                     MOVE '5'       CSSE             Sort Sequence
115700200529     C*
115800200529     C                     Z-ADD*ZEROS    CSTB             Charge to Av. Price
115900200529     C                     Z-ADD*ZEROS    CSVB             Charge to Av. Price
116000200529     C                     Z-ADD*ZEROS    CSAP             Average Price
116100200529     C                     Z-ADD*ZEROS    CSCP             Cust. Contract Price
116200200529     C                     Z-ADD*ZEROS    CSNL             Nominal
116300200529     C                     MOVE *BLANKS   CSRF             Reference
116400200529     C                     Z-ADDWWECD     CSGD             Date Generated
116500200529     C*
116600200529     C                     MOVE QAPTFR    PTFR             Portfolio Reference
116700200529     C                     MOVE *BLANKS   ACIN             Accrued Indicator
116800200529     C                     Z-ADD*ZEROS    ITRA             Interest Amount
116900200529     C                     Z-ADD*ZEROS    CFAP             Change to FX AP Num.
117000200529      *
117100200529      **  ACCESS CURRENCY DETAILS FILE TO RETRIEVE NOMINAL CURRENCY DETAILS
117200200529     C***********QATNMC    CHAINSDCURRL1             71                   CPM005
117300200529     C                     CALL 'AOCURRR0'                                CPM005
117400200529     C                     PARM *BLANKS   WWRTCD                          CPM005
117500200529     C                     PARM '*KEY   ' WWOPTN                          CPM005
117600200529     C                     PARM QATNMC    WWKEYC  3                       CPM005
117700200529     C           SDCURR    PARM SDCURR    DSSDY                           CPM005
117800200529      *
117900200529      **  IF RECORD NOT FOUND, DB ERROR
118000200529     C************IN71     IFEQ '1'                        *B2            CPM005
118100200529     C           WWRTCD    IFNE *BLANKS                                   CPM005
118200200529     C                     Z-ADD5         DBASE            ***************
118300200529     C***********          MOVEL'SDCURRL1'DBFILE           * DB ERROR 02 *CPM005
118400200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 02 *CPM005
118500200529     C                     MOVELQATNMC    DBKEY            ***************
118600200529     C                     EXSR *PSSR
118700200529     C                     END                             *E2
118800200529     C*
118900200529     C                     Z-ADD1         ZAMTF
119000200529     C                     MOVELQATNMC    ZCCYF
119100200529     C                     MOVELFMNBCY    ZCCYT
119200200529     C                     Z-ADDA6SPRT    ZRATEF
119300200529     C                     Z-ADDW2SPRT    ZRATET
119400200529     C                     MOVELA6MDIN    ZMDINF
119500200529     C                     MOVELW2MDIN    ZMDINT
119600200529     C                     Z-ADDA6NBDP    ZCDPF
119700200529     C                     Z-ADDW2NBDP    ZCDPT
119800200529     C*                                                                   158524
119900200529     C           QATNMC    IFEQ BKEURO                     B1             158524
120000200529     C           W2INCY    ANDEQ'Y'                                       158524
120100200529     C           FMNBCY    OREQ BKEURO                                    158524
120200200529     C           A6INCY    ANDEQ'Y'                                       158524
120300200529     C           A6INCY    OREQ 'Y'                                       158524
120400200529     C           W2INCY    ANDEQ'Y'                                       158524
120500200529     C*                                                                   158524
120600200529     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       158524
120700200529     C           QATNMC    IFEQ BKEURO                     B2             158524
120800200529     C                     MOVE 'M'       ZMDINF                          158524
120900200529     C                     Z-ADD1         ZRATEF                          158524
121000200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
121100200529     C                     ELSE                            X2             158524
121200200529     C                     Z-ADDA6EUER    ZRATEF                          158524
121300200529     C                     MOVE A6EUMD    ZMDINF                          158524
121400200529     C                     Z-ADDA6NBDP    ZCDPF                           158524
121500200529     C                     END                             E2             158524
121600200529     C*                                                                   158524
121700200529     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       158524
121800200529     C           FMNBCY    IFEQ BKEURO                     B2             158524
121900200529     C                     MOVE 'M'       ZMDINT                          158524
122000200529     C                     Z-ADD1         ZRATET                          158524
122100200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
122200200529     C                     ELSE                            X2             158524
122300200529     C                     Z-ADDW2EUER    ZRATET                          158524
122400200529     C                     MOVE W2EUMD    ZMDINT                          158524
122500200529     C                     Z-ADDW2NBDP    ZCDPT                           158524
122600200529     C                     END                             E2             158524
122700200529     C*                                                                   158524
122800200529     C                     END                             E1             158524
122900200529     C*                                                                   158524
123000200529     C                     EXSR ZCCYCN
123100200529     C                     Z-ADDZCRSRT    CAVR             Average FX Rate
123200200529     C*
123300200529     C                     Z-ADD*ZEROS    CFXR             Customer FX Rate
123400200529     C                     Z-ADD*ZEROS    CYLD             Customer Yield Rate
123500200529     C                     Z-ADDWWECD     OTHD             Other Date
123600200529      *
123700200529     C                     WRITECAPRHDF
123800200529      *
123900200529     C                     ENDSR
124000200529      ********************************************************************
124100200529      /EJECT
124200200529      ********************************************************************
124300200529      *                                                                  *
124400200529      * #MATUR   - SET RECORD ID IN 'MATURED' STATUS                     *
124500200529      *          - DELETE PORTFOLIO PROCESSING                           *
124600200529      *                                                                  *
124700200529      * SUBROUTINE CALLS:                                                *
124800200529      *                                                                  *
124900200529      * SUBROUTINE CALLED FROM:                                          *
125000200529      * MAIN     -                                                       *
125100200529      *                                                                  *
125200200529      * ROUTINE USES VARIABLES:                                          *
125300200529      *                                                                  *
125400200529      ********************************************************************
125500200529     C           #MATUR    BEGSR
125600200529      *
125700200529     C**********           Z-ADDFMCUST    KCNUM2                                              CSD027
125800200529     C                     MOVE FMCUST    KCNUM2                                              CSD027
125900200529     C                     MOVE FMPTFR    KPTFR2
126000200529     C                     Z-ADDFMTNLU    KTNLU2
126100200529      *
126200200529     C           KEY2      CHAINPMPCBCL0             71
126300200529      *
126400200529      **  IF RECORD NOT FOUND, DB ERROR
126500200529     C           *IN71     IFEQ '1'                        *B1
126600200529     C                     Z-ADD6         DBASE            ***************
126700200529     C                     MOVEL'PMPCBCL0'DBFILE           * DB ERROR 06 *
126800200529     C                     MOVELWKEY2     DBKEY            ***************
126900200529     C                     EXSR *PSSR
127000200529     C                     END                             *E1
127100200529      *
127200200529     C                     MOVE 'M'       FMRECI
127300200529     C                     UPDATPMPCBCDD
127400200529      *
127500200529      **  ACCESS PM CUSTOMER DETAILS
127600200529     C                     MOVE FMCUST    KCUST   6
127700200529     C***********KCUST     CHAINSDPLCSLL             71                   CPM005
127800200529     C           KCUST     CHAINSDPLCSL1             71                   CPM005
127900200529      *
128000200529      **  IF RECORD NOT FOUND, DB ERROR
128100200529     C           *IN71     IFEQ '1'                        *B1
128200200529     C                     Z-ADD7         DBASE            ***************
128300200529     C***********          MOVEL'SDPLCSLL'DBFILE           * DB ERROR 03 *CPM005
128400200529     C                     MOVEL'SDPLCSL1'DBFILE           * DB ERROR 03 *CPM005
128500200529     C                     MOVELFMCUST    DBKEY            ***************
128600200529     C                     EXSR *PSSR
128700200529     C                     END                             *E1
128800200529      *
128900200529     C                     MOVE 'Y'       WALLBC  1
129000200529      *
129100200529     C***********FMCUST    SETLLPMPORTPP                                  CPM005
129200200529     C***********FMCUST    READEPMPORTPP                 71               CPM005
129300200529     C           FMCUST    SETLLPMPORTPD                                  CPM005
129400200529     C           FMCUST    READEPMPORTPD                 71               CPM005
129500200529      *
129600200529      **  DO WHILE SAME CUSTOMER READ AND 'ALL PORTFOLIO IN BASE CCY' IS 'Y'
129700200529     C           *IN71     DOWEQ'0'                        *B1
129800200529     C           WALLBC    ANDEQ'Y'
129900200529      *
130000200529      **  IF CUSTOMER BASE CURRENCY IS NOT EQUAL TO PORTFOLIO CURRENCY
130100200529     C           QBCSBY    IFNE PNPTCY                     *B2
130200200529     C                     MOVE 'N'       WALLBC
130300200529     C                     END                             *E2
130400200529      *
130500200529     C***********FMCUST    READEPMPORTPP                 71               CPM005
130600200529     C           FMCUST    READEPMPORTPD                 71               CPM005
130700200529     C                     END                             *E1
130800200529      *
130900200529      **  MOVE WORKFIELD IN "ALL PORTFOLIOS IN BASE CURRENCY" FIELD
131000200529     C                     MOVE WALLBC    QBAPBC
131100200529     C***********          UPDATSDPLCSP0                                  CPM005
131200200529     C                     UPDAT@PLCSL1                                   CPM005
131300200529      *
131400200529      ****IF*PORTFOLIO*REFERENCE*FROM*PF/PMPCBCPP*IS*EQUAL*TO*BLANKS******CPM005
131500200529      **  IF PORTFOLIO REFERENCE FROM PF/PMPCBCPD IS EQUAL TO BLANKS      CPM005
131600200529     C           FMPTFR    IFEQ *BLANKS                    *B1
131700200529     C                     MOVE '9997'    KPTFR
131800200529     C                     EXSR #DELET
131900200529      *
132000200529     C                     MOVE '9998'    KPTFR
132100200529     C                     EXSR #DELET
132200200529      *
132300200529     C                     MOVE '9999'    KPTFR
132400200529     C                     EXSR #DELET
132500200529      *
132600200529     C                     ELSE                            *X1
132700200529     C                     MOVE FMPTFR    KPTFR
132800200529     C                     EXSR #DELET
132900200529     C                     END                             *E1
133000200529      *
133100200529     C                     ENDSR
133200200529      ********************************************************************
133300200529      /EJECT
133400200529      ********************************************************************
133500200529      *                                                                  *
133600200529      * #DELET   - DELETE RECORD IN 'MATURED' STATUS                     *
133700200529      *                                                                  *
133800200529      * SUBROUTINE CALLS:                                                *
133900200529      *                                                                  *
134000200529      * SUBROUTINE CALLED FROM:                                          *
134100200529      * #MATUR   -                                                       *
134200200529      *                                                                  *
134300200529      * ROUTINE USES VARIABLES:                                          *
134400200529      *                                                                  *
134500200529      ********************************************************************
134600200529     C           #DELET    BEGSR
134700200529      *
134800200529      ** DELETE RECORD FROM "PERFORMANCE START OF MONTH POSITION" FILE
134900200529     C***********KEY1      SETLLPMPSTMPP                                  CPM005
135000200529     C***********KEY1      READEPMPSTMPP                 71               CPM005
135100200529     C           KEY1      SETLLPMPSTMQ0                                  CPM005
135200200529     C           KEY1      READEPMPSTMQ0                 71               CPM005
135300200529      *
135400200529     C           *IN71     DOWEQ'0'                        *B1
135500200529     C                     DELETPMPSTMP0
135600200529     C***********KEY1      READEPMPSTMPP                 71               CPM005
135700200529     C           KEY1      READEPMPSTMQ0                 71               CPM005
135800200529     C                     END                             *E1
135900200529      *
136000200529      ** DELETE RECORD FROM "PERFORMANCE TRANSACTION ANALYSIS" FILE
136100200529     C           KEY1      SETLLPMPTRALL
136200200529     C           KEY1      READEPMPTRALL                 71
136300200529      *
136400200529     C           *IN71     DOWEQ'0'                        *B1
136500200529     C                     DELETPMPTRAP0
136600200529     C           KEY1      READEPMPTRALL                 71
136700200529     C                     END                             *E1
136800200529      *
136900200529      ** DELETE RECORD FROM "PERFORMANCE CASH ANALYSIS" FILE
137000200529     C           KEY1      SETLLPMPCAAL7
137100200529     C           KEY1      READEPMPCAAL7                 71
137200200529      *
137300200529     C           *IN71     DOWEQ'0'                        *B1
137400200529     C                     DELETPMPCAAP0
137500200529     C           KEY1      READEPMPCAAL7                 71
137600200529     C                     END                             *E1
137700200529      *
137800200529     C                     ENDSR
137900200529      ********************************************************************
138000200529      /EJECT
138100200529      ********************************************************************
138200200529      *                                                                  *
138300200529      * #TERM    - TERMINATION PROCESSING                                *
138400200529      *                                                                  *
138500200529      * SUBROUTINE CALLS:                                                *
138600200529      *                                                                  *
138700200529      * SUBROUTINE CALLED FROM:                                          *
138800200529      * MAIN     -                                                       *
138900200529      *                                                                  *
139000200529      * ROUTINE USES VARIABLES:                                          *
139100200529      *                                                                  *
139200200529      ********************************************************************
139300200529     C           #TERM     BEGSR
139400200529      *
139500200529     C                     MOVE '1'       *INLR
139600200529     C                     RETRN
139700200529      *
139800200529     C                     ENDSR
139900200529      ********************************************************************
140000200529      /EJECT
140100200529      ********************************************************************
140200200529      *                                                                  *
140300200529      * *PSSR    - ERROR IN FILE                                         *
140400200529      *                                                                  *
140500200529      * SUBROUTINE CALLS:                                                *
140600200529      *                                                                  *
140700200529      * SUBROUTINE CALLED FROM:                                          *
140800200529      * #INIT    - INITIAL PROCESSING                                    *
140900200529      *                                                                  *
141000200529      * ROUTINE USES VARIABLES:                                          *
141100200529      *                                                                  *
141200200529      ********************************************************************
141300200529     C           *PSSR     BEGSR
141400200529      *
141500200529     C                     DUMP                                           160446
141600200529     C           *LOCK     IN   LDA
141700200529     C                     OUT  LDA
141800200529      *
141900200529     C                     MOVE '1'       *INU7
142000200529     C                     MOVE '1'       *INU8
142100200529     C                     MOVE '1'       *INLR
142200200529     C***********          DUMP                                    160446
142300200529      *
142400200529     C                     RETRN
142500200529      *
142600200529     C                     ENDSR
142700200529     C**=================================================================
142800200529      /EJECT
142900200529      /COPY ZSRSRC,ZCCYCN
143000200529      /EJECT
143100200529      /COPY ZSRSRC,ZCCYXR
143200200529      /EJECT
143300200529     O*
143400200529     O** CUSTOMER AVERAGE PRICE ACTIONS
143500200529     OPMAPOSD0E                PMAPOU
143600200529     O                         QARECI
143700200529     O                         QAFXAP
143800200529     O                         QAPTCY
143900200529     O                         QAPCDP
144000200529     O                         QACSBY
144100200529     O                         QABYDP
144200200529     O**
144300200529     O** CUSTOMER AVERAGE PRICE ACTIONS
144400200529     OCAPRHD0 E                CAPRHU
144500200529     O                         CFAP
144600200529     O                         CAVR
144700200529     O                         CFXR
144800200529     O*
144900200529     O** DEPOT MOVEMENT DETAILS
145000200529     ODPTMVDF E                DPTMDU
145100200529     O                         SPXR
145200200529     O*
145300200529     ODPTMVTF E                DPTMTU
145400200529     O                         SPXR
145500200529     O*
145600200529     O** TRADE DETAILS
145700200529     OTRADSDF E                TRADSU
145800200529     O                         SPXR
145900200529     O                         SPMD
146000200529     O*
146100200529     OHSTTRDF E                HSTTRU
146200200529     O                         SPXR
146300200529     O                         SPMD
146400200529**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
1465002005290000001
1466002005290000010
1467002005290000100
1468002005290001000
1469002005290010000
1470002005290100000
1471002005291000000
147200200529**  CPY@
147300200529(c) Finastra International Limited 2001
