/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI *  TEXT('Midas RE Cash Management Daily Housekeeping')         */
/*********************************************************************/
/*                                                                   */
/*       Midas - Retail Module                                       */
/*                                                                   */
/*       REC100830 - Cash Management Daily Housekeeping              */
/*                                                                   */
/*       (c) Finastra International Limited 2002                     */
/*                                                                   */
/*       Last Amend No. MD046248           Date 27Oct17              */
/* Bank Fusion Midas 1.4 Base ---------------------------------------*/
/* Midas Plus 1.4 Base 04 -------------------------------------------*/
/* Midas Plus 1.4 Base ----------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base -----------------------------*/
/*       Prev Amend No. BUG7278            Date 20May05              */
/*                      228542             Date 10Aug04              */
/*                      214360             Date 03Feb03              */
/*                      212904             Date 14Jan03              */
/*                      212367             Date 10Dec02              */
/*                      CRE008 *CREATE     Date 19Feb02              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       MD046248 - Finastra Rebranding                              */
/*       BUG7278 - Error in daily initiation of REGARSPD.            */
/*       228542 - RGZPFM has changed at R5V3                         */
/*       214360 - Cash Management Deferred Posting                   */
/*       212904 - Balance purge errors                               */
/*       212367 - Various reporting errors                           */
/*       CRE008 - Cash Management                                    */
/*                                                                   */
/*********************************************************************/
             PGM
 
             DCL        VAR(&MEM) TYPE(*CHAR) LEN(70)
             DCL        VAR(&NDSURCV) TYPE(*CHAR) LEN(10)                                /*BUG7278*/
             DCL        VAR(&NDSUSEQ) TYPE(*DEC) LEN(10 0)                               /*BUG7278*/
 
             COPYRIGHT TEXT('(c) Finastra International Limited +
                          2002')
 
/* Global monitor message */
 
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(ABNOR))
 
             CHGJOB     SWS(00000000)
 
             SNDPGMMSG  MSG('REC100830 - Cash Management Daily +
                          Housekeeping') TOMSGQ(MRUNQ)
 
/* Reorganise files */
 
/**********  RGZPFM     FILE(REZSTDPD)                                                    /*228542*/
/**********  MONMSG     MSGID(CPF0000)                                                    /*228542*/
             CALL       PGM(SCC000060) PARM('REZSTDPD' '*FIRST')                          /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
                                                                                          /*228542*/
/**********  RGZPFM     FILE(REZSTIPD)                                                    /*228542*/
/**********  MONMSG     MSGID(CPF0000)                                                    /*228542*/
             CALL       PGM(SCC000060) PARM('REZSTIPD' '*FIRST')                          /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
 
/**********  RGZPFM     FILE(RERSTDPD)                                                    /*228542*/
/**********  MONMSG     MSGID(CPF0000)                                                    /*228542*/
             CALL       PGM(SCC000060) PARM('RERSTDPD' '*FIRST')                          /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
                                                                                          /*228542*/
/**********  RGZPFM     FILE(RERSTIPD)                                                    /*228542*/
/**********  MONMSG     MSGID(CPF0000)                                                    /*228542*/
             CALL       PGM(SCC000060) PARM('RERSTIPD' '*FIRST')                          /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
 
/**********  RGZPFM     FILE(REICSDPD)                                                    /*228542*/
/**********  MONMSG     MSGID(CPF0000)                                                    /*228542*/
             CALL       PGM(SCC000060) PARM('REICSDPD' '*FIRST')                          /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
                                                                                          /*228542*/
/**********  RGZPFM     FILE(REICSIPD)                                                    /*228542*/
/**********  MONMSG     MSGID(CPF0000)                                                    /*228542*/
             CALL       PGM(SCC000060) PARM('REICSIPD' '*FIRST')                          /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
 
/**********  RGZPFM     FILE(GLPSTTPD)                                                    /*228542*/
/**********  MONMSG     MSGID(CPF0000)                                                    /*228542*/
             CALL       PGM(SCC000060) PARM('GLPSTTPD' '*FIRST')                          /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
                                                                                          /*228542*/
/**********  RGZPFM     FILE(GLPSTZSPD)                                                   /*228542*/
/**********  MONMSG     MSGID(CPF0000)                                                    /*228542*/
             CALL       PGM(SCC000060) PARM('GLPSTZSPD' '*FIRST')                         /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
                                                                                          /*228542*/
/**********  RGZPFM     FILE(RECMPRPD)                       /*212904*/                   /*228542*/
/**********  MONMSG     MSGID(CPF0000)                       /*212904*/                   /*228542*/
             CALL       PGM(SCC000060) PARM('RECMPRPD' '*FIRST')                          /*228542*/
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                  /*228542*/
 
/* Clear files */
 
             CLRPFM     FILE(GLPSTGAPD)
 
/************CLRPFM*****FILE(REGARSPD)*****************************************************BUG7278*/
 
/**********  CLRPFM     FILE(REICSLPD)                                                 */ /*214360*/
 
             CLRPFM     FILE(RECMEXPD) MBR(MIC)
             CLRPFM     FILE(RECMEXPD) MBR(MASC)
             CLRPFM     FILE(RECMEXPD) MBR(MPUR)
             CLRPFM     FILE(RECMEXPD) MBR(M1)
             CLRPFM     FILE(RECMEXPD) MBR(M1PC)
             CLRPFM     FILE(RECMEXPD) MBR(M5)
             CLRPFM     FILE(RECMEXPD) MBR(M5PC)
 
             CLRPFM     FILE(RECMSRPD)                                                    /*212367*/
 
             CLRPFM     FILE(RECMVEPD)
 
/* Initialise files */
 
/************INZPFM*****FILE(REGARSPD)*TOTRCDS(1)******************************************BUG7278*/
/*                                                                                         BUG7278*/
/* Get the journal sequence number of the beginning of next day set up.                    BUG7278*/
/* This is the equivalent of the beginning of 'ICRCV001' in earlier releases of Midas.     BUG7278*/
/*                                                                                         BUG7278*/
             SCRTVJEVT  EVENT(NDSUJR) RECEIVER(&NDSURCV) +
                          SEQ(&NDSUSEQ)                                                  /*BUG7278*/
             MONMSG     MSGID(CPF0000 MCH0000) EXEC(DO)                                  /*BUG7278*/
             CHGVAR     VAR(&NDSUSEQ) VALUE(1)                                           /*BUG7278*/
             ENDDO                                                                       /*BUG7278*/
/*                                                                                         BUG7278*/
/* Call program REUPGARS to update the file REGARSPD with this value.                      BUG7278*/
/*                                                                                         BUG7278*/
             CALL     PGM(REUPGARS) PARM(&NDSUSEQ)                                       /*BUG7278*/
             MONMSG     MSGID(CPF0000 MCH0000) EXEC(DO)                                  /*BUG7278*/
             CLRPFM     FILE(REGARSPD)                                                   /*BUG7278*/
             INZPFM     FILE(REGARSPD) TOTRCDS(1)                                        /*BUG7278*/
             ENDDO                                                                       /*BUG7278*/
 
/* Normal ending: */
/*================*/
 
NORMAL:
             GOTO       CMDLBL(ENDPGM)
 
/* Abnormal ending: */
/*==================*/
 
ABNOR:
             CHGJOB     SWS(XXXXXX11)
 
/* Report an error */
 
             CHGVAR     VAR(&MEM) VALUE('REC100830 - Cash Management +
                          Daily Housekeeping FAILED')
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000)
 
             SNDPGMMSG  MSGID(MEM5052) MSGF(MIDAS) MSGDTA(&MEM) +
                          TOMSGQ(MOPERQ MRUNQ)
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000)
 
ENDPGM:
             ENDPGM
