0001 H        1                                                           S01117
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Trans Chgs-Initial Enq Scrn Proc')            *
0001 H***********                                                         S01117
0002 F*****************************************************************
0003 F*                                                               *
     F*  Midas - Retail Module
0005 F*                                                               *
0006 F*  RE0221 - TRANSACTION CHARGES   INPUT - S/RETRG               *
0007 F*           INITIAL/ENQUIRY SCREEN PROCESSING                   *
0008 F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*       1990                                                    *
0010 F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CGL154             Date 13Oct14               *
      *                 CER049             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01413             Date 13Apr93               *
     F*                 E22021                  26JUN90               *
     F*                 LN0233                  22MAY90               *
     F*                 S01194                  19FEB90               *
     F*                 S01199                  15FEB90               *
 011 F*                 S01117                  01NOV89               *
0012 F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  CER049 - Stamp Tax                                           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
     F*  S01413  -  Retail 3 Incorporation                            *
     F*  E22021  -  LDA IS BEING LOCKED BY THIS PROGRAM BUT IT IS     *
     F*             NEEDED BY INSTRUCTION MANUAL PROGRAM ASWELL , IF  *
     F*             IT IS CALLED (THIS IS MODIFIED FOR RELEASE 10)    *
     F*  LN0233  -  ADD IN VALIDATION FOR AMEND,DELETE & ENQUIRE      *
     F*             OPTIONS ALSO TO ALLOW ? IN S.D. FIELD(S)          *
     F*  S01194  -  STANDING DATA CHANGES                             *
     F*  S01199  -  HELP CHANGES                                      *
0010 F*  S01117  -  MULTIBRANCHING                                    *
     F*                                                               *
0013 F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/COPY WNCPYSRC,RE0221F001
0016 F***RE0220FMCF  F     271            WORKSTN                                             CER049
     FRE0220FMCF  F     272            WORKSTN                                                CER049
     F/COPY WNCPYSRC,RE0221F002
0017 F*
0019 F***RETRG   IF  F     128 12AI     2 DISK                                                CER049
     FRETRG   IF  F     129 12AI     2 DISK                                                   CER049
     F/COPY WNCPYSRC,RE0221F003
0021 F*TABLE***IF**F      96 12AI     2 DISK                              S01194
0022 F*
0023 F*       FUNCTION OF INDICATORS
0024 F*       STANDARD INPUT PROGRAM INDICATORS
     F*       KC      CMD/3 PRESSED - END PROGRAM
0025 F*       U7      DATABASE ERROR
0026 F*       89      BLINK ACTION CODE LABEL
0027 F*       88      NON-DISPLAY ERROR MESSAGE/CODES
0028 F*       87      NON-DISPLAY CHANGE DETAILS
0029 F*       86      NON-DISPLAY USEFUL DATA
0030 F*       85      OUTPUT ENQUIRE - SE - SCREEN
0031 F*       84      OUTPUT DELETE - SD - SCREEN
0032 F*       83      OUTPUT AMEND - SA - SCREEN
0033 F*       82      OUTPUT INSERT - SI - SCREEN
0034 F*       81      OUTPUT INITIAL - SF - SCREEN
0035 F*       80      BLINK DELETE CHECK FIELD LABEL
0036 F*       79      SYSTEM SET-UP FLAG ON
0037 F*       78      SF SCREEN READ IN
0038 F*       77      SE SCREEN READ IN
0039 F*       76      FIRST CYCLE IND
0040 F*       POSSIBLE MASTER FILE SITUATIONS
0041 F*       75      MASTER FILE - NO RECORD FOUND - NORF
0042 F*       74      MASTER FILE - RECORD FOUND, MATURED - RFMA
0043 F*       73      MASTER FILE - RECORD FOUND, DELETED TODAY - RFDT
0044 F*       72      MASTER FILE - RECORD FOUND, DELETED PREVIOUSLY-RFDP
0045 F*       71      MASTER FILE - RECORD FOUND, LIVE - RFLV
0046 F*       70      MASTER FILE - RECORD FOUND, BACKED OUT BY
0047 F*                                       RESTART/RECOVERY - RFBO
0048 F*       ACTION CODES ENTERED
0049 F*       69      E OR BLANK ENTERED
0050 F*       68      D ENTERED
0051 F*       67      A ENTERED
0052 F*       66      I ENTERED
0053 F*       ALLOWED ACTION CODES
0054 F*       65      INSERT OVER DELETED RECORD ALLOWED
0055 F*       64      ENQUIRE - E OR BLANK ALLOWED
0056 F*       63      DELETE - D ALLOWED
0057 F*       62      AMEND - A ALLOWED
0058 F*       61      INSERT - I ALLOWED
0059 F*       60      ACTION CODE ENTERED NOT I/A/D/E OR BLANK
0060 F*       59      MANDATORY KEY FIELD NOT ENTERED
0061 F*       58      USEFUL DATA TO BE DISPLAYED
0062 F*       NON-STANDARD INPUT PROGRAM INDICATORS
0063 F*       01      BLINK TRANSACTION TYPE
0064 F*       02      BLINK CURRENCY
0065 F*       03      BLINK TITLE
0066 F*       04      BLINK CHARGE - AMOUNT
0067 F*       05      BLINK D/C - AMOUNT
0068 F*       06      BLINK CHARGE - PERCENT
0069 F*       07      BLINK D/C - PERCENT
0070 F*       08      BLINK REBATEABLE INDICATOR
0014 F*       09      USED TO CONDITN 1ST TIME PASS THRU RPG CALC CYCLE *
0071 F********10****  TRANSACTION TYPE RECORD                             S01194
0072 F********11****  CURRENCY RECORD 1                                   S01194
0075 F*       14      AMOUNT OR PERCENT IS ZERO
0015 F********15****  SET ON IF ERROR DURING READ FROM THE WORK STATION * S01194
     F***********      - HELP INDICATOR                                   S01199
0076 E*    SUBROUTINE TABLES/ARRAYS
0080 E                    ZA1        16  1               ZALIGN/ZEDIT
0081 E                    ZA2        16  1               ZALIGN/ZEDIT
0082 E*    STANDARD TABLES/ARRAYS
0083 E                    ERCD       19  4               ERROR CODES
0084 E***********         ERCM    1  17 79               ERROR MSGS.      S01117
     E/COPY WNCPYSRC,RE0221E001
     E                    ERCM    1  20 79               ERROR MSGS.      S01117
     E/COPY WNCPYSRC,RE0221E002
     E                    CPY@    1   1 80
     E/EJECT
0085 I*    STANDARD FILES
0086 I*
0087 I*    WORKSTATION FILE
0088 I*
0089 I*    FORMAT - INITIAL SCREEN
0090 I*
0091 IRE0220FMNS  78   8 CS   9 CF
0092 I                                        1   7 SRUNA
0093 I                                        8   9 SID
0094 I                                       10  15 SPID
0095 I                                       16  23 STIME
0096 I                                       24  26 SWSID
0097 I*                                NON-STANDARD KEY FIELDS
0098 I                                       27  31 STTYP
0099 I                                       32  34 STCCY
0100 I*                                STANDARD ACTION CODE AND STRING
     I/COPY WNCPYSRC,RE0221I001
0101 I                                       35  35 SACTN
     I/COPY WNCPYSRC,RE0221I008
0102 I                                        1  35 SCNSF
     I/COPY WNCPYSRC,RE0221I002
0103 I*
0104 I*    FORMAT - ENQUIRY SCREEN
0105 I*
0106 I        NS  77   8 CS   9 CE
0107 I                                        1   7 SRUNA
0108 I                                        8   9 SID
0109 I                                       10  15 SPID
0110 I                                       16  23 STIME
0111 I                                       24  26 SWSID
0112 I*                                NON-STANDARD KEY FIELDS
0113 I                                       27  31 STTYP
0114 I                                       32  34 STCCY
     I/COPY WNCPYSRC,RE0221I003
0115 I*                                STANDARD ACTION CODE
0116 I                                       35  35 SACTN
     I/COPY WNCPYSRC,RE0221I009
0117 I*                                NON-STANDARD DETAIL SCREEN FIELDS
0118 I                                       36  49 SCHAM
0119 I                                       50  50 SDCAM
0120 I                                       51  64 SCHPC
0121 I                                       65  65 SDCPC
0122 I                                       66  66 SREBI
     I                                       67  67 SSTLB                                     CER049
0123 I*                                STANDARD STRING FIELDS
0124 I                                        1  35 SCNSF
     I/COPY WNCPYSRC,RE0221I004
0125 I*
0126 I*    CATCHALL
0127 I        NS
0128 I                                        8   9 SID
0129 I*
0130 I*    MASTER FILE - DETAIL RECORD
0131 I*
0132 IRETRG   NS  74   1 CM
0133 I       OR   73   1 C*
0134 I       OR   71   1 CD
0135 I                                        1   1 MRECI
0136 I                                        5   9 MTTYP
0137 I                                       10  12 MTCCY
0138 I                                       13  13 MRECT
0139 I                                    P  31  330MTNLU
0140 I                                    P  34  360MORED
0141 I                                    P  37  390MLCD
0142 I                                       40  40 MCHTP
0143 I                                    P  41  470MHASH
0144 I                                    P  48  540MCHAM
0145 I                                       55  56 MDCAM
0146 I                                    P  57  630MCHPC
0147 I                                       64  65 MDCPC
0148 I                                       66  66 MREBI
     I                                      129 129 MSTLB                                     CER049
0149 I**********                              1 128 MOLD1                                     CER049
     I                                        1 129 MOLD1                                     CER049
0150 I*
0151 I*    CATCHALL
0152 I        NS
0153 I                                        1   1 MRECI
0159 I*    NON-STANDARD FILES
0160 I*
0161 I**************                                                      S01194
0162 I*****TABLE*FILE - TRANSACTION TYPES RECORD.                         S01194
0163 I**************                                                      S01194
0164 I*TABLE***NS**10   1 CD   2 C4   3 C1                                S01194
0165 I**************                          1   1 RECI                  S01194
0166 I**************                          2   30RECT                  S01194
0167 I**************                          9  130TRAT                  S01194
0168 I**************                         14  43 TRAN                  S01194
0169 I**************                         44  44 CUOR                  S01194
0170 I**************                         45  45 DCIN                  S01194
0171 I**************                         56  56 REVI                  S01194
0172 I**************                         57  57 ADVI                  S01194
0173 I**************                      P  90  920LCD                   S01194
0174 I**************                         93  93 CHTP                  S01194
0175 I**************                      P  94  960TNLU                  S01194
0176 I**************                                                      S01194
0177 I**************                                                      S01194
0178 I**************                                                      S01194
0179 I*****TABLE*FILE - CURRENCIES RECORD 1.                              S01194
0180 I**************                                                      S01194
0181 I********NS**11   1 CD   2 C2   3 C0                                 S01194
0182 I*******AND****  13 C1                                               S01194
0183 I**************                          1   1 RECI                  S01194
0184 I**************                          2   30RECT                  S01194
0185 I**************                         10  12 CCY                   S01194
0186 I**************                         13  130SREC                  S01194
0187 I**************                         14  27 CCNM                  S01194
0188 I**************                      P  28  348SPOT                  S01194
0189 I**************                         35  37 CCYS                  S01194
0190 I**************                         38  380CDP                   S01194
0191 I**************                         39  390TNOT                  S01194
0192 I**************                         40  40 DCCY                  S01194
0193 I**************                         41  44 SRC1                  S01194
0194 I**************                         45  48 SRC2                  S01194
0195 I**************                         49  520TACC                  S01194
0196 I**************                         53  560TEQV                  S01194
0197 I**************                         57  600SWQV                  S01194
0198 I**************                         61  640TAC4                  S01194
0199 I**************                         65  680TAC5                  S01194
0200 I**************                         69  69 HIND                  S01194
0201 I**************                      P  70  768PART                  S01194
0202 I**************                         77  780SSNO                  S01194
0203 I**************                      P  79  858ERLC                  S01194
0204 I**************                         86  860MDIN                  S01194
0205 I**************                         87  870MDIA                  S01194
0206 I**************                         88  880MDIB                  S01194
0207 I**************                      P  90  920LCD                   S01194
0208 I**************                         93  93 CHTP                  S01194
0209 I**************                      P  94  960TNLU                  S01194
0210 I**************                                                      S01194
0211 I*****CATCHALL*                                                      S01194
0212 I********NS****                                                      S01194
     I/COPY WNCPYSRC,RE0221I005
0213 I*
0214 I*    STANDARD DATA STRUCTURES
0215 I*
0216 I*    DATA STRUCTURE FOR MASTER FILE KEY
0217 I*
0218 I            DS
0219 I                                        1  12 DSMKEY
0220 I                                        4   8 STTYP
0221 I                                        9  11 STCCY
0222 I                                       12  12 DSRECT
0223 I*
0224 I*    DATA STRUCTURE FOR CHANGE DETAILS
0225 I*
0226 I            DS
0227 I                                        1  17 DSCHDT
0228 I                                        1   1 MRECI
0229 I                                        2   60MTNLU
0230 I                                        7  110MORED
0231 I                                       12  160MLCD
0232 I                                       17  17 MCHTP
0233 I*
0234 I*    NON-STANDARD DATA STRUCTURES
0235 I**************                                                      S01194
0236 I*****DATA*STRUCTURE FOR TABLE FILE KEY                              S01194
0237 I**************                                                      S01194
0238 I************DS                                                      S01194
0239 I**************                          1  12 TABKEY                S01194
0240 I**************                          1   2 TAB2                  S01194
0241 I**************                          9  11 TAB3A                 S01194
0242 I**************                         10  12 TAB3B                 S01194
0243 I**************                          9  12 TAB4                  S01194
0244 I**************                         12  12 TAB1                  S01194
0245 I**************                          8  12 TAB5                  S01194
0246 I**************                          6  11 TAB6                  S01194
     I/COPY WNCPYSRC,RE0221I006
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I**  EXTERNAL DS FOR CURRENCY DETAILS                                S01194
     I              A6NBDP                          CDP                   S01194
     I*                                                                   S01194
     ISDRETR    E DSSDRETRPD                                              S01194
     I**  EXTERNAL DS FOR RETAIL TRANSACTION TYPES                        S01194
     I              A1RTNM                          TRAN                  S01194
     I/COPY WNCPYSRC,RE0221I010
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     ISCSARD    E DSSCSARDPD                                                                  CER049
0247 I*
0248 I*    STANDARD LOCAL DATA AREA FIELDS
0249 I*
0250 ILDA        UDS                            256
0251 I                                        1   8 LPROC
0252 I***********                           134 138 LFILE                 S01117
0253 I***********                           139 167 LKEY                  S01117
0254 I***********                           168 175 LPROG                 S01117
0255 I***********                           176 1770LDBNO                 S01117
0183 I                                      134 141 LFILE                 S01117
0183 I                                      142 170 LKEY                  S01117
0183 I                                      171 180 LPROG                 S01117
0183 I                                      181 1830LDBNO                 S01117
0183 I                                      134 141 DBFILE                S01117
0183 I                                      142 170 DBKEY                 S01117
0183 I                                      171 180 DBPGM                 S01117
0183 I                                      181 1830DBASE                 S01117
0256 I***********                           181 1850LRUND                 S01117
0257 I***********                           186 192 LRUNA                 S01117
0258 I***********                           193 193 LDATF                 S01117
0259 I***********                           194 1940LSFLG                 S01117
0260 I***********                           195 1960LKEYL                 S01117
0261 I***********                           197 202 LISP                  S01117
0262 I***********                           203 203 LTWOL                 S01117
0263 I***********                           204 2040LLDLP                 S01117
0264 I***********                           205 2090LTNLU                 S01117
0265 I***********                           210 210 LDELM                 S01117
0266 I***********                           211 211 LDUD                  S01117
0190 I                                      187 1910LRUND                 S01117
0191 I                                      192 198 LRUNA                 S01117
0192 I                                      199 199 LDATF                 S01117
0193 I**********                            200 2000LSFLG           S01117S01194
0193 I                                      200 200 LSFLG                 S01194
0260 I                                      201 2020LKEYL                 S01117
0261 I                                      203 208 LISP                  S01117
0262 I                                      209 209 LTWOL                 S01117
0263 I                                      210 2100LLDLP                 S01117
0264 I                                      211 2150LTNLU                 S01117
0265 I                                      216 216 LDELM                 S01117
0266 I                                      217 217 LDUD                  S01117
0267 I*
0268 I*    NON-STANDARD LDA FIELD
0269 I*
0270 I                                      104 133 LTRAN
     I*
     I*  WORSTATION TRANSACTION FILE DATA STRUCTURE
0250 IWTRAN      UDS                            860
     I                                        1 200 WTRAN1
     I/COPY WNCPYSRC,RE0221I007
     I                                      201 400 WTRAN2
     I                                      401 600 WTRAN3
     I                                      601 800 WTRAN4
     I                                      801 860 WTRAN5
     I**                                                                  S01117
     I** DATA AREA RUNDAT                                                 S01117
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*  RETRIEVE WSID FROM PROGRAM STATUS DATA STRUCTURE
     I*
     IPSDS       SDS
     I                                      244 246 WSID
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
     I** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 DFBM                  S01117
     I/EJECT
     C                     MOVEACPY@      BIS@   80
0271 C*  FIRST CYCLE PROCESSING
0272 C*
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           WTRAN
     C************LOCK     IN   *NAMVAR                                   S01117
     C************LOCK     IN   LDA                                 S01117E22021
     C           *LOCK     IN   WTRAN                                     S01117
     C**                                                                  S01117
     C**    IN THE DATAAREA RUNDAT                                        S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**    IN THE DATAAREA ZMUSER                                        S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C/COPY WNCPYSRC,RE0221C026
     C**
     C*    READ WORKSTATION FILE /*HELP*FACILITY*                         S01199
     C**
     C************IN15     DOUEQ'0'                                       S01199
     C                     UNLCKLDA                                       E22021
     C                     READ RE0220FM                 15
     C           *LOCK     IN   LDA                                       E22021
     C************IN15     IFEQ '1'                                       S01199
     C***********          MOVEAERCD      HERCD 160                       S01199
     C***********          MOVEL'RE0220'  HBPGM   8                       S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C***********          END                                            S01199
     C***********          END                                            S01199
0275 C***********          SETOF                     15                   S01199
     C/COPY WNCPYSRC,RE0221C001
0278 C*
0279 C*  SET-UP STANDARD INPUT PROGRAM FIELDS  -  WPROG IS THIS PROGRAM
0280 C*
0281 C                     MOVELLISP      WPROG   8
0282 C                     MOVE '1  '     WPROG
0283 C                     MOVELWPROG     SPID    6
0284 C*  SET-UP STANDARD LDA FIELDS
0285 C                     MOVE 'RETRG'   LFILE
0286 C                     MOVE WPROG     LPROG
0287 C                     Z-ADD12        LKEYL
0288 C                     Z-ADD1         LLDLP
0289 C*  SET-UP STANDARD BLANK FIELDS
0290 C                     MOVE ' '       BLK200200
0291 C*
0292 C           LDATF     COMP 'M'                      98* DATE FORMAT
0293 C********** LSFLG     COMP 1                        79* SSF          S01194
0293 C           LSFLG     COMP 'Y'                      79* SSF          S01194
0294 C           LDUD      COMP 'U'                      58* USEFUL DATA
0295 C*                                                    *    DISPLAYED
0296 C*
0297 C*  INITIALISE FIELD TO BLANK OUT KEY/ACTION CODE
0298 C*
     C/COPY WNCPYSRC,RE0221C002
0299 C                     MOVE ' '       BLK09   9
     C/COPY WNCPYSRC,RE0221C003
0300 C*
0301 C*  SET ON/OFF INDICATORS FOR ALLOWED ACTION CODES
0302 C*
0303 C*  SSF OFF
0304 C  N79                SETON                     61    I ALLOWED
0305 C  N79                SETON                     62    A ALLOWED
0306 C  N79                SETON                     63    D ALLOWED
0307 C  N79                SETON                     64    E ALLOWED
0308 C  N79                SETON                     65    I OVER D
0309 C*                                                       ALLOWED
0310 C*  SSF ON
0311 C   79                SETON                     61    I - ALLOWED
0312 C   79                SETON                     62    A NOT ALLOWED
0313 C   79                SETON                     63    D ALLOWED
0314 C   79                SETON                     64    E ALLOWED
0315 C   79                SETON                     65    I OVER D NOT
0316 C*                                                       ALLOWED
0317 C                     MOVE '*'       LDELM            DELETE METHOD
0318 C*
0319 C*  I OVER D IS NOT ALLOWED WHEN DELETE METHOD INVOLVES LEAVING RECI
0320 C*  AS D, BECAUSE OF FILE CONTROL PROBLEMS. THE FOLLOWING CODE CHECKS
0321 C*  THAT THIS HAS NOT BEEN ATTEMPTED.
0322 C*
0323 C           LDELM     COMP ' '                      91
0324 C  N65
0325 CORN91                GOTO ENDFC
0326 C                     SETON                     U7LR
0327 C                     MOVE '     '   LFILE
0328 C                     MOVE BLK200    LKEY
0329 C                     MOVE '93'      LDBNO            ** DB ERROR 93
0330 C                     GOTO END
0331 C*
0332 C           ENDFC     TAG                             ** ENDFC TAG
0333 C*
0334 C*  INITIALISE STANDARD INDICATORS
0335 C                     SETON                     888786* NON-DISPLAY
0336 C                     SETOF                     8980  * BLINK LABELS
0337 C                     SETOF                     858483* OUTPUT
0338 C                     SETOF                     8281  * SCREENS
0339 C                     SETOF                     696867* ACTION CODES
0340 C                     SETOF                     66    * ENTERED
0341 C                     SETOF                     59    * KEY FIELDS
0342 C*
0343 C*  INITIALISE NON-STANDARD INDS
0344 C*
0345 C                     SETOF                     010203* BLINK
0346 C                     SETOF                     040506* LABELS
0347 C                     SETOF                     0708  * PROTECT
     C                     SETOF                     11                                       CER049
      *                                                                                       CER049
      ** Check if CER049 feature is installed                                                 CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   P@RTCD  7                                           CER049
     C                     PARM '*VERIFY' P@OPTN  7                                           CER049
     C                     PARM 'CER049'  P@SARD  6                                           CER049
     C           SCSARD    PARM *BLANKS   DSFDY                                               CER049
      *                                                                                       CER049
     C           P@RTCD    IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049  1                                           CER049
     C                     SETON                     57                                       CER049
     C                     ELSE                                                               CER049
     C                     MOVE 'N'       CER049                                              CER049
     C                     SETOF                     57                                       CER049
     C                     MOVE ' '       MSTLB                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C/COPY WNCPYSRC,RE0221C004
0348 C*
0349 C*  BLANK OUT LAST CHANGE DETAILS
0350 C*
0351 C                     MOVE BLK200    DSCHDT
0352 C*
0353 C*  CHECK FOR CORRECT SCREEN READ IN
0354 C*
0355 C   77
0356 COR 78                GOTO PROCES
0357 C                     SETON                     U7LR
0358 C                     MOVE 'SCREN'   LFILE
0359 C                     MOVE BLK200    LKEY
0360 C                     MOVEL'SF OR SE'LKEY
0361 C                     MOVE 'FOUND   'LKEY
0362 C                     MOVE SID       LKEY
0363 C                     MOVE '92'      LDBNO            ** DB ERROR 92
0364 C                     GOTO END
0365 C*
0366 C           PROCES    TAG                             ** PROCES TAG
0367 C*
0368 C*  CLEAR ERROR CODE ARRAY, RESET INDEX
0369 C*
0370 C                     MOVE BLK200    ERMSG  79
0371 C                     MOVE '    '    ERCD
0372 C                     Z-ADD0         S       20
0373 C*
0374 C*  IF CMD/3, END THE PROGRAM
0375 C*
0376 C   KC                MOVE '**      'LPROC
0377 C   KC                SETON                     LR
0378 C   KC                GOTO END
0379 C*
0380 C*  IF F12, OUTPUT BLANK INITIAL SCREEN
0381 C*
0382 C   KL                EXSR SUBSF
0383 C   KL                GOTO END
0384 C*
0385 C*  IF F10, OUTPUT ERROR MSG TO INITIAL SCREEN
0386 C*
0387 C   KJ                EXSR SUBSF
0388 C   KJ                SETOF                     88
0389 C   KJ      S         ADD  1         S
0390 C   KJ                MOVE '915'     ERCD,S
0391 C   KJ                MOVE ERCM,15   ERMSG
0392 C   KJ                GOTO END
0393 C*
0394 C*  CMD KEYS HAVE BEEN PROCESSED. ONLY PROCESSING LEFT IS TO PROCESS
0395 C*  NEW KEY FIELDS/ACTION. WHETHER FROM SF OR SE SCREEN, PROCESSING
0396 C*  IS THE SAME.
0397 C*
0398 C*  VALIDATE ACTION CODE
0399 C*
0400 C           SACTN     COMP 'I'                  606066
0401 C   60      SACTN     COMP 'A'                  606067
0402 C   60      SACTN     COMP 'D'                  606068
0403 C   60      SACTN     COMP 'E'                  606069
0404 C   60      SACTN     COMP ' '                  606069
0405 C*
0406 C   69                MOVE 'E'       SACTN
0407 C*
0408 C  N60                GOTO ACTALL
0409 C*
0410 C*  ERROR IF ACTION CODE NOT I,A,D OR E - OUTPUT INITIAL SCREEN
0411 C*
0412 C                     EXSR SUBSF
0413 C                     SETOF                     88
0414 C                     SETON                     89
0415 C           S         ADD  1         S
0416 C                     MOVE '901'     ERCD,S
0417 C                     MOVE ERCM,1    ERMSG
0418 C                     GOTO END
0419 C*
0420 C           ACTALL    TAG                             ** ACTALL TAG
0421 C*
0422 C*  CHECK IF ACTION CODE IS ALLOWED
0423 C*
0424 C   66 61
0425 COR 67 62
0426 COR 68 63
0427 COR 69 64             GOTO KEYVAL
0428 C*
0429 C                     EXSR SUBSF
0430 C                     SETOF                     88
0431 C                     SETON                     89
0432 C           S         ADD  1         S
0433 C                     MOVE '902'     ERCD,S
0434 C                     MOVE ERCM,2    ERMSG
0435 C                     GOTO END
0436 C*
0437 C           KEYVAL    TAG                             ** KEYVAL TAG
0438 C*
     C**   VALIDATE ACTION CODE                                           S01117
     C***  VALIDATE USERS AUTHORITY TO USE THIS ACTION                    S01117
     C*                                                                   S01117
     C                     Z-ADD*ZERO     @ERR                            S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'N'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM SACTN     @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01194
     C                     ADD  1         S                               S01194
     C                     MOVE '302'     ERCD,S                          S01194
     C                     MOVE ERCM,18   ERMSG                           S01194
     C                     END                                            S01194
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF MBIN = Y, VALIDATE ACTION & BR. CODE TOGETHER               S01117
     C**   CHECK IF THE USER IS AUTHORIZED TO USE ACTION                  S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM SACTN     @ZACTN  1                       S01117
     C                     PARM DFBM      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01194
     C                     ADD  1         S                               S01194
     C           @ERR      IFEQ 1                                         S01194
     C                     MOVE '303'     ERCD,S                          S01194
     C                     MOVE ERCM,19   ERMSG                           S01194
     C                     END                                            S01194
     C           @ERR      IFEQ 2                                         S01194
     C                     MOVE '304'     ERCD,S                          S01194
     C                     MOVE ERCM,20   ERMSG                           S01194
     C                     END                                            S01194
     C                     END                                            S01194
     C                     END                                            S01117
     C*                                                                   S01117
     C**  IF NOT VALID FOR USER                                           S01117
     C           @ERR      IFNE *ZERO                                     S01117
0429 C                     EXSR SUBSF                                     S01117
0430 C                     SETOF                     88                   S01117
0431 C                     SETON                     89                   S01117
0435 C                     GOTO END                                       S01117
     C                     END                                            S01117
0438 C*
0439 C*  TEST FOR ALL MANDATORY KEY FIELDS ENTERED
0440 C*
0441 C           STTYP     COMP '     '                  01
0442 C           STCCY     COMP '   '                    02
0443 C   01
0444 COR 02                SETON                     59
0445 C*
0446 C   59      S         ADD  1         S
0447 C   59                MOVE '920'     ERCD,S
0448 C   59                MOVE ERCM,17   ERMSG
     C/COPY WNCPYSRC,RE0221C005
0449 C*
0450 C*  FOR INSERT VALIDATE KEY FIELDS INDIVIDUALLY, IF ALL ENTERED.
0451 C*
0469 C***66N59*****        EXSR VALKEY                                    LN0233
0469 C     N59             EXSR VALKEY                                    LN0233
0453 C*
0454 C*  S IS NON-ZERO IF THERE ARE ANY ERRORS. IF SO, OUTPUT SF SCREEN
0455 C*
0456 C           S         COMP 0                    8181
0457 C  N81                GOTO CHMAST
0458 C*
0459 C                     EXSR SUBSF
0460 C                     SETOF                     88
0461 C                     GOTO END
0462 C*
0463 C           CHMAST    TAG                             ** CHMAST TAG
0464 C*
0465 C*  CHAIN TO MASTER FILE FOR DETAIL RECORD
0466 C*
0467 C                     SETOF                     707172
0468 C                     SETOF                     737475
     C/COPY WNCPYSRC,RE0221C027
0469 C                     EXSR MASTCH
0470 C*
0471 C*  MOVE MASTER RECORD FOUND INTO OLD200
0472 C*  TO SIMPLIFY PROCESSING
0473 C*
     C/COPY WNCPYSRC,RE0221C006
0474 C  N75                MOVELMOLD1     OLD200200
     C/COPY WNCPYSRC,RE0221C007
0475 C*
0476 C*  UPDATE TNLU IN LDA
0477 C*
0478 C  N75                MOVE MTNLU     LTNLU
     C/COPY WNCPYSRC,RE0221C025
0479 C   75                Z-ADD0         LTNLU
0480 C*
0481 C*  DETERMINE SITUATION FOUND ON MASTER
0482 C*  FILE AND GOTO RELEVANT PROCESSING.
0483 C*
0484 C*  NO RECORD FOUND
0485 C*
0486 C   75                GOTO NORF
     C/COPY WNCPYSRC,RE0221C008
0487 C*
0488 C*  RECORD FOUND - MATURED
0489 C*
0490 C   74                GOTO RFMA
0491 C*
0492 C*  TEST RECORD FOUND WITH RECORD ID *
0493 C*  FOR BACKED OUT BY RESTART/RECOVERY
0494 C*
0495 C   73      MLCD      COMP 0                    73  70
0496 C*
0497 C*  RECORD FOUND HAS BEEN BACKED OUT
0498 C*
0499 C   70                GOTO RFBO
0500 C*
0501 C*  TEST RECORD FOUND WITH RECORD ID *
0502 C*  FOR DELETED TODAY OR PREVIOUSLY
0503 C*
0504 C   73      MLCD      COMP LRUND                  7273
0505 C*
0506 C*  RECORD WITH RECORD ID * HAS BEEN
0507 C*  DELETED TODAY
0508 C*
0509 C   73                GOTO RFDT
0510 C*
0511 C*  RECORD FOUND WITH RECORD ID * WAS DELETED PREVIOUSLY
0512 C*  - THAT IS, PRIOR TO TODAY
0513 C*
0514 C   72                GOTO RFDP
0515 C*
0516 C*  TEST RECORD FOUND WITH RECORD ID D
0517 C*  FOR DELETED
0518 C*
0519 C   71      MCHTP     COMP 'D'                  717173
0520 C*
0521 C*  RECORD FOUND IS LIVE - MCHTP IS NOT D
0522 C*
0523 C   71                GOTO RFLV
0524 C*
0525 C*  RECORD FOUND WITH RECORD ID D
0526 C*  AND MCHTP D - TEST FOR DELETED TODAY
0527 C*
0528 C   73      MLCD      COMP LRUND                    73
0529 C*
0530 C*  RECORD FOUND WITH RECORD ID D HAS
0531 C*  BEEN DELETED TODAY
0532 C*
0533 C   73                GOTO RFDT
     C/COPY WNCPYSRC,RE0221C009
0534 C*
0535 C*  IF PROCESSING REACHES HERE THEN THE RECORD FOUND MAY
0536 C*  BE IN ERROR, OR MAY BE THE HEADER OR TRAILER. IF IN ERROR,
0537 C*  OUTPUT THE SE SCREEN WITH 'CHANGE DETAILS', OR SF SCREEN.
0538 C*
0539 C           S         ADD  1         S
0540 C                     SETOF                     88
     C/COPY WNCPYSRC,RE0221C010
0541 C           MRECI     COMP 'A'                      96
0542 C  N96      MRECI     COMP 'Z'                      96
     C/COPY WNCPYSRC,RE0221C011
0543 C*
0544 C  N96                SETOF                     87    * CHNGE DETAILS
0545 C  N96                EXSR SUBSE
0546 C  N96                MOVE '903'     ERCD,S
0547 C  N96                MOVE ERCM,3    ERMSG
0548 C   96                EXSR SUBSF
0549 C   96                MOVE '919'     ERCD,S
0550 C   96                MOVE ERCM,16   ERMSG
0551 C                     GOTO END
0552 C*
0553 C*  PROCESS SITUATIONS FOUND ON MASTER FILE
0554 C*
0555 C*  NO RECORD FOUND
0556 C*
0557 C           NORF      TAG                             ** NORF TAG
0558 C*
0559 C*  INSERT
0560 C   66                EXSR SUBSI
0561 C   66                GOTO END
0562 C*
0563 C*  AMEND
0564 C*  DELETE
0565 C*  ENQUIRE
     C                     SETON                     0102
     C/COPY WNCPYSRC,RE0221C028
0566 C                     EXSR SUBSF
0567 C                     SETOF                     88
0568 C           S         ADD  1         S
0569 C                     MOVE '908'     ERCD,S
0570 C                     MOVE ERCM,8    ERMSG
0571 C                     GOTO END
0572 C*
0573 C*  RECORD FOUND - MATURED. ONLY ENQUIRE
0574 C*  ALLOWED. OTHERWISE OUTPUT SE SCREEN
0575 C*  WITH A MESSAGE.
0576 C*
0577 C           RFMA      TAG                             ** RFMA TAG
0578 C*
0579 C                     EXSR SUBSE
0580 C                     SETOF                     88
0581 C           S         ADD  1         S
0582 C*  INSERT
0583 C   66                MOVE '904'     ERCD,S
0584 C   66                MOVE ERCM,4    ERMSG
0585 C*
0586 C*  AMEND
0587 C   67                MOVE '909'     ERCD,S
0588 C   67                MOVE ERCM,9    ERMSG
0589 C*
0590 C*  DELETE
0591 C   68                MOVE '911'     ERCD,S
0592 C   68                MOVE ERCM,11   ERMSG
0593 C*
0594 C*  ENQUIRE
0595 C   69                MOVE '913'     ERCD,S
0596 C   69                MOVE ERCM,13   ERMSG
0597 C*
0598 C                     GOTO END
0599 C*
0600 C*  RECORD FOUND - DELETED TODAY
0601 C*
0602 C           RFDT      TAG                             ** RFDT TAG
0603 C*
0604 C*
0605 C*  FOR INSERT OVER DELETED RECORD ALLOWED,
0606 C*  OUTPUT INSERT SCREEN
0607 C*
0608 C   66 65             EXSR SUBSI
0609 C   66 65             SETOF                     88
0610 C   66 65   S         ADD  1         S
0611 C   66 65             MOVE '905'     ERCD,S
0612 C   66 65             MOVE ERCM,5    ERMSG
0613 C   66 65             GOTO END
0614 C*
0615 C*  FOR OTHER CONDITIONS, OUTPUT SE SCREEN WITH MESSAGE
0616 C*
0617 C                     EXSR SUBSE
0618 C                     SETOF                     88
0619 C           S         ADD  1         S
0620 C*
0621 C*  INSERT OVER DELETED RECORD NOT ALLOWED
0622 C*
0623 C   66N65             MOVE '906'     ERCD,S
0624 C   66N65             MOVE ERCM,6    ERMSG
0625 C*
0626 C*  AMEND
0627 C   67                MOVE '910'     ERCD,S
0628 C   67                MOVE ERCM,10   ERMSG
0629 C*
0630 C*  DELETE
0631 C   68                MOVE '912'     ERCD,S
0632 C   68                MOVE ERCM,12   ERMSG
0633 C*
0634 C*  ENQUIRE
0635 C   69                MOVE '914'     ERCD,S
0636 C   69                MOVE ERCM,14   ERMSG
0637 C*
0638 C                     GOTO END
0639 C*
0640 C*  RECORD FOUND - DELETED PREVIOUSLY
0641 C*
0642 C           RFDP      TAG                             ** RFDP TAG
0643 C*
0644 C*  INSERT ALLOWED, OTHERWISE OUTPUT
0645 C*  INITIAL SCREEN WITH MESSAGE - NOT ON FILE
0646 C*
0647 C*  INSERT
0648 C   66                EXSR SUBSI
0649 C   66                GOTO END
0650 C*  AMEND
0651 C*  DELETE
0652 C*  ENQUIRE
0653 C   69 58             EXSR SUBSE                      * USEFUL DATA
0654 C  N69
0655 CORN58                EXSR SUBSF
0656 C                     SETOF                     88
0657 C           S         ADD  1         S
0658 C                     MOVE '908'     ERCD,S
0659 C                     MOVE ERCM,8    ERMSG
0660 C                     GOTO END
0661 C*
0662 C*  RECORD FOUND - LIVE
0663 C*
0664 C           RFLV      TAG                             ** RFLV TAG
0665 C*
0666 C*  INSERT
0667 C   66                EXSR SUBSE
0668 C   66                SETOF                     88
0669 C   66      S         ADD  1         S
0670 C   66                MOVE '907'     ERCD,S
0671 C   66                MOVE ERCM,7    ERMSG
0672 C   66                GOTO END
0673 C*
0674 C*  AMEND
0675 C*  DELETE
0676 C*  ENQUIRE
0677 C   67                EXSR SUBSA
0678 C   68                EXSR SUBSD
0679 C   69                EXSR SUBSE
     C   83
     COR 84                EXSR WTRUPD
0680 C                     GOTO END
0681 C*
0682 C*  RECORD FOUND - BACKED OUT
0683 C*
0684 C           RFBO      TAG                             ** RFBO TAG
0685 C*
0686 C*  INSERT IS ALLOWED
0687 C   66                EXSR SUBSI
0688 C   66                GOTO END
0689 C*
0690 C*  OTHER ACTION CODES ARE INVALID -
0691 C*  OUTPUT MESSAGE - NOT ON FILE
0692 C*  AMEND
0693 C*  DELETE
0694 C*  ENQUIRE
0695 C   69 58             EXSR SUBSE                      * USEFUL DATA
0696 C  N69
0697 CORN58                EXSR SUBSF
0698 C                     SETOF                     88
0699 C           S         ADD  1         S
0700 C                     MOVE '908'     ERCD,S
0701 C                     MOVE ERCM,8    ERMSG
0702 C*
0703 C           END       TAG                             ** END TAG
0704 C*
0705 C*  SETOF OUTPUT INDS IF DATABASE ERROR
0706 C*
0707 C   U7                SETOF                     818283
0708 C   U7                SETOF                     8485
0709 C*
0710 C                     TIME           MTIME   60
     C   LR U7             EXSR *PSSR                                     S01117
     C***********          OUT  *NAMVAR                                   S01117
     C                     OUT  LDA                                       S01117
     C                     OUT  WTRAN                                     S01117
0711 C*
     C                     EXCPT
     C/COPY WNCPYSRC,RE0221C029
     C                     RETRN
0712 C********************************************************************
0713 C**
0714 C**   SUBR. - TO SET UP INITIAL SCREEN OUTPUT
0715 C**
0716 C           SUBSF     BEGSR                           ***  SUBSF  ***
0717 C                     SETON                     81
0718 C                     MOVE '1  '     LPROC
0719 C                     MOVE 'SF'      SID
0720 C                     ENDSR
0721 C********************************************************************
0722 C**
0723 C**   SUBR. - TO SET UP INSERT SCREEN OUTPUT
0724 C**
0725 C           SUBSI     BEGSR                           ***  SUBSI  ***
0726 C                     SETON                     82
0727 C                     MOVE '2  '     LPROC
0728 C                     MOVE 'SI'      SID
0729 C                     ENDSR
0730 C********************************************************************
0731 C**
0732 C**   SUBR. - TO SET UP AMEND SCREEN OUTPUT
0733 C**
0734 C           SUBSA     BEGSR                           ***  SUBSA  ***
0735 C                     SETON                     83
0736 C                     MOVE '3  '     LPROC
0737 C                     MOVE 'SA'      SID
0738 C                     EXSR FORMT
0739 C*
0740 C* GET TRANSACTION TYPE NAME
0741 C*
0742 C**************       MOVE BLK200    TABKEY                          S01194
0743 C**************       MOVE '41'      TAB2                            S01194
0744 C**************       MOVE STTYP     TAB5                            S01194
0745 C**************       EXSR TABCHN                                    S01194
     C                     CALL 'AORETRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM STTYP     TKEY    5                       S01194
     C           SDRETR    PARM SDRETR    DSFDY                           S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C                     MOVE A1RTTY    STTYP                           S01194
     C                     MOVE TRAN      LTRAN                           S01194
     C                     END                                            S01194
0746 C***10*********       MOVE TRAN      LTRAN                           S01194
0747 C*
0750 C*  PROTECT NARRATIVE FIELDS IF SSF IS ON
0751 C*
0754 C                     ENDSR
0755 C********************************************************************
0756 C**
0757 C**   SUBR. - TO SET UP DELETE SCREEN OUTPUT
0758 C**
0759 C           SUBSD     BEGSR                           ***  SUBSD  ***
0760 C                     SETON                     84
0761 C                     MOVE '4  '     LPROC
0762 C                     MOVE 'SD'      SID
0763 C                     EXSR FORMT
0764 C*
0765 C* GET TRANSACTION TYPE NAME
0766 C*
0767 C**************       MOVE BLK200    TABKEY                          S01194
0768 C**************       MOVE '41'      TAB2                            S01194
0769 C**************       MOVE STTYP     TAB5                            S01194
0770 C**************       EXSR TABCHN                                    S01194
     C                     CALL 'AORETRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM STTYP     TKEY                            S01194
     C           SDRETR    PARM SDRETR    DSFDY                           S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C                     MOVE A1RTTY    STTYP                           S01194
     C                     MOVE TRAN      LTRAN                           S01194
     C                     END                                            S01194
0771 C***10*********       MOVE TRAN      LTRAN                           S01194
0772 C*
0774 C                     ENDSR
0775 C********************************************************************
0776 C**
0777 C**   SUBR. - TO SET UP ENQUIRY SCREEN OUTPUT
0778 C**
0779 C           SUBSE     BEGSR                           ***  SUBSE  ***
0780 C                     SETON                     85
0781 C                     MOVE '1  '     LPROC
0782 C                     MOVE 'SE'      SID
0783 C                     EXSR FORMT
0784 C*
0785 C* GET TRANSACTION TYPE NAME
0786 C*
0787 C**************       MOVE BLK200    TABKEY                          S01194
0788 C**************       MOVE '41'      TAB2                            S01194
0789 C**************       MOVE STTYP     TAB5                            S01194
0790 C**************       EXSR TABCHN                                    S01194
     C                     CALL 'AORETRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM STTYP     TKEY                            S01194
     C           SDRETR    PARM SDRETR    DSFDY                           S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C                     MOVE A1RTTY    STTYP                           S01194
     C                     MOVE TRAN      LTRAN                           S01194
     C                     END                                            S01194
0791 C***10*********       MOVE TRAN      LTRAN                           S01194
0792 C*
0793 C*
0794 C*  CHECK FOR USEFUL DATA TO BE DISPLAYED.
0795 C*
0796 C*  IF SO, ALSO DISPLAY CHANGE DETAILS.
0797 C   58                SETOF                     8687
0798 C*
0799 C                     ENDSR
0800 C********************************************************************
0801 C**
0802 C**   SUBR. - TO CHAIN TO MASTER FILE
0803 C**
0804 C           MASTCH    BEGSR                           *** MASTCH  ***
0805 C                     MOVE 'D'       DSRECT
0806 C                     SETOF                     717374
0807 C                     SETOF                     75
0808 C                     MOVELDSMKEY    LKEY
     C/COPY WNCPYSRC,RE0221C012
0809 C           DSMKEY    CHAINRETRG                75
     C  N75                EXCPT
     C/COPY WNCPYSRC,RE0221C013
0810 C                     ENDSR
     C/COPY WNCPYSRC,RE0221C030
0811 C********************************************************************
0812 C**
0813 C**   SUBR. - TO VALIDATE THE INITIAL SCREEN KEY FIELDS
0814 C**
0815 C           VALKEY    BEGSR                           *** VALKEY  ***
     C/COPY WNCPYSRC,RE0221C031
0816 C*
0817 C*  CHECK TRANSACTION TYPE- MUST BE LIVE ON TABLE FILE
0818 C**************       MOVE BLK200    TABKEY                          S01194
0819 C**************       MOVE '41'      TAB2                            S01194
0820 C**************       MOVE STTYP     TAB5                            S01194
0821 C**************       EXSR TABCHN                                    S01194
     C                     CALL 'AORETRR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM STTYP     TKEY                            S01194
     C           SDRETR    PARM SDRETR    DSFDY                           S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C                     MOVE A1RTTY    STTYP                           S01194
     C                     MOVE TRAN      LTRAN                           S01194
     C                     ELSE                                           S01194
     C                     SETON                     01                   S01194
     C                     END                                            S01194
0822 C***10*********       MOVE TRAN      LTRAN                           S01194
0823 C**N10*********       SETON                     01                   S01194
0824 C   01      S         ADD  1         S
0825 C   01                MOVE '001'     ERCD,S
0826 C*
0827 C**VALIDATE*CURRENCY*-*MUST*BE*LIVE*ON*TABLE*FILE                    S01194
0827 C* VALIDATE CURRENCY - MUST BE LIVE ON SDCURRPD                      S01194
0828 C**************       MOVE BLK200    TABKEY                          S01194
0829 C**************       MOVE '20'      TAB2                            S01194
0830 C**************       MOVE '1'       TAB1                            S01194
0831 C**************       MOVE STCCY     TAB3A                           S01194
0832 C**************       EXSR TABCHN                                    S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM STCCY     CKEY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
0833 C**N11*********       SETON                     02                   S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                         02               S01194
     C                     ELSE                                           S01194
     C                     MOVE A6CYCD    STCCY                           S01194
     C                     END                                            S01194
0834 C*
0835 C   02      S         ADD  1         S
0836 C   02                MOVE '002'     ERCD,S
     C/COPY WNCPYSRC,RE0221C032
0837 C*
0838 C                     ENDSR
0839 C********************************************************************
0840 C**
0841 C**   SUBR. - TO FORMAT MASTER FILE RECORD DATA FOR SCREEN OUTPUT
0842 C**
0843 C           FORMT     BEGSR                           ***  FORMT  ***
0844 C*
0845 C*  GET CURRENCY RECORD FOR DECIMAL PLACES
0846 C*
0847 C**************       MOVE BLK200    TABKEY                          S01194
0848 C**************       MOVE '20'      TAB2                            S01194
0849 C**************       MOVE '1'       TAB1                            S01194
0850 C**************       MOVE MTCCY     TAB3A                           S01194
0851 C**************       EXSR TABCHN                                    S01194
     C/COPY WNCPYSRC,RE0221C014
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM MTCCY     CKEY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C/COPY WNCPYSRC,RE0221C015
0852 C***11*********       GOTO FORMT1                                    S01194
0853 C*
0854 C*  DATABASE ERROR IF CURRENCY NOT FOUND
0855 C*
     C           @RTCD     IFNE *BLANKS                                   S01194
0856 C                     SETON                     U7LR
0857 C**************       MOVE 'TABLE'   LFILE                           S01194
     C                     MOVE 'SDCURRPD'LFILE                           S01194
0858 C                     MOVE BLK200    LKEY
0859 C**************       MOVELTABKEY    LKEY                            S01194
     C                     MOVELMTCCY     LKEY                            S01194
0860 C                     MOVE '01'      LDBNO            ** DB ERROR 01
0861 C                     GOTO FORMTE
     C                     END                                            S01194
0862 C*
0863 C           FORMT1    TAG                             ** FORMT1 TAG
0864 C*
0865 C*  FORMAT CHARGE AMOUNT
0866 C*
     C/COPY WNCPYSRC,RE0221C016
0867 C           MCHAM     COMP 0                        14
0868 C   14                MOVE BLK200    WCHAM
0869 C   14                GOTO B1TAG
0870 C                     MOVE MCHAM     ZFIELD
     C/COPY WNCPYSRC,RE0221C017
0871 C           13        SUB  CDP       ZADIG
0872 C                     Z-ADDCDP       ZADEC
0873 C                     EXSR ZEDIT
0874 C                     MOVE ZFIELD    WCHAM  14
0875 C           B1TAG     TAG                             ** B1TAG TAG **
0876 C*
0877 C* FORMAT CHARGE PERCENT
0878 C*
     C/COPY WNCPYSRC,RE0221C018
0879 C           MCHPC     COMP 0                        14
0880 C   14                MOVE BLK200    WCHPC
0881 C   14                GOTO B2TAG
0882 C                     MOVE MCHPC     ZFIELD
     C/COPY WNCPYSRC,RE0221C019
0883 C                     Z-ADD8         ZADEC
0884 C                     Z-ADD5         ZADIG
0885 C                     EXSR ZEDIT
0886 C                     MOVE ZFIELD    WCHPC  14
0887 C           B2TAG     TAG                             ** B2TAG TAG **
0888 C*
0889 C* FORMAT D/C INDICATORS
0890 C*
     C/COPY WNCPYSRC,RE0221C020
0891 C                     MOVE MDCAM     WDCAM   1
0892 C                     MOVE MDCPC     WDCPC   1
     C/COPY WNCPYSRC,RE0221C021
0893 C*
0894 C*
0895 C           FORMTE    ENDSR                           ** FORMTE TAG
0896 C********************************************************************
0897 C**
0898 C**   SUBR. - TO UPDATE CHAIN TO THE WORKSTATION TRANSACTION FILE
0899 C**
0900 C           WTRUPD    BEGSR                           ***  WTRUPD ***
0910 C**
     C/COPY WNCPYSRC,RE0221C022
0901 C                     MOVE BLK200    WTRAN1
0902 C                     MOVE BLK200    WTRAN2
0903 C                     MOVE BLK200    WTRAN3
0904 C                     MOVE BLK200    WTRAN4
0905 C                     MOVE BLK200    WTRAN5
0906 C                     MOVE OLD200    WTRAN1
     C/COPY WNCPYSRC,RE0221C023
0910 C**
     C                     ENDSR
0909 C********************************************************************
0910 C**************                                                      S01194
0911 C*****SUBR.*-*TO CHAIN TO TABLE FILE                                 S01194
0912 C**************                                                      S01194
0913 C***********TABCHN    BEGSR                           ***  TABCHN ***S01194
0914 C**************                                                      S01194
0915 C**************       SETOF                     101199               S01194
0916 C**************                                                      S01194
0917 C***********TABKEY    CHAINTABLE                99                   S01194
0918 C**************                                                      S01194
0919 C**************       ENDSR                                          S01194
0920 C********************************************************************S01194
0921 C**                                                                 *
0922 C**  ZEDIT SUBROUTINE TO INSERT A DECIMAL POINT INTO A NUMERIC FIELD*
0923 C**  AND TO BLANK OUT LEADING ZEROES.                               *
0924 C**      INPUT FIELDS:   ZFIELD 16/                                 *
0925 C*                       ZADEC                                      *
0926 C*                       ZADIG - NOT ACTUALLY USED                  *
0927 C*                                                                  *
0928 C*       ARRAYS    ZA1 ,ZA2   BOTH 16 ELEMENTS, EACH ONE BYTE LONG. *
0929 C*                                                                  *
0930 C*       OUTPUT FIELD   ZFIELD                                      *
0931 C*                                                                  *
0932 C           ZEDIT     BEGSR                           ***  ZEDIT  ***
0933 C**                                                                 *
0934 C*       SET UP WORK FIELDS                                         *
0935 C**                                                                 *
0936 C                     Z-ADDZADIG     ZADIG   20                     *
0937 C                     Z-ADDZADEC     ZADEC   10                     *
0938 C*                                                                  *
0939 C                     MOVEA' '       ZA1                            *
0940 C                     MOVEA' '       ZA2                            *
0941 C*                                                                  *
0942 C                     Z-ADD16        Z1      20                     *
0943 C                     Z-ADD16        Z2      20                     *
0944 C*                                                                  *
0945 C           16        SUB  ZADEC     ZADEC2  20                     *
0946 C*                                                                  *
0947 C*                                                                  *
0948 C                     MOVEAZFIELD    ZA1                            *
0949 C*                                                                  *
0950 C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES               *
0951 C*                                                                  *
0952 C           ZADEC     COMP 0                        91              *
0953 C   91                GOTO ZT20                                     *
0954 C**                                                                 *
0955 C           ZT10      TAG                             ** ZT10 TAG ***
0956 C**                                                                 *
0957 C*                                                                  *
0958 C*       SET UP DECIMALS                                            *
0959 C*                                                                  *
0960 C                     MOVE ZA1,Z1    ZA2,Z2                         *
0961 C           Z1        SUB  1         Z1                             *
0962 C           Z2        SUB  1         Z2                             *
0963 C*                                                                  *
0964 C           Z2        COMP 0                        90              *
0965 C   90                GOTO ZT30                                     *
0966 C*                                                                  *
0967 C*       CHECK IF END OF DECIMALS                                   *
0968 C**                                                                 *
0969 C           Z2        COMP ZADEC2               90                  *
0970 C   90                GOTO ZT10                                     *
0971 C*                                                                  *
0972 C**                                                                 *
0973 C*       PUT IN DECIMAL PLACE                                       *
0974 C*                                                                  *
0975 C                     MOVE '.'       ZA2,Z2                         *
0976 C           Z2        SUB  1         Z2                             *
0977 C*                                                                  *
0978 C           ZT20      TAG                             ** ZT20 TAG ***
0979 C*                                                                  *
0980 C*       SET UP INTEGERS                                            *
0981 C*                                                                  *
0982 C                     MOVE ZA1,Z1    ZA2,Z2                         *
0983 C           Z1        SUB  1         Z1                             *
0984 C           Z2        SUB  1         Z2                             *
0985 C**                                                                 *
0986 C           Z2        COMP 0                    90                  *
0987 C   90                GOTO ZT20                                     *
0988 C*                                                                  *
0989 C*       PUT IN LEADING BLANKS                                      *
0990 C*                                                                  *
0991 C           ZT30      TAG                             ** ZT30 TAG ***
0992 C**                                                                 *
0993 C                     Z-ADD1         Z2                             *
0994 C**                                                                 *
0995 C           ZT40      TAG                             ** ZT40 TAG ***
0996 C*                                                                  *
0997 C           ZA2,Z2    COMP '0'                  9090                *
0998 C   90      ZA2,Z2    COMP ' '                  9090                *
0999 C*                                                                  *
1000 C   90                GOTO ZT50                                     *
1001 C*                                                                  *
1002 C                     MOVE ' '       ZA2,Z2                         *
1003 C           Z2        ADD  1         Z2                             *
1004 C*                                                                  *
1005 C           Z2        COMP 16                     90                *
1006 C   90                GOTO ZT40                                     *
1007 C*                                                                  *
1008 C*       IF NO INTEGERS PUT IN LEADING ZERO                         *
1009 C*                                                                  *
1010 C           ZT50      TAG                             ** ZT50 TAG ***
1011 C*                                                                  *
1012 C                     Z-ADDZADEC2    Z2                             *
1013 C  N91      Z2        SUB  1         Z2                             *
1014 C           ZA2,Z2    COMP ' '                      90              *
1015 C   90                MOVE '0'       ZA2,Z2                         *
1016 C*                                                                  *
1017 C*                                                                  *
1018 C*       SET UP OUTPUT FIELD                                        *
1019 C*                                                                  *
1020 C           ZT60      TAG                             ** ZT60 TAG ***
1021 C*                                                                  *
1022 C                     MOVEAZA2       ZFIELD 16                      *
1023 C**                                                                 *
1024 C           ZEND      ENDSR                           ** ZEND **    *
1025 C*                                                                  *
1026 C********************************************************************
     C*                                                                   S01117
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS                      S01117
     C*                                                                   S01117
     C* CALLS: NOTHING                                                    S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C/COPY WNCPYSRC,RE0221C024
     C********************************************************************S01117
     C/EJECT
1027 O*  WORKSTATION - INITIAL SCREEN OUTPUT
1028 O*
1029 ORE0220FME        81
1030 O                                   K8 'RE0220F1'
     O/COPY WNCPYSRC,RE0221O001
1031 O                         SCNSF     35
     O/COPY WNCPYSRC,RE0221O002
1032 O                         SID        9
1033 O                         SPID      15
1034 O                         MTIME     23 '  .  .  '
     O                         STTYP     31                               S01194
     O                         STCCY     34                               S01194
1035 O*  BLANK OUT KEY/ACTION CODE FOR F12 - REMOVED IN STANDARD PROG
     O/COPY WNCPYSRC,RE0221O003
1036 O                 KL      BLK09     35
1037 O*  ERROR FIELDS
1038 O                         ERCD     111
1039 O                         ERMSG    193
     O/COPY WNCPYSRC,RE0221O004
1040 O*
1041 O*  WORKSTATION - INSERT(82)/AMEND(83) SCREEN OUTPUT
1042 O*
1043 O        E        82
1044 O       OR        83
1045 O                                   K8 'RE0220F2'
     O/COPY WNCPYSRC,RE0221O005
1046 O                         SCNSF     35
     O/COPY WNCPYSRC,RE0221O007
1047 O                         SID        9
1048 O                         SPID      15
1049 O                         MTIME     23 '  .  .  '
     O                         STTYP     31                               S01194
     O                         STCCY     34                               S01194
     O/COPY WNCPYSRC,RE0221O008
1050 O*  OUTPUT DETAIL FIELDS FOR AMEND SCREEN
1051 O                         TRAN      65
1052 O                 83      WCHAM     79
1053 O                 83      WDCAM     80
1054 O                 83      WCHPC     94
1055 O                 83      WDCPC     95
1056 O                 83      MREBI     96
     O                 83      MSTLB     97                                                   CER049
1057 O*  ERROR FIELDS AND CHANGE DETAILS
1058 O**********               ERCD     172                                                   CER049
1059 O**********               ERMSG    254                                                   CER049
1060 O**********               DSCHDT   271                                                   CER049
     O                         ERCD     173                                                   CER049
     O                         ERMSG    255                                                   CER049
     O                         DSCHDT   272                                                   CER049
     O/COPY WNCPYSRC,RE0221O009
1061 O*
1062 O*  WORKSTATION - DELETE(84)/ENQUIRY(85) SCREEN OUTPUT
1063 O*
1064 O        E        84
1065 O       OR        85
1066 O                                   K8 'RE0220F3'
     O/COPY WNCPYSRC,RE0221O010
1067 O                         SCNSF     35
     O/COPY WNCPYSRC,RE0221O011
1068 O                         SID        9
1069 O                         SPID      15
1070 O                         MTIME     23 '  .  .  '
     O                         STTYP     31                               S01194
     O                         STCCY     34                               S01194
     O/COPY WNCPYSRC,RE0221O012
1071 O*  OUTPUT DETAIL FIELDS
1072 O                         TRAN      65
1073 O                         WCHAM     79
1074 O                         WDCAM     80
1075 O                         WCHPC     94
1076 O                         WDCPC     95
1077 O                         MREBI     96
     O                         MSTLB     97                                                   CER049
1078 O*  ERROR FIELDS AND CHANGE DETAILS
1079 O**********               ERCD     172                                                   CER049
1080 O**********               ERMSG    254                                                   CER049
1081 O**********               DSCHDT   271                                                   CER049
     O                         ERCD     173                                                   CER049
     O                         ERMSG    255                                                   CER049
     O                         DSCHDT   272                                                   CER049
     O/COPY WNCPYSRC,RE0221O006
1082 O*
      ** THE MESSAGE NO.18 IS ADDED BY S01117                             S01117
** ERROR MESSAGES
ACTION CODE INVALID
ACTION CODE ENTERED IS NOT ALLOWED
THIS RECORD IS POSSIBLY IN ERROR - PLEASE TAKE A SCREEN PRINT AND INFORM B
THIS IS A MATURED RECORD - INSERTION NOT ALLOWED
THIS IS A RECORD DELETED TODAY - INSERTION IS ALLOWED
THIS IS A RECORD DELETED TODAY - INSERTION IS NOT ALLOWED
THIS IS A LIVE RECORD ALREADY ON FILE - INSERTION NOT ALLOWED
RECORD NOT ON FILE
THIS IS A MATURED RECORD - AMENDMENT NOT ALLOWED
THIS IS A RECORD DELETED TODAY - AMENDMENT NOT ALLOWED
THIS IS A MATURED RECORD - DELETION NOT ALLOWED
THIS RECORD HAS ALREADY BEEN DELETED TODAY
THIS IS A MATURED RECORD
THIS IS A RECORD DELETED TODAY
F10 KEY NOT ALLOWED NOW
INVALID KEY FIELDS ENTERED
MANDATORY KEY FIELD/S NOT ENTERED
USER IS NOT AUTH. TO THE ACTION CODE FOR THIS MENU ITEM
USER IS NOT AUTH. TO ANY ACTION CODES FOR THIS MENU ITEM AND BRANCH
USER IS NOT AUTH. TO THE ACTION CODE FOR THIS MENU ITEM AND BRANCH
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
