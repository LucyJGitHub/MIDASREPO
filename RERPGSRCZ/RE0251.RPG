0001 H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Stop payments maintenance')                   *
0002 F*****************************************************************
0008 F*                                                               *
     F*  Midas - Retail Module
0004 F*                                                               *
0005 F*  RE0251 - STOP PAYMENTS MAINTENANCE                           *
0006 F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*      1990, 1993                                               *
0008 F*                                                               *
      *  Last Amend No. CER059             Date 19Jul10               *
      *  Prev Amend No. CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG27627           Date 07May10               *
      *                 BUG27045A          Date 13Apr10               *
      *                 BUG27045           Date 18Feb10               *
      *                 CAP201             Date 09Dec09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 19Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 02Mar99               *
      *                 CTI002             Date 09Sep98               *
     F*                 123986             DATE 27FEB98               *
     F*                 096352             DATE 15JAN98
     F*                 082288             DATE 15JAN98
     F*                 078274             DATE 08NOV94               *
     F*                 076550             DATE 20SEP94               *
     F*                 S01413             DATE 13APR93               *
     F*                 E22371                  13JUN90               *
     F*                 E21177                  27MAR90               *
     F*                 BHF638                  19SEP90               *
     F*                 LN0225                  21MAY90               *
     F*                 S01194                  20FEB90               *
     F*                 S01199                  15FEB90               *
     F*                 S01117                  18OCT89               *
     F*                 E16111                  17FEB89               *
     F*                 E16118                  18JAN89               *
     F*                 E13333                  14DEC88               *
0008 F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompiled)                                        *
      *  BUG27627 - Increase length of files referencing file         *
      *             STOPCSD                                           *
      *  BUG27045A - Override the fix of Bug 27045 (Recompile)        *
      *  BUG27045 - Amend via SOAP removes Document Linkage           *
      *             (Recompile)                                       *
      *  CAP201 - Enhance Stopped Cheques processing for              *
      *           Teller Interfaces                                   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CAAA03 - Webfacing Changes (recompile)                       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  123986 - Recompile over amended display file.                *
     F*  096352 - Amend fix 082288 to allow input of cheque amount    *
     F*           only, as this is all that is required for Stop      *
     F*           Cheques maintenance.                                *
     F*  082288 - Do not allow input of cheque number of '000000'     *
     F*           in 'From' field.                                    *
     F*  078274 - DO NOT ALLOW INPUT OF DUP CHECKS                    *
     F*  076550 - ADD A/C NAME AS FURTHER CHECK                       *
     F*  S01413 - Retail 3 Incorporation                              *
     F*  E22371 - RECOMPILED OVER AMENDED DISPLAY FILE                *
     F*  E21177 - INCORPORATE DATABASE ERROR HANDLING (NOT APPLIED    *
     F*           TO RELEASE 10 SOURCE BECAUSE IT DOES NOT NEED IT)   *
     F*  BHF638 - DELETE MESSAGE MISSING                              *
     F*  LN0225 - ADD PROCESSING FOR ? PROCESSING ON INPUT SCREEN     *
     F*  S01194 - NEW STANDING DATA                                   *
     F*  S01199 - HELP CHANGES                                        *
     F*  S01117 - MULTIBRANCHING                                      *
     F*  E16111 - CHANGE SIGN ON VALUE OF AMENDMENTS BEING PUT        *
     F*           OUT TO THE TRAILER IF IT IS NEGATIVE.               *
     F*  E16118 - DATE FIELDS ALLOW INPUT OF NON-NUMERIC DATA.        *
     F*  E13333 - PROGRAM AMENDED TO ALLOW DELETION OF STOP CHEQUES   *
     F*           ON CLOSED ACCOUNT.                                  *
     F*                                                               *
0011 F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     F*E0251FMCF  F     241            WORKSTN                            S01117
     F*RE0251FMCF**F    240            WORKSTN                      S01117076550
     F/COPY WNCPYSRC,RE0251F002
     F***RE0251FMCF  F     260            WORKSTN                                      076550 CGL029
     FRE0251FMCF  F     278            WORKSTN                                                CGL029
     F/COPY WNCPYSRC,RE0251F003
0018 F*TABLE***IF  F      96 12AI     2 DISK                              S01194
0019 F*CCNT   IF  F     400 15AI     2 DISK                               S01117
0019 F***ACCNT** IF  F     400 18AI     2 DISK                                         S01117 CGL029
     FACCNT   IF  F     573 24AI     2 DISK                                                   CGL029
0020 F***ACNUM** IF  F      40 10AI     2 DISK                                                CGL029
     FACNUM   IF  F      46 10AI     2 DISK                                                   CGL029
0021 F*TOPC   UF  F      96 18AI     2 DISK                               S01117
     F/COPY WNCPYSRC,RE0251F004
0021 F***STOPC** UF  F      96 21AI     2 DISK                                         S01117 CGL029
     F***STOPC** UF  F     106 27AI     2 DISK                                         CGL029 CAP201
     F***STOPC** UF  F     218 27AI     2 DISK                                       CAP201 BUG27627
     FSTOPC   UF  F     244 27AI     2 DISK                                                 BUG27627
     F                                              KCOMIT
0021 F***STOPCSD O   F      96            DISK                      A                         CGL029
     F***STOPCSD O   F     106            DISK                      A                  CGL029 CAP201
     F***STOPCSD O   F     218            DISK                      A                CAP201 BUG27627
     FSTOPCSD O   F     244            DISK                      A                          BUG27627
     F/COPY WNCPYSRC,RE0251F005
     F                                              KCOMIT
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FSDCURRL0IF  E           K        DISK                               LN0225
     FSTOPCL2 IF  E           K        DISK                               078274
     F/COPY WNCPYSRC,RE0251F001
0022 F**
0023 F*                  FUNCTION OF INDICATORS
0024 F*
0025 F* 01            WORKSTATION INPUT - SF SCREEN
0026 F* 02                              - SI
0027 F* 03                              SA
0028 F* 04                              SD
0029 F* 05                              - CATCHALL
0030 F* 06            STOPC - HEADER
0031 F* 11                  - DELETED REC
0032 F* 07                  - DETAIL REC
0033 F* 08                  - TRAILER
0037 F**09*******     TABLE FILE - CCY REC                                S01194
0038 F*
0012 F*    15  USED TO CONDITION FIRST TIME PASS THROUGH RPG CALC CYCLE
0013 F*    17  SET ON IF ERROR DURING READ FROM THE WORK STATION
     F*                                         OR  DUMMY RECORD I.D.
     F***********HELP INDICATOR                                           S01199
0039 F*               BLANK FIELDS ON INPUT
0040 F*
0041 F*    20         BRANCH
0042 F*    21         CCY - SECOND SCREEN
0043 F*    22         DATE RAISED(ALSO USED TO DENOTE NON-NUMERIC DATA)   E16118
0044 F*    23         FROM CHEQUE NO
0045 F*    24         TO CHEQUE NO
0046 F*    25         STOP AMOUNT
0047 F*    26         EXPIRY DATE
0048 F*    27         CUSTOMER
0049 F*    28         CCY - SF SCREEN
0050 F*    29         A/C CODE
0051 F*    30         SEQUENCE NO
0052 F*    31         RETAIL A/C NO
0053 F*    32         REFERENCE NO
0054 F*    33         ACT CODE
0055 F*       34      CHAIN FAIL
0056 F*       35      MULTI-PURPOSE
0057 F*       36      SCREEN INVALID
0058 F*       41      NON-DISPLAY FIELDS ON SECOND SCREEN
0059 F*       37      MULTI-BRANCH IND ON - MBIN=Y                        S01117
0060 F*       38      SUCCESSFUL EXIT FROM UDLOG
0061 F*       39      ACTION CODE OF E, VALID SF SCREEN
0061 F*       80      ON IF ORIGINAL STOP AMOUNT IS DECREASED             E16111
0062 F*       83      0 DEC PLACES
0063 F*       84      1
0064 F*       85      2
0065 F*       86      3
0066 F*
0067 F*               HIGH INTENSITY FIELDS ON SECOND SCREEN
0068 F*
0069 F*       45      BRANCH CODE
0070 F*       46      CCY
0071 F*       47      DATE RAISED
0072 F*       48      FROM CHEQUE NO
0073 F*       49      TO CHEQUE NO
0074 F*       50      STOP AMOUNT
0075 F*       51      NARRATIVE
0076 F*       52      EXPIRY DATE
0077 F*
0078 F*       53      PROTECT FIELDS ON SECOND SCREEN
0079 F*       54      NON-DISPLAY AND PROTECT A/C FIELDS ON SF SCREEN
0080 F*       55      STOP AMOUNT ON FILE IS ZERO
0081 F*       62      NON-DISPLAY AND PROTECT RETAIL A/C NO ON SF SCREEN
0082 F*       63      NON-DISPLAY AND PROTECT OTHER FIELDS ON SF SCREEN
0083 F*
0084 F*               HIGH INTENSITY FIELDS ON SF SCREEN
0085 F*
0086 F*       56      A/C NO
0087 F*       40      A/C CODE
0088 F*       42      RETAIL A/C NO
0089 F*       43      REF NO
0090 F*       44      ACTION CODE
0091 F*       57      CUSTOMER NO
0092 F*       58      SEQUENCE
0093 F*       59      CCY
0094 F*       60      OUTPUT TO WORKSTATION
0095 F*       64      RETAIL A/C NUMBERS SUPPORTED
0096 F*       65      NON-DISPLAY RETAIL A/C NO, SECOND SCREEN
0097 F*
0098 F*               OUTPUT INDICATORS
0099 F*
 104 F*       74      STOPC DETAIL
 105 F*       75      STOPC TRAILER
0106 F*       76      RELEASE STOPC
0107 F*       68      NON-DISPLAY ERROR CODES
0108 E*****               KY         15  1                                S01117
0108 E**********          KY         18  1                                             S01117 CGL029
     E                    KY         24  1                                                    CGL029
0109 E*****               MSG     1  13 55                                S01117
     E                    MSG     1  16 61                                S01117
0110 E                    ERCD       18  4
0111 E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
0112 E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
0113 E**
0114 E                    ZA1        16  1               ZALIGN SR. ARRAY
0115 E                    ZA2        16  1               ZALIGN SR. ARRAY
0116 E**
0117 E*****               ACD        18  1               FOR OPACOD FIELD S01117
0117 E**********          ACD        22  1               FOR OPACOD FIELD              S01117 CGL029
     E                    ACD        28  1                                                    CGL029
0118 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
0119 E**
     E                    CPY@    1   1 80
     E/EJECT
0120 I*****TABLE*FILE***INSTALLATION*CONTROL*DATA*RECORD*1.               S01194
0121 I**********                                                          S01194
0122 I*TABLE***NS  17   2 C0   3 C1  12 C1                                S01194
0123 I*******AND      13 C0                                               S01194
0124 I**********                              1   1 RECI                  S01194
0125 I**********                              2   30RECT                  S01194
0126 I**********                             12  130RCDE                  S01194
0127 I**********                             14  66 TITL                  S01194
0128 I***********                            67  67 DATF                  S01117
0129 I***********                            68  700DFBR                  S01117
0130 I**********                             74  74 MODI1                 S01194
0131 I**********                             75  75 MODI2                 S01194
0132 I**********                             76  76 MODI3                 S01194
0133 I***********                         P  77  790RUND                  S01117
0134 I***********                            80  86 RUNA                  S01117
0135 I**********                             87  870SFLG                  S01194
0136 I**********                          P  90  920LCD                   S01194
0137 I**********                             93  93 CHTP                  S01194
0138 I**********                          P  94  960TNLU                  S01194
0139 I**********                                                          S01194
0140 I*****TABLE*FILE***INSTALLATION*CONTROL*DATA*RECORD*3.               S01194
0141 I**********                                                          S01194
0142 I********NS  17   1 CD   2 C0   3 C1                                 S01194
0143 I*******AND      12 C2  13 C0                                        S01194
0144 I**********                              1   1 RECI                  S01194
0145 I**********                              2   30RECT                  S01194
0146 I**********                             12  130RCDE                  S01194
0147 I**********                             14  170COMS                  S01194
0148 I**********                             18  210CADC                  S01194
0149 I**********                          P  22  240MDIC                  S01194
0150 I**********                          P  25  270MCIC                  S01194
0151 I**********                          P  28  300MDIA                  S01194
0152 I**********                          P  31  330MCIA                  S01194
0153 I**********                             34  370SRPL                  S01194
0154 I**********                             38  410SPAC                  S01194
0155 I**********                             42  450SWAC                  S01194
0156 I**********                             46  490FTAC                  S01194
0157 I**********                             50  530TAC4                  S01194
0158 I**********                             54  570TAC5                  S01194
0159 I**********                          P  63  650NOBA                  S01194
0160 I**********                          P  66  680TSIZ                  S01194
0161 I**********                             69  69 RACN                  S01194
0162 I**********                             70  700GLSI                  S01194
0163 I**********                             71  710RTSI                  S01194
0164 I**********                             72  720DLSI                  S01194
0165 I**********                             73  730NOSI                  S01194
0166 I**********                             74  740CTSI                  S01194
0167 I**********                          P  90  920LCD                   S01194
0168 I**********                             93  93 CHTP                  S01194
0169 I**********                          P  94  960TNLU                  S01194
0170 I**********                                                          S01194
0171 I*****TABLE*FILE***CURRENCIES*RECORD*1.                              S01194
0172 I**********                                                          S01194
0173 I********NS  09   1 CD   2 C2   3 C0                                 S01194
0174 I*******AND      13 C1                                               S01194
0175 I**********                              1   1 RECI                  S01194
0176 I**********                              2   30RECT                  S01194
0177 I**********                             10  12 CCY                   S01194
0178 I**********                             13  130SREC                  S01194
0179 I**********                             14  27 CCNM                  S01194
0180 I**********                          P  28  348SPOT                  S01194
0181 I**********                             35  37 CCYS                  S01194
0182 I**********                             38  380CDP                   S01194
0183 I**********                             39  390TNOT                  S01194
0184 I**********                             40  40 DCCY                  S01194
0185 I**********                             41  44 SRC1                  S01194
0186 I**********                             45  48 SRC2                  S01194
0187 I**********                             49  520TACC                  S01194
0188 I**********                             53  560TEQV                  S01194
0189 I**********                             57  600SWQV                  S01194
0190 I**********                             61  640TAC4                  S01194
0191 I**********                             65  680TAC5                  S01194
0192 I**********                             69  69 HIND                  S01194
0193 I**********                          P  70  768PART                  S01194
0194 I**********                             77  780SSNO                  S01194
0195 I**********                          P  90  920LCD                   S01194
0196 I**********                             93  93 CHTP                  S01194
0197 I**********                          P  94  960TNLU                  S01194
0198 I**********                                                          S01194
0199 I*****CATCHALL*FOR*DELETED*RECORDS.                                  S01194
0200 I********NS  17                                                      S01194
0201 I**********                                                          S01194
0202 I**
     I/COPY WNCPYSRC,REH00049
0203 I*
0205 I*
0206 I*
0207 IRE0251FMNS  01   1 CS   2 CF
0208 I       OR   02   1 CS   2 CI
0209 I       OR   03   1 CS   2 CA
0210 I       OR   04   1 CS   2 CD
0211 I                                        1   2 SID
0212 I*****                                   3   5 INBRCH          20    S01117
0213 I*****                                   6   8 INCCY1          21    S01117
0213 I                                        3   5 INCCY1          21    S01117
0214 I*****                                  09  14 INDATR          22    S01117
0214 I                                        6  11 INDATR          22    S01117
0215 I*****                                  15  22 INFROM          23    S01117
0215 I                                       12  19 INFROM          23    S01117
0216 I*****                                  23  30 INTO            24    S01117
0216 I                                       20  27 INTO            24    S01117
0217 I*****                                  31  44 INSTOP          25    S01117
0217 I                                       28  41 INSTOP          25    S01117
0218 I*****                                  45  64 INNAR                 S01117
0218 I                                       42  61 INNAR                 S01117
0219 I*****                                  65  70 INDATE          26    S01117
0219 I                                       62  67 INDATE          26    S01117
0212 I                                       68  70 INBRCH          20    S01117
0220 I                                       71  76 INCUSN          27
0221 I                                       77  79 INCCY2          28
0222 I**********                             80  83 INACOD          29                        CGL029
0223 I**********                             84  85 INSEQ           30                        CGL029
0224 I**********                             86  95 INRET           31                        CGL029
     I                                       80  89 INACOD          29                        CGL029
     I                                       90  91 INSEQ           30                        CGL029
     I                                       92 101 INRET           31                        CGL029
     I/COPY WNCPYSRC,RE0251I001
0225 I**********                             96  98 INREF           32                        CGL029
0226 I**********                             99  99 INACT           33                        CGL029
0227 I**********                              1  99 LOTSCN                                    CGL029
     I                                      102 104 INREF           32                        CGL029
     I                                      105 105 INACT           33                        CGL029
     I                                        1 105 LOTSCN                                    CGL029
     I/COPY WNCPYSRC,RE0251I002
0228 I        NS  05
0229 I**
0230 I**   STOPPED CHEQUES FILE
0231 ISTOPC   NS  06   1 CH
0232 I                                    P   2   40FLSZ
0233 I        NS  11   1 C*
0234 I       OR   07   1 CD
0235 I**********                              2   70CNUM                                      CSD027
0235 I                                        2   7 CNUM                                      CSD027
0236 I                                        8  10 CCY
0237 I**********                             11  140ACOD                                      CGL029
     I                                       11  140QQACC2                                    CGL029
0238 I                                       15  160ACSQ
     I/COPY WNCPYSRC,RE0251I003
0239 I                                       17  190STCR
     I/COPY WNCPYSRC,RE0251I004
0240 I                                       20  290ACNO
0241 I***********                            30  320BRCD                  S01117
0241 I                                       30  32 BRCA                  S01117
0242 I                                       33  400FCHQ
0243 I                                       41  480TCHQ
0244 I                                    P  49  550STPA
0245 I                                    P  56  580DATI
0246 I                                       59  78 STPN
0247 I                                    P  79  810EXPD
0248 I                                    P  90  920LCD
0249 I                                       93  93 CHTP
0250 I                                    P  94  960TNLU
     I                                       97 1060ACOD                                      CGL029
     I                                      107 171 EUSER                                     CAP201
     I                                      172 197 TMSTP                                     CAP201
     I                                      198 217 FROID                                     CAP201
     I                                      218 218 RPRLOC                                    CAP201
     I                                      219 244 INSTMP                                  BUG27627
     I/COPY WNCPYSRC,RE0251I005
0251 I**********                              1  96 LSTC                                      CGL029
     I                                        1 106 LSTC                                      CGL029
     I/COPY WNCPYSRC,RE0251I006
0252 I**
0253 I**
0254 I        NS  08   1 CT
     I                                    P  20  220NOSQ
     I                                    P  23  300VQW
     I                                    P  31  320VQD
0056 I                                    P  33  340NSQI
0057 I                                    P  35  360NSQA
0058 I                                    P  37  380NSQD
0059 I                                    P  39  460VQIW
0060 I                                    P  47  480VQID
0061 I                                    P  49  560VQAW
0062 I                                    P  57  580VQAD
0063 I                                    P  59  660VQDW
0064 I                                    P  67  680VQDD
0065 I                                    P  69  710NSAU
0066 I                                    P  72  790VQUW
0067 I                                    P  80  810VQUD
0068 I                                    P  82  840LCD
0069 I                                    P  85  870TNLU
     I/COPY WNCPYSRC,RE0251I007
0269 I**********                              1  96 LOT                                       CGL029
     I                                        1 106 LOT                                       CGL029
     I/COPY WNCPYSRC,RE0251I008
     I**   CATCHALL
0270 I        NS  17
     I**
0271 IACNUM   NS  17
0272 I                                       12  17 CUSNB
0273 I                                       18  20 CCYB
0274 I**********                             21  24 ACODB                                     CGL029
0275 I**********                             25  26 ACSQB                                     CGL029
0276 I**********                             12  26 KEYB                                      CGL029
0277 I**********                             27  27 ACST            16                        CGL029
0275 I**********                             29  31 BRCDB                              S01117 CGL029
     I                                       21  30 ACODB                                     CGL029
     I                                       31  32 ACSQB                                     CGL029
     I                                       12  32 KEYB                                      CGL029
     I                                       33  33 ACST            16                        CGL029
     I                                       35  37 BRCDB                                     CGL029
0278 I**
0279 IACCNT   NS  17
0280 I                                        1   1 RECIA
0281 I*****                                  23  250BRCDA                 S01117
0281 I                                       23  250BRCDAN                S01117
0281 I                                       23  25 BNCH                  S01117
0282 I                                        8  10 CCYA
0283 I                                        2   7 CUSN
     I**********                              2   70CNUMK                              078274 CSD027
     I                                        2   7 CNUMK                                     CSD027
0284 I                                        8  10 CCY
0285 I                                        2   7 CNUMA
0286 I**********                             11  14 ACODA                                     CGL029
     I                                       11  14 QQACOD                                    CGL029
0287 I                                       15  16 ACSQA
     I**********                             11  140ACODK                              078274 CGL029
     I                                       11  140QQACOK                                    CGL029
     I                                       15  160ACSQK                 078274
0288 I                                       29  29 ACST            16
0287 I                                       36  55 ANAM                  076550
     I                                      554 563 ACODA                                     CGL029
     I                                      554 5630ACODK                                     CGL029
     I**
     IPSDS       SDS
     I                                      244 246 WSID
     I                                      245 246 WID
     I                                      254 263 USRID
     I*
     I**  DATA STRUCTURE  TO UPDATE LAST TRANSACTION NUMBER DTAARA
     I**
     IDNATN       DS                              5
     I                                        1   50FNATN
     I**
     I**   DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     IINFDS       DS
     I                                     *STATUS  STATUS
     I**
     I**   DATA STRUCTURE USED IN COMMITMENT
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 INACT
     I                                       26  35 USRIDX
     I/COPY WNCPYSRC,RE0251I009
     I**********                             51 149 LOTSCN                                    CGL029
     I                                       51 155 LOTSCN                                    CGL029
     I/COPY WNCPYSRC,RE0251I010
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I**  DATA AREA RUNDAT                                                S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
     I** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 DFBR                  S01117
     I**                                                                  S01117
     I            DS                                                      S01117
     I** OPACD2 DEFINED IN OPACOD                                         S01117
     I**********                              1  22 OPACOD                             S01117 CGL029
     I**********                              5  22 OPACD2                             S01117 CGL029
     I                                        1  28 OPACOD                                    CGL029
     I                                        5  28 OPACD2                                    CGL029
     I**                                                                  S01117
     ISDBANK    E DSSDBANKPD                                              S01194
      **   BANK DETAILS                                                   S01194
     ISDRETL    E DSSDRETLPD                                              S01194
      **   RETAIL DETAILS                                                 S01194
     ISDCURR    E DSSDCURRPD                                              S01194
      **   CURRENCY TYPE                                                  S01194
     ISDCUST    E DSSDCUSTPD                                              LN0225
      **   CUSTOMER DETAILS                                               LN0225
     ISDACOD    E DSSDACODPD                                              LN0225
     I              QQACCD                          QQACC1                                    CGL029
      **   ACCOUNT CODES                                                  LN0225
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              QQDFAC                          QQDFC1                                    CGL029
     I**  EXTERNAL DS FOR BRANCH CODE DETAILS                             S01117
     I*****************************************************************   S01117
     I**
     I/EJECT
     I/COPY WNCPYSRC,REH00050
     C                     MOVEACPY@      BIS@   80
     C** KLIST FOR STOPCL2                                                078274
     C           *LIKE     DEFN FCHQ      CHQK                            078274
     C           KEYME     KLIST                                          078274
     C                     KFLD           BNCH                            078274
     C                     KFLD           CNUMK                           078274
     C                     KFLD           CCY                             078274
     C                     KFLD           ACODK                           078274
     C                     KFLD           ACSQK                           078274
     C                     KFLD           CHQK                            078274
     C** PARAMETER LIST FOR PROGRAM 'AOBANKR0'                            S01194
     C           PLISTA    PLIST                                          S01194
     C                     PARM '*DBERR ' RTCD    7                       S01194
     C                     PARM '*FIRST ' OPTN    7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C** PARAMETER LIST FOR PROGRAM 'AORETLR0'                            S01194
     C           PLISTB    PLIST                                          S01194
     C                     PARM '*DBERR ' RTCD                            S01194
     C                     PARM '*FIRST ' OPTN                            S01194
     C           SDRETL    PARM SDRETL    DSFDY                           S01194
     C**  PARAMETER LIST FOR AOCURRR0                                     S01194
     C           PLIST1    PLIST                                          S01194
     C                     PARM '*BLANKS' RTCD                            S01194
     C                     PARM '*KEY   ' OPTN                            S01194
     C                     PARM           CKEY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C**  PARAMETER LIST FOR AOCUSTR0                                     LN0225
     C           PLIST2    PLIST                                          LN0225
     C                     PARM '*BLANKS' RTCD                            LN0225
     C                     PARM '*KEY   ' OPTN                            LN0225
     C                     PARM           CUSKEY 10                       LN0225
     C                     PARM           KEYSTS  7                       LN0225
     C           SDCUST    PARM SDCUST    DSSDY                           LN0225
     C**  PARAMETER LIST FOR AOACODR0                                     LN0225
     C           PLIST3    PLIST                                          LN0225
     C                     PARM '*BLANKS' RTCD                            LN0225
     C                     PARM '*KEY   ' OPTN                            LN0225
     C**********           PARM           ACOKEY  4                                    LN0225 CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                        LN0225 CGL029
     C                     PARM           ACOKEY 10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C**   IF RPG 01021 ERROR THEN GOTO PROGRAM ERROR HANDLING
     C           STATUS    IFEQ 01021
     C                     EXSR UDLOG
     C                     GOTO ERRTAG
     C                     END
     C**
     C*    READ WORKSTATION FILE /*HELP*FACILITY*                         S01199
     C**
     C           *IN15     IFEQ '1'
     C           *IN17     DOUEQ'0'
     C                     READ RE0251FM                 17
     C************IN17     IFEQ '1'                                       S01199
     C***********          MOVEAERCD      HERCD 160                       S01199
     C***********          MOVEL'RE0251'  HBPGM   8                       S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C***********          END                                            S01199
     C                     END
     C                     GOTO MAINPR
     C                     END
0332 C  N15                SETON                     1505
0333 C                     SETOF                     17
0335 C**
0336 C**   FIRST CYCLE PROCESSING
     C**                                                                  S01117
     C**    IN THE DATAAREA RUNDAT                                        S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**    IN THE DATAAREA ZMUSER                                        S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C*                                                                   S01117
0337 C**********           EXSR ZSYSTM                                    S01194
0338 C**********           MOVE '20'      ZTABKY                          S01194
0339 C**********           MOVE ZTABKY    TKEY                            S01194
0340 C**********           EXSR TABCHN                                    S01194
     C                     CALL 'AOBANKR0'PLISTA                          S01194
     C*                                                                   S01194
1143 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
1144 C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01194
     C*                                                                   S01194
     C                     CALL 'AORETLR0'PLISTB                          S01194
     C*                                                                   S01194
0341 C********** RACN      COMP 'Y'                  141464               S01194
0341 C           BMRANR    COMP 'Y'                  141464               S01194
0342 C  N64                SETON                     65
0343 C**
0344 C**   DEFINE FIELDS
0345 C                     MOVE ' '       BLK2    2
0346 C                     MOVE ' '       BLK4    4
0347 C                     MOVE ' '       BLK6    6
0348 C                     MOVE ' '       BLK3    3
0349 C                     MOVE ' '       BLK1    1
0350 C                     MOVE ' '       BLK10  10
0351 C*****                MOVE ' '       BLK68  68                       S01117
0351 C                     MOVE ' '       BLK65  65                       S01117
0352 C                     MOVE ' '       BLK76  76
0353 C                     MOVE ' '       BLK150150
0354 C                     MOVE ' '       BLK14  14
0355 C                     MOVE ' '       BLK18  18
0356 C                     MOVE ' '       BLK100100
0357 C                     Z-ADD0         ZERO05  50
     C/COPY WNCPYSRC,RE0251C004
0358 C**   GET MULTI-BRANCH INDICATOR                                     S01117
0359 C*****      DFBR      COMP 0                        37               S01117
     C**  IF MBIN = Y SETON MULTIBRANCH IND.                              S01117
0359 C           MBIN      COMP 'Y'                      37               S01117
0360 C           MAINPR    TAG                             ** MAINPR TAG
0361 C**   SET IND TO CONDITION SCREEN OUTPUT
0362 C                     SETON                     6051
0363 C                     SETOF                     78
0364 C                     EXSR SETOF
0365 C                     EXSR TIME
0366 C   05
0367 COR KL                EXSR SFOUT
0368 C   05
0369 COR KL                SETON                     4165
0370 C   05
0371 COR KL                GOTO ENDPR
0372 C   KC                GOTO ENDPR
0373 C   01                EXSR SR05
0374 C   02
0375 COR 03                EXSR SR10
0376 C   04                EXSR SR20
0377 C**
0382 C           ENDPR     TAG                             ** ENDPR TAG
     C/COPY WNCPYSRC,RE0251C001
     C**
     C   KC                SETOF                     60
     C   KC                SETON                     LR
0383 C**
     C           ERRTAG    TAG
0384 C**   IF ANY ERROR CODES ARE SET UP, MOVE INTO ERCDS
0385 C           S         COMP 0                    35
0386 C   35                MOVEAERCD      ERCDS
0387 C           ERCDS     COMP BLK76                    68
0388 C   01 KJ             GOTO JUMP
0389 C                     MOVE INRET     SAVRET 100
     C                     MOVE IANAM     SAVANM 20                       076550
0390 C           JUMP      TAG
0391 C********************************************************************
0392 C**
0393 C**   SUBROUTINE TO PROCESS GENERAL FUNCTION REQUEST SCREEN
0394 C           SR05      BEGSR                           *** SR05 ***
0395 C   KJ                MOVELMSG,2     ERCDS
0396 C   KJ                GOTO END051
0397 C                     SETOF                     77
0398 C**
0399 C**   VALIDATE ACCOUNT KEY DETAILS
     C**   VALIDATE BRANCH                                                S01117
     C           *IN64     IFNE '1'                        IF BMRANR<>'Y' S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '1'                        IF BLANK INBRCHS01117
     C           MBIN      OREQ 'N'                        OR SINGLEBRANCHS01117
     C**                                                                  S01117
     C**  TAKE DEFAULT BRANCH CODE AS INPUT BRANCH                        S01117
     C                     MOVE BJSBRC    INBRCH                          S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C** BASIC VALIDATION OF INPUT BRANCH CODE                            S01117
     C           MBIN      IFEQ 'Y'                        IF MULTIBRANCH S01117
     C           *IN20     ANDNE'1'                        & INBRCH<>BLANKS01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM INBRCH    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVE '032'     ERCD,S                          S01117
     C                     SETON                     45                   S01117
     C                     GOTO END051                                    S01117
     C                     ELSE                                           LN0225
     C                     MOVE A8BRCD    INBRCH                          LN0225
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C**                                                                  S01117
0400 C**   CUST NO - MANDATORY IF ACNO NOT ENTERED
0401 C   31 27N641         ADD  S         S          57
0402 C   31 27N64          MOVE '023'     ERCD,S
0403 C**
0404 C**   CURRENCY CODE - MANDATORY IF CUST NO. ENTERED
0405 C  N27 28   1         ADD  S         S          59
0406 C  N27 28             MOVE '024'     ERCD,S
0407 C**
0408 C**   A/C CODE - MANDATORY IF CUST NO. ENTERED
0409 C  N27 29   1         ADD  S         S          40
0410 C  N27 29             MOVE '036'     ERCD,S
0411 C**
0412 C**   RETAIL ACNO - PRESENT IF RETAIL NOS SUPPORTED, ELSE ABSENT
0413 C**
0414 C  N31                MOVELINRET     NUM110 110
0415 C  N31                MOVELNUM110    ALF10  10
0416 C  N31      INRET     COMP ALF10                3636
0417 C  N31 36   1         ADD  S         S          42
0418 C  N31 36             MOVE '090'     ERCD,S
0419 C*
0420 C   64 31   1         ADD  S         S          42
0421 C   64 31             MOVE '090'     ERCD,S
0422 C**
0423 C**   CURRENCY CODE
0424 C   28                GOTO TESTER
0425 C**********           MOVEL'20      'TKEY   12                       S01194
0426 C**********           MOVE '1'       TKEY4   4                       S01194
0427 C**********           MOVELINCCY2    TKEY4                           S01194
0428 C**********           MOVE TKEY4     TKEY                            S01194
0429 C**********           EXSR TABCHN                                    S01194
     C*                                                                   LN0225
     C* NEW STANDING DATA                                                 LN0225
     C*                                                                   LN0225
     C                     MOVELINCUSN    CUSKEY                          LN0225
     C                     CALL 'AOCUSTR0'PLIST2                          LN0225
     C           RTCD      IFNE *BLANKS                                   LN0225
     C           S         ADD  1         S                               LN0225
     C                     MOVE '128'     ERCD,S                          LN0225
     C                     MOVELMSG,2     ERCDS                           LN0225
     C                     SETON                     57                   LN0225
     C                     ELSE                                           LN0225
     C                     MOVELBBCUST    INCUSN                          LN0225
     C                     END                                            LN0225
     C*                                                                   LN0225
0427 C                     MOVELINCCY2    CKEY                            S01194
     C                     CALL 'AOCURRR0'PLIST1                          S01194
     C           RTCD      COMP *BLANKS                  09               S01194
     C   09                MOVELA6CYCD    INCCY2                          S01194
0430 C  N09      1         ADD  S         S          59
0431 C  N09                MOVE '024'     ERCD,S
     C*                                                                   LN0225
     C                     MOVELINACOD    ACOKEY                          LN0225
     C                     CALL 'AOACODR0'PLIST3                          LN0225
     C           RTCD      IFNE *BLANKS                                   LN0225
     C           S         ADD  1         S                               LN0225
     C                     MOVE '128'     ERCD,S                          LN0225
     C                     MOVELMSG,2     ERCDS                           LN0225
     C                     SETON                     40                   LN0225
     C                     ELSE                                           LN0225
     C                     MOVELA5ACCD    INACOD                          LN0225
     C                     END                                            LN0225
     C*                                                                   LN0225
0432 C           TESTER    TAG                             ** TESTER TAG
     C/COPY WNCPYSRC,RE0251C005
0433 C  N32                MOVELINREF     NUM40   40
0434 C  N32                MOVELNUM40     ALF3    3
     C/COPY WNCPYSRC,RE0251C006
0435 C  N32      INREF     COMP ALF3                 3232
0436 C   32      1         ADD  S         S          43
0437 C   32                MOVE '104'     ERCD,S
0438 C**
0439 C**   IF ANY ERRORS SO FAR, EXIT
0440 C           S         COMP 0                    35
0441 C   35                GOTO END051
0442 C**
0443 C**   ACCESS ACCOUNTS FILE RECORD
0444 C**   -  IF RETAIL A/C ENTERED, GET A/C KEY FROM ACNUM
0445 C  N31      INRET     CHAINACNUM                34
0446 C**N31N34N16                                          CLOSED A/C     E13333
0447 C*RN31*34***          GOTO ACNER                      NOT FOUND      E13333
     C*                                                                   E13333
     C  N31 34             GOTO ACNER                      NOT FOUND      E13333
0448 C*
0449 C**N31                MOVE KEYB      KEYA   15                       S01117
0449 C**N31*****           MOVELKEYB      KEYA   18                                    S01117 CGL029
     C  N31                MOVELKEYB      KEYA   24                                           CGL029
0449 C  N31                MOVE BRCDB     KEYA                            S01117
0450 C   31                MOVEAINCUSN    KY,1
0451 C   31                MOVEAINCCY2    KY,7
0452 C   31                MOVEAINACOD    KY,10
0453 C***31*****           MOVEAINSEQ     KY,14                                               CGL029
0454 C***31*30**           MOVEA'01'      KY,14            DEFAULT FOR A/C                    CGL029
0453 C***31*****           MOVEAINBRCH    KY,16                                        S01117 CGL029
     C   31                MOVEAINSEQ     KY,20                                               CGL029
     C   31 30             MOVEA'01'      KY,20                                               CGL029
     C   31                MOVEAINBRCH    KY,22                                               CGL029
0455 C**
0456 C   31                MOVEAKY        KEYA
0457 C                     MOVE ' '       RECIA
     C                     MOVE *BLANKS   IANAM  20                       076550
0458 C           KEYA      CHAINACCNT                34
0459 C*
0460 C**N34N16***                                          CLOSED A/C     E13333
0461 C*R*34******          GOTO ACNER                      NOT FOUND      E13333
     C*                                                                   E13333
     C   34                GOTO ACNER                      NOT FOUND      E13333
     C                     MOVE ANAM      IANAM                           076550
     C**                                                                  S01117
     C**  MOVE BRANCH CODE FOR OUTPUT                                     S01117
     C   17N34             MOVE BNCH      OPBR    3                       S01117
0462 C**
0463 C**   IF RET ACNO ENTERED, GET CCY REC
0464 C***28*****           MOVEL'20      'TKEY                            S01194
0465 C**********           MOVE '1'       TKEY4                           S01194
0466 C**********           MOVELCCYA      TKEY4                           S01194
0467 C**********           MOVE TKEY4     TKEY                            S01194
0468 C**********           EXSR TABCHN                                    S01194
     C                     MOVELCCYA      CKEY                            S01194
     C                     CALL 'AOCURRR0'PLIST1                          S01194
     C           RTCD      COMP *BLANKS              3434                 S01194
0469 C                     GOTO REFVAL
0470 C********
0471 C           ACNER     TAG                             ** ACNER TAG
0472 C**N31*34***                                          RET NOT FND    E13333
0473 C*RN31N34N16          SETON                     3642  RET CLOSED     E13333
0474 C***31*34***                                                         E13333
0475 C*R*31N34N16          SETON                     3656                 E13333
     C  N31 34             SETON                     3642                 E13333
     C   31 34             SETON                     3656                 E13333
     C*                                                                   E13333
0476 C   34                MOVELMSG,1     ERCDS  76
0477 C**N34N16***          MOVELMSG,13    ERCDS                           E13333
0478 C                     GOTO END05
0479 C           REFVAL    TAG                             ** REFVAL TAG
     C**                                                                  E13333
     C**   IF ACCOUNT IS CLOSED, CHECK IF ACTION CODE = 'D'               E13333
     C**                                                                  E13333
     C  N34N16   INACT     IFNE 'D'                                       E13333
     C                     MOVELMSG,13    ERCDS                           E13333
     C   31                SETON                     3656                 E13333
     C  N31                SETON                     3642                 E13333
     C                     GOTO END05                                     E13333
     C                     END                                            E13333
0480 C**
0481 C**   REF NO. - MANDATORY
0482 C**
0483 C**   GET ITEM FROM STOPC FILE AND RELEASE
     C**   KEY SEQUENCE OF S/STOPC IS BRCA/ACCOUNT NO/STCR                S01117
0484 C*****                MOVELKEYA      KEYS   18                       S01117
0484 C**********           MOVELKEYA      KEYS1  15                                    S01117 CGL029
     C                     MOVELKEYA      KEYS1  21                                           CGL029
0484 C**********           MOVELBNCH      WRK18  18                                    S01117 CGL029
0484 C**********           MOVE KEYS1     WRK18  18                                    S01117 CGL029
     C                     MOVELBNCH      WRK18  24                                           CGL029
     C                     MOVE KEYS1     WRK18                                               CGL029
0485 C*****                MOVE INREF     KEYS                            S01117
     C/COPY WNCPYSRC,RE0251C007
0485 C**********           MOVELWRK18     KEYS   21                                    S01117 CGL029
     C                     MOVELWRK18     KEYS   27                                           CGL029
     C/COPY WNCPYSRC,RE0251C008
0485 C                     MOVE INREF     KEYS                            S01117
0486 C                     EXSR STOCHN
0487 C  N34                SETON                     76
0488 C  N34                EXSR EXCPTN
     C/COPY WNCPYSRC,RE0251C009
0489 C**********           MOVE LSTC      LSTCS  96                                           CGL029
     C                     MOVE LSTC      LSTCS 106                                           CGL029
     C/COPY WNCPYSRC,RE0251C010
0490 C**
0491 C**   ACTION CODE
0492 C                     SETOF                     44
0493 C           INACT     COMP ' '                      35
0494 C   35                GOTO ACTERR
0495 C           INACT     COMP 'A'                      35
0496 C  N35      INACT     COMP 'D'                      35
0497 C  N35      INACT     COMP 'E'                      35
0498 C***35N07***          MOVELMSG,8     ERCDS                           S01117
0499 C***35N07***          GOTO END051                                    S01117
0500 C***35******          GOTO END05                                     S01117
0501 C*****      INACT     COMP 'I'                      35               S01117
0501 C  N35      INACT     COMP 'I'                      35               S01117
0502 C  N35                GOTO ACTERR
     C           INACT     IFNE 'I'                                       S01117
0498 C   35N07             MOVELMSG,8     ERCDS                           S01117
0499 C   35N07             GOTO END051                                    S01117
     C                     ELSE                                           S01117
     C           *IN07     IFEQ '1'                                       S01117
     C                     MOVELMSG,7     ERCDS                           S01117
     C                     SETON                     44                   S01117
     C                     GOTO END05                                     S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**   VALIDATE ACTION CODE                                           S01117
     C**   IF MBIN = N, VALIDATE ACTION                                   S01117
     C***  VALIDATE USERS AUTHORITY TO USE THIS BRANCH/ACTION             S01117
     C*                                                                   S01117
     C                     Z-ADD*ZERO     @ERR                            S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'N'                        B1             S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM INACT     @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**  IF NOT VALID FOR USER                                           S01117
     C           @ERR      IFNE *ZERO                      B2             S01117
     C                     MOVELMSG,14    ERCDS                           S01117
     C                     SETON                     44                   S01117
     C                     END                             E2             S01117
     C                     END                             E1             S01117
     C*                                                                   S01117
     C**   IF MBIN = Y, VALIDATE ACTION & BR. CODE TOGETHER               S01117
     C           MBIN      IFEQ 'Y'                        B1             S01117
     C*                                                                   S01117
     C*  IF RETAIL ACCOUNT MOVE BRANCH FROM ACNUM INTO INBRCH             S01117
     C*                                                                   S01117
     C  N31                MOVE BRCDB     INBRCH                          S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM INACT     @ZACTN  1                       S01117
     C                     PARM INBRCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**  IF NOT VALID FOR USER                                           S01117
     C           @ERR      IFNE *ZERO                      B3             S01117
     C           @ERR      IFEQ 1                                         S01194
     C                     MOVELMSG,15    ERCDS                           S01117
     C                     SETON                     4445                 S01117
     C                     END                                            S01117
     C           @ERR      IFEQ 2                                         S01194
     C                     MOVELMSG,16    ERCDS                           S01117
     C                     SETON                     4445                 S01117
     C                     END                                            S01117
     C                     END                             E2             S01117
     C*                                                                   S01117
     C                     END                             E1             S01117
     C                     GOTO END05                                     S01117
0503 C*****                                                               S01117
0504 C**N07                GOTO END05                                     S01117
0505 C*****                MOVELMSG,7     ERCDS                           S01117
0506 C*****                SETON                     44                   S01117
0507 C*****                GOTO END051                                    S01117
     C**   SETON ERROR INDICATORS                                         S01117
0508 C           ACTERR    TAG                             ** ACTERR TAG
0509 C           1         ADD  S         S       20 44
0510 C                     MOVE '012'     ERCD,S
0511 C           END05     TAG                             ** END05 TAG
0512 C  N34                SETON                     77
0513 C           S         COMP 0                    36
0514 C  N36      ERCDS     COMP BLK76                3636
0515 C   36                GOTO END051
0516 C**
0517 C**   SET UP INDICATORS, FIELDS FOR SECOND SCREEN
0518 C   64                SETOF                     65
0519 C  N64                SETON                     65
0520 C           INACT     COMP 'I'                      35
0521 C   35                SETON                     78
0522 C   35                SETON                     546362
0523 C   35                SETOF                     4153
0524 C   35                MOVE 'SI'      SID
0525 C**
0526 C           INACT     COMP 'A'                      35
0527 C   35                SETON                     546362
0528 C   35                SETOF                     4153
0529 C   35                MOVE 'SA'      SID
0530 C**
0531 C           INACT     COMP 'D'                      35
0532 C   35                SETON                     5354
0533 C   35                SETON                     6263
0534 C   35                SETOF                     41
0535 C   35                MOVE 'SD'      SID
0536 C**
0537 C**   SET UP A/C CODE FIELD
0538 C*****                MOVEA'-'       ACD,7                           S01117
0538 C                     MOVEA'-'       ACD,4                           S01117
0539 C                     MOVEA'-'       ACD,11
0540 C*****                MOVEA'-'       ACD,16                          S01117
0540 C                     MOVEA'-'       ACD,15                          S01117
0540 C**********           MOVEA'-'       ACD,20                                       S01117 CGL029
     C                     MOVEA'-'       ACD,26                                              CGL029
0541 C   31                MOVEAINBRCH    ACD,1                           S01117
0541 C***31                MOVEAINCUSN    ACD,1                           S01117
0541 C   31                MOVEAINCUSN    ACD,5                           S01117
0542 C***31                MOVEAINCCY2    ACD,8                           S01117
0542 C   31                MOVEAINCCY2    ACD,12                          S01117
0543 C***31                MOVEAINACOD    ACD,12                          S01117
0543 C   31                MOVEAINACOD    ACD,16                          S01117
0544 C***31                MOVEAINSEQ     ACD,17                          S01117
0544 C***31*****           MOVEAINSEQ     ACD,21                                       S01117 CGL029
     C   31                MOVEAINSEQ     ACD,27                                              CGL029
0545 C***31 30             MOVEA'01'      ACD,17                          S01117
0545 C***31*30**           MOVEA'01'      ACD,21                                       S01117 CGL029
     C   31 30             MOVEA'01'      ACD,27                                              CGL029
0541 C  N31                MOVEABNCH      ACD,1                           S01117
0546 C**N31                MOVEACUSN      ACD,1                           S01117
0546 C  N31                MOVEACUSN      ACD,5                           S01117
0547 C**N31                MOVEACCYA      ACD,8                           S01117
0547 C  N31                MOVEACCYA      ACD,12                          S01117
0548 C**N31                MOVEAACODA     ACD,12                          S01117
0548 C  N31                MOVEAACODA     ACD,16                          S01117
0549 C**N31                MOVEAACSQA     ACD,17                          S01117
0549 C**N31*****           MOVEAACSQA     ACD,21                                       S01117 CGL029
     C  N31                MOVEAACSQA     ACD,27                                              CGL029
0550 C*****                MOVEAACD       OPACOD 18                       S01117
0550 C**********           MOVEAACD       OPACOD 22                                    S01117 CGL029
     C                     MOVEAACD       OPACOD 28                                           CGL029
0551 C**
0552 C           INACT     COMP 'E'                      39
0553 C   39                EXSR SFOUT
0554 C**
0555 C**   IF ACTION CODE IS A, D OR E, MOVE DATA FROM REC INTO SCREEN
0556 C           INACT     COMP 'I'                      35
0557 C   35                GOTO END051
0558 C                     EXSR MOVER
0559 C**
0560 C           END051    ENDSR                           ** END051 **
0561 C********************************************************************
0562 C**   SUBROUTINE TO PROCESS INSERT OR AMEND SCREEN
0563 C           SR10      BEGSR                           *** SR10 ***
0564 C**
0565 C   KJ                MOVELMSG,2     ERCDS
0566 C   KJ                GOTO END10
0567 C**
0568 C**   VALIDATE INPUT DATA
0569 C**
0570 C*****BRANCH CODE - MANDATORY IF MULTIBRANCH ON                      S01117
0571 C***37 20             GOTO BRERR                                     S01117
0572 C***20                Z-ADDDFBR      OPBR    30                      S01117
0573 C**N20                MOVE INBRCH    OPBR                            S01117
0574 C*****      OPBR      COMP BRCDA                4545                 S01117
0575 C**N45                GOTO CURVL                                     S01117
0576 C*****      BRERR     TAG                             ** BRERR TAG   S01117
0577 C*****      1         ADD  S         S          45                   S01117
0578 C*****                MOVE '032'     ERCD,S                          S01117
0579 C*****      CURVL     TAG                             ** CURVL TAG   S01117
0580 C**
0581 C**   CURRENCY - MANDATORY, EQUAL TO CCY OF ACCOUNTS REC
0582 C   21                SETON                     46
     C**********           MOVE INCCY1    CKEY                      S01194LN0225
     C**********           CALL 'AOCURRR0'PLIST1                    S01194LN0225
     C********** RTCD      IFEQ *BLANKS                             S01194LN0225
     C**********           MOVE A6CYCD    INCCY1                    S01194LN0225
     C**********           END                                      S01194LN0225
     C           INCCY1    CHAINSDCURRL0             46                   LN0225
0583 C  N21      INCCY1    COMP CCYA                 4646
0584 C   46      1         ADD  S         S
0585 C   46                MOVE '024'     ERCD,S
0586 C**
0587 C**   DATE RAISED - MANDATORY, NOT GR THAN RUN DATE
0586 C**                                                                  E16118
0586 C                     MOVE *BLANKS   WKDT    6                       E16118
0586 C                     MOVE *ZEROS    WNUM7   70                      E16118
0586 C                     MOVELINDATR    WNUM7                           E16118
0586 C                     MOVELWNUM7     WKDT                            E16118
0586 C           INDATR    COMP WKDT                 2222                 E16118
0586 C**                                                                  E16118
0588 C  N22                MOVE INDATR    ZDATE
0589 C  N22                EXSR ZDATE1
0590 C  N22N99   ZDAYNO    COMP RUND                 47
0591 C   22
0592 COR 99                SETON                     47
0593 C   47      1         ADD  S         S
0594 C   47                MOVE '126'     ERCD,S
0595 C**
0596 C**   FROM CHEQUE NO - MANDATORY IF AMT ABSENT OR TO CHEQUE
0597 C**   NO ENTERED
     C                     MOVE *BLANKS   ALF8                            096352
0598 C  N24 23
0599 COR 25 23             SETON                     48
0600 C  N48N23             MOVELINFROM    NUM9    90       NUMERIC
0601 C  N48N23             MOVELNUM9      ALF8    8
     C*                                                                   082288
     C**  Cheque number must not be '000000'.                             082288
     C**  Only validate this field if it is non-blank.                    082288
     C*                                                                   082288
     C           NUM9      IFEQ 00                                        082288
     C           ALF8      ANDNE*BLANKS                                   096352
     C                     MOVE '1'       *IN48                           082288
     C                     END                                            082288
     C*                                                                   082288
0602 C  N48N23   ALF8      COMP INFROM               4848
0603 C   48      1         ADD  S         S
0604 C   48                MOVE '121'     ERCD,S
     C           *IN48     IFNE '1'                                       078274
     C           INFROM    ANDNE*BLANKS                                   078274
     C           INTO      ANDEQ*BLANKS                                   078274
     C           INACT     ANDEQ'I'                                       078274
     C                     MOVELINFROM    CHQK                            078274
     C           KEYME     CHAINSTOPCL2              99                   078274
     C           *IN99     IFNE '1'                                       078274
     C                     SETON                     48                   078274
     C           1         ADD  S         S                               078274
     C                     MOVE '121'     ERCD,S                          078274
     C                     END                                            078274
     C                     END                                            078274
0605 C**
0606 C**   TO CHEQUE NO - OPTIONAL, NOT ENTERED IF FROM CHEQUE
0607 C**   NO BLANK OR IF AMT ENTERED, GREATER THAN FROM NO
0608 C   24                GOTO AMTVAL
     C                     MOVE *BLANKS   ALF8                            096352
0609 C   23
0610 CORN25                SETON                     49
0611 C  N49                MOVELINTO      NUM9
0612 C  N49                MOVELNUM9      ALF8
0613 C  N49      ALF8      COMP INTO                 4949
0614 C**
0615 C  N49N48   INTO      COMP INFROM                 4949
0616 C   49      1         ADD  S         S
0617 C   49                MOVE '122'     ERCD,S
0618 C           AMTVAL    TAG                             ** AMTVAL TAG
0619 C**
0620 C**   STOP AMOUNT - MANDATORY IF FROM CHEQUE NO BLANK,
0621 C**   NOT ENTERED IF TO CHEQUE NO ENTERED
0622 C   23 25             SETON                     50
0623 C  N24N25             SETON                     50
0624 C                     MOVE '  '      ZFIELD
0625 C  N50                MOVELINSTOP    ZFIELD
0626 C**N50*****           Z-ADDCDP       ZADEC                           S01194
0626 C  N50                Z-ADDA6NBDP    ZADEC                           S01194
0627 C  N50                Z-ADD12        ZADIG
0628 C  N50                EXSR ZALIGN
0629 C  N50 99             SETON                     50
0630 C   50      1         ADD  S         S
0631 C   50                MOVE '123'     ERCD,S
0632 C  N50                MOVE ZFIELD    OSTOP  130
0633 C**
0634 C**   EXPIRY DATE - OPTIONAL, VALID, NOT LESS THAN RUN DATE
0635 C   26                GOTO TAG10A
0586 C**                                                                  E16118
0586 C                     MOVE *BLANKS   WKDT    6                       E16118
0586 C                     MOVE *ZEROS    WNUM7   70                      E16118
0586 C                     MOVELINDATE    WNUM7                           E16118
0586 C                     MOVELWNUM7     WKDT                            E16118
0586 C           INDATE    COMP WKDT                 5252                 E16118
0586 C           *IN52     IFEQ '0'                                       E16118
0636 C                     MOVE INDATE    ZDATE
0637 C                     EXSR ZDATE1
0638 C  N99      ZDAYNO    COMP RUND                   52
0639 C   99                SETON                     52
0586 C                     END                                            E16118
0586 C**                                                                  E16118
0640 C   52      1         ADD  S         S
0641 C   52                MOVE '127'     ERCD,S
0642 C           TAG10A    TAG                             ** TAG10A TAG
0643 C**
0644 C**   END OF VALIDATION, IF NO ERRORS, UPDATE
0645 C           S         COMP 0                    36
0646 C  N36      ERCDS     COMP BLK76                3636
0647 C   36                GOTO END10
0648 C**
0649 C                     EXSR UDLOG
0650 C**
0651 C**   IF SUCCESSFUL EXIT, RETURN SF SCREEN
0652 C   38                EXSR SFOUT
0653 C**
0654 C           END10     ENDSR                           *** END10 ***
0655 C********************************************************************
0656 C**
0657 C**   SUBROUTINE TO PROCESS DELETE SCREEN
0658 C**
0659 C           SR20      BEGSR                           *** SR20 ***
0660 C**
0661 C  NKJ                MOVELMSG,11    ERCDS
0662 C  NKJ                GOTO END20
0663 C**   CCY AND BRANCH CODE
0664 C           INCCY1    COMP CCY                  4646
0665 C   46      S         ADD  1         S
0666 C   46                MOVE '024'     ERCD,S
0667 C**********                                                          S01117
0668 C***37*20**           GOTO BRERRA                                    S01117
0669 C***20*****           Z-ADDDFBR      OPBR                            S01117
0670 C**N20*****           MOVE INBRCH    OPBR                            S01117
0671 C********** OPBR      COMP BRCDA                4545                 S01117
0671 C********** OPBR      COMP BRCDAN               4545                 S01117
0672 C**N45*****           GOTO TAG20A                                    S01117
0673 C********** BRERRA    TAG                             ** BRERRA TAG  S01117
0674 C********** 1         ADD  S         S                               S01117
0675 C**********           MOVE '032'     ERCD,S                          S01117
0676 C********** TAG20A    TAG                                            S01117
0677 C**
0678 C**   IF VALID, UPDATE
0679 C           S         COMP 0                    36
0680 C  N36                EXSR UDLOG
0681 C  N36 38             EXSR SFOUT
0682 C  N36 38             SETON                     65
0683 C           END20     ENDSR
0684 C********************************************************************
0685 C**
0686 C**   SUBROUTINE TO SET INDICATORS TO DISPLAY SF SCREEN
0687 C           SFOUT     BEGSR                           *** SFOUT ***
0688 C**   SPACEFILL SCREEN DETAILS
0689 C                     MOVE 'SF'      SID
0690 C                     MOVE '   '     INBRCH                          S01117
0690 C                     MOVE '      '  INCUSN
0691 C                     MOVE '   '     INCCY2
0692 C**********           MOVE '    '    INACOD                                              CGL029
     C                     MOVE *BLANKS   INACOD                                              CGL029
0693 C                     MOVE '  '      INSEQ
0694 C  N39                MOVE BLK10     INRET
     C/COPY WNCPYSRC,RE0251C011
0695 C  N39                MOVE '   '     INREF
     C/COPY WNCPYSRC,RE0251C012
0696 C  N39                MOVE ' '       INACT
     C                     SETON                     415365
0698 C                     SETOF                     63
0699 C   64                SETON                     54
0700 C   64                SETOF                     62
0701 C  N64                SETON                     62
0702 C  N64                SETOF                     54
0703 C**
0704 C**   IF ACT. CODE IS E, AND F12 NOT ON, DISPLAY
0705 C**   SECOND SCREEN DETAILS
0706 C   39NKL             SETOF                     41
0706 C   64 39NKL          SETOF                     65
0707 C**
0708 C                     ENDSR
0709 C**
0710 C********************************************************************
0711 C**
0712 C**   SUBROUTINE TO SET OFF INDICATORS USED TO BLINK FIELDS
0713 C**   AND RESET ERROR ARRAY, INDEX
0714 C**
0715 C           SETOF     BEGSR                           *** SETOF ***
0716 C                     SETOF                     364056
0717 C                     SETOF                     424344
0718 C                     SETOF                     454647
0719 C                     SETOF                     484950
0720 C                     SETOF                     515257
0721 C                     SETOF                     585939
0722 C                     MOVE '    '    ERCD
0723 C                     Z-ADD0         S
0724 C                     MOVE BLK76     ERCDS
0725 C                     ENDSR
0726 C********************************************************************
0727 C**
0728 C**   SUBROUTINE TO ACCESS STOP CHEQUES FILE RECORD
0729 C**
0730 C           STOCHN    BEGSR                           *** STOCHN **
0731 C**
0732 C**
0733 C                     SETOF                     060708
0734 C                     SETOF                     11
0735 C           KEYS      CHAINSTOPC                34
0736 C**
0737 C                     ENDSR
0738 C********************************************************************
0739 C**
.740 C           UDLOG     BEGSR                           *** UDLOG ***
     C**   IF RPG 01021 ERROR THEN GOTO PROGRAM ERROR HANDLING
     C           STATUS    IFEQ 01021
     C                     Z-ADD0         STATUS  50
     C                     GOTO INFTAG
     C                     END
0741 C                     SETOF                     38    'SUCCESSFUL'IND
0742 C**
0743 C**   IF A DATABASE OR SYSTEM ERROR IS FOUND INDICATORS
0744 C**   ARE SET TO - REFLECT THE ERROR CONDITION, RELEASE
0745 C**   FILES, RELEASE THE SCREEN AND TO END THE PROGRAM.
0746 C**
0749 C**
0750 C**   CHECK STATUS OF RECORD UNCHANGED.
0751 C                     EXSR STOCHN
0752 C**
0753 C  N07                Z-ADD0         LCD
0754 C  N07                MOVE ' '       CHTP
0755 C  N07                Z-ADD0         TNLU
0756 C**
0757 C           LSTC      COMP LSTCS                7979
     C           INFTAG    TAG                             ** INFTAG TAG *
0758 C**
0759 C**   IF RECORD CHANGED, RELEASE FILES, SET ERROR MESSAGE,
0760 C**   SET SCREEN CONTROL INDICATORS AND BYPASS.
0761 C   79                SETON                     76
0762 C   79                EXSR EXCPTN
0763 C   79                MOVELMSG,6     ERCDS
0764 C   79                EXSR MOVER
0765 C   79 03             MOVE LSTC      LSTCS
0766 C   79                GOTO ENDD
0767 C**
     C**  OBTAIN LAST TRANSACTION NUMBER  AND SET UP STANDARD OUTPUT
     C**  INFORMATION
     C                     EXSR ZTNLU1
     C                     MOVE 'RE'      MDID    2
     C                     MOVEL'RE0251'  PGMN    8
     C                     MOVE WSID      WSIDX
     C                     MOVE USRID     USRIDX
     C**
0792 C**
0793 C**   CONVERT INPUT DATES TO A NUMBER OF DAYS FOR OUTPUT
0794 C                     MOVE INDATR    ZDATE
0795 C                     EXSR ZDATE1
0796 C                     Z-ADDZDAYNO    OPDATR  50
0797 C                     MOVE INDATE    ZDATE
0798 C                     EXSR ZDATE1
0799 C                     Z-ADDZDAYNO    OPDATE  50
0800 C**
0801 C**   IF EXPIRY DATE BLANK, SET TO 99999
0802 C   26                Z-ADD99999     OPDATE
0803 C**
0819 C**   UPDATE/ADD STOPC FILE DETAIL RECORD.
0820 C                     SETON                     74
0822 C                     EXSR EXCPTN
     C/COPY WNCPYSRC,RE0251C002
0823 C**
0824 C**
0825 C**   UPDATE STOPC TRAILER
0826 C                     MOVEL'99999999'KEY16  16
0827 C                     MOVE '99999999'KEY16
0828 C*****                MOVE '99'      KEYS                            S01117
     C/COPY WNCPYSRC,RE0251C013
0828 C                     MOVE '99999'   KEYS                            S01117
     C/COPY WNCPYSRC,RE0251C014
0829 C                     MOVELKEY16     KEYS
     C                     MOVE *ALL'9'   KEYS                                                CGL029
0830 C                     EXSR STOCHN
0831 C  N08                MOVELMSG,12    ERCDS
0832 C  N08                GOTO ENDD
0833 C                     EXSR TRLRUP
0834 C**
0846 C**   UPDATE STOPC TRAILER RECORD
0847 C                     SETON                     75
0849 C                     EXSR EXCPTN
0850 C**
0851 C**
0874 C**
     C**  END COMMITMENT CYCLE
     C           CMTTXT    COMIT
     C**
0875 C**   OUTPUT INITIAL SCREEN
0876 C                     SETON                     418265
0877 C**
0878 C**
0879 C**   OBTAIN TIME FOR SCREEN DISPLAY.
0880 C           SCNOUT    TAG                             ** SCNOUT TAG *
0881 C**
0882 C                     EXSR TIME
0883 C                     SETON                     38
0884 C**
0885 C**
0886 C           ENDD      ENDSR
0887 C********************************************************************
0888 C**
0889 C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
0890 C**              CONVERT TO A NUMBER OF DAYS.
0891 C**
0892 C           ZDATE1    BEGSR                           *** ZDATE1 ***
0893 C**
0894 C**   CLEAR DAY NUMBER.
0895 C                     Z-ADD0         ZDAYNO  50
0896 C**
0897 C**   CALCULATION TO DEFINE INPUT DATE FIELD.
0898 C                     Z-ADDZDATE     ZDATE   60
0899 C**
0900 C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
0901 C                     MOVE ZDATE     ZYEAR   20
0902 C  N98                MOVELZDATE     ZDAY    20
0903 C   98                MOVELZDATE     ZMTH    20
0904 C                     MOVE ZDATE     ZWRK4   40
0905 C  N98                MOVELZWRK4     ZMTH
0906 C   98                MOVELZWRK4     ZDAY
0907 C**
0908 C**   ENSURE MONTH IS VALID.
0909 C           ZMTH      COMP 0                      9999
0910 C  N99      ZMTH      COMP 12                   99
0911 C   99                GOTO ZDEND1                     BYPASS IF ERROR
0912 C**
0913 C**   CHECK FOR 30 DAY MONTHS.
0914 C           ZMTH      COMP 4                        90IF 90 ON, 30
0915 C  N90      ZMTH      COMP 6                        90DAY MONTH.
0916 C  N90      ZMTH      COMP 9                        90
0917 C  N90      ZMTH      COMP 11                       90
0918 C**
0919 C**   ENSURE DAY IS VALID.
0920 C           ZDAY      COMP 0                      9999
0921 C   90N99   ZDAY      COMP 30                   99
0922 C  N90N99   ZDAY      COMP 31                   99
0923 C   99                GOTO ZDEND1                     BYPASS IF ERROR
0924 C**
0925 C**   CHECK FOR LEAP YEAR AND FEBRUARY.
0926 C           ZYEAR     ADD  28        ZYEAR
0927 C           ZYEAR     DIV  4         ZLYR    20
0928 C                     MVR            ZLY     10     91LEAP YR, 91 ON
0929 C           ZMTH      COMP 2                    93  92FEB., 92 ON
0930 C**                                                   PAST FEB, 93 ON
0931 C**   IF FEBUARY FURTHER VALIDATE DAY.
0932 C  N91 92   ZDAY      COMP 28                   99
0933 C   91 92   ZDAY      COMP 29                   99
0934 C   99                GOTO ZDEND1                     BYPASS IF ERROR
0935 C**
0936 C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
0937 C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
0938 C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
0939 C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
0940 C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
0941 C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
0942 C**
0943 C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
0944 C**
0945 C**
0946 C********************************************************************
0947 C**
0948 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
0949 C**
0950 C           ZDATE2    BEGSR                           *** ZDATE2 ***
0951 C**
0952 C**   CLEAR DATE FIELDS.
0953 C                     Z-ADD0         ZDATE   60
0954 C                     MOVEL'       ' ZADATE  7
0955 C**
0956 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
0957 C                     Z-ADDZDAYNO    ZDAYNO  50
0958 C**
0959 C**   DETERMINE YEAR NUMBER.
0960 C**
0961 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
0962 C           ZDAYNO    SUB  1         ZDAYN1  50   99
0963 C   99                GOTO ZDEND2
0964 C**
0965 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
0966 C           ZDAYN1    DIV  1461      ZLYR    20
0967 C                     MVR            ZDAYN1           SAVE REMAINING
0968 C**                                                   DAYS
0969 C**   CALCULATE NUMBER OF REMAINING YEARS.
0970 C                     Z-ADD1         ZWRK2   20
0971 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
0972 C           ZDAYN1    COMP ZYDY,ZWRK2             90
0973 C  N90      ZWRK2     ADD  1         ZWRK2
0974 C  N90                GOTO ZDTAG1
0975 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
0976 C**
0977 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
0978 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
0979 C**
0980 C**   CALCULATE ACTUAL YEAR NUMBER.
0981 C           ZLYR      MULT 4         ZWRK3   30
0982 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
0983 C                     Z-ADDZWRK3     ZYEAR   20
0984 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
0985 C**
0986 C**   DETERMINE MONTH NUMBER.
0987 C**
0988 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
0989 C                     SETOF                     9293
0990 C   91      ZDAYN1    COMP 59                     9293
0991 C   91N92   ZDAYN1    SUB  1         ZDAYN1
0992 C**
0993 C**   CALCULATE MONTH NUMBER.
0994 C                     Z-ADD2         ZWRK2
0995 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
0996 C           ZDAYN1    COMP ZMDY,ZWRK2             94
0997 C  N94      ZWRK2     ADD  1         ZWRK2
0998 C  N94                GOTO ZDTAG2
0999 C           ZWRK2     SUB  1         ZWRK2
1000 C**
1001 C                     Z-ADDZWRK2     ZMTH    20       MONTH
1002 C**
1003 C**   DETERMINE DAY OF MONTH.
1004 C**
1005 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
1006 C           ZDAYN1    ADD  1         ZDAYN1
1007 C**
1008 C**   CALCULATE DAY OF MONTH.
1009 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
1010 C**
1011 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
1012 C   93      ZDAY      ADD  1         ZDAY
1013 C**
1014 C**   FORMAT DATE, DDMMYY OR MMDDYY.
1015 C  N98                MOVELZDAY      ZWRK4   40
1016 C   98                MOVE ZDAY      ZWRK4
1017 C  N98                MOVE ZMTH      ZWRK4
1018 C   98                MOVELZMTH      ZWRK4
1019 C                     MOVELZWRK4     ZDATE
1020 C                     MOVE ZYEAR     ZDATE
1021 C**
1022 C**   FORMAT ALPHA DATE, DDMMMYY.
1023 C           ZDAY      COMP 10                     95
1024 C                     MOVELZDAY      ZWRK5   5
1025 C   95                MOVEL' '       ZWRK5
1026 C                     MOVE ZMNM,ZMTH ZWRK5
1027 C                     MOVELZWRK5     ZADATE
1028 C                     MOVE ZYEAR     ZADATE
1029 C**
1030 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
1031 C**
1032 C**
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C   97N93             DO   3
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
     C********************************************************************
1131 C**
0182 C*****ZSYSTM*SR.*TO*CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
0183 C**********                                                          S01194
0184 C********** ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
0185 C**********                                                          S01194
0186 C*****SET*UP*KEY*FOR*INSTALLATION CONTROL RECORD.                    S01194
0187 C**********           MOVEL'01      'ZTABKY 12                       S01194
0188 C**********           MOVE '  10'    ZTABKY                          S01194
0189 C**********                                                          S01194
0190 C********** ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
0191 C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01194
0192 C**********                                                          S01194
0193 C*****CHECK*SYSTEM*DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
0194 C********** DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
0195 C**********                                                          S01194
0196 C**********           ENDSR                                          S01194
1147 C**
1148 C**
1149 C********************************************************************
1150 C**********                                                          S01194
1151 C*****SUBROUTINE*TO*ACCESS*TABLE*FILE*REC                            S01194
1152 C**********                                                          S01194
1153 C********** TABCHN    BEGSR                           *** TABCHN *** S01194
1154 C**********           SETOF                     09                   S01194
1155 C********** TKEY      CHAINTABLE                34                   S01194
1156 C**********           ENDSR                                          S01194
1157 C********************************************************************
1158 C**
1159 C**   SUBROUTINE TO GET CORRECT TIME
1160 C**
1161 C           TIME      BEGSR                           *** TIME ***
1162 C                     TIME           MTIME   60
1163 C                     ENDSR
1164 C********************************************************************
1165 C**
1166 C**   SUBROUTINE TO OUTPUT A REC AND SET OFF INDS
1167 C           EXCPTN    BEGSR                           *** EXCPTN ***
1168 C                     EXCPT
1170 C                     SETOF                     747576
1172 C                     ENDSR
1180 C********************************************************************
1181 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
1182 C*   IND '99' IS SET BY AN OVERFLOW ERROR
1183 C*
1184 CSR         GLZADD    BEGSR                           *** GLZADD ****
1185 C*
1186 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
1187 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
1188 C*
1189 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
1190 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
1191 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
1192 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
1193 C*
1194 CSR                   EXSR GLZSUM
1195 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
1196 C*
1197 C********************************************************************
1198 C**
1199 C**   SUBROUTINE TO MOVE DETAILS FROM STOPC REC TO SCREEN
1200 C**
1201 C           MOVER     BEGSR                           *** MOVER ***
1202 C*****                MOVE BRCD      INBRCH                          S01117
1203 C                     MOVE CCY       INCCY1
1204 C                     Z-ADDDATI      ZDAYNO
1205 C                     EXSR ZDATE2
1206 C                     MOVE ZDATE     INDATR
1207 C                     MOVE FCHQ      INFROM
1208 C                     MOVE TCHQ      INTO
1209 C           FCHQ      COMP 0                        35
1210 C   35                MOVE '        'INFROM
1211 C           TCHQ      COMP 0                        35
1212 C   35                MOVE '        'INTO
1213 C** SET IND FOR DECIMAL POSITION
1214 C********** CDP       COMP 0                        83               S01194
1215 C********** CDP       COMP 1                        84               S01194
1216 C********** CDP       COMP 2                        85               S01194
1217 C********** CDP       COMP 3                        86               S01194
1214 C           A6NBDP    COMP 0                        83               S01194
1215 C           A6NBDP    COMP 1                        84               S01194
1216 C           A6NBDP    COMP 2                        85               S01194
1217 C           A6NBDP    COMP 3                        86               S01194
1218 C                     MOVE STPN      INNAR
1219 C                     Z-ADDEXPD      ZDAYNO
1220 C                     EXSR ZDATE2
1221 C                     MOVE ZDATE     INDATE
1222 C**
1223 C**   IF EXPIRY DATE IS 99999, MOVE BLANKS TO SCREEN
1224 C           EXPD      COMP 99999                    35
1225 C   35                MOVE '      '  INDATE
1226 C**   SET IND FOR ZERO AMOUNT
1227 C           STPA      COMP 0                        55
1228 C                     ENDSR
1229 C********************************************************************
1230 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
1231 C*                        GLZADD, GLZSUB, GLZCMP.
1232 C*          PARAMETERS PASSED -
1233 C*                     I/P ZZAMTI ZZAMTD
1234 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
1235 C*
1236 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
1237 C*
1238 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
1239 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
1240 CSR                   SETOF                     919293
1241 CSR                   SETOF                     949599
1242 C*
1243 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
1244 CSR         ZZAMTI    COMP 0                      9293
1245 CSR 93      ZZAMTD    COMP 0                      9293
1246 CSR 93                GOTO ZZSEND                     ZERO BYPASS
1247 C*
1248 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
1249 CSR         ZZTOTI    COMP 0                      9193
1250 CSR 93      ZZTOTD    COMP 0                      9193
1251 C*
1252 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
1253 CSR 93                Z-ADDZZAMTI    ZZTOTI
1254 CSR 93                Z-ADDZZAMTD    ZZTOTD
1255 CSR 93                GOTO ZZSEND                     ZERO BYPASS
1256 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
1257 CSR 91N92
1258 CORN91 92             GOTO ZZOFPS
1259 C*
1260 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
1261 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
1262 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
1263 C*
1264 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
1265 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
1266 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
1267 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
1268 C*
1269 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
1270 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
1271 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
1272 CSRN99                Z-ADDZZWK2     ZZTOTD
1273 CSRN99                Z-ADDZZWK3     ZZTOTI
1274 C*
1275 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
1276 CSR 99                Z-ADD0         ZZAMT  153
1277 CSR                   GOTO ZZSEND
1278 C*
1279 C* THE 'SIGNS' ARE DIFFERENT
1280 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
1281 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
1282 C*
1283 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
1284 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
1285 C*
1286 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
1287 C*
1288 CSR 91                Z-SUBZZTOTI    ZZTOTI
1289 CSR 91                Z-SUBZZTOTD    ZZTOTD
1290 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
1291 C*
1292 CSR         ZZTOTI    COMP ZZAMTI               93  95
1293 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
1294 C*
1295 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
1296 CSR 95                Z-ADD0         ZZTOTI
1297 CSR 95                Z-ADD0         ZZTOTD
1298 CSR 95                GOTO ZZSEND
1299 C*
1300 C* IF ZZTOT GT. ZZAMT.
1301 CSR 93      ZZAMTD    COMP ZZTOTD               94
1302 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
1303 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
1304 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
1305 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
1306 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
1307 C*
1308 C*
1309 C* IF ZZAMT GT. ZZTOT.
1310 CSRN93      ZZTOTD    COMP ZZAMTD               94
1311 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
1312 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
1313 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
1314 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
1315 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
1316 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
1317 C*
1318 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
1319 CSR                   SETOF                     94
1320 CSR 93 91
1321 CORN93 92             SETON                     94
1322 CSR 94                Z-SUBZZTOTI    ZZTOTI
1323 CSR 94                Z-SUBZZTOTD    ZZTOTD
1324 C**
1325 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
1326 CSR 92                Z-SUBZZAMTI    ZZAMTI
1327 CSR 92                Z-SUBZZAMTD    ZZAMTD
1328 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
1329 C**
1330 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
1331 CSR                   SETOF                     96
1332 CSR         ZZTOTD    COMP 0                        91
1333 CSR 91      ZZTOTI    COMP 0                      96
1334 CSR 96                MOVE '.000-'   ZZNEGD  5
1335 CSR                   ENDSR                             ** ENDSR **
1336 C********************************************************************
1337 C**
1338 C**   SUBROUTINE TO PUT OUT ERROR SCREEN
1339 C           DSERR     BEGSR                           *** DSERR ***
1340 C                     SETON                     LR
1341 C                     EXSR EXCPTN
1342 C                     ENDSR
1343 C********************************************************************
1344 C**
1345 C**   SUBROUTINE TO UPDATE DETAILS ON STOPC TRAILER
1346 C           TRLRUP    BEGSR                           *** TRLRUP ***
1354 C                     SETOF                     80                   E16111
1347 C   02      1         ADD  NSQI      NSQI
1348 C   03      1         ADD  NSQA      NSQA
1349 C   04      1         ADD  NSQD      NSQD
1350 C                     MOVE OSTOP     ZZAMT
1351 C   02                MOVE VQIW      ZZTOTI
1352 C   02                MOVE VQID      ZZTOTD
1354 C   03      STPA      IFGE OSTOP                                     E16111
1354 C                     SETON                     80                   E16111
1354 C                     END                                            E16111
1353 C***03******          Z-SUBSTPA      HOLD   150       REVERSE OUT    E16111
1353 C   03 80             Z-ADDSTPA      HOLD   150       REVERSE OUT    E16111
1353 C   03N80             Z-SUBSTPA      HOLD   150                      E16111
1354 C   03                MOVE HOLD      ZZAMT            OLD AMOUNT
1355 C   03                MOVE VQAW      ZZTOTI
1356 C   03                MOVE VQAD      ZZTOTD
1357 C   03                EXSR GLZADD
1353 C   80                Z-SUBOSTOP     OSTOP                           E16111
1358 C                     MOVE OSTOP     ZZAMT
1359 C   04                MOVE STPA      ZZAMT
1360 C   04                MOVE VQDW      ZZTOTI
1361 C   04                MOVE VQDD      ZZTOTD
1362 C                     EXSR GLZADD
1363 C   02                MOVE ZZTOTI    VQIW
1364 C   02                MOVE ZZTOTD    VQID
1365 C   03                MOVE ZZTOTI    VQAW
1366 C   03                MOVE ZZTOTD    VQAD
1367 C   04                MOVE ZZTOTI    VQDW
1368 C   04                MOVE ZZTOTD    VQDD
1369 C   02      NSAU      ADD  1         NSAU
1370 C   04      NSAU      SUB  1         NSAU
1371 C**
1372 C**   UPDATE VALUE OF STOPPED CHEQUES AFTER UPDATE
1373 C                     MOVE VQUW      ZZTOTI
1374 C                     MOVE VQUD      ZZTOTD
1375 C   02                MOVE OSTOP     ZZAMT
1376 C   02                EXSR GLZADD
1353 C   03 80             Z-SUBHOLD      HOLD                            E16111
1377 C   03                MOVE HOLD      ZZAMT            REVERSE OUT
1378 C   03                EXSR GLZADD                     OLD AMOUNT
1353 C   03 80             Z-SUBOSTOP     OSTOP                           E16111
1379 C   03                MOVE OSTOP     ZZAMT
1380 C   03                EXSR GLZADD
1381 C   04                Z-SUBSTPA      HOLD
1382 C   04                MOVE HOLD      ZZAMT
1383 C   04                EXSR GLZADD
1384 C                     Z-ADDZZTOTI    VQUW
1385 C                     Z-ADDZZTOTD    VQUD
1386 C                     Z-ADDNATN      TNLU
1387 C                     Z-ADDRUND      LCD
1388 C                     ENDSR
     C*****************************************************************
     C*
     C*   ZTNLU1 SR. - TO LOCK THE TRANSACTION NUMBER DATA AREA AND
     C*                THEN UPDATE AND RELEASE THE DATA AREA.
     C*
     C           ZTNLU1    BEGSR
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C                     ENDSR
     C*****************************************************************
     C**   FILE EXEPTION/ERROR HANDLING SUBROUTINE
     C**
     C           INFSR     BEGSR
     C**   CHECK ERROR TYPE
     C           STATUS    IFEQ 01021
     C**   CHAIN TO FILE TO GET CURRENT DETAILS
     C           KEYS      CHAINSTOPC                34
     C**
     C           *IN34     IFEQ '0'
     C**   ROLL BACK UPDATES ALREADY DONE
     C                     ROLBK
     C**   SET ON 'RECORD UPDATED BY ANOTHER WORKSTATION' INDICATOR
     C                     SETON                     79
     C**   RESET OTHER INDICATORS
     C                     SETOF                     747576
     C**
     C                     MOVEL'*DETC'   EXTTAG  6
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ENDSREXTTAG
     C**
     C/COPY WNCPYSRC,RE0251C003
1389 C********************************************************************
     C/EJECT
1390 ORE0251FMD        60NKC
1392 O                                   K8 'RE0251F1'
1393 O                         SID        2
1394 O                         MTIME     10 '  .  .  '
1395 O                         WSID      13
1396 O*****                    OPACOD    31                               S01117
1396 O**********          37   OPACOD    35                                            S01117 CGL029
1396 O**********         N37   OPACD2    53                                            S01117 CGL029
     O                    37   OPACOD    41                                                   CGL029
     O                   N37   OPACD2    65                                                   CGL029
1397 O*****                    INRET     41                               S01117
1397 O**********               INRET     63                                            S01117 CGL029
     O                         INRET     75                                                   CGL029
1398 O*****               01 KJSAVRET    41                               S01117
1398 O**********          01 KJSAVRET    63                                            S01117 CGL029
     O                    01 KJSAVRET    75                                                   CGL029
1399 O*****                    INREF     44                               S01117
     O/COPY WNCPYSRC,RE0251O001
1399 O**********               INREF     66                                            S01117 CGL029
     O                         INREF     78                                                   CGL029
1400 O*****                    INACT     45                               S01117
1400 O**********               INACT     67                                            S01117 CGL029
     O                         INACT     79                                                   CGL029
1401 O*****                    INBRCH    48                               S01117
1402 O*****                    INCCY1    51                               S01117
1402 O**********               INCCY1    70                         S01117076550
1403 O**********               INDATR    57                               S01117
1403 O**********               INDATR    76                                            S01117 CGL029
     O                         INDATR   108                                                   CGL029
1404 O**********               INFROM    65                               S01117
1404 O**********               INFROM    84                         S01117076550
1405 O**********               INTO      73                               S01117
1405 O**********               INTO      92                         S01117076550
1406 O**********               INSTOP    87                               S01117
1406 O**********               INSTOP   106                         S01117076550
1407 O**********          07 83STPA      87 '           0 '               S01117
1407 O**********          07 83STPA     106 '           0 '         S01117076550
1408 O**********          07 84STPA      87 '          0 . '              S01117
1408 O**********          07 84STPA     106 '          0 . '        S01117076550
1409 O**********          07 85STPA      87 '         0 .  '              S01117
1409 O**********          07 85STPA     106 '         0 .  '        S01117076550
1410 O**********          07 86STPA      87 '        0 .   '              S01117
1410 O**********          07 86STPA     106 '        0 .   '        S01117076550
1411 O**********          07 55BLK14     87                               S01117
1411 O**********          07 55BLK14    106                         S01117076550
1412 O**********               INNAR    107                               S01117
1412 O**********               INNAR    126                         S01117076550
1413 O**********               INDATE   113                               S01117
1413 O**********               INDATE   132                         S01117076550
1414 O**********             41BLK100   113                               S01117
1414 O**********             41BLK100   132                         S01117076550
1415 O**********             78BLK68    113                               S01117
1415 O**********             78BLK65    132                         S01117076550
1416 O**********               ERCDS    189                               S01117
1416 O**********               ERCDS    208                         S01117076550
1401 O**********               INBRCH   211                         S01117076550
1417 O**********               INCUSN   195                               S01117
1417 O**********               INCUSN   217                         S01117076550
1418 O**********               INCCY2   198                               S01117
1418 O**********               INCCY2   220                         S01117076550
1419 O**********               INACOD   202                               S01117
1419 O**********               INACOD   224                         S01117076550
1420 O**********               INSEQ    204                               S01117
1420 O**********               INSEQ    226                         S01117076550
1421 O**********               INRET    214                               S01117
1421 O**********               INRET    236                         S01117076550
1422 O**********               INREF    217                               S01117
1422 O**********               INREF    239                         S01117076550
1423 O**********               INACT    218                               S01117
1423 O**********               INACT    240                         S01117076550
1424 O**********             39BLK14    218                               S01117
1424 O**********             39BLK14    240                         S01117076550
     O**********               IANAM     87                                            076550 CGL029
     O**********          01 KJSAVANM    87                                            076550 CGL029
     O**********               INCCY1    90                                            076550 CGL029
     O**********               INDATR    96                                            076550 CGL029
1404 O**********               INFROM   104                                            076550 CGL029
1405 O**********               INTO     112                                            076550 CGL029
1406 O**********               INSTOP   126                                            076550 CGL029
1407 O**********          07 83STPA     126 '           0 '                            076550 CGL029
1408 O**********          07 84STPA     126 '          0 . '                           076550 CGL029
1409 O**********          07 85STPA     126 '         0 .  '                           076550 CGL029
1410 O**********          07 86STPA     126 '        0 .   '                           076550 CGL029
1411 O**********          07 55BLK14    126                                            076550 CGL029
1412 O**********               INNAR    146                                            076550 CGL029
1413 O**********               INDATE   152                                            076550 CGL029
1414 O**********             41BLK100   152                                            076550 CGL029
1415 O**********             78BLK65    152                                            076550 CGL029
1416 O**********               ERCDS    228                                            076550 CGL029
1401 O**********               INBRCH   231                                            076550 CGL029
1417 O**********               INCUSN   237                                            076550 CGL029
1418 O**********               INCCY2   240                                            076550 CGL029
1419 O**********               INACOD   244                                            076550 CGL029
1420 O**********               INSEQ    246                                            076550 CGL029
1421 O**********               INRET    256                                            076550 CGL029
1422 O**********               INREF    259                                            076550 CGL029
1423 O**********               INACT    260                                            076550 CGL029
1424 O**********             39BLK14    260                                            076550 CGL029
     O                         IANAM     99                                                   CGL029
     O                    01 KJSAVANM    99                                                   CGL029
     O                         INCCY1   102                                                   CGL029
     O                         INDATR   108                                                   CGL029
     O                         INFROM   116                                                   CGL029
     O                         INTO     124                                                   CGL029
     O                         INSTOP   138                                                   CGL029
     O                    07 83STPA     138 '           0 '                                   CGL029
     O                    07 84STPA     138 '          0 . '                                  CGL029
     O                    07 85STPA     138 '         0 .  '                                  CGL029
     O                    07 86STPA     138 '        0 .   '                                  CGL029
     O                    07 55BLK14    138                                                   CGL029
     O                         INNAR    158                                                   CGL029
     O                         INDATE   164                                                   CGL029
     O                       41BLK100   164                                                   CGL029
     O                       78BLK65    164                                                   CGL029
     O                         ERCDS    240                                                   CGL029
     O                         INBRCH   243                                                   CGL029
     O                         INCUSN   249                                                   CGL029
     O                         INCCY2   252                                                   CGL029
     O                         INACOD   262                                                   CGL029
     O                         INSEQ    264                                                   CGL029
     O                         INRET    274                                                   CGL029
     O                         INREF    277                                                   CGL029
     O                         INACT    278                                                   CGL029
     O                       39BLK14    278                                                   CGL029
     O/COPY WNCPYSRC,RE0251O002
1431 O**
1547 O**
1548 O**   STOPC FILE - DETAIL REC
1549 OSTOPC   E        74 11
1550 O       OR        74 07
1551 O                                    1 'D'
1552 O                 04                 1 '*'
1553 O                         CNUMA      7
1554 O                         CCYA      10
1555 O**********               ACODA     14                                                   CGL029
1556 O                         ACSQA     16
1557 O                       30          16 '01'
1558 O                      N31ACSQB     16
     O/COPY WNCPYSRC,RE0251O003
1559 O                      N04INREF     19
     O/COPY WNCPYSRC,RE0251O004
1560 O                      N04INRET     29
1561 O                      N04OPBR      32
1562 O                      N04INFROM    40
1563 O                      N04INTO      48
1564 O                      N04OSTOP     55P
1565 O                      N04OPDATR    58P
1566 O                      N04INNAR     78
1567 O                      N04OPDATE    81P
1568 O                         RUND      92P
1569 O                         INACT     93
1570 O                         NATN      96P
     O                         ACODA    106                                                   CGL029
     O                         EUSER    171                                                   CAP201
     O                         TMSTP    197                                                   CAP201
     O                         FROID    217                                                   CAP201
     O                         RPRLOC   218                                                   CAP201
     O                         INSTMP   244                                                 BUG27627
     O/COPY WNCPYSRC,RE0251O005
1592 O**   STOPC FILE - TRAILER REC
1593 O        E        75
1594 O                         NOSQ      22P
1595 O                         VQW       30P
1596 O                         VQD       32P
1594 O                         NSQI      34P
1595 O                         NSQA      36P
1596 O                         NSQD      38P
1597 O                         VQIW      46P
1598 O                         VQID      48P
1599 O                         VQAW      56P
1600 O                         VQAD      58P
1601 O                         VQDW      66P
1602 O                         VQDD      68P
1603 O                         NSAU      71P
1604 O                         VQUW      79P
1605 O                         VQUD      81P
1606 O                         RUND      84P
1607 O                         TNLU      87P
     O**  RELEASE STOPC
1593 O        E        76
     O**
1571 OSTOPCSD EADD     74N11N07
1572 O                                    1 'D'
1573 O                         CNUMA      7
1574 O                         CCYA      10
1575 O**********               ACODA     14                                                   CGL029
1576 O                         ACSQA     16
1577 O                       30          16 '01'
1578 O                      N31ACSQB     16
     O/COPY WNCPYSRC,RE0251O006
1579 O                         INREF     19
     O/COPY WNCPYSRC,RE0251O007
1580 O                         INRET     29
1581 O                         OPBR      32
1582 O                         INFROM    40
1583 O                         INTO      48
1584 O                         OSTOP     55P
1585 O                         OPDATR    58P
1586 O                         INNAR     78
1587 O                         OPDATE    81P
1588 O                         RUND      92P
1589 O                         INACT     93
1590 O                         NATN      96P
     O                         ACODA    106                                                   CGL029
     O                         EUSER    171                                                   CAP201
     O                         TMSTP    197                                                   CAP201
     O                         FROID    217                                                   CAP201
     O                         RPRLOC   218                                                   CAP201
     O                         INSTMP   244                                                 BUG27627
     O/COPY WNCPYSRC,RE0251O008
1591 O**
      *BHF638 CHANGED MSG 11 FROM INVALID KEY
** MSG
128 ACCOUNT DOES NOT EXIST                                        1
001 INVALID COMMAND KEY                                           2
002 INVALID INPUT                                                 3
012 INVALID ACTION CODE                                           4
013 UNABLE TO UPDATE - LOAD RECOVERY PROCEDURE                    5
014 INVALID UPDATE - THIS RECORD HAS SINCE BEEN UPDATED           6
016 RECORD ALREADY EXISTS                                         7
017 RECORD NOT FOUND                                              8
020 LOG FILE FULL ***THIS MESSAGE IS OBSOLETE****                 9
104 INVALID REFERENCE NUMBER                                     10
PRESS F10 TO DELETE                                              11
NO TRAILER ON STOPC FILE                                         12
086 ACCOUNT CLOSED                                               13
302 USER NOT AUTHORISED TO ACTION CODE FOR THIS MENU ITEM        14
303 USER NOT AUTHORISED TO ANY ACTION CODE FOR THIS ITEM & BRANCH15
304 USER NOT AUTHORISED TO ACTION CODE FOR THIS ITEM & BRANCH    16
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
