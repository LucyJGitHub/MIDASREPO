     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Held items maintenance')                      *
0001 H***********
0002 F*****************************************************************
0004 F*                                                               *
     A*  Midas Retail Module                                          *
0004 F*                                                               *
0005 F*  RE0252 - HELD ITEMS MAINTENANCE                              *
0006 F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*      1990, 1993                                               *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD034451C          Date 02Mar16               *
      *                 MD030959           Date 17Jun15               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG27532           Date 26Apr10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3584            Date 28Jul04               *
      *                 BUG2963            Date 28May04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2304            Date 30Apr04               *
      *                 CAAA03             Date 19Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CSF002             Date 11Aug03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 02MAR99               *
      *                 CTI002             DATE 09Sep98               *
     F*                 S01408             DATE 18APR96               *
     F*                 S01408             DATE 03AUG95               *
     F*                 S01408             DATE 05JUN95               *
     F*                 S01408             DATE 06MAR95               *
     F*                 S01413                  13APR93               *
     F*                 S01449                  07DEC93               *
     F*                 S01314                  20FEB91               *
     F*                 E22370                  13JUN90               *
     F*                 BHF668                  20SEP90               *
     F*                 BHF669                  20SEP90               *
     F*                 BHF528                  11SEP90               *
     F*                 LN0083                  02MAY90               *
     F*                 S01194                  20FEB90               *
     F*                 S01199                  15FEB90               *
     F*                 S01117                  21FEB90               *
     F*                 E81040                  10SEP86               *
0010 F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  MD034451C - API: Repeated Held Item reversals are allowed.   *
      *              Increase record length for HELDIHB.              *
      *  MD030959 - Recompiled due to changed PF/HELDIHC.             *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  BUG27532 - Several fields are blank in the confirmation page *
      *             (Recompile)                                       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3584 - Increase the size of the file control fields.      *
      *  BUG2963 - Wrong 10-digit account code is being save to       *
      *            HELDIHB during insert.  This is the reason why     *
      *            newly inserted held items cannot be enquired.      *
      *            Increase length of WHLDKY to 15 to solve problem.  *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2304 - Various file layout changes. Recompile.            *
      *  CAAA03 - Webfacing Changes (recompile)                       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSF002 - Global layer.                                       *
      *           - Remove unused ZMITEM layout.                      *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  S01408 - Addition of core hook RE0252EEP2                    *
     F*           Addition of core hook RE0252EEP1                    *
     F*           Addition of core hook RE0252IIP2                    *
     F*           Addition of core hook RE0252CCP3                    *
     F*           Addition of core hook RE0252CCP4                    *
     F*           Addition of core hook RE0252CCP5                    *
     F*           Addition of core hook RE0252CCP6                    *
     F*           Addition of core hook RE0252CCP7                    *
     F*           Addition of core hook RE0252CCP8                    *
     F*           Addition of core hook RE0252CCP9                    *
     F*           Addition of core hook RE0252CP10                    *
     F*           Addition of core hook RE0252CP11                    *
     F*           Addition of core hook RE0252CP12                    *
     F*           Addition of core hook RE0252OOP1                    *
     F*           Addition of core hook RE0252OOP2                    *
     F*           Addition of core hook RE0252OOP3                    *
     F*  S01408 - Addition of core hook RE0252CCP2                    *
     F*  S01408 - Addition of core hook RE0252CCP1                    *
     F*  S01408 - Addition of core hook RE0252FFPG                    *
     F*           Addition of core hook RE0252IIPG                    *
     F*           Addition of core hook RE0252GDTA                    *
     F*           Addition of core hook RE0252IIP1                    *
     F*           Addition of core hook RE0252CCPG                    *
     F*           Addition of core hook RE0252CPCR                    *
     F*           Addition of core hook RE0252CVSF                    *
     F*           Addition of core hook RE0252CVSR                    *
     F*           Addition of core hook RE0252CVS1                    *
     F*           Addition of core hook RE0252CVS2                    *
     F*           Addition of core hook RE0252CVS3                    *
     F*           Addition of core hook RE0252CVS4                    *
     F*           Addition of core hook RE0252CADU                    *
     F*  S01413 - Retail 3 Incorporation                              *
     F*         - Recompiled over amended display file                *
     F*                                                               *  *
     F*  S01449 - Autorecs II - Recompile for change to ACCNTAB       *  *
     F*                                                               *
     F*  S01314 - Changes made for PTF incorporation (S01199 was not  *
     F*           fully applied)                                      *
     F*                                                               *
     F*  E22370 - Recompiled over amended display file                *
     F*                                                               *
     F*  BHF668 - Insufficient validation of fields entered on ini-   *
     F*           tial screen caused errors in chain to ACNUM         *
     F*                                                               *
     F*  BHF669 - Delete screen did not show 'F10 to delete'          *
     F*                                                               *
     F*  BHF528 - Program was chaining to LF/ACCNT with a blank CCY   *
     F*           in the key                                          *
     F*                                                               *
     F*  LN0083 - New standing data file processing added             *
     F*         - Correction of error messages                        *
     F*                                                               *
     F*  S01194 - Standing data changes                               *
     F*                                                               *
     F*  S01199 - HELP changes                                        *
     F*                                                               *
     F*  S01117 - Multibranching                                      *
0010 F*                                                               *
     F*  E81040 - Bypass compare of BRCD and DFBR if DFBR is zero     *
0010 F*                                                               *
0011 F*****************************************************************
0010 F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
0010 F*                                                                  *
0011 F********************************************************************
0014 F*E0252FMCF  F     294            WORKSTN                            S01117
0014 F***RE0252FMCF  F     295            WORKSTN                                      S01117 CGL029
     FRE0252FMCF  F     313            WORKSTN                                                CGL029
0020 F***ACNUM** IF  F      40 10AI     2 DISK                                                CGL029
     FACNUM   IF  F      46 10AI     2 DISK                                                   CGL029
0016 F*ABLE***IF**F      96 12AI     2 DISK                               S01194
0019 F*CCNT   UF  F     400 15AI     2 DISK                               S01117
0019 F***ACCNT** UF  F     400 18AI     2 DISK                                         S01117 CGL029
     FACCNT   UF  F     573 24AI     2 DISK                                                   CGL029
     F                                              KCOMIT
0021 F*ELDI***UF* F      80 18AI     2 DISK                               S01117
0021 F***HELDIL1 UF  F      80 21AI     2 DISK                                         S01117 CGL029
     F***HELDIL1 UF  F      90 27AI     2 DISK                                        CGL029 BUG3584
     F***HELDIL1 UF  F     102 27AI     2 DISK                                     BUG3584 MD034451C
     FHELDIL1 UF  F     117 27AI     2 DISK                                                MD034451C
     F                                              KCOMIT
0021 F***HELDIHB O   F      80            DISK                                                CGL029
     F***HELDIHB O   F      90            DISK                                      CGL029 MD034451C
     FHELDIHB O   F     117            DISK                                                MD034451C
     F                                              KCOMIT
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     F*                                                                   S01408
     F/COPY WNCPYSRC,RE0252FFPG                                           S01408
     F*                                                                   S01408
0022 F*
0023 F*    FUNCTION OF INDICATORS.
0024 F* ID F  C  H  L
0025 F* 01            WRKSTN - 'SF' SCREEN.
0026 F* 02            WRKSTN - 'SI' SCREEN.
0026 F* 17            WRKSTN - 'SA' SCREEN.
0027 F* 03            WRKSTN - 'SD' SCREEN.
0028 F* 04            WRKSTN - 'SI' SCREEN.
0029 F* 05            TABLE - CURRENCIES RECORD 1.
0012 F*          06   USED TO CONDITION FIRST CALC CYCLE                *
0033 F* 10            ACCNT - DETAIL RECORD.
0034 F* 11            ACNUM - DETAIL RECORD.
0035 F**12*******     HELDI - DETAIL RECORD.                              S01117
0035 F* 12            HELDIL1 - DETAIL RECORD.                            S01117
0036 F**13*******     HELDI - TRAILER.                                    S01117
0036 F* 13            HELDIL1 - TRAILER.                                  S01117
0013 F*          15   SET ON IF ERROR DURING READ FROM THE WORK STATION *
     F***********     HELP INDICATOR                                      S01199
0037 F*          20   HELD CURRENCY HAS - 0 D.P.
0038 F*          21                     - 1 D.P.
0039 F*          22                     - 2 D.P.
0040 F*          23                     - 3 D.P.
0041 F*          24   POSITION CURSOR ON RETAIL A/C NO.
0042 F*          25   DO NOT ALLOW ENTRY OF A/C NO.
0043 F*          26   DO NOT ALLOW ENTRY OF RETAIL A/C NO.
0044 F*          28   POSITION CURSOR ON CUSTOMER NO.
0045 F*          30   ERROR IN INPUT DATA
0046 F*    31         CUSTOMER NUMBER BLANK.
0047 F*    32         CURRENCY BLANK.
0048 F*    33         ACCOUNT CODE BLANK.
0049 F*    34         ACCOUNT SEQUENCE BLANK.
0050 F*    35         RETAIL ACCOUNT NUMBER BLANK.
0051 F*    36         DEFAULT BRANCH NUMBER BLANK.
0052 F*    37         BRANCH NUMBER BLANK.
0053 F*    38         NARRATIVE BLANK.
0054 F*    51         ACCOUNT STATUS BLANK.
0055 F*       39      FIRST CYCLE PROCESSING COMPLETE.
0056 F*       40      RELEASE WORKSTATION.
0057 F*       41        OUTPUT 'SF' SCREEN.
0058 F*       42      PASS 'SF' FIELDS TO OUTPUT BUFFER.
0059 F*       43      PASS NON-'SF' FIELDS TO OUTPUT BUFFER.
0060 F*       45      BRANCH CODE NOT ENTERED
0063 F***********48   RELEASE HELDI                                       S01117
0063 F*          48   RELEASE HELDIL1                                     S01117
0064 F*          49   PROTECT FIELDS
0065 F*          52   ACTION CODE IS I
0065 F*          81                  A
0066 F*          53                  D
0067 F*          54                  E
0068 F*          55   INVALID ACTION CODE
0069 F*          56   BLINK RETAIL A/C NO. LABEL
0070 F*          57   BLINK REFERENCE NO. LABEL
0071 F*          58   BLINK A/C NO.LABEL
0072 F*          59   RETAIL A/C NO. MUST BE ENTERED
0073 F*          60   A/C NO. MUST BE ENTERED
0074 F*          61   BLINK HELD CURRENCY LABEL
0075 F*          62   BLINK HELD NARRATIVE LABEL
0076 F*          63   BLINK EXPIRY DATE LABEL
0077 F*          64   PROTECT FIELDS
0078 F*          65   BLINK HELD AMOUNT LABEL
0079 F*          66   NON-DISPLAY I/D/E SCREEN LABELS
0080 F*       67      NON-DISPLAY A/C NO.LABEL
0081 F*       68      NONDISPLAY RETAIL A/C NO.LABEL
0082 F*       69      NON-DISPLAY INITIAL SCREEN LABELS
0084 F*       71      UPDATE A/C MASTER DETAIL
     F*
     F********72*     MULTIBRANCH FLAG SET TO N                           S01117
     F*       72      MULTIBRANCH FLAG SET TO Y                           S01117
     F*
0085 F********73*     UPDATE HELDI TRAILER                                S01117
0085 F*       73      UPDATE HELDIL1 TRAILER                              S01117
0087 F*       75      RELEASE A/C MASTER FILE
0088 F********76*     CHAIN FAIL ON HELDI                                 S01117
0088 F*       76      CHAIN FAIL ON HELDIL1                               S01117
0089 F********77*     CHAIN FAIL ON TABLE                                 S01194
0091 F*       79      RECORD NOT UPDATED BY ANOTHER WORK STATION
0092 F*       83      NON-DISPLAY ERROR CODES
0093 F*       84      NON-DISPLAY ERROR MESSAGES
0094 F*       87      CHAIN FAIL ON ACNUM
0095 F*       88      CHAIN FAIL ON ACCNT
0096 E*****               ERRMSG  1   8 47               ERROR MESSAGES.  LN0083
     E*                                                                   S01408
     E/COPY WNCPYSRC,RE0252EEP1                                           S01408
     E*                                                                   S01408
0096 E                    ERRMSG  1  11 76               ERROR MESSAGES.  LN0083
     E*                                                                   S01408
     E/COPY WNCPYSRC,RE0252EEP2                                           S01408
     E*                                                                   S01408
0097 E*
0098 E**********          ERCD        6  4               ERROR CODE OUTPUTS01117
0098 E                    ERCD       19  4               ERROR CODE OUTPUTS01117
0099 E*
0100 E                    ZA1        16  1               ZALIGN SR. ARRAY
0101 E*
0102 E                    ZA2        16  1               ZALIGN SR. ARRAY
0103 E*
0104 E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
0105 E*
0106 E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
0107 E**
0108 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
0109 E**
     E                    CPY@    1   1 80
     E/EJECT
0110 I*
0111 I*    WORKSTATION FILE.
0112 I*
0113 IRE0252FMNS  01   1 CS   2 CF
0114 I       OR   02   1 CS   2 CI
0114 I       OR   17   1 CS   2 CA
0115 I       OR   03   1 CS   2 CD
0116 I       OR   04   1 CS   2 CE
0117 I*****                                   3   5 BNCHSF                S01117
0117 I*****                                   3   50BNCH                  S01117
0118 I*****                                   6   8 CCYI                  S01117
0118 I                                        3   5 CCYI                  S01117
0119 I*****                                   9  22 HELD                  S01117
0119 I                                        6  19 HELD                  S01117
0120 I*****                                  23  28 EXPD                  S01117
0120 I                                       20  25 EXPD                  S01117
0121 I*****                                  29  48 HLDN            38    S01117
0121 I                                       26  45 HLDN            38    S01117
0117 I                                       46  48 BNCHSF                S01117
0122 I                                       49  540CNUM            31
0122 I                                       49  54 CNUMA                 LN0083
0123 I                                       55  57 CCYSF           32
0124 I**********                             58  610ACOD            33                        CGL029
0124 I**********                             58  61 ACODA                              LN0083 CGL029
0125 I**********                             62  630ACSQ            34                        CGL029
0126 I**********                             49  63 ACNKEY                                    CGL029
0127 I**********                             64  73 RACNO           35                        CGL029
0128 I**********                             74  760REFNO                                     CGL029
0129 I**********                             74  76 XREFNO                                    CGL029
0130 I**********                             77  77 ACT                                       CGL029
0131 I**********                              1  77 LOTSCN                                    CGL029
     I                                       58  670ACOD            33                        CGL029
     I                                       58  67 ACODA                                     CGL029
     I                                       68  690ACSQ            34                        CGL029
     I                                       49  69 ACNKEY                                    CGL029
     I                                       70  79 RACNO           35                        CGL029
     I                                       80  820REFNO                                     CGL029
     I                                       80  82 XREFNO                                    CGL029
     I                                       83  83 ACT                                       CGL029
     I                                        1  83 LOTSCN                                    CGL029
0132 I*****                                  49  77 SFFL                  S01117
0132 I**********                             46  77 SFFL                               S01117 CGL029
     I                                       46  83 SFFL                                      CGL029
0133 I*
0134 I*    CATCHALL.
0135 I        NS
0136 I**********                                                          S01194
0137 I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 1.               S01194
0138 I**********                                                          S01194
0139 I*ABLE***NS       2 C0   3 C1  12 C1                                 S01194
0140 I*******AND      13 C0                                               S01194
0141 I**********                              1   1 RECI                  S01194
0142 I**********                              2   30RECT                  S01194
0143 I**********                             12  130RCDE                  S01194
0144 I**********                             14  66 TITL                  S01194
0145 I***********                            67  67 DATF                  S01117
0146 I***********                            68  700DFBR            36    S01117
0147 I**********                             74  74 MODI1                 S01194
0148 I**********                             75  75 MODI2                 S01194
0149 I**********                             76  76 MODI3                 S01194
0150 I***********                         P  77  790RUND                  S01117
0151 I***********                            80  86 RUNA                  S01117
0152 I**********                             87  870SFLG                  S01194
0153 I**********                          P  90  920LCD                   S01194
0154 I**********                             93  93 CHTP                  S01194
0155 I**********                          P  94  960TNLU                  S01194
0156 I**********                              1  96 LOT                   S01194
0157 I**********                                                          S01194
0158 I*****TABLE FILE - INSTALLATION CONTROL DATA RECORD 3.               S01194
0159 I**********                                                          S01194
0160 I********NS       1 CD   2 C0   3 C1                                 S01194
0161 I*******AND      12 C2  13 C0                                        S01194
0162 I**********                              1   1 RECI                  S01194
0163 I**********                              2   30RECT                  S01194
0164 I**********                             12  130RCDE                  S01194
0165 I**********                             14  170COMS                  S01194
0166 I**********                             18  210CADC                  S01194
0167 I**********                          P  22  240MDIC                  S01194
0168 I**********                          P  25  270MCIC                  S01194
0169 I**********                          P  28  300MDIA                  S01194
0170 I**********                          P  31  330MCIA                  S01194
0171 I**********                             34  370SRPL                  S01194
0172 I**********                             38  410SPAC                  S01194
0173 I**********                             42  450SWAC                  S01194
0174 I**********                             46  490FTAC                  S01194
0175 I**********                             50  530TAC4                  S01194
0176 I**********                             54  570TAC5                  S01194
0177 I**********                          P  63  650NOBA                  S01194
0178 I**********                          P  66  680TSIZ                  S01194
0179 I**********                             69  69 RACN                  S01194
0180 I**********                             70  700GLSI                  S01194
0181 I**********                             71  710RTSI                  S01194
0182 I**********                             72  720DLSI                  S01194
0183 I**********                             73  730NOSI                  S01194
0184 I**********                             74  740CTSI                  S01194
0185 I**********                          P  90  920LCD                   S01194
0186 I**********                             93  93 CHTP                  S01194
0187 I**********                          P  94  960TNLU                  S01194
0188 I**********                              1  96 LOT                   S01194
0189 I**********                                                          S01194
0190 I**********                                                          S01194
0191 I*****TABLE FILE - CURRENCIES RECORD 1.                              S01194
0192 I**********                                                          S01194
0193 I********NS  05   1 CD   2 C2   3 C0                                 S01194
0194 I*******AND      13 C1                                               S01194
0195 I**********                              1   1 RECI                  S01194
0196 I**********                              2   30RECT                  S01194
0197 I**********                             10  12 CCY                   S01194
0198 I**********                             13  130SREC                  S01194
0199 I**********                             14  27 CCNM                  S01194
0200 I**********                          P  28  348SPOT                  S01194
0201 I**********                             38  380CDP                   S01194
0202 I**********                             39  390TNOT                  S01194
0203 I**********                             40  40 DCCY                  S01194
0204 I**********                             41  44 SRC1                  S01194
0205 I**********                             45  48 SRC2                  S01194
0206 I**********                             49  520TACC                  S01194
0207 I**********                             53  560TEQV                  S01194
0208 I**********                             57  600SWQV                  S01194
0209 I**********                             61  640TAC4                  S01194
0210 I**********                             65  680TAC5                  S01194
0211 I**********                             69  69 HIND                  S01194
0212 I**********                          P  70  768PART                  S01194
0213 I**********                             77  780SSNO                  S01194
0214 I**********                          P  79  858ERLC                  S01194
0215 I**********                          P  90  920LCD                   S01194
0216 I**********                                                          S01194
0217 I**********                                                          S01194
     I*****TABLE*FILE - INSTALLATION CONTROL DATA RECORD 2.               S01117
     I***********                                                         S01117
     I********NS*      1 CD   2 C0   3 C1                                 S01117
     I*******AND*     12 C1  13 C1                                        S01117
     I***********                             1   1 RECI                  S01117
     I***********                            53  53 MBIN                  S01117
0218 I**********                                                          S01194
0219 I**********                                                          S01194
0220 I*****CATCHALL FOR DELETED RECORDS.                                  S01194
0221 I********NS                                                          S01194
0222 I**********                                                          S01194
0223 I**********                                                          S01194
0224 I**********                                                          S01194
0269 I**********                                                          S01194
0270 I**********                                                          S01194
0271 I*    ACCOUNT MASTER DETAIL RECORD.
0272 I*
0273 IACCNT   NS  10   1 CD
0274 I                                        1   1 RECI
0275 I                                        2  16 ACMDKY
0277 I                                        2   70CNUMAC
0278 I                                        8  10 CCYAC
0279 I**********                             11  140ACODAC                                    CGL029
     I                                       11  140QQACOD                                    CGL029
0280 I                                       15  160ACSQAC
     I*****                                  23  250BRCD                  S01117
0281 I                                       23  25 BRCA                  S01117
0282 I                                       26  26 ATYP
0283 I                                       29  29 ACST            51
0284 I                                    P  30  320DACO
0285 I                                    P  33  350DACC
0286 I                                       36  55 ANAM
0287 I                                    P  56  630LDBL
0288 I                                    P  64  710CLBL
0289 I                                       72  72 STFQ
0290 I                                       73  740STDY
0291 I                                    P  75  770LSTD
0292 I                                    P  78  800NSTD
0293 I                                    P  81  820LSTP
0294 I                                    P  83  900CFSB
0295 I                                    P  91  930LMVD
0296 I                                    P  94 1010EPLB
0297 I                                    P 102 1090EPCB
0298 I                                    P 110 1170YTDB
0299 I                                      118 118 GLBT
0300 I                                    P 178 1837CDIR
0301 I                                    P 184 1897CCIR
0302 I                                      190 1990ACNO
0303 I                                      200 200 RETB
0304 I                                      201 201 ODSC
0305 I                                    P 202 2070ODLN
0306 I                                    P 208 2100ODED
0307 I                                    P 211 2120DIOD
0308 I                                      213 2150FACT
0309 I                                      216 2170FCNO
0310 I                                      218 219 EFAC
0311 I                                    P 220 2270HELDAB
0312 I                                    P 228 2330MINB
0313 I                                    P 234 2360LACD
0314 I                                    P 237 2380LISP
0315 I                                    P 239 2410RRNM
0316 I**********                            242 2430DRIB                                      CSD103
0316 I                                      242 243 DRIB                                      CSD103
0317 I                                    P 244 2497DRIS
0318 I                                    P 250 2520DRCD
0319 I                                      253 2530DRIC
0320 I                                      254 254 DRIF
0321 I                                      255 2560DRDY
0322 I                                    P 257 2590NDID
0323 I                                    P 260 2620LDID
0324 I                                    P 263 2690LDIA
0325 I                                      270 270 SDAP
0326 I                                    P 271 2730LPAR
0327 I                                    P 274 2800DIIE
0328 I                                    P 281 2882DAIC
0329 I                                    P 289 2950MADI
0330 I                                    P 296 3020GADI
0331 I                                      303 303 DDIS
0332 I                                    P 304 3060DDIA
0333 I**********                            310 3110OLDB                                      CSD103
0333 I                                      310 311 OLDB                                      CSD103
0334 I                                    P 312 3177OLDS
0335 I**********                            318 3190CRIB                                      CSD103
0335 I                                      318 319 CRIB                                      CSD103
0336 I                                    P 320 3257CRIS
0337 I                                    P 326 3280CRCD
0338 I                                      329 3290CRIC
0339 I                                      330 330 CRIF
0340 I                                      331 3320CRDY
0341 I                                    P 333 3350NCID
0342 I                                    P 336 3380LCID
0343 I                                    P 339 3450LCIA
0344 I                                      346 346 SCAP
0345 I                                    P 347 3490LPAP
0346 I                                    P 350 3560CIIE
0347 I                                    P 357 3642CAIC
0348 I                                    P 365 3710MACI
0349 I                                    P 372 3780GACI
0350 I                                      379 379 CDIS
0351 I                                    P 380 3820DCIA
0352 I**********                            386 3870OLCB                                      CSD103
0352 I                                      386 387 OLCB                                      CSD103
0353 I                                    P 388 3937OLCS
0354 I                                    P 394 3960LCD
0355 I                                      397 397 CHTP
0356 I                                    P 398 4000TNLU
     I                                      554 5630ACODAC                                    CGL029
0357 I*
0358 I*    CATCHALL FOR DELETED RECORDS.
0359 I*
0360 I        NS
0361 I*
0362 I*    RETAIL ACCOUNT NUMBERS DETAIL RECORD.
0363 I*
0364 IACNUM   NS  11   1 CD
0365 I                                        1   1 RECI
0366 I                                        2  110ACNO
0367 I**********                             12  26 ACNKEY                                    CGL029
     I                                       12  32 ACNKEY                                    CGL029
0368 I                                       12  170CNUM
0369 I                                       18  20 CCYAC
0370 I**********                             21  240ACOD                                      CGL029
0371 I**********                             25  260ACSQ                                      CGL029
0372 I**********                             27  27 ACST            51                        CGL029
     I**********                             29  31 BRCDAC                             S01117 CGL029
0373 I**********                          P  35  370LCD                                       CGL029
0374 I**********                          P  38  400TNLU                                      CGL029
     I                                       21  300ACOD                                      CGL029
     I                                       31  320ACSQ                                      CGL029
     I                                       33  33 ACST            51                        CGL029
     I                                       35  37 BRCDAC                                    CGL029
     I                                    P  40  420LCD                                       CGL029
     I                                    P  44  460TNLU                                      CGL029
0375 I*
0376 I*    CATCHALL FOR DELETED RECORDS.
0377 I*
0378 I        NS
0379 I*
0380 I*ELDI***NS* 12   1 CD                                               S01117
0380 IHELDIL1 NS  12   1 CD                                               S01117
0381 I                                        2   70CNUM
0382 I                                        8  10 CCYI
0383 I**********                             11  140ACOD                                      CGL029
     I                                       11  140QQACOD                                    CGL029
0384 I                                       15  160ACSQ
0385 I                                       17  190HIRF
0386 I                                       20  290ACNO
0387 I                                    P  30  320DATI
0388 I                                    P  33  350HEXP
0389 I                                    P  36  420HLDA
0390 I                                       43  62 HLDNH
0391 I***********                            63  650BNCHH                 S01117
0391 I                                       63  65 BNCHH                 S01117
0392 I                                       74  74 TPLUH
0393 I                                    P  75  770LCDH
0394 I                                    P  78  800TNLUH
     I                                       81  900ACOD                                      CGL029
0395 I**********                              1  80 LOTHD                                     CGL029
     I**********                              1  90 LOTHD                           CGL029 MD034451C
     I                                        1 117 LOTHD                                  MD034451C
0396 I        NS  14   1 C*
0397 I**********                              1  80 LOTHD                                     CGL029
     I**********                              1  90 LOTHD                           CGL029 MD034451C
     I                                        1 117 LOTHD                                  MD034451C
0398 I        NS  13   1 CT
0399 I                                        1   1 RECI
0400 I                                        2  19 KEY
0401 I                                        1  19 TKEY
0402 I**********                          P  20  210NORE                                     BUG3584
0403 I**********                          P  22  230FLSZ                                     BUG3584
0404 I**********                          P  24  250NOHI                                     BUG3584
0405 I**********                          P  26  330VWHI                                     BUG3584
0406 I**********                          P  34  350VDHI                                     BUG3584
0407 I**********                          P  36  370NHII                                     BUG3584
0408 I**********                          P  38  390NHID                                     BUG3584
0409 I**********                          P  40  470VIHW                                     BUG3584
0410 I**********                          P  48  490VIHD                                     BUG3584
0411 I**********                          P  50  570VDHW                                     BUG3584
0412 I**********                          P  58  590VDHD                                     BUG3584
0413 I**********                          P  60  610NHAU                                     BUG3584
0414 I**********                          P  62  690VHAW                                     BUG3584
0415 I**********                          P  70  710VHAD                                     BUG3584
0416 I**********                          P  72  740LCD                                      BUG3584
0417 I**********                          P  75  770TNLU                                     BUG3584
0418 I**********                              1  80 LOTHT                                    BUG3584
     I                                    P  20  230NORE                                     BUG3584
     I                                    P  24  270FLSZ                                     BUG3584
     I                                    P  28  310NOHI                                     BUG3584
     I                                    P  32  390VWHI                                     BUG3584
     I                                    P  40  410VDHI                                     BUG3584
     I                                    P  42  450NHII                                     BUG3584
     I                                    P  46  490NHID                                     BUG3584
     I                                    P  50  570VIHW                                     BUG3584
     I                                    P  58  590VIHD                                     BUG3584
     I                                    P  60  670VDHW                                     BUG3584
     I                                    P  68  690VDHD                                     BUG3584
     I                                    P  70  730NHAU                                     BUG3584
     I                                    P  74  810VHAW                                     BUG3584
     I                                    P  82  830VHAD                                     BUG3584
     I                                    P  84  860LCD                                      BUG3584
     I                                    P  87  890TNLU                                     BUG3584
     I                                        1 102 LOTHT                                    BUG3584
0419 I*
0420 I*    CATCHALL FOR DELETED RECORDS.
0421 I        NS
     I*                                                                   S01408
     I/COPY WNCPYSRC,RE0252IIP2                                           S01408
     I*                                                                   S01408
0422 I*
0426 I*
0427 I*    DATA STRUCTURE FOR LAST UPDATE DATA.
0428 I            DS
0429 I                                        1   50LCDH
0430 I                                        6   6 TPLUH
0431 I                                        7  110TNLUH
0432 I                                        1  11 LSTC
0433 I                                       12  160LCDS
0434 I                                       17  17 TPLUS
0435 I                                       18  220TNLUS
0436 I                                       12  22 LSTCS
0437 I*
0438 I*    INITIAL SCREEN INPUT FIELDS
0439 I            DS
     I                                        1   3 BRCDS                 S01117
0440 I*****                                   1   6 CNUMS                 S01117
0440 I                                        4   9 CNUMS                 S01117
0441 I*****                                   7   9 CCYS                  S01117
0441 I                                       10  12 CCYS                  S01117
0442 I*****                                  10  13 ACODS                 S01117
0442 I**********                             13  16 ACODS                              S01117 CGL029
     I                                       13  22 ACODS                                     CGL029
0443 I*****                                  14  15 ACSQS                 S01117
0443 I**********                             17  18 ACSQS                              S01117 CGL029
     I                                       23  24 ACSQS                                     CGL029
0444 I*****                                  16  25 RACNOS                S01117
0444 I**********                             19  28 RACNOS                             S01117 CGL029
     I                                       25  34 RACNOS                                    CGL029
0445 I*****                                  26  28 REFNOS                S01117
0445 I**********                             29  31 REFNOS                             S01117 CGL029
     I                                       35  37 REFNOS                                    CGL029
0446 I*****                                  29  29 ACTS                  S01117
0446 I**********                             32  32 ACTS                               S01117 CGL029
     I                                       38  38 ACTS                                      CGL029
0447 I*****                                   1  29 SFFLS                 S01117
0447 I**********                              1  32 SFFLS                              S01117 CGL029
     I                                        1  38 SFFLS                                     CGL029
      *                                                                   LN0083
     IACCKEY      DS                                                      LN0083
     I                                        1   60CNUM                  LN0083
     I                                        7   9 CCYSF                 LN0083
     I**********                             10  130ACOD                               LN0083 CGL029
     I                                       10  190ACOD                                      CGL029
      *                                                                   LN0083
     I*                                                                   S01117
0115 I**      LOCAL DATA AREA FOR DATABASE ERROR REFERENCE                S01117
0116 I*                                                                   S01117
0067 ILDA        UDS                            256                       S01117
0183 I                                      134 141 DBFILE                S01117
0183 I                                      142 170 DBKEY                 S01117
0183 I                                      171 180 DBPGM                 S01117
0183 I                                      181 1830DBASE                 S01117
     IPSDS       SDS
     I*                                                                   S01408
     I/COPY WNCPYSRC,RE0252IIPG                                           S01408
     I*                                                                   S01408
     I                                      244 246 WSID
     I                                      245 246 WSID2
     I                                      254 263 USRID
     I**
     I**  DATA STRUCTURE  TO UPDATE LAST TRANSACTION NUMBER DTAARA
     I**
     IDNATN       DS                              5
     I                                        1   50FNATN
     I**   INFDS DATA STRUCTURE
     IINFDS       DS
     I                                     *STATUS  STATUS
     I**   CMTTXT DATASTRUCTURE
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTCD
     I                                       26  35 USRIDX
     I**********                             51 127 LOTSCN                                    CGL029
     I                                       51 133 LOTSCN                                    CGL029
     I** EXTERNAL DATA AREA OF MENU ITEM REQUESTED                        S01117
     I*MITEM*****UDS**                                                                 S01117 CSF002
     I**********                              1   1 ZID                                S01117 CSF002
     I**********                              2   50ZMGRP                              S01117 CSF002
     I**********                              6   9 ZICDE                              S01117 CSF002
     I**                                                                  S01117
     I** DATA AREA RUNDAT                                                 S01117
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
     I** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 DFBR                  S01117
     I*                                                                   S01408
     I/COPY WNCPYSRC,RE0252GDTA                                           S01408
     I*                                                                   S01408
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I**  EXTERNAL DS FOR BRANCH CODE DETAILS                             S01117
0122 I*                                                                   S01117
      ** BANK DETAILS                                                     S01194
     ISDRETL    E DSSDRETLPD                                              S01194
      **                                                                  S01194
     I              BMRANR                          RACN                  S01194
     ISDCUST    E DSSDCUSTPD                                              LN0083
     I              QQDFAC                          QQDFC1                                    CGL029
      **   CUSTOMER DETAILS                                               LN0083
      *                                                                   LN0083
     ISDACOD    E DSSDACODPD                                              LN0083
     I              QQACCD                          QQACC1                                    CGL029
      **   ACCOUNT CODE DETAILS                                           LN0083
      *                                                                   LN0083
     ISDCURR    E DSSDCURRPD                                              S01194
      **   CURRENCY TYPE                                                  S01194
     I              A6NBDP                          CDP                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     I*                                                                   S01408
     I/COPY WNCPYSRC,RE0252IIP1                                           S01408
     I*                                                                   S01408
     I*****************************************************************   S01117
     I/EJECT                                                              S01117
     C                     MOVEACPY@      BIS@   80
     C                     MOVEL'RE0252  'DBPGM                           S01117
     C* PARAMETER LIST FOR AOCUSTR0                                       LN0083
     C*                                                                   LN0083
     C           PLISTA    PLIST                                          LN0083
     C                     PARM           RTCD    7                       LN0083
     C                     PARM '*KEY   ' OPTN    7                       LN0083
     C                     PARM           CUSKEY 10                       LN0083
     C                     PARM '*CNUM  ' KEYSTS  7                       LN0083
     C           SDCUST    PARM SDCUST    DSSDY                           LN0083
     C*                                                                   LN0083
     C* PARAMETER LIST FOR AOCURRR0                                       LN0083
     C*                                                                   LN0083
     C           PLISTB    PLIST                                          LN0083
     C                     PARM '*BLANKS' RTCD                            LN0083
     C                     PARM '*KEY   ' OPTN                            LN0083
     C                     PARM           CKEY    3                       LN0083
     C           SDCURR    PARM SDCURR    DSSDY                           LN0083
     C*                                                                   LN0083
     C*                                                                   LN0083
     C* PARAMETER LIST FOR AOACODR0                                       LN0083
     C*                                                                   LN0083
     C           PLISTC    PLIST                                          LN0083
     C                     PARM '*BLANKS' RTCD                            LN0083
     C                     PARM '*KEY   ' OPTN                            LN0083
     C**********           PARM           ACOKEY  4                                    LN0083 CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                        LN0083 CGL029
     C                     PARM           ACOKEY 10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*                                                                   LN0083
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP9                                           S01408
     C*                                                                   S01408
     C****************************************************************    S01117
     C/EJECT
     C**   RPG ERROR HANDLING
     C           STATUS    IFEQ 01021
     C                     Z-ADD0         STATUS  50
     C                     GOTO INFTAG
     C                     END
     C**
     C*    READ WORKSTATION FILE /*HELP*FACILITY*                         S01199
     C**
     C           *IN06     IFEQ '1'
     C********** *IN15     DOUEQ'0'                                       S01314
     C                     READ RE0252FM                 15
     C************IN15     IFEQ '1'                                       S01199
     C***********          MOVEAERCD      HERCD 160                       S01199
     C***********          MOVEL'RE0252'  HBPGM   8                       S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C***********          END                                            S01199
     C*********************END                                            S01314
     C                     GOTO ENDFC
     C                     END
0449 C*    FIRST CYCLE ONLY CALCULATIONS.
0451 C  N06                SETON                     06
0452 C                     SETOF                     15
0454 C                     SETON                     39
0455 C*
     C**                                                                  S01117
     C**    IN THE DATAAREA RUNDAT                                        S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
1068 C**                                                                  S01194
1069 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
1070 C           DATF      COMP 'M'                      98MMDDYY, 98 ON. S01194
     C**    IN THE DATAAREA ZMUSER                                        S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C*                                                                   S01117
     C**                                                                  S01117
0456 C*****ACCESS*INSTALLATION*CONTROL*DATA*RECORD*1.                     S01194
0457 C**********           EXSR ZSYSTM                                    S01194
0458 C***99*****           SETON                     U840  NOT FOUND,     S01194
0459 C***99*****           GOTO ENDD                       DATABASE ERROR.S01194
0460 C                     MOVE ' '       BLK58  58
0461 C*
     C***
     C*****ACCESS*INSTALLATION*CONTROL*DATA*RECORD*3.                     S01194
     C***                                                                 S01194
0463 C**********           MOVEL'01      'TABKEY 12                       S01194
0464 C**********           MOVE '  20'    TABKEY                          S01194
0465 C**********           EXSR TABCHN                                    S01194
     C                     CALL 'AORETLR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDRETL    PARM SDRETL    DSFDY                           S01194
0466 C***77*****           SETON                     U840  NOT FOUND,     S01194
0467 C***40*****           GOTO ENDD                       DATABASE ERROR S01194
0468 C           RACN      COMP 'Y'                  595960
     C***
     C*****ACCESS*INSTALLATION*CONTROL*DATA*RECORD*2.                     S01194
     C**********                                                          S01194
     C**********           MOVEL'01      'TABKEY                          S01194
     C**********           MOVE '  11'    TABKEY                          S01194
     C**********           EXSR SABCHN                                    S01194
     C***77*****           SETON                     U840  NOT FOUND,     S01194
     C***40*****           GOTO ENDD                       DATABASE ERROR S01194
     C**
     C**    CHECK MULTIBRANCH FLAG
     C**
     C***********MBIN      COMP 'N'                      72               S01117
     C           MBIN      COMP 'Y'                      72               S01117
0469 C*
0470 C*    SETUP BLANK AND ZERO FIELDS.
0471 C                     MOVE ' '       BLANKS150
0472 C                     Z-ADD0         ZERO05  50
0473 C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCPG                                           S01408
     C*                                                                   S01408
     C**                                                                  S01117
0719 C********************************************************************S01117
0474 C           ENDFC     TAG                             ** ENDFC TAG **
0475 C*
0476 C*    CLEAR ERROR OUTPUT AREA AND WORKFIELD.
0477 C                     MOVE BLANKS    ERCD
0478 C                     Z-ADD0         S       10
0479 C                     SETON                     8384
0480 C*
0481 C*    CHECK COMMAND KEY STATUS.
0482 C   KC                SETON                     40LR
0483 C   KC                GOTO ENDD                       END OF JOB
0484 C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP3                                           S01408
     C*                                                                   S01408
0485 C   KL                GOTO SFOUT                      SCREEN SF REQ.
0486 C*
0487 C   KJ 03             GOTO UDLOG                      DELETE RECORD
0488 C*
0489 C*    INVALID OR COMMAND KEY FOR SCREEN TYPE TESTS.
0490 C                     SETOF                     30
0491 C   03
0492 COR KJN03             SETON                     30
0493 C   02 KJ             SETOF                     50
0494 C  N30                GOTO CMDOK
0495 C                     SETOF                     84
0496 C                     MOVE ERRMSG,4  ERMSG
0497 C      01             SETON                     42
0498 C      01             GOTO SFOUT
0499 C                     SETON                     43
0500 C                     SETOF                     66
0501 C   59                SETOF                     67
0502 C   59                SETON                     68
0503 C   60                SETOF                     67
0504 C   60                SETOF                     68
0505 C     N02N17          SETON                     64
0506 C      03             MOVE ERRMSG,5  ERMSG
0507 C                     GOTO SCNOUT
0508 C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CPCR                                           S01408
     C*                                                                   S01408
0509 C           CMDOK     TAG                             ** CMDOK TAG **
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP6                                           S01408
     C*                                                                   S01408
0510 C                     EXSR RSET
0511 C*
0512 C*    ACTION SCREEN TYPE.
0513 C   01
0514 COR 04                GOTO INITAL
0515 C   02
0515 COR 17                GOTO INSTAG
0516 C*
0517 C*    FIRST CYCLE BLANK SCREEN, 'SE' SCREEN OR F12 INPUT,
0518 C*    OUTPUT INITIAL SCREEN, ID SF.
0519 C           SFOUT     TAG                             ** SFOUT TAG **
0520 C                     EXSR RSET
0521 C                     SETON                     4164
0522 C                     SETOF                     525354
0522 C                     SETOF                     81
0523 C                     SETOF                     69
0524 C   59                SETOF                     25
0525 C   59                SETON                     28
0526 C   60                SETOF                     26
0527 C   60                SETON                     24
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP8                                           S01408
     C*                                                                   S01408
0528 C                     GOTO SCNOUT
0529 C*
0530 C*
0531 C*    HANDLE INITIAL SCREEN, TYPE SF.
0532 C           INITAL    TAG                             ** INITAL TAG *
0533 C*
0534 C*    SAVE INPUT FIELDS
0535 C                     MOVE SFFL      SFFLS
0536 C*
0537 C*    VALIDATE ACTION CODE.
0538 C                     SETOF                     55
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CP10                                           S01408
     C*                                                                   S01408
0539 C           ACT       COMP 'I'                      52
0539 C           ACT       COMP 'A'                      81
0540 C           ACT       COMP 'D'                      53
0541 C           ACT       COMP 'E'                      54
0542 C  N52N53N54
0542 CANN81                SETON                     55
0543 C  N55                GOTO ACTOK
0544 C*
0545 C*    SET ERROR CODE AND MESSAGE.
0546 C                     SETON                     30
0547 C                     SETOF                     84
0548 C                     Z-ADD1         S
0549 C                     MOVE '012'     ERCD,S
0550 C**********           MOVE ERRMSG,1  ERMSG  47                       LN0083
0550 C                     MOVE ERRMSG,1  ERMSG  76                       LN0083
0551 C*
0552 C*    VALID ACTION CODE.
0553 C           ACTOK     TAG                             ** ACTOK TAG **
0554 C   59                GOTO ACNOV
0555 C*
0556 C*    VALIDATE RETAIL ACCOUNT NUMBER IF ENTERED.
0557 C*
0558 C  N35                MOVELRACNO     NFLD11 110
0559 C  N35                MOVELNFLD11    AFLD10 10
0560 C  N35      RACNO     COMP AFLD10                   57
0561 C  N35N57             SETON                     3056
0562 C  N35N57   S         ADD  1         S
0563 C  N35N57             MOVE '090'     ERCD,S
0564 C*
0565 C   35                SETON                     3056
0566 C   35      S         ADD  1         S
0567 C   35                MOVE '090'     ERCD,S
0568 C                     GOTO REFNOV
0569 C*
0570 C*    VALIDATE ACCOUNT NUMBER IF ENTERED.
0571 C           ACNOV     TAG                             ** ACNOV TAG **
     C**   VALIDATE BRANCH                                                S01117
     C           *IN60     IFNE '1'                        IF RACN <> 'Y' S01117
     C*                                                                   S01117
     C           BNCHSF    IFEQ *BLANKS                                   S01117
     C           MBIN      OREQ 'N'                        OR SINGLEBRANCHS01117
     C**                                                                  S01117
     C**  USE DEFAULT FOR BRANCH CODE                                     S01117
     C                     MOVE DFBR      BNCHSF                          S01117
     C                     MOVE DFBR      BRCDS                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C** BASIC VALIDATION OF INPUT BRANCH CODE                            S01117
     C           MBIN      IFEQ 'Y'                        IF MULTIBRANCH S01117
     C           BNCHSF    ANDNE*BLANKS                    & BNCHSF<>BLANKS01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BNCHSF    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         S                               S01117
     C                     MOVE '032'     ERCD,S                          S01117
     C                     MOVE ERRMSG,8  ERMSG                           LN0083
     C                     SETON                     45                   S01117
     C**********           GOTO SFERR                               S01117LN0083
     C                     ELSE                                           LN0083
     C                     MOVE A8BRCD    BNCHSF                          LN0083
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  LN0083
     C**  NEW STANDING DATA FIELDS VALIDATION                             LN0083
     C**                                                                  LN0083
     C*                                                                   LN0083
     C                     MOVELCNUMS     CUSKEY                          LN0083
     C                     CALL 'AOCUSTR0'PLISTA                          LN0083
     C           RTCD      IFNE *BLANKS                                   LN0083
     C                     MOVE CNUMS     CNUMA                           LN0083
     C           S         ADD  1         S                               LN0083
     C                     MOVE '128'     ERCD,S                          LN0083
     C                     MOVE ERRMSG,8  ERMSG                           LN0083
     C                     SETON                     58                   LN0083
     C                     ELSE                                           LN0083
     C                     MOVE BBCUST    CNUM                            LN0083
     C                     MOVE BBCUST    CNUMA                           LN0083
     C                     END                                            LN0083
     C*                                                                   LN0083
     C                     MOVE CCYSF     CKEY                            LN0083
     C                     CALL 'AOCURRR0'PLISTB                          LN0083
     C           RTCD      IFNE *BLANKS                                   LN0083
     C           S         ADD  1         S                               LN0083
     C                     MOVE '128'     ERCD,S                          LN0083
     C                     MOVE ERRMSG,8  ERMSG                           LN0083
     C                     SETON                     58                   LN0083
     C                     ELSE                                           LN0083
     C                     MOVE A6CYCD    CCYSF                           LN0083
     C                     END                                            LN0083
     C*                                                                   LN0083
     C                     MOVE ACODA     ACOKEY                          LN0083
     C                     CALL 'AOACODR0'PLISTC                          LN0083
     C           RTCD      IFNE *BLANKS                                   LN0083
     C                     MOVE ACODS     ACODA                           LN0083
     C           S         ADD  1         S                               LN0083
     C                     MOVE '128'     ERCD,S                          LN0083
     C                     MOVE ERRMSG,8  ERMSG                           LN0083
     C                     SETON                     58                   LN0083
     C                     ELSE                                           LN0083
     C                     MOVE A5ACCD    ACOD                            LN0083
     C                     MOVE A5ACCD    ACODA                           LN0083
     C                     END                                            LN0083
     C*                                                                   LN0083
     C           S         IFNE *ZERO                                     LN0083
     C                     GOTO SFERR                                     LN0083
     C                     END                                            LN0083
     C*                                                                   S01117
     C                     END                                            S01117
     C**                                                                  S01117
0572 C   31                SETON                     3058
0573 C   31      S         ADD  1         S                CUSTOMER NO.
0574 C   31                MOVE '023'     ERCD,S
0575 C*
0576 C   32                SETON                     3058
0577 C   32      S         ADD  1         S                CURRENCY CODE
0578 C   32                MOVE '024'     ERCD,S
0579 C*
0580 C   33                SETON                     3058
0581 C   33      S         ADD  1         S                ACCOUNT CODE
0582 C   33                MOVE '036'     ERCD,S
0583 C*
0584 C*
0585 C*
0586 C*    VALIDATE REFERENCE NUMBER - ENSURE NUMERIC.
0587 C           REFNOV    TAG                             ** REFNOV TAG *
0588 C                     MOVELXREFNO    NFLD4   40
0589 C                     MOVELNFLD4     AFLD3   3
0590 C           XREFNO    COMP AFLD3                5757
0590 C  N57      XREFNO    COMP '000'                    57
0591 C   57                SETON                     30
0592 C   57      S         ADD  1         S
0593 C   57                MOVE '104'     ERCD,S
0594 C***30*****           GOTO SFERR                                     LN0083
0595 C*
0596 C*    CHECK IF ACTION CODE APPROPRIATE - DETERMINE IF INSERT ALREADY
0597 C*    ON FILE OR IF DELETE/ENQUIRY NOT ON FILE.
0598 C*
0599 C*    RETAIL ACCOUNT NUMBER ENTERED.
0600 C   59                GOTO SETUP
0601 C**********           SETOF                     57                   LN0083
0601 C  N30                SETOF                     57                   LN0083
     C*                                                                   BHF668
     C**  CHAIN ONLY IF VALID ENTRY,  OTHERWISE OUTPUT ERROR MESSAGES     BHF668
     C*                                                                   BHF668
0594 C   30                GOTO SFERR                                     BHF668
0602 C           RACNO     CHAINACNUM                87
0603 C  N87 51             GOTO GETAC
0604 C                     GOTO ACER
0594 C***30*****           GOTO SFERR                               LN0083BHF668
0605 C*
0606 C*    ACCOUNT NUMBER ENTERED. SET UP KEY FOR ACCNT.
0607 C           SETUP     TAG                             ** SETUP TAG **
0608 C   34 59             MOVE '01'      ACNKEY
0609 C   34 59             MOVE '01'      ACSQ
0609 C   34 59             MOVE '01'      ACSQS                           S01117
0610 C*
0611 C*    ACCESS ACCNT FILE.
0612 C           GETAC     TAG                             ** GETAC TAG **
0613 C*****                MOVE ACNKEY    ACKEY  15                       S01117
     C                     MOVELACCKEY    WFLD1   6                       BHF528
     C   59                MOVE CCYSF     CCYAC                           BHF528
     C                     MOVE CCYAC     WFLD2   9                       BHF528
     C                     MOVELWFLD1     WFLD2                           BHF528
     C                     MOVELWFLD2     ACCKEY                          BHF528
     C                     MOVELACCKEY    ACNKEY                          LN0083
     C**********           MOVELACNKEY    ACKEY  18                                    S01117 CGL029
     C                     MOVELACNKEY    ACKEY  24                                           CGL029
     C  N59                MOVE BRCDAC    ACKEY                           S01117
     C   59                MOVE BNCHSF    ACKEY                           S01117
   4 C                     EXSR ACACC
     C  N88                MOVE BRCA      BNCH    3                       S01117
0615 C  N88                SETON                     75    RELEASE FILE IF
0616 C   75                EXSR EXCPTN                     A RECORD FOUND
0617 C  N88 51             GOTO HCHN
0618 C*
0619 C*    ACCOUNT OR RETAIL ACCOUNT NUMBER ERROR.
0620 C           ACER      TAG                             ** ACER TAG ***
0621 C                     SETOF                     84
0622 C                     SETON                     5658
0623 C   87 60                                             RET NOT FND
0624 COR 88 59   S         ADD  1         S                NON RET,NOT FND
0625 C   87 60
0626 COR 88 59             MOVE '128'     ERCD,S
0627 C   87 60
0628 COR 88 59             MOVE ERRMSG,8  ERMSG
0629 C*
0630 C  N87N51 60                                          RET CLOSED
0631 CORN88N51 59S         ADD  1         S                NON RET,CLOSED
0632 C  N87N51 60
0633 CORN88N51 59          MOVE '086'     ERCD,S
0634 C  N87N51 60
0635 CORN88N51 59          MOVE ERRMSG,7  ERMSG
0636 C                     GOTO SFERR
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CVSF                                           S01408
     C*                                                                   S01408
0637 C*
0638 C*
0639 C*****SET*UP HELD ITEM KEY AND ACCESS HELDI FILE.                    S01117
0639 C*    SET UP HELD ITEM KEY AND ACCESS HELDIL1 FILE.                  S01117
0640 C           HCHN      TAG                             ** HCHN TAG ***
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP2                                           S01408
     C*                                                                   S01408
0641 C**********           MOVELACNKEY    HLDKEY 18                                           CGL029
     C                     MOVELACNKEY    HLDKEY 24                                           CGL029
     C**********           MOVE HLDKEY    WHLDKY 12                                   CGL029 BUG2963
     C                     MOVE HLDKEY    WHLDKY 15                                          BUG2963
     C                     MOVELWHLDKY    WHACOD 10                                           CGL029
0642 C                     MOVE REFNO     HLDKEY
     C**********           MOVELBRCA      HLDKY1 21                                    S01117 CGL029
     C                     MOVELBRCA      HLDKY1 27                                           CGL029
     C                     MOVE HLDKEY    HLDKY1                          S01117
0643 C                     EXSR HLDCHN
0644 C  N76                SETON                     48    RELEASE FILE IF
0645 C   48                EXSR EXCPTN                     A RECORD FOUND
0646 C*
0647 C   12 52                                             I - THERE
0648 CORN12 81                                             A - NOT THERE
0648 CORN12 53                                             D - NOT THERE
0649 CORN12 54             SETON                     30    E - NOT THERE
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CP12                                           S01408
     C*                                                                   S01408
0650 C**N30                GOTO SFOK                                      S01117
     C  N30                GOTO SPFCHK                                    S01117
0651 C*
0652 C*    SET ERROR CODE AND MESSAGE.
0653 C                     Z-ADD1         S
0654 C                     SETOF                     84
0655 C                     SETON                     57
0656 C   59                SETON                     58
0657 C   60                SETON                     56
0658 C                     MOVE '016'     ERCD,S
0659 C                     MOVE ERRMSG,3  ERMSG
0660 C  N52                MOVE '017'     ERCD,S
0661 C  N52                MOVE ERRMSG,2  ERMSG
     C                     GOTO SFERR                                     S01117
     C**                                                                  S01117
     C*                                                                   S01117
     C           SPFCHK    TAG                             **SPFCHK TAG **S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CVSR                                           S01408
     C*                                                                   S01408
     C**                                                                  S01117
     C**   VALIDATE ACTION CODE                                           S01117
     C**   IF MBIN = N, VALIDATE ACTION                                   S01117
     C***  VALIDATE USERS AUTHORITY TO USE THIS BRANCH/ACTION             S01117
     C*                                                                   S01117
     C                     Z-ADD*ZERO     @ERR    10                      LN0083
     C*                                                                   S01117
     C           MBIN      IFEQ 'N'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACT       @ZACTN  1                       S01117
     C                     PARM           @ERR                            S01117
     C**  IF NOT VALID FOR USER                                           S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         S                               S01117
     C                     MOVE '302'     ERCD,S                          S01117
     C                     MOVE ERRMSG,9  ERMSG                           S01117
     C                     SETON                     3055                 S01117
     C                     SETOF                     84                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   IF MBIN = Y, VALIDATE ACTION & BR. CODE TOGETHER               S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACT       @ZACTN                          S01117
     C                     PARM BNCHSF    @ZBR    3                       S01117
     C                     PARM           @ERR                            S01117
     C**  IF NOT VALID FOR USER                                           S01117
     C           @ERR      IFNE *ZERO                                     S01194
     C           @ERR      IFEQ 1                                         S01194
     C                     ADD  1         S                               S01194
     C                     MOVE '303'     ERCD,S                          S01194
     C                     MOVE ERRMSG,10 ERMSG                           S01194
     C                     ELSE                                           S01194
     C           @ERR      IFEQ 2                                         S01194
     C                     ADD  1         S                               S01117
     C                     MOVE '304'     ERCD,S                          S01117
     C                     MOVE ERRMSG,11 ERMSG                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     SETON                     305537               S01117
     C                     SETOF                     84                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C**                                                                  S01117
     C           *IN30     CABEQ'0'       SFOK                            S01117
     C**                                                                  S01117
0662 C*
0663 C*    INITIAL SCREEN ERROR.
0664 C*    SET WRKSTN CONTROL INDICATORS.
0665 C           SFERR     TAG                             ** SFERR TAG **
0666 C                     SETON                     4264
0667 C                     SETOF                     8369
0668 C                     SETOF                     525354
0668 C                     SETOF                     81
0669 C   59                SETOF                     25
0670 C   59                SETON                     28
0671 C   60                SETOF                     26
0672 C   60                SETON                     24
0673 C                     GOTO SCNOUT
0674 C*
0675 C           SFOK      TAG                             ** SFOK TAG ***
0676 C*
0677 C*    SAVE LAST UPDATE DATA USING DATA STRUCTURE.
0678 C   12                MOVE LSTC      LSTCS
0679 C  N12                Z-ADD0         LCDS
0680 C  N12                MOVE ' '       TPLUS
0681 C  N12                Z-ADD0         TNLUS
0682 C*
0683 C*    CONVERT EXPIRY DATE FOR OUTPUT.
0684 C                     MOVE HEXP      ZDAYNO
0685 C                     EXSR ZDATE2
     C                     MOVE ZDATE     EXPD
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP1                                           S01408
     C*                                                                   S01408
0686 C**********                                                          S01194
0687 C*****EDIT*HELD AMOUNT FOR OUTPUT.                                   S01194
0688 C**********           MOVEL'20'      TABKEY                          S01194
0689 C**********           MOVELCCYSF     WORKEY  4                       S01194
0690 C***60*****           MOVELCCYAC     WORKEY                          S01194
0691 C**********           MOVE '1'       WORKEY                          S01194
0692 C**********           MOVE WORKEY    TABKEY                          S01194
0693 C**********           EXSR TABCHN                                    S01194
     C                     MOVE CCYSF     CKEY                            S01194
     C   60                MOVE CCYAC     CKEY                            S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*BLANK ' RTCD    7                       LN0083
     C                     PARM '*KEY   ' OPTN    7                       S01194
     C                     PARM           CKEY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           RTCD      COMP *BLANKS              7777                 S01194
     C  N77                MOVE A6CYCD    CCYI                            S01194
     C   77                SETON                     U7U8  ***************S01194
     C   77                Z-ADD15        DBASE            * DB ERROR 15 *S01194
     C   77                MOVELCKEY      DBKEY            ***************S01194
     C   77                MOVEL'SDCURRPD'DBFILE                          S01194
0694 C           CDP       COMP 1                      2021               S01194
0695 C           CDP       COMP 2                    23  22               S01194
0696 C                     MOVE HLDA      HELDN                           S01194
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP7                                           S01408
     C*                                                                   S01408
0682 C*                                                                   S01194
0683 C*    MOVE HELD NARRATIVE AND BRANCH CODE FOR OUTPUT.                S01117
0684 C                     MOVE HLDNH     HLDN                            S01117
     C*****                MOVE BNCHH     BNCHSF                          S01117
0697 C*
0698 C*    SET WRKSTN CONTROL INDICATORS.
0699 C           SETIND    TAG                             ** SETIND TAG *
0700 C   54                SETOF                     69
0701 C   54 59             SETOF                     25
0702 C   54 60             SETOF                     26
0703 C   54 59             SETON                     28
0704 C   54 60             SETON                     24
0705 C  N54                SETON                     49
0706 C  N52N81             SETON                     64
0707 C   52                SETON                     50
0708 C                     SETON                     43
0709 C                     SETOF                     66
0710 C   59                SETOF                     67
0711 C   59                SETON                     68
0712 C   60                SETOF                     67
0713 C   60                SETOF                     68
0714 C                     GOTO SCNOUT
0715 C*
0716 C*    HANDLE INSERTIONS.
0717 C*
0718 C           INSTAG    TAG                             ** INSTAG TAG *
0719 C*
0720 C*****VALIDATE BRANCH CODE                                           S01117
0721 C******     BNCH      COMP 0                        45               S01117
     C******                                                              S01117
     C******SINGLE BRANCH - IF CODE ENTERED MUST BE DEFAULT CODE          S01117
     C******                                                              S01117
     C******72             DO                                             S01117
     C******                                                              S01117
     C*****IF NO DEFAULT BRANCH AND NO ENTERED BRANCH THEN ERROR          S01117
     C*****                                                               S01117
     C***36*45             SETON                     37                   S01117
     C*******                                                             S01117
     C**N37**              DO                                             S01117
     C***45**              Z-ADDDFBR      BNCH                            S01117
     C** 36      BNCH      COMP DFBR *************** 3737 ****************E81040
     C**N36******BNCH      COMP DFBR                 3737           E81040S01117
     C******               END                                            S01117
     C******               END                                            S01117
     C******                                                              S01117
     C******MULTI BRANCH - MUST BE VALID CODE                             S01117
     C******                                                              S01117
     C*****N72             DO                                             S01117
0722 C***36*45             SETON                     37                   S01117
0723 C**N37*45             Z-ADDDFBR      BNCH                            S01117
0724 C**N37***   BNCH      COMP BRCD                 3737                 S01117
     C**N37***             MOVELBNCHSF    NFLD4                           S01117
     C**N37***             MOVELNFLD4     AFLD3                           S01117
     C**N37***   BNCHSF    COMP AFLD3                3737                 S01117
     C******                                                              S01117
     C******               END                                            S01117
     C**                                                                  S01117
0725 C***37**              SETON                     30                   S01117
0726 C***37******S         ADD  1         S                               S01117
0727 C***37******          MOVE '032'     ERCD,S                          S01117
0719 C********************************************************************S01117
0728 C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP4                                           S01408
     C*                                                                   S01408
0729 C*    VALIDATE CURRENCY CODE.
0730 C           CCYI      COMP CCYAC                6161
0731 C   61                SETON                     30
0732 C   61      S         ADD  1         S
0733 C   61                MOVE '024'     ERCD,S
0734 C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CCP5                                           S01408
     C*                                                                   S01408
0735 C*    VALIDATE NARRATIVE.
0736 C   38                SETON                     6230
0737 C   62      S         ADD  1         S
0738 C   62                MOVE '027'     ERCD,S
0739 C*
0740 C*    VALIDATE HELD AMOUNT.
0750 C                     Z-ADDCDP       ZADEC
0751 C           13        SUB  CDP       ZADIG
0743 C                     MOVE '  '      ZFIELD
0744 C                     MOVELHELD      ZFIELD
0745 C                     EXSR ZALIGN
0746 C  N99                MOVE ZFIELD    HELDN  130
0747 C  N99      HELDN     COMP 0                        99
0748 C   99                SETON                     6530
0749 C   99      S         ADD  1         S
0750 C   99                MOVE '124'     ERCD,S
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CVS1                                           S01408
     C*                                                                   S01408
0751 C*
0752 C*    VALIDATE EXPIRY DATE.
     C                     MOVELEXPD      NFLD7   70
     C                     MOVELNFLD7     AFLD6   6
     C           EXPD      COMP AFLD6                6363
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CVS2                                           S01408
     C*                                                                   S01408
0753 C  N63                MOVE EXPD      ZDATE
0754 C  N63                EXSR ZDATE1
0755 C  N63 99             SETON                     63
0756 C  N63      RUND      COMP ZDAYNO               63
0757 C   63                SETON                     30
0758 C   63      S         ADD  1         S
0759 C   63                MOVE '127'     ERCD,S
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CVS3                                           S01408
     C*                                                                   S01408
0760 C  N30                GOTO UDLOG
0761 C*
0762 C*    SET WORKSTN CONTROL INDICATORS.
0763 C                     SETOF                     836667
0764 C                     SETOF                     68
0765 C                     SETON                     434969
0766 C                     GOTO SCNOUT
0767 C*
0768 C*
0769 C*
0770 C*****CALCULATIONS TO UPDATE HELDI FILE.                       S01030S01117
0770 C*    CALCULATIONS TO UPDATE HELDIL1 FILE.                           S01117
0771 C           UDLOG     TAG                             ** UDLOG TAG **
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CVS4                                           S01408
     C*                                                                   S01408
0772 C*
0773 C*    IF  A  DATABASE  ERROR  IS  FOUND  INDICATORS                  S01030
0774 C*    ARE SET - TO REFLECT THE ERROR CONDITION, RELEASE
0775 C*    FILES, RELEASE THE SCREEN AND TO END THE PROGRAM.
0776 C*
0779 C*
0780 C*    CHECK STATUS OF RECORD UNCHANGED.
0781 C                     EXSR HLDCHN
0782 C*
0783 C  N12                Z-ADD0         LCDH
0784 C  N12                MOVE ' '       TPLUH
0785 C  N12                Z-ADD0         TNLUH
0786 C*
0787 C           LSTC      COMP LSTCS                    79
     C           INFTAG    TAG
0788 C*
0789 C*    IF RECORD CHANGED, RELEASE FILES, SET ERROR MESSAGE,
0790 C*    SET SCREEN CONTROL INDICATORS AND BYPASS.
0791 C   79                GOTO RUNCH
0794 C                     EXSR EXCPTN
0795 C                     MOVE ERRMSG,6  ERMSG
0796 C                     SETOF                     84
0797 C                     SETOF                     66
0798 C                     SETON                     43
0799 C      59             SETOF                     67
0800 C      60             SETOF                     68
0801 C*
0802 C*    SAVE LAST UPDATE DATA IF FURTHER ACTION ALLOWED
0803 C      12N02          MOVE LSTC      LSTCS
0804 C*
0805 C                     GOTO SCNOUT
0806 C*
0807 C*    RECORD UNCHANGED.
0808 C           RUNCH     TAG                             ** RUNCH TAG **
0809 C*
     C**  OBTAIN LAST TRANSACTION NUMBER  AND SET UP STANDARD OUTPUT
     C**  INFORMATION
     C                     EXSR ZTNLU1
     C                     MOVE 'RE'      MDID    2
     C                     MOVEL'RE0252'  PGMN    8
     C                     MOVE WSID      WSIDX
     C                     MOVE USRID     USRIDX
0847 C                     EXSR ACACC
0848 C   02
0848 COR 17      HELDAB    ADD  HELDN     HELDAB
0849 C   17      HELDAB    SUB  HLDA      HELDAB
0849 C   03      HELDAB    SUB  HELDN     HELDAB
0853 C                     SETON                     71
0854 C                     EXSR TIME
0855 C                     EXSR EXCPTN
0865 C*
0866 C*****GET*HELDI FILE TRAILER RECORD READY FOR UPDATE.                S01117
0866 C*    GET HELDIL1 FILE TRAILER RECORD READY FOR UPDATE.              S01117
0867 C                     MOVEL'99999999'HWRK   16
0868 C                     MOVE '99999999'HWRK
0869 C***********          MOVELHWRK      HLDKEY                          S01117
0869 C                     MOVELHWRK      HLDKY1                          S01117
0870 C***********          MOVE '99'      HLDKEY                          S01117
0870 C                     MOVE '99999'   HLDKY1                          S01117
     C                     MOVE *ALL'9'   HLDKY1                                              CGL029
0871 C                     EXSR HLDCHN
0872 C*
0873 C*    IF TRAILER NOT FOUND , DATABASE ERROR.
0874 C  N13                SETON                     U840
0875 C   U8                GOTO ENDD
0876 C*
0877 C*****UPDATE HELDI FILE TRAILER.                                     S01117
0877 C*    UPDATE HELDIL1 FILE TRAILER.                                   S01117
0878 C   02      NHII      ADD  1         NHII
0879 C   02      NHAU      ADD  1         NHAU
0880 C   03      NHID      ADD  1         NHID
0881 C   03      NHAU      SUB  1         NHAU
0882 C*
0883 C*    UPDATE HASH TOTALS
0884 C                     Z-ADDVHAW      ZZTOTI
0885 C                     Z-ADDVHAD      ZZTOTD
0886 C           HELDN     DIV  1000      ZZAMT
0887 C   03                Z-SUBZZAMT     ZZAMT
0888 C                     EXSR GLZADD
0886 C   17      HLDA      DIV  1000      ZZAMT
0887 C   17                Z-SUBZZAMT     ZZAMT
0888 C   17                EXSR GLZADD
0889 C                     Z-ADDZZTOTI    VHAW
0890 C                     Z-ADDZZTOTD    VHAD
0891 C*
0892 C   02                Z-ADDVIHW      ZZTOTI
0893 C   02                Z-ADDVIHD      ZZTOTD
0894 C   03                Z-ADDVDHW      ZZTOTI
0895 C   03                Z-ADDVDHD      ZZTOTD
0896 C   03                Z-SUBZZAMT     ZZAMT
0897 C   02
0897 COR 03                EXSR GLZADD
0898 C   02                Z-ADDZZTOTI    VIHW
0899 C   02                Z-ADDZZTOTD    VIHD
0900 C   03                Z-ADDZZTOTI    VDHW
0901 C   03                Z-ADDZZTOTD    VDHD
0902 C*
 904 C*    UPDATE TRAILER
0905 C                     SETON                     73
0906 C                     EXSR EXCPTN
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CADU                                           S01408
     C*                                                                   S01408
0907 C*
     C*    END COMIT CYCLE
     C           CMTTXT    COMIT
0930 C*    OUTPUT INITIAL SCREEN
0931 C                     GOTO SFOUT
0932 C**
0933 C*
0934 C*    OBTAIN TIME FOR SCREEN DISPLAY.
0935 C           SCNOUT    TAG                             ** SCNOUT TAG *
0936 C                     EXSR TIME
0937 C**
0938 C**
0939 C           ENDD      TAG                             ** ENDD TAG **
0939 C   U8                SETON                     LR                **
0940 C**
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C   97N93             DO   3
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
     C********************************************************************
1042 C*    SR. TO RESET SCREEN AND ERROR INDICATORS.
1043 C           RSET      BEGSR                           *** RSET ***
1044 C*****                SETOF                       24                 S01117
1044 C                     SETOF                       2499               S01117
1045 C                     SETOF                     283040
1046 C                     SETOF                     414243
1047 C                     SETOF                     493750
1048 C                     SETOF                     555657
1049 C                     SETOF                     586162
1050 C                     SETOF                     636465
1051 C                     SETON                     666768
1052 C                     SETON                     698384
1053 C                     SETON                     2526
     C*                                                                   BHF669
     C**  SEND ERROR MESSAGE IF CMD 10 PRESSED ON INITIAL SCREEN          BHF669
     C*                                                                   BHF669
     C   KJN03             SETOF                     84                   BHF669
     C   KJN03             MOVE ERRMSG,4  ERMSG                           BHF669
     C*                                                                   BHF669
1054 C                     ENDSR
1055 C*
1056 C********************************************************************
1057 C**********                                                          S01194
1058 C*****ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
1059 C**********                                                          S01194
1060 C*R******** ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
1061 C**********                                                          S01194
1062 C*****SET*UP KEY FOR INSTALLATION CONTROL RECORD.                    S01194
1063 C*R********           MOVEL'01      'ZTABKY 12                       S01194
1064 C*R********           MOVE '  10'    ZTABKY                          S01194
1065 C**********                                                          S01194
1066 C*R******** ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
1067 C*RN99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01194
1071 C**********                                                          S01194
1072 C*R********           ENDSR                                          S01194
1073 C**********                                                          S01194
1074 C**********                                                          S01194
1075 C********************************************************************
1091 C*
1092 C*    EXCPTN SR. TO PERFORM EXCEPTION TIME OUTPUT
1093 C*               AND RESET EXCPTION CONTROL INDICATORS.
1094 C*
1095 C           EXCPTN    BEGSR                           *** EXCPTN ***
1096 C*
1097 C*    EXCEPTION OUTPUT.
1098 C                     EXCPT
     C                     SETOF                     487173
     C                     SETOF                     75
1102 C                     ENDSR
1103 C*
1104 C*
1105 C********************************************************************
1106 C**
1107 C**   TIME SR. TO OBTAIN TIME.
1108 C**
1109 C           TIME      BEGSR                           *** TIME ***
1110 C**
1111 C                     TIME           MTIME   60
1112 C**
1113 C                     ENDSR
1114 C**
1115 C**
1116 C********************************************************************
1117 C*
1118 C*****SR.*TO RANDOM ACCESS HELDI FILE.
1118 C*    SR. TO RANDOM ACCESS HELDIL1 FILE.
1119 C*
1120 C           HLDCHN    BEGSR                           *** HLDCHN ****
1121 C*
1122 C                     SETOF                     121314
1123 C********** HLDKEY    CHAINHELDI                76                   S01117
1123 C           HLDKY1    CHAINHELDIL1              76                   S01117
     C                     MOVE BNCH      BNCHSF
1124 C*
1125 C                     ENDSR
1126 C*
1127 C********************************************************************S01194
1128 C**********                                                          S01194
1129 C*****SR.*TO RANDOM ACCESS TABLE FILE.                               S01194
1130 C**********                                                          S01194
1131 C********** TABCHN    BEGSR                           *** TABCHN ****S01194
1132 C**********                                                          S01194
1133 C**********           SETOF                     05                   S01194
1134 C********** TABKEY    CHAINTABLE                77                   S01194
1135 C**********                                                          S01194
1136 C**********           ENDSR                                          S01194
1137 C**********                                                          S01194
1138 C********************************************************************S01194
1139 C*
1140 C*    SR. TO RANDOM ACCESS ACCNT FILE.
1141 C*
1142 C           ACACC     BEGSR
1143 C                     SETOF                     10
1144 C           ACKEY     CHAINACCNT                88
1145 C*
1146 C                     ENDSR
1147 C*
1148 C********************************************************************
1149 C**
1150 C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
1151 C**              CONVERT TO A NUMBER OF DAYS.
1152 C**
1153 C           ZDATE1    BEGSR                           *** ZDATE1 ***
1154 C**
1155 C**   CLEAR DAY NUMBER.
1156 C                     Z-ADD0         ZDAYNO  50
1157 C**
1158 C**   CALCULATION TO DEFINE INPUT DATE FIELD.
1159 C                     Z-ADDZDATE     ZDATE   60
1160 C**
1161 C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
1162 C                     MOVE ZDATE     ZYEAR   20
1163 C  N98                MOVELZDATE     ZDAY    20
1164 C   98                MOVELZDATE     ZMTH    20
1165 C                     MOVE ZDATE     ZWRK4   40
1166 C  N98                MOVELZWRK4     ZMTH
1167 C   98                MOVELZWRK4     ZDAY
1168 C**
1169 C**   ENSURE MONTH IS VALID.
1170 C           ZMTH      COMP 0                      9999
1171 C  N99      ZMTH      COMP 12                   99
1172 C   99                GOTO ZDEND1                     BYPASS IF ERROR
1173 C**
1174 C**   CHECK FOR 30 DAY MONTHS.
1175 C           ZMTH      COMP 4                        90IF 90 ON, 30
1176 C  N90      ZMTH      COMP 6                        90DAY MONTH.
1177 C  N90      ZMTH      COMP 9                        90
1178 C  N90      ZMTH      COMP 11                       90
1179 C**
1180 C**   ENSURE DAY IS VALID.
1181 C           ZDAY      COMP 0                      9999
1182 C   90N99   ZDAY      COMP 30                   99
1183 C  N90N99   ZDAY      COMP 31                   99
1184 C   99                GOTO ZDEND1                     BYPASS IF ERROR
1185 C**
1186 C**   CHECK FOR LEAP YEAR AND FEBRUARY.
1187 C           ZYEAR     ADD  28        ZYEAR
1188 C           ZYEAR     DIV  4         ZLYR    20
1189 C                     MVR            ZLY     10     91LEAP YR, 91 ON
1190 C           ZMTH      COMP 2                    93  92FEB., 92 ON
1191 C**                                                   PAST FEB, 93 ON
1192 C**   IF FEBUARY FURTHER VALIDATE DAY.
1193 C  N91 92   ZDAY      COMP 28                   99
1194 C   91 92   ZDAY      COMP 29                   99
1195 C   99                GOTO ZDEND1                     BYPASS IF ERROR
1196 C**
1197 C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
1198 C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
1199 C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
1200 C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
1201 C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
1202 C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
1203 C**
1204 C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
1205 C**
1206 C**
1207 C********************************************************************
1208 C**
1209 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
1210 C**
1211 C           ZDATE2    BEGSR                           *** ZDATE2 ***
1212 C**
1213 C**   CLEAR DATE FIELDS.
1214 C                     Z-ADD0         ZDATE   60
1215 C                     MOVEL'       ' ZADATE  7
1216 C**
1217 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
1218 C                     Z-ADDZDAYNO    ZDAYNO  50
1219 C**
1220 C**   DETERMINE YEAR NUMBER.
1221 C**
1222 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
1223 C           ZDAYNO    SUB  1         ZDAYN1  50   99
1224 C   99                GOTO ZDEND2
1225 C**
1226 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
1227 C           ZDAYN1    DIV  1461      ZLYR    20
1228 C                     MVR            ZDAYN1           SAVE REMAINING
1229 C**                                                   DAYS
1230 C**   CALCULATE NUMBER OF REMAINING YEARS.
1231 C                     Z-ADD1         ZWRK2   20
1232 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
1233 C           ZDAYN1    COMP ZYDY,ZWRK2             90
1234 C  N90      ZWRK2     ADD  1         ZWRK2
1235 C  N90                GOTO ZDTAG1
1236 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
1237 C**
1238 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
1239 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
1240 C**
1241 C**   CALCULATE ACTUAL YEAR NUMBER.
1242 C           ZLYR      MULT 4         ZWRK3   30
1243 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
1244 C                     Z-ADDZWRK3     ZYEAR   20
1245 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
1246 C**
1247 C**   DETERMINE MONTH NUMBER.
1248 C**
1249 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
1250 C                     SETOF                     9293
1251 C   91      ZDAYN1    COMP 59                     9293
1252 C   91N92   ZDAYN1    SUB  1         ZDAYN1
1253 C**
1254 C**   CALCULATE MONTH NUMBER.
1255 C                     Z-ADD2         ZWRK2
1256 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
1257 C           ZDAYN1    COMP ZMDY,ZWRK2             94
1258 C  N94      ZWRK2     ADD  1         ZWRK2
1259 C  N94                GOTO ZDTAG2
1260 C           ZWRK2     SUB  1         ZWRK2
1261 C**
1262 C                     Z-ADDZWRK2     ZMTH    20       MONTH
1263 C**
1264 C**   DETERMINE DAY OF MONTH.
1265 C**
1266 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
1267 C           ZDAYN1    ADD  1         ZDAYN1
1268 C**
1269 C**   CALCULATE DAY OF MONTH.
1270 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
1271 C**
1272 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
1273 C   93      ZDAY      ADD  1         ZDAY
1274 C**
1275 C**   FORMAT DATE, DDMMYY OR MMDDYY.
1276 C  N98                MOVELZDAY      ZWRK4   40
1277 C   98                MOVE ZDAY      ZWRK4
1278 C  N98                MOVE ZMTH      ZWRK4
1279 C   98                MOVELZMTH      ZWRK4
1280 C                     MOVELZWRK4     ZDATE
1281 C                     MOVE ZYEAR     ZDATE
1282 C**
1283 C**   FORMAT ALPHA DATE, DDMMMYY.
1284 C           ZDAY      COMP 10                     95
1285 C                     MOVELZDAY      ZWRK5   5
1286 C   95                MOVEL' '       ZWRK5
1287 C                     MOVE ZMNM,ZMTH ZWRK5
1288 C                     MOVELZWRK5     ZADATE
1289 C                     MOVE ZYEAR     ZADATE
1290 C**
1291 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
1292 C**
1293 C********************************************************************
1294 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
1295 C*   IND '99' IS SET BY AN OVERFLOW ERROR
1296 C*
1297 CSR         GLZADD    BEGSR                           *** GLZADD ****
1298 C*
1299 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
1300 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
1301 C*
1302 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
1303 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
1304 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
1305 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
1306 C*
1307 CSR                   EXSR GLZSUM
1308 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
1309 C*
1310 C********************************************************************
1311 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
1312 C*                        GLZADD, GLZSUB, GLZCMP.
1313 C*          PARAMETERS PASSED -
1314 C*                     I/P ZZAMTI ZZAMTD
1315 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
1316 C*
1317 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
1318 C*
1319 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
1320 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
1321 CSR                   SETOF                     919293
1322 CSR                   SETOF                     949599
1323 C*
1324 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
1325 CSR         ZZAMTI    COMP 0                      9293
1326 CSR 93      ZZAMTD    COMP 0                      9293
1327 CSR 93                GOTO ZZSEND                     ZERO BYPASS
1328 C*
1329 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
1330 CSR         ZZTOTI    COMP 0                      9193
1331 CSR 93      ZZTOTD    COMP 0                      9193
1332 C*
1333 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
1334 CSR 93                Z-ADDZZAMTI    ZZTOTI
1335 CSR 93                Z-ADDZZAMTD    ZZTOTD
1336 CSR 93                GOTO ZZSEND                     ZERO BYPASS
1337 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
1338 CSR 91N92
1339 CORN91 92             GOTO ZZOFPS
1340 C*
1341 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
1342 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
1343 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
1344 C*
1345 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
1346 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
1347 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
1348 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
1349 C*
1350 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
1351 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
1352 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
1353 CSRN99                Z-ADDZZWK2     ZZTOTD
1354 CSRN99                Z-ADDZZWK3     ZZTOTI
1355 C*
1356 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
1357 CSR 99                Z-ADD0         ZZAMT  153
1358 CSR                   GOTO ZZSEND
1359 C*
1360 C* THE 'SIGNS' ARE DIFFERENT
1361 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
1362 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
1363 C*
1364 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
1365 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
1366 C*
1367 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
1368 C*
1369 CSR 91                Z-SUBZZTOTI    ZZTOTI
1370 CSR 91                Z-SUBZZTOTD    ZZTOTD
1371 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
1372 C*
1373 CSR         ZZTOTI    COMP ZZAMTI               93  95
1374 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
1375 C*
1376 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
1377 CSR 95                Z-ADD0         ZZTOTI
1378 CSR 95                Z-ADD0         ZZTOTD
1379 CSR 95                GOTO ZZSEND
1380 C*
1381 C* IF ZZTOT GT. ZZAMT.
1382 CSR 93      ZZAMTD    COMP ZZTOTD               94
1383 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
1384 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
1385 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
1386 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
1387 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
1388 C*
1389 C*
1390 C* IF ZZAMT GT. ZZTOT.
1391 CSRN93      ZZTOTD    COMP ZZAMTD               94
1392 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
1393 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
1394 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
1395 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
1396 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
1397 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
1398 C*
1399 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
1400 CSR                   SETOF                     94
1401 CSR 93 91
1402 CORN93 92             SETON                     94
1403 CSR 94                Z-SUBZZTOTI    ZZTOTI
1404 CSR 94                Z-SUBZZTOTD    ZZTOTD
1405 C**
1406 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
1407 CSR 92                Z-SUBZZAMTI    ZZAMTI
1408 CSR 92                Z-SUBZZAMTD    ZZAMTD
1409 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
1410 C**
1411 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
1412 CSR                   SETOF                     96
1413 CSR         ZZTOTD    COMP 0                        91
1414 CSR 91      ZZTOTI    COMP 0                      96
1415 CSR 96                MOVE '.000-'   ZZNEGD  5
1416 CSR                   ENDSR                             ** ENDSR **
1417 C********************************************************************
     C*
     C*   ZTNLU1 SR. - TO LOCK THE TRANSACTION NUMBER DATA AREA AND
     C*                THEN UPDATE AND RELEASE THE DATA AREA.
     C*
     C           ZTNLU1    BEGSR
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C                     ENDSR
     C*****************************************************************   S01117
 707 C********************************************************************
     C**   FILE EXCEPTION/ERROR HANDLING SUBROUTINE
     C           INFSR     BEGSR
     C**   CHECK ERROR TYPE
     C           STATUS    IFEQ 01021
     C**   CHAIN TO FILE TO GET CURRENT DETAILS
     C***********HLDKEY    CHAINHELDI                76                   S01117
     C           HLDKY1    CHAINHELDIL1              76                   S01117
     C**
     C           *IN76     IFEQ '0'
     C**   ROLLBACK UPDATES ALREADY DONE
     C                     ROLBK
     C**   SET OFF'RECORD UPDATED....' INDICATOR
     C                     SETOF                     79
     C**   RESET OTHER INDICATORS
     C                     SETOF                     487173
     C                     SETOF                     75
     C**
     C                     MOVE '*DETC '  EXTTAG  6
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C*
     C                     ENDSREXTTAG
     C*****************************************************************
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE0252CP11                                           S01408
     C*                                                                   S01408
     C/EJECT
1418 O*    OUTPUT TO WORK-STATION.
1419 O*
1420 ORE0252FMD        01N40
1421 O       OR        02N40
1421 O       OR        17N40
1422 O       OR        03N40
1423 O       OR        04N40
1424 O       OR        41N40
1425 O                                   K8 'RE0252F1'
1426 O                                    2 'SF'
1427 O                 52                 2 'SI'
1427 O                 81                 2 'SA'
1428 O                 53                 2 'SD'
1429 O                 54                 2 'SE'
1430 O                         MTIME     10 '  .  .  '
1431 O                         WSID      13
1432 O                 43 59 72BRCDS     16                               S01117
1433 O                 43 59 72          17 '-'                           S01117
1432 O*****            43 59   CNUMS     19                               S01117
1432 O                 43 59   CNUMS     23                               S01117
1433 O*****            43 59             20 '-'                           S01117
1433 O                 43 59             24 '-'                           S01117
1434 O*****            43 59   CCYS      23                               S01117
1434 O                 43 59   CCYS      27                               S01117
1435 O*****            43 59             24 '-'                           S01117
1435 O                 43 59             28 '-'                           S01117
1436 O*****            43 59   ACODS     28                               S01117
1436 O**********       43 59   ACODS     32                                            S01117 CGL029
     O                 43 59   ACODS     38                                                   CGL029
1437 O*****            43 59             29 '-'                           S01117
1437 O**********       43 59             33 '-'                                        S01117 CGL029
     O                 43 59             39 '-'                                               CGL029
1438 O*****            43 59   ACSQS     31                               S01117
1438 O**********       43 59   ACSQS     35                                            S01117 CGL029
     O                 43 59   ACSQS     41                                                   CGL029
1432 O                 72 43 60BRCA      16                               S01117
1433 O                 72 43 60          17 '-'                           S01117
1439 O*****               43 60CNUMAC    19                               S01117
1432 O                    43 60CNUMAC    23                               S01117
1440 O*****               43 60          20 '-'                           S01117
1433 O                    43 60          24 '-'                           S01117
1441 O*****               43 60CCYAC     23                               S01117
1434 O                    43 60CCYAC     27                               S01117
1442 O*****               43 60          24 '-'                           S01117
1435 O                    43 60          28 '-'                           S01117
1443 O*****               43 60ACODAC    28                               S01117
1436 O**********          43 60ACODAC    32                                            S01117 CGL029
     O                    43 60ACODAC    38                                                   CGL029
1444 O*****               43 60          29 '-'                           S01117
1437 O**********          43 60          33 '-'                                        S01117 CGL029
     O                    43 60          39 '-'                                               CGL029
1445 O*****               43 60ACSQAC    31                               S01117
1438 O**********          43 60ACSQAC    35                                            S01117 CGL029
     O                    43 60ACSQAC    41                                                   CGL029
1446 O*****            43 60   RACNOS    41                               S01117
1446 O**********       43 60   RACNOS    64                                            S01117 CGL029
     O                 43 60   RACNOS    76                                                   CGL029
1447 O*****            43      REFNOS    44                               S01117
1447 O**********       43      REFNOS    67                                            S01117 CGL029
     O                 43      REFNOS    79                                                   CGL029
1448 O*****            43      ACTS      45                               S01117
1448 O**********       43      ACTS      68                                            S01117 CGL029
     O                 43      ACTS      80                                                   CGL029
1449 O*****            43N50   BNCHSF    48                               S01117
1450 O*****            43N50   CCYI      51                               S01117
1450 O**********       43N50   CCYI      71                                            S01117 CGL029
     O                 43N50   CCYI      83                                                   CGL029
1451 O*****            43 20N50HELDN     65 '           0 '               S01117
1451 O**********       43 20N50HELDN     85 '           0 '                            S01117 CGL029
     O                 43 20N50HELDN     97 '           0 '                                   CGL029
1452 O*****            43 21N50HELDN     65 '          0 . '              S01117
1452 O**********       43 21N50HELDN     85 '          0 . '                           S01117 CGL029
     O                 43 21N50HELDN     97 '          0 . '                                  CGL029
1453 O*****            43 22N50HELDN     65 '         0 .  '              S01117
1453 O**********       43 22N50HELDN     85 '         0 .  '                           S01117 CGL029
     O                 43 22N50HELDN     97 '         0 .  '                                  CGL029
1454 O*****            43 23N50HELDN     65 '        0 .   '              S01117
1454 O**********       43 23N50HELDN     85 '        0 .   '                           S01117 CGL029
     O                 43 23N50HELDN     97 '        0 .   '                                  CGL029
     O*                                                                   S01408
     O/COPY WNCPYSRC,RE0252OOP2                                           S01408
     O*                                                                   S01408
1455 O*****            43N50 65HELD      65                               S01117
1455 O**********       43N50 65HELD      85                                            S01117 CGL029
     O                 43N50 65HELD      97                                                   CGL029
1456 O*****            43N50   EXPD      71                               S01117
1456 O**********       43N50   EXPD      91                                            S01117 CGL029
1457 O**********          02 KJHELD      65                                            S01117 CGL029
1457 O**********          02 KJHELD      85                                            S01117 CGL029
1458 O**********          02 KJEXPD      71                                            S01117 CGL029
1458 O**********          02 KJEXPD      91                                            S01117 CGL029
1456 O                 43N50   EXPD     103                                                   CGL029
1457 O                    02 KJHELD      77                                                   CGL029
1457 O                    02 KJHELD      97                                                   CGL029
1458 O                    02 KJEXPD      83                                                   CGL029
1458 O                    02 KJEXPD     103                                                   CGL029
1459 O*****            43N50   HLDN      91                               S01117
1459 O**********       43N50   HLDN     111                                            S01117 CGL029
     O                 43N50   HLDN     123                                                   CGL029
1460 O*****                    ERCD     115                               S01117
1460 O**********               ERCD     187                                            LN0083 CGL029
     O                         ERCD     199                                                   CGL029
1461 O*****                    ERMSG    243                               S01117
1461 O**********               ERMSG    263                                            LN0083 CGL029
1449 O**********               BNCHSF   266                                            S01117 CGL029
     O                         ERMSG    275                                                   CGL029
     O                         BNCHSF   278                                                   CGL029
1462 O*****                    CNUM     249                               S01117
1462 O**********               CNUM     272                         S01117LN0083
1462 O**********               CNUMA    272                                            LN0083 CGL029
     O                         CNUMA    284                                                   CGL029
1463 O*****                    CCYSF    252                               S01117
1463 O**********               CCYSF    275                                            S01117 CGL029
     O                         CCYSF    287                                                   CGL029
1464 O*****                    ACOD     256                               S01117
1464 O**********               ACOD     279                         S01117LN0083
1464 O**********               ACODA    279                                            LN0083 CGL029
     O                         ACODA    297                                                   CGL029
1465 O*****                    ACSQ     258                               S01117
1465 O**********               ACSQ     281                                            S01117 CGL029
     O                         ACSQ     299                                                   CGL029
1466 O*****                    RACNO    268                               S01117
1466 O**********               RACNO    291                                            S01117 CGL029
     O                         RACNO    309                                                   CGL029
1467 O*****                    XREFNO   271                               S01117
1467 O**********               XREFNO   294                                            S01117 CGL029
     O                         XREFNO   312                                                   CGL029
1468 O*****                    ACT      272                               S01117
1468 O**********               ACT      295                                            S01117 CGL029
     O                         ACT      313                                                   CGL029
1469 O*****            54      BLK58    272                               S01117
1469 O**********       54      BLK58    295                                            S01117 CGL029
     O                 54      BLK58    313                                                   CGL029
1470 O*****            41 83 84BLK58    272                               S01117
1470 O**********       41 83 84BLK58    295                                            S01117 CGL029
     O                 41 83 84BLK58    313                                                   CGL029
1569 O*
     O*                                                                   S01408
     O/COPY WNCPYSRC,RE0252OOP3                                           S01408
     O*                                                                   S01408
1570 O*****HELDI*FILE OUTPUT.                                             S01117
1570 O*    HELDIL1 FILE OUTPUT.                                           S01117
1571 O*    INSERTION - NEW.
1572 OHELDIHB E        71N12N14
1573 O                                    1 'D'
1574 O**********               HLDKEY    19                                                   CGL029
     O                         WFLD2     10                                                   CGL029
     O                         ACSQ      16                                                   CGL029
     O                         REFNO     19                                                   CGL029
1575 O                 60      RACNO     29
1576 O                         RUND      32P
1577 O                         ZDAYNO    35P
1578 O                         HELDN     42P
1579 O                         HLDN      62
1580 O                         BNCH      65
1581 O                                   74 'I'
1582 O                         RUND      77P
1583 O                         NATN      80P
     O                         WHACOD    90                                                   CGL029
1584 O*
1585 O*    INSERTION OVER A DELETED RECORD OR DELETION.
1586 O*ELDI***E**      71 12                                              S01117
1586 OHELDIL1 E        71 12                                              S01117
1587 O       OR        71 14
1588 O**********               LOTHD     80                                                   CGL029
     O**********               LOTHD     90                                         CGL029 MD034451C
     O                         LOTHD    117                                                MD034451C
1589 O                 02                 1 'D'
1590 O                 03                 1 '*'
1591 O                N03      RUND      32P
1592 O                N03      ZDAYNO    35P
1593 O                N03      HELDN     42P
1594 O                N03      HLDN      62
1595 O                N03      BNCH      65
1596 O                         ACT       74
1597 O                         RUND      77P
1598 O                         NATN      80P
1599 O*
1600 O*    UPDATE TRAILER.
1601 O        E        73
1602 O**********               NHII      37P                                                 BUG3584
1603 O**********               NHID      39P                                                 BUG3584
1604 O**********               VIHW      47P                                                 BUG3584
1605 O**********               VIHD      49P                                                 BUG3584
1606 O**********               VDHW      57P                                                 BUG3584
1607 O**********               VDHD      59P                                                 BUG3584
1608 O**********               NHAU      61P                                                 BUG3584
1609 O**********               VHAW      69P                                                 BUG3584
1610 O**********               VHAD      71P                                                 BUG3584
1611 O**********               RUND      74P                                                 BUG3584
1612 O**********               NATN      77P                                                 BUG3584
     O                         NHII      45P                                                 BUG3584
     O                         NHID      49P                                                 BUG3584
     O                         VIHW      57P                                                 BUG3584
     O                         VIHD      59P                                                 BUG3584
     O                         VDHW      67P                                                 BUG3584
     O                         VDHD      69P                                                 BUG3584
     O                         NHAU      73P                                                 BUG3584
     O                         VHAW      81P                                                 BUG3584
     O                         VHAD      83P                                                 BUG3584
     O                         RUND      86P                                                 BUG3584
     O                         NATN      89P                                                 BUG3584
1613 O*
1616 O*
1617 O*    ACCNT FILE OUTPUT.
1618 OACCNT   E        71
1619 O                         HELDAB   227P
     O*                                                                   E80473
     O*    RELEASE ACCNT FILE                                             E80473
     OACCNT   E        75                                                 E80473
     O*                                                                   E80473
     O*****RELEASE HELDI FILE                                       E80473S01117
     O*    RELEASE HELDIL1 FILE                                           S01117
     O*ELDI***E**      48                                           E80473S01117
     OHELDIL1 E        48                                                 S01117
      *
      ** BHF669 CHANGED 5TH MESSAGE FROM INVALID KEY
     O*                                                                   S01408
     O/COPY WNCPYSRC,RE0252OOP1                                           S01408
     O*                                                                   S01408
**   ERRMSG - ERROR MESSAGES
INVALID ACTION CODE
HELD ITEM NOT FOUND
HELD ITEM ALREADY ON FILE
INVALID COMMAND KEY
PRESS F10 TO DELETE
RECORD HAS BEEN UPDATED BY ANOTHER WORK-STATION
ACCOUNT CLOSED
ACCOUNT DOES NOT EXIST
USER IS NOT AUTHORISED TO THE ACTION CODE FOR THIS MENU ITEM
USER NOT AUTHORISED TO ANY ACTION CODES FOR THIS MENU ITEM & BRANCH
USER NOT AUTHORISED TO THE ACTION CODE FOR THIS MENU ITEM & BRANCH
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
