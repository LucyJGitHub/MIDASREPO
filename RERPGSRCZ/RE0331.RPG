     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Sweep listing')                               *
      *****************************************************************
      *                                                               *
      *  Midas - Retail Module                                        *
      *                                                               *
      *  RE0331 - Sweeps Listing                                      *
      *                                                               *
      *  Function:  This program will run daily during Close of       *
      *  (COB/IC)   Business to print the details of any Sweeps       *
      *             which have been inserted, amended or deleted.     *
      *             It will be also available in Input Cycle as an    *
      *             audit list or as a full list of all Sweeps        *
      *                                                               *
      *  Called By: REC0331 - Sweep List Control                      *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. 262066             Date 15Apr20               *
      *  Prev Amend No. AR316754           Date 15Sep17               *
      *                 MD046248           Date 27Oct17               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CRE401             Date 26Nov09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 214573             Date 14Feb03               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 172956             Date 27Dec00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 148954             Date 14Apr99               *
      *                 155495             Date 07Mar99               *
      *                 CEU022             Date 13Mar98               *
      *                 CRE004 *CREATE     Date 20Jan97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  262066 - MSGW on REC0331 because of printer overflow. Apply  *
      *           241380, which makes sure that before writing next   *
      *           detail, enough lines are available. Also applied    *
      *           243365 to reduce number of blank lines before End   *
      *           of Report line is printed.                          *
      *         - Applied for MD-54390.                               *
      *  AR316754 - Incorrect DR, CR indicator displayed in RE0331P1. *
      *             Amended in such that Dr,CR indi are displayed     *
      *             correctly on Report RE0331P1.                     *
      *           - Applied for MD042922.                             *
      *  MD046248 - Finastra Rebranding                               *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CRE401 - 4-Eyes Checking Gaps - Sweeps                       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  214573 - RE0331 no longer removes deleted records from the   *
      *           sweeps file.  Fix is to ensure that deleted sweeps  *
      *           are still processed.                                *
      *  172956 - Ignore deleted Sweeps. Also do not produce DB error *
      *           if A/C not on ACCNTAB, but rather output "A/C not   *
      *           found" message in sweep type field of RE0331P1.     *
      *           Some sweeps have been entered using the             *
      *           retail number rather than the full GL a/c key. This *
      *           leads to problems, as teh report only prints out    *
      *           the GL key at 2.10. Amend program to get full GL    *
      *           key if this is not on file, by using the retail     *
      *           number.                                             *
      *  148954 - Include the currencies of origin and sweep A/cs in  *
      *           the report since multi-currency Sweeps is allowed   *
      *           if CEU022 is installed; display correct narrative   *
      *           for sweep type = '4'; whether or not retail A/c     *
      *           nos. are required, show full account on the report  *
      *  155495 - Edit reporting of Threshold amount always 2 dec     *
      *           places and not according to debit code ccy .        *
      *  CEU022 - EMU Retail Utilities                                *
      *  CRE004 - Sweep Acccounting                                   *
      *                                                               *
      *****************************************************************
     F/COPY WNCPYSRC,RE0331F001
      *
     FRESWEPL1UF  E           K        DISK
     FRE0331AUO   E                    PRINTER                        UC
     F                                              KINFDS SPOOLU
     FRE0331P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL1
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *   37  - Multibranching ON                                     *
      * 50-52 - Used to condition Report Title                        *
      *                                                               *
      *   89  - End of File                                           *
      *                                                               *
      *   98  - Date Format: DDMMYY (off); MMDDYY (on)                *
      * 90-99 - Used by Standard Subroutines                          *
      *                                                               *
      * U7+U8 - Database Error                                        *
      *                                                               *
      *****************************************************************
     F/SPACE 3
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  INIT   - Program Initialisation                              *
      *                                                               *
      *  DETL   - Format and Write a Detail Record to the Report      *
      *  CHGBR  - Change in branch processing                         *
      *  TERM   - Termination Processing                              *
      *                                                               *
      *  AUDIT  - Produce Audit Report and End Program                *
      *  *PSSR  - Program Error Processing Subroutine                 *
      *  RCFP1  - RCF Processing for P1 Report                        *
      *  RCFAU  - RCF Processing for Audit Report                     *
      *                                                               *
      *  ZDATE2 - Convert Midas Day Number into Date (DDMMYY/MMDDYY)  *
      *  ZFRPED - Edit Amount                                         *
      *                                                               *
      *****************************************************************
     E/EJECT
     E                    CPY@    1   1 80
      *
      ** Array containing Copyright statement
      *
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY WNCPYSRC,RE0331E001
     I/SPACE 3
     I/COPY WNCPYSRC,RE0331I002
     I/COPY ZSRSRC,ZFRPEDZ2
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     IRUNDAT    E DSRUNDAT
      *
      ** Data Area giving Installation Control Details
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure
      *
     I                                     *PROGRAM PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     ISPOOL1      DS
      ***  File Information Data Structure for RE0331P1.
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I                                    B 188 1890OFLLN1
     I                                    B 367 3680PRTLN1
      *
     ISPOOLU      DS
      ***  File Information Data Structure for RE0331AU.
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IACCNT1      DS
      *** DBKEY Data Structure for CR A/c of Origin
     I                                        1  10 CDRAN
     I                                       11  16 CDCUS
     I                                       17  19 CCCY
     I**********                             20  23 CDACD                                     CGL029
     I**********                             24  25 CDACS                                     CGL029
     I**********                             26  28 CDRBR                                     CGL029
     I                                       20  29 CDACD                                     CGL029
     I                                       30  31 CDACS                                     CGL029
     I                                       32  34 CDRBR                                     CGL029
     IACCNT2      DS
      *** DBKEY Data Structure for CR Sweep Account
     I                                        1  10 CCRAN
     I                                       11  16 CCCUS
     I                                       17  19 CCCCY
     I**********                             20  23 CCSCA                                     CGL029
     I**********                             24  25 CCACD                                     CGL029
     I**********                             26  28 CCBRC                                     CGL029
     I                                       20  29 CCSCA                                     CGL029
     I                                       30  31 CCACD                                     CGL029
     I                                       32  34 CCBRC                                     CGL029
      *
      ***  Dummy Data Structures used by Access Programs.
      *
     ISDBANK    E DSSDBANKPD
      ***  External data structures for Bank Details
     ISDRETL    E DSSDRETLPD
      ***  External data structures for Retail Details
     ISDBRCH    E DSSDBRCHPD
      ***  External data structures for Branch Details
     ISDACCT    E DSACCNTAB
      ***  External data structure for Account Details
     ISDCURR    E DSSDCURRPD
      *** External data structure for Currency Details
     I/COPY WNCPYSRC,RE0331I001
     IDSFDY     E DSDSFDY
      *** Short Data Structure - used as parameter to access programs
     IDSSDY     E DSDSSDY
      *** Long Data Structure  - used as parameter to access programs
     I/COPY WNCPYSRC,RE0331I003
     I              'MAINTAIN MAXIMUM BAL-C         SW1
     I              'ANCE'
     I              'MAINTAIN MINIMUM BAL-C         SW2
     I              'ANCE'
     I/COPY WNCPYSRC,RE0331I004
     I              'MAINTAIN SPECIFIED B-C         SW3
     I              'ALANCE'
     I              'SWEEP MAPPING'       C         SW4                         148954
     I              'DR A/C NOT FOUND'    C         WACNOF                      172956
     I              'CR A/C NOT FOUND'    C         ZACNOF                      172956
     I              'CR AND DR A/C NOT FO-C         BACNOF                      172956
     I              'UND'                                                       172956
      *** Sweep Type Description
      *
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ***  Perform Initialisation.
      *
     C                     EXSR INIT
      *
      ***  Depending on Branch Parameter,
      ***  position the file pointer then
      ***  read first available record.
      *
     C           PBRCA     IFEQ *BLANK
     C           PBRCA     OREQ 'ALL'
     C           *LOVAL    SETLLRESWEPD0
     C                     READ RESWEPD0                 89
     C                     ELSE
     C           PBRCA     SETLLRESWEPD0
     C           PBRCA     READERESWEPD0                 89
     C                     ENDIF
      *
      ***  Do While not End of File.
      *
     C           *IN89     DOWEQ*OFF
      *
      ***  Accumulate record count
      *
     C           CRE401    IFEQ 'N'                                                           CRE401
     C           CRE401    OREQ 'Y'                                                           CRE401
     C           AUTH      ANDEQ'Y'                                                           CRE401
      *                                                                                       CRE401
     C                     ADD  1         RCOUNT
      *
      ***  Process Report Lines.
      *
     C           PMODE     IFEQ 'F'
     C           PMODE     OREQ 'A'
     C/COPY WNCPYSRC,RE0331C025
     C           LCD       ANDEQBJRDNB
     C/COPY WNCPYSRC,RE0331C026
      *
      ***  Change in Branch - Create new report file
      *
     C           BRCA      IFNE SVBRCA
     C                     EXSR CHGBR
     C                     ENDIF
      *
      ***  Format and Write a Detail Record to Report File
      *
     C********** RECI      IFEQ 'D'                                                    172956 214573
     C                     EXSR DETL
     C**********           ENDIF                                                       172956 214573
      *
     C                     ENDIF
      *                                                                                       CRE401
     C                     ENDIF                                                              CRE401
      *
      ***  Read next record.
      *
     C                     READ RESWEPD0                 89
      *
      *** If Parameter Branch (PBRCA) is not equal to Branch Read
      ***     (Done when processing a specific branch)
      *
     C           PBRCA     IFNE 'ALL'
     C           PBRCA     ANDNE*BLANK
     C           PBRCA     ANDNEBRCA
     C                     LEAVE
     C                     ENDIF
      *
      ***  End of Do While not End of File.
      *
     C                     ENDDO
      *
      ***  Write final records and Totals to Report.
      *
     C                     EXSR TERM
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *================================================================
     C/TITLE SR/INIT
      *****************************************************************
      *                                                               *
      *  INIT   - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    : RCFAU - RCF Processing for Audit Report           *
      *             AOBANKR0 Access Program                           *
      *             AORETLR0 Access Program                           *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR                           ***  INIT  ***
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *
      ***  Receive Parameter List.
      *
     C           *ENTRY    PLIST
     C                     PARM           PSTAT   1
     C                     PARM           PMODE   1
     C                     PARM           PSEQ    5
     C                     PARM           PBRCA   3
      *
      ***  Call Access Program for Bank Details - Title, Run Date and
      ***  Run Day Number.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ***  Handle Database Error.
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVELWOPTN     DBKEY
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     MOVEL'RE0331'  DBPGM            * DBERR 01 *
     C                     Z-ADD001       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  Call Access Program for Retail ICD
      *
     C                     CALL 'AORETLR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDRETL    PARM SDRETL    DSFDY
      *
      ***  Handle Database Error.
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVELWOPTN     DBKEY
     C                     MOVEL'SDRETLPD'DBFILE           ************
     C                     MOVEL'RE0331'  DBPGM            * DBERR 02 *
     C                     Z-ADD002       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  Check System Date Format, DDMMYY (*IN98 off)
      ***                            MMDDYY (*IN98 on).
      *
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     ENDIF
      *
      **   Access RUNDAT for multibranching indicator
      *
     C           *NAMVAR   DEFN           RUNDAT
     C           *NAMVAR   DEFN           LDA
     C                     IN   RUNDAT
      *
     C           AGMBIN    IFEQ 'Y'
     C                     SETON                     37
     C                     END
      *
      **  Access Switchable SAR details for the existence of CEU022       CEU022
     C                     CALL 'AOSARDR0'                                CEU022
     C                     PARM *BLANK    @RTCD                           CEU022
     C                     PARM '*VERIFY' @OPTN                           CEU022
     C                     PARM 'CEU022'  @SARD   6                       CEU022
      *                                                                   CEU022
     C           @RTCD     IFEQ *BLANK                                    CEU022
     C                     MOVE 'Y'       CEU022  1                       CEU022
     C                     ELSE                                           CEU022
     C                     MOVE 'N'       CEU022                          CEU022
     C                     ENDIF                                          CEU022
      *                                                                                       CRE401
      **  Access Switchable SAR details for the existence of CRE401                           CRE401
      *                                                                                       CRE401
     C                     CALL 'AOSARDR0'                                                    CRE401
     C                     PARM *BLANK    @RTCD                                               CRE401
     C                     PARM '*VERIFY' @OPTN                                               CRE401
     C                     PARM 'CRE401'  @SARD                                               CRE401
      *                                                                                       CRE401
     C           @RTCD     IFEQ *BLANK                                                        CRE401
     C                     MOVE 'Y'       CRE401  1                                           CRE401
     C                     ELSE                                                               CRE401
     C                     MOVE 'N'       CRE401                                              CRE401
     C                     ENDIF                                                              CRE401
      *
      ***  Open Audit Printer File
      *
     C           AUOPEN    IFNE 'Y'
     C                     OPEN RE0331AU
     C                     MOVE 'Y'       AUOPEN  1
     C                     ENDIF
     C/COPY WNCPYSRC,RE0331C001
      *
      ***  RCF Processing for Audit File.
      *
     C                     EXSR RCFAU
      *
      ***  Report Work fields.
      *
     C                     Z-ADD0         RQDLN1  30
     C                     Z-ADD0         DIFLN1  30
     C                     Z-ADD0         WINS    50
     C                     Z-ADD0         WAMD    50
     C                     Z-ADD0         WDEL    50
     C                     Z-ADD0         RCOUNT  50
     C                     Z-ADD0         WTOTP   50
     C                     MOVE *BLANK    SVBRCA  3
     C                     MOVE *BLANK    P1OPEN  1
      *
      ***  Setup Report and Audit Header
      *
     C           PSTAT     IFEQ 'I'
     C           PMODE     IFEQ 'A'
     C                     SETON                     50
     C                     ELSE
     C                     SETON                     51
     C                     ENDIF
     C                     ELSE
     C                     SETON                     52
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/CHGBR
      *****************************************************************
      *                                                               *
      *  CHGBR - Change in Branch Processing.                         *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    : RCFP1 - RCF Processing for P1 Report              *
      *             AOBRCHR0 Access Program                           *
      *                                                               *
      *****************************************************************
      *
     C           CHGBR     BEGSR                           *** CHGBR ***
      *
     C           P1OPEN    IFEQ 'Y'
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
     C/COPY WNCPYSRC,RE0331C002
      *
     C**********           Z-ADD5         RQDLN1                                              262066
     C                     Z-ADD6         RQDLN1                                              262066
     C/COPY WNCPYSRC,RE0331C003
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C/COPY WNCPYSRC,RE0331C004
     C                     WRITEDTLHDR
     C/COPY WNCPYSRC,RE0331C005
     C                     ENDIF
      *
     C                     WRITETRAILP1
     C                     CLOSERE0331P1
     C                     MOVE 'N'       P1OPEN
      *
     C                     ENDIF
      *
      *** Call access program for Branch Details, Branch Name
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY    'WOPTN   7
     C                     PARM           BRCA
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVELBRCA      DBKEY
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     MOVEL'RE0331'  DBPGM            * DBERR 03 *
     C                     Z-ADD003       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      *** Move Branch Code & Name to report - Heading & trailer
      *
     C                     MOVELBRCA      RBRCA     P
     C                     MOVELA8BRNM    RDESC     P
      ***  Open Printer file
      *
     C                     OPEN RE0331P1
     C                     MOVE 'Y'       P1OPEN
      *
      ***  RCF Processing for Printer File.
      *
     C                     EXSR RCFP1
      *
      ****  Write Report File Header
      *
     C                     WRITEHEADP1
     C/COPY WNCPYSRC,RE0331C006
     C                     WRITEDTLHDR
     C/COPY WNCPYSRC,RE0331C007
      *
      ***  Move Branch to save branch field
      *
     C                     MOVE BRCA      SVBRCA
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/DETL
      *****************************************************************
      *                                                               *
      *  DETL  - Subroutine to Write a Detail record to the Report.   *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    : AOACCTR0 Access Program                           *
      *                                                               *
      *****************************************************************
      *
     C           DETL      BEGSR                           *** DETL ***
      *
      ***  Save Record Id, Last Change Type & Date
      *
     C                     MOVE RECI      SVRECI  1
     C                     MOVE CHTP      SVCHTP  1
     C/COPY WNCPYSRC,RE0331C027
     C                     MOVE LCD       SVLCD   50
     C/COPY WNCPYSRC,RE0331C028
      *
      ***  Move Sweeps Reference No.
      *
     C                     MOVE SWEP      RSWEP
      *
      ***  Format Start Date and Last Change Date
      *
     C                     MOVE NXTP      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RSDAT
     C           SVRECI    IFEQ 'D'                                                           214573
      *
      ***  Format CR A/c of Origin
      *****(If*Retail*A/c*Number*Used*Flag*is*'Y'**************           148954
      *****{SDRETLPD/BMRANR='Y'},*print*Account Number*(ACNO)**           148954
      *****from*PF/ACCNTAB*otherwise*print*Midas*full*Account**           148954
      *****Number*(DCUS*+*DACD*+*DACS)*************************           148954
      *
     C                     MOVE *BLANK    RCRAO
     C***********BMRANR    IFEQ 'Y'                                       148954
      *
     C                     MOVE DRAN      CDRAN
     C                     MOVE DCUS      CDCUS
     C                     MOVE CCY       CCCY
     C                     MOVE CCY       WCCY1   3                                           214573
     C                     MOVE DACD      CDACD
     C                     MOVE DACS      CDACS
     C                     MOVE DRBR      CDRBR
      *
     C                     CALL 'AOACCTR0'
     C                     PARM '*BLANKS 'WRTCD   7
     C                     PARM '*KEY    'WOPTN   7
     C                     PARM           CDRAN
     C                     PARM           CDCUS
     C                     PARM           CCCY
     C                     PARM           CDACD
     C                     PARM           CDACS
     C                     PARM           CDRBR
     C           SDACCT    PARM SDACCT    DSSDY
      *
      *****Handle*Database*Error.                                         172956
      *
     C********** WRTCD     IFNE *BLANK                                    172956
     C********** *LOCK     IN   LDA                                       172956
     C**********           MOVELACCNT1    DBKEY                           172956
     C**********           MOVEL'ACCNTAB 'DBFILE           ************   172956
     C**********           MOVEL'RE0331'  DBPGM            * DBERR 04 *   172956
     C**********           Z-ADD004       DBASE            ************   172956
     C**********           OUT  LDA                                       172956
     C**********           EXSR *PSSR                                     172956
     C**********           ENDIF                                          172956
      *                                                                   172956
      ** If the return code is blank, set up the full GL key from A/O     172956
      ** into the output fields.                                          172956
      *                                                                   172956
     C           WRTCD     IFEQ *BLANKS                                   172956
     C                     MOVE CNUM      DCUS                            172956
     C                     MOVE CCY       CCY                             172956
     C                     MOVE ACOD      DACD                            172956
     C                     MOVE ACSQ      DACS                            172956
     C                     MOVE BRCA      DRBR                            172956
     C                     MOVEL' '       XACNOF                          172956
     C                     ELSE                                           172956
      *                                                                   172956
      ** Instead of a database error, print out "A/C not found" in        172956
      ** sweep type field if AOACCNTR0 fails to find a/c.                 172956
      *                                                                   172956
     C                     MOVE WCCY1     CCY                                                 214573
     C                     MOVEL'1'       XACNOF  1                       172956
     C                     ENDIF                                          172956
      *
      ****Print*Retail*Account*Number**************************           148954
      *
     C***********          MOVELACNO      RCRAO     P                     148954
      *
      *****Move*ACCNTAB*Branch*Code****************************           148954
      *
     C***********          MOVE BRCA      RDRBR                           148954
      *
     C***********          ELSE                                           148954
      *
      ***  Move CR A/c of Origin Branch
      *
     C                     MOVE DRBR      RDRBR
      *
      *** Print Midas Full Account Number
      *
      ** Only if a/c was found. Otherwise print whatever information      172956
      ** is on file (full G/L account or retail number) depending on      172956
      ** how sweep was entered.                                           172956
      *                                                                   172956
     C           XACNOF    IFNE '1'                                       172956
     C********** DCUS      ORNE *ZEROS                                                 172956 CSD027
     C           DCUS      ORNE *BLANKS                                                       CSD027
     C                     MOVE DCUS      WDCUS   6
     C                     MOVE CCY       WDCCY   3                       148954
     C**********           MOVE DACD      WDACD   4                                           CGL029
     C                     MOVE DACD      WDACD  10                                           CGL029
     C                     MOVE DACS      WDACS   2
     C           RCRAO     CAT  WDCUS:0   RCRAO
     C           RCRAO     CAT  '-':0     RCRAO
     C           RCRAO     CAT  WDCCY:0   RCRAO                           148954
     C           RCRAO     CAT  '-':0     RCRAO                           148954
     C           RCRAO     CAT  WDACD:0   RCRAO
     C           RCRAO     CAT  '-':0     RCRAO
     C           RCRAO     CAT  WDACS:0   RCRAO
     C                     ELSE                                           172956
     C                     MOVELDRAN      RCRAO     P                     172956
     C                     ENDIF                                          172956
     C***********          ENDIF                                          148954
      *
      ***  Format CR Sweep Account
      *****(If*Retail*A/c*Number*Used*Flag*is*'Y'**************           148954
      *****{SDRETLPD/BMRANR='Y'},*print*Account*Number*(ACNO)**           148954
      *****from*PF/ACCNTAB*otherwise*print*Midas*full*Account**           148954
      *****Number*(CCUS*+*CSCA*+*CACD)*************************           148954
      *
     C                     MOVE *BLANK    RCRSA
     C***********BMRANR    IFEQ 'Y'                                       148954
      *
     C                     MOVE CRAN      CCRAN
     C                     MOVE CCUS      CCCUS
     C           CEU022    IFEQ 'Y'                                       CEU022
     C                     MOVE CCYC      CCCCY                           CEU022
     C                     ELSE                                           CEU022
     C                     MOVE CCY       CCCCY
     C                     ENDIF                                          CEU022
     C                     MOVE CCY       WCCY1                                               214573
     C                     MOVE CSCA      CCSCA
     C                     MOVE CACD      CCACD
     C                     MOVE CBRC      CCBRC
      *
     C                     CALL 'AOACCTR0'
     C                     PARM '*BLANKS 'WRTCD   7
     C                     PARM '*KEY    'WOPTN   7
     C                     PARM           CCRAN
     C                     PARM           CCCUS
     C                     PARM           CCCCY
     C                     PARM           CCSCA
     C                     PARM           CCACD
     C                     PARM           CCBRC
     C           SDACCT    PARM SDACCT    DSSDY
      *
      *****Handle*Dabase*Error.                                           172956
      *
     C********** WRTCD     IFNE *BLANK                                    172956
     C********** *LOCK     IN   LDA                                       172956
     C**********           MOVELACCNT2    DBKEY                           172956
     C**********           MOVEL'ACCNTAB 'DBFILE           ************   172956
     C**********           MOVEL'RE0331'  DBPGM            * DBERR 05 *   172956
     C**********           Z-ADD005       DBASE            ************   172956
     C**********           OUT  LDA                                       172956
     C**********           EXSR *PSSR                                     172956
     C**********           ENDIF                                          172956
      *                                                                   172956
      ** If the retail number was used, move the full customer number     172956
      ** into the output fields.                                          172956
      *                                                                   172956
     C           WRTCD     IFEQ *BLANKS                                   172956
     C                     MOVE CNUM      CCUS                            172956
     C           CEU022    IFEQ 'Y'                                       172956
     C                     MOVE CCY       CCYC                            172956
     C                     ELSE                                           172956
     C                     MOVE CCY       CCY                             172956
     C                     ENDIF                                          172956
     C                     MOVE ACSQ      CACD                            172956
     C                     MOVE ACOD      CSCA                            172956
     C                     MOVE BRCA      CBRC                            172956
     C                     MOVEL' '       YACNOF                          172956
     C                     ELSE                                           172956
      *                                                                   172956
      ** Instead of a database error, print out "A/C not found" in        172956
      ** sweep type field if AOACCNTR0 fails to find a/c.                 172956
      *                                                                   172956
     C                     MOVE WCCY1     CCY                                                 214573
     C                     MOVEL'1'       YACNOF  1                       172956
     C                     ENDIF                                          172956
      *
      *****Print*Retail*Account*Number*************************           148954
      *
     C***********          MOVELACNO      RCRSA     P                     148954
      *
      *****Move*ACCNTAB*Branch*Code****************************           148954
      *
     C***********          MOVE BRCA      RCBRC                           148954
      *
      *****Print*Midas*Full*Account*Number*********************           148954
      *
     C***********          ELSE                                           148954
      *
      ***  Move CR Sweep Account Branch
      *
     C                     MOVE CBRC      RCBRC
      *                                                                   148954
      *** Print Midas Full Account Number                                 148954
      *
      ** Only if a/c was found. Otherwise print whatever information      172956
      ** is on file (full G/L account or retail number) depending on      172956
      ** how sweep was entered.                                           172956
      *                                                                   172956
     C           YACNOF    IFNE '1'                                       172956
     C********** CCUS      ORNE *ZEROS                                                 172956 CSD027
     C           CCUS      ORNE *BLANKS                                                       CSD027
     C                     MOVE CCUS      WCCUS   6
     C                     MOVE CCYC      WCCYC   3                       148954
     C**********           MOVE CSCA      WCSCA   4                                           CGL029
     C                     MOVE CSCA      WCSCA  10                                           CGL029
     C                     MOVE CACD      WCACD   2
     C           RCRSA     CAT  WCCUS:0   RCRSA
     C           RCRSA     CAT  '-':0     RCRSA
     C           RCRSA     CAT  WCCYC:0   RCRSA                           148954
     C           RCRSA     CAT  '-':0     RCRSA                           148954
     C           RCRSA     CAT  WCSCA:0   RCRSA
     C           RCRSA     CAT  '-':0     RCRSA
     C           RCRSA     CAT  WCACD:0   RCRSA
     C                     ELSE                                           172956
     C                     MOVELCRAN      RCRSA     P                     172956
     C                     ENDIF                                          172956
     C***********          ENDIF                                          148954
      *
      ***  Format Threshold Amount, access program is used to get the
      ***  number of decimal place(s) of the currency being processed
      *
     C           CEU022    IFEQ 'Y'                                       CEU022
     C***********          MOVE CCYC      CCY                      CEU022*155495
     C                     MOVE CCCY      CCY                             155495
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY    '@OPTN   7
     C                     PARM           CCY
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ***  Handle Database Error.
      *
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVELCCY       DBKEY
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     MOVEL'RE0331'  DBPGM            * DBERR 06 *
     C                     Z-ADD006       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C/COPY WNCPYSRC,RE0331C008
      *
     C**********           Z-ADDSTHR      ZFLD15                                            AR316754
     C                     Z-SUBSTHR      ZFLD15                                            AR316754
     C                     MOVE 'A'       ZECODE
     C                     Z-ADDA6NBDP    ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSTHR
     C/COPY WNCPYSRC,RE0331C009
      *
      *****Move*Currency*Code**********************************
      *
     C***********CEU022    IFEQ 'Y'                                CEU022*155495
     C***********          MOVE CCCY      CCY                      CEU022*155495
     C***********          ENDIF                                   CEU022*155495
      *                                                                   CEU022
     C***********          MOVE CCY       RCCY                            148954
      *
      ***  Format Last Change Date
      *
     C                     MOVE SVLCD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RLCD
      *
      ***  Format Sweep Type
      *
     C           SWTP      IFEQ '1'
     C                     MOVELSW1       RSWTP     P
     C                     ELSE
     C           SWTP      IFEQ '2'
     C                     MOVELSW2       RSWTP     P
     C                     ELSE
     C           SWTP      IFEQ '3'
     C                     MOVELSW3       RSWTP     P
     C                     ELSE                                           148954
     C           SWTP      IFEQ '4'                                       148954
     C                     MOVELSW4       RSWTP     P                     148954
     C                     ENDIF                                          148954
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *                                                                   172956
      ** Instead of a database error, print out "A/C not found" in        172956
      ** sweep type field if AOACCNTR0 fails to find a/c.                 172956
      *                                                                   172956
     C           XACNOF    IFEQ '1'                                       172956
     C                     MOVELWACNOF    RSWTP     P                     172956
     C                     ENDIF                                          172956
     C           YACNOF    IFEQ '1'                                       172956
     C                     MOVELZACNOF    RSWTP     P                     172956
     C                     ENDIF                                          172956
     C           XACNOF    IFEQ '1'                                       172956
     C           YACNOF    ANDEQ'1'                                       172956
     C                     MOVELBACNOF    RSWTP     P                     172956
     C                     ENDIF                                          172956
     C                     MOVEL' '       XACNOF                          172956
     C                     MOVEL' '       YACNOF                          172956
      *                                                                                       214573
     C                     ENDIF                                                              214573
      *                                                                                       214573
     C           SVRECI    IFEQ '*'                                                           214573
      *                                                                                       214573
     C           DRAN      IFNE 0                                                             214573
     C                     MOVE *BLANKS   RDRBR                                               214573
     C                     MOVE *BLANKS   RCRAO                                               214573
     C                     MOVELDRAN      RCRAO     P                                         214573
     C                     ELSE                                                               214573
     C                     MOVELDRBR      RDRBR                                               214573
     C                     MOVE DCUS      WDCUS                                               214573
     C                     MOVE CCY       WDCCY                                               214573
     C                     MOVE DACD      WDACD                                               214573
     C                     MOVE DACS      WDACS                                               214573
     C           RCRAO     CAT  WDCUS:0   RCRAO                                               214573
     C           RCRAO     CAT  '-':0     RCRAO                                               214573
     C           RCRAO     CAT  WDCCY:0   RCRAO                                               214573
     C           RCRAO     CAT  '-':0     RCRAO                                               214573
     C           RCRAO     CAT  WDACD:0   RCRAO                                               214573
     C           RCRAO     CAT  '-':0     RCRAO                                               214573
     C           RCRAO     CAT  WDACS:0   RCRAO                                               214573
     C                     ENDIF                                                              214573
      *                                                                                       214573
     C           CRAN      IFNE 0                                                             214573
     C                     MOVE *BLANKS   RCBRC                                               214573
     C                     MOVE *BLANKS   RCRSA                                               214573
     C                     MOVELCRAN      RCRSA     P                                         214573
     C                     ELSE                                                               214573
     C                     MOVELCBRC      RCBRC                                               214573
     C                     MOVE CCUS      WCCUS                                               214573
     C                     MOVE CCYC      WCCYC                                               214573
     C                     MOVE CSCA      WCSCA                                               214573
     C                     MOVE CACD      WCACD                                               214573
     C           RCRSA     CAT  WCCUS:0   RCRSA                                               214573
     C           RCRSA     CAT  '-':0     RCRSA                                               214573
     C           RCRSA     CAT  WCCYC:0   RCRSA                                               214573
     C           RCRSA     CAT  '-':0     RCRSA                                               214573
     C           RCRSA     CAT  WCSCA:0   RCRSA                                               214573
     C           RCRSA     CAT  '-':0     RCRSA                                               214573
     C           RCRSA     CAT  WCACD:0   RCRSA                                               214573
     C                     ENDIF                                                              214573
      *                                                                                       214573
     C**********           Z-ADDSTHR      ZFLD15                                     214573 AR316754
     C                     Z-SUBSTHR      ZFLD15                                            AR316754
     C                     MOVE 'A'       ZECODE                                              214573
     C                     Z-ADDA6NBDP    ZDECS                                               214573
     C                     EXSR ZFRPED                                                        214573
     C                     MOVE ZOUT22    RSTHR                                               214573
      *                                                                                       214573
     C           SWTP      IFEQ '1'                                                           214573
     C                     MOVELSW1       RSWTP     P                                         214573
     C                     ELSE                                                               214573
     C           SWTP      IFEQ '2'                                                           214573
     C                     MOVELSW2       RSWTP     P                                         214573
     C                     ELSE                                                               214573
     C           SWTP      IFEQ '3'                                                           214573
     C                     MOVELSW3       RSWTP     P                                         214573
     C                     ELSE                                                               214573
     C           SWTP      IFEQ '4'                                                           214573
     C                     MOVELSW4       RSWTP     P                                         214573
     C                     ENDIF                                                              214573
     C                     ENDIF                                                              214573
     C                     ENDIF                                                              214573
     C                     ENDIF                                                              214573
      *                                                                                       214573
     C                     MOVE SVLCD     ZDAYNO                                              214573
     C                     EXSR ZDATE2                                                        214573
     C                     MOVE ZADATE    RLCD                                                214573
      *                                                                                       214573
     C                     ENDIF                                                              214573
      *
      ***  Format Last Change Type
      *
     C           SVCHTP    IFEQ 'I'
     C                     MOVE 'INSERT'  RCHTP
     C                     ADD  1         WINS
     C                     ELSE
     C           SVCHTP    IFEQ 'A'
     C                     MOVE 'AMEND '  RCHTP
     C                     ADD  1         WAMD
     C                     ELSE
     C           SVCHTP    IFEQ 'D'
     C                     MOVE 'DELETE'  RCHTP
     C                     ADD  1         WDEL
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
     C/COPY WNCPYSRC,RE0331C010
      *
     C**********           Z-ADD1         RQDLN1                                              262066
     C                     Z-ADD2         RQDLN1                                              262066
     C/COPY WNCPYSRC,RE0331C011
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C/COPY WNCPYSRC,RE0331C012
     C                     WRITEDTLHDR
     C/COPY WNCPYSRC,RE0331C013
     C                     ENDIF
      *
      ***  Write out Detail Record.
     C/COPY WNCPYSRC,RE0331C014
      *
     C                     WRITEDETAIL
     C/COPY WNCPYSRC,RE0331C015
      *
      *** Accumulate Total No. of Sweeps processed
      *
     C                     ADD  1         WTOTP
      *
      *** Delete after processing
      *
     C           PSTAT     IFNE 'I'
     C           SVRECI    ANDEQ'*'
     C                     DELETRESWEPD0
     C/COPY WNCPYSRC,RE0331C016
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/TERM
      *****************************************************************
      *                                                               *
      *  TERM - Termination Processing.                               *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    : AUDIT - Output Audit Report                       *
      *                                                               *
      *****************************************************************
      *
     C           TERM      BEGSR                           *** TERM ***
      *
     C           P1OPEN    IFEQ 'Y'
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
     C/COPY WNCPYSRC,RE0331C017
      *
     C**********           Z-ADD5         RQDLN1                                              262066
     C                     Z-ADD6         RQDLN1                                              262066
     C/COPY WNCPYSRC,RE0331C018
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C/COPY WNCPYSRC,RE0331C019
     C                     WRITEDTLHDR
     C/COPY WNCPYSRC,RE0331C020
     C                     ENDIF
      *
      ***  Write out Total Format.
      *
     C                     WRITETRAILP1
      *
     C                     ENDIF
      *
      ***  Output Audit Report and End Program.
      *
     C                     EXSR AUDIT
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/AUDIT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Output Audit report and End Program.  *
      *                                                               *
      *  Called By: TERM - Termination Processing                     *
      *             *PSSR - Error Control Subroutine                  *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           *** AUDIT  ***
      *
      ***  Format Audit Control Fields
      *
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD*ZERO     ZDECS
      *
     C                     Z-ADDWINS      ZFLD15
     C                     EXSR ZFRPED
     C           6         SUBSTZOUT25:14 RINS
      *
     C                     Z-ADDWAMD      ZFLD15
     C                     EXSR ZFRPED
     C           6         SUBSTZOUT25:14 RAMD
      *
     C                     Z-ADDWDEL      ZFLD15
     C                     EXSR ZFRPED
     C           6         SUBSTZOUT25:14 RDEL
      *
     C                     Z-ADDRCOUNT    ZFLD15
     C                     EXSR ZFRPED
     C           6         SUBSTZOUT25:14 RTREC
      *
     C                     Z-ADDWTOTP     ZFLD15
     C                     EXSR ZFRPED
     C           6         SUBSTZOUT25:14 TPROC
      *
     C           AUOPEN    IFNE 'Y'
     C                     OPEN RE0331AU
     C                     MOVE 'Y'       AUOPEN  1
     C                     ENDIF
      *
      ***  Output Audit Report Header.
      *
     C                     WRITEHEADAU
      *
      ***  If there is a DB Error, Output the DB Error Information.
      *
     C           *INU7     IFEQ *ON
      *
      ***  Output DB Error details to Audit File
      *
     C                     WRITEDBERROR
      *
      ***  Output DB error Reference to Report File
      *
     C           P1OPEN    IFEQ 'Y'
     C/COPY WNCPYSRC,RE0331C021
     C**********           Z-ADD5         RQDLN1                                              262066
     C                     Z-ADD6         RQDLN1                                              262066
     C/COPY WNCPYSRC,RE0331C022
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C/COPY WNCPYSRC,RE0331C023
     C                     WRITEDTLHDR
     C/COPY WNCPYSRC,RE0331C024
     C                     ENDIF
     C                     WRITEDBERR
     C                     ENDIF
      *
     C                     ELSE
      *
      ***  Or, if no records read, Output "No Details" message.
      *
     C           RCOUNT    IFEQ 0
     C                     WRITENODTLS
     C                     ELSE
     C                     WRITECONTROL
     C                     ENDIF
     C                     ENDIF
      *
      *** Close Audit Printer File & Report File
      *
     C           AUOPEN    IFEQ 'Y'
     C                     CLOSERE0331AU
     C                     ENDIF
      *
     C           P1OPEN    IFEQ 'Y'
     C                     CLOSERE0331P1
     C                     ENDIF
      *
      ***  End Program and Return.
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      *  *PSSR  - Error control subroutine                            *
      *                                                               *
      *  Called By: Abnormal Error Conditions                         *
      *  Calls    : AUDIT - Output Audit Report                       *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR **
      *
      ***  Check to see that *PSSR has not already been called.
      *
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     EXSR AUDIT
     C                     ENDIF
      *
      ***  If *PSSR already run, then just end the program here.
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/RCFP1
      *****************************************************************
      *                                                               *
      *  RCFP1  - Subroutine to register the P1 Printer File via RCF. *
      *                                                               *
      *  Called By: CHGBR - Change in Branch Processing               *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           RCFP1     BEGSR                            *** RCFP1  ***
      *
      ***  Ensure Report Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
      *
     C                     CALL 'ZSFILE'
     C                     PARM PSEQ      SEQ     5
     C                     PARM BRCA      SENTY   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/RCFAU
      *****************************************************************
      *                                                               *
      *  RCFAU  - Subroutine to register the AU Printer File via RCF. *
      *                                                               *
      *  Called By: INIT - Initial Processing                         *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           RCFAU     BEGSR                            *** RCFAU  ***
      *
      ***  Ensure Audit Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUMU    ZSNUMU  60
      *
     C                     CALL 'ZSFILE'
     C                     PARM PSEQ      SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM *BLANK    ZSERR
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
     C/TITLE SR/ZFRPED
     C/COPY ZSRSRC,ZFRPEDZ3
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
