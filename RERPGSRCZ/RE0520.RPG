     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas Transaction Details Audit & List')               *
0001 H***********
0002 F*****************************************************************
0003 F*                                                               *
     F*  Midas - Retail Module
0005 F*                                                               *
0006 F*  RE0520 - TRANSACTION CHARGES   AUDIT AND LIST - S/RETRG      *
0007 F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*      1990                                                     *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CER049             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 222457             Date 06Jun06               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01413             Date 13Apr93               *
      *                 S01117             Date 07Dec89               *
0010 F*                 E11632                  28MAR88               *
0010 F*                 E11279                  28MAR88               *
0011 F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CER049 - Stamp Tax
     F*  222457 - DB Error 2 should only occur if the record from     *
     F*           RETRGD is live.                                     *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  S01413 - Retail 3 Incorporation                              *
     F*  S01117 - Multibranching                                      *
     F*  E11632 - Debit/Credit field not shown                        *
     F*  E11279 - Array for currencies too small                      *
0011 F*                                                               *
     F*****************************************************************
0014 F***RETRG** UF  F     128 12AI     2 DISK                                         RE0520 CER049
     FRETRG   UF  F     129 12AI     2 DISK                                                   CER049
0015 F***TABLE** IF  F      96 12AI     2 DISK                                         RE0520 CGL029
     FTABLE   IF  F     126 12AI     2 DISK                                                   CGL029
0017 F*E0520P1O   F     132     OF     PRINTER                      S01124S01117
0017 FRE0520P1O   F     132     OF     PRINTER      KINFDS SPOOL          S01117
0017 FRE0520AUO   F     132     OA     PRINTER      KINFDS SPOOLU         S01117
0018 F*                                                                   RE0520
0019 F*       U8      FILE OUT OF BALANCE                                 RE0520
0020 F*       U7      DATABASE ERROR                                      RE0520
0021 F*       89      MASTER FILE - HEADER                                RE0520
0022 F*       88      MASTER FILE - TRAILER                               RE0520
0023 F*       87      MASTER FILE - DETAIL RECORD -CORRECT RECORD TYPE-   RE0520
0025 F*       85      FIRST CYCLE IND.                                    RE0520
0026 F*       84      PRINT THIS DETAIL RECORD                            RE0520
0027 F*       83      PRINT HEADINGS                                      RE0520
0028 F*       82      NO INPUT TODAY                                      RE0520
0029 F*       81      AUDIT REPORT WITH NO INPUT TODAY -U1 AND 82-        RE0520
0030 F*       80      UPDATE TRAILER BY EXCEPTION OUTPUT                  RE0520
0031 F*       79      FILE OUT OF BALANCE - NUMBER OF ACTIVE RECORDS      RE0520
0032 F*       78      FILE OUT OF BALANCE - LIVE RECORDS AFTER INPUT      RE0520
0033 F*       77      LISTING REPORT WITH NO DETAILS TO REPORT            RE0520
0034 F*       76      SPARE                                               RE0520
0035 F*       75      ACTIVE DETAIL RECORD READ - RECI NOT *              RE0520
0036 F*       74      LIVE DETAIL RECORD READ - RECI IS D AND CHTP NOT D  RE0520
0037 F*       73      DETAIL RECORD UPDATED TODAY - LCD EQUALS RUN DATE   RE0520
0038 F*       72      CURRENCY RECORD ON TABLE FILE                       RE0520
0039 F*       71      TABLE CATCHALL                                      RE0520
     F*       70      ICD RECORD ON TABLE FILE
     F*       64      END OF MASTER FILE
0040 F*       63      CURRENCY HAS 3 DECIMAL PLACES                       RE0520
0041 F*       62      CURRENCY HAS 2 DECIMAL PLACES                       RE0520
0042 F*       61      CURRENCY HAS 1 DECIMAL PLACE                        RE0520
0043 F*       60      CURRENCY HAS 0 DECIMAL PLACES                       RE0520
0044 F*       10      TRANSACTION TYPE RECORD ON TABLE FILE               RE0520
0045 F*       11      CHARGE AMOUNT IS ZERO                               RE0520
0046 F*       12      CHARGE PERCENT IS ZERO                              RE0520
0047 E*    STANDARD TABLES/ARRAYS                                         RE0520
0048 E*                                                                   RE0520
0049 E*    RN/RW/RD,1 ARE COUNT/HASH OF ACTIVE RECORDS                    RE0520
0050 E*    RN/RW/RD,2 ARE COUNT/HASH OF LIVE RECORDS                      RE0520
0051 E*    RN,3 IS COUNT OF RECORDS UPDATED TODAY. RW/RD,3 ARE NOT USED   RE0520
0052 E*    RN/RW/RD,4 ARE COUNT/HASH OF LIVE RECORDS CALCULATED FROM TRLR RE0520
0053 E                    RN          4  5 0                              RE0520
0054 E                    RW          4 15 0                              RE0520
0055 E                    RD          4  3 0                              RE0520
0056 E*    ARRAYS OF CURRENCY CODES, NAMES AND DECIMAL PLACES.            RE0520
0057 E*    NAMES REMOVED UNLESS REQUIRED, TO SAVE SPACE.                  RE0520
0058 E********************ACCY       99  3                                E11279
0059 E******************  ACNM       99 14                                RE0520
0060 E********************ACDP       99  1 0                              E11279
     E                    ACCY      150  3                                E11279
     E                    ACDP      150  1 0                              E11279
0061 E*    ARRAYS OF COUNTS AND HASH TOTALS IN THE MASTER FILE TRAILER    RE0520
0062 E                    NR          5  5 0                              RE0520
0063 E                    WN          5 15 0                              RE0520
0064 E                    DC          5  3 0                              RE0520
0065 E*                                                                   RE0520
0066 E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYRE0520
0067 E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYRE0520
0068 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY RE0520
0069 E*    NON-STANDARD TABLES/ARRAYS                                     RE0520
     E                    CPY@    1   1 80
     E/EJECT
0070 I*    STANDARD FILES                                                 RE0520
0071 I*                                                                   RE0520
0072 I*    MASTER FILE - HEADER                                           RE0520
0073 I*                                                                   RE0520
0074 IRETRG   NS  89   1 CA                                               RE0520
0100 I*                                                                   RE0520
0101 I*    MASTER FILE - TRAILER                                          RE0520
0102 I*                                                                   RE0520
0103 I        NS  88   1 CZ                                               RE0520
0104 I                                        1   1 RECI                  RE0520
0105 I                                    P  31  330TNLU                  RE0520
0106 I                                       34  34 IRRI                  RE0520
0107 I                                    P  35  49 NR                    RE0520
0108 I                                    P  50  89 WN                    RE0520
0109 I                                    P  90  99 DC                    RE0520
0079 I*                                                                   RE0520
0080 I*    MASTER FILE - DETAIL                                           RE0520
0081 I*                                                                   RE0520
0082 I        NS  87  13 CD                                               RE0520
0083 I                                        1   1 MRECI                 RE0520
0084 I                                        5   9 MTTYP                 RE0520
0085 I                                       10  12 MTCCY                 RE0520
0086 I                                       13  13 MRECT                 RE0520
0087 I                                    P  31  330MTNLU                 RE0520
0088 I                                    P  34  360MORED                 RE0520
0089 I                                    P  37  390MLCD                  RE0520
0090 I                                       40  40 MCHTP                 RE0520
0091 I                                    P  41  470MHASH                 RE0520
0092 I                                    P  48  540MCHAM                 RE0520
0093 I                                       55  56 MDCAM                 RE0520
0094 I                                    P  57  630MCHPC                 RE0520
0095 I                                       64  65 MDCPC                 RE0520
0096 I                                       66  66 MREBI                 RE0520
0110 I*                                                                   RE0520
0111 I*    CATCHALL                                                       RE0520
0112 I        NS                                                          RE0520
0113 I*                                                                   RE0520
0114 I*    TABLE FILE - TRANSACTION TYPES RECORD.                         RE0520
0115 I*                                                                   RE0520
0116 ITABLE   NS  10   1 CD   2 C4   3 C1                                 RE0520
0117 I                                        1   1 RECI                  RE0520
0118 I                                        2   30RECT                  RE0520
0119 I                                        9  130TRAT                  RE0520
0120 I                                       14  43 TRAN                  RE0520
0121 I                                       44  44 CUOR                  RE0520
0122 I                                       45  45 DCIN                  RE0520
0123 I                                       56  56 REVI                  RE0520
0124 I                                       57  57 ADVI                  RE0520
0125 I                                    P  90  920LCD                   RE0520
0126 I                                       93  93 CHTP                  RE0520
0127 I                                    P  94  960TNLU                  RE0520
0147 I*                                                                   RE0520
0148 I*    TABLE FILE - CURRENCIES RECORD 1.                              RE0520
0149 I*                                                                   RE0520
0150 I        NS  72   2 C2   3 C0                                        RE0520
0151 I                                        1   1 RECI                  RE0520
0152 I                                        2   30RECT                  RE0520
0153 I                                       10  12 CCY                   RE0520
0154 I                                       13  130SREC                  RE0520
0155 I                                       14  27 CCNM                  RE0520
0156 I                                    P  28  348SPOT                  RE0520
0157 I                                       35  37 CCYS                  RE0520
0158 I                                       38  380CDP                   RE0520
0159 I                                       39  390TNOT                  RE0520
0160 I                                       40  40 DCCY                  RE0520
0161 I                                       41  44 SRC1                  RE0520
0162 I                                       45  48 SRC2                  RE0520
0163 I**********                             49  520TACC                               RE0520 CGL029
0164 I**********                             53  560TEQV                               RE0520 CGL029
0165 I**********                             57  600SWQV                               RE0520 CGL029
0166 I**********                             61  640TAC4                               RE0520 CGL029
0167 I**********                             65  680TAC5                               RE0520 CGL029
0168 I**********                             69  69 HIND                               RE0520 CGL029
0169 I**********                          P  70  768PART                               RE0520 CGL029
0170 I**********                             77  780SSNO                               RE0520 CGL029
0171 I**********                          P  79  858ERLC                               RE0520 CGL029
0172 I**********                             86  860MDIN                               RE0520 CGL029
0173 I**********                             87  870MDIA                               RE0520 CGL029
0174 I**********                             88  880MDIB                               RE0520 CGL029
0175 I**********                          P  90  920LCD                                RE0520 CGL029
0176 I**********                             93  93 CHTP                               RE0520 CGL029
0177 I**********                          P  94  960TNLU                               RE0520 CGL029
0163 I                                       49  580TACC                                      CGL029
0164 I                                       59  680TEQV                                      CGL029
0165 I                                       69  780SWQV                                      CGL029
0166 I                                       79  880TAC4                                      CGL029
0167 I                                       89  980TAC5                                      CGL029
0168 I                                       99  99 HIND                                      CGL029
0169 I                                    P 100 1068PART                                      CGL029
0170 I                                      107 1080SSNO                                      CGL029
0171 I                                    P 109 1158ERLC                                      CGL029
0172 I                                      116 1160MDIN                                      CGL029
0173 I                                      117 1170MDIA                                      CGL029
0174 I                                      118 1180MDIB                                      CGL029
0175 I                                    P 120 1220LCD                                       CGL029
0176 I                                      123 123 CHTP                                      CGL029
0177 I                                    P 124 1260TNLU                                      CGL029
0128 I*                                                                   RE0520
0129 I*    TABLE FILE - INSTALLATION CONTROL DATA RECORD 1.               RE0520
0130 I*                                                                   RE0520
0131 ITABLE   NS  70   2 C0   3 C1  12 C1                                 RE0520
     I       AND      13 C0
0132 I                                        1   1 RECI                  RE0520
0133 I                                        2   30RECT                  RE0520
0134 I                                       12  130RCDE                  RE0520
0135 I                                       14  66 TITL                  RE0520
0136 I                                       67  67 DATF                  RE0520
0137 I***********                            68  703DFBR                  S01117
0137 I                                       68  70 DFBM                  S01117
0138 I                                       74  74 MODI1                 RE0520
0139 I                                       75  75 MODI2                 RE0520
0140 I                                       76  76 MODI3                 RE0520
0141 I                                    P  77  790RUND                  RE0520
0142 I                                       80  86 RUNA                  RE0520
0143 I                                       87  870SFLG                  RE0520
0144 I                                    P  90  920LCD                   RE0520
0145 I                                       93  93 CHTP                  RE0520
0146 I                                    P  94  960TNLU                  RE0520
     I*
     I*    CATCHALL
     I        NS  71
0181 I*                                                                   RE0520
0182 I*    DATA STRUCTURE FOR TABLE FILE KEY                              RE0520
0183 I*                                                                   RE0520
0184 I            DS                                                      RE0520
0185 I                                        1  12 TABKEY                RE0520
0186 I                                        1   2 TAB2                  RE0520
0187 I                                        9  11 TAB3A                 RE0520
0188 I                                       10  12 TAB3B                 RE0520
0189 I                                        9  12 TAB4                  RE0520
0190 I                                       12  12 TAB1                  RE0520
0191 I                                        6  11 TAB6                  RE0520
0192 I                                        8  12 TAB5                  RE0520
0193 I*                                                                   RE0520
0194 I*    STANDARD LOCAL DATA AREA FIELDS                                RE0520
0195 I*                                                                   RE0520
0196 ILDA        UDS                            256                       RE0520
0197 I***********                           134 138 LFILE                 S01117
0198 I***********                           139 167 LKEY                  S01117
0199 I***********                           168 175 LPROG                 S01117
0200 I***********                           176 1770LDBNO                 S01117
0197 I                                      134 141 LFILE                 S01117
0198 I                                      142 170 LKEY                  S01117
0199 I                                      171 180 LPROG                 S01117
0200 I                                      181 1830LDBNO                 S01117
0197 I                                      134 141 DBFILE                S01117
0198 I                                      142 170 DBKEY                 S01117
0199 I                                      171 180 DBPGM                 S01117
0200 I                                      181 1830DBASE                 S01117
     I**                                                                  S01117
     I**   FILE INFORMATION DATA STRUCTURE - P1                           S01117
     I**                                                                  S01117
     ISPOOL       DS                                                      S01117
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     I**                                                                  S01117
     I**   FILE INFORMATION DATA STRUCTURE - AU                           S01117
     I**                                                                  S01117
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     I**                                                                  S01117
     I/EJECT
     C                     MOVEACPY@      BIS@   80
     C**                                                                  S01117
     C*    DEFINE LDA                                                     S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C**                                                                  S01117
     C           *ENTRY    PLIST                                          S01117
     C                     PARM           SEQ     5         SEQUENCE NO.  S01117
0201 C*  INITIALISE TO -PRINT NO HEADINGS- AND -PRINT NO DETAILS-         RE0520
0202 C*                                                                   RE0520
0203 C                     SETOF                     8384                 RE0520
0204 C*                                                                   RE0520
0205 C  N85                EXSR FIRSTC                                    RE0520
     C  N85      *LOVAL    SETLLRETRG
0206 C                     SETON                     85                   RE0520
     C*  READS MASTER FILE
     C*
     C                     READ RETRG                    64
     C   64                SETON                     LR
     C   64                GOTO LASTR
0207 C*                                                                   RE0520
0208 C*  IF DATABASE ERROR OR NO INPUT TODAY FOR                          RE0520
0209 C*  AN AUDIT REPORT, GOTO LR PROCESSING.                             RE0520
0210 C*                                                                   RE0520
0211 C   U7                                                               RE0520
0212 COR U1 82             GOTO LASTR                                     RE0520
0213 C*                                                                   RE0520
0214 C*  IF HEADER OR TRAILER READ, GOTO LR PROCESSING                    RE0520
0215 C*                                                                   RE0520
0216 C   89                                                               RE0520
0217 COR 88                GOTO LASTR                                     RE0520
0218 C*                                                                   RE0520
0219 C*  IF INCORRECT - WRONG RECORD TYPE - DETAIL                        RE0520
0220 C*  RECORD READ, GOTO LR PROCESSING                                  RE0520
0221 C*                                                                   RE0520
0222 C  N87                GOTO LASTR                                     RE0520
0223 C*                                                                   RE0520
0224 C*  PROCESSING NOW CONSISTS OF RUN CONTROLS, RECORD FORMATTING       RE0520
0225 C*  FOR OUTPUT AND PRINTING THE RECORD.                              RE0520
0226 C*                                                                   RE0520
0227 C*                                                                   RE0520
0228 C*  RUN CONTROLS - AUDIT AND LIST CONTROLS ARE                       RE0520
0229 C*  MAINTAINED UNCONDITIONALLY                                       RE0520
0230 C*                                                                   RE0520
0231 C*  IF THERE IS NO HASH TOTAL FIELD ON THE MASTER FILE DETAIL RECORD,RE0520
0232 C*  THEN ZEROISE AND CONTINUE AS IF THERE IS.                        RE0520
0233 C*                                                                   RE0520
0234 C                     Z-ADD0         MHASH  130                      RE0520
0235 C*                                                                   RE0520
0236 C*  COUNT ACTIVE RECORDS READ - RECI NOT *                           RE0520
0237 C*  MOVE HASH AMOUNT INTO ZZAMT FIRST.                               RE0520
0238 C*                                                                   RE0520
0239 C                     MOVE MHASH     ZZAMT                           RE0520
0240 C*                                                                   RE0520
0241 C           MRECI     COMP '*'                  7575                 RE0520
0242 C   75                Z-ADD1         H                               RE0520
0243 C   75                EXSR NPZTOT                                    RE0520
0244 C*                                                                   RE0520
0245 C*  COUNT LIVE RECORDS READ - RECI IS D AND CHTP IS NOT D            RE0520
0246 C*                                                                   RE0520
0247 C           MRECI     COMP 'D'                      74               RE0520
0248 C   74      MCHTP     COMP 'D'                  7474                 RE0520
0249 C   74                Z-ADD2         H                               RE0520
0250 C   74                EXSR NPZTOT                                    RE0520
0251 C*                                                                   RE0520
0252 C*  COUNT RECORDS UPDATED TODAY - LCD IS RUN DATE                    RE0520
0253 C*                                                                   RE0520
0254 C           MLCD      COMP RUND                     73               RE0520
0255 C   73      RN,3      ADD  1         RN,3                            RE0520
0256 C*                                                                   RE0520
0257 C*  IF AUDIT REPORT, RECORDS UPDATED TODAY ARE PRINTED.              RE0520
0258 C*  IF LISTING, LIVE RECORDS ARE PRINTED.                            RE0520
0259 C*  SET ON 84 IF THE RECORD IS TO BE PRINTED.                        RE0520
0260 C*                                                                   RE0520
0261 C   U1 73                                                            RE0520
0262 CORNU1 74             SETON                       84                 RE0520
0263 C*                                                                   RE0520
0264 C*  FORMAT THE RECORD IF IT IS TO BE PRINTED                         RE0520
0265 C*                                                                   RE0520
0266 C   84                EXSR FORMT                                     RE0520
0267 C*                                                                   RE0520
0268 C   84 U7             GOTO LASTR                                     RE0520
0269 C*                                                                   RE0520
0270 C*                                                                   RE0520
0271 C           LASTR     TAG                             ** LASTR TAG   RE0520
     C**                                                                  S01117
     C*    ENSURE REPORT SPOOL FILE RECORDED BY RCF                       S01117
     C**                                                                  S01117
     CLR                   Z-ADDSFNUM     ZSNUM   60                      S01117
     CLR                   OUT  LDA                                       S01117
     C**                                                                  S01117
     CLR                   CALL 'ZSFILE'                                  S01117
     CLR                   PARM           SEQ                             S01117
     CLR                   PARM *BLANKS   SENTY                           S01117
     CLR                   PARM           SFILE                           S01117
     CLR                   PARM           ZSNUM                           S01117
     CLR                   PARM           ZSERR   1                       S01117
     CLR         *LOCK     IN   LDA                                       S01117
      *                                                                   S01117
     CLR         ZSERR     IFEQ 'Y'                                       S01117
      **  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     CLR                   SETON                     U7U8                 S01117
     CLR                   RETRN                                          S01117
     CLR                   END                                            S01117
0272 C*                                                                   RE0520
     C**                                                                  S01117
     C*       ENSURE TOTAL SPOOL FILE RECORDED BY RCF                     S01117
     C**                                                                  S01117
     CLR                   Z-ADDSFNUMU    ZSNUMU  60                      S01117
     CLR                   OUT  LDA                                       S01117
     C**                                                                  S01117
     CLR                   CALL 'ZSFILE'                                  S01117
     CLR                   PARM           SEQ     5                       S01117
     CLR                   PARM *BLANK    SENTY   3                       S01117
     CLR                   PARM           SFILEU                          S01117
     CLR                   PARM           ZSNUMU                          S01117
     CLR                   PARM           ZSERR   1                       S01117
     CLR         *LOCK     IN   LDA                                       S01117
      *                                                                   S01117
     CLR         ZSERR     IFEQ 'Y'                                       S01117
      **  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     CLR                   SETON                     U7U8                 S01117
     CLR                   RETRN                                          S01117
     CLR                   END                                            S01117
0148 C**                                                                  S01117
     C**                                                                  S01117
0273 CLR                   TIME           MTIME                           RE0520
0274 C*                                                                   RE0520
0275 C*  IF DATABASE ERROR OR NO INPUT TODAY FOR                          RE0520
0276 C*  AN AUDIT REPORT, NO FILE CONTROL CHECK DONE.                     RE0520
0277 C*                                                                   RE0520
0278 CLR U7                                                               RE0520
0279 COR U1 82             GOTO END                                       RE0520
0280 C*                                                                   RE0520
0281 C*  FOR LIST, TEST FOR NO DETAILS TO REPORT                          RE0520
0282 C*                                                                   RE0520
0283 CLRNU1      RN,2      COMP 0                        77               RE0520
0284 C*                                                                   RE0520
0285 C*  TEST FOR ALL ACTIVE RECORDS READ - COUNT AND HASH                RE0520
0286 C*                                                                   RE0520
0287 CLR         RN,1      COMP NR,1                 7979                 RE0520
0288 CLRN79      RW,1      COMP WN,1                 7979                 RE0520
0289 CLRN79      RD,1      COMP DC,1                 7979                 RE0520
0290 CLR 79                SETON                     U8                   RE0520
0291 C*                                                                   RE0520
0292 C*  IF LISTING REPORT, GOTO END                                      RE0520
0293 C*                                                                   RE0520
0294 CLRNU1                GOTO END                                       RE0520
0295 C*                                                                   RE0520
0296 C*  CALCULATE NUMBER OF LIVE RECORDS FROM TRAILER                    RE0520
0297 C*                                                                   RE0520
0298 CLR         NR,2      ADD  NR,3      RN,4                            RE0520
0299 CLR         RN,4      SUB  NR,5      RN,4             ** TOTAL       RE0520
0300 C*                                                                   RE0520
0301 C*  CALCULATE HASH TOTAL OF LIVE RECORDS AFTER INPUT FROM TRAILER    RE0520
0302 C*                                                                   RE0520
0303 C*  PUT HASH OF LIVE RECORDS BEFORE INPUT INTO ZZ FIELDS             RE0520
0304 C*                                                                   RE0520
0305 CLR                   Z-ADDWN,2      ZZTOTI                          RE0520
0306 CLR                   Z-ADDDC,2      ZZTOTD                          RE0520
0307 C*                                                                   RE0520
0308 C*  ADD HASH OF INSERTED RECORDS                                     RE0520
0309 C*                                                                   RE0520
0310 CLR                   Z-ADDWN,3      ZZAMTI                          RE0520
0311 CLR                   Z-ADDDC,3      ZZAMTD                          RE0520
0312 CLR                   EXSR GLZSUM                                    RE0520
0313 C*                                                                   RE0520
0314 C*  ADD HASH OF AMENDMENTS                                           RE0520
0315 C*                                                                   RE0520
0316 CLR                   Z-ADDWN,4      ZZAMTI                          RE0520
0317 CLR                   Z-ADDDC,4      ZZAMTD                          RE0520
0318 CLR                   EXSR GLZSUM                                    RE0520
0319 C*                                                                   RE0520
0320 C*  SUBTRACT HASH OF DELETIONS                                       RE0520
0321 C*                                                                   RE0520
0322 CLR                   Z-SUBWN,5      ZZAMTI                          RE0520
0323 CLR                   Z-SUBDC,5      ZZAMTD                          RE0520
0324 CLR                   EXSR GLZSUM                                    RE0520
0325 C*                                                                   RE0520
0326 CLR                   MOVE ZZTOTI    RW,4                            RE0520
0327 CLR                   MOVE ZZTOTD    RD,4                            RE0520
0328 C*                                                                   RE0520
0329 C*  COMPARE PROGRAM'S COUNT AND HASH OF LIVE RECORDS                 RE0520
0330 C*  READ WITH THOSE JUST CALCULATED.                                 RE0520
0331 C*                                                                   RE0520
0332 CLR         RN,2      COMP RN,4                 7878                 RE0520
0333 CLRN78      RW,2      COMP RW,4                 7878                 RE0520
0334 CLRN78      RD,2      COMP RD,4                 7878                 RE0520
0335 CLR 78                SETON                     U8                   RE0520
0336 C*                                                                   RE0520
0337 C*  IF DATABASE ERROR, GOTO END                                      RE0520
0338 C*                                                                   RE0520
0339 CLR U8                GOTO END                                       RE0520
0340 C*                                                                   RE0520
0341 C*  UPDATE CHAIN TO THE TRAILER                                      RE0520
0342 C*                                                                   RE0520
0343 CLR                   SETOF                     9988                 RE0520
0344 CLR         TRLRKY    CHAINRETRG                99                   RE0520
0345 CLRN99                                                               RE0520
0346 CAN 88                GOTO END01                                     RE0520
0347 CLR                   SETON                     U7    ** DB ERROR 92 RE0520
0348 CLR                   MOVELTRLRKY    LKEY                            RE0520
0349 CLR                   Z-ADD92        LDBNO                           RE0520
0350 CLR                   GOTO END                                       RE0520
0351 C*                                                                   RE0520
0352 CLR         END01     TAG                             ** END01 TAG   RE0520
0353 C*                                                                   RE0520
0354 C*  UPDATE THE TRAILER - IND 88 PERFORMS OUTPUT                      RE0520
0355 C*                                                                   RE0520
0356 CLR                   EXCPT                                          RE0520
0357 C*                                                                   RE0520
0358 CLR         END       TAG                             ** END TAG     RE0520
0359 C*                                                                   RE0520
     CLR U7                EXSR *PSSR                                     S01117
     C*                                                                   S01117
0360 C********************************************************************RE0520
0361 C**                                                                  RE0520
0362 C**   SUBR. - TO PERFORM FIRST CYCLE PROCESSING.                     RE0520
0363 C**                                                                  RE0520
0364 C           FIRSTC    BEGSR                           ***  FIRSTC ***RE0520
0365 C*                                                                   RE0520
0366 C*  SET-UP LDA FIELDS                                                RE0520
0367 C*                                                                   RE0520
     C                     MOVE *BLANKS   DBFILE                          S01117
0368 C                     MOVE 'RETRG'   LFILE                           RE0520
0369 C                     MOVE 'RE0520  'LPROG                           RE0520
0370 C*                                                                   RE0520
0371 C*  SET-UP BLANK LKEY                                                RE0520
0372 C*                                                                   RE0520
0373 C                     MOVE ' '       BLK200200                       RE0520
0374 C                     MOVE BLK200    LKEY                            RE0520
0375 C*                                                                   RE0520
0376 C*  SET-UP ZEROES                                                    RE0520
0377 C                     Z-ADD0         ZERO03  30                      RE0520
0378 C                     Z-ADD0         ZERO05  50                      RE0520
0379 C                     Z-ADD0         ZERO15 150                      RE0520
0380 C*                                                                   RE0520
0381 C*  SET-UP TRAILER KEY                                               RE0520
0382 C*                                                                   RE0520
0383 C                     MOVEL'99999999'TRLRKY 12                       RE0520
0384 C                     MOVE '999D'    TRLRKY                          RE0520
0411 C*                                                                   RE0520
0417 C*  OUTPUT HEADINGS                                                  S01117
0418 C                     SETON                     83                   S01117
0385 C*                                                                   RE0520
0386 C*  EXECUTE ZSYSTM                                                   RE0520
0387 C*                                                                   RE0520
0388 C                     EXSR ZSYSTM                                    RE0520
0389 C  N99                GOTO TAG01                                     RE0520
0390 C                     SETON                     U7LR  ** DB ERROR 90 RE0520
0391 C                     MOVE 'TABLE'   LFILE                           RE0520
0392 C                     MOVELZTABKY    LKEY                            RE0520
0393 C                     Z-ADD90        LDBNO                           RE0520
0394 C                     GOTO ENDFC                                     RE0520
0395 C*                                                                   RE0520
0396 C           TAG01     TAG                             ** TAG01 TAG   RE0520
0397 C*                                                                   RE0520
0398 C*  CHAIN TO THE TRAILER                                             RE0520
0399 C*                                                                   RE0520
0400 C                     SETOF                     9988                 RE0520
0401 C           TRLRKY    CHAINRETRG                99                   RE0520
0402 C  N99                                                               RE0520
0403 CAN 88                GOTO TAG02                                     RE0520
0404 C                     SETON                     U7LR  ** DB ERROR 91 RE0520
0405 C                     MOVELTRLRKY    LKEY                            RE0520
0406 C                     Z-ADD91        LDBNO                           RE0520
0407 C                     GOTO ENDFC                                     RE0520
0408 C*                                                                   RE0520
0409 C           TAG02     TAG                             ** TAG02 TAG   RE0520
0410 C           IRRI      COMP ' '                      82               RE0520
0419 C*                                                                   S01117
0412 C*  IF AUDIT REPORT AND NO INPUT TODAY, GOTO ENDFC                   RE0520
0413 C*                                                                   RE0520
0414 C   U1 82             SETON                     LR81                 RE0520
0415 C   U1 82             GOTO ENDFC                                     RE0520
0416 C*                                                                   RE0520
0417 C***OUTPUT*HEADINGS                                                  S01117
0418 C***********          SETON                     83                   S01117
0419 C*                                                                   RE0520
0420 C*  BUILD TABLE OF CURRENCY NAMES AND DECIMAL PLACES.                RE0520
0421 C*  CCY NAMES REMOVED UNLESS REQUIRED, TO SAVE SPACE.                RE0520
0422 C*                                                                   RE0520
0423 C                     MOVE BLK200    TABKEY                          RE0520
0424 C                     MOVE '20'      TAB2                            RE0520
0425 C           TABKEY    SETLLTABLE                                     RE0520
0426 C                     Z-ADD0         J       30                      RE0520
0427 C           ARC       TAG                             ** ARC TAG     RE0520
0428 C                     SETOF                     727192               RE0520
0429 C                     READ TABLE                    91               RE0520
0430 C  N72                                                               RE0520
0431 COR 91                GOTO ENDFC                                     RE0520
0432 C           RECI      COMP 'D'                  9292                 RE0520
0433 C  N92      SREC      COMP 1                    9292                 RE0520
0434 C   92                GOTO ARC                                       RE0520
0435 C           J         ADD  1         J                               RE0520
0436 C                     MOVE CCY       ACCY,J                          RE0520
0437 C*******************  MOVE CCNM      ACNM,J                          RE0520
0438 C                     MOVE CDP       ACDP,J                          RE0520
0439 C                     GOTO ARC                                       RE0520
0440 C*                                                                   RE0520
0441 C           ENDFC     TAG                             ** ENDFC TAG   RE0520
0442 C*                                                                   RE0520
0443 C                     TIME           MTIME   60                      RE0520
0444 C*                                                                   RE0520
0445 C                     ENDSR                                          RE0520
0446 C*                                                                   RE0520
0447 C********************************************************************RE0520
0448 C**                                                                  RE0520
0449 C**   SUBR. - TO FORMAT RECORD DETAILS PRIOR TO PRINTING             RE0520
0450 C**                                                                  RE0520
0451 C           FORMT     BEGSR                           ***  FORMT  ***RE0520
0452 C*                                                                   RE0520
0453 C*  CHECK CURRENCY DECIMAL PLACES                                    RE0520
0454 C*                                                                   RE0520
0455 C                     SETOF                     606162               RE0520
0456 C                     SETOF                     63                   RE0520
0457 C                     Z-ADD1         J       30                      RE0520
0458 C           MTCCY     LOKUPACCY,J                   91               RE0520
0459 C   91                GOTO FORMT1                                    RE0520
0460 C                     SETON                     U7LR  ** DB ERROR 01 RE0520
0461 C                     MOVE 'TABLE'   LFILE                           RE0520
0462 C                     MOVELMTCCY     LKEY                            RE0520
0463 C                     Z-ADD1         LDBNO                           RE0520
0464 C                     GOTO FORMTE                                    RE0520
0465 C*                                                                   RE0520
0466 C           FORMT1    TAG                             ** FORMT1 TAG  RE0520
0467 C*                                                                   RE0520
0468 C           ACDP,J    COMP 1                    626061               RE0520
0469 C   62      ACDP,J    COMP 2                    63  62               RE0520
0470 C*                                                                   RE0520
0471 C* GET TRANSACTION NAME                                              RE0520
0472 C*                                                                   RE0520
0473 C                     MOVE BLK200    TABKEY                          RE0520
0474 C                     MOVE '41'      TAB2                            RE0520
0475 C                     MOVE MTTYP     TAB5                            RE0520
0476 C                     SETOF                     10                   RE0520
0477 C           TABKEY    CHAINTABLE                99                   RE0520
0478 C   10                GOTO FORMT2                                    RE0520
     C  N99N75             GOTO FORMT2                                                        222457
0479 C                     SETON                     U7LR                 RE0520
0480 C                     MOVE 'TABLE'   LFILE                           RE0520
0481 C                     MOVELTABKEY    LKEY                            RE0520
0482 C                     Z-ADD2         LDBNO                           RE0520
0483 C                     GOTO FORMTE                                    RE0520
0484 C           FORMT2    TAG                             ** FORMT2 TAG  RE0520
0485 C*                                                                   RE0520
0486 C* PRINT AMOUNT OR PERCENT?                                          RE0520
0487 C*                                                                   RE0520
0488 C           MCHAM     COMP 0                        11               RE0520
0489 C           MCHPC     COMP 0                        12               RE0520
0490 C*                                                                   RE0520
0491 C*  STANDARD FORMATTING - FORMAT LAST CHANGE DATE                    RE0520
0492 C*                                                                   RE0520
0493 C                     Z-ADDMLCD      ZDAYNO                          RE0520
0494 C                     EXSR ZDATE2                                    RE0520
0495 C                     MOVE ZADATE    WLCD    7                       RE0520
0496 C*                                                                   RE0520
0497 C           FORMTE    ENDSR                           ** FORMTE TAG  RE0520
0498 C*                                                                   RE0520
0499 C********************************************************************RE0520
0500 C**                                                                  RE0520
0501 C**   SUBR. - TO ADD 1 TO RN,H AND TO ADD ZZAMT TO RW/RD,H           RE0520
0502 C**                                                                  RE0520
0503 C           NPZTOT    BEGSR                           ***  NPZTOT ***RE0520
0504 C                     Z-ADDH         H       10                      RE0520
0505 C*                                                                   RE0520
0506 C           RN,H      ADD  1         RN,H                            RE0520
0507 C*                                                                   RE0520
0508 C                     Z-ADDRW,H      ZZTOTI                          RE0520
0509 C                     Z-ADDRD,H      ZZTOTD                          RE0520
0510 C                     EXSR GLZADD                                    RE0520
0511 C                     Z-ADDZZTOTI    RW,H                            RE0520
0512 C                     Z-ADDZZTOTD    RD,H                            RE0520
0513 C*                                                                   RE0520
0514 C                     ENDSR                                          RE0520
0515 C********************************************************************RE0520
0516 C**                                                                  RE0520
0517 C**   ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   RE0520
0518 C**                                                                  RE0520
0519 C           ZSYSTM    BEGSR                           *** ZSYSTM *** RE0520
0520 C**                                                                  RE0520
0521 C**   SET UP KEY FOR INSTALLATION CONTROL RECORD.                    RE0520
0522 C                     MOVEL'01      'ZTABKY 12                       RE0520
0523 C                     MOVE '  10'    ZTABKY                          RE0520
0524 C**                                                                  RE0520
0525 C           ZTABKY    CHAINTABLE                99    ON NOT THERE   RE0520
0526 C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED RE0520
0527 C**                                                                  RE0520
0528 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    RE0520
0529 C           DATF      COMP 'M'                      98MMDDYY, 98 ON  RE0520
0530 C**                                                                  RE0520
0531 C                     ENDSR                                          RE0520
0532 C**                                                                  RE0520
0533 C**                                                                  RE0520
0534 C********************************************************************RE0520
0535 C**                                                                  RE0520
0536 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.            RE0520
0537 C**                                                                  RE0520
0538 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.         RE0520
0539 C**                                                                  RE0520
0540 C           ZDATE2    BEGSR                           *** ZDATE2 *** RE0520
0541 C**                                                                  RE0520
0542 C**   CLEAR DATE FIELDS.                                             RE0520
0543 C                     Z-ADD0         ZDATE   60                      RE0520
0544 C                     MOVEL'       ' ZADATE  7                       RE0520
0545 C**                                                                  RE0520
0546 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.                        RE0520
0547 C                     Z-ADDZDAYNO    ZDAYNO  50                      RE0520
0548 C**                                                                  RE0520
0549 C**   DETERMINE YEAR NUMBER.                                         RE0520
0550 C**                                                                  RE0520
0551 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.                    RE0520
0552 C           ZDAYNO    SUB  1         ZDAYN1  50   99                 RE0520
0553 C   99                GOTO ZDEND2                                    RE0520
0554 C**                                                                  RE0520
0555 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.             RE0520
0556 C           ZDAYN1    DIV  1461      ZLYR    20                      RE0520
0557 C                     MVR            ZDAYN1           SAVE REMAINING RE0520
0558 C**                                                   DAYS           RE0520
0559 C**   CALCULATE NUMBER OF REMAINING YEARS.                           RE0520
0560 C                     Z-ADD1         ZWRK2   20                      RE0520
0561 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *RE0520
0562 C           ZDAYN1    COMP ZYDY,ZWRK2             90                 RE0520
0563 C  N90      ZWRK2     ADD  1         ZWRK2                           RE0520
0564 C  N90                GOTO ZDTAG1                                    RE0520
0565 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON RE0520
0566 C**                                                                  RE0520
0567 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.                  RE0520
0568 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          RE0520
0569 C**                                                                  RE0520
0570 C**   CALCULATE ACTUAL YEAR NUMBER.                                  RE0520
0571 C           ZLYR      MULT 4         ZWRK3   30                      RE0520
0572 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972   RE0520
0573 C                     Z-ADDZWRK3     ZYEAR   20                      RE0520
0574 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           RE0520
0575 C**                                                                  RE0520
0576 C**   DETERMINE MONTH NUMBER.                                        RE0520
0577 C**                                                                  RE0520
0578 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.         RE0520
0579 C                     SETOF                     9293                 RE0520
0580 C   91      ZDAYN1    COMP 59                     9293               RE0520
0581 C   91N92   ZDAYN1    SUB  1         ZDAYN1                          RE0520
0582 C**                                                                  RE0520
0583 C**   CALCULATE MONTH NUMBER.                                        RE0520
0584 C                     Z-ADD2         ZWRK2                           RE0520
0585 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *RE0520
0586 C           ZDAYN1    COMP ZMDY,ZWRK2             94                 RE0520
0587 C  N94      ZWRK2     ADD  1         ZWRK2                           RE0520
0588 C  N94                GOTO ZDTAG2                                    RE0520
0589 C           ZWRK2     SUB  1         ZWRK2                           RE0520
0590 C**                                                                  RE0520
0591 C                     Z-ADDZWRK2     ZMTH    20       MONTH          RE0520
0592 C**                                                                  RE0520
0593 C**   DETERMINE DAY OF MONTH.                                        RE0520
0594 C**                                                                  RE0520
0595 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.                          RE0520
0596 C           ZDAYN1    ADD  1         ZDAYN1                          RE0520
0597 C**                                                                  RE0520
0598 C**   CALCULATE DAY OF MONTH.                                        RE0520
0599 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            RE0520
0600 C**                                                                  RE0520
0601 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.       RE0520
0602 C   93      ZDAY      ADD  1         ZDAY                            RE0520
0603 C**                                                                  RE0520
0604 C**   FORMAT DATE, DDMMYY OR MMDDYY.                                 RE0520
0605 C  N98                MOVELZDAY      ZWRK4   40                      RE0520
0606 C   98                MOVE ZDAY      ZWRK4                           RE0520
0607 C  N98                MOVE ZMTH      ZWRK4                           RE0520
0608 C   98                MOVELZMTH      ZWRK4                           RE0520
0609 C                     MOVELZWRK4     ZDATE                           RE0520
0610 C                     MOVE ZYEAR     ZDATE                           RE0520
0611 C**                                                                  RE0520
0612 C**   FORMAT ALPHA DATE, DDMMMYY.                                    RE0520
0613 C           ZDAY      COMP 10                     95                 RE0520
0614 C                     MOVELZDAY      ZWRK5   5                       RE0520
0615 C   95                MOVEL' '       ZWRK5                           RE0520
0616 C                     MOVE ZMNM,ZMTH ZWRK5                           RE0520
0617 C                     MOVELZWRK5     ZADATE                          RE0520
0618 C                     MOVE ZYEAR     ZADATE                          RE0520
0619 C**                                                                  RE0520
0620 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*RE0520
0621 C**                                                                  RE0520
0622 C**                                                                  RE0520
0623 C********************************************************************RE0520
0624 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)  RE0520
0625 C*   IND '99' IS SET BY AN OVERFLOW ERROR                            RE0520
0626 C*                                                                   RE0520
0627 CSR         GLZADD    BEGSR                           *** GLZADD ****RE0520
0628 C*                                                                   RE0520
0629 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT  RE0520
0630 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS RE0520
0631 C*                                                                   RE0520
0632 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS                       RE0520
0633 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD  RE0520
0634 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD  RE0520
0635 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW                  RE0520
0636 C*                                                                   RE0520
0637 CSR                   EXSR GLZSUM                                    RE0520
0638 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *RE0520
0639 C*                                                                   RE0520
0640 C********************************************************************RE0520
0641 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -            RE0520
0642 C*                        GLZADD, GLZSUB, GLZCMP.                    RE0520
0643 C*          PARAMETERS PASSED -                                      RE0520
0644 C*                     I/P ZZAMTI ZZAMTD                             RE0520
0645 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.       RE0520
0646 C*                                                                   RE0520
0647 CSR         GLZSUM    BEGSR                           *** GLZSUM ****RE0520
0648 C*                                                                   RE0520
0649 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI  RE0520
0650 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD  RE0520
0651 CSR                   SETOF                     919293               RE0520
0652 CSR                   SETOF                     949599               RE0520
0653 C*                                                                   RE0520
0654 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG                      RE0520
0655 CSR         ZZAMTI    COMP 0                      9293               RE0520
0656 CSR 93      ZZAMTD    COMP 0                      9293               RE0520
0657 CSR 93                GOTO ZZSEND                     ZERO BYPASS    RE0520
0658 C*                                                                   RE0520
0659 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.                       RE0520
0660 CSR         ZZTOTI    COMP 0                      9193               RE0520
0661 CSR 93      ZZTOTD    COMP 0                      9193               RE0520
0662 C*                                                                   RE0520
0663 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.                           RE0520
0664 CSR 93                Z-ADDZZAMTI    ZZTOTI                          RE0520
0665 CSR 93                Z-ADDZZAMTD    ZZTOTD                          RE0520
0666 CSR 93                GOTO ZZSEND                     ZERO BYPASS    RE0520
0667 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.                        RE0520
0668 CSR 91N92                                                            RE0520
0669 CORN91 92             GOTO ZZOFPS                                    RE0520
0670 C*                                                                   RE0520
0671 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40                      RE0520
0672 CSR         ZZWK2     COMP 999                  93    '93' = CARRY   RE0520
0673 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.RE0520
0674 C*                                                                   RE0520
0675 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VERE0520
0676 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VERE0520
0677 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3                           RE0520
0678 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3                           RE0520
0679 C*                                                                   RE0520
0680 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED    RE0520
0681 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS. RE0520
0682 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE      RE0520
0683 CSRN99                Z-ADDZZWK2     ZZTOTD                          RE0520
0684 CSRN99                Z-ADDZZWK3     ZZTOTI                          RE0520
0685 C*                                                                   RE0520
0686 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT. RE0520
0687 CSR 99                Z-ADD0         ZZAMT  153                      RE0520
0688 CSR                   GOTO ZZSEND                                    RE0520
0689 C*                                                                   RE0520
0690 C* THE 'SIGNS' ARE DIFFERENT                                         RE0520
0691 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**RE0520
0692 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT            RE0520
0693 C*                                                                   RE0520
0694 CSR 92                Z-SUBZZAMTI    ZZAMTI 150                      RE0520
0695 CSR 92                Z-SUBZZAMTD    ZZAMTD  30                      RE0520
0696 C*                                                                   RE0520
0697 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.           RE0520
0698 C*                                                                   RE0520
0699 CSR 91                Z-SUBZZTOTI    ZZTOTI                          RE0520
0700 CSR 91                Z-SUBZZTOTD    ZZTOTD                          RE0520
0701 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.                            RE0520
0702 C*                                                                   RE0520
0703 CSR         ZZTOTI    COMP ZZAMTI               93  95               RE0520
0704 CSR 95      ZZTOTD    COMP ZZAMTD               93  95               RE0520
0705 C*                                                                   RE0520
0706 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.                                   RE0520
0707 CSR 95                Z-ADD0         ZZTOTI                          RE0520
0708 CSR 95                Z-ADD0         ZZTOTD                          RE0520
0709 CSR 95                GOTO ZZSEND                                    RE0520
0710 C*                                                                   RE0520
0711 C* IF ZZTOT GT. ZZAMT.                                               RE0520
0712 CSR 93      ZZAMTD    COMP ZZTOTD               94                   RE0520
0713 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI                          RE0520
0714 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2                           RE0520
0715 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI                          RE0520
0716 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD                          RE0520
0717 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD                          RE0520
0718 C*                                                                   RE0520
0719 C*                                                                   RE0520
0720 C* IF ZZAMT GT. ZZTOT.                                               RE0520
0721 CSRN93      ZZTOTD    COMP ZZAMTD               94                   RE0520
0722 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150                      RE0520
0723 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2                           RE0520
0724 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI                          RE0520
0725 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI                          RE0520
0726 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD                          RE0520
0727 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD                          RE0520
0728 C*                                                                   RE0520
0729 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE          RE0520
0730 CSR                   SETOF                     94                   RE0520
0731 CSR 93 91                                                            RE0520
0732 CORN93 92             SETON                     94                   RE0520
0733 CSR 94                Z-SUBZZTOTI    ZZTOTI                          RE0520
0734 CSR 94                Z-SUBZZTOTD    ZZTOTD                          RE0520
0735 C**                                                                  RE0520
0736 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.            RE0520
0737 CSR 92                Z-SUBZZAMTI    ZZAMTI                          RE0520
0738 CSR 92                Z-SUBZZAMTD    ZZAMTD                          RE0520
0739 CSR         ZZSEND    TAG                             ** ZZSEND TAG *RE0520
0740 C**                                                                  RE0520
0741 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.           RE0520
0742 CSR                   SETOF                     96                   RE0520
0743 CSR         ZZTOTD    COMP 0                        91               RE0520
0744 CSR 91      ZZTOTI    COMP 0                      96                 RE0520
0745 CSR 96                MOVE '.000-'   ZZNEGD  5                       RE0520
0746 CSR                   ENDSR                             ** ENDSR **  RE0520
0747 C********************************************************************RE0520
     C*                                                                   S01117
     C*  *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C*  CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
     C*                                                                   S01117
     C*  CALLS: NOTHING                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT
0748 O*  STANDARD OUTPUT                                                  RE0520
0749 O*                                                                   RE0520
0750 ORE0520P1H  203   83                                                 S01124
0751 O       OR        OF                                                 RE0520
0752 O*                                                                   RE0520
0753 O*  STANDARD HEADINGS                                                RE0520
0754 O*                                                                   RE0520
0755 O***********                        20 'REFERENCE RE0520'            S01117
0755 O                                   22 'REFERENCE RE0520P1'          S01117
0756 O                         TITL      89                               RE0520
0757 O                                  104 'DATE'                        RE0520
0758 O                         RUNA     112                               RE0520
0759 O                                  122 'PAGE'                        RE0520
0760 O                         PAGE  Z  126                               RE0520
0761 O        H  1     83                                                 RE0520
0762 O       OR        OF                                                 RE0520
0763 O                       U1          16 'AUDIT REPORT'                RE0520
0764 O                      NU1          18 'LISTING REPORT'              RE0520
0765 O*                                                                   RE0520
0766 O*  NAME OF FILE OR RECORD                                           RE0520
0767 O*                                                                   RE0520
0768 O                                   73 'TRANSACTION CHARGES LIST'    RE0520
0769 O*                                                                   RE0520
0770 O*  STANDARD OUTPUT                                                  RE0520
0771 O*                                                                   RE0520
0772 O                         MTIME    112 '  .  .  '                    RE0520
0773 O        H  2     83                                                 RE0520
0774 O       OR        OF                                                 RE0520
0775 O                       U1          16 '------------'                RE0520
0776 O                      NU1          18 '--------------'              RE0520
0777 O*                                                                   RE0520
0778 O*  UNDERLINE NAME OF FILE OR RECORD                                 RE0520
0779 O*                                                                   RE0520
0780 O                                   73 '------------------------'    RE0520
0781 O*                                                                   RE0520
0782 O*  NON-STANDARD HEADINGS                                            RE0520
0783 O*                                                                   RE0520
0784 O        H  1     83                                                 RE0520
0785 O       OR        OF                                                 RE0520
0786 O                                   20 'TRANSACTION'                 RE0520
0787 O                                   74 'CHARGE'                      RE0520
0795 O                                   82 '-----D/C'                    E11632
0788 O                                   93 'CHARGE'                      RE0520
0795 O                                   99 '---D/C'                      E11632
0789 O                                  131 'CHANGE   CHANGE'             RE0520
0790 O        H  2     83                                                 RE0520
0791 O       OR        OF                                                 RE0520
0792 O                                   16 'TYPE'                        RE0520
0793 O                                   38 'TITLE'                       RE0520
0794 O                                   74 'CCY         AMOUNT'          RE0520
0795 O                                   94 'PERCENT'                     RE0520
0796 O                                  114 'REBATEABLE'                  RE0520
0797 O                                  130 'DATE     TYPE'               RE0520
0798 O*                                                                   RE0520
0799 O* NON-STANDARD DETAILS                                              RE0520
0800 O*                                                                   RE0520
0801 O        D  1     84                                                 RE0520
0802 O                         MTTYP     16                               RE0520
0803 O                         TRAN      51                               RE0520
0804 O                         MTCCY     59                               RE0520
0805 O                   N11 60MCHAM     75 '           0 '               RE0520
0806 O                   N11 61MCHAM     77 '          0 . '              RE0520
0807 O                   N11 62MCHAM     78 '         0 .  '              RE0520
0808 O                   N11 63MCHAM     79 '        0 .   '              RE0520
0810 O                         MDCAM     82                               E11632
0809 O                   N12   MCHPC     96 '   0 .        '              RE0520
0810 O                         MDCPC     99                               E11632
0810 O                         MREBI    110                               RE0520
0811 O                         WLCD     123                               RE0520
0812 O                         MCHTP    128                               RE0520
0820 O***DATABASE ERROR OUTPUT                                            S01117
0821 O*                                                                   S01117
0822 O        T 3      LR U7                                              S01117
0823 O                                   74 '*** DATABASE ERROR ***'      S01117
0813 O*                                                                   RE0520
0814 O*  NO DETAILS TO REPORT MESSAGE                                     RE0520
0815 O*                                                                   RE0520
0816 O        T   40   LRNU1 77                                           RE0520
0817 O                                   72 '*** NO DETAILS TO REPORT'    RE0520
0818 O                                   76 ' ***'                        RE0520
0873 O        T   40   LR 82 U1                                           S01117
0874 O                                   73 '*** NO INPUT TODAY ***'      S01117
0819 O*                                                                   RE0520
0820 O***DATABASE*ERROR OUTPUT                                            S01117
0821 O*                                                                   RE0520
0822 O********T*3      LR U7                                              S01117
0823 O***********                        38 'DATABASE ERROR NO.-'         S01117
0824 O***********              DBASE     40                               S01117
0825 O***********                        48 'FILE-'                       S01117
0826 O***********              DBFILE    53                               S01117
0827 O***********                        60 'KEY-'                        S01117
0828 O***********              DBKEY     89                               S01117
0941 O        T 3      LR                                                 S01117
0942 O                                   73 '*** END OF REPORT ***'       S01117
0829 O*                                                                   RE0520
0830 O*  STANDARD FILE CONTROLS                                           RE0520
0831 O*                                                                   RE0520
0832 O*  STANDARD HEADINGS                                                RE0520
0833 O*                                                                   RE0520
0834 O********T  203   LR                                                 S01117
0834 ORE0520AUT  203   LR                                                 S01117
0835 O***********                        20 'REFERENCE RE0520'            S01117
0835 O                                   22 'REFERENCE RE0520AU'          S01117
0836 O                         TITL      89                               RE0520
0837 O                                  104 'DATE'                        RE0520
0838 O                         RUNA     112                               RE0520
0839 O                                  122 'PAGE'                        RE0520
0840 O***********              PAGE  Z  126                               S01117
0840 O                         PAGE1 Z  126                               S01117
0841 O        T  1     LR                                                 RE0520
0842 O                       U1          16 'AUDIT REPORT'                RE0520
0843 O                      NU1          18 'LISTING REPORT'              RE0520
0844 O*                                                                   RE0520
0845 O*  NAME OF FILE OR RECORD                                           RE0520
0846 O*                                                                   RE0520
0847 O                                   73 'TRANSACTION CHARGES LIST'    RE0520
     O                                   88 '   RUN CONTROLS'             S01117
0848 O*                                                                   RE0520
0849 O*  STANDARD OUTPUT                                                  RE0520
0850 O*                                                                   RE0520
0851 O                         MTIME    112 '  .  .  '                    RE0520
0852 O        T  1     LR                                                 RE0520
0853 O                       U1          16 '------------'                RE0520
0854 O                      NU1          18 '--------------'              RE0520
0855 O*                                                                   RE0520
0856 O*  UNDERLINE NAME OF FILE OR RECORD                                 RE0520
0857 O*                                                                   RE0520
0858 O                                   73 '------------------------'    RE0520
0859 O*                                                                   RE0520
0860 O*  NO INPUT TODAY MESSAGE                                           RE0520
0861 O*                                                                   RE0520
0862 O        T   40   LR U1 82                                           RE0520
0863 O                                   73 '*** NO INPUT TODAY ***'      RE0520
0864 O*                                                                   RE0520
0865 O*  HEADINGS AND RUN CONTROLS COMMON TO AUDIT AND LIST               RE0520
0866 O*                                                                   RE0520
0867 O        T  220   LRN81                                              RE0520
0868 O                                   21 'RUN CONTROLS - '             RE0520
0869 O                                   77 '----------- PROGRAM ----'    RE0520
0870 O                                   84 '-------'                     RE0520
0871 O                                  116 '--------- FILE TRAILER '     RE0520
0872 O                                  124 '--------'                    RE0520
0873 O        T  1     LRN81                                              RE0520
0874 O                                   59 'NUMBER'                      RE0520
0875 O                                   84 'VALUE'                       RE0520
0876 O                                   99 'NUMBER'                      RE0520
0877 O                                  124 'VALUE'                       RE0520
0878 O        T  2     LRN81                                              RE0520
0879 O                                   13 'S/'                          RE0520
0880 O***********              LFILE     18                               S01117
0880 O                                   18 'RETRG'                       S01117
0881 O        T  2     LRN81                                              RE0520
0882 O                                   32 'NUMBER OF ACTIVE RECORDS'    RE0520
0883 O                                   40 'ON FILE'                     RE0520
0884 O                         RN,1  3   59                               RE0520
0885 O                         RW,1  Z   80                               RE0520
0886 O                         RD,1      84 '0   -'                       RE0520
0887 O                         NR,1  3   99                               RE0520
0888 O                         WN,1  Z  120                               RE0520
0889 O                         DC,1     124 '0   -'                       RE0520
0890 O                       79         130 '***'                         RE0520
0891 O*                                                                   RE0520
0892 O*  AUDIT REPORT ONLY RUN CONTROLS                                   RE0520
0893 O*                                                                   RE0520
0894 O        T  3     LR U1N82                                           RE0520
0895 O                                   29 'NUMBER OF RECORDS UPD'       RE0520
0896 O                                   39 'ATED TODAY'                  RE0520
0897 O                         RN,3  3   59                               RE0520
0898 O        T  2     LR U1N82                                           RE0520
0899 O                                   27 'LIVE RECORDS BEFORE'         RE0520
0900 O                                   39 'INPUT CYCLE'                 RE0520
0901 O                         NR,2  3   99                               RE0520
0902 O                         WN,2  Z  120                               RE0520
0903 O                         DC,2     124 '0   -'                       RE0520
0904 O        T  2     LR U1N82                                           RE0520
0905 O                                   26 'RECORDS INSERTED'            RE0520
0906 O                         NR,3  3   99                               RE0520
0907 O                         WN,3  Z  120                               RE0520
0908 O                         DC,3     124 '0   -'                       RE0520
0909 O        T  2     LR U1N82                                           RE0520
0910 O                                   25 'RECORDS AMENDED'             RE0520
0911 O                         NR,4  3   99                               RE0520
0912 O                         WN,4  Z  120                               RE0520
0913 O                         DC,4     124 '0   -'                       RE0520
0914 O        T  2     LR U1N82                                           RE0520
0915 O                                   25 'RECORDS DELETED'             RE0520
0916 O                         NR,5  3   99                               RE0520
0917 O                         WN,5  Z  120                               RE0520
0918 O                         DC,5     124 '0   -'                       RE0520
0919 O        T        LR U1N82                                           RE0520
0920 O                                   32 'LIVE RECORDS AFTER INPUT'    RE0520
0921 O                                   38 'CYCLE'                       RE0520
0922 O                         RN,2  3   59                               RE0520
0923 O                         RW,2  Z   80                               RE0520
0924 O                         RD,2      84 '0   -'                       RE0520
0925 O                         RN,4  3   99                               RE0520
0926 O                         RW,4  Z  120                               RE0520
0927 O                         RD,4     124 '0   -'                       RE0520
0928 O                       78         129 '***'                         RE0520
0929 O*                                                                   RE0520
0930 O*  LISTING REPORT ONLY RUN CONTROLS                                 RE0520
0931 O*                                                                   RE0520
0932 O        T        LRNU1                                              RE0520
0933 O                                   29 'NUMBER OF LIVE RECORD'       RE0520
0934 O                                   38 'S ON FILE'                   RE0520
0935 O                         RN,2  3   59                               RE0520
0929 O*                                                                   S01117
0820 O*  DATABASE ERROR OUTPUT                                            S01117
0821 O*                                                                   S01117
0822 O        T 3      LR U7                                              S01117
     O                                   66 'DATABASE ERROR '             S01117
     O                         DBASE     69                               S01117
     O                                   83 'IN PROGRAM '                 S01117
     O                         DBPGM     93                               S01117
     O        T 2      LR U7                                              S01117
     O                                   56 'FILE '                       S01117
     O                         DBFILE    64                               S01117
     O                                   70 ', KEY '                      S01117
     O                         DBKEY     99                               S01117
0936 O*                                                                   S01117
0929 O*                                                                   S01117
0937 O*  OUTPUT DETAILS COMMON TO AUDIT AND LIST                          RE0520
0938 O*                                                                   RE0520
0939 O********T** 45   LR U8                                              S01117
0939 O        T 3      LR U8NU7                                           S01117
0940 O                                  100 '*** DIFFERENCE ***'          RE0520
0936 O*                                                                   RE0520
0871 O*  NO DETAILS TO REPORT MESSAGE                                     S01117
0872 O*                                                                   S01117
0873 O        T   40   LRNU1 77                                           S01117
0874 O                                   72 '*** NO DETAILS TO REPORT'    S01117
0875 O                                   76 ' ***'                        S01117
0941 O********T** 50   LR                                                 S01117
0942 O***********                        73 '*** END OF REPORT ***'       S01117
0943 ORETRG   E        88                                                 RE0520
0944 O                                   34 ' '                           RE0520
0945 O                         RN,1      37P                              RE0520
0946 O                         RN,2      40P                              RE0520
0947 O                         ZERO05    43P                              RE0520
0948 O                         ZERO05    46P                              RE0520
0949 O                         ZERO05    49P                              RE0520
0950 O                         RW,1      57P                              RE0520
0951 O                         RW,2      65P                              RE0520
0952 O                         ZERO15    73P                              RE0520
0953 O                         ZERO15    81P                              RE0520
0954 O                         ZERO15    89P                              RE0520
0955 O                         RD,1      91P                              RE0520
0956 O                         RD,2      93P                              RE0520
0957 O                         ZERO03    95P                              RE0520
0958 O                         ZERO03    97P                              RE0520
0959 O                         ZERO03    99P                              RE0520
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
