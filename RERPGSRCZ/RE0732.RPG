     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Sweeps processed')                            *
      *****************************************************************
      *                                                               *
      *  Midas - Retail Module                                        *
      *                                                               *
      *  RE0732 - Sweeps Processed                                    *
      *                                                               *
      *  Function:  This program will process Sweeps and generate     *
      *    (COB)    Sweep Accounting Entries. It will run daily       *
      *             during CLose of Business (COB), after all other   *
      *             Postings to Retail accounts have been generated,  *
      *             but prior to interest capitalisation.             *
      *                                                               *
      *  Called By: REC0732 - Sweeps Processed Control                *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD055146           Date 04Feb20               *
      *  Prev Amend No. CER050             Date 16Jun19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD048589           Date 05Jan18               *
      *                 MD046248           Date 27Oct17               *
      *                 MD045744           Date 29May17               *
      *                 CGL184             Date 07Dec16               *
      *                 CGL154             Date 13Oct14               *
      *                 260839             Date 28May12               *
      *                 MD034985           Date 13Nov15               *
      *                 254051             Date 26Feb15               *
      *                 CGL165             Date 17Feb15               *
      *                 CRE075             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 AR751622           Date 02May11               *
      *                 CER059             Date 19Jul10               *
      *                 CER016             Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CRE401             Date 26Nov09               *
      *                 CDL081             Date 14Dec09               *
      *                 BUG26486           Date 19Oct09               *
      *                 260297             Date 19May09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246810             Date 16Apr07               *
      *                 250620             Date 15Oct07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 218538             Date 06Jun06               *
      *                 173010             Date 06Jun06               *
      *                 233259             Date 06Jun06               *
      *                 239502             Date 24Apr06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 03Sep01               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 197465             Date 02Sep02               *
      *                 196661             Date 15Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 193986             Date 26Dec01               *
      *                 162666             Date 26Oct01               *
      *                 181363             Date 17Oct01               *
      *                 177670             Date 17Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CDE002             Date 21Dec99               *
      *                 153144             Date 12Apr01               *
      *                 135467             Date 14Dec00               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 167269             Date 09Feb00               *
      *                 164572             Date 09Feb00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 155098             DATE 15Oct99               *
      *                 164757             DATE 13Oct99               *
      *                 153249             DATE 05Oct99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 153813             Date 11May99               *
      *                 150289             Date 29Dec98               *
      *                 149032             DATE 22DEC98               *
      *                 148355             Date 30Nov98               *
      *                 146799             Date 12Nov98               *
      *                 137491             Date 26JUN98               *
      *                 137251             Date 17Jun98               *
      *                 134902             Date 28Apr98               *
      *                 133672             Date 17Apr98               *
      *                 CEU022             Date 21Jan98               *
      *                 CRE004 *CREATE     Date 20Jan97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD055146 - Failed MXC004802 seq. 00001 and others            *
      *             Increase Branches to 900.                         *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD048589 - Reverse Sweeping was not done and the Overdraft   *
      *             line was not being considered. Corrected the      *
      *             validation of fix 250620                          *
      *  MD046248 - Finastra Rebranding                               *
      *  MD045744 - Incorrect Retail Sweep amounts on the report      *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  260839 - Incorrect processing for blocked accounts. Amended  *
      *           the program to reverse checking for credit sweep    *
      *           accounts.                                           *
      *         - Applied for AR973329 (Child: AR973334)              *
      *         - Applied for MDA-18282                               *
      *  MD034985 - Sweep fail due to incorrect flagging as DELETED.  *
      *             Corrected use of RECI field during checking.      *
      *  254051 - Sweep account type 2 does not work. Applied 253366. *
      *         - Applied for MD030996                                *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  AR751622 - Erroneous generated interest for Retail Account   *
      *             (non-leap year) when calculation basis is 0. Need *
      *             to include SR ZICD CER016 changes in /COPY        *
      *             ZICDREZ2 - (Recompile)                            *
      *             (Child: AR751623)                                 *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016 - German Interest Calculation: Upgarde of FGE059      *
      *           to Midas Plus                                       *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CRE401 - 4-Eyes Checking Gaps - Sweeps (Recompile)           *
      *  CDL081 - Tiered withholding tax rounding upgrade             *
      *         - Also applied fix 165057, 197268 and 196958.  Refer  *
      *           to fix description below.                           *
      *  165057 - Use main branch BCIN only if BKIEMB is 'Y' in       *
      *           SDGELRPD (interbranch entries via main branch) .    *
      *  197268 - Adapted fix 179570.  Refer to fix desciption below. *
      *         - Account cannot be close due to outstanding balances *
      *           not swept for sweep type '4'. Applied fixes 177670  *
      *           and 181363. Fix for 177670 computes extra statement *
      *           commision charges of the account.And fix for 181363 *
      *           will check for rebatable and non-rebatable charges  *
      *           if within min/max charges define.  The min/max      *
      *           charge should be added to the total if it less than *
      *           or exceed the limits.                               *
      *         - backvalued interest capitalisation was also added   *
      *           to the amount to be swept.  Fix was patterned over  *
      *           174884.                                             *
      *         - difference of 0.01 interest between sweep processing*
      *           and interest computed by RE3662 causing failure in  *
      *           closing of account.  Pattern interest computation   *
      *           on RE3362 which reads REHISL rather then REACRD.    *
      *         - SAR CDL013 has also been included for Tiered W/Tax  *
      *           calculation.  Hooks were not utilised for this.     *
      *  196958 - Discrepancies in the computation of interest in     *
      *           Sweeping and RE3662 (Capitalisation processing).    *
      *           Accessed the LF/REHISL for the details to be used   *
      *           in interest calculation to avoid 0.01 difference.   *
      *           Patterned fix after 170652, 178221 and 197035.      *
      *  BUG26486 - Coding standard (recompile)                       *
      *  260297 - Incorrect interest calculation w/ calc basis 6.     *
      *           Externalise SR/ZICD and patterned additional fix    *
      *           from ZINTDYZ2. Applied fix 220323.                  *
      *  246810 - Initialised field RVPAMT in case CEU022 is not on.  *
      *  250620 - RE Sweep Type 2 not working. Applied fix(Gems238465)*
      *  218538 - Use the correct indicators in SR/GLZSUM to avoid    *
      *           GLC30 FOOB.                                         *
      *  173010 - ADD A CHECK OF HOLIDAY DAY FOR THE LOCAL CURRENCY   *
      *  233259 - DB Error accessing RECOMD if the debit account has  *
      *           been entered as a 10 digit account number.          *
      *  239502 - On printing exception report if retail account      *
      *           number is blank/*ZEOR, then use full a/c code.      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
      *           Information (Recompile)                             *
      *  197465 - Default narrative will come from PF/SDRETRPD's      *
      *           transaction name or from hardcoded 'SWEEP TRANSFER' *
      *           if PNAR is blank.                                   *
      *  196661 - Amend program to skip re-converting sweep amount to *
      *           EMU currency equivalent for spot trade equivalent   *
      *           postings if base currency is equal to the EMU       *
      *           currency and either the debit currency or the       *
      *           credit currency is equal to the EMU currency.       *
      *  193986 - System incorrectly generates a sweep posting for    *
      *           a/c of origin even though it is already closed &    *
      *           uses the account number from previously processed   *
      *           records in PF/RESWEPPD. Applied the fix 189263      *
      *  162666 - Sweep amount is not properly calculated for a       *
      *           reverse sweep when the credit side account balance  *
      *           is less than the sweep amount to be reverse swept.  *
      *  181363 - Check the rebatable and non-rebatable charges if    *
      *           within the maximum and the minimum charges. The     *
      *           maximum or minimum charge should be added to the    *
      *           total if it less than or exceeds the limits. Also   *
      *           include the Daily Statements -Fixed Charge. Include *
      *           all commissions/charges in the total sweeping       *
      *           amount. The fixed commission should also be added   *
      *           or the fixed commission override if it is not zero. *
      *  177670 - Retail account not closed due to outstanding amount.*
      *           Commission on Number of Daily Statement should be   *
      *           processed so that it will not remain as an          *
      *           outstanding amount of the account to be closed.     *
      *  CDE002 - Revenue Analysis - Recompiled due to changes in     *
      *           PF/ACCNTBXC.                                        *
      *  153144 - Instead of filling the branch when it is blanked    *
      *           only fill it when the retail account is blank.      *
      *  135467 - Problem with Sweep accounting when single branch    *
      *           company                                             *
      *  167269 - Trailer record hash total does not match the total  *
      *           on file.                                            *
      *  164572 - Postings do not balance by branch and currency when *
      *           sweeping is multi-branch, multi currency.           *
      *           Customer number is zero if interbranch entries not  *
      *           via main branch.  Only use MBICN if interbranch via *
      *           main branch.                                        *
      *  155098 - New parameter introduced to determine if first run. *
      *           Always use GLACBT on first run to allow for real    *
      *           time postings.                                      *
      *  164757 - Customer number is zero if interbranch entries not  *
      *           via main branch.  Only use MBICN if interbranch via *
      *           main branch.                                        *
      *  153249 - Problem producing the wrong code in ACSC field in   *
      *           APOSTPD. Fixed by using a new subroutine (GETAC)    *
      *           to correctly set up field ACSC, by getting the      *
      *           value again from AOACODR0.                          *
      *  CGL007 - Account Postings Enquiry.  Recompile.               *
      *  153813 - WH TAX AMOUNT SHOULD BE ADDED IN THE FINAL SWEEP .  *
      *  150289 - INT. CAP. CHECK BEFORE SRSWPP PROCESSING (SR SRCAPT)*
      *  149032 - OUTSTANDING INTEREST NOT SWEPT AT FINAL DATE FOR    *
      *           SWEEP TYPE '4'. IF DR A/C SPECIFIED AS RETAIL A/C   *
      *           NO. GL KEY FIELDS ARE NOT SET TO REACRD & REIACD    *
      *           (& REHRDJ/REHRCJ) RECS. NOT FOUND. AMENND KLISTS &  *
      *           ADD DATABASE ERROR PROCESSING FOR REACR & IACBR.    *
      *  148355 - Sweep processing should not be blocked for inactive *
      *           accounts .                                          *
      *  146799 - EU0200 should only be called for conversion from    *
      *           an 'in' ccy to Euros. Also wrong amount used on     *
      *           conversion from CR ccy to base ccy, and multiccy    *
      *           ind. not reset so wrong ccy reported.               *
      *  137491 - Fix to bypass EU0200 when both currencies are EUR.  *
      *  137251 - EURO Implementation - fix to avoid generation of    *
      *           spot trade account equivalent postings with blank   *
      *           account code (in the event that spot trade equiv.   *
      *           account on currency record is blank - which it may  *
      *           be for base currency)                               *
      *  134902 - EURO Implementation.                                *
      *       a)  Incorrect sweep amount being calculated, due to     *
      *           incorrect adjustment of the account balance by the  *
      *           accrued interest/charges figure.                    *
      *       b)  When sweep type 4 and last day accruals then        *
      *           the accrued interest calculated does not include    *
      *           the last day                                        *
      *       c)  If it's not the final sweep date, the 'start of day *
      *           cleared balances' are output incorrectly.           *
      *       d)  Reverse sweep processing incorrect for a Euro sweep *
      *           ie. A/c of Origin with DR balance not being swept.  *
      *           Sweep amount should always be the balance on the    *
      *           A/c of origin (ie. In ccy a/c) even though it's DR. *
      *  133672 - Fix to allow reverse sweeps from Euro accounts when *
      *           'in' currency accounts are overdrawn                *
      *  CEU022 - EMU Retail Utilities                                *
      *  CRE004 - Sweep Accounting                                    *
      *                                                               *
      *****************************************************************
     F/EJECT
      *
      ** Sweeps Details File by Transaction Branch
     FRESWEPL1UF  E           K        DISK         KINFSR *PSSR
      *
      ** Sweep Generated Entries - Trailer
     FGESPZZ  O   E           K        DISK         KINFSR *PSSR
      *
      *  Account Balances Today
     FGLACBTL0IF  E           K        DISK         KINFSR *PSSR
      *
      ** Retail Generated Entries Detail
     FREEODLF IF  E           K        DISK         KINFSR *PSSR
      *                                                                   177670
      ** Commission Details                                               177670
      *                                                                   177670
     FRECOM   IF  E           K        DISK                               177670
      *                                                                   181363
      ** Retail by ICD currency.                                          181363
      *                                                                   181363
     FRECCY   IF  E           K        DISK                               181363
      *                                                                   181363
      ** Retail charges.                                                  181363
      *                                                                   181363
     FRECRG   IF  E           K        DISK                               181363
      *                                                                   181363
      ** Customer group code.                                             181363
      *                                                                   181363
     FTABLEV4 IF  E                    DISK                               181363
      *                                                                                       197268
     FREHISL  IF  E           K        DISK                                                   197268
     F            REHISPMF                          KIGNORE                                   197268
     F                                              KINFDS REHDS                              197268
     F                                              KINFSR REHSR                              197268
      *
      ** Sweep Generated Entries - Detail
     FGESPPD  O   E           K        DISK         KINFSR *PSSR
      *                                                                   CEU022
      ** Retail Accrued Interest to Date                                  CEU022
     FREACR   IF  E           K        DISK         KINFSR *PSSR          CEU022
      *                                                                   CEU022
      ** Retail Interest and Charges Detail                               CEU022
     FIACBR   IF  E           K        DISK         KINFSR *PSSR          CEU022
      *
     F/COPY WNCPYSRC,RE0732F001
      ** Sweeps Processed
     FRE0732P1O   E             15     PRINTER      KINFSR *PSSR      UC
     F                                              KINFDS SPOOL1
      *
      ** Exceptions
     FRE0732P2O   E             16     PRINTER      KINFSR *PSSR      UC
     F                                              KINFDS SPOOL2
      *
      ** Audit Report
     FRE0732AUO   E                    PRINTER      KINFSR *PSSR      UC
     F                                              KINFDS SPOOLU
      *                                                                   153813
     FACCNTBXCIF  E           K        DISK                               153813
      *                                                                   153813
     FSDSTAXPDIF  E                    DISK                           UC  153813
     FSDSTAAL1IF  E                    DISK                           UC                      197268
      *                                                                                       197268
     FSDCUSTL0IF  E           K        DISK                           UC                      197268
      *                                                                   134902
     F/COPY WNCPYSRC,RE0732F002
      ** Historic CR and DR rate change files                             134902
     FREHRCJ  IF  E           K        DISK                               134902
     FREHRDJ  IF  E           K        DISK                               134902
      *
     F/EJECT
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *       09      Customer group code match.                      *   181363
      *       10      Interbranch via main branch indicator           *
      *       11      Table lookup indicator for main branch          *
      *       12      Table lookup indicator for branch               *
      *       13      Chain fails to file RECOM                       *   177670
      *       15      Overflow for RE0732P1                           *
      *       16      Overflow for RE0732P2                           *
      *       17      Array full indicator                            *
      *       18      Multi currency sweep                            *   CEU022
      *       20      Indicator used in SR/GLZADD                     *
      *       21-26   Indicators used in SR/GLZSUM                    *
      *       49      Beginning of file for REHISL                    *                       197268
      *       61      Chain failed for RECCYD                         *   181363
      *       76      Chain failed for SDSTAXPD                       *   153813
      *       77      Test bit indicators                             *
      *       78      No record found indicator for ACCNTBXC          *   153813
      *       79      No record found indicator for GESPZZ            *
      *       82      Multi-Branching indicator                       *
      *       90      End of file for RESWEPL1                        *
      *       95      End of file read to TABLEV4.                    *   181363
      *       96      Chain failed for RECRG                          *   181363
      *       97      Chain failed for GLACBTL0/REEODLF               *
      *       98      Date format indicator                           *
      *       99      Error in core sub routine                       *
      *       U7      Program error                                   *
      *       U8      Database error                                  *
      *       LR      End program                                     *
      *                                                               *
      *****************************************************************
     F/SPACE 3
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *     1. SRINIT -  Initial Processing                           *
      *     2. SRNXTD -  Compute Next Sweep Date                      *
      *     3. SRCBR1 -  Change in Branch Processing for Detail Report*
      *     4. SRCBR2 -  Change in Branch Processing for Exception Rpt*
      *     5. SRMULT -  Access Branch Description                    *
      *     6. SRDETL -  Detail Processing                            *
      *     7. SRAACD -  Access Account Details                       *
      *     8. SRSWPP -  Sweep Processing                             *
      *        SRCAPT -  INTEREST CAPITALISATION CHECK                *   150289
      *     9. GLZADD -  Split amount into integer and decimal fields *
      *    10. GLZSUM -  Carry out addition of totals                 *
      *    11. SRRFP1 -  Referrals Processing                         *
      *    12. SRRFP2 -  Check referral Conditions                    *
      *    13. SRRVSP -  Reverse Sweep Processing                     *
      *    14. SRTERM -  Termination Processing                       *
      *    15. SRNARR -  Get narrative from SDNARRPD                  *
      *    16. SRW01  -  Write Debit posting record in GESPPD         *
      *    17. SRW02  -  Write Credit posting record in GESPPD        *
      *    18. SRW03  -  Write Inter-brch postings to GESPPD          *
      *    19. SRW04  -  Write Inter-brch via main brch postings      *
      *    20. SRW05  -  Write totals to GESPZZ                       *
      *    21. SRAUD  -  Termination Processing                       *
      *    22. RCFP1  -  RCF processing for RE0732P1                  *
      *    23. RCFP2  -  RCF processing for RE0732P2                  *
      *    24. RCFAU  -  RCF processing for RE0732AU                  *
      *    25. *PSSR  -  Error Control Subroutine                     *
      *                                                               *   134902
      *  CRINIT - Credit rate fields init processing                  *   134902
      *  DATEIN - Searching end-of-month date processing              *   134902
      *  DRINIT - Debit rate fields init processing                   *   134902
      *  INTCAL - Interest calculation between two dates              *   134902
      *  SREXTP - Extra processing for interest calcs                 *   134902
      *  ZICD   - Find number of days to calculate interest according *   134902
      *           to calculation basis processing                     *   134902
      *  ZIC00  - Interest calculation (type=00) processing           *   134902
      *  ZIC01  - Interest calculation (type=01) processing           *   134902
      *  ZIC02  - Interest calculation (type=02) processing           *   134902
      *                                                               *
      *****************************************************************
     E/EJECT
      *
      ** Array containing Copyright statement
     E                    CPY@    1   1 80
      *
      ** Array containing Referral Narratives
     E**********          RNAR    1   7 11                                254051
     E                    RNAR    1   8 11                                254051
      *
      ** Power Array
     E                    POWER   1   7  7 3
      *
      ** Array containing Branch Codes
     E**********          BC        150  3                                                  MD055146
     E                    BC        999  3                                                  MD055146
      *
      ** Array containing Branch Code Details
     E**********          BD        150 50                                                  MD055146
     E                    BD        999 50                                                  MD055146
      *                                                                   134902
      ** Arrays for Interest calc SR's                                    134902
     E                    ZIR        11 11 7             ZIC. INT.RATES   134902
     E                    ZIRD       11 11 7             ZIC. INT.RATES   134902
     E                    ZIRC       11 11 7             ZIC. INT.RATES   134902
     E                    ZIB        11 15 0A            ZIC. INT.BALANCES134902
     E                    ZIBD       11 15 0             ZIC. INT.BALANCES134902
     E                    ZIBC       11 15 0             ZIC. INT.BALANCES134902
     E                    ZIN        11 13 0             ZIC. INT.CALC    134902
     E**********          ZIN1       11 18 5             ZIC. INT.CALC                 134902 220323
     E                    ZIN1       11 30 9             ZIC. INT.CALC                        220323
     E                    ZIA        11 15 0             ZIC. WORK ARRAY  134902
     E**********          ZIA1       11 15 5             ZIC. WORK ARRAY               134902 220323
     E                    ZIA1       11 30 9             ZIC. WORK ARRAY                      220323
     E                    ZIA2       11 15 0             ZIC. WORK ARRAY                      CER016
      *
      ** Array for SR.ZFREQB
     E/COPY ZSRSRC,ZFREQBZ1
     E/COPY ZSRSRC,ZHOLE
      *
      ** Array for SR.ZFRPED
     E/COPY ZSRSRC,ZFRPEDZ1
      *
      ** Array for SR.ZDATE1, SR.ZDATE2
     E/COPY ZSRSRC,ZDATE2Z1
      *                                                                                       197268
     IREHISPPF                                                                                197268
      *                                                                                       197268
      ** Rename REHISPPF format RECI - REHISL file                                            197268
      *                                                                                       197268
     I              RECI                            WRECI                                     197268
     I              HISD                            DHISD                                     197268
     I              MNBL                            BMNBL                                     197268
     I              MACI                            BMACI                                     197268
     I              MADI                            BMADI                                     197268
     I              DRCD                            BDRCD                                     197268
     I              CRCD                            BCRCD                                     197268
     I              HISB                            BHISB                                     196958
     IREHISPSF                                                                                197268
      *                                                                                       197268
      ** Rename REHISPSF format RECI - REHISL file                                            197268
      *                                                                                       197268
     I              RECI                            WRECI                                     197268
     I              HISD                            DHISD                                     197268
     I              HISB                            BHISB                                     196958
     I              MNBL                            DMNBL                                     197268
     I              CRIS                            DCRIS                                     197268
     I              DRIS                            DDRIS                                     197268
     I              DRCD                            DDRCD                                     197268
     I              CRCD                            DCRCD                                     197268
     I              DAIC                            DDAIC                                     197268
     I              CAIC                            DCAIC                                     197268
     I              SDACP                           DSDCP                                     197268
     I              SCACP                           DSCCP                                     197268
     I              DRBR                            DDRBR                                     197268
     I              CRBR                            DCRBR                                     197268
     I              CHBR                            DCHBR                                     197268
      *                                                                   134902
      *                                                                   134902
      ** RENAME REHRCJF FORMAT FIELDS - REHRCJ FILE                       134902
      *                                                                   134902
     IREHRCJF                                                             134902
     I              RECI                            $RECIC                134902
     I              CNUM                            $CNUMC                134902
     I              CCY                             $CCYC                 134902
     I              ACOD                            $ACODC                134902
     I              ACSQ                            $ACSQC                134902
     I              ACNO                            $ACNOC                134902
     I              PSTD                            $PSTDC                134902
     I              VALD                            $VALDC                134902
     I              TRAT                            $TRATC                134902
     I              PNAR                            $PNARC                134902
     I              DRCR                            $DRCRC                134902
     I              HISD                            $HISDC                134902
     I              SPOS                            $SPOSC                134902
     I              BRCA                            $BRCAC                134902
     I              BRT                             $BRTC                 134902
     I              RTSP                            $RTSPC                134902
     I              INTH                            INTHC                 134902
      *                                                                   134902
      ** RENAME REHRDJF FORMAT FIELDS - REHRDJ FILE                       134902
      *                                                                   134902
     IREHRDJF                                                             134902
     I              RECI                            $RECID                134902
     I              CNUM                            $CNUMD                134902
     I              CCY                             $CCYD                 134902
     I              ACOD                            $ACODD                134902
     I              ACSQ                            $ACSQD                134902
     I              ACNO                            $ACNOD                134902
     I              PSTD                            $PSTDD                134902
     I              VALD                            $VALDD                134902
     I              TRAT                            $TRATD                134902
     I              PNAR                            $PNARD                134902
     I              DRCR                            $DRCRD                134902
     I              HISD                            $HISDD                134902
     I              SPOS                            $SPOSD                134902
     I              BRCA                            $BRCAD                134902
     I              BRT                             $BRTD                 134902
     I              RTSP                            $RTSPD                134902
     I              INTH                            INTHD                 134902
      *                                                                   134902
      ** RENAME REACRDF FORMAT FIELDS - REACR FILE                        134902
      *                                                                   134902
     IREACRDF                                                             134902
     I              LCD                             RHISD                 134902
     I              HISB                            RHISB                 134902
      *
      /COPY ZSRSRC,ZFRPEDZ2
      ** Data structure for SR.ZFRPED
      *
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZHOLDS
      /SPACE 3
      *
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
     IPSDS       SDS
      ** Program Status Data Structure
      *
     I                                     *PROGRAM PGM
     I                                      244 253 WSID
     I                                      254 263 USER
      *                                                                                       197268
     IREHDS       DS                                                                          197268
     I                                     *STATUS  STSREH                                    197268
      *
     ISPOOL1      DS
      ** File Information Data Structure for RE0732P1.
     I                                       82  82 OPENP1
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
      *
     ISPOOL2      DS
      ** File Information Data Structure for RE0732P2.
     I                                       82  82 OPENP2
     I                                       83  92 SFILE2
     I                                    B 123 1240SFNUM2
      *
     ISPOOLU      DS
      ** File Information Data Structure for RE0732AU.
     I                                       82  82 OPENAU
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     I            DS
      ** Account Key
     I**********                              1  18 WACCNT                                    CGL029
     I                                        1  24 WACCNT                                    CGL029
     I                                        1   3 WBRCH
     I                                        4   9 WCUSN
     I                                       10  12 WCCY
     I**********                             13  16 WACOD                                     CGL029
     I**********                             17  18 WACSQ                                     CGL029
     I                                       13  22 WACOD                                     CGL029
     I                                       23  24 WACSQ                                     CGL029
      *
     I            DS
      ** Account Key
     I**********                              1  18 WDRACT                                    CGL029
     I                                        1  24 WDRACT                                    CGL029
     I                                        1   3 DBRCH
     I                                        4   9 DCUSN
     I**********                              4   90DCUSND                             149032 CSD027
     I                                        4   9 DCUSND                                    CSD027
     I                                       10  12 DCCY
     I**********                             13  16 DACOD                                     CGL029
     I**********                             13  160DACODD                             149032 CGL029
     I**********                             17  18 DACSQ                                     CGL029
     I**********                             17  180DACSQD                             149032 CGL029
     I**********                              4  18 WDRAC2                             149032 CGL029
     I                                       13  22 DACOD                                     CGL029
     I                                       13  220DACODD                                    CGL029
     I                                       23  24 DACSQ                                     CGL029
     I                                       23  240DACSQD                                    CGL029
     I                                        4  24 WDRAC2                                    CGL029
      *
     I            DS
      ** Account Key
     I**********                              1  18 WCRACT                                    CGL029
     I                                        1  24 WCRACT                                    CGL029
     I                                        1   3 CBRCH
     I                                        4   9 CCUSN
     I                                       10  12 CCCY
     I**********                             13  16 CACOD                                     CGL029
     I**********                             17  18 CACSQ                                     CGL029
     I                                       13  22 CACOD                                     CGL029
     I                                       23  24 CACSQ                                     CGL029
      *
     I            DS
      ** DR A/c Branch Details Data Structure
     I**********                              1  20 DBCI                                      CGL029
     I                                        1  32 DBCI                                      CGL029
     I                                        1   6 DBICN
     I**********                              7  10 DADTO                                     CGL029
     I**********                             11  14 DADFR                                     CGL029
     I**********                             15  15 DTYPTO                                    CGL029
     I**********                             16  16 DTYPFR                                    CGL029
     I**********                             17  18 DASTO                                     CGL029
     I**********                             19  20 DASFR                                     CGL029
     I                                        7  16 DADTO                                     CGL029
     I                                       17  26 DADFR                                     CGL029
     I                                       27  27 DTYPTO                                    CGL029
     I                                       28  28 DTYPFR                                    CGL029
     I                                       29  30 DASTO                                     CGL029
     I                                       31  32 DASFR                                     CGL029
      *
     I            DS
      ** CR A/c Branch Details Data Structure
     I**********                              1  20 CBCI                                      CGL029
     I                                        1  32 CBCI                                      CGL029
     I                                        1   6 CBICN
     I**********                              7  10 CADTO                                     CGL029
     I**********                             11  14 CADFR                                     CGL029
     I**********                             15  15 CTYPTO                                    CGL029
     I**********                             16  16 CTYPFR                                    CGL029
     I**********                             17  18 CASTO                                     CGL029
     I**********                             19  20 CASFR                                     CGL029
     I                                        7  16 CADTO                                     CGL029
     I                                       17  26 CADFR                                     CGL029
     I                                       27  27 CTYPTO                                    CGL029
     I                                       28  28 CTYPFR                                    CGL029
     I                                       29  30 CASTO                                     CGL029
     I                                       31  32 CASFR                                     CGL029
      *
     I            DS
      ** CR A/c Branch Details Data Structure
     I**********                              1  20 MBCI                                      CGL029
     I                                        1  32 MBCI                                      CGL029
     I                                        1   6 MBICN
     I**********                              7  10 MADTO                                     CGL029
     I**********                             11  14 MADFR                                     CGL029
     I**********                             15  15 MTYPTO                                    CGL029
     I**********                             16  16 MTYPFR                                    CGL029
     I**********                             17  18 MASTO                                     CGL029
     I**********                             19  20 MASFR                                     CGL029
     I                                        7  16 MADTO                                     CGL029
     I                                       17  26 MADFR                                     CGL029
     I                                       27  27 MTYPTO                                    CGL029
     I                                       28  28 MTYPFR                                    CGL029
     I                                       29  30 MASTO                                     CGL029
     I                                       31  32 MASFR                                     CGL029
      *                                                                   134902
      ** DATA STRUCTURE FOR FINISHING DATE                                134902
      *                                                                   134902
     I            DS                                                      134902
     I                                        1   60FRES                  134902
     I                                        1   20ZIFD                  134902
     I                                        3   40ZIFM                  134902
     I                                        5   60ZIFY                  134902
     I*                                                                   134902
     I** KEY DATA STRUCTURE : REHKEY TO FILL DBKEY IF ERROR               134902
     I*                                                                   134902
     I            DS                                                      134902
     I                                        1  23 REHKEY                134902
     I***                                     1   3 DRBR            134902149032
     I***                                     4   90DCUS            134902149032
     I***                                    10  12 REHCCY          134902149032
     I***                                    13  160DACD            134902149032
     I***                                    17  180DACS            134902149032
     I                                       19  230REHDAT                134902
     I*                                                                   134902
     I** DATA STRUCTURE FOR DATE FORMAT DD/MM/YY                          134902
     I*                                                                   134902
     I            DS                                                      134902
     I                                        1   60RESULT                134902
     I                                        1   20ZDAY                  134902
     I                                        3   40ZMTH                  134902
     I                                        5   60ZYEAR                 134902
     I*                                                                   134902
     I** DATA STRUCTURE FOR BEGINNING DATE                                134902
     I*                                                                   134902
     I            DS                                                      134902
     I                                        1   60SRES                  134902
     I                                        1   20ZISD                  134902
     I                                        3   40ZISM                  134902
     I                                        5   60ZISY                  134902
     I*                                                                   134902
     I** DATA STRUCTURE TO SPLIT FROM ALPHA TO NUMERIC DEBIT & CREDIT RATE134902
     I*                                                                   134902
     IWDRAT       DS                                                      134902
     I                                    P   1  667ZIRD                  134902
     I                                    P   1   67ZRD01                 134902
     I                                    P   7  127ZRD02                 134902
     I                                    P  13  187ZRD03                 134902
     I                                    P  19  247ZRD04                 134902
     I                                    P  25  307ZRD05                 134902
     I                                    P  31  367ZRD06                 134902
     I                                    P  37  427ZRD07                 134902
     I                                    P  43  487ZRD08                 134902
     I                                    P  49  547ZRD09                 134902
     I                                    P  55  607ZRD10                 134902
     I                                    P  61  667ZRD11                 134902
     I                                    P  67  727ZRD12                 134902
     I*                                                                   134902
     IWCRAT       DS                                                      134902
     I                                    P   1  667ZIRC                  134902
     I                                    P   1   67ZRC01                 134902
     I                                    P   7  117ZRC02                 134902
     I                                    P  13  187ZRC03                 134902
     I                                    P  19  247ZRC04                 134902
     I                                    P  25  307ZRC05                 134902
     I                                    P  31  367ZRC06                 134902
     I                                    P  37  427ZRC07                 134902
     I                                    P  43  487ZRC08                 134902
     I                                    P  49  547ZRC09                 134902
     I                                    P  55  607ZRC10                 134902
     I                                    P  61  667ZRC11                 134902
     I                                    P  67  727ZRC12                 134902
     I*                                                                   134902
     I** DATA STRUCTURE TO SPLIT FROM ALPHA TO NUMERIC DEBIT AND          134902
     I** CREDIT BALANCES                                                  134902
     I*                                                                   134902
     IWDBAL       DS                                                      134902
     I                                    P   1  880ZIBD                  134902
     I                                    P   1   80ZBD01                 134902
     I                                    P   9  160ZBD02                 134902
     I                                    P  17  240ZBD03                 134902
     I                                    P  25  320ZBD04                 134902
     I                                    P  33  400ZBD05                 134902
     I                                    P  41  480ZBD06                 134902
     I                                    P  49  560ZBD07                 134902
     I                                    P  57  640ZBD08                 134902
     I                                    P  65  720ZBD09                 134902
     I                                    P  73  800ZBD10                 134902
     I                                    P  81  880ZBD11                 134902
     I                                    P  89  960ZBD12                 134902
     I*                                                                   134902
     IWCBAL       DS                                                      134902
     I                                    P   1  880ZIBC                  134902
     I                                    P   1   80ZBC01                 134902
     I                                    P   9  160ZBC02                 134902
     I                                    P  17  240ZBC03                 134902
     I                                    P  25  320ZBC04                 134902
     I                                    P  33  400ZBC05                 134902
     I                                    P  41  480ZBC06                 134902
     I                                    P  49  560ZBC07                 134902
     I                                    P  57  640ZBC08                 134902
     I                                    P  65  720ZBC09                 134902
     I                                    P  73  800ZBC10                 134902
     I                                    P  81  880ZBC11                 134902
     I                                    P  89  960ZBC12                 134902
     I*                                                                   134902
     I** DATA STRUCTURE FOR DATE FORMAT MM/DD/YY                          134902
     I*                                                                   134902
     I            DS                                                      134902
     I                                        1   60RESULX                134902
     I                                        1   20ZMTHX                 134902
     I                                        3   40ZDAYX                 134902
     I                                        5   60ZYEARX                134902
     I*                                                                   134902
     I** DATA STRUCTURE FOR BEGINNING DATE MM/DD/YY                       134902
     I*                                                                   134902
     I            DS                                                      134902
     I                                        1   60SRESX                 134902
     I                                        1   20ZISMX                 134902
     I                                        3   40ZISDX                 134902
     I                                        5   60ZISYX                 134902
     I*                                                                   134902
     I** DATA STRUCTURE FOR FINISHING DATE MM/DD/YY                       134902
     I*                                                                   134902
     I            DS                                                      134902
     I                                        1   60FRESX                 134902
     I                                        1   20ZIFMX                 134902
     I                                        3   40ZIFDX                 134902
     I                                        5   60ZIFYX                 134902
      *                                                                   177670
     I            DS                                                      177670
     I                                        1   7 CEXF                  177670
     I                                        1   70NCEXF                 177670
      *                                                                   181363
     I            DS                                                      181363
     I                                        1   7 CEXG                  181363
     I                                        1   70NCEXG                 181363
      *                                                                   181363
      ** Key data structure: RECHRK tp chain to RECRG file.               181363
      *                                                                   181363
     I            DS                                                      181363
     I                                        1  12 RECHRK                181363
     I                                        2   30CHGT                  181363
     I                                        4   80CHST                  181363
     I                                        9  11 WCCYA                 181363
     I                                       12  12 DEE                   181363
      *                                                                   181363
      ** Data structure: For Customer Group no. (TABLEV4)                 181363
      *                                                                   181363
     I            DS                                                      181363
     I                                        1  10 ZZ010                 181363
     I                                       10  10 CGRP                  181363
      *                                                                   181363
     ISDCUST    E DSSDCUSTPD                                              181363
      *                                                                   181363
      ** Data structure for customer details.                             181363
      *                                                                   181363
     I              BBCGRP                          @WCGRP                181363
      *                                                                   181363
      ** Key data structure: CKEY to fill RECKEY.                         181363
      *                                                                   181363
     I            DS                                                      181363
     I                                        1  12 CKEY                  181363
     I                                       12  12 KRECI                 181363
     I                                        9  11 KSCCY                 181363
     I                                        1   8 KBLK8                 181363
      *                                                                   181363
     I            DS                                                      181363
     I                                        1  10 WCNUMA                181363
     I**********                              1   60WCNUMN                             181363 CSD027
     I                                        1   6 WCNUMN                                    CSD027
      *                                                                                       CDL081
      ** Named constants                                                                      CDL081
      *                                                                                       CDL081
     I              'BasCcyTaxRoundDown'  C         C#BASE                                    CDL081
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                    CDL081
      *
      ** Default narr. if PNAR and A1RTNM are both blanks                                     197465
      *                                                                                       197465
     I              'SWEEP TRANSFER'      C         WDNARR                                    197465
      *                                                                                       197465
     IRUNDAT    E DSRUNDAT
      ** Data Area giving Installation Control Details
      *
     ISDBANK    E DSSDBANKPD
      ** SD Bank Details
      *
     ISDACOD    E DSSDACODPD
      ** SD Account Codes
      *
     ISDRETL    E DSSDRETLPD
      ** SD Retail Details
     I              QQACCD                          QQACD1                                    CGL029
      *
     ISDGELR    E DSSDGELRPD
      ** SD General Ledger Details
     I              QQACCD                          QQACD2                                    CGL029
      *
     ISCSARD    E DSSCSARDPD                                                                  CER016
     I              LCD                             SLCD                                      CER016
      *                                                                                       CER016
      ** External DS SC Switchable Features                                                   CER016
      *                                                                                       CER016
     ISDACCT    E DSACCNTAB
      ** SD Account Details Details
      *
     ISDCURR    E DSSDCURRPD
      ** SD Currency Details
      *
     ISDBRCH    E DSSDBRCHPD
      ** SD Branch Details
     I              QQDFAC                          #DFAC1                                    CGL029
      *
     ISDRETR    E DSSDRETRPD                                                                  197465
      ** SD Retail Transaction Types Details                                                  197465
      *                                                                                       197465
     ISDNARR    E DSSDNARRPD
      ** SD Narrative Codes
      *
     ISDTRAD    E DSSDTRADPD                                              CEU022
      ** Trading Data Details                                             CEU022
     I              QQACCD                          QQACD3                                    CGL029
      *                                                                   153813
     ISDMMOD    E DSSDMMODPD                                              153813
      ** Midas Module details                                             153813
      *                                                                   CEU022
     I/COPY WNCPYSRC,RE0732I001
     IDSFDY     E DSDSFDY
      ** Short Data Structure - used as parameter to access programs
      *
      ** Constant Value for Interest Calculation Method                                       CER016
      *                                                                                       CER016
     I              'InterestNumber'      C         PSYSVL                                    CER016
     I/EJECT                                                                                  CER016
      *                                                                                       CER016
      /TITLE Main Processing
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ** Entry parameter
     C           *ENTRY    PLIST
     C                     PARM           WUPD    1
     C                     PARM           CUPD    1                       155098
      *                                                                   181363
      ** Key field to access to RECCY file.                               181363
      *                                                                   181363
     C           RECKEY    KLIST                                          181363
     C                     KFLD           CKEY                            181363
      *
      ** Set up copyright parameter
     C                     MOVEACPY@      MKI@   80
      *                                                                   134902
      ** KEY LISTS                                                        134902
      *                                                                   134902
      *                                                                                       197268
      ** Key field to access LF/REHISL                                                        197268
      *                                                                                       197268
     C           R1KEY     KLIST                                                              197268
     C                     KFLD           DBRCH                                               197268
     C                     KFLD           DCUSND                                              197268
     C                     KFLD           DCCY                                                197268
     C                     KFLD           DACODD                                              197268
     C                     KFLD           DACSQD                                              197268
      *                                                                   134902
      ** Key field to access to REHRDJ/REHRCJ file                        134902
      *                                                                   134902
     C           DCKEY     KLIST                                          134902
     C***                  KFLD           DRBR                      134902149032
     C***                  KFLD           DCUS                      134902149032
     C                     KFLD           DBRCH                           149032
     C                     KFLD           DCUSND                          149032
     C                     KFLD           DCCY                            134902
     C***                  KFLD           DACD                      134902149032
     C***                  KFLD           DACS                      134902149032
     C                     KFLD           DACODD                          149032
     C                     KFLD           DACSQD                          149032
     C                     KFLD           KDATE                           134902
      *                                                                   177670
      ** Key fields to access RECOM file                                  177670
      *                                                                   177670
     C           COMKEY    KLIST                                          177670
     C                     KFLD           CMBRC                           177670
     C                     KFLD           CMCUS                           177670
     C                     KFLD           CMCCY                           177670
     C                     KFLD           CMACD                           177670
     C                     KFLD           CMACS                           177670
      *                                                                   134902
      ** WORK FIELDS DEFINITION                                           134902
      *                                                                   134902
     C           *LIKE     DEFN ACOD      ZLYCHK                          134902
     C           *LIKE     DEFN ACSQ      ZLYREM                          134902
     C           *LIKE     DEFN ACSQ      ZIM1                            134902
     C           *LIKE     DEFN ACSQ      ZIMAN                           134902
     C           *LIKE     DEFN ACSQ      ZIDW1                           134902
     C           *LIKE     DEFN ACSQ      ZIY1                            134902
     C           *LIKE     DEFN ACSQ      Y                               134902
     C           *LIKE     DEFN ACSQ      Z                               134902
     C           *LIKE     DEFN RCA       ZINTR                           134902
     C           *LIKE     DEFN RHISB     ZIAMT                           134902
     C           *LIKE     DEFN RHISB     ZIAMT1                          134902
     C           *LIKE     DEFN RHISB     ZIAMTR                          134902
     C           *LIKE     DEFN RHISB     WAMT                                                CER016
     C           *LIKE     DEFN RHISB     WINAMT                                              CER016
     C           *LIKE     DEFN RHISB     WNAMT1                                              CER016
     C           *LIKE     DEFN RHISB     WNAMT2                                              CER016
     C           *LIKE     DEFN RHISB     ZITHR                           134902
     C           *LIKE     DEFN RHISB     ZBAL                            134902
     C           *LIKE     DEFN DRIB      ZICT                            134902
     C           *LIKE     DEFN BJRDNB    RUND                            134902
     C           *LIKE     DEFN RUND      ZIBEG                           134902
     C           *LIKE     DEFN RUND      ZIEND                           134902
     C           *LIKE     DEFN RUND      ZLDTM                           134902
     C           *LIKE     DEFN RUND      ZIDREM                          134902
     C           *LIKE     DEFN RUND      ZID1                            134902
     C           *LIKE     DEFN RUND      ZID2                            134902
     C           *LIKE     DEFN RUND      ZIDW2                           134902
     C           *LIKE     DEFN RUND      ZILPCP                          134902
     C           *LIKE     DEFN RUND      KDATE                           134902
     C           *LIKE     DEFN RUND      ZIBW1                           134902
     C           *LIKE     DEFN RUND      ZIREM                           134902
     C           *LIKE     DEFN DRIC      ZERROR                          134902
     C           *LIKE     DEFN DRIC      ZICALC                          134902
     C           *LIKE     DEFN DRIS      ZIRATE                          134902
     C           *LIKE     DEFN DRIS      WRATE                                               CER016
     C           *LIKE     DEFN RHISB     DINT                            134902
     C           *LIKE     DEFN RHISB     CINT                            134902
     C           *LIKE     DEFN DRCD      WDRCD                           134902
     C           *LIKE     DEFN CRCD      WCRCD                           134902
     C           *LIKE     DEFN DRIB      WDRIB                           134902
     C           *LIKE     DEFN DRIS      WDRIS                           134902
     C           *LIKE     DEFN DRIC      WDRIC                           134902
     C           *LIKE     DEFN OLDR      WOLDR                           134902
     C           *LIKE     DEFN CRIB      WCRIB                           134902
     C           *LIKE     DEFN CRIS      WCRIS                           134902
     C           *LIKE     DEFN CRIC      WCRIC                           134902
     C           *LIKE     DEFN OLCR      WOLCR                           134902
     C           *LIKE     DEFN RHISB     WADIC                                               197268
     C           *LIKE     DEFN RHISB     WACIC                                               197268
     C           *LIKE     DEFN RHISB     W#PSTA                                              197268
     C           *LIKE     DEFN RUND      WOVALD                                              197268
     C           *LIKE     DEFN RUND      WVALD                                               197268
     C           *LIKE     DEFN RUND      WHISD                                               197268
      *                                                                   134902
     C                     Z-ADD*ZEROS    ZIFY2   30                      134902
     C                     Z-ADD*ZEROS    ZISY2   30                      134902
     C                     Z-ADD*ZEROS    ZINOM   30                      134902
     C                     Z-ADD*ZEROS    ZIM2    30                      134902
     C                     Z-ADD*ZEROS    LOOP    10                      134902
     C**********           Z-ADD*ZEROS    ZIWRK1 155                                   134902 220323
     C**********           Z-ADD*ZEROS    ZIWRK2 155                                   134902 220323
     C                     Z-ADD*ZEROS    ZIWRK1 309                                          220323
     C                     Z-ADD*ZEROS    ZIWRK2 309                                          220323
     C                     Z-ADD*ZEROS    ZDAYN2  94                      134902
     C                     MOVEL*BLANKS   ERRDAT 12                       134902
      *
      ** Perform initial processing
     C                     EXSR SRINIT
      *
      ** Read first record on Sweeps Detail File
     C                     READ RESWEPL1                 90
      *
     C           *IN90     DOWEQ'0'
     C/COPY WNCPYSRC,RE0732C025
      *
      ** If live record and sweep date <= event control date
     C           RECI      IFEQ 'D'
     C           NXTP      ANDLEECD
      *
      ** Compute for the Next Sweep Date
     C           WUPD      IFEQ 'Y'
     C                     EXSR SRNXTD
     C                     ENDIF
     C/COPY WNCPYSRC,RE0732C001
      *
      ** Save Transaction Branch
     C                     MOVE BRCA      WTRBR   3
     C                     MOVE PNAR      WPNAR  30
     C                     MOVE PRFC      WPRFC   4
     C                     MOVE TRAT      WTRAT   5
      *
     C/COPY WNCPYSRC,RE0732C002
      ** Process detail record
     C                     EXSR SRDETL
      *
      ** Count number of records read
     C                     Z-ADDWCOUNT    WTOTAL  50
      *
     C                     ENDIF
     C/COPY WNCPYSRC,RE0732C026
      *
      ** Read next record on file
     C                     READ RESWEPL1                 90
      *                                                                                       197268
     C                     MOVE ' '       WNPOST                                              197268
     C                     Z-ADD0         W#PSTA                                              197268
     C                     Z-ADD0         WOVALD                                              197268
     C                     Z-ADD0         WADIC                                               197268
     C                     Z-ADD0         WACIC                                               197268
      *
     C                     ENDDO
     C/COPY WNCPYSRC,RE0732C029
      *
      **  Perform termination processing
     C                     EXSR SRTERM
      *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *                                                               *
      *  SRINIT - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  SRBRCD - Subroutine to setup array of Branch Table Details   *
      *  AOBANKR0 Access Program                                      *
      *  AORETLR0 Access Program                                      *
      *  AOGELRR0 Access Program                                      *
      *  AORETLR0 Access Program                                      *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR                           ***  INIT  ***
      *
     C                     SETOF                     U7U8LR
      *
      **  Initialise LDA field.
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVEL'RE0732'  DBPGM
     C                     OUT  LDA
      *
      **  Call Access Program for Bank Details - Title, Run Date and
      **  Run Day Number.
     C                     CALL 'AOBANKR0'
     C                     PARM '*BLANKS' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      **  Handle Database Error.
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVELWOPTN     DBKEY
     C                     MOVEL'SDBANKPD'DBFILE           ****************
     C                     Z-ADD001       DBASE            * DB ERROR 001 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Access Retail ICD Details (SDRETLPD)
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*FIRST  'WOPTN   7
     C           SDRETL    PARM SDRETL    DSFDY
      *
      **  Handle Database Error.
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVELWOPTN     DBKEY
     C                     MOVEL'SDRETLPD'DBFILE           ***************
     C                     Z-ADD002       DBASE            *DB ERROR 002 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Access General Ledger Details (SDGELRPD)
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*FIRST  'WOPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
      ** Data base error in file (SDGELRPD)
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVELWOPTN     DBKEY
     C                     MOVEL'SDGELRPD'DBFILE           ***************
     C                     Z-ADD003       DBASE            *DB ERROR 003 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
     C/COPY WNCPYSRC,RE0732C024
      *                                                                                       197268
      ** Check for CDL013 Tiered Withholding Tax                                              197268
      *                                                                                       197268
     C                     CALL 'AOSARDR0'                                                    197268
     C                     PARM '*BLANKS' @RTCD                                               197268
     C                     PARM '*VERIFY' @OPTN                                               197268
     C                     PARM 'CDL013'  @SARD   6                                           197268
      *                                                                                       197268
      ** CAR CGL013 is NOT installed                                                          197268
      *                                                                                       197268
     C           @RTCD     IFNE *BLANKS                                                       197268
     C                     MOVE 'N'       CDL013  1                                           197268
      *                                                                   153813
      **  Call Access Program for Mod Details , To check if whithholding  153813
      **  tax is used or not .                                            153813
      *                                                                   153813
     C                     CALL 'AOMMODR0'                                153813
     C                     PARM '*BLANKS' WRTCD   7                       153813
     C                     PARM '*FIRST ' WOPTN   7                       153813
     C           SDMMOD    PARM SDMMOD    DSFDY                           153813
      *                                                                   153813
      **  Handle Database Error.                                          153813
     C           WRTCD     IFNE *BLANKS                                   153813
     C           *LOCK     IN   LDA                                       153813
     C                     SETON                     U7U8LR               153813
     C                     MOVELWOPTN     DBKEY                           153813
     C                     MOVEL'SDMMODPD'DBFILE           ************** 153813
     C                     Z-ADD022       DBASE            *DB ERROR 022* 153813
     C                     OUT  LDA                        ************** 153813
     C                     EXSR *PSSR                                     153813
     C                     ENDIF                                          153813
      *                                                                                       197268
      ** CAR CDL013 is installed                                                              197268
      *                                                                                       197268
     C                     ELSE                                                               197268
      *                                                                                       197268
     C                     MOVE 'Y'       CDL013  1                                           197268
      *                                                                                       197268
      ** Access WHT ICD record to determine WHT rate.                                         197268
      *                                                                                       197268
     C                     OPEN SDSTAAL1                                                      197268
     C           1         CHAINSDSTAAL1             74                                       197268
     C                     CLOSESDSTAAL1                                                      197268
      *                                                                                       197268
     C           *IN74     IFEQ *ON                                                           197268
     C           *LOCK     IN   LDA                                                           197268
     C                     MOVEL'SDSTAAL1'DBFILE           ************                       197268
     C                     MOVEL'RETAIL'  DBKEY            * DBERR 50 *                       197268
     C                     Z-ADD50        DBASE            ************                       197268
     C                     EXSR *PSSR                                                         197268
     C                     ENDIF                                                              197268
     C                     ENDIF                                                              197268
     C*                                                                   153813
     C** Whithholding tax rate default is zero .                          153813
     C*                                                                   153813
     C                     Z-ADD0         TXWTRR                          153813
     C*                                                                   153813
     C** Get With Tax rate from ICD file if With Tax mod is ON .          153813
     C*                                                                   153813
     C           BGNTST    IFEQ 'Y'                                       153813
     C           CDL013    OREQ 'Y'                                                           197268
     C                     OPEN SDSTAXPD                                  153813
     C           1         CHAINSDSTAXPD             76                   153813
     C                     CLOSESDSTAXPD                                  153813
     C                     END                                            153813
     C*                                                                   153813
     C** ERROR IN SDSTAXPD                                                153813
     C*                                                                   153813
     C           *IN76     IFEQ '1'                                       153813
     C           *LOCK     IN   LDA                                       153813
     C                     Z-ADD023       DBASE            ************** 153813
     C                     MOVEL'SDTAX'   DBFILE           *DB ERROR 023* 153813
     C                     MOVEL*BLANKS   DBKEY            ************** 153813
     C                     OUT  LDA                                       153813
     C                     EXSR *PSSR                                     153813
     C                     END                                            153813
     C*                                                                   153813
     C/COPY WNCPYSRC,RE0732C015
      *                                                                   CEU022
      **  Access Switchable SAR details for the existence of CEU022       CEU022
     C                     CALL 'AOSARDR0'                                CEU022
     C                     PARM *BLANK    @RTCD                           CEU022
     C                     PARM '*VERIFY' @OPTN                           CEU022
     C                     PARM 'CEU022'  @SARD   6                       CEU022
     C           @RTCD     IFEQ *BLANKS                                   CEU022
     C                     MOVE 'Y'       CEU022  1                       CEU022
     C                     ELSE                                           CEU022
     C                     MOVE 'N'       CEU022                          CEU022
     C                     ENDIF                                          CEU022
      *                                                                                       CDL081
      ** Check if CDL081 is installed                                                         CDL081
      *                                                                                       CDL081
     C                     MOVE 'N'       CDL081  1                                           CDL081
     C                     CALL 'AOSARDR0'                                                    CDL081
     C                     PARM *BLANKS   @RTCD                                               CDL081
     C                     PARM '*VERIFY' @OPTN                                               CDL081
     C                     PARM 'CDL081'  @SARD                                               CDL081
      *                                                                                       CDL081
     C           @RTCD     IFNE *BLANKS                                                       CDL081
     C           @RTCD     ANDNE'*NRF   '                                                     CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD206       DBASE                                               CDL081
     C                     MOVE 'SCSARDPD'DBFILE                                              CDL081
     C                     MOVEL'CDL081'  DBKEY                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR *PSSR                                                         CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           @RTCD     IFEQ *BLANKS                                                       CDL081
     C                     MOVE 'Y'       CDL081                                              CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Access withholding tax round down system values if CDL081 is on                      CDL081
      *                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C                     CALL 'AOSVALR0'                                                    CDL081
     C                     PARM *BLANKS   @RTCD                                               CDL081
     C                     PARM C#BASE    SVALK1 20                                           CDL081
     C                     PARM           SVAL1 200                                           CDL081
     C                     PARM C#NBAS    SVALK2 20                                           CDL081
     C                     PARM           SVAL2 200                                           CDL081
     C                     PARM *BLANK    SVALK3 20                                           CDL081
     C                     PARM           SVAL3 200                                           CDL081
     C                     PARM *BLANK    SVALK4 20                                           CDL081
     C                     PARM           SVAL4 200                                           CDL081
     C                     PARM *BLANK    SVALK5 20                                           CDL081
     C                     PARM           SVAL5 200                                           CDL081
     C                     PARM *BLANK    SVALK6 20                                           CDL081
     C                     PARM           SVAL6 200                                           CDL081
     C                     PARM *BLANK    SVALK7 20                                           CDL081
     C                     PARM           SVAL7 200                                           CDL081
     C                     PARM *BLANK    SVALK8 20                                           CDL081
     C                     PARM           SVAL8 200                                           CDL081
     C                     PARM *BLANK    SVALK9 20                                           CDL081
     C                     PARM           SVAL9 200                                           CDL081
     C                     PARM *BLANK    SVALK0 20                                           CDL081
     C                     PARM           SVAL10200                                           CDL081
      *                                                                                       CDL081
     C           @RTCD     IFNE *BLANKS                                                       CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD207       DBASE                                               CDL081
     C                     MOVE 'SDSVALPD'DBFILE                                              CDL081
     C           SVAL1     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK1    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C           SVAL2     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK2    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR *PSSR                                                         CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Setup tax amount rounding down indicators                                            CDL081
      *                                                                                       CDL081
     C                     MOVELSVAL1     W#BSRD  1                                           CDL081
     C                     MOVELSVAL2     W#NBRD  1                                           CDL081
     C                     ENDIF                                                              CDL081
      *
      ** Read in Installation Data
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
      *
      ** Check if Branch is to be displayed (Multi-branching?)
     C           AGMBIN    IFEQ 'Y'
     C                     MOVE '1'       *IN82
      *
      ** Setup array of branch table details
     C                     EXSR SRBRCD
      *
      ** Interbranch Entries via Main Branch?
     C           BKIEMB    IFEQ 'Y'
     C                     MOVE '1'       *IN10
     C                     Z-ADDWIT       WI
     C           BKMABR    LOKUPBC,WI                    11
     C           *IN11     IFEQ '1'
     C                     MOVE BD,WI     MBCI
     C                     ENDIF
     C                     ELSE
     C                     MOVE '0'       *IN10
     C                     ENDIF
      *
     C                     ELSE
     C           BRCA      IFEQ *BLANK                                    153144
     C                     MOVE BJSBRC    BRCA                            153144
     C                     ENDIF                                          153144
     C                     MOVE '0'       *IN82
     C                     ENDIF
      *
      ** Set Date Format Indicator *IN98  on if date format is MMDDYY
     C           AGDFF     IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
      *
      ** Todays Start Balances Key list
     C           ACBTK0    KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA
      *
      ** General Entries Details Key List
     C           REEODK    KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
      *
      ***  Report Work fields.
     C                     Z-ADD0         WCOUNT  50
     C                     MOVE *BLANKS   WSVBR   3
     C                     MOVE *BLANKS   WRVSWF  1
     C                     Z-ADD0         WNORE   50
     C                     Z-ADD0         HASHI  150
     C                     Z-ADD0         HASHD   30
      *                                                                   CEU022
      ** REACR                                                            CEU022
     C           KEY01     KLIST                                          CEU022
     C***                  KFLD           DCUS                      CEU022149032
     C                     KFLD           DCUSND                          149032
     C                     KFLD           DCCY                            CEU022
     C***                  KFLD           DACD                      CEU022149032
     C***                  KFLD           DACS                      CEU022149032
     C***                  KFLD           DRBR                      CEU022149032
     C                     KFLD           DACODD                          149032
     C                     KFLD           DACSQD                          149032
     C                     KFLD           DBRCH                           149032
      *                                                                   CEU022
      ** IACBR                                                            CEU022
     C           KEY02     KLIST                                          CEU022
     C***                  KFLD           DRBR                      CEU022149032
     C***                  KFLD           DCUS                      CEU022149032
     C                     KFLD           DBRCH                           149032
     C                     KFLD           DCUSND                          149032
     C                     KFLD           DCCY                            CEU022
     C***                  KFLD           DACD                      CEU022149032
     C***                  KFLD           DACS                      CEU022149032
     C                     KFLD           DACODD                          149032
     C                     KFLD           DACSQD                          149032
      *                                                                   CEU022
      ** REACR                                                            CEU022
     C           KEY03     KLIST                                          CEU022
     C                     KFLD           CCUS                            CEU022
     C                     KFLD           CCCY                            CEU022
     C                     KFLD           CSCA                            CEU022
     C                     KFLD           CACD                            CEU022
     C                     KFLD           CBRC                            CEU022
      *                                                                   CEU022
      ** IACBR                                                            CEU022
     C           KEY04     KLIST                                          CEU022
     C                     KFLD           CBRC                            CEU022
     C                     KFLD           CCUS                            CEU022
     C                     KFLD           CCCY                            CEU022
     C                     KFLD           CSCA                            CEU022
     C                     KFLD           CACD                            CEU022
      *                                                                   134902
      ** Extra interest processing uses old RUND field.                   134902
     C                     Z-ADDBJRDNB    RUND                            134902
      *
      ***  Determine Event Control Date
     C                     Z-ADDBKAPDT    ZZAPDT  50
     C                     Z-ADDBJDNWD    ZZDNWD  50
     C                     EXSR ZEVCD
     C/COPY WNCPYSRC,RE0732C012
      *
      ** Call AOSARDR0 to check for CER016                                                    CER016
      *                                                                                       CER016
     C                     CALL 'AOSARDR0'                                                    CER016
     C                     PARM *BLANKS   PRTCD   7                                           CER016
     C                     PARM '*VERIFY' POPTN   7                                           CER016
     C                     PARM 'CER016'  PSARD   6                                           CER016
     C           SCSARD    PARM SCSARD    DSFDY                                               CER016
      *                                                                                       CER016
     C           PRTCD     IFEQ *BLANKS                                                       CER016
     C                     MOVE 'Y'       CER016  1                                           CER016
     C                     MOVE 'Y'       WFIRST  1                                           CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C                     MOVE 'N'       CER016                                              CER016
     C                     MOVE 'N'       WFIRST                                              CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C           PRTCD     IFNE *BLANKS                                                       CER016
     C           PRTCD     ANDNE'*NRF   '                                                     CER016
      *                                                                                       CER016
     C           *LOCK     IN   LDA                                                           CER016
     C                     MOVEL'CER016'  DBKEY                                               CER016
     C                     MOVEL'SCSARDPD'DBFILE                                              CER016
     C                     Z-ADD097       DBASE                                               CER016
     C                     OUT  LDA                                                           CER016
      *                                                                                       CER016
     C                     EXSR *PSSR                                                         CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRNXTD - Subroutine to Compute Next Sweep Date.              *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  ZFREQB - Calculate day no. of next sweep date from current   *
      *           date/day in month and frequency code.               *
      *  ZFWDT  - Calculate the nth working day forward from a given  *
      *           start date fo any particular Ccy and location.      *
      *                                                               *
      *****************************************************************
      *
     C           SRNXTD    BEGSR                           *** SRNXTD ***
      *
      ** Compute Next Sweep Date
     C                     MOVE NXTP      ZDAYNO  50
     C                     MOVE PAYF      ZFREQ   1
     C                     MOVE DYTP      ZMDAY   20
     C**********           MOVE CCY       ZCCY    3                                           173010
     C                     MOVE BJLCCY    ZCCY    3                                           173010
     C                     MOVE *BLANKS   ZLOC    3
      *
     C                     EXSR ZFREQB
     C                     MOVE *ZEROS    ZNRDYS  20
     C                     EXSR ZFWDT
     C                     MOVE ZDYNBR    NXTP
      *
      ** If Next Sweep Date  > final date, flag record as deleted
     C           NXTP      IFGT DLPY
     C           DLPY      ANDNE*ZERO
     C                     MOVE '*'       RECI
     C                     MOVE BJRDNB    LCD
     C                     MOVEL'D'       CHTP
     C                     END
      *
      ** Update record in file
     C                     UPDATRESWEPD0
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCBR1 - Change in Branch Processing for Detail Report       *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  AOBRCHR0 Access Program                                      *
      *  RCFP1  - RCF Processing for Printer Report File (RE0732P1)   *
      *                                                               *
      *****************************************************************
      *
     C           SRCBR1    BEGSR                           *** SRCBR1 ***
      *
      ** Output report footer and close printer file (RE0732P1)
     C           OPENP1    IFEQ 'Y'
      *
      ** Multi-Branching indicator on?
     C           *IN82     IFEQ '1'
     C                     MOVE WSVBR     RSBRCD
     C                     ELSE                                           135467
     C                     MOVE BJSBRC    RSBRCD                          135467
     C                     ENDIF
      *
     C                     WRITETRAILP1
     C                     CLOSERE0732P1
     C                     MOVE 'N'       OPENP1  1
     C                     ENDIF
     C           *IN82     IFEQ '0'                                       135467
     C                     MOVE BJSBRC    WTRBR                           135467
     C                     ENDIF                                          135467
      *
      ** Get Branch details
     C                     EXSR SRMULT
      *
      ** Open printer file
     C                     OPEN RE0732P1
     C                     MOVE 'Y'       OPENP1
      *
      ** RCF Processing for Printer File (RE0732P1)
     C                     EXSR RCFP1
      *
      ** Multi-Branching indicator on?
     C           *IN82     IFEQ '1'
     C                     MOVEL*BLANKS   RSDESC
     C                     EXSR SRMULT
     C                     MOVELWTRBR     RSBRCD
     C                     MOVELWDESC     RSDESC
     C                     ENDIF
      *
      ** Output header details
     C                     WRITEHEADP1
     C                     WRITEDTLHDR
      *
      ** Save Branch
     C                     MOVE WTRBR     WSVBR
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCBR2 - Change in Branch Processing for Exception Report    *
      *                                                               *
      *  Called By: Referrals Processing                              *
      *  Calls:                                                       *
      *  AOBRCHR0 Access Program                                      *
      *  RCFP2  - RCF Processing for Printer Report File (RE0732P2)   *
      *        (none)                                                 *
      *                                                               *
      *****************************************************************
      *
     C           SRCBR2    BEGSR                           *** SRCBR2 ***
      *
      ** Output report footer and close printer file (RE0732P2)
     C           OPENP2    IFEQ 'Y'
      *
      ** Multi-Branching indicator on?
     C           *IN82     IFEQ '1'
     C                     MOVE WSVBR     RSBRCD
     C                     ENDIF
      *
     C                     WRITETRAILP2
     C                     CLOSERE0732P2
     C                     MOVE 'N'       OPENP2
     C                     ENDIF
      *
      ** Get Branch details
     C                     EXSR SRMULT
      *
      ** Open printer file
     C                     OPEN RE0732P2
     C                     MOVE 'Y'       OPENP2
      *
      ** RCF Processing for Printer File (RE0732P2)
     C                     EXSR RCFP2
      *
      ** Multi-Branching indicator on?
     C           *IN82     IFEQ '1'
     C                     MOVEL*BLANKS   RSDESC
     C                     EXSR SRMULT
     C                     MOVELWTRBR     RSBRCD
     C                     MOVELWDESC     RSDESC
     C                     ENDIF
      *
      ** Output Report Header
     C                     WRITEHEADP2
     C                     WRITEDTLHDR2
      *
      ** Save Branch
     C                     MOVE WTRBR     WBRCH2  3
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRMULT - Access Branch Description                           *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  AOBRCHR0 Access Program                                      *
      *  RCFP1  - RCF Processing for Printer Report File (RE0732P1)   *
      *                                                               *
      *****************************************************************
      *
     C           SRMULT    BEGSR                           *** SRMULT ***
      *                                                                   135467
      ** Get Branch details  If single branch move SDBANKPD branch        135467
     C*  into work field WTRBR.                                           135467
      *                                                                   135467
     C           AGMBIN    IFNE 'Y'                                       135467
     C                     MOVE BJSBRC    WTRBR                           135467
     C                     END                                            135467
      *
      ** Get Branch details
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C**********           PARM *BLANKS   WRTCD   7                                           193986
     C                     PARM *BLANKS   TRTCD   7                                           193986
     C                     PARM '*KEY    'WOPTN   7
     C                     PARM           WTRBR
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      ** Data base error in file (SDBRCHPD)
     C********** WRTCD     IFNE *BLANKS                                                       193986
     C           TRTCD     IFNE *BLANKS                                                       193986
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     Z-ADD004       DBASE            ***************
     C                     MOVEL'SDBRCHPD'DBFILE           *DB ERROR 004 *
     C                     MOVELWTRBR     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE A8BRNM    WDESC  30
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRDETL - Detail Processing.                                  *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  SRAACD - Access Account Details.                             *
      *  SRRFP1 - Referrals Processing.                               *
      *  SRSWPP - Sweep Processing.                                   *
      *  SRCAPT - INTEREST CAPITALISATION CHECK                       *   150289
      *                                                               *
      *****************************************************************
      *
     C           SRDETL    BEGSR                           *** SRDETL ***
      *
     C                     MOVE 'N'       WBLOCK  1
     C                     MOVE 'N'       WINSFN  1                                           254051
      *
      **  D E B I T
      ** Use Retail Account Nbr if present
      *
     C                     MOVE DRAN      WRAN   10
     C                     MOVE DCUS      WCUSN   6
     C                     MOVE CCY       WCCY    3
     C**********           MOVE DACD      WACOD   4                                           CGL029
     C                     MOVE DACD      WACOD                                               CGL029
     C                     MOVE DACS      WACSQ   2
      *                                                                   135467
     C           DRBR      IFEQ *BLANK                                    135467
     C                     MOVE *BLANK    WBRCH   3                       153144
     C                     MOVE BJSBRC    DRBR                            153144
     C           DRAN      IFEQ *ZERO                                     153144
     C                     MOVE BJSBRC    WBRCH   3                       135467
     C                     END                                            153144
     C                     ELSE                                           135467
     C                     MOVE DRBR      WBRCH   3
      *                                                                   177670
     C**********           MOVE DCUS      CMCUS   60                                   177670 CSD027
     C**********           MOVE DCUS      CMCUS   6                                    CSD027 233259
     C**********           MOVE CCY       CMCCY   3                       177670              233259
     C**********           MOVE DACD      CMACD   40                                   177670 CGL029
     C**********           MOVE DACD      CMACD  100                                   CGL029 233259
     C**********           MOVE DACS      CMACS   20                      177670              233259
     C**********           MOVE DRBR      CMBRC   3                       177670              233259
     C**********           MOVE ' '       SRAF    1                                  197268 MD045744
     C                     END                                            135467
     C                     MOVE ' '       SRAF                                              MD045744
      *
      ** Get account details of Credit A/c of Origin
     C                     EXSR SRAACD
      *
     C           WRTCD     IFEQ *BLANKS
      *                                                                                       233259
     C**********           MOVE WCUSN     CMCUS   60                                          233259
     C                     MOVE WCUSN     CMCUS   6                                    233259 CSD031
     C                     MOVE WCCY      CMCCY   3                                           233259
     C                     MOVE WACOD     CMACD  100                                          233259
     C                     MOVE WACSQ     CMACS   20                                          233259
     C                     MOVE WBRCH     CMBRC   3                                           233259
      *
     C                     MOVE WACNO     WDRAC  10
     C                     MOVE WRRNM     WDRRM   50
     C                     MOVE WCLBL     WDRCB  150
     C                     MOVE WLDBL     WDRLB  150
     C                     MOVE WACS      WDRACS  2
     C                     MOVE WACCNT    WDRACT
      *                                                                   134902
      ** Save details of DR/CR rate change date                           134902
     C                     Z-ADDDRCD      WDRCD                           134902
     C                     Z-ADDCRCD      WCRCD                           134902
     C                     Z-ADDDRIB      WDRIB                           134902
     C                     Z-ADDDRIS      WDRIS                           134902
     C                     Z-ADDDRIC      WDRIC                           134902
     C                     Z-ADDOLDR      WOLDR                           134902
     C                     Z-ADDCRIB      WCRIB                           134902
     C                     Z-ADDCRIS      WCRIS                           134902
     C                     Z-ADDCRIC      WCRIC                           134902
     C                     Z-ADDOLCR      WOLCR                           134902
      *
      ** Store Branch Details
     C                     MOVE CBCI      DBCI
      *
      ** Move account referral conditions of Credit A/c of Origin to
      ** work fields
     C                     MOVE WRFDR     DRFDR   1
     C                     MOVE WRFCR     DRFCR   1
     C                     MOVE WBLDR     DBLDR   1
     C                     MOVE WBLCR     DBLCR   1
      *
     C                     ENDIF
      *
      ** Account do not exist? closed?
     C********** WRECI     IFNE 'D'                                                         MD034985
     C           ARECI     IFNE 'D'                                                         MD034985
     C           ACST      OREQ 'C'
     C           CEU022    ANDEQ'N'                                       CEU022
     C           WINAC     OREQ 'Y'
     C           WBKPT     OREQ 'Y'
     C           WBDDT     OREQ 'Y'
     C           WRTCD     OREQ '*NRF   '
      *
      ** Perform Referrals processing
     C                     EXSR SRRFP1
     C                     ENDIF
      *
      ** If sweeping for CR A/c of origin possible (i.e. A/c exists,
      ** active, etc.)
     C           WBLOCK    IFNE 'Y'
      *
      **  C R E D I T
      ** Use Retail Account Nbr if present
      *
     C                     MOVE CRAN      WRAN
     C                     MOVE CCUS      WCUSN
     C           CEU022    IFEQ 'Y'                                       CEU022
     C                     MOVE CCYC      WCCY                            CEU022
     C                     ELSE                                           CEU022
     C                     MOVE CCY       WCCY
     C                     ENDIF                                          CEU022
     C                     MOVE CSCA      WACOD
     C                     MOVE CACD      WACSQ
     C                     MOVE CBRC      WBRCH
      *
      ** Get account details of Credit Sweep Account
     C                     EXSR SRAACD
      *
     C           WRTCD     IFEQ *BLANKS
      *
     C                     MOVE WACNO     WCRAC  10
     C                     MOVE WRRNM     WCRRM   50
     C                     MOVE WCLBL     WCRCB  150
     C                     MOVE WLDBL     WCRLB  150
     C                     MOVE WACS      WCRACS  2
     C                     MOVE WACCNT    WCRACT
      *
      ** Store Branch Details
     C                     MOVE CBCI      CBCI
      *
     C                     Z-ADDODLN      WODLN  110
     C                     Z-ADDODED      WODED   50
      *
      ** Move account referral conditions of Credit Sweep Account to
      ** work fields
     C                     MOVE WRFDR     CRFDR   1
     C                     MOVE WRFCR     CRFCR   1
     C                     MOVE WBLDR     CBLDR   1
     C                     MOVE WBLCR     CBLCR   1
      *
     C                     ENDIF
      *
      ** Account do not exist? closed?
     C********** WRECI     IFNE 'D'                                                         MD034985
     C           ARECI     IFNE 'D'                                                         MD034985
     C           ACST      OREQ 'C'
     C           WINAC     OREQ 'Y'
     C           WBKPT     OREQ 'Y'
     C           WBDDT     OREQ 'Y'
     C           WRTCD     OREQ '*NRF   '
      *
      ** Perform Referrals processing
     C                     EXSR SRRFP1
     C                     ENDIF
      *
      ** Check if Sweeping will take place (no error on both A/cs)
     C           WBLOCK    IFNE 'Y'
      *                                                                   150289
      ** CHECK IF INTEREST CAPITALISATION MUST BE PROCESS OR NOT          150289
     C                     EXSR SRCAPT                                    150289
      *                                                                   150289
     C/COPY WNCPYSRC,RE0732C003
      ** Perform Sweep Processing if one of the follwing is true:
     C           WDRCB     IFGT STHR
     C           SWTP      ANDEQ'1'
     C           WDRCB     ORGT STHR
     C           SWTP      ANDEQ'3'
     C           WDRCB     ORLT STHR
     C           SWTP      ANDEQ'2'
     C           WDRCB     ORLT STHR
     C           SWTP      ANDEQ'3'
     C           WDRCB     ORLT STHR                                      CEU022
     C           SWTP      ANDEQ'4'                                       CEU022
     C           WDRCB     ORGT STHR                                      CEU022
     C           SWTP      ANDEQ'4'                                       CEU022
     C                     EXSR SRSWPP
      *
     C                     ENDIF
     C/COPY WNCPYSRC,RE0732C013
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRAACD - Access Account Details.                             *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  AOACCTR0 Access Program.                                     *
      *  AOBRCHR0 Access Program.                                     *
      *  AOACODR0 Access Program.                                     *
      *                                                               *
      *****************************************************************
      *
     C           SRAACD    BEGSR                           *** SRAACD ***
      *
      ** Get Account details
     C                     CALL 'AOACCTR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY    'WOPTN   7
     C                     PARM           WRAN
     C                     PARM           WCUSN
     C                     PARM           WCCY
     C                     PARM           WACOD
     C                     PARM           WACSQ
     C                     PARM           WBRCH
     C           SDACCT    PARM SDACCT    DSSDY
      *
     C           WRTCD     IFNE *BLANKS                                                       193986
     C                     MOVE WRAN      WACNO  10                                           193986
     C                     ELSE                                                               193986
     C********** WRTCD     IFEQ *BLANKS                                                       193986
      *
      **  Get Retail A/c no and relative record no of memos record
     C                     MOVE ACNO      WACNO  10
     C                     Z-ADDRRNM      WRRNM   50
     C**********           MOVE ACOD      WACCD   4                                           CGL029
     C                     MOVE ACOD      WACCD  10                                           CGL029
     C                     MOVE CNUM      WCUSN
     C                     MOVE CCY       WCCY
     C                     MOVE ACOD      WACOD
     C                     MOVE ACSQ      WACSQ
     C                     MOVE BRCA      WBRCH
     C**********           MOVE RECI      WRECI   1                                         MD034985
     C                     MOVE RECI      ARECI   1                                         MD034985
     C                     MOVE STFQ      WSTFQ   1                       177670
      *                                                                                       197268
     C           SRAF      IFEQ ' '                                                           197268
     C                     MOVE 'F'       SRAF    1                                           197268
     C                     MOVE WACNO     WDRAC  10                                           197268
     C                     MOVE WRRNM     WDRRM   50                                          197268
     C                     MOVE WCLBL     WDRCB  150                                          197268
     C                     MOVE WLDBL     WDRLB  150                                          197268
     C                     MOVE WACS      WDRACS  2                                           197268
     C                     MOVE WACCNT    WDRACT                                              197268
      *                                                                                       197268
      ** Save details of DR/CR rate change date                                               197268
      *                                                                                       197268
     C                     Z-ADDDRCD      WDRCD                                               197268
     C                     Z-ADDCRCD      WCRCD                                               197268
     C                     Z-ADDDRIB      WDRIB                                               197268
     C                     Z-ADDDRIS      WDRIS                                               197268
     C                     Z-ADDDRIC      WDRIC                                               197268
     C                     Z-ADDOLDR      WOLDR                                               197268
     C                     Z-ADDCRIB      WCRIB                                               197268
     C                     Z-ADDCRIS      WCRIS                                               197268
     C                     Z-ADDCRIC      WCRIC                                               197268
     C                     Z-ADDOLCR      WOLCR                                               197268
      *                                                                                       197268
      ** Store Branch Details                                                                 197268
      *                                                                                       197268
     C                     MOVE CBCI      DBCI                                                197268
      *                                                                                       197268
      ** Move account referral conditions of Credit A/c of Origin to                          197268
      ** work fields                                                                          197268
      *                                                                                       197268
     C                     MOVE WRFDR     DRFDR   1                                           197268
     C                     MOVE WRFCR     DRFCR   1                                           197268
     C                     MOVE WBLDR     DBLDR   1                                           197268
     C                     MOVE WBLCR     DBLCR   1                                           197268
     C                     END                                                                197268
      *
      *  Use balances from PF/GLACBTPD on first run.
     C********** WUPD      IFEQ 'N'                                       155098
     C           CUPD      IFEQ 'Y'                                       155098
      ***Move*start*of*day*balances*to*work*fields*********************** 155098
     C**********           Z-ADD0         CLBL                            155098
     C**********           Z-ADD0         LDBL                            155098
      *
      *  Access the 'Start Of Day' Account Balances
     C********** ACBTK0    CHAINGLACBTL0             97                   155098
     C           ACBTK0    CHAINGLACBTL0             9797                 155098
      ** Initialise Balances if not found or error, so that only          155098
      ** postings are swept.  Not found indicates new account today.      155098
     C           *IN97     IFEQ '1'                                       155098
     C                     Z-ADD0         CLBL                            155098
     C                     Z-ADD0         LDBL                            155098
     C                     ENDIF                                          155098
     C                     ENDIF
      *
      ** Add Todays postings to the Opening Balances
     C           REEODK    CHAINREEODLF              97
      *                                                                                       197268
     C           *IN97     IFEQ '0'                                                           197268
     C           BKANWD    ANDEQ'2'                                                           197268
     C           VALD      ANDGTDHISD                                                         197268
      *                                                                                       197268
      ** Access the last record from LF/REHISL                                                197268
      *                                                                                       197268
     C           R1KEY     SETGTREHISL                                                        197268
     C           R1KEY     REDPEREHISL                   97                                   197268
     C           *IN97     IFEQ '1'                                                           197268
     C                     EXSR REHSR                                                         197268
     C                     END                                                                197268
     C                     END                                                                197268
     C           *IN97     DOWEQ'0'
      *                                                                                       197268
      ** Do this only if Accrual for non-working day is '2'                                   197268
      *                                                                                       197268
     C           BKANWD    IFEQ '2'                                                           197268
     C           VALD      ANDGTDHISD                                                         197268
     C                     MOVE 'Y'       WNPOST  1                                           197268
     C           DRCR      IFEQ *ZERO                                                         197268
     C                     Z-ADDPSTA      W#PSTA                                              197268
     C                     ELSE                                                               197268
     C                     Z-SUBPSTA      W#PSTA                                              197268
     C                     END                                                                197268
     C           VALD      IFNE WOVALD                                                        197268
     C                     Z-ADDVALD      WVALD                                               197268
     C           WOVALD    IFEQ *ZERO                                                         197268
     C                     Z-ADDDHISD     WHISD                                               197268
     C                     ELSE                                                               197268
     C                     Z-ADDWOVALD    WHISD                                               197268
     C                     END                                                                197268
     C                     Z-ADD0         DINT                                                197268
     C                     Z-ADD0         CINT                                                197268
     C                     EXSR INTCAL                                                        197268
     C                     ADD  DINT      WADIC                                               197268
     C                     ADD  CINT      WACIC                                               197268
     C                     END                                                                197268
     C                     ADD  W#PSTA    RHISB                                               197268
     C                     Z-ADDVALD      WOVALD                                              197268
     C                     END                                                                197268
      *
      ** Value Date < Next Working Date, add/subtract Posting Amt
      ** to Cleared Balance
     C           VALD      IFLT BJDNWD
      * CR=1, DR=0
     C           DRCR      IFEQ *ZERO
     C                     ADD  PSTA      CLBL
     C                     ELSE
     C                     SUB  PSTA      CLBL
     C                     ENDIF
     C                     ENDIF
      *
      ** Posting Date >= Rundate, add/subtract Posting Amt
      ** to Ledger Balance
     C           PSTD      IFGE BJRDNB
      * CR=1, DR=0
     C           DRCR      IFEQ *ZERO
     C                     ADD  PSTA      LDBL
     C                     ELSE
     C                     SUB  PSTA      LDBL
     C                     ENDIF
     C                     ENDIF
      *
      ** Read next Posting for this account.
     C           REEODK    READEREEODLF                  97
     C                     ENDDO
      *
     C           WNPOST    IFEQ 'Y'                                                           197268
     C                     Z-ADDWOVALD    WHISD                                               197268
     C                     Z-ADDRUND      WVALD                                               197268
     C                     END                                                                197268
      *
     C/COPY WNCPYSRC,RE0732C004
     C                     Z-SUBCLBL      WCLBL  150
     C                     Z-SUBLDBL      WLDBL  150
      *
      ** Initialise referral conditions
     C                     MOVE 'N'       WRFDR   1
     C                     MOVE 'N'       WRFCR   1
     C                     MOVE 'N'       WBLDR   1
     C                     MOVE 'N'       WBLCR   1
     C                     MOVE 'N'       WINAC   1
     C                     MOVE 'N'       WBKPT   1
     C                     MOVE 'N'       WBDDT   1
      *
      ** Account referral conditions
     C                     TESTB'0'       RETB           77
     C           *IN77     IFEQ '1'
     C                     MOVE 'Y'       WRFDR
     C                     ENDIF
     C                     TESTB'1'       RETB           77
     C           *IN77     IFEQ '1'
     C                     MOVE 'Y'       WRFCR
     C                     ENDIF
     C                     TESTB'2'       RETB           77
     C           *IN77     IFEQ '1'
     C                     MOVE 'Y'       WBLDR
     C                     ENDIF
     C                     TESTB'3'       RETB           77
     C           *IN77     IFEQ '1'
     C                     MOVE 'Y'       WBLCR
     C                     ENDIF
     C                     TESTB'4'       RETB           77
     C           *IN77     IFEQ '1'
     C                     MOVE 'Y'       WINAC
     C                     ENDIF
     C                     TESTB'6'       RETB           77
     C           *IN77     IFEQ '1'
     C                     MOVE 'Y'       WBKPT
     C                     ENDIF
     C                     TESTB'7'       RETB           77
     C           *IN77     IFEQ '1'
     C                     MOVE 'Y'       WBDDT
     C                     ENDIF
      *
      **  Get A/c code details
     C                     CALL 'AOACODR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY    'WOPTN   7
     C                     PARM           WACCD
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *
      **  Handle Database Error.
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVELWACCD     DBKEY
     C                     MOVEL'SDACODPD'DBFILE           ****************
     C                     Z-ADD007       DBASE            * DB ERROR 007 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Get A/c Section
     C                     MOVELA5ACSC    WACS    2
      *
      **  Get A/c Branch details
     C                     Z-ADDWIT       WI
     C*                                                                   135467
     C* Only look up table if multi brancehed else use WBRCH which        135467
     C* denote single branch name.                                        135467
     C*                                                                   135467
     C           AGMBIN    IFEQ 'Y'                                       135467
     C*                                                                   135467
     C           WBRCH     LOKUPBC,WI                    12
     C           *IN12     IFEQ '1'
     C                     MOVE BD,WI     CBCI
     C*                                                                   135467
     C                     ELSE                                           135467
     C                     MOVE BJSBRC    CBCI                            135467
     C*                                                                   135467
     C                     ENDIF
      *
     C                     ENDIF                                          135467
     C*                                                                   135467
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRSWPP - Sweep Processing.                                   *
      *                                                               *
      *  Called By: Detail Processing                                 *
      *  Calls:                                                       *
      *  SRRVSP - Reverse Sweep Processing                            *
      *  SRRFP2 - Check Referral Conditions                           *
      *  SRW01  - Write Debit Posting record in GESPPD                *
      *  SRW02  - Write Credit Posting record in GESPPD               *
      *  SRW03  - Output Interbranch Postings to GESPPD               *
      *  SRW04  - Output Main Branch Entries to GESPPD                *
      *  ZFRPED - Midas ZS Edit Amount                                *
      *  AOCURRR0 Access Program.                                     *
      *                                                               *
      *****************************************************************
      *
     C           SRSWPP    BEGSR                           *** SRSWPP ***
      *
      ** Get no. of decimal places for currency
     C           CEU022    IFEQ 'Y'                                       CEU022
     C                     MOVE DCCY      CCY                             CEU022
     C                     ENDIF                                          CEU022
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY    'WOPTN   7
     C                     PARM           CCY
     C           SDCURR    PARM SDCURR    DSSDY
      *
      **  Handle Database Error.
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVELCCY       DBKEY
     C                     MOVEL'SDCURRPD'DBFILE           ****************
     C                     Z-ADD008       DBASE            * DB ERROR 008 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Format DR and CR Balance
     C                     Z-ADDA6NBDP    ZDECS
     C                     Z-ADDA6NBDP    DCNBDP  10                      CEU022
     C                     Z-SUBWDRCB     ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSBALO
      *
      *                                                                   CEU022
     C           CEU022    IFEQ 'Y'                                       CEU022
     C           DCCY      ANDNECCCY                                      CEU022
      *                                                                   CEU022
      ** Debit currency details                                           CEU022
     C                     MOVE A6CYCD    ZCCYF                           CEU022
     C                     Z-ADDA6SPRT    ZRATEF                          CEU022
     C                     MOVE A6MDIN    ZMDINF                          CEU022
     C                     Z-ADDA6NBDP    ZCDPF                           CEU022
     C**********           MOVE A6SPAE    DRSPAE  4                                    CEU022 CGL029
     C                     MOVE A6SPAE    DRSPAE 10                                           CGL029
     C                     MOVE A6INCY    DRINCY  1                       146799
      *                                                                   CEU022
      ** Get no. of decimal places for CR currency                        CEU022
     C                     CALL 'AOCURRR0'                                CEU022
     C                     PARM *BLANKS   WRTCD   7                       CEU022
     C                     PARM '*KEY    'WOPTN   7                       CEU022
     C                     PARM           CCCY                            CEU022
     C           SDCURR    PARM SDCURR    DSSDY                           CEU022
      *                                                                   CEU022
      **  Handle Database Error.                                          CEU022
     C           WRTCD     IFNE *BLANKS                                   CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     SETON                     U7U8LR               CEU022
     C                     MOVELCCCY      DBKEY                           CEU022
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU022
     C                     Z-ADD009       DBASE            * DB ERROR 009 CEU022
     C                     OUT  LDA                        ***************CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     MOVE A6CYCD    ZCCYT                           CEU022
     C                     Z-ADDA6SPRT    ZRATET                          CEU022
     C                     MOVE A6MDIN    ZMDINT                          CEU022
     C                     Z-ADDA6NBDP    ZCDPT                           CEU022
     C                     Z-ADDA6NBDP    CCNBDP  10                      CEU022
     C**********           MOVE A6SPAE    CRSPAE  4                                    CEU022 CGL029
     C                     MOVE A6SPAE    CRSPAE 10                                           CGL029
     C                     MOVE A6INCY    CRINCY  1                       146799
      *                                                                   CEU022
     C                     Z-ADDA6NBDP    ZDECS
     C                     Z-SUBWCRCB     ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSBALS
      *                                                                   CEU022
     C                     ELSE                                           CEU022
      *
     C                     Z-ADDA6NBDP    ZDECS
     C                     Z-SUBWCRCB     ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSBALS
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *
      **  Move fields to report fields
     C                     MOVE SWEP      RSSWEP
      *
      ***  Format CR A/c of Origin and CR Sweep Account
      ***  (If Retail A/c Number Used Flag is 'Y'
      ***  {SDRETLPD/BMRANR='Y'}, print Account Number (ACNO)
      ***  from PF/ACCNTAB otherwise print Midas full Account
      ***  Number
      *
     C           BMRANR    IFEQ 'Y'
      *
     C                     MOVE WDRAC     RSCRAO    P
     C                     MOVE WCRAC     RSCRSA    P
     C                     ELSE
     C                     MOVE WDRACT    RSCRAO
     C                     MOVE WCRACT    RSCRSA
      *
     C                     ENDIF
      *                                                                   134902
      ** For Euro sweep's, if the retail a/c number is being retained,    134902
      ** the retail a/c number on the IN currency a/c will be zeros,      134902
      ** print full a/c number instead.                                   134902
     C           SWTP      IFEQ '4'                                       134902
     C           WDRAC     IFEQ *BLANKS                                   134902
     C           WDRAC     OREQ *ZEROS                                    134902
     C                     MOVE WDRACT    RSCRAO                          134902
     C                     END                                            134902
     C                     END                                            134902
      *
     C                     Z-ADD0         SWPAMT 150
     C/COPY WNCPYSRC,RE0732C005
      ********************************************************************150289
     C/COPY WNCPYSRC,RE0732C014
      * ALL FOLLOWING INSTRUCTIONS (150289) HAVE BEEN PUT IN SR SRCAPT    150289
      ********************************************************************150289
     C***********CEU022    IFEQ 'Y'                                133672 150289
      ***************                                              134902 150289
      ***Store*the*cleared*balance*figures;*because*if*it's*not*the134902 150289
      ***final*sweep*date*the*'start*of*day*cleared*balances'*are*n134902 150289
      ***output*correctly*as*the*following*code*is*not*executed*unl134902 150289
      ***it's*the*final*sweep.*************************************134902 150289
     C***************      MOVE WCRCB     W#CRCB 150               134902 150289
     C***************      MOVE WDRCB     W#DRCB 150               134902 150289
      ***************                                              133672 150289
      ***If*Sweep*Type*=*'4'***************************************133672 150289
     C***********SWTP      IFEQ '4'                                133672 150289
     C***********DLPY      ANDGEBJRDNB                             133672 150289
     C***********DLPY      ANDLTBJDNWD                             133672 150289
     C***********DLPY      ANDNE*ZERO                              133672 150289
      ***************                                              133672 150289
     C***********KEY01     CHAINREACR                97            133672 150289
      ***************                                              149032 150289
      ***DATABASE*ERROR*IF*RECORD*NOT*FOUND************************149032 150289
     C************IN97     IFEQ '1'                                149032 150289
     C************LOCK     IN   LDA                                149032 150289
     C***************      Z-ADD020       DBASE                    149032 150289
     C***************      CLEARDBFILE                             149032 150289
     C***************      MOVEL'REACR'   DBFILE           ********149032 150289
     C***************      CLEARDBKEY                      * DBERR 149032 150289
     C***********WDRAC2    CAT  DBRCH     DBKEY            ********149032 150289
     C***************      OUT  LDA                                149032 150289
     C***************      EXSR *PSSR                              149032 150289
     C***************      ENDIF                                   149032 150289
      ***************                                              133672 150289
      ***Add*extra*processing*for*accrued*interest*so*totals*are*co134902 150289
     C***************      EXSR SREXTP                             134902 150289
      ***************                                              134902 150289
     C***********DAIC1     ADD  MADI      TOT1   150               133672 150289
     C***********GADI      ADD  TOT1      TOT1                     133672 150289
      ***************                                              133672 150289
     C***********CAIC1     ADD  MACI      TOT2   150               133672 150289
     C***********GACI      ADD  TOT2      TOT2                     133672 150289
      ***************                                              133672 150289
     C***********TOT1      SUB  TOT2      TOT3   150               133672 150289
     C*                                                                   153813
     C** Calculate the withhold tax amount from the credit interest       153813
     C** only if with mod is ON and Tax with rate is not zero             153813
     C*                                                                   153813
     C           BGNTST    IFEQ 'Y'                        IF1            153813
     C           TXWTRR    ANDNE0                                         153813
     C*                                                                   153813
     C           KEY01     CHAINACCNTBXC             78                   153813
     C*                                                                   153813
     C           *IN78     IFEQ *OFF                       IF2            153813
      *                                                                   153813
      ** check if allowed to tax individual acc                           153813
      *                                                                   153813
     C           ATITAX    IFEQ 'Y'                        IF3            153813
     C                     MOVEL*ZEROS    TAXAMT                          153813
      *                                                                   153813
     C           TXWNDI    IFEQ 'N'                        IF4            153813
     C           TOT2      MULT TXWTRR    TAXAMT 150                      153813
     C           TAXAMT    DIV  100       TAXAMT    H                     153813
     C           TOT3      ADD  TAXAMT    TOT3                            153813
     C                     ELSE                            ELSE4          153813
     C** Netdebit credit interest is yes, with tax over total of both     153813
     C** credit and debit interest only if credit more than debit .       153813
     C*                                                                   153813
     C           TOT3      IFLT 0                                         153813
     C           TOT3      MULT TXWTRR    TAXAMT                          153813
     C           TAXAMT    DIV  100       TAXAMT    H                     153813
     C           TOT3      SUB  TAXAMT    TOT3                            153813
     C                     END                                            153813
      *                                                                   153813
     C                     ENDIF                           END4           153813
      *                                                                   153813
     C                     ENDIF                           END3           153813
      *                                                                   153813
     C                     ENDIF                           END2           153813
      *                                                                   153813
     C                     ENDIF                           END1           153813
      *                                                                   153813
      ***************                                              133672 150289
     C***********KEY02     CHAINIACBR                97            133672 150289
      ***************                                              149032 150289
      ***DATABASE*ERROR*IF*RECORD*NOT*FOUND************************149032 150289
     C************IN97     IFEQ '1'                                149032 150289
     C************LOCK     IN   LDA                                149032 150289
     C***************      Z-ADD21        DBASE                    149032 150289
     C***************      CLEARDBFILE                             149032 150289
     C***************      MOVEL'IACBR'   DBFILE           ********149032 150289
     C***************      CLEARDBKEY                      * DBERR 149032 150289
     C***************      MOVELWDRACT    DBKEY            ********149032 150289
     C***************      OUT  LDA                                149032 150289
     C***************      EXSR *PSSR                              149032 150289
     C***************      ENDIF                                   149032 150289
      ***************                                              133672 150289
     C***********CHGT      IFNE *ZERO                              133672 150289
     C***********NRCA      ADD  TOT3      TOT3                     133672 150289
     C***********RCA*      ADD  TOT3      TOT3                     133672 150289
     C***************      ENDIF                                   133672 150289
      ***************                                              133672 150289
     C*********************MOVE WCRCB     W#CRCB 150               133672 134902
     C*********************MOVE WDRCB     W#DRCB 150               133672 134902
      ***************                                              133672 150289
      ***Reverse*the*sign*of*the*accrued*interest/charges,*as*this*134902 150289
      ***already*been*actioned*for*the*account*balance.************134902 150289
      ***Ref:*Subroutine*SRAACD,*Access*account*details.***********134902 150289
     C***************      Z-SUBTOT3      TOT3                     134902 150289
      ***************                                              134902 150289
     C***********TOT3      ADD  WDRCB     WDRCB                    134902 150289
      ***************                                              134902 150289
     C***************      ENDIF                                   133672 150289
      ***************                                              133672 150289
     C***************      ENDIF                                   133672 150289
      ***************                                              133672 150289
      ***************                                              133672 150289
      ************************************************************ 133672*150289
      *   END OF COPIED INSTRUCTIONS (150289)                             150289
      ********************************************************************150289
      *                                                                   150289
      ** Perform Reverse Sweep Processing if Cleared Balance of
      ** CR A/c of Origin < Threshold Amt AND Sweep Type = 2  OR
      ** CR A/c of Origin < Threshold Amt AND Sweep Type = 3
      ** CR A/c of Origin < Threshold Amt AND Sweep Type = 4              CEU022
     C           WDRCB     IFLT STHR
     C           SWTP      ANDEQ'2'
     C           WDRCB     ORLT STHR
     C           SWTP      ANDEQ'3'
     C           WDRCB     ORLT STHR                                      CEU022
     C           SWTP      ANDEQ'4'                                       CEU022
      *                                                                   CEU022
      *                                                                   CEU022
     C***********CEU022    IFEQ 'Y'                                CEU022 133672
      ***********                                                  CEU022 133672
      ***If*Sweep*Type*=*'4'**************                         CEU022 133672
     C***********SWTP      IFEQ '4'                                CEU022 133672
     C***********DLPY      ANDGEBJRDNB                             CEU022 133672
     C***********DLPY      ANDLTBJDNWD                             CEU022 133672
     C***********DLPY      ANDNE*ZERO                              CEU022 133672
      ***********                                                  CEU022 133672
     C***********KEY03     CHAINREACR                97            CEU022 133672
      ***********                                                  CEU022 133672
     C***********DAIC1     ADD  MADI      TOT1   150               CEU022 133672
     C***********GADI      ADD  TOT1      TOT1                     CEU022 133672
      ***********                                                  CEU022 133672
     C***********CAIC1     ADD  MACI      TOT2   150               CEU022 133672
     C***********GACI      ADD  TOT2      TOT2                     CEU022 133672
      ***********                                                  CEU022 133672
     C***********TOT1      SUB  TOT2      TOT3   150               CEU022 133672
      ***********                                                  CEU022 133672
     C***********KEY04     CHAINIACBR                97            CEU022 133672
      ***********                                                  CEU022 133672
     C***********CHGT      IFNE *ZERO                              CEU022 133672
     C***********NRCA      ADD  TOT3      TOT3                     CEU022 133672
     C***********          ENDIF                                   CEU022 133672
      ***********                                                  CEU022 133672
     C***********          MOVE WCRCB     W#CRCB                   CEU022 133672
     C***********          MOVE WDRCB     W#DRCB                   CEU022 133672
      ***********                                                  CEU022 133672
     C***********TOT3      ADD  WCRCB     WCRCB                    CEU022 133672
      ***********                                                  CEU022 133672
     C***********          ENDIF                                   CEU022 133672
      ***********                                                  CEU022 133672
     C***********          ENDIF                                   CEU022 133672
      ***********                                                  CEU022 133672
     C                     MOVE '*'       WRVSWF
     C                     MOVE WRVSWF    RSRVSI
     C                     EXSR SRRVSP
      *                                                                   133672
     C                     ENDIF
     C/COPY WNCPYSRC,RE0732C006
      *
      ** Perform Normal Sweep Processing if Cleared Balance of
      ** CR A/c of Origin > Threshold Amt AND Sweep Type = 1  OR
      ** CR A/c of Origin > Threshold Amt AND Sweep Type = 3
      ** CR A/c of Origin > Threshold Amt AND Sweep Type = 4              CEU022
     C/COPY WNCPYSRC,RE0732C007
     C           WDRCB     IFGT STHR
     C           SWTP      ANDEQ'1'
     C           WDRCB     ORGT STHR
     C           SWTP      ANDEQ'3'
     C           WDRCB     ORGT STHR                                      CEU022
     C           SWTP      ANDEQ'4'                                       CEU022
      *                                                                   CEU022
      *                                                                   CEU022
     C***********CEU022    IFEQ 'Y'                                CEU022 133672
      ***********                                                  CEU022 133672
      ***If*Sweep*Type*=*'4'**************                         CEU022 133672
     C***********SWTP      IFEQ '4'                                CEU022 133672
     C***********DLPY      ANDGEBJRDNB                             CEU022 133672
     C***********DLPY      ANDLEBJDNWD                             CEU022 133672
     C***********DLPY      ANDNE*ZERO                              CEU022 133672
      ***********                                                  CEU022 133672
     C***********KEY01     CHAINREACR                97            CEU022 133672
      ***********                                                  CEU022 133672
     C***********DAIC1     ADD  MADI      TOT1   150               CEU022 133672
     C***********GADI      ADD  TOT1      TOT1                     CEU022 133672
      ***********                                                  CEU022 133672
     C***********CAIC1     ADD  MACI      TOT2   150               CEU022 133672
     C***********GACI      ADD  TOT2      TOT2                     CEU022 133672
      ***********                                                  CEU022 133672
     C***********TOT1      SUB  TOT2      TOT3   150               CEU022 133672
      ***********                                                  CEU022 133672
     C***********KEY02     CHAINIACBR                97            CEU022 133672
      ***********                                                  CEU022 133672
     C***********CHGT      IFNE *ZERO                              CEU022 133672
     C***********NRCA      ADD  TOT3      TOT3                     CEU022 133672
     C***********          ENDIF                                   CEU022 133672
      ***********                                                  CEU022 133672
     C***********          MOVE WDRCB     W#DRCB 150               CEU022 133672
     C***********          MOVE WCRCB     W#CRCB 150               CEU022 133672
      ***********                                                  CEU022 133672
     C***********TOT3      ADD  WDRCB     WDRCB                    CEU022 133672
      ***********                                                  CEU022 133672
     C***********          ENDIF                                   CEU022 133672
      ***********                                                  CEU022 133672
     C***********          ENDIF                                   CEU022 133672
      *
      ** Compute for Sweep Amount
     C           WDRCB     SUB  STHR      SWPAMT
     C                     MOVE ' '       WRVSWF
     C                     MOVE WRVSWF    RSRVSI
      *                                                                   133672
     C                     ENDIF
      *                                                                   133672
      *
     C/COPY WNCPYSRC,RE0732C008
      ** Compute for Sweep Amount
     C           SWPAMT    IFNE *ZEROS
      *
      ** Format Transfer Amount
     C                     Z-ADDDCNBDP    ZDECS                           CEU022
     C                     Z-ADDSWPAMT    ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSAMTR
      *                                                                   146799
     C                     MOVE *OFF      *IN18                           146799
      *                                                                   CEU022
      ** Format Transfer Amount - Debit  account currency                 CEU022
     C           CEU022    IFEQ 'Y'                                       CEU022
      *                                                                   CEU022
     C           DCCY      IFNE CCCY                                      CEU022
      *                                                                   CEU022
     C                     MOVE DCCY      RSDCCY                          CEU022
      *                                                                   CEU022
      ** convert posting amount   to CCCY curency                         CEU022
     C           CCCY      IFEQ BKEURO                                    CEU022
     C           DRINCY    ANDEQ'Y'                                       146799
      *                                                                   CEU022
     C                     CALL 'EU0200'                                  CEU022
     C                     PARM *BLANK    P@RTCD  7        Return Code    CEU022
     C                     PARM SWPAMT    P@FRAM 183       FROM Ccy AmountCEU022
     C                     PARM DCCY      P@FRCY  3        FROM Currency  CEU022
     C                     PARM BKEURO    P@TOCY  3        TO Currency    CEU022
     C                     PARM           P@OUTA 150       Outright AmountCEU022
     C                     PARM           P@INTA 183       Interim Amount CEU022
     C                     PARM           P@EXRT 159       Exchange Rate  CEU022
     C                     PARM           P@MDIN  1        Mult/Div Ind.  CEU022
      *                                                                   CEU022
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     MOVEL'RE0732  'DBFILE           ************   CEU022
     C                     MOVE 035       DBASE            * DBERR 35 *   CEU022
     C                     MOVE *BLANKS   DBKEY            ************   CEU022
     C                     MOVE *BLANKS   W@OPTN  7                       CEU022
     C                     MOVELP@FRCY    W@OPTN                          CEU022
     C                     MOVE P@TOCY    W@OPTN                          CEU022
     C                     MOVELW@OPTN    DBKEY                           CEU022
     C                     OUT  LDA                                       CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     Z-ADDP@OUTA    W2PAMT 150                      CEU022
      *                                                                   CEU022
     C                     ELSE                                           CEU022
      *                                                                   CEU022
     C                     Z-ADDSWPAMT    ZAMTF                           CEU022
     C                     Z-ADD0         ZAMTT                           CEU022
     C                     EXSR ZCCYCN                                    CEU022
     C                     Z-ADDZAMTT     W2PAMT                          CEU022
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     Z-ADDCCNBDP    ZDECS                           CEU022
     C                     Z-ADDW2PAMT    ZFLD15                          CEU022
     C                     MOVE 'A'       ZECODE                          CEU022
     C                     EXSR ZFRPED                                    CEU022
     C                     MOVE ZOUT22    RSAMTD                          CEU022
     C                     MOVE CCCY      RSCCCY                          CEU022
     C                     MOVE *ON       *IN18                           CEU022
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C**********           ELSE                                    CEU022 146799
     C**********           MOVE *OFF      *IN18                    CEU022 146799
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *
      ** Check if account has any referral conditions
     C                     EXSR SRRFP2
      *
     C           WBLOCK    IFNE 'Y'
      *
     C           WTRBR     IFNE WSVBR
     C           OPENP1    ANDEQ'Y'
     C           *IN82     ANDEQ'1'
     C                     EXSR SRCBR1
     C                     ENDIF
      *
     C           OPENP1    IFNE 'Y'
     C                     EXSR SRCBR1
     C                     ENDIF
      *
      ** Check overflow
     C           *IN15     IFEQ '1'
      *
      ** Multi-Branching on?
     C           *IN82     IFEQ '1'
     C                     MOVEL*BLANKS   RSDESC
     C                     EXSR SRMULT
     C                     MOVELWSVBR     RSBRCD
     C                     MOVELWDESC     RSDESC
     C                     ENDIF
      *
     C                     WRITEHEADP1
     C                     WRITEDTLHDR
     C                     MOVE '0'       *IN15
     C                     ENDIF
      *
      ** Output detail
     C                     WRITEDETAIL
      *
     C           WRVSWF    IFEQ '*'                                                           250620
     C           WSIGN     ANDEQ'Y'                                                           250620
     C                     Z-SUBSWPAMT    SWPAMT                                              250620
     C                     ENDIF                                                              250620
      *
      ** Add 1 to number of record generated
     C                     ADD  1         WCOUNT  50
      *
      ** Write DR posting record
     C                     EXSR SRW01
      *                                                                   CEU022
     C           CEU022    IFEQ 'Y'                                       CEU022
     C                     Z-ADDPSTA      WZZAMT                          CEU022
     C                     ENDIF                                          CEU022
      *
      ** Write CR posting record
     C                     EXSR SRW02
      *
      ** Accumulate total no. of records  output to GESPPD
     C                     ADD  2         WNORE
      *
      ** Accumulate hash totals of records  output to GESPPD
      *                                                                   CEU022
     C           CEU022    IFEQ 'Y'                                       CEU022
     C                     ADD  PSTA      WZZAMT                          CEU022
     C                     ELSE                                           CEU022
     C           SWPAMT    MULT 2         WZZAMT 150
     C                     ENDIF                                          CEU022
     C                     MOVE WZZAMT    ZZAMT
     C                     EXSR SRHASH
     C/COPY WNCPYSRC,RE0732C017
      *                                                                   CEU022
      **                                                                  CEU022
     C           CEU022    IFEQ 'Y'                                       CEU022
      *                                                                   CEU022
     C           DCCY      ANDNECCCY                                      CEU022
      *                                                                   CEU022
      ** Write DR posting record                                          CEU022
     C                     EXSR SRW06                                     CEU022
      *                                                                   CEU022
     C                     Z-ADDPSTA      WZZAMT                          CEU022
      *                                                                   CEU022
      ** Write CR posting record                                          CEU022
     C                     EXSR SRW07                                     CEU022
      *                                                                   CEU022
      ** Accumulate total no. of records  output to GESPPD                CEU022
     C                     ADD  2         WNORE                           CEU022
      *                                                                   CEU022
      ** Accumulate hash totals of records  output to GESPPD              CEU022
     C                     ADD  PSTA      WZZAMT                          CEU022
     C                     MOVE WZZAMT    ZZAMT                           CEU022
     C                     EXSR SRHASH                                    CEU022
      *                                                                   CEU022
      ** Obtain  base currency spot trade account code                    CEU022
     C                     MOVE BJCYCD    @CCY                            CEU022
     C                     CALL 'AOCURRR0'                                CEU022
     C                     PARM '*MSG   ' @RTCD   7                       CEU022
     C                     PARM '*KEY   ' @OPTN   7                       CEU022
     C                     PARM           @CCY    3                       CEU022
     C           SDCURR    PARM SDCURR    DSSDY                           CEU022
      *                                                                   CEU022
      ** If database error, return to calling program                     CEU022
     C           @RTCD     IFNE *BLANK                                    CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     MOVEL'SDCURRPD'DBFILE           ************   CEU022
     C                     Z-ADD010       DBASE            * DBERR 10 *   CEU022
     C                     MOVEL@CCY      DBKEY            ************   CEU022
     C                     OUT  LDA                                       CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C           DCCY      IFNE BJCYCD                                    CEU022
     C           CCCY      ANDNEBJCYCD                                    CEU022
     C           A6SPAE    ORNE *ZERO                                     CEU022
     C           A6SPAE    ANDNE*BLANK                                    137251
      *                                                                   CEU022
      ** Write DR posting record                                          CEU022
     C                     EXSR SRW08                                     CEU022
      *                                                                   CEU022
     C                     Z-ADDPSTA      WZZAMT                          CEU022
      *                                                                   CEU022
      ** Write CR posting record                                          CEU022
     C                     EXSR SRW09                                     CEU022
      *                                                                   CEU022
      ** Accumulate total no. of records  output to GESPPD                CEU022
     C                     ADD  2         WNORE                           CEU022
      *                                                                   CEU022
      ** Accumulate hash totals of records  output to GESPPD              CEU022
     C                     ADD  PSTA      WZZAMT 150                      CEU022
     C                     MOVE WZZAMT    ZZAMT                           CEU022
     C                     EXSR SRHASH                                    CEU022
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *
      ** Multi-Branched Sweep?
     C           MBSI      IFEQ 'Y'
      *
     C           DBRCH     IFNE BKMABR
     C           CBRCH     ANDNEBKMABR
     C           BKIEMB    ANDEQ'Y'                                       164757
     C                     MOVE 'Y'       MBRENT  1
     C                     ENDIF
      *
     C                     EXSR SRW03
      *
     C           MBRENT    IFEQ 'Y'
     C           *IN10     ANDEQ'1'
      *
     C                     EXSR SRW04
     C**********           ADD  4         WNORE                           167269
     C********** SWPAMT    MULT 4         WZZAMT                          167269
     C**********           MOVE WZZAMT    ZZAMT                           167269
     C**********           EXSR SRHASH                                    167269
      *
     C**********           ELSE                                           167269
     C**********           ADD  2         WNORE                           167269
     C********** SWPAMT    MULT 2         WZZAMT                          167269
     C**********           MOVE WZZAMT    ZZAMT                           167269
     C**********           EXSR SRHASH                                    167269
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Exception report, insufficient funds.                                                254051
      *                                                                                       254051
     C                     ELSE                                                               254051
     C                     MOVE 'Y'       WINSFN                                              254051
     C                     EXSR SRRFP2                                                        254051
      *                                                                                       254051
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRHASH - Subroutine to move work hash totals                 *
      *                                                               *
      *  Called By: Sweep Processing                                  *
      *  Calls:                                                       *
      *  GLZADD - Subroutine to carry out addition of totals          *
      *                                                               *
      *****************************************************************
      *
     C           SRHASH    BEGSR
      *
     C           ZZAMT     IFLT 0
     C                     Z-SUBZZAMT     ZZAMT
     C                     ENDIF
      *
     C                     Z-ADDHASHI     ZZTOTI
     C                     Z-ADDHASHD     ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HASHI
     C                     Z-ADDZZTOTD    HASHD
      *
     C                     ENDSR
      *
      *****************************************************************   150289
      /EJECT                                                              150289
      *****************************************************************   150289
      *                                                               *   150289
      *  SRCAPT - INTEREST CAPITALISATION CHECK                       *   150289
      *                                                               *   150289
      *****************************************************************   150289
      *                                                                   150289
     C           SRCAPT    BEGSR                           *** SRCAPT *** 150289
      *                                                                   150289
     C           CEU022    IFEQ 'Y'                                       150289
      *                                                                   150289
      ** Store the cleared balance figures; because if it's not the       150289
      ** final sweep date the 'start of day cleared balances' are not     150289
      ** output correctly as the following code is not executed unless    150289
      ** it's the final sweep.                                            150289
     C                     MOVE WCRCB     W#CRCB 150                      150289
     C                     MOVE WDRCB     W#DRCB 150                      150289
      *                                                                   150289
      *  If Sweep Type = '4'                                              150289
     C           SWTP      IFEQ '4'                                       150289
     C           DLPY      ANDGEBJRDNB                                    150289
     C           DLPY      ANDLTBJDNWD                                    150289
     C           DLPY      ANDNE*ZERO                                     150289
      *                                                                   150289
     C           WNPOST    IFNE 'Y'                                                           197268
     C           KEY01     CHAINREACR                97                   150289
      *                                                                                       197268
      ** Reset accrual interest from PF/REACRD                                                197268
      *                                                                                       197268
     C                     Z-ADD0         CAIC1                                               197268
     C                     Z-ADD0         DAIC1                                               197268
      *                                                                   150289
      ** DATABASE ERROR IF RECORD NOT FOUND                               150289
     C           *IN97     IFEQ '1'                                       150289
     C           *LOCK     IN   LDA                                       150289
     C                     Z-ADD020       DBASE                           150289
     C                     CLEARDBFILE                                    150289
     C                     MOVEL'REACR'   DBFILE           ************   150289
     C                     CLEARDBKEY                      * DBERR 20 *   150289
     C           WDRAC2    CAT  DBRCH     DBKEY            ************   150289
     C                     OUT  LDA                                       150289
     C                     EXSR *PSSR                                     150289
     C                     ENDIF                                          150289
     C                     ENDIF                                                              197268
      *                                                                                       197268
      ** Access the last record from LF/REHISL                                                197268
      *                                                                                       197268
     C           R1KEY     SETGTREHISL                                                        197268
     C           R1KEY     REDPEREHISL                   49                                   197268
     C           *IN49     IFEQ '1'                                                           197268
     C                     EXSR REHSR                                                         197268
     C                     END                             - E2                               197268
      *                                                                   150289
      ** Add extra processing for accrued interest so totals are correct  150289
     C                     EXSR SREXTP                                    150289
      *                                                                   150289
     C           DAIC1     ADD  MADI      TOT1   150                      150289
     C           GADI      ADD  TOT1      TOT1                            150289
     C           WADIC     ADD  TOT1      TOT1                                                197268
      *                                                                   150289
     C           CAIC1     ADD  MACI      TOT2   150                      150289
     C           GACI      ADD  TOT2      TOT2                            150289
     C           WACIC     ADD  TOT2      TOT2                                                197268
      *                                                                                       197268
      ** Check if Extra Daily Statement Commission must be processed                          197268
      *                                                                                       197268
     C                     EXSR SRCOMM                                                        197268
      *                                                                   150289
     C           TOT1      SUB  TOT2      TOT3   150                      150289
      *                                                                                       197268
      ** Processing for CDL013                                                                197268
      *                                                                                       197268
      *  Chain to SDCUSTPD to determine if customer needs withholding                         197268
      *  tax calculated                                                                       197268
      *                                                                                       197268
     C                     OPEN SDCUSTL0                                                      197268
     C           DCUS      CHAINSDCUSTL0             78                                       197268
     C                     CLOSESDCUSTL0                                                      197268
      *                                                                                       197268
     C           CDL013    IFEQ 'Y'                                                           197268
     C           BBCSTY    IFNE 'N'                                                           197268
      *                                                                                       197268
      ** Include withholding tax in closing balance                                           197268
      ** If SDSTAXPD/TXWNDI is 'Y', compute tax from net interest (sum                        197268
      ** of DR and CR interests).  Else, compute tax from gross                               197268
      ** interest (CR interest only).                                                         197268
      *                                                                                       197268
     C           TXWNDI    IFEQ 'Y'                                                           197268
     C                     Z-ADDTOT3      @INTT  150                                          197268
     C                     ELSE                                                               197268
     C                     Z-SUBTOT2      @INTT                                               197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
      ** If the resulting interest is zero or debit, no need to compute                       197268
      ** for the w/holding tax.  It is automatically equal to zero.                           197268
      *                                                                                       197268
     C           @INTT     IFGE *ZERO                                                         197268
     C                     Z-ADD*ZERO     TAXAMT 150                                          197268
     C                     ELSE                                                               197268
      *                                                                                       197268
      ** Retrieve taxable indicator for this account                                          197268
      *                                                                                       197268
     C           KEY01     CHAINACCNTBXC             78                                       197268
      *                                                                                       197268
     C           *IN78     IFEQ '1'                                                           197268
     C                     Z-ADD0         ULWHTR  52                                          197268
     C                     ELSE                                                               197268
      *                                                                                       197268
      *** If tax indicator is ZERO set WHT rate to ZERO,                                      197268
      *** otherwise set WHT rate                                                              197268
      *                                                                                       197268
     C                     SELEC                                                              197268
     C           ATITAX    WHEQ '0'                                                           197268
     C                     Z-ADD0         ULWHTR                                              197268
     C           ATITAX    WHEQ '1'                                                           197268
     C                     Z-ADDETXR1     ULWHTR                                              197268
     C           ATITAX    WHEQ '2'                                                           197268
     C                     Z-ADDETXR2     ULWHTR                                              197268
     C           ATITAX    WHEQ '3'                                                           197268
     C                     Z-ADDETXR3     ULWHTR                                              197268
     C           ATITAX    WHEQ '4'                                                           197268
     C                     Z-ADDETXR4     ULWHTR                                              197268
     C           ATITAX    WHEQ '5'                                                           197268
     C                     Z-ADDETXR5     ULWHTR                                              197268
     C           ATITAX    WHEQ '6'                                                           197268
     C                     Z-ADDETXR6     ULWHTR                                              197268
     C           ATITAX    WHEQ '7'                                                           197268
     C                     Z-ADDETXR7     ULWHTR                                              197268
     C           ATITAX    WHEQ '8'                                                           197268
     C                     Z-ADDETXR8     ULWHTR                                              197268
     C           ATITAX    WHEQ '9'                                                           197268
     C                     Z-ADDETXR9     ULWHTR                                              197268
     C                     ENDSL                                                              197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
      ** If WHT rate is ZERO set tax amount to ZERO                                           197268
      *                                                                                       197268
     C           ULWHTR    IFEQ *ZERO                                                         197268
     C                     Z-ADD0         TAXAMT                                              197268
      *                                                                                       197268
      ** Otherwise, calculate tax amount                                                      197268
      *                                                                                       197268
     C                     ELSE                                                               197268
      *                                                                                       197268
      ** Get DCCY details                                                                     197268
      *                                                                                       197268
     C                     CALL 'AOCURRR0'                                                    197268
     C                     PARM *BLANKS   WRTCD   7                                           197268
     C                     PARM '*KEY    'WOPTN   7                                           197268
     C                     PARM           DCCY                                                197268
     C           SDCURR    PARM SDCURR    DSSDY                                               197268
      *                                                                                       197268
      ** Handle database error                                                                197268
      *                                                                                       197268
     C           WRTCD     IFNE *BLANKS                                                       197268
     C           *LOCK     IN   LDA                                                           197268
     C                     MOVE '1'       *INU7                                               197268
     C                     MOVE '1'       *INU8                                               197268
     C                     MOVE '1'       *INLR                                               197268
     C                     MOVELDCCY      DBKEY                                               197268
     C                     MOVEL'SDCURRPD'DBFILE           *************                      197268
     C                     Z-ADD005       DBASE            * DBERR 005 *                      197268
     C                     OUT  LDA                        *************                      197268
     C                     EXSR *PSSR                                                         197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
      ** Initialise vars for conversion                                                       197268
      *                                                                                       197268
     C                     MOVE A6CYCD    ZCCYF                                               197268
     C                     Z-ADDA6SPRT    ZRATEF                                              197268
     C                     MOVE A6MDIN    ZMDINF                                              197268
     C                     Z-ADDA6NBDP    ZCDPF                                               197268
      *                                                                                       197268
      ** If account currency is in base currency                                              197268
      ** and CDL081 is off                                                                    CDL081
      *                                                                                       197268
     C           DCCY      IFEQ BJCYCD                                                        197268
     C           CDL081    ANDEQ'N'                                                           CDL081
      *                                                                                       197268
      ** Set work adjustment field according to number of decimal                             197268
      ** places in currency before calculating the tax amount                                 197268
      *                                                                                       197268
     C                     SELEC                                                              197268
     C           ZCDPF     WHEQ 0                                                             197268
     C                     Z-ADD1         ULWKAD  40                                          197268
     C           ZCDPF     WHEQ 1                                                             197268
     C                     Z-ADD10        ULWKAD                                              197268
     C           ZCDPF     WHEQ 2                                                             197268
     C                     Z-ADD100       ULWKAD                                              197268
     C           ZCDPF     WHEQ 3                                                             197268
     C                     Z-ADD1000      ULWKAD                                              197268
     C                     ENDSL                                                              197268
      *                                                                                       197268
      ** Account currency is in base currency round down gross                                197268
      ** interest amount                                                                      197268
      *                                                                                       197268
     C           @INTT     DIV  ULWKAD    ULTINT 150                                          197268
     C                     MULT ULWKAD    ULTINT                                              197268
      *                                                                                       197268
      ** Calculate tax amount                                                                 197268
      *                                                                                       197268
     C           ULTINT    MULT ULWHTR    TAXAMT                                              197268
     C                     DIV  100       TAXAMT                                              197268
      *                                                                                       197268
      ** Round down tax amount                                                                197268
      *                                                                                       197268
     C           TAXAMT    DIV  ULWKAD    TAXAMT                                              197268
     C                     MULT ULWKAD    TAXAMT                                              197268
      *                                                                                       197268
      ** Otherwise (account ccy NOT = base ccy) calculate                                     197268
      ** tax amount without rounding down                                                     197268
      *                                                                                       197268
     C                     ELSE                                                               197268
     C           @INTT     MULT ULWHTR    TAXAMT                                              197268
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           DCCY      IFEQ BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           DCCY      ORNE BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#NBRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       TAXAMT                                              CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       TAXAMT    H                                         197268
     C                     ENDIF                                                              CDL081
      *                                                                                       197268
      ** Calculate the interest amount in base currency (ULTINT)                              197268
      *                                                                                       197268
      ** Get base CCY details                                                                 197268
      *                                                                                       197268
     C                     CALL 'AOCURRR0'                                                    197268
     C                     PARM *BLANKS   WRTCD   7                                           197268
     C                     PARM '*KEY    'WOPTN   7                                           197268
     C                     PARM           BJCYCD                                              197268
     C           SDCURR    PARM SDCURR    DSSDY                                               197268
      *                                                                                       197268
      ** Handle database error                                                                197268
      *                                                                                       197268
     C           WRTCD     IFNE *BLANKS                                                       197268
     C           *LOCK     IN   LDA                                                           197268
     C                     MOVE '1'       *INU7                                               197268
     C                     MOVE '1'       *INU8                                               197268
     C                     MOVE '1'       *INLR                                               197268
     C                     MOVELDCCY      DBKEY                                               197268
     C                     MOVEL'SDCURRPD'DBFILE           *************                      197268
     C                     Z-ADD006       DBASE            * DBERR 006 *                      197268
     C                     OUT  LDA                        *************                      197268
     C                     EXSR *PSSR                                                         197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
      ** Initialise vars for conversion                                                       197268
      *                                                                                       197268
     C                     MOVE A6CYCD    ZCCYT                                               197268
     C                     Z-ADDA6SPRT    ZRATET                                              197268
     C                     MOVE A6MDIN    ZMDINT                                              197268
     C                     Z-ADDA6NBDP    ZCDPT                                               197268
      *                                                                                       197268
      ** Set amount in the account ccy                                                        197268
      *                                                                                       197268
     C                     Z-ADD@INTT     ZAMTF                                               197268
      *                                                                                       197268
      ** Convert the amount to the base ccy                                                   197268
      *                                                                                       197268
     C                     EXSR ZCCYCN                                                        197268
      *                                                                                       197268
      ** Set amount in the base ccy                                                           197268
      *                                                                                       197268
     C                     Z-ADDZAMTT     ULTINT                                              197268
      *                                                                                       197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
      **  Get account code details                                                            197268
      *                                                                                       197268
     C                     CALL 'AOACODR0'                                                    197268
     C                     PARM *BLANKS   WRTCD   7                                           197268
     C                     PARM '*KEY    'WOPTN   7                                           197268
     C                     PARM           DACODD                                              197268
     C           SDACOD    PARM SDACOD    DSFDY                                               197268
      *                                                                                       197268
      ** Handle database error                                                                197268
      *                                                                                       197268
     C           WRTCD     IFNE *BLANKS                                                       197268
     C           *LOCK     IN   LDA                                                           197268
     C                     MOVE '1'       *INU7                                               197268
     C                     MOVE '1'       *INU8                                               197268
     C                     MOVE '1'       *INLR                                               197268
     C                     MOVELDACODD    DBKEY                                               197268
     C                     MOVEL'SDACODPD'DBFILE           *************                      197268
     C                     Z-ADD030       DBASE            * DBERR 030 *                      197268
     C                     OUT  LDA                        *************                      197268
     C                     EXSR *PSSR                                                         197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
      ** Check if the interest amount in base ccy is below minimum                            197268
      *                                                                                       197268
     C                     Z-SUBULTINT    ULTINT                                              197268
     C           ULTINT    IFLT A5MISU                                                        197268
     C                     Z-ADD*ZERO     TAXAMT                                              197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
     C           TOT3      SUB  TAXAMT    TOT3                                                197268
      *                                                                                       197268
     C                     ENDIF                           BBCSTY                             197268
     C                     ELSE                                                               197268
     C*                                                                                       197268
     C** Calculate the withhold tax amount from the credit interest                           197268
     C** only if with mod is ON and Tax with rate is not zero                                 197268
     C*                                                                                       197268
     C           BGNTST    IFEQ 'Y'                        IF1                                197268
     C           TXWTRR    ANDNE0                                                             197268
     C*                                                                                       197268
     C           KEY01     CHAINACCNTBXC             78                                       197268
     C*                                                                                       197268
     C           *IN78     IFEQ '0'                        IF2                                197268
      *                                                                                       197268
      ** Check if allowed to tax individual acc                                               197268
      *                                                                                       197268
     C           ATITAX    IFEQ 'Y'                        IF3                                197268
     C                     MOVEL*ZEROS    TAXAMT                                              197268
      *                                                                                       197268
     C           TXWNDI    IFEQ 'N'                        IF4                                197268
     C           TOT2      MULT TXWTRR    TAXAMT 150                                          197268
     C           TAXAMT    DIV  100       TAXAMT    H                                         197268
     C           TOT3      ADD  TAXAMT    TOT3                                                197268
     C                     ELSE                            ELSE4                              197268
     C** Netdebit credit interest is yes, with tax over total of both                         197268
     C** credit and debit interest only if credit more than debit .                           197268
     C*                                                                                       197268
     C           TOT3      IFLT 0                                                             197268
     C           TOT3      MULT TXWTRR    TAXAMT                                              197268
     C           TAXAMT    DIV  100       TAXAMT    H                                         197268
     C           TOT3      SUB  TAXAMT    TOT3                                                197268
     C                     END                                                                197268
      *                                                                                       197268
     C                     ENDIF                           END4                               197268
      *                                                                                       197268
     C                     ENDIF                           END3                               197268
      *                                                                                       197268
     C                     ENDIF                           END2                               197268
      *                                                                                       197268
     C                     ENDIF                           END1                               197268
      *                                                                                       197268
     C                     ENDIF                           ENDEEE                             197268
      *                                                                                       197268
     C/COPY WNCPYSRC,RE0732C016
      *                                                                   150289
      ** Check if Extra Daily Statement Commission must be processed      177670
      *                                                                   177670
     C                     EXSR SRCOMM                                    177670
      *                                                                   177670
     C           KEY02     CHAINIACBR                97                   150289
      *                                                                   150289
      ** DATABASE ERROR IF RECORD NOT FOUND                               150289
     C           *IN97     IFEQ '1'                                       150289
     C           *LOCK     IN   LDA                                       150289
     C                     Z-ADD21        DBASE                           150289
     C                     CLEARDBFILE                                    150289
     C                     MOVEL'IACBR'   DBFILE           ************   150289
     C                     CLEARDBKEY                      * DBERR 21 *   150289
     C                     MOVELWDRACT    DBKEY            ************   150289
     C                     OUT  LDA                                       150289
     C                     EXSR *PSSR                                     150289
     C                     ENDIF                                          150289
      *                                                                   150289
     C           CHGT      IFNE *ZERO                                     150289
     C                     EXSR FNDCRG                                    181363
     C********** NRCA      ADD  TOT3      TOT3                     150289 181363
     C********** RCA       ADD  TOT3      TOT3                     150289 181363
     C********** NCOMM     ADD  TOT3      TOT3                     177670 181363
     C                     ENDIF                                          150289
      *                                                                   150289
      ** Reverse the sign of the accrued interest/charges, as this has    150289
      ** already been actioned for the account balance.                   150289
      ** Ref: Subroutine SRAACD, Access account details.                  150289
     C                     Z-SUBTOT3      TOT3                            150289
      *                                                                   150289
     C           TOT3      ADD  WDRCB     WDRCB                           150289
      *                                                                   150289
     C                     ENDIF                                          150289
      *                                                                   150289
     C                     ENDIF                                          150289
      *                                                                   150289
      *                                                                   150289
     C                     ENDSR                                          150289
      *                                                                   150289
      *****************************************************************   150289
      *****************************************************************
      /EJECT
      *****************************************************************   177670
      *                                                               *   177670
      *  SRCOMM - Commission on Number of Daily Statement             *   177670
      *                                                               *   177670
      *****************************************************************   177670
      *                                                                   177670
     C           SRCOMM    BEGSR                           *** SRCOMM *** 177670
     C                     Z-ADD0         NCOMM  150                      177670
      *                                                                   177670
      ** Retrieve details for the computation of Commission               177670
      *                                                                   177670
     C           COMKEY    CHAINRECOMDF              13                   177670
      *                                                                   177670
     C           *IN13     IFEQ '0'                                       177670
     C           RECI      ANDNE'D'                                       177670
     C                     MOVE '1'       *IN13                           177670
     C                     ENDIF                                          177670
      *                                                                   177670
     C           *IN13     IFEQ '1'                                       177670
     C           *LOCK     IN   LDA                                       177670
     C                     MOVEL'RE0732'  DBPGM                           177670
     C                     MOVEL'RECOM'   DBFILE                          177670
     C                     MOVELWOPTN     DBKEY                           177670
     C                     Z-ADD12        DBASE                           177670
     C                     OUT  LDA                                       177670
     C                     EXSR *PSSR                                     177670
     C                     ENDIF                                          177670
      *                                                                   177670
      ** Generate Statement Charge if frequency is 'E' and                177670
      ** no. of interest statement has a value.                           177670
      *                                                                   177670
     C                     MOVE NOIS      WNOIS   50                      177670
     C           WSTFQ     IFEQ 'E'                        -B1            177670
     C           WNOIS     ORNE 0                                         177670
      *                                                                   177670
     C                     EXSR FNDTAB                                    181363
      *                                                                   181363
     C           CEXF      IFNE 'E'                                       177670
     C           DYSI      ANDEQ'Y'                                       181363
     C***********CEXF      ANDNE*BLANKS                            177670 181363
     C           CEXF      IFNE *BLANKS                                   181363
     C           WNOIS     MULT NCEXF     NCOMM                           177670
     C                     ELSE                                           181363
     C           WNOIS     MULT DSFC      NCOMM                           181363
     C                     ENDIF                                          181363
     C                     ENDIF                                          177670
     C                     ENDIF                           -E1            177670
      *                                                                   181363
     C           NCOMM     ADD  TOT3      TOT3                            181363
      *                                                                   181363
      ** Add the fixed commission override if this has a value or the     181363
      ** fixed commission if the fixed commission override is blank.      181363
      *                                                                   181363
     C           CEXG      IFEQ *BLANKS                                   181363
     C           FXDC      ADD  TOT3      TOT3                            181363
     C                     ELSE                                           181363
     C           CEXG      IFNE 'E'                                       181363
     C           NCEXG     ADD  TOT3      TOT3                            181363
     C                     ENDIF                                          181363
     C                     ENDIF                                          181363
      *                                                                   177670
     C                     ENDSR                                          177670
      *****************************************************************   177670
      /EJECT                                                              177670
      *****************************************************************
      *                                                               *
      *  GLZADD - Subroutine to split amount into integer and         *
      *           decimal fields.                                     *
      *                                                               *
      *  Called By: Sweep Processing                                  *
      *  Calls:                                                       *
      *  GLZSUM - Subroutine to carry out addition of totals          *
      *                                                               *
      *****************************************************************
      *
     C           GLZADD    BEGSR                           *** GLZADD ***
      *
     C                     Z-ADDZZAMT     ZZAMT  153     20-Define ZZAMT
     C   20                GOTO ZZAEND                     Amt = 0.Bypass
      *
      **  Split ZZAMT into integer and decimal fields
      *
     C                     Z-ADDZZAMT     ZZAMTI 150       Integer field
     C                     MOVE ZZAMT     ZZAMTD  30       Decimal field
      *
      **  Both ZZAMTI and ZZAMTD contain a 'sign' zone now
      *
     C                     EXSR GLZSUM
     C           ZZAEND    ENDSR                           ** ZZAEND TAG *
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  GLZSUM - Standard subroutine to carry out addition of        *
      *           totals                                              *
      *                                                               *
      *  Called By: Sweep Processing                                  *
      *  Calls:                                                       *
      *        (none)                                                 *
      *                                                               *
      *****************************************************************
      *
     C           GLZSUM    BEGSR                           *** GLZSUM ***
      *
     C                     Z-ADDZZTOTI    ZZTOTI 150       Define ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       Define ZZTOTD
     C                     SETOF                     211213
     C                     SETOF                     242529
      *
      **  Determine sign of ZZAMTI & D,   92 if neg
      *
     C           ZZAMTI    COMP 0                      2223
     C   23      ZZAMTD    COMP 0                      2223
     C   23                GOTO ZZSEND                     Zero bypass
      *
      **  Determine sign of ZZTOTI & D, 91 if neg.
      *
     C           ZZTOTI    COMP 0                      2123
     C   23      ZZTOTD    COMP 0                      2123
      *
      **  If ZZTOTAL is zero, return ZZAMOUNT.
      *
     C   23                Z-ADDZZAMTI    ZZTOTI
     C   23                Z-ADDZZAMTD    ZZTOTD
     C   23                GOTO ZZSEND                     Zero bypass
      *
      **  If signs differ bypass overflow checks
      *
     C***21N22**                                                                              218538
     C**ORN91*22           GOTO ZZOFPS                                                        218538
     C           *IN21     IFEQ '1'                                                           218538
     C           *IN22     ANDEQ'0'                                                           218538
     C           *IN21     OREQ '0'                                                           218538
     C           *IN22     ANDEQ'1'                                                           218538
     C                     GOTO ZZOFPS                                                        218538
     C                     ENDIF                                                              218538
      *
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  23    '23' = carry
     C  N23      ZZWK2     COMP -999                   23    into integer
      *
     C   23N22   ZZAMTI    ADD  1         ZZWK3  150       Add 'Carry' +ve
     C******23*92ZZAMTI    SUB  1         ZZWK3            Sub 'Carry' -ve                    218538
      *                                                                                       218538
     C           *IN23     IFEQ '1'                                                           218538
     C           *IN22     ANDEQ'1'                                                           218538
     C           ZZAMTI    SUB  1         ZZWK3            Sub 'Carry' -ve                    218538
     C                     ENDIF                                                              218538
      *                                                                                       218538
     C   23      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N23      ZZTOTI    ADD  ZZAMTI    ZZWK3
      *
      **  If the modulus of ZZWK3 is LT mod. ZZTOTI then O/F has occured
      *
     C  N22      ZZWK3     COMP ZZTOTI                 29  -92 MEANS NOS.
     C   22      ZZWK3     COMP ZZTOTI               29     NEGATIVE
     C  N29                Z-ADDZZWK2     ZZTOTD
     C  N29                Z-ADDZZWK3     ZZTOTI
      *
      **  If O/F zeroize ZZAMT , ind '99' set and ZZTOT fields left intact.
      *
     C   29                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
      *
      ** The 'signs' are different
      *
     C           ZZOFPS    TAG                             ** ZZOFPS TAG**
      *
      ** If ZZAMT was negative, make it pos. to comp with ZZTOT
      *
     C   22                Z-SUBZZAMTI    ZZAMTI 150
     C   22                Z-SUBZZAMTD    ZZAMTD  30
      *
      ** If ZZTOT was negative, make it pos. to comp with ZZAMT.
      *
     C   21                Z-SUBZZTOTI    ZZTOTI
     C   21                Z-SUBZZTOTD    ZZTOTD
      *
      ** Both ZZAMT and ZZTOT are now positive.
      *
     C           ZZTOTI    COMP ZZAMTI               23  25
     C   25      ZZTOTD    COMP ZZAMTD               23  25
      *
      ** If ZZTOT eq. ZZAMT return zero.
      *
     C   25                Z-ADD0         ZZTOTI
     C   25                Z-ADD0         ZZTOTD
     C   25                GOTO ZZSEND
      *
      ** If ZZTOT GT. ZZAMT.
      *
     C   23      ZZAMTD    COMP ZZTOTD               24
     C   23 24   ZZTOTI    SUB  1         ZZTOTI
     C   23 24   ZZTOTD    ADD  1000      ZZWK2
     C   23      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   23 24   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   23N24   ZZTOTD    SUB  ZZAMTD    ZZTOTD
      *
      ** IF ZZAMT GT. ZZTOT.
      *
     C  N23      ZZTOTD    COMP ZZAMTD               24
     C  N23 24   ZZAMTI    SUB  1         ZZWK3  150
     C  N23 24   ZZAMTD    ADD  1000      ZZWK2
     C  N23 24   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N23N24   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N23 24   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
      *
      ** Reverse sign of ZZTOT if larger I/P fields were negative
      *
     C                     SETOF                     24
     C   23 21
     CORN23 22             SETON                     24
     C   24                Z-SUBZZTOTI    ZZTOTI
     C   24                Z-SUBZZTOTD    ZZTOTD
      *
      ** Restore sign of ZZAMTI & ZZAMTD if it was reversed.
      *
     C   22                Z-SUBZZAMTI    ZZAMTI
     C   22                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG                             ** ZZSEND TAG *
      *
      ** If ZZTOTD is zero, and ZZTOTI is neg. set up ZZNEGD.
      *
     C                     SETOF                     26
     C           ZZTOTD    COMP 0                        21
     C   21      ZZTOTI    COMP 0                      26
     C   26                MOVE '.000-'   ZZNEGD  5
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRRFP1 - Referrals Processing.                               *
      *                                                               *
      *  Called By: Detail Processing                                 *
      *  Calls:                                                       *
      *  SRCBR2 - Change in Branch Processing for Exception Report    *
      *                                                               *
      *****************************************************************
      *
     C           SRRFP1    BEGSR                           *** SRRFP1 ***
      *
     C                     MOVE *BLANKS   RSACNO
     C                     MOVE *BLANKS   RSADET
     C                     MOVE *BLANKS   RSSWEP
     C                     MOVE *BLANKS   RSCLAC
      *
      ** Retail A/c no used?
     C           BMRANR    IFEQ 'Y'
     C                     MOVE WACNO     RSACNO    P
     C                     ELSE
     C                     MOVE WACCNT    RSACNO
     C                     ENDIF
      ** For Euro sweep's, if the retail a/c number is being retained,    134902
      ** the retail a/c number on the IN currency a/c will be zeros,      134902
      ** print full a/c number instead.                                   134902
     C           SWTP      IFEQ '4'                                       134902
     C           WACNO     IFEQ *BLANKS                                   134902
     C           WACNO     OREQ *ZEROS                                    134902
     C                     MOVE WACCNT    RSACNO                          134902
     C                     END                                            134902
     C                     END                                            134902
      *
      ** A/c not found,
     C           WRTCD     IFEQ '*NRF   '
     C                     MOVEL'MISSING' RSADET
     C                     ENDIF
      *
      ** A/c status closed,
     C           ACST      IFEQ 'C'
     C                     MOVE 'Y'       WACLO   1
     C                     ELSE
     C                     MOVE ' '       WACLO
     C                     ENDIF
      *
      ** A/c deleted,
     C********** WRECI     IFNE 'D'                                                         MD034985
     C           ARECI     IFNE 'D'                                                         MD034985
     C                     MOVEL'DELETED' RSADET
     C                     ENDIF
      *
      ** Check A/c details - For Credit A/c of Origin (DR)
      ** (Bankrupt, Bad Debt, or Inactive)
     C           WBKPT     IFEQ 'Y'
     C                     MOVE RNAR,5    RSADET
     C                     ENDIF
      *
     C           WBDDT     IFEQ 'Y'
     C                     MOVE RNAR,6    RSADET
     C                     ENDIF
      *
     C           WINAC     IFEQ 'Y'
     C                     MOVE RNAR,7    RSADET
     C                     ENDIF
      *
      ** Output details
     C                     MOVE SWEP      RSSWEP
     C                     MOVE WACLO     RSCLAC
      *
     C           WTRBR     IFNE WBRCH2
     C           OPENP2    ANDEQ'Y'
     C           *IN82     ANDEQ'1'
     C                     EXSR SRCBR2
     C                     ENDIF
      *
     C           OPENP2    IFNE 'Y'
     C                     EXSR SRCBR2
     C                     ENDIF
      *
     C           *IN16     IFEQ '1'
      *
      ** Multi-Branching on?
     C           *IN82     IFEQ '1'
     C                     MOVEL*BLANKS   RSDESC
     C                     EXSR SRMULT
     C                     MOVELWBRCH2    RSBRCD
     C                     MOVELWDESC     RSDESC
     C                     ENDIF
      *
     C                     WRITEHEADP2
     C                     WRITEDTLHDR2
     C                     MOVE '0'       *IN16
     C                     ENDIF
      *
     C                     WRITEDETAIL2
      *
     C           WBKPT     IFEQ 'Y'                                       148355
     C           WBDDT     OREQ 'Y'                                       148355
     C********** WRECI     ORNE 'D'                                                  148355 MD034985
     C           ARECI     ORNE 'D'                                                  148355 MD034985
     C           ACST      OREQ 'C'                                       148355
     C           WRTCD     OREQ '*NRF   '                                 148355
     C                     MOVE 'Y'       WBLOCK
     C                     END                                            148355
     C*                                                                   148355
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRRFP2 - Check Referral Conditions                           *
      *                                                               *
      *  Called By: Sweep Processing                                  *
      *  Calls:                                                       *
      *  SRCBR2 - Change in Branch Processing for Exception Report    *
      *                                                               *
      *****************************************************************
      *
     C           SRRFP2    BEGSR                           *** SRRFP2 ***
      *
      ** Initialise A/c Referred Flag
     C                     MOVE 'N'       WACREF  1
      ** Initialise A/c Blocked  Flag
     C                     MOVE 'N'       WBLOCK
      *
     C                     MOVE *BLANKS   RSACNO
     C                     MOVE *BLANKS   RSADET
     C                     MOVE *BLANKS   RSCLAC
      *
      ** If A/c is going to generate a DR posting for the Debit
      ** account (Ordinary sweep)
      *
     C           WRVSWF    IFEQ ' '
      *
      ** Refer DR?
     C           DRFDR     IFEQ 'Y'
     C                     MOVE 'Y'       WACREF
     C                     MOVE RNAR,1    RSADET
     C                     ENDIF
      *
      ** Block DR?
     C           DBLDR     IFEQ 'Y'
     C                     MOVE 'Y'       WBLOCK
     C                     MOVE RNAR,3    RSADET
     C                     ENDIF
     C                     ENDIF
      *
      ** If a/c is going to generate a CR posting for the Debit
      ** account (Reverse sweep)
      *
     C           WRVSWF    IFEQ '*'
     C           WACREF    ANDEQ'N'
     C           WBLOCK    ANDEQ'N'
      *
      ** Refer CR?
     C           DRFCR     IFEQ 'Y'
     C                     MOVE 'Y'       WACREF
     C                     MOVE RNAR,2    RSADET
     C                     ENDIF
      *
      ** Block CR?
     C           DBLCR     IFEQ 'Y'
     C                     MOVE 'Y'       WBLOCK
     C                     MOVE RNAR,4    RSADET
     C                     ENDIF
     C                     ENDIF
      *                                                                                       254051
      ** If insufficient fund.                                                                254051
      *                                                                                       254051
     C           WINSFN    IFEQ 'Y'                                                           254051
     C                     MOVE 'Y'       WBLOCK                                              254051
     C                     MOVE RNAR,8    RSADET                                              254051
     C                     ENDIF                                                              254051
      *
      ** If account has been referred or blocked, write to
      ** exception report (RE0732P2)
      *
     C           WACREF    IFEQ 'Y'
     C           WBLOCK    OREQ 'Y'
      *
      ** Output a detail exception record
     C                     MOVE SWEP      RSSWEP
      *
      ** Retail A/c no used?
     C           BMRANR    IFEQ 'Y'
      *
     C                     MOVE WDRAC     RSACNO    P
     C                     ELSE
     C                     MOVE WDRACT    RSACNO
      *
     C                     ENDIF
      *
      ** For EMU, if retail Number is Zero or Blank the use full                              239502
      ** account number.                                                                      239502
      *                                                                                       239502
     C           SWTP      IFEQ '4'                                                           239502
     C           WDRAC     IFEQ *BLANKS                                                       239502
     C           WDRAC     OREQ *ZEROS                                                        239502
     C                     MOVE *BLANKS   RSACNO                                              239502
     C                     MOVE WACCNT    RSACNO                                              239502
     C                     ENDIF                                                              239502
     C                     ENDIF                                                              239502
      *
     C                     MOVE WACLO     RSCLAC
      *
     C           WTRBR     IFNE WBRCH2
     C           OPENP2    ANDEQ'Y'
     C           *IN82     ANDEQ'1'
     C                     EXSR SRCBR2
     C                     ENDIF
      *
     C           OPENP2    IFNE 'Y'
     C                     EXSR SRCBR2
     C                     ENDIF
      *
      ** Check Overflow
     C           *IN16     IFEQ '1'
      *
      ** Multi-Branching on?
     C           *IN82     IFEQ '1'
     C                     MOVEL*BLANKS   RSDESC
     C                     EXSR SRMULT
     C                     MOVELWBRCH2    RSBRCD
     C                     MOVELWDESC     RSDESC
     C                     ENDIF
      *
     C                     WRITEHEADP2
     C                     WRITEDTLHDR2
     C                     MOVE '0'       *IN16
     C                     ENDIF
      *
      ** Write details
     C                     WRITEDETAIL2
      *
     C                     ELSE
      *
      ** If A/c is going to generate a DR posting for the
      ** Credit account (Reverse Sweep)
      *
     C********** WRVSWF    IFEQ ' '                                                           260839
     C           WRVSWF    IFEQ '*'                                                           260839
      *
      ** Refer DR?
     C           CRFDR     IFEQ 'Y'
     C                     MOVE 'Y'       WACREF
     C                     MOVE RNAR,1    RSADET
     C                     ENDIF
      *
      ** Block DR?
     C           CBLDR     IFEQ 'Y'
     C                     MOVE 'Y'       WBLOCK
     C                     MOVE RNAR,3    RSADET
     C                     ENDIF
     C                     ENDIF
      *
      ** If a/c is going to generate a CR posting for the
      ** Credit account (Ordinary Sweep)
      *
     C********** WRVSWF    IFEQ '*'                                                           260839
     C           WRVSWF    IFEQ ' '                                                           260839
      *
      ** Refer CR?
     C           CRFCR     IFEQ 'Y'
     C                     MOVE 'Y'       WACREF
     C                     MOVE RNAR,2    RSADET
     C                     ENDIF
      *
      ** Block CR?
     C           CBLCR     IFEQ 'Y'
     C                     MOVE 'Y'       WBLOCK
     C                     MOVE RNAR,4    RSADET
     C                     ENDIF
     C                     ENDIF
      *                                                                                       254051
      ** If insufficient fund.                                                                254051
      *                                                                                       254051
     C           WINSFN    IFEQ 'Y'                                                           254051
     C                     MOVE 'Y'       WBLOCK                                              254051
     C                     MOVE RNAR,8    RSADET                                              254051
     C                     ENDIF                                                              254051
      *
      ** If account has been referred or blocked, write to
      ** exception report (RE0732P2)
     C           WACREF    IFEQ 'Y'
     C           WBLOCK    OREQ 'Y'
      *
      ** Output a detail exception record
     C                     MOVE SWEP      RSSWEP
      *
      ** Retail A/c no used?
     C           BMRANR    IFEQ 'Y'
      *
     C                     MOVE WCRAC     RSACNO    P
     C                     ELSE
     C                     MOVE WCRACT    RSACNO
     C                     ENDIF
      *
      ** For EMU, if retail Number is Zero or Blank the use full                              239502
      ** account number.                                                                      239502
      *                                                                                       239502
     C           SWTP      IFEQ '4'                                                           239502
     C           WCRAC     IFEQ *BLANKS                                                       239502
     C           WCRAC     OREQ *ZEROS                                                        239502
     C                     MOVE *BLANKS   RSACNO                                              239502
     C                     MOVE WACCNT    RSACNO                                              239502
     C                     ENDIF                                                              239502
     C                     ENDIF                                                              239502
      *                                                                                       239502
     C                     MOVE WACLO     RSCLAC
      *
     C           WTRBR     IFNE WBRCH2
     C           OPENP2    ANDEQ'Y'
     C           *IN82     ANDEQ'1'
     C                     EXSR SRCBR2
     C                     ENDIF
      *
     C           OPENP2    IFNE 'Y'
     C                     EXSR SRCBR2
     C                     ENDIF
      *
      ** Check overflow
     C           *IN16     IFEQ '1'
      *
      ** Multi-Branching on?
     C           *IN82     IFEQ '1'
     C                     MOVEL*BLANKS   RSDESC
     C                     EXSR SRMULT
     C                     MOVELWBRCH2    RSBRCD
     C                     MOVELWDESC     RSDESC
     C                     ENDIF
      *
     C                     WRITEHEADP2
     C                     WRITEDTLHDR2
     C                     MOVE '0'       *IN16
     C                     ENDIF
      *
      ** Write details
     C                     WRITEDETAIL2
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRRVSP - Reverse Sweep Processing                            *
      *                                                               *
      *  Called By: Sweep Processing                                  *
      *  Calls:                                                       *
      *        (none)                                                 *
      *                                                               *
      *****************************************************************
      *
     C           SRRVSP    BEGSR                           *** SRRVSP ***
      *
     C                     MOVE 'N'       WSIGN   1                                           250620
     C/COPY WNCPYSRC,RE0732C009
      ** Compute for the Sweep Amount
     C           STHR      SUB  WDRCB     SWPAMT
     C/COPY WNCPYSRC,RE0732C010
      *
      ** (Overdraft Limit > 0) and (Overdraft Expiry Date >= Rundate)
     C           WODLN     IFGT 0
     C           WODED     ANDGEBJRDNB
      *
      ** Convert overdraft to have decimal places
     C                     MOVE WODLN     ZAMTCI
     C                     MOVE CCY       ZCCYI
     C                     MOVE CCY       ZCCYO
     C                     Z-ADD0         ZCDPI
     C                     Z-ADDZDECS     ZCDPO
     C                     Z-ADD1         ZEXCH
     C                     MOVE A6MDIN    ZMD
     C                     EXSR ZCONV
     C           WCRCB     ADD  ZAMTCO    WWCRCB 150
     C                     ELSE
     C                     Z-ADDWCRCB     WWCRCB
     C                     ENDIF
      *                                                                                       246810
      ** Initialise field RVPAMT in case CEU022 is not on.                                    246810
      *                                                                                       246810
     C                     Z-ADDWWCRCB    RVPAMT                                              246810
      *
      ** Convert posting Euro credit total amount to DCCY.                162666
      *                                                                   162666
     C           CEU022    IFEQ 'Y'                                       162666
      *          DCCY      ANDNECCCY                                      162666
      *                                                                   162666
     C           CCCY      IFEQ BKEURO                                    162666
     C           DRINCY    ANDEQ'Y'                                       162666
      *                                                                   162666
     C                     CALL 'EU0200'                                  162666
     C                     PARM *BLANK    P@RTCD  7                       162666
     C                     PARM WWCRCB    P@FRAM 183                      162666
     C                     PARM BKEURO    P@FRCY  3                       162666
     C                     PARM DCCY      P@TOCY  3                       162666
     C                     PARM           P@OUTA 150                      162666
     C                     PARM           P@INTA 183                      162666
     C                     PARM           P@EXRT 159                      162666
     C                     PARM           P@MDIN  1                       162666
      *                                                                   162666
     C           P@RTCD    IFEQ '*ERROR*'                                 162666
     C           *LOCK     IN   LDA                                       162666
     C                     MOVEL'RE0732  'DBFILE           ************   162666
     C                     MOVE 035       DBASE            * DBERR 35 *   162666
     C                     MOVE *BLANKS   DBKEY            ************   162666
     C                     MOVE *BLANKS   W@OPTN  7                       162666
     C                     MOVELP@FRCY    W@OPTN                          162666
     C                     MOVE P@TOCY    W@OPTN                          162666
     C                     MOVELW@OPTN    DBKEY                           162666
     C                     OUT  LDA                                       162666
     C                     EXSR *PSSR                                     162666
     C                     ENDIF                                          162666
      *                                                                   162666
     C                     Z-ADDP@OUTA    RVPAMT 150                      162666
      *                                                                   162666
     C                     ELSE                                           162666
      *                                                                   162666
     C                     Z-ADDWWCRCB    ZAMTF                           162666
     C                     Z-ADD0         ZAMTT                           162666
     C                     EXSR ZCCYCN                                    162666
     C                     Z-ADDZAMTT     RVPAMT                          162666
      *                                                                   162666
     C                     ENDIF                                          162666
      *                                                                   162666
     C                     ENDIF                                          162666
      *                                                                   162666
      ***Cleared*Balance*less*than*Sweep*Amount?**********************    162666
     C********** WWCRCB    IFLT SWPAMT                                    162666
      ** Is the equivalent cleared balance less than the sweep amount.    162666
      *
     C           CEU022    IFEQ 'Y'                                                           250620
     C           RVPAMT    IFLT SWPAMT                                    162666
      *                                                                   133672
     C           SWTP      IFEQ '4'                                       133672
     C***********          Z-ADDWWCRCB    SWPAMT                    133672134902
      *                                                                   133672
     C                     ELSE                                           133672
      *                                                                   133672
     C********** WWCRCB    IFGT 0                                         162666
     C***********SWTP      OREQ '4'                                CEU022 133672
     C           RVPAMT    IFGT 0                                         162666
     C/COPY WNCPYSRC,RE0732C027
     C                     Z-ADDWWCRCB    SWPAMT
     C/COPY WNCPYSRC,RE0732C028
     C                     ELSE
     C                     Z-ADD0         SWPAMT
     C                     ENDIF
      *                                                                   133672
     C                     ENDIF
      *                                                                   133672
     C                     ENDIF                                          133672
      *                                                                                       250620
      ** If CEU022 = 'N'                                                                      250620
      *                                                                                       250620
     C                     ELSE                                                               250620
     C********** WCRCB     IFGT SWPAMT                                               250620 MD048589
     C           WWCRCB    IFGT SWPAMT                                                      MD048589
     C                     Z-SUBSWPAMT    SWPAMT                                              250620
     C                     MOVE 'Y'       WSIGN                                               250620
     C                     ELSE                                                               250620
     C           WWCRCB    IFGT 0                                                           MD048589
     C                     Z-SUBWWCRCB    SWPAMT                                            MD048589
     C                     MOVE 'Y'       WSIGN                                             MD048589
     C                     ELSE                                                             MD048589
     C                     Z-ADD0         SWPAMT                                              250620
     C                     ENDIF                                                            MD048589
     C                     ENDIF                                                              250620
     C                     ENDIF                                                              250620
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRTERM - Termination Processing                              *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *        (none)                                                 *
      *                                                               *
      *****************************************************************
      *
     C           SRTERM    BEGSR                           *** SRTERM ***
      *
      ** Printer file P1 open? (RE0732P1)
     C           OPENP1    IFEQ 'Y'
      *
      ** Multi-Branching indicator on?
     C           *IN82     IFEQ '1'
     C                     MOVE WSVBR     RSBRCD
     C                     ENDIF
      *
     C                     WRITETRAILP1
     C                     CLOSERE0732P1
     C                     MOVE 'N'       OPENP1
     C                     ENDIF
      *
      ** Printer file P2 open? (RE0732P2)
     C           OPENP2    IFEQ 'Y'
      *
      ** Multi-Branching indicator on?
     C           *IN82     IFEQ '1'
     C                     MOVE WBRCH2    RSBRCD
     C                     ENDIF
      *
     C                     WRITETRAILP2
     C                     CLOSERE0732P2
     C                     MOVE 'N'       OPENP2
     C                     ENDIF
      *
     C                     EXSR SRW05
      *
     C                     EXSR SRAUD
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRW01  - Write a Debit Posting Record in GESPPD              *
      *                                                               *
      *  Called by: Sweep Processing                                  *
      *  Calls:                                                       *
      *  SRNARR - Access Program.                                     *
      *                                                               *
      *****************************************************************
      *
     C           SRW01     BEGSR                           *** SRW01  ***
      *
      ** Initialise GESPPD record format
     C                     CLEARAPOSTPDF
      *
      ** Write DR Posting
     C                     MOVE 'P'       RECI
     C                     MOVE DCUSN     CNUM
     C                     MOVE DCCY      CCY
     C                     MOVE DACOD     ACOD
     C                     MOVE DACSQ     ACSQ
     C                     MOVE WDRAC     ACNO
     C                     Z-ADDBJRDNB    PSTD
     C/COPY WNCPYSRC,RE0732C034
     C                     Z-ADDBJRDNB    VALD
     C/COPY WNCPYSRC,RE0732C035
     C                     MOVE WTRAT     TRAT
      *
     C           PNCD      IFNE *BLANKS
     C                     EXSR SRNARR
     C                     ELSE
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                                197465
     C                     ENDIF
      *
     C                     Z-ADDSWPAMT    PSTA
      *
      ** If Reverse Sweep, CR posting
     C           WRVSWF    IFEQ '*'
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     ENDIF
      *
     C                     MOVEL'  GE-SP' SPOS
     C                     MOVE DBRCH     BRCA
     C                     Z-ADD1         RIND
     C                     Z-ADDWDRRM     RRNM
     C                     MOVE 'R'       ATYP
     C                     MOVE 'V'       GETP
     C                     MOVE WPRFC     PRFC
     C                     Z-ADD235959    PTIM
     C                     MOVE WDRACS    ACSC
     C                     MOVE SWEP      RINO
     C                     MOVE *BLANKS   OTRF
     C                     MOVELSWEP      OTRF
     C                     MOVELWTRAT     OTTP
     C           CEU022    IFEQ 'Y'                                       CEU022
     C                     Z-SUBW#DRCB    SDCB                            CEU022
     C                     ELSE                                           CEU022
     C                     Z-SUBWDRCB     SDCB
     C                     ENDIF                                          CEU022
     C                     Z-SUBWDRLB     SDLB
     C/COPY WNCPYSRC,RE0732C018
     C                     WRITEAPOSTPDF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRW02  - Write a Credit Posting Record in GESPPD             *
      *                                                               *
      *  Called by: Sweep Processing                                  *
      *  Calls:                                                       *
      *  SRNARR - Get Narrative from SDNARRPD                         *
      *                                                               *
      *****************************************************************
      *
     C           SRW02     BEGSR                           *** SRW02  ***
      *
      ** Initialise GESPPD record format
     C                     CLEARAPOSTPDF
      *
      ** Write CR Posting
     C                     MOVE 'P'       RECI
     C                     MOVE CCUSN     CNUM
     C                     MOVE CCCY      CCY
     C                     MOVE CACOD     ACOD
     C                     MOVE CACSQ     ACSQ
     C                     MOVE WCRAC     ACNO
     C                     Z-ADDBJRDNB    PSTD
     C/COPY WNCPYSRC,RE0732C036
     C                     Z-ADDBJRDNB    VALD
     C/COPY WNCPYSRC,RE0732C037
     C                     MOVE WTRAT     TRAT
      *
     C           PNCD      IFNE *BLANKS
     C                     EXSR SRNARR
     C                     ELSE
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                                197465
     C                     ENDIF
      *                                                                   CEU022
     C           CEU022    IFEQ 'Y'                                       CEU022
     C           DCCY      ANDNECCCY                                      CEU022
      *                                                                   CEU022
      ** convert posting amount   to CCCY curency                         CEU022
     C           CCCY      IFEQ BKEURO                                    CEU022
     C           DCCY      ANDNEBKEURO                                    137491
     C           DRINCY    ANDEQ'Y'                                       146799
      *                                                                   CEU022
     C                     CALL 'EU0200'                                  CEU022
     C                     PARM *BLANK    P@RTCD  7        Return Code    CEU022
     C                     PARM SWPAMT    P@FRAM 183       FROM Ccy AmountCEU022
     C                     PARM DCCY      P@FRCY  3        FROM Currency  CEU022
     C                     PARM BKEURO    P@TOCY  3        TO Currency    CEU022
     C                     PARM           P@OUTA 150       Outright AmountCEU022
     C                     PARM           P@INTA 183       Interim Amount CEU022
     C                     PARM           P@EXRT 159       Exchange Rate  CEU022
     C                     PARM           P@MDIN  1        Mult/Div Ind.  CEU022
      *                                                                   CEU022
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     MOVEL'RE0732  'DBFILE           ************   CEU022
     C                     MOVE 011       DBASE            * DBERR 11 *   CEU022
     C                     MOVE *BLANKS   DBKEY            ************   CEU022
     C                     MOVE *BLANKS   W@OPTN  7                       CEU022
     C                     MOVELP@FRCY    W@OPTN                          CEU022
     C                     MOVE P@TOCY    W@OPTN                          CEU022
     C                     MOVELW@OPTN    DBKEY                           CEU022
     C                     OUT  LDA                                       CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     Z-ADDP@OUTA    PSTA                            CEU022
      *                                                                   CEU022
     C                     ELSE                                           CEU022
      *                                                                   CEU022
     C                     Z-ADDSWPAMT    ZAMTF                           CEU022
     C                     Z-ADD0         ZAMTT                           CEU022
     C                     EXSR ZCCYCN                                    CEU022
     C                     Z-ADDZAMTT     PSTA                            CEU022
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     Z-ADDPSTA      WWPAMT 150                      CEU022
      *                                                                   CEU022
     C                     ELSE                                           CEU022
      *                                                                   CEU022
     C                     Z-ADDSWPAMT    PSTA
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *
      ** If Reverse Sweep, DR posting
     C           WRVSWF    IFEQ '*'
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     ENDIF
      *
     C                     MOVEL'  GE-SP' SPOS
     C                     MOVE CBRCH     BRCA
     C                     Z-ADD1         RIND
     C                     Z-ADDWCRRM     RRNM
     C                     MOVE 'R'       ATYP
     C                     MOVE 'V'       GETP
     C                     MOVE WPRFC     PRFC
     C                     Z-ADD235959    PTIM
     C                     MOVE WCRACS    ACSC
     C                     MOVE SWEP      RINO
     C                     MOVE *BLANKS   OTRF
     C                     MOVELSWEP      OTRF
     C                     MOVELWTRAT     OTTP
     C           CEU022    IFEQ 'Y'                                       CEU022
     C                     Z-SUBW#CRCB    SDCB                            CEU022
     C                     ELSE                                           CEU022
     C                     Z-SUBWCRCB     SDCB
     C                     ENDIF                                          CEU022
     C                     Z-SUBWCRLB     SDLB
     C/COPY WNCPYSRC,RE0732C019
     C                     WRITEAPOSTPDF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRW03  - Output Interbranch Postings to GESPPD               *
      *                                                               *
      *  Called by: Sweep Processing                                  *
      *  Calls:                                                       *
      *  SRNARR - Get Narrative from SDNARRPD                         *
      *                                                               *
      *****************************************************************
      *
     C           SRW03     BEGSR                           ***  SRW03 ***
      *
      ** Initialise GESPPD record format
     C                     CLEARAPOSTPDF
      *
      ** Write CR Posting
     C                     MOVE 'P'       RECI
      *
     C           MBRENT    IFEQ 'Y'
     C           *IN10     ANDEQ*ON                                       165057
     C                     MOVE MBICN     CNUM
     C                     ELSE
     C                     MOVE CBICN     CNUM
     C                     ENDIF
      *
     C           CEU022    IFEQ 'Y'                                       164572
     C           DCCY      ANDNECCCY                                      164572
     C                     MOVE CCCY      CCY                             164572
     C                     ELSE                                           164572
     C                     MOVE DCCY      CCY
     C                     END                                            164572
      *
      ** If Reverse Sweep, DR 'Due From' A/c Code
     C           WRVSWF    IFEQ '*'
     C                     MOVE DADFR     ACOD
     C                     Z-ADD0         DRCR
     C                     MOVE DTYPFR    ATYP
     C                     MOVE DASFR     ACSC
     C                     ELSE
     C                     MOVE DADTO     ACOD
     C                     Z-ADD1         DRCR
     C                     MOVE DTYPTO    ATYP
     C                     MOVE DASTO     ACSC
     C                     ENDIF
      *
     C                     MOVE '01'      ACSQ
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE WTRAT     TRAT
      *
     C           PNCD      IFNE *BLANKS
     C                     EXSR SRNARR
     C                     ELSE
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                                197465
     C                     ENDIF
      *
     C           CEU022    IFEQ 'Y'                                       164572
     C           DCCY      ANDNECCCY                                      164572
     C                     Z-ADDWWPAMT    PSTA                            164572
     C                     Z-ADDWWPAMT    W#AMT1 150                      167269
     C                     ELSE                                           164572
     C                     Z-ADDSWPAMT    PSTA
     C                     END                                            164572
      *
     C                     MOVEL'  GE-SP' SPOS
     C                     MOVE DBRCH     BRCA
     C                     Z-ADD0         RIND
     C                     Z-ADD*ZEROS    RRNM
      *
     C                     MOVE 'V'       GETP
     C                     MOVE WPRFC     PRFC
     C                     Z-ADD235959    PTIM
      *
     C                     MOVE SWEP      RINO
     C                     MOVE *BLANKS   OTRF
     C                     MOVELSWEP      OTRF
     C                     MOVELWTRAT     OTTP
     C                     Z-ADD0         SDCB
     C                     Z-ADD0         SDLB
     C/COPY WNCPYSRC,RE0732C020
     C                     WRITEAPOSTPDF
      *                                                                   167269
      ** Call hash total routine now to use correct amounts.              167269
      *                                                                   167269
     C                     ADD  1         WNORE                           167269
     C                     MOVE PSTA      ZZAMT                           167269
     C                     EXSR SRHASH                                    167269
     C           CEU022    IFEQ 'Y'                                       167269
     C           DCCY      ANDNECCCY                                      167269
     C                     Z-ADDW#AMT1    SWPAMT                          167269
     C                     ENDIF                                          167269
      *
      ** Initialise GESPPD record format
     C                     CLEARAPOSTPDF
      *
      ** Write DR Posting
     C                     MOVE 'P'       RECI
      *
     C           MBRENT    IFEQ 'Y'
     C           *IN10     ANDEQ*ON                                       165057
     C                     MOVE MBICN     CNUM
     C                     ELSE
     C                     MOVE DBICN     CNUM
     C                     ENDIF
      *
     C           CEU022    IFEQ 'Y'                                       164572
     C           DCCY      ANDNECCCY                                      164572
     C                     MOVE CCCY      CCY                             164572
     C                     ELSE                                           164572
     C                     MOVE DCCY      CCY
     C                     END                                            164572
      *
      ** If Reverse Sweep, CR 'Due To' A/c Code
     C           WRVSWF    IFEQ '*'
     C                     MOVE CADTO     ACOD
     C                     Z-ADD1         DRCR
     C                     MOVE CTYPTO    ATYP
     C                     MOVE CASTO     ACSC
     C                     ELSE
     C                     MOVE CADFR     ACOD
     C                     Z-ADD0         DRCR
     C                     MOVE CTYPFR    ATYP
     C                     MOVE CASFR     ACSC
     C                     ENDIF
      *
     C                     MOVE '01'      ACSQ
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE WTRAT     TRAT
      *
     C           PNCD      IFNE *BLANKS
     C                     EXSR SRNARR
     C                     ELSE
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                                197465
     C                     ENDIF
      *
     C           CEU022    IFEQ 'Y'                                       164572
     C           DCCY      ANDNECCCY                                      164572
     C                     Z-ADDWWPAMT    PSTA                            164572
     C                     Z-ADDWWPAMT    W#AMT2 150                      167269
     C                     ELSE                                           164572
     C                     Z-ADDSWPAMT    PSTA
     C                     END                                            164572
      *
     C                     MOVEL'  GE-SP' SPOS
     C                     MOVE CBRCH     BRCA
     C                     Z-ADD0         RIND
     C                     Z-ADD*ZEROS    RRNM
      *
     C                     MOVE 'V'       GETP
     C                     MOVE WPRFC     PRFC
     C                     Z-ADD235959    PTIM
      *
     C                     MOVE SWEP      RINO
     C                     MOVE *BLANKS   OTRF
     C                     MOVELSWEP      OTRF
     C                     MOVELWTRAT     OTTP
     C                     Z-ADD0         SDCB
     C                     Z-ADD0         SDLB
     C/COPY WNCPYSRC,RE0732C021
     C                     WRITEAPOSTPDF
      *                                                                   167269
      ** Call hash total routine now to use correct amounts.              167269
      *                                                                   167269
     C                     ADD  1         WNORE                           167269
     C                     MOVE PSTA      ZZAMT                           167269
     C                     EXSR SRHASH                                    167269
     C           CEU022    IFEQ 'Y'                                       167269
     C           DCCY      ANDNECCCY                                      167269
     C                     Z-ADDW#AMT2    SWPAMT                          167269
     C                     ENDIF                                          167269
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRW04  - Output Main Branch Entries to GESPPS                *
      *                                                               *
      *  Called by: Sweep Processing                                  *
      *  Calls:                                                       *
      *  SRNARR - Get Narrative from SDNARRPD                         *
      *                                                               *
      *****************************************************************
      *
     C           SRW04     BEGSR                           *** SRW04  ***
      *
      ** Initialise GESPPD record format
     C                     CLEARAPOSTPDF
      *
      ** Write CR Posting
     C                     MOVE 'P'       RECI
     C                     MOVE CBICN     CNUM
     C**********           MOVE DCCY      CCY                             167269
     C           CEU022    IFEQ 'Y'                                       167269
     C           DCCY      ANDNECCCY                                      167269
     C                     MOVE CCCY      CCY                             167269
     C                     ELSE                                           167269
     C                     MOVE DCCY      CCY                             167269
     C                     ENDIF                                          167269
      *
      ** If Reverse Sweep, Main 'Due From' A/c Code
     C           WRVSWF    IFEQ '*'
     C                     MOVE MADFR     ACOD
     C                     Z-ADD0         DRCR
     C                     MOVE MTYPFR    ATYP
     C                     MOVE MASFR     ACSC
     C                     ELSE
     C                     MOVE MADTO     ACOD
     C                     Z-ADD1         DRCR
     C                     MOVE MTYPTO    ATYP
     C                     MOVE MASTO     ACSC
     C                     ENDIF
      *
     C                     MOVE '01'      ACSQ
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE WTRAT     TRAT
      *
     C           PNCD      IFNE *BLANKS
     C                     EXSR SRNARR
     C                     ELSE
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                                197465
     C                     ENDIF
      *
     C                     Z-ADDSWPAMT    PSTA
      *
     C                     MOVEL'  GE-SP' SPOS
     C                     MOVE BKMABR    BRCA
     C                     Z-ADD0         RIND
     C                     Z-ADD*ZEROS    RRNM
      *
     C                     MOVE 'V'       GETP
     C                     MOVE WPRFC     PRFC
     C                     Z-ADD235959    PTIM
      *
     C                     MOVE SWEP      RINO
     C                     MOVE *BLANKS   OTRF
     C                     MOVELSWEP      OTRF
     C                     MOVELWTRAT     OTTP
     C                     Z-ADD0         SDCB
     C                     Z-ADD0         SDLB
     C/COPY WNCPYSRC,RE0732C022
     C                     WRITEAPOSTPDF
      *                                                                   167269
      ** Call hash total routine now to use correct amounts.              167269
      *                                                                   167269
     C                     ADD  1         WNORE                           167269
     C                     MOVE PSTA      ZZAMT                           167269
     C                     EXSR SRHASH                                    167269
      *
      ** Initialise GESPPD record format
     C                     CLEARAPOSTPDF
      *
      ** Write DR Posting
     C                     MOVE 'P'       RECI
     C                     MOVE DBICN     CNUM
     C**********           MOVE DCCY      CCY                             167269
     C           CEU022    IFEQ 'Y'                                       167269
     C           DCCY      ANDNECCCY                                      167269
     C                     MOVE CCCY      CCY                             167269
     C                     ELSE                                           167269
     C                     MOVE DCCY      CCY                             167269
     C                     ENDIF                                          167269
      *
      ** If Reverse Sweep, Main 'Due To' A/c Code
     C           WRVSWF    IFEQ '*'
     C                     MOVE MADTO     ACOD
     C                     Z-ADD1         DRCR
     C                     MOVE MTYPTO    ATYP
     C                     MOVE MASTO     ACSC
     C                     ELSE
     C                     MOVE MADFR     ACOD
     C                     Z-ADD0         DRCR
     C                     MOVE MTYPFR    ATYP
     C                     MOVE MASFR     ACSC
     C                     ENDIF
      *
     C                     MOVE '01'      ACSQ
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE WTRAT     TRAT
      *
     C           PNCD      IFNE *BLANKS
     C                     EXSR SRNARR
     C                     ELSE
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                                197465
     C                     ENDIF
      *
     C                     Z-ADDSWPAMT    PSTA
      *
     C                     MOVEL'  GE-SP' SPOS
     C**********           MOVE WSVBR     BRCA                            167269
     C                     MOVE BKMABR    BRCA                            167269
     C                     Z-ADD0         RIND
     C                     Z-ADD*ZEROS    RRNM
      *
     C                     MOVE 'V'       GETP
     C                     MOVE WPRFC     PRFC
     C                     Z-ADD235959    PTIM
      *
     C                     MOVE SWEP      RINO
     C                     MOVE *BLANKS   OTRF
     C                     MOVELSWEP      OTRF
     C                     MOVELWTRAT     OTTP
     C                     Z-ADD0         SDCB
     C                     Z-ADD0         SDLB
     C/COPY WNCPYSRC,RE0732C023
     C                     WRITEAPOSTPDF
      *                                                                   167269
      ** Call hash total routine now to use correct amounts.              167269
      *                                                                   167269
     C                     ADD  1         WNORE                           167269
     C                     MOVE PSTA      ZZAMT                           167269
     C                     EXSR SRHASH                                    167269
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRW05  - Write totals to GESPZZ                              *
      *                                                               *
      *  Called by: Termination Processing                            *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRW05     BEGSR                           *** SRW05  ***
      *
      ** Write totals to PF/GESPZZ
     C                     MOVE 'T'       RECI
     C                     ADD  2         WNORE
     C                     ADD  WNORE     NORE1
     C                     ADD  HASHI     HRWN
     C                     ADD  HASHD     HRDC
     C                     WRITEAPOSTZZF
      *
     C                     ENDSR
      *
      /EJECT                                                              CEU022
      *****************************************************************   CEU022
      *                                                               *   CEU022
      *  SRW06  - Write a Debit  Posting Record in GESPPD             *   CEU022
      *                                                               *   CEU022
      *  Called by: Sweep Processing                                  *   CEU022
      *  Calls:                                                       *   CEU022
      *  SRNARR - Access Program.                                     *   CEU022
      *                                                               *   CEU022
      *****************************************************************   CEU022
      *                                                                   CEU022
     C           SRW06     BEGSR                           *** SRW06  *** CEU022
      *                                                                   CEU022
      ** Initialise GESPPD record format                                  CEU022
     C                     CLEARAPOSTPDF                                  CEU022
      *                                                                   CEU022
      ** Write CR Posting                                                 CEU022
     C                     MOVE 'P'       RECI                            CEU022
     C                     MOVE A8BICN    CNUM                            CEU022
     C                     MOVE CCCY      CCY                             CEU022
      *                                                                   CEU022
      ** CALL ACCESS PROGRAM FOR TRADING DATA  DETAILS                    CEU022
      *                                                                   CEU022
     C                     CALL 'AOTRADR0'                                CEU022
     C                     PARM *BLANKS   WRTCD                           CEU022
     C                     PARM '*FIRST  'WOPTN                           CEU022
     C           SDTRAD    PARM SDTRAD    DSFDY                           CEU022
      *                                                                   CEU022
     C           WRTCD     IFNE *BLANK                                    CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     SETON                     U7U8LR               CEU022
     C                     MOVELWOPTN     DBKEY                           CEU022
     C                     MOVEL'SDTRADPD'DBFILE           ***************CEU022
     C                     Z-ADD12        DBASE            * DB ERROR 012 CEU022
     C                     OUT  LDA                        ***************CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
     C                     MOVE BLSPTA    ACOD                            CEU022
      *                                                                   CEU022
     C                     MOVE '01'      ACSQ                            CEU022
     C                     Z-ADD*ZERO     ACNO                            CEU022
     C                     Z-ADDBJRDNB    PSTD                            CEU022
     C                     Z-ADDBJRDNB    VALD                            CEU022
     C                     Z-ADD*ZERO     TRAT                            CEU022
      *                                                                   CEU022
     C           PNCD      IFNE *BLANKS                                   CEU022
     C                     EXSR SRNARR                                    CEU022
     C                     ELSE                                           CEU022
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                         CEU022 197465
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     Z-ADDWWPAMT    PSTA                            CEU022
      *                                                                   CEU022
      ** If Reverse Sweep, CR posting                                     CEU022
     C           WRVSWF    IFEQ '*'                                       CEU022
     C                     Z-ADD1         DRCR                            CEU022
     C                     ELSE                                           CEU022
     C                     Z-ADD0         DRCR                            CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     MOVEL'  GE-SP' SPOS                            CEU022
     C                     MOVE DBRCH     BRCA                            CEU022
     C                     Z-ADD0         RIND                            CEU022
     C                     Z-ADDWDRRM     RRNM                            CEU022
     C                     MOVE 'G'       ATYP                            CEU022
     C                     MOVE 'V'       GETP                            CEU022
     C                     MOVE WPRFC     PRFC                            CEU022
     C                     Z-ADD235959    PTIM                            CEU022
     C                     MOVE WDRACS    ACSC                            CEU022
     C                     MOVE SWEP      RINO                            CEU022
     C                     MOVE *BLANKS   OTRF                            CEU022
     C                     MOVELSWEP      OTRF                            CEU022
     C                     MOVELWTRAT     OTTP                            CEU022
     C                     Z-SUBW#CRCB    SDCB                            CEU022
     C                     Z-SUBWCRLB     SDLB                            CEU022
      ** Ensure that ACSC is correct.                                     153249
     C**********           MOVELACOD      @ACD    4                                    153249 CGL029
     C                     MOVELACOD      @ACD   10                                           CGL029
     C                     EXSR GETAC                                     153249
     C/COPY WNCPYSRC,RE0732C030
     C                     WRITEAPOSTPDF                                  CEU022
      *                                                                   CEU022
     C                     ENDSR                                          CEU022
      /EJECT                                                              CEU022
      *****************************************************************   CEU022
      *                                                               *   CEU022
      *  SRW07  - Write a Credit Posting Record in GESPPD             *   CEU022
      *                                                               *   CEU022
      *  Called by: Sweep Processing                                  *   CEU022
      *  Calls:                                                       *   CEU022
      *  SRNARR - Access Program.                                     *   CEU022
      *                                                               *   CEU022
      *****************************************************************   CEU022
      *                                                                   CEU022
     C           SRW07     BEGSR                           *** SRW07  *** CEU022
      *                                                                   CEU022
      ** Initialise GESPPD record format                                  CEU022
     C                     CLEARAPOSTPDF                                  CEU022
      *                                                                   CEU022
      ** Write CR Posting                                                 CEU022
     C                     MOVE 'P'       RECI                            CEU022
     C                     MOVE A8BICN    CNUM                            CEU022
     C                     MOVE DCCY      CCY                             CEU022
      *                                                                   CEU022
      ** CALL ACCESS PROGRAM FOR TRADING DATA  DETAILS                    CEU022
      *                                                                   CEU022
     C                     CALL 'AOTRADR0'                                CEU022
     C                     PARM *BLANKS   WRTCD                           CEU022
     C                     PARM '*FIRST  'WOPTN                           CEU022
     C           SDTRAD    PARM SDTRAD    DSFDY                           CEU022
      *                                                                   CEU022
     C           WRTCD     IFNE *BLANK                                    CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     SETON                     U7U8LR               CEU022
     C                     MOVELWOPTN     DBKEY                           CEU022
     C                     MOVEL'SDTRADPD'DBFILE           ***************CEU022
     C                     Z-ADD13        DBASE            * DB ERROR 013 CEU022
     C                     OUT  LDA                        ***************CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
     C                     MOVE BLSPTA    ACOD                            CEU022
      *                                                                   CEU022
     C                     MOVE '01'      ACSQ                            CEU022
     C                     Z-ADD*ZERO     ACNO                            CEU022
     C                     Z-ADDBJRDNB    PSTD                            CEU022
     C                     Z-ADDBJRDNB    VALD                            CEU022
     C                     Z-ADD*ZERO     TRAT                            CEU022
      *                                                                   CEU022
     C           PNCD      IFNE *BLANKS                                   CEU022
     C                     EXSR SRNARR                                    CEU022
     C                     ELSE                                           CEU022
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                         CEU022 197465
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     Z-ADDSWPAMT    PSTA                            CEU022
      *                                                                   CEU022
      *                                                                   CEU022
      ** If Reverse Sweep, CR posting                                     CEU022
     C           WRVSWF    IFEQ '*'                                       CEU022
     C                     Z-ADD0         DRCR                            CEU022
     C                     ELSE                                           CEU022
     C                     Z-ADD1         DRCR                            CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     MOVEL'  GE-SP' SPOS                            CEU022
     C                     MOVE DBRCH     BRCA                            CEU022
     C                     Z-ADD0         RIND                            CEU022
     C                     Z-ADDWDRRM     RRNM                            CEU022
     C                     MOVE 'G'       ATYP                            CEU022
     C                     MOVE 'V'       GETP                            CEU022
     C                     MOVE WPRFC     PRFC                            CEU022
     C                     Z-ADD235959    PTIM                            CEU022
     C                     MOVE WDRACS    ACSC                            CEU022
     C                     MOVE SWEP      RINO                            CEU022
     C                     MOVE *BLANKS   OTRF                            CEU022
     C                     MOVELSWEP      OTRF                            CEU022
     C                     MOVELWTRAT     OTTP                            CEU022
     C                     Z-SUBW#DRCB    SDCB                            CEU022
     C                     Z-SUBWDRLB     SDLB                            CEU022
      ** Ensure that ACSC is correct.                                     153249
     C**********           MOVELACOD      @ACD    4                                    153249 CGL029
     C                     MOVELACOD      @ACD                                                CGL029
     C                     EXSR GETAC                                     153249
     C/COPY WNCPYSRC,RE0732C031
     C                     WRITEAPOSTPDF                                  CEU022
      *                                                                   CEU022
     C                     ENDSR                                          CEU022
      /EJECT                                                              CEU022
      *****************************************************************   CEU022
      *                                                               *   CEU022
      *  SRW08  - Write a Debit Posting Record in GESPPD              *   CEU022
      *                                                               *   CEU022
      *  Called by: Sweep Processing                                  *   CEU022
      *  Calls:                                                       *   CEU022
      *  SRNARR - Access Program.                                     *   CEU022
      *                                                               *   CEU022
      *****************************************************************   CEU022
      *                                                                   CEU022
     C           SRW08     BEGSR                           *** SRW08  *** CEU022
      *                                                                   CEU022
      ** Initialise GESPPD record format                                  CEU022
     C                     CLEARAPOSTPDF                                  CEU022
      *                                                                   CEU022
      ** Write DR Posting                                                 CEU022
     C                     MOVE 'P'       RECI                            CEU022
     C                     MOVE A8BICN    CNUM                            CEU022
     C                     MOVE BJCYCD    CCY                             CEU022
      *                                                                   CEU022
     C                     MOVE DRSPAE    ACOD                            CEU022
      *                                                                   CEU022
     C                     MOVE '01'      ACSQ                            CEU022
     C                     Z-ADD*ZERO     ACNO                            CEU022
     C                     Z-ADDBJRDNB    PSTD                            CEU022
     C                     Z-ADDBJRDNB    VALD                            CEU022
     C                     Z-ADD*ZERO     TRAT                            CEU022
      *                                                                   CEU022
     C           PNCD      IFNE *BLANKS                                   CEU022
     C                     EXSR SRNARR                                    CEU022
     C                     ELSE                                           CEU022
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                         CEU022 197465
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
      ** convert posting amount                                           CEU022
     C           BJCYCD    IFEQ BKEURO                                    CEU022
     C           DCCY      ANDNEBKEURO                                    137491
     C           DRINCY    ANDEQ'Y'                                       146799
     C           CCCY      ANDNEBKEURO                                                        196661
      *                                                                   CEU022
     C                     CALL 'EU0200'                                  CEU022
     C                     PARM *BLANK    P@RTCD  7        Return Code    CEU022
     C                     PARM SWPAMT    P@FRAM 183       FROM Ccy AmountCEU022
     C                     PARM DCCY      P@FRCY  3        FROM Currency  CEU022
     C                     PARM BKEURO    P@TOCY  3        TO Currency    CEU022
     C                     PARM           P@OUTA 150       Outright AmountCEU022
     C                     PARM           P@INTA 183       Interim Amount CEU022
     C                     PARM           P@EXRT 159       Exchange Rate  CEU022
     C                     PARM           P@MDIN  1        Mult/Div Ind.  CEU022
      *                                                                   CEU022
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     MOVEL'RE0732  'DBFILE           ************   CEU022
     C                     MOVE 014       DBASE            * DBERR 14 *   CEU022
     C                     MOVE *BLANKS   DBKEY            ************   CEU022
     C                     MOVE *BLANKS   W@OPTN  7                       CEU022
     C                     MOVELP@FRCY    W@OPTN                          CEU022
     C                     MOVE P@TOCY    W@OPTN                          CEU022
     C                     MOVELW@OPTN    DBKEY                           CEU022
     C                     OUT  LDA                                       CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     Z-ADDP@OUTA    PSTA                            CEU022
      *                                                                   CEU022
     C                     ELSE                                           CEU022
      *                                                                   CEU022
     C                     MOVE BJCYCD    @CCY                            CEU022
     C                     CALL 'AOCURRR0'                                CEU022
     C                     PARM *BLANKS   WRTCD   7                       CEU022
     C                     PARM '*KEY    'WOPTN   7                       CEU022
     C                     PARM           @CCY    3                       CEU022
     C           SDCURR    PARM SDCURR    DSSDY                           CEU022
      *                                                                   CEU022
      **  Handle Database Error.                                          CEU022
     C           WRTCD     IFNE *BLANKS                                   CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     SETON                     U7U8LR               CEU022
     C                     MOVEL@CCY      DBKEY                           CEU022
     C                     MOVEL'SDCURRPD'DBFILE           ***************CEU022
     C                     Z-ADD015       DBASE            * DB ERROR 015 CEU022
     C                     OUT  LDA                        ***************CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     MOVE A6CYCD    ZCCYT                           CEU022
     C                     Z-ADDA6SPRT    ZRATET                          CEU022
     C                     MOVE A6MDIN    ZMDINT                          CEU022
     C                     Z-ADDA6NBDP    ZCDPT                           CEU022
      *                                                                   CEU022
     C                     Z-ADDSWPAMT    ZAMTF                           CEU022
     C                     Z-ADD0         ZAMTT                           CEU022
     C                     EXSR ZCCYCN                                    CEU022
     C                     Z-ADDZAMTT     PSTA                            CEU022
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
      ** If Reverse Sweep, CR posting                                     CEU022
     C           WRVSWF    IFEQ '*'                                       CEU022
     C                     Z-ADD1         DRCR                            CEU022
     C                     ELSE                                           CEU022
     C                     Z-ADD0         DRCR                            CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     MOVEL'  GE-SP' SPOS                            CEU022
     C                     MOVE DBRCH     BRCA                            CEU022
     C                     Z-ADD0         RIND                            CEU022
     C                     Z-ADDWDRRM     RRNM                            CEU022
     C                     MOVE 'G'       ATYP                            CEU022
     C                     MOVE 'V'       GETP                            CEU022
     C                     MOVE WPRFC     PRFC                            CEU022
     C                     Z-ADD235959    PTIM                            CEU022
     C                     MOVE WDRACS    ACSC                            CEU022
     C                     MOVE SWEP      RINO                            CEU022
     C                     MOVE *BLANKS   OTRF                            CEU022
     C                     MOVELSWEP      OTRF                            CEU022
     C                     MOVELWTRAT     OTTP                            CEU022
     C                     Z-SUBW#DRCB    SDCB                            CEU022
     C                     Z-SUBWDRLB     SDLB                            CEU022
      ** Ensure that ACSC is correct.                                     153249
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETAC                                     153249
     C/COPY WNCPYSRC,RE0732C032
     C                     WRITEAPOSTPDF                                  CEU022
      *                                                                   CEU022
     C                     ENDSR                                          CEU022
      /EJECT                                                              CEU022
      *****************************************************************   CEU022
      *                                                               *   CEU022
      *  SRW09  - Write a Credit Posting Record in GESPPD             *   CEU022
      *                                                               *   CEU022
      *  Called by: Sweep Processing                                  *   CEU022
      *  Calls:                                                       *   CEU022
      *  SRNARR - Access Program.                                     *   CEU022
      *                                                               *   CEU022
      *****************************************************************   CEU022
      *                                                                   CEU022
     C           SRW09     BEGSR                           *** SRW09  *** CEU022
      *                                                                   CEU022
      ** Initialise GESPPD record format                                  CEU022
     C                     CLEARAPOSTPDF                                  CEU022
      *                                                                   CEU022
      ** Write CR Posting                                                 CEU022
     C                     MOVE 'P'       RECI                            CEU022
     C                     MOVE A8BICN    CNUM                            CEU022
     C                     MOVE BJCYCD    CCY                             CEU022
     C                     MOVE CRSPAE    ACOD                            CEU022
      *                                                                   CEU022
     C                     MOVE '01'      ACSQ                            CEU022
     C                     Z-ADD*ZERO     ACNO                            CEU022
     C                     Z-ADDBJRDNB    PSTD                            CEU022
     C                     Z-ADDBJRDNB    VALD                            CEU022
     C                     Z-ADD*ZERO     TRAT                            CEU022
      *                                                                   CEU022
     C           PNCD      IFNE *BLANKS                                   CEU022
     C                     EXSR SRNARR                                    CEU022
     C                     ELSE                                           CEU022
     C                     EXSR SRBNAR                                                        197465
     C**********           MOVELWPNAR     PNAR                                         CEU022 197465
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
      ** convert posting amount                                           CEU022
     C           BJCYCD    IFEQ BKEURO                                    CEU022
     C           CCCY      ANDNEBKEURO                                    137491
     C           CRINCY    ANDEQ'Y'                                       146799
     C           DCCY      ANDNEBKEURO                                                        196661
      *                                                                   CEU022
     C                     CALL 'EU0200'                                  CEU022
     C                     PARM *BLANK    P@RTCD  7        Return Code    CEU022
     C**********           PARM SWPAMT    P@FRAM 183       FROM CcyCEU022 146799
     C                     PARM WWPAMT    P@FRAM 183       FROM Ccy Amount146799
     C                     PARM CCCY      P@FRCY  3        FROM Currency  CEU022
     C                     PARM BKEURO    P@TOCY  3        TO Currency    CEU022
     C                     PARM           P@OUTA 150       Outright AmountCEU022
     C                     PARM           P@INTA 183       Interim Amount CEU022
     C                     PARM           P@EXRT 159       Exchange Rate  CEU022
     C                     PARM           P@MDIN  1        Mult/Div Ind.  CEU022
      *                                                                   CEU022
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU022
     C           *LOCK     IN   LDA                                       CEU022
     C                     MOVEL'RE0732  'DBFILE           ************   CEU022
     C                     MOVE 019       DBASE            * DBERR 19 *   CEU022
     C                     MOVE *BLANKS   DBKEY            ************   CEU022
     C                     MOVE *BLANKS   W@OPTN  7                       CEU022
     C                     MOVELP@FRCY    W@OPTN                          CEU022
     C                     MOVE P@TOCY    W@OPTN                          CEU022
     C                     MOVELW@OPTN    DBKEY                           CEU022
     C                     OUT  LDA                                       CEU022
     C                     EXSR *PSSR                                     CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     Z-ADDP@OUTA    PSTA                            CEU022
      *                                                                   CEU022
     C                     ELSE                                           CEU022
      *                                                                   CEU022
     C                     Z-ADDSWPAMT    ZAMTF                           CEU022
     C                     Z-ADD0         ZAMTT                           CEU022
     C                     EXSR ZCCYCN                                    CEU022
      *                                                                   CEU022
     C                     Z-ADDZAMTT     PSTA                            CEU022
      *                                                                   CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
      ** If Reverse Sweep, CR posting                                     CEU022
     C           WRVSWF    IFEQ '*'                                       CEU022
     C                     Z-ADD0         DRCR                            CEU022
     C                     ELSE                                           CEU022
     C                     Z-ADD1         DRCR                            CEU022
     C                     ENDIF                                          CEU022
      *                                                                   CEU022
     C                     MOVEL'  GE-SP' SPOS                            CEU022
     C                     MOVE DBRCH     BRCA                            CEU022
     C                     Z-ADD0         RIND                            CEU022
     C                     Z-ADDWDRRM     RRNM                            CEU022
     C                     MOVE 'G'       ATYP                            CEU022
     C                     MOVE 'V'       GETP                            CEU022
     C                     MOVE WPRFC     PRFC                            CEU022
     C                     Z-ADD235959    PTIM                            CEU022
     C                     MOVE WDRACS    ACSC                            CEU022
     C                     MOVE SWEP      RINO                            CEU022
     C                     MOVE *BLANKS   OTRF                            CEU022
     C                     MOVELSWEP      OTRF                            CEU022
     C                     MOVELWTRAT     OTTP                            CEU022
     C                     Z-SUBW#CRCB    SDCB                            CEU022
     C                     Z-SUBWCRLB     SDLB                            CEU022
      ** Ensure that ACSC is correct.                                     153249
     C**********           MOVELACOD      @ACD    4                                    153249 CGL029
     C                     MOVELACOD      @ACD                                                CGL029
     C                     EXSR GETAC                                     153249
     C/COPY WNCPYSRC,RE0732C033
     C                     WRITEAPOSTPDF                                  CEU022
      *                                                                   CEU022
     C                     ENDSR                                          CEU022
      *                                                                   CEU022
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRNARR - Get Narrative from SDNARRPD                         *
      *                                                               *
      *  Called by: SRW01, SRW02, SRW03, SRW04                        *
      *  Calls:                                                       *
      *  AONARRR0 Access Program.                                     *
      *                                                               *
      *****************************************************************
      *
     C           SRNARR    BEGSR                           *** SRNARR ***
      *
      ** Get narrative from Narratives file
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*KEY    'WOPTN   7
     C                     PARM           PNCD
     C           SDNARR    PARM SDNARR    DSFDY
      *
      **  Handle Database Error.
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVELPNCD      DBKEY
     C                     MOVEL'SDNARRPD'DBFILE           ****************
     C                     Z-ADD009       DBASE            * DB ERROR 009 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE ALDON     PNAR
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                                                  197465
      *****************************************************************                       197465
      *                                                               *                       197465
      * SRBNAR - If PNAR is blank, get the default narrative from     *                       197465
      *          the transaction type in PF/SDRETRPD. If A1RTNM is    *                       197465
      *          still blank, the default narrative will be hard-     *                       197465
      *          coded 'SWEEP TRANSFER.                               *                       197465
      *                                                               *                       197465
      * Called by: SRW01, SRW02, SRW03, SRW04, SRW06, SRW07, SRW08    *                       197465
      *                                                               *                       197465
      * Calls: AORETRR0 Access Program                                *                       197465
      *                                                               *                       197465
      *****************************************************************                       197465
      *                                                                                       197465
     C           SRBNAR    BEGSR                            *** SRBNAR ***                    197465
     C           WPNAR     IFEQ *BLANKS                                                       197465
     C           TRAT      IFNE *ZERO                                                         197465
     C                     CALL 'AORETRR0'                                                    197465
     C                     PARM *BLANKS   WRTCD   7                                           197465
     C                     PARM '*KEY   ' WOPTN   7                                           197465
     C                     PARM WTRAT     WTRATT  5                                           197465
     C           SDRETR    PARM SDRETR    DSFDY                                               197465
      *                                                                                       197465
      **  Handle Database Error.                                                              197465
      *                                                                                       197465
     C           WRTCD     IFNE *BLANKS                                                       197465
     C           *LOCK     IN   LDA                                                           197465
     C                     SETON                     U7U8LR***************                    197465
     C                     Z-ADD005       DBASE            *DB ERROR 005 *                    197465
     C                     MOVEL'SDRETRPD'DBFILE           ***************                    197465
     C                     MOVELTRAT      DBKEY                                               197465
     C                     OUT  LDA                                                           197465
     C                     EXSR *PSSR                                                         197465
     C                     ENDIF                                                              197465
      *                                                                                       197465
     C           A1RTNM    IFNE *BLANKS                                                       197465
     C                     MOVELA1RTNM    PNAR                                                197465
     C                     ELSE                                                               197465
     C                     MOVELWDNARR    PNAR                                                197465
     C                     ENDIF                                                              197465
      *                                                                                       197465
     C                     ELSE                                                               197465
     C                     MOVELWDNARR    PNAR                                                197465
     C                     ENDIF                                                              197465
     C                     ELSE                                                               197465
     C                     MOVELWPNAR     PNAR                                                197465
     C                     ENDIF                                                              197465
      *                                                                                       197465
     C                     ENDSR                                                              197465
      *                                                                                       197465
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRBRCD - Subroutine to setup array of Branch table details.  *
      *                                                               *
      *  Called by: Initial Processing                                *
      *  Calls:                                                       *
      *  AOBRCHR0 Access Program.                                     *
      *  AOACODR0 Access Program.                                     *
      *                                                               *
      *****************************************************************
      *
     C           SRBRCD    BEGSR                            *** SRBRCD ***
      *
      ***  Set Array Index
     C                     Z-ADD151       WI      30
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C                     PARM           @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      **  Handle Database Error.
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVE @OPTN     DBKEY
     C                     MOVE 'SDBRCHPD'DBFILE           ****************
     C                     Z-ADD015       DBASE            * DB ERROR 015 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           @RTCD     DOUEQ'*EOF'
     C           *IN17     OREQ '1'
      *
      **  Decrement Array Index
     C           WI        SUB  1         WI
      *
      **  Move Data into array
     C                     MOVE A8BRCD    BC,WI
     C                     MOVE A8BICN    DBICN
     C                     MOVE A8DTAC    DADTO
     C                     MOVE A8DFAC    DADFR
     C                     MOVE *BLANKS   DTYPTO
     C                     MOVE *BLANKS   DTYPFR
     C                     MOVE *BLANKS   DASTO
     C                     MOVE *BLANKS   DASFR
      *
      ** When Multi-Branching is on,access account codes table to
      ** get account type and account section
     C           *IN82     IFEQ '1'
     C                     CALL 'AOACODR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY    '@OPTN   7
     C                     PARM           DADTO
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *
      **  Handle Database Error.
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVE DADTO     DBKEY
     C                     MOVE 'SDACODPD'DBFILE           ****************
     C                     Z-ADD016       DBASE            * DB ERROR 016 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE A5ACTY    DTYPTO
     C                     MOVE A5ACSC    DASTO
      *
     C                     CALL 'AOACODR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY    '@OPTN   7
     C                     PARM           DADFR
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *
      **  Handle Database Error.
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVELDADFR     DBKEY
     C                     MOVE 'SDACODPD'DBFILE           ****************
     C                     Z-ADD017       DBASE            * DB ERROR 017 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE A5ACTY    DTYPFR
     C                     MOVE A5ACSC    DASFR
      *
     C                     ENDIF
      *
     C                     MOVE DBCI      BD,WI
      *
      **   Check if array is full
     C           WI        IFEQ 1
     C                     MOVE '1'       *IN17
     C                     ENDIF
      **
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*NEXT   '@OPTN   7
     C                     PARM           @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      **  Handle Database Error.
     C           @RTCD     IFNE *BLANKS
     C           @RTCD     ANDNE'*EOF'
     C           *LOCK     IN   LDA
     C                     SETON                     U7U8LR
     C                     MOVE @OPTN     DBKEY
     C                     MOVE 'SDBRCHPD'DBFILE           ****************
     C                     Z-ADD018       DBASE            * DB ERROR 018 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDDO
      *
      ** Store no of table records
     C                     Z-ADDWI        WIT     30
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************   134902
      *****************************************************************   134902
      * The following subroutines ahve been added for 134902              134902
      * SREXTP INTCAL ZICD ZIC00 ZIC01 ZIC02 DRINIT CRINIT DATEIN         134902
      *****************************************************************   134902
     C********************************************************************134902
     C**                                                                  134902
     C** SREXTP subroutine for extra processing for interest calculation  134902
     C**                                                                  134902
     C**                                                                  134902
     C**     Called by       SCROUT                                       134902
     C**     Calls           INTCAL                                       134902
     C**                                                                  134902
     C           SREXTP    BEGSR                           **SREXTP BEGSR*134902
      *                                                                   134902
     C********** RHISD     IFNE RUND                                                   134902 196958
     C           DHISD     IFNE RUND                                                          196958
     C                     CLEARDINT                                      134902
     C                     CLEARCINT                                      134902
     C                     EXSR INTCAL                                    134902
      *                                                                                       197268
      ** Initialise DAIC/CAIC with accruals from last balance                                 197268
      ** date of REHISL                                                                       197268
      *                                                                                       197268
     C           WRECI     IFEQ 'S'                                                           197268
     C                     Z-ADDDDAIC     DAIC1                                               197268
     C                     Z-ADDDCAIC     CAIC1                                               197268
     C                     ELSE                                                               197268
     C                     Z-ADDDAID      DAIC1                                               197268
     C                     Z-ADDCAID      CAIC1                                               197268
     C                     ENDIF                                                              197268
      *                                                                                       197268
     C                     ADD  DINT      DAIC1                           134902
     C                     ADD  CINT      CAIC1                           134902
     C                     END                                            134902
      *                                                                   134902
     C                     ENDSR                                          134902
      *                                                                   134902
     C********************************************************************134902
     C**                                                                  134902
     C** INTCAL subroutine for interest calculation between two dates     134902
     C**                                                                  134902
     C**                                                                  134902
     C**     Called by       External program                             134902
     C**     Calls           CRINIT, DATEIN, DRINIT, ZIC00, ZIC01,        134902
     C**                     ZIC02                                        134902
     C**                                                                  134902
     C           INTCAL    BEGSR                           **INTCAL BEGSR*134902
     C*                                                                   134902
     C** LOADING OF CURRENCY TO CHAIN TO REHRDJ/REHRCJ FILES              134902
     C*                                                                   134902
     C***                  MOVE DCCY      REHCCY                    134902149032
     C                     Z-ADD*ZEROS    INRT                            134902
     C                     Z-ADD*ZEROS    INTP                            134902
     C                     Z-ADD*ZEROS    INST                            134902
     C                     Z-ADD*ZEROS    ZINTR                           134902
     C                     Z-ADD*ZEROS    ZLDTM                           134902
      *                                                                                       CER016
      *                                                                                       CER016
     C           WFIRST    IFEQ 'Y'                                                           CER016
     C                     EXSR SAROS                                                         CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
     C*                                                                   134902
     C** DEBIT PROCESSING                                                 134902
     C*                                                                   134902
     C           RHISB     IFGT *ZEROS                     - B1           134902
     C           MNBL      ORGT *ZEROS                                    134902
     C                     EXSR DRINIT                                    134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C                     Z-ADDINRT      ZIRATE                          134902
     C                     Z-ADDINTP      ZICT                            134902
     C                     Z-ADDWDRIC     ZICALC                          134902
     C**********           Z-ADDRHISD     ZIBEG                                        134902 197268
     C                     Z-ADDDHISD     ZIBEG                                               197268
     C                     Z-ADDRUND      ZIEND                           134902
     C           WNPOST    IFEQ 'Y'                                                           197268
     C                     Z-ADDWHISD     ZIBEG                                               197268
     C                     Z-ADDWVALD     ZIEND                                               197268
     C                     END                                                                197268
     C*                                                                   134902
     C           INTP      IFLT 3                          - B1           134902
     C           RHISB     IFGT 0                          - B2           134902
     C**********           Z-ADDRHISB     ZIAMT                                        134902 196958
     C                     Z-ADDBHISB     ZIAMT                                               196958
     C           ZICT      CASEQ0         ZIC00                           134902
     C           ZICT      CASEQ1         ZIC01                           134902
     C           ZICT      CASEQ2         ZIC02                           134902
     C                     END                                            134902
     C                     Z-ADDZINTR     DINT                            134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C                     ELSE                            - X1           134902
     C*                                                                   134902
     C** SEARCHING END-OF-MONTH DATE                                      134902
     C*                                                                   134902
     C                     EXSR DATEIN                                    134902
     C*                                                                   134902
     C           RUND      IFLE ZLDTM                      - B2           134902
     C           MNBL      IFGT 0                          - B3           134902
     C                     Z-ADDMNBL      ZIAMT                           134902
     C           INTP      IFEQ 3                          - B4           134902
     C                     Z-ADD1         ZICT                            134902
     C                     ELSE                            - X4           134902
     C                     Z-ADD2         ZICT                            134902
     C                     END                             - E4           134902
     C           ZICT      CASEQ1         ZIC01                           134902
     C           ZICT      CASEQ2         ZIC02                           134902
     C                     END                                            134902
     C                     Z-ADDZINTR     DINT                            134902
     C                     END                             - E3           134902
     C*                                                                   134902
     C                     ELSE                            - X2           134902
     C*                                                                   134902
     C** IF CHANGE OF MONTH OCCURS WITH METHODS 3 & 4 THEN TWO PROCESSINGS134902
     C** FIRST PROCESSING:                                                134902
     C*                                                                   134902
     C           MNBL      IFGT 0                          - B3           134902
     C                     Z-ADDMNBL      ZIAMT                           134902
     C                     Z-ADDZLDTM     ZIEND                           134902
     C           INTP      IFEQ 3                          - B4           134902
     C                     Z-ADD1         ZICT                            134902
     C                     ELSE                            - X4           134902
     C                     Z-ADD2         ZICT                            134902
     C                     END                             - E4           134902
     C           ZICT      CASEQ1         ZIC01                           134902
     C           ZICT      CASEQ2         ZIC02                           134902
     C                     END                                            134902
     C                     Z-ADDZINTR     DINT                            134902
     C                     END                             - E3           134902
     C*                                                                   134902
     C** SECOND PROCESSING:                                               134902
     C*                                                                   134902
     C           RHISB     IFGT 0                          - B3           134902
     C                     Z-ADDRHISB     ZIAMT                           134902
     C                     Z-ADDZLDTM     ZIBEG                           134902
     C                     Z-ADDRUND      ZIEND                           134902
     C           INTP      IFEQ 3                          - B4           134902
     C                     Z-ADD1         ZICT                            134902
     C                     ELSE                            - X4           134902
     C                     Z-ADD2         ZICT                            134902
     C                     END                             - E4           134902
     C           ZICT      CASEQ1         ZIC01                           134902
     C           ZICT      CASEQ2         ZIC02                           134902
     C                     END                                            134902
     C                     ADD  ZINTR     DINT                            134902
     C                     END                             - E3           134902
     C*                                                                   134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C** CREDIT PROCESSING                                                134902
     C*                                                                   134902
     C                     Z-ADD*ZEROS    INRT                            134902
     C                     Z-ADD*ZEROS    INTP                            134902
     C                     Z-ADD*ZEROS    INST                            134902
     C                     Z-ADD*ZEROS    ZINTR                           134902
     C                     Z-ADD*ZEROS    ZLDTM                           134902
     C*                                                                   134902
     C           RHISB     IFLT *ZEROS                     - B1           134902
     C           MNBL      ORLT *ZEROS                                    134902
     C                     EXSR CRINIT                                    134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C                     Z-ADDINRT      ZIRATE                          134902
     C                     Z-ADDINTP      ZICT                            134902
     C                     Z-ADDWCRIC     ZICALC                          134902
     C**********           Z-ADDRHISD     ZIBEG                                        134902 197268
     C                     Z-ADDDHISD     ZIBEG                                               197268
     C                     Z-ADDRUND      ZIEND                           134902
     C           WNPOST    IFEQ 'Y'                                                           197268
     C                     Z-ADDWHISD     ZIBEG                                               197268
     C                     Z-ADDWVALD     ZIEND                                               197268
     C                     END                                                                197268
     C*                                                                   134902
     C           INTP      IFLT 3                          - B1           134902
     C           RHISB     IFLT 0                          - B2           134902
     C**********           Z-ADDRHISB     ZIAMT                                        134902 196958
     C                     Z-ADDBHISB     ZIAMT                                               196958
     C           ZICT      CASEQ0         ZIC00                           134902
     C           ZICT      CASEQ1         ZIC01                           134902
     C           ZICT      CASEQ2         ZIC02                           134902
     C                     END                                            134902
     C                     Z-ADDZINTR     CINT                            134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C                     ELSE                            - X1           134902
     C*                                                                   134902
     C** SEARCHING END-OF-MONTH DATE                                      134902
     C*                                                                   134902
     C                     EXSR DATEIN                                    134902
     C*                                                                   134902
     C           RUND      IFLE ZLDTM                      - B2           134902
     C           MNBL      IFGT 0                          - B3           134902
     C                     Z-ADDMNBL      ZIAMT                           134902
     C           INTP      IFEQ 3                          - B4           134902
     C                     Z-ADD1         ZICT                            134902
     C                     ELSE                            - X4           134902
     C                     Z-ADD2         ZICT                            134902
     C                     END                             - E4           134902
     C           ZICT      CASEQ1         ZIC01                           134902
     C           ZICT      CASEQ2         ZIC02                           134902
     C                     END                                            134902
     C                     Z-ADDZINTR     CINT                            134902
     C                     END                             - E3           134902
     C*                                                                   134902
     C                     ELSE                            - X2           134902
     C*                                                                   134902
     C** IF CHANGE OF MONTH OCCURS WITH METHODS 3 & 4 THEN TWO PROCESSINGS134902
     C** FIRST PROCESSING:                                                134902
     C*                                                                   134902
     C           MNBL      IFGT 0                          - B3           134902
     C                     Z-ADDMNBL      ZIAMT                           134902
     C                     Z-ADDZLDTM     ZIEND                           134902
     C           INTP      IFEQ 3                          - B4           134902
     C                     Z-ADD1         ZICT                            134902
     C                     ELSE                            - X4           134902
     C                     Z-ADD2         ZICT                            134902
     C                     END                             - E4           134902
     C           ZICT      CASEQ1         ZIC01                           134902
     C           ZICT      CASEQ2         ZIC02                           134902
     C                     END                                            134902
     C                     Z-ADDZINTR     CINT                            134902
     C                     END                             - E3           134902
     C*                                                                   134902
     C** SECOND PROCESSING:                                               134902
     C*                                                                   134902
     C           RHISB     IFGT 0                          - B3           134902
     C                     Z-ADDRHISB     ZIAMT                           134902
     C                     Z-ADDZLDTM     ZIBEG                           134902
     C                     Z-ADDRUND      ZIEND                           134902
     C           INTP      IFEQ 3                          - B4           134902
     C                     Z-ADD1         ZICT                            134902
     C                     ELSE                            - X4           134902
     C                     Z-ADD2         ZICT                            134902
     C                     END                             - E4           134902
     C           ZICT      CASEQ1         ZIC01                           134902
     C           ZICT      CASEQ2         ZIC02                           134902
     C                     END                                            134902
     C                     ADD  ZINTR     CINT                            134902
     C                     END                             - E3           134902
     C*                                                                   134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C                     ENDSR                           **INTCAL ENDSR*134902
     C********************************************************************134902
     C/EJECT                                                              134902
      *****************************************************************                       220323
      *                                                               *                       220323
      *  DBSR - Subroutine to call SRAUD                              *                       220323
      *                                                               *                       220323
      *  Called by: ZICD                                              *                       220323
      *  Calls:     SRAUD                                             *                       220323
      *                                                               *                       220323
      *****************************************************************                       220323
      *                                                                                       220323
     C           DBSR      BEGSR                                                              220323
      *                                                                                       220323
     C                     MOVE '1'       *IN89                                               220323
     C                     EXSR SRAUD                                                         220323
      *                                                                                       220323
     C                     ENDSR                                                              220323
     C*****************************************************************                       220323
     C/EJECT                                                                                  220323
     C/COPY ZSRSRC,ZICDREZ2                                                                   220323
     C********************************************************************134902
     C**********                                                                       134902 220323
     C***ZICD*subroutine*to*find*number*of*days*to*calculate*interest**                134902 220323
     C********according*to*calculation*basis***************************                134902 220323
     C**********                                                                       134902 220323
     C*******Called by       ZIC00, ZIC01, ZIC02                                       134902 220323
     C*******Calls           SRAUD                                                     134902 220323
     C**********                                                                       134902 220323
     C********** ZICD      BEGSR                           **ZICD BEGSR**              134902 220323
     C**********                                                                       134902 220323
     C***TO*DETERMINE*NUMBER*OF*DAYS*INTEREST*TO*BE*CALCULATED*********                134902 220323
     C**********                                                                       134902 220323
     C********** ZIEND     SUB  ZIBEG     ZDAYN2                                       134902 220323
     C**********                                                                       134902 220323
     C***CHECK*FOR*INTEREST*CALCULATION*BASIS**************************                134902 220323
     C**********                                                                       134902 220323
     C********** ZICALC    IFEQ 3                          - B1                        134902 220323
     C********** ZIEND     IFGT ZIBEG                      - B2                        134902 220323
     C**********                                                                       134902 220323
     C***CALCULATING*DATE*FROM*DAY*NUMBER*(BEGINNING*DATE)*************                134902 220323
     C**********                                                                       134902 220323
     C**********           Z-ADDZIBEG     ZDAYNO                                       134902 220323
     C**********           EXSR ZDATE2                                                 134902 220323
     C**********                                                                       134902 220323
     C***VERIFY*IF*ERROR***********************************************                134902 220323
     C**********                                                                       134902 220323
     C********** *IN99     IFEQ '1'                        - B3                        134902 220323
     C********** *LOCK     IN   LDA                                                    134902 220323
     C**********           Z-ADD090       DBASE            ***************             134902 220323
     C**********           MOVE 'ZDATE2'  DBFILE           * DBERROR 090 *             134902 220323
     C**********           MOVE *BLANKS   DBKEY            ***************             134902 220323
     C**********           OUT  LDA                                                    134902 220323
     C**********           MOVEA'1'       *IN,89                                       134902 220323
     C**********           EXSR SRAUD                                                  134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C********** *IN98     IFEQ '0'                        - B3                        134902 220323
     C**********           Z-ADDZDATE     SRES                                         134902 220323
     C**********           ELSE                            - X3                        134902 220323
     C**********           Z-ADDZDATE     SRESX                                        134902 220323
     C**********           Z-ADDZISDX     ZISD                                         134902 220323
     C**********           Z-ADDZISMX     ZISM                                         134902 220323
     C**********           Z-ADDZISYX     ZISY                                         134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C***CALCULATING*DATE*FROM*DAY*NUMBER*(FINISHING*DATE)*************                134902 220323
     C**********                                                                       134902 220323
     C**********           Z-ADDZIEND     ZDAYNO                                       134902 220323
     C**********           EXSR ZDATE2                                                 134902 220323
     C**********                                                                       134902 220323
     C***VERIFY*IF*ERROR***********************************************                134902 220323
     C**********                                                                       134902 220323
     C********** *IN99     IFEQ '1'                        - B3                        134902 220323
     C********** *LOCK     IN   LDA                                                    134902 220323
     C**********           Z-ADD091       DBASE            ***************             134902 220323
     C**********           MOVE 'ZDATE2'  DBFILE           * DBERROR 091 *             134902 220323
     C**********           MOVE *BLANKS   DBKEY            ***************             134902 220323
     C**********           OUT  LDA                                                    134902 220323
     C**********           MOVEA'1'       *IN,89                                       134902 220323
     C**********           EXSR SRAUD                                                  134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C********** *IN98     IFEQ '0'                        - B3                        134902 220323
     C**********           Z-ADDZDATE     FRES                                         134902 220323
     C**********           ELSE                            - X3                        134902 220323
     C**********           Z-ADDZDATE     FRESX                                        134902 220323
     C**********           Z-ADDZIFDX     ZIFD                                         134902 220323
     C**********           Z-ADDZIFMX     ZIFM                                         134902 220323
     C**********           Z-ADDZIFYX     ZIFY                                         134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C***IN*ORDER*FOR*THE*FINISH*YEAR*TO*BE*LESS*THAN*THE*START*YEAR*IF*ZI             134902 220323
     C***IS*GREATER*THAN*ZIBEG,*THEN*THE*DATE*ZIEND*MUST*BE*IN*A*DIFFERENT             134902 220323
     C***CENTURY*TO*ZIBEG.*IF*SO*ADD*100*YEARS*TO*IT.******************                134902 220323
     C**********                                                                       134902 220323
     C********** ZIFY      IFLT ZISY                       - B3                        134902 220323
     C********** ZIFY      ADD  100       ZIFY2                                        134902 220323
     C**********           ELSE                            - X3                        134902 220323
     C**********           Z-ADDZIFY      ZIFY2                                        134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C**********           Z-ADDZISY      ZISY2                                        134902 220323
     C**********                                                                       134902 220323
     C***DETERMINE*WHETHER*START*YEAR*IS*A*LEAP*YEAR*AND*IF*START*MONTH                134902 220323
     C***IS*FEBRUARY**THEN*CONSIDER*LAST*DAY*OF*FEBRUARY*AS*DATE*30ND.*                134902 220323
     C***OF*THE*MONTH**************************************************                134902 220323
     C**********                                                                       134902 220323
     C********** ZISM      IFEQ 2                          - B3                        134902 220323
     C********** ZISY2     ADD  1900      ZLYCHK                                       134902 220323
     C********** ZLYCHK    DIV  4         ZLYCHK                                       134902 220323
     C**********           MVR            ZLYREM                                       134902 220323
     C********** ZLYREM    IFEQ 0                          - B4                        134902 220323
     C********** ZISD      IFEQ 29                         - B5                        134902 220323
     C**********           Z-ADD30        ZISD                                         134902 220323
     C**********           END                             - E5                        134902 220323
     C**********           ELSE                            - X4                        134902 220323
     C********** ZISD      IFEQ 28                         - B5                        134902 220323
     C**********           Z-ADD30        ZISD                                         134902 220323
     C**********           END                             - E5                        134902 220323
     C**********           END                             - E4                        134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C********** 30        SUB  ZISD      ZID1                                         134902 220323
     C**********                                                                       134902 220323
     C********** ZID1      IFLT 0                          - B3                        134902 220323
     C**********           Z-ADD*ZEROS    ZID1                                         134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C********** ZISM      IFEQ 12                         - B3                        134902 220323
     C**********           Z-ADD*ZEROS    ZISM                                         134902 220323
     C**********           ADD  1         ZISY                                         134902 220323
     C**********           ADD  1         ZISY2                                        134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C***DETERMINE*WHETHER*END*YEAR*IS*A*LEAP*YEAR*AND*IF*END*MONTH*IS*FEB             134902 220323
     C**********                                                                       134902 220323
     C********** ZIFM      IFEQ 2                          - B3                        134902 220323
     C********** ZIFY2     ADD  1900      ZLYCHK                                       134902 220323
     C********** ZLYCHK    DIV  4         ZLYCHK                                       134902 220323
     C**********           MVR            ZLYREM                                       134902 220323
     C********** ZLYREM    IFEQ 0                          - B4                        134902 220323
     C********** ZIFD      IFEQ 29                         - B5                        134902 220323
     C**********           Z-ADD30        ZIFD                                         134902 220323
     C**********           END                             - E5                        134902 220323
     C**********           ELSE                            - X4                        134902 220323
     C********** ZIFD      IFEQ 28                         - B5                        134902 220323
     C**********           Z-ADD30        ZIFD                                         134902 220323
     C**********           END                             - E5                        134902 220323
     C**********           END                             - E4                        134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C********** ZIFD      IFEQ 31                         - B3                        134902 220323
     C**********           ADD  30        ZID1                                         134902 220323
     C**********           ELSE                            - X3                        134902 220323
     C**********           ADD  ZIFD      ZID1                                         134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C**********           SUB  1         ZIFM                                         134902 220323
     C**********                                                                       134902 220323
     C********** ZISY      IFEQ ZIFY                       - B3                        134902 220323
     C********** ZIFM      SUB  ZISM      ZINOM                                        134902 220323
     C**********           ELSE                            - X3                        134902 220323
     C********** 12        SUB  ZISM      ZIM1                                         134902 220323
     C**********           Z-ADD1         ZISM                                         134902 220323
     C**********                                                                       134902 220323
     C***USE*ENLARGE*FIELDS*THAT*CAN*HANDLE*1999*ONWARDS***************                134902 220323
     C**********                                                                       134902 220323
     C**********           ADD  1         ZISY2                                        134902 220323
     C********** ZIFY2     SUB  ZISY2     ZIY1                                         134902 220323
     C********** ZIY1      MULT 12        ZIM2                                         134902 220323
     C********** ZIM2      ADD  ZIFM      ZIM2                                         134902 220323
     C********** ZIM2      ADD  ZIM1      ZINOM                                        134902 220323
     C**********                                                                       134902 220323
     C**********           END                             - E3                        134902 220323
     C**********                                                                       134902 220323
     C********** ZINOM     MULT 30        ZID2                                         134902 220323
     C********** ZID2      ADD  ZID1      ZDAYN2                                       134902 220323
     C**********                                                                       134902 220323
     C**********           END                             - E2                        134902 220323
     C**********                                                                       134902 220323
     C**********           END                             - E1                        134902 220323
     C**********                                                                       134902 220323
     C********** ZICALC    IFEQ 4                          - B1                        134902 220323
     C********** ZICALC    OREQ 5                                                      134902 220323
     C**********                                                                       134902 220323
     C***ONE*DAY*IS*SUBTRACTED*FROM*ZDAYN2*FOR*EACH*OCCURANCE*OF*29*FEB*IN             134902 220323
     C***THE*INTEREST*CALCULATION*PERIOD*INCLUSIVE*OF*ZIBEG*AND*ZIEND**                134902 220323
     C**********                                                                       134902 220323
     C***FIND*NO*OF*FOUR*YEAR*PERIODS*BETWEEN*DATES********************                134902 220323
     C**********                                                                       134902 220323
     C********** ZDAYN2    DIV  1461      ZIMAN                                        134902 220323
     C**********           MVR            ZIREM                                        134902 220323
     C**********                                                                       134902 220323
     C***FIND*NEXT*29*FEB*DAY*NO.*ON*OR*AFTER*ZIBEG.*******************                134902 220323
     C**********                                                                       134902 220323
     C********** ZIBEG     SUB  60        ZIBW1                                        134902 220323
     C********** ZIBW1     DIV  1461      ZIDW1                                        134902 220323
     C**********           MVR            ZIDREM                                       134902 220323
     C**********                                                                       134902 220323
     C********** ZIDREM    IFEQ 0                          - B2                        134902 220323
     C**********           Z-ADDZIBEG     ZIDW2                                        134902 220323
     C**********           END                             - E2                        134902 220323
     C**********                                                                       134902 220323
     C***ROUND*UP*RESULT***********************************************                134902 220323
     C**********                                                                       134902 220323
     C********** ZIDW1     ADD  1         ZIDW2                                        134902 220323
     C**********                                                                       134902 220323
     C***CALCULATE*NEXT*29*FEB.****************************************                134902 220323
     C**********                                                                       134902 220323
     C********** ZIDW2     MULT 1461      ZIDW2                                        134902 220323
     C********** ZIDW2     ADD  60        ZIDW2                                        134902 220323
     C**********                                                                       134902 220323
     C***IF*THIS*NEXT*29*FEB.*DAYNO*-*ZIBEG*IS*GREATER*OR*EQUAL*TO*ZIREM               134902 220323
     C***THEN*ADD*1*TO*ZIMAN.******************************************                134902 220323
     C**********                                                                       134902 220323
     C********** ZIDW2     SUB  ZIBEG     ZILPCP                                       134902 220323
     C**********                                                                       134902 220323
     C********** ZIREM     IFGE ZILPCP                     - B2                        134902 220323
     C**********           ADD  1         ZIMAN                                        134902 220323
     C**********           END                             - E2                        134902 220323
     C**********                                                                       134902 220323
     C***SUBTRACT*ZIMAN*FROM*ZDAYN2*TO*GIVE*VALUE*OF*ZDAYN2*REQUIRED*FOR               134902 220323
     C***THIS*INTEREST*CALCULATION*************************************                134902 220323
     C**********                                                                       134902 220323
     C********** ZDAYN2    SUB  ZIMAN     ZDAYN2                                       134902 220323
     C**********                                                                       134902 220323
     C**********           END                             - E1                        134902 220323
     C**********                                                                       134902 220323
     C**********           ENDSR                           **ZICD ENDSR**              134902 220323
     C********************************************************************134902
     C/EJECT                                                              134902
     C********************************************************************134902
     C**                                                                  134902
     C** ZIC00 subroutine to calculate interest (type=00)                 134902
     C**                                                                  134902
     C**     Called by       INTCAL                                       134902
     C**     Calls           ZICD                                         134902
     C**                                                                  134902
     C           ZIC00     BEGSR                           **ZIC00 BEGSR**134902
     C*                                                                   134902
     C** Core hook for externalisation.                                   134902
     C/COPY WNCPYSRC,RE3360CLD1                                           134902
     C*                                                                   134902
     C*                                                                   134902
     C** REVERSE SIGN OF AMOUNT IF IT'S NEGATIVE                          134902
     C*                                                                   134902
     C           ZIAMT     IFLT 0                          - B1           134902
     C                     Z-SUBZIAMT     ZIAMT                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASI134902
     C*                                                                   134902
     C                     EXSR ZICD                                      134902
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIAMT     MULT INT6DY    WWMULT 309H                                         220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIAMT     MULT ZDAYN2    WWMULT                                              220323
     C                     ENDIF                                                              220323
      *                                                                                       220323
      ** Change field length to prevent 0.01 difference                                       220323
      *                                                                                       220323
     C           WWMULT    MULT ZIRATE    WWDIV  309H                                         220323
     C           WWDIV     DIV  100       WWRATE 309H                                         220323
     C*                                                                   134902
     C********** ZIAMT     MULT ZDAYN2    WWMULT 150                                   134902 220323
     C********** WWMULT    DIV  100       WWDIV  150H                                  134902 220323
     C********** WWDIV     MULT ZIRATE    WWRATE 150                                   134902 220323
     C*                                                                   134902
     C           ZICALC    IFEQ 7                          - B1           134902
     C           ZICALC    OREQ 5                                         134902
     C           ZICALC    OREQ 3                                         134902
     C           ZICALC    OREQ 2                                         134902
     C           ZICALC    OREQ 0                                                             CER016
      *                                                                                       CER016
     C           ZICALC    IFEQ 0                                                             CER016
     C           PINTN     ANDEQ'Y'                                                           CER016
     C                     Z-ADDZIAMT     WAMT                                                CER016
     C                     Z-ADDZIRATE    WRATE                                               CER016
     C                     EXSR SRINT0                                                        CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C           WWRATE    DIV  360       ZIWRK1    H                     134902
     C                     END                                                                CER016
      *                                                                                       CER016
     C                     END                             - E1           134902
     C*                                                                   134902
     C           ZICALC    IFEQ 4                          - B1           134902
     C           ZICALC    OREQ 1                                         134902
     C           WWRATE    DIV  365       ZIWRK1    H                     134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           ZICALC    IFEQ 6                          - B1           134902
     C           WWRATE    DIV  366       ZIWRK1    H                     134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           ZICALC    IFNE 0                                                             CER016
     C           PINTN     ORNE 'Y'                                                           CER016
      *                                                                                       CER016
     C***********          Z-ADDZIWRK1    ZINTR                           134902
     C                     Z-ADDZIWRK1    ZINTR     H                     134902
     C                     ENDIF                                                              CER016
     C*                                                                   134902
     C*                                                                   134902
     C** Core hook for externalisation.                                   134902
     C/COPY WNCPYSRC,RE3360CLD2                                           134902
     C*                                                                   134902
     C                     ENDSR                           **ZIC00 ENDSR**134902
     C********************************************************************134902
     C/EJECT                                                              134902
     C********************************************************************134902
     C**                                                                  134902
     C** ZIC01 subroutine to calculate interest (type=01)                 134902
     C**                                                                  134902
     C**     Called by       INTCAL                                       134902
     C**     Calls           ZICD                                         134902
     C**                                                                  134902
     C           ZIC01     BEGSR                           **ZIC01 BEGSR**134902
     C*                                                                   134902
     C** Core hook for externalisation.                                   134902
     C/COPY WNCPYSRC,RE3360CLD3                                           134902
     C*                                                                   134902
     C*                                                                   134902
     C** REVERSE SIGN OF AMOUNT IF IT'S NEGATIVE                          134902
     C*                                                                   134902
     C           ZIAMT     IFLT 0                          - B1           134902
     C                     Z-SUBZIAMT     ZIAMT                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C** INITIALIZE WORK FIELDS                                           134902
     C*                                                                   134902
     C                     Z-ADDZIAMT     ZIAMT1                          134902
     C                     Z-ADD1         Z                               134902
     C                     Z-ADD*ZEROS    ZIAMTR                          134902
     C                     Z-ADD*ZEROS    ZIA                             134902
     C                     Z-ADD*ZEROS    ZIA1                            134902
     C                     Z-ADD*ZEROS    LOOP                            134902
     C                     Z-ADD*ZEROS    Y                               134902
     C                     Z-ADD*ZEROS    ZIN                             134902
     C                     Z-ADD*ZEROS    ZIA2                                                CER016
     C*                                                                   134902
     C** INTEREST IS ONLY CALCULATED ON AN AMOUNT THAT EXCEEDS OR IS EQUAL134902
     C** TO THE INITIAL THRESHOLD BALANCE                                 134902
     C*                                                                   134902
     C           ZIAMT     IFGE ZITHR                      - B1           134902
     C*                                                                   134902
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASI134902
     C*                                                                   134902
     C                     EXSR ZICD                                      134902
     C*                                                                   134902
     C           LOOP      DOWEQ0                          - B2           134902
     C                     Z-ADDZIAMT1    ZIAMTR                          134902
     C*                                                                   134902
     C           Z         IFEQ 11                         - B3           134902
     C                     Z-ADDZIAMTR    ZIA,Z                           134902
     C                     Z-ADD1         LOOP                            134902
     C*                                                                   134902
     C                     ELSE                            - X3           134902
     C                     ADD  1         Y                               134902
     C                     ADD  1         Z                               134902
     C*                                                                   134902
     C           ZIB,Z     IFEQ 0                          - B4           134902
     C                     ADD  ZIAMTR    ZIA,Y                           134902
     C                     Z-ADD1         LOOP                            134902
     C*                                                                   134902
     C                     ELSE                            - X4           134902
     C           ZIB,Z     SUB  ZIB,Y     ZBAL                            134902
     C           ZIAMTR    SUB  ZBAL      ZIAMT1                          134902
     C*                                                                   134902
     C           ZIAMT1    IFLE 0                          - B5           134902
     C                     ADD  ZIAMTR    ZIA,Y                           134902
     C                     Z-ADD1         LOOP                            134902
     C*                                                                   134902
     C                     ELSE                            - X5           134902
     C                     ADD  ZBAL      ZIA,Y                           134902
     C*                                                                   134902
     C                     END                             - E5           134902
     C*                                                                   134902
     C                     END                             - E4           134902
     C*                                                                   134902
     C                     END                             - E3           134902
     C*                                                                   134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C* IF THE SUB-TYPE IS FROM 50000 TO 99999, CALCULATE THE INTEREST    134902
     C* ON THE AMOUNT EXCEEDING THE INITIAL THRESHOLD. OTHERWISE, THE     134902
     C* INTEREST IS CALCULATED ON THE WHOLE BALANCE WHENEVER IT EXCEEDS   134902
     C* THE INITIAL THRESHOLD.                                            134902
     C*                                                                   134902
     C           INST      IFGE 50000                      - B2           134902
     C                     Z-ADD1         Z                               134902
     C           Z         DOWLT12                         - B3           134902
     C           ZITHR     ANDGT0                                         134902
     C           ZIA,Z     SUB  ZITHR     ZIA,Z                           134902
     C           ZIA,Z     IFLT 0                          - B4           134902
     C                     Z-SUBZIA,Z     ZITHR                           134902
     C                     Z-ADD0         ZIA,Z                           134902
     C                     ELSE                            - X4           134902
     C                     Z-ADD0         ZITHR                           134902
     C                     END                             - E4           134902
     C                     ADD  1         Z                               134902
     C                     END                             - E3           134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C                     MOVEAZIA       ZIA2                                                CER016
      *                                                                                       CER016
     C********** ZIA       MULT ZDAYN2    ZIA                                          134902 220323
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIA       MULT INT6DY    ZIA1                                                220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIA       MULT ZDAYN2    ZIA1                                                220323
     C                     ENDIF                                                              220323
      *                                                                                       220323
     C********** ZIA       DIV  100       ZIA                                          134902 220323
     C********** ZIA       MULT ZIR       ZIA                                          134902 220323
     C           ZIA1      MULT ZIR       ZIA1                                                220323
     C           ZIA1      DIV  100       ZIA1                                                220323
     C*                                                                   134902
     C           ZICALC    IFEQ 7                          - B2           134902
     C           ZICALC    OREQ 5                                         134902
     C           ZICALC    OREQ 3                                         134902
     C           ZICALC    OREQ 2                                         134902
     C           ZICALC    OREQ 0                                                             CER016
      *                                                                                       CER016
     C           ZICALC    IFEQ 0                                                             CER016
     C           PINTN     ANDEQ'Y'                                                           CER016
     C                     Z-ADD1         C       20                                          CER016
      *                                                                                       CER016
     C           C         DOWLT12                                                            CER016
     C                     Z-ADDZIA2,C    WAMT                                                CER016
     C                     Z-ADDZIR,C     WRATE                                               CER016
     C                     EXSR SRINT0                                                        CER016
     C                     Z-ADDZINTR     ZIN1,C                                              CER016
     C                     ADD  1         C                                                   CER016
     C                     ENDDO                                                              CER016
      *                                                                                       CER016
     C                     XFOOTZIN1      ZINTR1    H                                         CER016
     C                     Z-ADDZINTR1    ZINTR     H                                         CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C***********ZIA       DIV  360       ZIN       H                     134902
     C********** ZIA       DIV  360       ZIN1      H                                  134902 220323
     C           ZIA1      DIV  360       ZIN1      H                                         220323
     C                     END                                                                CER016
     C*                                                                   134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C           ZICALC    IFEQ 4                          - B2           134902
     C           ZICALC    OREQ 1                                         134902
     C***********ZIA       DIV  365       ZIN       H                     134902
     C********** ZIA       DIV  365       ZIN1      H                     134902       134902 220323
     C           ZIA1      DIV  365       ZIN1      H                                         220323
     C*                                                                   134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C           ZICALC    IFEQ 6                          - B2           134902
     C***********ZIA       DIV  366       ZIN       H                     134902
     C********** ZIA       DIV  366       ZIN1      H                     134902       134902 220323
     C           ZIA1      DIV  366       ZIN1      H                                         220323
     C*                                                                   134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C           ZICALC    IFNE 0                                                             CER016
     C           PINTN     ORNE 'Y'                                                           CER016
     C***********          XFOOTZIN       ZINTR                           134902
     C                     XFOOTZIN1      ZINTR1 185H                     134902
     C                     Z-ADDZINTR1    ZINTR     H                     134902
     C*                                                                   134902
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C                     END                             - E1           134902
     C*                                                                   134902
     C*                                                                   134902
     C** Core hook for externalisation.                                   134902
     C/COPY WNCPYSRC,RE3360CLD4                                           134902
     C*                                                                   134902
     C                     ENDSR                           **ZIC01 ENDSR**134902
     C********************************************************************134902
     C/EJECT                                                              134902
     C********************************************************************134902
     C**                                                                  134902
     C** ZIC02 subroutine to calculate interest (type=02)                 134902
     C**                                                                  134902
     C**     Called by       INTCAL                                       134902
     C**     Calls           ZICD                                         134902
     C**                                                                  134902
     C           ZIC02     BEGSR                           **ZIC02 BEGSR**134902
     C*                                                                   134902
     C** Core hook for externalisation.                                   134902
     C/COPY WNCPYSRC,RE3360CLD5                                           134902
     C*                                                                   134902
     C*                                                                   134902
     C** FILL THE END OF THE TABLE WITH HIGHVAL                           134902
     C*                                                                   134902
     C                     Z-ADD2         Z                               134902
     C           Z         DOWLE11                                        134902
     C           ZIB,Z     IFEQ *ZEROS                                    134902
     C                     Z-ADD*HIVAL    ZIB,Z                           134902
     C                     END                                            134902
     C                     ADD  1         Z                               134902
     C                     END                                            134902
     C*                                                                   134902
     C** REVERSE SIGN OF AMOUNT IF IT'S NEGATIVE                          134902
     C*                                                                   134902
     C           ZIAMT     IFLT 0                          - B1           134902
     C                     Z-SUBZIAMT     ZIAMT                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C** INTEREST IS ONLY CALCULATED ON AN AMOUNT THAT EXCEEDS OR IS EQUAL134902
     C** TO THE INITIAL THRESHOLD BALACE                                  134902
     C*                                                                   134902
     C           ZIAMT     IFGE ZITHR                      - B1           134902
     C*                                                                   134902
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASI134902
     C*                                                                   134902
     C                     EXSR ZICD                                      134902
     C*                                                                   134902
     C                     Z-ADD1         Z                               134902
     C*                                                                   134902
     C           ZIAMT     LOKUPZIB,Z                  40                 134902
     C*                                                                   134902
     C* IF THE SUB-TYPE IS FROM 50000 TO 99999, CALCULATE THE INTEREST    134902
     C* ON THE AMOUNT EXCEEDING THE INITIAL THRESHOLD. OTHERWISE, THE     134902
     C* INTEREST IS CALCULATED ON THE WHOLE BALANCE WHENEVER IT EXCEEDS   134902
     C* THE INITIAL THRESHOLD.                                            134902
     C*                                                                   134902
     C           INST      IFGE 50000                      - B2           134902
     C           ZIAMT     SUB  ZITHR     ZIAMT                           134902
     C                     END                             - E2           134902
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIAMT     MULT INT6DY    WWMUL3 309                                          220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIAMT     MULT ZDAYN2    WWMUL3                                              220323
     C                     ENDIF                                                              220323
      *                                                                                       220323
      ** Change field length to prevent 0.01 difference                                       220323
      *                                                                                       220323
     C           WWMUL3    MULT ZIR,Z     WWDIV3 309                                          220323
     C           WWDIV3    DIV  100       WWZIR  309                                          220323
     C*                                                                   134902
     C********** ZIAMT     MULT ZDAYN2    WWMUL3 150                                   134902 220323
     C********** WWMUL3    DIV  100       WWDIV3 150H                                  134902 220323
     C********** WWDIV3    MULT ZIR,Z     WWZIR  150                                   134902 220323
     C*                                                                   134902
     C           ZICALC    IFEQ 7                          - B2           134902
     C           ZICALC    OREQ 5                                         134902
     C           ZICALC    OREQ 3                                         134902
     C           ZICALC    OREQ 2                                         134902
     C           ZICALC    OREQ 0                                                             CER016
      *                                                                                       CER016
     C           ZICALC    IFEQ 0                                                             CER016
     C           PINTN     ANDEQ'Y'                                                           CER016
     C                     Z-ADDZIAMT     WAMT                                                CER016
     C                     Z-ADDZIR,Z     WRATE                                               CER016
     C                     EXSR SRINT0                                                        CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C           WWZIR     DIV  360       ZIWRK1    H                     134902
     C                     END                                                                CER016
     C*                                                                   134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C           ZICALC    IFEQ 4                          - B2           134902
     C           ZICALC    OREQ 1                                         134902
     C           WWZIR     DIV  365       ZIWRK1    H                     134902
     C*                                                                   134902
     C                     END                             - E2           134902
     C*                                                                   134902
     C           ZICALC    IFEQ 6                          - B2           134902
     C           WWZIR     DIV  366       ZIWRK1    H                     134902
     C*                                                                   134902
     C                     END                             - E2           134902
      *                                                                                       CER016
     C           ZICALC    IFNE 0                                                             CER016
     C           PINTN     ORNE 'Y'                                                           CER016
     C*                                                                   134902
     C***********          ADD  ZIWRK1    ZINTR                           134902
     C                     ADD  ZIWRK1    ZINTR     H                     134902
     C                     ENDIF                                                              CER016
     C*                                                                   134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C*                                                                   134902
     C** Core hook for externalisation.                                   134902
     C/COPY WNCPYSRC,RE3360CLD6                                           134902
     C*                                                                   134902
     C                     ENDSR                           **ZIC02 ENDSR**134902
     C********************************************************************134902
     C/EJECT                                                              134902
     C********************************************************************134902
     C**                                                                  134902
     C** DRINIT subroutine for debit rates loading                        134902
     C**                                                                  134902
     C**     Called by       INTCAL                                       134902
     C**     Calls           SRAUD                                        134902
     C**                                                                  134902
     C           DRINIT    BEGSR                           **DRINIT BEGSR*134902
     C*                                                                   134902
     C                     Z-ADD*ZEROS    ZIRD                            134902
     C                     Z-ADD*ZEROS    ZIBD                            134902
     C                     Z-ADD*ZERO     ZITHR                           134902
     C                     Z-ADD*ZEROS    INTHD                           134902
     C*                                                                   134902
     C** CHAIN TO DEBIT RATE CHANGES FILE                                 134902
     C*                                                                   134902
     C                     Z-ADDWDRCD     KDATE                           134902
     C*                                                                   134902
     C           DCKEY     CHAINREHRDJ               99                   134902
     C*                                                                   134902
     C** ERROR IN REHRDJ                                                  134902
     C*                                                                   134902
     C           *IN99     IFEQ '1'                        - B1           134902
     C           WDRIB     ANDEQ*ZEROS                                    134902
     C           WDRIS     ANDEQ*ZEROS                                    134902
     C           WOLDR     ORNE *ZEROS                                    134902
     C                     MOVE '0'       *IN99                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           *IN99     IFEQ '1'                        - B1           134902
     C           *LOCK     IN   LDA                                       134902
     C                     CLEARDBFILE                                    149032
     C                     Z-ADD092       DBASE            ***************134902
     C                     MOVE 'REHRDJ'  DBFILE           * DBERROR 092 *134902
     C                     Z-ADDKDATE     REHDAT           ***************134902
     C                     MOVE *BLANKS   DBKEY                           134902
     C                     MOVELREHKEY    DBKEY                           134902
     C                     OUT  LDA                                       134902
     C                     MOVEA'1'       *IN,89                          134902
     C***                  EXSR SRAUD                               134902149032
     C                     EXSR *PSSR                                     149032
     C                     END                             - E1           134902
     C*                                                                   134902
     C** PICK-UP DEBIT THRESHOLD BALANCE                                  134902
     C*                                                                   134902
     C                     Z-ADDINTHD     ZITHR                           134902
     C*                                                                   134902
     C** SETUP WORK DEBIT FIELDS WITH FIELDS READ                         134902
     C*                                                                   134902
     C           RAT2      IFNE *BLANKS                    - B1           134902
     C                     MOVELRAT2      WDRAT                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           RAT3      IFNE *BLANKS                    - B1           134902
     C                     MOVE RAT3      WDRAT                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           BAL2      IFNE *BLANKS                    - B1           134902
     C                     MOVELBAL2      WDBAL                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           BAL3      IFNE *BLANKS                    - B1           134902
     C                     MOVE BAL3      WDBAL                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C** LOADING OF DEBIT INTEREST RATES AND DEBIT INTEREST BALANCES      134902
     C*                                                                   134902
     C                     Z-ADDZIRD      ZIR                             134902
     C                     Z-ADDZIBD      ZIB                             134902
     C*                                                                   134902
     C                     ENDSR                           **DRINIT ENDSR*134902
     C********************************************************************134902
     C/EJECT                                                              134902
     C********************************************************************134902
     C**                                                                  134902
     C** CRINIT subroutine for credit rates loading                       134902
     C**                                                                  134902
     C**     Called by       INTCAL                                       134902
     C**     Calls           SRAUD                                        134902
     C**                                                                  134902
     C           CRINIT    BEGSR                           **CRINIT BEGSR*134902
     C*                                                                   134902
     C                     Z-ADD*ZEROS    ZIRC                            134902
     C                     Z-ADD*ZEROS    ZIBC                            134902
     C                     Z-ADD*ZERO     ZITHR                           134902
     C                     Z-ADD*ZEROS    INTHC                           134902
     C*                                                                   134902
     C** CHAIN TO CREDIT RATE CHANGES FILE                                134902
     C*                                                                   134902
     C                     Z-ADDWCRCD     KDATE                           134902
     C*                                                                   134902
     C           DCKEY     CHAINREHRCJ               99                   134902
     C*                                                                   134902
     C** ERROR IN REHRCJ                                                  134902
     C*                                                                   134902
     C           *IN99     IFEQ '1'                        - B1           134902
     C           WCRIB     ANDEQ*ZEROS                                    134902
     C           WCRIS     ANDEQ*ZEROS                                    134902
     C           WOLCR     ORNE *ZEROS                                    134902
     C                     MOVE '0'       *IN99                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           *IN99     IFEQ '1'                        - B1           134902
     C           *LOCK     IN   LDA                                       134902
     C                     CLEARDBFILE                                    149032
     C                     Z-ADD093       DBASE            ***************134902
     C                     MOVE 'REHRCJ'  DBFILE           * DBERROR 093 *134902
     C                     Z-ADDKDATE     REHDAT           ***************134902
     C                     MOVE *BLANKS   DBKEY                           134902
     C                     MOVELREHKEY    DBKEY                           134902
     C                     OUT  LDA                                       134902
     C                     MOVEA'1'       *IN,89                          134902
     C***                  EXSR SRAUD                               134902149032
     C                     EXSR *PSSR                                     149032
     C                     END                             - E1           134902
     C*                                                                   134902
     C** PICK-UP CREDIT THRESHOLD BALANCE                                 134902
     C*                                                                   134902
     C                     Z-ADDINTHC     ZITHR                           134902
     C*                                                                   134902
     C** SETUP WORK CREDIT FIELDS WITH FIELDS READ PROCESSING             134902
     C*                                                                   134902
     C           RAT2      IFNE *BLANKS                    - B1           134902
     C                     MOVELRAT2      WCRAT                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           RAT3      IFNE *BLANKS                    - B1           134902
     C                     MOVE RAT3      WCRAT                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           BAL2      IFNE *BLANKS                    - B1           134902
     C                     MOVELBAL2      WCBAL                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           BAL3      IFNE *BLANKS                    - B1           134902
     C                     MOVE BAL3      WCBAL                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C** LOADING OF CREDIT INTEREST RATES AND CREDIT INTEREST BALANCES    134902
     C*                                                                   134902
     C                     Z-ADDZIRC      ZIR                             134902
     C                     Z-ADDZIBC      ZIB                             134902
     C*                                                                   134902
     C                     ENDSR                           **CRINIT ENDSR*134902
     C*                                                                   134902
     C********************************************************************134902
     C/EJECT                                                              134902
     C********************************************************************134902
     C**                                                                  134902
     C** DATEIN subroutine for date init processing                       134902
     C**                                                                  134902
     C**     Called by       INTCAL                                       134902
     C**     Calls           SRAUD                                        134902
     C**                                                                  134902
     C           DATEIN    BEGSR                           **DATEIN BEGSR*134902
     C*                                                                   134902
     C** WORK FIELD INIT                                                  134902
     C*                                                                   134902
     C                     Z-ADD*ZEROS    ZLDTM                           134902
     C*                                                                   134902
     C***CALCULATING*DATE*FROM*DAY*NUMBER*(REACR*HISTORY*DATE)*                        134902 197268
     C** Calculating date from history day number (REHISL history date)                       197268
     C*                                                                   134902
     C**********           Z-ADDRHISD     ZDAYNO                                       134902 197268
     C                     Z-ADDDHISD     ZDAYNO                                              197268
     C                     EXSR ZDATE2                                    134902
     C*                                                                   134902
     C** VERIFY IF ERROR                                                  134902
     C*                                                                   134902
     C           *IN99     IFEQ '1'                        - B1           134902
     C           *LOCK     IN   LDA                        - B1           134902
     C                     Z-ADD094       DBASE            ***************134902
     C                     MOVE 'ZDATE2'  DBFILE           **DB ERROR 94**134902
     C                     MOVE ZERROR    ERRDAT           ***************134902
     C                     MOVE *BLANKS   DBKEY                           134902
     C                     MOVELERRDAT    DBKEY                           134902
     C           *LOCK     IN   LDA                        - B1           134902
     C                     MOVEA'1'       *IN,89                          134902
     C                     EXSR SRAUD                                     134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C** CALCULATING FIRST DAY OF THIS MONTH TO CALCULATE THE LAST ONE    134902
     C*                                                                   134902
     C           *IN98     IFEQ '0'                        - B1           134902
     C                     Z-ADDZDATE     RESULT                          134902
     C                     Z-ADD1         ZDAY                            134902
     C                     Z-ADDRESULT    ZDATE                           134902
     C                     ELSE                            - X1           134902
     C                     Z-ADDZDATE     RESULX                          134902
     C                     Z-ADD1         ZDAYX                           134902
     C                     Z-ADDRESULX    ZDATE                           134902
     C                     END                             - E1           134902
     C                     EXSR ZDATE1                                    134902
     C*                                                                   134902
     C** VERIFY IF ERROR                                                  134902
     C*                                                                   134902
     C           *IN99     IFEQ '1'                        - B1           134902
     C           *LOCK     IN   LDA                                       134902
     C                     Z-ADD095       DBASE            ***************134902
     C                     MOVE 'ZDATE1'  DBFILE           * DBERROR 095 *134902
     C                     MOVE ZERROR    ERRDAT           ***************134902
     C                     MOVE *BLANKS   DBKEY                           134902
     C                     MOVELERRDAT    DBKEY                           134902
     C                     OUT  LDA                                       134902
     C                     MOVEA'1'       *IN,89                          134902
     C                     EXSR SRAUD                                     134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           *IN98     IFEQ '0'                        - B0           134902
     C           ZMTH      IFEQ 12                         - B1           134902
     C                     Z-ADD1         ZMTH                            134902
     C                     ADD  1         ZYEAR                           134902
     C                     ELSE                            - X1           134902
     C                     ADD  1         ZMTH                            134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C                     Z-ADDRESULT    ZDATE                           134902
     C                     ELSE                            - X0           134902
     C           ZMTHX     IFEQ 12                         - B1           134902
     C                     Z-ADD1         ZMTHX                           134902
     C                     ADD  1         ZYEARX                          134902
     C                     ELSE                            - X1           134902
     C                     ADD  1         ZMTHX                           134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C                     Z-ADDRESULX    ZDATE                           134902
     C                     END                             - E0           134902
     C                     EXSR ZDATE1                                    134902
     C*                                                                   134902
     C** VERIFY IF ERROR                                                  134902
     C*                                                                   134902
     C           *IN99     IFEQ '1'                        - B1           134902
     C           *LOCK     IN   LDA                                       134902
     C                     Z-ADD096       DBASE            ***************134902
     C                     MOVE 'ZDATE1'  DBFILE           * DBERROR 096**134902
     C                     MOVE ZERROR    ERRDAT           ***************134902
     C                     MOVE *BLANKS   DBKEY                           134902
     C                     MOVELERRDAT    DBKEY                           134902
     C                     OUT  LDA                                       134902
     C                     MOVEA'1'       *IN,89                          134902
     C                     EXSR SRAUD                                     134902
     C                     END                             - E1           134902
     C*                                                                   134902
     C           ZDAYNO    SUB  1         ZLDTM                           134902
     C*                                                                   134902
     C                     ENDSR                           **DATEIN ENDSR*134902
     C********************************************************************134902
     C/EJECT                                                              134902
      *****************************************************************   134902
      * End of changes added for 134902                                   134902
      *****************************************************************   134902
      *****************************************************************   134902
      /EJECT
      *****************************************************************
      *                                                               *
      *  RCFP1  - Subroutine to register the P1 Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFP1     BEGSR                            *** RCFP1  ***
      *
      ***  Ensure Report Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
      *
     C                     CALL 'ZSFILE'
     C                     PARM *BLANKS   SEQ     5
     C                     PARM WTRBR     SENTY   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM *BLANKS   ZSERR   1
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  RCFP2  - Subroutine to register the P1 Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFP2     BEGSR                            *** RCFP2  ***
      *
      ***  Ensure Report Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUM2    ZSNUM   60
      *
     C                     CALL 'ZSFILE'
     C                     PARM *BLANKS   SEQ     5
     C                     PARM WTRBR     SENTY   3
     C                     PARM           SFILE2
     C                     PARM           ZSNUM
     C                     PARM *BLANKS   ZSERR   1
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  RCFAU  - Subroutine to register the AU Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFAU     BEGSR                            *** RCFAU  ***
      *
      ***  Ensure Audit Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUMU    ZSNUMU  60
      *
     C                     CALL 'ZSFILE'
     C                     PARM *BLANKS   SEQ     5
     C                     PARM *BLANKS   SENTY   3
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM *BLANKS   ZSERR   1
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRAUD  - Subroutine to Output Audit report and End Program.  *
      *                                                               *
      *  Called By: Program Exception Error Routine and               *
      *             Termination Processing                            *
      *  Calls:                                                       *
      *     (none)                                                    *
      *                                                               *
      *****************************************************************
      *
     C           SRAUD     BEGSR                           *** SRAUD  ***
      *
      ** Open Audit Printer File
     C           OPENAU    IFNE 'Y'
      *
      ** If no records read, Output "No Details" message.
     C           WTOTAL    IFEQ 0
     C           *INU7     OREQ *ON
     C                     OPEN RE0732AU
     C                     MOVE 'Y'       OPENAU  1
      *
      ** RCF Processing for Audit File.
     C                     EXSR RCFAU
      *
      ** Output Report Header
     C                     WRITEHEADAU
      *
     C           WTOTAL    IFEQ 0
     C           *INU7     ANDEQ*OFF
      *
      ** Output File Control.
     C                     WRITENODTLS
     C                     ENDIF
      *
      ** If there is a DB Error, Output the DB Error Information.
      *
     C           *INU7     IFEQ *ON
     C                     WRITEDBERROR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** End Program and Return.
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
     C/COPY WNCPYSRC,RE0732C011
      *
      *****************************************************************
      *                                                               *
      * GETAC  - Subroutine to get correct details for account        *   153249
      *          using the account code.                              *   153249
      *                                                               *   153249
      *                                                               *   153249
      * Called by: SRW06, SRW08 and SRW09                             *   153249
      *                                                               *   153249
      * Calls:     AOACODR0                                           *   153249
      *                                                               *   153249
      *****************************************************************   153249
     C           GETAC     BEGSR                           *** GETAC ***  153249
     C                     CALL 'AOACODR0'                                153249
     C                     PARM '*BLANK ' @RTCD   7                       153249
     C                     PARM '*KEY   ' @OPTN   7                       153249
     C**********           PARM @ACD      @ACCD   4                                    153249 CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                        153249 CGL029
     C                     PARM @ACD      @ACCD  10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      ** If record not found                                              153249
     C           @RTCD     IFNE *BLANK                                    153249
     C           *LOCK     IN   LDA                                       153249
     C                     MOVEL'SDACODPD'DBFILE           ************   153249
     C                     MOVE 040       DBASE            * DBERR 40 *   153249
     C                     MOVE @ACD      DBKEY            ************   153249
     C                     OUT  LDA                                       153249
     C                     EXSR *PSSR                                     153249
     C                     ENDIF                                          153249
      ** Move account section to field on file                            153249
     C                     MOVELA5ACSC    ACSC    2                       153249
     C                     ENDSR                                          153249
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      * Called by: (**calling routines**)                             *
      *                                                               *
      * Calls: None                                                   *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     EXSR SRAUD
     C                     END
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************                       197268
      /EJECT                                                                                  197268
      *****************************************************************                       197268
      *                                                               *                       197268
      *  REHSR subroutine for REHISL file exception/error handling    *                       197268
      *                                                               *                       197268
      *      Called by       Input specifications                     *                       197268
      *      Calls           DBSR                                     *                       197268
      *                                                               *                       197268
      *****************************************************************                       197268
     C           REHSR     BEGSR                           **REHSR BEGSR*                     197268
      *                                                                                       197268
     C           *LOCK     IN   LDA                                                           197268
     C                     MOVE 'REHISL'  DBFILE           **************                     197268
     C                     Z-ADD18        DBASE            * DBASE  018 *                     197268
     C                     MOVEL'     '   DBKEY            * STATUS ERR *                     197268
     C                     MOVELSTSREH    DBSTAT  5        **************                     197268
     C                     OUT  LDA                                                           197268
     C                     MOVEA'1'       *IN,88                                              197268
     C                     EXSR *PSSR                                                         197268
      *                                                                                       197268
     C                     ENDSR                           **REHSR ENDSR*                     197268
      *                                                                   181363
      ** Check charge is within Max and Min charges.                      181363
      *                                                                   181363
     C           FNDCRG    BEGSR                                          181363
      *                                                                   181363
     C                     Z-ADD0         WCHRG  130                      181363
     C           NRCA      ADD  RCA       WCHRG                           181363
     C                     MOVE CCY       WCCYA                           181363
     C                     MOVE 'D'       DEE                             181363
      *                                                                   181363
      ** Chain to charges file - RECRG.                                   181363
      *                                                                   181363
     C           RECHRK    CHAINRECRG                96                   181363
      *                                                                   181363
      ** Error in RECRGDF.                                                181363
      *                                                                   181363
     C           *IN96     IFEQ '1'                                       181363
     C           RECI      ORNE 'D'                                       181363
     C           *LOCK     IN   LDA                                       181363
     C                     CLEARDBFILE                                    181363
     C                     CLEARDBKEY                                     181363
     C                     Z-ADD30        DBASE            *************  181363
     C                     MOVE 'RECRG'   DBFILE           * DBERR 030 *  181363
     C                     MOVELRECHRK    DBKEY            *************  181363
     C                     OUT  LDA                                       181363
     C                     EXSR *PSSR                                     181363
     C                     ENDIF                                          181363
      *                                                                   181363
     C           MAXC      IFNE 0                                         181363
     C           WCHRG     IFGT MAXC                                      181363
     C                     Z-ADDMAXC      WCHRG                           181363
     C                     ENDIF                                          181363
     C                     ENDIF                                          181363
      *                                                                   181363
     C           MINC      IFNE 0                                         181363
     C           WCHRG     IFLT MINC                                      181363
     C                     Z-ADDMINC      WCHRG                           181363
     C                     ENDIF                                          181363
     C                     ENDIF                                          181363
      *                                                                   181363
     C           WCHRG     ADD  TOT3      TOT3                            181363
      *                                                                   181363
     C                     ENDSR                                          181363
      *                                                                   181363
      ** Check charge is within Max and Min charges.                      181363
      *                                                                   181363
     C           FNDTAB    BEGSR                                          181363
      *                                                                   181363
     C**********           Z-ADDCNUM      WCNUMN                                       181363 CSD027
     C                     MOVE CNUM      WCNUMN                                              CSD027
      *                                                                   181363
      ** Get customer details (SDCUSTPD).                                 181363
      *                                                                   181363
     C                     CALL 'AOCUSTR0'                                181363
     C                     PARM '*MSG   ' @RTCD   7                       181363
     C                     PARM '*KEY   ' @OPTN   7                       181363
     C                     PARM WCNUMA    @CNUM  10                       181363
     C                     PARM           @KYST   7                       181363
     C           SDCUST    PARM SDCUST    DSSDY                           181363
      *                                                                   181363
     C           @RTCD     IFNE *BLANKS                                   181363
     C           *LOCK     IN   LDA                                       181363
     C                     CLEARDBFILE                                    181363
     C                     CLEARDBKEY                                     181363
     C                     Z-ADD31        DBASE            *************  181363
     C                     MOVE 'SDCUSTPD'DBFILE           * DBERR 031 *  181363
     C                     MOVELCNUM      DBKEY            *************  181363
     C                     OUT  LDA                                       181363
     C                     EXSR *PSSR                                     181363
     C                     ENDIF                                          181363
      *                                                                   181363
      ** Check if it is a valid group (in TABLEV4).                       181363
      *                                                                   181363
     C           @WCGRP    IFEQ *BLANK                                    181363
     C                     MOVEL'1'       @WCGRP                          181363
     C                     ENDIF                                          181363
      *                                                                   181363
     C                     MOVE '0'       *IN09                           181363
     C           1         SETLLTABLEV4                                   181363
     C                     READ TABLEV4                  95               181363
      *                                                                   181363
     C           *IN95     DOWEQ'0'                                       181363
     C           RECI      IFEQ 'D'                                       181363
      *                                                                   181363
     C           @WCGRP    IFEQ CGRP                                      181363
     C                     MOVE '1'       *IN09                           181363
     C                     LEAVE                                          181363
     C                     ENDIF                                          181363
      *                                                                   181363
     C                     READ TABLEV4                  95               181363
      *                                                                   181363
     C                     ENDIF                                          181363
     C                     ENDDO                                          181363
      *                                                                   181363
      ** Check if error.                                                  181363
      *                                                                   181363
     C           *IN09     IFEQ '0'                                       181363
     C           *LOCK     IN   LDA                                       181363
     C                     CLEARDBFILE                                    181363
     C                     CLEARDBKEY                                     181363
     C                     Z-ADD032       DBASE            *************  181363
     C                     MOVEL'TABLEV4' DBFILE           * DBERR 032 *  181363
     C                     MOVEL*BLANKS   DBKEY            *************  181363
     C                     MOVEL@WCGRP    DBKEY                           181363
     C                     OUT  LDA                                       181363
     C                     EXSR *PSSR                                     181363
     C                     ENDIF                                          181363
      *                                                                   181363
     C                     MOVE *BLANKS   KBLK8                           181363
     C                     MOVE 'D'       KRECI                           181363
     C                     MOVE CCY       KSCCY                           181363
      *                                                                   181363
     C           RECKEY    CHAINRECCY                61                   181363
      *                                                                   181363
     C           *IN61     IFEQ '1'                                       181363
     C           *LOCK     IN   LDA                                       181363
     C                     CLEARDBFILE                                    181363
     C                     CLEARDBKEY                                     181363
     C                     Z-ADD033       DBASE            *************  181363
     C                     MOVE 'RECCY'   DBFILE           * DBERR 033 *  181363
     C                     MOVELCKEY      DBKEY            *************  181363
     C                     OUT  LDA                                       181363
     C                     EXSR *PSSR                                     181363
     C                     ENDIF                                          181363
      *                                                                   181363
     C                     ENDSR                                          181363
      *
      *****************************************************************                       CER016
      /EJECT                                                                                  CER016
      *****************************************************************                       CER016
      *                                                               *                       CER016
      *  SRINT0 - Calculate Interest for Retail Type Account          *                       CER016
      *                                                               *                       CER016
      *  Called By: ZIC00, ZIC01, ZIC02                               *                       CER016
      *                                                               *                       CER016
      *  Calls: None                                                  *                       CER016
      *                                                               *                       CER016
      *****************************************************************                       CER016
      *                                                                                       CER016
     C           SRINT0    BEGSR                                                              CER016
      *                                                                                       CER016
     C                     CALL 'AOCURRR0'                                                    CER016
     C                     PARM *BLANKS   WRTCD                                               CER016
     C                     PARM '*KEY    'WOPTN                                               CER016
     C                     PARM           CCY                                                 CER016
     C           SDCURR    PARM SDCURR    DSSDY                                               CER016
      *                                                                                       CER016
      **  Handle Database Error.                                                              CER016
      *                                                                                       CER016
     C           WRTCD     IFNE *BLANKS                                                       CER016
     C           *LOCK     IN   LDA                                                           CER016
     C                     SETON                     U7U8LR                                   CER016
     C                     MOVELCCY       DBKEY                                               CER016
     C                     MOVEL'SDCURRPD'DBFILE                                              CER016
     C                     Z-ADD098       DBASE                                               CER016
     C                     OUT  LDA                                                           CER016
     C                     EXSR *PSSR                                                         CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C                     MOVE A6NBDP    WNDP    10                                          CER016
     C                     Z-ADD1         WNDTMP 150                                          CER016
      *                                                                                       CER016
     C           WNDP      IFEQ 0                                                             CER016
      *                                                                                       CER016
     C                     Z-ADD1         WNDTMP                                              CER016
     C                     ELSE                                                               CER016
      *                                                                                       CER016
     C                     DO   WNDP                                                          CER016
     C           10        MULT WNDTMP    WNDTMP                                              CER016
     C                     ENDDO                                                              CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C           WAMT      MULT ZDAYN2    WINAMT                                              CER016
     C           WINAMT    DIV  100       WNAMT1    H                                         CER016
     C           WNAMT1    DIV  WNDTMP    WNAMT2    H                                         CER016
     C           WNAMT2    MULT WNDTMP    WRKFLD 150                                          CER016
     C           WRKFLD    MULT WRATE     ZINT1  150                                          CER016
     C           ZINT1     DIV  360       ZINT2  150H                                         CER016
     C                     Z-ADDZINT2     ZINTR                                               CER016
      *                                                                                       CER016
     C                     ENDSR                                                              CER016
      *                                                                                       CER016
      *****************************************************************                       CER016
      /EJECT                                                                                  CER016
      *****************************************************************                       CER016
      *                                                               *                       CER016
      *  SRAOS - To call AOSVALR0 for New system value InterestNumber *                       CER016
      *                                                               *                       CER016
      *  Called By: INTCAL                                            *                       CER016
      *                                                               *                       CER016
      *  Calls: None                                                  *                       CER016
      *                                                               *                       CER016
      *****************************************************************                       CER016
      *                                                                                       CER016
     C           SAROS     BEGSR                                                              CER016
      *                                                                                       CER016
     C                     MOVEL'N'       WFIRST                                              CER016
      *                                                                                       CER016
     C                     CALL 'AOSVALR0'                                                    CER016
     C                     PARM *BLANKS   PRTCD   7                                           CER016
     C                     PARM PSYSVL    PSVLK1 20                                           CER016
     C                     PARM           PSVL1 200                                           CER016
     C                     PARM *BLANKS   PSVLK2 20                                           CER016
     C                     PARM           PSVL2 200                                           CER016
     C                     PARM *BLANKS   PSVLK3 20                                           CER016
     C                     PARM           PSVL3 200                                           CER016
     C                     PARM *BLANKS   PSVLK4 20                                           CER016
     C                     PARM           PSVL4 200                                           CER016
     C                     PARM *BLANKS   PSVLK5 20                                           CER016
     C                     PARM           PSVL5 200                                           CER016
     C                     PARM *BLANKS   PSVLK6 20                                           CER016
     C                     PARM           PSVL6 200                                           CER016
     C                     PARM *BLANKS   PSVLK7 20                                           CER016
     C                     PARM           PSVL7 200                                           CER016
     C                     PARM *BLANKS   PSVLK8 20                                           CER016
     C                     PARM           PSVL8 200                                           CER016
     C                     PARM *BLANKS   PSVLK9 20                                           CER016
     C                     PARM           PSVL9 200                                           CER016
     C                     PARM *BLANKS   PSVLK0 20                                           CER016
     C                     PARM           PSVL0 200                                           CER016
      *                                                                                       CER016
     C           PRTCD     IFNE *BLANKS                                                       CER016
     C           PSVL1     ANDNE'*NRF'                                                        CER016
      *                                                                                       CER016
     C                     EXSR *PSSR                                                         CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
      *                                                                                       CER016
     C                     MOVELPSVL1     PINTN   1                                           CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C                     ENDSR                                                              CER016
      *                                                                                       CER016
      *****************************************************************                       CER016
      /EJECT                                                                                  CER016
      ********************************************************************
     C/COPY ZSRSRC,ZFREQBZ2
     C/COPY ZSRSRC,ZDATE1Z2
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZCHKH
     C/COPY ZSRSRC,ZFWDT
     C/COPY ZSRSRC,ZACCH
     C/COPY ZSRSRC,ZCONVZ1
     C/COPY ZSRSRC,ZFRPEDZ3
     C/COPY ZSRSRC,ZEVCDZ1
      /TITLE SR/ZCCYCN                                                    CEU022
     C/COPY ZSRSRC,ZCCYCN                                                 CEU022
      ********************************************************************
**  CPY@
(c) Finastra International Limited 2001
**  RNAR - Referral narratives
Refer Dr
Refer Cr
Block Dr
Block Cr
Bankrupt
Bad debt
Inactive
Insuf Funds                                                                                   254051
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC