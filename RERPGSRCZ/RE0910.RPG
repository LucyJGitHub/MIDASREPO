0001 H        1                                                           S01117
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Stop cheques reorg & expired itms')
0001 H***********                                                         S01117
0002 F*****************************************************************
     F*                                                               *
     F*  Midas - Retail Module
0004 F*                                                               *
0005 F*  RE0910 - STOP CHEQUES REORGANISATION & EXPIRED ITEMS LIST    *
0006 F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*      1990, 1993                                               *
0008 F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. MD026015           Date 13Feb15               *
      *                 248203             Date 13Feb15               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG27627           Date 07May10               *
      *                 BUG27045A          Date 13Apr10               *
      *                 BUG27045           Date 18Feb10               *
      *                 BUG27178           Date 25Mar10               *
      *                 CAP201             Date 09Dec09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG4139            Date 02Sep04               *
      *                 CGL029             Date 03Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01413             Date 13Apr93               *
      *                                    Date                       *
0010 F*                                                               *
0011 F*****************************************************************
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  MD026015 - Prevent purging of Stopped cheques if EXPD is not *
      *             set.                                              *
      *           - Applied for MD031409
      *  248203 - Stopped checks expire 1 day too early.              *
      *         - Applied for MD031409.                               *
      *  BUG27627 - Increase length of files referencing file         *
      *             STOPCSD                                           *
      *  BUG27045A - Override the fix of Bug 27045 (Recompile)        *
      *  BUG27045 - Amend via SOAP removes Document Linkage           *
      *             (Recompile)                                       *
      *  BUG27178 - Stop Cheque Error in GOC0100                      *
      *  CAP201 - Enhance Stopped Cheques processing for              *
      *           Teller Interfaces                                   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG4139 - Initialise ACOD in STOPOSE to 9999999999.          *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  S01413 - Retail 3 Incorporation                              *
     F*         - Recompiled due to changes to files STOPC, STOPOSC,  *
     F*           STOPOSD, STOPOSE.                                   *
     F*  S01117 - Multibranching changes                              *
     F*                                                               *   S01117
0011 F*****************************************************************
0012 F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
0012 F*
0013 F*TOPC*  IP  F      96 18AI     2 DISK                               S01117
     F/COPY WNCPYSRC,RE0910F001
     F***STOPC** IP  F      96 21AI     2 DISK                                         S01117 CGL029
     F***STOPC** IP  F     106 21AI     2 DISK                                         CGL029 CAP201
     F***STOPC** IP  F     218 21AI     2 DISK                                       CAP201 BUG27627
     FSTOPC   IP  F     244 21AI     2 DISK                                                 BUG27627
     F/COPY WNCPYSRC,RE0910F002
0014 FTABLE   IF  F      96 12AI     2 DISK
     F/COPY WNCPYSRC,RE0910F003
0015 FSTOPOSC O   F      96 18AI     2 DISK
0015 F***STOPOSD O   F      96 18AI     2 DISK                                                CGL029
     F***STOPOSD O   F     106 18AI     2 DISK                                         CGL029 CAP201
     F***STOPOSD O   F     218 18AI     2 DISK                                       CAP201 BUG27627
     FSTOPOSD O   F     244 18AI     2 DISK                                                 BUG27627
0015 F***STOPOSE O   F      96 18AI     2 DISK                                               BUG4139
     FSTOPOSE O   F     106 18AI     2 DISK                                                  BUG4139
     F/COPY WNCPYSRC,RE0910F004
     FRE0910AUO   F     132     OV     PRINTER      KINFDS SPOOLU         S01117
0016 F*E0910P1O   F     132     OF     PRINTER                      S01124S01117
     FRE0910P1O   F     132     OF     PRINTER      KINFDS SPOOL      UC  S01117
0017 F*
0018 F* 01            STOPC HEADER
0019 F* 02            STOPC DETAIL RECORDS
0020 F* 03            STOPC TRAILER
0021 F* 04            TABLE ICDR1
0025 F*       11      FIRST SELECTED RECORD IN A BRANCH                   S01117
0025 F*       12      RECORD IS SELECTED IN A BRANCH                      S01117
0022 F*       40      1ST CYCLE BEEN DONE
0023 F*       41      FILES CONTROLS OUT OF BALANCE-NO.OF ST.CHEQUES
0024 F*       42      FILE CONTROLS OUT OF BALANCE-HASH VALUE
0025 F********50******EXPIRY*DATE*EQUAL*OR*LESS*THAN*RUN*DATE**********                       248203
     F*       50      EXPIRY DATE          LESS THAN RUN DATE                                 248203
0026 F*       60      EXPIRY DATE GREATER THAN RUN DATE
     F*       77      NO DETAILS TO REPORT FOR ALL BRANCH                 S01117
     F*       88      MBIN = 'Y'                                          S01117
     F*          U7   DATABASE ERROR                                      S01117
0027 F*          U8   HASH TOTALS OR NO.OF RECORDS CALCULATED NOT EQUAL TO
0028 F*               VALUE ON FILE TRAILER
     E                    CPY@    1   1 80
0029 I*    S/STOPC RECORDS
0030 I*
0031 I*    HEADER
0032 ISTOPC   NS  01   1 CH
     I/COPY WNCPYSRC,RE0910I001
0033 I                                        1  96 HEADER
     I/COPY WNCPYSRC,RE0910I002
0034 I*    DETAIL RECORDS
0035 I        NS  02   1 CD
0036 I**********                              2   70CNUM                                      CSD027
0036 I                                        2   7 CNUM                                      CSD027
0037 I                                        8  10 CCY
0038 I**********                             11  140ACOD                                      CGL029
     I                                       11  140ACODQQ                                    CGL029
0039 I                                       15  160ACSQ
     I/COPY WNCPYSRC,RE0910I003
0040 I                                       17  190STCR
     I/COPY WNCPYSRC,RE0910I004
0041 I                                       20  290ACNO            10
0042 I***********                            30  320BRCD                  S01117
0042 I                                       30  32 BRCA  L1              S01117
0043 I                                       33  400FCHQ
0044 I                                       41  480TCHQ
0045 I                                    P  49  550STPA
0046 I                                    P  56  580DATI
0047 I                                       59  78 STPN
0048 I                                    P  79  810EXPD
0049 I                                    P  90  920LCD
0050 I                                       93  93 CHTP
0051 I                                    P  94  960TNLU
     I                                       97 1060ACOD                                      CGL029
     I/COPY WNCPYSRC,RE0910I005
0052 I**********                              1  96 DETAIL                                    CGL029
     I**********                              1 106 DETAIL                           CGL029 BUG27178
     I**********                              1 218 DETAIL                         BUG27178 BUG27627
     I                                        1 244 DETAIL                                  BUG27627
     I/COPY WNCPYSRC,RE0910I006
0053 I*
0054 I*
0055 I        NS  03   1 CT
     I                                    P  20  220NOSQ
     I                                    P  23  300VQW
     I                                    P  31  320VQD
0056 I                                    P  33  340NSQI
0057 I                                    P  35  360NSQA
0058 I                                    P  37  380NSQD
0059 I                                    P  39  460VQIW
0060 I                                    P  47  480VQID
0061 I                                    P  49  560VQAW
0062 I                                    P  57  580VQAD
0063 I                                    P  59  660VQDW
0064 I                                    P  67  680VQDD
0065 I                                    P  69  710NSAU
0066 I                                    P  72  790VQUW
0067 I                                    P  80  810VQUD
0068 I                                    P  82  840LCD
0069 I                                    P  85  870TNLU
0070 I*                                       1  96 LOT
0071 I*
0072 I*    CATCHALL
0073 I        NS
0074 I*
0075 I*    S/TABLE RECORDS
0076 I**   TABLE FILE - INSTALLATION CONTROL DATA RECORD 1.
0077 I**
0078 ITABLE   NS  04   2 C0   3 C1  12 C1
0079 I       AND      13 C0
0080 I                                        1   1 RECI
0081 I                                        2   30RECT
0082 I                                       12  130RCDE
0083 I                                       14  66 TITL
0084 I***********                            67  67 DATF                  S01117
0085 I***********                            68  700DFBR                  S01117
0086 I                                       74  74 MODI1
0087 I                                       75  75 MODI2
0088 I                                       76  76 MODI3
0089 I***********                         P  77  790RUND                  S01117
0090 I***********                            80  86 RUNA                  S01117
0091 I                                       87  870SFLG
0092 I                                    P  90  920LCD
0093 I                                       93  93 CHTP
0094 I                                    P  94  960TNLU
0095 I*                                       1  96 LOT
0096 I**
0097 I**   CATCHALL FOR DELETED RECORDS.
0098 I        NS
0099 I**
     I**                                                                  S01117
     I**   FILE INFORMATION DATA STRUCTURE                                S01117
     I**                                                                  S01117
     ISPOOL       DS                                                      S01117
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
0218 I*                                                                   S01117
0219 I*    LDA - DIAGNOSTICS FOR PROGRAM ABORT                            S01117
0220 I*                                                                   S01117
0221 ILDA        UDS                            256                       S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I**                                                                  S01117
     I** DATA AREA RUNDAT                                                 S01117
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I**  EXTERNAL DS FOR BRANCH DETAILS                                  S01117
     I              A8BRNM                          BRNM                  S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01117
     I*                                                                   S01117
     I**                                                                  S01117
0100 I**
     I/EJECT
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
     C                     MOVEACPY@      BIS@   80
0101 C*
0102 C*    N.B. IN THIS PROGRAM EXPIRED MEANS EXPIRED DUE TO DATE
0103 C*    DELETED RECORDS ARE NOT COUNTED AS EXPIRED. THEY ARE HANDLED BY
0104 C*    THE MAINTAINANCE PROGRAM.
0105 C*
     C**                                                                  S01117
     C*    DEFINE LDA                                                     S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBFILE                          S01117
     C                     MOVE *BLANKS   DBKEY                           S01117
     C                     MOVE *BLANKS   DBPGM                           S01117
     C                     MOVEL'RE0910  'DBPGM                           S01117
     C                     OUT  LDA                                       S01117
     C**                                                                  S01117
     C**    IN THE DATAAREA RUNDAT                                        S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**    TEST FOR MULTIBRANCHING                                       S01117
     C**                                                                  S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     88                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
0106 C*
0107 C*    1ST CYCLE PROCESSING
0108 C*    GET INST.CONTROL DATA RECORD 1 FOR RUN DATE,RUNA,MAINTAIN COUNT
0109 C*    OF NO. OF CURRENT RECORDS,NORE1,AND OUTPUT HEADER FOR STOPO
0110 C   40                GOTO START
0111 C                     EXSR ZSYSTM
0112 C           NORE1     ADD  1         NORE1   50
     C                     SETON                     77    ASSUME NO DTLS S01117
0113 C                     SETON                     40
0114 C           START     TAG                             ** START TAG **
0115 C                     SETOF                     5060
     C                     SETOF                     11                   S01117
0116 C*
     C*                                                                   S01117
     C           *INL1     IFEQ '1'                                       S01117
     C                     CLOSERE0910P1                                  S01117
     C                     SETOF                     12                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** If Branch Report                                                 S01117
0117 C*    INPUT CYCLE PROCESSING
0118 C*    EXPIRED STOP CHEQUES TO RE0910 CALCULATIONS - IND. 50
0119 C*    CURRENT STOP CHEQUES TO STOPO CALCULATIONS - IND. 60
      *    Rundate is already updated: only expire when expiry date is LT rundate             248203
0120 C***02***** EXPD      COMP RUND                 605050                                   248203
0120 C   02      EXPD      COMP RUND                 605060                                   248203
     C           EXPD      IFEQ 0                                                           MD026015
     C                     SETON                     60                                     MD026015
     C                     SETOF                     50                                     MD026015
     C                     ENDIF                                                            MD026015
0121 C*
0122 C*    RE0910 CALCULATIONS
0123 C*    OUTPUT TO RE0910,MAINTAIN COUNT OF NO.OF EXPIRED RECORDS,NORE2,
0124 C*    AND HASH TOTAL VALUE OF EXPIRED RECORDS,RHASHI & RHASHD
0125 C   02 50   NORE2     ADD  1         NORE2   50
0125 C   02 50   NORE3     ADD  1         NORE3                           S01117
0126 C   02 50             MOVE RHASHI    ZZTOTI
0127 C   02 50             MOVE RHASHD    ZZTOTD
0128 C   02 50             MOVE STPA      ZZAMT
0129 C   02 50             EXSR GLZADD
0130 C   02 50             MOVE ZZTOTI    RHASHI 150       INTEGERS
0131 C   02 50             MOVE ZZTOTD    RHASHD  30       DECIMALS
0132 C*
0133 C*    STOPO CALCULATIONS
0134 C*    OUTPUT TO STOPO,MAINTAIN COUNT OF NO.OF CURRENT RECORDS,NORE1,
0135 C*    AND HASH TOTAL VALUE OF CURRENT RECORDS,SHASHI & SHASHD
0136 C   02 60   NORE1     ADD  1         NORE1
0137 C   02 60             MOVE SHASHI    ZZTOTI
0138 C   02 60             MOVE SHASHD    ZZTOTD
0139 C   02 60             MOVE STPA      ZZAMT
0140 C   02 60             EXSR GLZADD
0141 C   02 60             MOVE ZZTOTI    SHASHI 150       INTEGERS
0142 C   02 60             MOVE ZZTOTD    SHASHD  30       DECIMALS
     C*                                                                   S01117
0098 C  N02                                                               S01117
0098 CORN50                GOTO END                                       S01117
     C*                                                                   S01117
     C  N12                SETON                     1112                 S01117
     C                     SETOF                     77    SOME DETAILS   S01117
     C*                                                                   S01117
     C**  MULTIBRANCH TEST FOR OUTPUT                                     S01117
     C*                                                                   S01117
     C           *IN11     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C                     OPEN RE0910P1                                  S01117
     C*                                                                   S01117
     C                     Z-ADD0         PAGE                            S01117
     C                     Z-ADD1         NORE3   50                      S01117
     C**                                                                  S01117
     C** ENSURE REPORT SPOOL FILE RECORDED BY RCF                         S01117
     C                     Z-ADDSFNUM     ZSNUM   60                      S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ                             S01117
     C                     PARM BRCA      SENTY   3                       S01117
     C                     PARM           SFILE                           S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C                     SETON                     U7LR                 S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C**                                                                  S01117
     C** GET BRANCH NAME (IN BRNM)                                        S01117
     C**                                                                  S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL@DSNB     DBKEY                           S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
     C                     Z-ADD12        DBASE            * DBERROR 012 *S01117
     C                     OUT  LDA                        ***************S01117
     C                     SETON                     U7LR                 S01117
     C                     GOTO END                                       S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C           END       TAG                                   ** END TAG ***
     C*                                                                   S01117
0143 C*
0144 C*    LAST RECORD PROCESSING
     C**                                                                  S01117
     C*       ENSURE TOTAL SPOOL FILE RECORDED BY RCF                     S01117
     C**                                                                  S01117
     CLR                   Z-ADDSFNUMU    ZSNUMU  60                      S01117
     C**                                                                  S01117
     CLR                   CALL 'ZSFILE'                                  S01117
     CLR                   PARM           SEQ     5                       S01117
     CLR                   PARM *BLANK    SENTY   3                       S01117
     CLR                   PARM           SFILEU                          S01117
     CLR                   PARM           ZSNUMU                          S01117
     CLR                   PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     CLR         ZSERR     IFEQ 'Y'                                       S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     CLR                   SETON                     U7                   S01117
     CLR                   RETRN                                          S01117
     CLR                   END                                            S01117
0145 C*    STOPO FILE
0146 C*    MAINTAIN COUNT OF CURRENT RECORDS,NORE1,OUTPUT TRAILER TO STOPO
0147 CLR         NORE1     ADD  1         NORE1
0148 C*
0149 C*    CONVENTION - ON MASTER FILES THE NO.OF RECORDS EXCLUDES THE
0150 C*    HEADER & TRAILER FROM THE COUNT,SO WE MUST SUBTRACT 2.
0151 CLR         NORE1     SUB  2         NORE1
0152 C*
0153 C*    RE0910 REPORT
0154 C*    IF NO.OF CURRENT RECORDS CALCULATED IS UNEQUAL TO NO.ON STOPC
0155 C*    TRAILER(I.E.CURRENT & EXPIRED)-NO.OF EXPIRED,SET U8 & PRINT
0156 C*    'DIFFERENCE'
0157 CLR         NSAU      SUB  NORE2     NSAU
0158 CLR         NORE1     COMP NSAU                 4141
0159 CLR    41             SETON                     U8
0160 CLR   N41             SETOF                     U8
0161 C*
0162 C*    IF HASH VALUE OF CURRENT RECORDS IS UNEQUAL TO VALUE ON STOPC
0163 C*    TRAILER (I.E.CURRENT & EXPIRED)-HASH VALUE OF EXPIRED RECORDS,
0164 C*    SET U8 & PRINT'DIFFERENCE'
0165 CLR                   MOVE RHASHI    ZZAMTI
0166 CLR                   MOVE RHASHD    ZZAMTD
0167 CLR                   MOVE SHASHI    ZZTOTI
0168 CLR                   MOVE SHASHD    ZZTOTD
0169 CLR                   EXSR GLZSUM
0170 CLR         VQUW      COMP ZZTOTI               4242
0171 CLRN42      VQUD      COMP ZZTOTD               4242
0172 CLR 42                SETON                     U8
0173 C*
0174 C*    SET UP FIELDS OF ZEROS FOR BLANKING OUT FIELDS ON STOPO TRAILER
0175 CLR                   Z-ADD0         ZERO1  150
0176 CLR                   Z-ADD0         ZERO2   30
     C*                                                                   S01117
     CLR U7                EXSR *PSSR                                     S01117
0177 C*
0178 C********************************************************************
0179 C**
0180 C**   ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.
0181 C**
0182 C           ZSYSTM    BEGSR                           *** ZSYSTM ***
0183 C**
0184 C**   SET UP KEY FOR INSTALLATION CONTROL RECORD.
0185 C                     MOVEL'01      'ZTABKY 12
0186 C                     MOVE '  10'    ZTABKY
0187 C**
0188 C           ZTABKY    CHAINTABLE                99    ON NOT THERE
0189 C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED
0190 C**
0191 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
0192 C           DATF      COMP 'M'                      98MMDDYY, 98 ON
0193 C**
0194 C                     ENDSR
0195 C**
0196 C**
0197 C********************************************************************
0198 C********************************************************************
0199 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0200 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0201 C*
0202 CSR         GLZADD    BEGSR                           *** GLZADD ****
0203 C*
0204 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0205 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0206 C*
0207 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0208 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0209 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0210 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0211 C*
0212 CSR                   EXSR GLZSUM
0213 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0214 C*
0215 C********************************************************************
0216 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0217 C*                        GLZADD, GLZSUB, GLZCMP.
0218 C*          PARAMETERS PASSED -
0219 C*                     I/P ZZAMTI ZZAMTD
0220 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0221 C*
0222 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0223 C*
0224 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0225 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0226 CSR                   SETOF                     919293
0227 CSR                   SETOF                     949599
0228 C*
0229 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0230 CSR         ZZAMTI    COMP 0                      9293
0231 CSR 93      ZZAMTD    COMP 0                      9293
0232 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0233 C*
0234 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0235 CSR         ZZTOTI    COMP 0                      9193
0236 CSR 93      ZZTOTD    COMP 0                      9193
0237 C*
0238 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0239 CSR 93                Z-ADDZZAMTI    ZZTOTI
0240 CSR 93                Z-ADDZZAMTD    ZZTOTD
0241 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0242 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0243 CSR 91N92
0244 CORN91 92             GOTO ZZOFPS
0245 C*
0246 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0247 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0248 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0249 C*
0250 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0251 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0252 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0253 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0254 C*
0255 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0256 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0257 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0258 CSRN99                Z-ADDZZWK2     ZZTOTD
0259 CSRN99                Z-ADDZZWK3     ZZTOTI
0260 C*
0261 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0262 CSR 99                Z-ADD0         ZZAMT  153
0263 CSR                   GOTO ZZSEND
0264 C*
0265 C* THE 'SIGNS' ARE DIFFERENT
0266 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0267 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0268 C*
0269 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0270 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0271 C*
0272 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0273 C*
0274 CSR 91                Z-SUBZZTOTI    ZZTOTI
0275 CSR 91                Z-SUBZZTOTD    ZZTOTD
0276 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0277 C*
0278 CSR         ZZTOTI    COMP ZZAMTI               93  95
0279 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0280 C*
0281 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0282 CSR 95                Z-ADD0         ZZTOTI
0283 CSR 95                Z-ADD0         ZZTOTD
0284 CSR 95                GOTO ZZSEND
0285 C*
0286 C* IF ZZTOT GT. ZZAMT.
0287 CSR 93      ZZAMTD    COMP ZZTOTD               94
0288 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0289 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0290 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0291 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0292 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0293 C*
0294 C*
0295 C* IF ZZAMT GT. ZZTOT.
0296 CSRN93      ZZTOTD    COMP ZZAMTD               94
0297 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0298 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0299 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0300 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0301 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0302 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0303 C*
0304 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0305 CSR                   SETOF                     94
0306 CSR 93 91
0307 CORN93 92             SETON                     94
0308 CSR 94                Z-SUBZZTOTI    ZZTOTI
0309 CSR 94                Z-SUBZZTOTD    ZZTOTD
0310 C**
0311 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0312 CSR 92                Z-SUBZZAMTI    ZZAMTI
0313 CSR 92                Z-SUBZZAMTD    ZZAMTD
0314 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0315 C**
0316 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0317 CSR                   SETOF                     96
0318 CSR         ZZTOTD    COMP 0                        91
0319 CSR 91      ZZTOTI    COMP 0                      96
0320 CSR 96                MOVE '.000-'   ZZNEGD  5
0321 CSR                   ENDSR                             ** ENDSR **
0546 C********************************************************************S01117
     C*                                                                   S01117
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS                      S01117
     C*                                                                   S01117
     C* CALLS: NOTHING                                                    S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** *PSSR **    S01117
0322 C********************************************************************
0323 C*
     C/EJECT
0324 O*    STOPO OUTPUT
0325 OSTOPOSC H        01
     O/COPY WNCPYSRC,RE0910O001
0326 O                         HEADER    96
     O/COPY WNCPYSRC,RE0910O002
0327 OSTOPOSD D        02 60
     O/COPY WNCPYSRC,RE0910O003
0328 O**********               DETAIL    96                                                   CGL029
     O**********               DETAIL   106                                            CGL029 CAP201
     O**********               DETAIL   218                                          CAP201 BUG27627
     O                         DETAIL   244                                                 BUG27627
     O/COPY WNCPYSRC,RE0910O004
0329 OSTOPOSE T        LR
0330 O                                    1 'T'
0331 O                                   19 '999999999999999999'
0332 O                         NORE1     22P
0333 O                         SHASHI    30P
0334 O                         SHASHD    32P
0335 O                         ZERO2     34P
0336 O                         ZERO2     36P
0337 O                         ZERO2     38P
0338 O                         ZERO1     46P
0339 O                         ZERO2     48P
0340 O                         ZERO1     56P
0341 O                         ZERO2     58P
0342 O                         ZERO1     66P
0343 O                         ZERO2     68P
0344 O                         NORE1     71P
0345 O                         SHASHI    79P
0346 O                         SHASHD    81P
0347 O                         LCD       84P
0348 O                         TNLU      87P
     O                                   90 '999'                         S01117
     O                                  106 '9999999999'                                     BUG4139
     O/COPY WNCPYSRC,RE0910O005
0349 O*
0350 O*    RE0910 OUTPUT
0351 O*E0910P1H**203   01                                           S01124S01117
0352 O*******OR**      OF                                                 S01117
     ORE0910P1H  203   11                                                 S01117
0352 O       OR        OF 12                                              S01117
0353 O***********                        20 'REFERENCE RE0910'            S01117
0353 O                                   20 'REFERENCE RE0910P1'          S01117
0354 O                         TITL      94
0355 O                                  104 'DATE'
0356 O                         RUNA     113
0357 O                                  122 'PAGE'
0358 O                         PAGE  Z  127
0359 O********H  1     01                                                 S01117
0360 O*******OR        OF                                                 S01117
0359 O        H  1     11                                                 S01117
0360 O       OR        OF 12                                              S01117
0361 O                                   75 'EXPIRED STOP CHEQUES REP'
0362 O                                   78 'ORT'
     O                 88                88 'BRANCH'                      S01117
     O                 88      BRCA      92                               S01117
     O                 88                93 '-'                           S01117
     O                 88      BRNM     123                               S01117
0363 O********H  2     01                                                 S01117
0364 O*******OR        OF                                                 S01117
0359 O        H  1     11                                                 S01117
0360 O       OR        OF 12                                              S01117
0365 O                                   75 '------------------------'
0366 O                                   78 '---'
0367 O********H  1     01                                                 S01117
0368 O*******OR        OF                                                 S01117
0359 O        H  1     11                                                 S01117
0360 O       OR        OF 12                                              S01117
0369 O                                   29 'ACCOUNT NO'
0370 O                                   60 'RETAIL ACCOUNT NO'
0371 O                                   84 'STOP CHEQUE'
0372 O*****                             104 'BRANCH'                      S01117
0373 O********H  2     01                                                 S01117
0374 O*******OR        OF                                                 S01117
0359 O        H  2     11                                                 S01117
0360 O       OR        OF 12                                              S01117
0375 O                                   81 'REF NO'
0376 O        D  2     02 50
     O**********       88      BRCA      16                                            S01117 CGL029
     O**********       88                17 '-'                                        S01117 CGL029
0377 O**********               CNUM      23                                                   CGL029
0378 O**********                         24 '-'                                               CGL029
0379 O**********               CCY       27                                                   CGL029
0380 O**********               ACOD      33 '-    -'                                          CGL029
     O                 88      BRCA      10                                                   CGL029
     O                 88                11 '-'                                               CGL029
     O                         CNUM      17                                                   CGL029
     O                                   18 '-'                                               CGL029
     O                         CCY       21                                                   CGL029
     O**********               ACOD      27 '-           -'                          CGL029 MD026015
     O                                   22 '-'                                             MD026015
     O                         ACOD      32                                                 MD026015
     O                                   33 '-'                                             MD026015
0381 O                         ACSQ      35
0382 O                      N10ACNO      55
0383 O                         STCR      80
0384 O*****                    BRCD     102                               S01117
0385 O********TF 237   LR                                                 S01117
0385 O        TF 2     L1 12                                              S01117
0386 O                                   62 'NO.EXPIRED'
0387 O***********              NORE2 1   68                               S01117
0387 O                         NORE3 1   68                               S01117
     O        T 32     L1 U7 12                                           S01117
     O                                   74 '*** DATABASE ERROR ***'      S01117
0388 O********T  2     LR                                                 S01117
0389 O********                           39 'END OF REPORT TOTALS'        S01117
     O        T 3      L1 12                                              S01117
     O                 88                66 '*** END OF REPORT FOR'       S01117
     O                 88                74 ' BRANCH '                    S01117
     O                 88      BRCA      77                               S01117
     O                 88                81 ' ***'                        S01117
     O                N88                76 '*** END OF REPORT ***'       S01117
0349 O*                                                                   S01117
0350 O*    RE0910AU OUTPUT                                                S01117
     ORE0910AUT  203   LR                                                 S01117
0353 O                                   20 'REFERENCE RE0910AU'          S01117
0354 O                         TITL      94                               S01117
0355 O                                  104 'DATE'                        S01117
0356 O                         RUNA     113                               S01117
0357 O                                  122 'PAGE'                        S01117
0358 O                         PAGE1 Z  127                               S01117
0359 O        T  1     LR                                                 S01117
0361 O                                   77 'EXPIRED STOP CHEQUES REP'    S01117
0362 O                                   80 'ORT'                         S01117
     O                                   95 '   RUN CONTROLS'             S01117
0363 O        T  2     LR                                                 S01117
0365 O                                   77 '------------------------'    S01117
0366 O                                   80 '---'                         S01117
0390 O        T  3     LR
0391 O                                   43 'NUMBER OF STOPPED CHEQUE'
0392 O                                   57 'S AFTER UPDATE'
0393 O                         NSAU  1   64
0394 O                                   90 'VALUE OF STOPPED CHEQUES'
0395 O                                  103 ' AFTER UPDATE'
0396 O                         SHASHIZ  124
0397 O                         SHASHD   127
0398 O        T  2     LR U8
0399 O                                   30 'CALCULATED - NUMBER OF S'
0400 O                                   54 'TOPPED CHEQUES AFTER UPD'
0401 O                                   57 'ATE'
0402 O                         NORE1 1   64
0403 O                                   90 'VALUE OF STOPPED CHEQUES'
0404 O                                  103 'AFTER UPDATE'
0405 O                         SHASHIZ  124
0406 O                         SHASHD   127
0407 O        T  2     LR
0408 O                 41                64 '***  DIFFERENCE  ***'
0409 O                 42               123 '***  DIFFERENCE  ***'
0868 O*                                                                   S01117
0797 O*  NO DETAILS OUTPUT                                                S01117
0798 O*                                                                   S01117
     O        T 32     LR 77NU7                                           S01117
     O                                   70 '***   NO DETAILS TO REPO'    S01117
     O                                   78 'RT   ***'                    S01117
0799 O        T 32     LR U7                                              S01117
0800 O                                   58 'DATABASE ERROR '             S01117
0801 O                         DBASE     61                               S01117
0802 O                                   75 'IN PROGRAM '                 S01117
0803 O                         DBPGM     85                               S01117
0799 O        T  2     LR U7                                              S01117
0804 O                                   48 'FILE '                       S01117
0805 O                         DBFILE    56                               S01117
0804 O                                   62 ', KEY '                      S01117
0805 O                         DBKEY     91                               S01117
0410 O********TF*      LR                                                 S01117
0411 O***********                        72 '*** END OF REPORT ***'       S01117
0412 O*
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
