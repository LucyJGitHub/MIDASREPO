     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Daily comm calculations')                     *
     F*****************************************************************
     F*                                                               *
     F*  Midas Retail Module                                          *
     F*                                                               *
     F*  RE3113 - DAILY ACCRUAL COMMISSION                            *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSW101             Date 03Feb23               *
      *  Prev Amend No. MD058854           Date 21Oct21               *
      *                 MD058755           Date 01Sep21               *
      *                 MD058815           Date 28Sep21               *
      *                 MD053295           Date 13Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 MD037176           Date 09Feb16               *
      *                 MD027119           Date 21May14               *
      *                 MD027016           Date 19May14               *
      *                 MD026867           Date 15May14               *
      *                 CRE090A            Date 14Feb14               *
      *                 CRE083BR           Date 06Aug12               *
      *                 CRE083             Date 06Aug12               *
      *                 AR802662           Date 29Jul11               *
      *                 CER049             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG14933           Date 02Oct07               *
      *                 BUG12930           Date 04Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 240760             Date 06Jun06               *
      *                 CRE027             Date 15Mar06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 158789             Date 04Aug99               *
      *                 CDE002             Date 21Dec99               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 183259             Date 01Sep00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 106054             DATE 24Sep97               *
     F*                 101829             DATE 09Apr97               *
     F*                 CCB003             Date 25Oct96               *
     F*                 107896             DATE 10SEP96               *
     F*                 098818             DATE 15APR96               *
     F*                 084414             DATE 23FEB95               *
     F*                 075264             DATE 13OCT94               *
     F*                 S01413 *CREATE     DATE 13APR93               *
     F*                                                               *
      *****************************************************************
      *                                                               *
      *  CSW101 - PAYplus Interface.                                  *
      *           Recompiled                                          *
      *  MD058854 - Deliverable Data Split for TABLEV4                *
      *  MD058755 - Deliverable Data Split for SDRETRPD and TABLETZ   *
      *  MD058815 - Dealing interest Calculation type 6 have different*
      *             interest amount for Calculation type 1 for non-   *
      *             leap year interest period with same parameters.   *
      *             Based from MD052690. (Recompile)                  *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD037176 - Component fail due to array index error.          *
      *             Increase array size to 2000 and index I1 to 4,0   *
      *  MD027119 - Incorrect accrual for accounts with commission    *
      *             on delayed capitalisation date.                   *
      *  MD027016 - Outstanding interest after delayed capitalisation *
      *             date is incorrect on accounts with commission for *
      *             first day accrual.                                *
      *  MD026867 - Debit Turnover and Minimum Balance commissions    *
      *             not generated correctly.                          *
      *  CRE090A - Delay Capitalization of Interest                   *
      *  CRE083BR - COB Restructure - RE COB Optimisation Phase 1     *
      *  CRE083 - COB Restructure - RE COB Optimisation Phase 1       *
      *  AR802662 - Commission on minimum CR balance(CMBE) calculated *
      *             is wrong when only one record exists since last   *
      *             capitalization. Checked if HISD=LSTCH2 use RUND   *
      *             instead to avoid result of zero. Partially applied*
      *             fix 255184. (Child: AR802663)                     *
      *  CER049 - Stamp Tax (Recompile)                               *
      *  BUG14933 - Error in checking switchable feature CSW207       *
      *             (Recompile)                                       *
      *  BUG12930 - Change the length of data area CBTASKSP to 10     *
      *             characters. (Recompile)                           *
      *  240760 - Array index error when loading TRT as there are     *
      *           more Transaction Types on file than elements in     *
      *           the array. Increase the number of elements to 999.  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CRE027 - Charges for extra statements and fixed commission   *
      *           enhancement.                                        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  158789 - Apply fix for dberr at 08  (159233)                 *
      *           - "if rcd not found read previous rcd for a/c"      *
      *  CDE002 - Revenue Analysis - Recompiled due to changes in     *
      *           PF/RECCYD.                                          *
      *  CSD007 - Customer Closing                                    *
     F*  183259 - Cater for account closure request history records.  *
     F*  106054 - Increase array of Transaction Types.                *
     F*  101829 - Inactive a/c commission applied to newly opened a/c *
     F*           with daily CR capitalisation. Amend processing to   *
     F*           check for longest period of inactivity starting     *
     F*           with (Control Next CR Cap date/DNWD - NDBI) or DACO *
     F*           if later or Control Last CR Cap. date if earlier.   *
     F*           Also if 1st day accruals and REHISL 'S' record not  *
     F*           found, read previous record as may be a cap. caused *
     F*           by attempted closure. (Error found while testing.)  *
     F*  CCB003 - COB Performance Enhancements - Task Split           *
     F*  107896 - If fields NCID and NDID are not equal to zero then  *
     F*           treat as if <= DATE1.                               *
     F*  098818 - Allow for interest capital indicator on RSHISPS     *
     F*           to retain its original values of 'C' 'D' 'Y' &      *
     F*           ' ' to be used by input cycle enquiries.            *
     F*  084414 - Array index error when History Date prior to        *
     F*           (DNWD - 365) or when Account Inactivity Period is   *
     F*           greater than 370 days.                              *
     F*  075264 - Customer Group is not always defaulted to '1'.      *
     F*           Treat ' ' the same as '1'.
     F*  S01413 - Retail 3 Incorporation                              *
     F*                                                               *
     F*****************************************************************
     F/COPY WNCPYSRC,RE3113F001
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FREHPOPL IF  E           K        DISK
     FREHISBN UF  E           K        DISK
     F*********   REHISPPF                          KRENAMEREHISPBF       CCB003
     F*********   REHISPPF                          KRENAMEREHISPB1                    CCB003 CRE083
     F            REHISPPF                          KRENAMEREHISPBF                           CRE083
     F                                              KCOMIT
     F**REFIXCPDUF  E           K        DISK                                          CCB003 CRE083
     FREFIXCPDUF  E           K        DISK                           UC                      CRE083
     F**********  REHISPPF                          KRENAMEREHISPBF                    CCB003 CRE083
     F            REFIXCD0                          KRENAMEREHISPB1                           CRE083
     F                                              KCOMIT                CCB003
     FREHISL  IF  E           K        DISK
     FREHISDL UF  E           K        DISK                                                  CRE090A
     F            REHISPPF                          KRENAMEREHISD1                           CRE090A
     F*TABLETZ*IF  E                    DISK                                                MD058755
     FSDRTRXTDIF  E                    DISK                                                 MD058755
     FTABTBRE IF  E                    DISK
     F*TABLEV4*IF  E                    DISK                                                MD058854
     FTABV4XTDIF  E                    DISK                                                 MD058854
     FRECCY   IF  E           K        DISK
     F            RECCYAF                           KIGNORE
     F            RECCYZF                           KIGNORE
     F***REACR   IF  E           K        DISK                                               CRE090A
     FREACR   UF  E           K        DISK                                                  CRE090A
     F            REACRAF                           KIGNORE
     F            REACRZF                           KIGNORE
     FRECOM   UF  E           K        DISK
     F                                              KCOMIT
     F*RE3113AUO***E             73     PRINTER                           CCB003
     FRE3113AUO   E             73     PRINTER                        UC  CCB003
      *****************************************************************   CCB003
     F/EJECT
      *****************************************************************   CCB003
     E                    CPY@    1   1 80
     E                    ZYDY    4   4  4 0             ZDATE1 YEAR
     E                    ZMDY   13  13  3 0             ZDATE1 MONTH
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    GRP         8 12               CLIENT GROUP CODE
     E                    IN1         8  1               FIXED COM.
     E                    IN2         8  1               DB. INTEREST COM.
     E                    IN3         8  1               INACT. ACC. COM.
     E                    IN4         8  1               MAX. DB. BAL. COM
     E                    IN5         8  1               MIN. CR. BAL. COM
     E                    IN6         8  1               ACC. COM BAL. COM
     E                    IN7         8  1               Statement Commiss43963
     E                    ICC       150 12               RETAIL ICD CODES
     E                    MX1       150 13 0             FIXED COM. AMT.
     E                    MN2       150 13 0             MIN. DB. INT. COM
     E                    MX2       150 13 0             MAX. DB. INT. COM
     E                    RT2       150 10 8             DB. INT. RATE
     E                    MX3       150 13 0             INACT. THRESHOLD
     E                    MN4       150 13 0             MAX. DB. BAL. COM
     E                    MX4       150 13 0             MIN. DB. BAL. COM
     E                    RT4       150 10 8             DB. BAL. RATE
     E                    M5A       150 13 0             CR. BAL. C THRESH
     E                    M5B       150 13 0             CR. BAL. S THRESH
     E                    M5C       150 13 0             CR. BAL. C AMOUNT
     E                    M5D       150 13 0             CR. BAL. S AMOUNT
     E                    MXD        12 15 0             DB. BAL. BY MONTH
     E                    MX6       150 13 0             AACC COM MAX  .
     E                    MN6       150 13 0             MIN. ACC COM. COM
     E                    RT6       150 10 8             ACC COM. RATE
     E                    MX7       150 13 0             statement commiss
     E                    DYS       370  1               DAYS IN YEAR FLAG
     E**********          TRT       150  5 0A            TRANSACTION TYPES106054
     E**********          TRT       350  5 0A            TRANSACTION TYPES106054              240760
     E********************TRT       999  5 0A            TRANSACTION TYPES           240760 MD037176
     E                    TRT      2000  5 0A            TRANSACTION TYPES                  MD037176
     E/COPY ZSRSRC,ZDATE9Z1                                                                  CRE090A
      *****************************************************************   CCB003
     E/EJECT
      *****************************************************************   CCB003
     IREHISPBF
     I              RECI                            BRECI
     I              HISD                            BHISD
     I              HISB                            BHISB
     I              MNBL                            BMNBL
     I              CHGAR                           BCHGAR
     I              TCHGAR                          BTHGAR
     I              CHGAN                           BCHGAN
     I              TCHGAN                          BTHGAN
     I              DMVT                            BDMVT
     I              DICT                            BDICT
     I              DRCB                            BDRCB
     I              DRIR                            BDRIR
     I              DRCD                            BDRCD
     I              DAID                            BDAID
     I              MADI                            BMADI
     I              TMADI                           BTMADI
     I              PDID                            BPDID
     I              DMINT                           BDMINT
     I              CMVT                            BCMVT
     I              CICT                            BCICT
     I              CRCB                            BCRCB
     I              CRIR                            BCRIR
     I              CRCD                            BCRCD
     I              CAID                            BCAID
     I              MACI                            BMACI
     I              TMACI                           BTMACI
     I              PCID                            BPCID
     I              CMINT                           BCMINT
     I              DICI                            BDICI
     I              CICI                            BCICI
     I              DRCI                            BDRCI
     I              CRCI                            BCRCI
     I              VDTC                            BVDTC
     I              ADTY                            BADTY
     I              ALTI                            BALTI
     I              MNBCP                           BMNBCP
     I              LGID                            BLGID
     I              VALL                            BVALL
     I              LINK                            BLINK
      *                                                                   CCB003
     IREHISPB1                                                            CCB003
     I**********    RECI                            CRECI                              CCB003 CRE083
     I              RECID                           CRECID                                    CRE083
     I**********    HISD                            CHISD                              CCB003 CRE083
     I**********    HISB                            CHISB                              CCB003 CRE083
     I**********    MNBL                            CMNBL                              CCB003 CRE083
     I**********    CHGAR                           CCHGAR                             CCB003 CRE083
     I**********    TCHGAR                          CTHGAR                             CCB003 CRE083
     I**********    CHGAN                           CCHGAN                             CCB003 CRE083
     I**********    TCHGAN                          CTHGAN                             CCB003 CRE083
     I**********    DMVT                            CDMVT                              CCB003 CRE083
     I**********    DICT                            CDICT                              CCB003 CRE083
     I**********    DRCB                            CDRCB                              CCB003 CRE083
     I**********    DRIR                            CDRIR                              CCB003 CRE083
     I**********    DRCD                            CDRCD                              CCB003 CRE083
     I**********    DAID                            CDAID                              CCB003 CRE083
     I**********    MADI                            CMADI                              CCB003 CRE083
     I**********    TMADI                           CTMADI                             CCB003 CRE083
     I**********    PDID                            CPDID                              CCB003 CRE083
     I**********    DMINT                           CDMINT                             CCB003 CRE083
     I**********    CMVT                            CCMVT                              CCB003 CRE083
     I**********    CICT                            CCICT                              CCB003 CRE083
     I**********    CRCB                            CCRCB                              CCB003 CRE083
     I**********    CRIR                            CCRIR                              CCB003 CRE083
     I**********    CRCD                            CCRCD                              CCB003 CRE083
     I**********    CAID                            CCAID                              CCB003 CRE083
     I**********    MACI                            CMACI                              CCB003 CRE083
     I**********    TMACI                           CTMACI                             CCB003 CRE083
     I**********    PCID                            CPCID                              CCB003 CRE083
     I**********    CMINT                           CCMINT                             CCB003 CRE083
     I**********    DICI                            CDICI                              CCB003 CRE083
     I**********    CICI                            CCICI                              CCB003 CRE083
     I**********    DRCI                            CDRCI                              CCB003 CRE083
     I**********    CRCI                            CCRCI                              CCB003 CRE083
     I**********    VDTC                            CVDTC                              CCB003 CRE083
     I**********    ADTY                            CADTY                              CCB003 CRE083
     I**********    ALTI                            CALTI                              CCB003 CRE083
     I**********    MNBCP                           CMNBCP                             CCB003 CRE083
     I**********    LGID                            CLGID                              CCB003 CRE083
     I**********    VALL                            CVALL                              CCB003 CRE083
     I**********    LINK                            CLINK                              CCB003 CRE083
      *                                                                   CCB003
     IRECCYDF
     I              KEY                             RECKEY
     IREACRDF
     I              HISB                            HISB2
     IACCNTABF
     I              RECI                            RECIX
     I              DRIS                            ADRIS
     I              CRIS                            ACRIS
     I********************************************************
     I*  DATA AREA LDA - USED IN THE EVENT OF DATABASE ERRORS*
     I********************************************************
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I            DS
     I**********                              1  18 KFMT1                                     CGL029
     I                                        1  24 KFMT1                                     CGL029
     I**********                              1   60KF11                                      CSD027
     I                                        1   6 KF11                                      CSD027
     I                                        7   9 KF12
     I**********                             10  130KF13                                      CGL029
     I**********                             14  150KF14                                      CGL029
     I**********                             16  18 KF15                                      CGL029
     I                                       10  190KF13                                      CGL029
     I                                       20  210KF14                                      CGL029
     I                                       22  24 KF15                                      CGL029
     I            DS
     I**********                              1  18 KFMT2                                     CGL029
     I                                        1  24 KFMT2                                     CGL029
     I                                        1   3 KF21
     I**********                              4   90KF22                                      CSD027
     I                                        4   9 KF22                                      CSD027
     I                                       10  12 KF23
     I**********                             13  160KF24                                      CGL029
     I**********                             17  180KF25                                      CGL029
     I                                       13  220KF24                                      CGL029
     I                                       23  240KF25                                      CGL029
     I            DS
     I                                        1   7 KFMT3
     I                                        1   60KF31
     I            DS
     I                                        1   60ZDATE
     I                                        1   20ZDD
     I                                        3   40ZMM
     I                                        5   60ZYY
     I            DS
     I                                        1  10 CEXA
     I                                        1  108ORATEA
     I            DS
     I                                        1  10 CEXB
     I                                        1  108ORATEB
     I            DS
     I                                        1  10 CEXC
     I                                        1  108ORATEC
     I            DS
     I                                        1   7 CEXG
     I                                        1   70NCEXG
     I            DS
     I                                        1   7 CEXE
     I                                        1   70NCEXE
     I            DS
     I                                        1   7 CEXF
     I                                        1   70NCEXF
     I            DS
     I                                        1   7 CEXD
     I                                        1   70NCEXD
     I            DS
     I                                        1  130RATEDS
     I                                        1  138RATEVL
     I            DS
     I                                        1  12 CCYKEY
     I                                        9  11 CCY
     I                                       12  12 CCYCON
     I            DS
     I                                        1  12 TZFKEY
     I                                        1   2 TZFPRE
     I                                        8  120TZFTRA
     I            DS
     I**********                              1  18 CMKEY                                     CGL029
     I                                        1  24 CMKEY                                     CGL029
     I**********                              1   60XCNUM                                     CSD027
     I                                        1   6 XCNUM                                     CSD027
     I                                        7   9 XCCY
     I**********                             10  130XACOD                                     CGL029
     I**********                             14  150XACSQ                                     CGL029
     I**********                             16  18 XBRCA                                     CGL029
     I                                       10  190XACOD                                     CGL029
     I                                       20  210XACSQ                                     CGL029
     I                                       22  24 XBRCA                                     CGL029
     I            DS
     I                                        2  13 GRPKEY
     I                                        2   30RECT
     I                                        4  13 ZZ010
     I            DS                                                                          CRE083
      *                                                                                       CRE083
      ** End Record Key Data Structure                                                        CRE083
      *                                                                                       CRE083
     I                                        1  24 ENDKEY                                    CRE083
     I                                        1   3 EBRCA                                     CRE083
     I                                        4   9 ECNUM                                     CRE083
     I                                       10  12 ECCY                                      CRE083
     I                                       13  220EACOD                                     CRE083
     I                                       23  240EACSQ                                     CRE083
     I            DS                                                                          CRE083
      *                                                                                       CRE083
      ** Next Record Key Data Structure                                                       CRE083
      *                                                                                       CRE083
     I                                        1  24 NXTKEY                                    CRE083
     I                                        1   3 BRCA                                      CRE083
     I                                        4   9 CNUM                                      CRE083
     I                                       10  12 @CCY                                      CRE083
     I                                       13  220ACOD                                      CRE083
     I                                       23  240ACSQ                                      CRE083
     I            DS                                                                          CRE083
      *                                                                                       CRE083
      ** Last Record Key Data Structure                                                       CRE083
      *                                                                                       CRE083
     I                                        1  24 LSTKEY                                    CRE083
     I                                        1   3 LBRCA                                     CRE083
     I                                        4   9 LCNUM                                     CRE083
     I                                       10  12 LCCY                                      CRE083
     I                                       13  220LACOD                                     CRE083
     I                                       23  240LACSQ                                     CRE083
     I/COPY ZSRSRC,ZINTDYZ1                                                                  CRE090A
     I/COPY ZSRSRC,ZDATE9Z2                                                                  CRE090A
     I/COPY ZSRSRC,ZDAT10Z1                                                                  CRE090A
     ITRATDS      DS                                                                        MD058755
     I                                        1   50XTRAT                                   MD058755
     I                                        1   5 CTRAT                                   MD058755
      *                                                                   CCB003
     ICBTASK    E DSCBTASKSP                                              CCB003
      ** Commitment control size                                          CCB003
      *                                                                   CCB003
     ISDBANK    E DSSDBANKPD
     I*
     I** Bank Details
     I*
     I              BJDNWD                          DNWD
     I              BJRDNB                          RUND
     I*
     ISDCUST    E DSSDCUSTPD
     I*
     I** Customer Details
     I*
     ISDGELR    E DSSDGELRPD
     I              BKAPDT                          APDA
     I*
     I** General Ledger Details
     I*
     ISDRETL    E DSSDRETLPD
     I*
     I** Retail Details
     I*
     I              QQACCD                          ACCDQQ                                    CGL029
     I              BMLDAI                          LDAC
     I              BMNDBI                          NDBI
     I*
     ISCSARD    E DSSCSARDPD                                              CSD007
      ** SAR file details accessed via access program AOSARDR0            CSD007
      *                                                                   CSD007
     IDSFDY     E DSDSFDY
     I*
     I** First DS for access programs, Short data structure
     I*
     IDSSDY     E DSDSSDY
     I*
     I** Second DS for access progrmas, Long data structure
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
      *                                                                   CSD007
     I*
     I/COPY WNCPYSRC,RE3113I001
      *****************************************************************   CCB003
     I/EJECT
      *****************************************************************   CCB003
     C           REAKEY    KLIST
     C                     KFLD           CUST
     C                     KFLD           ACCY
     C                     KFLD           ACOD
     C                     KFLD           ASEQ
     C                     KFLD           BRCA
     C*
     C           REHKEY    KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C*
     C           POPKEY    KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C***********          KFLD           HISD                            101829
     C                     KFLD           @BEG                            101829
     C*
     C           RDKEY     KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           LSTCH1
     C*
     C           RDKEY2    KLIST                                                              158789
     C                     KFLD           BRCA                                                158789
     C                     KFLD           CNUM                                                158789
     C                     KFLD           CCY                                                 158789
     C                     KFLD           ACOD                                                158789
     C                     KFLD           ACSQ                                                158789
      *                                                                                       158789
     C           RCKEY     KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           LSTCH2
     C*
     C           REGKEY    KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA
     C*
     C           COMKEY    KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C*
     C           ACCKEY    KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA
     C*
     C           *LIKE     DEFN DACO      DATE1
     C           *LIKE     DEFN DACO      LSTCDT
     C           *LIKE     DEFN DACO      NXTCDT
     C           *LIKE     DEFN DACO      LSTDDT
     C           *LIKE     DEFN DACO      NXTDDT
     C           *LIKE     DEFN DACO      DIFFDD
     C           *LIKE     DEFN DACO      DIFFMM
     C           *LIKE     DEFN DACO      ENDCMM
     C           *LIKE     DEFN DACO      INACT1
     C           *LIKE     DEFN DACO      INACT2
     C           *LIKE     DEFN CDRR      RATE
     C           *LIKE     DEFN HISB      PHISB
     C           *LIKE     DEFN HISB      HISBX
     C           *LIKE     DEFN HISB      MAXDB
     C           *LIKE     DEFN HISB      MINCBE
     C           *LIKE     DEFN HISB      MINCBC
     C           *LIKE     DEFN HISB      MAXDBE
     C           *LIKE     DEFN HISB      MAXDBC
     C           *LIKE     DEFN HISB      WKVAL1
     C           *LIKE     DEFN HISB      TMAXI
     C           *LIKE     DEFN ZMM       LSTCMM
     C           *LIKE     DEFN ZYY       LSTCYY
     C           *LIKE     DEFN HISD      LSTCH1
     C           *LIKE     DEFN HISD      LSTCH2
     C           *LIKE     DEFN HISD      @BEG                            101829
     C           *LIKE     DEFN HISD      @BEGC                           101829
     C           *LIKE     DEFN HISD      @BEGE                           101829
     C           *LIKE     DEFN HISD      @END                            101829
     C           *LIKE     DEFN HISD      @ENDC                           101829
     C           *LIKE     DEFN HISD      @ENDE                           101829
     C           *LIKE     DEFN HISD      @WK50                           101829
     C           *LIKE     DEFN HISB      WMXCAP                                             CRE090A
     C           *LIKE     DEFN DAIC1     WDRACD                                             CRE090A
     C           *LIKE     DEFN CAIC1     WCRACD                                             CRE090A
      *                                                                   CCB003
      *****************************************************************   CCB003
     C/EJECT
      *****************************************************************   CCB003
     C*                                                               *
     C**         M A I N L I N E                                      *
     C*                                                               *
      *****************************************************************   CCB003
      *                                                                   CCB003
     C           *ENTRY    PLIST                                          CCB003
     C                     PARM           RSTART  1                       CCB003
      *                                                                   CCB003
     C                     OPEN REFIXCPD                                                      CRE083
      *                                                                                       CRE083
     C           RUNONE    IFEQ ' '                                                           CRE083
     C                     MOVE 'Y'       RUNONE  1                                           CRE083
     C                     EXSR INIT
     C                     ENDIF                                                              CRE083
      *                                                                                       CRE083
      ** Initialise work fields for re-run of program.                                        CRE083
      *                                                                                       CRE083
     C                     Z-ADD1         #COMIT                                              CRE083
     C                     Z-ADD*ZERO     TOTDIN                                              CRE083
     C                     Z-ADDTOTCDI    TOTCDI                                              CRE083
      *                                                                   CCB003
     C***********          WRITEHEADAU                                    CCB003
     C*                                                               *
     C**         Determine if any type of commission is               *
     C**         to be calculated for current account record.         *
     C*                                                               *
     C***********REHKEY    SETLLREHISBN                                   CCB003
      *                                                                   CCB003
      ** Read END key from REFIXCPD                                                           CRE083
      *                                                                                       CRE083
     C                     MOVE 'Z'       IXCKEY  1                                           CRE083
     C           IXCKEY    CHAINREFIXCPD             38                                       CRE083
     C           *IN38     IFEQ '0'                                                           CRE083
     C                     MOVE BRCA      EBRCA                                               CRE083
     C                     MOVE CNUM      ECNUM                                               CRE083
     C                     MOVE CCY       ECCY                                                CRE083
     C                     MOVE ACOD      EACOD                                               CRE083
     C                     MOVE ACSQ      EACSQ                                               CRE083
     C                     END                                                                CRE083
      *                                                                                       CRE083
      ** Read START key from REFIXCPD                                                         CRE083
      *                                                                                       CRE083
     C           *IN38     IFEQ '0'                                                           CRE083
     C                     MOVE 'A'       IXCKEY                                              CRE083
     C           IXCKEY    CHAINREFIXCPD             38                                       CRE083
     C                     END                                                                CRE083
      *                                                                                       CRE083
     C           *IN38     IFEQ '1'                                                           CRE083
     C                     EXSR ERROR                                                         CRE083
     C                     END                                                                CRE083
      *                                                                                       CRE083
      ** Set pointer to the first record.                                                     CRE083
      *                                                                                       CRE083
     C                     MOVE CCY       @CCY                                                CRE083
     C                     MOVE '0'       *IN19                                               CRE083
     C           NXTKEY    IFGT ENDKEY                                                        CRE083
     C           NXTKEY    OREQ ENDKEY                                                        CRE083
     C           PROT      ANDEQ'C'                                                           CRE083
     C                     MOVE '1'       *IN19                                               CRE083
     C                     END                                                                CRE083
      *                                                                                       CRE083
     C           *IN19     IFEQ '0'                                                           CRE083
      *                                                                                       CRE083
     C           PROT      IFEQ ' '                                                           CRE083
     C           REHKEY    SETLLREHISBN                                                       CRE083
     C                     ELSE                                                               CRE083
     C           REHKEY    SETGTREHISBN                                                       CRE083
     C                     END                                                                CRE083
      *                                                                                       CRE083
     C**********           READ REHISPBF                 LR                                   CRE083
     C                     READ REHISPBF                 19                                   CRE083
     C                     ENDIF                                                              CRE083
      *                                                                   CCB003
     C********** *INLR     DOWEQ'0'                        -B1                                CRE083
     C           *IN19     DOWEQ'0'                        -B1                                CRE083
     C                     EXSR SELE
     C*                                                               *
     C**         Calculate the commission payable.                    *
     C*                                                               *
     C           RECIX     IFEQ 'D'                        -B2
     C                     EXSR MAIN
     C*                                                               *
     C**         If historic record has been read                     *
     C**         and commision indicators set process record.         *
     C*                                                               *
     C           *IN23     IFEQ '1'                        -B3
     C           *IN25     OREQ '1'                         OR
     C                     EXSR SRPOST
     C                     END                             -E3
     C*                                                               *
     C**         At Total-Time processing consider if totaling        *
     C**         for historic postings needs to be carried out.       *
     C**         Then write the payment details to RECOM.             *
     C*                                                               *
     C                     EXSR L0CHK
     C                     END                             -E2
      *                                                                   CCB003
      ***Access*output*file*REHISBN****                                                CCB003 CRE083
      *                                                                   CCB003
     C********** REHKEY    CHAINREHISBN              52                                CCB003 CRE083
      *                                                                   CCB003
     C********** *IN52     IFEQ '1'                        -B2                         CCB003 CRE083
     C********** *LOCK     IN   LDA                                                    CCB003 CRE083
     C**********           MOVE BRCA      KF21                                         CCB003 CRE083
     C**********           Z-ADDCNUM      KF22                                         CCB003 CSD027
     C**********           MOVE CNUM      KF22                                         CSD027 CRE083
     C**********           MOVE CCY       KF23                                         CCB003 CRE083
     C**********           Z-ADDACOD      KF24                                         CCB003 CRE083
     C**********           Z-ADDACSQ      KF25                                         CCB003 CRE083
     C**********           MOVEL'REHISBN' DBFILE           ************                CCB003 CRE083
     C**********           MOVELKFMT2     DBKEY            * DBERR 10 *                CCB003 CRE083
     C**********           Z-ADD10        DBASE            ************                CCB003 CRE083
     C**********           EXSR ERROR                                                  CCB003 CRE083
     C**********           ENDIF                                                       CCB003 CRE083
     C*
     C           BADTY     IFEQ 'Y'                        -B2
     C***********          MOVE *BLANKS   BADTY                           CCB003
     C***********          UPDATREHISPBF                                  CCB003
     C**********           MOVE *BLANKS   CADTY                                        CCB003 CRE083
     C**********           UPDATREHISPB1                                               CCB003 CRE083
     C                     MOVE *BLANKS   BADTY                                               CRE083
     C                     UPDATREHISPBF                                                      CRE083
     C                     END                             -E2
     C*
      ** Increase number of records processed                             CCB003
     C                     ADD  1         #COMIT                          CCB003
      *                                                                   CCB003
      ***Delete*record*from*driving*file***                                            CCB003 CRE083
     C**********           DELETREHISPBF                                               CCB003 CRE083
      *                                                                   CCB003
      ** Comit if restart status = 'Y' or number of records processed     CCB003
      ** has reached optimum defined in CBTASKSP                          CCB003
     C                     MOVE CCY       @CCY                                                CRE083
     C                     MOVE NXTKEY    LSTKEY                                              CRE083
     C           RSTART    IFEQ 'Y'                                       CCB003
     C           #COMIT    OREQ #OPTIM                                    CCB003
     C                     EXSR UPDPTR                                                        CRE083
     C                     COMIT
     C                     Z-ADD0         #COMIT                          CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C**********           READ REHISPBF                 LR                                   CRE083
     C                     READ REHISPBF                 19                                   CRE083
      *                                                                                       CRE083
      ** Check if end record is read.                                                         CRE083
      **                                                                                      CRE083
     C           *IN19     IFEQ '0'                                                           CRE083
     C                     MOVE CCY       @CCY                                                CRE083
     C           NXTKEY    IFGT ENDKEY                                                        CRE083
     C                     MOVE '1'       *IN19                                               CRE083
     C                     END                                                                CRE083
     C                     END                                                                CRE083
     C           *IN19     IFEQ '1'                                                           CRE083
     C                     MOVE LSTKEY    NXTKEY                                              CRE083
     C                     END                                                                CRE083
     C                     END                             -E1
      *                                                                   CCB003
      ** Comit if no records left in driving file and number of           CCB003
      ** records processed is not 0                                       CCB003
     C********** *INLR     IFEQ '1'                                                    CCB003 CRE083
     C           *IN19     IFEQ '1'                                                           CRE083
     C           #COMIT    ANDGT0                                         CCB003
     C                     EXSR UPDPTR                                                        CRE083
     C                     COMIT                                          CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
      ** Release record lock and close file.                                                  CRE083
      *                                                                                       CRE083
     C           @FIRST    IFEQ 'Y'                                       CCB003
     C                     CLOSERE3113AU                                  CCB003
     C                     MOVE ' '       @FIRST                                              CRE083
     C                     ENDIF                                          CCB003
     C                     UNLCKREHISBN                                                       CRE083
     C                     UNLCKRECOM                                                         CRE083
     C                     CLOSEREFIXCPD                                                      CRE083
     C                     RETRN                                                              CRE083
     C*
     C************INU7     IFEQ '0'                                       CCB003
     C************INU8     ANDEQ'0'                                       CCB003
     C************         COMIT                                          CCB003
     C************         END                                            CCB003
      *                                                                   CCB003
      *****************************************************************   CCB003
     C/EJECT
     C*****************************************************************
     C           STMT      BEGSR
     C           CEXF      IFNE *BLANKS                    - B3
     C           NOIS      MULT NCEXF     NOIP
     C                     ELSE                            - X3
     C           NOIS      MULT MX7,I1    NOIP
     C                     END
     C*
     C**         Include any manual adjustments to the enquiry value.
     C*
     C                     ADD  CCINST    NOIP
     C*
     C                     ENDSR
     C*****************************************************************
     C*                                                               *
     C*          ---   INDEX TO SUBROUTINES   ---                     *
     C*                                                               *
     C* 1        INIT   :   First cycle of program processing.        *
     C*                                                               *
     C* 2        SELE   :   Selection test for commission calculation.*
     C* 2.1      SELE1  :     Test for account exemption.             *
     C* 2.2      SELE2  :     Test for client group exemption.        *
     C*                                                               *
     C* 3        MAIN   :   Mainline for commission calculation.      *
     C*                                                               *
     C* 3.1      SR000  :   Retrieve ICD by currency details.         *
     C* 3.2      SR100  :   Determine if account capitalising.        *
     C* 3.3      SR200  :   Calculate fixed commission.               *
     C*                       interest.                               *
     C* 3.4      SR400  :     Initial processing for other commissions*
     C* 3.4.1    POST20 :     Calculate highest debit balance         *
     C*                       commission.                             *
     C* 4        SRPOST :     Calculate other commissions.            *
     C* 4.1      POST10 :     Calculate inactive account commission.  *
     C* 4.2      POST30 :     Calculate minimum credit balance        *
     C*                       commission.                             *
     C* 4.3      INACDT :     Calculate start & end date to determine *   101829
     C*                       greatest period of inactivity.          *   101829
     C* 5        L0CHK  :     Check if total processing needed.       *
     C* 5.1      L0TOT  :     Determine total processing/commision type
     C* 5.1.1    LSR100 :     Total processing for other (inactive    *
     C*                       account) commissions.                   *
     C* 5.1.1.1  LSR110 :     Search array DYS for No. of inactive days
     C* 5.1.2    LSR200 :     Total processing for other (highest debit
     C*                       balance) commissions.                   *
     C* 5.1.2.1  LSR210 :     Calc capitalisation on highest debit bal.
     C* 5.1.2.2  LSR220 :     Calc initial value for highest debit bal.
     C* 5.1.3    LSR300 :     Total processing for other (minumum     *
     C*                       credit balance) commissions.            *
     C* 5.1.3.1  LSR310 :       Capitalisation of commission on minimum
     C*                         credit balance.                       *
     C* 5.2      L0UPDT :     Output RECOM details.                   *
     C* 6        UPDPTR :     Update REFIXCPD with Start Key for      *                       CRE083
     C*                       restart                                 *                       CRE083
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  INIT subroutine to perform the following:                   *
     C**      (i)   read all retail ICD by currency records (up to 150)
     C**            and store relevant data in an internal array ;    *
     C**      (ii)  read up to eight group records and store relevant *
     C**            data in an internal array ;                       *
     C**      (iii) read retail ICD record ;                          *
     C**      (iv)  read installation control record 1 ;              *
     C**      (v)   read installation control record 2.               *
     C**                                                              *
     C**  Called By:  Mainline code.                                  *
     C**  Calls:      -                                               *
     C**                                                              *
     C**  Arrays:                                                     *
     C**                                                              *
     C*****************************************************************
     C           INIT      BEGSR                           **  INIT
      *                                                                   CCB003
      ** Set up copyright parameter                                       CCB003
     C                     MOVEACPY@      BIS@   80
      *                                                                   CCB003
      ** Define LDA                                                       CCB003
     C           *NAMVAR   DEFN           LDA
      *                                                                   CCB003
      ** Access data area CBTASKSP for commit block size                  CCB003
     C           *NAMVAR   DEFN CBTASKSP  CBTASK                          CCB003
     C                     IN   CBTASK                                    CCB003
     C**********           MOVE CMTBLK    #OPTIM  60                                   CCB003 CRE083
     C                     MOVE CMTBLK    #OPTIM 100                                          CRE083
      *                                                                   CCB003
      ** Set commit counter to 1                                          CCB003
     C                     Z-ADD1         #COMIT  60                      CCB003
      *                                                                   CCB003
     C                     SETOF                     98
     C                     Z-ADDTOTDIN    TOTDIN 152
     C                     Z-ADDTOTCDI    TOTCDI 152
     C                     MOVE 'D'       CCYCON
     C                     MOVE *BLANKS   TZFKEY
     C                     MOVE '41'      TZFPRE
     C*                                                               *
     C**         Read up to 150 retail ICD by currency records        *
     C**         and store details in internal arrays.                *
     C*                                                               *
     C************         Z-ADD0         I1      30                                        MD037176
     C                     Z-ADD0         I1      40                                        MD037176
     C           *LOVAL    SETLLRECCY
     C           *IN10     DOUEQ'1'
     C                     READ RECCY                    10
     C           *IN10     IFEQ '0'
     C                     ADD  1         I1
     C                     MOVE RECKEY    ICC,I1
     C*                                                               *
     C**         Account commission                                   *
     C*                                                               *
     C                     Z-ADDACRT      RT6,I1
     C                     Z-ADDACMX      MX6,I1
     C                     Z-ADDACMN      MN6,I1
     C*                                                               *
     C**         Statement commission.
     C*
     C                     Z-ADDDSFC      MX7,I1
     C*
     C**         Fixed commission.                                    *
     C*                                                               *
     C                     Z-ADDFCFC      MX1,I1
     C*                                                               *
     C**         Debit interest commission.                           *
     C*                                                               *
     C                     Z-ADDDIRT      RT2,I1
     C                     Z-ADDDIMX      MX2,I1
     C                     Z-ADDDIMN      MN2,I1
     C*                                                               *
     C**         Inactive account commission.                         *
     C*                                                               *
     C                     Z-ADDINFC      MX3,I1
     C*                                                               *
     C**         Highest debit balance commission.                    *
     C*                                                               *
     C                     Z-ADDHORT      RT4,I1
     C                     Z-ADDHOMX      MX4,I1
     C                     Z-ADDHOMN      MN4,I1
     C*                                                               *
     C**         Minimum credit balance commission.                   *
     C*                                                               *
     C                     Z-ADDAMBC      M5A,I1
     C                     Z-ADDAMBS      M5B,I1
     C                     Z-ADDMCFC      M5C,I1
     C                     Z-ADDMSFC      M5D,I1
     C*                                                               *
     C           I1        IFEQ 150
     C                     SETON                     10
     C                     END
     C                     END
     C                     END
     C           I1        DOWLT150
     C                     ADD  1         I1
     C                     MOVE *HIVAL    ICC,I1
     C                     END
     C*                                                               *
     C**         Read up to eight group records and store relevant    *
     C**         details in internal arrays.                          *
     C*                                                               *
     C                     Z-ADD0         I1
     C********** 1         SETLLTABLEV4F                                                    MD058854
     C           1         SETLLTABV4XTD                                                    MD058854
     C*
     C           *IN10     DOUEQ'1'
     C**********           READ TABLEV4F                 10                                 MD058854
     C                     READ TABV4XTD                 10                                 MD058854
     C           *IN10     IFEQ '0'
     C                     ADD  1         I1
     C                     MOVE GRPKEY    GRP,I1
     C                     MOVE DYSI      IN7,I1
     C                     MOVE FIXI      IN1,I1
     C                     MOVE DINI      IN2,I1
     C                     MOVE INAI      IN3,I1
     C                     MOVE MDBI      IN4,I1
     C                     MOVE MINI      IN5,I1
     C                     MOVE ACMI      IN6,I1
     C           I1        IFEQ 8
     C                     SETON                     10
     C                     END
     C                     END
     C                     END
     C           I1        DOWLT8
     C                     ADD  1         I1
     C                     MOVE *HIVAL    GRP,I1
     C                     END
     C*                                                               *
     C**         Setup Transaction types Array                        *
     C*                                                               *
     C                     Z-ADD*HIVAL    TRT
     C                     Z-ADD0         I1
     C********** 1         SETLLTABLETZF                                                    MD058755
     C           1         SETLLSDRTRXT0                                                    MD058755
     C                     SETOF                     10
     C           *IN10     DOUEQ'1'
     C**********           READ TABLETZF                 10                                 MD058755
     C                     READ SDRTRXTD                 10                                 MD058755
     C           *IN10     IFEQ '0'
     C********** RECI      IFEQ 'D'                                                         MD058755
     C********** CUOR      IFEQ 'Y'                                                         MD058755
     C           A1COIN    IFEQ 'Y'                                                         MD058755
     C                     MOVELA1RTTY    CTRAT                                             MD058755
     C                     ADD  1         I1
     C**********           Z-ADDTRAT      TRT,I1                                            MD058755
     C                     Z-ADDXTRAT     TRT,I1                                            MD058755
     C                     END
     C**********           END                                                              MD058755
     C                     END
     C                     END                             ENDDO
     C*                                                               *
     C**         Read retail ICD record.                              *
     C*                                                               *
     C                     CALL 'AORETLR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDRETL    PARM SDRETL    DSFDY
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'SDRETLPD'DBFILE           ***************
     C                     Z-ADD1         DBASE            * DB ERROR 01 *
     C                     EXSR ERROR                      ***************
     C                     END
     C*
     C** ACCESS RETAIL ICD TABTBRE FOR COMMISSION ON
     C*
     C           1         SETLLTABTBRE
     C                     READ TABTBRE                  10
     C           *IN10     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'TABTBRE' DBFILE           ***************
     C                     Z-ADD6         DBASE            * DB ERROR 06 *
     C                     EXSR ERROR                      ***************
     C                     END
     C*                                                               *
     C**         Read installation control record 1.                  *
     C*                                                               *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'SDBANKPD'DBFILE           ***************
     C                     Z-ADD2         DBASE            * DB ERROR 02 *
     C                     EXSR ERROR                      ***************
     C                     END
     C*                                                               *
     C***********Set array period for Inactive Commission             *   101829
     C*                                                               *
     C***********DNWD      SUB  365       LYEAR   50                      101829
     C           DNWD      SUB  1         @DNWD1  50                      101829
     C*                                                               *
     C**         Read installation control record 2.                  *
     C*                                                               *
     C/COPY WNCPYSRC,RE3113C010
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C/COPY WNCPYSRC,RE3113C011
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'SDGELRPD'DBFILE           ***************
     C                     Z-ADD3         DBASE            * DB ERROR 03 *
     C                     EXSR ERROR                      ***************
     C                     END
      *                                                                   CSD007
      ** Access SAR details to check if 'Customer Closing' is             CSD007
      ** installed.                                                       CSD007
      *                                                                   CSD007
     C                     MOVE 'N'       CSD007  1                       CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   PRTCD   7                       CSD007
     C                     PARM '*VERIFY' POPTN   7                       CSD007
     C                     PARM 'CSD007'  PSARD   6                       CSD007
     C           SCSARD    PARM SCSARD    DSFDY                           CSD007
      *                                                                   CSD007
     C           PRTCD     IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007                          CSD007
     C                     ELSE                                           CSD007
     C           PRTCD     IFNE '*NRF   '                                 CSD007
     C                     MOVE 'SCSARDPD'DBFILE                          CSD007
     C                     MOVEL'CSD007'  DBKEY                           CSD007
     C                     Z-ADD4         DBASE                           CSD007
     C                     EXSR ERROR                                     CSD007
     C                     ENDIF                                          CSD007
     C                     ENDIF                                          CSD007
      *                                                                                       CRE027
      ** Access SAR details to check if CRE027 is installed                                   CRE027
      *                                                                                       CRE027
     C                     MOVE 'N'       CRE027  1                                           CRE027
     C                     CALL 'AOSARDR0'                                                    CRE027
     C                     PARM *BLANKS   PRTCD   7                                           CRE027
     C                     PARM '*VERIFY' POPTN   7                                           CRE027
     C                     PARM 'CRE027'  PSARD   6                                           CRE027
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE027
      *                                                                                       CRE027
     C           PRTCD     IFEQ *BLANKS                                                       CRE027
     C                     MOVE 'Y'       CRE027                                              CRE027
     C                     ENDIF                                                              CRE027
      *                                                                                      CRE090A
      ** Check if CRE090 is installed                                                        CRE090A
      *                                                                                      CRE090A
     C                     CALL 'AOSARDR0'                                                   CRE090A
     C                     PARM *BLANKS   PRTCD                                              CRE090A
     C                     PARM '*VERIFY' POPTN                                              CRE090A
     C                     PARM 'CRE090'  PSARD                                              CRE090A
     C           SCSARD    PARM SCSARD    DSFDY                                              CRE090A
      *                                                                                      CRE090A
     C********** @RTCD     IFEQ *BLANKS                                             CRE090A MD026867
     C           PRTCD     IFEQ *BLANKS                                                     MD026867
     C                     MOVEL'Y'       CRE090  1                                          CRE090A
     C                     ELSE                                                              CRE090A
     C                     MOVEL'N'       CRE090                                             CRE090A
     C                     ENDIF                                                             CRE090A
     C*                                                               *
     C***********Set*KLIST*to*low*value.                              *   CCB003
     C***********                                                     *   CCB003
     C***********          MOVE *BLANK    BRCA                            CCB003
     C***********          Z-ADD*ZERO     CNUM                            CCB003
     C***********          MOVE *BLANK    CCYA                            CCB003
     C***********          Z-ADD*ZERO     ACOD                            CCB003
     C***********          Z-ADD*ZERO     ACSQ                            CCB003
     C*
     C/COPY WNCPYSRC,RE3113C001
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SELE subroutine determines which of the five (if any)       *
     C**  account commissions are to be calculated for the current    *
     C**  account record read.                                        *
     C**                                                              *
     C**  Called By:  Mainline code.                                  *
     C**  Calls:      SELE1                                           *
     C**              SELE2                                           *
     C**                                                              *
     C**  Indicators: 21 ON  -  Fixed commission applicable.          *
     C**              22 ON  -  Debit interest commission applicable. *
     C**              23 ON  -  Inactive account commission applicable.*
     C**              24 ON  -  Highest debit balance commission      *
     C**                        applicable.                           *
     C**              25 ON  -  Minimum credit balance commission     *
     C**                        applicable.                           *
     C**              29 ON  -  Statement commission                  *
     C**                                                              *
     C**  Arrays:     IN1    -  Fixed commission flag.                *
     C**              IN2    -  Debit interest commission flag.       *
     C**              IN3    -  Inactive account commission flag.     *
     C**              IN4    -  Highest debit balance commission flag.*
     C**              IN5    -  Minimum credit balance commission flag.*
     C**                                                              *
     C**                                                              *
      *****************************************************************   CCB003
     C           SELE      BEGSR                           **  SELE
     C*                                                               *
     C**         Assume that all four commissions are to be calculated.*
     C**         Commission on debit interest is calculated on line for*
     C**         Enquiry and by re3116 for capitalisation this due to *
     C**         calculation of TEG.                                  *
     C*                                                               *
     C                     MOVEA'00000'   *IN,21
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN29
     C*                                                               *
     C           CNDS      COMP 'Y'                      29
     C           FXAC      COMP 'Y'                      21
     C           CDRI      COMP 'Y'                      22
     C           CINA      COMP 'Y'                      23
     C           CHOV      COMP 'Y'                      24
     C           CMBL      COMP 'Y'                      25
     C           CDTO      COMP 'Y'                      28
     C*                                                               *
     C**         Test for account exemption.                          *
     C*                                                               *
     C                     EXSR SELE1
     C*                                                               *
     C**         Test for client group exemption if account exemptions*
     C**         don't already apply.                                 *
     C*                                                               *
     C           *IN21     IFEQ '1'
     C           *IN22     OREQ '1'
     C           *IN23     OREQ '1'
     C           *IN24     OREQ '1'
     C           *IN25     OREQ '1'
     C           *IN28     OREQ '1'
     C           *IN29     OREQ '1'
     C                     EXSR SELE2
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SELE1 subroutine determines if the account is exempt from   *
     C**  commission calculations.                                    *
     C**                                                              *
     C**  Called By:  SELE                                            *
     C**  Calls:      -                                               *
     C**                                                              *
     C**  Indicators: As per SELE                                     *
     C**                                                              *
     C**  Arrays:     -                                               *
     C**                                                              *
      *****************************************************************   CCB003
     C           SELE1     BEGSR                           **  SELE1
     C*                                                               *
     C**         Get Account record                                   *
     C*                                                               *
     C           ACCKEY    CHAINACCNTABF             10
     C*                                                               *
     C**         If account close process next record                 *
     C*                                                               *
     C           *IN10     IFEQ '1'                        -B1
     C           RECIX     ORNE 'D'
     C           COMKEY    CHAINRECOMDF              10
     C           *IN10     IFEQ '0'                        -B2
     C           RECI      ANDEQ'D'
     C*                                                               *
     C**         Initialise output RECOM fields.                      *
     C*                                                               *
     C                     Z-ADD*ZERO     ACCC
     C                     Z-ADD*ZERO     ACCEA
     C                     Z-ADD*ZERO     ACCRA
     C                     Z-ADD*ZERO     GVDPC
     C                     Z-ADD*ZERO     GVDPE
     C                     MOVE *BLANKS   MMACC
     C*                                                               *
     C                     Z-ADD*ZERO     FXDC
     C                     Z-ADD*ZERO     CDIE
     C                     Z-ADD*ZERO     CDICA
     C                     Z-ADD*ZERO     CDRR
     C                     MOVE *BLANKS   MMCDI
     C                     Z-ADD*ZERO     IACE
     C                     Z-ADD*ZERO     IACCC
     C                     Z-ADD*ZERO     CMBE
     C                     Z-ADD*ZERO     CMBC
     C                     Z-ADD*ZERO     CHDBE
     C                     Z-ADD*ZERO     CHDBC
     C                     MOVE *BLANKS   MMCHDB
     C                     Z-ADD*ZERO     HDRB
     C                     Z-ADD*ZERO     CHDBR
     C                     Z-ADD*ZERO     ACCB
     C                     Z-ADD*ZERO     NOIP
     C                     Z-ADD*ZERO     NOIS
     C                     Z-ADD*ZERO     NOCC
     C                     MOVE 'C'       RECI
     C                     UPDATRECOMDF                                ***
     C                     END                             -E2         0 *
     C                     MOVEA'00000'   *IN,21                       ***
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN29
     C                     MOVE 'C'       RECIX
     C*                                                               *
     C**         Account is live .                                    *
     C*                                                               *
     C                     ELSE                            -X1
      *                                                                                      CRE090A
      ** Check if delay date = run date                                                      CRE090A
      *                                                                                      CRE090A
     C                     MOVE 'N'       WDRDLY  1                                          CRE090A
     C                     MOVE 'N'       WCRDLY  1                                          CRE090A
     C           CRE090    IFEQ 'Y'                                                          CRE090A
     C           NDID      IFLT RUND                                                         CRE090A
     C           NDID      ANDNE0                                                            CRE090A
     C           BDICI     ANDEQ'Y'                                                          CRE090A
     C                     MOVE 'Y'       WDRDLY                                             CRE090A
     C                     ENDIF                                                             CRE090A
     C           NCID      IFLT RUND                                                         CRE090A
     C           NCID      ANDNE0                                                            CRE090A
     C           BCICI     ANDEQ'Y'                                                          CRE090A
     C                     MOVE 'Y'       WCRDLY                                             CRE090A
     C                     ENDIF                                                             CRE090A
     C                     ENDIF                                                             CRE090A
     C/COPY WNCPYSRC,RE3113C007
     C*                                                               *
     C**         No commission for secondary account                  *
     C*                                                               *
     C           LTAC      IFNE *ZERO                      -B2
     C           CRE027    ANDEQ'N'                                                           CRE027
     C/COPY WNCPYSRC,RE3113C008
     C                     MOVEA'00000'   *IN,21
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN29
     C                     END                             -E2
     C                     EXSR SR000
     C*
     C**         Statement Commission
     C*
     C           CEXF      IFEQ 'E'                        -B2
     C                     SETOF                     29
     C                     END                             -E2
     C*                                                               *
     C**         Fixed commission.                                    *
     C*                                                               *
     C           CEXG      IFEQ 'E'                        -B2
     C                     SETOF                     21
     C                     END                             -E2
     C*                                                               *
     C**         Debit interest commission.                           *
     C*                                                               *
     C           CEXC      IFEQ 'E'
     C                     SETOF                     22
     C                     END
     C*                                                               *
     C**         Inactive account commission.                         *
     C*                                                               *
     C           CEXD      IFEQ 'E'                        -B2
     C                     SETOF                     23
     C                     END                             -E2
     C*                                                               *
     C**         Highest debit balance commission.                    *
     C*                                                               *
     C           CEXA      IFEQ 'E'                        -B2
     C                     SETOF                     24
     C                     END                             -E2
     C*                                                               *
     C**         Minimum credit balance commission.                   *
     C*                                                               *
     C           CEXE      IFEQ 'E'                        -B2
     C                     SETOF                     25
     C                     END                             -E2
     C*                                                               *
     C**         ACCNT COMMISSION                                     *
     C*                                                               *
     C           CEXB      IFEQ 'E'                        -B2
     C                     SETOF                     28
     C                     END                             -E2
     C                     END                             -E1
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SELE2 subroutine determines if the client group is exempt   *
     C**  from commission calculations.                               *
     C**                                                              *
     C**  Called By:  SELE                                            *
     C**  Calls:      -                                               *
     C**                                                              *
     C**  Indicators: As per SELE                                     *
     C**                                                              *
     C**  Arrays:     As per SELE                                     *
     C**                                                              *
      *****************************************************************   CCB003
     C           SELE2     BEGSR                           **  SELE2
     C*
     C           CNUM      IFNE #CNUM                                                       CRE083BR
     C                     MOVELCNUM      #CNUM   6
     C*
     C***********          CALL 'AOCUSTR0'                                CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM #CNUM     @KEY1  10
     C                     PARM           @KEYST  7
     C***********SDCUST    PARM SDCUST    DSSDY                           CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE *BLANKS
     C           CSD007    ANDNE'Y'                                       CSD007
      *                                                                   CSD007
     C           @RTCD     ORNE *BLANKS                                   CSD007
     C           @RTCD     ANDEQ'*NRF   '                                 CSD007
     C           BBDTDL    ANDNE*ZEROS                                    CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C           @RTCD     ORNE *BLANKS                                   CSD007
     C           @RTCD     ANDNE'*NRF   '                                 CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C           *LOCK     IN   LDA
     C                     MOVEL#CNUM     DBKEY
     C                     MOVEL'SDCUSTPD'DBFILE           ***************
     C                     Z-ADD4         DBASE            * DB ERROR 04 *
     C                     EXSR ERROR                      ***************
     C                     END
     C                     ENDIF                                                            CRE083BR
     C*
     C           BBCGRP    IFEQ *BLANK                                    075264
     C                     MOVE '1'       BBCGRP                          075264
     C                     END                                            075264
     C*                                                                   075264
     C                     MOVE *BLANKS   GRPKEY
     C                     MOVEL'81'      GRPKEY
     C                     MOVE BBCGRP    GROUP   10
     C           GROUP     IFLT 1
     C           GROUP     ORGT 8
     C                     MOVE BBCGRP    CTYP    1
     C                     EXSR CHKOVR
     C                     WRITEGRPERR
     C                     MOVE 8         BBCGRP
     C                     END
     C                     MOVE BBCGRP    GRPKEY
     C                     Z-ADD1         I3      20
     C           GRPKEY    LOKUPGRP,I3                   10
     C*
     C           *IN10     IFNE '1'                        -B1
     C           *LOCK     IN   LDA
     C                     MOVELGRPKEY    DBKEY
     C                     MOVEL'TABLEV4' DBFILE           ***************
     C                     Z-ADD5         DBASE            * DB ERROR 05 *
     C                     EXSR ERROR                      ***************
     C                     END                             -E1
     C*
     C**         Statement commission.
     C*
     C           *IN29     IFEQ '1'                        -B1
     C           IN7,I3    ANDNE'Y'
     C                     SETOF                     29
     C                     END                             -E1
     C*                                                               *
     C**         Fixed commission.                                    *
     C*                                                               *
     C           *IN21     IFEQ '1'                        -B1
     C           IN1,I3    ANDNE'Y'
     C                     SETOF                     21
     C                     END                             -E1
     C*                                                               *
     C**         Debit interest commission.                           *
     C*                                                               *
     C           *IN22     IFEQ '1'
     C           IN2,I3    ANDNE'Y'
     C                     SETOF                     22
     C                     END
     C*                                                               *
     C**         Inactive account commission.                         *
     C*                                                               *
     C           *IN23     IFEQ '1'                        -B1
     C           IN3,I3    ANDNE'Y'
     C                     SETOF                     23
     C                     END                             -E1
     C*                                                               *
     C**         Highest debit balance commission.                    *
     C*                                                               *
     C           *IN24     IFEQ '1'                        -B1
     C           IN4,I3    ANDNE'Y'
     C                     SETOF                     24
     C                     END                             -E1
     C*                                                               *
     C**         Minimum credit balance commission.                   *
     C*                                                               *
     C           *IN25     IFEQ '1'                        -B1
     C           IN5,I3    ANDNE'Y'
     C                     SETOF                     25
     C                     END                             -E1
     C*                                                               *
     C**         ACCNT COMMISSION                                     *
     C*                                                               *
     C           *IN28     IFEQ '1'                        -B1
     C           IN6,I3    ANDNE'Y'
     C                     SETOF                     28
     C                     END                             -E1
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  Called By:  Mainline code.                                  *
     C**  Calls: SR000, SR100 ,SR200, SR400                           *
     C**                                                              *
     C**  Arrays:                                                     *
     C**                                                              *
     C**                                                              *
      *****************************************************************   CCB003
     C           MAIN      BEGSR                           **  MAIN
     C*                                                               *
     C**         Retrieve retail ICD by currency details.             *
     C**         and access RECOM file                                *
     C*
     C*                                                               *
     C**         Determine if account capitalising.                   *
     C*                                                               *
     C                     EXSR SR100
     C*                                                               *
     C**         Calculate Statement commission if applicable.        *
     C*                                                               *
     C           *IN29     IFEQ '1'                        -B1
     C                     EXSR STMT
     C                     END                             -E1
     C*                                                               *
     C**         Calculate fixed commission if applicable.            *
     C*                                                               *
     C           *IN21     IFEQ '1'                        -B1
     C                     EXSR SR200
     C                     END                             -E1
     C*                                                               *
     C**         Calculate debit interest commission if applicable.   *
     C*                                                               *
     C           *IN22     IFEQ '1'
     C                     EXSR SR300
     C                     END
     C*                                                               *
     C**         Calculate other commissions where applicable.        *
     C*                                                               *
     C           *IN23     IFEQ '1'                        -B1
     C           *IN24     OREQ '1'
     C           *IN25     OREQ '1'
     C                     EXSR SR400
     C                     END                             -E1
     C*
     C           *IN27     IFEQ '1'                        -B1
     C           CEXB      ANDNE'E'
     C           *IN28     ANDEQ'1'
     C           LTAC      ANDEQ*ZERO
     C           CACDC     ANDNE'D'
     C/COPY WNCPYSRC,RE3113C009
     C                     EXSR ACCPR
     C                     END                             -E1
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C*    ACCPR    . account commission capitalisation
     C*
      *****************************************************************   CCB003
     C           ACCPR     BEGSR                           *** ACCRP  **
     C*
     C           CEXB      IFNE *BLANKS
     C                     MOVE CEXB      RATE
     C                     ELSE
     C                     Z-ADDRT6,I1    RATE
     C                     END
     C                     Z-ADDGVDPE     GVDPC
     C*
     C*    ACCOUNT COMMISSION IS CALCULATED
     C*
     C           GVDPC     MULT RATE      TOTAL  150
     C           TOTAL     DIV  100       TOTAL
     C*
     C*    BELOW MINIMUM COMMISSION
     C*
     C           TOTAL     IFLE MN6,I1
     C                     MOVE MN6,I1    ACCC
     C                     MOVE 'MIN'     MMACC
     C/COPY WNCPYSRC,RE3113C002
     C*
     C*    ABOVE MAXIMUM COMMISSION
     C*
     C                     ELSE
     C           TOTAL     IFGE MX6,I1
     C                     MOVE MX6,I1    ACCC
     C                     MOVE 'MAX'     MMACC
     C*
     C*    NOT BELOW MNIMUM AND NOT ABOVE MAXIMUM COMMISSION
     C*
     C                     ELSE
     C                     MOVE TOTAL     ACCC
     C                     MOVE *BLANKS   MMACC
     C                     END
     C                     END
     C                     Z-ADDRATE      ACCRA
     C                     Z-ADD*ZERO     GVDPE
     C                     Z-ADD*ZERO     ACCEA
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SR000 subroutine retrieves retail ICD details based on      *
     C**  the account currency code.                                  *
     C**                                                              *
     C**  Called By:  MAIN                                            *
     C**  Calls:      -                                               *
     C**                                                              *
     C**  Indicators:                                                 *
     C**                                                              *
     C**  Arrays:                                                     *
     C**                                                              *
      *****************************************************************   CCB003
     C           SR000     BEGSR
     C*
     C                     MOVE CCYKEY    RECKEY
     C                     Z-ADD1         I1
     C           RECKEY    LOKUPICC,I1                   10
     C*
     C           *IN10     IFNE '1'                        -B1
     C                     EXSR CCYICD
     C                     END                             -E1
     C*                                                               *
     C**         Access RECOM file                                    *
     C*                                                               *
     C           COMKEY    CHAINRECOM                10
     C           *IN10     IFEQ '1'                        -B1
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA
     C**********           Z-ADDCNUM      XCNUM                                               CSD027
     C                     MOVE CNUM      XCNUM                                               CSD027
     C                     MOVE CCY       XCCY
     C                     Z-ADDACOD      XACOD
     C                     Z-ADDACSQ      XACSQ
     C                     MOVELCMKEY     DBKEY
     C                     MOVEL'RECOM'   DBFILE           ***************
     C                     Z-ADD13        DBASE            * DB ERROR 13 *
     C                     EXSR ERROR                      ***************
     C                     END                             -E1
     C*                                                               *
     C**         Initialise output RECOM fields.                      *
     C*                                                               *
     C           CACDC     IFNE 'D'
     C                     Z-ADD*ZERO     ACCC
     C                     Z-ADD*ZERO     ACCRA
     C                     Z-ADD*ZERO     GVDPC
     C                     MOVE *BLANKS   MMACC
     C                     END
     C                     Z-ADD*ZERO     FXDC
     C                     Z-ADD*ZERO     CDIE
     C                     Z-ADD*ZERO     CDICA
     C                     Z-ADD*ZERO     CDRR
     C                     MOVE *BLANKS   MMCDI
     C                     Z-ADD*ZERO     IACE
     C                     Z-ADD*ZERO     IACCC
     C                     Z-ADD*ZERO     CMBE
     C                     Z-ADD*ZERO     CMBC
     C                     Z-ADD*ZERO     CHDBE
     C                     Z-ADD*ZERO     CHDBC
     C                     MOVE *BLANKS   MMCHDB
     C                     Z-ADD*ZERO     HDRB
     C                     Z-ADD*ZERO     CHDBR
     C                     Z-ADD*ZERO     ACCB
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SR100 subroutine determines if the account is capitalising. *
     C**                                                              *
     C**  Called By:  MAIN                                            *
     C**  Calls:      -                                               *
     C**                                                              *
     C**  Indicators: 26      Account credit capitalising.            *
     C**              27      Account debit capitalising.             *
     C**                                                              *
     C**  Arrays:                                                     *
     C**                                                              *
     C**  Fields:     LSTCDT  Control last credit capitalisation date.*
     C**              NXTCDT  Control next credit capitalisation date.*
     C**              LSTDDT  Control last debit capitalisation date. *
     C**              NXTDDT  Control next debit capitalisation date. *
     C**                                                              *
      *****************************************************************   CCB003
     C           SR100     BEGSR
     C*                                                               *
     C**         Assume that account is not captialising.             *
     C                     MOVE '0'       *IN50
     C                     SETOF                     2627
     C                     Z-ADDLCID      LSTCDT
     C                     Z-ADDRUND      NXTCDT
     C                     Z-ADDLDID      LSTDDT
     C                     Z-ADDRUND      NXTDDT
     C*
     C           BDICI     IFEQ 'Y'                        -B1
     C           BDICI     OREQ 'D'
     C           BDICI     OREQ 'C'
     C                     MOVE '1'       *IN27
     C                     END                             -E1
     C           BCICI     IFEQ 'Y'                        -B1
     C           BCICI     OREQ 'D'
     C           BCICI     OREQ 'C'
     C                     MOVE '1'       *IN26
     C                     END                             -E1
     C*                                                               *
     C**         If account capitalising then set control dates.      *
     C*                                                               *
     C*                                                               *
     C**         Set control last credit capitalisation date and      *
     C**         next credit capitalisation date.                     *
     C**         Note:- If next credit capitalisation date = 0,       *
     C**         account is not credit capitalising.                  *
     C*                                                               *
     C           DNWD      SUB  1         DATE1
     C           APDA      IFLT DATE1
     C                     Z-ADDAPDA      DATE1
     C                     END
     C*                                                               *
     C***********BCICI     IFEQ 'Y'                        -B1            098818
     C           *IN26     IFEQ '1'                        -B1            098818
     C*                                                               *
     C           NCID      IFLE DATE1                      -B2
     C           NCID      ANDNE0                                         107896
     C                     Z-ADDLCID      LSTCDT
     C                     Z-ADDNCID      NXTCDT
     C                     END                             -E2
     C*                                                               *
     C                     END                             -E1
     C*                                                               *
     C**         Set control last debit capitalisation date and       *
     C**         next debit capitalisation date.                      *
     C**         Note:- If next debit capitalisation date = 0,        *
     C**         account is not debit capitalising.                   *
     C*                                                               *
     C***********BDICI     IFEQ 'Y'                        -B1            098818
     C           *IN27     IFEQ '1'                        -B1            098818
     C*                                                               *
     C           NDID      IFLE DATE1                      -B2
     C           NDID      ANDNE0                                         107896
     C                     Z-ADDLDID      LSTDDT
     C                     Z-ADDNDID      NXTDDT
     C                     END                             -E2
     C*
     C                     END                             -E1
     C*                                                               *
     C**         If FIRST day accruals then subtract one from the     *
     C**         control dates.                                       *
     C*                                                               *
     C           LDAC      IFNE 'Y'                        -B1
     C           LCID      IFGT DACO                       -B2
     C                     ADD  1         LSTCDT
     C                     END                             -E2
     C           LDID      IFGT DACO                       -B2
     C                     ADD  1         LSTDDT
     C                     END                             -E2
     C                     ADD  1         NXTCDT
     C                     END                             -E1
     C*                                                               *
     C**         If account is closing then set both next debit and   *
     C**         credit cpaitalisation dates to run date.             *
     C*                                                               *
     C           ACST      IFEQ 'C'                        -B1
     C                     Z-ADDRUND      NXTCDT
     C                     Z-ADDRUND      NXTDDT
     C                     END                             -E1
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  CCYICD Subroutine to handle missing currencies on Retail ICD*
     C**                                                              *
     C**  Called By:  SR000                                           *
     C**  Calls:      -                                               *
     C**                                                              *
     C**  Indicators: 21 ON  -  Fixed commission applicable.          *
     C**              22 ON  -  Debit interest commission applicable. *
     C**              23 ON  -  Inactive account commission applicable.*
     C**              24 ON  -  Highest debit balance commission      *
     C**                        applicable.                           *
     C**              25 ON  -  Minimum credit balance commission     *
     C**                        applicable.                           *
     C**                                                              *
     C**  Arrays:                                                     *
     C**                                                              *
     C**  Fields:                                                     *
     C**                                                              *
      *****************************************************************   CCB003
     C           CCYICD    BEGSR
     C*                                                               *
     C**         Force no commission to be calculated                 *
     C*                                                               *
     C**         Check if no overflow.                                *
     C                     EXSR CHKOVR
     C*                                                               *
     C**         Output advice for CCY missing on ICD Account reference*
     C                     WRITECCYERR
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SR200 subroutine outputs fixed commission.                  *
     C**                                                              *
     C**  Called By:  MAIN                                            *
     C**  Calls:      -                                               *
     C**                                                              *
     C**  Indicators:                                                 *
     C**                                                              *
     C**  Arrays:                                                     *
     C**                                                              *
      *****************************************************************   CCB003
     C           SR200     BEGSR
     C*
     C                     Z-ADDMX1,I1    FXDC
     C*
     C** OVERIDE FIXED COMMISSION IF PRESENT
     C*
     C           CEXG      IFNE *BLANKS                    - B1
     C                     Z-ADDNCEXG     FXDC
     C                     END                             - E1
     C*
     C                     ENDSR
     C*****************************************************************
     C**
     C** CHKOVR subroutine for processing overflow on RE3113AU
     C**
     C**     Called by       CCYICD, SELE2
     C**
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           CHKOVR    BEGSR                           **CHKOVR BEGSR*
      *                                                                   CCB003
      ** Check if first headings should be output                         CCB003
      *                                                                   CCB003
     C           @FIRST    IFNE 'Y'                                       CCB003
     C                     OPEN RE3113AU                                  CCB003
     C                     WRITEHEADAU                                    CCB003
     C                     MOVE 'Y'       @FIRST  1                       CCB003
     C                     ENDIF                                          CCB003
     C*
     C**  CHECK IF OVERFLOW ON RE3113AU
     C*
     C           *IN73     IFEQ '1'                        - B1
     C                     ADD  1         PAGE
     C                     WRITEHEADAU
     C                     MOVE '0'       *IN73
     C                     END                             - E1
     C*
     C                     ENDSR                           **CHKOVR ENDSR*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SR300 subroutine calculates debit interest commission.      *
     C**                                                              *
     C**  Called By:  MAIN                                            *
     C**  Calls:      SR310                                           *
     C**                                                              *
     C**  Indicators:                                                 *
     C**                                                              *
     C**  Arrays:                                                     *
     C**                                                              *
     C**  Fields:     TOTDIN  Total debit interest for enquiry.       *
     C**              TOTCDI  Total debit interest capitalised.       *
     C**                                                              *
      *****************************************************************   CCB003
     C           SR300     BEGSR
     C*                                                               *
     C**         Retrieve accrued interest.                           *
     C*                                                               *
     C**********           Z-ADDCNUM      CUST                                                CSD027
     C                     MOVE CNUM      CUST                                                CSD027
     C                     MOVE CCY       ACCY
     C                     Z-ADDACSQ      ASEQ
     C           REAKEY    CHAINREACR                10
     C           *IN10     IFEQ '1'
     C           *LOCK     IN   LDA
     C**********           Z-ADDCUST      KF11                                                CSD027
     C                     MOVE CUST      KF11                                                CSD027
     C                     MOVE ACCY      KF12
     C                     Z-ADDACOD      KF13
     C                     Z-ADDASEQ      KF14
     C                     MOVELKFMT1     DBKEY
     C                     MOVEL'REACR'   DBFILE           ***************
     C                     Z-ADD7         DBASE            * DB ERROR 07 *
     C                     EXSR ERROR                      ***************
     C                     END
     C*                                                               *
     C**         Calculate accrued interest as the sum of             *
     C**         accrued debit interest , manual adjustments ,        *
     C**         generated adjustments less total debit interest      *
     C**         capitalised.                                         *
     C*                                                               *
     C           DAIC1     ADD  MADI      TOTDIN
     C                     ADD  GADI      TOTDIN
     C*                                                               *
     C**         If account is debit capitalising then routine        *
     C**         SR310 is executed to calculate the capitalisation    *
     C**         amount on debit interest.                            *
     C*                                                               *
     C           *IN27     IFEQ '1'
     C                     EXSR SR310
     C                     END
     C*                                                               *
     C**         Calculation interest rate is based on the override   *
     C**         rate (if present) else the rate as supplied on the   *
     C**         retail ICD record.                                   *
     C*                                                               *
     C           CEXC      IFNE *BLANKS
     C                     Z-ADDORATEC    RATE
     C                     ELSE
     C                     Z-ADDRT2,I1    RATE
     C                     END
     C*
     C                     MULT RATE      TOTDIN    H
     C                     DIV  100       TOTDIN    H
     C*                                                               *
     C**         If the calculated commission is less than the minimum*
     C**         commission chargeable then charge the minimum        *
     C**         commission.                                          *
     C*                                                               *
     C           TOTDIN    IFLT MN2,I1
     C                     Z-ADDMN2,I1    TOTDIN
     C/COPY WNCPYSRC,RE3113C003
     C                     ELSE
     C*                                                               *
     C**         If the calculated commission is greater than the     *
     C**         maximum commission chargeable then charge the maximum*
     C**         commission.                                          *
     C*                                                               *
     C           TOTDIN    IFGT MX2,I1
     C                     Z-ADDMX2,I1    TOTDIN
     C                     END
     C                     END
     C*
     C                     Z-ADDRATE      CDRR
     C                     Z-ADDTOTDIN    CDIE      H
     C*
     C**         Include any manual adjustments to the enquiry value.
     C*
     C                     ADD  CCDIC     CDIE
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SR310 subroutine to handle capitalisation of commission     *
     C**  on debit interest.                                          *
     C**                                                              *
     C**  Called By:  SR300                                           *
     C**  Calls:      -                                               *
     C**                                                              *
     C**  Indicators:                                                 *
     C**                                                              *
     C**  Arrays:                                                     *
     C**                                                              *
      *****************************************************************   CCB003
     C           SR310     BEGSR
     C*
     C*                                                               *
     C**         Calculate debit interest for capitalisation as the sum*
     C**         of debit interest capitalised , manual adjustments , *
     C**         and generated adjustments.                           *
     C*                                                               *
     C           TDINT     ADD  MADI      TOTCDI
     C                     ADD  GADI      TOTCDI
     C*
     C**         Deduct the interest to be capitalised from the
     C**         interest for enquiry
     C*
     C                     SUB  TOTCDI    TOTDIN
     C*                                                               *
     C**         Calculation interest rate is based on the override   *
     C**         rate (if present) else the rate as supplied on the   *
     C**         retail ICD record.                                   *
     C*                                                               *
     C           CEXC      IFNE *BLANKS
     C                     Z-ADDORATEC    RATE
     C                     ELSE
     C                     Z-ADDRT2,I1    RATE
     C                     END
     C*
     C                     MULT RATE      TOTCDI    H
     C                     DIV  100       TOTCDI    H
     C*                                                               *
     C**         If the calculated commission is less than the minimum*
     C**         commission chargeable then charge the minimum        *
     C**         commission.                                          *
     C*                                                               *
     C           TOTCDI    IFLT MN2,I1
     C                     MOVE 'MIN'     MMCDI
     C                     Z-ADDMN2,I1    TOTCDI
     C/COPY WNCPYSRC,RE3113C004
     C                     ELSE
     C*                                                               *
     C**         If the calculated commission is greater than the     *
     C**         maximum commission chargeable then charge the maximum*
     C**         commission.                                          *
     C*                                                               *
     C           TOTCDI    IFGT MX2,I1
     C                     MOVE 'MAX'     MMCDI
     C                     Z-ADDMX2,I1    TOTCDI
     C                     END
     C                     END
     C*
     C                     Z-ADDTOTCDI    CDICA     H
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SR400 subroutine does initial processing for inactive account*
     C**        commission , highest debit balance commission and     *
     C**        minimum credit balance commission.                    *
     C**                                                              *
     C**  Called By:  MAIN                                            *
     C**  Calls:      POST20                                          *
     C**                                                              *
     C**  Indicators: 23  Inactive account commission.                *
     C**              24  Highest debit balance commission.           *
     C**              25  Minimum credit balance commission.          *
     C**                                                              *
     C**  Arrays:     DYS Account activity array (one element for each*
     C**                  day in a year).                             *
     C**                                                              *
     C**  Fields:     ACCBL1  Account balance accumulator.            *
     C**              LSTCH1  Last change date.                       *
     C**              MAXDB   Running highest monthly debit balance   *
     C**                      accumulator.                            *
     C**              NXTDDT  Control next debit capitalisation date. *
     C**                                                              *
     C**              ACCBL2  Account balance accumulator.            *
     C**              LSTCH2  Last change date.                       *
     C**              MINCBE  Minimum credit balance - enquiry.       *
     C**              MINCBC  Minimum credit balance - capitalised.   *
     C**                                                              *
      *****************************************************************   CCB003
     C           SR400     BEGSR
     C*                                                               *
     C**         Retrieve the account balance record.                 *
     C*                                                               *
     C*                                                               *
     C**         If calculating inactive account commission then      *
     C**         initialise all elements in the array DYS to '0'.     *
     C**         Each element represents a day in a year and is used  *
     C**         to flag account activity on a particular day (ie. the*
     C**         array element will be set to '1').                   *
     C*                                                               *
     C           *IN23     IFEQ '1'                        -B1
     C                     MOVEA*ALL'0'   DYS,1
     C                     END                             -E1
     C*                                                               *
     C**         If calculating highest debit balance commission then *
     C**         initialise the various working fields that are to be *
     C**         used:                                                *
     C**                                                              *
     C**             HISB   : account balance is set as per the       *
     C**                      retrieved account balance record. This  *
     C**                      field is updated to reflect the influence*
     C**                      of each posting read.                   *
     C**                                                              *
     C**             LSTCH1 : last change date is set to the day      *
     C**                      following the last debit capitalisation *
     C**                      date. This field is used to store the   *
     C**                      date of the previous posting that was   *
     C**                      read.                                   *
     C**                                                              *
     C**             MAXDB  : maximum debit balance per month is set  *
     C**                      to the balance on the retrieved account *
     C**                      balance record (if in debit) else it is *
     C**                      set to zero. This field is used to record*
     C**                      the maximum debit balance as reflected by*
     C**                      the postings. Its value is updated upon *
     C**                      a change in month across postings or an *
     C**                      increase in a prior maximum debit balance*
     C**                      within a month.                         *
     C**                                                              *
     C**             MXD    : each element represents the maximum debit*
     C**                      balance for a month. All twelve elements *
     C**                      are initialised at zero.                *
     C*                                                               *
     C           *IN24     IFEQ '1'                        -B1
     C                     Z-ADDLSTDDT    LSTCH1
     C           RDKEY     SETLLREHISL
     C           RDKEY     READEREHISL                   10
     C           *IN10     IFEQ '1'                        -B2
     C*                                                                   183259
     C* If chain fails this could be because capitalisation was a closure 183259
     C* request, in which case the date is one less, but also SDICI and   183259
     C* SCICI will be set to 'C' for closure. Otherwise database error.   183259
     C*                                                                   183259
     C                     SUB  1         LSTCH1                          183259
     C           RDKEY     SETLLREHISL                                    183259
     C           RDKEY     READEREHISL                   10               183259
     C           SDICI     IFNE 'C'                                       183259
     C           SCICI     ORNE 'C'                                       183259
     C                     MOVE '1'       *IN10                           183259
     C                     END                                            183259
     C           *IN10     IFEQ '1'                        -B3            183259
      *                                                                                       158789
      ** If not found, read previous record without date                                      158789
      *                                                                                       158789
     C                     SETOF                     10                                       158789
     C           RDKEY     SETGTREHISL                                                        158789
     C           RDKEY2    REDPEREHISL                   10                                   158789
     C           *IN10     IFEQ *ON                                                           158789
     C           *LOCK     IN   LDA
     C**********           Z-ADDCNUM      KF11                                                CSD027
     C                     MOVE CNUM      KF11                                                CSD027
     C                     MOVE CCY       KF12
     C                     Z-ADDACOD      KF13
     C                     Z-ADDACSQ      KF14
     C                     MOVELBRCA      KF15
     C                     MOVELKFMT1     DBKEY
     C***********          MOVEL'REHIS'   DBFILE           ***************183259
     C                     MOVEL'REHISL'  DBFILE           ***************183259
     C                     Z-ADD8         DBASE            * DB ERROR 08 *
     C                     EXSR ERROR                      ***************
     C                     ENDIF                                                              158789
      *                                                                                       158789
     C                     END                             -B2            183259
     C                     END                             -E2
     C           HISB      IFGT *ZERO
     C                     Z-ADDHISB      MAXDB
     C                     ELSE                            -X2
     C                     Z-ADD0         MAXDB
     C                     END                             -E2
     C*  SAVE PREVIOUS BALANCE READ
     C                     Z-ADDHISB      PHISB
     C                     Z-ADD*ZERO     MXD
     C                     Z-ADD1         I2
     C*                                                                  *
     C**         Now process all history date till end of period         *
     C*                                                                  *
     C                     Z-ADDMAXDB     WMXCAP                                             CRE090A
     C           REHKEY    READEREHISL                   10
     C           *IN10     DOWEQ'0'                        -B2
     C           HISD      ANDLTNXTDDT
     C           WDRDLY    OREQ 'Y'                                                          CRE090A
     C           *IN10     ANDEQ'0'                                                          CRE090A
     C                     EXSR POST20
     C           WDRDLY    IFEQ 'Y'                                                          CRE090A
     C           HISD      ANDLTNXTDDT                                                       CRE090A
     C           LDAC      ANDEQ'Y'                                                         MD027016
     C           WDRDLY    OREQ 'Y'                                                         MD027016
     C           HISD      ANDLENXTDDT                                                      MD027016
     C           LDAC      ANDNE'Y'                                                         MD027016
     C                     Z-ADDMAXDB     WMXCAP                                             CRE090A
     C                     ENDIF                                                             CRE090A
     C*  SAVE PREVIOUS BALANCE READ
     C                     Z-ADDHISB      PHISB
     C           REHKEY    READEREHISL                   10
     C                     END                             -E2
     C*                                                                  *
     C**         Process LAST history date OF period                     *
     C*                                                                  *
     C                     EXSR POST20
     C                     Z-ADDZMM       I2
     C                     Z-ADDMAXDB     MXD,I2
     C                     END                             -E1
     C*                                                                  *
     C**         If calculating minimum credit balance commission then   *
     C**         initialise the various working fields that are to be    *
     C**         used:                                                   *
     C**                                                                 *
     C**             HISBX  : account balance is set as per the          *
     C**                      retrieved account balance record. This     *
     C**                      field is updated to reflect the influence  *
     C**                      of each posting read.                      *
     C**                                                                 *
     C**             LSTCH2 : last change date is set to the day         *
     C**                      following the last debit capitalisation    *
     C**                      date. This field is used to store the      *
     C**                      date of the previous posting that was      *
     C**                      read.                                      *
     C**                                                                 *
     C**             MINCBE : minimum credit balance for enquiry is set  *
     C**                      to zero. This field will record the sum    *
     C**                      of the product : credit balance amount     *
     C**                      multiplied by the number of days that the  *
     C**                      balance was at that amount. This field     *
     C**                      is applicable only to the account enquiry  *
     C**                      date range.                                *
     C**                                                                 *
     C**             MINCBE : minimum credit balance for capitalisation  *
     C**                      is set to zero. Field usage is the same    *
     C**                      as MINCBE but is applicable only to the    *
     C**                      account capitalisation date range.         *
     C**                                                                 *
     C           *IN25     IFEQ '1'
     C                     Z-ADD0         MINCBE
     C                     Z-ADD0         MINCBC
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  SRPOST subroutine calculates other commissions (ie. inactive   *
     C**  account , highest debit balance and minimum credit balance).   *
     C**                                                                 *
     C**  Called By:  Mainline code                                      *
     C**  Calls:      POST10 Detail processing - inactive account        *
     C**              POST30 Detail processing - min. credit balance     *
     C**                                                                 *
     C**  Indicators:                                                    *
     C**                                                                 *
     C**  Arrays:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           SRPOST    BEGSR
     C*                                                                  *
     C**         Prepare and access credit history.                      *
     C*                                                                  *
     C                     Z-ADDLSTCDT    LSTCH2
     C           RCKEY     SETLLREHISL
     C           RCKEY     READEREHISL                   10
     C*                                                                  *
     C**         Must be a S or B record                                 *
     C*                                                                  *
     C           *IN10     IFEQ '1'
     C           RECI      OREQ 'D'
     C*                                                                  *101829
     C**         If 1st day accruals and cap. record not found, read     *101829
     C**         previous record as may be a closure cap.                *101829
     C*                                                                  *101829
     C           LDAC      IFNE 'Y'                                       101829
     C                     SUB  1         LSTCH2                          101829
     C                     SUB  1         LSTCDT                          101829
     C           RCKEY     SETLLREHISL                                    101829
     C           RCKEY     READEREHISL                   10               101829
     C                     END                                            101829
     C           *IN10     IFEQ '1'                                       101829
     C           RECI      ORNE 'S'                                       101829
     C*                                                                  *101829
     C           *LOCK     IN   LDA
     C**********           Z-ADDCNUM      KF11                                                CSD027
     C                     MOVE CNUM      KF11                                                CSD027
     C                     MOVE CCY       KF12
     C                     Z-ADDACOD      KF13
     C                     Z-ADDASEQ      KF14
     C                     MOVELKFMT1     DBKEY
     C                     MOVEL'REHIS'   DBFILE           ***************
     C                     Z-ADD18        DBASE            * DB ERROR 18 *
     C                     EXSR ERROR                      ***************
     C*                                                                   101829
     C                     END                                            101829
     C                     END                             -E2
     C*                                                                  *
     C********** Commission on inactive account                          *101829
     C*                                                                  *
     C********** *IN23     IFEQ '1'                                       101829
     C********** RECI      ANDEQ'B'                                       101829
     C**********           EXSR POST10                                    101829
     C**********           END                                            101829
     C*                                                                  *
     C**         Commission on minimum credit balance.                   *
     C*                                                                  *
     C           *IN25     IFEQ '1'
     C           HISB      IFGT *ZERO
     C                     Z-ADD*ZERO     HISBX
     C                     ELSE
     C                     Z-ADDHISB      HISBX
     C                     END
     C**********           END                                            101829
     C                     Z-ADDHISD      LSTCH2
     C           REHKEY    READEREHISL                   10
     C*
     C**         Process all record within teh credit period             *
     C*                                                                  *
     C           *IN10     DOWEQ'0'
     C           HISD      ANDLEDNWD
     C*                                                                  *
     C********** Commission on inactive account                          *101829
     C*                                                                  *
     C********** *IN23     IFEQ '1'                                       101829
     C********** RECI      ANDEQ'D'                                       101829
     C**********           EXSR POST10                                    101829
     C**********           END                                            101829
     C*                                                                  *
     C**         Commission on minimum credit balance.                   *
     C*                                                                  *
     C********** *IN25     IFEQ '1'                                       101829
     C                     EXSR POST30
     C**********           END                                            101829
     C                     Z-ADDHISD      LSTCH2
     C           REHKEY    READEREHISL                   10
     C                     END
     C*                                                                  *
     C**         Ensure period has been compleeted                       *
     C*                                                                  *
     C********** *IN25     IFEQ '1'                                       101829
     C********** LSTCH2    ANDLTDNWD                                      101829
     C           LSTCH2    IFLT DNWD                                      101829
     C                     EXSR POST30
     C                     END
     C*                                                                  *101829
     C                     END                                            101829
     C*                                                                  *101829
     C**         Commission on inactive account                          *101829
     C*                                                                  *101829
     C           *IN23     IFEQ '1'                                       101829
     C                     EXSR POST10                                    101829
     C                     END                                            101829
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  POST10 subroutine maintains the array DYS that is used to      *
     C**         determine the greatest period of account inactivity.    *
     C**                                                                 *
     C**  Called By:  SRPOST                                             *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     DYS Account activity array (one element for each   *
     C**                  day in a year).                                *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           POST10    BEGSR
     C*                                                                  *
     C*                                                                  *101829
     C**         Set up dates for calculating greatest period of a/c     *101829
     C**         inactivity.                                             *101829
     C*                                                                  *101829
     C                     EXSR INACDT                                    101829
     C**************If movment exist at this date process history        *101829
     C***********posting file to found Customer originated movement      *101829
     C**************the first array element corresponds to the date      *101829
     C**************that the account was opened.                         *101829
     C*                                                                  *
     C**         If maximum no. of days to check for inactivity is       *101829
     C**         *GE No. of Days Before Inactive, process history        *101829
     C**         posting file from calculated start date. If the         *101829
     C**         movement was customer originated set the                *101829
     C**         corresponding element in DYS to '1'. The first          *101829
     C**         array element corresponds to the start date.            *101829
     C*                                                                  *101829
     C********** DMVT      IFNE *ZERO                                     101829
     C********** CMVT      ORNE *ZERO                                     101829
     C           @END      SUB  @BEG      @WK50                           101829
     C                     ADD  1         @WK50                           101829
     C           @WK50     IFGE NDBI                                      101829
     C*                                                                  *101829
     C           POPKEY    SETLLREHPOPL
     C********** POPKEY    READEREHPOPL                  11               101829
     C           REHKEY    READEREHPOPL                  11               101829
     C           *IN11     DOWEQ'0'
     C           HISD      ANDLE@END                                      101829
     C                     Z-ADD1         I2
     C           TRAT      LOKUPTRT                      11
     C*                                                                  *
     C**         If the transaction was customer originated              *
     C**         then flag the transaction date element in               *
     C**         array DYS as active.                                    *
     C*                                                                  *
     C           *IN11     IFEQ '1'
     C********** HISD      SUB  LYEAR     I2                              101829
     C           HISD      SUB  @BEG      I2                              101829
     C           I2        IFLT 0                                         084414
     C                     Z-ADD0         I2                              084414
     C                     END                                            084414
     C*                                                                  *
     C**         Add one to I2 because we may have a posting             *
     C**         that occurred on the date corresponding to              *
     C**         First day of the period                                 *
     C*                                                                  *
     C                     ADD  1         I2
     C*                                                                  *
     C**         Ignore records more than a year ago as not              *
     C**         relevant for inactive period check.                     *
     C*                                                                  *
     C           I2        IFGT 0
     C                     MOVE '1'       DYS,I2
     C                     END
     C*
     C                     END
     C*
     C**  Read next record on Retail history posting file                *
     C*
     C********** POPKEY    READEREHPOPL                  11               101829
     C           REHKEY    READEREHPOPL                  11               101829
     C                     END
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************   101829
     C**                                                                 *101829
     C**  INACDT subroutine calculates start and end date to determine   *101829
     C**         the greatest period of account inactivity.              *101829
     C**                                                                 *101829
     C**  Called By:  POST10                                             *101829
     C**  Calls:      -                                                  *101829
     C**                                                                 *101829
     C           INACDT    BEGSR                                          101829
     C*                                                                  *101829
     C**         Set up start and end date for calculating inactive a/c  *101829
     C**         commission for enquiry (IACE). End date is DNWD - 1.    *101829
     C**         Start date is (end date - NDBI) + 1 as end date counts  *101829
     C**         as a day. If DACO is later or LSTCDT is earlier use     *101829
     C**         that instead.                                           *101829
     C*                                                                  *101829
     C                     Z-ADD@DNWD1    @ENDE                           101829
     C           @DNWD1    SUB  NDBI      @BEGE                           101829
     C                     ADD  1         @BEGE                           101829
     C           DACO      IFGT @BEGE                                     101829
     C                     Z-ADDDACO      @BEGE                           101829
     C                     ELSE                                           101829
     C           LSTCDT    IFLT @BEGE                                     101829
     C                     Z-ADDLSTCDT    @BEGE                           101829
     C                     END                                            101829
     C                     END                                            101829
     C*                                                                  *101829
     C**         If a/c not capitalising or cap. date = DNWD - 1, start  *101829
     C**         & end date for enquiry, cap. & array DYS are the same.  *101829
     C**         Maximum for array is 370.                               *101829
     C*                                                                  *101829
     C           *IN26     IFEQ '0'                                       101829
     C           *IN26     OREQ '1'                                       101829
     C           NXTCDT    ANDEQ@DNWD1                                    101829
     C           @ENDE     SUB  @BEGE     @WK50                           101829
     C           @WK50     IFGT 369                                       101829
     C           @ENDE     SUB  369       @BEGE                           101829
     C                     END                                            101829
     C                     Z-ADD@BEGE     @BEG                            101829
     C                     Z-ADD@BEGE     @BEGC                           101829
     C                     Z-ADD@ENDE     @END                            101829
     C                     Z-ADD@ENDE     @ENDC                           101829
     C                     ELSE                                           101829
     C*                                                                  *101829
     C**         If a/c is capitalising & cap. date *NE DNWD - 1, start  *101829
     C**         date is (NXTCDT - NDBI) + 1. If DACO is later or        *101829
     C**         LSTCDT is earlier, use that instead.                    *101829
     C*                                                                  *101829
     C                     Z-ADDNXTCDT    @ENDC                           101829
     C           NXTCDT    SUB  NDBI      @BEGC                           101829
     C                     ADD  1         @BEGC                           101829
     C           DACO      IFGT @BEGC                                     101829
     C                     Z-ADDDACO      @BEGC                           101829
     C                     ELSE                                           101829
     C           LSTCDT    IFLT @BEGC                                     101829
     C                     Z-ADDLSTCDT    @BEGC                           101829
     C                     END                                            101829
     C                     END                                            101829
     C*                                                                  *101829
     C**         Use the later of the enquiry & cap. end dates as the    *101829
     C**         array end date.                                         *101829
     C*                                                                  *101829
     C           @ENDC     IFGE @ENDE                                     101829
     C                     Z-ADD@ENDC     @END                            101829
     C                     ELSE                                           101829
     C                     Z-ADD@ENDE     @END                            101829
     C                     END                                            101829
     C*                                                                  *101829
     C**         Maximum is 370.                                         *101829
     C*                                                                  *101829
     C           @END      SUB  @BEGE     @WK50                           101829
     C           @WK50     IFGT 369                                       101829
     C           @END      SUB  369       @BEGE                           101829
     C                     END                                            101829
     C           @END      SUB  @BEGC     @WK50                           101829
     C           @WK50     IFGT 369                                       101829
     C           @END      SUB  369       @BEGC                           101829
     C                     END                                            101829
     C*                                                                  *101829
     C**         Use the earlier of the enquiry & cap. end dates as the  *101829
     C**         array start date.                                       *101829
     C*                                                                  *101829
     C           @BEGC     IFLE @BEGE                                     101829
     C                     Z-ADD@BEGC     @BEG                            101829
     C                     ELSE                                           101829
     C                     Z-ADD@BEGE     @BEG                            101829
     C                     END                                            101829
     C*                                                                  *101829
     C                     END                                            101829
     C*                                                                  *101829
     C                     ENDSR                                          101829
     C/EJECT                                                              101829
     C*****************************************************************
     C**                                                                 *
     C**  POST20 subroutine maintains the array MXD that holds the       *
     C**         highest debit balances for the range of months          *
     C**         analysed.                                               *
     C**                                                                 *
     C**  Called By:  SR400                                              *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     MXD Highest debit balance array by month.          *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           POST20    BEGSR
     C*                                                                  *
     C**         Process this record if the balance is debit             *
     C*                                                                  *
     C**         Convert the previous posting date and the               *
     C**         current posting date into DDMMYY format to              *
     C**         determine if we are in a new month.                     *
     C*                                                                  *
     C                     Z-ADDLSTCH1    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZMM       LSTCMM
     C                     Z-ADDZYY       LSTCYY
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C*                                                                  *
     C**         If a change in month has occurred then                  *
     C**         update the array element of MXD for the                 *
     C**         previous month with the highest debit                   *
     C**         balance in that month.                                  *
     C**         If more than one month has passed then                  *
     C**         update the intervening months array                     *
     C**         elements in MXD with the account balance.               *
     C**         If the account balance was not a debit                  *
     C**         amount then the array elements remain set               *
     C**         at zero.                                                *
     C*                                                                  *
     C           MAXDB     IFGT *ZERO
     C           LSTCMM    DOWNEZMM
     C                     Z-ADDLSTCMM    I2      30
     C                     Z-ADDMAXDB     MXD,I2
     C                     ADD  1         LSTCMM
     C           LSTCMM    IFEQ 13
     C                     Z-ADD1         LSTCMM
     C                     END
     C* INITIALISE MAXDB WITH CORRECT BALANCE FOR NEW MONTH
     C           LSTCMM    IFEQ ZMM
     C           PHISB     IFGT *ZEROS
     C                     Z-ADDPHISB     MAXDB
     C                     ELSE
     C                     Z-ADD*ZEROS    MAXDB
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                  *
     C**         Update maximum monthly debit balance if the             *
     C**         current account balance HISB   is a greater             *
     C**         debit amount than the maximum debit balance             *
     C**         MAXDB.                                                  *
     C*                                                                  *
     C           HISB      IFGT MAXDB
     C                     Z-ADDHISB      MAXDB
     C                     END
     C*                                                                  *
     C**         If this record  is the first for the month              *
     C**         then set the maximum debit balance to zero or HISD/     *
     C*                                                                  *
     C           ZDD       IFEQ 1
     C           HISB      IFGT *ZERO
     C                     Z-ADDHISB      MAXDB
     C                     ELSE
     C                     Z-ADD*ZERO     MAXDB
     C                     END
     C                     END
     C*                                                                  *
     C**         Reset last change date to the history                   *
     C**         posting date.                                           *
     C*                                                                  *
     C                     Z-ADDHISD      LSTCH1
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  POST30 subroutine determines the minimum average credit        *
     C**         balance over the range of dates analysed.               *
     C**                                                                 *
     C**  Called By:  SRPOST                                             *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     -                                                  *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           POST30    BEGSR
     C*                                                                  *
     C**         Process if the account is in credit.                    *
     C*                                                                  *
     C           HISBX     IFLT *ZERO
     C           *IN26     IFEQ '1'
     C           LSTCH2    IFLT NXTCDT
     C           HISD      ANDGENXTCDT
     C*                                                                  *
     C**         Calculate the number of days difference                 *
     C**         between the lesser of the control next                  *
     C**         credit capitalisation date and history                  *
     C**         posting date , and the last change date.                *
     C*                                                                  *
     C           NXTCDT    SUB  LSTCH2    DIFFDD
     C*                                                                  *
     C**         If credit capitalisation                                *
     C**         Increment MINCBC by the account balance                 *
     C**         multiplied by the relevant number of                    *
     C**         days that the account was at the balance                *
     C**         value.                                                  *
     C*                                                                  *
     C           HISBX     MULT DIFFDD    WKVAL1
     C           MINCBE    ADD  WKVAL1    MINCBC
     C                     END
     C                     END
     C                     END
     C*                                                                  *
     C**         Increment MINCBE by the account balance                 *
     C**         multiplied by the relevant number of                    *
     C**         days that the account was at the balance                *
     C**         value.                                                  *
     C*                                                                  *
     C           HISD      IFLT DNWD
      *                                                                                     AR802662
     C           HISD      IFEQ LSTCH2                                                      AR802662
     C           RUND      SUB  LSTCH2    DIFFDD                                            AR802662
     C                     ELSE                                                             AR802662
     C*                                                                  *
     C**         Calculate the number of days difference                 *
     C**         between the lesser of the control next                  *
     C**         credit capitalisation date and history                  *
     C**         posting date , and the last change date.                *
     C*                                                                  *
     C           HISD      SUB  LSTCH2    DIFFDD
     C                     ENDIF                                                            AR802662
     C                     ELSE
     C           DNWD      SUB  LSTCH2    DIFFDD
     C                     END
     C*                                                                  *
     C**         Increment MINCBE by the account balance                 *
     C**         multiplied by the relevant number of                    *
     C**         days that the account was at the balance                *
     C**         value.                                                  *
     C*                                                                  *
     C           HISBX     MULT DIFFDD    WKVAL1
     C                     ADD  WKVAL1    MINCBE
     C*
     C           HISB      IFGT *ZERO
     C                     Z-ADD*ZERO     HISBX
     C                     ELSE
     C                     Z-ADDHISB      HISBX
     C                     END
     C                     ENDSR
     C*
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  L0CHK Check if totaling for historic postings needs to be      *
     C**        carried out.                                             *
     C**                                                                 *
     C**  Called By:      Mainline Code -- at Total time Processing      *
     C**  Calls:      -   L0TOT, L0UPDT                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:                                                        *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           L0CHK     BEGSR
     C*
     C                     EXSR L0TOT
      *                                                                                      CRE090A
     C           WDRDLY    IFEQ 'Y'                                                          CRE090A
     C           WCRDLY    OREQ 'Y'                                                          CRE090A
     C           *IN21     IFEQ '1'                                                          CRE090A
     C           *IN22     OREQ '1'                                                          CRE090A
     C           *IN24     OREQ '1'                                                          CRE090A
     C           *IN25     OREQ '1'                                                          CRE090A
     C           *IN28     OREQ '1'                                                          CRE090A
     C                     EXSR SRDLAY                                                       CRE090A
     C                     ENDIF                                                             CRE090A
     C                     ENDIF                                                             CRE090A
     C*                                                                  *
     C**         Write payment details to RECOM.                         *
     C*                                                                  *
     C                     EXSR L0UPDT
     C*
     C                     ENDSR
     C*
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  L0UPDT subroutine writes a record to RECOMD.                   *
     C**                                                                 *
     C**  Called By:  L0CHK                                              *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     -                                                  *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           L0UPDT    BEGSR
     C*
     C                     MOVE 'D'       RECI
     C*
     C                     UPDATRECOMDF
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  L0TOT subroutine totals up data read from looping thru         *
     C**        historic posting records for each account read.          *
     C**                                                                 *
     C**  Called By:  L0CHK                                              *
     C**  Calls:   -  LSR100 Total processing - inactive account         *
     C**              LSR200 Total processing - max. debit balance       *
     C**              LSR300 Total processing - min. credit balance      *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:                                                        *
     C**                                                                 *
     C**  Fields:                                                        *
     C*
      *****************************************************************   CCB003
     C           L0TOT     BEGSR
     C*
     C*                                                                  *
     C**         Total processing for inactive account commission.       *
     C*                                                                  *
     C           *IN23     IFEQ '1'
     C                     EXSR LSR100
     C                     END
     C*                                                                  *
     C**         Total processing for highest debit balance              *
     C**         commission.                                             *
     C*                                                                  *
     C           *IN24     IFEQ '1'
     C                     EXSR LSR200
     C                     END
     C*                                                                  *
     C**         Total processing for minimum credit balance             *
     C**         commission.                                             *
     C           *IN25     IFEQ '1'
     C                     EXSR LSR300
     C                     END
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  LSR100 subroutine determines the highest inactive period       *
     C**         based on the results in array DYS. Inactive account     *
     C**         commission is then calculated.                          *
     C**                                                                 *
     C**  Called By:  -  L0TOT                                           *
     C**  Calls:      -  LSR110                                          *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     DYS Account activity array (one element for each   *
     C**                  day in a year).                                *
     C**                                                                 *
     C**  Fields:     STRARY  Date corresponding to array element one.   *
     C**              ENDELE  Array element occurrence corresponding     *
     C**                      to end date.                               *
     C**                                                                 *
      *****************************************************************   CCB003
     C           LSR100    BEGSR
     C*                                                                  *
     C**         Process the following if the account is credit          *
     C**         capitalising.                                           *
     C*                                                                  *
     C           *IN26     IFEQ '1'
     C*                                                                  *
     C**         Set ENDELE to the array element that corresponds        *
     C**         to the control next credit capitalisation date.         *
     C*                                                                  *
     C********** NXTCDT    SUB  LSTCDT    ENDELE  50                      101829
     C           @ENDC     SUB  @BEG      ENDELE  50                      101829
     C                     ADD  1         ENDELE
     C**********           Z-ADD1         I2                              101829
     C           @BEGC     SUB  @BEG      I2                              101829
     C                     ADD  1         I2                              101829
     C********** ENDELE    IFGT 370                                084414 101829
     C**********           Z-ADD370       ENDELE                   084414 101829
     C**********           END                                     084414 101829
     C*                                                                  *
     C**         Search array DYS for the greatest period of             *
     C**         account inactivity.                                     *
     C*                                                                  *
     C                     EXSR LSR110
     C*                                                                  *
     C**         If the greatest period of inactivty equals or           *
     C**         exceeds the prescibed limit , then apply the            *
     C**         credit capitalisation charge for account                *
     C**         inactivity to this account.                             *
     C*                                                                  *
     C**
     C********** Calulate inactive period as no of days prior to run date 101829
     C********** without any activity. (Overrides previous code).         101829
     C**
     C**********           Z-ADD370       I2                              101829
     C********** DYS,I2    DOUEQ'1'                                       101829
     C********** I2        OREQ 1                                         101829
     C**********           SUB  1         I2                              101829
     C**********           END                                            101829
     C********** 370       SUB  I2        INACT2                          101829
     C           INACT2    IFGE NDBI
     C                     Z-ADDMX3,I1    IACCC
     C*
     C** OVERIDE INACTIVE ACCOUNT COMMISSION IF PRESENT
     C*
     C           CEXD      IFNE *BLANKS
     C                     Z-ADDNCEXD     IACCC
     C                     END
     C*
     C                     END
     C*                                                                   101829
     C                     END                                            101829
     C*                                                                  *
     C********** Set ENDELE to the array element that corresponds        *101829
     C********** to the date prior to the next working date.             *101829
     C*                                                                  *
     C********** DNWD      SUB  LSTCDT    ENDELE                          101829
     C********** ENDELE    IFGT 370                                084414 101829
     C**********           Z-ADD370       ENDELE                   084414 101829
     C**********           END                                     084414 101829
     C*                                                                  *
     C********** Set I2 to the array element that corresponds to the     *101829
     C********** date following the next credit capitalisation date.     *101829
     C**                                                                 *
     C*                                                                  *
     C********** NXTCDT    SUB  LSTCDT    I2                              101829
     C**********           ADD  2         I2                              101829
     C********** I2        IFLE 0                                  084414 101829
     C**********           Z-ADD1         I2                       084414 101829
     C**********           END                                     084414 101829
     C*                                                                  *
     C********** Search array DYS for the greatest period of             *101829
     C********** account inactivity.                                     *101829
     C*                                                                  *
     C**********           EXSR LSR110                                    101829
     C*                                                                  *
     C********** If the greatest period of inactivty equals or           *101829
     C********** exceeds the prescibed limit , then apply the            *101829
     C********** charge for account inactivity to this account.          *101829
     C*                                                                  *
     C**
     C********** Calulate inactive period as no of days prior to run date 101829
     C********** without any activity. (Overrides previous code).         101829
     C**
     C**********           Z-ADD370       I2                              101829
     C********** DYS,I2    DOUEQ'1'                                       101829
     C********** I2        OREQ 1                                         101829
     C**********           SUB  1         I2                              101829
     C**********           END                                            101829
     C********** 370       SUB  I2        INACT2                          101829
     C********** INACT2    IFGE NDBI                                      101829
     C**********           Z-ADDMX3,I1    IACE                            101829
     C*
     C***OVERIDE*INACTIVE*ACCOUNT COMMISSION IF PRESENT                   101829
     C*
     C********** CEXD      IFNE *BLANKS                                   101829
     C**********           Z-ADDNCEXD     IACE                            101829
     C**********           END                                            101829
     C*
     C**********           END                                            101829
     C*
     C**********           ELSE                                           101829
     C*                                                                  *101829
     C**         Calculate greatest period of inactivity for enquiry     *101829
     C**         if not the same as for capitalisation.                  *101829
     C*                                                                  *101829
     C           *IN26     IFEQ '1'                                       101829
     C           @ENDC     ANDNE@ENDE                                     101829
     C           *IN26     OREQ '0'                                       101829
     C*                                                                  *
     C**         Set ENDELE to the array element that corresponds        *
     C**         to the date prior to the next working date.             *
     C*                                                                  *
     C********** DNWD      SUB  LSTCDT    ENDELE                          101829
     C**********           Z-ADD1         I2                              101829
     C********** ENDELE    IFGT 370                                084414 101829
     C**********           Z-ADD370       ENDELE                   084414 101829
     C**********           END                                     084414 101829
     C           @ENDE     SUB  @BEG      ENDELE                          101829
     C                     ADD  1         ENDELE                          101829
     C           @BEGE     SUB  @BEG      I2                              101829
     C                     ADD  1         I2                              101829
     C*                                                                  *
     C**         Search array DYS for the greatest period of             *
     C**         account inactivity.                                     *
     C*                                                                  *
     C                     EXSR LSR110
     C                     END                                            101829
     C*                                                                  *
     C**         If the greatest period of inactivty equals or           *
     C**         exceeds the prescibed limit , then apply the            *
     C**         charge for account inactivity to this account.          *
     C*                                                                  *
     C********** Calulate inactive period as no of days prior to run date 101829
     C********** without any activity. (Overrodes previous code).         101829
     C**
     C**********           Z-ADD370       I2                              101829
     C********** DYS,I2    DOUEQ'1'                                       101829
     C********** I2        OREQ 1                                         101829
     C**********           SUB  1         I2                              101829
     C**********           END                                            101829
     C********** 370       SUB  I2        INACT2                          101829
     C           INACT2    IFGE NDBI
     C                     Z-ADDMX3,I1    IACE
     C*
     C** OVERIDE INACTIVE ACCOUNT COMMISSION IF PRESENT
     C*
     C           CEXD      IFNE *BLANKS
     C                     Z-ADDNCEXD     IACE
     C                     END
     C*
     C                     END
     C*
     C**********           END                                            101829
     C*
     C**         Include any manual adjustments to the enquiry value.
     C*
     C                     ADD  CIACC     IACE
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  LSR110 subroutine searches the array DYS within a predefined   *
     C**         array element range for the greatest number of          *
     C**         consequetive '0's (ie. inactive days).                  *
     C**                                                                 *
     C**  Called By:  -   LSR100                                         *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     DYS Account activity array (one element for each   *
     C**                  day in a year).                                *
     C**                                                                 *
     C**  Fields:     STRARY  Date corresponding to array element one.   *
     C**              ENDELE  Array element occurrence corresponding     *
     C**                      to end date.                               *
     C**              INACT1  Transitory working value for calculated    *
     C**                      number of inactive days.                   *
     C**              INACT2  Resultant value of the highest number of   *
     C**                      inactive days.                             *
     C**                                                                 *
      *****************************************************************   CCB003
     C           LSR110    BEGSR
     C*
     C                     Z-ADD*ZERO     INACT1
     C                     Z-ADD*ZERO     INACT2
     C*                                                                   101829
     C**         Calculate no. of inactive days if maximum possible       101829
     C**         is *GE No. of Days Before Inactive.                      101829
     C*                                                                   101829
     C           ENDELE    SUB  I2        @WK50                           101829
     C                     ADD  1         @WK50                           101829
     C           @WK50     IFGE NDBI                                      101829
     C*                                                                   101829
     C           I2        SUB  1         @I      30                      101829
     C*
     C********** I2        DOUGTENDELE                                    101829
     C********** DYS,I2    IFEQ '1'                                       101829
     C           *IN80     DOUEQ'0'                                       101829
     C           I2        ORGT ENDELE                                    101829
     C           '1'       LOKUPDYS,I2                   80               101829
      *                                                                   101829
     C           *IN80     IFEQ '0'                                       101829
     C           ENDELE    SUB  @I        INACT1                          101829
     C                     ELSE                                           101829
      *                                                                   101829
     C           I2        IFGT ENDELE                                    101829
     C           ENDELE    SUB  @I        INACT1                          101829
     C                     ELSE                                           101829
     C                     ADD  1         @I                              101829
     C           I2        SUB  @I        INACT1                          101829
     C*
     C           INACT1    IFGT INACT2
     C                     Z-ADDINACT1    INACT2
     C                     END
     C**********           Z-ADD*ZERO     INACT1                          101829
     C**********           ELSE                                           101829
     C**********           ADD  1         INACT1                          101829
     C**********           END                                            101829
     C                     Z-ADDI2        @I                              101829
     C                     ADD  1         I2                              101829
     C                     END                                            101829
     C                     END                                            101829
     C**********           ADD  1         I2                              101829
     C                     END
     C*
     C           INACT1    IFGT INACT2
     C                     Z-ADDINACT1    INACT2
     C                     END
     C*                                                                   101829
     C                     END                                            101829
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  LSR200 subroutine performs total processing for highest debit  *
     C**         balance commission.                                     *
     C**                                                                 *
     C**  Called By:  L0TOT                                              *
     C**  Calls:      LSR210                                             *
     C**              LSR220                                             *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     MXD Maximum monthly debit balances.                *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           LSR200    BEGSR
     C*                                                                  *
     C**         Do specific processing based on whether the             *
     C**         account is debit capitalising or not.                   *
     C*                                                                  *
     C           *IN27     IFEQ '1'                                      B1
     C                     EXSR LSR210
     C                     ELSE                                          X1
     C                     EXSR LSR220
     C                     END                                           E1
     C*                                                                  *
     C**         SETUP THE BALANCE FOR ENDUIRY CALCULATION               *
     C*                                                                  *
     C*                                                                  *
     C**         SETUP THE BALANCE FOR ENDUIRY CALCULATION               *
     C*                                                                  *
     C*                                                                  *
     C           CEXA      IFNE *BLANKS                                  B1
     C           MAXDBE    MULT ORATEA    CHDBE     H
     C                     Z-ADDORATEA    CHDBR
     C                     ELSE                                          X1
     C           MAXDBE    MULT RT4,I1    CHDBE     H
     C                     Z-ADDRT4,I1    CHDBR
     C                     END                                           E1
     C                     DIV  100       CHDBE     H
     C*                                                                  *
     C**         If the calculated commission for capitalisation         *
     C**         is less than the prescribed minumum then charge         *
     C**         the minimum commission.                                 *
     C*                                                                  *
     C           CHDBE     IFLT MN4,I1                                   B1
     C                     Z-ADDMN4,I1    CHDBE
     C/COPY WNCPYSRC,RE3113C005
     C*                                                                  *
     C**         If the calculated commission for capitalisation         *
     C**         is not under the minimum , then the maximum             *
     C**         commission charge must be calculated.                   *
     C*                                                                  *
     C                     END
     C*                                                                  *
     C**         If the maximum commission is fixed then its             *
     C**         value is as defined on the retail ICD record.           *
     C*                                                                  *
     C           MDPF      IFEQ 'F'                                      B1
     C                     Z-ADDMX4,I1    TMAXI
     C*                                                                  *
     C**         If the maximum commission is not fixed then its         *
     C**         value must be calculated. In this case the              *
     C**         maximum commission field on the retail ICD              *
     C**         record is a percentage rate. This rate is used          *
     C**         to calculate the maximum commission to be               *
     C**         charged.                                                *
     C*                                                                  *
     C                     ELSE                                          X1
     C*                                                                  *
     C**         The calculation begins by retrieving retail             *
     C**         capitalised account details.                            *
     C*                                                                  *
     C           REGKEY    CHAINREACRDF              10
     C           *IN10     IFEQ '1'                                      B2
     C           *LOCK     IN   LDA
     C                     MOVE BRCA      KF21
     C**********           Z-ADDCNUM      KF22                                                CSD027
     C                     MOVE CNUM      KF22                                                CSD027
     C                     MOVE CCY       KF23
     C                     Z-ADDACOD      KF24
     C                     Z-ADDACSQ      KF25
     C                     MOVELKFMT2     DBKEY
     C                     MOVEL'REACR'   DBFILE           ***************
     C                     Z-ADD12        DBASE            * DB ERROR 12 *
     C                     EXSR ERROR                      ***************
     C                     END
     C                     END
     C*                                                                  *
     C**         The maximum commission is calculated by multiplying     *
     C**         the rate by the sum of debit interest ACCRUED     ,     *
     C**         manual adjustments to debit interest capitalised ,      *
     C**         and generated adjustments to debit interest             *
     C**         capitalised.                                            *
     C*                                                                  *
     C           DAIC1     ADD  MADI      TOTCDI
     C                     ADD  GADI      TOTCDI
     C                     Z-ADDMX4,I1    RATEDS
     C           RATEVL    MULT TOTCDI    TMAXI     H
     C                     DIV  100       TMAXI     H
     C*
     C** HIGHEST OVERDRAFT COMMISSION CAN NEVER BE CREDIT
     C*
     C           TMAXI     IFLT *ZEROS
     C                     Z-ADD*ZEROS    TMAXI
     C                     END
     C*                                                                  *
     C**         If the calculated commission for ENQUIRY        is      *
     C**         greater than the calculated maximum commission then     *
     C**         charge the maximum commission.                          *
     C*                                                                  *
     C           CHDBE     IFGT TMAXI                                    B1
     C                     Z-ADDTMAXI     CHDBE
     C                     END                                           B2
     C*
     C**         Include any manual adjustments to the enquiry value.
     C*
     C                     ADD  CCHDBC    CHDBE
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  LSR210 subroutine calculates capitalisation of highest debit   *
     C**         balance commission and an initial value for highest     *
     C**         debit balance commission for enquiry.                   *
     C**                                                                 *
     C**  Called By:  LSR200                                             *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     MXD Maximum monthly debit balances.                *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           LSR210    BEGSR
     C*                                                                  *
     C**         Scan the array containing the maximum debit             *
     C**         balances starting from the month corresponding          *
     C**         to the control last debit capitalisation date           *
     C**         plus one , up to the month corresponding to the         *
     C**         control next debit capitalisation date.                 *
     C*                                                                  *
     C           LSTDDT    ADD  1         ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZMM       I2
     C                     Z-ADDNXTDDT    ZDAYNO
     C                     EXSR ZDATE2
     C*                                                                  *
     C**         Set the maximum debit balance for capitalisation        *
     C**         to the debit balance of the first month to be           *
     C**         scanned.                                                *
     C*                                                                  *
     C                     Z-ADDMXD,I2    MAXDBC
     C           WDRDLY    IFEQ 'Y'                                                          CRE090A
     C           WMXCAP    ANDNEMAXDBC                                                       CRE090A
     C                     Z-ADDWMXCAP    MAXDBC                                             CRE090A
     C                     ENDIF                                                             CRE090A
     C           I2        IFNE ZMM                                      B1
     C           I2        DOUEQZMM                                      B2
     C           I2        IFNE 12                                       B3
     C                     ADD  1         I2
     C                     ELSE                                          X3
     C                     Z-ADD1         I2
     C                     END                                           E3
     C*                                                                  *
     C**         If commission for highest debit balance is to be        *
     C**         calculated over the period then scan the array          *
     C**         for the maximum debit balance.                          *
     C*                                                                  *
     C           CMDR      IFEQ 'P'                                      B3
     C           MXD,I2    IFGT MAXDBC                                   B4
     C                     Z-ADDMXD,I2    MAXDBC
     C                     END                                           E4
     C*                                                                  *
     C**         If commission for highest debit balance is to be        *
     C**         calculated over the month then accumulate the           *
     C**         debit balances over the scanned months.                 *
     C*                                                                  *
     C                     ELSE                                          X3
     C                     ADD  MXD,I2    MAXDBC
     C                     END                                           E3
     C                     END                                           E2
     C                     END                                           E1
     C*                                                                  *
     C**         Scan the array containing the maximum debit             *
     C**         balances starting from the month corresponding          *
     C**         to the control next debit capitalisation date           *
     C**         plus one , up to the month corresponding to the         *
     C**         next working day less one.                              *
     C*                                                                  *
     C           NXTDDT    ADD  1         ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZMM       I2
     C           DNWD      SUB  1         ZDAYNO
     C                     EXSR ZDATE2
     C*                                                                  *
     C**         Set the maximum debit balance for enquiry to the        *
     C**         debit balance of the first month to be scanned.         *
     C*                                                                  *
     C                     Z-ADDMXD,I2    MAXDBE
     C           I2        IFNE ZMM                                      B1
     C           I2        DOUEQZMM                                      B2
     C           I2        IFNE 12                                       B3
     C                     ADD  1         I2
     C                     ELSE                                          X3
     C                     Z-ADD1         I2
     C                     END                                           E3
     C*                                                                  *
     C**         If commission for highest debit balance is to be        *
     C**         calculated over the period then scan the array          *
     C**         for the maximum debit balance.                          *
     C*                                                                  *
     C           CMDR      IFEQ 'P'                                      B3
     C           MXD,I2    IFGT MAXDBE                                   B4
     C                     Z-ADDMXD,I2    MAXDBE
     C                     END                                           E4
     C*                                                                  *
     C**         If commission for highest debit balance is to be        *
     C**         calculated over the month then accumulate the           *
     C**         debit balances over the scanned months.                 *
     C*                                                                  *
     C                     ELSE                                          X3
     C                     ADD  MXD,I2    MAXDBE
     C                     END                                           E3
     C                     END                                           E2
     C                     END                                           E1
     C*                                                                  *
     C**         Multiply the maximum debit amount for capitalisation    *
     C**         by the override rate (if supplied) else by              *
     C**         the rate as supplied on the retail ICD record.          *
     C*                                                                  *
     C           CEXA      IFNE *BLANKS                                  B1
     C           MAXDBC    MULT ORATEA    CHDBC     H
     C                     Z-ADDORATEA    CHDBR
     C                     ELSE                                          X1
     C           MAXDBC    MULT RT4,I1    CHDBC     H
     C                     Z-ADDRT4,I1    CHDBR
     C                     END                                           E1
     C                     DIV  100       CHDBC     H
     C                     Z-ADDMAXDBC    HDRB
     C*                                                                  *
     C**         If the calculated commission for capitalisation         *
     C**         is less than the prescribed minumum then charge         *
     C**         the minimum commission.                                 *
     C*                                                                  *
     C           CHDBC     IFLT MN4,I1                                   B1
     C                     Z-ADDMN4,I1    CHDBC
     C                     MOVE 'MIN'     MMCHDB
     C/COPY WNCPYSRC,RE3113C006
     C*                                                                  *
     C**         If the calculated commission for capitalisation         *
     C**         is not under the minimum , then the maximum             *
     C**         commission charge must be calculated.                   *
     C*                                                                  *
     C                     END
     C*                                                                  *
     C**         If the maximum commission is fixed then its             *
     C**         value is as defined on the retail ICD record.           *
     C*                                                                  *
     C           MDPF      IFEQ 'F'                                      B1
     C                     Z-ADDMX4,I1    TMAXI
     C*                                                                  *
     C**         If the maximum commission is not fixed then its         *
     C**         value must be calculated. In this case the              *
     C**         maximum commission field on the retail ICD              *
     C**         record is a percentage rate. This rate is used          *
     C**         to calculate the maximum commission to be               *
     C**         charged.                                                *
     C*                                                                  *
     C                     ELSE                                          X1
     C*                                                                  *
     C**         The calculation begins by retrieving retail             *
     C**         capitalised account details.                            *
     C*                                                                  *
     C           REGKEY    CHAINREACRDF              10
     C           *IN10     IFEQ '1'                                      B2
     C           *LOCK     IN   LDA
     C                     MOVE BRCA      KF21
     C**********           Z-ADDCNUM      KF22                                                CSD027
     C                     MOVE CNUM      KF22                                                CSD027
     C                     MOVE CCY       KF23
     C                     Z-ADDACOD      KF24
     C                     Z-ADDACSQ      KF25
     C                     MOVELKFMT2     DBKEY
     C                     MOVEL'REACR'   DBFILE           ***************
     C                     Z-ADD9         DBASE            * DB ERROR 09 *
     C                     EXSR ERROR                      ***************
     C                     END
     C                     END
     C*                                                                  *
     C**         The maximum commission is calculated by multiplying     *
     C**         the rate by the sum of debit interest capitalised ,     *
     C**         manual adjustments to debit interest capitalised ,      *
     C**         and generated adjustments to debit interest             *
     C**         capitalised.                                            *
     C*                                                                  *
     C                     Z-ADDTDINT     TOTCDI
     C                     Z-ADDMX4,I1    RATEDS
     C           RATEVL    MULT TOTCDI    TMAXI     H
     C                     DIV  100       TMAXI     H
     C*
     C** HIGHEST OVERDRAFT COMMISSION CAN NEVER BE CREDIT
     C*
     C           TMAXI     IFLT *ZEROS
     C                     Z-ADD*ZEROS    TMAXI
     C                     END
     C*                                                                  *
     C**         If the calculated commission for capitalisation is      *
     C**         greater than the calculated maximum commission then     *
     C**         charge the maximum commission.                          *
     C*                                                                  *
     C           CHDBC     IFGT TMAXI
     C                     Z-ADDTMAXI     CHDBC
     C                     MOVE 'MAX'     MMCHDB
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  LSR220 subroutine calculates an initial value for highest      *
     C**         debit balance commission for enquiry.                   *
     C**                                                                 *
     C**  Called By:  LSR200                                             *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     MXD Maximum monthly debit balances.                *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           LSR220    BEGSR
     C*                                                                  *
     C**         Scan the array containing the maximum debit             *
     C**         balances starting from the month corresponding          *
     C**         to the control last debit capitalisation date           *
     C**         plus one , up to the month corresponding to the         *
     C**         next working day less one.                              *
     C*                                                                  *
     C           LSTDDT    ADD  1         ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZMM       I2
     C           DNWD      SUB  1         ZDAYNO
     C                     EXSR ZDATE2
     C*                                                                  *
     C**         Set the maximum debit balance for enquiry to the        *
     C**         debit balance of the first month to be scanned.         *
     C*                                                                  *
     C                     Z-ADDMXD,I2    MAXDBE
     C*
     C           I2        IFNE ZMM
     C           I2        DOUEQZMM
     C           I2        IFNE 12
     C                     ADD  1         I2
     C                     ELSE
     C                     Z-ADD1         I2
     C                     END
     C*                                                                  *
     C**         If commission for highest debit balance is to be        *
     C**         calculated over the period then scan the array          *
     C**         for the maximum debit balance.                          *
     C*                                                                  *
     C           CMDR      IFEQ 'P'
     C           MXD,I2    IFGT MAXDBE
     C                     Z-ADDMXD,I2    MAXDBE
     C                     END
     C*                                                                  *
     C**         If commission for highest debit balance is to be        *
     C**         calculated over the month then accumulate the           *
     C**         debit balances over the scanned months.                 *
     C*                                                                  *
     C                     ELSE
     C                     ADD  MXD,I2    MAXDBE
     C                     END
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  LSR300 subroutine performs total processing for minimum        *
     C**         credit balance commission.                              *
     C**                                                                 *
     C**  Called By:  L0TOT                                              *
     C**  Calls:      LSR310                                             *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     -                                                  *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           LSR300    BEGSR
     C*                                                                  *
     C**         If the account is credit capitalising then              *
     C**         calculate the capitalisation commission amount.         *
     C**                                                                 *
     C**         Subtract the minimum credit balance for                 *
     C**         capitalisation value (MINCBC) from the the              *
     C**         minimum credit balance for enquiry value (MINCBE).      *
     C**                                                                 *
     C**         Set DIFFDD to the days difference between the           *
     C**         control next credit capitalisation date and the         *
     C**         next working date.                                      *
     C*                                                                  *
     C           *IN26     IFEQ '1'
     C                     EXSR LSR310
     C                     SUB  MINCBC    MINCBE
     C           DNWD      SUB  NXTCDT    DIFFDD
     C*                                                                  *
     C**         If the account is not credit capitalising then          *
     C**         set DIFFDD to the days difference between the           *
     C**         control last credit capitalisation date and the         *
     C**         next working date.                                      *
     C*                                                                  *
     C                     ELSE
     C           DNWD      SUB  LSTCDT    DIFFDD
     C                     END
     C*                                                                  *
     C**         Calculate the average minimum credit balance            *
     C**         for enquiry by dividing the minimum credit              *
     C**         balance for enquiry value (MINCBE) by the               *
     C**         number of days scanned (DIFFDD).                        *
     C*                                                                  *
     C           DIFFDD    IFGT 0
     C           MINCBE    DIV  DIFFDD    WKVAL1    H
     C                     ELSE
     C                     Z-ADD0         WKVAL1
     C                     END
     C*                                                                  *
     C**         If account subtype is 'C' (current) and the             *
     C**         average credit balance for enquiry is less              *
     C**         than the prescribed minimum credit balance              *
     C**         for current accounts , then charge the                  *
     C**         minimum credit balance commission on minimum            *
     C**         credit balance enquiry.                                 *
     C                     Z-SUBWKVAL1    WKVAL1
     C           STYP      IFEQ 'C'
     C           WKVAL1    ANDGT0
     C           WKVAL1    ANDLTM5A,I1
     C                     Z-ADDM5C,I1    CMBE
     C*
     C** OVERIDE MINIMUM CREDIT BALANCE IF PRESENT
     C*
     C           CEXE      IFNE *BLANKS
     C                     Z-ADDNCEXE     CMBE
     C                     END
     C                     ELSE
     C*                                                                  *
     C**         If account subtype is 'S' (savings) and the             *
     C**         average credit balance for enquiry is less              *
     C**         than the prescribed minimum credit balance              *
     C**         for savings accounts , then charge the                  *
     C**         minimum credit balance commission on minimum            *
     C**         credit balance enquiry.                                 *
     C*                                                                  *
     C           STYP      IFEQ 'S'
     C           WKVAL1    ANDGT0
     C           WKVAL1    ANDLTM5B,I1
     C                     Z-ADDM5D,I1    CMBE
     C*
     C** OVERIDE MINIMUM CREDIT BALANCE IF PRESENT
     C*
     C           CEXE      IFNE *BLANKS
     C                     Z-ADDNCEXE     CMBE
     C                     END
     C*
     C**         If the average minimum is exceeded, or the
     C**         account is not current or savings zeroise
     C**         the commission on minimum balance
     C*
     C                     ELSE
     C                     Z-ADD0         CMBE
     C                     END
     C                     END
     C           DBT       TAG
     C*
     C**         Include any manual adjustments to the enquiry value.
     C*
     C                     ADD  CCMBC     CMBE
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  LSR310 subroutine performs total processing for                *
     C**         capitalisation minimum credit balance commission.       *
     C**                                                                 *
     C**  Called By:  LSR300                                             *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     -                                                  *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           LSR310    BEGSR
     C*                                                                  *
     C**         Calculate the days difference between the last change   *
     C**         date and the control next credit capitalisation         *
     C**         date.                                                   *
     C*                                                                  *
     C           NXTCDT    SUB  LSTCDT    DIFFDD
     C*                                                                  *
     C**         Calculate the average minimum credit balance            *
     C**         for capitalisation by dividing the minimum credit       *
     C**         balance for capitalisation value (MINCBC) by the        *
     C**         number of days scanned (DIFFDD).                        *
     C*                                                                  *
     C           DIFFDD    IFGT 0
     C           MINCBC    DIV  DIFFDD    WKVAL1    H
     C                     ELSE
     C                     Z-ADD0         WKVAL1
     C                     END
     C*                                                                  *
     C**         If account subtype is 'C' (current) and the             *
     C**         average credit balance for capitalisation is less       *
     C**         than the prescribed minimum credit balance for          *
     C**         current accounts , then charge the minimum credit       *
     C**         balance commission on capitalised minimum credit        *
     C**         balance.                                                *
     C                     Z-SUBWKVAL1    WKVAL1
     C                     Z-ADDWKVAL1    ACCB
     C           STYP      IFEQ 'C'
     C           WKVAL1    ANDLTM5A,I1
     C           WKVAL1    ANDGT0
     C                     Z-ADDM5C,I1    CMBC
     C           CEXE      IFNE *BLANKS                                                     MD026867
     C                     Z-ADDNCEXE     CMBC                                              MD026867
     C                     END                                                              MD026867
     C*                                                                  *
     C**         If account subtype is 'S' (savings) and the             *
     C**         average credit balance for capitalisation is less       *
     C**         than the prescribed minimum credit balance for          *
     C**         savings accounts , then charge the minimum credit       *
     C**         balance commission on capitalised minimum credit        *
     C**         balance.                                                *
     C*                                                                  *
     C                     ELSE
     C           STYP      IFEQ 'S'
     C           WKVAL1    ANDLTM5B,I1
     C           WKVAL1    ANDGT0
     C                     Z-ADDM5D,I1    CMBC
     C           CEXE      IFNE *BLANKS                                                     MD026867
     C                     Z-ADDNCEXE     CMBC                                              MD026867
     C                     END                                                              MD026867
     C*
     C**         If the average minimum is exceeded, or the
     C**         account is not current or savings zeroise
     C**         the commission on minimum balance
     C*
     C                     ELSE
     C                     Z-ADD0         CMBC
     C                     END
     C                     END
     C*
     C                     ENDSR
      *****************************************************************   CCB003
     C/EJECT                                                                                 CRE090A
     C*****************************************************************                      CRE090A
     C**                                                                 *                   CRE090A
     C**  SRDLAY Update accrued interests and commissions for delayed    *                   CRE090A
     C**         accounts.                                               *                   CRE090A
     C**                                                                 *                   CRE090A
     C**  Called By:      Mainline Code                                  *                   CRE090A
     C**                                                                 *                   CRE090A
      *****************************************************************                      CRE090A
     C           SRDLAY    BEGSR                                                             CRE090A
      *                                                                                      CRE090A
      ** Compute total commissions for accrued interest adjustment                           CRE090A
      *                                                                                      CRE090A
     C           WDRDLY    IFEQ 'Y'                         - B1                             CRE090A
     C                     Z-ADDNDID      LSTCH1                                             CRE090A
     C                     Z-ADDCDICA     DLYAMT 130                                         CRE090A
     C                     ADD  CHDBC     DLYAMT                                             CRE090A
     C                     ADD  ACCC      DLYAMT                                             CRE090A
     C           WCRDLY    IFEQ 'Y'                                                          CRE090A
     C                     ADD  FXDC      DLYAMT                                             CRE090A
     C                     ADD  CMBC      DLYAMT                                             CRE090A
     C                     ENDIF                                                             CRE090A
     C                     ELSE                             - X1                             CRE090A
     C                     Z-ADDNCID      LSTCH1                                             CRE090A
     C                     Z-ADDFXDC      DLYAMT                                             CRE090A
     C                     ADD  CMBC      DLYAMT                                             CRE090A
     C                     ENDIF                            - E1                             CRE090A
      *                                                                                      CRE090A
     C           DLYAMT    IFNE 0                           - B1                             CRE090A
      *                                                                                      CRE090A
     C                     Z-ADD0         WDRACD                                             CRE090A
     C                     Z-ADD0         WCRACD                                             CRE090A
     C           LDAC      IFNE 'Y'                                                         MD027119
     C                     ADD  1         LSTCH1                                            MD027119
     C                     ENDIF                                                            MD027119
     C           RDKEY     SETLLREHISDL                                                      CRE090A
     C           RDKEY2    READEREHISDL                  10                                  CRE090A
     C           HISB      ADD  DLYAMT    ZIAMT                                              CRE090A
     C                     Z-ADDHISD      ZIBEG                                              CRE090A
     C********** LDAC      IFNE 'Y'                                                MD027016 MD027119
     C**********           ADD  1         ZIBEG                                    MD027016 MD027119
     C**********           ENDIF                                                   MD027016 MD027119
      *                                                                                      CRE090A
     C           *IN10     DOWEQ'0'                         - B2                             CRE090A
      *                                                                                      CRE090A
     C                     Z-ADD0         ZINTR                                              CRE090A
     C           ZIAMT     IFGT 0                           - B3                             CRE090A
     C                     Z-ADDDRCB      ZICALC                                             CRE090A
     C                     Z-ADDDRIR      ZIRATE                                             CRE090A
     C                     ELSE                             - X3                             CRE090A
     C                     Z-ADDCRCB      ZICALC                                             CRE090A
     C                     Z-ADDCRIR      ZIRATE                                             CRE090A
     C                     ENDIF                            - E3                             CRE090A
     C           RDKEY2    READEREHISDL                  10                                  CRE090A
     C           *IN10     IFEQ '0'                         - B3                             CRE090A
     C                     Z-ADDHISD      ZIEND                                              CRE090A
     C                     ELSE                             - X3                             CRE090A
     C                     Z-ADDRUND      ZIEND                                              CRE090A
     C           LDAC      IFNE 'Y'                                                         MD027119
     C                     ADD  1         ZIEND                                             MD027119
     C                     ENDIF                                                            MD027119
     C                     Z-ADDZIBEG     LSTCH1                                             CRE090A
     C           RDKEY     CHAINREHISDL              12                                      CRE090A
     C           *IN12     IFEQ '1'                                                         MD027016
     C           LDAC      IFNE 'Y'                                                         MD027016
     C                     SUB  1         LSTCH1                                            MD027016
     C           RDKEY     CHAINREHISDL              12                                     MD027016
     C                     ENDIF                                                            MD027016
     C                     ENDIF                                                            MD027016
     C           *IN12     IFEQ '0'                                                          CRE090A
     C                     Z-ADDWDRACD    DAID                                               CRE090A
     C                     Z-ADDWCRACD    CAID                                               CRE090A
     C                     UPDATREHISD1                                                      CRE090A
     C                     ENDIF                                                             CRE090A
     C                     ENDIF                            - E3                             CRE090A
     C                     EXSR GLINTC                                                       CRE090A
     C           ZIAMT     IFGT 0                           - B3                             CRE090A
     C                     ADD  ZINTR     WDRACD    H                                        CRE090A
     C                     ELSE                             - X3                             CRE090A
     C                     SUB  ZINTR     WCRACD    H                                        CRE090A
     C                     ENDIF                            - E3                             CRE090A
     C           HISB      ADD  DLYAMT    ZIAMT                                              CRE090A
     C                     Z-ADDHISD      ZIBEG                                              CRE090A
      *                                                                                      CRE090A
     C                     ENDDO                            - E2                             CRE090A
      *                                                                                      CRE090A
     C           ACCKEY    CHAINREACR                10                                      CRE090A
     C           *IN10     IFEQ '0'                         - B2                             CRE090A
     C           WDRACD    ADD  TDINT     DAIC1                                              CRE090A
     C           WCRACD    ADD  TCINT     CAIC1                                              CRE090A
     C                     UPDATREACRDF                                                      CRE090A
     C                     ENDIF                            - E2                             CRE090A
      *                                                                                      CRE090A
      ** Update commission on debit interest for enquiry                                     CRE090A
      *                                                                                      CRE090A
     C           *IN22     IFEQ '1'                         - B2                             CRE090A
     C           WDRACD    ANDNE0                                                            CRE090A
      *                                                                                      CRE090A
     C           WDRACD    MULT CDRR      TOTDIN    H                                        CRE090A
     C                     DIV  100       TOTDIN    H                                        CRE090A
     C           TOTDIN    IFLT MN2,I1                      - B3                             CRE090A
     C                     Z-ADDMN2,I1    TOTDIN                                             CRE090A
     C                     ELSE                             - X3                             CRE090A
     C           TOTDIN    IFGT MX2,I1                                                       CRE090A
     C                     Z-ADDMX2,I1    TOTDIN                                             CRE090A
     C                     END                                                               CRE090A
     C                     END                              - E3                             CRE090A
     C                     Z-ADDTOTDIN    CDIE      H                                        CRE090A
      *                                                                                      CRE090A
     C                     ENDIF                            - E2                             CRE090A
      *                                                                                      CRE090A
      ** Update commission on highest Dr bal for enquiry                                     CRE090A
      *                                                                                      CRE090A
     C           *IN24     IFEQ '1'                         - B2                             CRE090A
     C           CHDBE     ANDNE0                                                            CRE090A
     C           DLYAMT    ANDGT0                                                            CRE090A
      *                                                                                      CRE090A
     C           MAXDBE    ADD  DLYAMT    MAXDBE                                             CRE090A
     C           MAXDBE    MULT CHDBR     CHDBE     H                                        CRE090A
     C                     DIV  100       CHDBE     H                                        CRE090A
     C           CHDBE     IFLT MN4,I1                                   B1                  CRE090A
     C                     Z-ADDMN4,I1    CHDBE                                              CRE090A
     C                     END                                                               CRE090A
     C           CHDBE     IFGT TMAXI                                    B1                  CRE090A
     C                     Z-ADDTMAXI     CHDBE                                              CRE090A
     C                     ENDIF                                         B2                  CRE090A
      *                                                                                      CRE090A
     C                     ENDIF                            - E2                             CRE090A
      *                                                                                      CRE090A
     C                     ENDIF                            - E1                             CRE090A
      *                                                                                      CRE090A
     C                     ENDSR                                                             CRE090A
      *                                                                                      CRE090A
     C/EJECT                                                                                  CRE083
     C*****************************************************************                       CRE083
     C**                                                                 *                    CRE083
     C**  UPDPTR subroutine updates REFIXCPD with Start Key.             *                    CRE083
     C**                                                                 *                    CRE083
     C**  Called By:  Mainline code.                                     *                    CRE083
     C**  Calls:      -                                                  *                    CRE083
     C**                                                                 *                    CRE083
     C**  Indicators: -                                                  *                    CRE083
     C**                                                                 *                    CRE083
     C**  Arrays:     -                                                  *                    CRE083
     C**                                                                 *                    CRE083
     C**  Fields:                                                        *                    CRE083
     C**                                                                 *                    CRE083
      *****************************************************************                       CRE083
     C           UPDPTR    BEGSR                                                              CRE083
      *                                                                                       CRE083
     C                     MOVE 'A'       IXCKEY                                              CRE083
     C                     MOVE NXTKEY    LSTKEY                                              CRE083
     C           IXCKEY    CHAINREFIXCPD             38                                       CRE083
     C           *IN38     IFEQ '0'                                                           CRE083
     C                     MOVE LSTKEY    NXTKEY                                              CRE083
     C                     MOVE @CCY      CCY                                                 CRE083
     C                     MOVE 'C'       PROT                                                CRE083
     C                     UPDATREHISPB1                                                      CRE083
     C                     END                                                                CRE083
      *                                                                                       CRE083
     C                     ENDSR                                                              CRE083
      *****************************************************************                       CRE083
     C/EJECT
     C*****************************************************************
     C**                                                                 *
     C**  ERROR subroutine performs a dump of RE3113 and the aborts.     *
     C**                                                                 *
     C**  Called By:  Various                                            *
     C**  Calls:      -                                                  *
     C**                                                                 *
     C**  Indicators: -                                                  *
     C**                                                                 *
     C**  Arrays:     -                                                  *
     C**                                                                 *
     C**  Fields:                                                        *
     C**                                                                 *
      *****************************************************************   CCB003
     C           ERROR     BEGSR
      *                                                                   CCB003
     C                     MOVEL'RE3113'  DBPGM
     C                     OUT  LDA
     C                     SETON                     U7U8LR
     C***********          COMIT                                          CCB003
     C                     ROLBK                                          CCB003
     C                     DUMP
     C                     RETRN
      *                                                                   CCB003
     C                     ENDSR
      *****************************************************************   CCB003
     C/EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C*
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C*
     C**   CLEAR DATE FIELDS.
     C*
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C*
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C*
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C*
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C*
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C*
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C*
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C*                                                    DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C*                                                    DAYS
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C*
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C*
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C*
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C*
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C*
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C*
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C*
     C**   CALCULATE MONTH NUMBER.
     C*
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C*
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C*
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C*
     C           ZDAYN1    ADD  1         ZDAYN1
     C*
     C**   CALCULATE DAY OF MONTH.
     C*
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C*
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C*
     C   93      ZDAY      ADD  1         ZDAY
     C*
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C*
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C*
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C*
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C*
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C*****************************************************************   084414
     C*                                                               *   084414
     C*    ERROR DUMP SUBROUTINE.                                     *   084414
     C*                                                               *   084414
     C*****************************************************************   084414
     C*                                                                   084414
     C           *PSSR     BEGSR                           ***  PSSR **   084414
     C           @RUN      IFEQ *BLANK                                    084414
     C                     MOVE 'Y'       @RUN    1                       084414
     C                     SETON                       U7U8               106054
     C                     SETON                         LR               084414
     C                     DUMP                                           084414
     C                     RETRN                                          084414
     C                     END                                            084414
     C                     ENDSR                           *** *PSSR **   084414
     C*                                                                   084414
     C********************************************************************
     C/EJECT                                                                                 CRE090A
     C********************************************************************                   CRE090A
     C/COPY ZSRSRC,GLINTCZ1                                                                  CRE090A
     C********************************************************************                   CRE090A
     C/COPY ZSRSRC,ZINTDYZ2                                                                  CRE090A
     C********************************************************************                   CRE090A
     C/COPY ZSRSRC,ZDATE9Z3                                                                  CRE090A
     C********************************************************************                   CRE090A
     C/COPY ZSRSRC,ZDAT10Z2                                                                  CRE090A
     C********************************************************************                   CRE090A
** CPY@  OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN                       CRE090A
00366007310109601461                                                                         CRE090A
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                          CRE090A
00000000310005900090001200015100181002120024300273003040033400365                            CRE090A
