     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Unlinked accounts')                           *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Retail Module
     F*                                                               *
     F*  RE3262 - INTEREST STATEMENTS UNLINKED                        *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 230844             Date 16Dec04               *
      *                 262850             Date 26Nov09               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 AR751622           Date 02May11               *
      *                 CER059             Date 19Jul10               *
      *                 CER016             Date 19May08               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG26486           Date 19Oct09               *
      *                 260297             Date 19May09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 219375             Date 06Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 178785             Date 27Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CDE002             Date 21Dec99               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 170768             Date 12Jan00               *
      *                 169797             Date 12Jan00               *
     F*                 169054             DATE 12Jan00               *
     F*                 154241             Date 24Nov99               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 144977             Date 17Nov98               *
     F*                 103460             DATE 06MAR98               *
     F*                 120414             DATE 03MAR98               *
     F*                 081162             DATE 20FEB98               *
     F*                 CRE001             Date 18Feb97               *
     F*                 S01408             Date 12Sep96               *
     F*                 088029             Date 08Jun95               *
     F*                 S01408             DATE 29SEP94               *
     F*                 S01408             DATE 24AUG94               *
     F*                 074578             DATE 17AUG94               *
     F*                 S01413 *CREATE     DATE 13APR93               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  230844 - There is a problem with charges after unlink of     *
      *           accounts. Applied fix 200199.                       *
      *  262850 - DATABASE ERROR IN FILE HRCJ AT 093.                 *
      *           Use renamed fields DRIS1 and CRIS1 from ACCNTAB     *
      *           when validating DR/CR rate change file.             *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  AR751622 - Erroneous generated interest for Retail Account   *
      *             (non-leap year) when calculation basis is 0. Need *
      *             to include SR ZICD CER016 changes in /COPY        *
      *             ZICDREZ2 - (Recompile)                            *
      *             (Child: AR751623)                                 *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016 - German Interest Calculation: Upgarde of FGE059      *
      *           to Midas Plus                                       *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  BUG26486 - Coding standard (recompile)                       *
      *  260297 - Incorrect interest calculation w/ calc basis 6.     *
      *           Externalise SR/ZICD and patterned additional fix    *
      *           from ZINTDYZ2. Applied fix 220323.                  *
      *  219375 - Database error in file FUSIONPD.  Remove part of    *
      *           169797 that issued the dbase error.                 *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  178785 - Database error if account is tagged for closure     *
      *           and unlinked.  ACST and DACC should not be updated  *
      *           in this program, CHTP should not be updated if CHTP *
      *           was previously 'C'.  Also, return the initial key   *
      *           before the chain to RELINKL1 is made.               *
      *  CDE002 - Revenue Analysis - Recompiled due to changes in     *
      *           PF/RECCYD.                                          *
     F*  170768 - Duplicate records on some files after restart,      *
     F*           because some updates not under commitment control.  *
     F*           Fix is to add KCOMIT to all files updated by this   *
     F*           program.                                            *
     F*  169797 - Remove FUSIONPD record when account is unlinked.    *
     F*         - Set up LTAS field in ACCNTAB correcly after unlink. *
     F*         - Set up account details correctly on narrative if    *
     F*           retail account numbers not used.                    *
     F*  169054 - Set up SPOS correctly for GE-FU postings, else      *
     F*           these will be ignored later, causing history        *
     F*           balance to be incorrect.                            *
     F*  154241  -  Set CHTP to 'A' on ACCNTAB to avoid FCOOB later.  *
     F*  144977  -  Remove fix 120414 as it causes DB error if unlink *
     F*             date is today or if no action on secondary a/c on *
     F*             or after unlink date, and also causes discrepancy *
     F*             on primary a/c as sec. a/c balance is effectively *
     F*             reversed out twice. Original problem caused by    *
     F*             unlink date being history start date for sec. a/c *
     F*             so REDPE failed but file was not repositioned     *
     F*             before READE. Reset limits before READE and if    *
     F*             unlink date is hist. start date for sec. a/c set  *
     F*             posting amount to zero on unlink GE-FU posting to *
     F*             primary a/c.                                      *
     F*  103460  -  Only charge interest if the balance exceeds the   *
     F*             initial threshhold.                               *
     F*  120414  -  DB error 012 when trying to REDPE and there is no *
     F*             record found                                      *
     F*  081162  -  When reversing out postings duplicated from the   *
     F*             secondary a/c to the primary a/c, ignore the GE-FU*
     F*             rec. created at link time; otherwise the unlinking*
     F*             GE-FU record will cause a history discrepancy.    *
     F*             Also amend narrative on the unlink GE-FU record   *
     F*             and correct file control report.                  *
     F*  CRE001  -  Overdraft Interest Calculation:                   *
     F*             To include Additional Overdraft Rate in the       *
     F*             calculation of DR interest accrued to date        *
     F*             on individual accounts, once they have been       *
     F*             linked.                                           *
     F*  S01408  -  Hook RE3262FFP1 added.                            *
     F*             Hook RE3262IIP3 added.                            *
     F*             Hook RE3262IIP2 added.                            *
     F*             Hook RE3262IIP1 added.                            *
     F*             Hook RE3262CP10 added.                            *
     F*             Hook RE3262CCP9 added.                            *
     F*             Hook RE3262CCP8 added.                            *
     F*             Hook RE3262CCP7 added.                            *
     F*             Hook RE3262CCP6 added.                            *
     F*             Hook RE3262CCP5 added.                            *
     F*             Hook RE3262CCP4 added.                            *
     F*             Hook RE3262CCP3 added.                            *
     F*             Hook RE3262CCP2 added.                            *
     F*             Hook RE3262CCP1 added.                            *
     F*  088029  -  Field 'RESULT' Not Correctly Formatted When       *
     F*             American Date Format is Used.                     *
     F*  S01408  -  Hook RE3262IIPG added.                            *
     F*  S01408  -  Hook RE3262CPD1 added.                            *
     F*             Hook RE3262CPD2 added.                            *
     F*             Hook RE3262CPD3 added.                            *
     F*             Hook RE3262CPD4 added.                            *
     F*             Hook RE3262CPD5 added.                            *
     F*             Hook RE3262CPD6 added.                            *
     F*  074578  -  Tiered interest not rounded correctly             *
     F*  S01413  -  Retail 3 Incorporation                            *
     F*                                                               *
     F*****************************************************************
     FREDETP  UF  E           K        DISK
     F            REHPOSPF                          KRENAMEREDETPF
     F                                              KCOMIT                170768
     FREDETY  UF  E           K        DISK                      A
     F            REEODPFF                          KRENAMEREDETYF
     F                                              KCOMIT                170768
     FREHRDJ  IF  E           K        DISK
     FREHRCJ  IF  E           K        DISK
     FRECCY   IF  E                    DISK
     F            RECCYAF                           KIGNORE
     F            RECCYZF                           KIGNORE
     FRELINKU UF  E                    DISK
     F            RELINKF                           KRENAMERELINKFF
     F                                              KCOMIT
     F                                              KINFDS LNKDS
     F                                              KINFSR LNKSR
      *                                                                   S01408
     F/COPY WNCPYSRC,RE3262FFP1                                           S01408
      *                                                                   S01408
     FREHISL  IF  E           K        DISK
     F            REHISPMF                          KIGNORE
     F            REHISPPF                          KRENAMEREHISLPF
     FREHISDL UF  E           K        DISK
     F                                              KCOMIT
     F                                              KINFDS HIPDS
     F                                              KINFSR HIPSR
     FREHISBL UF  E           K        DISK
     F            REHISPPF                          KRENAMEREHISBF
     F                                              KCOMIT
     F                                              KINFDS HIBDS
     F                                              KINFSR HIBSR
     FREHISLS UF  E           K        DISK                      A
     F            REHISPSF                          KRENAMEREHISSF
     F                                              KCOMIT
     F                                              KINFDS HIADS
     F                                              KINFSR HIASR
     FACCNT   UF  E           K        DISK
     F                                              KCOMIT
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F                                              KINFDS ACCDS
     F                                              KINFSR ACCSR
     FREACR   UF  E           K        DISK
     F                                              KCOMIT
     F            REACRAF                           KIGNORE
     F            REACRZF                           KIGNORE
     F                                              KINFDS READS
     F                                              KINFSR REASR
     FRECOM   UF  E           K        DISK         KCOMIT
     FTABLEV4 IF  E                    DISK
     FREIAC   UF  E           K        DISK                                                   230844
     F                                              KCOMIT                                    230844
     F            REIACAF                           KIGNORE                                   230844
     F            REIACZF                           KIGNORE                                   230844
     FRELINKL1UF  E           K        DISK                               169797
     F                                              KCOMIT                169797
     F/COPY WNCPYSRC,RE3262F001
     FRE3262AUO   E                    PRINTER
     F/COPY WNCPYSRC,RE3262F002
     F/EJECT
     F*****************************************************************
     F**          FUNCTION OF INDICATORS
     F*
     F*       51         ACCESS ON REDETM
     F*       52         ACCESS ON REDETY
     F*       53         ACCESS ON REHPOSPP
     F*       54         ACCESS ON REEODPF
     F*       55         ACCESS ON ACCNT
     F*       56         ACCESS ON REHISL
     F*       57         ACCESS ON REHISL
     F*       58         ACCESS ON REACR
     F*       59         ACCESS ON REHISLS
     F*       60         Access on SDCURRL0                               CRE001
     F*                                                                   CRE001
     F*       63         Unlink date is hist. start date for sec. a/c     144977
     F*       64         Currency Array Look-up successful                CRE001
     F*       65         Switchable feature CRE001 indicator              CRE001
     F*
     F*       U7         DATABASE ERROR
     F*       U8         DATABASE ERROR
     F*       LR         END OF PROGRAM
     F*
     F*****************************************************************
     F**          SUBROUTINES INDEX
     F*
     F*   ACCNSR - Update ACCNT
     F*   ACCSR  - ACCNT file exception/error handling
     F*   *PSSR  - Database error handling
     F*   EODPSR - Delete REEODPF
     F*   EODSR  - REEODPF file exception/error handling
     F*   FIRST  - First cycle
     F*   HISLSR - Create the S record and update the B record
     F*   LNKSR  - RELINKU file exception/error handling
     F*   MAIN   - Main processing
     F*   POPSR  - REHPOSPP file exception/error handling
     F*   POSSR  - Delete REHPOSPP
     F*   REACSR - Update REACR
     F*   REASR  - REACR file exception/error handling
     F*   TOTAL  - End processing
     F*   ZFDATE - Reformat date and ensure valid
     F*   ZFRQA  - Increment a day number date by a period value
     F*
     F*****************************************************************
     E*
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZDATE2Z1
     E                    CPY@    1   1 80
     E                    ZHC        50  3
     E                    ZFMD   12  12  2
     E                    ZIA        11 15 0             ZIC. WORK ARRAY
     E**********          ZIA1       11 15 5             ZIC. WORK ARRAY                      220323
     E                    ZIA1       11 30 9             ZIC. WORK ARRAY                      220323
     E                    ZIB        11 15 0A            ZIC. INT.BALANCES
     E                    ZIBD       11 15 0             ZIC. INT.BALANCES
     E                    ZIBC       11 15 0             ZIC. INT.BALANCES
     E                    ZIN        11 13 0             ZIC. INT.CALC
     E**********          ZIN1       11 18 5             ZIC. INT.CALC                 074578 220323
     E                    ZIN1       11 30 9             ZIC. INT.CALC                        220323
     E                    ZIR        11 11 7             ZIC. INT.RATES
     E                    ZIRC       11 11 7             ZIC. INT.RATES
     E                    ZIRD       11 11 7             ZIC. INT.RATES
     E*
     E                    CURR      150  3               CURRENCY
     E                    AMAX      150 13 0             ACCOUNT MAXIMUM
     E                    AMIN      150 13 0             ACCOUNT MINIMUM
     E                    ARET      150 10 8             COMMISSION RATE
     E                    DPA       150  1 0             CCY Decimal Pos. CRE001
     E*
     E                    CGRP        9  1               CUSTOMER GROUP
     E                    AGRP        9  1               ACCOUNT COMMISS.
     E*
     E/COPY WNCPYSRC,RE3262E001
     E                    NAR     1   1 35
     E/COPY WNCPYSRC,RE3262E002
     E/EJECT
     IREACRDF
     I*
     I** RENAME REACRDF FORMAT FIELDS - REACR FILE
     I*
     I              CUST                            CNUM
     I              ACCY                            CCY
     I              ASEQ                            ACSQ
     I              HISB                            RHISB
     I              LCD                             RHISD
     IACCNTABF
     I*
     I** RENAME ACCNTABF FORMAT FIELDS - ACCNT FILE
     I*
     I              DRIS                            DRIS1
     I              CRIS                            CRIS1
     IRELINKFF
     I*
     I** RENAME RELINKFF FORMAT FIELDS - RELINKU FILE
     I*
     I              VALL                            VALU
     IREHRCJF
     I*
     I** RENAME REHRCJF FORMAT FIELDS - REHRCJ FILE
     I*
     I              INTH                            INTHC
     I*
     IREHRDJF
     I*
     I** RENAME REHRDJF FORMAT FIELDS - REHRDJ FILE
     I*
     I              INTH                            INTHD
      *                                                                   S01408
     I/COPY WNCPYSRC,RE3262IIP1                                           S01408
      *                                                                   S01408
     I*
     I** KEY DATA STRUCTURE : DKEY AND LKEY TO MOVE IN LKEY  IF ERROR
     I*
     I            DS
     I**********                              1  23 REHKEY                                    CGL029
     I**********                              1  18 DKEY                                      CGL029
     I                                        1  29 REHKEY                                    CGL029
     I                                        1  24 DKEY                                      CGL029
     I                                        1   3 BRCA
     I**********                              4  18 AKEY                                      CGL029
     I                                        4  24 AKEY                                      CGL029
     I**********                              4   90CNUM                                      CSD027
     I                                        4   9 CNUM                                      CSD027
     I                                       10  12 REHCCY
     I**********                             13  160ACOD                                      CGL029
     I**********                             17  180ACSQ                                      CGL029
     I**********                             19  230WDATE                                     CGL029
     I**********                             19  230REHDAT                                    CGL029
     I                                       13  220ACOD                                      CGL029
     I                                       23  240ACSQ                                      CGL029
     I                                       25  290WDATE                                     CGL029
     I                                       25  290REHDAT                                    CGL029
     I*
     I** DATA STRUCTURE : PRIMARY ACCOUNT KEY FOR DATABASE ERROR REPORTING169797
     I*                                                                   169797
     I            DS                                                      169797
     I**********                              1  18 PKEY                               169797 CGL029
     I                                        1  24 PKEY                                      CGL029
     I**********                              1   60LTCUST                             169797 CSD027
     I                                        1   6 LTCUST                                    CSD027
     I                                        7   9 CCY                   169797
     I**********                             10  130LTAC                               169797 CGL029
     I**********                             14  150LTAS                               169797 CGL029
     I**********                             16  18 LTAB                               169797 CGL029
     I                                       10  190LTAC                                      CGL029
     I                                       20  210LTAS                                      CGL029
     I                                       22  24 LTAB                                      CGL029
     I*                                                                   169797
     I** DATA STRUCTURE : SECONDARY ACCOUNT KEY FOR DATABASE ERROR REP    169797
     I*                                                                   169797
     I            DS                                                      169797
     I**********                              1  18 SKEY                               169797 CGL029
     I                                        1  24 SKEY                                      CGL029
     I**********                              1   60SCNUM                              169797 CSD027
     I                                        1   6 SCNUM                                     CSD027
     I                                        7   9 SCCY                  169797
     I**********                             10  130SACOD                              169797 CGL029
     I**********                             14  150SACSQ                              169797 CGL029
     I**********                             16  18 SBRCA                              169797 CGL029
     I                                       10  190SACOD                                     CGL029
     I                                       20  210SACSQ                                     CGL029
     I                                       22  24 SBRCA                                     CGL029
     I*                                                                   169797
     I** DATA STRUCTURE FOR FINISHING DATE
     I*
     I            DS
     I                                        1   60FRES
     I                                        1   20ZIFD
     I                                        3   40ZIFM
     I                                        5   60ZIFY
     I*
     I** DATA STRUCTURE FOR BEGINNING DATE
     I*
     I            DS
     I                                        1   60SRES
     I                                        1   20ZISD
     I                                        3   40ZISM
     I                                        5   60ZISY
     I*
     I** DATA STRUCTURE FOR DATE FORMAT DD/MM/YY
     I*
     I            DS
     I                                        1   60RESULT
     I                                        1   20ZDAY
     I                                        3   40ZMTH
     I                                        5   60ZYEAR
     I*                                                                   088029
     I** DATA STRUCTURE FOR DATE FORMAT MM/DD/YY                          088029
     I*                                                                   088029
     I            DS                                                      088029
     I                                        1   60RESULX                088029
     I                                        1   20ZMTHX                 088029
     I                                        3   40ZDAYX                 088029
     I                                        5   60ZYEARX                088029
     I*                                                                   088029
     I** DATA STRUCTURE FOR BEGINNING DATE MM/DD/YY                       088029
     I*                                                                   088029
     I            DS                                                      088029
     I                                        1   60SRESX                 088029
     I                                        1   20ZISMX                 088029
     I                                        3   40ZISDX                 088029
     I                                        5   60ZISYX                 088029
     I*                                                                   088029
     I** DATA STRUCTURE FOR FINISHING DATE MM/DD/YY                       088029
     I*                                                                   088029
     I            DS                                                      088029
     I                                        1   60FRESX                 088029
     I                                        1   20ZIFMX                 088029
     I                                        3   40ZIFDX                 088029
     I                                        5   60ZIFYX                 088029
      *                                                                   S01408
     I/COPY WNCPYSRC,RE3262IIP2                                           S01408
      *                                                                   S01408
     I*
     I** SECONDARY KEY
     I*
     IWKEY        DS
     I**********                              1   60WCNUM                                     CSD027
     I                                        1   6 WCNUM                                     CSD027
     I                                        7   9 WCCY
     I**********                             10  130WACOD                                     CGL029
     I**********                             14  150WACSQ                                     CGL029
     I                                       10  190WACOD                                     CGL029
     I                                       20  210WACSQ                                     CGL029
     I            DS
     I                                        1  30 WNAR
     I************                            1  15 WNAR1                 081162
     I************                           16  30 WNAR2                 081162
     I                                        1   9 WNAR1                 081162
     I                                       10  30 WNAR2                 081162
     I                                       20  22 WCCY2                 169797
     I*
     I** DATA STRUCTURE TO SPLIT FROM ALPHA TO NUMERIC DEBIT AND
     I** CREDIT BALANCES
     I*
     IWDBAL       DS
     I                                    P   1  880ZIBD
     I                                    P   1   80ZBD01
     I                                    P   9  160ZBD02
     I                                    P  17  240ZBD03
     I                                    P  25  320ZBD04
     I                                    P  33  400ZBD05
     I                                    P  41  480ZBD06
     I                                    P  49  560ZBD07
     I                                    P  57  640ZBD08
     I                                    P  65  720ZBD09
     I                                    P  73  800ZBD10
     I                                    P  81  880ZBD11
     I                                    P  89  960ZBD12
     I*
     IWCBAL       DS
     I                                    P   1  880ZIBC
     I                                    P   1   80ZBC01
     I                                    P   9  160ZBC02
     I                                    P  17  240ZBC03
     I                                    P  25  320ZBC04
     I                                    P  33  400ZBC05
     I                                    P  41  480ZBC06
     I                                    P  49  560ZBC07
     I                                    P  57  640ZBC08
     I                                    P  65  720ZBC09
     I                                    P  73  800ZBC10
     I                                    P  81  880ZBC11
     I                                    P  89  960ZBC12
     I*
     I** DATA STRUCTURE TO SPLIT FROM ALPHA TO NUMERIC DEBIT AND
     I** CREDIT RATES
     I*
     IWDRAT       DS
     I                                    P   1  667ZIRD
     I                                    P   1   67ZRD01
     I                                    P   7  127ZRD02
     I                                    P  13  187ZRD03
     I                                    P  19  247ZRD04
     I                                    P  25  307ZRD05
     I                                    P  31  367ZRD06
     I                                    P  37  427ZRD07
     I                                    P  43  487ZRD08
     I                                    P  49  547ZRD09
     I                                    P  55  607ZRD10
     I                                    P  61  667ZRD11
     I                                    P  67  727ZRD12
     I*
     IWCRAT       DS
     I                                    P   1  667ZIRC
     I                                    P   1   67ZRC01
     I                                    P   7  117ZRC02
     I                                    P  13  187ZRC03
     I                                    P  19  247ZRC04
     I                                    P  25  307ZRC05
     I                                    P  31  367ZRC06
     I                                    P  37  427ZRC07
     I                                    P  43  487ZRC08
     I                                    P  49  547ZRC09
     I                                    P  55  607ZRC10
     I                                    P  61  667ZRC11
     I                                    P  67  727ZRC12
     I*
     I** DATA STRUCTURE FOR RPG STATUS ERROR HANDLING
     I*
     ILNKDS       DS
     I                                     *STATUS  STSLNK
     IACCDS       DS
     I                                     *STATUS  STSACC
     IREADS       DS
     I                                     *STATUS  STSREA
     IHIPDS       DS
     I                                     *STATUS  STSHIP
     IHIBDS       DS
     I                                     *STATUS  STSHIB
     IHIADS       DS
     I                                     *STATUS  STSHIA
     ISPOOLU      DS
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
     I/COPY ZSRSRC,ZHOLI
     I*
     ISDBANK    E DSSDBANKPD
     I              BJRDNB                          RUND
     I              BJURPT                          TITL
     I              BJMRDT                          RUNA
     I*
     I** Bank Details
     I*
     ISDRETL    E DSSDRETLPD                                              169797
     I              BMRANR                          RACN                  169797
      *                                                                   169797
     I** Retail ICD details                                               169797
      *                                                                   169797
     ISDCUST    E DSSDCUSTPD
     I*
     I** Client Details
     I*
     IDSFDY     E DSDSFDY
     I*
     I** First DS for access programs, Short data structure
     I*
     ISCSARD    E DSSCSARDPD                                                                  CER016
      *                                                                                       CER016
      ** Externam DS SC Switchable Features                                                   CER016
      *                                                                                       CER016
     IDSSDY     E DSDSSDY
     I*
     I** Second DS for access programs, Long data structure
     I*
      *                                                                   S01408
     I/COPY WNCPYSRC,RE3262IIP3                                           S01408
      *                                                                   S01408
     ISDCURR    E DSSDCURRPD                                              CRE001
     I** Currency Details                                                 CRE001
     I*                                                                   CRE001
     ISDBRCH    E DSSDBRCHPD
     I              A8BRNM                          BRNM
     I              QQDFAC                          QQDFA1                                    CGL029
     I*
     I**  External DS for Branch Codes.
     I*                                                                   S01408
     I/COPY WNCPYSRC,RE3262IIPG                                           S01408
     I*                                                                   S01408
     I*
     I/COPY ZSRSRC,ZAOZ2
     I              QQACCD                          QQACC1                                    CGL029
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA        UDS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *                                                                                       CER016
      ** Constant Value                                                                       CER016
      *                                                                                       CER016
     I              'InterestNumber'      C         PSYSVL                                    CER016
     I/EJECT
     C*===================================================================
     C*
     C** KEY LIST
     C*
     C** KEY FIELD TO READ REDETM AND REDETY FILES
     C*
     C           REPKEY    KLIST
     C                     KFLD           BRCA
     C                     KFLD           ZZCNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           LTAB
     C                     KFLD           LTCUST
     C/COPY WNCPYSRC,RE3262C009
     C                     KFLD           LTAC
     C                     KFLD           LTAS
     C                     KFLD           VALU
     C           REYKEY    KLIST
     C                     KFLD           BRCA
     C                     KFLD           ZZCNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           LTAB
     C                     KFLD           LTCUST
     C/COPY WNCPYSRC,RE3262C010
     C                     KFLD           LTAC
     C                     KFLD           LTAS
     C/COPY WNCPYSRC,RE3262C011
     C*
     C** KEY FIELD TO READ REHPOPL AND REHISL FILES
     C*
     C           REDKEY    KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           HISD
     C*
     C** KEY FIELD TO READ ACCNT AND REACR FILES
     C*
     C           ACCKEY    KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA
     C*
     C** KEY FIELD TO READ ACCNT AND RECOM FILES
     C*
     C           ACCKY     KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C*
     C** KEY FIELD TO READ ACCNT AND REACR FILES
     C*
     C           WWKEY     KLIST
     C                     KFLD           WCNUM
     C                     KFLD           WCCY
     C                     KFLD           WACOD
     C                     KFLD           WACSQ
     C           LNKKEY    KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C*
     C** KEY FIELD TO READ ACCNT RECORD FOR PRIMARY FILE                  169797
     C*                                                                   169797
     C           ACCKYP    KLIST                                          169797
     C                     KFLD           LTCUST                          169797
     C                     KFLD           CCY                             169797
     C                     KFLD           LTAC                            169797
     C                     KFLD           LTAS                            169797
     C                     KFLD           LTAB                            169797
     C*                                                                   169797
     C** KEY FIELD TO ACCESS TO REHRDJ/REHRCJ FILE
     C*
     C           DCKEY     KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           KDATE
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP1                                           S01408
      *                                                                   S01408
     C*
     C** WORK FIELDS DEFINITION
     C*
     C           *LIKE     DEFN LTAC      WLTAC
     C           *LIKE     DEFN LTAS      WLTAS
     C           *LIKE     DEFN LTAB      WLTAB
     C           *LIKE     DEFN LTCUST    WLTCUS
     C           *LIKE     DEFN CMVT      WCMVT
     C           *LIKE     DEFN DMVT      WDMVT
     C           *LIKE     DEFN VDTC      BVDTC
     C           *LIKE     DEFN ADTY      BADTY
     C           *LIKE     DEFN BRCA      WBRCA
     C           *LIKE     DEFN HISD      PHISD
     C           *LIKE     DEFN HISD      WHISD
     C           *LIKE     DEFN RHISB     ZITHR
     C           *LIKE     DEFN ACSQ      ZIY1
     C           *LIKE     DEFN RUND      ZID1
     C           *LIKE     DEFN RUND      ZID2
     C           *LIKE     DEFN ACSQ      ZIDW1
     C           *LIKE     DEFN RUND      ZIDW2
     C           *LIKE     DEFN ACSQ      ZLYREM
     C           *LIKE     DEFN ZZ006     ZZCNUM
     C           *LIKE     DEFN RUND      ZLDTM
     C           *LIKE     DEFN RUND      ZIDREM
     C           *LIKE     DEFN ACOD      ZLYCHK
     C           *LIKE     DEFN ACSQ      ZICT
     C           *LIKE     DEFN DRIC      ZICALC
     C           *LIKE     DEFN RUND      ZIBW1
     C           *LIKE     DEFN RUND      KDATE
     C           *LIKE     DEFN RUND      ZIBEG
     C           *LIKE     DEFN RUND      ZIEND
     C           *LIKE     DEFN RUND      ZIREM
     C           *LIKE     DEFN DRIS1     ZIRATE
     C           *LIKE     DEFN DRIS1     WRATE                                               CER016
     C           *LIKE     DEFN DIIE      ZINTR
     C           *LIKE     DEFN ACSQ      ZIM1
     C           *LIKE     DEFN ACSQ      ZIMAN
     C           *LIKE     DEFN RUND      ZILPCP
     C           *LIKE     DEFN RHISB     ZIAMT
     C           *LIKE     DEFN RHISB     ZIAMT1
     C           *LIKE     DEFN RHISB     ZIAMTR
     C           *LIKE     DEFN RHISB     ZBAL
     C           *LIKE     DEFN RHISB     WAMT                                                CER016
     C           *LIKE     DEFN RHISB     WINAMT                                              CER016
     C           *LIKE     DEFN RHISB     WNAMT1                                              CER016
     C           *LIKE     DEFN RHISB     WNAMT2                                              CER016
     C           *LIKE     DEFN ACSQ      Z
     C           *LIKE     DEFN ACSQ      Y
     C           *LIKE     DEFN DRIC      LOOP
     C           *LIKE     DEFN KEY       ZTABKY
     C           *LIKE     DEFN ACNO      WACNO
     C           *LIKE     DEFN KEY       ERRDAT
     C********** *LIKE     DEFN CNUM      ZERROR- 5                                           CSD027
     C                     Z-ADD*ZEROS    ZERROR  10                                          CSD027
     C           *LIKE     DEFN LDBL      CINT
     C           *LIKE     DEFN LDBL      DINT
     C*
     C/EJECT
     C*===================================================================
     C** P R O G R A M     S T A R T
     C*===================================================================
     C*
     C** FIRST CYCLE PROCESSING
     C*
     C                     EXSR FIRST
     C*
     C** MAIN PROCESSING
     C*
     C           1         SETLLRELINKU                  90
     C                     READ RELINKU                  LR
     C*
     C           *INLR     DOWEQ'0'                        - B1
     C/COPY WNCPYSRC,RE3262C001
     C                     EXSR MAIN
     C                     Z-ADD01        DBASE
     C                     DELETRELINKU
     C/COPY WNCPYSRC,RE3262C002
     C                     Z-ADD02        DBASE
     C                     READ RELINKU                  LR
     C                     END                             - E1
     C*
     C** TOTAL PROCESSING
     C*
     C                     EXSR TOTAL
     C*
     C                     COMIT
     C*
     C*===================================================================
     C** P R O G R A M     E N D
     C*===================================================================
     C/EJECT
     C********************************************************************
     C**
     C** ACCNSR subroutine to update the ACCNT record
     C**
     C**     Called by       MAIN
     C**     Calls           *PSSR, ZFREQA
     C**
     C           ACCNSR    BEGSR                           **ACCNSR BEGSR**
     C*
     C                     Z-ADDWACOD     ACOD
     C                     Z-ADDWACSQ     ACSQ
     C**********           Z-ADDWCNUM     CNUM                                                CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C/COPY WNCPYSRC,RE3262C012
     C*
     C                     Z-ADD03        DBASE
     C           ACCKEY    CHAINACCNT                55
     C*
     C           *IN55     IFEQ '1'                        - B1
     C                     MOVE CCY       REHKEY
     C                     Z-ADD04        DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           **DB ERROR 04**
     C                     MOVELAKEY      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C                     Z-ADDACNO      WACNO
     C                     Z-ADDRUND      LCD
     C           CHTP      IFNE 'C'                                       178785
     C                     MOVE 'A'       CHTP                            154241
     C                     ENDIF                                          178785
     C                     Z-ADD*ZEROS    CIIE
     C                     Z-ADD*ZEROS    DIIE
     C                     Z-ADDVALU      LCID
     C                     Z-ADDVALU      LDID
     C                     MOVE CEXB      WCEXB  10
     C                     MOVE *BLANKS   LTAB
     C                     Z-ADD*ZEROS    LTAC
     C/COPY WNCPYSRC,RE3262C013
     C                     Z-ADD*ZEROS    LTAS
     C                     Z-ADDVALU      NCID
     C                     Z-ADDVALU      NDID
     C                     MOVE *BLANKS   DDIS
     C                     MOVE *BLANKS   CDIS
     C**********           MOVE *BLANKS   ACST                            178785
     C**********           Z-ADD*ZEROS    DACC                            178785
     C*
     C** COMPUTE THE NEXT DEBIT INTEREST CAPITALISATION DATE
     C*
     C           DRIF      IFNE 'Z'
     C*
     C           NDID      DOWLERUND                       - B1
     C*
     C                     Z-ADDNDID      ZDAYNO
     C                     MOVE DRIF      ZFREQ
     C                     MOVE CCY       ZCCY
     C                     Z-ADDDRDY      ZMDAY
     C*
     C                     EXSR ZFRQA
     C*
     C                     Z-ADDZDAYNO    NDID
     C*
     C                     END                             - E1
     C*
     C                     ELSE
     C*
     C                     Z-ADD*ZEROS    NDID
     C*
     C                     END
     C*
     C** COMPUTE THE NEXT CREDIT INTEREST CAPITALISATION DATE
     C*
     C           CRIF      IFNE 'Z'
     C*
     C           NCID      DOWLERUND                       - B1
     C*
     C                     Z-ADDNCID      ZDAYNO
     C                     MOVE CRIF      ZFREQ
     C                     MOVE CCY       ZCCY
     C                     Z-ADDCRDY      ZMDAY
     C*
     C                     EXSR ZFRQA
     C*
     C                     Z-ADDZDAYNO    NCID
     C*
     C                     END                             - E1
     C*
     C                     ELSE
     C*
     C                     Z-ADD*ZEROS    NCID
     C*
     C                     END
     C*
     C** UPDATE ACCNT
     C*
     C                     Z-ADD05        DBASE
     C                     UPDATACCNTABF
     C*
     C                     ENDSR                           **ACCNSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ACCSR subroutine for ACCNT file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
     C           ACCSR     BEGSR                           **ACCSR BEGSR**
     C*
     C                     MOVE CCY       REHCCY
     C                     MOVE 'ACCNT'   DBFILE           **DB ERROR 02**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     MOVELSTSACC    DBSTAT
     C                     MOVE '1'       *IN88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **ACCSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** *PSSR subroutine for database error handling
     C**
     C**     Called by       FIRST, MAIN, EODPSR, POSSR, HISLSR,
     C**                     ACCNSR, REACSR, EODSR, LNKSR, POPSR,
     C**                     ACCSR, REASR, ZFDATE
     C**     Calls           -
     C**
     C           *PSSR     BEGSR                           **PSSR BEGSR**
     C*
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     WRITEERRAU
     C*
     C                     RETRN
     C*
     C                     ENDSR                           **PSSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** EODPSR subroutine to delete in REEODPF
     C**
     C**     Called by       MAIN
     C**     Calls           *PSSR
     C**
     C           EODPSR    BEGSR                           **EODPSR BEGSR**
     C*
     C** DELETE DUPLICATE RECORD
     C*
     C                     Z-ADD06        DBASE
     C                     DELETREDETYF
     C*
     C***********          ADD  1         NORE2                           081162
     C                     ADD  1         NORE1                           081162
     C*
     C** RESTORE THE INITIAL KEY
     C*
     C                     MOVE WBRCA     BRCA
     C                     Z-ADDWACOD     ACOD
     C                     Z-ADDWACSQ     ACSQ
     C**********           Z-ADDWCNUM     CNUM                                                CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C/COPY WNCPYSRC,RE3262C014
     C*
     C                     Z-ADD07        DBASE
     C           REYKEY    READEREDETY                   52
     C*
     C                     ENDSR                           **EODPSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** EODUPD subroutine to add a record on PF/REEODPF with the reverse
     C**        balance of the secondary on the primary
     C**
     C**     Called by       MAIN
     C**     Calls           *PSSR
     C**
     C           EODUPD    BEGSR                           **EODUPD BEGSR**
     C*
     C                     MOVE CCY       WCCY
     C                     MOVE WBRCA     BRCA
     C                     Z-ADDWACOD     ACOD
     C                     Z-ADDWACSQ     ACSQ
     C**********           Z-ADDWCNUM     CNUM                                                CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C/COPY WNCPYSRC,RE3262C015
     C*
     C                     MOVE '0'       *IN63                           144977
     C                     Z-ADDVALU      KDATE
     C                     Z-ADD08        DBASE
     C           DCKEY     SETLLREHISDL                  61
     C*
     C***********LNKKEY    REDPEREHISDL                  61                     120414
     C************IN61     IFEQ '1'                                             120414
     C           LNKKEY    REDPEREHISDL                  61               144977
     C           *IN61     IFEQ '1'                                       144977
     C           DCKEY     SETLLREHISDL                                   144977
     C********** LNKKEY    READEREHISDL                  61               144977
     C           DCKEY     READEREHISDL                  61               144977
     C           *IN61     IFEQ '1'
     C                     MOVE CCY       REHCCY
     C                     Z-ADDVALU      WDATE
     C                     Z-ADD12        DBASE            ***************
     C                     MOVE 'REHIS'   DBFILE           **DB ERROR 12**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     EXSR *PSSR
      *                                                                   144977
     C                     ELSE                                           144977
     C                     MOVE '1'       *IN63                           144977
     C                     END
     C************         END                                                   120414
     C                     END                                            144977
     C*
     C**********           Z-ADDWLTCUS    CNUM                                                CSD027
     C                     MOVE WLTCUS    CNUM                                                CSD027
     C                     Z-ADDWLTAC     ACOD
     C                     Z-ADDWLTAS     ACSQ
     C                     MOVE WLTAB     BRCA
     C/COPY WNCPYSRC,RE3262C016
     C*
     C                     Z-ADD13        DBASE
     C           ACCKEY    CHAINACCNT                60
     C*
     C           *IN60     IFEQ '1'                        - B1
     C                     Z-ADD14        DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           **DB ERROR 14**
     C                     MOVELWKEY      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C                     MOVELNAR,1     WNAR1
     C/COPY WNCPYSRC,RE3262C003
     C           RACN      IFEQ 'Y'                                       169797
     C                     MOVELWACNO     WNAR2
     C                     ELSE                                           169797
     C                     MOVELDKEY      WNAR2                           169797
     C                     MOVELCCY       WCCY2                           169797
     C                     END                                            169797
     C                     MOVE WNAR      PNAR
     C*
     C                     MOVE WLTCUS    CNUM
     C                     MOVE WLTAC     ACOD
     C                     MOVE WLTAS     ACSQ
     C                     MOVE WLTAB     BRCA
     C/COPY WNCPYSRC,RE3262C017
     C                     MOVE *BLANKS   ZZ006
     C                     Z-ADD*ZEROS    FTAC
     C                     Z-ADD*ZEROS    FTAS
     C                     MOVE *BLANKS   FTAB
     C*
     C           *IN63     IFEQ '1'                                       144977
     C                     Z-ADD*ZERO     PSTA                            144977
     C                     ELSE                                           144977
     C           HISB      IFLT *ZEROS                     - B1
     C                     Z-ADD*ZEROS    DRCR
     C                     Z-SUBHISB      PSTA
     C                     ELSE                            - X1
     C                     Z-ADD1         DRCR
     C                     Z-ADDHISB      PSTA
     C                     END                             - E1
     C                     END                                            144977
     C/COPY WNCPYSRC,RE3262C018
     C*
     C                     Z-ADDRUND      PSTD
     C                     Z-ADDVALU      VALD
     C                     MOVE 'P'       RECI
     C                     MOVE '00001'   TRAT
     C                     MOVE '1'       RIND
     C                     MOVE 'R'       ATYP
     C************         MOVE 'GE-FU'   SPOS                            169054
     C                     MOVE '  GE-FU' SPOS                            169054
     C*
     C                     Z-ADD15        DBASE
     C/COPY WNCPYSRC,RE3262C008
     C                     WRITEREDETYF
     C/COPY WNCPYSRC,RE3262C004
     C*
     C                     ENDSR                           **EODUPD ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** FIRST subroutine to execute first cycle.
     C**
     C**     Called by       S T A R T
     C**     Calls           *PSSR
     C**
     C           FIRST     BEGSR                           **FIRST BEGSR**
     C                     MOVEACPY@      BIS@   80
     C*
     C           *NAMVAR   DEFN           LDA
     C*
     C** INITIALISE LDA VARIABLES
     C*
     C***********          MOVE 'RE3262  'DBPGM                           CRE001
     C                     MOVEL'RE3262  'DBPGM                           CRE001
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBASE
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ***************
     C                     MOVEL@OPTN     DBKEY            * DBERROR 016 *
     C                     Z-ADD016       DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP2                                           S01408
      *                                                                   S01408
     C*
     C** CHECK DATE FORMAT
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     END
     C*
     C*  Access Retail ICD                                                169797
     C                     CALL 'AORETLR0'                                169797
     C                     PARM '*DBERR ' @RTCD   7                       169797
     C                     PARM '*FIRST ' @OPTN   7                       169797
     C           SDRETL    PARM SDRETL    DSFDY                           169797
     C*                                                                   169797
     C** OUTPUT AUDIT HEADER
     C*
     C                     WRITEHEADAU
     C*
     C** INITIALIZE FIELDS TO WRITE IN AUDIT
     C*
     C                     Z-ADD*ZEROS    NORE1
     C                     Z-ADD*ZEROS    NORE2
     C                     Z-ADD*ZEROS    NORE3
     C                     Z-ADD*ZEROS    ZDAYN2  94
     C**********           Z-ADD*ZEROS    ZIWRK1 155                                          220323
     C**********           Z-ADD*ZEROS    ZIWRK2 155                                          220323
     C                     Z-ADD*ZEROS    ZIWRK1 309                                          220323
     C                     Z-ADD*ZEROS    ZIWRK2 309                                          220323
      *                                                                   CRE001
      ** Define work  fields for Overdraft Interest details               CRE001
     C                     Z-ADD*ZEROS    WWINTA 150                      CRE001
     C                     Z-ADD*ZEROS    WWDRIA 150                      CRE001
     C                     Z-ADD*ZEROS    WWODIA 150                      CRE001
     C                     Z-ADD*ZEROS    WWODRL 150                      CRE001
      *                                                                   CRE001
      ** Check if Overdraft Interset Calculations feature is on           CRE001
     C                     MOVE 'N'       CRE001  1                       CRE001
     C                     CALL 'AOSARDR0'                                CRE001
     C                     PARM *BLANKS   @RTCD   7                       CRE001
     C                     PARM '*VERIFY' @OPTN   7                       CRE001
     C                     PARM 'CRE001'  @SARD   6                       CRE001
      *                                                                   CRE001
     C           @RTCD     IFNE *BLANKS                                   CRE001
     C           @RTCD     ANDNE'*NRF   '                                 CRE001
     C                     SETON                     U7U8LR               CRE001
     C                     MOVEL'CRE001'  DBKEY                           CRE001
     C                     MOVE 'SCSARDPD'DBFILE           ***************CRE001
     C                     Z-ADD061       DBASE            * DBERR0R 061 *CRE001
     C                     EXSR *PSSR                      ***************CRE001
     C                     END                                            CRE001
      *                                                                   CRE001
     C           @RTCD     IFEQ *BLANKS                                   CRE001
     C                     MOVE 'Y'       CRE001                          CRE001
     C                     MOVE '1'       *IN65   1                       CRE001
     C                     ELSE                                           CRE001
     C                     MOVE 'N'       CRE001                          CRE001
     C                     MOVE '0'       *IN65                           CRE001
     C                     END                                            CRE001
     C*
     C** STORE ALL RETAIL ICD BY CURRENCY RECORDS
     C*
     C                     Z-ADD1         X       30
     C*
     C                     READ RECCYDF                  40
     C*
     C           *IN40     DOWEQ'0'                        - B1
     C           RECI      IFEQ 'D'                         - B2
     C                     MOVE KEY       CUR     4
     C                     MOVELCUR       CURR,X
     C                     MOVE ACMX      AMAX,X
     C                     MOVE ACMN      AMIN,X
     C                     Z-ADDACRT      ARET,X
      *                                                                   CRE001
      ** Get Currency Decimal Points for each Retail Currency retrieved   CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     MOVELCUR       SCUR    3                       CRE001
     C                     CALL 'AOCURRR0'                                CRE001
     C                     PARM '*MSG   ' @RTCD                           CRE001
     C                     PARM '*KEY   ' @OPTN                           CRE001
     C                     PARM SCUR      @CCY    3                       CRE001
     C           SDCURR    PARM SDCURR    DSSDY                           CRE001
     C           @RTCD     IFNE *BLANK                     B..3           CRE001
     C                     Z-ADD97        DBASE            ***************CRE001
     C                     MOVE 'SDCURRPD'DBFILE           **DB ERROR 97**CRE001
     C                     MOVELSCUR      DBKEY            ***************CRE001
     C                     EXSR *PSSR                                     CRE001
     C                     ENDIF                           E..3           CRE001
      *                                                                   CRE001
      ** Move Currency Decimal Points to array                            CRE001
     C                     MOVE A6NBDP    DPA,X                           CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     ADD  1         X
     C                     END                              - E2
     C                     READ RECCYDF                  40- E1
     C                     END
     C*
     C** STORE THE EIGHT GROUPS RECORDS FROM THE RETAIL TABLE
     C*
     C                     Z-ADD1         W       10
     C*
     C                     MOVEL'81      'CTKEY  12
     C                     MOVE '    '    CTKEY
     C           1         SETLLTABLEV4
     C*
     C                     READ TABLEV4                  42
     C                     MOVELCTKEY     CT      2
     C*
     C           *IN42     DOUEQ'1'                        - B1
     C           RECI      IFEQ 'D'                         - B2
     C           CT        IFEQ '81'                         - B3
     C                     MOVE ZZ010     CGRP,W
     C                     MOVE ACMI      AGRP,W
     C                     ADD  1         W
     C                     END                               - E3
     C                     READ TABLEV4                  42
     C                     MOVELCTKEY     CT      2
     C                     END                              - E2
     C                     END                             - E1
     C*
     C** Call AOSARDR0 to check for CER016                                                    CER016
     C*                                                                                       CER016
     C                     CALL 'AOSARDR0'                                                    CER016
     C                     PARM *BLANKS   PRTCD   7                                           CER016
     C                     PARM '*VERIFY' POPTN   7                                           CER016
     C                     PARM 'CER016'  PSARD   6                                           CER016
     C           SCSARD    PARM SCSARD    DSFDY                                               CER016
      *                                                                                       CER016
     C           PRTCD     IFEQ *BLANKS                                                       CER016
     C                     MOVE 'Y'       CER016  1                                           CER016
     C                     MOVE 'Y'       WFIRST  1                                           CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C                     MOVE 'N'       CER016                                              CER016
     C                     MOVE 'N'       WFIRST                                              CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C           PRTCD     IFNE *BLANKS                                                       CER016
     C           PRTCD     ANDNE'*NRF   '                                                     CER016
     C           *LOCK     IN   LDA                                                           CER016
     C                     MOVEL'CER016'  DBKEY                                               CER016
     C                     MOVEL'SCSARDPD'DBFILE                                              CER016
     C                     Z-ADD98        DBASE                                               CER016
     C                     OUT  LDA                                                           CER016
     C                     EXSR *PSSR                                                         CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C                     ENDSR                           **FIRST ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** HISLSR subroutine to create a S record on REHISL and to update
     C**        the B record
     C**
     C**     Called by       MAIN
     C**     Calls           *PSSR, INTCAL
     C**
     C           HISLSR    BEGSR                           **HISLSR BEGSR**
     C*
     C** UPDTA THE B RECORD OF THE PRIME TO REBUILD HISTORY
     C*
     C                     MOVE WLTAB     BRCA
     C                     Z-ADDWLTAC     ACOD
     C                     Z-ADDWLTAS     ACSQ
     C**********           Z-ADDWLTCUS    CNUM                                                CSD027
     C                     MOVE WLTCUS    CNUM                                                CSD027
     C/COPY WNCPYSRC,RE3262C019
     C           LNKKEY    CHAINREHISBL              57
     C*
     C           *IN57     IFEQ '1'                        - B1
     C                     MOVE CCY       REHCCY
     C                     Z-ADD17        DBASE            ***************
     C                     MOVE 'HISBL'   DBFILE           **DB ERROR 17**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C                     Z-ADDVALU      VDTC
     C                     MOVE 'Y'       ADTY
     C                     UPDATREHISBF
     C*
     C** RESTORE SECONDARY
     C*
     C                     MOVE WBRCA     BRCA
     C                     Z-ADDWACOD     ACOD
     C                     Z-ADDWACSQ     ACSQ
     C**********           Z-ADDWCNUM     CNUM                                                CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C/COPY WNCPYSRC,RE3262C020
     C*
     C** ACCESS ACCNT FOR THE SECONDARY TO GET LAST CAPITALISATION DATES
     C*
     C                     Z-ADD20        DBASE
     C           ACCKEY    CHAINACCNT                55
     C*
     C           *IN55     IFEQ '1'                        - B1
     C                     MOVE CCY       REHCCY
     C                     Z-ADD21        DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           **DB ERROR 21**
     C                     MOVELAKEY      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C                     Z-ADD*ZEROS    HISD
     C*
     C***********          Z-ADD17        DBASE                           CRE001
     C                     Z-ADD9         DBASE                           CRE001
     C           LNKKEY    CHAINREHISBL              57
     C*
     C           *IN57     IFEQ '1'                        - B1
     C                     MOVE CCY       REHCCY
     C                     Z-ADD18        DBASE            ***************
     C                     MOVE 'HISBL'   DBFILE           **DB ERROR 18**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C                     Z-ADDVALU      VDTC
     C                     MOVE 'Y'       ADTY
     C*
     C                     MOVE 'D'       LINK
     C*
     C** UPDATE B RECORD
     C*
     C                     Z-ADD19        DBASE
     C                     UPDATREHISBF
     C*
     C** CREATE NEW RECORD S ON BASE OF THE PREVIOUS
     C*
     C                     Z-ADDVALU      HISD
     C*
     C                     Z-ADD22        DBASE
     C           REDKEY    CHAINREHISLS              59
     C*
     C           *IN59     IFEQ '1'                        - B1
     C*
     C                     Z-ADD23        DBASE
     C           REDKEY    SETGTREHISL
     C                     Z-ADD24        DBASE
     C           LNKKEY    REDPEREHISL                   56
     C*
     C           *IN56     IFEQ '1'                        - B2
     C                     Z-ADDHISD      WDATE
     C                     Z-ADD25        DBASE            ***************
     C                     MOVE 'HISLS'   DBFILE           **DB ERROR 25**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C           HISD      IFEQ VALU                       - B2
     C*
     C           RECI      IFEQ 'B'                        - B3
     C           RECI      OREQ 'D'
     C                     Z-ADDDAID      DRIS
     C                     Z-ADDCAID      CRIS
     C                     Z-ADD*ZEROS    DAIC
     C                     Z-ADD*ZEROS    CAIC
     C                     Z-ADDHISB      STBL
     C                     MOVE 'S'       RECI
     C                     Z-ADDVALU      HISD
     C                     Z-ADDLDID      PDID
     C                     Z-ADDLCID      PCID
     C                     MOVE 'Y'       SDICI
     C                     MOVE 'Y'       SCICI
     C                     Z-ADD26        DBASE
     C                     WRITEREHISSF
     C*
     C                     ELSE                            - X3
     C                     Z-ADDDAIC      DRIS
     C                     Z-ADDCAIC      CRIS
     C                     Z-ADD*ZEROS    DAIC
     C                     Z-ADD*ZEROS    CAIC
     C                     Z-ADDHISB      STBL
     C                     Z-ADDVALU      HISD
     C                     Z-ADDLDID      PDID
     C                     Z-ADDLCID      PCID
     C                     MOVE 'Y'       SDICI
     C                     MOVE 'Y'       SCICI
     C                     WRITEREHISSF
     C*
     C                     END                             - E3
     C*
     C                     ELSE                            - X2
     C*
     C           RECI      IFEQ 'D'                        - B3
     C*
     C                     Z-ADD*ZEROS    DINT
     C                     Z-ADD*ZEROS    CINT
     C                     EXSR INTCAL
     C           DAID      ADD  DINT      DRIS
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP3                                           S01408
      *                                                                   S01408
     C           CAID      ADD  CINT      CRIS
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP4                                           S01408
      *                                                                   S01408
     C                     Z-ADD*ZEROS    DAIC
     C                     Z-ADD*ZEROS    CAIC
     C                     Z-ADDHISB      STBL
     C                     MOVE 'S'       RECI
     C                     Z-ADDVALU      HISD
     C                     Z-ADDLDID      PDID
     C                     Z-ADDLCID      PCID
     C                     MOVE 'Y'       SDICI
     C                     MOVE 'Y'       SCICI
     C                     Z-ADD27        DBASE
     C                     WRITEREHISSF
     C*
     C                     ELSE                            - X3
     C*
     C                     Z-ADD*ZEROS    DINT
     C                     Z-ADD*ZEROS    CINT
     C                     EXSR INTCAL
     C           DAIC      ADD  DINT      DRIS
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP5                                           S01408
      *                                                                   S01408
     C           CAIC      ADD  CINT      CRIS
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP6                                           S01408
      *                                                                   S01408
     C                     Z-ADD*ZEROS    DAIC
     C                     Z-ADD*ZEROS    CAIC
     C                     Z-ADDHISB      STBL
     C                     MOVE 'S'       RECI
     C                     Z-ADDVALU      HISD
     C                     Z-ADDLDID      PDID
     C                     Z-ADDLCID      PCID
     C                     MOVE 'Y'       SDICI
     C                     MOVE 'Y'       SCICI
     C                     Z-ADD28        DBASE
     C                     WRITEREHISSF
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C                     ADD  DAIC      DRIS
     C                     ADD  CAIC      CRIS
     C                     Z-ADD*ZEROS    DAIC
     C                     Z-ADD*ZEROS    CAIC
     C                     Z-ADDLDID      PDID
     C                     Z-ADDLCID      PCID
     C*                    UPDATREHISLPF
     C                     Z-ADD29        DBASE
     C                     UPDATREHISSF
     C*
     C                     END                             - E1
     C*
     C                     Z-ADD30        DBASE
     C           LNKKEY    SETLLREHISLS
     C                     Z-ADD31        DBASE
     C           LNKKEY    READEREHISLS                  56
     C*
     C           *IN56     DOWEQ'0'                        - B1
     C                     ADD  DAIC      DRIS
     C                     ADD  CAIC      CRIS
     C                     Z-ADD*ZEROS    DAIC
     C                     Z-ADD*ZEROS    CAIC
     C                     Z-ADD32        DBASE
     C                     UPDATREHISSF
     C                     Z-ADD33        DBASE
     C           LNKKEY    READEREHISLS                  56
     C                     END                             - E1
     C*
     C                     ENDSR                           **HISLSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** LNKSR subroutine for RELINKL file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
     C           LNKSR     BEGSR                           **LNKSR BEGSR**
     C*
     C                     MOVE CCY       REHCCY
     C                     MOVE 'LINKU'   DBFILE           **DB ERROR 10**
     C                     MOVELDKEY      DBKEY            ***************
     C                     MOVELSTSLNK    DBSTAT
     C                     MOVE '1'       *IN88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **LNKSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** MAIN subroutine to execute main processing.
     C**
     C**     Called by       S T A R T
     C**     Calls           *PSSR, POSSR, EODPSR, HISLSR, ACCNSR,
     C**                     REACSR
     C**
     C           MAIN      BEGSR                           **MAIN BEGSR**
     C*
     C** SAVE THE INITIAL KEY
     C*
     C                     MOVE BRCA      WBRCA
     C                     Z-ADDACOD      WACOD
     C                     Z-ADDACSQ      WACSQ
     C**********           Z-ADDCNUM      WCNUM                                               CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     MOVE CNUM      ZZCNUM
     C                     MOVE LTAB      WLTAB
     C                     Z-ADDLTAC      WLTAC
     C                     Z-ADDLTAS      WLTAS
     C                     MOVE LTCUST    WLTCUS
     C/COPY WNCPYSRC,RE3262C005
     C*
     C** SETLL REDETM TO FIND POSTINGS IF EXISTS
     C*
     C                     Z-ADD34        DBASE
     C           REPKEY    SETLLREDETP
     C*
     C** PROCESS IF THERE IS AT LEAST ONE POSTING
     C*
     C                     Z-ADD35        DBASE
     C           REYKEY    READEREDETP                   51
     C*
     C           *IN51     IFEQ '0'                        - B1
     C*
     C** CHECK IF IT IS A GOOD POSTING
     C*
     C           HISD      IFLT VALU                       - B2
     C                     Z-ADDHISD      WDATE
     C                     MOVE CCY       REHCCY
     C                     Z-ADD36        DBASE            ***************
     C                     MOVE 'HISD '   DBFILE           **DB ERROR 36**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E2
     C                     Z-ADDVALU      BVDTC
     C                     MOVE 'Y'       BADTY
     C                     Z-ADDHISD      PHISD
     C                     Z-ADD*ZERO     WDMVT
     C                     Z-ADD*ZERO     WCMVT
     C*
     C                     Z-ADD*ZEROS    TOTCOM
     C                     Z-ADD*ZEROS    WCOM
     C*
     C           *IN51     DOWEQ'0'                        - B2
     C*
     C                     EXSR POSSR
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C** SETLL REDETY TO FIND POSTINGS IF EXISTS
     C*
     C                     Z-ADD37        DBASE
     C           REYKEY    SETLLREDETY                   52
     C*
     C           *IN52     IFEQ '1'                        - B1
     C*
     C** PROCESS IF THERE IS AT LEAST ONE POSTING
     C*
     C                     Z-ADD38        DBASE
     C           REYKEY    READEREDETY                   52
     C*
     C           *IN52     DOWEQ'0'                        - B2
     C*
     C                     EXSR EODPSR
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     EXSR HISLSR
     C*
     C                     EXSR ACCNSR
     C*
     C                     EXSR REACSR
     C*
     C                     EXSR EODUPD
     C*
     C                     EXSR RECOMD
      *                                                                   178785
      ** Remove the initial key to the Secondary account                  178785
      *                                                                   178785
     C                     MOVE WBRCA     BRCA                            178785
     C                     Z-ADDWACOD     ACOD                            178785
     C                     Z-ADDWACSQ     ACSQ                            178785
     C**********           Z-ADDWCNUM     CNUM                                         178785 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C*
     C**  Remove Linked Account record from FUSIONPD                      169797
     C*                                                                   169797
     C           ACCKY     CHAINRELINKL1             50                   169797
     C*                                                                   169797
     C           *IN50     IFEQ '0'                        - B1           169797
     C                     DELETFUSIONF1                                  169797
     C**********           ELSE                                                        169797 219375
     C**********           MOVE BRCA      SBRCA                                        169797 219375
     C**********           Z-ADDACOD      SACOD                                        169797 219375
     C**********           MOVE CCY       SCCY                                         169797 219375
     C**********           Z-ADDACSQ      SACSQ                                        169797 219375
     C**********           Z-ADDCNUM      SCNUM                                        169797 CSD027
     C**********           MOVE CNUM      SCNUM                                        CSD027 219375
     C**********           MOVELSKEY      DBKEY            ***************             169797 219375
     C**********           Z-ADD61        DBASE            * DB ERROR 61 *             169797 219375
     C**********           MOVE 'FUSIONPD'DBFILE           ***************             169797 219375
     C**********           EXSR *PSSR                                                  169797 219375
     C                     END                                            169797
     C*                                                                   169797
     C                     EXSR SRCHRG                                                        230844
      *                                                                                       230844
     C                     ADD  1         NORE3
     C*
     C                     ENDSR                           **MAIN ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** POSSR subroutine to delete in REHPOSPP
     C**
     C**     Called by       MAIN
     C**     Calls           *PSSR
     C**
     C           POSSR     BEGSR                           **POSSR BEGSR**
     C*
     C** ACCESS THE LOGICAL FILE
     C*
     C           PHISD     IFNE HISD
     C*
     C                     Z-ADDHISD      WHISD
     C                     MOVE WLTAB     BRCA
     C                     Z-ADDWLTAC     ACOD
     C                     Z-ADDWLTAS     ACSQ
     C**********           Z-ADDWLTCUS    CNUM                                                CSD027
     C                     MOVE WLTCUS    CNUM                                                CSD027
     C/COPY WNCPYSRC,RE3262C021
     C*
     C                     Z-ADDPHISD     KDATE
     C                     Z-ADD39        DBASE
     C           DCKEY     CHAINREHISDL              53
     C*
     C           *IN53     IFEQ '1'                        - B1
     C                     Z-ADDKDATE     WDATE
     C                     MOVE CCY       REHCCY
     C                     Z-ADD40        DBASE            ***************
     C                     MOVE 'HISDL'   DBFILE           **DB ERROR 40**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E2
     C                     SUB  WDMVT     DMVT
     C                     SUB  WCMVT     CMVT
     C           RECI      IFEQ 'B'
     C           DMVT      SUB  CMVT      HISB
     C                     END
     C                     Z-ADD41        DBASE
     C                     UPDATREHISPPF
     C                     Z-ADD*ZERO     WDMVT
     C                     Z-ADD*ZERO     WCMVT
     C                     Z-ADDWHISD     PHISD
     C                     END
      *                                                                   081162
      * Ignore original linking GE-FU record                              081162
     C           SPOS      IFNE '  GE-FU'                                 081162
      *                                                                   081162
     C           DRCR      IFEQ 0
     C                     ADD  PSTA      WDMVT
     C*
     C           TURN      IFEQ 'Y'
     C                     ADD  PSTA      TOTCOM
     C                     END
     C*
     C                     ELSE
     C                     ADD  PSTA      WCMVT
     C                     END
     C/COPY WNCPYSRC,RE3262C006
     C*
     C** DELETE DUPLICATED RECORD
     C*
     C                     Z-ADD42        DBASE
     C                     DELETREDETPF
     C*
     C***********          ADD  1         NORE1                           081162
     C                     ADD  1         NORE2                           081162
     C                     END                                            081162
     C*
     C** RESTORE THE INITIAL KEY
     C*
     C                     MOVE WBRCA     BRCA
     C                     Z-ADDWACOD     ACOD
     C                     Z-ADDWACSQ     ACSQ
     C**********           Z-ADDWCNUM     CNUM                                                CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C/COPY WNCPYSRC,RE3262C022
     C*
     C                     Z-ADD43        DBASE
     C           REYKEY    READEREDETP                   51
     C           *IN51     IFEQ '1'                        - B1
     C*
     C                     MOVE WLTAB     BRCA
     C                     Z-ADDWLTAC     ACOD
     C                     Z-ADDWLTAS     ACSQ
     C**********           Z-ADDWLTCUS    CNUM                                                CSD027
     C                     MOVE WLTCUS    CNUM                                                CSD027
     C/COPY WNCPYSRC,RE3262C023
     C                     Z-ADDPHISD     KDATE
     C*
     C                     Z-ADD44        DBASE
     C           DCKEY     CHAINREHISDL              53
     C*
     C           *IN53     IFEQ '1'                        - B1
     C                     Z-ADDHISD      WDATE
     C                     MOVE CCY       REHCCY
     C                     Z-ADD45        DBASE            ***************
     C                     MOVE 'HISDL'   DBFILE           **DB ERROR 45**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E2
     C                     SUB  WDMVT     DMVT
     C                     SUB  WCMVT     CMVT
     C           RECI      IFEQ 'B'
     C           DMVT      SUB  CMVT      HISB
     C                     END
     C                     Z-ADD46        DBASE
     C                     UPDATREHISPPF
     C                     END
     C*
     C                     ENDSR                           **POSSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** REACSR subroutine to update the REACR record
     C**
     C**     Called by       MAIN
     C**     Calls           *PSSR
     C**
     C           REACSR    BEGSR                           **REACSR BEGSR**
     C*
     C                     Z-ADD47        DBASE
     C           ACCKEY    CHAINREACR                58
     C*
     C           *IN58     IFEQ '1'                        - B1
     C                     MOVE CCY       REHCCY
     C                     Z-ADD48        DBASE            ***************
     C                     MOVE 'REACR'   DBFILE           **DB ERROR 48**
     C                     MOVELAKEY      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C                     Z-ADDVALU      RHISD
     C                     Z-ADD*ZEROS    MNBL
     C                     Z-ADD*ZEROS    RHISB
     C*
     C** UPDATE REACR
     C*
     C                     Z-ADD49        DBASE
     C                     UPDATREACRDF
     C*
     C                     ENDSR                           **REACSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** RECOMD subroutine to update the RECOM record
     C**
     C**     Called by       MAIN
     C**     Calls           *PSSR
     C**
     C           RECOMD    BEGSR                           **RECOMD BEGSR**
     C*
     C                     MOVELWBRCA     BRCA
     C**********           Z-ADDWCNUM     CNUM                                                CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     Z-ADDWACOD     ACOD
     C                     Z-ADDWACSQ     ACSQ
     C/COPY WNCPYSRC,RE3262C024
     C*
     C***********          Z-ADD50        DBASE                           CRE001
     C                     Z-ADD10        DBASE                           CRE001
     C           ACCKY     CHAINRECOM                20
     C           *IN20     IFEQ '1'                        - B1
     C                     MOVE CCY       REHCCY
     C                     Z-ADD51        DBASE            ***************
     C                     MOVE 'RECOM'   DBFILE           **DB ERROR 51**
     C                     MOVELAKEY      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C** RESET TO *ZEROS OR *BLANKS ALL FIELDS FROM THE COMMISSIONS
     C** OF THE SECONDARY ACCOUNT
     C*
     C                     Z-ADD*ZEROS    FXDC
     C                     Z-ADD*ZEROS    ACCC
     C                     Z-ADD*ZEROS    GVDPC
     C                     Z-ADD*ZEROS    ACCRA
     C                     MOVE *BLANKS   MMACC
     C                     Z-ADD*ZEROS    CACCC
     C                     Z-ADD*ZEROS    CDIE
     C                     Z-ADD*ZEROS    CDICA
     C                     Z-ADD*ZEROS    CDRR
     C                     MOVE *BLANKS   MMCDI
     C                     Z-ADD*ZEROS    CCDIC
     C                     Z-ADD*ZEROS    IACE
     C                     Z-ADD*ZEROS    IACCC
     C                     Z-ADD*ZEROS    CIACC
     C                     Z-ADD*ZEROS    CMBE
     C                     Z-ADD*ZEROS    CMBC
     C                     Z-ADD*ZEROS    ACCB
     C                     Z-ADD*ZEROS    CCMBC
     C                     Z-ADD*ZEROS    CHDBE
     C                     Z-ADD*ZEROS    CHDBC
     C                     Z-ADD*ZEROS    HDRB
     C                     Z-ADD*ZEROS    CHDBR
     C                     MOVE *BLANKS   MMCHDB
     C                     Z-ADD*ZEROS    CCHDBC
     C                     MOVE *BLANKS   CACDC
     C                     Z-ADD*ZEROS    CCINST
     C                     Z-ADD*ZEROS    TEGRT
     C                     Z-ADD*ZEROS    VATAM
     C*
     C** CHECK IF CUSTOMER IS EXEMPT FROM COMMISSION
     C*
     C                     MOVELWCEXB     CEXBX   1
     C           CEXBX     IFNE 'E'                        - B1
     C*
     C** ACCESS SDCUSTPD TO GET CUSTOMER GROUP
     C*
     C                     MOVE CNUM      WWCNUM  6
     C*
     C                     MOVELWWCNUM    CLKEY  10
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           CLKEY
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCUSTPD'DBFILE           ***************
     C                     MOVEL@OPTN     DBKEY            * DBERROR 054 *
     C                     Z-ADD054       DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** CHECK IF CUSTOMER IS SUBJECT TO THE COMMISSION
     C*
     C                     Z-ADD1         W
     C           BBCGRP    LOKUPCGRP,W                   60
     C           *IN60     IFEQ '0'                        - B2
     C                     Z-ADD55        DBASE            ***************
     C                     MOVE 'TABLEV4' DBFILE           **DB ERROR 55**
     C                     MOVELBBCGRP    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C** CHECK IF CUSTOMER GROUP IS Y OR N
     C*
     C           AGRP,W    IFEQ 'Y'                        - B2
     C*
     C                     Z-ADD1         X
     C           CCY       LOKUPCURR,X                   64
     C           *IN64     IFEQ '0'                        - B3
     C                     Z-ADD56        DBASE            ***************
     C                     MOVE 'RECCY'   DBFILE           **DB ERROR 56**
     C                     MOVELCCY       DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** ACCOUNT IS OVERRIDE
     C*
     C           WCEXB     IFNE *BLANKS                    - B3
     C                     MOVE WCEXB     RATE   108
     C                     ELSE                            - X3
     C                     Z-ADDARET,X    RATE
     C                     END                             - E3
     C*
     C** ACCOUNT COMMISSION IS CALCULATED
     C*
     C                     Z-ADDTOTCOM    GVDPE
     C/COPY WNCPYSRC,RE3262C025
     C           GVDPE     MULT RATE      WCOM   150
     C           WCOM      DIV  100       WCOM
     C*
     C** BELOW MINIMUM COMMISSION
     C*
     C           WCOM      IFLE AMIN,X                      - B3
     C                     MOVE AMIN,X    ACCEA
     C*
     C** ABOVE MAXIMUM COMMISSION
     C*
     C                     ELSE                             - X3
     C           WCOM      IFGE AMAX,X                      - B4
     C                     MOVE AMAX,X    ACCEA
     C*
     C** NOT BELOW MINIMUM AND NOT ABOVE MAXIMUM COMMISSION
     C*
     C                     ELSE                             - X4
     C*
     C                     MOVE WCOM      ACCEA
     C*
     C                     END                              - E4
     C                     END                              - E3
     C*
     C                     ELSE                             - X2
     C*
     C                     Z-ADD*ZEROS    GVDPE
     C                     Z-ADD*ZEROS    ACCEA
     C*
     C                     END                              - E2
     C*
     C                     ELSE                             - X1
     C*
     C                     Z-ADD*ZEROS    GVDPE
     C                     Z-ADD*ZEROS    ACCEA
     C*
     C                     END                              - E1
     C*
     C*
     C** UPDATE RECOM
     C*
     C***********          Z-ADD52        DBASE                           CRE001
     C                     Z-ADD11        DBASE                           CRE001
     C                     UPDATRECOMDF
     C*
     C** UPDATE MOVEMENT COMMISSION OF THE PRIME
     C** CHECK IF CUSTOMER IS EXEMPT FROM COMMISSION
     C*
     C                     MOVELCEXB      CEXBX   1
     C           CEXBX     IFNE 'E'                        - B1
     C*
     C** ACCESS CLINT TO GET CUSTOMER GROUP
     C*
     C                     MOVE WLTCUS    CNUM
     C*
     C                     MOVE CNUM      WWCNUM
     C*
     C                     MOVELWWCNUM    CLKEY  10
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           CLKEY
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCUSTPD'DBFILE           ***************
     C                     MOVEL@OPTN     DBKEY            * DBERROR 057 *
     C                     Z-ADD057       DBASE            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** CHECK IF CUSTOMER IS SUBJECT TO THE COMMISSION
     C*
     C                     Z-ADD1         W
     C           BBCGRP    LOKUPCGRP,W                   60
     C           *IN60     IFEQ '0'                        - B2
     C                     Z-ADD58        DBASE            ***************
     C                     MOVE 'TABLEV4' DBFILE           **DB ERROR 58**
     C                     MOVELBBCGRP    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C** CHECK IF CUSTOMER GROUP IS Y OR N
     C*
     C           AGRP,W    IFEQ 'Y'                        - B2
     C*
     C                     Z-ADD1         X
     C           CCY       LOKUPCURR,X                   64
     C           *IN64     IFEQ '0'                        - B3
     C                     Z-ADD59        DBASE            ***************
     C                     MOVE 'RECCY'   DBFILE           **DB ERROR 59**
     C                     MOVELCCY       DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** ACCOUNT IS OVERRIDE
     C*
     C           CEXB      IFNE *BLANKS                    - B3
     C                     MOVE CEXB      RATE
     C                     ELSE                            - X3
     C                     Z-ADDARET,X    RATE
     C                     END                             - E3
     C*
     C** ACCESS RECOM OF THE PRIME
     C*
     C                     MOVE WLTCUS    CNUM
     C                     MOVE WLTAC     ACOD
     C                     MOVE WLTAS     ACSQ
     C/COPY WNCPYSRC,RE3262C026
     C*
     C                     Z-ADD50        DBASE
     C           ACCKY     CHAINRECOM                20
     C           *IN20     IFEQ '1'                        - B3
     C                     MOVE CCY       REHCCY
     C                     Z-ADD60        DBASE            ***************
     C                     MOVE 'RECOM'   DBFILE           **DB ERROR 60**
     C                     MOVELAKEY      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** ACCOUNT COMMISSION IS CALCULATED
     C*
     C                     SUB  TOTCOM    GVDPE
     C           TOTCOM    MULT RATE      TOTCOM 150
     C           TOTCOM    DIV  100       TOTCOM
     C                     SUB  TOTCOM    ACCEA
     C*
     C           ACCEA     IFLT *ZEROS                     - B3
     C                     Z-ADD*ZEROS    ACCEA
     C                     END                             - E3
     C*
     C           GVDPE     IFLT *ZEROS                     - B3
     C                     Z-ADD*ZEROS    GVDPE
     C                     END                             - E3
     C*
     C** UPDATE RECOM
     C*
     C                     Z-ADD52        DBASE
     C                     UPDATRECOMDF
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **RECOMD ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** REASR subroutine for REACR file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
     C           REASR     BEGSR                           **REASR BEGSR**
     C*
     C                     MOVE CCY       REHCCY           ***************
     C                     MOVE 'REACR'   DBFILE           **DB ERROR 16**
     C                     MOVELAKEY      DBKEY            ***************
     C                     MOVELSTSREA    DBSTAT
     C                     MOVE '1'       *IN88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **REASR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** HIBSR subroutine for REHISBL file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
     C           HIBSR     BEGSR                           **HIBSR BEGSR**
     C*
     C                     MOVE CCY       REHCCY           ***************
     C                     MOVE 'HISBL'   DBFILE           **DB ERROR 17**
     C                     MOVELAKEY      DBKEY            ***************
     C                     MOVELSTSHIB    DBSTAT
     C                     MOVE '1'       *IN88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **HIBSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** HIASR subroutine for REHISLS file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
     C           HIASR     BEGSR                           **HIASR BEGSR**
     C*
     C                     MOVE CCY       REHCCY
     C                     Z-ADDHISD      WDATE            ***************
     C                     MOVE 'HISLS'   DBFILE           **DB ERROR 19**
     C                     MOVELREHKEY    DBKEY            ***************
     C                     MOVELSTSHIA    DBSTAT
     C                     MOVE '1'       *IN88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **HIASR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** HIPSR subroutine for REHISDL file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
     C           HIPSR     BEGSR                           **HIPSR BEGSR**
     C*
     C                     MOVE CCY       REHCCY           ***************
     C                     MOVE 'HISDL'   DBFILE           **DB ERROR 18**
     C                     MOVELAKEY      DBKEY            ***************
     C                     MOVELSTSHIP    DBSTAT
     C                     MOVE '1'       *IN88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **HIPSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** TOTAL subroutine to execute end processing.
     C**
     C**     Called by       S T A R T
     C**     Calls           -
     C**
     C           TOTAL     BEGSR                           **TOTAL BEGSR**
     C*
     C** OUTPUT AUDIT TRAILER - NUMBER OF RECORD WRITTEN IN REEODPF
     C*
     C                     WRITETOTALS
     C/COPY WNCPYSRC,RE3262C007
     C*
     C                     ENDSR                           **TOTAL ENDSR**
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C**
     C** INTCAL subroutine for interest calculation between two dates
     C**
     C**
     C**     Called by       External program
     C*******Calls***********CRINIT,DATEIN,DRINIT,ZIC00,ZIC01,ZIC02**     CRE001
     C**     Calls           CRINIT,DATEIN,DRINIT,ZIC00,ZIC01,ZIC02,ZICOD CRE001
     C**
     C           INTCAL    BEGSR                           **INTCAL BEGSR**
     C*
     C** LOADING OF CURRENCY TO CHAIN TO REHRDJ/REHRCJ FILES
     C*
     C                     MOVE CCY       REHCCY
     C*
     C** DEBIT PROCESSING
     C*
     C                     Z-ADD*ZEROS    INRT
     C                     Z-ADD*ZEROS    INTP
     C                     Z-ADD*ZEROS    ZINTR
     C                     Z-ADD*ZEROS    ZLDTM
      *                                                                                       CER016
      *                                                                                       CER016
     C           WFIRST    IFEQ 'Y'                                                           CER016
     C                     EXSR SRAOS                                                         CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
     C*
     C           HISB      IFGT *ZEROS                     - B1
     C           MNBL      ORGT *ZEROS
     C                     EXSR DRINIT
     C                     END                             - E1
     C*
     C                     Z-ADDINRT      ZIRATE
     C                     Z-ADDINTP      ZICT
     C                     Z-ADDDRIC      ZICALC
     C                     Z-ADDHISD      ZIBEG
     C                     Z-ADDVALU      ZIEND
     C/COPY WNCPYSRC,RE3262C027
     C*
     C           INTP      IFLT 3                          - B1
     C           HISB      IFGT 0                          - B2
     C                     Z-ADDRHISB     ZIAMT
     C***********ZICT      CASEQ0         ZIC00                           CRE001
     C   65      ZICT      CASEQ0         ZICOD                           CRE001
     C  N65      ZICT      CASEQ0         ZIC00                           CRE001
     C           ZICT      CASEQ1         ZIC01
     C           ZICT      CASEQ2         ZIC02
     C                     END
     C                     Z-ADDZINTR     DINT
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C** SEARCHING END-OF-MONTH DATE
     C*
     C                     EXSR DATEIN
     C*
     C           RUND      IFLE ZLDTM                      - B2
     C           MNBL      IFGT 0                          - B3
     C                     Z-ADDMNBL      ZIAMT
     C           INTP      IFEQ 3                          - B4
     C                     Z-ADD1         ZICT
     C                     ELSE                            - X4
     C                     Z-ADD2         ZICT
     C                     END                             - E4
     C           ZICT      CASEQ1         ZIC01
     C           ZICT      CASEQ2         ZIC02
     C                     END
     C                     Z-ADDZINTR     DINT
     C                     END                             - E3
     C*
     C                     ELSE                            - X2
     C*
     C** IF CHANGE OF MONTH OCCURS WITH METHODS 3 & 4 THEN TWO PROCESSINGS
     C** FIRST PROCESSING :
     C*
     C           MNBL      IFGT 0                          - B3
     C                     Z-ADDMNBL      ZIAMT
     C                     Z-ADDZLDTM     ZIEND
     C           INTP      IFEQ 3                          - B4
     C                     Z-ADD1         ZICT
     C                     ELSE                            - X4
     C                     Z-ADD2         ZICT
     C                     END                             - E4
     C           ZICT      CASEQ1         ZIC01
     C           ZICT      CASEQ2         ZIC02
     C                     END
     C                     Z-ADDZINTR     DINT
     C                     END                             - E3
     C*
     C** SECOND PROCESSING :
     C*
     C           HISB      IFGT 0                          - B3
     C                     Z-ADDHISB      ZIAMT
     C                     Z-ADDZLDTM     ZIBEG
     C                     Z-ADDRUND      ZIEND
     C           INTP      IFEQ 3                          - B4
     C                     Z-ADD1         ZICT
     C                     ELSE                            - X4
     C                     Z-ADD2         ZICT
     C                     END                             - E4
     C           ZICT      CASEQ1         ZIC01
     C           ZICT      CASEQ2         ZIC02
     C                     END
     C                     ADD  ZINTR     DINT
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3262C028
     C*
     C** CREDIT PROCESSING
     C*
     C                     Z-ADD*ZEROS    INRT
     C                     Z-ADD*ZEROS    INTP
     C                     Z-ADD*ZEROS    ZINTR
     C                     Z-ADD*ZEROS    ZLDTM
     C*
     C           HISB      IFLT *ZEROS                     - B1
     C           MNBL      ORLT *ZEROS
     C                     EXSR CRINIT
     C                     END                             - E1
     C*
     C                     Z-ADDINRT      ZIRATE
     C                     Z-ADDINTP      ZICT
     C                     Z-ADDCRIC      ZICALC
     C                     Z-ADDHISD      ZIBEG
     C                     Z-ADDVALU      ZIEND
     C*
     C           INTP      IFLT 3                          - B1
     C           HISB      IFLT 0                          - B2
     C                     Z-ADDHISB      ZIAMT
     C           ZICT      CASEQ0         ZIC00
     C           ZICT      CASEQ1         ZIC01
     C           ZICT      CASEQ2         ZIC02
     C                     END
     C                     Z-ADDZINTR     CINT
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP7                                           S01408
      *                                                                   S01408
     C*
     C** SEARCHING END-OF-MONTH DATE
     C*
     C                     EXSR DATEIN
     C*
     C           RUND      IFLE ZLDTM                      - B2
     C           MNBL      IFGT 0                          - B3
     C                     Z-ADDMNBL      ZIAMT
     C           INTP      IFEQ 3                          - B4
     C                     Z-ADD1         ZICT
     C                     ELSE                            - X4
     C                     Z-ADD2         ZICT
     C                     END                             - E4
     C           ZICT      CASEQ1         ZIC01
     C           ZICT      CASEQ2         ZIC02
     C                     END
     C                     Z-ADDZINTR     CINT
     C                     END                             - E3
     C*
     C                     ELSE                            - X2
     C*
     C** IF CHANGE OF MONTH OCCURS WITH METHODS 3 & 4 THEN TWO PROCESSINGS
     C** FIRST PROCESSING :
     C*
     C           MNBL      IFGT 0                          - B3
     C                     Z-ADDMNBL      ZIAMT
     C                     Z-ADDZLDTM     ZIEND
     C           INTP      IFEQ 3                          - B4
     C                     Z-ADD1         ZICT
     C                     ELSE                            - X4
     C                     Z-ADD2         ZICT
     C                     END                             - E4
     C           ZICT      CASEQ1         ZIC01
     C           ZICT      CASEQ2         ZIC02
     C                     END
     C                     Z-ADDZINTR     CINT
     C                     END                             - E3
     C*
     C** SECOND PROCESSING :
     C*
     C           HISB      IFGT 0                          - B3
     C                     Z-ADDHISB      ZIAMT
     C                     Z-ADDZLDTM     ZIBEG
     C                     Z-ADDRUND      ZIEND
     C           INTP      IFEQ 3                          - B4
     C                     Z-ADD1         ZICT
     C                     ELSE                            - X4
     C                     Z-ADD2         ZICT
     C                     END                             - E4
     C           ZICT      CASEQ1         ZIC01
     C           ZICT      CASEQ2         ZIC02
     C                     END
     C                     ADD  ZINTR     CINT
     C                     END                             - E3
     C*
     C                     END                             - E2
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP8                                           S01408
      *                                                                   S01408
     C*
     C                     END                             - E1
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CCP9                                           S01408
      *                                                                   S01408
     C*
     C                     ENDSR                           **INTCAL ENDSR**
     C*
     C********************************************************************
     C/EJECT
      *****************************************************************                       220323
      *                                                               *                       220323
      *  DBSR - Subroutine to call *PSSR                              *                       220323
      *                                                               *                       220323
      *  Called by: ZICD                                              *                       220323
      *  Calls:     *PSSR                                             *                       220323
      *                                                               *                       220323
      *****************************************************************                       220323
      *                                                                                       220323
     C           DBSR      BEGSR                                                              220323
      *                                                                                       220323
     C                     MOVE '1'       *IN89                                               220323
     C                     EXSR *PSSR                                                         220323
      *                                                                                       220323
     C                     ENDSR                                                              220323
     C*****************************************************************                       220323
     C/EJECT                                                                                  220323
     C/COPY ZSRSRC,ZICDREZ2                                                                   220323
     C*****************************************************************                       220323
     C**********                                                                              220323
     C***ZICD*subroutine*to*find*number*of*days*to*calculate*interest**                       220323
     C********according*to*calculation*basis***************************                       220323
     C**********                                                                              220323
     C*******Called*by*******ZIC00,ZIC01,ZIC02*************************                       220323
     C*******Calls************PSSR*************************************                       220323
     C**********                                                                              220323
     C********** ZICD      BEGSR                           **ZICD BEGSR**                     220323
     C**********                                                                              220323
     C**TO*DETERMINE*NUMBER*OF*DAYS*INTEREST*TO*BE*CALCULATED**********                       220323
     C**********                                                                              220323
     C********** ZIEND     SUB  ZIBEG     ZDAYN2                                              220323
     C**********                                                                              220323
     C**CHECK*FOR*INTEREST*CALCULATION*BASIS***************************                       220323
     C**********                                                                              220323
     C********** ZICALC    IFEQ 3                          - B1                               220323
     C********** ZIEND     IFGT ZIBEG                      - B2                               220323
     C**********                                                                              220323
     C***CALCULATING*DATE*FROM*DAY*NUMBER*(BEGINNING*DATE)*************                       220323
     C**********                                                                              220323
     C**********           Z-ADDZIBEG     ZDAYNO                                              220323
     C**********           EXSR ZDATE2                                                        220323
     C**********                                                                              220323
     C***VERIFY*IF*ERROR***********************************************                       220323
     C**********                                                                              220323
     C********** *IN99     IFNE '0'                        - B3                               220323
     C**********           Z-ADD90        DBASE            ***************                    220323
     C**********           MOVE 'ZDATE2'  DBFILE           **DB ERROR 90**                    220323
     C**********           MOVE ZERROR    ERRDAT           ***************                    220323
     C**********           MOVE *BLANKS   DBKEY                                               220323
     C**********           MOVELERRDAT    DBKEY                                               220323
     C**********           EXSR *PSSR                                                         220323
     C**********           END                             - E3                        088029 220323
     C**********                                                                              220323
     C********** *IN98     IFEQ '0'                        - B3                        088029 220323
     C**********           Z-ADDZDATE     SRES                                         088029 220323
     C**********           ELSE                            - X3                        088029 220323
     C**********           Z-ADDZDATE     SRESX                                        088029 220323
     C**********           Z-ADDZISDX     ZISD                                                220323
     C**********           Z-ADDZISMX     ZISM                                                220323
     C**********           Z-ADDZISYX     ZISY                                         088029 220323
     C**********           END                             - E3                        088029 220323
     C**********                                                                              220323
     C***CALCULATING*DATE*FROM*DAY*NUMBER*(FINISHING*DATE)*************                       220323
     C**********                                                                              220323
     C**********           Z-ADDZIEND     ZDAYNO                                              220323
     C**********           EXSR ZDATE2                                                        220323
     C**********                                                                              220323
     C***VERIFY*IF*ERROR***********************************************                       220323
     C**********                                                                              220323
     C********** *IN99     IFNE '0'                        - B3                               220323
     C**********           Z-ADD91        DBASE            ***************                    220323
     C**********           MOVE 'ZDATE2'  DBFILE           **DB ERROR 91**                    220323
     C**********           MOVE ZERROR    ERRDAT           ***************                    220323
     C**********           MOVE *BLANKS   DBKEY                                               220323
     C**********           MOVELERRDAT    DBKEY                                               220323
     C**********           EXSR *PSSR                                                         220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C********** *IN98     IFEQ '0'                        - B3                        088029 220323
     C**********           Z-ADDZDATE     FRES                                                220323
     C**********           ELSE                            - X3                        088029 220323
     C**********           Z-ADDZDATE     FRESX                                        088029 220323
     C**********           Z-ADDZIFDX     ZIFD                                         088029 220323
     C**********           Z-ADDZIFMX     ZIFM                                         088029 220323
     C**********           Z-ADDZIFYX     ZIFY                                         088029 220323
     C**********           END                             - E3                        088029 220323
     C**********                                                                              220323
     C**********                                                                              220323
     C***IN*ORDER*FOR*THE*FINISH*YEAR*TO*BE*LESS*THAN*THE*START*YEAR*IF*ZIEND                 220323
     C***IS*GREATER*THAN*ZIBEG,*THEN*THE*DATE*ZIEND*MUST*BE*IN*A*DIFFERENT                    220323
     C***CENTURY*TO*ZIBEG.*IF*SO*ADD*100*YEARS*TO*IT.******************                       220323
     C**********                                                                              220323
     C**********                                                                              220323
     C********** ZIFY      IFLT ZISY                       - B3                               220323
     C********** ZIFY      ADD  100       ZIFY2   30                                          220323
     C**********           ELSE                            - X3                               220323
     C**********           Z-ADDZIFY      ZIFY2                                               220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C**********           Z-ADDZISY      ZISY2   30                                          220323
     C*COPY*WNCPYSRC,RE3262C034                                                               220323
     C**********                                                                              220323
     C***DETERMINE*WHETHER*START*YEAR*IS*A*LEAP*YEAR*AND*IF*START*MONTH                       220323
     C***IS*FEBRUARY**THEN*CONSIDER*LAST*DAY*OF*FEBRUARY*AS*DATE*30ND.*OF*THE                 220323
     C***MONTH*********************************************************                       220323
     C**********                                                                              220323
     C********** ZISM      IFEQ 2                          - B3                               220323
     C********** ZISY2     ADD  1900      ZLYCHK                                              220323
     C********** ZLYCHK    DIV  4         ZLYCHK                                              220323
     C**********           MVR            ZLYREM                                              220323
     C********** ZLYREM    IFEQ 0                          - B4                               220323
     C********** ZISD      IFEQ 29                         - B5                               220323
     C**********           Z-ADD30        ZISD                                                220323
     C**********           END                             - E5                               220323
     C**********           ELSE                            - X4                               220323
     C********** ZISD      IFEQ 28                         - B5                               220323
     C**********           Z-ADD30        ZISD                                                220323
     C**********           END                             - E5                               220323
     C**********           END                             - E4                               220323
     C**********           END                             - E3                               220323
     C*COPY*WNCPYSRC,RE3262C035                                                               220323
     C**********                                                                              220323
     C********** 30        SUB  ZISD      ZID1                                                220323
     C**********                                                                              220323
     C********** ZID1      IFLT 0                          - B3                               220323
     C**********           Z-ADD*ZEROS    ZID1                                                220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C********** ZISM      IFEQ 12                         - B3                               220323
     C**********           Z-ADD*ZEROS    ZISM                                                220323
     C**********           ADD  1         ZISY                                                220323
     C**********           ADD  1         ZISY2                                               220323
     C**********           END                             - E3                               220323
     C*COPY*WNCPYSRC,RE3262C036                                                               220323
     C**********                                                                              220323
     C***DETERMINE*WHETHER*END*YEAR*IS*A*LEAP*YEAR*AND*IF*END*MONTH*IS*FEBRUARY               220323
     C**********                                                                              220323
     C********** ZIFM      IFEQ 2                          - B3                               220323
     C********** ZIFY2     ADD  1900      ZLYCHK                                              220323
     C********** ZLYCHK    DIV  4         ZLYCHK                                              220323
     C**********           MVR            ZLYREM                                              220323
     C********** ZLYREM    IFEQ 0                          - B4                               220323
     C********** ZIFD      IFEQ 29                         - B5                               220323
     C**********           Z-ADD30        ZIFD                                                220323
     C**********           END                             - E5                               220323
     C**********           ELSE                            - X4                               220323
     C********** ZIFD      IFEQ 28                         - B5                               220323
     C**********           Z-ADD30        ZIFD                                                220323
     C**********           END                             - E5                               220323
     C**********           END                             - E4                               220323
     C**********           END                             - E3                               220323
     C*COPY*WNCPYSRC,RE3262C037                                                               220323
     C**********                                                                              220323
     C********** ZIFD      IFEQ 31                         - B3                               220323
     C**********           ADD  30        ZID1                                                220323
     C**********           ELSE                            - X3                               220323
     C**********           ADD  ZIFD      ZID1                                                220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C**********           SUB  1         ZIFM                                                220323
     C**********                                                                              220323
     C********** ZISY      IFEQ ZIFY                       - B3                               220323
     C********** ZIFM      SUB  ZISM      ZINOM   30                                          220323
     C**********           ELSE                            - X3                               220323
     C********** 12        SUB  ZISM      ZIM1                                                220323
     C**********           Z-ADD1         ZISM                                                220323
     C**********                                                                              220323
     C***USE*ENLARGE*FIELDS*THAT*CAN*HANDLE*1999*ONWARDS***************                       220323
     C**********                                                                              220323
     C**********           ADD  1         ZISY2                                               220323
     C********** ZIFY2     SUB  ZISY2     ZIY1                                                220323
     C********** ZIY1      MULT 12        ZIM2    30                                          220323
     C********** ZIM2      ADD  ZIFM      ZIM2                                                220323
     C********** ZIM2      ADD  ZIM1      ZINOM                                               220323
     C**********                                                                              220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C********** ZINOM     MULT 30        ZID2                                                220323
     C********** ZID2      ADD  ZID1      ZDAYN2                                              220323
     C**********                                                                              220323
     C**********           END                             - E2                               220323
     C**********                                                                              220323
     C**********           END                             - E1                               220323
     C**********                                                                              220323
     C********** ZICALC    IFEQ 4                          - B1                               220323
     C********** ZICALC    OREQ 5                                                             220323
     C**********                                                                              220323
     C***ONE*DAY*IS*SUBTRACTED*FROM*ZDAYN2*FOR*EACH*OCCURANCE*OF*29*FEB*IN*THE                220323
     C***THE*INTEREST*CALCULATION*PERIOD*INCLUSIVE*OF*ZIBEG*AND*ZIEND**                       220323
     C**********                                                                              220323
     C***FIND*NO*OF*FOUR*YEAR*PERIODS*BETWEEN*DATES********************                       220323
     C**********                                                                              220323
     C********** ZDAYN2    DIV  1461      ZIMAN                                               220323
     C**********           MVR            ZIREM                                               220323
     C**********                                                                              220323
     C***FIND*NEXT*29*FEB*DAY*NO.*ON*OR*AFTER*ZIBEG.*******************                       220323
     C**********                                                                              220323
     C********** ZIBEG     SUB  60        ZIBW1                                               220323
     C********** ZIBW1     DIV  1461      ZIDW1                                               220323
     C**********           MVR            ZIDREM                                              220323
     C**********                                                                              220323
     C********** ZIDREM    IFEQ 0                          - B2                               220323
     C**********           Z-ADDZIBEG     ZIDW2                                               220323
     C**********           END                             - E2                               220323
     C**********                                                                              220323
     C***ROUND*UP*RESULT***********************************************                       220323
     C**********                                                                              220323
     C********** ZIDW1     ADD  1         ZIDW2                                               220323
     C**********                                                                              220323
     C***CALCULATE*NEXT*29*FEB.****************************************                       220323
     C**********                                                                              220323
     C********** ZIDW2     MULT 1461      ZIDW2                                               220323
     C********** ZIDW2     ADD  60        ZIDW2                                               220323
     C**********                                                                              220323
     C***IF*THIS*NEXT*29*FEB.*DAYNO*-*ZIBEG*IS*GREATER*OR*EQUAL*TO*ZIREM*THEN                 220323
     C***ADD*1*TO*ZIMAN.***********************************************                       220323
     C**********                                                                              220323
     C********** ZIDW2     SUB  ZIBEG     ZILPCP                                              220323
     C**********                                                                              220323
     C********** ZIREM     IFGE ZILPCP                     - B2                               220323
     C**********           ADD  1         ZIMAN                                               220323
     C**********           END                             - E2                               220323
     C**********                                                                              220323
     C***SUBTRACT*ZIMAN*FROM*ZDAYN2*TO*GIVE*VALUE*OF*ZDAYN2*REQUIRED*FOR*THIS                 220323
     C***INTEREST*CALCULATION******************************************                       220323
     C**********                                                                              220323
     C********** ZDAYN2    SUB  ZIMAN     ZDAYN2                                              220323
     C**********                                                                              220323
     C**********           END                             - E1                               220323
     C**********                                                                              220323
     C**********           ENDSR                           **ZICD ENDSR**                     220323
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZIC00 subroutine to calculate interest (type=00)
     C**
     C**     Called by       INTCAL
     C**     Calls           ZICD
     C**
     C           ZIC00     BEGSR                           **ZIC00 BEGSR**
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3262CPD1                                           S01408
     C*                                                                   S01408
     C*
     C** REVERSE SIGN OF AMOUNT IF IT'S NEGATIVE
     C*
     C           ZIAMT     IFLT 0                          - B1
     C                     Z-SUBZIAMT     ZIAMT
     C                     END                             - E1
     C*
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASIS
     C*
     C                     EXSR ZICD
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZIAMT     MULT ZIRATE    ZIWRK1                                              220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIWRK1    MULT INT6DY    ZIWRK2                                              220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIWRK1    MULT ZDAYN2    ZIWRK2                                              220323
     C                     ENDIF                                                              220323
     C*
     C           ZICALC    IFEQ 7                          - B1
     C           ZICALC    OREQ 5
     C           ZICALC    OREQ 3
     C           ZICALC    OREQ 2
     C           ZICALC    OREQ 0                                                             CER016
      *                                                                                       CER016
     C           ZICALC    IFEQ 0                                                             CER016
     C           PINTN     ANDEQ'Y'                                                           CER016
     C                     Z-ADDZIAMT     WAMT                                                CER016
     C                     Z-ADDZIRATE    WRATE                                               CER016
     C                     EXSR SRINT0                                                        CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C********** ZIAMT     DIV  36000     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36000     ZINTR     H                                         220323
     C                     END                                                                CER016
      *                                                                                       CER016
     C                     END                             - E1
     C*
     C           ZICALC    IFEQ 4                          - B1
     C           ZICALC    OREQ 1
     C********** ZIAMT     DIV  36500     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36500     ZINTR     H                                         220323
     C                     END                             - E1
     C*
     C           ZICALC    IFEQ 6                          - B1
     C********** ZIAMT     DIV  36600     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36600     ZINTR     H                                         220323
     C                     END                             - E1
     C*
     C********** ZIWRK1    MULT ZIRATE    ZIWRK2    H                                         220323
     C********** ZIWRK2    MULT ZDAYN2    ZINTR     H                                         220323
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3262CPD2                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **ZIC00 ENDSR**
     C********************************************************************
     C/EJECT                                                              CRE001
     C********************************************************************CRE001
     C**                                                                  CRE001
     C** ZICOD subroutine to calculate Interest with Overdraft            CRE001
     C**                                                                  CRE001
     C**     Called by       INTCAL                                       CRE001
     C**     Calls           ZICD                                         CRE001
     C**                                                                  CRE001
     C********************************************************************CRE001
     C           ZICOD     BEGSR                           **ZICOD BEGSR**CRE001
      *                                                                   CRE001
      ** Zeroise work fields                                              CRE001
     C                     Z-ADD*ZEROS    WWINTA                          CRE001
     C                     Z-ADD*ZEROS    WWDRIA                          CRE001
     C                     Z-ADD*ZEROS    WWODIA                          CRE001
     C                     Z-ADD*ZEROS    WWODRL                          CRE001
      *                                                                   CRE001
      ** Set work field with Overdraft Line Amount                        CRE001
     C                     Z-ADDODRL      WWODRL                          CRE001
      *                                                                   CRE001
      ** Adjust work field according to Currency Decimal Places           CRE001
     C           CCY       LOKUPCURR,X                   64               CRE001
     C                     DO   DPA,X                                     CRE001
     C                     MULT 10        WWODRL                          CRE001
     C                     ENDDO                                          CRE001
      *                                                                   CRE001
      ** If History Balance > work field Overdraft Line Amount            CRE001
      **    And Additional Overdraft Rate NOT = 0                         CRE001
      **    And Period End Date < OR = Overdraft Expiry Date              CRE001
     C           HISB      IFGT WWODRL                     B1             CRE001
     C           AODR      ANDNE*ZERO                      A1             CRE001
     C           ZIEND     ANDLEODED                       A1             CRE001
     C/COPY WNCPYSRC,RE3262C038
      *                                                                   CRE001
      ** Calculate Interest on History Balance using normal DR Int.Rate   CRE001
     C                     Z-ADDRHISB     ZIAMT                           CRE001
     C/COPY WNCPYSRC,RE3262C031
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Interest Amount           CRE001
     C                     Z-ADDZINTR     WWINTA                          CRE001
      *                                                                   CRE001
      ** Calculate Interest again using Additional Overdraft Rate         CRE001
      ** on the difference between the Balance and the Overdraft Limit    CRE001
     C           RHISB     SUB  WWODRL    ZIAMT                           CRE001
     C                     Z-ADDAODR      ZIRATE                          CRE001
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Overdraft Interest Amt    CRE001
     C                     Z-ADDZINTR     WWODIA                          CRE001
      *                                                                   CRE001
      ** Interest Amt + Overdraft Interest Amt = Debit Interest Amt       CRE001
     C           WWINTA    ADD  WWODIA    WWDRIA                          CRE001
      *                                                                   CRE001
     C                     ELSE                            X1             CRE001
      *                                                                   CRE001
      ** If Period End Date > Overdraft Expiry Date                       CRE001
      **    And Overdraft Expiry Date > 0                                 CRE001
     C           ZIEND     IFGT ODED                       B.2            CRE001
     C           ODED      ANDGT*ZERO                      A.2            CRE001
      *                                                                   CRE001
      ** Calculate Interest on History Balance using normal DR Int.Rate   CRE001
     C/COPY WNCPYSRC,RE3262C032
     C                     Z-ADDRHISB     ZIAMT                           CRE001
     C                     EXSR ZIC00                                     CRE001
     C/COPY WNCPYSRC,RE3262C033
      *                                                                   CRE001
      ** Move calculated Interest to work field Interest Amount           CRE001
     C                     Z-ADDZINTR     WWINTA                          CRE001
      *                                                                   CRE001
      ** Calculate Interest again using Additional Overdraft Rate         CRE001
      ** on the same Balance Amount                                       CRE001
     C                     Z-ADDRHISB     ZIAMT                           CRE001
     C                     Z-ADDAODR      ZIRATE                          CRE001
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Overdraft Interest Amt    CRE001
     C                     Z-ADDZINTR     WWODIA                          CRE001
      *                                                                   CRE001
      ** Interest Amt + Overdraft Interest Amt = Debit Interest Amt       CRE001
     C           WWINTA    ADD  WWODIA    WWDRIA                          CRE001
      *                                                                   CRE001
     C                     ELSE                            X.2            CRE001
      *                                                                   CRE001
      ** Calculate Interest on History Balance using normal DR Int.Rate   CRE001
     C                     Z-ADDRHISB     ZIAMT                           CRE001
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Debit Interest Amt        CRE001
     C                     Z-ADDZINTR     WWDRIA                          CRE001
      *                                                                   CRE001
     C                     ENDIF                           E.2            CRE001
     C                     ENDIF                           E1             CRE001
      *                                                                   CRE001
      ** Move Debit Interest Amount to Interest Amount                    CRE001
     C                     Z-ADDWWDRIA    ZINTR                           CRE001
      *                                                                   CRE001
     C                     ENDSR                           **ZICOD ENDSR**CRE001
     C********************************************************************CRE001
     C/EJECT
     C********************************************************************
     C**
     C** ZIC01 subroutine to calculate interest (type=01)
     C**
     C**     Called by       INTCAL
     C**     Calls           ZICD
     C**
     C           ZIC01     BEGSR                           **ZIC01 BEGSR**
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3262CPD3                                           S01408
     C*                                                                   S01408
     C*
     C** REVERSE SIGN OF AMOUNT IF IT'S NEGATIVE
     C*
     C           ZIAMT     IFLT 0                          - B1
     C                     Z-SUBZIAMT     ZIAMT
     C                     END                             - E1
     C*
     C** INITIALIZE WORK FIELDS
     C*
     C                     Z-ADDZIAMT     ZIAMT1
     C                     Z-ADD1         Z
     C                     Z-ADD*ZEROS    ZIAMTR
     C                     Z-ADD*ZEROS    ZIA
     C                     Z-ADD*ZEROS    ZIA1
     C                     Z-ADD*ZEROS    LOOP
     C                     Z-ADD*ZEROS    Y
     C                     Z-ADD*ZEROS    ZIN
     C*
     C***INTEREST*IS*ONLY*CALCULATED*ON*AN*AMOUNT*THAT*EXCEEDS*OR*IS*EQUAL103460
     C***TO*THE*INITIAL*THRESHOLD*BALANCE                                 103460
      *  INTEREST IS ONLY CALCULATED ON AN AMOUNT THAT EXCEEDS THE        103460
      *  INITIAL THRESHOLD BALANCE                                        103460
     C*
     C***********ZIAMT     IFGE ZITHR                      - B1           103460
     C           ZIAMT     IFGT ZITHR                      - B1           103460
     C*
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASIS
     C*
     C                     EXSR ZICD
     C*
     C*
     C           LOOP      DOWEQ0                          - B2
     C                     Z-ADDZIAMT1    ZIAMTR
     C*
     C           Z         IFEQ 11                         - B3
     C                     Z-ADDZIAMTR    ZIA,Z
     C                     Z-ADD1         LOOP
     C*
     C                     ELSE                            - X3
     C                     ADD  1         Y
     C                     ADD  1         Z
     C*
     C           ZIB,Z     IFEQ 0                          - B4
     C                     ADD  ZIAMTR    ZIA,Y
     C                     Z-ADD1         LOOP
     C*
     C                     ELSE                            - X4
     C           ZIB,Z     SUB  ZIB,Y     ZBAL
     C           ZIAMTR    SUB  ZBAL      ZIAMT1
     C*
     C           ZIAMT1    IFLE 0                          - B5
     C                     ADD  ZIAMTR    ZIA,Y
     C                     Z-ADD1         LOOP
     C*
     C                     ELSE                            - X5
     C                     ADD  ZBAL      ZIA,Y
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZIA       MULT ZIR       ZIA1                                                220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIA1      MULT INT6DY    ZIA1                                                220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIA1      MULT ZDAYN2    ZIA1                                                220323
     C                     ENDIF                                                              220323
     C*
     C           ZICALC    IFEQ 7                          - B2
     C           ZICALC    OREQ 5
     C           ZICALC    OREQ 3
     C           ZICALC    OREQ 2
     C           ZICALC    OREQ 0                                                             CER016
      *                                                                                       CER016
     C           ZICALC    IFEQ 0                                                             CER016
     C           PINTN     ANDEQ'Y'                                                           CER016
     C                     Z-ADD1         C       20                                          CER016
      *                                                                                       CER016
     C           C         DOWLT12                                                            CER016
     C                     Z-ADDZIA,C     WAMT                                                CER016
     C                     Z-ADDZIR,C     WRATE                                               CER016
     C                     EXSR SRINT0                                                        CER016
     C                     Z-ADDZINTR     ZIN1,C                                              CER016
     C                     ADD  1         C                                                   CER016
     C                     ENDDO                                                              CER016
      *                                                                                       CER016
     C                     XFOOTZIN1      ZINTR1    H                                         CER016
     C                     Z-ADDZINTR1    ZINTR     H                                         CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C********** ZIA       DIV  36000     ZIA1      H                                         220323
     C           ZIA1      DIV  36000     ZIN1      H                                         220323
     C                     END                                                                CER016
     C*
     C                     END                             - E2
     C*
     C           ZICALC    IFEQ 4                          - B2
     C           ZICALC    OREQ 1
     C********** ZIA       DIV  36500     ZIA1      H                                         220323
     C           ZIA1      DIV  36500     ZIN1      H                                         220323
     C*
     C                     END                             - E2
     C*
     C           ZICALC    IFEQ 6                          - B2
     C********** ZIA       DIV  36600     ZIA1      H                                         220323
     C           ZIA1      DIV  36600     ZIN1      H                                         220323
     C*
     C                     END                             - E2
     C           ZICALC    IFNE 0                                                             CER016
     C           PINTN     ORNE 'Y'                                                           CER016
     C*
     C********** ZIA1      MULT ZIR       ZIA1      H                                         220323
     C***********ZIA1      MULT ZDAYN2    ZIN       H                     074578
     C********** ZIA1      MULT ZDAYN2    ZIN1      H                                  074578 220323
     C***********          XFOOTZIN       ZINTR                           074578
     C                     XFOOTZIN1      ZINTR1 185H                     074578
     C                     Z-ADDZINTR1    ZINTR     H                     074578
     C                     ENDIF                                                              CER016
     C*
     C                     END                             - E1
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3262CPD4                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **ZIC01 ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZIC02 subroutine to calculate interest (type=02)
     C**
     C**     Called by       INTCAL
     C**     Calls           ZICD
     C**
     C           ZIC02     BEGSR                           **ZIC02 BEGSR**
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3262CPD5                                           S01408
     C*                                                                   S01408
     C*
     C** FILL THE END OF THE TABLE WITH HIGHVAL
     C*
     C                     Z-ADD2         Z
     C           Z         DOWLE11
     C           ZIB,Z     IFEQ *ZEROS
     C                     Z-ADD*HIVAL    ZIB,Z
     C                     END
     C                     ADD  1         Z
     C                     END
     C*
     C** REVERSE SIGN OF AMOUNT IF IT'S NEGATIVE
     C*
     C           ZIAMT     IFLT 0                          - B1
     C                     Z-SUBZIAMT     ZIAMT
     C                     END                             - E1
     C*
     C***INTEREST*IS*ONLY*CALCULATED*ON*AN*AMOUNT*THAT*EXCEEDS*OR*IS*EQUAL103460
     C***TO*THE*INITIAL*THRESHOLD*BALACEE                                 103460
      *  INTEREST IS ONLY CALCULATED ON AN AMOUNT THAT EXCEEDS THE        103460
      *  INITIAL THRESHOLD BALANCE                                        103460
     C*
     C***********ZIAMT     IFGE ZITHR                      - B1           103460
     C           ZIAMT     IFGT ZITHR                      - B1           103460
     C*
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASIS
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADD1         Z
     C           ZIAMT     LOKUPZIB,Z                  40
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZIAMT     MULT ZIR,Z     ZIWRK1                                              220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIWRK1    MULT INT6DY    ZIWRK2                                              220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIWRK1    MULT ZDAYN2    ZIWRK2                                              220323
     C                     ENDIF                                                              220323
     C*
     C           ZICALC    IFEQ 7                          - B2
     C           ZICALC    OREQ 5
     C           ZICALC    OREQ 3
     C           ZICALC    OREQ 2
     C           ZICALC    OREQ 0                                                             CER016
      *                                                                                       CER016
     C           ZICALC    IFEQ 0                                                             CER016
     C           PINTN     ANDEQ'Y'                                                           CER016
     C                     Z-ADDZIAMT     WAMT                                                CER016
     C                     Z-ADDZIR,Z     WRATE                                               CER016
     C                     EXSR SRINT0                                                        CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C********** ZIAMT     DIV  36000     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36000     ZINTR     H                                         220323
     C                     END                                                                CER016
     C*
     C                     END                             - E2
     C*
     C           ZICALC    IFEQ 4                          - B2
     C           ZICALC    OREQ 1
     C********** ZIAMT     DIV  36500     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36500     ZINTR     H                                         220323
     C*
     C                     END                             - E2
     C*
     C           ZICALC    IFEQ 6                          - B2
     C********** ZIAMT     DIV  36600     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36600     ZINTR     H                                         220323
     C*
     C                     END                             - E2
     C*
     C/COPY WNCPYSRC,RE3262C029
     C********** ZIWRK1    MULT ZIR,Z     ZIWRK2    H                                         220323
     C********** ZIWRK2    MULT ZDAYN2    ZINTR     H                                         220323
     C/COPY WNCPYSRC,RE3262C030
     C*
     C                     END                             - E1
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3262CPD6                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **ZIC02 ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DRINIT subroutine for debit rates loading
     C**
     C**     Called by       INTCAL
     C**     Calls           *PSSR
     C**
     C           DRINIT    BEGSR                           **DRINIT BEGSR**
     C*
     C                     Z-ADD*ZEROS    ZIRD
     C                     Z-ADD*ZEROS    ZIBD
     C                     Z-ADD*ZERO     ZITHR
     C                     Z-ADD*ZEROS    INTHD
     C*
     C** CHAIN TO DEBIT RATE CHANGES FILE
     C*
     C                     Z-ADDDRCD      KDATE
     C*
     C           DCKEY     CHAINREHRDJ               99
     C*
     C** ERROR IN REHRDJ
     C*
     C           *IN99     IFEQ '1'                        - B1
     C********** DRIB      ANDEQ*ZEROS                                                        CSD103
     C           DRIB      ANDEQ*BLANKS                                                       CSD103
     C********** DRIS      ANDEQ*ZEROS                                                        262850
     C           DRIS1     ANDEQ*ZEROS                                                        262850
     C                     MOVE '0'       *IN99
     C                     END                             - E1
     C*
     C           *IN99     IFEQ '1'                        - B1
     C                     Z-ADD92        DBASE            ***************
     C                     MOVE 'HRDJ '   DBFILE           **DB ERROR 92**
     C                     Z-ADDKDATE     REHDAT           ***************
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELREHKEY    DBKEY
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C** PICK-UP DEBIT THRESHOLD BALANCE
     C*
     C                     Z-ADDINTHD     ZITHR
     C*
     C** SETUP WORK DEBIT FIELDS WITH FIELDS READ
     C*
     C           RAT2      IFNE *BLANKS                    - B1
     C                     MOVELRAT2      WDRAT
     C                     END                             - E1
     C*
     C           RAT3      IFNE *BLANKS                    - B1
     C                     MOVE RAT3      WDRAT
     C                     END                             - E1
     C*
     C           BAL2      IFNE *BLANKS                    - B1
     C                     MOVELBAL2      WDBAL
     C                     END                             - E1
     C*
     C           BAL3      IFNE *BLANKS                    - B1
     C                     MOVE BAL3      WDBAL
     C                     END                             - E1
     C*
     C** LOADING OF DEBIT INTEREST RATES AND DEBIT INTEREST BALANCES
     C*
     C                     Z-ADDZIRD      ZIR
     C                     Z-ADDZIBD      ZIB
     C*
     C                     ENDSR                           **DRINIT ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CRINIT subroutine for credit rates loading
     C**
     C**     Called by       INTCAL
     C**     Calls           *PSSR
     C**
     C           CRINIT    BEGSR                           **CRINIT BEGSR**
     C*
     C                     Z-ADD*ZEROS    ZIRC
     C                     Z-ADD*ZEROS    ZIBC
     C                     Z-ADD*ZERO     ZITHR
     C                     Z-ADD*ZEROS    INTHC
     C*
     C** CHAIN TO CREDIT RATE CHANGES FILE
     C*
     C                     Z-ADDCRCD      KDATE
     C*
     C           DCKEY     CHAINREHRCJ               99
     C*
     C** ERROR IN REHRCJ
     C*
     C           *IN99     IFEQ '1'                        - B1
     C********** CRIB      ANDEQ*ZEROS                                                        CSD103
     C           CRIB      ANDEQ*BLANKS                                                       CSD103
     C********** CRIS      ANDEQ*ZEROS                                                        262850
     C           CRIS1     ANDEQ*ZEROS                                                        262850
     C                     MOVE '0'       *IN99
     C                     END                             - E1
     C*
     C           *IN99     IFEQ '1'                        - B1
     C                     Z-ADD93        DBASE            ***************
     C                     MOVE 'HRCJ '   DBFILE           **DB ERROR 93**
     C                     Z-ADDKDATE     REHDAT           ***************
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELREHKEY    DBKEY
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C** PICK-UP CREDIT THRESHOLD BALANCE
     C*
     C                     Z-ADDINTHC     ZITHR
     C*
     C** SETUP WORK CREDIT FIELDS WITH FIELDS READ PROCESSING
     C*
     C           RAT2      IFNE *BLANKS                    - B1
     C                     MOVELRAT2      WCRAT
     C                     END                             - E1
     C*
     C           RAT3      IFNE *BLANKS                    - B1
     C                     MOVE RAT3      WCRAT
     C                     END                             - E1
     C*
     C           BAL2      IFNE *BLANKS                    - B1
     C                     MOVELBAL2      WCBAL
     C                     END                             - E1
     C*
     C           BAL3      IFNE *BLANKS                    - B1
     C                     MOVE BAL3      WCBAL
     C                     END                             - E1
     C*
     C** LOADING OF CREDIT INTEREST RATES AND CREDIT INTEREST BALANCES
     C*
     C                     Z-ADDZIRC      ZIR
     C                     Z-ADDZIBC      ZIB
     C*
     C                     ENDSR                           **CRINIT ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DATEIN subroutine for date init processing
     C**
     C**     Called by       INTCAL
     C**     Calls           *PSSR
     C**
     C           DATEIN    BEGSR                           **DATEIN BEGSR**
     C*
     C** WORK FIELD INIT
     C*
     C                     Z-ADD*ZEROS    ZLDTM
     C*
     C** CALCULATING DATE FROM DAY NUMBER (REACR HISTORY DATE)
     C*
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFNE '0'                        - B1
     C                     Z-ADD94        DBASE            ***************
     C                     MOVE 'ZDATE2'  DBFILE           **DB ERROR 94**
     C                     MOVE ZERROR    ERRDAT           ***************
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELERRDAT    DBKEY
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C** CALCULATING FIRST DAY OF THIS MONTH TO CALCULATE THE LAST ONE
     C*
     C           *IN98     IFEQ '0'                        - B1           088029
     C                     Z-ADDZDATE     RESULT
     C                     Z-ADD1         ZDAY
     C                     Z-ADDRESULT    ZDATE
     C                     ELSE                            - X1           088029
     C                     Z-ADDZDATE     RESULX                          088029
     C                     Z-ADD1         ZDAYX                           088029
     C                     Z-ADDRESULX    ZDATE                           088029
     C                     END                             - E1           088029
     C                     EXSR ZDATE1
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFNE '0'                        - B1
     C                     Z-ADD95        DBASE            ***************
     C                     MOVEL'ZDATE1'  DBFILE           **DB ERROR 95**
     C                     MOVE ZERROR    ERRDAT           ***************
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELERRDAT    DBKEY
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C           *IN98     IFEQ '0'                        - B0           088029
     C           ZMTH      IFEQ 12                         - B1
     C                     Z-ADD1         ZMTH
     C                     ADD  1         ZYEAR
     C                     ELSE                            - X1
     C                     ADD  1         ZMTH
     C                     END                             - E1
     C*
     C                     Z-ADDRESULT    ZDATE
     C                     ELSE                            - X0           088029
     C           ZMTHX     IFEQ 12                         - B1           088029
     C                     Z-ADD1         ZMTHX                           088029
     C                     ADD  1         ZYEARX                          088029
     C                     ELSE                            - X1           088029
     C                     ADD  1         ZMTHX                           088029
     C                     END                             - E1           088029
     C*                                                                   088029
     C                     Z-ADDRESULX    ZDATE                           088029
     C                     END                             - E0           088029
     C                     EXSR ZDATE1
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFNE '0'                        - B1
     C                     Z-ADD96        DBASE            ***************
     C                     MOVEL'ZDATE1'  DBFILE           **DB ERROR 96**
     C                     MOVE ZERROR    ERRDAT           ***************
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELERRDAT    DBKEY
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C           ZDAYNO    SUB  1         ZLDTM
     C*
     C                     ENDSR                           **DATEIN ENDSR**
     C*
     C/EJECT                                                                                  230844
      *****************************************************************                       230844
      **                                                              *                       230844
      ** SRCHRG subroutine for reversal of charges in primary         *                       230844
      **                                                              *                       230844
      **     Called by       MAIN                                     *                       230844
      **     Calls                                                    *                       230844
      **                                                              *                       230844
      *****************************************************************                       230844
     C           SRCHRG    BEGSR                                                              230844
      *                                                                                       230844
     C           *LIKE     DEFN CHGAN     WCHGAN                                              230844
     C           *LIKE     DEFN CHGAR     WCHGAR                                              230844
     C                     Z-ADD0         WCHGAN                                              230844
     C                     Z-ADD0         WCHGAR                                              230844
      *                                                                                       230844
     C                     MOVE WCNUM     CNUM                                                230844
     C                     Z-ADDWACOD     ACOD                                                230844
     C                     Z-ADDWACSQ     ACSQ                                                230844
     C                     MOVE WBRCA     BRCA                                                230844
      *                                                                                       230844
     C           ACCKEY    CHAINACCNT                55                                       230844
     C           *IN55     IFEQ '1'                        - B1                               230844
     C                     MOVE CCY       REHKEY                                              230844
     C                     Z-ADD62        DBASE            ***************                    230844
     C                     MOVE 'ACCNT'   DBFILE           **DB ERROR 62**                    230844
     C                     MOVELAKEY      DBKEY            ***************                    230844
     C                     EXSR *PSSR                                                         230844
     C                     END                             - E2                               230844
      *                                                                                       230844
     C                     Z-ADDVALU      HISD                                                230844
      *                                                                                       230844
      ** Get charge amount information from secondary account                                 230844
      *                                                                                       230844
     C           REDKEY    SETLLREHISPPF                                                      230844
     C           ACCKY     READEREHISPPF                 53                                   230844
     C           *IN53     DOWEQ'0'                                                           230844
     C           HISD      ANDLELMVD                                                          230844
     C                     ADD  CHGAN     WCHGAN                                              230844
     C                     ADD  CHGAR     WCHGAR                                              230844
     C           ACCKY     READEREHISPPF                 53                                   230844
     C                     ENDDO                                                              230844
      *                                                                                       230844
     C                     MOVE WLTCUS    CNUM                                                230844
     C                     Z-ADDWLTAC     ACOD                                                230844
     C                     Z-ADDWLTAS     ACSQ                                                230844
     C                     MOVE WLTAB     BRCA                                                230844
     C                     Z-ADDRUND      HISD                                                230844
      *                                                                                       230844
      ** Subtract secondary account charges from primary account                              230844
      *                                                                                       230844
     C           REDKEY    SETGTREHISPPF                                                      230844
     C           ACCKY     REDPEREHISPPF                 53                                   230844
      *                                                                                       230844
      ** Verify if error                                                                      230844
      *                                                                                       230844
     C           *IN53     IFNE '0'                                                           230844
     C                     MOVE CCY       REHKEY                                              230844
     C                     Z-ADD63        DBASE            ***************                    230844
     C                     MOVE 'REHISDL' DBFILE           **DB ERROR 63**                    230844
     C                     MOVE *BLANKS   DBKEY            ***************                    230844
     C                     MOVELAKEY      DBKEY                                               230844
     C                     EXSR *PSSR                                                         230844
      *                                                                                       230844
     C                     ELSE                                                               230844
     C           CHGAN     SUB  WCHGAN    CHGAN                                               230844
     C           CHGAR     SUB  WCHGAR    CHGAR                                               230844
     C           TCHGAN    SUB  WCHGAN    TCHGAN                                              230844
     C           TCHGAR    SUB  WCHGAR    TCHGAR                                              230844
     C                     UPDATREHISPPF                                                      230844
     C                     ENDIF                                                              230844
      *                                                                                       230844
      ** Update REIACD                                                                        230844
      *                                                                                       230844
     C           ACCKEY    CHAINREIAC                66                                       230844
     C           *IN66     IFEQ '1'                        - B1                               230844
     C                     MOVE CCY       REHKEY                                              230844
     C                     Z-ADD64        DBASE            ***************                    230844
     C                     MOVE 'REIAC'   DBFILE           **DB ERROR 64**                    230844
     C                     MOVELAKEY      DBKEY            ***************                    230844
     C                     EXSR *PSSR                                                         230844
     C                     ELSE                                                               230844
     C           NRCA      SUB  WCHGAN    NRCA                                                230844
     C           RCA       SUB  WCHGAR    RCA                                                 230844
     C                     UPDATREIACDF                                                       230844
     C                     END                             - E2                               230844
      *                                                                                       230844
     C                     ENDSR                                                              230844
      *****************************************************************                       230844
     C/EJECT                                                                                  230844
     C********************************************************************
      *                                                               *                       CER016
      *  SRINT0 - Subroutine to calculate interest for Retail type    *                       CER016
      *           account (Method 0)                                  *                       CER016
      *                                                               *                       CER016
      *  Called By: ZIC00, ZIC01 and ZIC02 Subroutine                 *                       CER016
      *                                                               *                       CER016
      *  Calls: None                                                  *                       CER016
      *                                                               *                       CER016
      *****************************************************************                       CER016
      *                                                                                       CER016
     C           SRINT0    BEGSR                                                              CER016
      *                                                                                       CER016
     C                     MOVE A6NBDP    WNDP    10                                          CER016
     C                     Z-ADD1         WNDTMP 150                                          CER016
     C           WNDP      IFEQ 0                                                             CER016
     C                     Z-ADD1         WNDTMP                                              CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
      *                                                                                       CER016
     C                     DO   WNDP                                                          CER016
     C           10        MULT WNDTMP    WNDTMP                                              CER016
     C                     ENDDO                                                              CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C           WAMT      MULT ZDAYN2    WINAMT                                              CER016
     C           WINAMT    DIV  100       WNAMT1    H                                         CER016
     C           WNAMT1    DIV  WNDTMP    WNAMT2    H                                         CER016
     C           WNAMT2    MULT WNDTMP    WRKFLD 150                                          CER016
     C           WRKFLD    MULT WRATE     ZINT1  150                                          CER016
     C           ZINT1     DIV  360       ZINT2  150H                                         CER016
     C                     Z-ADDZINT2     ZINTR                                               CER016
     C                     ENDSR                           **SRINT0 ENDSR**                   CER016
      *****************************************************************                       CER016
      /EJECT                                                                                  CER016
      *****************************************************************                       CER016
      *                                                               *                       CER016
      *  SRAOS - Subroutine to call AOSVALR0 for New system valuele   *                       CER016
      *          Interest Number                                      *                       CER016
      *                                                               *                       CER016
      *  Called By: INTCAL Subroutine                                 *                       CER016
      *                                                               *                       CER016
      *  Calls: AOSVALR0                                              *                       CER016
      *                                                               *                       CER016
      *****************************************************************                       CER016
      *                                                                                       CER016
     C           SRAOS     BEGSR                                                              CER016
     C                     MOVE 'N'       WFIRST                                              CER016
      *                                                                                       CER016
      **  Call AOSVALR0 to check for InterestNumber                                           CER016
      *                                                                                       CER016
     C                     CALL 'AOSVALR0'                                                    CER016
     C                     PARM *BLANKS   PRTCD   7                                           CER016
     C                     PARM PSYSVL    PSVLK1 20                                           CER016
     C                     PARM           PSVL1 200                                           CER016
     C                     PARM *BLANKS   PSVLK2 20                                           CER016
     C                     PARM           PSVL2 200                                           CER016
     C                     PARM *BLANKS   PSVLK3 20                                           CER016
     C                     PARM           PSVL3 200                                           CER016
     C                     PARM *BLANKS   PSVLK4 20                                           CER016
     C                     PARM           PSVL4 200                                           CER016
     C                     PARM *BLANKS   PSVLK5 20                                           CER016
     C                     PARM           PSVL5 200                                           CER016
     C                     PARM *BLANKS   PSVLK6 20                                           CER016
     C                     PARM           PSVL6 200                                           CER016
     C                     PARM *BLANKS   PSVLK7 20                                           CER016
     C                     PARM           PSVL7 200                                           CER016
     C                     PARM *BLANKS   PSVLK8 20                                           CER016
     C                     PARM           PSVL8 200                                           CER016
     C                     PARM *BLANKS   PSVLK9 20                                           CER016
     C                     PARM           PSVL9 200                                           CER016
     C                     PARM *BLANKS   PSVLK0 20                                           CER016
     C                     PARM           PSVL0 200                                           CER016
      *                                                                                       CER016
     C           PRTCD     IFNE *BLANKS                                                       CER016
     C           PSVL1     ANDEQ'*NRF   '                                                     CER016
     C                     EXSR *PSSR                                                         CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C                     MOVELPSVL1     PINTN   1                                           CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C                     ENDSR                                                              CER016
      *                                                                                       CER016
      *****************************************************************                       CER016
      /EJECT                                                                                  CER016
      *****************************************************************                       CER016
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3262CP10                                           S01408
      *                                                                   S01408
     C/COPY ZSRSRC,ZDATE1Z2
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZFRQAZ2
     C/COPY ZSRSRC,ZACCH
     C/COPY ZSRSRC,ZCHKH
     C/EJECT
      *                                                                   081162
      ** Array NAR has been changed - previous value 'INITIAL LINK'       081162
      *                                                                   081162
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@  OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**  ZFMD
312831303130313130313031
**  NAR
UNLINK -                                                                  081162
