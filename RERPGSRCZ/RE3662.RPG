     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Capitalisation processing')                   *
     F*****************************************************************
     F*                                                               *
     F*  Midas Retail Module                                          *
     F*                                                               *
     F*  RE3662 - ACCRUALS PROCESSING                                 *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
     F*   Note: This program is used in Data Migration and when core  *
     F*         changes to it are signed off, it must be copied to    *
     F*         CORESRC in library MIGRATE and the members that refer *
     F*         to it in the various Migration Data Libraries         *
     F*         must be recompiled.                                   *
      *                                                               *
      *  Last Amend No. MD055663           Date 22May20               *
      *  Prev Amend No. CER050             Date 16Jun19               *
      *                 AR666241           Date 12Aug19               *
      *                 MD046248           Date 27Oct17               *
      *                 AR836982           Date 16May14               *
      *                 CER071             Date 01Aug16               *
      *                 MD035448           Date 01Dec15               *
      *                 MD031299           Date 27Feb15               *
      *                 CRE095             Date 25Apr14               *
      *                 CGL165             Date 17Feb15               *
      *                 CER070             Date 19Aug14               *
      *                 CER069             Date 03Jul14               *
      *                 MD027245           Date 12Jun14               *
      *                 CRE090             Date 14Feb14               *
      *                 MD023376           Date 25Apr14               *
      *                 MD025491           Date 20Mar14               *
      *                 MD022970           Date 21Oct13               *
      *                 MD020841           Date 10Jun13               *
      *                 AR1075078          Date 08Feb13               *
      *                 AR1046263          Date 07Feb13               *
      *                 220323             Date 06Oct12               *
      *                 CLE134             Date 01Aug12               *
      *                 CRE083AY           Date 06Aug12               *
      *                 AR833959           Date 27Nov11               *
      *                 AR851468           Date 19Oct11               *
      *                 AR813832           Date 20Aug11               *
      *                 AR823701           Date 07Sep11               *
      *                 CER049             Date 06Dec10               *
      *                 CER055             Date 06Dec10               *
      *                 AR787620           Date 10Jun11               *
      *                 AR750273C          Date 11Jun11               *
      *                 AR782377           Date 04Jun11               *
      *                 AR744574           Date 17May11               *
      *                 AR749044           Date 04May11               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26873           Date 13Jan09               *
      *                 BUG26839           Date 05Jan10               *
      *                 BUG26767           Date 20Nov09               *
      *                 BUG26754           Date 19Nov09               *
      *                 BUG26537           Date 22Oct09               *
      *                 BUG26037B          Date 12Oct09               *
      *                 BUG26324           Date 08Oct09               *
      *                 BUG25533           Date 19Aug09               *
      *                 BUG25942           Date 11Sep09               *
      *                 CER045             Date 20Jul09               *
      *                 BUG25233           Date 31Jul09               *
      *                 BUG24768           Date 07Jun09               *
      *                 BUG24630A          Date 02Jul09               *
      *                 BUG24379           Date 17Jun09               *
      *                 BUG24051           Date 27May09               *
      *                 BUG23732           Date 23Apr09               *
      *                 BUG23932A          Date 25May09               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23931           Date 11May09               *
      *                 BUG23932           Date 08May09               *
      *                 BUG23123B          Date 17Apr09               *
      *                 BUG23310A          Date 24Apr09               *
      *                 BUG23310           Date 08Apr09               *
      *                 BUG23123           Date 09Mar09               *
      *                 BUG23309           Date 11Mar09               *
      *                 BUG23139           Date 03Mar09               *
      *                 BUG23009A          Date 27Feb09               *
      *                 BUG22911           Date 17Feb09               *
      *                 CER048             Date 19May08               *
      *                 CER016             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CDL081             Date 14Dec09               *
      *                 260297A            Date 28May09               *
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG14933           Date 02Oct07               *
      *                 BUG12930           Date 22Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL013             Date 08Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 16May06               *
      *                 CSD027             Date 09Dec05               *
      *                 236061             Date 16Sep05               *
      *                 235875             Date 06Sep05               *
      *                 235329             Date 19Aug05               *
      *                 234870             Date 22Jul05               *
      *                 234656             Date 06Jul05               *
      *                 234628             Date 04Jul05               *
      *                 234003             Date 21Jun05               *
      *                 233564             Date 18May05               *
      *                 233563             Date 18May05               *
      *                 232543             Date 01Apr05               *
      *                 CGL035             Date 01Mar05               *
      *                 CGL031             Date 04Jul05               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      *                 182452             Date 19Jun01               *
      *                 CDE002             Date 21Dec99               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179181             Date 22May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 153001             Date 26Apr99               *
     F*                 131447             Date 30Apr99               *
     F*                 130468             DATE 28Apr99               *
     F*                 123519             DATE 27May98               *
     F*                 091680             DATE 18May98               *
     F*                 103460             DATE 06Mar98               *
     F*                 092245             DATE 21Feb98               *
     F*                 100086             DATE 17FEB98               *
     F*                 121125             Date 09FEB98               *
     F*                 105489             DATE 06FEB98               *
     F*                 102667             DATE 06FEB98               *
     F*                 108867             DATE 05FEB98               *
     F*                 088932             DATE 21JAN98               *
     F*                 108931             DATE 26SEP97               *
     F*                 101827             DATE 08MAY97               *
     F*                 CRE001             Date 18Feb97               *
     F*                 099090             Date 09APR97               *
     F*                 114049             DATE 05MAR97               *
     F*                 089057             DATE 14FEB97               *
     F*                 CCB003             DATE 23OCT96               *
     F*                 S01408             DATE 15OCT96               *
     F*                 S01408             DATE 16AUG96               *
     F*                 S01408             DATE 08AUG96               *
     F*                 086372             DATE 13APR95               *
     F*                 S01408             DATE 06JUN96               *
     F*                 S01408             DATE 11APR96               *
     F*                 085250             DATE 28APR95               *
     F*                 088029             DATE 08JUN95               *
     F*                 085464             DATE 04APR95               *
     F*                 085330             DATE 27MAR95               *
     F*                 075197             DATE 08SEP94               *
     F*                 S01408             DATE 22AUG94               *
     F*                 074578             DATE 17AUG95               *
     F*                 071053             DATE 23MAY94               *
     F*                 057048             DATE 07MAR94               *
     F*                 067706             DATE 07MAR94               *
     F*                 063793             DATE 10FEB94               *
     F*                 054346             DATE 28SEP93               *
     F*                 045125             DATE 28SEP93               *
     F*                 S01413 *CREATE     DATE 13APR93               *
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  MD055663 - Incorrect interest calculation for Interest Type  *
      *             03/04. Change capitalisation period for interest  *
      *             type 03/04. Instead of 1st day of the month, start*
      *             date will now be the last calendar day of the     *
      *             previous month, end date will be the penultimate  *
      *             day of the month.                                 *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  AR666241 - Discrepancy in RE3810 report due HISB being       *
      *             updated twice with WHT. Caused by CDL013.         *
      *             Apply 216656 to ensure HISB is updated once       *
      *             (Child: AR666242)                                 *
      *           - Applied for MD054157.                             *
      *  MD046248 - Finastra Rebranding                               *
      *  AR836982 - REC62N failed dur to inseted account with back-   *
      *             valued rate change date. To avoid REC62N failure, *
      *             use HISD as key to search for rate change record. *
      *             Applied fix 244181. (Child: AR836983)             *
      *           - Applied for MD021848.                             *
      *  CER071 - BAIS - Legal Form field (Recompile)                 *
      *  MD035448 - CER016 only applies to cal basis 0. Need to apply *
      *             in all cal basis.                                 *
      *  MD031299 - Forward Valued Rate Change are ignored. Rate      *
      *             Change should always be processed.                *
      *  CRE095 - Rate Fixing for RE Accounts (Recompile)             *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CER070 - BuBa Reporting / BAIS V.1.16.0 (Recompile)          *
      *  CER069 - German Tax Enhancement                              *
      *  MD027245 - Interest capitalisation not performed on delay    *
      *             date when demand capitalisation was requested     *
      *             during delay period.                              *
      *  CRE090 - Delay Capitalization of Interest                    *
      *  MD023376 - Write TEGLIS correctly in REHISPS                 *
      *  MD025491 - Discrepancies in System Calculation for OD penalty*
      *             interest calculation                              *
      *  MD022970 - REC62A 00001 Database Error                       *
      *  MD020841 - Database comparison differences for REHISPS.      *
      *             RUND is being overridden when REHPOSPP fields are *
      *             cleared.
      *  AR1075078 - Database compare results between KL and C1       *
      *              have the differences in REACRD. Populate the     *
      *              NXTKEY based on the key fields of the main input *
      *              file - REHISBN.                                  *
      *  AR1046263 - RE3662 contains a field ACKEY still defined with *
      *              18 CHAR not the new 24 (Child:AR1046264)         *
      *  220323 - Retail Capitalisation and Income/Expense postings   *
      *           difference. Externalise SR/ZICD.                    *
      *         - Applied for 259032.                                 *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CRE083AY - COB Restructure - RE COB Optimisation Phase 1     *
      *  AR833959 - REC6203 on DEQW                                   *
      *  AR851468 - No tax when CR interest posted on alternate       *
      *             account (Child:AR851469)                          *
      *  AR813832 - Missing postings on main and second tax accounts  *
      *             (Child:AR813833)                                  *
      *  AR823701 - Incorrect calculated Debit interest for Account   *
      *             with Tiered and Threshold                         *
      *  CER049 - Stamp Tax (Recompile)                               *
      *  CER055 - Penalty Interest on Exceeding Overdraft Limit       *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,REH00008                                 *
      *             WNCPYSRC,REH00009                                 *
      *             WNCPYSRC,REH00010                                 *
      *             WNCPYSRC,REH00011                                 *
      *             WNCPYSRC,REH00012                                 *
      *             WNCPYSRC,REH00013                                 *
      *             WNCPYSRC,REH00014                                 *
      *  AR750273C - Components failed due to closed customer         *
      *              (Child: AR750274)                                *
      *  AR782377 - Retail account's income not reflected on Tax      *
      *             Self-Declaration Statement                        *
      *  AR744574 - Oustanding Interest/charges Enquiry shows         *
      *             incorrect history balance. Moved update of Tax to *
      *             WHISB same as in CAIC.                            *
      *             (Child: AR744575)                                 *
      *  AR749044 - Manual interest adjustment did reverse threshold  *
      *             utilized on retail account. (Child: AR749045)     *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *         - LT049 REC62N-00001 component failed.                *
      *  BUG26873 - Threshold limit utilization not posted to the     *
      *             member account (partly posted to the main joint   *
      *             acct and the other part unposted) based on limit  *
      *             utilization enquiry                               *
      *  BUG26839 - JA1_Threshold limit of the main joint customer was*
      *             utilized by the member                            *
      *  BUG26767 - REC62N 00001                                      *
      *  BUG26754 - Understatement of "Total Tax" (Overstatement of   *
      *             "Net Interest Earned") reflected on the Limit     *
      *             Utilisation Enquiry, first screen                 *
      *  BUG26537 - Check for feature when calling AOCTTXR0           *
      *  BUG26037B - Components DLC0606B seq 00001 and REC62N seq     *
      *              00001 failed in COB                              *
      *  BUG26324 - SDC200205 00001 and 00002                         *
      *           - Applied fix 26312                                 *
      *  BUG26312 - SDC200205 00001 & 00002                           *
      *  BUG25533 - Non Generation of Withholding Tax per Federal     *
      *             State Report during Input Cycle and after COB     *
      *             (Applied BUG24714 fix)                            *
      *  BUG24714 - Non Generation of Withholding Tax per Federal     *
      *             State Report during Input Cycle and after COB     *
      *  BUG25942 - Incorrect taxes on joint account w/o members      *
      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
      *  BUG25233 - Secondary tax is being computed on taxable        *
      *             non-resident customer                             *
      *  BUG24768 - Limit Util Enq's first screen should include      *
      *             third tax                                         *
      *  BUG24630A - In MM and Retail Interest Calculation Threshold  *
      *              is not being Deducted                            *
      *  BUG24379 - Inconsitencies in decimal places for 3rd Tax and  *
      *             Totals in Annual Tax Deducted Stmt                *
      *  BUG24051 - Incorrect Threshold Utilisation Postings          *
      *  BUG23732-Joint Account threshold                             *
      *  BUG23932A - Base currency amount conversion is incorrect     *
      *  CER054 - German Features - Church Tax                        *
      *  BUG23931 - Int earned upto threshold figure incorrect on CCY *
      *  BUG23932 - Problems with customer income due to fix by       *
      *             BUG23310A                                         *
      *  BUG23123B - Inaccurate Dates are being printed               *
      *  BUG23310A - SD000772 does not recalculate backdated amounts  *
      *  BUG23310 - SD000772 does not recalculate backdated amounts   *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *  BUG23309 - OSIC showing difference between histoy and ledger *
      *             Apply fix 239687 and 236714                       *
      *  BUG23139- Populate the value of the field TITOUT(Utilisation)*
      *            from base currency instead of original currency    *
      *  BUG23009A- Seconday Tax Duducted from Net Interest Amount    *
      *             in Tax Ccy                                        *
      *  BUG22911 - Changes for Correct Tax Calculation               *
      *  CER048 - German Features - Taxes                             *
      *  CER016 - German Interest Calculation: Upgarde of FGE059      *
      *           to Midas Plus                                       *
      *  CDL081 - Tiered withholding tax rounding upgrade             *
      *  260297A- Incorrect interest calculation w/ calc basis 6.     *
      *           Recompile using the correct src for ZICDREZ2.       *
      *  CSC042 - COB performance fixes.                              *
      *           Cache the currency details. RZB sofia calls AOCURRR**
      *           more than 1 million times                           *
      *  BUG14933 - Error in checking switchable feature CSW207       *
      *             (Recompile)                                       *
      *  BUG12930 - Change the length of data area CBTASKSP to 10     *
      *             characters. (Recompile)                           *
      *  CDL013 - Tiered Withholding Tax                              *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  236061 - No EU tax posted for demand capitalisation          *
      *  235875 - Need to calculate EU tax on CR interest adjustments *
      *  235329 - No EU tax should be posted when no interest posted  *
      *           (Eg when interest below minimum)                    *
      *  234870 - Several error in EU tax management                  *
      *  234656 - EU Tax should not be calculated if it is less than  *
      *           the local tax.                                      *
      *  234628 - No EU tax have been calculated on Interest          *
      *           Capitalisation.                                     *
      *  234003 - No tax calculated on interest for retail a/c.       *
      *  233564 - Tax rate not output in SDCSINPD                     *
      *  233563 - Accrued interest incorrect                          *
      *  232543 - Fix to CGL031 (Recompile)                           *
      *  CGL035 - EUSD Upgrade to MidasPlus                           *
      *  CGL031 - Taxation on Savings Income                          *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  182452 - Corrected the processing of interest type 03/04.    *
      *  CDE002 - Revenue Analysis - Recompiled due to changes in     *
      *           PF/RECCYD.                                          *
     F*  179181 - Fix 108931 incomplete - values are overwritten      *
     F*           prior to update of REIACD                           *
     F*  153001 - A/c failed to close because minimum charge posted   *
     F*           so balance was not zero. At closure capitalisation  *
     F*           post actual charges, ie. do not apply rebate or     *
     F*           minimum/maximum charge.                             *
     F*  131447 - If a non-chargeable a/c is made chargeable, only    *
     F*           charges since last cap. will be posted; charges of  *
     F*           backvalued postings into a previous period will     *
     F*           also be included.                                   *
     F*  130468 - BRT not deducted from CR interest adjustments.      *
     F*           NB. 088932 amended to include BRT on adjs.          *
     F*  123519 - Interest posted to suspense instead of alternative  *
     F*           a/c when full a/c no. used for alt a/c. Caused by   *
     F*           alt. a/c branch code being overwritten with blanks. *
     F*  091680 - If a manual adjustment is input for the same day as *
     F*           a/c closure is requested, the adjustment is ignored.*
     F*           Adjustment must be retrieved from the REHISPD rec.  *
     F*           (already created by RE3661), output to the REHISPS  *
     F*           rec., then zeroised on REHISPD to avoid being       *
     F*           carried forward if a/c fails to close.              *
     F*  103460 - Only charge interest if the balance exceeds the     *
     F*           initial threshhold.                                 *
     F*  092245 - All accounts after first BRT-liable account have    *
     F*           BRT deducted.  Fix is to reset BRT indicator.       *
     F*  100086 - VALD = 0 FOR DUMMY POSTINGS.                        *
     F*  121125 - Generated adjustment still shows on OSIC (with      *
     F*           opposite sign) after being posted. Caused by error  *
     F*           in application of 085250 to core; CSGADI & CSGACI   *
     F*           should be output to RECAPM, not REHISPS.            *
     F*  105489 - Generated Adjustement for an A/C which currently has*
     F*           an alternative a/c but did not have one at the time *
     F*           of the original cap., was posted to suspence.       *
     F*  102667 - If charges to be capitalised are below minimum or   *
     F*           above maximum, history bal. is updated immediately, *
     F*           regardless of the cap. value date, causing the a/c  *
     F*           to appear on the discrepancy report RE3810.         *
     F*  108867 - Charge amount in NRCA on REIACD for non-chargeable  *
     F*           a/c; zeroise NRCA & RCA if CHGT is 0.               *
     F*           Also apply 113053 to prevent corruption of charges. *
     F*  088932 - Incorrect interest accrual amount calculated if     *
     F*           tomorrow is non-working day and account is capital'd*
     F*           today, because when the pgm accrues interest on a/c *
     F*           balance + interest to be capitalised, it does not   *
     F*           deduct BRT on the interest first. Fix is to deduct  *
     F*           BRT when calculating interest to be accrued.        *
     F*           Note - program must output the full accrual amount  *
     F*           to REHISPS; the BRT amount is deducted later.       *
     F*  108931 - Charges corrupted; total incorrectly carried over   *
     F*           to position record for cap. date (last day accruals)*
     F*           and then total on cap. record corrupted when int.   *
     F*           adj. generated the next day. Apply 113053.          *
     F*           Charge amount capitalised too big, causing system   *
     F*           to generate negative charge to correct at next cap. *
     F*           Caused by corruption of charges when interest adj.  *
     F*           has been generated; charges from position record on *
     F*           cap. value date overwrite charges on cap. record.   *
     F*  101827 - Charges rebate applied to a/c with debit minimum    *
     F*           balance.                                            *
     F*  CRE001 - Overdraft Interest Calculations:                    *
     F*         - Include Add'l Overdraft Rate in the calculation     *
     F*           of DR interest accrued to date.                     *
     F*  099090 - If DR & CR cap. dates are different but both sides  *
     F*           capitalise during COB, the accrued interest on      *
     F*           REACR for the earlier cap. does not include cap'd   *
     F*           interest, which causes incorrect accrual postings.  *
     F*  114049 - URGENT FIX                                          *
     F*           One days accrual omitted at the end of January 97.  *
     F*           This relates to 086372 which perhaps inadvertantly  *
     F*           changed the Monthly accruals to be up to the end of *
     F*           each month - effectively first day accruals. The    *
     F*           rest of the system (capitalisation accruals and     *
     F*           postings) accrues up to one day short - last day    *
     F*           accruals. 086372 was incorporated into core but     *
     F*           should have been LOCAL only. This fix removes       *
     F*           086372 from core.                                   *
     F*  089057 - WRONG FIELDS USED FOR ADJUSTMENTD TO ACCRUED INT.   *
     F*  CCB003 - COB Performance Enhancements - Task Split           *
     F*  S01408 - Addition of Core Hook RE3662OOP1                    *
     F*           Addition of Core Hook RE3662EEP1                    *
     F*  S01408 - Core hook RE3662CP37 added                          *
     F*         - Core hook RE3662CP36 added                          *
     F*         - Core hook RE3662CP35 added                          *
     F*         - Core hook RE3662CP34 added                          *
     F*         - Core hook RE3662CP33 added                          *
     F*         - Core hook RE3662CP32 added                          *
     F*         - Core hook RE3662CP31 added                          *
     F*         - Core hook RE3662CP30 added                          *
     F*         - Core hook RE3662CP29 added                          *
     F*         - Core hook RE3662CP28 added                          *
     F*         - Core hook RE3662CP27 added                          *
     F*         - Core hook RE3662CP26 added                          *
     F*         - Core hook RE3662CP25 added                          *
     F*         - Core hook RE3662CP24 added                          *
     F*         - Core hook RE3662CP23 added                          *
     F*         - Core hook RE3662CP22 added                          *
     F*         - Core hook RE3662CP21 added                          *
     F*         - Core hook RE3662CP20 added                          *
     F*         - Core hook RE3662CP19 added                          *
     F*         - Core hook RE3662CP18 added                          *
     F*         - Core hook RE3662CP17 added                          *
     F*         - Core hook RE3662CP16 added                          *
     F*         - Core hook RE3662CP15 added                          *
     F*         - Core hook RE3662CP14 added                          *
     F*         - Core hook RE3662IIP4 added                          *
     F*         - Core hook RE3662IIP3 added                          *
     F*  S01408 - Core hook RE3662CP13 added                          *
     F*  086372 - Interest calculated incorrectly if bank is on last  *
     F*           day accruals and monthly postings.                  *
     F*  S01408 - Core hook RE3662CP12 added                          *
     F*  S01408 - Core hook RE3662CP11 added                          *
     F*           Core hook RE3662CP10 added                          *
     F*           Core hook RE3662CCP9 added                          *
     F*           Core hook RE3662CCP8 added                          *
     F*           Core hook RE3662CCP7 added                          *
     F*           Core hook RE3662CCP6 added                          *
     F*           Core hook RE3662CCP5 added                          *
     F*           Core hook RE3662CCP4 added                          *
     F*           Core hook RE3662CCP3 added                          *
     F*           Core hook RE3662CCP2 added                          *
     F*           Core hook RE3662CCP1 added                          *
     F*           Core hook RE3662FFP1 added                          *
     F*           Core hook RE3662IIP2 added                          *
     F*           Core hook RE3662IIP1 added                          *
     F*  085250 - Interest adjustments are appearing on the capital'n *
     F*           report but are not updating the interest balance to *
     F*           be posted - amend program to allow total generated  *
     F*           adjustment to appear on stmt.                       *
     F*         - Adjustment of interest not shown on interest        *
     F*           statement when they are generated to an alternate   *
     F*           account or to suspense.  Fix is to generate a       *
     F*           dummy posting to REHPOSPP for use by reporting      *
     F*           and enquiry programs.                               *
     F*  088029 - Field 'RESULT' Not Correctly Formatted When         *
     F*           American Date Format is Used.                       *
     F*  085464 - After 085330, for Unsuccessful Close of A/c Right   *
     F*           After Cap. Date for 1st Day Accrual, the Interest   *
     F*           Cap. Amount was Still Reversed.                     *
     F*  (81153)- Interest from date of history rec. before cap. rec. *
     F*           upto cap. date not calculated when a/c closed the   *
     F*           day after capitalisation and system is on 1st day   *
     F*           accruals. Amend fix 072865.                         *
     F*  085330 - Apply 72865 and 70989 to Prevent Duplicate Record   *
     F*  (72865)- Further to 070989 - avoid dup cap record if 1st day *
     F*           accruals and a/c closed after capitalisation;       *
     F*           do not write cap rec if record read is cap rec.     *
     F*  (70989)- Avoid Dup Record if LDAC *NO and Closure Day After  *
     F*           Capitalisation.                                     *
     F*  075197 - Threshhold interest produces no accrual if balance  *
     F*           is above the highest level and all levels used.     *
     F*  S01408 - Hook RE3662CPD1 added.                              *
     F*           Hook RE3662CPD2 added.                              *
     F*           Hook RE3662CPD3 added.                              *
     F*           Hook RE3662CPD4 added.                              *
     F*           Hook RE3662CPD5 added.                              *
     F*           Hook RE3662CPD6 added.                              *
     F*  074578 - Tiered interest not rounded correctly               *
     F*  071053 - Capitalisations due today are not actioned when the *
     F*           branch code of the account is alphanumeric as the   *
     F*           file pointer is set to the wrong position in file.  *
     F*  057048 - Problem with account closure if first day accrual   *
     F*  067706 - Interest calculation review for interest type 3&4   *
     F*  063793 - Minimum Monthly Balance Method does not work. For   *
     F*           interest types 03 & 04, the total interest is       *
     F*           always zero.                                        *
     F*  054346 - Capitalisation missing for Retail accounts          *
     F*  045125 - To avoid discrepancies with Linked accounts         *
     F*  S01413 - Retail 3 Incorporation                              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*REHISBN*IF**E           K        DISK                              CCB003
     FREHISBN IF  E           K        DISK                                                 CRE083AY
     F            REHISPPF                          KRENAMEMAINF                            CRE083AY
     F***REACNAPDUE**E        K           DISK         KCOMIT                        CCB003 CRE083AY
     F**********  REHISPPF                          KRENAMEREHISPBF                         CRE083AY
     FREACNAPDUF  E           K        DISK         KCOMIT            UC                    CRE083AY
     F            REACNAD0                          KRENAMEDRIVEF                           CRE083AY
     FACCNT   IF  E           K        DISK                               088932
     F            ACCNTAAF                          KIGNORE               088932
     F            ACCNTACF                          KIGNORE               088932
     FSDBRTDL1IF  E           K        DISK                               088932
     FACCRACJ IF  E           K        DISK
     FRELINKL1IF  E           K        DISK
     FREHRCJ  IF  E           K        DISK
     FREHRDJ  IF  E           K        DISK
     FREHRCJH IF  E           K        DISK                                                 AR836982
     FREHRDJH IF  E           K        DISK                                                 AR836982
     FRECRG   IF  E           K        DISK
     F            RECRGAF                           KIGNORE
     F            RECRGZF                           KIGNORE
     FRECCY   IF  E           K        DISK
     F            RECCYAF                           KIGNORE
     F            RECCYZF                           KIGNORE
     FSDSTAXPDIF  E                    DISK                                                   234656
      *                                                                                       CGL031
     FSDJACCLBIF  E           K        DISK                                                   CGL031
      ** Midas SD Joint Account Member Details - Retrieve Index                               CGL031
      *                                                                                       CGL031
     FSDACUSL1IF  E           K        DISK                                                   CGL031
      ** Midas SD Additional Customer Details - Retrieve Index                                CGL031
      *                                                                                       CGL031
     FSDNAHOL1IF  E           K        DISK                                                   CGL031
      ** Midas SD Non-Account Holders - Retrieve Index                                        CGL031
      *                                                                                       CGL031
      *                                                                                       CDL013
     FACCNTBY0IF  E           K        DISK                           UC                      CDL013
      ** Account Details extension file                                                       CDL013
      *                                                                                       CDL013
     FSDSTAAL1IF  E           K        DISK                           UC                      CDL013
      ** Withholding Tax ICD extension file                                                   CDL013
      *                                                                                       CDL013
     FSDSTAXL1IF  E           K        DISK                           UC                      CDL013
     F            SDSTAXD0                          KRENAMESDSTAXDX                           CDL013
      ** Withholding Tax ICD control record                                                   CDL013
     FREHISBL UF  E           K        DISK
     F            REHISPPF                          KRENAMEREHISBF
     F                                              KCOMIT                CCB003
     F                                              KINFDS REBDS
     F                                              KINFSR REBSR
     FREHISL  UF  E           K        DISK
     F            REHISPMF                          KIGNORE
     F                                              KCOMIT                CCB003
     F                                              KINFDS REHDS
     F                                              KINFSR REHSR
     FREHISMDLUF  E           K        DISK                      A        067706
     F                                              KCOMIT                CCB003
     F                                              KINFDS REMDS          067706
     F                                              KINFSR REMSR          067706
     FREHISMCLUF  E           K        DISK                      A        067706
     F            REHISPMF                          KRENAMEREHISPCF       067706
     F                                              KCOMIT                CCB003
     F                                              KINFDS REMCS          067706
     F                                              KINFSR RECSR          067706
     F**REHISML UF  E           K        DISK                      A      067706
     F**                                              KINFDS REMDS        067706
     F**                                              KINFSR REMSR        067706
     FREHISDL UF  E           K        DISK                      A
     F            REHISPPF                          KRENAMEREHISPDF
     F                                              KCOMIT                CCB003
     F                                              KINFDS REDDS
     F                                              KINFSR REDSR
     FREACR   UF  E           K        DISK
     F                                              KCOMIT                CCB003
     F                                              KINFDS READS
     F                                              KINFSR REASR
     F            REACRAF                           KIGNORE
     F            REACRZF                           KIGNORE
     FREIAC   UF  E           K        DISK
     F                                              KCOMIT                CCB003
     F                                              KINFDS REIDS
     F                                              KINFSR REISR
     F            REIACAF                           KIGNORE
     F            REIACZF                           KIGNORE
     F**SDCSINL0UF  E         K        DISK                                       BUG23310 BUG23310A
     F**********                                    KCOMIT                        BUG23310 BUG23310A
     F**********  SDCSIND0                          KRENAMESDCSINDL               BUG23310 BUG23310A
      *                                                                                       CGL031
     FSDCSINPDO   E                    DISK         KCOMIT                                    CGL031
      ** Midas SD Customer Income                                                             CGL031
      *                                                                                       CGL031
     FREHPOSPPIF  E                    DISK                      A        085250
      *                                                                                    BUG23310A
     F***REHPOPL IF  E        K        DISK                                       BUG23310A BUG23932
     F**********  REHPOSPF                          KRENAMEREHPOSPL               BUG23310A BUG23932
     F*REHISPS*O***F*****329            DISK                      A       CRE001
     F***REHISPS O   F     353            DISK                      A                  CRE001 CGL029
     FREHISPS O   F     426            DISK                      A                            CGL029
     F                                              KCOMIT                CCB003
     F*RECAPM**O***F*****311            DISK                      A       CRE001
     F***RECAPM* O   F     319            DISK                      A                  CRE001 CGL029
     FRECAPM  O   F     392            DISK                      A                            CGL029
     F                                              KCOMIT                CCB003
     F*RE3662AUO***E                    PRINTER      KINFDS SPOOLU        CCB003
     FRE3662AUO   E                    PRINTER      KINFDS SPOOLU     UC  CCB003
      *                                                                   CCB003
     F*RE3662P1O***E             01     PRINTER      KINFDS SPOOL      UC CCB003
     F*
     F*                                                                   S01408
     FSDACTXL1IF  E           K        DISK                                                BUG26037B
      ** Customer by Country of Tax details                                                BUG26037B
      *                                                                                    BUG26037B
     FREODHSL0IF  E           K        DISK                                                   CER055
     F***SDINPHL2UF  E           K        DISK                                       CER048 BUG23732
      *                                                                                       CER048
      ** Midas SD Interest Payment Hist File by Cust/Branch file                              CER048
      *                                                                                       CER048
     FGLACNTL4IF  E           K        DISK                                                   CRE090
     F/COPY WNCPYSRC,RE3662FFP1                                           S01408
     F*                                                                   S01408
      *****************************************************************   CCB003
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*       30       Multibranching Indicator                       *
     F*       40       LOKUP Indicator in ZIC02 Subroutine            *
     F*       50       End-of-file / Beginning-of-file Ind - REHISL   *
     F*       51       End-of-file / Beginning-of-file Ind - REHRDJ   *
     F*       52       End-of-file / Beginning-of-file Ind - REHRCJ   *
     F*       53       End-of-file / Beginning-of-file Ind - REACR    *
     F*       54       Overdraft Interest Calculation feature is on   *   CRE001
      *       55       CHAIN to file SDSTAXPD                         *                       234656
     F*       60       Record found on REHISL file                    *
     F*       88       Show status on DB Error report                 *
     F*       98       Date format flag                               *
     F*       99       Error Indicator                                *
     F*                                                               *
     F*       U7       Database Error                                 *
     F*       U8       Database Error                                 *
     F*                                                               *
     F*       L1       Change of Branch                               *
     F*       LR       End of Program                                 *
     F*                                                               *
     F*****************************************************************
      /SPACE 3
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  CAPI   - Capitalisation processing                           *
     F*  CHGPR  - Charges processing                                  *
     F*  CREPR  - Credit capitalisation processing                    *
     F*  CRINIT - Credit rate fields init processing                  *
     F*  CRSET  - Setup work credit fields w/ fields read processing  *
     F*  DATEIN - Date init processing                                *
     F*  DBSR   - Database error handling                             *
     F*  DEBPR  - Debit capitalisation processing                     *
     F*  DETPR  - Detail processing                                   *
     F*  DRCRPR - Debit and credit capitalisation processing          *
     F*  DRINIT - Debit rate fields init processing                   *
     F*  DRSET  - Setup work debit fields with fields read processing *
     F*  FIRST  - First cycle                                         *
     F*  INITPR - Work fields init processing                         *
     F*  INTCAP - Interest capitalisation processing                  *
     F*  INTSR  - Interest calculation between two dates processing   *
     F*  ITYPIN - Interest type 03 & 04 fields init processing        *
     F*  MAIN   - Main processing                                     *
     F*  MRECD  - Process file REHISM for debit int. type 03 & 04     *
     F*  MRECC  - Process file REHISM for credit int. type 03 & 04    *
     F*  OUTPOS - New interest posting record creation processing     *
     F*  POSIPR - Position record processing                          *
     F*  POSPR  - Create/update next position recd w/ adj. int. proc. *
     F*  PRCC34 - Additional processing for credit interest type > 2  *
     F*  PRCD34 - Additional processing for debit interest type > 2   *
     F*  FINSR  - Reacr file update processing                        *
     F*  REASR  - Reacr file exception/error handling                 *
     F*  REACSR - REACNAPD file exception/error handling              *                     CRE083AY
     F*  REDSR  - Rehisdl file exception/error handling               *
     F*  REMSR  - Rehisml file exception/error handling               *
     F*  REHSR  - Rehisl file exception/error handling                *
     F*  SCRPR  - Credit capitalisation record preparation processing *
     F*  SDRPR  - Debit capitalisation record preparation processing  *
     F*  SETUP  - Capitalisation record preparation processing        *
     F*  TOTAC  - Total account processing                            *
     F***TOTAL**-*End*processing                                      *   CCB003
     F*  UPDPTR - Update REHISUPD with Start Key for restart          *                     CRE083AY
     F*  WKSET  - Wrk flds reset after creation of position recd proc *
     F*  ZICCR  - Interest calc. for credit int type < 3 processing   *
     F*  ZICC34 - Interest calc. for credit int type > 2 proc         *
     F*  ZICD   - Find number of days to calculate interest according *
     F*           to calculation basis processing                     *
     F*  ZICDR  - Interest calc. for debit int type < 3 processing    *
     F*  ZICD34 - Interest calc. for debit int type > 2 processing    *
     F*  ZIC00  - Interest calculation (type=00) processing           *
     F*  ZIC01  - Interest calculation (type=01) processing           *
     F*  ZIC02  - Interest calculation (type=02) processing           *
     F*  ZDATE1 - To convert date format to day number                *
     F*  ZDATE2 - To convert day number to date format                *
      *  *PSSR  - Handles Abnormal Error Conditions                   *                       CER016
     F*                                                               *
     F*****************************************************************
     E/EJECT
      *****************************************************************   CCB003
     E*                                                                   S01408
     E/COPY WNCPYSRC,RE3662EEP1                                           S01408
     E*                                                                   S01408
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZHOLE                                                                      CRE090
     E/COPY ZSRSRC,ZDATE9Z1                                                                   CGL031
     E/COPY ZSRSRC,ZPOWERZ1                                                                   CGL031
      *                                                                   CCB003
     E                    CPY@    1   1 80               COPYRIGHT
     E                    MSG     1   4 29                                085250
     E                    ZFMD   12  12  2                                                    CRE090
     E**********          ZIR        12 11 7             ZIC. INT.RATES   075197
     E**********          ZIRD       12 11 7             ZIC. INT.RATES   075197
     E**********          ZIRC       12 11 7             ZIC. INT.RATES   075197
     E**********          ZIB        12 15 0A            ZIC. INT.BALANCES075197
     E**********          ZIBD       12 15 0             ZIC. INT.BALANCES075197
     E**********          ZIBC       12 15 0             ZIC. INT.BALANCES075197
     E**********          ZIN        12 13 0             ZIC. INT.CALC    075197
     E                    ZIR        11 11 7             ZIC. INT.RATES   075197
     E                    ZIRD       11 11 7             ZIC. INT.RATES   075197
     E                    ZIRC       11 11 7             ZIC. INT.RATES   075197
     E                    ZIB        11 15 0A            ZIC. INT.BALANCES075197
     E                    ZIBD       11 15 0             ZIC. INT.BALANCES075197
     E                    ZIBC       11 15 0             ZIC. INT.BALANCES075197
     E                    ZIN        11 13 0             ZIC. INT.CALC    075197
     E**********          ZIN1       11 18 5             ZIC. INT.CALC                 074578 220323
     E                    ZIN1       11 30 9             ZIC. INT.CALC                        220323
     E**********          ZIA        12 15 0             ZIC. WORK ARRAY  075197
     E**********          ZIA1       12 15 5             ZIC. WORK ARRAY  075197
     E                    ZIA        11 15 0             ZIC. WORK ARRAY  075197
     E**********          ZIA1       11 15 5             ZIC. WORK ARRAY               075197 220323
     E                    ZIA1       11 30 9             ZIC. WORK ARRAY                      220323
     E                    CURR      150  3               Currency                             CSC042
     E                    #CDP      150  1 0             Decimal Places                       CSC042
     E                    #CMD      150  1               Mult/Div Ind                         CSC042
     E                    #CSR      150 13 8             Spot Rate                            CSC042
     E                    WZIB       11 15 0A                                                 CER055
      *                                                                                     CRE083AY
     E                    ##AC      300 10               Account Codes                      CRE083AY
     E                    ##AD      300 13 0             A5MISU                             CRE083AY
     E                    #LRU      300  4 0             Least Recent RECCY                 CRE083AY
     E                    #LOC       20  3               Location Code                      CRE083AY
     E                    #LOD       20101               SDLOCN                             CRE083AY
     E                    #LR2       20  4 0             Least Recent LOCN                  CRE083AY
     E                    ##CC      200 12               Currency Code                      CRE083AY
     E                    ##CD      200 52               Details                            CRE083AY
      *                                                                   CCB003
      *****************************************************************   CCB003
     I/EJECT
      *****************************************************************   CCB003
     I*
     I***REHISPBF                                                                           CRE083AY
     IMAINF                                                                                 CRE083AY
     I*
     I***RENAME*REHISPBF*FORMAT*FIELDS*-*REHISBN*FILE                     CCB003
     I***RENAME*REHISPBF*FORMAT*FIELDS*-*REACNAPD*FILE*****************              CCB003 CRE083AY
      ** Rename MAINF Format Fields - REHISBN File                                          CRE083AY
     I*
     I              RECI                            BRECI
     I              BRCA                            BBRCA
     I              CNUM                            BCNUM
     I              CCY                             BCCY
     I              ACOD                            BACOD
     I              ACSQ                            BACSQ
     I              HISD                            BHISD
     I              HISB                            BHISB
     I              MNBL                            BMNBL
     I              CHGAR                           BCHGAR
     I              TCHGAR                          BTHGAR
     I              CHGAN                           BCHGAN
     I              TCHGAN                          BTHGAN
     I              DMVT                            BDMVT
     I              DICT                            BDICT
     I              DRCB                            BDRCB
     I              DRIR                            BDRIR
     I              DRCD                            BDRCD
     I              DAID                            BDAID
     I              MADI                            BMADI
     I              TMADI                           BTMADI
     I              PDID                            BPDID
     I              DMINT                           BDMINT
     I              CMVT                            BCMVT
     I              CICT                            BCICT
     I              CRCB                            BCRCB
     I              CRIR                            BCRIR
     I              CRCD                            BCRCD
     I              CAID                            BCAID
     I              MACI                            BMACI
     I              TMACI                           BTMACI
     I              PCID                            BPCID
     I              CMINT                           BCMINT
     I              DICI                            BDICI
     I              CICI                            BCICI
     I              DRCI                            BDRCI
     I              CRCI                            BCRCI
     I              VDTC                            BVDTC
     I              ADTY                            BADTY
     I              ALTI                            BALTI
     I              MNBCP                           BMNBCP
     I              LGID                            BLGID
     I              VALL                            BVALL
     I              LINK                            BLINK
     I              AODR                            BAODR                 CRE001
     I              ODRL                            BODRL                 CRE001
     I              ODLI                            BODLI                 CRE001
     I              ODIA                            BODIA                 CRE001
     IREHPOSPF                                                            085250
     I*                                                                   085250
     I** RENAME REHPOSPP FORMAT FIELDS - REHPOSPPF                        085250
     I*                                                                   085250
     I              RECI                            PRECI                 085250
     I              BRCA                            BBRCA                 085250
     I              CNUM                            BCNUM                 085250
     I              CCY                             BCCY                  085250
     I              ACOD                            BACOD                 085250
     I              ACSQ                            BACSQ                 085250
     I              PSTD                            RUND                  085250
     I              HISD                            SHISD                 085250
     I              CHGA                            XCHGA                 085250
     I              VALD                            XVALD                 085250
     I***REHPOSPL                                                                 BUG23310A BUG23932
     I**********    RECI                            QRECI                         BUG23310A BUG23932
     I**********    CNUM                            QCNUM                         BUG23310A BUG23932
     I**********    CCY                             QCCY                          BUG23310A BUG23932
     I**********    ACODQQ                          QACODQ                        BUG23310A BUG23932
     I**********    ACSQ                            LACSQ                         BUG23310A BUG23932
     I**********    ZZ006                           QZZ006                        BUG23310A BUG23932
     I**********    ACNO                            QACNO                         BUG23310A BUG23932
     I**********    PSTD                            QPSTD                         BUG23310A BUG23932
     I**********    VALD                            QVALD                         BUG23310A BUG23932
     I**********    TRAT                            QTRAT                         BUG23310A BUG23932
     I**********    PNAR                            QPNAR                         BUG23310A BUG23932
     I**********    PSTA                            QPSTA                         BUG23310A BUG23932
     I**********    DRCR                            QDRCR                         BUG23310A BUG23932
     I**********    ASOC                            QASOC                         BUG23310A BUG23932
     I**********    CHQN                            QCHQN                         BUG23310A BUG23932
     I**********    SPOS                            QSPOS                         BUG23310A BUG23932
     I**********    BRCA                            QBRCA                         BUG23310A BUG23932
     I**********    RIND                            QRIND                         BUG23310A BUG23932
     I**********    REJC                            QREJC                         BUG23310A BUG23932
     I**********    DPMT                            QDPMT                         BUG23310A BUG23932
     I**********    RRNM                            QRRNM                         BUG23310A BUG23932
     I**********    ZZ009                           QZZ009                        BUG23310A BUG23932
     I**********    ATYP                            QATYP                         BUG23310A BUG23932
     I**********    ZZ002                           QZZ002                        BUG23310A BUG23932
     I**********    EXIN                            QEXIN                         BUG23310A BUG23932
     I**********    PRIN                            QPRIN                         BUG23310A BUG23932
     I**********    GETP                            QGETP                         BUG23310A BUG23932
     I**********    ACUM                            QACUM                         BUG23310A BUG23932
     I**********    ZZ022                           QZZ022                        BUG23310A BUG23932
     I**********    REBI                            QREBI                         BUG23310A BUG23932
     I**********    CHGA                            QCHGA                         BUG23310A BUG23932
     I**********    SWCR                            QSWCR                         BUG23310A BUG23932
     I**********    DLREF                           QDLREF                        BUG23310A BUG23932
     I**********    FACO                            QFACO                         BUG23310A BUG23932
     I**********    DBCNUM                          QBCNUM                        BUG23310A BUG23932
     I**********    PREF                            QPREF                         BUG23310A BUG23932
     I**********    FTAB                            QFTAB                         BUG23310A BUG23932
     I**********    FTAS                            QFTAS                         BUG23310A BUG23932
     I**********    FTACQQ                          QFTACQ                        BUG23310A BUG23932
     I**********    TURN                            QTURN                         BUG23310A BUG23932
     I**********    HISD                            QHISD                         BUG23310A BUG23932
     I**********    NITMS                           QNITMS                        BUG23310A BUG23932
     I**********    REACT                           QREACT                        BUG23310A BUG23932
     I**********    ACOD                            QACOD                         BUG23310A BUG23932
     I**********    FTAC                            QFTAC                         BUG23310A BUG23932
     I*
     IREHISPDF
     I*
     I** RENAME REHISPDF FORMAT FIELDS - REHISDL FILE
     I*
     I              RECI                            DRECI
     I              HISD                            DHISD
     I              HISB                            DHISB
     I              MNBL                            DMNBL
     I              CHGAR                           DCHGAR
     I              TCHGAR                          DTCHGR                108931
     I              CHGAN                           DCHGAN
     I              TCHGAN                          DTCHGN                108931
     I              DMVT                            DDMVT
     I              DRIR                            DDRIR
     I              DRCD                            DDRCD
     I              DAID                            DDAID
     I              MADI                            DMADI
     I              TMADI                           DTMADI
     I              PDID                            DPDID
     I              DMINT                           DDMINT
     I              CMVT                            DCMVT
     I              CRIR                            DCRIR
     I              CRCD                            DCRCD
     I              CAID                            DCAID
     I              MACI                            DMACI
     I              TMACI                           DTMACI
     I              PCID                            DPCID
     I              CMINT                           DCMINT
     I              DRCI                            DDRCI
     I              CRCI                            DCRCI
     I              MNBCP                           DMNBCP
     I              LGID                            DLGID
     I              VALL                            DVALL
     I              LINK                            DLINK
     I              DICT                            DDICT
     I              CICT                            DCICT
     I              DRCB                            DDRCB                 054346
     I              CRCB                            DCRCB                 054346
     I              AODR                            DAODR                 CRE001
     I              ODRL                            DODRL                 CRE001
     I              ODLI                            DODLI                 CRE001
     I              ODIA                            DODIA                 CRE001
     I*
     IREHISPPF
     I*
     I** RENAME REHISPPF FORMAT RECI - REHISL FILE
     I*
     I              RECI                            WRECI
     I*
     IREHISPSF
     I*
     I** RENAME REHISPSF FORMAT RECI - REHISL FILE
     I*
     I              RECI                            WRECI
     I              DRBR                            SDRBR                 123519
     I              CRBR                            SCRBR                 123519
     I              CHBR                            SCHBR                 123519
     I*
     IREHISPMF
     I*
     I** RENAME REHISPMF FORMAT FIELDS - REHISM FILE
     I*
     I              RECI                            MRECI
     I              BRCA                            MBRCA
     I              CNUM                            MCNUM
     I              CCY                             MCCY
     I              ACOD                            MACOD
     I              ACSQ                            MACSQ
     I              HISD                            MHISD
     I              MNBL                            MMNBL
     I****          DSDAT                           MPDID                 067706
     I****          CSDAT                           MPCID                 067706
     I              DINT                            MDINT
     I              CINT                            MCINT
     IREHISPCF                                                            067706
     I*                                                                   067706
     I** RENAME REHISPCF FORMAT FIELDS - REHISMCL FILE                    067706
     I*                                                                   067706
     I              RECI                            MRECI                 067706
     I              BRCA                            MBRCA                 067706
     I              CNUM                            MCNUM                 067706
     I              CCY                             MCCY                  067706
     I              ACOD                            MACOD                 067706
     I              ACSQ                            MACSQ                 067706
     I              HISD                            MHISD                 067706
     I              MNBL                            MMNBL                 067706
     I              DINT                            MDINT                 067706
     I              CINT                            MCINT                 067706
     IREHRCJF
     I*
     I** RENAME REHRCJF FORMAT FIELDS - REHRCJ FILE
     I*
     I              VALD                            RCVALD
     I              HISD                            RCHISD
     I              INTH                            INTHC
     I              RAT2                            CAT2                  067706
     I              RAT3                            CAT3                  067706
     I              BAL2                            CAL2                  067706
     I              BAL3                            CAL3                  067706
     I*
     IREHRCJFH                                                                              AR836982
     I              VALD                            RCVALD                                  AR836982
     I              HISD                            RCHISD                                  AR836982
     I              INTH                            INTHC                                   AR836982
     I              RAT2                            CAT2                                    AR836982
     I              RAT3                            CAT3                                    AR836982
     I              BAL2                            CAL2                                    AR836982
     I              BAL3                            CAL3                                    AR836982
     I*                                                                                     AR836982
     IREHRDJF
     I*
     I** RENAME REHRDJF FORMAT FIELDS - REHRDJ FILE
     I*
     I              VALD                            RDVALD
     I              HISD                            RDHISD
     I              INTH                            INTHD
     I*                                                                                     AR836982
     IREHRDJFH                                                                              AR836982
     I              VALD                            RDVALD                                  AR836982
     I              HISD                            RDHISD                                  AR836982
     I              INTH                            INTHD                                   AR836982
     I*
     IACCRACJF
     I*
     I** RENAME ACCRACJF FORMAT FIELDS - ACCRACJ FILE
     I*
     I              CCY                             ACCCCY
     I              DRCD                            ADRCD
     I              DAIC                            ADAIC
     I              CRCD                            ACRCD
     I              CAIC                            ACAIC
     I              DICT                            ADICT
     I              CICT                            ACICT
     I              HISB                            AHISB
     I*
     I*
     IREACRDF
     I*
     I** RENAME REACRDF FORMAT FIELDS - REACR FILE
     I*
     I              MNBL                            RMNBL
     I              LCD                             RLCD
     I              CHTP                            RCHTP
     I              DAIC1                           RDAIC
     I              MADI                            RMADI
     I              GADI                            RGADI
     I              CAIC1                           RCAIC
     I              MACI                            RMACI
     I              GACI                            RGACI
     I              HISB                            RHISB
     I              BFDR                            RBFDR
     I              BFCR                            RBFCR
     IREIACDF
     I*
     I** RENAME REIACDF FORMAT FIELDS - REIAC FILE
     I*
     I              NRCA                            RNRCA
     I              RCA                             RRCA
     I*
     IRECRGDF
     I*
     I** RENAME RECRGDF FORMAT - RECRGD FILE
     I*
     I              RECI                            GRECI
     I              ACOD                            GACOD
     I*                                                                   088932
     I** Rename ACCNTABF format fields - ACCNT file                       088932
     I*                                                                   088932
     IACCNTABF                                                            088932
     I              RECI                            AARECI                088932
     I              ACNO                            AAACNO                088932
     I              CNUM                            AACNUM                088932
     I              CCY                             AACCY                 088932
     I              ACOD                            AAACOD                088932
     I              ACSQ                            AAACSQ                088932
     I              ATYP                            AAATYP                088932
     I              BRCA                            AABRCA                088932
     I              RRNM                            AARRNM                088932
     I              DRIS                            AADRIS                088932
     I              DRCD                            AADRCD                088932
     I              DAIC                            AADAIC                088932
     I              MADI                            AAMADI                088932
     I              GADI                            AAGADI                088932
     I              CRIS                            AACRIS                088932
     I              CRCD                            AACRCD                088932
     I              CAIC                            AACAIC                088932
     I              MACI                            AAMACI                088932
     I              GACI                            AAGACI                088932
     I*                                                                                       CDL013
     IACCNTBD0                                                                                CDL013
     I*                                                                                       CDL013
     I** RENAME ACCNTBY0 FORMAT ZZ100                                                         CDL013
     I*                                                                                       CDL013
     I              ZZ100                           ZZ101                                     CDL013
      *                                                                                       CDL013
     IREODHSD0                                                                                CER055
     I              BRCA                            RHBRCA                                    CER055
     I              CNUM                            RHCNUM                                    CER055
     I              CCY                             RHCCY                                     CER055
     I              ACODQQ                          RHACQQ                                    CER055
     I              ACSQ                            RHACSQ                                    CER055
     I              ACNO                            RHACNO                                    CER055
     I              HISD                            RHHISD                                    CER055
     I              PSTD                            RHPSTD                                    CER055
     I              PCSI                            RHPCSI                                    CER055
     I              ODLN                            RHODLN                                    CER055
     I              ODED                            RHODED                                    CER055
     I              PODL                            RHPODL                                    CER055
     I              POLE                            RHPOLE                                    CER055
     I              ACOD                            RHACOD                                    CER055
      *                                                                   S01408
     I/COPY WNCPYSRC,RE3662IIP3                                           S01408
      *                                                                   S01408
     I*
     I** DATA STRUCTURE FOR RPG ERROR HANDLING
     I*
     IREBDS       DS
     I                                     *STATUS  STSREB
     IREHDS       DS
     I                                     *STATUS  STSREH
     IREMDS       DS
     I                                     *STATUS  STSREM
     IREMCS       DS                                                      067706
     I                                     *STATUS  STSREC                067706
     IREDDS       DS
     I                                     *STATUS  STSRED
     IREADS       DS
     I                                     *STATUS  STSREA
     IREIDS       DS
     I                                     *STATUS  STSREI
     I*
     I** DATA STRUCTURE FOR DATE FORMAT DD/MM/YY
     I*
     I            DS
     I                                        1   60RESULT
     I                                        1   60CUTOVR                                  MD055663
     I                                        1   20ZDAY
     I                                        3   40ZMTH
     I                                        5   60ZYEAR
     I*
     I** DATA STRUCTURE FOR BEGINNING DATE
     I*
     I            DS
     I                                        1   60SRES
     I                                        1   20ZISD
     I                                        3   40ZISM
     I                                        5   60ZISY
     I*
     I** DATA STRUCTURE FOR FINISHING DATE
     I*
     I            DS
     I                                        1   60FRES
     I                                        1   20ZIFD
     I                                        3   40ZIFM
     I                                        5   60ZIFY
     I*                                                                   088029
     I** DATA STRUCTURE FOR DATE FORMAT MM/DD/YY                          088029
     I*                                                                   088029
     I            DS                                                      088029
     I                                        1   60RESULX                088029
     I                                        1   60CUTOVX                                  MD055663
     I                                        1   20ZMTHX                 088029
     I                                        3   40ZDAYX                 088029
     I                                        5   60ZYEARX                088029
     I*                                                                   088029
     I** DATA STRUCTURE FOR BEGINNING DATE MM/DD/YY                       088029
     I*                                                                   088029
     I            DS                                                      088029
     I                                        1   60SRESX                 088029
     I                                        1   20ZISMX                 088029
     I                                        3   40ZISDX                 088029
     I                                        5   60ZISYX                 088029
     I*                                                                   088029
     I** DATA STRUCTURE FOR FINISHING DATE MM/DD/YY                       088029
     I*                                                                   088029
     I            DS                                                      088029
     I                                        1   60FRESX                 088029
     I                                        1   20ZIFMX                 088029
     I                                        3   40ZIFDX                 088029
     I                                        5   60ZIFYX                 088029
     I/COPY ZSRSRC,ZDATE9Z2                                                                   CGL031
     IWDBAL       DS
     I*
     I** DATA STRUCTURE TO SPLIT FROM ALPHA TO NUMERIC DEBIT AND CREDIT BALANCES
     I*
     I**********                          P   1  960ZIBD                  075197
     I                                    P   1  880ZIBD                  075197
     I                                    P   1   80ZBD01
     I                                    P   9  160ZBD02
     I                                    P  17  240ZBD03
     I                                    P  25  320ZBD04
     I                                    P  33  400ZBD05
     I                                    P  41  480ZBD06
     I                                    P  49  560ZBD07
     I                                    P  57  640ZBD08
     I                                    P  65  720ZBD09
     I                                    P  73  800ZBD10
     I                                    P  81  880ZBD11
     I                                    P  89  960ZBD12
     I*
     IWCBAL       DS
     I**********                          P   1  960ZIBC                  075197
     I                                    P   1  880ZIBC                  075197
     I                                    P   1   80ZBC01
     I                                    P   9  160ZBC02
     I                                    P  17  240ZBC03
     I                                    P  25  320ZBC04
     I                                    P  33  400ZBC05
     I                                    P  41  480ZBC06
     I                                    P  49  560ZBC07
     I                                    P  57  640ZBC08
     I                                    P  65  720ZBC09
     I                                    P  73  800ZBC10
     I                                    P  81  880ZBC11
     I                                    P  89  960ZBC12
     IWDRAT       DS
     I*
     I** DATA STRUCTURE TO SPLIT FROM ALPHA TO NUMERIC DEBIT AND CREDIT RATES
     I*
     I**********                          P   1  727ZIRD                  075197
     I                                    P   1  667ZIRD                  075197
     I                                    P   1   67ZRD01
     I                                    P   7  127ZRD02
     I                                    P  13  187ZRD03
     I                                    P  19  247ZRD04
     I                                    P  25  307ZRD05
     I                                    P  31  367ZRD06
     I                                    P  37  427ZRD07
     I                                    P  43  487ZRD08
     I                                    P  49  547ZRD09
     I                                    P  55  607ZRD10
     I                                    P  61  667ZRD11
     I                                    P  67  727ZRD12
     I*
     IWCRAT       DS
     I**********                          P   1  727ZIRC                  075197
     I                                    P   1  667ZIRC                  075197
     I                                    P   1   67ZRC01
     I                                    P   7  117ZRC02
     I                                    P  13  187ZRC03
     I                                    P  19  247ZRC04
     I                                    P  25  307ZRC05
     I                                    P  31  367ZRC06
     I                                    P  37  427ZRC07
     I                                    P  43  487ZRC08
     I                                    P  49  547ZRC09
     I                                    P  55  607ZRC10
     I                                    P  61  667ZRC11
     I                                    P  67  727ZRC12
     I*
     I** KEY DATA STRUCTURE : AKEY TO COMPARE IF NEW ACCOUNT
     I*
     I            DS
     I**********                              1  18 AKEY                                      CGL029
     I                                        1  24 AKEY                                      CGL029
     I                                        1   3 BRCA
     I**********                              4   90CNUM                                      CSD027
     I                                        4   9 CNUM                                      CSD027
     I                                       10  12 CCY
     I**********                             13  160ACOD                                      CGL029
     I**********                             17  180ACSQ                                      CGL029
     I                                       13  220ACOD                                      CGL029
     I                                       23  240ACSQ                                      CGL029
     I*
     I** KEYS DATA STRUCTURE : PKEY TO COMPARE IF NEW ACCOUNT
     I**                       PKEY TO FILL DBKEY IF ERROR
     I**                       RKEY TO FILL DBKEY IF ERROR
     I*
     I            DS
     I**********                              1  23 RKEY                                      CGL029
     I**********                              1  18 PKEY                                      CGL029
     I**********                              4  18 CKEY                                      CGL029
     I                                        1  29 RKEY                                      CGL029
     I                                        1  24 PKEY                                      CGL029
     I                                        4  24 CKEY                                      CGL029
     I                                        1   3 BBRCA
     I**********                              4   90BCNUM                                     CSD027
     I                                        4   9 BCNUM                                     CSD027
     I                                       10  12 BCCY
     I**********                             13  160BACOD                                     CGL029
     I**********                             17  180BACSQ                                     CGL029
     I**********                             19  230WVDTC                                     CGL029
     I                                       13  220BACOD                                     CGL029
     I                                       23  240BACSQ                                     CGL029
     I                                       25  290WVDTC                                     CGL029
     I*
     I** KEY DATA STRUCTURE : VKEY TO FILL DBKEY IF ERROR
     I*
     I            DS
     I**********                              1  20 MKEY                                      CGL029
     I**********                              1  20 VKEY                                      CGL029
     I                                        1  26 MKEY                                      CGL029
     I                                        1  26 VKEY                                      CGL029
     I**********                              1   60VCNUM                                     CSD027
     I                                        1   6 VCNUM                                     CSD027
     I                                        7   9 VCCY
     I**********                             10  130VACOD                                     CGL029
     I**********                             14  150VACSQ                                     CGL029
     I**********                             16  200WVDATE                                    CGL029
     I                                       10  190VACOD                                     CGL029
     I                                       20  210VACSQ                                     CGL029
     I                                       22  260WVDATE                                    CGL029
     I*
     I** KEY DATA STRUCTURE : CHKEY TO CHAIN TO RECRG FILE
     I*
     I            DS
     I                                        1  12 CHKEY
     I                                        1   1 BLANK1
     I                                        2   30CHGT
     I                                        4   80CHST
     I                                        9  11 ACCCCY
     I                                       12  12 ENDK
     I*
     I** KEY DATA STRUCTURE : CCKEY TO CHAIN TO RECCY FILE
     I*
     I            DS
     I                                        1  12 CCKEY
     I                                        9  12 CCYZ
      *                                                                                       CDL013
      ** Key Data Structure ACKEY to chain to ACCNTBY0                                        CDL013
      *                                                                                       CDL013
     I            DS                                                                          CDL013
     I**********                              1  18 ACKEY                           CDL013 AR1046263
     I**********                              1  15 ACKEY3                          CDL013 AR1046263
     I**********                             16  18 ACKEY2                          CDL013 AR1046263
     I                                        1  24 ACKEY                                  AR1046263
     I                                        1  21 ACKEY3                                 AR1046263
     I                                       21  24 ACKEY2                                 AR1046263
     I*                                                                   S01408
     I/COPY WNCPYSRC,RE3662IIP1                                           S01408
     I*                                                                   S01408
     I*
     I*********** DS                                                      CCB003
     I***********                             1  150GADI0                 CCB003
     I***********                             1  151GADI1                 CCB003
     I***********                             1  152GADI2                 CCB003
     I***********                             1  153GADI3                 CCB003
     I***********                                                         CCB003
     I*********** DS                                                      CCB003
     I***********                             1  150GACI0                 CCB003
     I***********                             1  151GACI1                 CCB003
     I***********                             1  152GACI2                 CCB003
     I***********                             1  153GACI3                 CCB003
      *                                                                   S01408
     I/COPY WNCPYSRC,RE3662IIP4                                           S01408
      *                                                                   S01408
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA       EUDSLDA                         256                       CCB003
      *                                                                   CCB003
     I*LDA*******  DS                            256                      CCB003
     I***********                           134 141 DBFILE                CCB003
     I***********                           142 170 DBKEY                 CCB003
     I***********                           171 180 DBPGM                 CCB003
     I***********                           181 1830DBASE                 CCB003
     I*SPOOL*****  DS                                          CCB003
     I***********                                                         CCB003
     I****FILE*INFORMATION*DATA*STRUCTURE*(FOR*RE3662P1)                  CCB003
     I***********                                                         CCB003
     I***********                            83  92 SFILE                 CCB003
     I***********                         B 123 1240SFNUM                 CCB003
      *                                                                   CCB003
     ISPOOLU      DS
     I*
     I**  FILE INFORMATION DATA STRUCTURE (FOR RE3662AU)
     I*
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
     I/COPY ZSRSRC,ZHOLI                                                                      CRE090
      *                                                                                     CRE083AY
      ** Data Structure for the end record key                                              CRE083AY
      *                                                                                     CRE083AY
     I            DS                                                                        CRE083AY
     I                                        1  24 ENDKEY                                  CRE083AY
     I                                        1   3 EBRCA                                   CRE083AY
     I                                        4   9 ECNUM                                   CRE083AY
     I                                       10  12 ECCY                                    CRE083AY
     I                                       13  220EACOD                                   CRE083AY
     I                                       23  240EACSQ                                   CRE083AY
      *                                                                                     CRE083AY
      ** Data Structure for the next record key                                             CRE083AY
      *                                                                                     CRE083AY
     I            DS                                                                        CRE083AY
     I                                        1  24 NXTKEY                                  CRE083AY
     I                                        1   3 NBRCA                                   CRE083AY
     I                                        4   9 NCNUM                                   CRE083AY
     I                                       10  12 NCCY                                    CRE083AY
     I                                       13  220NACOD                                   CRE083AY
     I                                       23  240NACSQ                                   CRE083AY
      *                                                                                     CRE083AY
      ** Data Structure for the last record key                                             CRE083AY
      *                                                                                     CRE083AY
     I            DS                                                                        CRE083AY
     I                                        1  24 LSTKEY                                  CRE083AY
     I                                        1   3 LBRCA                                   CRE083AY
     I                                        4   9 LCNUM                                   CRE083AY
     I                                       10  12 LCCY                                    CRE083AY
     I                                       13  220LACOD                                   CRE083AY
     I                                       23  240LACSQ                                   CRE083AY
      *                                                                                       CRE090
      ** Data Structure for SRDLAY execution                                                  CRE090
      *                                                                                       CRE090
     I            DS                                                                          CRE090
     I                                        1  24 F1KEY                                     CRE090
     I                                        1   3 F1BRCA                                    CRE090
     I                                        4   9 F1CNUM                                    CRE090
     I                                       10  12 F1CCY                                     CRE090
     I                                       13  220F1ACOD                                    CRE090
     I                                       23  240F1ACSQ                                    CRE090
      *                                                                   CCB003
      ** Commitment control size                                          CCB003
     ICBTASK    E DSCBTASKSP                                              CCB003
      *                                                                   CCB003
     IRUNDAT      DS
     I*
     I** DATA AREA RUNDAT
     I*
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     I*
     ISDBANK    E DSSDBANKPD
     I*
     I** DATA STRUCTURE FOR BANK DETAILS
     I*
     I              BJURPT                          TITL
     I              BJDNWD                          DNWD
     I*
     ISDGELR    E DSSDGELRPD
     I*
     I** DATA STRUCTURE FOR GENERAL LEDGER DETAILS
     I*
     I**********    BKAPDT                          APDA                                      CRE090
     I*
     ISDBRCH    E DSSDBRCHPD
     I*
     I** DATA STRUCTURE FOR BRANCH DETAILS
     I*
     I              A8BRNM                          BBRNM
     I*
     ISDCURR    E DSSDCURRPD
     I*
     I** DATA STRUCTURE FOR CURRENCY CODE DETAILS
     I*
     I              A6NBDP                          CDP
     I*
     ISDRETL    E DSSDRETLPD
     I              QQACCD                          QQACC1                                    CGL029
     I*
     I** DATA STRUCTURE FOR RETAIL DETAILS
     I*
     I              BMLDAI                          LDAC
     I*
     ISDMMOD    E DSSDMMODPD                                                                  234656
     I*                                                                                       234656
     I**  Access Midas Modules.                                                               234656
     I*                                                                                       234656
     ISCSARD    E DSSCSARDPD                                                                  CGL031
      ** Data Structure for Switchable Feature Details                                        CGL031
      *                                                                                       CGL031
     ISDCSIN    E DSSDCSINPD                                                                  CGL031
      ** Data Structure for Customer Income Details                                           CGL031
      *                                                                                       CGL031
     IDSFDY     E DSDSFDY
     I*
     I** FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
     I*
     IDSSDY     E DSDSSDY
     I*
     I** SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE
     I*
      *                                                                                       CDL013
      ** Data Structure for Account Codes access program                                      CDL013
     ISDACOD    E DSSDACODPD                                                                  CDL013
     I              QQACCD                          QQACC2                                    CDL013
      *                                                                                       CDL081
      ** Named constants                                                                      CDL081
      *                                                                                       CDL081
     I              'BasCcyTaxRoundDown'  C         C#BASE                                    CDL081
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                    CDL081
     I*                                                                   S01408
     ISDCTTX    E DSSDCTTXPD                                                                  CER048
      *                                                                                       CER048
      ** Data Structure for Country of Tax Codes                                              CER048
      *                                                                                       CER048
     ISDCUST    E DSSDCUSTPD                                                                  CER048
     I              QQDFAC                          QQDFA1                                    CER048
      *                                                                                       CER048
      ** Data Structure for Customer Details                                                  CER048
      *                                                                                       CER048
     ISDLOCN    E DSSDLOCNPD                                                                  CER048
      *                                                                                       CER048
      ** Data structure for Location Details                                                  CER048
      *                                                                                       CER048
     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
      *                                                                                     BUG22911
      ** Data structure for Tax Parameter File                                              BUG22911
      *                                                                                     BUG22911
     I/COPY WNCPYSRC,RE3662IIP2                                           S01408
      *                                                                                       CER016
      ** Constant Value for Interest Calculation Method                                       CER016
      *                                                                                       CER016
     I              'InterestNumber '     C         PSYSVL                                    CER016
     I*                                                                   S01408
     IRCCYDS      DS                             52                                         CRE083AY
     I                                        1  130#MIDC                                   CRE083AY
     I                                       14  260#MADC                                   CRE083AY
     I                                       27  390#MICC                                   CRE083AY
     I                                       40  520#MACC                                   CRE083AY
     I              9999                  C         MAXVAL                                  CRE083AY
     IEFDT34      DS                                                                        MD055663
      *                                                                                     MD055663
      ** Data Area EFDT34                                                                   MD055663
      *                                                                                     MD055663
     I                                        1   7 EFFA                                    MD055663
     I                                        8  120EFFD                                    MD055663
      *                                                                                     MD055663
      ** Constan Value for New Capitalisation Period of Type 3 and 4                        MD055663
      *                                                                                     MD055663
     I              'NewIntCpPeriodTyp3&4'C         WSYSVL                                  MD055663
      *****************************************************************   CCB003
     C/EJECT
     C*===================================================================
      *                                                                   CCB003
     C           *ENTRY    PLIST                                          CCB003
     C                     PARM           RSTART  1        Restart if Y   CCB003
      *                                                                   CCB003
     C*
     C** COPYRIGHT INSERTION
     C*
     C                     MOVEACPY@      BIS@   80
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP33                                           S01408
      *                                                                   S01408
     C*
     C** KEY LISTS
     C*
     C** KEY FIELD TO ACCESS TO REHISL FILE
     C*
     C           R1KEY     KLIST
     C                     KFLD           BBRCA
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C                     KFLD           BVDTC
     C*
     C** PARTIAL KEY FIELD TO CHAIN TO ACCRACJ FILE AND TO READ REHISL,
     C** REHRDJ AND REHRCJ FILES
     C*
     C           R2KEY     KLIST
     C                     KFLD           BBRCA
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C*
     C** KEY FIELD TO ACCESS TO REHRDJ/REHRCJ FILE
     C*
     C           DCKEY     KLIST
     C                     KFLD           BBRCA
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C                     KFLD           KDATE
     C*
     C** KEY FIELD TO CHAIN TO REHISL FILE
     C*
     C           KVKEY     KLIST
     C                     KFLD           BBRCA
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C                     KFLD           KVDATE
     C*
     C** KEY FIELD TO CHAIN TO REHISML FILE
     C*
     C           KMKEY     KLIST
     C                     KFLD           BBRCA
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C                     KFLD           KVDATE
     C                     KFLD           KKDATE                          067706
     C*
     C** KEY FIELD TO CHAIN TO REACR FILE
     C*
     C           REKEY     KLIST
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C                     KFLD           BBRCA
     C*                                                                   088932
     C** Key field to chain to ACCNT file                                 088932
     C*                                                                   088932
     C           ACKEY1    KLIST                                          088932
     C                     KFLD           BCNUM                           088932
     C                     KFLD           BCCY                            088932
     C                     KFLD           BACOD                           088932
     C                     KFLD           BACSQ                           088932
     C                     KFLD           BBRCA                           088932
      **********                                                                  BUG23310A BUG23932
     C********** ACKEY2    KLIST                                                  BUG23310A BUG23932
     C**********           KFLD           BBRCA                                   BUG23310A BUG23932
     C**********           KFLD           BCNUM                                   BUG23310A BUG23932
     C**********           KFLD           BCCY                                    BUG23310A BUG23932
     C**********           KFLD           BACOD                                   BUG23310A BUG23932
     C**********           KFLD           BACSQ                                   BUG23310A BUG23932
     C**********           KFLD           WHISD                                   BUG23310A BUG23932
      *                                                                                       CER048
      ** Keylist to chain SDINPHL2 file                                                       CER048
      *                                                                                       CER048
     C********** KSDIN2    KLIST                                                     CER048 BUG23732
     C**********           KFLD           TICUST                                     CER048 BUG23732
     C**********           KFLD           BBRCA                                      CER048 BUG23732
      *                                                                                       CER048
      ** Key field to chain to ACCNTBY file renamed                                           CER048
      *                                                                                       CER048
     C           KEY01     KLIST                                                              CER048
     C                     KFLD           BCNUM                                               CER048
     C                     KFLD           BCCY                                                CER048
     C                     KFLD           BACOD                                               CER048
     C                     KFLD           BACSQ                                               CER048
     C                     KFLD           BBRCA                                               CER048
      *                                                                                    BUG26037B
      ** Key field to chain to SDACTXL1 file                                               BUG26037B
      *                                                                                    BUG26037B
     C           KLACTX    KLIST                                                           BUG26037B
     C                     KFLD           KCNUM   6                                        BUG26037B
     C                     KFLD           KCOLC   2                                        BUG26037B
      *                                                                                       CER048
      ***Key*field to chain to SDCSINPD file                                      BUG23310 BUG23310A
      **********                                                                  BUG23310 BUG23310A
     C********** KSDCS     KLIST                                                  BUG23310 BUG23310A
     C**********           KFLD           TSCTRT                                  BUG23310 BUG23310A
     C**********           KFLD           TSBRCA                                  BUG23310 BUG23310A
     C**********           KFLD           TSRCTR                                  BUG23310 BUG23310A
     C**********           KFLD           TSCUST                                  BUG23310 BUG23310A
     C**********           KFLD           TSIPDT                                  BUG23310 BUG23310A
     C**********           KFLD           TSMODI                                  BUG23310 BUG23310A
     C**********           KFLD           TSINST                                  BUG23310 BUG23310A
      *                                                                                     CRE083AY
      ** Key field to chain to REHISBN files                                                CRE083AY
      *                                                                                     CRE083AY
     C           REHKEY    KLIST                                                            CRE083AY
     C                     KFLD           BRCA                                              CRE083AY
     C                     KFLD           CNUM                                              CRE083AY
     C                     KFLD           CCY                                               CRE083AY
     C                     KFLD           ACOD                                              CRE083AY
     C                     KFLD           ACSQ                                              CRE083AY
      *                                                                                       CRE090
      ** Key list to chain to GLACNTL4                                                        CRE090
      *                                                                                       CRE090
     C           KACEX     KLIST                                                              CRE090
     C                     KFLD           F1CNUM                                              CRE090
     C                     KFLD           F1CCY                                               CRE090
     C                     KFLD           F1ACOD                                              CRE090
     C                     KFLD           F1ACSQ                                              CRE090
     C                     KFLD           F1BRCA                                              CRE090
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP1                                           S01408
     C*                                                                   S01408
     C*
     C** WORK FIELDS DEFINITION
     C*
     C           *LIKE     DEFN LDID      CLDID
     C           *LIKE     DEFN LCID      CLCID
     C           *LIKE     DEFN NCID      CNCID
     C           *LIKE     DEFN NDID      CNDID
     C           *LIKE     DEFN LDID      WLDID                                               CRE090
     C           *LIKE     DEFN LCID      WLCID                                               CRE090
     C           *LIKE     DEFN NDID      WDCAPD                                              CRE090
     C           *LIKE     DEFN NCID      WCCAPD                                              CRE090
     C           *LIKE     DEFN MNBL      CRMNBL
     C           *LIKE     DEFN RUND      CTFDAT
     C           *LIKE     DEFN RUND      CTLDAT
     C           *LIKE     DEFN MNBL      DRMNBL
     C           *LIKE     DEFN RUND      EDAT
     C           *LIKE     DEFN RUND      ENDDAT
     C           *LIKE     DEFN RUND      KDATE
     C           *LIKE     DEFN RUND      KVDATE
     C           *LIKE     DEFN DSDAT     KKDATE                          067706
     C           *LIKE     DEFN CRCB      LOOP
     C           *LIKE     DEFN POSTI     WPOSTI
     C           *LIKE     DEFN HISB      REBATE
     C           *LIKE     DEFN RUND      SDAT
     C           *LIKE     DEFN RUND      WBEG
     C           *LIKE     DEFN DAID      WCAIC
     C           *LIKE     DEFN CAID      WCAID
     C           *LIKE     DEFN RUND      WCFDNM
     C           *LIKE     DEFN RUND      WCFDTM
     C           *LIKE     DEFN TCHGAN    WCHGAN
     C           *LIKE     DEFN TCHGAR    WCHGAR
     C           *LIKE     DEFN TCHGAN    CCHGAN                          108931
     C           *LIKE     DEFN TCHGAR    CCHGAR                          108931
     C           *LIKE     DEFN DAID      WCIGA
     C           *LIKE     DEFN CICT      WCICT
     C           *LIKE     DEFN HISB      WCINT
     C           *LIKE     DEFN RUND      WCLDNM
     C           *LIKE     DEFN RUND      WCLDTM
     C           *LIKE     DEFN CMINT     WCMINT
     C           *LIKE     DEFN CRCB      WCRCB
     C           *LIKE     DEFN CRCD      WCRCD
     C           *LIKE     DEFN CRIR      WCRIR
     C           *LIKE     DEFN DAID      WDAIC
     C           *LIKE     DEFN DAID      WDAID
     C           *LIKE     DEFN RUND      WDFDNM
     C           *LIKE     DEFN RUND      WDFDTM
     C           *LIKE     DEFN DICT      WDICT
     C           *LIKE     DEFN DAID      WDIGA
     C           *LIKE     DEFN HISB      WDINT
     C           *LIKE     DEFN RUND      WDLDNM
     C           *LIKE     DEFN RUND      WDLDTM
     C           *LIKE     DEFN DMINT     WDMINT
     C           *LIKE     DEFN DRCB      WDRCB
     C           *LIKE     DEFN DRCD      WDRCD
     C           *LIKE     DEFN DRIR      WDRIR
     C           *LIKE     DEFN RUND      WEND
     C           *LIKE     DEFN DAID      WGACI
     C           *LIKE     DEFN DAID      WGADI
     C           *LIKE     DEFN HISB      WHISB
     C           *LIKE     DEFN RUND      WHISD
     C           *LIKE     DEFN DAID      WINTC                           088932
     C           *LIKE     DEFN MACI      WMACI
     C           *LIKE     DEFN MADI      WMADI
     C           *LIKE     DEFN MNBCP     WMNB
     C           *LIKE     DEFN MNBCP     WMNBCP
     C           *LIKE     DEFN MNBCP     UMNBCP                          101827
     C           *LIKE     DEFN MNBL      WMNBL
     C           *LIKE     DEFN MNBL      WWMNBL
     C           *LIKE     DEFN PCID      WPCID
     C           *LIKE     DEFN PDID      WPDID
     C           *LIKE     DEFN PDID      MPDID                           067706
     C           *LIKE     DEFN PDID      MPCID                           067706
     C           *LIKE     DEFN RECI      WRII
     C           *LIKE     DEFN TDINT     WTDINT
     C           *LIKE     DEFN TCINT     WTCINT
     C           *LIKE     DEFN TMACI     WTMACI
     C           *LIKE     DEFN TMADI     WTMADI
     C           *LIKE     DEFN RUND      WVALD
     C           *LIKE     DEFN CRIB      Y
     C           *LIKE     DEFN CRIB      Z
     C           *LIKE     DEFN HISB      ZBAL
     C           *LIKE     DEFN HISB      WAMT                                                CER016
     C           *LIKE     DEFN HISB      WINAMT                                              CER016
     C           *LIKE     DEFN HISB      WNAMT1                                              CER016
     C           *LIKE     DEFN HISB      WNAMT2                                              CER016
     C           *LIKE     DEFN RUND      ZFDNM
     C           *LIKE     DEFN RUND      ZFDTM
     C           *LIKE     DEFN HISB      ZIAMT
     C           *LIKE     DEFN HISB      ZIAMTR
     C           *LIKE     DEFN HISB      ZIAMT1
     C           *LIKE     DEFN RUND      ZIBEG
     C           *LIKE     DEFN RUND      ZIBW1
     C           *LIKE     DEFN CRCB      ZICALC
     C           *LIKE     DEFN RUND      ZIDREM
     C           *LIKE     DEFN CICT      ZIDW1
     C           *LIKE     DEFN RUND      ZIDW2
     C           *LIKE     DEFN RUND      ZID1
     C           *LIKE     DEFN RUND      ZID2
     C           *LIKE     DEFN RUND      ZIEND
     C********** *LIKE     DEFN FACT      ZIFY2                                               220323
     C           *LIKE     DEFN RUND      ZILPCP
     C           *LIKE     DEFN CICT      ZIMAN
     C           *LIKE     DEFN CICT      ZIM1
     C********** *LIKE     DEFN FACT      ZIM2                                                220323
     C********** *LIKE     DEFN FACT      ZINOM                                               220323
     C           *LIKE     DEFN TMACI     ZINTR
     C           *LIKE     DEFN CRIR      ZIRATE
     C           *LIKE     DEFN CRIR      WRATE2                                              CER016
     C           *LIKE     DEFN RUND      ZIREM
     C********** *LIKE     DEFN FACT      ZISY2                                               220323
     C           *LIKE     DEFN HISB      ZITHR
     C           *LIKE     DEFN CICT      ZIY1
     C           *LIKE     DEFN RUND      ZLDNM
     C           *LIKE     DEFN RUND      ZLDTM
     C           *LIKE     DEFN ACOD      ZLYCHK
     C           *LIKE     DEFN ACSQ      ZLYREM
     C           *LIKE     DEFN TMACI     ZSINT
     C           *LIKE     DEFN DAIC      CDAIC                           099090
     C           *LIKE     DEFN CAIC      CCAIC                           099090
     C           *LIKE     DEFN DNWD      WDNWD                                               234628
     C           *LIKE     DEFN RUND      WFDCO                                             MD055663
     C           *LIKE     DEFN RUND      WLDCO                                             MD055663
     C*
     C                     MOVE *BLANKS   ZZ025  25
     C                     MOVE *BLANKS   ZZ030  30
     C***********          MOVE 'Y'       FTIME   1                       CCB003
     C*
     C                     Z-ADD*ZEROS    WWDRIA 150                      CRE001
     C                     Z-ADD*ZEROS    WWINTA 150                      CRE001
     C                     Z-ADD*ZEROS    WWODIA 150                      CRE001
     C                     Z-ADD*ZEROS    WWODIP 150                      CRE001
     C                     Z-ADD*ZEROS    WWODLN 150                      CRE001
     C                     Z-ADD*ZEROS    WWAODR 117                      CRE001
      *                                                                   CRE001
     C                     MOVE ALGID     ALGID   2
     C                     MOVEL'N'       CRE090  1                                           CRE090
     C                     Z-ADD*ZEROS    WDLYDY  20                                          CRE090
     C                     Z-ADD*ZEROS    DYNBR   50                                          CRE090
     C                     Z-ADD*ZEROS    DAYNO   50                                          CRE090
     C                     Z-ADD*ZEROS    NRDYS   20                                          CRE090
     C                     Z-ADD*ZEROS    WNXDID  50                                          CRE090
     C                     Z-ADD*ZEROS    WNXCID  50                                          CRE090
     C                     Z-ADD*ZEROS    BVHISD  50                                          CRE090
     C                     Z-ADD*ZEROS    BVHISB 150                                          CRE090
     C                     MOVE 'N'       WDRDLY  1                                           CRE090
     C                     MOVE 'N'       WCRDLY  1                                           CRE090
     C                     MOVE ' '       WDDIS   1                                           CRE090
     C                     MOVE ' '       WCDIS   1                                           CRE090
     C                     Z-ADD*ZEROS    ZKVDTE  50                                          CRE090
     C                     Z-ADD*ZEROS    ZWHISB 150                                          CRE090
     C                     Z-ADD*ZEROS    ZWMNBL 150                                          CRE090
     C                     Z-ADD*ZEROS    ZDAIC  150                                          CRE090
     C                     Z-ADD*ZEROS    ZPMADI 130                                          CRE090
     C                     Z-ADD*ZEROS    ZWTMDI 130                                          CRE090
     C                     Z-ADD*ZEROS    ZCAIC  150                                          CRE090
     C                     Z-ADD*ZEROS    ZPMACI 130                                          CRE090
     C                     Z-ADD*ZEROS    ZWTMCI 130                                          CRE090
     C                     MOVE ' '       WDICI   1                                           CRE090
     C                     MOVE ' '       WCICI   1                                           CRE090
     C                     Z-ADD*ZEROS    WACCCR 150                                          CRE090
     C                     Z-ADD*ZEROS    WACCDR 150                                          CRE090
     C*
     C           *NAMVAR   DEFN           LDA
     C*
     C/EJECT
     C*===================================================================
     C** P R O G R A M     S T A R T
     C*===================================================================
     C*
     C** FIRST CYCLE PROCESSING
     C*
     C           @INIT     IFEQ ' '                                                         CRE083AY
     C                     EXSR FIRST
     C                     MOVE 'Y'       @INIT   1                                         CRE083AY
     C                     Z-ADDRUND      @RUND   50                                        MD020841
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
      ** Initialise work fields for re-run of program                                       CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADD1         #COMIT                                            CRE083AY
     C                     Z-ADD*ZEROS    WVALD                                             CRE083AY
     C                     CLEARREHPOSPF                                                    CRE083AY
     C                     CLEARREHISPDF                                                    CRE083AY
     C                     CLEARREHISPPF                                                    CRE083AY
     C                     CLEARREHISPSF                                                    CRE083AY
     C                     CLEARREHISPMF                                                    CRE083AY
     C                     CLEARREHISPCF                                                    CRE083AY
     C                     CLEARREACRDF                                                     CRE083AY
     C                     CLEARREIACDF                                                     CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADD@RUND     RUND                                              MD020841
      *                                                                                     CRE083AY
      ** Initialise work fields                                                             CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADD*ZEROS    ZIWRK1                                            CRE083AY
     C                     Z-ADD*ZEROS    ZIWRK2                                            CRE083AY
     C                     Z-ADD*ZEROS    ZDAYN2                                            CRE083AY
     C                     Z-ADD*ZEROS    ZRO117                                            CRE083AY
     C                     MOVE *BLANK    WPOSTI                                            CRE083AY
     C                     MOVE *BLANK    WRII                                              CRE083AY
     C                     MOVE *BLANK    ZZ001                                             CRE083AY
     C                     MOVE *BLANK    BLANK1                                            CRE083AY
     C                     MOVE 'D'       ENDK                                              CRE083AY
     C                     MOVE 'D'       CCYZ                                              CRE083AY
     C                     Z-ADD0         ##QNDX                                            CRE083AY
      *                                                                                     CRE083AY
     C*
     C** MAIN PROCESSING
     C*
     C***********          MOVE *ZERO     PKEY                            CCB003
     C***********          MOVE *BLANK    BCCY                            CCB003
     C***********          MOVE *BLANKS   BBRCA                     071053CCB003
     C***********R2KEY     SETLLREHISBN                                   CCB003
      *                                                                   CCB003
      ** Read end key for REACNAPD                                                          CRE083AY
      *                                                                                     CRE083AY
     C                     OPEN REACNAPD                                                    CRE083AY
     C                     MOVE 'Z'       IXCKEY  1                                         CRE083AY
     C           IXCKEY    CHAINDRIVEF               38                                     CRE083AY
     C           *IN38     IFEQ '0'                                                         CRE083AY
     C                     MOVE BRCA      EBRCA                                             CRE083AY
     C                     MOVE CNUM      ECNUM                                             CRE083AY
     C                     MOVE CCY       ECCY                                              CRE083AY
     C                     MOVE ACOD      EACOD                                             CRE083AY
     C                     MOVE ACSQ      EACSQ                                             CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
      ** Read start key from REACNAPD                                                       CRE083AY
      *                                                                                     CRE083AY
     C           *IN38     IFEQ '0'                                                         CRE083AY
     C                     MOVE 'A'       IXCKEY                                            CRE083AY
     C           IXCKEY    CHAINDRIVEF               38                                     CRE083AY
     C                     ENDIF                                                            CRE083AY
     C           *IN38     IFEQ '0'                                                         CRE083AY
     C                     MOVE BRCA      NBRCA                                             CRE083AY
     C                     MOVE CNUM      NCNUM                                             CRE083AY
     C                     MOVE CCY       NCCY                                              CRE083AY
     C                     MOVE ACOD      NACOD                                             CRE083AY
     C                     MOVE ACSQ      NACSQ                                             CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C********** *IN38     IFEQ '1'                                                CRE083AY MD022970
     C**********           EXSR REACSR                                             CRE083AY MD022970
     C**********           ENDIF                                                   CRE083AY MD022970
      *                                                                                     CRE083AY
      ** Set pointer to the first record for process                                        CRE083AY
      *                                                                                     CRE083AY
     C                     MOVE '0'       *IN19                                             CRE083AY
     C           NXTKEY    IFGT ENDKEY                                                      CRE083AY
     C           NXTKEY    OREQ ENDKEY                                                      CRE083AY
     C           PROT      ANDEQ'C'                                                         CRE083AY
     C                     MOVE '1'       *IN19                                             CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C           *IN19     IFEQ '0'                                                         CRE083AY
      *                                                                                     CRE083AY
     C           PROT      IFEQ ' '                                                         CRE083AY
     C           REHKEY    SETLLREHISBN                                                     CRE083AY
     C                     ELSE                                                             CRE083AY
     C           REHKEY    SETGTREHISBN                                                     CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C**********           READ REHISPBF                 LR                                 CRE083AY
     C                     READ REHISBN                  19                                 CRE083AY
     C           *IN19     IFEQ '0'                                                         CRE083AY
     C**********           MOVE BRCA      NBRCA                                   CRE083AY AR1075078
     C**********           MOVE CNUM      NCNUM                                   CRE083AY AR1075078
     C**********           MOVE CCY       NCCY                                    CRE083AY AR1075078
     C**********           MOVE ACOD      NACOD                                   CRE083AY AR1075078
     C**********           MOVE ACSQ      NACSQ                                   CRE083AY AR1075078
     C                     MOVE BBRCA     NBRCA                                            AR1075078
     C                     MOVE BCNUM     NCNUM                                            AR1075078
     C                     MOVE BCCY      NCCY                                             AR1075078
     C                     MOVE BACOD     NACOD                                            AR1075078
     C                     MOVE BACSQ     NACSQ                                            AR1075078
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C                     ENDIF                                                            CRE083AY
     C*
     C********** *INLR     DOWEQ'0'                        - B1                             CRE083AY
     C           *IN19     DOWEQ'0'                                                         CRE083AY
      ** Indicator for calculation type 01 and 02                                             CER055
     C                     MOVE *BLANK    WC0102  1                                           CER055
     C                     MOVE *BLANK    WDEBIT  1                                           CER055
     C*
     C** CHECK IF CURRENCY EXISTS
     C*
      * Are the details for this CCY already stored in the arrays                             CSC042
     C                     MOVELBCCY      ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
      * Found in the arrays so use the details from there                                     CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
      * Not found in arrays so go to DB                                                       CSC042
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM BCCY      @CCY    3
     C           SDCURR    PARM SDCURR    DSSDY
     C*
     C** ERROR IN SDCURRPD
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD25        DBASE            ***************
     C                     MOVE 'SDCURRPD'DBFILE           **DB ERROR 25**
     C                     MOVELBCCY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     ELSE                                                               CSC042
      * Found on the DB and not in the array so add to the array                              CSC042
     C                     EXSR ##ADDC                                                        CSC042
     C                     END
     C                     ENDIF                                                              CSC042
     C/COPY WNCPYSRC,RE3662C067
     C***********                                                         CCB003
     C***CHECK*NUMBER OF DECIMALS OF CURRENCY                             CCB003
     C***********                                                         CCB003
     C***********          MOVEA'0000'    *IN,80                          CCB003
     C***********                                                         CCB003
     C***********CDP       IFEQ 0                          - B1           CCB003
     C***********          MOVE '1'       *IN80                           CCB003
     C***********          ELSE                            - X1           CCB003
     C***********CDP       IFEQ 1                          - B2           CCB003
     C***********          MOVE '1'       *IN81                           CCB003
     C***********          ELSE                            - X2           CCB003
     C***********CDP       IFEQ 2                          - B3           CCB003
     C***********          MOVE '1'       *IN82                           CCB003
     C***********          ELSE                            - X3           CCB003
     C***********          MOVE '1'       *IN83                           CCB003
     C***********          END                             - E3           CCB003
     C***********          END                             - E2           CCB003
     C***********          END                             - E1           CCB003
     C*
     C** CHECK IF THERE IS A CHANGE IN BRANCH
     C*
     C           BBRCA     IFNE @BRCA
     C***********          MOVE @BRCA     XBRCA   3                       CCB003
     C                     MOVE BBRCA     @BRCA   3
     C                     MOVE '1'       *INL1
     C                     ELSE
     C                     MOVE '0'       *INL1
     C                     END
     C*
     C           *INL1     IFEQ '1'
     C*
     C***PRINTING*OF*REPORT*FOOTER*DONE*IF*FILE*HAS*BEEN*OPENED           CCB003
     C***********                                                         CCB003
     C***********FTIME     IFNE 'Y'                                       CCB003
     C***********                                                         CCB003
     C***********P1OP      IFNE 'Y'                                       CCB003
     C***********          WRITENODET                                     CCB003
     C***********          END                                            CCB003
     C***********                                                         CCB003
     C***********          WRITEENDP1                                     CCB003
     C***********                                                         CCB003
     C***********          END                                            CCB003
     C***********                                                         CCB003
     C***********          CLOSERE3662P1                                  CCB003
     C***********          MOVE 'N'       FTIME                           CCB003
     C***********          OPEN RE3662P1                                  CCB003
     C***********                                                         CCB003
     C***********          Z-ADD0         PAGE                            CCB003
     C***********                                                         CCB003
     C***ENSURE*REPORT*SPOOL*FILE*RECORDED*BY*RCF                         CCB003
     C***********                                                         CCB003
     C***********          Z-ADDSFNUM     ZSNUM   60                      CCB003
     C***********                                                         CCB003
     C***********          CALL 'ZSFILE'                                  CCB003
     C***********          PARM *BLANK    SEQ                             CCB003
     C***********          PARM BBRCA     SENTY   3                       CCB003
     C***********          PARM           SFILE                           CCB003
     C***********          PARM           ZSNUM                           CCB003
     C***********          PARM           ZSERR   1                       CCB003
     C***********                                                         CCB003
     C***********ZSERR     IFEQ 'Y'                                       CCB003
     C***********                                                         CCB003
     C****Error*during*ZSFILE*processing,*return*to*calling*program       CCB003
     C***********                                                         CCB003
     C************LOCK     IN   LDA                                       CCB003
     C***********          MOVELBBRCA     DBKEY                           CCB003
     C***********          MOVEL'ZSFILE  'DBFILE           ***************CCB003
     C***********          Z-ADD030       DBASE            * DBERROR 030 *CCB003
     C***********          OUT  LDA                        ***************CCB003
     C***********          EXSR DBSR                                      CCB003
     C***********          END                                            CCB003
     C*
     C           MBIN      IFEQ 'Y'
     C*
     C** GET BRANCH NAME
     C*
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM BBRCA     @BRCH   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL@BRCH     DBKEY
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C                     Z-ADD017       DBASE            * DBERROR 017 *
     C                     OUT  LDA                        ***************
     C                     EXSR DBSR
     C                     END
     C*
     C                     END
     C*
     C***OUTPUT*REPORT*HEADER                                             CCB003
     C***********                                                         CCB003
     C***********          WRITEHEADPR                                    CCB003
     C*
     C                     END
     C*
     C                     EXSR MAIN
     C*
      ** Increase number of records processed                             CCB003
     C                     ADD  1         #COMIT                          CCB003
      *                                                                   CCB003
      ** Delete record from driving file                                  CCB003
     C**********           DELETREHISPBF                                             CCB003 CRE083AY
      *                                                                   CCB003
      ** Comit if restart status = 'Y' or number of records processed     CCB003
      ** has reached optimum defined in CBTASKSP                          CCB003
     C                     MOVE NXTKEY    LSTKEY                                            CRE083AY
     C           RSTART    IFEQ 'Y'                                       CCB003
     C           #COMIT    OREQ #OPTIM                                    CCB003
     C                     EXSR UPDPTR                                                      CRE083AY
     C                     COMIT                                          CCB003
     C                     Z-ADD0         #COMIT                          CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C**********           READ REHISPBF                 LR                                 CRE083AY
     C                     READ REHISBN                  19                                 CRE083AY
     C*
      ** Check if end record is read                                                        CRE083AY
      *                                                                                     CRE083AY
     C           *IN19     IFEQ '0'                                                         CRE083AY
     C**********           MOVE BRCA      NBRCA                                   CRE083AY AR1075078
     C**********           MOVE CNUM      NCNUM                                   CRE083AY AR1075078
     C**********           MOVE CCY       NCCY                                    CRE083AY AR1075078
     C**********           MOVE ACOD      NACOD                                   CRE083AY AR1075078
     C**********           MOVE ACSQ      NACSQ                                   CRE083AY AR1075078
     C                     MOVE BBRCA     NBRCA                                            AR1075078
     C                     MOVE BCNUM     NCNUM                                            AR1075078
     C                     MOVE BCCY      NCCY                                             AR1075078
     C                     MOVE BACOD     NACOD                                            AR1075078
     C                     MOVE BACSQ     NACSQ                                            AR1075078
      *                                                                                     CRE083AY
     C           NXTKEY    IFGT ENDKEY                                                      CRE083AY
     C                     MOVE '1'       *IN19                                             CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
     C           *IN19     IFEQ '1'                                                         CRE083AY
     C                     MOVE LSTKEY    NXTKEY                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ENDDO                                          CCB003
      *                                                                   CCB003
      ** Comit if no records left in driving file and number of           CCB003
      ** records processed is not 0                                       CCB003
     C********** *INLR     IFEQ '1'                                                  CCB003 CRE083AY
     C           *IN19     IFEQ '1'                                                         CRE083AY
     C           #COMIT    ANDGT0                                         CCB003
     C                     EXSR UPDPTR                                                      CRE083AY
     C                     COMIT                                          CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C                     UNLCKREHISBL                                                     CRE083AY
     C                     UNLCKREHISDL                                                     CRE083AY
     C                     UNLCKREHISL                                                      CRE083AY
     C                     UNLCKREHISMDL                                                    CRE083AY
     C                     UNLCKREHISMCL                                                    CRE083AY
     C                     UNLCKREACNAPD                                                    CRE083AY
     C                     UNLCKREACR                                                       CRE083AY
     C                     UNLCKREIAC                                                       CRE083AY
     C                     CLOSEREACNAPD                                                    CRE083AY
      *                                                                                     CRE083AY
     C                     RETRN                                                            CRE083AY
     C************INLR     IFEQ '1'                                       CCB003
     C***********                                                         CCB003
     C***********P1OP      IFNE 'Y'                                       CCB003
     C***********          WRITENODET                                     CCB003
     C***********          END                                            CCB003
     C***********                                                         CCB003
     C***********          MOVE @BRCA     XBRCA   3                       CCB003
     C***********          WRITEENDP1                                     CCB003
     C***********                                                         CCB003
     C***********          END                                            CCB003
     C***********                                                         CCB003
     C***********          END                             - E1           CCB003
     C***********                                                         CCB003
     C***TOTAL*PROCESSING                                                 CCB003
     C***********                                                         CCB003
     C***********          EXSR TOTAL                                     CCB003
     C***********                                                         CCB003
     C****ENSURE*TOTAL*SPOOL*FILE*RECORDED*BY*RCF                         CCB003
     C***********                                                         CCB003
     C***********          Z-ADDSFNUMU    ZSNUMU  60                      CCB003
     C***********                                                         CCB003
     C***********          CALL 'ZSFILE'                                  CCB003
     C***********          PARM           SEQ     5                       CCB003
     C***********          PARM *BLANK    SENTY   3                       CCB003
     C***********          PARM           SFILEU                          CCB003
     C***********          PARM           ZSNUMU                          CCB003
     C***********          PARM           ZSERR   1                       CCB003
     C***********                                                         CCB003
     C***********ZSERR     IFEQ 'Y'                                       CCB003
     C***********                                                         CCB003
     C****ERROR*DURING*ZSFILE*PROCESSING,*RETURN*TO*CALLING*PROGRAM       CCB003
     C***********                                                         CCB003
     C************LOCK     IN   LDA                                       CCB003
     C***********          MOVEL'AUDIT'   DBKEY                           CCB003
     C***********          MOVEL'ZSFILE  'DBFILE           ***************CCB003
     C***********          Z-ADD031       DBASE            * DBERROR 031 *CCB003
     C***********          OUT  LDA                        ***************CCB003
     C***********          EXSR DBSR                                      CCB003
     C***********          END                                            CCB003
     C*
     C*===================================================================
     C** P R O G R A M     E N D
     C*===================================================================
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP28                                           S01408
      *                                                                   S01408
     C/EJECT
      ********************************************************************                  CRE083AY
      *  SRCHKL - Checks if Location code is already in the array.       *                  CRE083AY
      *  Called by:                                                      *                  CRE083AY
      *  Calls:     None                                                 *                  CRE083AY
      ********************************************************************                  CRE083AY
     C           SRCHKL    BEGSR                                                            CRE083AY
     C                     MOVE *IN20     #IN20   1                                         CRE083AY
     C                     MOVEL*BLANK    ##LFIC  1                                         CRE083AY
      *                                                                                     CRE083AY
      ** Restore saved value of A index                                                     CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADD##LSAV    A                                                 CRE083AY
      *                                                                                     CRE083AY
      ** Defend against A == 0                                                              CRE083AY
      *                                                                                     CRE083AY
     C           A         IFEQ 0                                                           CRE083AY
     C                     Z-ADD1         A                                                 CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
      ** Is this the same as the last LOKUP? if so, we can bypass LOKUP                     CRE083AY
      *                                                                                     CRE083AY
     C           A8LCCD    IFEQ #LOC,A                                                      CRE083AY
     C                     SETON                     20                                     CRE083AY
     C                     ELSE                                                             CRE083AY
      *                                                                                     CRE083AY
      ** Begin lookup from last saved or if full, start from 1                              CRE083AY
      *                                                                                     CRE083AY
     C           ##LNDX    IFEQ 0                                                           CRE083AY
     C                     Z-ADD1         A                                                 CRE083AY
     C                     ELSE                                                             CRE083AY
     C                     Z-ADD##LNDX    A                                                 CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C           A8LCCD    LOKUP#LOC,A                   20                                 CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C           *IN20     IFEQ *ON                                                         CRE083AY
      *                                                                                     CRE083AY
      ** Update LRU                                                                         CRE083AY
      *                                                                                     CRE083AY
     C           ##LC2     IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         ##LC2                                             CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         ##LC2                                             CRE083AY
     C                     MOVE ##LC2     #LR2,A                                            CRE083AY
      *                                                                                     CRE083AY
      ** Save the last update to A                                                          CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADDA         ##LSAV                                            CRE083AY
      *                                                                                     CRE083AY
      ** Turn on indicator so that program will know it is in the cache                     CRE083AY
      *                                                                                     CRE083AY
     C                     MOVEL'Y'       ##LFIC                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C                     MOVE #IN20     *IN20                                             CRE083AY
     C                     ENDSR                                                            CRE083AY
      ********************************************************************                  CRE083AY
      *  SRADDL - This subroutine adds the newly acquired LOCN details   *                  CRE083AY
      *           to the cache. If the cache is full, it replaces the    *                  CRE083AY
      *           least recently used.                                   *                  CRE083AY
      *  Called by:                                                      *                  CRE083AY
      *  Calls:     None                                                 *                  CRE083AY
      ********************************************************************                  CRE083AY
     C           SRADDL    BEGSR                                                            CRE083AY
     C                     MOVE *IN40     #IN40   1                                         CRE083AY
      *                                                                                     CRE083AY
      ** Check if there is still available slot in the array.                               CRE083AY
      *                                                                                     CRE083AY
     C           ##LNDX    IFNE 0                                                           CRE083AY
     C                     Z-ADD##LNDX    A                                                 CRE083AY
      *                                                                                     CRE083AY
     C                     MOVE A8LCCD    #LOC,A                                            CRE083AY
     C                     MOVE SDLOCN    #LOD,A                                            CRE083AY
      *                                                                                     CRE083AY
     C           ##LC2     IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         ##LC2                                             CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         ##LC2   40                                        CRE083AY
     C                     MOVE ##LC2     #LR2,A                                            CRE083AY
      *                                                                                     CRE083AY
     C                     SUB  1         ##LNDX                                            CRE083AY
      *                                                                                     CRE083AY
      ** Else replace the LRU                                                               CRE083AY
      *                                                                                     CRE083AY
     C                     ELSE                                                             CRE083AY
     C                     Z-ADD1         A                                                 CRE083AY
     C                     SETOF                     40                                     CRE083AY
     C           *IN40     DOWEQ*OFF                                                        CRE083AY
     C           #LEAS2    LOKUP#LR2,A                   40                                 CRE083AY
      *                                                                                     CRE083AY
     C           *IN40     IFEQ *OFF                                                        CRE083AY
     C           #LEAS2    IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         #LEAS2                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         #LEAS2                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ENDDO                                                            CRE083AY
      *                                                                                     CRE083AY
     C                     MOVE A8LCCD    #LOC,A                                            CRE083AY
     C                     MOVE SDLOCN    #LOD,C                                            CRE083AY
      *                                                                                     CRE083AY
     C           ##LC2     IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         ##LC2                                             CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         ##LC2                                             CRE083AY
     C                     MOVE ##LC2     #LR2,A                                            CRE083AY
     C           #LEAS2    IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         #LEAS2                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         #LEAS2                                            CRE083AY
      *                                                                                     CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
      ** Update LSAVE so next call to SRCHKL checks                                         CRE083AY
      ** this newly added element.                                                          CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADDA         ##LSAV                                            CRE083AY
     C                     MOVE #IN40     *IN40                                             CRE083AY
     C                     ENDSR                                                            CRE083AY
     C********************************************************************                  CRE083AY
     C*  SRSETL - If a match in the cache is found, transfer the values  *                  CRE083AY
     C*           from the cache to the work variables of the program.   *                  CRE083AY
     C*  Called by:                                                      *                  CRE083AY
     C*  Calls:     None                                                 *                  CRE083AY
     C********************************************************************                  CRE083AY
     C           SRSETL    BEGSR                                                            CRE083AY
     C                     MOVE #LOC,A    A8LCCD                                            CRE083AY
     C                     MOVE #LOD,A    SDLOCN                                            CRE083AY
     C                     ENDSR                                                            CRE083AY
      ********************************************************************                  CRE083AY
      *  SRCHKA - Checks if Account Code is already in the array.        *                  CRE083AY
      *  Called by:                                                      *                  CRE083AY
      *  Calls:     None                                                 *                  CRE083AY
      ********************************************************************                  CRE083AY
     C           SRCHKA    BEGSR                                                            CRE083AY
     C                     MOVE *IN20     #IN20   1                                         CRE083AY
     C                     MOVEL*BLANK    ##AFIC  1                                         CRE083AY
      *                                                                                     CRE083AY
      ** Restore saved value of A index                                                     CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADD##ASAV    A                                                 CRE083AY
      *                                                                                     CRE083AY
      ** Defend against A == 0                                                              CRE083AY
      *                                                                                     CRE083AY
     C           A         IFEQ 0                                                           CRE083AY
     C                     Z-ADD1         A                                                 CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
      ** Is this the same as the last LOKUP? if so, we can bypass LOKUP                     CRE083AY
      *                                                                                     CRE083AY
     C           WACOD     IFEQ ##AC,A                                                      CRE083AY
     C                     SETON                     20                                     CRE083AY
     C                     ELSE                                                             CRE083AY
      *                                                                                     CRE083AY
      ** Begin lookup from last saved or if full, start from 1                              CRE083AY
      *                                                                                     CRE083AY
     C           ##ANDX    IFEQ 0                                                           CRE083AY
     C                     Z-ADD1         A                                                 CRE083AY
     C                     ELSE                                                             CRE083AY
     C                     Z-ADD##ANDX    A                                                 CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C           WACOD     LOKUP##AC,A                   20                                 CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C           *IN20     IFEQ *ON                                                         CRE083AY
      *                                                                                     CRE083AY
      ** Update LRU                                                                         CRE083AY
      *                                                                                     CRE083AY
     C           ##LC      IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         ##LC                                              CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         ##LC                                              CRE083AY
     C                     MOVE ##LC      #LRU,A                                            CRE083AY
      *                                                                                     CRE083AY
      ** Save the last update to A                                                          CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADDA         ##ASAV                                            CRE083AY
      *                                                                                     CRE083AY
      ** Turn on indicator so that program will now it is in the array                      CRE083AY
      *                                                                                     CRE083AY
     C                     MOVEL'Y'       ##AFIC                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C                     MOVE #IN20     *IN20                                             CRE083AY
     C                     ENDSR                                                            CRE083AY
      ********************************************************************                  CRE083AY
      *  SRADDA - This subroutine adds the newly chained transaction     *                  CRE083AY
      *           type and its A5MISU to the cache. If the cache is full,*                  CRE083AY
      *           it replaces the least recently used.                   *                  CRE083AY
      *  Called by:                                                      *                  CRE083AY
      *  Calls:     None                                                 *                  CRE083AY
      ********************************************************************                  CRE083AY
     C           SRADDA    BEGSR                                                            CRE083AY
     C                     MOVE *IN40     #IN40   1                                         CRE083AY
      *                                                                                     CRE083AY
      ** Check if there is still available slot in the array.                               CRE083AY
      *                                                                                     CRE083AY
     C           ##ANDX    IFNE 0                                                           CRE083AY
     C                     Z-ADD##ANDX    A                                                 CRE083AY
      *                                                                                     CRE083AY
     C                     MOVE WACOD     ##AC,A                                            CRE083AY
     C                     MOVE A5MISU    ##AD,A                                            CRE083AY
      *                                                                                     CRE083AY
     C           ##LC      IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         ##LC                                              CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         ##LC    40                                        CRE083AY
     C                     MOVE ##LC      #LRU,A                                            CRE083AY
      *                                                                                     CRE083AY
     C                     SUB  1         ##ANDX                                            CRE083AY
      *                                                                                     CRE083AY
      ** Else replace the LRU                                                               CRE083AY
      *                                                                                     CRE083AY
     C                     ELSE                                                             CRE083AY
     C                     Z-ADD1         A                                                 CRE083AY
     C                     SETOF                     40                                     CRE083AY
     C           *IN40     DOWEQ*OFF                                                        CRE083AY
     C           #LEAST    LOKUP#LRU,A                   40                                 CRE083AY
      *                                                                                     CRE083AY
     C           *IN40     IFEQ *OFF                                                        CRE083AY
     C           #LEAST    IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         #LEAST                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         #LEAST                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ENDDO                                                            CRE083AY
      *                                                                                     CRE083AY
     C                     MOVE WACOD     ##AC,A                                            CRE083AY
     C                     MOVE A5MISU    ##AD,A                                            CRE083AY
      *                                                                                     CRE083AY
     C           ##LC      IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         ##LC                                              CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         ##LC                                              CRE083AY
     C                     MOVE ##LC      #LRU,A                                            CRE083AY
     C           #LEAST    IFEQ MAXVAL                                                      CRE083AY
     C                     Z-ADD0         #LEAST                                            CRE083AY
     C                     ENDIF                                                            CRE083AY
     C                     ADD  1         #LEAST                                            CRE083AY
      *                                                                                     CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
      ** Update PSAVE so next call to SRCHKP checks                                         CRE083AY
      ** this newly added elt                                                               CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADDA         ##ASAV                                            CRE083AY
     C                     MOVE #IN40     *IN40                                             CRE083AY
     C                     ENDSR                                                            CRE083AY
     C********************************************************************                  CRE083AY
     C*  SRSETA - If a match in the cache is found, transfer the values  *                  CRE083AY
     C*           from the cache to the work variables of the program.   *                  CRE083AY
     C*  Called by:                                                      *                  CRE083AY
     C*  Calls:     None                                                 *                  CRE083AY
     C********************************************************************                  CRE083AY
     C           SRSETA    BEGSR                                                            CRE083AY
     C                     MOVEL##AC,A    WACOD                                             CRE083AY
     C                     MOVEL##AD,A    A5MISU                                            CRE083AY
     C                     ENDSR                                                            CRE083AY
     C********************************************************************                  CRE083AY
     C*                                                                  *                  CRE083AY
     C*  SRCCYC - Cache for RECCYD. Caches CCY and its limits.           *                  CRE083AY
     C*                                                                  *                  CRE083AY
     C********************************************************************                  CRE083AY
     C           SRCCYC    BEGSR                                                            CRE083AY
     C                     READ RECCY                    99                                 CRE083AY
     C                     Z-ADD0         C       20                                        CRE083AY
     C           *IN99     DOWEQ*OFF                                                        CRE083AY
     C                     ADD  1         C                                                 CRE083AY
     C                     MOVE KEY       ##CC,C                                            CRE083AY
     C                     Z-ADDMIDC      #MIDC                                             CRE083AY
     C                     Z-ADDMADC      #MADC                                             CRE083AY
     C                     Z-ADDMICC      #MICC                                             CRE083AY
     C                     Z-ADDMACC      #MACC                                             CRE083AY
     C                     MOVE RCCYDS    ##CD,C                                            CRE083AY
     C                     READ RECCY                    99                                 CRE083AY
      *                                                                                     CRE083AY
      ** If it will exceed the array's size, do not add anymore.                            CRE083AY
      *                                                                                     CRE083AY
     C           C         IFEQ 200                                                         CRE083AY
     C                     SETON                     99                                     CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C                     ENDDO                                                            CRE083AY
     C                     ENDSR                                                            CRE083AY
     C********************************************************************                    CSC042
     C*                                                                                       CSC042
     C*  ##CHKC  - Check the currency details                                                 CSC042
     C*                                                                                       CSC042
     C********************************************************************                    CSC042
     C           ##CHKC    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C           *LIKE     DEFN BJCYCD    ##KC                                                CSC042
     C           *LIKE     DEFN Q         ##QSV                                               CSC042
      *                                                                                       CSC042
      * Set off the currency found indicator                                                  CSC042
     C                     MOVEL*BLANK    ##FIC   1                                           CSC042
      *                                                                                       CSC042
      * Save the state of indicator 87 so it can be reset at the end                          CSC042
      * of the SR as it may be used elsewhere in the code                                     CSC042
     C           *IN87     IFEQ *ON                                                           CSC042
     C                     MOVEL'Y'       #IN87   1                                           CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL'N'       #IN87                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C                     SETOF                         87                                   CSC042
      *                                                                                       CSC042
      * Restore Q from ##QSV in case Q is used elsewhere in the code                          CSC042
     C                     Z-ADD##QSV     Q       40                                          CSC042
      *                                                                                       CSC042
      * Are we looking for the same details as the last time this                             CSC042
      * subroutine was called i.e. is Q already set correctly?                                CSC042
      * If so then use the data rather than do another LOKUP                                  CSC042
      * First make sure that we don't reference the 0th array element                         CSC042
     C           Q         IFEQ 0                                                             CSC042
     C                     Z-ADD1         Q                                                   CSC042
     C                     ENDIF                                                              CSC042
      * Now see if this search is same as last one performed                                  CSC042
      * If we have a match then seton 87 so the code after this                               CSC042
      * subroutine knows it can use Q directly                                                CSC042
     C           ##KC      IFEQ CURR,Q                                                        CSC042
     C                     SETON                         87                                   CSC042
     C                     ELSE                                                               CSC042
      * Otherwise hunt in the array and seton 87 if found                                     CSC042
     C                     Z-ADD1         Q                                                   CSC042
     C           ##KC      LOKUPCURR,Q                   87                                   CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Save Q for next time                                                                  CSC042
     C           *IN87     IFEQ *ON                                                           CSC042
     C                     Z-ADDQ         ##QSV                                               CSC042
      * Set the indicator to show the data was found                                          CSC042
     C                     MOVEL'Y'       ##FIC                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Reset the state of indicator 87.                                                      CSC042
     C           #IN87     IFEQ 'Y'                                                           CSC042
     C                     MOVEL*ON       *IN87                                               CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL*OFF      *IN87                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      *                                                                                       CSC042
     C********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
     C********************************************************************                    CSC042
     C*                                                                                       CSC042
     C*  ##SETB  - Set up the SDCURRPD fields as expected by this program                     CSC042
     C*            from the array fields                                                      CSC042
     C*                                                                                       CSC042
     C********************************************************************                    CSC042
     C           ##SETC    BEGSR                                                              CSC042
     C*                                                                                       CSC042
     C                     MOVELCURR,Q    A6CYCD                                              CSC042
     C                     Z-ADD#CDP,Q    CDP                                                 CSC042
     C                     MOVEL#CMD,Q    A6MDIN                                              CSC042
     C                     Z-ADD#CSR,Q    A6SPRT                                              CSC042
     C*                                                                                       CSC042
     C                     ENDSR                                                              CSC042
     C********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##ADDC - Adds the SDCURRPD fields used in the code to the                             CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##ADDC    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C           *LIKE     DEFN Q         ##QNDX                                              CSC042
      * If there is still room in the array then add the details                              CSC042
     C           ##QNDX    IFLT 150                                                           CSC042
     C                     ADD  1         ##QNDX                                              CSC042
     C                     Z-ADD##QNDX    Q                                                   CSC042
     C                     MOVELA6CYCD    CURR,Q                                              CSC042
     C                     Z-ADDCDP       #CDP,Q                                              CSC042
     C                     MOVELA6MDIN    #CMD,Q                                              CSC042
     C                     Z-ADDA6SPRT    #CSR,Q                                              CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Update ##QSV so next call to ##CHKC checks this latest adddition                      CSC042
      * to the array firss                                                                    CSC042
     C                     Z-ADDQ         ##QSV                                               CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
     C********************************************************************
     C**
     C** CAPI subroutine to process the capitalisation
     C**
     C**     Called by       DETPR
     C**     Calls           CREPR,DEBPR,DRCRPR,INTSR
     C**
      *****************************************************************   CCB003
     C           CAPI      BEGSR                           **CAPI BEGSR**
      *                                                                                       CRE090
      ** Check account if for delay                                                           CRE090
      *                                                                                       CRE090
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           AKEY      ANDNEF1KEY                                                         CRE090
     C           BDICI     IFEQ 'Y'                                                           CRE090
     C           BCICI     OREQ 'Y'                                                           CRE090
     C                     EXSR SRDLAY                                                        CRE090
     C                     ELSE                                                               CRE090
     C                     MOVE 'N'       WDRDLY                                              CRE090
     C                     MOVE 'N'       WCRDLY                                              CRE090
     C                     ENDIF                                                              CRE090
     C                     ENDIF                                                              CRE090
     C*
     C/COPY WNCPYSRC,RE3662C026
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDWHISD     WHISDS  60
      *                                                                                     MD027245
     C           WDICI     IFNE *BLANKS                                                     MD027245
     C           WCICI     ORNE *BLANKS                                                     MD027245
      *                                                                                     MD027245
     C           CNDID     IFEQ WRKHSD                                                      MD027245
     C                     MOVE 'C'       SFOUND                                            MD027245
     C                     ENDIF                                                            MD027245
     C           CNCID     IFEQ WRKHSD                                                      MD027245
     C                     MOVE 'C'       SFOUND                                            MD027245
     C                     ENDIF                                                            MD027245
      *                                                                                     MD027245
     C                     ENDIF                                                            MD027245
     C*
     C** DEBIT CAPITALISATION ONLY IF NOT CREDIT
     C*
     C           CNCID     IFLE WHISDS                     - B1
     C           CNCID     ORGT ENDDAT
     C                     EXSR DEBPR
     C                     END                             - E1
     C*
     C** CREDIT CAPITALISATION ONLY IF NOT DEBIT
     C*
     C           CNDID     IFLE WHISDS                     - B1
     C           CNDID     ORGT ENDDAT
     C                     EXSR CREPR
     C                     END                             - E1
     C*
     C** CHECK IF BOTH CAPITALISATIONS
     C*
     C           CNDID     IFGT WHISDS                     - B1
     C           CNDID     ANDLEENDDAT
     C           CNCID     ANDGTWHISDS
     C           CNCID     ANDLEENDDAT
     C*
     C** DEBIT AND CREDIT CAPITALISATIONS TOGETHER
     C*
     C           CNDID     IFEQ CNCID                      - B2
     C*
     C                     EXSR DRCRPR
     C*
     C                     END                             - E2
     C*
     C** DEBIT BEFORE CREDIT CAPITALISATION
     C*
     C           CNDID     IFLT CNCID                      - B2
     C*
     C                     EXSR DEBPR
     C*
     C                     Z-ADDCNDID     WHISD
     C                     Z-ADDZIEND     ZIBEG
     C*
     C                     EXSR CREPR
     C*
     C                     END                             - E2
     C*
     C** CREDIT BEFORE DEBIT CAPITALISATION
     C*
     C           CNCID     IFLT CNDID                      - B2
     C*
     C                     EXSR CREPR
     C*
     C                     Z-ADDCNCID     WHISD
     C                     Z-ADDZIEND     ZIBEG
     C*
     C                     EXSR DEBPR
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
      *                                                                                     MD027245
     C           WDICI     IFNE *BLANKS                                                     MD027245
     C           WCICI     ORNE *BLANKS                                                     MD027245
     C                     MOVE WDICI     SDICI                                             MD027245
     C                     MOVE WCICI     SCICI                                             MD027245
     C                     MOVE *BLANK    SFOUND                                            MD027245
     C                     ENDIF                                                            MD027245
     C*
     C/COPY WNCPYSRC,RE3662C027
     C           ZIEND     IFLT ENDDAT                     - B1
     C*
     C                     Z-ADDZIEND     ZIBEG
     C                     Z-ADDENDDAT    ZIEND
     C*
     C** INTEREST CALCULATION BETWEEN TWO DATES
     C*
     C                     EXSR INTSR
     C*
     C                     ELSE                            - X1
     C*
     C                     Z-ADD0         WDINT
     C                     Z-ADD0         WCINT
      *                                                                   CRE001
     C                     Z-ADD*ZEROS    WWODIA                          CRE001
     C*
     C/COPY WNCPYSRC,RE3662C037
     C                     END                             - E1
     C*
     C                     ENDSR                           **CAPI ENDSR**
      ********************************************************************                    CRE090
      /EJECT                                                                                  CRE090
      ********************************************************************                    CRE090
      *                                                                  *                    CRE090
      *  SRDLAY - Check accounts for delay                               *                    CRE090
      *                                                                  *                    CRE090
      ********************************************************************                    CRE090
     C           SRDLAY    BEGSR                                                              CRE090
      *                                                                                       CRE090
      ** Check the account's Delay Capitalisation Days from GLACNTL4.                         CRE090
      *                                                                                       CRE090
     C                     MOVE CNUM      F1CNUM                                              CRE090
     C                     MOVE CCY       F1CCY                                               CRE090
     C                     Z-ADDACOD      F1ACOD                                              CRE090
     C                     Z-ADDACSQ      F1ACSQ                                              CRE090
     C                     MOVE BRCA      F1BRCA                                              CRE090
     C           KACEX     CHAINGLACNTL4             81                                       CRE090
     C           *IN81     IFEQ *OFF                                                          CRE090
     C                     Z-ADDF1DECD    WDLYDY                                              CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
      *                                                                                       CRE090
     C           WDLYDY    IFGT *ZERO                                                         CRE090
      *                                                                                       CRE090
     C                     Z-ADD*ZEROS    DYNBR                                               CRE090
     C                     Z-ADD*ZEROS    DAYNO                                               CRE090
     C                     Z-ADD*ZEROS    NRDYS                                               CRE090
     C                     MOVE BJLCCY    ZCCY                                                CRE090
     C                     MOVE BJSLCD    ZLOC                                                CRE090
      *                                                                                       CRE090
     C           NDID      IFGT 0                                                             CRE090
      *                                                                                       CRE090
     C                     Z-ADDNDID      DAYNO                                               CRE090
     C                     Z-ADDWDLYDY    NRDYS                                               CRE090
      *                                                                                       CRE090
     C                     CALL 'ZFWDT'                                                       CRE090
     C                     PARM           DAYNO                                               CRE090
     C                     PARM           NRDYS                                               CRE090
     C                     PARM           DYNBR                                               CRE090
     C                     PARM           ZCCY                                                CRE090
     C                     PARM           ZLOC                                                CRE090
      *                                                                                       CRE090
     C                     Z-ADDDYNBR     WDCAPD                                              CRE090
      *                                                                                       CRE090
     C                     ELSE                                                               CRE090
      *                                                                                       CRE090
     C                     Z-ADD*ZERO     WDCAPD                                              CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C           NCID      IFGT 0                                                             CRE090
      *                                                                                       CRE090
     C                     Z-ADDNCID      DAYNO                                               CRE090
     C                     Z-ADDWDLYDY    NRDYS                                               CRE090
      *                                                                                       CRE090
     C                     CALL 'ZFWDT'                                                       CRE090
     C                     PARM           DAYNO                                               CRE090
     C                     PARM           NRDYS                                               CRE090
     C                     PARM           DYNBR                                               CRE090
     C                     PARM           ZCCY                                                CRE090
     C                     PARM           ZLOC                                                CRE090
      *                                                                                       CRE090
     C                     Z-ADDDYNBR     WCCAPD                                              CRE090
      *                                                                                       CRE090
     C                     ELSE                                                               CRE090
      *                                                                                       CRE090
     C                     Z-ADD*ZERO     WCCAPD                                              CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
      *                                                                                       CRE090
      ** The capitalization delay will only be applied to accounts                            CRE090
      ** whose defined delay capitalisation days is greater than                              CRE090
      ** zero.                                                                                CRE090
      **                                                                                      CRE090
      ** But excluding these instances:                                                       CRE090
      **                                                                                      CRE090
      **  o  Computed Next capitalisation date is equal to or                                 CRE090
      **     less than delayed date of capitalisation                                         CRE090
      **  o  Closure capitalisation (BDICI/BCICI = 'C')                                       CRE090
      **  o  Demand capitalisation (BDICI/BCICI = 'D')                                        CRE090
      **  o  Management capitalisation (BDICI/BCICI = 'M')                                    CRE090
      *                                                                                       CRE090
     C                     EXSR NXCAP                                                         CRE090
      *                                                                                       CRE090
     C           ACKEY1    CHAINACCNT                99                                       CRE090
     C                     MOVE DDIS      WDDIS                                               CRE090
     C                     MOVE CDIS      WCDIS                                               CRE090
     C           BDICI     IFEQ 'Y'                                                           CRE090
     C           WDCAPD    ANDLTWNXDID                                                        CRE090
     C           WDCAPD    ANDNE0                                                             CRE090
     C           WDCAPD    ANDGTCTLDAT                                                        CRE090
     C                     MOVE 'Y'       WDRDLY                                              CRE090
     C                     MOVE *BLANKS   BDICI                                               CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C           BCICI     IFEQ 'Y'                                                           CRE090
     C           WCCAPD    ANDLTWNXCID                                                        CRE090
     C           WCCAPD    ANDNE0                                                             CRE090
     C           WCCAPD    ANDGTCTLDAT                                                        CRE090
     C                     MOVE 'Y'       WCRDLY                                              CRE090
     C                     MOVE *BLANKS   BCICI                                               CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C                     ENDSR                                                              CRE090
      ********************************************************************                    CRE090
      /EJECT                                                                                  CRE090
      ********************************************************************                    CRE090
      **                                                                 *                    CRE090
      ** NXCAP - Compute the next capitalisation days based on frequency *                    CRE090
      **                                                                 *                    CRE090
      ********************************************************************                    CRE090
     C           NXCAP     BEGSR                                                              CRE090
      *                                                                                       CRE090
     C                     Z-ADD*ZERO     WNXDID                                              CRE090
     C                     Z-ADD*ZERO     WNXCID                                              CRE090
      *                                                                                       CRE090
     C           BDICI     IFNE 'C'                                                           CRE090
     C           BDICI     ANDNE'D'                                                           CRE090
      *                                                                                       CRE090
     C                     Z-ADDNDID      WLDID                                               CRE090
     C                     Z-ADDNDID      ZDAYNO                                              CRE090
     C                     Z-ADDDRDY      ZMDAY                                               CRE090
     C                     MOVE BJLCCY    ZCCY                                                CRE090
     C                     MOVE BJSLCD    ZLOC                                                CRE090
     C                     MOVE DRIF      ZFREQ                                               CRE090
      *                                                                                       CRE090
     C           ZFREQ     IFNE 'Z'                                                           CRE090
     C           ZFREQ     ANDNE'A'                                                           CRE090
      *                                                                                       CRE090
     C           ZDAYNO    DOWLTWDNWD                                                         CRE090
     C                     EXSR ZFRQA                                                         CRE090
     C                     ENDDO                                                              CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C           ZFREQ     IFEQ 'Z'                                                           CRE090
     C                     Z-ADD*ZERO     ZDAYNO                                              CRE090
     C                     ENDIF                                                              CRE090
     C                     Z-ADDZDAYNO    WNXDID                                              CRE090
      *                                                                                       CRE090
      ** If Capitalisation Frequency is 'A', calculate the next accrual                       CRE090
      ** profit date and make that as the next interest capitalisation                        CRE090
      ** date.                                                                                CRE090
      *                                                                                       CRE090
     C           ZFREQ     IFEQ 'A'                                                           CRE090
     C                     MOVE BKAPFQ    ZFREQ                                               CRE090
     C                     MOVE BJLCCY    ZCCY                                                CRE090
     C                     MOVE BJSLCD    ZLOC                                                CRE090
     C                     MOVE BKAPFD    ZMDAY                                               CRE090
     C                     Z-ADDBKAPDT    ZDAYNO                                              CRE090
     C                     EXSR ZFRQA                                                         CRE090
     C                     Z-ADDZDAYNO    WNXDID                                              CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C           BCICI     IFNE 'C'                                                           CRE090
     C           BCICI     ANDNE'D'                                                           CRE090
      *                                                                                       CRE090
     C                     Z-ADDNCID      WLCID                                               CRE090
     C                     Z-ADDNCID      ZDAYNO                                              CRE090
     C                     Z-ADDCRDY      ZMDAY                                               CRE090
     C                     MOVE BJLCCY    ZCCY                                                CRE090
     C                     MOVE BJSLCD    ZLOC                                                CRE090
     C                     MOVE CRIF      ZFREQ                                               CRE090
      *                                                                                       CRE090
     C           ZFREQ     IFNE 'Z'                                                           CRE090
     C           ZFREQ     ANDNE'A'                                                           CRE090
      *                                                                                       CRE090
     C           ZDAYNO    DOWLTWDNWD                                                         CRE090
     C                     EXSR ZFRQA                                                         CRE090
     C                     ENDDO                                                              CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C           ZFREQ     IFEQ 'Z'                                                           CRE090
     C                     Z-ADD*ZERO     ZDAYNO                                              CRE090
     C                     ENDIF                                                              CRE090
     C                     Z-ADDZDAYNO    WNXCID                                              CRE090
      *                                                                                       CRE090
      ** If Capitalisation Frequency is 'A', calculate the next accrual                       CRE090
      ** profit date and make that as the next interest capitalisation                        CRE090
      ** date.                                                                                CRE090
      *                                                                                       CRE090
     C           ZFREQ     IFEQ 'A'                                                           CRE090
     C                     MOVE BKAPFQ    ZFREQ                                               CRE090
     C                     MOVE BJLCCY    ZCCY                                                CRE090
     C                     MOVE BJSLCD    ZLOC                                                CRE090
     C                     MOVE BKAPFD    ZMDAY                                               CRE090
     C                     Z-ADDBKAPDT    ZDAYNO                                              CRE090
     C                     EXSR ZFRQA                                                         CRE090
     C                     Z-ADDZDAYNO    WNXCID                                              CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C                     ENDSR                                                              CRE090
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CHGPR subroutine to charges processing
     C**
     C**     Called by       SCRPR
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           CHGPR     BEGSR                           **CHGPR BEGSR**
     C*
     C** SETUP MINIMUM BALANCE OF THE PERIOD
     C*
     C                     Z-ADD*ZEROS    MINC
     C                     Z-ADD*HIVAL    MAXC
     C                     Z-ADDWMNBCP    MNBCP
     C*
     C** ACCESS RECRG FILE
     C*
     C           CHKEY     CHAINRECRG                99
     C*
     C** ERROR IN RECRG
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD20        DBASE            ***************
     C                     MOVE 'RECRG'   DBFILE           **DB ERROR 20**
     C                     MOVELCHKEY     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3662C024
     C*
      * Rebate should not be applied if min. bal. is DR or if no rebate   101827
      * details exist (per min. bal. is 0) or if min. bal. is CR but      101827
      * the unsigned amount is less than the excluding balance amount.    101827
      * Also do not apply at closure capitalisation.                      153001
     C                     Z-SUBMNBCP     UMNBCP                          101827
      *                                                                   101827
     C/COPY WNCPYSRC,RE3662C020
     C           MNBCP     IFGE *ZEROS                     - B1
     C***********PERM      ANDEQ*ZEROS                                    101827
     C           PERM      OREQ *ZEROS                                    101827
     C***********MNBCP     ANDGEEXBL                                      101827
     C           UMNBCP    ORLT EXBL                                      101827
     C           BCICI     OREQ 'C'                                       153001
     C*
     C                     Z-ADDWCHGAR    CHGP
     C*
     C* TO AVOID DIVIDE BY ZERO CODING TO BE REVIEWED
     C*
     C                     ELSE
     C*
     C** CALCULATE REBATE CHARGES
     C*
     C           MNBCP     ADD  EXBL      REBATE
     C           REBATE    DIV  PERM      REBATE    H
     C           REBATE    MULT REB       REBATE
     C/COPY WNCPYSRC,RE3662C021
     C           WCHGAR    ADD  REBATE    CHGP
     C*
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3662C025
     C*
     C           CHGP      IFLT *ZEROS                     - B1
     C                     Z-ADD*ZEROS    CHGP
     C                     END                             - E1
     C*
     C           CHGP      ADD  WCHGAN    CHGP
      *                                                                   153001
      * Do not apply minimum or maximum at closure capitalisation.        153001
     C           BCICI     IFNE 'C'                                       153001
     C*
     C/COPY WNCPYSRC,RE3662C022
     C           CHGP      IFLT MINC                       - B1
     C                     Z-ADDMINC      CHGP
     C                     MOVE 'L'       SCHGI
     C                     END                             - E1
     C*
     C           CHGP      IFGT MAXC                       - B1
     C                     Z-ADDMAXC      CHGP
     C                     MOVE 'O'       SCHGI
     C                     END                             - E1
      *                                                                   153001
     C                     ENDIF                                          153001
      *                                                                   153001
     C/COPY WNCPYSRC,RE3662C023
     C*
     C                     MOVE CHAC      SCHAC
     C                     MOVE CHBR      SCHBR
     C*
     C           SCHGI     IFEQ *BLANKS                    - B1
     C           CHGP      IFNE *ZEROS                     - B2
     C           CHAC      IFNE *BLANKS                    - B3
     C                     MOVE 'A'       SCHGI
     C*
     C                     ELSE                            - X3
     C*
     C           KVDATE    IFLE CTLDAT                     - B4
     C                     MOVE 'Y'       SCHGI
     C*
     C                     ELSE                            - X4
     C*
     C                     MOVE 'I'       SCHGI
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           SCHGI     IFEQ 'L'                        - B1
     C           CHGP      IFNE *ZEROS                     - B2
     C           CHAC      IFNE *BLANKS                    - B3
     C                     MOVE 'P'       SCHGI
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           SCHGI     IFEQ 'O'                        - B1
     C           CHGP      IFNE *ZEROS                     - B2
     C           CHAC      IFNE *BLANKS                    - B3
     C                     MOVE 'Q'       SCHGI
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     ENDSR                           **CHGPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CREPR subroutine to execute credit capitalisation
     C**
     C**     Called by       TOTAC
     C**     Calls           INTSR,OUTPOS,SCRPR,SETUP,WKSET
     C**
      *****************************************************************   CCB003
     C           CREPR     BEGSR                           **CREPR BEGSR**
     C*
     C                     Z-ADDCNCID     ZIEND
     C*
     C** INTEREST CALCULATION BETWEEN TWO DATES
     C*
     C                     EXSR INTSR
      *                                                                                       CRE090
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           WCRDLY    ANDEQ'Y'                                                           CRE090
     C                     ADD  WDINT     WACCDR                                              CRE090
     C                     ADD  WCINT     WACCCR                                              CRE090
     C                     GOTO CPRTAG                                                        CRE090
     C                     ENDIF                                                              CRE090
     C*
     C                     Z-ADDCNCID     KVDATE
     C*
     C** CAPITALISATION RECORD PREPARATION PROCESSING
     C*
     C                     EXSR SETUP
     C*
     C** CREDIT CAPITALISATION RECORD PREPARATION
     C*
     C                     EXSR SCRPR
     C*
     C** OUTPUT CAPITALISATION RECORD FOR PRINT
     C*
     C                     Z-ADDWPDID     MPDID
     C                     Z-ADDWPCID     MPCID
     C                     Z-ADDCRIC      WCRCB                           054346
     C                     EXCPTOUTM
     C/COPY WNCPYSRC,RE3662C038
     C*
     C** OUTPUT CAPITALISATION RECORD ONLY IF NOT MANAGEMENT
     C*
     C           BCICI     IFNE 'M'                        - B1
     C                     Z-ADDCAIC      WTCINT
     C*
     C                     Z-ADD*ZERO     MNBCP
     C                     Z-ADD*ZERO     TEGLIS
     C                     Z-ADD*ZERO     DEXRT
     C                     Z-ADD*ZERO     CEXRT
     C                     Z-ADD*ZERO     CHXRT
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDWWAODR    AODR                            CRE001
     C                     Z-ADDWWODLN    ODRL                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C           SFOUND    IFNE 'C'                                      085330
     C                     EXCPTOUTS
     C/COPY WNCPYSRC,RE3662C016
     C                     END                                           085330
     C*
     C                     Z-ADD*ZEROS    WTMACI
      *                                                                   108931
      * Save capitalised charges for updating REIAC                       108931
     C                     Z-ADDWCHGAN    CCHGAN                          108931
     C                     Z-ADDWCHGAR    CCHGAR                          108931
     C                     Z-ADD*ZEROS    WCHGAN                          108931
     C                     Z-ADD*ZEROS    WCHGAR                          108931
      *                                                                   108931
     C                     Z-ADDCNCID     WPCID
     C                     Z-ADDWHISB     BFCR
      *                                                                                       233563
      ** Accumulate interest in total for EUSD or BRT                                         233563
      *                                                                                       233563
     C           S01383    IFEQ 'Y'                                                           233563
     C           SCCI      ANDEQ'Y'                                                           233563
     C           CGL031    OREQ 'Y'                                                           233563
     C********** SCCI      ANDEQ'Y'                                                    233563 234003
     C           CGL032    OREQ 'Y'                                                           233563
     C********** SCCI      ANDEQ'Y'                                                    233563 234003
     C                     ADD  CAIC      WINTC                                               233563
     C                     ENDIF                                                              233563
     C*
     C           SCCI      IFEQ 'Y'                        - B2
     C           SCHGI     OREQ 'Y'
     C           SCHGI     OREQ 'L'
     C           KVDATE    ANDLECTLDAT                                    102667
     C           SCHGI     OREQ 'O'
     C           KVDATE    ANDLECTLDAT                                    102667
      *                                                                   130468
     C           S01383    OREQ 'Y'                                       130468
     C           KVDATE    ANDLECTLDAT                                    130468
     C           WINTC     ANDGT*ZERO                                     130468
     C           CACP      ANDEQ*BLANKS                                   130468
      *                                                                   130468
     C           CGL031    OREQ 'Y'                                                           233563
     C********** KVDATE    ANDLECTLDAT                                                 233563 234003
     C********** NCID      ANDLEBJRDNB                                                 234003 234628
     C********** NCID      ANDLTWDNWD                                                  234628 236061
     C           WINTC     ANDGT*ZERO                                                         233563
     C********** CACP      ANDEQ*BLANKS                                              233563 AR851468
      *                                                                                       233563
     C           CGL032    OREQ 'Y'                                                           233563
     C********** KVDATE    ANDLECTLDAT                                                 233563 234003
     C********** NCID      ANDLEBJRDNB                                                 234003 234628
     C********** NCID      ANDLTWDNWD                                                  234628 236061
     C           WINTC     ANDGT*ZERO                                                         233563
     C********** CACP      ANDEQ*BLANKS                                              233563 AR851468
      *                                                                                       233563
      **Accumulate*interest*in*total*for*BRT******************************             130468 233563
     C********** S01383    IFEQ 'Y'                                                    130468 233563
     C********** SCCI      ANDEQ'Y'                                                    130468 233563
     C**********           ADD  CAIC      WINTC                                        130468 233563
     C**********           END                                                         130468 233563
      *                                                                                       234003
      ** Take into account EU Withholding Tax if necessary.                                   234003
      *                                                                                       234003
     C           CGL031    IFEQ 'Y'                                                           234003
     C           CGL032    OREQ 'Y'                                                           234003
     C********** NCID      IFLE BJRDNB                                                 234003 234628
     C********** NCID      IFLT WDNWD                                                  234628 236061
     C           SCICI     IFNE ' '                                                           236061
     C           SCICI     ANDNE'M'                                                           236061
     C           WINTC     ANDGT*ZERO                                                         234003
     C********** CACP      ANDEQ*BLANKS                                              234003 AR851468
     C           SCCI      ANDNE'L'                                                           235329
     C           SCCI      ANDNE'O'                                                           235329
     C           SCCI      ANDNE'S'                                                           235329
     C                     Z-ADDCLCID     PSTRD                                               235875
     C                     Z-ADDCNCID     PENDD                                               235875
     C                     Z-ADDWINTC     PTOTI                                               235875
     C                     EXSR SREUTX                                                        234003
     C**********           ADD  WEUWT     WHISB                                      234003 AR744574
     C********** CER048    IFEQ 'Y'                                                  CER048 AR744574
     C**********           ADD  WSTXA     WHISB                                      CER048 AR744574
     C**********           ENDIF                                                     CER048 AR744574
      **********                                                                     CER054 AR744574
     C********** CER054    IFEQ 'Y'                                                  CER054 AR744574
     C**********           ADD  WTTXA     WHISB                                      CER054 AR744574
     C**********           ENDIF                                                     CER054 AR744574
     C                     ENDIF                                                              234003
     C                     ENDIF                                                              234003
     C*
     C           KVDATE    IFEQ HISD                       - B3
     C*
     C           SCCI      IFEQ 'Y'                        - B4
     C*
      *                                                                                       CDL013
      ** If CDL013 installed, calculate WHT amount                                            CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
     C                     Z-ADDCAIC      WINTC                                               CDL013
     C                     Z-ADDDAIC      WINTD  150                                          CDL013
     C                     EXSR #ECALC                                                        CDL013
      *                                                                                       CDL013
      ** If CDL013 NOT installed                                                              CDL013
     C                     ELSE                                                               CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP3                                           S01408
     C*                                                                   S01408
     C********** S01383    IFEQ 'Y'                                088932 130468
     C**********           Z-ADDCAIC      WINTC                    088932 130468
     C**********           EXSR BRTPRO                             088932 130468
     C**********           SUB  NETBRT    WHISB                    088932 130468
     C**********           ELSE                                    088932 130468
     C                     SUB  CAIC      WHISB
     C**********           END                                     088932 130468
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP4                                           S01408
     C*                                                                   S01408
     C           CACP      IFEQ *BLANKS                                                     AR851468
     C           CGL031    IFEQ 'Y'                                                         AR744574
     C           CGL032    OREQ 'Y'                                                         AR744574
     C                     ADD  WEUWT     WHISB                                             AR744574
     C           CER048    IFEQ 'Y'                                                         AR744574
     C                     ADD  WSTXA     WHISB                                             AR744574
     C                     ENDIF                                                            AR744574
      *                                                                                     AR744574
     C           CER054    IFEQ 'Y'                                                         AR744574
     C                     ADD  WTTXA     WHISB                                             AR744574
     C                     ENDIF                                                            AR744574
     C                     END                                                              AR744574
     C                     ENDIF                                                            AR851468
     C*
     C                     END                             - E4
      *                                                                   130468
      * Update history with BRT on total interest and CR adjs. if req'd   130468
     C           S01383    IFEQ 'Y'                                       130468
     C           KVDATE    ANDLECTLDAT                                    130468
     C           WINTC     ANDGT*ZERO                                     130468
     C           CACP      ANDEQ*BLANKS                                   130468
     C                     EXSR BRTPRO                                    130468
     C                     ADD  BRTAMT    WHISB                           130468
     C                     END                                            130468
      *****************************************************************                CGL031 234003
      ***Take*into*account*EU*Withholding*Tax*if*necessary.************                CGL031 234003
      *****************************************************************                CGL031 234003
     C********** CGL031    IFEQ 'Y'                                                    CGL031 234003
     C********** CGL032    OREQ 'Y'                                                    CGL031 234003
     C********** KVDATE    IFLE CTLDAT                                                 CGL031 234003
     C********** WINTC     ANDGT*ZERO                                                  CGL031 234003
     C********** CACP      ANDEQ*BLANKS                                                CGL031 234003
     C**********           EXSR SREUTX                                                 CGL031 234003
     C**********           ADD  WEUWT     WHISB                                        CGL031 234003
     C**********           ENDIF                                                       CGL031 234003
     C**********           ENDIF                                                       CGL031 234003
     C*
     C           SCHGI     IFEQ 'Y'                        - B4
     C           SCHGI     OREQ 'L'
     C           SCHGI     OREQ 'O'
     C*
     C                     ADD  CHGP      WHISB
     C*
     C                     END                             - E4
     C*
     C                     ELSE                            - X3
     C*
     C** NEW INTEREST POSTING RECORD CREATION
     C*
     C                     EXSR OUTPOS
      **********                                                                  BUG23310 BUG23310A
      ***Update the principal amount of customer income                           BUG23310 BUG23310A
      **********                                                                  BUG23310 BUG23310A
     C********** CGL031    IFEQ 'Y'                                               BUG23310 BUG23310A
     C********** CGL032    OREQ 'Y'                                               BUG23310 BUG23310A
     C********** CSINPD    IFEQ 'Y'                                               BUG23310 BUG23310A
      **********                                                                  BUG23310 BUG23310A
     C**********           MOVE 'N'       CSINPD                                  BUG23310 BUG23310A
     C********** KSDCS     CHAINSDCSINL0             97                           BUG23310 BUG23310A
     C********** *IN97     IFEQ '0'                                               BUG23310 BUG23310A
     C**********           Z-ADDWHISB     TSPAMT                                  BUG23310 BUG23310A
     C**********           Z-ADDWHISB     TSPAMS                                  BUG23310 BUG23310A
      **********                                                                  BUG23310 BUG23310A
     C********** TSOCCY    IFEQ TSTXCY                                            BUG23310 BUG23310A
     C**********           Z-ADDWHISB     TSPAMC                                  BUG23310 BUG23310A
     C**********           ELSE                                                   BUG23310 BUG23310A
     C**********           Z-ADDWHISB     ZAMTF                                   BUG23310 BUG23310A
     C**********           Z-ADDTSXRST    ZCRSRT                                  BUG23310 BUG23310A
     C**********           MOVE TSSTMD    ZCRSMD                                  BUG23310 BUG23310A
     C**********           Z-ADDTSOCDP    ZCDPF                                   BUG23310 BUG23310A
     C**********           Z-ADDTSTCDP    ZCDPT                                   BUG23310 BUG23310A
     C**********           EXSR ZCCYXR                                            BUG23310 BUG23310A
     C**********           Z-ADDZAMTT     TSPAMC                                  BUG23310 BUG23310A
     C**********           ENDIF                                                  BUG23310 BUG23310A
      **********                                                                  BUG23310 BUG23310A
     C********** TSOCCY    IFEQ BJCYCD                                            BUG23310 BUG23310A
     C**********           Z-ADDWHISB     TSPAMB                                  BUG23310 BUG23310A
     C**********           ELSE                                                   BUG23310 BUG23310A
     C**********           Z-ADDWHISB     ZAMTF                                   BUG23310 BUG23310A
     C**********           Z-ADDTSOCSR    ZCRSRT                                  BUG23310 BUG23310A
     C**********           MOVE TSOCMD    ZCRSMD                                  BUG23310 BUG23310A
     C**********           Z-ADDTSOCDP    ZCDPF                                   BUG23310 BUG23310A
     C**********           Z-ADDZCDPF     ZCDPT                                   BUG23310 BUG23310A
     C**********           EXSR ZCCYXR                                            BUG23310 BUG23310A
     C**********           Z-ADDZAMTT     TSPAMB                                  BUG23310 BUG23310A
     C**********           ENDIF                                                  BUG23310 BUG23310A
      **********                                                                  BUG23310 BUG23310A
     C**********           UPDATSDCSINDL                                          BUG23310 BUG23310A
     C**********           ENDIF                                                  BUG23310 BUG23310A
     C**********           ENDIF                                                  BUG23310 BUG23310A
     C**********           ENDIF                                                  BUG23310 BUG23310A
     C*
     C** RESET WORK FIELDS
     C*
     C                     EXSR WKSET
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
      *                                                                   099090
      * Save value of accrued CR interest                                 099090
     C                     Z-ADDCAIC      CCAIC                           099090
     C*
     C/COPY WNCPYSRC,RE3662C039
     C           CPRTAG    TAG                                                                CRE090
     C                     ENDSR                           **CREPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CRINIT subroutine for initialise interest type fields
     C**
     C**     Called by       INITPR
     C**     Calls           CRSET,DBSR
     C**
      *****************************************************************   CCB003
     C           CRINIT    BEGSR                           **CRINIT BEGSR**
     C*
     C           WCICT     IFNE 0                          - B1
     C                     MOVE 'Y'       WC0102                                              CER055
     C*
     C           WRII      IFEQ *BLANK                     - B2
     C           CRCI      OREQ 'Y'
     C*
     C                     Z-ADD*ZEROS    ZIRC
     C                     Z-ADD*ZEROS    ZIBC
     C                     Z-ADD*ZEROS    WCSTYP           INT.SUB-TYPE
     C*
     C** CHAIN TO CREDIT RATE CHANGES FILE
     C*
     C                     Z-ADDCRCD      KDATE
     C*
     C           DCKEY     CHAINREHRCJ               99
     C*
     C** ERROR IN REHRCJ
     C*
     C           *IN99     IFEQ '1'                                                         AR836982
     C           DCKEY     CHAINREHRCJH              99                                     AR836982
     C           *IN99     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA
     C                     Z-ADD12        DBASE            ***************
     C                     MOVE 'REHRCJ'  DBFILE           **DB ERROR 12**
     C                     Z-ADDKDATE     WVDTC            ***************
     C                     MOVELRKEY      DBKEY
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E3
     C                     ENDIF                                                            AR836982
     C*
     C** SETUP WORK CREDIT FIELDS WITH FIELDS READ PROCESSING
     C*
     C                     EXSR CRSET
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **CRINIT ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CRSET subroutine to setup work credit fields with fields read
     C**
     C**     Called by       CRINIT,ITYPIN,PRCC34
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           CRSET     BEGSR                           **CRSET BEGSR**
     C*
     C***        RAT2      IFNE *BLANKS                    - B1           067706
     C****                 MOVELRAT2      WCRAT                           067706
     C           CAT2      IFNE *BLANKS                    - B1           067706
     C                     MOVELCAT2      WCRAT                           067706
     C                     END                             - E1
     C*
     C***        RAT3      IFNE *BLANKS                    - B1           067706
     C****                 MOVE RAT3      WCRAT                           067706
     C           CAT3      IFNE *BLANKS                    - B1           067706
     C                     MOVE CAT3      WCRAT                           067706
     C                     END                             - E1
     C*
     C***        BAL2      IFNE *BLANKS                    - B1           067706
     C****                 MOVELBAL2      WCBAL                           067706
     C           CAL2      IFNE *BLANKS                    - B1           067706
     C                     MOVELCAL2      WCBAL                           067706
     C                     END                             - E1
     C*
     C***        BAL3      IFNE *BLANKS                    - B1           067706
     C****                 MOVE BAL3      WCBAL                           067706
     C           CAL3      IFNE *BLANKS                    - B1           067706
     C                     MOVE CAL3      WCBAL                           067706
     C                     END                             - E1
     C*
     C                     Z-ADDINST      WCSTYP  50       INT.SUB-TYPE
     C*
     C                     ENDSR                           **CRSET ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DATEIN subroutine for date init processing
     C**
     C**     Called by       ITYPIN,PRCC34,PRCD34
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           DATEIN    BEGSR                           **DATEIN BEGSR**
     C*
     C** WORK FIELDS INIT
     C*
     C                     Z-ADD*ZEROS    ZFDTM
     C                     Z-ADD*ZEROS    ZLDTM
     C                     Z-ADD*ZEROS    ZFDNM
     C                     Z-ADD*ZEROS    ZLDNM
      *                                                                                     MD055663
     C           NCAP34    IFEQ 'Y'                                                         MD055663
     C           ZDAYNO    IFEQ PCID                                                        MD055663
     C           ZDAYNO    OREQ PDID                                                        MD055663
     C                     ADD  1         ZDAYNO                                            MD055663
     C                     ENDIF                                                            MD055663
     C                     ENDIF                                                            MD055663
     C*
     C** CALCULATING DATE FROM DAY NUMBER (HISTORY DATE)
     C*
     C** *IN99 SET OFF AS ZDATE2Z2 DOES NOT RESET. ZDATE2Z4 NOT USED.
     C*
     C                     SETOF                     99
     C                     EXSR ZDATE2
      *                                                                   182452
     C                     Z-ADDZYEAR     YRSAVE  20                      182452
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD13        DBASE            ***************
     C                     MOVE 'ZDATE2'  DBFILE           **DB ERROR 13**
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C** CALCULATING FIRST DAY
     C*
     C           *IN98     IFEQ '0'                        - B1           088029
     C                     Z-ADDZDATE     RESULT
     C                     Z-ADD1         ZDAY
     C                     Z-ADDRESULT    ZDATE
     C                     ELSE                            - X1           088029
     C                     Z-ADDZDATE     RESULX                          088029
     C                     Z-ADD1         ZDAYX                           088029
     C                     Z-ADDRESULX    ZDATE                           088029
     C                     END                             - E1           088029
     C                     EXSR ZDATE1
      *                                                                   182452
     C                     Z-ADDYRSAVE    ZYEAR                           182452
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD14        DBASE            ***************
     C                     MOVE 'ZDATE1'  DBFILE           **DB ERROR 14**
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C** CALCULATING FIRST AND LAST DAY OF THIS MONTH
     C*
     C                     Z-ADDZDAYNO    ZFDTM
     C*
     C           *IN98     IFEQ '0'                        - B0           088029
     C           ZMTH      IFEQ 12                         - B1
     C                     Z-ADD1         ZMTH
     C                     ADD  1         ZYEAR
     C                     ELSE                            - X1
     C                     ADD  1         ZMTH
     C                     END                             - E1
     C*
     C                     Z-ADDRESULT    ZDATE
     C                     ELSE                            - X0           088029
     C           ZMTHX     IFEQ 12                         - B1           088029
     C                     Z-ADD1         ZMTHX                           088029
     C                     ADD  1         ZYEARX                          088029
     C                     ELSE                            - X1           088029
     C                     ADD  1         ZMTHX                           088029
     C                     END                             - E1           088029
     C*                                                                   088029
     C                     Z-ADDRESULX    ZDATE                           088029
     C                     END                             - E0           088029
     C                     EXSR ZDATE1
      *                                                                                     MD055663
     C                     Z-ADDYRSAVE    ZYEAR                                             MD055663
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD15        DBASE            ***************
     C                     MOVE 'ZDATE1'  DBFILE           **DB ERROR 15**
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C                     Z-ADDZDAYNO    ZFDNM
     C           ZDAYNO    SUB  1         ZLDTM
     C*
     C** CALCULATING LAST DAY OF NEXT MONTH
     C*
     C           *IN98     IFEQ '0'                        - B0           088029
     C           ZMTH      IFEQ 12                         - B1
     C                     Z-ADD1         ZMTH
     C                     ADD  1         ZYEAR
     C                     ELSE                            - X1
     C                     ADD  1         ZMTH
     C                     END                             - E1
     C*
     C                     Z-ADDRESULT    ZDATE
     C                     ELSE                            - X0           088029
     C           ZMTHX     IFEQ 12                         - B1           088029
     C                     Z-ADD1         ZMTHX                           088029
     C                     ADD  1         ZYEARX                          088029
     C                     ELSE                            - X1           088029
     C                     ADD  1         ZMTHX                           088029
     C                     END                             - E1           088029
     C*                                                                   088029
     C                     Z-ADDRESULX    ZDATE                           088029
     C                     END                             - E0           088029
     C                     EXSR ZDATE1
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD16        DBASE            ***************
     C                     MOVE 'ZDATE1'  DBFILE           **DB ERROR 16**
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           ZDAYNO    SUB  1         ZLDNM
     C*
     C           NCAP34    IFEQ 'Y'                                                         MD055663
     C           ZFDTM     IFEQ WFDCO                                                       MD055663
     C           ZLDTM     SUB  1         ZLDTM                                             MD055663
     C           ZFDNM     SUB  1         ZFDNM                                             MD055663
     C           ZLDNM     SUB  1         ZLDNM                                             MD055663
     C                     ENDIF                                                            MD055663
     C           ZFDTM     IFGT WLDCO                                                       MD055663
     C           ZFDTM     SUB  1         ZFDTM                                             MD055663
     C           ZLDTM     SUB  1         ZLDTM                                             MD055663
     C           ZFDNM     SUB  1         ZFDNM                                             MD055663
     C           ZLDNM     SUB  1         ZLDNM                                             MD055663
     C                     ENDIF                                                            MD055663
     C                     ENDIF                                                            MD055663
      *                                                                                     MD055663
     C                     ENDSR                           **DATEIN ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DBSR subroutine for database error handling
     C**
     C**     Called by       CRINIT,DATEIN,DRINIT,FIRST,ITYPIN,MAIN,REMSR,REHSR
     C**                     ZICD,CHGPR
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           DBSR      BEGSR                           **DBSR BEGSR**
     C*
     C                     OPEN RE3662AU                                  CCB003
     C                     WRITEHEADAU                                    CCB003
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     WRITEERRAU
     C                     CLOSERE3662AU                                  CCB003
     C*
     C***********          WRITEERRP1                                     CCB003
     C*
     C                     DUMP
     C*
     C                     RETRN
     C*
     C                     ENDSR                           **DBSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DEBPR subroutine to execute debit capitalisation
     C**
     C**     Called by       TOTAC
     C**     Calls           INTSR,OUTPOS,SDRPR,SETUP,WKSET
     C**
      *****************************************************************   CCB003
     C           DEBPR     BEGSR                           **DEBPR BEGSR**
     C*
     C                     Z-ADDCNDID     ZIEND
     C*
     C** INTEREST CALCULATION BETWEEN TWO DATES
     C*
     C                     EXSR INTSR
      *                                                                                       CRE090
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           WDRDLY    ANDEQ'Y'                                                           CRE090
     C                     ADD  WDINT     WACCDR                                              CRE090
     C                     ADD  WCINT     WACCCR                                              CRE090
     C                     GOTO DPRTAG                                                        CRE090
     C                     ENDIF                                                              CRE090
     C*
     C                     Z-ADDCNDID     KVDATE
     C*
     C** CAPITALISATION RECORD PREPARATION PROCESSING
     C*
     C                     EXSR SETUP
     C*
     C** DEBIT CAPITALISATION RECORD PREPARATION
     C*
     C                     EXSR SDRPR
     C*
     C** OUTPUT CAPITALISATION RECORD FOR PRINT
     C*
     C                     Z-ADDWPDID     MPDID
     C                     Z-ADDWPCID     MPCID
     C                     Z-ADDDRIC      WDRCB                           054346
     C                     EXCPTOUTM
     C/COPY WNCPYSRC,RE3662C040
     C*
     C** OUTPUT CAPITALISATION RECORD ONLY IF NOT MANAGEMENT
     C*
     C           BDICI     IFNE 'M'                        - B1
     C*
     C                     Z-ADDDAIC      WTDINT
     C*
     C** OUTPUT CAPITALISATION RECORD
     C*
     C                     Z-ADD*ZERO     MNBCP
     C                     Z-ADD*ZERO     TEGLIS
     C                     Z-ADD*ZERO     DEXRT
     C                     Z-ADD*ZERO     CEXRT
     C                     Z-ADD*ZERO     CHXRT
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDWWAODR    AODR                            CRE001
     C                     Z-ADDWWODLN    ODRL                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C           SFOUND    IFNE 'C'                                      085330
     C                     EXCPTOUTS
     C/COPY WNCPYSRC,RE3662C017
     C                     END                                           085330
     C*
     C                     Z-ADD*ZEROS    WTMADI
     C                     Z-ADDCNDID     WPDID
     C                     Z-ADDWHISB     BFDR
     C*
     C           SDCI      IFEQ 'Y'                        - B2
     C*
     C           KVDATE    IFEQ HISD                       - B3
     C*
     C                     ADD  DAIC      WHISB
     C*
     C                     ELSE                            - X3
     C*
     C** NEW INTEREST POSTING RECORD CREATION
     C*
     C                     EXSR OUTPOS
     C*
     C** RESET WORK FIELDS
     C*
     C                     EXSR WKSET
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
      *                                                                   099090
      * Save value of accrued DR interest                                 099090
     C                     Z-ADDDAIC      CDAIC                           099090
      *                                                                   099090
     C/COPY WNCPYSRC,RE3662C041
     C           DPRTAG    TAG                                                                CRE090
     C                     ENDSR                           **DEBPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DETPR subroutine to execute detail processing
     C**
     C**     Called by       MAIN
     C**     Calls           CAPI,POSIPR,TOTAC,ZICCR,ZICDR,ZICC34,ZICD34
     C**
      *****************************************************************   CCB003
     C           DETPR     BEGSR                           **DETPR BEGSR**
     C*
     C                     MOVE *ZERO     HISD
     C                     MOVE *BLANK    WRECI
     C*
     C           R2KEY     READEREHISL                   50
     C*
     C** IF RECORD NOT FOUND, TOTAL ACCOUNT PROCESSING
     C** OTHERWISE, DETAIL FOLLOWED BY POSITION RECORDS PROCESSING
     C*
     C                     MOVE 'N'       WDRDLY                                              CRE090
     C                     MOVE 'N'       WCRDLY                                              CRE090
     C                     Z-ADD0         WACCDR                                              CRE090
     C                     Z-ADD0         WACCCR                                              CRE090
     C                     Z-ADDWHISD     BVHISD                                              CRE090
     C                     Z-ADDWHISB     BVHISB                                              CRE090
     C                     MOVE 'N'       SKIPDR  1                                         MD027245
     C                     MOVE 'N'       SKIPCR  1                                         MD027245
     C                     MOVE *BLANKS   WDICI   1                                         MD027245
     C                     MOVE *BLANKS   WCICI   1                                         MD027245
     C                     Z-ADD0         WRKHSD  50                                        MD027245
     C           *IN50     DOWEQ'0'                        - B1
      *                                                                                     MD031299
      ** If Forward Fate consider end of History                                            MD031299
      *                                                                                     MD031299
     C           HISD      IFLE CTLDAT                                                      MD031299
      *                                                                                     MD031299
     C*
      ** Save latest history balance for Management cap.                                      CRE090
      ** request during delay period.                                                         CRE090
      *                                                                                       CRE090
     C           HISD      IFGE BVHISD                                                        CRE090
     C           HISB      ANDNE0                                                             CRE090
     C                     Z-ADDHISD      BVHISD                                              CRE090
     C                     Z-ADDHISB      BVHISB                                              CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                     MD027245
     C                     Z-ADDHISD      WRKHSD                                            MD027245
     C           LDAC      IFNE 'Y'                                                         MD027245
     C                     SUB  1         WRKHSD                                            MD027245
     C                     ENDIF                                                            MD027245
     C/COPY WNCPYSRC,RE3662C042
     C           HISD      IFEQ WHISD                      - B2
     C*
     C                     Z-ADD0         WDINT
     C                     Z-ADD0         WCINT
      *                                                                   CRE001
     C                     Z-ADD*ZEROS    WWODIA                          CRE001
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP15                                           S01408
      *                                                                   S01408
     C*
     C** MAINTAIN MINIMUM BALANCE FOR INTEREST TYPE 03 & 04
     C*
     C           WDICT     IFGT 2                          - B3
     C           WCICT     ORGT 2
     C           WRECI     IFNE 'S'                        - B4
     C           WHISB     ADD  DMVT      MNBL
     C                     SUB  CMVT      MNBL
     C           MNBL      IFGT WMNBL                      - B5
     C           HISD      OREQ WCFDTM                                    182452
     C                     Z-ADDMNBL      WMNBL
     C                     END                             - E5
     C                     END                             - E4
     C                     END                             - E3
     C*
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP14                                           S01408
      *                                                                   S01408
     C                     ELSE                            - X2
     C*
     C           HISD      IFGE CNDID                      - B3
     C           WHISD     ANDLTCNDID
     C/COPY WNCPYSRC,RE3662C086
     C           HISD      ORGE CNCID
     C           WHISD     ANDLTCNCID
     C/COPY WNCPYSRC,RE3662C028
      *                                                                   085330
      * If system is on first day accruals and the a/c is closing on      085330
      * the day after capitalisation, a cap. record for run date will     085330
      * already exist. Do not create a new cap.record if record just      085330
      * read is a cap. rec.                                               085330
     C*
     C** CONTROL DATE CAPITALISATION PROCESSING
     C*
     C           WRECI     IFNE 'S'                                       085330
     C           CRE090    OREQ 'Y'                                                         MD027245
     C           WRECI     ANDEQ'S'                                                         MD027245
     C           CNDID     ANDLTWRKHSD                                                      MD027245
     C           CRE090    OREQ 'Y'                                                         MD027245
     C           WRECI     ANDEQ'S'                                                         MD027245
     C           CNCID     ANDLTWRKHSD                                                      MD027245
      *                                                                                     MD027245
     C           WRECI     IFEQ 'S'                                                         MD027245
     C                     MOVE SDICI     WDICI                                             MD027245
     C                     MOVE SCICI     WCICI                                             MD027245
     C                     ENDIF                                                            MD027245
     C                     Z-ADDHISD      ENDDAT
      *                                                                   091680
      * If closure cap., ensure manual adjustment valued today is         091680
      * processed; it must go on to the cap. record and be zeroised on    091680
      * the 'D' record.                                                   091680
     C           BDICI     IFEQ 'C'                                       091680
     C           HISD      ANDEQCNDID                                     091680
     C                     ADD  MADI      WTMADI                          091680
     C                     ADD  MACI      WTMACI                          091680
     C                     Z-ADD0         MADI                            091680
     C                     Z-ADD0         MACI                            091680
     C                     END                                            091680
      *                                                                   091680
     C                     EXSR CAPI
     C                     ELSE                                           085464
      *                                                                   085464
      * If cap. record read, calculate interest upto cap. date.           085464
     C                     Z-ADDWHISD     ZIBEG                           085464
     C                     Z-ADDHISD      ZIEND                           085464
     C/COPY WNCPYSRC,RE3662C068
     C                     EXSR INTSR                                     085464
     C                     END                                            085330
     C*
     C                     ELSE                            - X3
     C*
     C** INITIALIZE START DATE AND END DATE
     C*
     C                     Z-ADDHISD      ZIEND
     C                     Z-ADDWHISD     ZIBEG
     C*
     C** INTEREST CALCULATION BETWEEN TWO DATES
     C*
     C/COPY WNCPYSRC,RE3662C069
     C                     EXSR INTSR
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C** POSITION RECORDS PROCESSING AND READ AGAIN
     C*
     C                     EXSR POSIPR
      *                                                                                     MD031299
     C                     END                                                              MD031299
      *                                                                                     MD031299
     C*
     C                     MOVE *ZERO     HISD
     C                     MOVE *BLANK    WRECI
     C                     MOVE 'N'       SKIPDR                                            MD027245
     C                     MOVE 'N'       SKIPCR                                            MD027245
     C                     MOVE *BLANKS   WDICI                                             MD027245
     C                     MOVE *BLANKS   WCICI                                             MD027245
     C                     Z-ADD0         WRKHSD                                            MD027245
     C                     MOVE *BLANKS   SFOUND                                            MD027245
     C*
     C           R2KEY     READEREHISL                   50
     C*
     C                     END                             - E1
     C*
     C** TOTAL ACCOUNT PROCESSING
     C*
     C                     EXSR TOTAC
     C*
     C                     ENDSR                           **DETPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DRCRPR subroutine to execute debit and credit capitalisation
     C**
     C**     Called by       TOTAC
     C**     Calls           INTSR,OUTPOS,SCRPR,SDRPR,SETUP,WKSET
     C**
      *****************************************************************   CCB003
     C           DRCRPR    BEGSR                           **DRCRPR BEGSR**
     C*
     C                     Z-ADDCNCID     ZIEND
     C*
     C** INTEREST CALCULATION BETWEEN TWO DATES
     C*
     C                     EXSR INTSR
      *                                                                                       CRE090
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           WCRDLY    IFEQ 'Y'                                                           CRE090
     C********** WDRDLY    OREQ 'Y'                                                  CRE090 MD027245
     C           WDRDLY    ANDEQ'Y'                                                         MD027245
     C                     ADD  WCINT     WACCCR                                              CRE090
     C                     ADD  WDINT     WACCDR                                              CRE090
     C                     GOTO CDRTAG                                                        CRE090
     C                     ENDIF                                                              CRE090
     C                     ENDIF                                                              CRE090
     C*
     C                     Z-ADDCNCID     KVDATE
     C*
     C** CAPITALISATION RECORD PREPARATION PROCESSING
     C*
     C                     EXSR SETUP
     C*
     C** CREDIT CAPITALISATION RECORD PREPARATION
     C*
     C           BCICI     IFNE 'M'                        - B1
     C                     EXSR SCRPR
     C                     Z-ADDWHISB     BFCR
     C                     END                             - E1
     C*
     C** DEBIT CAPITALISATION RECORD PREPARATION
     C*
     C           BDICI     IFNE 'M'                        - B1
     C                     EXSR SDRPR
     C                     Z-ADDWHISB     BFDR
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3662C029
     C** OUTPUT CAPITALISATION RECORD ONLY IF NOT MANAGEMENT
     C*
     C           BCICI     IFNE 'M'                        - B1
     C           BDICI     ORNE 'M'
     C*
     C** OUTPUT CAPITALISATION RECORD
     C*
     C                     Z-ADDDAIC      WTDINT
     C                     Z-ADDCAIC      WTCINT
     C                     Z-ADDDRIC      WDRCB                           054346
     C                     Z-ADDCRIC      WCRCB                           054346
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDWWAODR    AODR                            CRE001
     C           ODLI      IFNE 'Y'                                       CRE001
     C                     Z-ADDWWODLN    ODRL                            CRE001
     C                     ENDIF                                          CRE001
     C                     ENDIF                                          CRE001
     C*
     C           SFOUND    IFNE 'C'                                      085330
     C                     EXCPTOUTS
     C/COPY WNCPYSRC,RE3662C018
     C                     END                                           085330
     C*
     C                     Z-ADD*ZEROS    WTMADI
     C                     Z-ADD*ZEROS    WTMACI
     C                     END                             - E1
     C           BDICI     IFNE 'M'                        - B1
     C           BCICI     ANDNE'M'
     C                     Z-ADDWPDID     MPDID
     C                     Z-ADDWPCID     MPCID
     C                     Z-ADDDRIC      WDRCB                           054346
     C                     Z-ADDCRIC      WCRCB                           054346
     C                     EXCPTOUTM
     C*
     C                     END                             - E1
     C*
     C** CREDIT CAPITALISATION RECORD PREPARATION
     C*
     C           BCICI     IFEQ 'M'                        - B1
     C           BDICI     ANDNE'M'
     C                     EXSR SCRPR
     C                     Z-ADDWPDID     MPDID
     C                     Z-ADDWPCID     MPCID
     C                     Z-ADDCRIC      WCRCB                           054346
     C                     EXCPTOUTM
     C*
     C                     END                             - E1
     C*
     C** DEBIT CAPITALISATION RECORD PREPARATION
     C*
     C           BDICI     IFEQ 'M'                        - B1
     C           BCICI     ANDNE'M'
     C                     EXSR SDRPR
     C                     Z-ADDWPDID     MPDID
     C                     Z-ADDWPCID     MPCID
     C                     Z-ADDDRIC      WDRCB                           054346
     C                     EXCPTOUTM
     C*
     C                     END                             - E1
      *                                                                   108931
      * Save capitalised charges for updating REIAC                       108931
     C           BCICI     IFNE *BLANK                                    108931
     C           BCICI     ANDNE'M'                                       108931
     C                     Z-ADDWCHGAN    CCHGAN                          108931
     C                     Z-ADDWCHGAR    CCHGAR                          108931
     C                     Z-ADD*ZEROS    WCHGAN                          108931
     C                     Z-ADD*ZEROS    WCHGAR                          108931
     C                     END                                            108931
     C*
     C** OUTPUT CAPITALISATION RECORD FOR PRINT
     C*
     C           BDICI     IFEQ 'M'                        - B1
     C           BCICI     ANDEQ'M'
     C                     EXSR SDRPR
     C                     EXSR SCRPR
     C                     Z-ADDWPDID     MPDID
     C                     Z-ADDWPCID     MPCID
     C                     Z-ADDDRIC      WDRCB                           054346
     C                     Z-ADDCRIC      WCRCB                           054346
     C                     EXCPTOUTM
     C*
     C                     END                             - E1
     C           BDICI     IFNE 'M'                        - B1
     C                     Z-ADDCNDID     WPDID
     C                     END                             - E1
     C           BCICI     IFNE 'M'                        - B1
     C                     Z-ADDCNCID     WPCID
     C                     END                             - E1
      *                                                                                       233563
      ** Accumulate interest in total for EUSD or BRT                                         233563
      *                                                                                       233563
     C           S01383    IFEQ 'Y'                                                           233563
     C           SCCI      ANDEQ'Y'                                                           233563
     C           BCICI     ANDEQ'M'                                                           233563
     C           CGL031    OREQ 'Y'                                                           233563
     C********** SCCI      ANDEQ'Y'                                                    233563 234003
     C********** BCICI     ANDEQ'M'                                                    233563 234003
     C           CGL032    OREQ 'Y'                                                           233563
     C********** SCCI      ANDEQ'Y'                                                    233563 234003
     C********** BCICI     ANDEQ'M'                                                    233563 234003
     C                     ADD  CAIC      WINTC                                               233563
     C                     ENDIF                                                              233563
     C*
     C           SDCI      IFEQ 'Y'                        - B1
     C           SCCI      OREQ 'Y'
     C           SCHGI     OREQ 'Y'
     C           SCHGI     OREQ 'L'
     C           KVDATE    ANDLECTLDAT                                    102667
     C           SCHGI     OREQ 'O'
     C           KVDATE    ANDLECTLDAT                                    102667
      *                                                                   130468
     C           S01383    OREQ 'Y'                                       130468
     C           KVDATE    ANDLECTLDAT                                    130468
     C           WINTC     ANDGT*ZERO                                     130468
     C           CACP      ANDEQ*BLANKS                                   130468
      *                                                                   130468
     C           CGL031    OREQ 'Y'                                                           233563
     C********** KVDATE    ANDLECTLDAT                                                 233563 234003
     C********** NCID      ANDLEBJRDNB                                                 234003 234628
     C********** NCID      ANDLTWDNWD                                                  234628 236061
     C           WINTC     ANDGT*ZERO                                                         233563
     C********** CACP      ANDEQ*BLANKS                                              233563 AR851468
      *                                                                                       233563
     C           CGL032    OREQ 'Y'                                                           233563
     C********** KVDATE    ANDLECTLDAT                                                 233563 234003
     C********** NCID      ANDLEBJRDNB                                                 234003 234628
     C********** NCID      ANDLTWDNWD                                                  234628 236061
     C           WINTC     ANDGT*ZERO                                                         233563
     C********** CACP      ANDEQ*BLANKS                                              233563 AR851468
      *                                                                                       233563
      **Accumulate*interest*in*total*for*BRT******************************             130468 233563
     C********** S01383    IFEQ 'Y'                                                    130468 233563
     C********** SCCI      ANDEQ'Y'                                                    130468 233563
     C********** BCICI     ANDNE'M'                                                    130468 233563
     C**********           ADD  CAIC      WINTC                                        130468 233563
     C**********           END                                                         130468 233563
      *                                                                                       234003
      ** Take into account EU Withholding Tax if necessary.                                   234003
      *                                                                                       234003
     C           CGL031    IFEQ 'Y'                                                           234003
     C           CGL032    OREQ 'Y'                                                           234003
     C********** NCID      IFLE BJRDNB                                                 234003 234628
     C********** NCID      IFLT WDNWD                                                  234628 236061
     C           SCICI     IFNE ' '                                                           236061
     C           SCICI     ANDNE'M'                                                           236061
     C           WINTC     ANDGT*ZERO                                                         234003
     C********** CACP      ANDEQ*BLANKS                                              234003 AR851468
     C           SCCI      ANDNE'L'                                                           235329
     C           SCCI      ANDNE'O'                                                           235329
     C           SCCI      ANDNE'S'                                                           235329
     C                     Z-ADDCLCID     PSTRD                                               235875
     C                     Z-ADDCNCID     PENDD                                               235875
     C                     Z-ADDWINTC     PTOTI                                               235875
     C                     EXSR SREUTX                                                        234003
     C**********           ADD  WEUWT     WHISB                                      234003 AR744574
     C********** CER048    IFEQ 'Y'                                                  CER048 AR744574
     C**********           ADD  WSTXA     WHISB                                      CER048 AR744574
     C**********           ENDIF                                                     CER048 AR744574
     C********** CER054    IFEQ 'Y'                                                  CER054 AR744574
     C**********           ADD  WTTXA     WHISB                                      CER054 AR744574
     C**********           ENDIF                                                     CER054 AR744574
     C                     ENDIF                                                              234003
     C                     ENDIF                                                              234003
     C*
     C           KVDATE    IFEQ HISD                       - B2
     C*
     C           SDCI      IFEQ 'Y'                        - B3
     C           BDICI     ANDNE'M'
     C*
     C                     ADD  DAIC      WHISB
     C*
     C                     END                             - E3
     C*
     C           SCCI      IFEQ 'Y'                        - B3
     C           BCICI     ANDNE'M'
     C*
      *                                                                                       CDL013
      ** If CDL013 installed, calculate WHT amount                                            CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
     C                     Z-ADDCAIC      WINTC                                               CDL013
     C                     Z-ADDDAIC      WINTD                                               CDL013
     C                     EXSR #ECALC                                                        CDL013
      *                                                                                       CDL013
      ** If CDL013 NOT installed                                                              CDL013
     C                     ELSE                                                               CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP5                                           S01408
     C*                                                                   S01408
     C********** S01383    IFEQ 'Y'                                088932 130468
     C**********           Z-ADDCAIC      WINTC                    088932 130468
     C**********           EXSR BRTPRO                             088932 130468
     C**********           SUB  NETBRT    WHISB                    088932 130468
     C**********           ELSE                                    088932 130468
     C                     SUB  CAIC      WHISB
     C**********           END                                     088932 130468
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP6                                           S01408
     C*                                                                   S01408
     C           CACP      IFEQ *BLANKS                                                     AR851468
     C           CGL031    IFEQ 'Y'                                                         AR744574
     C           CGL032    OREQ 'Y'                                                         AR744574
     C                     ADD  WEUWT     WHISB                                             AR744574
     C           CER048    IFEQ 'Y'                                                         AR744574
     C                     ADD  WSTXA     WHISB                                             AR744574
     C                     ENDIF                                                            AR744574
     C           CER054    IFEQ 'Y'                                                         AR744574
     C                     ADD  WTTXA     WHISB                                             AR744574
     C                     ENDIF                                                            AR744574
     C                     ENDIF                                                            AR744574
     C                     ENDIF                                                            AR851468
     C*
     C                     END                             - E3
      *                                                                   130468
      * Update history with BRT on total interest and CR adjs. if req'd   130468
     C           S01383    IFEQ 'Y'                                       130468
     C           BCICI     ANDNE'M'                                       130468
     C           KVDATE    ANDLECTLDAT                                    130468
     C           WINTC     ANDGT*ZERO                                     130468
     C           CACP      ANDEQ*BLANKS                                   130468
     C                     EXSR BRTPRO                                    130468
     C                     ADD  BRTAMT    WHISB                           130468
     C                     END                                            130468
      *****************************************************************                CGL031 234003
      ***Take*into*account*EU*Withholding*Tax*if*necessary.************                CGL031 234003
      *****************************************************************                CGL031 234003
     C********** CGL031    IFEQ 'Y'                                                    CGL031 234003
     C********** CGL032    OREQ 'Y'                                                    CGL031 234003
     C********** BCICI     IFNE 'M'                                                    CGL031 234003
     C********** KVDATE    ANDLECTLDAT                                                 CGL031 234003
     C********** WINTC     ANDGT*ZERO                                                  CGL031 234003
     C********** CACP      ANDEQ*BLANKS                                                CGL031 234003
     C**********           EXSR SREUTX                                                 CGL031 234003
     C**********           ADD  WEUWT     WHISB                                        CGL031 234003
     C**********           ENDIF                                                       CGL031 234003
     C**********           ENDIF                                                       CGL031 234003
     C*
     C           SCHGI     IFEQ 'Y'                        - B3
     C           SCHGI     OREQ 'L'
     C           SCHGI     OREQ 'O'
     C           BCICI     IFNE 'M'
     C*
     C                     ADD  CHGP      WHISB
     C*
     C                     END                             - E3
     C                     END                             - E3
     C*
     C*
     C                     ELSE                            - X2
     C*
     C** NEW INTEREST POSTING RECORD CREATION
     C*
     C           BCICI     IFNE 'M'                        - B3
     C           BDICI     ORNE 'M'
     C                     EXSR OUTPOS
     C*
     C** RESET WORK FIELDS
     C*
     C                     EXSR WKSET
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
      *                                                                   099090
      * Save value of accrued DR & CR interest                            099090
     C                     Z-ADDDAIC      CDAIC                           099090
     C                     Z-ADDCAIC      CCAIC                           099090
     C*
     C/COPY WNCPYSRC,RE3662C043
     C           CDRTAG    TAG                                                                CRE090
     C                     ENDSR                           **DRCRPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DRINIT subroutine for initialise debit rate fields
     C**
     C**     Called by       INITPR
     C**     Calls           DBSR,DRSET
     C**
      *****************************************************************   CCB003
     C           DRINIT    BEGSR                           **DRINIT BEGSR**
     C*
     C           WDICT     IFNE 0                          - B1
     C                     MOVE 'Y'       WC0102                                              CER055
     C*
     C           WRII      IFEQ *BLANK                     - B2
     C           DRCI      OREQ 'Y'
     C*
     C                     Z-ADD*ZEROS    ZIRD
     C                     Z-ADD*ZEROS    ZIBD
     C                     Z-ADD*ZEROS    WDSTYP           INT.SUB-TYPE
     C*
     C** CHAIN TO DEBIT RATE CHANGES FILE
     C*
     C                     Z-ADDDRCD      KDATE
     C*
     C           DCKEY     CHAINREHRDJ               99
     C*
     C                     MOVE KDATE     RDVALD
     C*
     C** ERROR IN REHRDJ
     C*
     C           *IN99     IFEQ '1'                                                         AR836982
     C           DCKEY     CHAINREHRDJH              99                                     AR836982
     C           *IN99     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA
     C                     Z-ADD11        DBASE            ***************
     C                     MOVE 'REHRDJ'  DBFILE           **DB ERROR 11**
     C                     Z-ADDKDATE     WVDTC            ***************
     C                     MOVELRKEY      DBKEY
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E3
     C                     ENDIF                                                            AR836982
     C*
     C** SETUP WORK DEBIT FIELDS WITH FIELDS READ PROCESSING
     C*
     C                     EXSR DRSET
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **DRINIT ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DRSET subroutine to setup work debit fields with fields read
     C**
     C**     Called by       DRINIT,ITYPIN,PRCD34
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           DRSET     BEGSR                           **DRSET BEGSR**
     C*
     C           RAT2      IFNE *BLANKS                    - B1
     C                     MOVELRAT2      WDRAT
     C                     END                             - E1
     C*
     C           RAT3      IFNE *BLANKS                    - B1
     C                     MOVE RAT3      WDRAT
     C                     END                             - E1
     C*
     C           BAL2      IFNE *BLANKS                    - B1
     C                     MOVELBAL2      WDBAL
     C                     END                             - E1
     C*
     C           BAL3      IFNE *BLANKS                    - B1
     C                     MOVE BAL3      WDBAL
     C                     END                             - E1
     C*
     C                     Z-ADDINST      WDSTYP  50       INT.SUB-TYPE
     C*
     C                     ENDSR                           **DRSET ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** FIRST subroutine to execute first cycle.
     C**
     C**     Called by       S T A R T
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           FIRST     BEGSR                           **FIRST BEGSR**
     C*
     C** ACCESS DATA AREA RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C           *NAMVAR   DEFN           EFDT34                                            MD055663
     C                     IN   EFDT34                                                      MD055663
     C*
     C** CHECK MULTIBRANCHING INDICATOR
     C*
     C           MBIN      IFEQ 'Y'
     C                     MOVE '1'       *IN30
     C                     END
     C*
     C* SET UP INDICATOR 98 BASED ON THE DATE FORMAT
     C*
     C           DATF      IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ELSE
     C                     MOVE '0'       *IN98
     C                     END
     C*
     C** PREPARE DBPGM, DBKEY AND DBASE VARIABLES
     C*
     C           *LOCK     IN   LDA
     C                     MOVEL'RE3662'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD0         DBASE
     C                     OUT  LDA
     C*
     C** ACCESS BANK DETAILS (SDBANKPD)
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C** ERROR IN SDBANKPD
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD1         DBASE            ***************
     C                     MOVE 'SDBANKPD'DBFILE           **DB ERROR 01**
     C                     MOVEL@OPTN     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C***OUTPUT*AUDIT*HEADER                                              CCB003
     C***********                                                         CCB003
     C***********          WRITEHEADAU                                    CCB003
     C***********          Z-ADD1         PAGP                            CCB003
     C*
     C** ACCESS GENERAL LEDGER DETAILS (SDGELRPD)
     C*
     C/COPY WNCPYSRC,RE3662C074
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C/COPY WNCPYSRC,RE3662C075
     C*
     C** ERROR IN SDGELRPD
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD2         DBASE            ***************
     C                     MOVE 'SDGELRPD'DBFILE           **DB ERROR 02**
     C                     MOVEL@OPTN     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP12                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C*
     C** ACCESS RETAIL DETAILS  (SDRETLPD)
     C*
     C                     CALL 'AORETLR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDRETL    PARM SDRETL    DSFDY
     C*
     C** ERROR IN SDRETLPD
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD3         DBASE            ***************
     C                     MOVE 'SDRETLPD'DBFILE           **DB ERROR 03**
     C                     MOVEL@OPTN     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
      *                                                                                       234656
      ** Access SDMMODPD to check if Cantonal Tax is used or not                              234656
      *                                                                                       234656
     C                     CALL 'AOMMODR0'                                                    234656
     C                     PARM *BLANKS   @RTCD   7                                           234656
     C                     PARM '*FIRST ' @OPTN   7                                           234656
     C           SDMMOD    PARM SDMMOD    DSFDY                                               234656
     C           @RTCD     IFNE *BLANK                                                        234656
     C           *LOCK     IN   LDA                                                           234656
     C                     MOVEL'SDMMODPD'DBFILE           ***************                    234656
     C                     MOVEL@OPTN     DBKEY            * DBERROR 030 *                    234656
     C                     Z-ADD030       DBASE            ***************                    234656
     C                     OUT  LDA                                                           234656
     C                     EXSR DBSR                                                          234656
     C                     END                                                                234656
     C*                                                                   088932
     C** Access SAR details file to determine if BRT SAR is installed     088932
     C*                                                                   088932
     C                     CALL 'AOSARDR0'                                088932
     C                     PARM '       ' @RTCD                           088932
     C                     PARM '*VERIFY' @OPTN                           088932
     C                     PARM 'S01383'  @SARD   6                       088932
     C*                                                                   088932
     C           @RTCD     IFNE *BLANK                                    088932
     C           @RTCD     ANDNE'*NRF   '                                 088932
     C           *LOCK     IN   LDA                                       088932
     C                     MOVEL'SCSARDPD'DBFILE           ***************088932
     C                     MOVEL@RTCD     DBKEY            * DB ERROR 32 *088932
     C                     Z-ADD32        DBASE            ***************088932
     C                     OUT  LDA                                       088932
     C                     EXSR DBSR                                      088932
     C                     END                                            088932
     C*                                                                   088932
     C           @RTCD     IFEQ *BLANK                                    088932
     C                     MOVEL'Y'       S01383  1                       088932
     C                     END                                            088932
     C*                                                                   088932
     C** If BRT SAR installed                                             088932
     C*                                                                   088932
     C           S01383    IFEQ 'Y'                                       088932
     C*                                                                   088932
     C** Access BRT installatiob control data                             088932
     C*                                                                   088932
     C                     MOVE 'D'       RECI                            088932
     C           RECI      CHAINSDBRTDD0             99    (99 = EOF)     088932
     C*                                                                   088932
     C** Error in SDBRTDPD                                                088932
     C*                                                                   088932
     C           *IN99     IFEQ '1'                                       088932
     C           *LOCK     IN   LDA                                       088932
     C                     MOVEL'SDBRTDPD'DBFILE           ***************088932
     C                     MOVELRECI      DBKEY            * DB ERROR 33 *088932
     C                     Z-ADD33        DBASE            ***************088932
     C                     OUT  LDA                                       088932
     C                     EXSR DBSR                                      088932
     C                     END                                            088932
     C                     END                                            088932
      *                                                                   CRE001
      ** Access SAR Details File to determine if CRE001 is installed      CRE001
      *                                                                   CRE001
     C                     CALL 'AOSARDR0'                                CRE001
     C                     PARM *BLANKS   @RTCD   7                       CRE001
     C                     PARM '*VERIFY' @OPTN                           CRE001
     C                     PARM 'CRE001'  @SARD   6                       CRE001
      *                                                                   CRE001
      ** Handle Datebase Error.                                           CRE001
     C           @RTCD     IFNE *BLANK                                    CRE001
     C           @RTCD     ANDNE'*NRF   '                                 CRE001
     C           *LOCK     IN   LDA                        ***************CRE001
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 25**CRE001
     C                     MOVEL@RTCD     DBKEY            ***************CRE001
     C                     Z-ADD28        DBASE                           CRE001
     C                     OUT  LDA                                       CRE001
     C                     EXSR DBSR                                      CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
      ** CRE001 is installed                                              CRE001
     C           @RTCD     IFEQ *BLANK                                    CRE001
     C                     MOVE 'Y'       CRE001  1                       CRE001
     C                     MOVE '1'       *IN54                           CRE001
     C                     ELSE                                           CRE001
     C                     MOVE 'N'       CRE001                          CRE001
     C                     MOVE '0'       *IN54                           CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     Z-ADD*ZERO     ZZ117  117                      CRE001
     C/COPY WNCPYSRC,RE3662C080
     C                     Z-ADD*ZERO     ZZ100  100                      CRE001
     C/COPY WNCPYSRC,RE3662C081
     C                     Z-ADD*ZERO     ZZ150  150                      CRE001
      *                                                                                       CGL031
      ** Check if CGL031 is enabled.                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD   7                                           CGL031
     C                     PARM '*VERIFY' POPTN   7                                           CGL031
     C                     PARM 'CGL031'  PSARD   6                                           CGL031
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       CGL031  1                                           CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL031                                              CGL031
      *                                                                                       234656
     C           BGNTST    IFEQ 'Y'                                                           234656
     C***********          OPEN SDSTAXPD                                               234656 234870
     C           1         CHAINSDSTAXPD             93                                       234656
     C***********          CLOSESDSTAXPD                                               234656 234870
     C                     END                                                                234656
      *                                                                                       234656
      ** Error in SDSTAXPD                                                                    234656
      *                                                                                       234656
     C           *IN93     IFEQ '1'                                                           234656
     C           *LOCK     IN   LDA                                                           234656
     C                     Z-ADD055       DBASE            ***************                    234656
     C                     MOVEL'SDTAXPD' DBFILE           * DB ERROR 55 *                    234656
     C                     MOVEL*BLANKS   DBKEY            ***************                    234656
     C                     OUT  LDA                                                           234656
     C                     EXSR DBSR                                                          234656
     C                     END                                                                234656
      *                                                                                       234656
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE '*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     MOVEL'CGL031'  DBKEY                                               CGL031
     C                     Z-ADD101       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR DBSR                                                          CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Check if CGL032 is enabled.                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*VERIFY' POPTN                                               CGL031
     C                     PARM 'CGL032'  PSARD                                               CGL031
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       CGL032  1                                           CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL032                                              CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE '*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     MOVEL'CGL032'  DBKEY                                               CGL031
     C                     Z-ADD102       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR DBSR                                                          CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CER048
     C                     CALL 'AOSARDR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*VERIFY' POPTN                                               CER048
     C                     PARM 'CER048'  PSARD                                               CER048
     C           SCSARD    PARM SCSARD    DSFDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANKS                                                       CER048
     C           PRTCD     ANDNE'*NRF    '                                                    CER048
      *                                                                                       CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     MOVE 'SCSARDPD'DBFILE                                              CER048
     C                     MOVEL105       DBASE                                               CER048
     C                     MOVEL'CER048'  DBKEY                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR DBSR                                                          CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           PRTCD     IFEQ *BLANKS                                                       CER048
     C           CGL031    ANDEQ'Y'                                                           CER048
     C                     MOVE 'Y'       CER048  1                                           CER048
     C                     OPEN ACCNTBY0                                                      CER059
     C                     ELSE                                                               CER048
     C                     MOVE 'N'       CER048                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                   CCB003
      ** Access data area CBTASKSP for commit block size                  CCB003
     C           *NAMVAR   DEFN CBTASKSP  CBTASK                          CCB003
     C                     IN   CBTASK                                    CCB003
     C**********           MOVE CMTBLK    #OPTIM  60                                 CCB003 CRE083AY
     C                     MOVE CMTBLK    #OPTIM 100                                        CRE083AY
      *                                                                   CCB003
      ** Set commit counter to 1                                          CCB003
     C                     Z-ADD1         #COMIT  60                      CCB003
      *                                                                                       CDL013
      ** Check if CDL013 is installed                                                         CDL013
     C                     CALL 'AOSARDR0'                                                    CDL013
     C                     PARM *BLANKS   @RTCD   7                                           CDL013
     C                     PARM '*VERIFY' @OPTN   7                                           CDL013
     C                     PARM 'CDL013'  @SARD   6                                           CDL013
     C                     PARM           DSFDY                                               CDL013
      *                                                                                       CDL013
      ** If CDL013 NOT installed, set field to 0                                              CDL013
     C           @RTCD     IFNE *BLANKS                                                       CDL013
     C                     MOVE '0'       CDL013  1                                           CDL013
      *                                                                                       CDL013
      ** If CDL013 installed                                                                  CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C                     MOVE '1'       CDL013                                              CDL013
     C                     MOVEL'RETAIL'  WTYPE  10 P                                         CDL013
      *                                                                                       CDL013
      ** Open files                                                                           CDL013
     C                     OPEN ACCNTBY0                                                      CDL013
     C                     OPEN SDSTAXL1                                                      CDL013
     C                     OPEN SDSTAAL1                                                      CDL013
      *                                                                                       CDL013
      ** Access ICD to determine WHT rate                                                     CDL013
     C           WTYPE     CHAINSDSTAAL1             74                                       CDL013
      *                                                                                       CDL013
      ** If CHAIN failed                                                                      CDL013
     C           *IN74     IFEQ '1'                                                           CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     Z-ADD37        DBASE            ************                       CDL013
     C                     MOVEL'SDSTAAL1'DBFILE           * DBERR 37 *                       CDL013
     C                     MOVELWTYPE     DBKEY            ************                       CDL013
     C                     OUT  LDA                                                           CDL013
     C                     MOVE *OFF      *IN89                                               CDL013
     C                     EXSR DBSR                                                          CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ** Access ICD control record to get Retail Netting Indicator                            CDL013
     C           WTYPE     CHAINSDSTAXL1             74                                       CDL013
      *                                                                                       CDL013
      ** If CHAIN failed                                                                      CDL013
     C           *IN74     IFEQ '1'                                                           CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     Z-ADD38        DBASE            ************                       CDL013
     C                     MOVEL'SDSTAXL1'DBFILE           * DBERR 38 *                       CDL013
     C                     MOVELWTYPE     DBKEY            ************                       CDL013
     C                     OUT  LDA                                                           CDL013
     C                     MOVE *OFF      *IN89                                               CDL013
     C                     EXSR DBSR                                                          CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ** Access Currency Codes to retrieve Base Ccy decimal places                            CDL013
     C                     CALL 'AOCURRR0'                                                    CDL013
     C                     PARM '*MSG   ' @RTCD   7                                           CDL013
     C                     PARM '*KEY   ' @OPTN   7                                           CDL013
     C                     PARM BJCYCD    @CCY    3                                           CDL013
     C           SDCURR    PARM SDCURR    DSSDY                                               CDL013
      *                                                                                       CDL013
      ** If error occured, terminate the program                                              CDL013
     C           @RTCD     IFNE *BLANKS                                                       CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     Z-ADD39        DBASE            ************                       CDL013
     C                     MOVEL'SDCURRPD'DBFILE           * DBERR 39 *                       CDL013
     C                     MOVELBJCYCD    DBKEY            ************                       CDL013
     C                     OUT  LDA                                                           CDL013
     C                     EXSR DBSR                                                          CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ** Store number of decimal places for Base Ccy for later use                            CDL013
     C                     Z-ADDCDP       WNBDP   10                                          CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL081
      ** Check if CDL081 is installed                                                         CDL081
      *                                                                                       CDL081
     C                     MOVE 'N'       CDL081  1                                           CDL081
     C                     CALL 'AOSARDR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM '*VERIFY' POPTN                                               CDL081
     C                     PARM 'CDL081'  PSARD                                               CDL081
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           PRTCD     ANDNE'*NRF   '                                                     CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD056       DBASE                                               CDL081
     C                     MOVE 'SCSARDPD'DBFILE                                              CDL081
     C                     MOVEL'CDL081'  DBKEY                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR DBSR                                                          CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           PRTCD     IFEQ *BLANKS                                                       CDL081
     C                     MOVE 'Y'       CDL081                                              CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Access withholding tax round down system values if CDL081 is on                      CDL081
      *                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C                     CALL 'AOSVALR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM C#BASE    SVALK1 20                                           CDL081
     C                     PARM           SVAL1 200                                           CDL081
     C                     PARM C#NBAS    SVALK2 20                                           CDL081
     C                     PARM           SVAL2 200                                           CDL081
     C                     PARM *BLANK    SVALK3 20                                           CDL081
     C                     PARM           SVAL3 200                                           CDL081
     C                     PARM *BLANK    SVALK4 20                                           CDL081
     C                     PARM           SVAL4 200                                           CDL081
     C                     PARM *BLANK    SVALK5 20                                           CDL081
     C                     PARM           SVAL5 200                                           CDL081
     C                     PARM *BLANK    SVALK6 20                                           CDL081
     C                     PARM           SVAL6 200                                           CDL081
     C                     PARM *BLANK    SVALK7 20                                           CDL081
     C                     PARM           SVAL7 200                                           CDL081
     C                     PARM *BLANK    SVALK8 20                                           CDL081
     C                     PARM           SVAL8 200                                           CDL081
     C                     PARM *BLANK    SVALK9 20                                           CDL081
     C                     PARM           SVAL9 200                                           CDL081
     C                     PARM *BLANK    SVALK0 20                                           CDL081
     C                     PARM           SVAL10200                                           CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD057       DBASE                                               CDL081
     C                     MOVE 'SDSVALPD'DBFILE                                              CDL081
     C           SVAL1     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK1    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C           SVAL2     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK2    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR DBSR                                                          CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Setup tax amount rounding down indicators                                            CDL081
      *                                                                                       CDL081
     C                     MOVELSVAL1     W#BSRD  1                                           CDL081
     C                     MOVELSVAL2     W#NBRD  1                                           CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CRE090
      ** Check if CRE090 is installed                                                         CRE090
      *                                                                                       CRE090
     C                     CALL 'AOSARDR0'                                                    CRE090
     C                     PARM *BLANKS   @RTCD                                               CRE090
     C                     PARM '*VERIFY' @OPTN                                               CRE090
     C                     PARM 'CRE090'  @SARD                                               CRE090
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE090
      *                                                                                       CRE090
     C           @RTCD     IFEQ *BLANKS                                                       CRE090
     C                     MOVEL'Y'       CRE090                                              CRE090
     C                     ELSE                                                               CRE090
     C                     MOVEL'N'       CRE090                                              CRE090
     C                     ENDIF                                                              CRE090
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP2                                           S01408
     C*                                                                   S01408
     C*
     C** INITIALISE CONTROL DATE
     C*
     C                     MOVE DNWD      WDNWD                                               234628
     C                     SUB  1         DNWD
     C********** DNWD      IFLE APDA                       - B1                               CRE090
     C           DNWD      IFLE BKAPDT                     - B1                               CRE090
     C                     Z-ADDDNWD      CTLDAT
     C                     ELSE                            - X1
     C**********           Z-ADDAPDA      CTLDAT                                              CRE090
     C                     Z-ADDBKAPDT    CTLDAT                                              CRE090
     C                     END                             - E1
     C*
     C***********APDA      IFLT DNWD                                086372114049
     C           LDAC      IFEQ 'Y'                        - B1
     C                     Z-ADDCTLDAT    CTFDAT
     C                     ELSE                            - X1
     C           CTLDAT    ADD  1         CTFDAT
     C                     END                             - E1
     C***********          ELSE                                     086372114049
     C***********CTLDAT    ADD  1         CTFDAT                    086372114049
     C***********          END                                      086372114049
     C*
     C** INITIALISE WORK FIELDS
     C*
     C**********           Z-ADD*ZEROS    ZIWRK1 155                                          220323
     C**********           Z-ADD*ZEROS    ZIWRK2 155                                          220323
     C                     Z-ADD*ZEROS    ZIWRK1 309                                          220323
     C                     Z-ADD*ZEROS    ZIWRK2 309                                          220323
     C                     Z-ADD*ZEROS    ZDAYN2  94
     C                     Z-ADD*ZEROS    ZRO117 117
     C***********          Z-ADD*ZEROS    NBRREC                          CCB003
     C                     MOVE *BLANK    WPOSTI
     C                     MOVE *BLANK    WRII
     C                     MOVE *BLANK    ZZ001
     C                     MOVE *BLANK    BLANK1
     C                     MOVE 'D'       ENDK
     C                     MOVE 'D'       CCYZ
     C*
      * Set up index used by ccy arrays                                                       CSC042
     C                     Z-ADD0         ##QNDX                                              CSC042
      *                                                                                       CSC042
      *                                                                                       CER016
      ** Call AOSARDR0 to check for CER016                                                    CER016
      *                                                                                       CER016
     C                     CALL 'AOSARDR0'                                                    CER016
     C                     PARM *BLANKS   PRTCD   7                                           CER016
     C                     PARM '*VERIFY' POPTN   7                                           CER016
     C                     PARM 'CER016'  PSARD   6                                           CER016
     C           SCSARD    PARM SCSARD    DSFDY                                               CER016
      *                                                                                       CER016
     C           PRTCD     IFEQ *BLANKS                                                       CER016
     C                     MOVE 'Y'       CER016  1                                           CER016
     C                     MOVE 'Y'       WFIRST  1                                           CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C                     MOVE 'N'       CER016                                              CER016
     C                     MOVE 'N'       WFIRST                                              CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C           PRTCD     IFNE *BLANKS                                                       CER016
     C           PRTCD     ANDNE'*NRF   '                                                     CER016
      *                                                                                       CER016
     C           *LOCK     IN   LDA                                                           CER016
     C                     MOVEL'CER016'  DBKEY                                               CER016
     C                     MOVEL'SCSARDPD'DBFILE                                              CER016
     C                     Z-ADD106       DBASE                                               CER016
     C                     OUT  LDA                                                           CER016
     C                     EXSR *PSSR                                                         CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
      ** Check if CER054 is enabled                                                           CER054
      *                                                                                       CER054
     C                     CALL 'AOSARDR0'                                                    CER054
     C                     PARM *BLANKS   PRTCD                                               CER054
     C                     PARM '*VERIFY' POPTN                                               CER054
     C                     PARM 'CER054'  PSARD                                               CER054
     C           SCSARD    PARM SCSARD    DSFDY                                               CER054
      *                                                                                       CER054
     C           PRTCD     IFNE *BLANKS                                                       CER054
     C           PRTCD     ANDNE'*NRF    '                                                    CER054
      *                                                                                       CER054
     C           *LOCK     IN   LDA                                                           CER054
     C                     MOVE 'SCSARDPD'DBFILE                                              CER054
     C                     MOVEL105       DBASE                                               CER054
     C                     MOVEL'CER054'  DBKEY                                               CER054
     C                     OUT  LDA                                                           CER054
     C                     EXSR DBSR                                                          CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C           PRTCD     IFEQ *BLANKS                                                       CER054
     C                     MOVE 'Y'       CER054  1                                           CER054
     C                     ELSE                                                               CER054
     C                     MOVE 'N'       CER054                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER055
      ** Check if CER055 is enabled                                                           CER055
      *                                                                                       CER055
     C                     CALL 'AOSARDR0'                                                    CER055
     C                     PARM *BLANKS   PRTCD                                               CER055
     C                     PARM '*VERIFY' POPTN                                               CER055
     C                     PARM 'CER055'  PSARD                                               CER055
     C           SCSARD    PARM SCSARD    DSFDY                                               CER055
      *                                                                                       CER055
     C           PRTCD     IFNE *BLANKS                                                       CER055
     C           PRTCD     ANDNE'*NRF    '                                                    CER055
      *                                                                                       CER055
     C           *LOCK     IN   LDA                                                           CER055
     C                     MOVEL'SCSARDPD'DBFILE                                              CER055
     C                     Z-ADD109       DBASE                                               CER055
     C                     MOVEL'CER055'  DBKEY                                               CER055
     C                     OUT  LDA                                                           CER055
     C                     EXSR DBSR                                                          CER055
      *                                                                                       CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER055
     C           PRTCD     IFEQ *BLANKS                                                       CER055
     C                     MOVE 'Y'       CER055  1                                           CER055
     C                     ELSE                                                               CER055
     C                     MOVE 'N'       CER055                                              CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER054
      ** Define variables for LRU and initializations (RECCY).                              CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADD0         ##ANDX  40                                        CRE083AY
     C           *LIKE     DEFN ##ANDX    #LEAST                                            CRE083AY
     C           *LIKE     DEFN ##ANDX    A                                                 CRE083AY
     C           *LIKE     DEFN ##ANDX    ##ASAV                                            CRE083AY
     C                     Z-ADD300       ##ANDX                                            CRE083AY
     C                     Z-ADD1         #LEAST                                            CRE083AY
      *                                                                                     CRE083AY
      ** Define variables for LRU and initializations (SDLOCN).                             CRE083AY
      *                                                                                     CRE083AY
     C                     Z-ADD0         ##LNDX  40                                        CRE083AY
     C           *LIKE     DEFN ##LNDX    #LEAS2                                            CRE083AY
     C           *LIKE     DEFN ##LNDX    ##LSAV                                            CRE083AY
     C                     Z-ADD20        ##LNDX                                            CRE083AY
     C                     Z-ADD1         #LEAS2                                            CRE083AY
      *                                                                                     CRE083AY
      ** Cache CCY details                                                                  CRE083AY
      *                                                                                     CRE083AY
     C                     EXSR SRCCYC                                                      CRE083AY
      *                                                                                     MD055663
      **  Call AOSVALR0 to check for New Int.Cap. Period Int. Calc. Type 3 and 4            MD055663
      *                                                                                     MD055663
     C                     CALL 'AOSVALR0'                                                  MD055663
     C                     PARM *BLANKS   PRTCD   7                                         MD055663
     C                     PARM WSYSVL    WSVLK1 20                                         MD055663
     C                     PARM           WSVL1 200                                         MD055663
     C                     PARM *BLANKS   WSVLK2 20                                         MD055663
     C                     PARM           WSVL2 200                                         MD055663
     C                     PARM *BLANKS   WSVLK3 20                                         MD055663
     C                     PARM           WSVL3 200                                         MD055663
     C                     PARM *BLANKS   WSVLK4 20                                         MD055663
     C                     PARM           WSVL4 200                                         MD055663
     C                     PARM *BLANKS   WSVLK5 20                                         MD055663
     C                     PARM           WSVL5 200                                         MD055663
     C                     PARM *BLANKS   WSVLK6 20                                         MD055663
     C                     PARM           WSVL6 200                                         MD055663
     C                     PARM *BLANKS   WSVLK7 20                                         MD055663
     C                     PARM           WSVL7 200                                         MD055663
     C                     PARM *BLANKS   WSVLK8 20                                         MD055663
     C                     PARM           WSVL8 200                                         MD055663
     C                     PARM *BLANKS   WSVLK9 20                                         MD055663
     C                     PARM           WSVL9 200                                         MD055663
     C                     PARM *BLANKS   WSVLK0 20                                         MD055663
     C                     PARM           WSVL0 200                                         MD055663
      *                                                                                     MD055663
     C           PRTCD     IFNE *BLANKS                                                     MD055663
     C           WSVL1     ANDEQ'*NRF   '                                                   MD055663
     C                     EXSR *PSSR                                                       MD055663
      *                                                                                     MD055663
     C                     ELSE                                                             MD055663
     C                     MOVELWSVL1     NCAP34  1                                         MD055663
     C                     ENDIF                                                            MD055663
      *                                                                                     MD055663
     C           NCAP34    IFEQ 'Y'                                                         MD055663
     C                     Z-ADDEFFD      @EFFD   50                                        MD055663
     C                     MOVE @EFFD     ZDAYNO                                            MD055663
     C                     EXSR CUTDAT                                                      MD055663
     C                     ENDIF                                                            MD055663
      *                                                                                     MD055663
     C                     ENDSR                           **FIRST ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** INITPR subroutine to execute work fields init processing
     C**
     C**     Called by       MAIN,POSIPR
     C**     Calls           CRINIT,DRINIT,ITYPIN
     C**
      *****************************************************************   CCB003
     C           INITPR    BEGSR                           **INITPR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3662C044
     C** CHARGES CALCULATION
     C*
     C           CHGT      IFNE *ZEROS                     - B1
     C           HISD      IFGT CLCID                      - B2
     C                     Z-ADDMNBCP     WMNBCP
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C                     Z-ADD*ZEROS    WMNBCP
     C*
     C                     END                             - E1
     C*
     C** INIT
     C*
     C                     Z-ADDHISD      WHISD
     C                     Z-ADDTCHGAR    WCHGAR
     C                     Z-ADDTCHGAN    WCHGAN
     C                     Z-ADDTMADI     WTMADI
     C                     Z-ADDTMACI     WTMACI
      *                                                                   182452
      ** Save previous content of DICT and CICT and HISB                  182452
      *                                                                   182452
     C                     Z-ADDWCICT     SVCICT  20                      182452
     C                     Z-ADDWDICT     SVDICT  20                      182452
     C                     Z-ADDHISB      SVHISB 150                      182452
      *                                                                   182452
     C                     Z-ADDHISB      WHISB
     C                     Z-ADDDICT      WDICT
     C                     Z-ADDCICT      WCICT
     C                     Z-ADDDRCD      WDRCD
     C                     Z-ADDCRCD      WCRCD
     C                     Z-ADDDRIR      WDRIR
     C                     Z-ADDCRIR      WCRIR
     C                     Z-ADDDRCB      WDRCB
     C                     Z-ADDCRCB      WCRCB
     C                     Z-ADDDMINT     WDMINT
     C                     Z-ADDCMINT     WCMINT
      *                                                                   CRE001
      ** Initialise Additional Overdraft Rate & Overdraft Line            CRE001
      ** workfields from the values from LF/REHISL                        CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDAODR      WWAODR                          CRE001
     C                     Z-ADDODRL      WWODLN                          CRE001
     C                     ENDIF                                          CRE001
     C*
     C           WRECI     IFNE 'S'                        - B1
     C                     Z-ADDCAID      WCAID
     C                     Z-ADDDAID      WDAID
     C                     Z-ADDPDID      WPDID
     C                     Z-ADDPCID      WPCID
      *                                                                   CRE001
      ** If record is not a Capitalisaction (RECI <> 'S')                 CRE001
      ** initialise Overdraft Interest Amount to Posted                   CRE001
      ** to Overdraft Interest Amount from LF/REHISL                      CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDODIA      WWODIP                          CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C/COPY WNCPYSRC,RE3662C045
     C                     ELSE                            - X1
     C                     MOVE *BLANK    DRCI
     C                     MOVE *BLANK    CRCI
     C*
     C           SDICI     IFNE ' '                        - B2
     C           SDICI     ANDNE'M'                        - B2
     C                     Z-ADDHISD      WPDID
     C                     Z-ADD*ZEROS    WDAID
     C                     Z-ADD*ZEROS    WDMINT
     C                     Z-ADD*ZEROS    WTMADI
      *                                                                   CRE001
      ** If Record is for DR Capitalisation and Not from DR Mgmt.         CRE001
      ** (RECI <> ' ' and RECI <> 'M', then Set Overdraft Interest        CRE001
      ** Amount to be Posted workfield to Zero                            CRE001
      ** Overdraft Interest Amount from LF/REHISL                         CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADD*ZEROS    WWODIP                          CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     ELSE                            - X2
     C                     Z-ADDPDID      WPDID
     C                     Z-ADDDAIC      WDAID
      *                                                                   CRE001
      ** ...otherwise Set Overdraft Interest Amount workfield to          CRE001
      **    Overdraft Interest Amount from LF/REHISL                      CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDODIA      WWODIP                          CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     END                             - E2
     C           SCICI     IFNE ' '
     C           SCICI     ANDNE'M'
     C                     Z-ADDHISD      WPCID
     C                     Z-ADD*ZEROS    WCAID
     C                     Z-ADD*ZEROS    WCMINT
     C                     Z-ADD*ZEROS    WTMACI
     C                     ELSE                            - X2
     C                     Z-ADDPCID      WPCID
     C                     Z-ADDCAIC      WCAID
     C                     END                             - E2
     C*
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP29                                           S01408
      *                                                                   S01408
     C                     END                             - E1
     C*
     C           WDICT     IFLT 3                          - B1
     C*
     C** DEBIT RATE INIT PROCESSING
     C*
     C                     EXSR DRINIT
     C                     END                             - E1
     C*
     C           WCICT     IFLT 3                          - B1
     C*
     C** CREDIT RATE INIT PROCESSING
     C*
     C                     EXSR CRINIT
     C                     END                             - E1
     C*
     C           WDICT     IFGT 2                          - B1
     C           WCICT     ORGT 2
     C*
     C** INTEREST TYPE 03 & 04 INIT PROCESSING
     C*
     C           WRII      IFEQ *BLANK                     - B2
     C                     EXSR ITYPIN
     C                     Z-ADDMNBL      WMNBL
     C                     ELSE                                           182452
      *                                                                   182452
      ** If change in interest type                                       182452
      *                                                                   182452
     C           WDICT     IFGT 2                                         182452
     C           SVDICT    ANDLE2                                         182452
     C           WCICT     ORGT 2                                         182452
     C           SVCICT    ANDLE2                                         182452
     C                     Z-ADDHISD      ZDAYNO                          182452
     C                     EXSR DATEIN                                    182452
      *                                                                   182452
      ** Change in DR interest type                                       182452
      *                                                                   182452
     C           WDICT     IFGT 2                                         182452
     C           SVDICT    ANDLE2                                         182452
     C                     Z-ADDZFDTM     WDFDTM                          182452
     C                     Z-ADDZLDTM     WDLDTM                          182452
     C                     Z-ADDZFDNM     WDFDNM                          182452
     C                     Z-ADDZLDNM     WDLDNM                          182452
     C                     Z-ADD*ZEROS    ZIRD                            182452
     C                     Z-ADD*ZEROS    ZIBD                            182452
     C                     Z-ADD*ZEROS    WDSTYP           INT.SUB-TYPE   182452
     C                     Z-ADDWDMINT    WDAID                           182452
      *                                                                   182452
      ** If the history date is the first of the month, then set          182452
      ** the current history balance to be the minimum balance.           182452
      *                                                                   182452
     C           HISD      IFEQ WDFDTM                                    182452
     C                     Z-ADDWHISB     WMNBL                           182452
     C                     Z-ADDWHISB     DRMNBL                          182452
     C                     MOVE 'N'       W@MBID  1                       182452
     C                     ELSE                                           182452
      *                                                                   182452
      ** Otherwise, switch On Minimum Balance Setup Indicator             182452
      *                                                                   182452
     C                     MOVE 'Y'       W@MBID                          182452
     C                     Z-ADDWDFDNM    W@FDMD  50                      182452
     C                     ENDIF                                          182452
      *                                                                   182452
     C                     ENDIF                                          182452
      *                                                                   182452
      ** Change in CR interest type                                       182452
      *                                                                   182452
     C           WCICT     IFGT 2                                         182452
     C           SVCICT    ANDLE2                                         182452
     C                     Z-ADDZFDTM     WCFDTM                          182452
     C                     Z-ADDZLDTM     WCLDTM                          182452
     C                     Z-ADDZFDNM     WCFDNM                          182452
     C                     Z-ADDZLDNM     WCLDNM                          182452
     C                     Z-ADD*ZEROS    ZIRC                            182452
     C                     Z-ADD*ZEROS    ZIBC                            182452
     C                     Z-ADD*ZEROS    WCSTYP           INT.SUB-TYPE   182452
     C                     Z-ADDWCMINT    WCAID                           182452
      *                                                                   182452
      ** If the history date is the first of the month, then set          182452
      ** the current history balance to be the minimum balance.           182452
      *                                                                   182452
     C           HISD      IFEQ WCFDTM                                    182452
     C                     Z-ADDWHISB     WMNBL                           182452
     C                     Z-ADDWHISB     CRMNBL                          182452
     C                     MOVE 'N'       W@MBIC  1                       182452
     C                     ELSE                                           182452
      *                                                                   182452
      ** Otherwise, switch On Minimum Balance Setup Indicator             182452
      *                                                                   182452
     C                     MOVE 'Y'       W@MBIC                          182452
     C                     Z-ADDWCFDNM    W@FDMC  50                      182452
     C                     ENDIF                                          182452
      *                                                                   182452
     C                     ENDIF                                          182452
      *                                                                   182452
      ** Flag that the account has just changed its interest type to      182452
      ** 03 or 04.                                                        182452
      *                                                                   182452
     C                     MOVE 'Y'       W34FLG                          182452
      *                                                                   182452
     C                     ENDIF                                          182452
      *                                                                   182452
     C                     END                             - E2
      *                                                                   182452
      ** If the history balance setup indicator is on, get the minimum    182452
      ** balance from the first historic record that will next month's    182452
      ** start date.                                                      182452
      *                                                                   182452
      ** DEBIT Side                                                       182452
      *                                                                   182452
     C           W@MBID    IFEQ 'Y'                                       182452
      *                                                                   182452
     C           HISD      IFGE W@FDMD                                    182452
      *                                                                   182452
      ** If the history date of the record being processed is the same    182452
      ** as the first date of next month, then use the current balance    182452
      ** as the minimum balance.  Otherwise, use the previous date's      182452
      ** balance.                                                         182452
      *                                                                   182452
     C           HISD      IFEQ W@FDMD                                    182452
     C                     Z-ADDWHISB     WMNBL                           182452
     C                     Z-ADDWHISB     DRMNBL                          182452
     C                     ELSE                                           182452
     C                     Z-ADDSVHISB    WMNBL                           182452
     C                     Z-ADDSVHISB    DRMNBL                          182452
     C                     ENDIF                                          182452
      *                                                                   182452
     C                     MOVE 'N'       W@MBID                          182452
     C                     Z-ADD*ZEROS    W@FDMD                          182452
      *                                                                   182452
      ** Set the rate fields                                              182452
      *                                                                   182452
     C           R2KEY     SETLLREHRDJ                                    182452
     C           R2KEY     READEREHRDJ                   51               182452
     C                     EXSR DRSET                                     182452
      *                                                                   182452
     C                     ENDIF                                          182452
      *                                                                   182452
     C                     ENDIF                                          182452
      *                                                                   182452
      ** CREDIT Side                                                      182452
      *                                                                   182452
     C           W@MBIC    IFEQ 'Y'                                       182452
      *                                                                   182452
     C           HISD      IFGE W@FDMC                                    182452
      *                                                                   182452
      ** If the history date of the record being processed is the same    182452
      ** as the first date of next month, then use the current balance    182452
      ** as the minimum balance.  Otherwise, use the previous date's      182452
      ** balance.                                                         182452
      *                                                                   182452
     C           HISD      IFEQ W@FDMC                                    182452
     C                     Z-ADDWHISB     WMNBL                           182452
     C                     Z-ADDWHISB     CRMNBL                          182452
     C                     ELSE                                           182452
     C                     Z-ADDSVHISB    WMNBL                           182452
     C                     Z-ADDSVHISB    CRMNBL                          182452
     C                     ENDIF                                          182452
      *                                                                   182452
     C                     MOVE 'N'       W@MBIC                          182452
     C                     Z-ADD*ZEROS    W@FDMC                          182452
      *                                                                   182452
      ** Set the rate fields                                              182452
      *                                                                   182452
     C           R2KEY     SETLLREHRCJ                                    182452
     C           R2KEY     READEREHRCJ                   52               182452
     C                     EXSR CRSET                                     182452
      *                                                                   182452
     C                     ENDIF                                          182452
      *                                                                   182452
     C                     ENDIF                                          182452
     C*
     C                     END                             - E1
     C*
     C** FIRST INITIALISATION INDICATOR
     C*
     C                     MOVE 'Y'       WRII
     C*
     C                     ENDSR                           **INITPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** INTCAP subroutine to capitalize interest
     C**
     C**     Called by       POSIPR
     C**     Calls           POSPR
     C**
      *****************************************************************   CCB003
     C           INTCAP    BEGSR                           **INTCAP BEGSR**
     C*
     C** RESET WORK CAPITALISATION INDICATOR
     C**                                                                 085330
     C** IF THE RECORD READ IS SAME THEN TODAY CAPITALISATION FOR CLOSURE085330
     C** FLAG WORK FIELD TO AVOID OUTS PROCESS.                          085330
     C**                                                                 085330
     C           BDICI     IFEQ 'C'                                      085330
     C           HISD      ANDEQCNDID                                    085330
     C                     MOVE 'C'       SFOUND  1                      085330
     C                     MOVE 'C'       SDICI                          085330
     C                     MOVE 'C'       SCICI                          085330
     C                     ELSE                                          085330
     C                     MOVE ' '       SFOUND                         085330
     C           CRE090    IFEQ 'Y'                                                         MD027245
     C           SKIPDR    ANDEQ'Y'                                                         MD027245
     C           BDICI     ANDNE'D'                                                         MD027245
     C           CRE090    OREQ 'Y'                                                         MD027245
     C           SKIPCR    ANDEQ'Y'                                                         MD027245
     C           BCICI     ANDNE'D'                                                         MD027245
     C                     MOVE 'C'       SFOUND                                            MD027245
     C                     ENDIF                                                            MD027245
     C                     END                                           085330
     C*
     C                     MOVE *BLANK    SDCI
     C                     MOVE *BLANK    SCCI
     C                     MOVE *BLANK    WDCI                            085250
     C                     MOVE *BLANK    WCCI                            085250
     C*
     C           SDICI     IFNE ' '                        - B1
     C           SDICI     ANDNE'M'
     C           *IN10     IFEQ '1'
     C                     MOVE 'S'       SDCI
     C                     ELSE
     C*
     C** CHECK IF AMOUNT TO BE POSTED OR NOT ON THE ACCOUNT
     C*
     C           DRIS      IFNE 0                          - B2
     C                     MOVE 'S'       SDCI
     C                     MOVE 'S'       WDCI                            085250
     C                     MOVE 'S'       WPOSTI
     C*
     C                     ELSE                            - X2
     C*
     C           SDACP     IFNE *BLANKS                    - B3
     C********** DACP      ORNE *BLANKS                                   105489
     C                     MOVE 'A'       SDCI
     C                     MOVE 'A'       WDCI                            085250
     C                     MOVE 'A'       WPOSTI
     C*
     C                     ELSE                            - X3
     C*
     C           DRIP      IFNE 0                          - B4
     C                     MOVE 'Y'       SDCI
     C*
     C                     ELSE                            - X4
     C*
     C           WDAIC     IFLT MIDC                       - B5
     C*
     C                     MOVE 'L'       SDCI
     C                     MOVE 'S'       WDCI                            085250
     C*
     C                     ELSE                            - X5
     C*
     C           WDAIC     IFGT MADC                       - B6
     C*
     C                     MOVE 'O'       SDCI
     C                     MOVE 'S'       WDCI    1                       085250
     C*
     C                     ELSE                            - X6
     C*
     C                     MOVE 'Y'       SDCI
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END
     C                     END                             - E1
     C*
     C           SCICI     IFNE ' '
     C           SCICI     ANDNE'M'
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP35                                           S01408
      *                                                                   S01408
     C           *IN10     IFEQ '1'
     C                     MOVE 'S'       SCCI
     C                     ELSE
     C*
     C** CHECK IF AMOUNT TO BE POSTED OR NOT ON THE ACCOUNT
     C*
     C           CRIS      IFNE 0                          - B2
     C                     MOVE 'S'       SCCI
     C                     MOVE 'S'       WCCI                            085250
     C*
     C                     ELSE                            - X2
     C*
     C           SCACP     IFNE *BLANKS                    - B3
     C********** CACP      ORNE *BLANKS                                   105489
     C                     MOVE 'A'       SCCI
     C                     MOVE 'A'       WCCI                            085250
     C*
     C                     ELSE                            - X3
     C*
     C           CRIP      IFNE 0                          - B4
     C                     MOVE 'Y'       SCCI
     C*
     C                     ELSE                            - X4
     C*
     C           WCAIC     IFLT MICC                       - B5
     C*
     C                     MOVE 'L'       SCCI
     C                     MOVE 'S'       WCCI                            085250
     C*
     C                     ELSE                            - X5
     C*
     C           WCAIC     IFGT MACC                       - B6
     C*
     C                     MOVE 'O'       SCCI
     C                     MOVE 'S'       WCCI    1                       085250
     C*
     C                     ELSE                            - X6
     C*
     C                     MOVE 'Y'       SCCI
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END
     C                     END                             - E1
     C*                                                                   085250
     C** Process debit adjustement side                                   085250
     C*                                                                   085250
     C           SDCI      IFNE ' '                                       085250
     C                     ADD  WDAIC     CSGADI                          085250
     C                     END                                            085250
     C           WDCI      IFNE ' '                                       085250
     C           WDAIC     ANDNE*ZERO                                     085250
     C           BDICI     ANDNE' '                                       085250
     C           BDICI     ANDNE'M'                                       085250
     C                     MOVE WDCI      WIND    1                       085250
     C                     Z-ADDWDAIC     PSTA                            085250
     C                     Z-ADD0         DRCR                            085250
     C                     EXSR DUMPOS                                    085250
     C                     END                                            085250
     C*                                                                   085250
     C** Process credit adjustement side                                  085250
     C*                                                                   085250
     C           SCCI      IFNE ' '                                       085250
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP36                                           S01408
      *                                                                   S01408
     C                     ADD  WCAIC     CSGACI                          085250
      *                                                                   130468
      * If adj. going to a/c or alt. a/c accumulate in total for BRT.     130468
     C           S01383    IFEQ 'Y'                                       130468
     C           SCCI      IFEQ 'Y'                                       130468
     C           SCCI      OREQ 'A'                                       130468
     C                     ADD  WCAIC     WINTC                           130468
     C                     END                                            130468
     C                     END                                            130468
      *                                                                   130468
     C                     END                                            085250
     C           WCCI      IFNE ' '                                       085250
     C           WCAIC     ANDNE*ZERO                                     085250
     C           BCICI     ANDNE' '                                       085250
     C           BCICI     ANDNE'M'                                       085250
     C                     MOVE WCCI      WIND    1                       085250
     C                     Z-ADDWCAIC     PSTA                            085250
     C                     Z-ADD1         DRCR                            085250
     C                     EXSR DUMPOS                                    085250
     C                     END                                            085250
     C*
     C           SDCI      IFEQ 'Y'                        - B1
     C           WDAIC     ANDNE*ZERO
     C           SCCI      OREQ 'Y'
     C           WCAIC     ANDNE*ZERO
     C*
     C** CREATE/UPDATE NEXT POSITION RECORD
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **INTCAP ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** INTSR subroutine to calculate interest between two dates
     C**
     C**     Called by      SR01,SR02,SR03,SR04,SR05,SR06,SR07,SR08,TOTAC
     C**     Calls          ZICCR,ZICDR,ZICC34,ZICD34
     C**
      *****************************************************************   CCB003
     C           INTSR     BEGSR                           **INTSR BEGSR**
     C*
     C** MAINTAIN MINIMUM MONTHLY BALANCE FOR INTEREST TYPE 03 & 04
     C** IF END DATE IS IN THE CURRENT MONTH AND NOT END OF FILE
     C*
     C************IN50     IFEQ '0'                        - B1           182452
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP17                                           S01408
      *                                                                                       CER016
     C           WFIRST    IFEQ 'Y'                                                           CER016
     C                     EXSR SRAOS                                                         CER016
     C                     ENDIF                                                              CER016
      *                                                                   S01408
     C           WDICT     IFGT 2                          - B1
     C           WCICT     ORGT 2                          - B1
     C                     Z-ADDWMNBL     DRMNBL
     C                     Z-ADDWMNBL     CRMNBL
     C                     END
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP16                                           S01408
      *                                                                   S01408
     C***********          END                             - E1           182452
     C*
     C** CHECK ON DEBIT INTEREST TYPE
     C*
     C           WDICT     IFGT 2                          - B1
     C*
     C** INTEREST CALCULATION FOR DEBIT INTEREST TYPE > 2 PROCESSING
     C*
     C                     EXSR ZICD34
     C*
     C                     ELSE                            - X1
     C*
     C** INTEREST CALCULATION FOR DEBIT INTEREST TYPE < 3 PROCESSING
     C*
     C                     EXSR ZICDR
     C*
     C                     END                             - E1
     C*
     C** CHECK ON CREDIT INTEREST TYPE
     C*
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP18                                           S01408
      *                                                                   S01408
     C           WCICT     IFGT 2                          - B1
     C*
     C** INTEREST CALCULATION FOR CREDIT INTEREST TYPE > 2 PROCESSING
     C*
     C                     EXSR ZICC34
     C*
     C                     ELSE                            - X1
     C*
     C** INTEREST CALCULATION FOR CREDIT INTEREST TYPE < 3 PROCESSING
     C*
     C                     EXSR ZICCR
     C*
     C                     END                             - E1
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP19                                           S01408
      *                                                                   S01408
     C*
     C** MAINTAIN MINIMUM MONTHLY BALANCE FOR INTEREST TYPE 03 & 04
     C** AFTER PERIOD CALCULATION
     C*
     C* ONLY FOR POSITION RECORD                                          067706
     C*                                                                   067706
     C           WRECI     IFNE 'S'                                       067706
     C           WRECI     ANDNE' '                                       182452
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP21                                           S01408
      *                                                                   S01408
     C           WDICT     IFGT 2                          - B1
     C           WCICT     ORGT 2                          - B1
     C           WHISB     ADD  DMVT      MNBL
     C                     SUB  CMVT      MNBL             - X3
     C           MNBL      IFGT WMNBL
     C                     Z-ADDMNBL      WMNBL
     C                     END                             - E4
     C                     END                             - E3
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP20                                           S01408
      *                                                                   S01408
     C                     END                                            067706
     C*
     C                     ENDSR                           **INTSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ITYPIN subroutine for initialise interest type 03 & 04 fields
     C**
     C**     Called by       INITPR
     C**     Calls           CRSET,DATEIN,DBSR,DRSET
     C**
      *****************************************************************   CCB003
     C           ITYPIN    BEGSR                           **ITYPIN BEGSR**
     C*
     C/COPY WNCPYSRC,RE3662C046
     C** DATE INIT PROCESSING
     C*
     C           WRII      IFEQ *BLANK
     C           DRCI      OREQ 'Y'
     C           CRCI      OREQ 'Y'
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR DATEIN
     C                     END
     C*
     C** DEBIT SETUP PROCESSING
     C*
     C           WRII      IFEQ *BLANK
     C           DRCI      OREQ 'Y'
     C*
     C           WDICT     IFGT 2                          - B1
     C                     Z-ADDZFDTM     WDFDTM
     C                     Z-ADDZLDTM     WDLDTM
     C                     Z-ADDZFDNM     WDFDNM
     C                     Z-ADDZLDNM     WDLDNM
     C                     Z-ADD*ZEROS    ZIRD
     C                     Z-ADD*ZEROS    ZIBD
     C                     Z-ADD*ZEROS    WDSTYP           INT.SUB-TYPE
     C                     Z-ADDWDMINT    WDAID
     C*
     C* ONLY FULL MONTH ARE TO BE TAKEN EVEN IF PRIOR TO PREVIOUS         067706
     C* CAPITALISATION EXCEPTION IS TO LIMIT TO BACK VALUE HEADER.        067706
     C****       WDFDTM    IFLT WPDID                      - B2           067706
     C********             Z-ADDWPDID     KDATE                           067706
     C           WDFDTM    IFLT BHISD                      - B2           067706
     C                     Z-ADDBHISD     KDATE                           067706
     C                     ELSE                            - X2
     C                     Z-ADDWDFDTM    KDATE
     C                     END                             - E2
     C*
     C** POSITIONING ON DEBIT RATE CHANGES FILE
     C*
     C***********DCKEY     SETLLREHRDJ               60                   182452
     C           DCKEY     SETLLREHRDJ                   60               182452
     C*
     C** IF NOT FOUND, READ PREVIOUS RECORD
     C*
     C************IN60     IFEQ '1'                        - B2           182452
     C           *IN60     IFEQ '0'                        - B2           182452
     C*
     C                     READPREHRDJ                   51
     C*
     C                     MOVE KDATE     RDVALD
     C*
     C** IF BEGINNING OF FILE OR CHANGE OF ACCOUNT THEN DATABASE ERROR
     C*
     C           *IN51     IFEQ '1'                        - B3
     C           PKEY      ORNE AKEY
     C************LOCK     IN   LDA                                       182452
     C***********          Z-ADD9         DBASE            ***************182452
     C***********          MOVE 'REHRDJ'  DBFILE           **DB ERROR 09**182452
     C***********          Z-ADDKDATE     WVDTC            ***************182452
     C***********          MOVELRKEY      DBKEY                           182452
     C***********          OUT  LDA                                       182452
     C***********          EXSR DBSR                                      182452
     C                     CLEARWDBAL                                     182452
     C                     CLEARWDRAT                                     182452
     C                     Z-ADD*ZEROS    WDSTYP                          182452
     C                     MOVE '0'       *IN51                           182452
     C*
     C                     END                             - E3
     C*
     C                     ELSE                            - X2
     C*
     C           R2KEY     READEREHRDJ                   51
     C*
     C                     END                             - E2
     C*
     C** SETUP WORK DEBIT FIELDS WITH FIELDS READ PROCESSING
     C*
     C                     EXSR DRSET
     C*
     C                     END                             - E1
     C*
     C                     END
     C*
     C*
     C** CREDIT SETUP PROCESSING
     C*
     C           WRII      IFEQ *BLANK
     C           CRCI      OREQ 'Y'
     C*
     C           WCICT     IFGT 2                          - B1
     C                     Z-ADDZFDTM     WCFDTM
     C                     Z-ADDZLDTM     WCLDTM
     C                     Z-ADDZFDNM     WCFDNM
     C                     Z-ADDZLDNM     WCLDNM
     C                     Z-ADD*ZEROS    ZIRC
     C                     Z-ADD*ZEROS    ZIBC
     C                     Z-ADD*ZEROS    WCSTYP           INT.SUB-TYPE
     C                     Z-ADDWCMINT    WCAID
     C*
     C* ONLY FULL MONTH ARE TO BE TAKEN EVEN IF PRIOR TO PREVIOUS         067706
     C* CAPITALISATION EXCEPTION IS TO LIMIT TO BACK VALUE HEADER.        067706
     C****       WCFDTM    IFLT WPCID                      - B2           067706
     C********             Z-ADDWPCID     KDATE                           067706
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP31                                           S01408
      *                                                                   S01408
     C           WCFDTM    IFLT BHISD                      - B2           067706
     C                     Z-ADDBHISD     KDATE                           067706
     C                     ELSE                            - X2
     C                     Z-ADDWCFDTM    KDATE
     C                     END                             - E2
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP32                                           S01408
      *                                                                   S01408
     C*
     C** POSITIONING ON CREDIT RATE CHANGES FILE
     C*
     C***********DCKEY     SETLLREHRCJ               60                   182452
     C           DCKEY     SETLLREHRCJ                   60               182452
     C*
     C** IF NOT FOUND, READ PREVIOUS RECORD
     C*
     C************IN60     IFEQ '1'                        - B2           182452
     C           *IN60     IFEQ '0'                        - B2           182452
     C*
     C                     READPREHRCJ                   52
     C*
     C                     MOVE KDATE     RCVALD
     C*
     C** IF BEGINNING OF FILE OR CHANGE OF ACCOUNT THEN DATABASE ERROR
     C*
     C           *IN52     IFEQ '1'                        - B3
     C           PKEY      ORNE AKEY
     C************LOCK     IN   LDA                                       182452
     C***********          Z-ADD10        DBASE            ***************182452
     C***********          MOVE 'REHRCJ'  DBFILE           **DB ERROR 10**182452
     C***********          Z-ADDKDATE     WVDTC            ***************182452
     C***********          MOVELRKEY      DBKEY                           182452
     C***********          OUT  LDA                                       182452
     C***********          EXSR DBSR                                      182452
     C                     CLEARWCBAL                                     182452
     C                     CLEARWCRAT                                     182452
     C                     Z-ADD*ZEROS    WCSTYP                          182452
     C                     MOVE '0'       *IN52                           182452
     C*
     C                     END                             - E3
     C*
     C                     ELSE                            - X2
     C*
     C           R2KEY     READEREHRCJ                   52
     C*
     C                     END                             - E2
     C*
     C** SETUP WORK CREDIT FIELDS WITH FIELDS READ PROCESSING
     C*
     C                     EXSR CRSET
     C*
     C                     END                             - E1
      *
     C                     END
     C*
     C                     ENDSR                           **ITYPIN ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** MAIN subroutine to execute main processing.
     C**
     C**     Called by       S T A R T
     C**     Calls           DBSR,DETPR,INITPR,POSIPR,TOTAC
     C**
      *****************************************************************   CCB003
     C           MAIN      BEGSR                           **MAIN BEGSR**
     C*                                                                   085250
     C** RESET TOTQL GENERATED ADJUSTEMENT FOR CHANGE OF ACCOUNT          085250
     C**                                                                  085250
     C           *LIKE     DEFN SGADI     CSGADI                          085250
     C           *LIKE     DEFN SGACI     CSGACI                          085250
     C                     Z-ADD*ZEROS    CSGADI                          085250
     C                     Z-ADD*ZEROS    CSGACI                          085250
     C*
     C** SET MINIMUM AND MAXIMUM TO LIMIT VALUE BEFORE ACCOUNT ACCESS
     C*
     C                     Z-ADD*ZEROS    MIDC
     C                     Z-ADD*ZEROS    MICC
     C                     Z-ADD*HIVAL    MADC
     C                     Z-ADD*HIVAL    MACC
     C                     MOVE ' '       SFOUND                         085330
     C*
     C** ACCESS RECCY FILE FOR LIMITS AMOUNTS TO BE POSTED
     C*
     C                     MOVELBCCY      CCYZ
      *                                                                                     CRE083AY
     C                     Z-ADD1         C                                                 CRE083AY
     C           CCKEY     LOKUP##CC,C                   99                                 CRE083AY
     C                     MOVE ##CD,C    RCCYDS                                            CRE083AY
     C                     Z-ADD#MIDC     MIDC                                              CRE083AY
     C                     Z-ADD#MADC     MADC                                              CRE083AY
     C                     Z-ADD#MICC     MICC                                              CRE083AY
     C                     Z-ADD#MACC     MACC                                              CRE083AY
      *                                                                                     CRE083AY
      ** If it is not found in the cache (probably exceeded cache's array                   CRE083AY
      ** size), chain the original file.                                                    CRE083AY
      *                                                                                     CRE083AY
     C           *IN99     IFEQ *OFF                                                        CRE083AY
     C           CCKEY     CHAINRECCY                99
     C                     ENDIF                                                            CRE083AY
     C*
     C** ACCOUNT MUST EXIST ON ACCNT, REIAC AND REACR
     C*
     C           R2KEY     CHAINACCRACJ              99
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD4         DBASE            ***************
     C                     MOVE 'ACCRACJ' DBFILE           **DB ERROR 04**
     C                     MOVELPKEY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP13                                           S01408
     C*                                                                   S01408
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDODED      WWODED  50                      CRE001
     C                     ENDIF                                          CRE001
     C*
     C** DEFINE IF ACCOUNT IS SECONDARY
     C*
     C                     SETOF                         10
     C           R2KEY     SETLLRELINKL1                 10
     C/COPY WNCPYSRC,RE3662C002
     C*
     C***NUMBER*OF*PROCESSED*RECORDS                                      CCB003
     C***********                                                         CCB003
     C***********          ADD  1         NBRREC                          CCB003
     C*
     C** CHECK ON LAST DAY ACCRUAL AND ON DEBIT/CREDIT INTEREST
     C** CAPITALISATION INDICATOR TO CHANGE OR NOT THE LAST DEBIT/CREDIT
     C** INTEREST CAPITALISATION DATE AND THE NEXT DEBIT/CREDIT INTEREST
     C** CAPITALISATION DATE
     C*
     C                     Z-ADDLDID      CLDID
     C                     Z-ADDLCID      CLCID
     C*
     C           BDICI     IFEQ 'Y'                        - B1
     C                     Z-ADDNDID      CNDID
     C                     ELSE                            - X1
     C           BDICI     IFNE ' '                        - B2
     C                     Z-ADDRUND      CNDID
     C                     ELSE                            - X2
     C                     Z-ADD*ZEROS    CNDID
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           BCICI     IFEQ 'Y'                        - B1
     C                     Z-ADDNCID      CNCID
     C                     ELSE                            - X1
     C           BCICI     IFNE ' '                        - B2
     C                     Z-ADDRUND      CNCID
     C                     ELSE                            - X2
     C                     Z-ADD*ZEROS    CNCID
     C                     END                             - E2
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3662C089
     C*
     C           LDAC      IFNE 'Y'                        - B1
     C*
     C           BPDID     IFLT LDID                       - B2
     C                     ADD  1         CLDID
     C                     END                             - E2
     C           BPCID     IFLT LCID                       - B2
     C                     ADD  1         CLCID
     C                     END                             - E2
     C*
     C           BDICI     IFNE ' '                        - B2
     C           BDICI     ANDNE'C'                        - B2           057048
     C                     ADD  1         CNDID
     C                     END                             - E2
     C           BCICI     IFNE ' '                        - B2
     C           BCICI     ANDNE'C'                        - B2           057048
     C                     ADD  1         CNCID
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3662C030
     C** INITIALIZE INTEREST CALCULATION FIELDS TO *ZEROES
     C*
     C                     Z-ADD*ZEROS    WDINT
     C                     Z-ADD*ZEROS    WCINT
     C                     Z-ADD*ZEROS    WWODIA                          CRE001
     C                     Z-ADD*ZEROS    WWODIP                          CRE001
     C                     Z-ADD*ZEROS    WWODLN                          CRE001
     C                     Z-ADD*ZEROS    WWAODR                          CRE001
     C*
     C** POSITIONING ON COMPLETE HISTORY FILE (REHISL)
     C*
     C           BVDTC     IFLT BHISD                      - B1
     C                     Z-ADDBHISD     BVDTC
     C                     END
      *                                                                                       CRE090
      ** If account capitalisation was delayed, position                                      CRE090
      ** REHISL processing on the particular record.                                          CRE090
      *                                                                                       CRE090
     C           CRE090    IFEQ 'Y'                                                           CRE090
      *                                                                                       CRE090
     C           BVDTC     IFGT NDID                                                          CRE090
     C           NDID      ANDGT0                                                             CRE090
     C                     Z-ADDNDID      BVDTC                                               CRE090
     C                     ENDIF                                                              CRE090
     C           BVDTC     IFGT NCID                                                          CRE090
     C           NCID      ANDGT0                                                             CRE090
     C                     Z-ADDNCID      BVDTC                                               CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C           R1KEY     SETLLREHISL                   60
     C*
     C** CHECK IF FIRST RECORD TO BE PROCESSED IS A BACK-VALUE
     C*
     C           BVDTC     IFLE BHISD                      - B1
     C*
     C           *IN60     IFEQ '0'                        - B2
     C*
     C** HEADER RECORD NOT FOUND
     C*
     C           *LOCK     IN   LDA
     C                     Z-ADD5         DBASE            ***************
     C                     MOVE 'REHISL'  DBFILE           **DB ERROR 05**
     C                     Z-ADDBVDTC     WVDTC            ***************
     C                     MOVELRKEY      DBKEY
     C                     OUT  LDA
     C                     EXSR DBSR
     C*
     C                     ELSE                            - X2
     C*
     C** BACK-VALUE RECORD PROCESSING
     C*
     C                     READ REHISL                   50
     C*
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C** NON BACK-VALUE RECORD PROCESSING
     C*
     C                     READPREHISL                   50
     C*
     C** IF BEGINNING OF FILE OR CHANGE OF ACCOUNT THEN DATABASE ERROR
     C*
     C           *IN50     IFEQ '1'                        - B2
     C           PKEY      ORNE AKEY
     C           *LOCK     IN   LDA
     C                     Z-ADD6         DBASE            ***************
     C                     MOVE 'REHISL'  DBFILE           **DB ERROR 06**
     C                     Z-ADDBVDTC     WVDTC            ***************
     C                     MOVELRKEY      DBKEY
     C                     OUT  LDA
     C                     EXSR DBSR
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
      ** Gets Customer Details.                                                               CER048
      *                                                                                       CER048
     C                     MOVELBCNUM     WCUST  10                                           CER048
     C           WCUST     IFNE #WCUST                                                      CRE083AY
     C                     MOVE *BLANKS   #WCUST 10                                         CRE083AY
     C                     MOVE WCUST     #WCUST                                            CRE083AY
     C                     CALL 'AOCUSTR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD   7                                           CER048
     C                     PARM '*KEY   ' POPTN   7                                           CER048
     C                     PARM           WCUST                                               CER048
     C                     PARM *BLANKS   WKYST   7                                           CER048
     C           SDCUST    PARM SDCUST    DSSDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANKS                                                       CER048
     C********** PRTCD     ANDNE'*NRF'                                              CER048 AR750273C
     C           PRTCD     ANDNE'*CUSDEL'                                                   BUG26767
     C           PRTCD     ANDNE'*CUSCLS'                                                  AR750273C
      *                                                                                       CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     Z-ADD106       DBASE                                               CER048
     C                     MOVE 'SDCUSTPD'DBFILE                                              CER048
     C                     MOVELWCUST     DBKEY                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR DBSR                                                          CER048
     C                     END                                                                CER048
      *                                                                                     CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                       CER048
      ** Country code details                                                                 CER048
      *                                                                                       CER048
     C                     EXSR SRCHKL                                                      CRE083AY
     C           ##LFIC    IFEQ 'Y'                                                         CRE083AY
     C                     EXSR SRSETL                                                      CRE083AY
     C                     ELSE                                                             CRE083AY
     C                     CALL 'AOLOCNR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*KEY   ' POPTN                                               CER048
     C                     PARM A8LCCD    PLCCD   3                                           CER048
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANKS                                                       CER048
     C           PRTCD     ANDNE'*NRF'                                                        CER048
      *                                                                                       CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     Z-ADD107       DBASE                                               CER048
     C                     MOVE 'SDLOCNPD'DBFILE                                              CER048
     C                     MOVELWCUST     DBKEY                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR DBSR                                                          CER048
     C                     ELSE                                                             CRE083AY
     C                     EXSR SRADDL                                                      CRE083AY
     C                     ENDIF                                                              CER048
     C                     ENDIF                                                            CRE083AY
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C*
     C/COPY WNCPYSRC,RE3662C031
     C** INITIALIZE WORK FIELDS
     C*
     C                     EXSR INITPR
     C*
     C** DETAIL PROCESSING
     C*
     C                     EXSR DETPR
     C*
     C                     ENDSR                           **MAIN ENDSR**
     C/EJECT                                                              085250
     C********************************************************************085250
     C**                                                                  085250
     C** DUMPOS subroutine to create a DUMMY        posting record        085250
     C**                                                                  085250
     C**     Called by       INTCAP                                       085250
     C**     Calls           -                                            085250
     C**                                                                  085250
     C           DUMPOS    BEGSR                           **DUMPOS BEGSR*085250
     C*                                                                   085250
     C** Dummy access for compilation                                     085250
     C*                                                                   085250
     C           'X'       IFEQ 'P'                                       085250
     C                     READ REHPOSPP                 99               085250
     C                     END                                            085250
     C*                                                                   085250
     C** POSITION RECORD PREPARATION                                      085250
     C*                                                                   085250
     C                     MOVE 'P'       PRECI                           085250
     C                     MOVE *BLANK    ZZ006                           085250
     C                     MOVE *BLANK    ZZ002                           085250
     C                     MOVE *BLANK    ZZ009                           085250
     C***********          Z-ADDSHISD     XVALD                    085250 100086
     C                     Z-ADDHISD      XVALD                           100086
     C*                                                                   085250
     C** Flag posting to allow easy retrieval as DUMMY.                   085250
     C*                                                                   085250
     C                     Z-ADD99999     TRAT                            085250
     C                     MOVEL'DUMMY'   SPOS                            085250
     C*                                                                   085250
     C** Setup appropriate narrative                                      085250
     C*                                                                   085250
     C           DRCR      IFEQ 0                                         085250
     C                     MOVELMSG,1     PNAR                            085250
     C           WIND      IFEQ 'S'                                       085250
     C                     MOVELMSG,2     PNAR                            085250
     C                     END                                            085250
     C                     END                                            085250
     C           DRCR      IFEQ 1                                         085250
     C                     MOVELMSG,3     PNAR                            085250
     C           WIND      IFEQ 'S'                                       085250
     C                     MOVELMSG,4     PNAR                            085250
     C                     END                                            085250
     C                     END                                            085250
     C****************     Z-ADDSHISD     XVALD                    085250 100086
     C                     Z-ADDHISD      XVALD                           100086
     C                     MOVE '1'       RIND                            085250
     C                     MOVE 'R'       ATYP                            085250
     C**********           Z-ADD*ZEROS    ASOC                                         085250 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD*ZEROS    XCHGA                           085250
     C*                                                                   085250
     C** Flag PRIN to avoid process in RE3860                             085250
     C*                                                                   085250
     C                     MOVE 'Y'       PRIN                            085250
     C                     MOVE 'Y'       REACT                           CCB003
     C*                                                                   085250
     C** As adjustment may be negative reverse sign and DRCR              085250
     C*                                                                   085250
     C           PSTA      IFLT *ZERO                                     085250
     C                     Z-SUBPSTA      PSTA                            085250
     C           DRCR      IFEQ 1                                         085250
     C                     Z-ADD0         DRCR                            085250
     C                     ELSE                                           085250
     C                     Z-ADD1         DRCR                            085250
     C                     END                                            085250
     C                     END                                            085250
     C                     WRITEREHPOSPF                                  085250
     C*                                                                   085250
     C                     ENDSR                                          085250
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** OUTPOS subroutine to create a new interest posting record
     C**
     C**     Called by       POSPR,SR01,SR02,SR03,SR04,SR07,TOTAC
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           OUTPOS    BEGSR                           **OUTPOS BEGSR**
     C*
     C** POSITION RECORD PREPARATION
     C*
     C                     MOVE 'D'       DRECI
     C                     Z-ADDKVDATE    DHISD
     C                     Z-ADDWMNBL     DMNBL
     C                     Z-ADD*ZEROS    DCHGAR
     C**********           Z-ADDWCHGAR    TCHGAR                          108931
     C**********           Z-ADDWCHGAN    TCHGAN                          108931
     C                     Z-ADDWCHGAR    DTCHGR                          108931
     C                     Z-ADDWCHGAN    DTCHGN                          108931
     C                     Z-ADD*ZEROS    DCHGAN
     C                     Z-ADD*ZEROS    DDMVT
     C                     Z-ADDWDRIR     DDRIR
     C                     Z-ADDWDRCD     DDRCD
     C                     Z-ADD*ZEROS    DDAID
     C                     Z-ADD*ZEROS    DMADI
     C                     Z-ADDWTMADI    DTMADI
     C                     Z-ADD*ZEROS    DDMINT
     C                     Z-ADD*ZEROS    DCMVT
     C                     Z-ADDWCRIR     DCRIR
     C                     Z-ADDWCRCD     DCRCD
     C                     Z-ADD*ZEROS    DCAID
     C                     Z-ADD*ZEROS    DMACI
     C                     Z-ADDWTMACI    DTMACI
     C                     Z-ADD*ZEROS    DCMINT
     C                     Z-ADD*ZEROS    VDTC
     C                     Z-ADDWDICT     DDICT
     C                     Z-ADDWCICT     DCICT
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDWWAODR    DAODR                           CRE001
     C                     Z-ADDWWODLN    DODRL                           CRE001
     C                     MOVE *BLANK    DODLI                           CRE001
     C                     Z-ADD*ZEROS    DODIA                           CRE001
     C                     ENDIF                                          CRE001
     C*
     C                     MOVE *BLANK    DICI
     C                     MOVE *BLANK    CICI
     C                     MOVE *BLANK    DDRCI
     C                     MOVE *BLANK    DCRCI
     C                     MOVE *BLANK    ADTY
     C                     MOVE *BLANK    ALTI
     C/COPY WNCPYSRC,RE3662C032
     C*
     C           SDICI     IFEQ 'Y'                        - B1
     C           SDICI     OREQ 'D'                        - B1
     C           SDICI     OREQ 'C'                        - B1
     C                     Z-ADDKVDATE    DPDID
     C                     Z-ADD*ZEROS    DTMADI
     C           SDCI      IFEQ 'Y'                        - B1
     C                     ADD  DAIC      WHISB
     C                     END                             - B2
     C                     ELSE                            - X1
     C                     Z-ADDDAIC      DDAID
     C                     Z-ADDWPDID     DPDID
      *                                                                   CRE001
      ** If the Account being processed is Capitalising DR Interest       CRE001
      ** today but the Interest is not being posted to this Account,      CRE001
      ** Set Overdraft Interest Amount to Post workfield                  CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDWWODIA    DODIA                           CRE001
     C                     ENDIF                                          CRE001
     C                     END                             - E1
     C*
     C           SCICI     IFEQ 'Y'                        - B1
     C           SCICI     OREQ 'D'                        - B1
     C           SCICI     OREQ 'C'                        - B1
     C                     Z-ADD*ZEROS    DTMACI
     C                     Z-ADDKVDATE    DPCID
     C                     Z-ADDWHISB     DMNBCP
     C           SCCI      IFEQ 'Y'                        - B2
      *                                                                                       CDL013
      ** If CDL013 installed, calculate WHT amount                                            CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
     C           KVDATE    ANDEQCNCID                                                       AR666241
      *                                                                                       CDL013
     C                     Z-ADDCAIC      WINTC                                               CDL013
     C                     Z-ADDDAIC      WINTD                                               CDL013
     C                     EXSR #ECALC                                                        CDL013
      *                                                                                       CDL013
      ** If CDL013 NOT installed                                                              CDL013
     C                     ELSE                                                               CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP7                                           S01408
     C*                                                                   S01408
     C********** S01383    IFEQ 'Y'                                088932 130468
     C**********           Z-ADDCAIC      WINTC                    088932 130468
     C**********           EXSR BRTPRO                             088932 130468
     C**********           SUB  NETBRT    WHISB                    088932 130468
     C**********           ELSE                                    088932 130468
     C                     SUB  CAIC      WHISB
     C**********           END                                     088932 130468
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP8                                           S01408
     C*                                                                   S01408
     C                     END                             - E2
      *                                                                   130468
      * If creating hist rec for current cap. period (ie. not for adj.)   130468
      * update history with BRT on total interest and CR adjs. if req'd   130468
     C           S01383    IFEQ 'Y'                                       130468
     C           KVDATE    ANDEQCNCID                                     130468
     C           KVDATE    ANDLECTLDAT                                    130468
     C           WINTC     ANDGT*ZERO                                     130468
     C           CACP      ANDEQ*BLANKS                                   130468
     C                     EXSR BRTPRO                                    130468
     C                     ADD  BRTAMT    WHISB                           130468
     C                     END                                            130468
      *                                                                   130468
      ** Take into account EU Withholding Tax if necessary.                                   CGL031
      *                                                                                       CGL031
     C********** CGL031    IFEQ 'Y'                                                  CGL031 BUG23309
     C********** CGL032    OREQ 'Y'                                                  CGL031 BUG23309
     C********** KVDATE    IFEQ CNCID                                                  CGL031 234003
     C********** KVDATE    ANDLECTLDAT                                                 CGL031 234003
     C********** NCID      IFLE BJRDNB                                                 234003 234628
     C********** NCID      IFLT WDNWD                                                234628 BUG23309
     C********** WINTC     ANDGT*ZERO                                                  CGL031 233563
     C********** CACP      ANDEQ*BLANKS                                                CGL031 233563
     C**********           EXSR SREUTX                                                 CGL031 233563
     C**********           ADD  WEUWT     WHISB                                      CGL031 BUG23309
     C********** CER048    IFEQ 'Y'                                                  CER048 BUG23309
     C**********           ADD  WSTXA     WHISB                                      CER048 BUG23309
     C**********           ENDIF                                                     CER048 BUG23309
     C**********           ENDIF                                                     CGL031 BUG23309
     C**********           ENDIF                                                     CGL031 BUG23309
      *                                                                                       CGL031
     C           SCHGI     IFEQ 'Y'                        - B2
     C           SCHGI     OREQ 'L'
     C           SCHGI     OREQ 'O'
     C                     ADD  CHGP      WHISB
     C                     END                             - E2
     C                     ELSE                            - X1
     C                     Z-ADDCAIC      DCAID
     C                     Z-ADDWMNBCP    DMNBCP
     C                     Z-ADDWPCID     DPCID
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3662C003
     C                     Z-ADDWHISB     DHISB
     C/COPY WNCPYSRC,RE3662C004
     C*
     C** WRITE NEW POSITION RECORD IN REHISPD FILE
     C*
     C                     Z-ADDWDRCB     DDRCB                           054346
     C                     Z-ADDWCRCB     DCRCB                           054346
     C                     WRITEREHISPDF
     C/COPY WNCPYSRC,RE3662C009
     C*
     C                     ENDSR                           **OUTPOS ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** MRECC subroutine to process file REHISM
     C**
     C**     Called by       PRCC34
     C**     Calls
     C**
      *****************************************************************   CCB003
     C           MRECC     BEGSR                           **MRECD  BEGSR**
     C*
     C** Process only if rate change date or change of month
     C*
     C********             Z-ADDZIEND     ENDMTH  50               R01188 067706
     C*********  LDAC      IFNE 'Y'                                R01188 067706
     C*********  ZIEND     ANDNERCVALD                             R01188 067706
     C*********  ZIEND     ANDNECNCID                              R01188 067706
     C*********  ZIEND     IFNE RCVALD                             R01188 067706
     C*********            SUB  1         ENDMTH                   R01188 067706
     C*********            END                                     R01188 067706
     C********   ENDMTH    IFEQ RCVALD                     - B1    R01188 067706
     C********   ENDMTH    OREQ WCLDTM                             R01188 067706
     C*********  ENDMTH    OREQ CNCID                              R01188 067706
     C*****************    Z-ADDZIEND     KVDATE                          067706
     C                     Z-ADDEDAT      KVDATE                          067706
     C                     Z-ADDZIEND     KKDATE                          182452
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP30                                           S01408
      *                                                                   S01408
     C**********           Z-ADDBCNUM     VCNUM                                               CSD027
     C                     MOVE BCNUM     VCNUM                                               CSD027
     C                     MOVE BCCY      VCCY
     C                     Z-ADDBACOD     VACOD
     C                     Z-ADDBACSQ     VACSQ
     C*
     C*****      KMKEY     CHAINREHISML              99                   067706
     C           KMKEY     CHAINREHISMCL             99                   067706
     C*
     C                     MOVE 'M'       MRECI
     C******************** Z-ADDZIEND     MHISD                           067706
     C                     Z-ADDEDAT      MHISD                           067706
     C                     MOVE BBRCA     MBRCA
     C**********           Z-ADDBCNUM     MCNUM                                               CSD027
     C                     MOVE BCNUM     MCNUM                                               CSD027
     C                     MOVE BCCY      MCCY
     C                     Z-ADDBACOD     MACOD
     C                     Z-ADDBACSQ     MACSQ
     C**************       Z-ADDZINTR     MCINT                           067706
     C                     Z-ADDWCAID     MCINT                           067706
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP25                                           S01408
      *                                                                   S01408
     C                     Z-ADDCRMNBL    MMNBL
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP24                                           S01408
      *                                                                   S01408
     C**************       Z-ADDZIBEG     MPCID                           067706
     C                     Z-ADDZIEND     CSDAT                           067706
     C*
     C           *IN99     IFEQ '1'                        - B2
     C                     Z-ADDZIEND     DSDAT                           067706
     C******               WRITEREHISPMF                                  067706
     C                     WRITEREHISPCF                                  067706
     C                     ELSE                            - X2
     C*********            UPDATREHISPMF                                  067706
     C                     UPDATREHISPCF                                  067706
     C*
     C                     END                             - E2
     C                     Z-ADD*ZERO     CSDAT                           067706
     C                     Z-ADD*ZERO     MCINT                           067706
     C*
     C*************        END                             - E1           067706
     C*
     C                     ENDSR                           **MRECC  ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** MRECD subroutine to process file REHISM
     C**
     C**     Called by       PRCD34
     C**     Calls
     C**
      *****************************************************************   CCB003
     C           MRECD     BEGSR                           **MRECD  BEGSR**
     C*
     C** Process only if rate change date or change of month
     C*
     C*********            Z-ADDZIEND     ENDMTH  50               R01188 067706
     C*********  LDAC      IFNE 'Y'                                R01188 067706
     C*********  ZIEND     ANDNERDVALD                             R01188 067706
     C*********  ZIEND     ANDNECNDID                              R01188 067706
     C*********  ZIEND     IFNE RDVALD                             R01188 067706
     C*********            SUB  1         ENDMTH                   R01188 067706
     C*********            END                                     R01188 067706
     C********   ENDMTH    IFEQ RDVALD                     - B1    R01188 067706
     C********   ENDMTH    OREQ WDLDTM                             R01188 067706
     C*********  ENDMTH    OREQ CNDID                              R01188 067706
     C*****************    Z-ADDZIEND     KVDATE                          067706
     C                     Z-ADDEDAT      KVDATE                          067706
     C                     Z-ADDZIEND     KKDATE                          182452
     C**********           Z-ADDBCNUM     VCNUM                                               CSD027
     C                     MOVE BCNUM     VCNUM                                               CSD027
     C                     MOVE BCCY      VCCY
     C                     Z-ADDBACOD     VACOD
     C                     Z-ADDBACSQ     VACSQ
     C*
     C*****      KMKEY     CHAINREHISML              99                   067706
     C           KMKEY     CHAINREHISMDL             99                   067706
     C*
     C                     MOVE 'M'       MRECI
     C******************** Z-ADDZIEND     MHISD                           067706
     C                     Z-ADDEDAT      MHISD                           067706
     C                     MOVE BBRCA     MBRCA
     C**********           Z-ADDBCNUM     MCNUM                                               CSD027
     C                     MOVE BCNUM     MCNUM                                               CSD027
     C                     MOVE BCCY      MCCY
     C                     Z-ADDBACOD     MACOD
     C                     Z-ADDBACSQ     MACSQ
     C*****************    Z-ADDZINTR     MDINT                           067706
     C                     Z-ADDWDAID     MDINT                           067706
     C                     Z-ADDDRMNBL    MMNBL
     C***************      Z-ADDZIBEG     MPDID                           067706
     C                     Z-ADDZIEND     DSDAT                           067706
     C*
     C           *IN99     IFEQ '1'                        - B2
     C                     Z-ADDZIEND     CSDAT                           067706
     C                     WRITEREHISPMF
     C                     ELSE                            - X2
     C                     UPDATREHISPMF
     C*
     C                     END                             - E2
     C                     Z-ADD*ZERO     DSDAT                           067706
     C                     Z-ADD*ZERO     MDINT                           067706
     C*
     C********             END                             - E1           067706
     C*
     C                     ENDSR                           **MRECD  ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** POSIPR subroutine to execute position records processing
     C**
     C**     Called by       DETPR,MAIN
     C**     Calls           INITPR,INTCAP
     C**
      *****************************************************************   CCB003
     C           POSIPR    BEGSR                           **POSIPR BEGSR**
     C*
     C** CHARGES CALCULATION
     C*
     C           CHGT      IFNE *ZEROS                     - B1
     C           HISD      IFGT CLCID                      - B2
     C           WHISB     ADD  DMVT      WMNB
     C                     SUB  CMVT      WMNB
     C           WMNB      IFGT WMNBCP                     - B3
     C                     Z-ADDWMNB      WMNBCP
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     Z-ADDWMNBCP    MNBCP
     C*
     C** CHECK ON INTEREST TYPE
     C*
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP27                                           S01408
      *                                                                   S01408
     C           WDICT     IFGT 2                          - B1
     C           WCICT     ORGT 2
     C*
     C** SAVE ACTUAL MINIMUM
     C*
     C                     Z-ADDMNBL      WWMNBL
     C                     Z-ADDWMNBL     MNBL
     C                     END                             - E1
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP26                                           S01408
      *                                                                   S01408
     C*
     C           WRECI     IFEQ 'S'                        - B1
      *                                                                   091680
      * If closure cap. and a the cap. record already exists (ie 1st      091680
      * day accruals and a/c capitalised the previous day), check for     091680
      * manual adjustment valued today ; it must go on to the cap.        091680
      * record and be zeroised on the 'D' record.                         091680
     C           BDICI     IFEQ 'C'                                       091680
     C           HISD      ANDEQCNDID                                     091680
     C                     Z-ADDHISD      KVDATE                          091680
     C           KVKEY     CHAINREHISDL              99                   091680
     C           *IN99     IFEQ '0'                                       091680
     C                     ADD  DMADI     WTMADI                          091680
     C                     ADD  DMACI     WTMACI                          091680
     C                     Z-ADD0         DMADI                           091680
     C                     Z-ADD0         DMACI                           091680
     C                     UPDATREHISPDF                                  091680
     C                     END                                            091680
     C                     END                                            091680
      *                                                                                     MD027245
     C           CRE090    IFEQ 'Y'                                                         MD027245
      *                                                                                     MD027245
     C           BDICI     IFEQ 'Y'                                                         MD027245
     C           CNDID     ANDLEWRKHSD                                                      MD027245
     C           CNDID     ANDNE0                                                           MD027245
     C           BCICI     OREQ 'Y'                                                         MD027245
     C           CNCID     ANDLEWRKHSD                                                      MD027245
     C           CNCID     ANDNE0                                                           MD027245
      *                                                                                     MD027245
     C           AKEY      IFNE F1KEY                                                       MD027245
     C                     EXSR SRDLAY                                                      MD027245
     C                     ENDIF                                                            MD027245
      *                                                                                     MD027245
     C           CNDID     IFEQ WRKHSD                                                      MD027245
     C                     MOVE 'Y'       SKIPDR                                            MD027245
     C           BDICI     IFEQ 'Y'                                                         MD027245
     C                     MOVE 'Y'       SDICI                                             MD027245
     C                     ENDIF                                                            MD027245
     C                     ELSE                                                             MD027245
     C                     MOVE 'N'       SKIPDR                                            MD027245
     C                     ENDIF                                                            MD027245
      *                                                                                     MD027245
     C           CNCID     IFEQ WRKHSD                                                      MD027245
     C                     MOVE 'Y'       SKIPCR                                            MD027245
     C           BCICI     IFEQ 'Y'                                                         MD027245
     C                     MOVE 'Y'       SCICI                                             MD027245
     C                     ENDIF                                                            MD027245
     C                     ELSE                                                             MD027245
     C                     MOVE 'N'       SKIPCR                                            MD027245
     C                     ENDIF                                                            MD027245
      *                                                                                     MD027245
     C                     ENDIF                                                            MD027245
      *                                                                                     MD027245
     C                     ENDIF                                                            MD027245
     C*
     C** CAPITALISATION RECORD UPDATE
     C*
     C                     Z-ADDWHISB     HISB
     C                     Z-ADDWDRCD     DRCD
     C                     Z-ADDWCRCD     CRCD
     C                     Z-ADDWDRIR     DRIR
     C                     Z-ADDWCRIR     CRIR
     C                     Z-ADDWDICT     DICT
     C                     Z-ADDWCICT     CICT
     C                     Z-ADDWTMADI    TMADI
     C                     Z-ADDWTMACI    TMACI
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDWWAODR    AODR                            CRE001
     C                     Z-ADDWWODLN    ODRL                            CRE001
     C                     ENDIF                                          CRE001
     C*
     C** CHECK ON DEBIT CAPITALISATION
     C*
     C           SDICI     IFEQ 'Y'                        - B2
     C           SDICI     OREQ 'D'
     C           SDICI     OREQ 'C'
     C                     Z-ADD*ZERO     WTMADI
     C                     Z-ADDDRCB      WDRCB                           054346
     C*
     C** CHECK ON INTEREST TYPE
     C*
     C           WDICT     IFLT 3                          - B3
     C           WDAID     ADD  WDINT     WDAIC
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     ADD  WWODIA    WWODIP                          CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     ELSE                            - X3
     C                     Z-ADDWDAID     WDAIC
     C                     END                             - E3
     C*
     C** CALCULATE EFFECTIVE AMOUNT TO BE POSTED
     C*
     C********             Z-ADD*ZERO     WDMINT                   067706
     C                     SUB  DRIP      WDAIC
     C                     SUB  DRIS      WDAIC
     C*
     C** AT THIS STAGE GENERATED ADJUSTMENT FOR THE PERIOD
     C*
     C           WDAIC     SUB  SGADI     WDIGA
     C                     Z-ADDWDAIC     SGADI
     C                     ADD  TMADI     WDAIC
     C                     SUB  PMADI     WDAIC
     C*
     C** AT THIS STAGE MANUAL ADJUSTMENT FOR THE PERIOD
     C*
     C           TMADI     SUB  PMADI     WMADI
     C*
     C** FOR TOTAL CREDIT ADJUSTMENT ON DEBIT INTEREST DO REDUCE
     C** ADJUSTMENT OF TEG AMOUNT CORRECTION LIMITED TO ZERO.
     C*
     C           WDAIC     IFLT *ZERO
     C           WDAIC     IFLE TEGLIS
     C                     SUB  TEGLIS    WDAIC
     C                     SUB  TEGLIS    WDIGA
     C                     SUB  TEGLIS    SGADI
     C                     ELSE
     C                     SUB  WDAIC     WDIGA
     C                     SUB  WDAIC     SGADI
     C                     Z-ADD*ZERO     WDAIC
     C                     END
     C                     END
     C*
     C                     ADD  WDIGA     WGADI
     C                     Z-ADDWDAIC     DAIC
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDWWODIP    ODIA                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C           WDIGA     IFNE *ZERO
     C***********          Z-ADDWDIGA     GADI0                           CCB003
     C                     Z-ADDHISD      ZDAYNO
     C** *IN99 SET OFF AS ZDATE2Z2 DOES NOT RESET. ZDATE2Z4 NOT USED.
     C*
     C                     SETOF                     99
     C                     EXSR ZDATE2
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD23        DBASE            ***************
     C                     MOVE 'ZDATE2'  DBFILE           **DB ERROR 23**
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C************IN01     IFEQ '1'                                       CCB003
     C***********          ADD  1         PAGP                            CCB003
     C***********          WRITEHEADPR                                    CCB003
     C***********          MOVE '0'       *IN01                           CCB003
     C***********          END                                            CCB003
     C***********          MOVE ZDATE     LASTDR                          CCB003
     C***********          WRITEDETDR                                     CCB003
     C***********          MOVE 'Y'       P1OP    1                       CCB003
      *                                                                   CCB003
     C                     END
     C*
     C                     ELSE                            - X2
     C*
     C                     Z-ADDWDRCB     DRCB
     C                     Z-ADDWPDID     PDID
     C*
     C** CHECK ON INTEREST TYPE
     C*
     C           WDICT     IFLT 3                          - B3
     C           WDAID     ADD  WDINT     DAIC
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C           WWODIA    ADD  WWODIP    ODIA                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     ELSE                            - X3
     C                     Z-ADDWDAID     DAIC
     C                     Z-ADDWDMINT    DMINT
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C** CHECK ON CREDIT CAPITALISATION
     C*
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP34                                           S01408
      *                                                                   S01408
     C           SCICI     IFEQ 'Y'                        - B2
     C           SCICI     OREQ 'D'
     C           SCICI     OREQ 'C'
     C*
     C                     Z-ADDCRCB      WCRCB                           054346
     C                     Z-ADD*ZERO     WTMACI
     C           WCHGAR    SUB  PCHGAR    TCHGAR
     C           WCHGAN    SUB  PCHGAN    TCHGAN
     C*
     C** CHECK ON INTEREST TYPE
     C*
     C           WCICT     IFLT 3                          - B3
     C           WCAID     ADD  WCINT     WCAIC
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C           WWODIA    ADD  WWODIP    ODIA                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     ELSE                            - X3
     C                     Z-ADDWCAID     WCAIC
     C                     END                             - E3
     C*
     C                     Z-ADD*ZERO     WCMINT
     C                     SUB  CRIP      WCAIC
     C                     SUB  CRIS      WCAIC
     C*
     C** AT THIS STAGE GENERATED ADJUSTMENT FOR THE PERIOD
     C*
     C           WCAIC     SUB  SGACI     WCIGA
     C                     Z-ADDWCAIC     SGACI
     C                     ADD  TMACI     WCAIC
     C                     SUB  PMACI     WCAIC
     C*
     C** AT THIS STAGE MANUAL ADJUSTMENT FOR THE PERIOD
     C*
     C           TMACI     SUB  PMACI     WMACI
     C                     ADD  WCIGA     WGACI
     C                     Z-ADDWCAIC     CAIC
     C*
     C           WCIGA     IFNE *ZERO
     C***********          Z-ADDWCIGA     GACI0                           CCB003
     C                     Z-ADDHISD      ZDAYNO
     C** *IN99 SET OFF AS ZDATE2Z2 DOES NOT RESET. ZDATE2Z4 NOT USED.
     C*
     C                     SETOF                     99
     C                     EXSR ZDATE2
     C*
     C** VERIFY IF ERROR
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD24        DBASE            ***************
     C                     MOVE 'ZDATE2'  DBFILE           **DB ERROR 24**
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C************IN01     IFEQ '1'                                       CCB003
     C***********          ADD  1         PAGP                            CCB003
     C***********          WRITEHEADPR                                    CCB003
     C***********          MOVE '0'       *IN01                           CCB003
     C***********          END                                            CCB003
     C***********          MOVE ZDATE     LASTCR                          CCB003
     C***********          WRITEDETCR                                     CCB003
     C***********          MOVE 'Y'       P1OP                            CCB003
      *                                                                   CCB003
     C                     END
      *                                                                                     AR749044
      ** Convert CAIC to absolute value                                                     AR749044
     C           CAIC      IFLT 0                                                           AR749044
     C           -1        MULT CAIC      GECAIC 150                                        AR749044
     C                     ENDIF                                                            AR749044
      *                                                                                     AR749044
     C* Calculate EU tax on CR interest adjustment                                            235875
     C*                                                                                       235875
     C           CGL031    IFEQ 'Y'                                                           235875
     C           CGL032    OREQ 'Y'                                                           235875
     C********** CACP      IFEQ *BLANKS                                              235875 AR851468
     C********** CAIC      ANDNE*ZERO                                              BUG23309 AR851468
     C           CAIC      IFNE *ZERO                                                       AR851468
      * Interest for this period posted on suspense ==> adj. will be posted on suspense     BUG23309
     C           SCCI      ANDNE'L'                                                         BUG23309
     C           SCCI      ANDNE'O'                                                         BUG23309
     C           SCCI      ANDNE'S'                                                         BUG23309
      * Check adjustment against minimum/maximum interest                                   BUG23309
     C********** CAIC      ANDGEMICC                                               BUG23309 AR749044
     C********** CAIC      ANDLEMACC                                               BUG23309 AR749044
     C           GECAIC    ANDGEMICC                                                        AR749044
     C           GECAIC    ANDLEMACC                                                        AR749044
      * CR Capitalisation today                                                             BUG23309
     C           BCICI     ANDNE' '                                                         BUG23309
     C           BCICI     ANDNE'M'                                                         BUG23309
     C                     Z-ADDWHISD     PSTRD                                               235875
     C                     Z-ADDHISD      PENDD                                               235875
     C                     Z-ADDCAIC      PTOTI                                               235875
     C                     EXSR SREUTX                                                        235875
     C           CACP      IFEQ *BLANKS                                                     AR851468
     C                     ADD  WEUWT     HISB                                                235875
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     ADD  WSTXA     HISB                                                CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     ADD  WTTXA     HISB                                                CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                            AR851468
     C                     ENDIF                                                              235875
     C                     ENDIF                                                              235875
     C                     ELSE                            - X2
     C*
     C                     Z-ADDWCRCB     CRCB
     C                     Z-ADDWCHGAR    TCHGAR
     C                     Z-ADDWCHGAN    TCHGAN
     C                     Z-ADDWPCID     PCID
     C*
     C** CHECK ON INTEREST TYPE
     C*
     C           WCICT     IFLT 3                          - B3
     C           WCAID     ADD  WCINT     CAIC
     C                     ELSE                            - X3
     C                     Z-ADDWCAID     CAIC
     C                     Z-ADDWCMINT    CMINT
     C                     END                             - E3
     C*
     C                     END                             - E2
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP37                                           S01408
      *                                                                   S01408
     C*
     C** INTEREST CAPITALISATION PROCESSING
     C*
     C                     EXSR INTCAP
     C*
     C** UPDATE CAPITALISATION RECORD IN REHISL
     C*
     C                     Z-ADD7         DBASE
     C                     UPDATREHISPSF
     C/COPY WNCPYSRC,RE3662C019
     C                     Z-ADDWHISB     HISB
      *                                                                   182452
      ** There can be some adjustment due to backvalued events. If the    182452
      ** interest type is 3 or 4, that adjustment must be included in     182452
      ** the minimum balance calculation.                                 182452
      *                                                                   182452
     C           WDICT     IFGT 2                                         182452
     C           WCICT     ORGT 2                                         182452
      *                                                                   182452
      ** If it is the first day of the current month.                     182452
      *                                                                   182452
     C           HISD      IFEQ WCFDTM                                    182452
     C                     Z-ADDWHISB     MNBL                            182452
     C                     Z-ADDWHISB     WMNBL                           182452
     C                     ELSE                                           182452
     C           WHISB     IFGT WMNBL                                     182452
     C                     Z-ADDWHISB     MNBL                            182452
     C                     Z-ADDWHISB     WMNBL                           182452
     C                     ENDIF                                          182452
     C                     ENDIF                                          182452
      *                                                                   182452
     C                     ENDIF                                          182452
     C*
     C** RESET WORK CAPITALISATION INDICATOR
     C*
     C                     MOVE *BLANK    SDCI
     C                     MOVE *BLANK    SCCI
     C*
     C                     ELSE                            - X1
     C*
     C** HEADER OR POSITION RECORD UPDATE
     C*
     C           WHISB     ADD  DMVT      HISB
     C                     SUB  CMVT      HISB
     C           WCHGAR    ADD  CHGAR     TCHGAR
     C           WCHGAN    ADD  CHGAN     TCHGAN
     C           WTMADI    ADD  MADI      TMADI
     C           WTMACI    ADD  MACI      TMACI
     C                     Z-ADDWDRCB     DRCB
     C                     Z-ADDWCRCB     CRCB
     C*
     C** CHECK ON INTEREST TYPE
     C*
     C           WDICT     IFLT 3                          - B2
     C           WDAID     ADD  WDINT     DAID
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C           WWODIA    ADD  WWODIP    ODIA                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     ELSE                            - X2
     C                     Z-ADDWDAID     DAID
     C                     Z-ADDWDMINT    DMINT
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADD*ZERO     ODIA                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     END                             - E2
     C*
     C           WCICT     IFLT 3                          - B2
     C           WCAID     ADD  WCINT     CAID
     C                     ELSE                            - X2
     C                     Z-ADDWCAID     CAID
     C                     Z-ADDWCMINT    CMINT
     C                     END                             - E2
     C*
     C                     Z-ADDWPDID     PDID
     C                     Z-ADDWPCID     PCID
     C*
     C** CHECK ON DEBIT RATE INDICATOR
     C*
     C           DRCI      IFNE 'Y'                        - B2
     C                     Z-ADDWDRIR     DRIR
     C                     Z-ADDWDRCD     DRCD
     C                     Z-ADDWDICT     DICT
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDWWAODR    AODR                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     END                             - E2
     C*
     C** CHECK ON CREDIT RATE INDICATOR
     C*
     C           CRCI      IFNE 'Y'                        - B2
     C                     Z-ADDWCRIR     CRIR
     C                     Z-ADDWCRCD     CRCD
     C                     Z-ADDWCICT     CICT
     C                     END                             - E2
      *                                                                   CRE001
      ** Check wether Overdraft Line has been processed                   CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C           ODLI      ANDNE'Y'                                       CRE001
     C                     Z-ADDWWODLN    ODRL                            CRE001
     C                     ENDIF                                          CRE001
     C*
     C** UPDATE HEADER OR POSITION RECORD IN REHISL
     C*
     C                     Z-ADD8         DBASE
     C                     UPDATREHISPPF
     C/COPY WNCPYSRC,RE3662C010
     C*
     C                     END                             - E1
     C*
     C** RESTORE ACTUAL MINIMUM
     C*
     C***********          Z-ADDWWMNBL    MNBL                            063793
     C*
     C** INITIALIZE WORK FIELDS
     C*
     C                     EXSR INITPR
     C*
     C                     ENDSR                           **POSIPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** POSPR subroutine to create/update next position record with adj. int.
     C**
     C**     Called by       INTCAP
     C**     Calls           OUTPOS
     C**
      *****************************************************************   CCB003
     C           POSPR     BEGSR                           **POSPR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3662C047
     C                     Z-ADDHISD      KVDATE
     C*
     C           KVKEY     CHAINREHISDL              99
     C*
     C*
     C           *IN99     IFEQ '1'                        - B1
     C*
     C/COPY WNCPYSRC,RE3662C048
     C** NEW INTEREST POSTING RECORD CREATION
     C*
     C                     EXSR OUTPOS
     C*
     C                     ELSE                            - X1
     C*
     C** INTEREST POSTING RECORD UPDATE
     C*
     C           SDCI      IFEQ 'Y'                        - B1
     C                     ADD  WDAIC     WHISB
     C                     END                             - E1
     C*
     C           SCCI      IFEQ 'Y'                        - B1
      **********                                                                     CDL013 AR666241
      ***If*CDL013*installed,*calculate*WHT*amount*********************              CDL013 AR666241
     C********** CDL013    IFEQ '1'                                                  CDL013 AR666241
      **********                                                                     CDL013 AR666241
     C**********           Z-ADDWCAIC     WINTC                                      CDL013 AR666241
     C**********           Z-ADDWDAIC     WINTD                                      CDL013 AR666241
     C**********           EXSR #ECALC                                               CDL013 AR666241
      **********                                                                     CDL013 AR666241
      ***If*CDL013*NOT*installed***************************************              CDL013 AR666241
     C**********           ELSE                                                      CDL013 AR666241
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CCP9                                           S01408
     C*                                                                   S01408
     C                     SUB  WCAIC     WHISB
      *                                                                                       CDL013
     C**********           ENDIF                                                     CDL013 AR666241
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP10                                           S01408
     C*                                                                   S01408
     C                     END                             - E1
     C*
     C                     Z-ADDWDRCB     DDRCB                           054346
     C                     Z-ADDWCRCB     DCRCB                           054346
     C/COPY WNCPYSRC,RE3662C005
     C                     Z-ADDWHISB     DHISB
     C/COPY WNCPYSRC,RE3662C006
     C                     Z-ADD26        DBASE
     C                     UPDATREHISPDF
     C/COPY WNCPYSRC,RE3662C011
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **POSPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** PRCC34 subroutine to additional processing credit interest type > 2
     C**
     C**     Called by       ZICC34
     C**     Calls           CRSET,DATEIN,ZIC01,ZIC02
     C**
      *****************************************************************   CCB003
     C           PRCC34    BEGSR                           **PRCC34 BEGSR**
     C*
     C/COPY WNCPYSRC,RE3662C049
     C*******************  Z-ADD*ZEROS    ZIEND                           067706
     C                     Z-ADDSDAT      ZIEND                           067706
     C                     Z-ADDSDAT      ZIBEG
     C* LAST RATE ALREADY INITIALISED THEREFORE READ NEXT TO CHECK IF     067706
     C* NEED TO BE PROCESSED                                              067706
     C           *IN52     IFEQ '0'                        - B1           067706
     C           RCVALD    ANDLEZIBEG                                     067706
     C           R2KEY     READEREHRCJ                   52               067706
     C                     Z-ADDRCVALD    WVALD                           067706
     C                     END                             - E1           067706
     C*
     C           *IN52     DOWEQ'0'                        - B1
     C           RCVALD    ANDLEZIBEG
     C                     EXSR CRSET
     C*
     C           R2KEY     READEREHRCJ                   52
     C*
     C                     Z-ADDRCVALD    WVALD
     C                     END                             - E1
     C*
     C** INITIALIZE WORK FIELDS
     C*
     C                     Z-ADD*ZEROS    WCINT
     C                     Z-ADD*ZEROS    ZDAYN2
     C                     Z-ADD*ZEROS    ZIN
     C                     Z-SUBCRMNBL    ZIAMT
     C                     Z-SUBCRMNBL    ZIAMT1
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDZIBC      ZIB
     C                     Z-ADDZIRC      ZIR
     C                     Z-ADDINTHC     ZITHR
     C                     Z-ADD*ZEROS    ZIWRK1
     C                     Z-ADD*ZEROS    ZIWRK2
     C                     Z-ADD*ZEROS    ZIA
     C                     Z-ADD1         Z
     C                     Z-ADD*ZEROS    Y
     C                     Z-ADD*ZEROS    LOOP
     C                     Z-ADD*ZEROS    ZIAMTR
     C                     Z-ADD*ZEROS    ZBAL
     C                     Z-ADD*ZEROS    ZIA1
     C                     Z-ADDWCSTYP    WWSTYP           INT.SUB-TYPE
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDEDAT      ZIEND
     C           CRMNBL    IFLT *ZERO                      - B2
     C           BHISD     ANDLEWCFDTM                                    067706
     C           WCICT     CASEQ3         ZIC01            - B3
     C           WCICT     CASEQ4         ZIC02
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADD*ZERO     ZINTR
     C                     END                             - E2
     C*
     C** PROCESS REHISM FILE
     C*
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C*************        EXSR MRECC                                     067706
     C*
     C**  SAVE THIS MONTH'S INTEREST
     C*
     C                     Z-ADDZINTR     WCINT
     C           WCINT     ADD  WCAID     WCAID
     C/COPY WNCPYSRC,RE3662C050
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C                     EXSR MRECC                                     067706
     C                     ELSE                            - X1
     C           RCVALD    IFGE EDAT                       - B2
     C                     Z-ADDEDAT      ZIEND
     C           CRMNBL    IFLT *ZERO                      - B3
     C           BHISD     ANDLEWCFDTM                                    067706
     C           WCICT     CASEQ3         ZIC01            - B4
     C           WCICT     CASEQ4         ZIC02
     C                     END                             - E4
     C                     ELSE                            - X3
     C                     Z-ADD*ZERO     ZINTR
     C                     END                             - E3
     C*
     C** PROCESS REHISM FILE
     C*
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C*************        EXSR MRECC                                     067706
     C*
     C**  SAVE THIS MONTH'S INTEREST
     C*
     C                     Z-ADDZINTR     WCINT
     C           WCINT     ADD  WCAID     WCAID
     C*
     C/COPY WNCPYSRC,RE3662C051
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C                     EXSR MRECC                                     067706
     C           RCVALD    IFEQ EDAT                       - B3
     C                     EXSR CRSET
     C           R2KEY     READEREHRCJ                   52
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           *IN52     DOWEQ'0'                        - B1
     C           RCVALD    ANDLEEDAT
     C                     Z-ADD*ZEROS    ZDAYN2
     C                     Z-ADD*ZEROS    ZIN
     C                     Z-SUBCRMNBL    ZIAMT
     C                     Z-SUBCRMNBL    ZIAMT1
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDZIBC      ZIB
     C                     Z-ADDZIRC      ZIR
     C                     Z-ADDINTHC     ZITHR
     C                     Z-ADD*ZEROS    ZIWRK1
     C                     Z-ADD*ZEROS    ZIWRK2
     C                     Z-ADD*ZEROS    ZIA
     C                     Z-ADD1         Z
     C                     Z-ADD*ZEROS    Y
     C                     Z-ADD*ZEROS    LOOP
     C                     Z-ADD*ZEROS    ZIAMTR
     C                     Z-ADD*ZEROS    ZBAL
     C                     Z-ADD*ZEROS    ZIA1
     C                     Z-ADDWCSTYP    WWSTYP           INT.SUB-TYPE
     C*
     C                     Z-ADDRCVALD    ZIEND
     C           CRMNBL    IFLT *ZERO                      - B2
     C           BHISD     ANDLEWCFDTM                                    067706
     C           WCICT     CASEQ3         ZIC01            - B3
     C           WCICT     CASEQ4         ZIC02
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADD*ZERO     ZINTR
     C                     END                             - E2
     C*
     C* PROCESS REHISM FILE
     C*
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C*************        EXSR MRECC                                     067706
     C*
     C**  ACCUMULATE THIS MONTH'S INTEREST
     C*
     C                     Z-ADDZINTR     WCINT
     C           WCINT     ADD  WCAID     WCAID
     C/COPY WNCPYSRC,RE3662C052
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C                     EXSR MRECC                                     067706
     C                     Z-ADDZIEND     ZIBEG
     C                     EXSR CRSET
     C*
     C           R2KEY     READEREHRCJ                   52
     C*
     C                     Z-ADDRCVALD    WVALD
     C                     END                             - E1
     C*
     C           ZIEND     IFLT EDAT                       - B1
     C                     Z-ADDZIEND     ZIBEG
     C                     Z-ADDEDAT      ZIEND
     C           CRMNBL    IFLT *ZERO                      - B2
     C           BHISD     ANDLEWCFDTM                                    067706
     C                     Z-ADD*ZEROS    ZDAYN1                          067706
     C                     Z-ADD*ZEROS    ZIN                             067706
     C                     Z-SUBCRMNBL    ZIAMT                           067706
     C                     Z-SUBCRMNBL    ZIAMT1                          067706
     C                     Z-ADDWCRCB     ZICALC                          067706
     C                     Z-ADDZIBC      ZIB                             067706
     C                     Z-ADDZIRC      ZIR                             067706
     C                     Z-ADDINTHC     ZITHR                           067706
     C                     Z-ADD*ZEROS    ZIWRK1                          067706
     C                     Z-ADD*ZEROS    ZIWRK2                          067706
     C                     Z-ADD*ZEROS    ZIA                             067706
     C                     Z-ADD1         Z                               067706
     C                     Z-ADD*ZEROS    Y                               067706
     C                     Z-ADD*ZEROS    LOOP                            067706
     C                     Z-ADD*ZEROS    ZIAMTR                          067706
     C                     Z-ADD*ZEROS    ZBAL                            067706
     C                     Z-ADD*ZEROS    ZIA1                            067706
     C           WCICT     CASEQ3         ZIC01            - B3
     C           WCICT     CASEQ4         ZIC02
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADD*ZERO     ZINTR
     C                     END                             - E2
     C*
     C** PROCESS REHISM FILE
     C*
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C*************        EXSR MRECC                                     067706
     C*
     C**  ACCUMULATE THIS MONTH'S INTEREST
     C*
     C                     Z-ADDZINTR     WCINT
     C           WCINT     ADD  WCAID     WCAID
     C/COPY WNCPYSRC,RE3662C053
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C                     EXSR MRECC                                     067706
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **PRCC34 ENDSR**
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP23                                           S01408
      *                                                                   S01408
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** PRCD34 subroutine to additional processing debit interest type > 2
     C**
     C**     Called by       ZICD34
     C**     Calls           DATEIN,DRSET,ZIC01,ZIC02
     C**
      *****************************************************************   CCB003
     C           PRCD34    BEGSR                           **PRCD34 BEGSR**
     C*
     C/COPY WNCPYSRC,RE3662C054
     C*******************  Z-ADD*ZEROS    ZIEND                           067706
     C                     Z-ADDSDAT      ZIEND                           067706
     C                     Z-ADDSDAT      ZIBEG
     C* LAST RATE ALREADY INITIALISED THEREFORE READ NEXT TO CHECK IF     067706
     C* NEED TO BE PROCESSED                                              067706
     C           *IN51     IFEQ '0'                        - B1           067706
     C           RDVALD    ANDLEZIBEG                                     067706
     C           R2KEY     READEREHRDJ                   51               067706
     C                     Z-ADDRDVALD    WVALD                           067706
     C                     END                             - E1           067706
     C*
     C           *IN51     DOWEQ'0'                        - B1
     C           RDVALD    ANDLEZIBEG
     C                     EXSR DRSET
     C*
     C           R2KEY     READEREHRDJ                   51
     C*
     C                     Z-ADDRDVALD    WVALD
     C                     END                             - E1
      *                                                                                     MD055663
     C           NCAP34    IFEQ 'Y'                                                         MD055663
     C           WDICT     IFGT 2                                                           MD055663
     C           WDFDTM    ANDEQWFDCO                                                       MD055663
     C                     ADD  WDMINT    DRMNBL                                            MD055663
     C                     ENDIF                                                            MD055663
     C                     ENDIF                                                            MD055663
     C*
     C** INITIALIZE WORK FIELDS
     C*
     C                     Z-ADD*ZEROS    WDINT
     C                     Z-ADD*ZEROS    WWODIA                          CRE001
     C                     Z-ADD*ZEROS    ZDAYN2
     C                     Z-ADD*ZEROS    ZIN
     C                     Z-ADDDRMNBL    ZIAMT
     C                     Z-ADDDRMNBL    ZIAMT1
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWDRIR     ZIRATE
     C                     Z-ADDZIBD      ZIB
     C                     Z-ADDZIRD      ZIR
     C                     Z-ADDINTHD     ZITHR
     C                     Z-ADD*ZEROS    ZIWRK1
     C                     Z-ADD*ZEROS    ZIWRK2
     C                     Z-ADD*ZEROS    ZIA
     C                     Z-ADD1         Z
     C                     Z-ADD*ZEROS    Y
     C                     Z-ADD*ZEROS    LOOP
     C                     Z-ADD*ZEROS    ZIAMTR
     C                     Z-ADD*ZEROS    ZBAL
     C                     Z-ADD*ZEROS    ZIA1
     C                     Z-ADDWDSTYP    WWSTYP  50       INT.SUB-TYPE
     C*
     C** NO MORE RATE CHANGE DEBIT FOR THIS ACCOUNT
     C*
     C           *IN51     IFEQ '1'                        - B1
     C                     Z-ADDEDAT      ZIEND
     C           DRMNBL    IFGT *ZERO                      - B2
     C           BHISD     ANDLEWDFDTM                                    067706
     C           WDICT     CASEQ3         ZIC01            - B3
     C           WDICT     CASEQ4         ZIC02
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADD*ZERO     ZINTR
     C                     END                             - E2
     C*
     C** PROCESS REHISM FILE
     C*
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C*********            EXSR MRECD                                     067706
     C*
     C**  SAVE THIS MONTH'S INTEREST
     C*
     C                     Z-ADDZINTR     WDINT
     C           WDINT     ADD  WDAID     WDAID
     C/COPY WNCPYSRC,RE3662C055
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C                     EXSR MRECD                                     067706
     C                     ELSE                            - X1
     C           RDVALD    IFGE EDAT                       - B2
     C           BHISD     ANDLEWDFDTM                                    067706
     C                     Z-ADDEDAT      ZIEND
     C           DRMNBL    IFGT *ZERO                      - B3
     C           WDICT     CASEQ3         ZIC01            - B4
     C           WDICT     CASEQ4         ZIC02
     C                     END                             - E4
     C                     ELSE                            - X3
     C                     Z-ADD*ZERO     ZINTR
     C                     END                             - E3
     C*
     C** PROCESS REHISM FILE
     C*
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C*********            EXSR MRECD                                     067706
     C*
     C**  SAVE THIS MONTH'S INTEREST
     C*
     C                     Z-ADDZINTR     WDINT
     C           WDINT     ADD  WDAID     WDAID
     C/COPY WNCPYSRC,RE3662C056
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C                     EXSR MRECD                                     067706
     C*
     C           RDVALD    IFEQ EDAT                       - B3
     C                     EXSR DRSET
     C           R2KEY     READEREHRDJ                   51
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           *IN51     DOWEQ'0'                        - B1
     C           RDVALD    ANDLEEDAT
     C                     Z-ADD*ZEROS    ZDAYN2
     C                     Z-ADD*ZEROS    ZIN
     C                     Z-ADDDRMNBL    ZIAMT
     C                     Z-ADDDRMNBL    ZIAMT1
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWDRIR     ZIRATE
     C                     Z-ADDZIBD      ZIB
     C                     Z-ADDZIRD      ZIR
     C                     Z-ADDINTHD     ZITHR
     C                     Z-ADD*ZEROS    ZIWRK1
     C                     Z-ADD*ZEROS    ZIWRK2
     C                     Z-ADD*ZEROS    ZIA
     C                     Z-ADD1         Z
     C                     Z-ADD*ZEROS    Y
     C                     Z-ADD*ZEROS    LOOP
     C                     Z-ADD*ZEROS    ZIAMTR
     C                     Z-ADD*ZEROS    ZBAL
     C                     Z-ADD*ZEROS    ZIA1
     C                     Z-ADDWDSTYP    WWSTYP           INT.SUB-TYPE
     C*
     C                     Z-ADDRDVALD    ZIEND
     C           DRMNBL    IFGT *ZERO                      - B2
     C           BHISD     ANDLEWDFDTM                                    067706
     C           WDICT     CASEQ3         ZIC01            - B3
     C           WDICT     CASEQ4         ZIC02
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADD*ZERO     ZINTR
     C                     END                             - E2
     C*
     C** PROCESS REHISM FILE
     C*
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C*********            EXSR MRECD                                     067706
     C*
     C**  ACCUMULATE THIS MONTH INTEREST
     C*
     C                     Z-ADDZINTR     WDINT
     C           WDINT     ADD  WDAID     WDAID
     C/COPY WNCPYSRC,RE3662C057
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C                     EXSR MRECD                                     067706
     C                     Z-ADDZIEND     ZIBEG
     C                     EXSR DRSET
     C*
     C           R2KEY     READEREHRDJ                   51
     C*
     C                     Z-ADDRDVALD    WVALD
     C                     END                             - E1
     C*
     C           ZIEND     IFLT EDAT                       - B1
     C                     Z-ADDZIEND     ZIBEG
     C                     Z-ADDEDAT      ZIEND
     C           DRMNBL    IFGT *ZERO                      - B2
     C           BHISD     ANDLEWDFDTM                                    067706
     C                     Z-ADD*ZEROS    ZDAYN1                          067706
     C                     Z-ADD*ZEROS    ZIN                             067706
     C                     Z-ADDDRMNBL    ZIAMT                           067706
     C                     Z-ADDDRMNBL    ZIAMT1                          067706
     C                     Z-ADDWDRCB     ZICALC                          067706
     C                     Z-ADDWDRIR     ZIRATE                          067706
     C                     Z-ADDZIBD      ZIB                             067706
     C                     Z-ADDZIRD      ZIR                             067706
     C                     Z-ADDINTHD     ZITHR                           067706
     C                     Z-ADD*ZEROS    ZIWRK1                          067706
     C                     Z-ADD*ZEROS    ZIWRK2                          067706
     C                     Z-ADD*ZEROS    ZIA                             067706
     C                     Z-ADD1         Z                               067706
     C                     Z-ADD*ZEROS    Y                               067706
     C                     Z-ADD*ZEROS    LOOP                            067706
     C                     Z-ADD*ZEROS    ZIAMTR                          067706
     C                     Z-ADD*ZEROS    ZBAL                            067706
     C                     Z-ADD*ZEROS    ZIA1                            067706
     C           WDICT     CASEQ3         ZIC01            - B3
     C           WDICT     CASEQ4         ZIC02
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADD*ZERO     ZINTR
     C                     END                             - E2
     C*
     C** PROCESS REHISM FILE
     C*
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C*********            EXSR MRECD                                     067706
     C*
     C**  ACCUMULATE THIS MONTH'S INTEREST
     C*
     C                     Z-ADDZINTR     WDINT
     C           WDINT     ADD  WDAID     WDAID
     C/COPY WNCPYSRC,RE3662C058
     C* CHANGE TO KEEP CUMULATED INTEREST ON REHISPM                      067706
     C                     EXSR MRECD                                     067706
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **PRCD34 ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** FINSR  subroutine to Update processing
     C**
     C**     Called by       TOTAC
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           FINSR     BEGSR                           **FINSR  BEGSR**
     C/COPY WNCPYSRC,RE3662C084
     C*
     C** UPDATE REACR
     C*
     C           REKEY     CHAINREACR                53
     C*
     C           *IN53     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     Z-ADD19        DBASE            ***************
     C                     MOVE 'REACR'   DBFILE           **DB ERROR 19**
     C                     MOVELPKEY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C                     Z-ADDCTFDAT    RLCD
     C           WDICT     IFLT 3                          - B1
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C           WWODIA    ADD  WWODIP    ODIA                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C           WDAID     ADD  WDINT     RDAIC
     C                     ELSE                            - X1
     C                     Z-ADDWDAID     RDAIC
     C                     END                             - E1
     C           WCICT     IFLT 3                          - B1
     C           WCAID     ADD  WCINT     RCAIC
     C                     ELSE                            - X1
     C                     Z-ADDWCAID     RCAIC
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3662C033
     C           BDICI     IFNE *BLANK                     - B1
     C***********          ADD  DAIC      RDAIC                           099090
     C                     ADD  CDAIC     RDAIC                           099090
     C*********************SUB  TMADI     RDAIC                           089057
     C                     SUB  RMADI     RDAIC                           089057
     C                     END                             - E1
     C           BCICI     IFNE *BLANK                     - B1
     C***********          ADD  CAIC      RCAIC                           099090
     C                     ADD  CCAIC     RCAIC                           099090
     C*********************SUB  TMACI     RCAIC                           089057
     C                     SUB  RMACI     RCAIC                           089057
     C                     END                             - E1
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           WDRDLY    ANDEQ'Y'                                                           CRE090
     C           CRE090    OREQ 'Y'                                                           CRE090
     C           WCRDLY    ANDEQ'Y'                                                           CRE090
     C                     ADD  WACCDR    RDAIC                                               CRE090
     C                     ADD  WACCCR    RCAIC                                               CRE090
     C                     ENDIF                                                              CRE090
     C                     ADD  WGADI     RGADI
     C                     ADD  WGACI     RGACI
     C                     Z-ADDWHISB     RHISB
     C                     Z-ADDBFDR      RBFDR
     C                     Z-ADDBFCR      RBFCR
     C                     Z-ADDWTDINT    TDINT
     C                     Z-ADDWTCINT    TCINT
     C                     MOVE WPOSTI    POSTI
     C           WDICT     IFGT 2
     C           WCICT     ORGT 2
     C                     Z-ADDWMNBL     RMNBL
     C                     END
     C*
     C                     UPDATREACRDF
      *                                                                                       CRE090
      ** Output updated accrued interest and balance for                                      CRE090
      ** management cap. request during delay period                                          CRE090
      *                                                                                       CRE090
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           WDRDLY    ANDEQ'Y'                                                           CRE090
     C           WDDIS     ANDEQ'M'                                                           CRE090
     C           CRE090    OREQ 'Y'                                                           CRE090
     C           WCRDLY    ANDEQ'Y'                                                           CRE090
     C           WCDIS     ANDEQ'M'                                                           CRE090
      *                                                                                       CRE090
     C                     Z-ADDKVDATE    ZKVDTE                                              CRE090
     C                     Z-ADDWHISB     ZWHISB                                              CRE090
     C                     Z-ADDWMNBL     ZWMNBL                                              CRE090
     C                     Z-ADDDAIC      ZDAIC                                               CRE090
     C                     Z-ADDPMADI     ZPMADI                                              CRE090
     C                     Z-ADDWTMADI    ZWTMDI                                              CRE090
     C                     Z-ADDCAIC      ZCAIC                                               CRE090
     C                     Z-ADDPMACI     ZPMACI                                              CRE090
     C                     Z-ADDWTMACI    ZWTMCI                                              CRE090
     C                     MOVE SDICI     WDICI                                               CRE090
     C                     MOVE SCICI     WCICI                                               CRE090
     C                     Z-ADDRLCD      KVDATE                                              CRE090
     C           LDAC      IFEQ 'Y'                                                           CRE090
     C                     Z-ADDBVHISB    WHISB                                               CRE090
     C                     ELSE                                                               CRE090
     C                     Z-ADDRHISB     WHISB                                               CRE090
     C                     ENDIF                                                              CRE090
     C                     Z-ADDRMNBL     WMNBL                                               CRE090
     C                     Z-ADDRDAIC     DAIC                                                CRE090
     C                     Z-ADDRMADI     PMADI                                               CRE090
     C                     Z-ADDRGADI     WTMADI                                              CRE090
     C                     Z-ADDRCAIC     CAIC                                                CRE090
     C                     Z-ADDRMACI     PMACI                                               CRE090
     C                     Z-ADDRGACI     WTMACI                                              CRE090
     C           WDDIS     IFEQ 'M'                                                           CRE090
     C           WDRDLY    ANDEQ'Y'                                                           CRE090
     C                     MOVE 'M'       SDICI                                               CRE090
     C                     ENDIF                                                              CRE090
     C           WCDIS     IFEQ 'M'                                                           CRE090
     C           WCRDLY    ANDEQ'Y'                                                           CRE090
     C                     MOVE 'M'       SCICI                                               CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C                     EXCPTOUTM                                                          CRE090
      *                                                                                       CRE090
     C                     Z-ADDZKVDTE    KVDATE                                              CRE090
     C                     Z-ADDZWHISB    WHISB                                               CRE090
     C                     Z-ADDZWMNBL    WMNBL                                               CRE090
     C                     Z-ADDZDAIC     DAIC                                                CRE090
     C                     Z-ADDZPMADI    PMADI                                               CRE090
     C                     Z-ADDZWTMDI    WTMADI                                              CRE090
     C                     Z-ADDZCAIC     CAIC                                                CRE090
     C                     Z-ADDZPMACI    PMACI                                               CRE090
     C                     Z-ADDZWTMCI    WTMACI                                              CRE090
     C                     MOVE WDICI     SDICI                                               CRE090
     C                     MOVE WCICI     SCICI                                               CRE090
      *                                                                                       CRE090
     C                     ENDIF                                                              CRE090
      *                                                                                       CRE090
     C/COPY WNCPYSRC,RE3662C012
     C*
     C***UPDATE*REIAC*IF*CHARGE*APPLICABLE                                108867
     C*
     C********** CHGT      IFNE *ZERO                      - B1           108867
      *  Update charges fields on REIAC. If a/c is non-chargeable, set    108867
      *  charges to zero.                                                 108867
     C*
     C           REKEY     CHAINREIAC                53
     C*
     C           *IN53     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA
     C                     Z-ADD22        DBASE            ***************
     C                     MOVE 'REIAC'   DBFILE           **DB ERROR 22**
     C                     MOVELPKEY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E2
      *                                                                   108867
     C           CHGT      IFEQ *ZERO                                     108867
     C                     Z-ADD*ZERO     RRCA                            108867
     C                     Z-ADD*ZERO     RNRCA                           108867
     C                     ELSE                                           108867
     C*
     C**********           Z-ADDTCHGAR    RRCA                            108931
     C**********           Z-ADDTCHGAN    RNRCA                           108931
     C                     Z-ADDWCHGAR    RRCA                            108931
     C                     Z-ADDWCHGAN    RNRCA                           108931
      *                                                                   108931
      * Include capitalised charges (subtracted later by RE3664).         108931
     C           BCICI     IFNE *BLANK                                    108931
     C                     ADD  CCHGAR    RRCA                            108931
     C                     ADD  CCHGAN    RNRCA                           108931
     C                     END                                            108931
      *                                                                   108931
     C                     END                                            108867
      *                                                                   108867
     C**********           Z-ADDTCHGAR    RRCA                            179181
     C**********           Z-ADDTCHGAN    RNRCA                           179181
     C                     UPDATREIACDF
     C*
     C**********           END                             - E1           108867
     C*
     C/COPY WNCPYSRC,RE3662C085
     C** UPDATE REHISBL
     C*
     C           R2KEY     CHAINREHISBF              53
     C*
     C           *IN53     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA
     C                     Z-ADD21        DBASE            ***************
     C                     MOVE 'REHISBL' DBFILE           **DB ERROR 21**
     C                     Z-ADDBVDTC     WVDTC            ***************
     C                     MOVELRKEY      DBKEY
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END                             - E2
     C*
     C                     MOVE ALGID     LGID
     C*
      ** If the account's interest type has just changed to 03 or 04      182452
      ** force the system to calculate interest from the date it has      182452
      ** changed.                                                         182452
      *                                                                   182452
     C           W34FLG    IFNE 'Y'                                       182452
     C           W34FLG    OREQ 'Y'                                       182452
     C           BDICI     ANDNE*BLANK                                    182452
     C           BDICI     ANDNE'M'                                       182452
     C           WDICT     ANDGT2                                         182452
     C           W34FLG    OREQ 'Y'                                       182452
     C           BCICI     ANDNE*BLANK                                    182452
     C           BCICI     ANDNE'M'                                       182452
     C           WCICT     ANDGT2                                         182452
     C                     Z-ADDCTLDAT    VDTC
     C                     ENDIF                                          182452
     C*
     C** NEXT LINE REMOVED IN CASE OF COMMISSION INSTALLATION
     C*
     C           BDICI     IFNE *BLANK                     - B1
     C           BDICI     ANDNE'M'
     C                     MOVE 'C'       ADTY
     C                     ELSE                            - X1
     C                     MOVE *BLANKS   DICI
     C                     END                             - E1
     C*
     C           BCICI     IFNE *BLANK                     - B1
     C           BCICI     ANDNE'M'
     C                     MOVE 'C'       ADTY
     C                     ELSE                            - X1
     C                     MOVE *BLANKS   CICI
     C                     END                             - E1
     C*
     C                     UPDATREHISBF
     C/COPY WNCPYSRC,RE3662C083
     C*
     C                     Z-ADD*ZEROS    DHISD
     C                     Z-ADD*ZEROS    DHISB
     C                     Z-ADD*ZEROS    DMNBL
     C                     Z-ADD*ZEROS    DCHGAR
     C                     Z-ADD*ZEROS    DCHGAN
     C                     Z-ADD*ZEROS    DTCHGR                          108931
     C                     Z-ADD*ZEROS    DTCHGN                          108931
     C                     Z-ADD*ZEROS    DDMVT
     C                     Z-ADD*ZEROS    DDRIR
     C                     Z-ADD*ZEROS    DDRCD
     C                     Z-ADD*ZEROS    DDAID
     C                     Z-ADD*ZEROS    DMADI
     C                     Z-ADD*ZEROS    DTMADI
     C                     Z-ADD*ZEROS    DPDID
     C                     Z-ADD*ZEROS    DDMINT
     C                     Z-ADD*ZEROS    DCMVT
     C                     Z-ADD*ZEROS    DCRIR
     C                     Z-ADD*ZEROS    DCRCD
     C                     Z-ADD*ZEROS    DCAID
     C                     Z-ADD*ZEROS    KVDATE
     C                     Z-ADD*ZEROS    DMACI
     C                     Z-ADD*ZEROS    DTMACI
     C                     Z-ADD*ZEROS    DPCID
     C                     Z-ADD*ZEROS    DCMINT
     C                     Z-ADD*ZEROS    DMNBCP
     C                     Z-ADD*ZEROS    RDAIC
     C                     Z-ADD*ZEROS    RMADI
     C                     Z-ADD*ZEROS    RGADI
     C                     Z-ADD*ZEROS    RCAIC
     C                     Z-ADD*ZEROS    RMACI
     C                     Z-ADD*ZEROS    RGACI
     C                     Z-ADD*ZEROS    RHISB
     C                     Z-ADD*ZEROS    WCHGAR
     C                     Z-ADD*ZEROS    WCHGAN
     C                     Z-ADD*ZEROS    WTMADI
     C                     Z-ADD*ZEROS    WTMACI
     C                     Z-ADD*ZEROS    WMADI
     C                     Z-ADD*ZEROS    WMACI
     C                     Z-ADD*ZEROS    ZINTR
     C                     Z-ADD*ZEROS    ZSINT
     C                     Z-ADD*ZEROS    WCAID
     C                     Z-ADD*ZEROS    WDAID
     C                     Z-ADD*ZEROS    WDAIC
     C                     Z-ADD*ZEROS    WCAIC
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADD*ZEROS    WWODIP                          CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     Z-ADD*ZEROS    WTDINT
     C                     Z-ADD*ZEROS    WTCINT
     C                     Z-ADD*ZEROS    WDIGA
     C                     Z-ADD*ZEROS    WCIGA
     C                     Z-ADD*ZEROS    WPDID
     C                     Z-ADD*ZEROS    WPCID
     C                     Z-ADD*ZEROS    WDICT
     C                     Z-ADD*ZEROS    WCICT
     C                     Z-ADD*ZEROS    WDRCD
     C                     Z-ADD*ZEROS    WCRCD
     C                     Z-ADD*ZEROS    WDRIR
     C                     Z-ADD*ZEROS    WCRIR
     C                     Z-ADD*ZEROS    ZIRATE
     C                     Z-ADD*ZEROS    WDRCB
     C                     Z-ADD*ZEROS    WCRCB
     C                     Z-ADD*ZEROS    WMNBL
     C                     Z-ADD*ZEROS    MNBL
     C                     Z-ADD*ZEROS    DRMNBL
     C                     Z-ADD*ZEROS    CRMNBL
     C                     Z-ADD*ZEROS    WDMINT
     C                     Z-ADD*ZEROS    WCMINT
     C                     Z-ADD*ZEROS    WMNBCP
     C                     Z-ADD*ZEROS    WGADI
     C                     Z-ADD*ZEROS    WGACI
     C                     MOVE *BLANK    WRII
     C                     MOVE *BLANKS   WPOSTI
     C                     Z-ADD0         DDRCB                           054346
     C                     Z-ADD0         DCRCB                           054346
     C                     Z-ADD0         WDRCB                           054346
     C                     Z-ADD0         WCRCB                           054346
     C                     Z-ADD*ZERO     WINTC                           130468
     C*
     C** INITIALIZE FIELDS CAIC AND DAIC
     C*
     C                     Z-ADD0         DAIC
     C                     Z-ADD0         CAIC
     C                     Z-ADD0         CCHGAN                          108931
     C                     Z-ADD0         CCHGAR                          108931
     C                     Z-ADD0         CDAIC                           099090
     C                     Z-ADD0         CCAIC                           099090
      *                                                                   182452
      ** Reset Interest Type change to 03 or 04 indicator.                182452
      *                                                                   182452
     C                     MOVE 'N'       W34FLG  1                       182452
     C*
     C/COPY WNCPYSRC,RE3662C059
     C                     ENDSR                           **FINSR  ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
      *                                                               *                     CRE083AY
      *  UPDPTR - Update REHISUPD with Start Key for restart          *                     CRE083AY
      *                                                               *                     CRE083AY
      *  Called by:                                                   *                     CRE083AY
      *                                                               *                     CRE083AY
      *****************************************************************                     CRE083AY
      *                                                                                     CRE083AY
     C           UPDPTR    BEGSR                                                            CRE083AY
      *                                                                                     CRE083AY
     C                     MOVE 'A'       IXCKEY                                            CRE083AY
     C*                    MOVE NXTKEY    LSTKEY                                            CRE083AY
     C           IXCKEY    CHAINDRIVEF               38                                     CRE083AY
     C           *IN38     IFEQ '0'                                                         CRE083AY
     C                     MOVE LBRCA     BRCA                                              CRE083AY
     C                     MOVE LCNUM     CNUM                                              CRE083AY
     C                     MOVE LCCY      CCY                                               CRE083AY
     C                     MOVE LACOD     ACOD                                              CRE083AY
     C                     MOVE LACSQ     ACSQ                                              CRE083AY
     C                     MOVE 'C'       PROT                                              CRE083AY
     C                     UPDATDRIVEF                                                      CRE083AY
     C                     ENDIF                                                            CRE083AY
      *                                                                                     CRE083AY
     C                     ENDSR                                                            CRE083AY
      *****************************************************************                     CRE083AY
     C/EJECT                                                                                CRE083AY
      *****************************************************************                     CRE083AY
     C**
     C** REBSR subroutine for REHISBL file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           REBSR     BEGSR                           **REBSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'REHISBL' DBFILE           ***************
     C                     MOVELPKEY      DBKEY            **STATUS ERR **
     C                     MOVELSTSREB    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'1'       *IN,88
     C                     EXSR DBSR
     C*
     C                     ENDSR                           **REBSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** REASR subroutine for REACR file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           REASR     BEGSR                           **REASR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'REACR'   DBFILE           ***************
     C                     MOVELCKEY      DBKEY            **STATUS ERR **
     C                     MOVELSTSREA    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'1'       *IN,88
     C                     EXSR DBSR
     C*
     C                     ENDSR                           **REASR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** REISR subroutine for REIAC file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           REISR     BEGSR                           **REASR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'REIAC'   DBFILE           ***************
     C                     MOVELCKEY      DBKEY            **STATUS ERR **
     C                     MOVELSTSREI    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'1'       *IN,88
     C                     EXSR DBSR
     C*
     C                     ENDSR                           **REASR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** REDSR subroutine for REHIDL file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           REDSR     BEGSR                           **REDSR BEGSR**
     C*
     C**********           Z-ADDBCNUM     VCNUM                                               CSD027
     C                     MOVE BCNUM     VCNUM                                               CSD027
     C                     MOVE BCCY      VCCY
     C                     Z-ADDBACOD     VACOD
     C                     Z-ADDBACSQ     VACSQ
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'REHISDL' DBFILE
     C                     Z-ADDKVDATE    WVDATE           ***************
     C                     MOVELVKEY      DBKEY            **STATUS ERR **
     C                     MOVELSTSRED    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'1'       *IN,88
     C                     EXSR DBSR
     C*
     C                     ENDSR                           **REDSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** REHSR subroutine for REHISL file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           REHSR     BEGSR                           **REHSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'REHISL'  DBFILE
     C                     Z-ADDBVDTC     WVDTC            ***************
     C                     MOVELRKEY      DBKEY            **STATUS ERR **
     C                     MOVELSTSREH    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'1'       *IN,88
     C                     EXSR DBSR
     C*
     C                     ENDSR                           **REHSR ENDSR**
     C*
     C********************************************************************
     C**
     C** REMSR subroutine for REHISML file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           DBSR
     C**
      *****************************************************************   CCB003
     C           REMSR     BEGSR                           **REMSR BEGSR**
     C*
     C**********           Z-ADDBCNUM     VCNUM                                               CSD027
     C                     MOVE BCNUM     VCNUM                                               CSD027
     C                     MOVE BCCY      VCCY
     C                     Z-ADDBACOD     VACOD
     C                     Z-ADDBACSQ     VACSQ
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'REHISML' DBFILE
     C                     Z-ADDKVDATE    WVDATE           ***************
     C                     MOVELMKEY      DBKEY            **STATUS ERR **
     C                     MOVELSTSREM    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'1'       *IN,88
     C                     EXSR DBSR
     C*
     C                     ENDSR                           **REMSR ENDSR**
     C*
     C********************************************************************
     C/EJECT                                                              067706
     C********************************************************************067706
     C**                                                                  067706
     C** RECSR subroutine for REHISML file exception/error handling       067706
     C**                                                                  067706
     C**     Called by       Input specifications                         067706
     C**     Calls           DBSR                                         067706
     C**                                                                  067706
      *****************************************************************   CCB003
     C           RECSR     BEGSR                           **RECSR BEGSR**067706
     C*                                                                   067706
     C**********           Z-ADDBCNUM     VCNUM                                        067706 CSD027
     C                     MOVE BCNUM     VCNUM                                               CSD027
     C                     MOVE BCCY      VCCY                            067706
     C                     Z-ADDBACOD     VACOD                           067706
     C                     Z-ADDBACSQ     VACSQ                           067706
     C*                                                                   067706
     C                     MOVE 'HISMC'   DBFILE           ***************067706
     C                     Z-ADDKVDATE    WVDATE                          067706
     C                     MOVELMKEY      DBKEY            **STATUS ERR **067706
     C                     MOVELSTSREC    DBSTAT           ***************067706
     C                     MOVEA'11'      *IN,88                          067706
     C                     EXSR DBSR                                      067706
     C*                                                                   067706
     C                     ENDSR                           **RECSR ENDSR**067706
     C*                                                                   067706
     C********************************************************************067706
     C/EJECT                                                                                CRE083AY
      *****************************************************************                     CRE083AY
      *****************************************************************            CRE083AY MD022970
      ***REACSR*subroutine*for*REACNAPD*file*exception/error*handling**            CRE083AY MD022970
      *****************************************************************            CRE083AY MD022970
      *******Called*by*******Input*specifications**********************            CRE083AY MD022970
      *******Calls***********DBSR**************************************            CRE083AY MD022970
      *****************************************************************            CRE083AY MD022970
     C********************************************************************                  CRE083AY
     C***/EJECT********************************************************            CRE083AY MD022970
      *****************************************************************                     CRE083AY
     C********** REACSR    BEGSR                                                   CRE083AY MD022970
      *****************************************************************            CRE083AY MD022970
     C********** *LOCK     IN   LDA                                                CRE083AY MD022970
     C**********           MOVEL'READ/'   DBOPER 11                                CRE083AY MD022970
     C**********           MOVE 'DELETE'  DBOPER                                   CRE083AY MD022970
     C**********           MOVEL'REACNAPD'DBFILE                                   CRE083AY MD022970
     C**********           MOVELDBOPER    DBKEY                                    CRE083AY MD022970
     C**********           Z-ADD23        DBASE                                    CRE083AY MD022970
     C**********           MOVELSTSREH    DBSTAT                                   CRE083AY MD022970
     C**********           OUT  LDA                                                CRE083AY MD022970
     C**********           MOVEA'11'      *IN,88                                   CRE083AY MD022970
     C**********           EXSR DBSR                                               CRE083AY MD022970
      *****************************************************************            CRE083AY MD022970
     C**********           ENDSR                                                   CRE083AY MD022970
      *****************************************************************            CRE083AY MD022970
     C********************************************************************                  CRE083AY
     C/EJECT
     C********************************************************************
     C**
     C** SCRPR subroutine to prepare credit capitalisation record
     C**
     C**     Called by       SR01,SR02,SR04,SR07,TOTAC
     C**     Calls           CHGPR
     C**
      *****************************************************************   CCB003
     C           SCRPR     BEGSR                           **SCRPR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3662C060
     C                     Z-ADD*ZERO     WCMINT
     C                     Z-ADD*ZERO     WCAID
     C                     ADD  WTMACI    CAIC
     C*
     C** CHARGES CALCULATION
     C*
     C           CHGT      IFEQ 0                          - B1
     C*
     C                     MOVE *BLANK    SCHGI
     C                     Z-ADD*ZEROS    CHGP
     C                     Z-ADDTCHGAR    PCHGAR                          131447
     C                     Z-ADDTCHGAN    PCHGAN                          131447
     C                     Z-ADD*ZEROS    WCHGAR                          131447
     C                     Z-ADD*ZEROS    WCHGAN                          131447
     C                     Z-ADD*ZEROS    TCHGAR
     C                     Z-ADD*ZEROS    TCHGAN
     C*
     C                     ELSE                            - X1
     C*
     C** CHARGES PROCESSING
     C*
     C                     EXSR CHGPR
     C*
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3662C034
     C                     MOVE BCICI     SCICI
     C                     MOVE CACP      SCACP
     C                     MOVE CRBR      SCRBR
     C*
     C           CACP      IFNE *BLANKS                    - B1
     C                     MOVE 'A'       SCCI
     C                     END                             - E1
     C*
     C           CAIC      IFLT MICC                       - B1
     C*
     C                     MOVE 'L'       SCCI
     C*
     C                     ELSE                            - X1
     C*
     C           CAIC      IFGT MACC                       - B2
     C*
     C                     MOVE 'O'       SCCI
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           SCCI      IFEQ *BLANK                     - B1
     C           CAIC      ANDNE0
     C           KVDATE    IFLE CTLDAT                     - B2
     C                     MOVE 'Y'       SCCI
     C                     ELSE                            - X2
     C                     MOVE 'I'       SCCI
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           *IN10     IFEQ '1'
     C                     MOVE 'S'       SCCI
     C                     MOVE 'S'       SCHGI
     C                     END
     C                     ENDSR                           **SCRPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** SDRPR subroutine to prepare debit capitalisation record
     C**
     C**     Called by       SR01,SR02,SR03,SR04,TOTAC
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           SDRPR     BEGSR                           **SDRPR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3662C061
     C                     Z-ADD*ZERO     WDMINT
     C                     Z-ADD*ZERO     WDAID
     C                     MOVE BDICI     SDICI
     C                     MOVE DACP      SDACP
     C                     MOVE DRBR      SDRBR
     C                     ADD  WTMADI    DAIC
     C*
     C/COPY WNCPYSRC,RE3662C035
     C           DACP      IFNE *BLANKS                    - B1
     C                     MOVE 'A'       SDCI
     C                     MOVE 'A'       WPOSTI
     C                     END                             - E1
     C*
     C           DAIC      IFLT MIDC                       - B1
     C*
     C                     MOVE 'L'       SDCI
     C*
     C                     ELSE                            - X1
     C*
     C           DAIC      IFGT MADC                       - B2
     C*
     C                     MOVE 'O'       SDCI
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           SDCI      IFEQ *BLANK                     - B1
     C           DAIC      ANDNE0
     C           KVDATE    IFLE CTLDAT                     - B2
     C                     MOVE 'Y'       SDCI
     C                     ELSE                            - X2
     C                     MOVE 'I'       SDCI
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           *IN10     IFEQ '1'
     C*********************MOVE 'S'       SCCI                            045125
     C                     MOVE 'S'       SDCI                            045125
     C                     END
     C                     ENDSR                           **SDRPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** SETUP subroutine to prepare capitalisation record
     C**
     C**     Called by       SR01,SR02,SR03,SR04,SR07,TOTAC
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           SETUP     BEGSR                           **SETUP BEGSR**
     C*
     C** CAPITALISATION RECORD PREPARATION
     C*
     C                     Z-ADD*ZEROS    PCHGAR
     C                     Z-ADD*ZEROS    PCHGAN
     C                     Z-ADD*ZEROS    PMADI
     C                     Z-ADD*ZEROS    SGADI
     C                     Z-ADD*ZEROS    DRIP
     C                     Z-ADD*ZEROS    DRIS
     C                     Z-ADD*ZEROS    PMACI
     C                     Z-ADD*ZEROS    SGACI
     C                     Z-ADD*ZEROS    CRIP
     C                     Z-ADD*ZEROS    CRIS
     C                     Z-ADD*ZEROS    CHGP
     C*
     C                     Z-ADDWHISB     STBL
     C           WDICT     IFLT 3                          - B1
     C           WDAID     ADD  WDINT     DAIC
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C           WWODIA    ADD  WWODIP    ODIA                            CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     ELSE                            - X1
     C                     Z-ADDWDAID     DAIC
     C                     END                             - E1
     C           WCICT     IFLT 3                          - B1
     C           WCAID     ADD  WCINT     CAIC
     C                     ELSE                            - X1
     C                     Z-ADDWCAID     CAIC
     C                     END                             - E1
     C                     Z-ADDDAIC      WDAID
     C                     Z-ADDCAIC      WCAID
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDODIA      WWODIP                          CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C*
     C                     MOVE *BLANK    SDICI
     C                     MOVE *BLANK    SCICI
     C                     MOVE *BLANK    SCHGI
     C                     MOVE *BLANKS   SCHAC
     C                     MOVE *BLANKS   SDACP
     C                     MOVE *BLANKS   SCACP
     C                     MOVE *BLANKS   SCHBR   3
     C                     MOVE *BLANKS   SDRBR   3
     C                     MOVE *BLANKS   SCRBR   3
     C                     MOVE *BLANKS   ZZ025
     C*
     C** RESET WORK CAPITALISATION INDICATOR
     C*
     C                     MOVE *BLANK    SDCI
     C                     MOVE *BLANK    SCCI
     C*
     C/COPY WNCPYSRC,RE3662C062
     C                     ENDSR                           **SETUP ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** TOTAC subroutine to execute total account processing
     C**
     C**     Called by       DETPR,MAIN
     C**     Calls           CAPI,INTSR,FINSR
     C**
      *****************************************************************   CCB003
     C           TOTAC     BEGSR                           **TOTAC BEGSR**
      *                                                                   182452
      ** If the history balance setup indicator is still on and already   182452
      ** processing the last historic record, then the current history    182452
      ** balance is the minimum balance.                                  182452
      *                                                                   182452
      ** CREDIT                                                           182452
      *                                                                   182452
     C           W@MBIC    IFEQ 'Y'                                       182452
     C           WHISD     ANDGEW@FDMC                                    182452
     C                     Z-ADDWHISB     WMNBL                           182452
     C                     Z-ADDWHISB     CRMNBL                          182452
     C                     MOVE 'N'       W@MBIC                          182452
     C                     Z-ADD*ZEROS    W@FDMC                          182452
      *                                                                   182452
      ** Set the rate fields                                              182452
      *                                                                   182452
     C           R2KEY     SETLLREHRCJ                                    182452
     C           R2KEY     READEREHRCJ                   52               182452
     C                     EXSR CRSET                                     182452
      *                                                                   182452
     C                     ENDIF                                          182452
      *                                                                   182452
      ** DEBIT                                                            182452
      *                                                                   182452
     C           W@MBID    IFEQ 'Y'                                       182452
     C           WHISD     ANDGEW@FDMD                                    182452
     C                     Z-ADDWHISB     WMNBL                           182452
     C                     Z-ADDWHISB     DRMNBL                          182452
     C                     MOVE 'N'       W@MBID                          182452
     C                     Z-ADD*ZEROS    W@FDMD                          182452
      *                                                                   182452
      ** Set the rate fields                                              182452
      *                                                                   182452
     C           R2KEY     SETLLREHRDJ                                    182452
     C           R2KEY     READEREHRDJ                   51               182452
     C                     EXSR DRSET                                     182452
      *                                                                   182452
     C                     ENDIF                                          182452
     C*
     C/COPY WNCPYSRC,RE3662C063
     C                     Z-ADD*ZEROS    HISD
     C*
     C** CHECK IF CAPITALISATION STILL TO BE PROCESSED
     C*
     C           CTFDAT    IFGE CNDID                      - B1
     C           WHISD     ANDLTCNDID
     C           CTFDAT    ORGE CNCID
     C           WHISD     ANDLTCNCID
     C/COPY WNCPYSRC,RE3662C036
     C*
     C                     Z-ADDCTFDAT    ENDDAT
     C*
     C** CAPITALISATION PROCESSING
     C*
     C                     EXSR CAPI
     C*
     C** INTEREST CALCULATION FROM LAST PROCESSING DATE TO CONTROL DATE
     C*
     C                     ELSE                            - X1
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDCTFDAT    ZIEND
     C*
     C           ZIBEG     IFLT ZIEND                      - B2
     C*
     C** INTEREST CALCULATION BETWEEN TWO DATES
     C*
     C/COPY WNCPYSRC,RE3662C013
     C                     EXSR INTSR
     C*
     C                     ELSE                            - X2
     C*
     C                     Z-ADD*ZEROS    WDINT
     C                     Z-ADD*ZEROS    WCINT
      *                                                                   CRE001
     C                     Z-ADD*ZEROS    WWODIA                          CRE001
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C** REACR FILE UPDATE PROCESSING
     C*
     C                     EXSR FINSR
     C/COPY WNCPYSRC,RE3662C082
     C*
     C                     ENDSR                           **TOTAC ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***********                                                         CCB003
     C***TOTAL*subroutine to execute end processing.                      CCB003
     C***********                                                         CCB003
     C*******Called by       S T A R T                                    CCB003
     C*******Calls           -                                            CCB003
     C***********                                                         CCB003
     C***********TOTAL     BEGSR                           **TOTAL BEGSR**CCB003
     C***********                                                         CCB003
     C***OUTPUT*AUDIT DETAIL                                              CCB003
     C***********                                                         CCB003
     C***********          WRITETOTALS                                    CCB003
     C***********                                                         CCB003
     C***********          ENDSR                           **TOTAL ENDSR**CCB003
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** WKSET subroutine to reset work fields after creation of position record
     C**
     C**     Called by       SR01,SR02,SR03,SR04,SR07,TOTAC
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           WKSET     BEGSR                           **WKSET BEGSR**
     C*
     C                     Z-ADDDHISD     WHISD
     C/COPY WNCPYSRC,RE3662C007
     C                     Z-ADDDHISB     WHISB
     C/COPY WNCPYSRC,RE3662C008
     C                     Z-ADDDCAID     WCAID
     C                     Z-ADDDDAID     WDAID
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     Z-ADDDODIA     WWODIP                          CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     Z-ADDDDMINT    WDMINT
     C                     Z-ADDDCMINT    WCMINT
     C                     Z-ADDDPDID     WPDID
     C                     Z-ADDDPCID     WPCID
     C                     Z-ADDDMNBCP    WMNBCP
     C                     Z-ADDDDRCB     WDRCB                           054346
     C                     Z-ADDDCRCB     WCRCB                           054346
     C*
     C                     ENDSR                           **WKSET ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZICCR subroutine to calculate interest for credit interest type < 2
     C**
     C**     Called by       DETPR,INTSR
     C**     Calls           ZIC00,ZIC01,ZIC02
     C**
      *****************************************************************   CCB003
     C           ZICCR     BEGSR                           **ZICCR BEGSR**
     C*
     C** INITIALIZE ZINTR
     C*
     C                     Z-ADD*ZEROS    ZINTR
     C                     Z-ADD*ZEROS    WWODIA                          CRE001
     C*
     C           WHISB     IFLT 0                          - B1
     C*
     C** INITIALIZE WORK FIELDS
     C*
     C                     Z-ADD*ZEROS    ZDAYN2
     C                     Z-ADD*ZEROS    ZIN
     C                     Z-SUBWHISB     ZIAMT
     C                     Z-SUBWHISB     ZIAMT1
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWCRIR     ZIRATE
     C                     Z-ADDZIBC      ZIB
     C                     Z-ADDZIRC      ZIR
     C                     Z-ADDINTHC     ZITHR
     C                     Z-ADD*ZEROS    ZIWRK1
     C                     Z-ADD*ZEROS    ZIWRK2
     C                     Z-ADD*ZEROS    ZIA
     C                     Z-ADD1         Z
     C                     Z-ADD*ZEROS    Y
     C                     Z-ADD*ZEROS    LOOP
     C                     Z-ADD*ZEROS    ZIAMTR
     C                     Z-ADD*ZEROS    ZBAL
     C                     Z-ADD*ZEROS    ZIA1
     C                     Z-ADDWCSTYP    WWSTYP           INT.SUB-TYPE
     C*
     C** CHECK ON INTEREST TYPE
     C*
     C           WCICT     CASEQ0         ZIC00            - B2
     C           WCICT     CASEQ1         ZIC01
     C           WCICT     CASEQ2         ZIC02
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     Z-ADDZINTR     WCINT
     C/COPY WNCPYSRC,RE3662C014
     C*
     C                     ENDSR                           **ZICCR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZICC34 subroutine to calculate interest for debit interest type > 3
     C**
     C**     Called by       DETPR,INTSR
     C**     Calls           PRCC34
     C**
      *****************************************************************   CCB003
     C           ZICC34    BEGSR                           **ZICC34 BEGSR**
     C*
     C** SAVE DATES
     C*
     C                     Z-ADDZIBEG     WBEG
     C                     Z-ADDZIEND     WEND
     C*
     C** START & END DATE SETUP
     C*
     C                     Z-ADD*ZEROS    SDAT
     C                     Z-ADD*ZEROS    EDAT
     C*
     C** FINAL DATE IS GREATER THAN MONTH END THEN CALCULATE THIS MONTH'S
     C** INTEREST
     C*
     C* ONLY FULL MONTH ARE TO BE TAKEN THEREFORE SDAT IS ALWAYS FIRST    067706
     C* DATE OF MONTH AND EDAT IS ALWAYS FIRS DATE OF NEXT MONTH.         067706
     C* FOR INCOMPLETE MONTH FORCE SDATE EQUAL EDAT.                      067706
     C*                                                                   067706
     C           WEND      DOWGTWCLDTM                     - B1
     C*********  LDAC      IFEQ 'Y'                        - B2           067706
     C*********  WCFDTM    SUB  1         SDAT                            067706
     C*********            Z-ADDWCLDTM    EDAT                            067706
     C*********            ELSE                            - X2           067706
     C                     Z-ADDWCFDTM    SDAT
     C                     Z-ADDWCFDNM    EDAT
     C*********            END                             - E2           067706
     C*********  SDAT      IFLT WPCID                      - B2           067706
     C*********            Z-ADDWPCID     SDAT                            067706
     C           SDAT      IFLT BHISD                      - B2           067706
     C                     Z-ADDBHISD     SDAT                            067706
     C                     END                             - E2
     C*
     C           SDAT      IFLT EDAT                       - B2
     C                     EXSR PRCC34
     C                     END                             - E2
     C*
     C** FOLLOWING MONTHS USE WHISB
     C*
     C                     Z-ADDWHISB     CRMNBL
     C                     Z-ADDWHISB     WMNBL
     C*
     C** CALCULATE NEXT END OF MONTH DATE
     C*
     C           WCFDNM    IFEQ 0                          - B1
     C                     Z-ADDWHISD     WCFDNM
     C                     END                             - E1
     C*
     C           NCAP34    IFEQ 'Y'                                                         MD055663
     C                     Z-ADDWCFDNM    ZDAYNO                                            MD055663
     C                     ADD  1         ZDAYNO                                            MD055663
     C                     ELSE                                                             MD055663
     C                     Z-ADDWCFDNM    ZDAYNO
     C                     ENDIF                                                            MD055663
     C                     EXSR DATEIN
     C*
     C                     Z-ADDZFDTM     WCFDTM
     C                     Z-ADDZLDTM     WCLDTM
     C                     Z-ADDZFDNM     WCFDNM
     C                     Z-ADDZLDNM     WCLDNM
      *                                                                   182452
      ** If just taken on interest type 3 or 4 and the minimum balance/   182452
      ** initial rate initialisation indicator is still on and already    182452
      ** processing the final interest calculation, get initial interest  182452
      ** rate.                                                            182452
      *                                                                   182452
     C           W@MBIC    IFEQ 'Y'                                       182452
     C           *IN50     ANDEQ'1'                                       182452
     C                     MOVE 'N'       W@MBIC                          182452
     C                     Z-ADD*ZEROS    W@FDMC                          182452
      *                                                                   182452
      ** Set the rate fields                                              182452
      *                                                                   182452
     C           R2KEY     SETLLREHRCJ                                    182452
     C           R2KEY     READEREHRCJ                   52               182452
     C                     EXSR CRSET                                     182452
      *                                                                   182452
     C                     ENDIF                                          182452
     C*
     C                     END                             - E1
     C*
     C** CALCULATE FINAL MONTH MINIMUM BALANCE
     C*
     C           WRECI     IFNE 'S'
     C           WRECI     ANDNE' '                                       182452
     C           WHISB     ADD  DMVT      WWMNBL
     C                     SUB  CMVT      WWMNBL
     C                     ELSE
     C                     Z-ADDWHISB     WWMNBL
     C                     END
     C           WEND      IFEQ WCFDTM                     - B1
     C                     Z-ADDWWMNBL    CRMNBL
     C                     Z-ADDWWMNBL    WMNBL
     C                     ELSE                            - X1
     C           WWMNBL    IFGT CRMNBL                     - B2
     C                     Z-ADDWWMNBL    CRMNBL
     C                     Z-ADDWWMNBL    WMNBL
     C                     END                             - E2
     C                     END                             - E1
     C*
     C** LAST MONTH OF PERIOD PROCESS ONLY IF CAPITALISATION, END
     C** OF MONTH OR CHANGE OF ACCOUNT.
     C*
     C           WEND      IFEQ CTFDAT                     - B1
     C******     WEND      OREQ CNCID                                     067706
     C******     WRECI     OREQ 'S'                                063793 067706
     C******     SCICI     ANDNE*BLANKS                            063793 067706
     C*
     C* ONLY FULL MONTH ARE TO BE TAKEN THEREFORE SDAT IS ALWAYS FIRST    067706
     C* DATE OF MONTH AND EDAT IS ALWAYS FIRS DATE OF NEXT MONTH.         067706
     C* FOR INCOMPLETE MONTH FORCE SDATE EQUAL EDAT.                      067706
     C*                                                                   067706
     C*********  LDAC      IFEQ 'Y'                        - B2           067706
     C*********  WCFDTM    SUB  1         SDAT                            067706
     C*********            Z-ADDWCLDTM    EDAT                            067706
     C*********            ELSE                            - X2           067706
     C                     Z-ADDWCFDTM    SDAT
     C                     Z-ADDWCFDNM    EDAT
     C*********            END                             - E2           067706
     C*********  SDAT      IFLT WPCID                      - B2           067706
     C*********            Z-ADDWPCID     SDAT                            067706
     C           SDAT      IFLT BHISD                      - B2           067706
     C                     Z-ADDBHISD     SDAT                            067706
     C                     END                             - E2           067706
     C*********  WRECI     IFEQ 'S'                                063793 067706
     C********   SCICI     ANDNE*BLANKS                            063793 067706
     C********             Z-ADDWEND      EDAT                     063793 067706
     C*********            END                                     063793 067706
     C***********SDAT      IFLT WPCID                      - B2           067706
     C***********          Z-ADDWPCID     SDAT                            067706
     C***********          END                             - E2           067706
     C********   CNCID     IFLT EDAT                       - B2           067706
     C********   CNCID     ANDGTSDAT                                      067706
     C********             Z-ADDCNCID     EDAT                            067706
     C********             END                             - E2           067706
     C           CTFDAT    IFLT EDAT                       - B2
     C***********          Z-ADDCTFDAT    EDAT                            067706
     C                     Z-ADDSDAT      EDAT                            067706
     C                     END                             - E2
     C*
     C           SDAT      IFLT EDAT                       - B2
     C                     EXSR PRCC34
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     Z-ADDWCAID     WCMINT
     C*
     C                     Z-ADDWBEG      ZIBEG
     C                     Z-ADDWEND      ZIEND
     C*
     C/COPY WNCPYSRC,RE3662C064
     C                     ENDSR                           **ZICC34 ENDSR**
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP22                                           S01408
      *                                                                   S01408
     C********************************************************************
     C*EJECT***********************************************************                       220323
     C********************************************************************
     C*****************************************************************                       220323
     C***ZICD*subroutine*to*find*number*of*days*to*calculate*interest**                       220323
     C********according*to*calculation*basis***************************                       220323
     C*****************************************************************                       220323
     C*******Called*by*******ZIC00,ZIC01,ZIC02*************************                       220323
     C*******Calls***********DBSR**************************************                       220323
     C*****************************************************************                       220323
      *****************************************************************   CCB003
     C********** ZICD      BEGSR                           **ZICD BEGSR**                     220323
     C**********                                                                              220323
     C**TO*DETERMINE*NUMBER*OF*DAYS*INTEREST*TO*BE*CALCULATED**********                       220323
     C**********                                                                              220323
     C********** ZIEND     SUB  ZIBEG     ZDAYN2                                              220323
     C**********                                                                              220323
     C**CHECK*FOR*INTEREST*CALCULATION*BASIS***************************                       220323
     C**********                                                                              220323
     C********** ZICALC    IFEQ 3                          - B1                               220323
     C********** ZICALC    OREQ 0                                                      CER016 220323
      **********                                                                       CER016 220323
     C********** ZIEND     IFGT ZIBEG                      - B2                               220323
     C**********                                                                              220323
     C***CALCULATING*DATE*FROM*DAY*NUMBER*(BEGINNING DATE)*************                       220323
     C**********                                                                              220323
     C**********           Z-ADDZIBEG     ZDAYNO                                              220323
     C****IN99*SET*OFF*AS*ZDATE2Z2*DOES*NOT*RESET.*ZDATE2Z4*NOT*USED.**                       220323
     C**********                                                                              220323
     C**********           SETOF                     99                                       220323
     C**********           EXSR ZDATE2                                                        220323
     C**********                                                                              220323
     C***VERIFY*IF*ERROR***********************************************                       220323
     C**********                                                                              220323
     C********** *IN99     IFEQ '1'                        - B3                               220323
     C********** *LOCK     IN   LDA                                                           220323
     C**********           Z-ADD27        DBASE            ***************                    220323
     C**********           MOVE 'ZDATE2'  DBFILE           **DB ERROR 27**                    220323
     C**********           MOVE *BLANKS   DBKEY            ***************                    220323
     C**********           OUT  LDA                                                           220323
     C**********           EXSR DBSR                                                          220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C********** *IN98     IFEQ '0'                        - B3                        088029 220323
     C**********           Z-ADDZDATE     SRES                                                220323
     C**********           ELSE                            - X3                        088029 220323
     C**********           Z-ADDZDATE     SRESX                                        088029 220323
     C**********           Z-ADDZISDX     ZISD                                         088029 220323
     C**********           Z-ADDZISMX     ZISM                                         088029 220323
     C**********           Z-ADDZISYX     ZISY                                         088029 220323
     C**********           END                             - E3                        088029 220323
     C**********                                                                              220323
     C***CALCULATING*DATE*FROM*DAY*NUMBER*(FINISHING*DATE)*************                       220323
     C**********                                                                              220323
     C**********           Z-ADDZIEND     ZDAYNO                                              220323
     C****IN99*SET*OFF*AS*ZDATE2Z2*DOES*NOT*RESET.*ZDATE2Z4*NOT*USED.**                       220323
     C**********                                                                              220323
     C**********           SETOF                     99                                       220323
     C**********           EXSR ZDATE2                                                        220323
     C**********                                                                              220323
     C***VERIFY*IF*ERROR***********************************************                       220323
     C**********                                                                              220323
     C********** *IN99     IFEQ '1'                        - B3                               220323
     C********** *LOCK     IN   LDA                                                           220323
     C**********           Z-ADD18        DBASE            ***************                    220323
     C**********           MOVE 'ZDATE2'  DBFILE           **DB ERROR 18**                    220323
     C**********           MOVE *BLANKS   DBKEY            ***************                    220323
     C**********           OUT  LDA                                                           220323
     C**********           EXSR DBSR                                                          220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C********** *IN98     IFEQ '0'                        - B3                        088029 220323
     C**********           Z-ADDZDATE     FRES                                                220323
     C**********           ELSE                            - X3                        088029 220323
     C**********           Z-ADDZDATE     FRESX                                        088029 220323
     C**********           Z-ADDZIFDX     ZIFD                                         088029 220323
     C**********           Z-ADDZIFMX     ZIFM                                         088029 220323
     C**********           Z-ADDZIFYX     ZIFY                                         088029 220323
     C**********           END                             - E3                        088029 220323
     C**********                                                                              220323
     C***IN*ORDER*FOR*THE*FINISH*YEAR*TO*BE*LESS*THAN*THE*START*YEAR*IF*ZIEND                 220323
     C***IS*GREATER*THAN*ZIBEG,*THEN*THE*DATE*ZIEND*MUST*BE*IN*A*DIFFERENT                    220323
     C***CENTURY*TO*ZIBEG.*IF*SO*ADD*100*YEARS*TO*IT.******************                       220323
     C**********                                                                              220323
     C********** ZIFY      IFLT ZISY                       - B3                               220323
     C********** ZIFY      ADD  100       ZIFY2                                               220323
     C**********           ELSE                            - X3                               220323
     C**********           Z-ADDZIFY      ZIFY2                                               220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C**********           Z-ADDZISY      ZISY2                                               220323
     C**********                                                                              220323
     C***DETERMINE*WHETHER*START*YEAR*IS*A*LEAP*YEAR*AND*IF*START*MONTH                       220323
     C***IS*FEBRUARY**THEN*CONSIDER*LAST*DAY*OF*FEBRUARY*AS*DATE*30ND.*                       220323
     C***OF*THE*MONTH**************************************************                       220323
     C**********                                                                              220323
     C********** ZICALC    IFEQ 3                                                      CER016 220323
     C********** ZICALC    OREQ 0                                                      CER016 220323
     C********** CER016    ANDEQ'N'                                                    CER016 220323
     C*COPY*WNCPYSRC,RE3662C076****************************************                       220323
     C********** ZISM      IFEQ 2                          - B3                               220323
     C********** ZISY2     ADD  1900      ZLYCHK                                              220323
     C********** ZLYCHK    DIV  4         ZLYCHK                                              220323
     C**********           MVR            ZLYREM                                              220323
     C********** ZLYREM    IFEQ 0                          - B4                               220323
     C********** ZISD      IFEQ 29                         - B5                               220323
     C**********           Z-ADD30        ZISD                                                220323
     C**********           END                             - E5                               220323
     C**********           ELSE                            - X4                               220323
     C********** ZISD      IFEQ 28                         - B5                               220323
     C**********           Z-ADD30        ZISD                                                220323
     C**********           END                             - E5                               220323
     C**********           END                             - E4                               220323
     C**********           END                             - E3                               220323
      **********                                                                       CER016 220323
     C**********           ENDIF                                                       CER016 220323
     C*COPY*WNCPYSRC,RE3662C077****************************************                       220323
     C**********                                                                              220323
     C********** 30        SUB  ZISD      ZID1                                                220323
     C**********                                                                              220323
     C********** ZID1      IFLT 0                          - B3                               220323
     C**********           Z-ADD*ZEROS    ZID1                                                220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C********** ZISM      IFEQ 12                         - B3                               220323
     C**********           Z-ADD*ZEROS    ZISM                                                220323
     C**********           ADD  1         ZISY                                                220323
     C**********           ADD  1         ZISY2                                               220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C***DETERMINE*WHETHER*END*YEAR*IS*A*LEAP*YEAR*AND*IF*END*MONTH*IS*FEBRUARY               220323
     C**********                                                                              220323
     C********** ZICALC    IFEQ 3                                                      CER016 220323
     C********** ZICALC    OREQ 0                                                      CER016 220323
     C********** CER016    ANDEQ'N'                                                    CER016 220323
     C*COPY*WNCPYSRC,RE3662C078                                                               220323
     C********** ZIFM      IFEQ 2                          - B3                               220323
     C********** ZIFY2     ADD  1900      ZLYCHK                                              220323
     C********** ZLYCHK    DIV  4         ZLYCHK                                              220323
     C**********           MVR            ZLYREM                                              220323
     C********** ZLYREM    IFEQ 0                          - B4                               220323
     C********** ZIFD      IFEQ 29                         - B5                               220323
     C**********           Z-ADD30        ZIFD                                                220323
     C**********           END                             - E5                               220323
     C**********           ELSE                            - X4                               220323
     C********** ZIFD      IFEQ 28                         - B5                               220323
     C**********           Z-ADD30        ZIFD                                                220323
     C**********           END                             - E5                               220323
     C**********           END                             - E4                               220323
     C**********           END                             - E3                               220323
      **********                                                                       CER016 220323
     C**********           ENDIF                                                       CER016 220323
     C*COPY*WNCPYSRC,RE3662C079************************************                           220323
     C**********                                                                              220323
     C********** ZIFD      IFEQ 31                         - B3                               220323
     C**********           ADD  30        ZID1                                                220323
     C**********           ELSE                            - X3                               220323
     C**********           ADD  ZIFD      ZID1                                                220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C**********           SUB  1         ZIFM                                                220323
     C**********                                                                              220323
     C********** ZISY      IFEQ ZIFY                       - B3                               220323
     C********** ZIFM      SUB  ZISM      ZINOM                                               220323
     C**********           ELSE                            - X3                               220323
     C********** 12        SUB  ZISM      ZIM1                                                220323
     C**********           Z-ADD1         ZISM                                                220323
     C**********                                                                              220323
     C***USE*ENLARGE*FIELDS*THAT*CAN*HANDLE*1999*ONWARDS***************                       220323
     C**********                                                                              220323
     C**********           ADD  1         ZISY2                                               220323
     C********** ZIFY2     SUB  ZISY2     ZIY1                                                220323
     C********** ZIY1      MULT 12        ZIM2                                                220323
     C********** ZIM2      ADD  ZIFM      ZIM2                                                220323
     C********** ZIM2      ADD  ZIM1      ZINOM                                               220323
     C**********                                                                              220323
     C**********           END                             - E3                               220323
     C**********                                                                              220323
     C********** ZINOM     MULT 30        ZID2                                                220323
     C********** ZID2      ADD  ZID1      ZDAYN2                                              220323
     C**********                                                                              220323
     C**********           END                             - E2                               220323
     C**********                                                                              220323
     C**********           END                             - E1                               220323
     C**********                                                                              220323
     C********** ZICALC    IFEQ 4                          - B1                               220323
     C********** ZICALC    OREQ 5                                                             220323
     C**********                                                                              220323
     C***ONE*DAY*IS*SUBTRACTED*FROM*ZDAYN2*FOR*EACH*OCCURANCE*OF*29*FEB*IN*THE                220323
     C***THE*INTEREST*CALCULATION*PERIOD*INCLUSIVE*OF*ZIBEG*AND*ZIEND**                       220323
     C**********                                                                              220323
     C***FIND*NO*OF*FOUR*YEAR*PERIODS*BETWEEN*DATES********************                       220323
     C**********                                                                              220323
     C********** ZDAYN2    DIV  1461      ZIMAN                                               220323
     C**********           MVR            ZIREM                                               220323
     C**********                                                                              220323
     C***FIND*NEXT*29*FEB*DAY*NO.*ON*OR*AFTER*ZIBEG.*******************                       220323
     C**********                                                                              220323
     C********** ZIBEG     SUB  60        ZIBW1                                               220323
     C********** ZIBW1     DIV  1461      ZIDW1                                               220323
     C**********           MVR            ZIDREM                                              220323
     C**********                                                                              220323
     C********** ZIDREM    IFEQ 0                          - B2                               220323
     C**********           Z-ADDZIBEG     ZIDW2                                               220323
     C**********           END                             - E2                               220323
     C**********                                                                              220323
     C***ROUND*UP*RESULT***********************************************                       220323
     C**********                                                                              220323
     C********** ZIDW1     ADD  1         ZIDW2                                               220323
     C**********                                                                              220323
     C***CALCULATE*NEXT*29*FEB.****************************************                       220323
     C**********                                                                              220323
     C********** ZIDW2     MULT 1461      ZIDW2                                               220323
     C********** ZIDW2     ADD  60        ZIDW2                                               220323
     C**********                                                                              220323
     C***IF*THIS*NEXT*29*FEB.*DAYNO*-*ZIBEG*IS*GREATER*OR*EQUAL*TO*ZIREM*THEN                 220323
     C***ADD*1*TO*ZIMAN.***********************************************                       220323
     C**********                                                                              220323
     C********** ZIDW2     SUB  ZIBEG     ZILPCP                                              220323
     C**********                                                                              220323
     C********** ZIREM     IFGE ZILPCP                     - B2                               220323
     C**********           ADD  1         ZIMAN                                               220323
     C**********           END                             - E2                               220323
     C**********                                                                              220323
     C***SUBTRACT*ZIMAN*FROM*ZDAYN2*TO*GIVE*VALUE*OF*ZDAYN2*REQUIRED*FOR*THIS                 220323
     C***INTEREST*CALCULATION******************************************                       220323
     C**********                                                                              220323
     C********** ZDAYN2    SUB  ZIMAN     ZDAYN2                                              220323
     C**********                                                                              220323
     C**********           END                             - E1                               220323
     C**********                                                                              220323
     C**********           ENDSR                           **ZICD ENDSR**                     220323
     C********************************************************************
     C/EJECT                                                                                  220323
     C/COPY ZSRSRC,ZICDREZ2                                                                   220323
     C/EJECT
     C********************************************************************
     C**
     C** ZICDR subroutine to calculate interest for debit interest type < 2
     C**
     C**     Called by       DETPR,INTSR
     C**     Calls           ZIC00,ZIC01,ZIC02
     C**
      *****************************************************************   CCB003
     C           ZICDR     BEGSR                           **ZICDR BEGSR**
     C*
     C** INITIALIZE ZINTR
     C*
     C                     Z-ADD*ZEROS    ZINTR
     C*
     C           WHISB     IFGT 0                          - B1
     C*
     C** INITIALIZE WORK FIELDS
     C*
     C                     MOVE 'Y'       WDEBIT                                              CER055
     C                     Z-ADD*ZEROS    ZDAYN2
     C                     Z-ADD*ZEROS    ZIN
     C                     Z-ADDWHISB     ZIAMT
     C                     Z-ADDWHISB     ZIAMT1
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWDRIR     ZIRATE
     C                     Z-ADDZIBD      ZIB
     C                     Z-ADDZIRD      ZIR
     C                     Z-ADDINTHD     ZITHR
     C                     Z-ADD*ZEROS    ZIWRK1
     C                     Z-ADD*ZEROS    ZIWRK2
     C                     Z-ADD*ZEROS    ZIA
     C                     Z-ADD1         Z
     C                     Z-ADD*ZEROS    Y
     C                     Z-ADD*ZEROS    LOOP
     C                     Z-ADD*ZEROS    ZIAMTR
     C                     Z-ADD*ZEROS    ZBAL
     C                     Z-ADD*ZEROS    ZIA1
     C                     Z-ADDWDSTYP    WWSTYP           INT.SUB-TYPE
     C*
     C** CHECK ON INTEREST TYPE
     C*
     C********** WDICT     CASEQ0         ZIC00                           CRE001
     C   54      WDICT     CASEQ0         ZICOD                           CRE001
     C  N54      WDICT     CASEQ0         ZIC00                           CRE001
     C           WDICT     CASEQ1         ZIC01
     C           WDICT     CASEQ2         ZIC02
     C                     END
     C*
     C                     END                             - E1
     C*
     C                     Z-ADDZINTR     WDINT
     C/COPY WNCPYSRC,RE3662C015
     C*
     C                     ENDSR                           **ZICDR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZICD34 subroutine to calculate interest for debit interest type > 3
     C**
     C**     Called by       INTSR
     C**     Calls           PRCD34
     C**
      *****************************************************************   CCB003
     C           ZICD34    BEGSR                           **ZICD34 BEGSR**
     C*
     C** SAVE DATES FOR CREDIT SIDE
     C*
     C                     Z-ADDZIBEG     WBEG
     C                     Z-ADDZIEND     WEND
     C*
     C** START & END DATE SETUP
     C*
     C                     Z-ADD*ZEROS    SDAT
     C                     Z-ADD*ZEROS    EDAT
     C*
     C** FINAL DATE IS GREATER THEN MONTH END THEN CALCULATE THID MONTH
     C** INTEREST
     C*
     C* ONLY FULL MONTH ARE TO BE TAKEN THEREFORE SDAT IS ALWAYS FIRST    067706
     C* DATE OF MONTH AND EDAT IS ALWAYS FIRS DATE OF NEXT MONTH.         067706
     C* FOR INCOMPLETE MONTH FORCE SDATE EQUAL EDAT.                      067706
     C*                                                                   067706
     C           WEND      DOWGTWDLDTM                     - B1
     C*********  LDAC      IFEQ 'Y'                        - B2           067706
     C*********  WDFDTM    SUB  1         SDAT                            067706
     C*********            Z-ADDWDLDTM    EDAT                            067706
     C*********            ELSE                            - X2           067706
     C                     Z-ADDWDFDTM    SDAT
     C                     Z-ADDWDFDNM    EDAT
     C*************        END                             - E2           067706
     C*****      SDAT      IFLT WPDID                      - B2           067706
     C******               Z-ADDWPDID     SDAT                            067706
     C           SDAT      IFLT BHISD                      - B2           067706
     C                     Z-ADDBHISD     SDAT                            067706
     C                     END                             - E2
     C*
     C           SDAT      IFLT EDAT                       - B2
     C                     EXSR PRCD34
     C                     END                             - E2
     C*
     C** FOLLOWING MONTHS USE MNBL
     C*
     C                     Z-ADDWHISB     DRMNBL
     C***********          Z-ADDWHISD     WMNBL                           063793
     C                     Z-ADDWHISB     WMNBL                           063793
     C*
     C** CALCULATE NEXT END OF MONTH DATE
     C*
     C           WDFDNM    IFEQ 0                          - B1
     C                     Z-ADDWHISD     WDFDNM
     C                     END                             - E1
     C*
     C           NCAP34    IFEQ 'Y'                                                         MD055663
     C                     Z-ADDWDFDNM    ZDAYNO                                            MD055663
     C                     ADD  1         ZDAYNO                                            MD055663
     C                     ELSE                                                             MD055663
     C                     Z-ADDWDFDNM    ZDAYNO
     C                     ENDIF                                                            MD055663
     C                     EXSR DATEIN
     C*
     C                     Z-ADDZFDTM     WDFDTM
     C                     Z-ADDZLDTM     WDLDTM
     C                     Z-ADDZFDNM     WDFDNM
     C                     Z-ADDZLDNM     WDLDNM
      *                                                                   182452
      ** If just taken on interest type 3 or 4 and the minimum balance/   182452
      ** initial rate initialisation indicator is still on and already    182452
      ** processing the final interest calculation, get initial interest  182452
      ** rate.                                                            182452
      *                                                                   182452
     C           W@MBID    IFEQ 'Y'                                       182452
     C           *IN50     ANDEQ'1'                                       182452
     C                     MOVE 'N'       W@MBID                          182452
     C                     Z-ADD*ZEROS    W@FDMD                          182452
      *                                                                   182452
      ** Set the rate fields                                              182452
      *                                                                   182452
     C           R2KEY     SETLLREHRDJ                                    182452
     C           R2KEY     READEREHRDJ                   51               182452
     C                     EXSR DRSET                                     182452
      *                                                                   182452
     C                     ENDIF                                          182452
     C*
     C                     END                             - E1
     C*
     C** CALCULATE FINAL MONTH MINIMUM BALANCE
     C*
     C           WRECI     IFNE 'S'
     C           WRECI     ANDNE' '                                       182452
     C           WHISB     ADD  DMVT      WWMNBL
     C                     SUB  CMVT      WWMNBL
     C                     ELSE
     C                     Z-ADDWHISB     WWMNBL
     C                     END
     C           WEND      IFEQ WDFDTM                     - B1
     C                     Z-ADDWWMNBL    DRMNBL
     C                     Z-ADDWWMNBL    WMNBL
     C                     ELSE                            - X1
     C           WWMNBL    IFGT DRMNBL                     - B2
     C                     Z-ADDWWMNBL    DRMNBL
     C                     Z-ADDWWMNBL    WMNBL
     C                     END                             - E2
     C                     END                             - E1
     C*
     C** LAST MONTH OF PERIOD PROCESS ONLY IF $APITALISATION, END
     C** OF MONTH OR CHANGE OF ACCOUNT.
     C*
     C           WEND      IFEQ CTFDAT                     - B1
     C*****      WEND      OREQ CNDID                                     067706
     C*****      WRECI     OREQ 'S'                                063793 067706
     C*****      SDICI     ANDNE*BLANKS                            063793 067706
     C*
     C* ONLY FULL MONTH ARE TO BE TAKEN THEREFORE SDAT IS ALWAYS FIRST    067706
     C* DATE OF MONTH AND EDAT IS ALWAYS FIRS DATE OF NEXT MONTH.         067706
     C* FOR INCOMPLETE MONTH FORCE SDATE EQUAL EDAT.                      067706
     C*                                                                   067706
     C*********  LDAC      IFEQ 'Y'                        - B2           067706
     C*********  WDFDTM    SUB  1         SDAT                            067706
     C*********            Z-ADDWDLDTM    EDAT                            067706
     C*********            ELSE                            - X2           06770%
     C                     Z-ADDWDFDTM    SDAT
     C                     Z-ADDWDFDNM    EDAT
     C*************        END                             - E2           067706
     C******     WRECI     IFEQ 'S'                                063793 067706
     C******     SDICI     ANDNE*BLANKS                            063793 067706
     C******               Z-ADDWEND      EDAT                     063793 067706
     C*****                END                                     063793 067706
     C*****      SDAT      IFLT WPDID                      - B2           067706
     C******               Z-ADDWPDID     SDAT                            067706
     C           SDAT      IFLT BHISD                      - B2           067706
     C                     Z-ADDBHISD     SDAT                            067706
     C                     END                             - E2
     C*****      CNDID     IFLT EDAT                       - B2           067706
     C*****      CNDID     ANDGTSDAT                                      067706
     C*****                Z-ADDCNDID     EDAT                            067706
     C*****                END                             - E2           067706
     C           CTFDAT    IFLT EDAT                       - B2
     C*****                Z-ADDCTFDAT    EDAT                            067706
     C                     Z-ADDSDAT      EDAT                            067706
     C                     END                             - E2
     C*
     C           SDAT      IFLT EDAT                       - B2
     C                     EXSR PRCD34
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     Z-ADDWDAID     WDMINT
     C*
     C                     Z-ADDWBEG      ZIBEG
     C                     Z-ADDWEND      ZIEND
     C*
     C/COPY WNCPYSRC,RE3662C065
     C                     ENDSR                           **ZICD34 ENDSR**
     C/EJECT                                                              CRE001
     C********************************************************************CRE001
     C**                                                                  CRE001
     C** ZICOD subroutine to calculate Interest with Overdraft            CRE001
     C**                                                                  CRE001
     C**     Called by       INTCAL                                       CRE001
     C**     Calls           ZIC00                                        CRE001
     C**                                                                  CRE001
     C********************************************************************CRE001
     C           ZICOD     BEGSR                           **ZICOD BEGSR**CRE001
      *                                                                   CRE001
      ** Zeroise work fields                                              CRE001
     C                     Z-ADD*ZEROS    WWINTA                          CRE001
     C                     Z-ADD*ZEROS    WWDRIA                          CRE001
     C                     Z-ADD*ZEROS    WWODIA                          CRE001
     C                     Z-ADD*ZEROS    FWODLN 150                      CRE001
      *                                                                   CRE001
      ** Set work field with Overdraft Line Amount                        CRE001
     C                     Z-ADDWWODLN    FWODLN                          CRE001
      *                                                                   CRE001
      ** Adjust work field according to Currency Decimal Places           CRE001
      **                                  (retrieved earlier)             CRE001
     C                     DO   CDP                                       CRE001
     C                     MULT 10        FWODLN                          CRE001
     C                     ENDDO                                          CRE001
     C/COPY WNCPYSRC,RE3662C070
      *                                                                   CRE001
      ** If work History Balance > work field Overdraft Line Amount       CRE001
      **    And work Additional Overdraft Rate NOT = 0                    CRE001
      **    And Period End Date < OR = work Overdraft Expiry Date         CRE001
     C           WHISB     IFGT FWODLN                     B1             CRE001
     C           WWAODR    ANDNE*ZERO                      A1             CRE001
     C           ZIEND     ANDLEWWODED                     A1             CRE001
      *                                                                   CRE001
     C/COPY WNCPYSRC,RE3662C087
      ** Calculate Interest on History Balance using normal DR Int.Rate   CRE001
     C                     Z-ADDWHISB     ZIAMT                           CRE001
     C/COPY WNCPYSRC,RE3662C088
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Interest Amount           CRE001
     C                     Z-ADDZINTR     WWINTA                          CRE001
      *                                                                   CRE001
      ** Calculate Interest again using Additional Overdraft Rate         CRE001
      ** on the difference between the Balance and the Overdraft Limit    CRE001
     C           WHISB     SUB  FWODLN    ZIAMT                           CRE001
     C                     Z-ADDWWAODR    ZIRATE                          CRE001
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Overdraft Interest Amt    CRE001
     C                     Z-ADDZINTR     WWODIA                          CRE001
      *                                                                   CRE001
      ** Interest Amt + Overdraft Interest Amt = Debit Interest Amt       CRE001
     C           WWINTA    ADD  WWODIA    WWDRIA                          CRE001
      *                                                                   CRE001
     C                     ELSE                            X1             CRE001
      *                                                                   CRE001
      ** If Period End Date > Overdraft Expiry Date                       CRE001
      **    And Overdraft Expiry Date > 0                                 CRE001
     C           ZIEND     IFGT WWODED                     B.2            CRE001
     C           WWODED    ANDGT*ZERO                      A.2            CRE001
      *                                                                   CRE001
      ** Calculate Interest on History Balance using normal DR Int.Rate   CRE001
     C                     Z-ADDWHISB     ZIAMT                           CRE001
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Interest Amount           CRE001
     C                     Z-ADDZINTR     WWINTA                          CRE001
      *                                                                   CRE001
      ** Calculate Interest again using Additional Overdraft Rate         CRE001
      ** on the same Balance Amount                                       CRE001
     C                     Z-ADDWHISB     ZIAMT                           CRE001
     C                     Z-ADDWWAODR    ZIRATE                          CRE001
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Overdraft Interest Amt    CRE001
     C                     Z-ADDZINTR     WWODIA                          CRE001
      *                                                                   CRE001
      ** Interest Amt + Overdraft Interest Amt = Debit Interest Amt       CRE001
     C           WWINTA    ADD  WWODIA    WWDRIA                          CRE001
      *                                                                   CRE001
     C                     ELSE                            X.2            CRE001
      *                                                                   CRE001
      ** Calculate Interest on History Balance using normal DR Int.Rate   CRE001
     C                     Z-ADDWHISB     ZIAMT                           CRE001
     C                     EXSR ZIC00                                     CRE001
      *                                                                   CRE001
      ** Move calculated Interest to work field Debit Interest Amt        CRE001
     C                     Z-ADDZINTR     WWDRIA                          CRE001
      *                                                                   CRE001
     C                     ENDIF                           E.2            CRE001
     C                     ENDIF                           E1             CRE001
      *                                                                   CRE001
      ** Move Debit Interest Amount to Interest Amount                    CRE001
     C                     Z-ADDWWDRIA    ZINTR                           CRE001
     C/COPY WNCPYSRC,RE3662C071
      *                                                                   CRE001
     C                     ENDSR                           **ZICOD ENDSR**CRE001
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZIC00 subroutine to calculate interest (type=00)
     C**
     C**     Called by       ZICCR,ZICDR
     C**     Calls           ZICD
     C**
      *****************************************************************   CCB003
     C           ZIC00     BEGSR                           **ZIC00 BEGSR**
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CPD1                                           S01408
     C*                                                                   S01408
     C*
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASIS
     C*
     C                     EXSR ZICD
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZIAMT     MULT ZIRATE    ZIWRK1                                              220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIWRK1    MULT INT6DY    ZIWRK2                                              220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIWRK1    MULT ZDAYN2    ZIWRK2                                              220323
     C                     ENDIF                                                              220323
     C*
     C********** ZICALC    IFEQ 7                          - B1                             MD035448
     C********** ZICALC    OREQ 5                                                           MD035448
     C********** ZICALC    OREQ 3                                                           MD035448
     C********** ZICALC    OREQ 2                                                           MD035448
     C********** ZICALC    OREQ 0                                                    CER016 MD035448
      *                                                                                       CER016
     C********** ZICALC    IFEQ 0                                                    CER016 MD035448
     C           CER016    IFEQ 'Y'                                                         MD035448
     C           PINTN     ANDEQ'Y'                                                           CER016
     C                     Z-ADDZIAMT     WAMT                                                CER016
     C                     Z-ADDZIRATE    WRATE2                                              CER016
     C                     EXSR SRINT0                                                        CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C           ZICALC    IFEQ 7                          - B1                             MD035448
     C           ZICALC    OREQ 5                                                           MD035448
     C           ZICALC    OREQ 3                                                           MD035448
     C           ZICALC    OREQ 2                                                           MD035448
     C           ZICALC    OREQ 0                                                           MD035448
     C********** ZIAMT     DIV  36000     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36000     ZINTR     H                                         220323
     C                     END                                                                CER016
      *                                                                                       CER016
     C**********           END                             - E1                             MD035448
     C*
     C           ZICALC    IFEQ 4                          - B1
     C           ZICALC    OREQ 1
     C********** ZIAMT     DIV  36500     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36500     ZINTR     H                                         220323
     C                     END                             - E1
     C*
     C           ZICALC    IFEQ 6                          - B1
     C********** ZIAMT     DIV  36600     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36600     ZINTR     H                                         220323
     C                     END                             - E1
     C                     ENDIF                           - E1                             MD035448
     C*
     C********** ZICALC    IFNE 0                                                      CER016 220323
     C********** PINTN     ORNE 'Y'                                                    CER016 220323
     C********** ZIWRK1    MULT ZIRATE    ZIWRK2    H                                         220323
     C********** ZIWRK2    MULT ZDAYN2    ZINTR     H                                         220323
     C**********           ENDIF                                                       CER016 220323
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CPD2                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **ZIC00 ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZIC01 subroutine to calculate interest (type=01)
     C**
     C**     Called by       PRCC34,PRCD34,ZICCR,ZICDR
     C**     Calls           ZICD
     C**
      *****************************************************************   CCB003
     C           ZIC01     BEGSR                           **ZIC01 BEGSR**
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CPD3                                           S01408
     C*                                                                   S01408
     C*
     C***INTEREST*IS*ONLY*CALCULATED*ON*AN*AMOUNT*THAT*EXCEEDS*OR*IS*EQUAL103460
     C***TO*THE*INITIAL*THRESHOLD*BALANCE                                 103460
      *  INTEREST IS ONLY CALCULATED ON AN AMOUNT THAT EXCEEDS THE        103460
      *  INITIAL THRESHOLD BALANCE                                        103460
     C*
     C***********ZIAMT     IFGE ZITHR                      - B1           103460
     C           ZIAMT     IFGT ZITHR                      - B1           103460
     C*
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASIS
     C*
     C                     EXSR ZICD
      *                                                                                     MD055663
      ** Add 1 day on cutover month such that number of days for which interest             MD055663
      ** is accrued on this balance should be the full number of days that would            MD055663
      ** normally calculated for this month                                                 MD055663
      *                                                                                     MD055663
     C           NCAP34    IFEQ 'Y'                                                         MD055663
     C           WDICT     IFGT 2                                                           MD055663
     C           WDFDTM    ANDEQWFDCO                                                       MD055663
     C           WCICT     ORGT 2                                                           MD055663
     C           WCFDTM    ANDEQWFDCO                                                       MD055663
     C                     ADD  1         ZDAYN2                                            MD055663
     C                     ENDIF                                                            MD055663
     C                     ENDIF                                                            MD055663
     C*
     C                     MOVE 'N'       WOVRDR  1                                           CER055
     C                     Z-ADD0         WOVRIN 117                                          CER055
     C                     Z-ADD0         WACTDB 110                                          CER055
     C           LOOP      DOWEQ0                          - B2
     C                     Z-ADDZIAMT1    ZIAMTR
      ** Skip and exit if BAL is -2                                                           CER055
     C           CER055    IFEQ 'Y'                                                           CER055
     C           WC0102    ANDEQ'Y'                                                           CER055
     C           WDEBIT    ANDEQ'Y'                                                           CER055
     C           ZIB,Z     ANDEQ-2                                                            CER055
     C                     MOVE 'Y'       WOVRDR                                              CER055
     C                     Z-ADDZIR,Z     WOVRIN                                              CER055
     C                     Z-ADDZIAMTR    ZIA,Y                                               CER055
     C                     Z-ADD1         LOOP                                                CER055
     C                     GOTO SKP01                                                         CER055
     C                     ENDIF                                                              CER055
     C*
     C           Z         IFEQ 11                         - B3
     C                     Z-ADDZIAMTR    ZIA,Z
     C                     Z-ADD1         LOOP
     C*
     C                     ELSE                            - X3
     C                     ADD  1         Y
     C                     ADD  1         Z
     C*
     C           ZIB,Z     IFEQ 0                          - B4
     C                     ADD  ZIAMTR    ZIA,Y
     C                     Z-ADD1         LOOP
     C*
     C                     ELSE                            - X4
      ** Skip and exit if BAL is -2                                                           CER055
     C           CER055    IFEQ 'Y'                                                           CER055
     C           WC0102    ANDEQ'Y'                                                           CER055
     C           WDEBIT    ANDEQ'Y'                                                           CER055
     C           ZIB,Z     ANDEQ-2                                                            CER055
     C                     MOVE 'Y'       WOVRDR                                              CER055
     C                     Z-ADDZIR,Z     WOVRIN                                              CER055
     C                     Z-ADDZIAMTR    ZIA,Y                                               CER055
     C                     Z-ADD1         LOOP                                                CER055
     C                     GOTO SKP01                                                         CER055
     C                     ENDIF                                                              CER055
     C           ZIB,Z     SUB  ZIB,Y     ZBAL
     C           ZIAMTR    SUB  ZBAL      ZIAMT1
     C*
     C           ZIAMT1    IFLE 0                          - B5
     C                     ADD  ZIAMTR    ZIA,Y
     C                     Z-ADD1         LOOP
      ** Check if last BAL is -2                                                              CER055
     C           CER055    IFEQ 'Y'                                                           CER055
     C           WC0102    ANDEQ'Y'                                                           CER055
     C           WDEBIT    ANDEQ'Y'                                                           CER055
     C                     ADD  1         Z                                                   CER055
     C           ZIB,Z     IFEQ -2                                                            CER055
     C                     MOVE 'Y'       WOVRDR                                              CER055
     C                     Z-ADDZIR,Z     WOVRIN                                              CER055
     C                     ENDIF                                                              CER055
     C                     ENDIF                                                              CER055
     C*
     C                     ELSE                            - X5
     C                     ADD  ZBAL      ZIA,Y
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C           SKP01     TAG                                                                CER055
     C                     END                             - E2
     C*
     C* IF THE SUB-TYPE IS FROM 50000 TO 99999, CALCULATE THE INTEREST
     C* ON THE AMOUNT EXCEEDING THE INITIAL THRESHOLD. OTHERWISE, THE
     C* INTEREST IS CALCULATED ON THE WHOLE BALANCE WHENEVER IT EXCEEDS
     C* THE INITIAL THRESHOLD.
     C*
     C           WWSTYP    IFGE 50000                      - B2
     C                     Z-ADD1         Z
     C           Z         DOWLT12                         - B3
     C           ZITHR     ANDGT0
     C           ZIA,Z     SUB  ZITHR     ZIA,Z
     C           ZIA,Z     IFLT 0                          - B4
     C                     Z-SUBZIA,Z     ZITHR
     C                     Z-ADD0         ZIA,Z
     C                     ELSE                            - X4
     C                     Z-ADD0         ZITHR
     C                     END                             - E4
     C                     ADD  1         Z
     C                     END                             - E3
     C                     END                             - E2
     C*
     C/COPY WNCPYSRC,RE3662C066
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZIA       MULT ZIR       ZIA1                                                220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIA1      MULT INT6DY    ZIA1                                                220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIA1      MULT ZDAYN2    ZIA1                                                220323
     C                     ENDIF                                                              220323
      *                                                                                       220323
     C********** ZICALC    IFEQ 7                          - B2                             MD035448
     C********** ZICALC    OREQ 5                                                           MD035448
     C********** ZICALC    OREQ 3                                                           MD035448
     C********** ZICALC    OREQ 2                                                           MD035448
     C********** ZICALC    OREQ 0                                                    CER016 MD035448
      *                                                                                       CER016
     C********** ZICALC    IFEQ 0                                                    CER016 MD035448
     C           CER016    IFEQ 'Y'                                                         MD035448
     C           PINTN     ANDEQ'Y'                                                           CER016
      *                                                                                       CER016
     C                     Z-ADD1         C       20                                          CER016
      *                                                                                       CER016
     C           C         DOWLT12                                                            CER016
      ** Skip if BAL is -2                                                                    CER055
     C           CER055    IFEQ 'Y'                                                           CER055
     C           WC0102    ANDEQ'Y'                                                           CER055
     C           WDEBIT    ANDEQ'Y'                                                           CER055
     C           ZIB,Z     ANDEQ-2                                                            CER055
     C                     ELSE                                                             AR833959
     C                     Z-ADDZIA,C     WAMT                                                CER016
     C                     Z-ADDZIR,C     WRATE2                                              CER016
     C                     EXSR SRINT0                                                        CER016
     C                     Z-ADDZINTR     ZIN1,C                                              CER016
     C                     ENDIF                                                            AR833959
     C                     ADD  1         C                                                   CER016
     C**********           ENDIF                                                     CER055 AR833959
     C                     ENDDO                                                              CER016
      *                                                                                       CER016
     C                     XFOOTZIN1      ZINTR1    H                                         CER016
     C                     Z-ADDZINTR1    ZINTR     H                                         CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C           ZICALC    IFEQ 7                          - B2                             MD035448
     C           ZICALC    OREQ 5                                                           MD035448
     C           ZICALC    OREQ 3                                                           MD035448
     C           ZICALC    OREQ 2                                                           MD035448
     C           ZICALC    OREQ 0                                                           MD035448
      *                                                                                       CER016
     C********** ZIA       DIV  36000     ZIA1      H                                         220323
     C           ZIA1      DIV  36000     ZIN1      H                                         220323
     C                     END                                                                CER016
     C*
     C**********           END                             - E2                             MD035448
     C*
     C           ZICALC    IFEQ 4                          - B2
     C           ZICALC    OREQ 1
     C********** ZIA       DIV  36500     ZIA1      H                                         220323
     C           ZIA1      DIV  36500     ZIN1      H                                         220323
     C*
     C                     END                             - E2
     C*
     C           ZICALC    IFEQ 6                          - B2
     C********** ZIA       DIV  36600     ZIA1      H                                         220323
     C           ZIA1      DIV  36600     ZIN1      H                                         220323
     C*
     C                     END                             - E2
     C                     ENDIF                           - E2                             MD035448
     C********** ZICALC    IFNE 0                                                    CER016 MD035448
     C           CER016    IFNE 'Y'                                                         MD035448
     C           PINTN     ORNE 'Y'                                                           CER016
     C/COPY WNCPYSRC,RE3662C001
     C*
     C********** ZIA1      MULT ZIR       ZIA1      H                                         220323
     C***********ZIA1      MULT ZDAYN2    ZIN       H                     074578
     C********** ZIA1      MULT ZDAYN2    ZIN1      H                                  074578 220323
     C***********          XFOOTZIN       ZINTR                           074578
     C                     XFOOTZIN1      ZINTR1 185H                     074578
     C                     Z-ADDZINTR1    ZINTR     H                     074578
     C                     ENDIF                                                              CER016
     C*
     C                     END                             - E1
      *                                                                                       CER055
      ** If OVERDRAFT exists, get account debit balance                                       CER055
      *                                                                                       CER055
     C           WOVRDR    IFEQ 'Y'                                                           CER055
     C                     Z-ADD0         WODLN  110                                          CER055
     C                     Z-ADD0         WODLN2 150                                        AR823701
     C                     Z-ADD0         WZIA   155                                          CER055
     C                     Z-ADD0         WZIN   185                                          CER055
     C           R2KEY     CHAINREODHSL0             99                                       CER055
     C           *IN99     IFEQ '0'                                                           CER055
     C                     Z-ADDRHODLN    WODLN                                               CER055
     C           WODLN     MULT 100       WODLN2                                            AR823701
     C           RHODLN    IFNE 0                                                             CER055
     C           BJRDNB    ANDLERHODED                                                        CER055
     C********** WHISB     SUB  WODLN     WACTDB                                     CER055 AR823701
     C           WHISB     SUB  WODLN2    WACTDB                                            AR823701
     C                     ELSE                                                               CER055
     C                     Z-ADDWHISB     WACTDB                                              CER055
     C                     ENDIF                                                              CER055
     C                     ENDIF                                                              CER055
      ** Get calculation basis                                                                CER055
     C********** ZICALC    IFEQ 7                                                    CER055 MD035448
     C********** ZICALC    OREQ 5                                                    CER055 MD035448
     C********** ZICALC    OREQ 3                                                    CER055 MD035448
     C********** ZICALC    OREQ 2                                                    CER055 MD035448
     C********** ZICALC    OREQ 0                                                    CER055 MD035448
      *                                                                                       CER055
     C********** ZICALC    IFEQ 0                                                    CER055 MD035448
     C           CER016    IFEQ 'Y'                                                         MD035448
     C           PINTN     ANDEQ'Y'                                                           CER055
      *                                                                                       CER055
     C                     Z-ADD1         C       20                                          CER055
      *                                                                                       CER055
     C           C         DOWLT12                                                            CER055
      ** Skip if BAL is -2                                                                    CER055
     C           CER055    IFEQ 'Y'                                                           CER055
     C           WC0102    ANDEQ'Y'                                                           CER055
     C           WDEBIT    ANDEQ'Y'                                                           CER055
     C           ZIB,Z     ANDEQ-2                                                            CER055
     C                     ELSE                                                             AR833959
     C                     Z-ADDZIA,C     WAMT                                                CER055
     C                     Z-ADDZIR,C     WRATE2                                              CER055
     C                     EXSR SRINT0                                                        CER055
     C                     Z-ADDZINTR     ZIN1,C                                              CER055
     C                     ENDIF                                                            AR833959
     C                     ADD  1         C                                                   CER055
     C**********           ENDIF                                                     CER055 AR833959
     C                     ENDDO                                                              CER055
      *                                                                                       CER055
     C                     XFOOTZIN1      ZINTR1    H                                         CER055
     C                     Z-ADDZINTR1    ZINTR     H                                         CER055
      *                                                                                       CER055
     C                     ELSE                                                               CER055
     C           ZICALC    IFEQ 7                                                           MD035448
     C           ZICALC    OREQ 5                                                           MD035448
     C           ZICALC    OREQ 3                                                           MD035448
     C           ZICALC    OREQ 2                                                           MD035448
     C           ZICALC    OREQ 0                                                           MD035448
      *                                                                                       CER055
     C           WACTDB    DIV  36000     WZIA      H                                         CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER055
     C**********           ENDIF                                                     CER055 MD035448
      *                                                                                       CER055
     C           ZICALC    IFEQ 4                                                             CER055
     C           ZICALC    OREQ 1                                                             CER055
     C           WACTDB    DIV  36500     WZIA      H                                         CER055
      *                                                                                       CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER055
     C           ZICALC    IFEQ 6                                                             CER055
     C           WACTDB    DIV  36600     WZIA      H                                         CER055
      *                                                                                       CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER055
     C           WZIA      MULT WOVRIN    WZIA                                                CER055
     C           WZIA      MULT ZDAYN2    WZIN                                                CER055
      *                                                                                       CER055
     C**********           ADD  WZIN      ZINTR                                      CER055 MD025491
     C                     Z-ADDWZIN      WRKINT 130H                                       MD025491
     C                     ADD  WRKINT    ZINTR                                             MD025491
     C                     ENDIF                                                              CER055
     C                     ENDIF                                                            MD035448
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CPD4                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **ZIC01 ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZIC02 subroutine to calculate interest (type=02)
     C**
     C**     Called by       PRCC34,PRCD34,ZICCR,ZICDR
     C**     Calls           ZICD
     C**
      *****************************************************************   CCB003
     C           ZIC02     BEGSR                           **ZIC02 BEGSR**
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CPD5                                           S01408
     C*                                                                   S01408
      *                                                                                       CER055
      ** Check if OVERDRAFT exist in ZIB array                                                CER055
      **  and save the original ZIB in WZIB array                                             CER055
      *                                                                                       CER055
     C                     Z-ADD0         WACTDB                                              CER055
     C           CER055    IFEQ 'Y'                                                           CER055
     C           WC0102    ANDEQ'Y'                                                           CER055
     C           WDEBIT    ANDEQ'Y'                                                           CER055
      *                                                                                       CER055
     C                     Z-ADD2         Z                                                   CER055
     C                     MOVE 'N'       WOVRDR                                              CER055
     C                     Z-ADD0         WOVRIN                                              CER055
     C           Z         DOWLE11                                                            CER055
     C           ZIB,Z     IFEQ -2                                                            CER055
     C                     MOVE 'Y'       WOVRDR                                              CER055
     C                     Z-ADDZIR,Z     WOVRIN                                              CER055
      ** Save original Balance array(ZIB)                                                     CER055
     C                     MOVE ZIB       WZIB                                                CER055
     C                     Z-ADD0         ZIB,Z                                               CER055
     C                     LEAVE                                                              CER055
     C                     ENDIF                                                              CER055
     C                     ADD  1         Z                                                   CER055
     C                     ENDDO                                                              CER055
     C                     ENDIF                                                              CER055
     C*
     C** FILL THE END OF THE TABLE WITH HIGHVAL
     C*
     C                     Z-ADD2         Z
     C           Z         DOWLE11
     C           ZIB,Z     IFEQ *ZEROS
     C                     Z-ADD*HIVAL    ZIB,Z
     C                     END
     C                     ADD  1         Z
     C                     END
     C*
     C***INTEREST*IS*ONLY*CALCULATED*ON*AN*AMOUNT*THAT*EXCEEDS*OR*IS*EQUAL103460
     C***TO*THE*INITIAL*THRESHOLD*BALACEE                                 103460
      *  INTEREST IS ONLY CALCULATED ON AN AMOUNT THAT EXCEEDS THE        103460
      *  INITIAL THRESHOLD BALANCE                                        103460
     C*
     C***********ZIAMT     IFGE ZITHR                      - B1           103460
     C           ZIAMT     IFGT ZITHR                      - B1           103460
     C*
     C** FIND NUMBER OF DAYS TO CALCULATE INTEREST ACCORDING TO CALC. BASIS
     C*
     C                     EXSR ZICD
      *                                                                                     MD055663
      ** Add 1 day on cutover month such that number of days for which interest             MD055663
      ** is accrued on this balance should be the full number of days that would            MD055663
      ** normally calculated for this month                                                 MD055663
      *                                                                                     MD055663
     C           NCAP34    IFEQ 'Y'                                                         MD055663
     C           WDICT     IFGT 2                                                           MD055663
     C           WDFDTM    ANDEQWFDCO                                                       MD055663
     C           WCICT     ORGT 2                                                           MD055663
     C           WCFDTM    ANDEQWFDCO                                                       MD055663
     C                     ADD  1         ZDAYN2                                            MD055663
     C                     ENDIF                                                            MD055663
     C                     ENDIF                                                            MD055663
     C*
     C                     Z-ADD1         Z
     C           ZIAMT     LOKUPZIB,Z                  40
      ** Move back Original Balance array(ZIB)                                                CER055
     C           WOVRDR    IFEQ 'Y'                                                           CER055
     C                     MOVE WZIB      ZIB                                                 CER055
     C                     ENDIF                                                              CER055
     C*
     C* IF THE SUB-TYPE IS FROM 50000 TO 99999, CALCULATE THE INTEREST
     C* ON THE AMOUNT EXCEEDING THE INITIAL THRESHOLD. OTHERWISE, THE
     C* INTEREST IS CALCULATED ON THE WHOLE BALANCE WHENEVER IT EXCEEDS
     C* THE INITIAL THRESHOLD.
     C*
     C           WWSTYP    IFGE 50000                      - B2
     C           ZIAMT     SUB  ZITHR     ZIAMT
     C                     END                             - E2
      *                                                                                       220323
      ** For calc basis 6, use the factored number of days                                    220323
      *                                                                                       220323
     C           ZIAMT     MULT ZIR,Z     ZIWRK1                                              220323
     C           ZICALC    IFEQ 6                                                             220323
     C           ZIWRK1    MULT INT6DY    ZIWRK2                                              220323
      *                                                                                       220323
     C                     ELSE                                                               220323
     C           ZIWRK1    MULT ZDAYN2    ZIWRK2                                              220323
     C                     ENDIF                                                              220323
     C*
     C********** ZICALC    IFEQ 7                          - B2                             MD035448
     C********** ZICALC    OREQ 5                                                           MD035448
     C********** ZICALC    OREQ 3                                                           MD035448
     C********** ZICALC    OREQ 2                                                           MD035448
     C********** ZICALC    OREQ 0                                                    CER016 MD035448
      *                                                                                       CER016
     C********** ZICALC    IFEQ 0                                                    CER016 MD035448
     C           CER016    IFEQ 'Y'                                                         MD035448
     C           PINTN     ANDEQ'Y'                                                           CER016
     C                     Z-ADDZIAMT     WAMT                                                CER016
     C                     Z-ADDZIR,Z     WRATE2                                              CER016
     C                     EXSR SRINT0                                                        CER016
     C                     ELSE                                                               CER016
     C           ZICALC    IFEQ 7                          - B2                             MD035448
     C           ZICALC    OREQ 5                                                           MD035448
     C           ZICALC    OREQ 3                                                           MD035448
     C           ZICALC    OREQ 2                                                           MD035448
     C           ZICALC    OREQ 0                                                           MD035448
      *                                                                                       CER016
     C********** ZIAMT     DIV  36000     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36000     ZINTR     H                                         220323
      *                                                                                       CER016
     C                     END                                                                CER016
     C*
     C**********           END                             - E2                             MD035448
     C*
     C           ZICALC    IFEQ 4                          - B2
     C           ZICALC    OREQ 1
     C********** ZIAMT     DIV  36500     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36500     ZINTR     H                                         220323
     C*
     C                     END                             - E2
     C*
     C           ZICALC    IFEQ 6                          - B2
     C********** ZIAMT     DIV  36600     ZIWRK1    H                                         220323
     C           ZIWRK2    DIV  36600     ZINTR     H                                         220323
     C*
     C                     END                             - E2
     C                     END                             - E2                             MD035448
     C*
     C/COPY WNCPYSRC,RE3662C072
     C********** ZICALC    IFNE 0                                                      CER016 220323
     C********** PINTN     ORNE 'Y'                                                    CER016 220323
     C********** ZIWRK1    MULT ZIR,Z     ZIWRK2    H                                         220323
     C********** ZIWRK2    MULT ZDAYN2    ZINTR     H                                         220323
     C**********           ENDIF                                                       CER016 220323
     C/COPY WNCPYSRC,RE3662C073
     C*
     C                     END                             - E1
      ** If OVERDRAFT exists                                                                  CER055
     C           WOVRDR    IFEQ 'Y'                                                           CER055
     C                     Z-ADDWHISB     WACTDB                                              CER055
      *                                                                                       CER055
     C********** ZICALC    IFEQ 7                                                    CER055 MD035448
     C********** ZICALC    OREQ 5                                                    CER055 MD035448
     C********** ZICALC    OREQ 3                                                    CER055 MD035448
     C********** ZICALC    OREQ 2                                                    CER055 MD035448
     C********** ZICALC    OREQ 0                                                    CER055 MD035448
      *                                                                                       CER055
     C********** ZICALC    IFEQ 0                                                    CER055 MD035448
     C           CER016    IFEQ 'Y'                                                         MD035448
     C           PINTN     ANDEQ'Y'                                                           CER055
      *                                                                                       CER055
     C                     Z-ADD1         C       20                                          CER055
      *                                                                                       CER055
     C           C         DOWLT12                                                            CER055
     C                     Z-ADDZIA,C     WAMT                                                CER055
     C                     Z-ADDZIR,C     WRATE2                                              CER055
     C                     EXSR SRINT0                                                        CER055
     C                     Z-ADDZINTR     ZIN1,C                                              CER055
     C                     ADD  1         C                                                   CER055
     C                     ENDDO                                                              CER055
      *                                                                                       CER055
     C                     XFOOTZIN1      ZINTR1    H                                         CER055
     C                     Z-ADDZINTR1    ZINTR     H                                         CER055
      *                                                                                       CER055
     C                     ELSE                                                               CER055
     C           ZICALC    IFEQ 7                                                           MD035448
     C           ZICALC    OREQ 5                                                           MD035448
     C           ZICALC    OREQ 3                                                           MD035448
     C           ZICALC    OREQ 2                                                           MD035448
     C           ZICALC    OREQ 0                                                           MD035448
      *                                                                                       CER055
     C           WACTDB    DIV  36000     WZIA      H                                         CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER055
     C**********           ENDIF                                                     CER055 MD035448
      *                                                                                       CER055
     C           ZICALC    IFEQ 4                                                             CER055
     C           ZICALC    OREQ 1                                                             CER055
     C           WACTDB    DIV  36500     WZIA      H                                         CER055
      *                                                                                       CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER055
     C           ZICALC    IFEQ 6                                                             CER055
     C           WACTDB    DIV  36600     WZIA      H                                         CER055
      *                                                                                       CER055
     C                     ENDIF                                                              CER055
      *                                                                                       CER055
     C           WZIA      MULT WOVRIN    WZIA                                                CER055
     C           WZIA      MULT ZDAYN2    WZIN                                                CER055
      *                                                                                       CER055
     C**********           ADD  WZIN      ZINTR                                      CER055 MD025491
     C                     Z-ADDWZIN      WRKINT    H                                       MD025491
     C                     ADD  WRKINT    ZINTR                                             MD025491
     C                     ENDIF                                                              CER055
     C                     ENDIF                                                            MD035448
      *                                                                                       CER055
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CPD6                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **ZIC02 ENDSR**
     C********************************************************************
     C/EJECT                                                              088932
     C******************************************************************  088932
     C*                                                                *  088932
     C*  BRTPRO SR. TO PERFORM EXTRA PROCESSING FOR BRT                *  088932
     C*                                                                *  088932
     C*  CHECKS BRT LIABLE INDICATOR                                   *  088932
     C*                                                                *  088932
     C*  CALLS : CALBRT                                                *  088932
     C*                                                                *  088932
     C******************************************************************  088932
     C*                                                                   088932
     C           BRTPRO    BEGSR                           ** BRTPRO SR **088932
     C*                                                                   088932
     C** Initialise output amount fields for BRT                          088932
     C*                                                                   088932
     C                     Z-ADD0         BRTAMT                          088932
     C**********           Z-ADD0         NETBRT                   088932 130468
     C*                                                                   088932
     C** Access BRT category & new account signal from ACCNT              088932
     C*                                                                   088932
     C           ACKEY1    CHAINACCNT                99                   088932
     C*                                                                   088932
     C           *IN99     IFEQ '1'                                       088932
     C           *LOCK     IN   LDA                                       088932
     C                     MOVEL'ACCNT'   DBFILE           ***************088932
     C                     MOVELAKEY      DBKEY            * DB ERROR 34 *088932
     C                     Z-ADD34        DBASE            ***************088932
     C                     OUT  LDA                                       088932
     C                     EXSR DBSR                                      088932
     C                     END                                            088932
     C*                                                                   088932
     C** Check if BRT liable or part liable                               088932
     C*                                                                   088932
     C                     SETOF                     26                   092245
     C           BRTCA     IFEQ 'L'                                       088932
     C           BRTCA     OREQ 'P'                                       088932
     C                     SETON                     26                   088932
     C                     END                                            088932
     C*                                                                   088932
     C           *IN26     IFEQ '1'                                       088932
     C*                                                                   088932
     C** If so, calculate BRT amount                                      088932
     C*                                                                   088932
     C                     EXSR CALBRT                                    088932
     C*                                                                   088932
     C***else*interest*net of BRT is the amount                    088932 130468
     C*                                                                   088932
     C**********           ELSE                                    088932 130468
     C**********           Z-ADDWINTC     NETBRT                   088932 130468
     C*                                                                   088932
     C                     END                                            088932
     C*                                                                   088932
     C           ENDBRT    ENDSR                                          088932
     C**                                                                  088932
     C*****************************************************************   088932
     C/EJECT                                                              088932
     C*****************************************************************   088932
     C*                                                               *   088932
     C*    CALBRT SR. TO CALCULATE BRT CURRENCY AMOUNT                *   088932
     C*                                                               *   088932
     C*    IF BRT CATEGORY = 'L'                                      *   088932
     C*                                                               *   088932
     C*           BRT =  GROSS X BRT RATE                             *   088932
     C*                  ----------------                             *   088932
     C*                       100                                     *   088932
     C*                                                               *   088932
     C*    IF BRT CATEGORY = 'P'                                      *   088932
     C*                                                               *   088932
     C*           BRT =  GROSS X (BRT RATE X 0.5)                     *   088932
     C*                  ------------------------                     *   088932
     C*                       100                                     *   088932
     C*                                                               *   088932
     C*****************************************************************   088932
     C*                                                                   088932
     C           CALBRT    BEGSR                           ** CALBRT SR **088932
     C*                                                                   088932
     C** If date is before 'DEFF' on SDBRTDPD - use prev BRT rate         088932
     C** otherwise - use current BRT rate.                                088932
     C*                                                                   088932
     C           BCICI     IFEQ 'D'                                       088932
     C           BCICI     OREQ 'M'                                       088932
     C                     MOVE '1'       *IN70                           088932
     C                     ELSE                                           088932
     C                     MOVE '0'       *IN70                           088932
     C                     END                                            088932
     C*                                                                   088932
     C           LDAC      IFEQ 'Y'                                       088932
     C*                                                                   088932
     C           *IN70     IFEQ '1'                                       088932
     C           RUND      IFLE DEFF                                      088932
     C                     Z-ADDPBRTR     WRKRAT 135                      088932
     C                     ELSE                                           088932
     C                     Z-ADDBRTR      WRKRAT                          088932
     C                     END                                            088932
     C                     END                                            088932
     C*                                                                   088932
     C           BCICI     IFEQ 'C'                                       088932
     C           RUND      IFLT DEFF                                      088932
     C                     Z-ADDPBRTR     WRKRAT                          088932
     C                     ELSE                                           088932
     C                     Z-ADDBRTR      WRKRAT                          088932
     C                     END                                            088932
     C                     END                                            088932
     C*                                                                   088932
     C           *IN70     IFEQ '0'                                       088932
     C           BCICI     ANDNE'C'                                       088932
     C           NCID      IFLE DEFF                                      088932
     C                     Z-ADDPBRTR     WRKRAT                          088932
     C                     ELSE                                           088932
     C                     Z-ADDBRTR      WRKRAT                          088932
     C                     END                                            088932
     C                     END                                            088932
     C*                                                                   088932
     C                     ELSE                                           088932
     C*                                                                   088932
     C           *IN70     IFEQ '1'                                       088932
     C           BCICI     OREQ 'C'                                       088932
     C           RUND      IFLT DEFF                                      088932
     C                     Z-ADDPBRTR     WRKRAT                          088932
     C                     ELSE                                           088932
     C                     Z-ADDBRTR      WRKRAT                          088932
     C                     END                                            088932
     C                     END                                            088932
     C*                                                                   088932
     C           *IN70     IFEQ '0'                                       088932
     C           BCICI     ANDNE'C'                                       088932
     C           NCID      IFLT DEFF                                      088932
     C                     Z-ADDPBRTR     WRKRAT                          088932
     C                     ELSE                                           088932
     C                     Z-ADDBRTR      WRKRAT                          088932
     C                     END                                            088932
     C                     END                                            088932
     C*                                                                   088932
     C                     END                                            088932
     C*                                                                   088932
     C           BRTCA     IFEQ 'P'                                       088932
     C           WRKRAT    MULT 0.5       WRKRAT                          088932
     C                     END                                            088932
     C*                                                                   088932
     C           WINTC     DIV  100       WPACR1 112H                     088932
     C*                                                                   088932
     C           WPACR1    MULT WRKRAT    WRKBRT 156H                     088932
     C*                                                                   088932
     C*  ('BRTAMT' is the BRT currency amount)                            088932
     C*                                                                   088932
     C                     Z-ADDWRKBRT    BRTAMT 130H                     088932
     C*                                                                   088932
     C***('NETBRT'*is*the net amount to be credited)               088932 130468
     C*                                                                   088932
     C********** WINTC     SUB  BRTAMT    NETBRT 130               088932 130468
     C*                                                                   088932
     C                     ENDSR                           **CALBRT ENDSR*088932
     C*****************************************************************   088932
     C*****************************************************************                       CDL013
      *                                                                                       CDL013
     C           #ECALC    BEGSR                                                              CDL013
      *                                                                                       CDL013
      ** Access account details extension file                                                CDL013
     C           REKEY     CHAINACCNTBY0             74                                       CDL013
      *                                                                                       CDL013
      ** If CHAIN failed, terminate the program                                               CDL013
     C           *IN74     IFEQ '1'                                                           CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C**********           MOVE PKEY      ACKEY3                                    CDL013 AR1046263
     C                     MOVE CKEY      ACKEY3                                           AR1046263
     C                     MOVE BBRCA     ACKEY2                                              CDL013
     C                     Z-ADD35        DBASE            ************                       CDL013
     C                     MOVEL'ACCNTBY0'DBFILE           * DBERR 35 *                       CDL013
     C                     MOVELACKEY     DBKEY            ************                       CDL013
     C                     OUT  LDA                                                           CDL013
     C                     MOVE *OFF      *IN89                                               CDL013
     C                     EXSR DBSR                                                          CDL013
     C                     ENDIF                                                              CDL013
     C/COPY WNCPYSRC,REH00008
      *                                                                                       CDL013
      ** Set WHT rate                                                                         CDL013
     C                     SELEC                                                              CDL013
     C           ATITAX    WHEQ '0'                                                           CDL013
     C                     Z-ADD0         WRATE   52                                          CDL013
     C           ATITAX    WHEQ '1'                                                           CDL013
     C                     Z-ADDETXR1     WRATE                                               CDL013
     C           ATITAX    WHEQ '2'                                                           CDL013
     C                     Z-ADDETXR2     WRATE                                               CDL013
     C           ATITAX    WHEQ '3'                                                           CDL013
     C                     Z-ADDETXR3     WRATE                                               CDL013
     C           ATITAX    WHEQ '4'                                                           CDL013
     C                     Z-ADDETXR4     WRATE                                               CDL013
     C           ATITAX    WHEQ '5'                                                           CDL013
     C                     Z-ADDETXR5     WRATE                                               CDL013
     C           ATITAX    WHEQ '6'                                                           CDL013
     C                     Z-ADDETXR6     WRATE                                               CDL013
     C           ATITAX    WHEQ '7'                                                           CDL013
     C                     Z-ADDETXR7     WRATE                                               CDL013
     C           ATITAX    WHEQ '8'                                                           CDL013
     C                     Z-ADDETXR8     WRATE                                               CDL013
     C           ATITAX    WHEQ '9'                                                           CDL013
     C                     Z-ADDETXR9     WRATE                                               CDL013
     C                     ENDSL                                                              CDL013
     C/COPY WNCPYSRC,REH00009
      *                                                                                       CDL013
      ** If WHT rate is 0, set tax amount to 0                                                CDL013
     C           WRATE     IFEQ 0                                                             CDL013
     C                     Z-ADD0         WWHT   150                                          CDL013
     C                     Z-ADD0         WTXAMT                                              CDL013
      *                                                                                       CDL013
      ** Otherwise, calculate WHT amount                                                      CDL013
     C                     ELSE                                                               CDL013
      *                                                                                     AR666241
     C                     ADD  CSGACI    WINTC                                             AR666241
     C                     ADD  CSGADI    WINTD                                             AR666241
      *                                                                                       CDL013
      ** If Retail Netting of Debit Interest is 'Y',                                          CDL013
      ** Taxable amount = Credit Acrrued Int - Debit Acrrued Int                              CDL013
     C           TXWNDI    IFEQ 'Y'                                                           CDL013
     C           NDID      ANDEQNCID                                                          CDL013
     C           WINTC     SUB  WINTD     WTXAMT 150                                          CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ** If Retail Netting of Debit Interest is 'N',                                          CDL013
      ** Taxable amount is Credit Acrrued Int. only                                           CDL013
     C           TXWNDI    IFEQ 'N'                                                           CDL013
     C           NDID      ORNE NCID                                                          CDL013
     C                     Z-ADDWINTC     WTXAMT                                              CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ** If Taxable amount is equal 0, set tax amount to 0                                    CDL013
     C           WTXAMT    IFEQ 0                                                             CDL013
     C                     Z-ADD0         WWHT                                                CDL013
      *                                                                                       CDL013
      ** Otherwise, for Taxable amount GT 0                                                   CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      ** If Acc Ccy is equal to Base Ccy, calculate WHT                                       CDL013
      ** and CDL081 is off                                                                    CDL081
      *                                                                                       CDL081
     C           ATCCY     IFEQ BJCYCD                                                        CDL013
     C           CDL081    ANDEQ'N'                                                           CDL081
      *                                                                                       CDL013
      ** Set work adjustment field according to decimal places.                               CDL013
     C                     SELEC                                                              CDL013
     C           CDP       WHEQ 0                                                             CDL013
     C                     Z-ADD1         WADJ    40                                          CDL013
     C           CDP       WHEQ 1                                                             CDL013
     C                     Z-ADD10        WADJ                                                CDL013
     C           CDP       WHEQ 2                                                             CDL013
     C                     Z-ADD100       WADJ                                                CDL013
     C           CDP       WHEQ 3                                                             CDL013
     C                     Z-ADD1000      WADJ                                                CDL013
     C                     ENDSL                                                              CDL013
     C/COPY WNCPYSRC,REH00010
      *                                                                                       CDL013
      ** Round down Interest Amount.                                                          CDL013
     C                     DIV  WADJ      WTXAMT                                              CDL013
     C                     MULT WADJ      WTXAMT                                              CDL013
     C/COPY WNCPYSRC,REH00011
      *                                                                                       CDL013
      ** Calculate Withholding Tax                                                            CDL013
     C           WTXAMT    MULT WRATE     WWHT                                                CDL013
     C                     DIV  100       WWHT                                                CDL013
     C/COPY WNCPYSRC,REH00012
      *                                                                                       CDL013
      ** Round down Withholding Tax                                                           CDL013
     C                     DIV  WADJ      WWHT                                                CDL013
     C                     MULT WADJ      WWHT                                                CDL013
     C/COPY WNCPYSRC,REH00013
      *                                                                                       CDL013
      ** If Acc Ccy is NOT equal to Base Ccy                                                  CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      ** Calculate Tax Amount without rounding down                                           CDL013
     C           WTXAMT    MULT WRATE     WWHT                                                CDL013
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           ATCCY     IFEQ BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           ATCCY     ORNE BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#NBRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       WWHT                                                CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       WWHT      H                                         CDL013
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C/COPY WNCPYSRC,REH00014
      *                                                                                       CDL013
      ** If Account Ccy = Base Ccy, store the Taxable Amount                                  CDL013
     C           ATCCY     IFEQ BJCYCD                                                        CDL013
     C                     Z-ADDWTXAMT    WTXBAS 150                                          CDL013
      *                                                                                       CDL013
      ** Otherwise, convert Taxable Amount to Base Ccy equivalent                             CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C                     Z-ADDWTXAMT    ZAMTCI                                              CDL013
     C                     MOVE ATCCY     ZCCYI                                               CDL013
     C                     Z-ADDWNBDP     ZCDPI                                               CDL013
     C                     MOVE BJCYCD    ZCCYO                                               CDL013
     C                     Z-ADDCDP       ZCDPO                                               CDL013
     C                     Z-ADDA6SPRT    ZEXCH                                               CDL013
     C/COPY WNCPYSRC,REH00152
     C                     MOVE A6MDIN    ZMD                                                 CDL013
      *                                                                                       CDL013
     C                     EXSR ZCONV                                                         CDL013
      *                                                                                       CDL013
     C                     Z-ADDZAMTCO    WTXBAS                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ** Retrieve Minimum Interest Subject to Tax for this account                            CDL013
     C                     MOVE ATACOD    WACOD  10                                           CDL013
     C                     EXSR SRCHKA                                                      CRE083AY
      *                                                                                     CRE083AY
     C           ##AFIC    IFEQ 'Y'                                                         CRE083AY
     C                     EXSR SRSETA                                                      CRE083AY
     C                     ELSE                                                             CRE083AY
     C                     CALL 'AOACODR0'                                                    CDL013
     C                     PARM '*MSG   ' @RTCD                                               CDL013
     C                     PARM '*KEY   ' @OPTN                                               CDL013
     C                     PARM WACOD     @ACCD  10                                           CDL013
     C           SDACOD    PARM SDACOD    DSFDY                                               CDL013
      *                                                                                       CDL013
      ** If error occured, terminate the program                                              CDL013
     C           @RTCD     IFNE *BLANKS                                                       CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     Z-ADD36        DBASE            ************                       CDL013
     C                     MOVEL'SDACODPD'DBFILE           * DBERR 36 *                       CDL013
     C                     MOVELATACOD    DBKEY            ************                       CDL013
     C                     OUT  LDA                                                           CDL013
     C                     EXSR DBSR                                                          CDL013
     C                     ELSE                                                             CRE083AY
     C                     EXSR SRADDA                                                      CRE083AY
     C                     ENDIF                                                              CDL013
     C                     ENDIF                                                            CRE083AY
      *                                                                                       CDL013
      ** If Base Ccy equivalent LT Minimum Interest Subject to Tax,                           CDL013
      ** set all tax fields to 0                                                              CDL013
     C           WTXBAS    IFLT A5MISU                                                        CDL013
     C                     Z-ADD0         WTXBAS                                              CDL013
     C                     Z-ADD0         WTXAMT                                              CDL013
     C                     Z-ADD0         WWHT                                                CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                     AR666241
     C                     SUB  CSGACI    WINTC                                             AR666241
     C                     SUB  CSGADI    WINTD                                             AR666241
      *                                                                                       CDL013
      ** Update history balance                                                               CDL013
     C                     SUB  WINTC     WHISB                                               CDL013
     C                     ADD  WWHT      WHISB                                               CDL013
      *                                                                                       CDL013
     C                     ENDSR                                                              CDL013
      *                                                                                       CDL013
      ** ZCONV subroutine to convert an amount from one Ccy to another                        CDL013
     C*****************************************************************                       CDL013
     C/COPY ZSRSRC,ZCONVZ1                                                                    CDL013
     C*****************************************************************                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3662CP11                                           S01408
     C*                                                                   S01408
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SREUTX - Calculates European Withholding Tax.                *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SREUTX    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZEROS    WSTXA  150                                          CER048
     C                     Z-ADD*ZERO     WEUWT  150                                          CGL031
     C                     Z-ADD*ZERO     WTTXA  150                                          CER054
     C                     MOVE 'N'       WTCPI   1                                           CGL031
     C                     MOVE 'N'       WTCJA   1                                           CGL031
      *                                                                                     BUG26537
     C           CER048    IFEQ 'Y'                                                         BUG26537
     C           CER054    OREQ 'Y'                                                         BUG26537
      *                                                                                     BUG25233
      ** Country of Tax                                                                     BUG25233
      *                                                                                     BUG25233
     C                     MOVE DVCNCD    WCNCD   2                                         BUG25233
     C                     MOVE BBCOLC    WCOLC   2                                         BUG25233
      *                                                                                     BUG25233
     C                     CALL 'AOCTTXR0'                                                  BUG25233
     C                     PARM *BLANKS   PRTCD                                             BUG25233
     C                     PARM '*KEY   ' POPTN                                             BUG25233
     C                     PARM           WCNCD                                             BUG25233
     C                     PARM           WCOLC                                             BUG25233
     C           SDCTTX    PARM SDCTTX    DSFDY                                             BUG25233
      *                                                                                     BUG25233
     C           PRTCD     IFEQ '*NRF   '                                                   BUG25233
     C                     MOVE *BLANKS   WCOLC                                             BUG25233
     C                     CALL 'AOCTTXR0'                                                  BUG25233
     C                     PARM *BLANKS   PRTCD                                             BUG25233
     C                     PARM '*KEY   ' POPTN                                             BUG25233
     C                     PARM           WCNCD                                             BUG25233
     C                     PARM           WCOLC                                             BUG25233
     C           SDCTTX    PARM SDCTTX    DSFDY                                             BUG25233
      *                                                                                     BUG25233
      ** Database Error                                                                     BUG25233
      *                                                                                     BUG25233
     C           PRTCD     IFNE *BLANKS                                                     BUG25233
     C                     MOVELWCNCD     DBKEY                                             BUG25233
     C                     MOVELWCOLC     DBKEY                                             BUG25233
     C                     MOVEL'SDCTTXPD'DBFILE                                            BUG25233
     C                     Z-ADD108       DBASE                                             BUG25233
     C                     EXSR DBSR                                                        BUG25233
     C                     ENDIF                                                            BUG25233
     C                     ENDIF                                                            BUG25233
      *                                                                                     BUG25233
      ** Set Flag EU, Local or German                                                       BUG25233
      *                                                                                     BUG25233
     C           BBCOLC    IFNE EWCTRT                                                      BUG25233
     C                     MOVE 'E'       WELGTX  1                                         BUG25233
     C                     ELSE                                                             BUG25233
      *                                                                                     BUG25233
     C           CER048    IFEQ 'Y'                                                         BUG25233
     C           BBCOLC    IFEQ EWCTRT                                                      BUG25233
     C           EWTHMD    ANDEQ'Y'                                                         BUG25233
     C                     MOVE 'G'       WELGTX                                            BUG25233
     C                     ELSE                                                             BUG25233
     C                     MOVE 'L'       WELGTX                                            BUG25233
     C                     ENDIF                                                            BUG25233
      *                                                                                     BUG25233
     C                     ELSE                                                             BUG25233
      *                                                                                     BUG25233
     C                     MOVE 'G'       WELGTX                                            BUG25233
     C                     ENDIF                                                            BUG25233
      *                                                                                     BUG25233
     C                     ENDIF                                                            BUG25233
     C                     ENDIF                                                            BUG26537
      *                                                                                       CGL031
      ** Calculate tax for private individuals.                                               CGL031
      *                                                                                       CGL031
     C                     EXSR SRTCPI                                                        CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
     C           PZRTCD    WHEQ 'ERROR  '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVELPZFILE    DBFILE                                              CGL031
     C                     MOVELPZKEY     DBKEY                                               CGL031
     C                     Z-ADD102       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR DBSR                                                          CGL031
      *                                                                                       CGL031
     C           PZRTCD    WHNE 'JOINT'                                                       CGL031
     C           PTOTO     IFNE *ZERO                                                         CGL031
     C           CER048    OREQ 'Y'                                                         BUG24051
     C           PSTAT     IFEQ 'TAXAB'                                                       CGL031
     C           PSTAT     OREQ 'DISCL'                                                       CGL031
     C           PSTAT     OREQ 'SELF '                                                       CGL031
     C                     MOVE 'Y'       WTCPI                                               CGL031
     C                     Z-ADDPTAXA     WEUWT                                               CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C           WELGTX    ANDNE'E'                                                         BUG25233
     C                     Z-ADDPSTXA     WSTXA                                               CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C           WELGTX    ANDNE'E'                                                         BUG25233
     C                     Z-ADDPTTXA     WTTXA                                               CER054
     C                     ENDIF                                                              CER054
     C                     EXSR SRCSIN                                                        CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Handle joint accounts.                                                               CGL031
      *                                                                                       CGL031
     C           PZRTCD    WHEQ 'JOINT  '                                                     CGL031
     C                     MOVE 'N'       WTCPI                                               CGL031
     C                     EXSR SRJACC                                                        CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRJACC - Handles joint accounts for EU Withholding Tax       *                       CGL031
      *           accounting.                                         *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRJACC    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     WJAWT  150                                          CGL031
      *                                                                                       CER048
     C                     Z-ADD*ZEROS    WJSTA  150                                          CER048
     C                     Z-ADD*ZERO     WJTTA  150                                          CER054
      *                                                                                       CER048
     C                     MOVE BCNUM     KJANO   6                                           CGL031
      *                                                                                       CGL031
      ** Do tax calculations for customer numbers on a joint account.                         CGL031
      *                                                                                       CGL031
     C           KJANO     SETLLSDJACCLB                                                      CGL031
     C           KJANO     READESDJACCLB                 20                                   CGL031
      *                                                                                       CGL031
     C********** *IN20     DOWEQ*OFF                                                 CGL031 BUG25942
     C           *IN20     DOUEQ*ON                                                         BUG25942
      *                                                                                     BUG25942
     C           *IN20     IFEQ *ON                                                         BUG25942
     C                     MOVELKJANO     JCCUST                                            BUG25942
     C                     MOVE *BLANKS   JCNAHO                                            BUG25942
     C                     MOVE *BLANKS   JCINVP                                            BUG25942
     C                     MOVEL'1/1'     JCINVP                                            BUG25942
     C                     ENDIF                                                            BUG25942
      *                                                                                       CGL031
      ** Calculate tax for joint accounts.                                                    CGL031
      *                                                                                       CGL031
     C                     EXSR SRTCJA                                                        CGL031
      *                                                                                       CGL031
     C           PZRTCD    IFEQ 'ERROR  '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVELPZFILE    DBFILE                                              CGL031
     C                     MOVELPZKEY     DBKEY                                               CGL031
     C                     Z-ADD105       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR DBSR                                                          CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PTOTO     IFNE *ZERO                                                         CGL031
     C           CER048    OREQ 'Y'                                                         BUG24051
     C           PSTAT     IFEQ 'TAXAB'                                                       CGL031
     C           PSTAT     OREQ 'DISCL'                                                       CGL031
     C           PSTAT     OREQ 'SELF '                                                       CGL031
     C                     MOVE 'Y'       WTCJA                                               CGL031
     C                     ADD  PTAXA     WJAWT                                               CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C           WELGTX    ANDNE'E'                                                         BUG25233
     C                     ADD  PSTXA     WJSTA                                               CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C           WELGTX    ANDNE'E'                                                         BUG25233
     C                     ADD  PTTXA     WJTTA                                               CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER048
     C                     EXSR SRCSIN                                                        CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PZRTCD    IFEQ 'NOTAX'                                                       CGL031
     C           PZRTCD    OREQ 'TAXAB'                                                       CGL031
     C           KJANO     READESDJACCLB                 20                                   CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PZRTCD    IFEQ 'LAST   '                                                     CGL031
     C                     MOVE *ON       *IN20                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ADD  WJAWT     WEUWT                                               CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     ADD  WJSTA     WSTXA                                               CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     ADD  WJTTA     WTTXA                                               CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRTCPI - Performs tax calculation for private individuals    *                       CGL031
      *           via ZATXCLPI.                                       *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRTCPI    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise relevant variables.                                                       CGL031
      *                                                                                       CGL031
     C**********           Z-ADDCLCID     PSTRD                                        CGL031 235875
     C**********           Z-ADDCNCID     PENDD                                        CGL031 235875
     C**********           Z-ADDWINTC     PTOTI                                        CGL031 235875
     C                     Z-ADD*ZERO     PTAXR                                               CGL031
     C                     MOVE BCNUM     PCUST                                               CGL031
      *                                                                                       CGL031
      ** Calculate tax.                                                                       CGL031
      *                                                                                       CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C           KEY01     CHAINACCNTBY0             78                                       CER048
      *                                                                                       CER048
     C           *IN78     IFEQ *OFF                                                          CER048
      *                                                                                       CER048
     C                     MOVE ATITAX    WTITAX  1                                           CER048
      *                                                                                       CER048
     C                     ELSE                                                               CER048
     C                     MOVE *BLANKS   WTITAX                                              CER048
     C                     ENDIF                                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     CALL 'ZATXCLPI'                                                    CGL031
     C                     PARM 'G'       PMODI   1                                           CGL031
     C**********           PARM PKEY      PTRRF  18                                    CGL031 CGL035
     C                     PARM PKEY      PTRRF  24                                           CGL035
     C                     PARM BBRCA     PBRCA   3                                           CGL031
     C                     PARM           PCUST   6                                           CGL031
     C                     PARM           PSTRD   50                                          CGL031
     C                     PARM           PENDD   50                                          CGL031
     C                     PARM           PTOTI  150                                          CGL031
     C                     PARM           PTAXR   64                                          CGL031
     C                     PARM BCCY      POCCY   3                                           CGL031
     C                     PARM WTITAX    PINTH   1                                           CER048
     C                     PARM *ZERO     PIAED  150                                          CGL031
     C                     PARM *ZERO     PTAXA  150                                          CGL031
     C                     PARM *ZERO     PTOTO  150                                          CGL031
     C                     PARM *BLANKS   PTXCY   3                                           CGL031
     C                     PARM *BLANKS   PCTAX   2                                           CGL031
     C                     PARM *BLANKS   PTXBS   2                                           CGL031
     C**********           PARM *ZERO     PWTAC   40                                   CGL031 CGL035
     C                     PARM *ZERO     PWTAC  100                                          CGL035
     C                     PARM *BLANKS   PCOLC   2                                           CGL031
     C                     PARM *BLANKS   PSTAT   5                                           CGL031
     C                     PARM *BLANK    PTRTE   1                                           CGL031
     C                     PARM *ZERO     PTXR1   64                                          CGL031
     C**********           PARM           PSTXB   20                                 CER048 BUG22911
     C**********           PARM           PSTAC  100                                 CER048 BUG22911
     C**********           PARM           PSTTR   64                                 CER048 BUG22911
     C**********           PARM           PSTTP   1                                  CER048 BUG22911
     C**********           PARM           PSTXA  150                                 CER048 BUG22911
     C                     PARM *BLANKS   PZKEY  10                                           CGL031
     C                     PARM *BLANKS   PZFILE 10                                           CGL031
     C                     PARM *BLANKS   PZRTCD  7                                           CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRTCJA - Performs tax calculation for joint accounts via     *                       CGL031
      *           ZATXCLJA.                                           *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRTCJA    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise relevant variables.                                                       CGL031
      *                                                                                       CGL031
     C**********           Z-ADDCLCID     PSTRD                                        CGL031 235875
     C**********           Z-ADDCNCID     PENDD                                        CGL031 235875
     C**********           Z-ADDWINTC     PTOTI                                        CGL031 235875
     C                     Z-ADD*ZERO     PTAXR                                               CGL031
     C                     MOVE BCNUM     PJANO                                               CGL031
      *                                                                                       CGL031
      ** Calculate tax.                                                                       CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLJA'                                                    CGL031
     C                     PARM 'G'       PMODI                                               CGL031
     C                     PARM PKEY      PTRRF                                               CGL031
     C                     PARM BBRCA     PBRCA                                               CGL031
     C                     PARM           PJANO   6                                           CGL031
     C                     PARM JCCUST    PCUST                                               CGL031
     C                     PARM JCNAHO    PNARF  10                                           CGL031
     C                     PARM JCINVP    PINVP  10                                           CGL031
     C                     PARM JCPAHT    PPAHT   1                                         BUG26839
     C                     PARM           PSTRD                                               CGL031
     C                     PARM           PENDD                                               CGL031
     C                     PARM           PTOTI                                               CGL031
     C                     PARM           PTAXR                                               CGL031
     C                     PARM BCCY      POCCY                                               CGL031
     C                     PARM WTITAX    PINTH                                               CER048
     C                     PARM *ZERO     PIAED                                               CGL031
     C                     PARM *ZERO     PTAXA                                               CGL031
     C                     PARM *ZERO     PTOTO                                               CGL031
     C                     PARM *BLANKS   PTXCY                                               CGL031
     C                     PARM *BLANKS   PCTAX                                               CGL031
     C                     PARM *BLANKS   PTXBS                                               CGL031
     C                     PARM *ZERO     PWTAC                                               CGL031
     C                     PARM *BLANKS   PCOLC                                               CGL031
     C                     PARM *BLANKS   PSTAT                                               CGL031
     C                     PARM *BLANK    PTRTE                                               CGL031
     C                     PARM *ZERO     PTXR1                                               CGL031
     C                     PARM           PJAMG   1                                           CGL031
     C**********           PARM           PSTXB                                      CER048 BUG22911
     C**********           PARM           PSTAC                                      CER048 BUG22911
     C**********           PARM           PSTTR                                      CER048 BUG22911
     C**********           PARM           PSTTP                                      CER048 BUG22911
     C**********           PARM           PSTXA                                      CER048 BUG22911
     C                     PARM *BLANKS   PZKEY                                               CGL031
     C                     PARM *BLANKS   PZFILE                                              CGL031
     C                     PARM *BLANKS   PZRTCD                                              CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRCSIN - Writes new customer income records.                 *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRCSIN    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Clear output fields.                                                                 CGL031
      *                                                                                       CGL031
      ** Set output values.                                                                   CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     TSTXSB                                            BUG24051
     C                     Z-ADD*ZERO     TSSTDB                                            BUG24051
     C                     Z-ADD*ZERO     TSGINB                                            BUG24051
     C                     Z-ADD*ZERO     TSNINB                                            BUG24051
     C           PTOTO     IFNE *ZERO                                                       BUG24051
      *                                                                                     BUG24051
     C                     Z-ADDBJRDNB    TSRDNB                                              CGL031
     C                     Z-ADDPENDD     TSEDAT                                              CGL031
      *                                                                                       CGL031
      ** Convert Tax Calculation Date to friendly date.                                       CGL031
      *                                                                                       CGL031
     C                     CALL 'ZDATE2'                                                      CGL031
     C                     PARM TSEDAT    PZDAYN  50                                          CGL031
     C                     PARM BJDFIN    PZDATF  1                                           CGL031
     C                     PARM *ZERO     PZDATE  60                                          CGL031
     C                     PARM *BLANKS   PZADAT  7                                           CGL031
      *                                                                                       CGL031
      ** Get year and month.                                                                  CGL031
      *                                                                                       CGL031
     C                     MOVE PZDATE    WYEAR   2                                           CGL031
     C                     MOVELPZDATE    WTEMP   4                                           CGL031
      *                                                                                       CGL031
     C           BJDFIN    IFEQ 'D'                                                           CGL031
     C                     MOVE WTEMP     WMONTH  2                                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVELWTEMP     WMONTH                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Derive the Tax Year.                                                                 CGL031
      *                                                                                       CGL031
     C                     MOVEL'20'      WTAXY   4                                           CGL031
     C                     MOVE WYEAR     WTAXY                                               CGL031
     C                     MOVE WTAXY     TSTAXY                                              CGL031
      *                                                                                       CGL031
     C                     MOVE WMONTH    TSTAXM                                              CGL031
      *                                                                                       CGL031
     C                     MOVE PCTAX     TSCTRT                                              CGL031
     C                     MOVE PBRCA     TSBRCA                                              CGL031
      *                                                                                       CGL031
     C           WTCJA     IFEQ 'Y'                                                           CGL031
     C                     MOVE PJANO     TSJOIN                                              CGL031
     C                     MOVE PNARF     TSNAHO                                              CGL031
     C                     MOVE PINVP     TSINVP                                              CGL031
     C                     ELSE                                                               CGL031
     C**********           Z-ADD*ZERO     TSJOIN                                      CGL031 CSD027A
     C                     MOVE *BLANKS   TSJOIN                                             CSD027A
     C                     MOVE *BLANKS   TSNAHO                                              CGL031
     C                     MOVE *BLANKS   TSINVP                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE PCUST     TSCUST                                              CGL031
     C                     MOVELPSTAT     TSSTAT                                              CGL031
      *                                                                                       CGL031
      ** Get additional customer details if a customer is available.                          CGL031
      ** Otherwise, check the non-a/c holder reference.                                       CGL031
      *                                                                                       CGL031
     C           PCUST     IFNE *BLANKS                                                       CGL031
     C                     MOVE PCUST     KCUST   6                                           CGL031
     C           KCUST     CHAINSDACUSL1             21                                       CGL031
      *                                                                                       CGL031
     C           *IN21     IFEQ *OFF                                                          CGL031
     C                     MOVE E5CNA1    TSFAMN                                              CGL031
     C                     MOVE E5CNA2    TSFIRN                                              CGL031
     C                     MOVELE5CNA3    TSSTRT                                              CGL031
     C                     MOVE E5CNA4    TSSTRT                                              CGL031
     C                     MOVE E5ZIPC    TSZIPC                                              CGL031
     C                     MOVE E5CITY    TSCITY                                              CGL031
     C                     MOVE E5TINO    TSRTIN                                              CGL031
     C                     MOVE E5DBTH    TSDBTH                                              CGL031
     C                     MOVE E5BTHT    TSTBTH                                              CGL031
     C                     MOVE E5BTHC    TSCBTH                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           PNARF     IFNE *BLANKS                                                       CGL031
     C                     MOVE PNARF     KNARF  10                                           CGL031
     C           KNARF     CHAINSDNAHOL1             21                                       CGL031
      *                                                                                       CGL031
     C           *IN21     IFEQ *OFF                                                          CGL031
     C                     MOVE NHIDE1    TSFAMN                                              CGL031
     C                     MOVE NHIDE2    TSFIRN                                              CGL031
     C                     MOVELNHIDE3    TSSTRT                                              CGL031
     C                     MOVE NHIDE4    TSSTRT                                              CGL031
     C                     MOVE NHZIPC    TSZIPC                                              CGL031
     C                     MOVE NHCITY    TSCITY                                              CGL031
     C                     MOVE NHTINO    TSRTIN                                              CGL031
     C                     MOVE NHDBTH    TSDBTH                                              CGL031
     C                     MOVE NHBTHT    TSTBTH                                              CGL031
     C                     MOVE NHBTHC    TSCBTH                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE PCOLC     TSRCTR                                              CGL031
      *                                                                                       CGL031
      ** Convert the Interest Calculation End Date to YYYYMMDD format.                        CGL031
      *                                                                                       CGL031
     C                     Z-ADDPENDD     @@DAYN  50                                          CGL031
     C                     EXSR ZDATE9                                                        CGL031
     C                     MOVE @@VDT     TSIPDT                                              CGL031
      *                                                                                       CGL031
     C                     MOVE PTXBS     TSTXBS                                              CGL031
     C                     Z-ADDPWTAC     TSWTAC                                              CGL031
      *                                                                                       CGL031
      ** Convert the Start Date or Last Interest Date to YYYYMMDD format.                   BUG23123
     C**********           Z-ADDPSTRD     @@STRD  50                              BUG23123 BUG23123B
     C**********           EXSR ZDATE9                                            BUG23123 BUG23123B
     C**********           MOVE @@VDT     TSSLID                                  BUG23123 BUG23123B
     C                     Z-ADDPSTRD     TSSLID                                           BUG23123B
      *                                                                                     BUG23123
      ** Set Original Currency information.                                                   CGL031
      *                                                                                       CGL031
     C           POCCY     IFNE *BLANKS                                                       CGL031
     C                     MOVE POCCY     TSOCCY                                              CGL031
     C                     MOVE POCCY     PCCY                                                CGL031
     C                     EXSR SRCURR                                                        CGL031
      *                                                                                       CGL031
     C           A6MDIN    IFEQ 'D'                                                           CGL031
     C                     Z-ADDA6SPRT    TSOCSR                                              CGL031
     C                     ELSE                                                               CGL031
      *                                                                                    BUG23009A
      ** If German Features - Taxes is on, subtract margin points                          BUG23009A
     C           CER048    IFEQ 'Y'                                                        BUG23009A
     C           A6SPRT    SUB  A6TCMP    WSPRT  138                                       BUG23009A
     C           1         DIV  WSPRT     TSOCSR    H                                      BUG23009A
     C                     ELSE                                                            BUG23009A
     C           1         DIV  A6SPRT    TSOCSR    H                                         CGL031
     C                     ENDIF                                                           BUG23009A
      *                                                                                    BUG23009A
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'D'       TSOCMD                                              CGL031
     C                     Z-ADDCDP       TSOCDP                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE TSOCCY    TSSCCY                                              CGL031
     C                     Z-ADDTSOCSR    TSSCSR                                              CGL031
     C                     MOVE TSOCMD    TSSCMD                                              CGL031
     C                     Z-ADDTSOCDP    TSSCDP                                              CGL031
      *                                                                                       CGL031
      ** Set Tax Currency information.                                                        CGL031
      *                                                                                       CGL031
     C           PTXCY     IFNE *BLANKS                                                       CGL031
     C                     MOVE PTXCY     TSTXCY                                              CGL031
     C                     MOVE PTXCY     PCCY                                                CGL031
     C                     EXSR SRCURR                                                        CGL031
      *                                                                                       CGL031
     C           A6MDIN    IFEQ 'D'                                                           CGL031
     C                     Z-ADDA6SPRT    TSTCSR                                              CGL031
     C                     ELSE                                                               CGL031
      *                                                                                    BUG23009A
      ** If German Features - Taxes is on, subtract margin points                          BUG23009A
     C           CER048    IFEQ 'Y'                                                        BUG23009A
     C           A6SPRT    SUB  A6TCMP    WSPRT                                            BUG23009A
     C           1         DIV  WSPRT     TSTCSR    H                                      BUG23009A
     C                     ELSE                                                            BUG23009A
     C           1         DIV  A6SPRT    TSTCSR    H                                         CGL031
     C                     ENDIF                                                           BUG23009A
      *                                                                                    BUG23009A
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'D'       TSTCMD                                              CGL031
     C                     Z-ADDCDP       TSTCDP                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                    BUG23932A
      ** Retrieve base currency details                                                    BUG23932A
      *                                                                                    BUG23932A
     C                     MOVE BJCYCD    PCCY                                             BUG23932A
     C                     EXSR SRCURR                                                     BUG23932A
     C                     Z-ADDCDP       BCDP    10                                       BUG23932A
      *                                                                                       CGL031
     C                     Z-ADD1         TSXROS                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSOCSR    ZRATE1 138                                          CGL031
     C                     MOVE TSOCMD    ZMDI1   1                                           CGL031
     C                     Z-ADDTSTCSR    ZRATE2 138                                          CGL031
     C                     MOVE TSTCMD    ZMDI2   1                                           CGL031
     C                     EXSR ZXRATE                                                        CGL031
     C                     Z-ADDZRATEX    TSXRST                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'D'       TSOSMD                                              CGL031
     C                     MOVE ZMDIX     TSSTMD                                              CGL031
     C                     MOVE 'G'       TSMODI                                              CGL031
      *                                                                                       CGL031
      ** Get account information.                                                             CGL031
      *                                                                                       CGL031
     C           ACKEY1    CHAINACCNT                21                                       CGL031
      *                                                                                       CGL031
     C           *IN21     IFEQ *OFF                                                          CGL031
     C                     MOVELIBAN      TSINST                                              CGL031
     C                     Z-ADDBACOD     TSACOD                                              CGL031
     C                     Z-ADDBACSQ     TSACSQ                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   PIBAN                                               CGL031
     C                     MOVELIBAN      PIBAN                                               CGL031
     C                     EXSR SRIBAN                                                        CGL031
     C                     MOVE PIWITH    TSIBAN                                              CGL031
     C**********           Z-ADDLDBL      TSPAMT                                    CGL031 BUG23310A
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     TSDLLN                                              CGL031
     C                     Z-ADDPTOTO     TSGINT                                              CGL031
     C                     Z-ADDWHISB     TSPAMT                                           BUG23310A
      *                                                                                    BUG23310A
      ***Recalculate*the*principal/gross*interest*amount                          BUG23310A BUG23932
      *                                                                                    BUG23310A
     C********** ACKEY2    SETLLREHPOPL                                           BUG23310A BUG23932
     C********** ACKEY2    READEREHPOPL                  22                       BUG23310A BUG23932
      *                                                                                    BUG23310A
     C********** *IN22     DOWEQ*OFF                                              BUG23310A BUG23932
     C********** QDRCR     IFEQ 0                                                 BUG23310A BUG23932
     C********** QDLREF    ANDNE*BLANKS                                           BUG23310A BUG23932
      *                                                                                    BUG23310A
     C********** TSPAMT    SUB  QPSTA     TSPAMT                                  BUG23310A BUG23932
      *                                                                                    BUG23310A
     C**********           ENDIF                                                  BUG23310A BUG23932
      *                                                                                    BUG23310A
     C********** ACKEY2    READEREHPOPL                  22                       BUG23310A BUG23932
     C**********           ENDDO                                                  BUG23310A BUG23932
      *                                                                                    BUG23310A
     C********** TSPAMT    MULT PTOTO     TSGINT    H                             BUG23310A BUG23932
     C********** TSGINT    DIV  WHISB     TSGINT    H                             BUG23310A BUG23932
      *                                                                                    BUG23310A
     C********** TSGINT    IFLT 0                                                 BUG23310A BUG23932
     C**********           Z-SUBTSGINT    TSGINT                                  BUG23310A BUG23932
     C**********           ENDIF                                                  BUG23310A BUG23932
      *                                                                                       CER048
     C                     Z-ADDPSTXB     TSSTXB                                              CER048
     C                     Z-ADD*ZEROS    TSSTAC                                              CER048
     C                     Z-ADDPSTAC     TSSTAC                                              CER048
     C                     Z-ADD*ZEROS    TSSTRA                                              CER048
     C                     Z-ADD*ZEROS    TSSTDO                                              CER048
     C                     Z-ADD*ZEROS    TSSTDS                                              CER048
     C                     Z-ADD*ZEROS    TSSTDT                                              CER048
     C                     Z-ADD*ZEROS    TSSTDB                                              CER048
     C                     Z-ADD*ZEROS    TSPTHU                                              CER048
     C                     Z-ADD*ZEROS    TSPTUT                                              CER048
      *                                                                                       CER054
     C********** CER054    IFEQ 'Y'                                                  CER054 BUG26312
     C           CER048    IFEQ 'Y'                                                         BUG24714
     C                     MOVE PSTCD     TSSTCD                                              CER054
     C                     ENDIF                                                            BUG24714
     C                     MOVE PRLAF     TSRLAF                                              CER054
     C                     Z-ADDPTTXB     TSTTXB                                              CER054
     C                     Z-ADD*ZEROS    TSTTAC                                              CER054
     C                     Z-ADDPTTAC     TSTTAC                                              CER054
     C                     Z-ADD*ZEROS    TSTTRA                                              CER054
     C                     Z-ADD*ZEROS    TSTTDO                                              CER054
     C                     Z-ADD*ZEROS    TSTTDS                                              CER054
     C                     Z-ADD*ZEROS    TSTTDT                                              CER054
     C                     Z-ADD*ZEROS    TSTTDB                                              CER054
     C**********           ENDIF                                                     CER054 BUG26312
      *                                                                                       CGL031
      ** Do tax calculations if this account is taxable.                                      CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     TSTXRT                                              CGL031
     C                     Z-ADD*ZERO     TSTXSR                                              CGL031
     C           TSSTAT    IFEQ 'T'                                                           CGL031
     C********** PTRTE     IFEQ '2'                                                    CGL031 233564
     C                     Z-ADDPTXR1     TSTXRT                                              CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     MOVE PSTTR     TSSTRA                                              CER048
     C                     Z-ADDPSTXA     TSSTDO                                              CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     MOVE PTTTR     TSTTRA                                              CER054
     C                     Z-ADDPTTXA     TSTTDO                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER048
     C**********           ENDIF                                                       CGL031 233564
     C                     Z-ADDPTAXA     TSTXSR                                              CGL031
     C                     ENDIF                                                              CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     Z-ADDTSSTDO    TSSTDS                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     Z-ADDTSTTDO    TSTTDS                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER048
      ***Country*of*Tax                                                              CER048 BUG25233
      *                                                                                       CER048
     C**********           MOVE DVCNCD    WCNCD   2                                  CER048 BUG25233
     C**********           MOVE BBCOLC    WCOLC   2                                  CER048 BUG25233
      *                                                                                       CER048
     C**********           CALL 'AOCTTXR0'                                           CER048 BUG25233
     C**********           PARM *BLANKS   PRTCD                                      CER048 BUG25233
     C**********           PARM '*KEY   ' POPTN                                      CER048 BUG25233
     C**********           PARM           WCNCD                                      CER048 BUG25233
     C**********           PARM           WCOLC                                      CER048 BUG25233
     C********** SDCTTX    PARM SDCTTX    DSFDY                                      CER048 BUG25233
      *                                                                                       CER048
     C********** PRTCD     IFEQ '*NRF   '                                            CER048 BUG25233
     C**********           MOVE *BLANKS   WCOLC                                      CER048 BUG25233
     C**********           CALL 'AOCTTXR0'                                           CER048 BUG25233
     C**********           PARM *BLANKS   PRTCD                                      CER048 BUG25233
     C**********           PARM '*KEY   ' POPTN                                      CER048 BUG25233
     C**********           PARM           WCNCD                                      CER048 BUG25233
     C**********           PARM           WCOLC                                      CER048 BUG25233
     C********** SDCTTX    PARM SDCTTX    DSFDY                                      CER048 BUG25233
      *                                                                                       CER048
      ***Database*Error                                                              CER048 BUG25233
      *                                                                                       CER048
     C********** PRTCD     IFNE *BLANKS                                              CER048 BUG25233
     C**********           MOVELWCNCD     DBKEY                                      CER048 BUG25233
     C**********           MOVELWCOLC     DBKEY                                      CER048 BUG25233
     C**********           MOVEL'SDCTTXPD'DBFILE                                     CER048 BUG25233
     C**********           Z-ADD108       DBASE                                      CER048 BUG25233
     C**********           EXSR DBSR                                                 CER048 BUG25233
     C**********           ENDIF                                                     CER048 BUG25233
     C**********           ENDIF                                                     CER048 BUG25233
      *                                                                                       CER048
     C********** EWTHMD    IFEQ 'Y'                                                  CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C**********           MOVE BCNUM     TICUST                                     CER048 BUG22911
     C********** KSDIN2    CHAINSDINPHL2             25                              CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C********** *IN25     IFEQ *OFF                                                 CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C********** TIUTTH    ADD  TSGINT    WKUTIL 150                                 CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C********** WKUTIL    IFLT TICUTH                                               CER048 BUG22911
     C**********           Z-ADDTSGINT    TSPTHU                                     CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C**********           ELSE                                                      CER048 BUG22911
     C********** TICUTH    SUB  TIUTTH    TSPTHU                                     CER048 BUG22911
     C**********           ENDIF                                                     CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C**********           ENDIF                                                     CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C**********           ENDIF                                                     CER048 BUG22911
      *                                                                                     BUG22911
      ** Set the portion of threshold used (in base currency)                               BUG22911
      *                                                                                     BUG22911
     C                     Z-ADDPPORT     TSPTHU                                            BUG22911
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CGL031
     C           TSGINT    SUB  TSTXSR    TSNINT                                              CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C           TSNINT    SUB  TSSTDO    TSNINT                                              CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C           TSNINT    SUB  TSTTDO    TSNINT                                              CER054
     C                     ENDIF                                                              CER054
     C                     Z-ADDTSPAMT    TSPAMS                                              CGL031
     C                     Z-ADDTSGINT    TSGINS                                              CGL031
     C                     Z-ADDTSTXSR    TSTXSS                                              CGL031
     C                     Z-ADDTSNINT    TSNINS                                              CGL031
      *                                                                                       CGL031
      ** If Original Currency is equal to Tax Currency, use previously                        CGL031
      ** calculated values. Convert otherwise.                                                CGL031
      *                                                                                       CGL031
     C           TSOCCY    IFEQ TSTXCY                                                        CGL031
     C                     Z-ADDTSPAMT    TSPAMC                                              CGL031
     C                     Z-ADDPTOTO     TSGINC                                              CGL031
     C                     Z-ADDPTAXA     TSTXSC                                              CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     Z-ADDTSSTDO    TSSTDT                                              CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     Z-ADDTSTTDO    TSTTDT                                              CER054
     C                     ENDIF                                                              CER054
     C                     ELSE                                                               CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     Z-ADDTSSTDO    ZAMTF                                               CER048
     C                     Z-ADDTSXRST    ZCRSRT                                              CER048
     C                     MOVE TSSTMD    ZCRSMD                                              CER048
     C                     Z-ADDTSOCDP    ZCDPF                                               CER048
     C                     Z-ADDTSTCDP    ZCDPT                                               CER048
     C                     EXSR ZCCYXR                                                        CER048
     C                     Z-ADDZAMTT     TSSTDT                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CGL031
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     Z-ADDTSTTDO    ZAMTF                                               CER054
     C                     EXSR ZCCYXR                                                        CER054
     C                     Z-ADDZAMTT     TSTTDT                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
     C                     Z-ADDTSTCDP    ZCDPT                                               CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSPAMT    ZAMTF                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSPAMC                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDPTOTO     ZAMTF                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSGINC                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDPTAXA     ZAMTF                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSTXSC                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TSGINC    SUB  TSTXSC    TSNINC                                              CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C           TSNINC    SUB  TSSTDT    TSNINC                                              CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C           TSNINC    SUB  TSTTDT    TSNINC                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER048
      ***Convert*Portion*Of*Threshold*Used*in*Orig*Ccy*to*Tax*Ccy.                   CER048 BUG22911
      ** Convert Portion Of Threshold Used in Base Ccy to Tax Ccy.                          BUG22911
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C********** *IN25     IFEQ *OFF                                                 CER048 BUG22911
     C                     Z-ADDTSPTHU    TSPTUT                                              CER048
      *                                                                                       CER048
     C********** TSOCCY    IFNE TSTXCY                                               CER048 BUG22911
     C           BJCYCD    IFNE TSTXCY                                                      BUG22911
      *                                                                                     BUG22911
     C                     MOVE BJCYCD    PCCY                                              BUG22911
     C                     EXSR SRCURR                                                      BUG22911
      *                                                                                     BUG22911
     C                     Z-ADDTSPTHU    ZAMTF                                               CER048
     C                     Z-ADDTSXRST    ZCRSRT                                              CER048
     C                     MOVE TSSTMD    ZCRSMD                                              CER048
     C**********           Z-ADDTSOCDP    ZCDPF                                      CER048 BUG22911
     C                     Z-ADDCDP       ZCDPF                                             BUG22911
     C                     Z-ADDTSTCDP    ZCDPT                                               CER048
     C                     EXSR ZCCYXR                                                        CER048
     C                     Z-ADDZAMTT     TSPTUT                                              CER048
     C                     ENDIF                                                              CER048
     C**********           ENDIF                                                     CER048 BUG22911
     C                     ENDIF                                                              CER048
      *                                                                                       CGL031
     C           TSOCCY    IFEQ BJCYCD                                                        CGL031
     C                     Z-ADDTSPAMT    TSPAMB                                              CGL031
     C                     Z-ADDPTOTO     TSGINB                                              CGL031
     C                     Z-ADDPTAXA     TSTXSB                                              CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     Z-ADDTSSTDO    TSSTDB                                              CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     Z-ADDTSTTDB    ZAMTF                                               CER054
     C                     EXSR ZCCYXR                                                        CER054
     C**********           Z-ADDZAMTT     TSSTDB                                     CER054 BUG24379
     C                     Z-ADDZAMTT     TSTTDB                                            BUG24379
     C                     ENDIF                                                              CER054
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     Z-ADDTSTTDO    TSTTDB                                              CER054
     C                     ENDIF                                                              CER054
     C                     ELSE                                                               CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     Z-ADDTSSTDO    ZAMTF                                               CER048
     C                     Z-ADDTSOCSR    ZCRSRT                                              CER048
     C                     MOVE TSOCMD    ZCRSMD                                              CER048
     C                     Z-ADDTSOCDP    ZCDPF                                               CER048
     C**********           Z-ADDTSOCDP    ZCDPT                                     CER048 BUG23932A
     C                     Z-ADDBCDP      ZCDPT                                            BUG23932A
     C                     EXSR ZCCYXR                                                        CER048
     C                     Z-ADDZAMTT     TSSTDB                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CGL031
     C           CER054    IFEQ 'Y'                                                         BUG26754
     C                     Z-ADDTSTTDO    ZAMTF                                             BUG26754
     C                     Z-ADDTSOCSR    ZCRSRT                                            BUG26754
     C                     MOVE TSOCMD    ZCRSMD                                            BUG26754
     C                     Z-ADDTSOCDP    ZCDPF                                             BUG26754
     C                     Z-ADDBCDP      ZCDPT                                             BUG26754
     C                     EXSR ZCCYXR                                                      BUG26754
     C                     Z-ADDZAMTT     TSTTDB                                            BUG26754
     C                     ENDIF                                                            BUG26754
      *                                                                                     BUG26754
     C**********           Z-ADDTSOCSR    ZCRSRT                                     CGL031 BUG23931
     C                     Z-ADDTSXRST    ZCRSRT                                            BUG23931
     C                     MOVE TSOCMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
     C**********           Z-ADDZCDPF     ZCDPT                                     CGL031 BUG23932A
     C                     Z-ADDBCDP      ZCDPT                                            BUG23932A
      *                                                                                       CGL031
     C                     Z-ADDTSPAMT    ZAMTF                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSPAMB                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDPTOTO     ZAMTF                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSGINB                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDPTAXA     ZAMTF                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSTXSB                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TSGINB    SUB  TSTXSB    TSNINB                                              CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C           TSNINB    SUB  TSSTDB    TSNINB                                              CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C           TSNINB    SUB  TSTTDB    TSNINB                                              CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CGL031
     C                     MOVE 'N'       TSINPR                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     TSTNLU                                              CGL031
      *                                                                                       234656
      ***Check*if*local*tax*is*lower*than*EU*Tax,*if*so*post*EU*Tax.**               234656 AR782377
      ** Check if local tax rate is lower than EU Tax Rate or EU Tax Rate            234656 AR782377
      ** is equal to zero, if so post the EU Tax.                                           AR782377
      *                                                                                       234656
     C********** TXWTRR    IFLT TSTXRT                                               234656 AR813832
     C********** *ZERO     OREQ TSTXRT                                             AR782377 AR813832
      *                                                                                       CGL031
     C                     WRITESDCSIND0                                                      CGL031
      **********                                                                  BUG23310 BUG23310A
     C**********           MOVE 'Y'       CSINPD  1                               BUG23310 BUG23310A
      *                                                                                       234656
     C**********           ENDIF                                                     234656 AR813832
      *                                                                                     BUG24051
     C                     ENDIF                                                            BUG24051
      *                                                                                       CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C           EWTHMD    IFEQ 'Y'                                                           CER048
     C           PTOTO     ANDNE*ZERO                                                      BUG24630A
      *                                                                                       CER048
     C**********           MOVE BCNUM     TICUST                                   BUG22911 BUG23732
     C********** KSDIN2    CHAINSDINPHL2             25                            BUG22911 BUG23732
      *                                                                                     BUG22911
     C********** *IN25     IFEQ *OFF                                                 CER048 BUG23732
     C**********           ADD  TSNINT    TITOUT                                     CER048 BUG23139
     C**********           ADD  TSNINB    TITOUT                                   BUG23139 BUG23732
      *                                                                                       CER048
     C********** WTITAX    IFEQ 'T'                                                  CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C********** WKUTIL    IFLT TICUTH                                               CER048 BUG22911
     C**********           ADD  TSGINT    TIUTTH                                     CER048 BUG22911
     C**********           ELSE                                                      CER048 BUG22911
     C**********           Z-ADDTICUTH    TIUTTH                                     CER048 BUG22911
     C**********           ENDIF                                                     CER048 BUG22911
      **********                                                                     CER048 BUG22911
     C**********           ENDIF                                                     CER048 BUG22911
      *                                                                                     BUG22911
     C**********           Z-ADDPUTIL     TIUTTH                                   BUG22911 BUG23732
      *                                                                                       CER048
     C**********           UPDATSDINPHD0                                             CER048 BUG23732
      *                                                                                       CER048
     C**********           ENDIF                                                     CER048 BUG23732
      *                                                                                       CER048
     C           TSTXSB    ADD  TSSTDB    PTAXB  150                                        BUG23732
     C           PTAXB     ADD  TSTTDB    PTAXB                                             BUG24768
     C                     MOVE BCNUM     PCNUM   6                                         BUG23732
      *                                                                                    BUG26037B
      ** Retrieve Customer by country of tax details                                       BUG26037B
      *                                                                                    BUG26037B
     C                     MOVE BCNUM     KCNUM                                            BUG26037B
     C                     MOVE BBCOLC    KCOLC                                            BUG26037B
      *                                                                                    BUG26037B
     C           KLACTX    CHAINSDACTXL1             80                                    BUG26037B
     C           *IN80     IFEQ *OFF                                                       BUG26037B
     C           AXETXS    IFEQ 'S'                                                        BUG26037B
     C           AXETXS    OREQ 'D'                                                        BUG26037B
     C           AXETXS    OREQ 'T'                                                        BUG26037B
     C           AXETXS    OREQ 'Y'                                                           CER069
      *                                                                                     BUG26873
     C           PJAMG     IFNE '3'                                                         BUG26873
     C           WTCJA     ANDEQ'Y'                                                         BUG26873
     C           PCUST     ANDNE*BLANKS                                                     BUG26873
     C                     MOVE PCUST     PCNUM                                             BUG26873
     C                     ENDIF                                                            BUG26873
      *                                                                                     BUG23732
      ** Replaced AO with a commitment control version                                     BUG24630A
     C**********           CALL 'AOINPHU0'                                        BUG23732 BUG24630A
     C                     CALL 'AOINPHU1'                                                 BUG24630A
     C                     PARM *BLANKS   PRTNCD  7                                         BUG23732
     C                     PARM           PCNUM                                             BUG23732
     C                     PARM PUTIL     PTHUTL 150                                        BUG23732
     C                     PARM TSGINB    PGINB  150                                        BUG23732
     C                     PARM           PTAXB                                             BUG23732
     C                     PARM TSNINB    PNINB  150                                        BUG23732
     C                     PARM           CDP                                               BUG24051
     C                     PARM           PJAMG                                             BUG26873
      *                                                                                     BUG23732
      ** If customer does not exists in the file                                            BUG23732
      *                                                                                     BUG23732
     C           PRTNCD    IFNE *BLANKS                                                     BUG23732
     C           *LOCK     IN   LDA                                                         BUG23732
     C                     Z-ADD110       DBASE                                             BUG23732
     C                     MOVE 'SDINPHPD'DBFILE                                            BUG23732
     C                     MOVELPCNUM     DBKEY                                             BUG23732
     C                     OUT  LDA                                                         BUG23732
     C                     EXSR DBSR                                                        BUG23732
     C                     ENDIF                                                            BUG23732
      *                                                                                    BUG26037B
     C                     ENDIF                                                           BUG26037B
     C                     ENDIF                                                           BUG26037B
      *                                                                                     BUG23732
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRCURR - Gets currency details via AOCURRR0.                 *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRCURR    BEGSR                                                              CGL031
      *                                                                                       CGL031
      * Are the details for this CCY already stored in the arrays                             CSC042
     C                     MOVELPCCY      ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
      * Found in the arrays so use the details from there                                     CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
      * Not found in arrays so go to DB                                                       CSC042
     C                     CALL 'AOCURRR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*KEY   ' POPTN                                               CGL031
     C                     PARM           PCCY    3                                           CGL031
     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
     C                     MOVELPCCY      DBKEY                                               CGL031
     C                     Z-ADD104       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR DBSR                                                          CGL031
     C                     ELSE                                                               CSC042
      * Found on the DB and not in the array so add to the array                              CSC042
     C                     EXSR ##ADDC                                                        CSC042
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CSC042
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRIBAN - Gets IBAN details via AOIBANR3.                     *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRIBAN    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'AOIBANR3'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM           PIBAN  47                                           CGL031
     C                     PARM *BLANKS   PIWITH 47                                           CGL031
     C                     PARM *BLANKS   PINOBL 34                                           CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  ZDATE9 - Converts a Midas Day Number to YYYYMMDD format.     *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C/COPY ZSRSRC,ZDATE9Z3                                                                   CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  ZXRATE - Gets the x-ccy exchange rate and M/D indicator.     *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C/COPY ZSRSRC,ZXRATEZ1                                                                   CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  ZCCYXR - Converts an amount from one currency to another.    *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C/COPY ZSRSRC,ZCCYXR                                                                     CGL031
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZDATE1 subroutine to convert date format to day number
     C**
     C**     Called by       DATEIN
     C**     Calls           -
     C**
     C*
     C/COPY ZSRSRC,ZDATE1Z2
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZDATE2 subroutine to convert day number to date format
     C**
     C**     Called by       DATEIN, POSIPR, ZICD
     C**     Calls           -
     C**
     C*
     C/COPY ZSRSRC,ZDATE2Z2
     C*
      *****************************************************************                       CER016
      /EJECT                                                                                  CER016
      *****************************************************************                       CER016
      *                                                               *                       CER016
      *  *PSSR: Subroutine to handle abnormal error conditions        *                       CER016
      *                                                               *                       CER016
      *  Called by: FIRST,SRAOS                                       *                       CER016
      *                                                               *                       CER016
      *  Calls: None                                                  *                       CER016
      *                                                               *                       CER016
      *****************************************************************                       CER016
     C           *PSSR     BEGSR                                                              CER016
      *                                                                                       CER016
     C           WRUN      IFEQ *BLANKS                                                       CER016
     C                     MOVE 'Y'       WRUN    1                                           CER016
     C                     DUMP                                                               CER016
     C                     END                                                                CER016
      *                                                                                       CER016
     C                     SETON                     U7U8LR                                   CER016
      *                                                                                       CER016
     C                     ENDSR                                                              CER016
      *****************************************************************                       CER016
      /EJECT                                                                                  CER016
      *****************************************************************                       CER016
      *                                                               *                       CER016
      *  SRINT0 - Subroutine to calculate interest for Retail type    *                       CER016
      *           account.                                            *                       CER016
      *                                                               *                       CER016
      *  Called by: Z1C00,Z1C01,Z1C02                                 *                       CER016
      *                                                               *                       CER016
      *  Calls: None                                                  *                       CER016
      *                                                               *                       CER016
      *****************************************************************                       CER016
     C           SRINT0    BEGSR                                                              CER016
      *                                                                                       CER016
     C                     MOVE CDP       WNDP    10                                          CER016
     C                     Z-ADD1         WNDTMP 150                                          CER016
      *                                                                                       CER016
     C           WNDP      IFEQ 0                                                             CER016
     C                     Z-ADD1         WNDTMP                                              CER016
     C                     ELSE                                                               CER016
      *                                                                                       CER016
     C                     DO   WNDP                                                          CER016
     C           10        MULT WNDTMP    WNDTMP                                              CER016
     C                     ENDDO                                                              CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C           WAMT      MULT ZDAYN2    WINAMT                                              CER016
     C           WINAMT    DIV  100       WNAMT1    H                                         CER016
     C           WNAMT1    DIV  WNDTMP    WNAMT2    H                                         CER016
     C           WNAMT2    MULT WNDTMP    WRKFLD 150                                          CER016
     C           WRKFLD    MULT WRATE2    ZINT1  150                                          CER016
     C                     SELEC                                                            MD035448
     C           ZICALC    WHEQ 4                                                           MD035448
     C           ZICALC    OREQ 1                                                           MD035448
     C           ZINT1     DIV  365       ZINT2  150H                                       MD035448
     C           ZICALC    WHEQ 6                                                           MD035448
     C           ZINT1     DIV  366       ZINT2                                             MD035448
     C                     OTHER                                                            MD035448
     C           ZINT1     DIV  360       ZINT2  150H                                         CER016
     C                     ENDSL                                                            MD035448
     C                     Z-ADDZINT2     ZINTR                                               CER016
      *                                                                                       CER016
     C                     ENDSR                                                              CER016
      *                                                                                       CER016
      *****************************************************************                       CER016
      /EJECT                                                                                  CER016
      *****************************************************************                       CER016
      *                                                               *                       CER016
      *  SRAOS - Subroutine to call AOSVALR0 for New system value     *                       CER016
      *          InterestNumber.                                      *                       CER016
      *                                                               *                       CER016
      *  Called by: INTCAL                                            *                       CER016
      *                                                               *                       CER016
      *  Calls: None                                                  *                       CER016
      *                                                               *                       CER016
      *****************************************************************                       CER016
     C           SRAOS     BEGSR                                                              CER016
     C                     MOVE 'N'       WFIRST                                              CER016
      *                                                                                       CER016
      **  Call AOSVALR0 to check for InterestNumber                                           CER016
      *                                                                                       CER016
     C                     CALL 'AOSVALR0'                                                    CER016
     C                     PARM *BLANKS   PRTCD   7                                           CER016
     C                     PARM PSYSVL    PSVLK1 20                                           CER016
     C                     PARM           PSVL1 200                                           CER016
     C                     PARM *BLANKS   PSVLK2 20                                           CER016
     C                     PARM           PSVL2 200                                           CER016
     C                     PARM *BLANKS   PSVLK3 20                                           CER016
     C                     PARM           PSVL3 200                                           CER016
     C                     PARM *BLANKS   PSVLK4 20                                           CER016
     C                     PARM           PSVL4 200                                           CER016
     C                     PARM *BLANKS   PSVLK5 20                                           CER016
     C                     PARM           PSVL5 200                                           CER016
     C                     PARM *BLANKS   PSVLK6 20                                           CER016
     C                     PARM           PSVL6 200                                           CER016
     C                     PARM *BLANKS   PSVLK7 20                                           CER016
     C                     PARM           PSVL7 200                                           CER016
     C                     PARM *BLANKS   PSVLK8 20                                           CER016
     C                     PARM           PSVL8 200                                           CER016
     C                     PARM *BLANKS   PSVLK9 20                                           CER016
     C                     PARM           PSVL9 200                                           CER016
     C                     PARM *BLANKS   PSVLK0 20                                           CER016
     C                     PARM           PSVL0 200                                           CER016
      *                                                                                       CER016
     C           PRTCD     IFNE *BLANKS                                                       CER016
     C           PSVL1     ANDEQ'*NRF   '                                                     CER016
     C                     EXSR *PSSR                                                         CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C                     MOVELPSVL1     PINTN   1                                           CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C                     ENDSR                                                              CER016
      *                                                                                       CER016
     C********************************************************************                    CRE090
     C/EJECT                                                                                  CRE090
      *****************************************************************                     MD055663
      *                                                               *                     MD055663
      *  CUTDAT - subroutine to determine the first and last day      *                     MD055663
      *           of cutover month.                                   *                     MD055663
      *                                                               *                     MD055663
      *      Called by       DATEIN                                   *                     MD055663
      *      Calls           DBSR                                     *                     MD055663
      *                                                               *                     MD055663
      *****************************************************************                     MD055663
     C           CUTDAT    BEGSR                                                            MD055663
      *                                                                                     MD055663
      ** Work fields initialization                                                         MD055663
      *                                                                                     MD055663
     C                     Z-ADD*ZEROS    WFDCO                                             MD055663
     C                     Z-ADD*ZEROS    WLDCO                                             MD055663
      *                                                                                     MD055663
      ** Calculating date from Effective Date                                               MD055663
      *                                                                                     MD055663
      ** *IN99 set off as ZDATE2Z2 does not reset. ZDATE2Z4 not used.                       MD055663
      *                                                                                     MD055663
     C                     SETOF                     99                                     MD055663
     C                     EXSR ZDATE2                                                      MD055663
      *                                                                                     MD055663
     C                     Z-ADDZYEAR     YRSAVE  20                                        MD055663
      *                                                                                     MD055663
      ** Verify if error                                                                    MD055663
      *                                                                                     MD055663
     C           *IN99     IFEQ '1'                                                         MD055663
     C           *LOCK     IN   LDA                                                         MD055663
     C                     Z-ADD13        DBASE            ***************                  MD055663
     C                     MOVE 'ZDATE2'  DBFILE           **DB ERROR 13**                  MD055663
     C                     MOVE *BLANKS   DBKEY            ***************                  MD055663
     C                     OUT  LDA                                                         MD055663
     C                     EXSR DBSR                                                        MD055663
     C                     ENDIF                                                            MD055663
      *                                                                                     MD055663
      ** Calculating the first day                                                          MD055663
      *                                                                                     MD055663
     C           *IN98     IFEQ '0'                        - B1                             MD055663
     C                     Z-ADDZDATE     CUTOVR                                            MD055663
     C                     Z-ADD1         ZDAY                                              MD055663
     C                     Z-ADDCUTOVR    ZDATE                                             MD055663
     C                     ELSE                            - X1                             MD055663
     C                     Z-ADDZDATE     CUTOVX                                            MD055663
     C                     Z-ADD1         ZDAYX                                             MD055663
     C                     Z-ADDCUTOVX    ZDATE                                             MD055663
     C                     END                             - E1                             MD055663
     C                     EXSR ZDATE1                                                      MD055663
      *                                                                                     MD055663
     C                     Z-ADDYRSAVE    ZYEAR                                             MD055663
      *                                                                                     MD055663
      ** Verify if error                                                                    MD055663
      *                                                                                     MD055663
     C           *IN99     IFEQ '1'                        - B1                             MD055663
     C           *LOCK     IN   LDA                                                         MD055663
     C                     Z-ADD14        DBASE            ***************                  MD055663
     C                     MOVE 'ZDATE1'  DBFILE           **DB ERROR 14**                  MD055663
     C                     MOVE *BLANKS   DBKEY            ***************                  MD055663
     C                     OUT  LDA                                                         MD055663
     C                     EXSR DBSR                                                        MD055663
     C                     ENDIF                           - E1                             MD055663
      *                                                                                     MD055663
      ** Calculating first and last day of cutover month                                    MD055663
      *                                                                                     MD055663
     C                     Z-ADDZDAYNO    WFDCO                                             MD055663
      *                                                                                     MD055663
     C           *IN98     IFEQ '0'                        - B0                             MD055663
     C           ZMTH      IFEQ 12                         - B1                             MD055663
     C                     Z-ADD1         ZMTH                                              MD055663
     C                     ADD  1         ZYEAR                                             MD055663
     C                     ELSE                            - X1                             MD055663
     C                     ADD  1         ZMTH                                              MD055663
     C                     ENDIF                           - E1                             MD055663
      *                                                                                     MD055663
     C                     Z-ADDCUTOVR    ZDATE                                             MD055663
     C                     ELSE                            - X0                             MD055663
     C           ZMTHX     IFEQ 12                         - B1                             MD055663
     C                     Z-ADD1         ZMTHX                                             MD055663
     C                     ADD  1         ZYEARX                                            MD055663
     C                     ELSE                            - X1                             MD055663
     C                     ADD  1         ZMTHX                                             MD055663
     C                     ENDIF                           - E1                             MD055663
     C*                                                                                     MD055663
     C                     Z-ADDCUTOVX    ZDATE                                             MD055663
     C                     ENDIF                           - E0                             MD055663
     C                     EXSR ZDATE1                                                      MD055663
      *                                                                                     MD055663
     C                     Z-ADDYRSAVE    ZYEAR                                             MD055663
      *                                                                                     MD055663
      ** Verify if error                                                                    MD055663
      *                                                                                     MD055663
     C           *IN99     IFEQ '1'                        - B1                             MD055663
     C           *LOCK     IN   LDA                                                         MD055663
     C                     Z-ADD15        DBASE            ***************                  MD055663
     C                     MOVE 'ZDATE1'  DBFILE           **DB ERROR 15**                  MD055663
     C                     MOVE *BLANKS   DBKEY            ***************                  MD055663
     C                     OUT  LDA                                                         MD055663
     C                     EXSR DBSR                                                        MD055663
     C                     ENDIF                           - E1                             MD055663
      *                                                                                     MD055663
     C           ZDAYNO    SUB  1         WLDCO                                             MD055663
      *                                                                                     MD055663
     C                     ENDSR                                                            MD055663
     C********************************************************************                  MD055663
     C/EJECT                                                                                MD055663
     C********************************************************************                    CRE090
     C/COPY ZSRSRC,ZFRQAZ2                                                                    CRE090
     C********************************************************************                    CRE090
     C/COPY ZSRSRC,ZCHKH                                                                      CRE090
     C********************************************************************                    CRE090
     C/COPY ZSRSRC,ZACCH                                                                      CRE090
     C********************************************************************
     C/EJECT
      *****************************************************************   CCB003
     O*
     O** CAPITALISATION FILE
     O*
     OREHISPS EADD             OUTS
     O                                    1 'S'
     O                                    2 ' '
     O                         BBRCA      5
     O                         BCNUM     11
     O                         BCCY      14
     O**********               BACOD     18                                                   CGL029
     O                                   18 '0000'                                            CGL029
     O                         BACSQ     20
     O                         KVDATE    23P
     O                         WHISB     31P
     O                         WMNBL     39P
     O                         PCHGAR    46P
     O                         WCHGAR    53P
     O                         PCHGAN    60P
     O                         WCHGAN    67P
     O                         WDICT     69
     O                         WDRCB     70
     O                         WDRIR     76P
     O                         WDRCD     79P
     O                         DAIC      87P
     O                         PMADI     94P
     O                         WTMADI   101P
     O                         WPDID    104P
     O                         WDMINT   111P
     O*********                SGADI    118P                              085250
     O**************           CSGADI   118P                        085250121125
     O                         SGADI    118P                              121125
     O                         DRIP     125P
     O                         SDICI    126
     O                         DRIS     133P
     O**********               SDACP    148                                                   CGL029
     O                         SDCI     149
     O                         WCICT    151
     O                         WCRCB    152
     O                         WCRIR    158P
     O                         WCRCD    161P
     O                         CAIC     169P
     O                         PMACI    176P
     O                         WTMACI   183P
     O                         WPCID    186P
     O                         WCMINT   193P
     O**************           SGACI    200P                              085250
     O**************           CSGACI   200P                        085250121125
     O                         SGACI    200P                              121125
     O                         CRIP     207P
     O                         SCICI    208
     O                         CRIS     215P
     O**********               SCACP    230                                                   CGL029
     O                         SCCI     231
     O                         STBL     239P
     O                         CHGP     246P
     O**********               SCHAC    261                                                   CGL029
     O                         MNBCP    269P
     O                         SCHGI    270
     O                         TEGLIS   277P                                                MD023376
     O                         ZZ025    302
     O                         ZRO117   308P
     O                         ZRO117   314P
     O                         ZRO117   320P
     O                         SDRBR    323
     O                         SCRBR    326
     O                         SCHBR    329
     O                 54      AODR     335P                              CRE001
     O                N54      ZZ117    335P                              CRE001
     O                 54      ODRL     345                               CRE001
     O/COPY WNCPYSRC,RE3662O005
     O                N54      ZZ100    345                               CRE001
     O/COPY WNCPYSRC,RE3662O006
     O                 54      ODIA     353P                              CRE001
     O                N54      ZZ150    353P                              CRE001
     O                         BACOD    363                                                   CGL029
     O                         SDACP    384                                                   CGL029
     O                         SCACP    405                                                   CGL029
     O                         SCHAC    426                                                   CGL029
     O*
     ORECAPM  EADD             OUTM
     O                                    1 'C'
     O                                    2 ' '
     O                         BBRCA      5
     O                         BCNUM     11
     O                         BCCY      14
     O**********               BACOD     18                                                   CGL029
     O                                   18 '0000'                                            CGL029
     O                         BACSQ     20
     O                         KVDATE    23P
     O                         WHISB     31P
     O                         WMNBL     39P
     O                         PCHGAR    46P
     O                         WCHGAR    53P
     O                         PCHGAN    60P
     O                         WCHGAN    67P
     O                         WDICT     69
     O                         WDRCB     70
     O                         WDRIR     76P
     O                         WDRCD     79P
     O                         DAIC      87P
     O/COPY WNCPYSRC,RE3662O001
     O                         PMADI     94P
     O                         WTMADI   101P
     O/COPY WNCPYSRC,RE3662O002
     O                         MPDID    104P
     O                         WDMINT   111P
     O**************           SGADI    118P                              121125
     O                         CSGADI   118P                              121125
     O                         DRIP     125P
     O                         SDICI    126
     O                         DRIS     133P
     O**********               SDACP    148                                                   CGL029
     O                         SDCI     149
     O                         WCICT    151
     O                         WCRCB    152
     O                         WCRIR    158P
     O                         WCRCD    161P
     O                         CAIC     169P
     O/COPY WNCPYSRC,RE3662O003
     O                         PMACI    176P
     O                         WTMACI   183P
     O/COPY WNCPYSRC,RE3662O004
     O                         MPCID    186P
     O                         WCMINT   193P
     O**************           SGACI    200P                              121125
     O                         CSGACI   200P                              121125
     O                         CRIP     207P
     O                         SCICI    208
     O                         CRIS     215P
     O**********               SCACP    230                                                   CGL029
     O                         SCCI     231
     O                         STBL     239P
     O                         CHGP     246P
     O**********               SCHAC    261                                                   CGL029
     O                         MNBCP    269P
     O                         SCHGI    270
     O*************************LGID     272                               054346
     O                         ALGID    272                               054346
     O                         ZZ030    302
     O                         SDRBR    305
     O                         SCRBR    308
     O                         SCHBR    311
     O                 54      ODIA     319P                              CRE001
     O                N54      ZZ150    319P                              CRE001
     O                         BACOD    329                                                   CGL029
     O                         SDACP    350                                                   CGL029
     O                         SCACP    371                                                   CGL029
     O                         SCHAC    392                                                   CGL029
     O*
      *****************************************************************   CCB003
     O/COPY WNCPYSRC,RE3662OOP1                                           S01408
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   @YD  - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN                                         CGL031
00366007310109601461                                                                          CGL031
**   @MD  - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                                            CGL031
00000000310005900090001200015100181002120024300273003040033400365                             CGL031
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                                           CGL031
0000001                                                                                       CGL031
0000010                                                                                       CGL031
0000100                                                                                       CGL031
0001000                                                                                       CGL031
0010000                                                                                       CGL031
0100000                                                                                       CGL031
1000000                                                                                       CGL031
** CPY@ OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**  MSG
Adj Debit Int. to ALTERNATE
Adj Debit Int. to SUSPENS
Adj Credit Int. to ALTERNATE
Adj Credit Int. to SUSPENS
**  ZFMD                                                                                      CRE090
312831303130313130313031                                                                      CRE090
