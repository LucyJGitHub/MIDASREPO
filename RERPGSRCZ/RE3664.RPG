     H        1
      *****************************************************************
/*S*D****RPGBASE*******************************************************                       CRE105
/*STD *  RPGSQL                                                       *                       CRE105
/*EXI *  TEXT('Midas RE Interest and charges capitalisation')         *
/*XBIA*: OVRDBF FILE(ACCNTX) TOFILE(ACCNT) SHARE(*NO)               : *
      *****************************************************************
      *                                                               *
      *  Midas - Retail Module                                        *
      *                                                               *
      *  RE3664 - INTEREST AND CHARGE CAPITALISATION                  *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD034990           Date 25May16               *      
      *  Prev Amend No. MD032185           Date 02Jun15               *
      *                 AR676495A          Date 02Jun15               *
      *                 AR676495           Date 02Jun15               *
      *                 CRE105             Date 17Mar15               *
      *                 MD034383           Date 12May15               *
      *                 CGL165             Date 23Feb15               *
      *                 228966             Date 28Oct14               *
      *                 231617             Date 19Aug14               *
      *                 MD027841           Date 01Jul14               *
      *                 MD027245           Date 12Jun14               *
      *                 CRE090             Date 14Feb14               *
      *                 MD024001           Date 06May14               *
      *                 MD026742           Date 22May14               *
      *                 CRE100             Date 21Mar14               *
      *                 MD024557           Date 14Feb14               *
      *                 AR830076           Date 16Sep11               *
      *                 MD022635           Date 30Sep13               *
      *                 MD022410           Date 13Sep13               *
      *                 MD022379           Date 12Sep13               *
      *                 MD021155           Date 16Jul13               *
      *                 MD020956           Date 18Jun13               *
      *                 MD020687           Date 11Jun13               *
      *                 AR577206           Date 16Mar11               *
      *                 AR1096650          Date 19Mar13               *
      *                 AR1093681          Date 04Mar13               *
      *                 AR1089863          Date 19Feb13               *
      *                 CRE083BK           Date 06Aug12               *
      *                 AR978914           Date 13Dec12               *
      *                 261620             Date 28Nov12               *
      *                 CRE083BE           Date 06Aug12               *
      *                 AR851468B          Date 27Oct11               *
      *                 AR851468A          Date 25Oct11               *
      *                 AR851468           Date 19Oct11               *
      *                 AR831847           Date 20Sep11               *
      *                 AR813717           Date 06Sep11               *
      *                 CER049             Date 06Dec10               *
      *                 CRE073             Date 06Dec10               *
      *                 AR787620           Date 10Jun11               *
      *                 AR784212           Date 03Jun11               *
      *                 AR762246           Date 27May11               *
      *                 CRE075             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 AR744480           Date 15Apr11               *
      *                 AR676213           Date 19Nov10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26900           Date 16Jan10               *
      *                 BUG25530           Date 14Aug08               *
      *                 BUG26566           Date 28Oct09               *
      *                 BUG25295           Date 10Aug08               *
      *                 BUG24341           Date 16Jun09               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23309B          Date 29Jun09               *
      *                 BUG23309A          Date 17Jun09               *
      *                 BUG24114           Date 09May09               *
      *                 BUG23732           Date 23Apr09               *
      *                 BUG23163A          Date 30Apr09               *
      *                 BUG23163           Date 25Mar09               *
      *                 BUG23681           Date 03Apr09               *
      *                 BUG23587           Date 25Mar09               *
      *                 BUG23123           Date 09Mar09               *
      *                 BUG23347           Date 18Mar09               *
      *                 BUG23097A          Date 10Mar09               *
      *                 CER048             Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CDL081             Date 14Dec09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG14933           Date 02Oct07               *
      *                 246184             Date 14Mar07               *
      *                 CRE026             Date 19Feb07               *
      *                 250998             Date 25Oct07               *
      *                 BUG12930           Date 04Jan07               *
      *                 244623             Date 19Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 135809R            Date 29Jun06               *
      *                 CDL013             Date 27Jun06               *
      *                 239314             Date 25May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 09May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG9030            Date 22Nov05               *
      *                 236352             Date 06Sep05               *
      *                 235917             Date 06Sep05               *
      *                 235875             Date 06Sep05               *
      *                 235328             Date 18Aug05               *
      *                 235174             Date 27Jul05               *
      *                 235368             Date 05Aug05               *
      *                 235307             Date 03Aug05               *
      *                 234870             Date 22Jul05               *
      *                 234661             Date 04Jul05               *
      *                 234438             Date 27Jun05               *
      *                 234003             Date 21Jun05               *
      *                 233720             Date 26May05               *
      *                 233719             Date 26May05               *
      *                 232543             Date 10Mar05               *
      *                 CGL031             Date 04Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 218393             Date 10Jun03               *
      *                 217910             Date 30May03               *
      *                 CRE008             Date 19Feb02               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 211084             Date 25Oct02               *
      *                 198082             Date 06Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 189038             Date 20Aug01               *
      *                 184965             Date 20Aug01               *
      *                 183947             Date 20Aug01               *
      *                 164975             Date 20Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CDE002             Date 04Apr00               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CMX001             Data 18Apr01               *
     F*                 CRE007             Date 01Mar01               *
     F*                 162319             Date 17Jun99               *
     F*                 150714             Date 19May99               *
     F*                 161803             Date 21JUN99               *
     F*                 129099             Date 07May98               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179300             DATE 29Nov99               *
      *                 156767             DATE 24Nov99               *
      *                 131825             Date 22Nov99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 01Jun99               *
      *                 135809             Date 07Jul99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 02Mar99               *
      *                 135401             Date 30Apr99               *
      *                 130468             Date 29Apr99               *
      *                 CTI002             DATE 09Sep98               *
     F*                 101861             DATE 18Jun98               *
     F*                 123519             DATE 27May98               *
     F*                 091680             DATE 18May98               *
     F*                 112808 SL          DATE 17Feb98               *
     F*                 104489             DATE 06Feb98               *
     F*                 120254             DATE 06FEB98               *
     F*                 S01408             DATE 26Jan98               *
     F*                 122952             Date 28OCT97               *
     F*                 105084             DATE 24SEP97               *
     F*                 106604             DATE 13MAY97               *
     F*                 CRE002             Date 18Feb97               *
     F*                 101656             Date 12Dec96               *
     F*                 CCB003             Date 31Oct96               *
     F*                 111921             Date 16Dec96               *
     F*                 S01408             Date 02Sep96               *
     F*                 CAC001             Date 01Feb96               *
     F*                 106213             DATE 22JUL96               *
     F*                 100086             DATE 18JUL96               *
     F*                 101847             DATE 04JUN96               *
     F*                 098818             DATE 15APR96               *
     F*                 094681             DATE 24NOV95               *
     F*                 093582             DATE 24APR96               *
     F*                 092564             DATE 26SEP95               *
     F*                 091906             DATE 24APR96               *
     F*                 091896             DATE 24APR96               *
     F*                 S01408             DATE 11APR96               *
     F*                 S01408             DATE 29MAR96               *
     F*                 095656             DATE  8NOV95               *
     F*                 S01408             DATE 18OCT95               *
     F*                 085762             DATE 27APR95               *
     F*                 088181             DATE 15JUN95               *
     F*                 086125             DATE 16MAR95               *
     F*                 S01522             DATE 25JAN95               *
     F*                 081545             DATE 10MAR95               *
     F*                 088273             DATE 25SEP95               *
     F*                 092064             DATE 21AUG95               *
     F*                 089741             DATE 21JUL95               *
     F*                 087513             DATE 23JUN95               *
     F*                 087842             DATE 02JUN95               *
     F*                 084082             DATE 01JUN95               *
     F*                 085787             DATE 10APR95               *
     F*                 082592             DATE 06MAR95               *
     F*                 S01408             DATE 22FEB95               *
     F*                 076557             DATE 26SEP94               *
     F*                 084054             DATE 01MAR95               *
     F*                 080978             DATE 21FEB95               *
     F*                 075073             DATE 02MAR95               *
     F*                 074598             DATE 05AUG94               *
     F*                 071428             DATE 01JUN94               *
     F*                 071427             DATE 01JUN94               *
     F*                 071053             DATE 23MAY94               *
     F*                 069558             DATE 18MAY94               *
     F*                 057048             DATE 07MAR94               *
     F*                 060828             DATE 28JAN94               *
     F*                 048430             DATE 28JAN94               *
     F*                 B8200              DATE 29SEP93               *
     F*                 LN0106             DATE 06DEC93               *
     F*                 049320             DATE 29SEP93               *
     F*                 052739             DATE 29SEP93               *
     F*                 S01413 *CREATE     DATE 13APR93               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD034990 - Postings not posted against account sequence of   *
      *             the retail account.                               *      
      *  MD032185 -  Job GLC0340 00003 (Midas GL Daily journal - post *
      *              1) failed with accounting imbalance of EUR 0.02  *
      *              from Retail Interest Adjustments                 *
      *  AR676495A - Wrong posting still generated if int. adj. and   *
      *              AVRT=WLEVEL. Added condition not to use Average  *
      *              rate limit if CER054 is ON.                      *
      *            - Applied for MD032185                             *
      *  AR676495 - Wrong posting when interest adjustment occurred,  *
      *             Posted gross instead of net for interest adj. and *
      *             net for int adj. was deducted on total interest   *
      *             Amended pgm to post net int adj. by reading file  *
      *             LF/SDCSINL7 and this will correct the deduction of*
      *             taxes for the total interest.                     *
      *            - Applied for MD032185                             *
      *  CRE105 - Modelo 123 and 193 Reports                          *
      *           Added /COPYs: CRE105_007, CRE105_008, CRE105_009    *
      *                         CRE105_010, CRE105_011                *
      *  MD034383 - Amendment to Tax Calculation Program              *
      *  CGL165 - Dual Withholding Tax                                *
      *  228966 - Database error caused by a blank Spot Trade Accnt   *
      *           Equivalent in PF/SDCURRPD. Applied fix 121398.      *
      *  231617 - Amend 198082 to use WACN0 rather than AAACNO.       *
      *  MD027841 - Inconsistent display for Interest when system     *
      *             values RET_CHG_CUS_LVL = 'N' & RET_INTAC_CUST_LVL *
      *             = 'Y' against RET_CHG_CUS_LVL = 'Y' &             *
      *             RET_INTAC_CUST_LVL = 'Y'.                         *
      *  MD027245 - Interest capitalisation not performed on delay    *
      *             date when demand capitalisation was requested     *
      *             during delay period.                              *
      *  CRE090 - Delay Capitalization of Interest                    *
      *  MD024001 - Avoid ZZ001 update on REHISPS from RETRG.         *
      *  MD026742 - Accounting Imbalance due to Retail Withholding    *
      *             Tax.                                              *
      *  CRE100 - Allow Customer Number For Retail Accrual And Charge *
      *           Postings.                                           *
      *  MD024557 - REC64N failed with REHISL file locking error      *
      *  AR830076 - Apply fix AR318139 (Child:AR830077)               *
      *  AR318139 - Wrong narrative for when UDC is on. Need to use   *
      *             German translated narrative when this feature is  *
      *             on by enhancing BUG23163A. (Child:AR318140)       *
      *  MD022635 - Multiple reconciliation differences field OTRF,   *
      *             OTST, FACO needs to be populated.                 *
      *           - Field PRFC incorrect due to interbranch Fix.      *
      *           - NAR is not updated. Only blank inside the table.  *
      *           - Inconsistent index used to udate NARD, causing    *
      *             incorrect narrative in PNAR.                      *
      *  MD022410 - Record allocation problem in REC64N               *
      *  MD022379 - EODPOPD Wrong customer for interbranch            *
      *  MD021155 - COB Restructure Phase 1 Remnants                  *
      *           - Caching Issues                                    *
      *  MD020956 - Blank Posting Narrative on Customer Account       *
      *             in GE-IC Module.                                  *
      *  MD020687 - Component REC64N 01005 & 01007 failed             *
      *  AR577206 - AJAX Narrative on the interest capitalisation     *
      *             entry (CHILD: AR577207)                           *
      *           - Amend MGD index to retrieve narrative             *
      *             "Interest nnnnnnnnnn"                             *
      *  AR1096650 - Caching flaw found in linked test                *
      *  AR1093681 - REC64N eror encountered in link test             *
      *  AR1089863 - Merging issues of 2.0 and 2.1 releases           *
      *  CRE083BK - COB Restructure - RE COB Optimisation Phase 1     *
      *  AR978914 - Reinstated fix 135809 for data reconciliation     *
      *             purposes. (Child: AR978915)                       *
      *  261620 - Multiple reconciliation differences that seem to be *
      *           caused by CRE008.                                   *
      *           Amended in such a way that the population of FACO,  *
      *           OTRF & OTST will be correct.                        *
      *         - Applied for AR1006287 (Child: AR1006288)            *
      *  CRE083BE - COB Restructure - RE COB Optimisation Phase 1     *
      *  AR851468B - Do not use withholding tax account when          *
      *              CGL031 is switched on (Child:AR851469)           *
      *  AR851468A - Wtax and main tax are posted simultaneously      *
      *              (Child:AR851469)                                 *
      *  AR851468 - No tax when CR interest posted on alternate       *
      *             account (Child:AR851469)                          *
      *  AR831847 - Missing PostNetInterest system value              *
      *             (Child:AR831848)                                  *
      *  AR813717 - Main and secondary taxes not found(Child:AR814547)*
      *  CER049 - Stamp Tax                                           *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,REH00026                                 *
      *             WNCPYSRC,REH00015                                 *
      *             WNCPYSRC,REH00016                                 *
      *             WNCPYSRC,REH00024                                 *
      *             WNCPYSRC,REH00025                                 *
      *             WNCPYSRC,REH00017                                 *
      *             WNCPYSRC,REH00018                                 *
      *             WNCPYSRC,REH00019                                 *
      *             WNCPYSRC,REH00020                                 *
      *             WNCPYSRC,REH00021                                 *
      *             WNCPYSRC,REH00022                                 *
      *             WNCPYSRC,REH00023                                 *
      *  AR784212 - Next interest capitalisation date does not default*
      *             based on defined currency and location holiday    *
      *             table. Applied fix 252356                         *
      *  252356 - Amended system to pass variable BJSLCD before       *
      *           chaining to the holidays file.                      *
      *  AR762246 - Incorrect tax amount posted in ACMV               *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  AR744480 - Taxes not reflected in the Account movements while*
      *             interest is posted  (Child: AR744481)             *
      *  AR676213 - Incorrect definition of CLGLAI field (Recompile)  *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26900 - Double posting of taxes in apostpd                *
      *  BUG25530 - Difference in value dates for main tax, interest  *
      *             and 2nd, 3rd tax                                  *
      *  BUG26566 - GLC30 0001: At least one currency is out of bal.  *
      *           - Applied fix BUG25343                              *
      *  BUG25295 - 24114 and 23347 Extended for Church Tax           *
      *  BUG24341 - Thresholds were not considered in calculation of  *
      *             Main tax and the label for Third Tax is incorrect *
      *  CER054 - German Features - Church Tax                        *
      *  BUG23309B -  REACR updated only for the positive value of    *
      *               History Balance.                                *
      *  BUG23309A -  OSIC showing difference between History and     *
      *               Ledger Balance                                  *
      *  BUG24114 - Limit Utilisation Enquiry and report is showing a *
      *             Minus figure                                      *
      *  BUG23732 - Joint Account threshold (Recompile)               *
      *  BUG23163A - Posting Narrative needs to be changed re-open    *
      *  BUG23163 - Interest posting Narrative needs to be changed    *
      *  BUG23681 - REC64N Error - Updating SDINPHL2 w/out prior read *
      *  BUG23587 - Saving Account Threshold no more required         *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *                     (Recompile)                               *
      *  BUG23347 - Average rate less than the Retail Accounts rate   *
      *             defined on Country of Taxes                       *
      *  BUG23097A - Various errors in GLC30 00001                    *
      *  CER048 - German Features - Taxes                             *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CDL081 - Tiered withholding tax rounding upgrade             *
      *  BUG14933 - Error in checking switchable feature CSW207       *
      *             (Recompile)                                       *
      *  246184 - If spot trade account code field is blank, do not   *
      *           chain to SDACODPD anymore to prevent DBERROR 86.    *
      *  CRE026 - Consumer Banking                                    *
      *  250998 - Added SR/DETPR to allow the system to compute for   *
      *           charges for transaction type 91060 seperately.      *
      *  BUG12930 - Change the length of data area CBTASKSP to 10     *
      *             characters. (Recompile)                           *
      *  244623 - Retail Accnt is not accruing (in RE3380P1) daily.   *
      *           If the Account's interest capitalisation frequency  *
      *           is 'A', the system updates the next capitalisation  *
      *           date with the current accrual date instead of the   *
      *           next accrual date. Applied fix 226373.              *
      *           Coding done by Bug9030.                             *
      *  135809R- Remove fix 135809 as it clashes with CDL013         *
      *  CDL013 - Tiered Withholding Tax                              *
      *  239314 - If spot trade equivalent is not existing, do not    *
      *           generate postings for spot trade equivalent.        *
      *           Apply 161915.                                       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG9030 - Problem with Accruals (Applied fix 226373).        *
      *  236352 - Wrong narrative for EU tax postings (with REPNAR)   *
      *           MsgID GB00243 replaced by GB00540/GB00541/GB00542   *
      *           because GB0024X are used for withholding taxes      *
      *  235917 - Wrong and duplicate EU tax postings for joint A/C   *
      *  235875 - Allow negative EU tax amounts (for neg. CR int.adj.)*
      *  235328 - Wrong narrative for CR int adjustments due to       *
      *           EU tax changes                                      *
      *  235174 - Trade a/c keys do not consider Joint A/c country.   *
      *  235368 - Value date for EU tax postings must be set to SHISD *
      *  235307 - No debit posting must be generated in account       *
      *           currency on the EU tax account                      *
      *  234870 - Several errors in EU tax management                 *
      *  234661 - TOF is showing incorrect amounts.                   *
      *  234438 - Narrative missing on RE capitalization posting.     *
      *  234003 - No tax calculated on interest for retail a/c.       *
      *  233720 - Process must be based on RCAIC                      *
      *  233719 - WTAOC must be put in PIORAM                         *
      *  232543 - Fix to CGL031                                       *
      *  CGL031 - Taxation on Savings Income                          *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  218393 - GA unlink errors (CRE008 fix)                       *
      *  217910 - Show retail old retail account on postings          *
      *           for mapped GAs  (CRE008 fix)                        *
      *  CRE008 - Cash Management                                     *
      *  CGL020 - Compliance Watch - Additional A/C Postings          *
      *           Information                                         *
      *  211084 - Complete 184965 : The size of the fields passed to  *
      *           AOPRFMR0 doesn't correspond to the entry fields of  *
      *           this access object                                  *
      *  198082 - Posting narrative should be <MSG> brca-<cust><ccy>  *
      *           <acno> when retail account number is already zero   *
      *           due to mapping.                                     *
      *  189038 - Interest posted on closing account shows the wrong  *
      *           narrative. Changed narrative to 'Interest'. Applied *
      *           fixes 183578 and 167772.                            *
      *  184965 - Postings with SPOS = 'GE-IC' do not contain profit  *
      *           centre. Applied fix 143578.                         *
      *  183947 - Remove '-' from posting narrative if account is not *
     F*  164975 - For accounts capitalising on a weekly, forthnightly *
     F*           or semi-monthly basis, the next cap. date should be *
     F*           set on or after the next working date.              *
      *  CDE002 - Revenue Analysis - Recompiled due to changes in     *
      *           PF/RECCYD.                                          *
     F*  CMX001 - Meridian Export                                     *
     F*  CRE007 - Base Rate Tax 2001.                                 *
     F*  162319 - Incorrect transaction type                          *
     F*  150714 - Complete 129099                                     *
     F*           ADD TEST FOR INTEREST OF CAPITALIZATION             *
     F*  161803 - INCORRECT TRANSACTION TYPE TRANSFERRED TO INTERFACE *
     F*  129099 - Identify Capitalisation Postings:                   *
     F*           Split 91060 to 91061 / 91062                        *
     F*                 91040 to 91041 / 91042                        *
     F*  179300 - Ensure that IPDT is set up correctly, as NCID is    *
     F*           now updated before BRT procedures are called.       *
     F*           Save NCID, and use this saved value rather than     *
     F*           NCID in OUTBRT sub.                                 *
     F*  156767 - Prohibit generation of entry to REINCXPD if account *
     F*           is secondary.  This would ensure that no posting is *
     F*           reported in RE5420 for the secondary account.       *
     F*  131825 - Postings should not be produced if Dr Interest      *
     F*           payment account codes are equal for Dr and Cr       *
     F*           or Cr Interest payment account codes Cr is equal    *
     F*           debit interest sub to tax or not subject to tax.    *
     F*  CPB001 - Meridian DBA Middleware Replication Customization.  *
     F*           Midas/TOF Interface.                                *
      *  135809 - Withholding tax retained in the wrong branch when   *
      *           alternative a/c used. Post gross interest and tax   *
      *           to main a/c, then transfer net interest to alt. a/c.*
      *  CGL007 - Account Postings Enquiry.  Recompile.               *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
     F*  135401 - Change the posting narratives to specify whether an *
     F*           Interest Adjustment is a DR or CR.                  *
     F*  130468 - BRT not deducted from CR interest adjustments.      *
     F*           BRT processing amended to calculate BRT on total of *
     F*           CR adjustments plus CR interest and to output BRT   *
     F*           as a separate DR posting to the retail a/c (instead *
     F*           of deducting it from the interest). Also BRT should *
     F*           be deducted when an alternative a/c is used.        *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  101861 - No Withholding tax is ever deducted if an           *
     F*           alternative account for credit interest is defined. *
     F*           CACP should be moved left into the work field.      *
     F*  123519 - Interest posted to suspense instead of alternative  *
     F*           a/c when full a/c no. used for alt a/c. Ensure alt. *
     F*           a/c branch code is taken from the REHISPS record.   *
     F*  091680 - Ensure manual adjustment reversing out accrued      *
     F*           interest is correctly processed.                    *
     F*           NB. This fix depends on REHISSL selecting on        *
     F*           SDICI *NE ' ' & PMADI *NE TMADI or SCICI *NE ' ' &  *
     F*           PMACI *NE TMACI (fix 084790).                       *
     F*  112808 - VALUE DATE NOT SET UP FOR POSTINGS TO ALTERNATE A/C *
     F*  104489 - Control cap. date for closure cap. for 1st day      *
     F*           accruals should be run date instead of run date + 1.*
     F*           Charge fields were not set correctly for closure    *
     F*           cap. due to wrong control cap. date., causing       *
     F*           capitalised charges to show as outstanding in OSIC. *
     F*  120254 - Value date missing from Account Movement Screen.    *
     F*         - ( Applied Fix 100086 )                              *
     F*  S01408 - Missing core hooks in Midas DBAR2                   *
     F*           Addition of core hook RE3664C004                    *
     F*           Addition of core hook RE3664C005                    *
     F*           Addition of core hook RE3664C006                    *
     F*           Addition of core hook RE3664C007                    *
     F*           Addition of core hook RE3664C008                    *
     F*           Addition of core hook RE3664C009                    *
     F*  122952 - Database error 41 in REHISBC, key *NRF, caused by   *
     F*           program changing Added Today Indicator from 'C' to  *
     F*           'Y' in the middle of the program, so the record is  *
     F*           excluded when the logical file is accessed later.   *
     F*           Fix is not to update the ADTY flag if the REHISPD   *
     F*           'B' record is updated other than at the end of the  *
     F*           program.                                            *
     F*         - Changes to REHISBC not rolled back if an error      *
     F*           occurs - add a KCOMIT line for this file.           *
     F*         - Make DB Error output more meaningful for error 41   *
     F*  105084 - Incomplete posting description in Daily Journal.    *
     F*  106604 - Withholding tax posting has not the same value date *
     F*           as interest posting still.                          *
     F*  CRE002 - Post Retail Accrual to Interim Accounts.            *
     F*           To initialise values of the Additional Overdraft    *
     F*           Interest Rate, Overdraft Line, Overdraft Line       *
     F*           Change Indicator, and the Overdraft Interest Amount *
     F*           on Retail History files.                            *
     F*  101656 - Withholding Tax code is never executed because      *
     F*           field BCICI is cleared before SR/TOTTAX. Also,      *
     F*           REACRD should be updated AFTER the withholding      *
     F*           tax routine.                                        *
     F*  CCB003 - COB Performance Enhancements - Task Split           *
     F*  111921 - Zero Value date for suspense postings.              *
     F*  S01408 - Addition of core hook RE3664CP36                    *
     F*           Addition of core hook RE3664CP35                    *
     F*           Addition of core hook RE3664CP34                    *
     F*           Addition of core hook RE3664CP33                    *
     F*           Addition of core hook RE3664CP32                    *
     F*           Addition of core hook RE3664CP31                    *
     F*           Addition of core hook RE3664CP30                    *
     F*           Addition of core hook RE3664CP29                    *
     F*           Addition of core hook RE3664CP28                    *
     F*           Addition of core hook RE3664CP27                    *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           The profit centre of postings with certain account  *
     F*           types should be assigned as follows:                *
     F*           Interbranch Posting - profit centre from PCA ICD    *
     F*           Suspense Posting - primary funding profit centre    *
     F*           Retail or Nostro alternate a/c - profit centre of   *
     F*             the account                                       *
     F*           Other - profit centre of the generating a/c.        *
     F*  106213 - Error exists in program because *IN40 is never      *
     F*           reset if TXWTRR *EQ 0, causing DBError 003.         *
     F*           Fix resets *IN40 to 0 before conditional chain      *
     F*           to ACCNTBXC.                                        *
     F*  100086 - Value date is 0 for postings, due to incorrect fix  *
     F*           082592 - fix is to move RUND to VALD, but only if   *
     F*           VALD is 0.                                          *
     F*  101847 - Multiply/divide indicatore are inverted - the M/D   *
     F*           indicator of the 'From' currency has to be moved to *
     F*           the cross-rate M/D indicator before calling ZCONV.  *
     F*  098818 - Allow for interest capital indicator on RSHISPS     *
     F*           to retain its original values of 'C' 'D' 'Y' &      *
     F*           ' ' to be used by input cycle enquiries.            *
     F*  094681 - Ensure that 'CLOS.INT.' posting narrative is only   *
     F*           used for closing interest and not for interest      *
     F*           adjustment applied at closure capitalisation.       *
     F*  093582 - Withholding tax posting has not the same value date *
     F*           as interest posting because SR WVALD is called      *
     F*           before these postings are created but the SR        *
     F*           changes the value date. Remove WVALD since 060828   *
     F*           determines value date.                              *
     F*  092564 - NDID and NCID can fall behind on daily accruals.    *
     F*           Always use local currency for check for next        *
     F*           working day.                                        *
     F*  091906 - Withholding tax minimum threshold is incorrect,     *
     F*           Use correct work field WKMISU not WMISU.            *
     F*  091896 - Postings for withholding tax do not get created     *
     F*           in COB since BDICI and BCICI is initialised after   *
     F*           TOTTAX. Initialise fields after this SR.            *
     F*  S01408 - Addition of core hook RE3664CP26                    *
     F*           Addition of core hook RE3664CP25                    *
     F*           Addition of core hook RE3664CP24                    *
     F*           Addition of core hook RE3664CP23                    *
     F*           Addition of core hook RE3664CP22                    *
     F*           Addition of core hook RE3664CP21                    *
     F*           Addition of core hook RE3664CP20                    *
     F*           Addition of core hook RE3664CP19                    *
     F*           Addition of core hook RE3664CP18                    *
     F*  S01408 - Rename duplicate hook RE3664CCP4 to RE3664CP17      *
     F*  095656 - Ensure ZZ001 blank before chain to RECRG            *
     F*  S01408 - Addition of core hook RE3664CP12                    *
     F*           Addition of core hook RE3664CP13                    *
     F*           Addition of core hook RE3664CP14                    *
     F*           Addition of core hook RE3664CP15                    *
     F*           Addition of core hook RE3664CP16                    *
     F*  085762 - If no records on file, P1 report was being produced *
     F*           for branch 000 with no details on it - amended pgm  *
     F*           to not produce this report.                         *
     F*  088181 - A) I/O operation on closed RE3664P1 file in INITPR  *
     F*              and FIRST SRs.                                   *
     F*              Removed WRITE to P1 file as adequate info is     *
     F*              supplied in RE3664AU by the *PSSR routine.       *
     F*           B) Error was incorrect anyway because ACOD may be   *
     F*              blank for base ccy Trade Equivalent a/c.         *
     F*              Suppress read of SDACODPD if WBTACC is blank.    *
     F*           C) Change test of Sterling ccy A/C code to look for *
     F*              blanks rather than '0000' for not entered.       *
     F*  086125 - Add new parameter to AOPNARR0                       *
     F*  S01522 - Call to AOPNARR0 if switchable feature installed    *
     F*           and UDC present                                     *
     F*  081545 - Page is a preerved word and should not be           *
     F*           accumulated in the program. Also initialise *IN85   *
     F*           to zero or the first page produced is blank.        *
     F*  088273 - A/C closure generated entry has blank narrative.    *
     F*           Affects 087513 and 084082.                          *
     F*  092064 - The wrong interest amount is being output to BRT    *
     F*           hisory if the category is 'N'. This is because      *
     F*           the work field PACR1 is not being set up correctly. *
     F*  089741 - Ensure that BRT processing is performed when an     *
     F*           account is closed.                                  *
     F*  087513 - Interest is capitalised twice, if closure           *
     F*           requested on day after normal capitalisation.       *
     F*           This is fixed within RE3662. However, narrative for *
     F*           this posting was also wrong. It was set to          *
     F*           'ACCR.A/C.' when this should have been 'INT.CAP.'.  *
     F*  087842 - BRT history records are being output with wrong     *
     F*           account details.                                    *
     F*  084082 - Posting narrative is defaulting to 'CLOSURE' for    *
     F*           BRT postings - amend to default to 'BRT INTEREST'   *
     F*  085787 - Inconsistent page numbers, last posting date,       *
     F*           eroneous reporting of posted field.                 *
     F*         - Print details of accounts which have capitalised    *
     F*           today but have accrued zero interest, to avoid      *
     F*           blank reports for a branch being produced.          *
     F*         - Do not print anything in posted today field if      *
     F*           zero interest calculated.                           *
     F*         - If no details to print in any branch, say so        *
     F*         - Overprinting is occuring in posted today field      *
     F*           on RE3364P1 report, due to an error in fix 075073   *
     F*         - Add JOB NAME text to the report header to indicate  *
     F*           from which run of the RE3664 this report is produced*
     F*  082592 - Dates being wrongly overwritten.                    *
     F*  S01408 - Addition of core hook RE3664FFPG                    *
     F*           Addition of core hook RE3664IIPG                    *
     F*           Addition of core hook RE3664CCPG                    *
     F*           Addition of core hook RE3664CCP1                    *
     F*           Addition of core hook RE3664CCP2                    *
     F*           Addition of core hook RE3664CCP3                    *
     F*           Addition of core hook RE3664CCP4                    *
     F*           Addition of core hook RE3664CCP5                    *
     F*           Addition of core hook RE3664CCP6                    *
     F*           Addition of core hook RE3664CCP7                    *
     F*           Addition of core hook RE3664CCP8                    *
     F*           Addition of core hook RE3664CCP9                    *
     F*           Addition of core hook RE3664CP10                    *
     F*           Addition of core hook RE3664CP11                    *
     F*  076557 - IF REHIS IS BLANK THEN NO BRANCH CODE IS REPORTED   *
     F*  084054 - WHEN CONVERTING TO STG OR NOT USES WRONG CURRENCY   *
     F*  080978 - SET UP CORRECT A/C REFERENCE ON BRT FILES AS PICKS  *
     F*           WRONG REFERENCE AND SOMETIMES BLANK                 *
     F*         - ALSO USE CUST NO OF A/C CAUSING GEN ENTRY AS        *
     F*           ASSOCIATED CUSTOMER                                 *
     F*  075073 - Overflow not working for RE3664P1.                  *
     F*           *IN90 is also used by /COPY Z* routines.            *
     F*         - False YES into posting today field if standard      *
     F*           defaults fail. Program also recompiled as           *
     F*           printer file RE3664P1 changed
     F*  074598 - Accrual narrative on capitalisation via RE3664      *
     F*           to have same layout as accruals via RE3666.         *
     F*  071428 - Incorrect narratives being set-up within BRT        *
     F*  071427 - Exchange conversion to STG for BRT wrong            *
     F*  071053 - Capitalisations due today are not actioned when the *
     F*           branch code of the account is alphanumeric as the   *
     F*           file pointer is set to the wrong position in file.  *
     F*  069558 - Array index error in routine ZFRQA when this is     *
     F*           called for accounts capitalising with Freq = 'Z'.   *
     F*  057048 - Problem with account closure if first day accrual   *
     F*  060828 - Value date of withholding tax posting must be       *
     F*           the same as interest posting value date             *
     F*  048430 - Discrepancies with withholding taxe the day the     *
     F*           account capitalise in credit                        *
     F*  B8200  - Correct the narrative for Withholding Tax           *
     F*  LN0106 - To add one day to VALD/HISD if LDAC not equal 'Y'   *
     F*  049320 - Incorrect Combination of Branch Internal Customer   *
     F*           and Branch Code Output to GEICPD.                   *
     F*  052739 - Ensure Last Change Date is Updated on REACRD.       *
     F*  S01413 - Retail 3 Incorporation                              *
     F*  BRTSAR - BRT apply only in this period interest credit and   *
     F*           not an adjustment                                   *
     F*                                                               *
     F*****************************************************************
     F/COPY WNCPYSRC,RE3664F001
     FACCNTX  UF  E           K        DISK
     F                                              KCOMIT
     F            ACCNTABF                          KRENAMEACCNTXF
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F                                              KINFDS ACXDS
     F                                              KINFSR ACXSR
     FSDBRTDL1IF  E           K        DISK
     FSDCBRTL1IF  E           K        DISK
     FSDFRCTL0IF  E           K        DISK                               CRE007
      *                                                                                       CGL031
     F***SDCSINL7IF  E        K        DISK                                            CGL031 232543
     F**********                                    KINFSR *PSSR                       CGL031 232543
      ***Midas*SD Customer Income by Account Number                                    CGL031 232543
      **********                                                                       CGL031 232543
     FSDCSINL7IF  E           K        DISK         KINFSR *PSSR                              232543
     F            SDCSIND0                          KRENAMESDCSIND7                           232543
      ** Midas SD Customer Income - Customer Number Retrieve Index                            232543
      *                                                                                       232543
     FSDCSINLCIF  E           K        DISK         KINFSR *PSSR                              232543
     F            SDCSIND0                          KRENAMESDCSINDC                           232543
      ** Midas SD Customer Income - Joint A/c Number Retrieve Index                           232543
      *                                                                                       232543
     FSDJACCL1IF  E           K        DISK         KINFSR *PSSR                              232543
      ** Midas SD Joint A/c Member Details - Retrieve Index                                   232543
      *                                                                                       232543
     FREHISBC UF  E           K        DISK
     F                                              KCOMIT                122952
     F**********  REHISPPF                          KRENAMEREHISBP1                  CCB003 CRE083BE
     F***REINTCPDUF  E                    DISK                                       CCB003 CRE083BE
     FREINTCPDUF  E           K        DISK                           UC                    CRE083BE
     F            REINTCD0                          KRENAMEREHISBP1                         CRE083BE
     F                                              KCOMIT
     F                                              KINFDS RECDS
     F                                              KINFSR RECSR
     FREHISBL UF  E           K        DISK
     F                                              KCOMIT
     F            REHISPPF                          KRENAMEREHISPBF
     F                                              KINFDS REBDS
     F                                              KINFSR REBSR
     FREHISL  UF  E           K        DISK                      A
     F                                              KCOMIT
     F            REHISPPF                          KRENAMEREHISPDF
     F            REHISPSF                          KIGNORE
     F                                              KINFDS RELDS
     F                                              KINFSR RELSR
     FREHISSL UF  E           K        DISK
     F                                              KCOMIT
     F                                              KINFDS RESDS
     F                                              KINFSR RESSR
     FRELINKL1IF  E           K        DISK
     F/COPY WNCPYSRC,REH00167
     FACCRACJ IF  E           K        DISK
     FRECRG   IF  E           K        DISK
     F            RECRGAF                           KIGNORE
     F            RECRGZF                           KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMABF
     FREACNML0IF  E           K        DISK                               CAC001
     FACCNT   UF  E           K        DISK
     F                                              KCOMIT
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F                                              KINFDS ACCDS
     F                                              KINFSR ACCSR
     FREACR   UF  E           K        DISK
     F                                              KCOMIT
     F            REACRAF                           KIGNORE
     F            REACRZF                           KIGNORE
     F                                              KINFDS ACRDS
     F                                              KINFSR ACRSR
     FRETRG   IF  E           K        DISK                                                   250998
     F            RETRGAF                           KIGNORE                                   250998
     F            RETRGZF                           KIGNORE                                   250998
     FREIAC   UF  E           K        DISK
     F                                              KCOMIT
     F            REIACAF                           KIGNORE
     F            REIACZF                           KIGNORE
     F                                              KINFDS IACDS
     F                                              KINFSR IACSR
     F*GEICZZ**UF**E                    DISK                      A    UC CCB003
     FREINTCPAUF  E                    DISK                      A    UC  CCB003
     F                                              KCOMIT
     FSDSTAXPDIF  E                    DISK                           UC
      *                                                                                       CDL013
     FSDSTAAL1IF  E           K        DISK                           UC                      CDL013
      ** WHT ICD extension file                                                               CDL013
      *                                                                                       CDL013
     FGLWHTCL0UF  E           K        DISK                      A    UC                      CDL013
      ** WHT Customer History file                                                            CDL013
      *                                                                                       CDL013
     FGLXTAXL0O   E                    DISK                      A    UC                      CDL013
      ** Retail WHT Extract file                                                              CDL013
      *                                                                                       CDL013
     FACCNTBY0IF  E           K        DISK                           UC                      CDL013
     F            ACCNTBD0                          KRENAMEACCNTYD0                           CDL013
      ** Account Details Extension file                                                       CDL013
      *                                                                                       CDL013
     FSDACOAL0IF  E           K        DISK                           UC                      CDL013
      ** Account Code Extension file                                                          CDL013
     FACCNTBXCIF  E           K        DISK
     FREGAHLJ2IF  E           K        DISK                           UC  CRE008
     FREZSHLJ2IF  E           K        DISK                           UC  CRE008
     FRECIEUL2IF  E           K        DISK                           UC  CRE008
     FREHPOSPPO   E           K        DISK
     F                                              KCOMIT
     F                                              KINFDS REPDS
     F                                              KINFSR REPSR
     F***GEICPD* O   E           K        DISK                                                CGL020
     FGEICPD  UF  E           K        DISK                      A                            CGL020
     F                                              KCOMIT
     F                                              KINFDS GEIDS
     F                                              KINFSR GEISR
     FINTPSDD O   E                    DISK                      A
     F                                              KCOMIT                CCB003
     FCOINTDD O   E                    DISK
     F                                              KCOMIT                CCB003
      *                                                                   CPB001
      **  End of Day interests for Private Banking Customers.             CPB001
     FRPEODIPDO   E                    DISK                               CPB001
      *                                                                   CPB001
     FREINCXPDUF  E                    DISK         KCOMIT       A        CCB003
      *                                                                   CCB003
     F*RE3664AUO***E                    PRINTER      KINFDS SPOOLU        CCB003
     FRE3664AUO   E                    PRINTER      KINFDS SPOOLU     UC  CCB003
      *                                                                   CCB003
     F*RE3664P1O***E*******     90     PRINTER       KINFDS SPOOL      UC 075073
     F*RE3664P1O***E            85     PRINTER       KINFDS SPOOL UC07507 CCB003
      *                                                                                     BUG23347
      ** Midas SD Interest Payment History File                                             BUG23347
     FSDINPHL2UF  E           K        DISK                                                 BUG23347
     F                                              KCOMIT                                  BUG23347
      *                                                                                     BUG23347
      ** Midas SD Customer Income File                                                      BUG24114
     FSDCSINLJUF  E           K        DISK         KINFSR *PSSR                            BUG24114
     F            SDCSIND0                          KRENAMESDCSINDJ                         BUG24114
      *                                                                                     BUG24114
     FSDBRCHL1IF  E                    DISK                                                 CRE083BK
     F**********SDCURRL1IF  E                    DISK                                 CRE083BKCGL165
     FSDCURRL1IF  E                    DISK                           UC                      CGL165
     FSDNARRL1IF  E                    DISK                                                 CRE083BK
     FSDWTRCL0IF  E           K        DISK                                                   CGL165
     F*
     F*                                                                   S01408
     F/COPY WNCPYSRC,RE3664FFPG                                           S01408
     F*                                                                   S01408
     F*****************************************************************
     F**          FUNCTION OF INDICATORS                              *
     F*                                                               *
     F*       26      OUTPUT CREDIT POSTING & BRT POSTING TO GEICCPD  *
     F*       27      - OUTPUT CREDIT BASE CCY EQUIV. A/C - STERLING  *
     F*               - OUTPUT DEBIT BASE CCY EQUIV. A/C - CURRENCY   *
     F*               - OUTPUT DEBIT CCY WITHHOLDING TAX A/C          *
     F*               - OUTPUT CREDIT CCY SPOT POSITION A/C.          *
     F*               - OUTPUT CREDIT STERLING WITHHOLDING TAX A/C    *
     F*               - OUTPUT DEBIT STERLING SPOT POSITION A/C       *
     F*       29      NO BASE CCY EQUIV A/C CODE FOR STERLING         *
     F*       30      CAPITALISATION IS ON DEMAND OR FOR MANGT. STATMT*
     F********35******DR*INT.*CAPITAL'N*TYPE*&*SUBTYPE*IS*ZERO        *   CCB003
     F********36******CR*INT.*CAPITAL'N*TYPE*&*SUBTYPE*IS*ZERO        *   CCB003
      *       37      Indicator for dummy read of REINCXPD            *   CCB003
      *       38      CHAIN indicator for REHISBC                     *   CCB003
     F*       40      ACCESS SUCCED ON FILE                           *
     F*       41      NO DETAILS TO REPORT                            *
     F********43******DETAILS*WRITTEN*TO*PRINTER*FILE                 *   CCB003
     F*       50      SECONDARY ACCOUNT                               *
     F********53******RETAIL*A/C*NUMBER*REQUIRED                      *   CCB003
     F*       60      RECORD FOUND ON REHISSL FILE                    *
     F*****61*->*75***POSTED*INDICATORS*ON*RE3664PR                   *   CCB003
     F*       79      MULTIBRANCHING INDICATOR                        *
     F*       80      DECIMAL POSITION IS 0                           *
     F*       81      DECIMAL POSITION IS 1                           *
     F*       82      DECIMAL POSITION IS 2                           *
     F*       83      DECIMAL POSITION IS 3                           *
     F********85******OVERFLOW*INDICATOR*ON*RE3664P1                075073CCB003
     F********87******WRITE*'END*OF*BRANCH...'*TEXT                   *   CCB003
     F*       88      SHOW STATUS ON DB ERROR REPORT                  *
     F********90      OVERFLOW INDICATOR ON RE3664PR                  *   075073
     F*    90 -> 99   USED BY /COPY SUBROUTINES                       *   075073
     F*       92      CHECK LEAP YEAR                                 *
     F*       98      DATE FORMAT IS 'M'                              *
     F*       99      ACCESS SUCCED ON FILE                           *
     F*                                                               *
     F*       LR      END OF PROGRAM                                  *
     F*                                                               *
     F*       U7      DATABASE ERROR                                  *
     F*       U8      DATABASE ERROR                                  *
     F*                                                               *
     F*****************************************************************
     F**          SUBROUTINES INDEX                                   *
     F*                                                               *
     F*   ACCPR  - Account processing                                 *
     F*   ACCSR  - Accnt file exception/error handling                *
     F*   ACRSR  - Reacr file exception/error handling                *
     F*   ALTPR  - Alternate processing                               *
     F*   CHGPR  - Charges processing                                 *
     F*   CREPR  - Credit processing                                  *
     F*   *PSSR  - Database error handling                            *
     F*   DCIND  - Checking debit/credit indicator processing         *
     F*   DEBPR  - Debit processing                                   *
     F*   FIRST  - First cycle                                        *
     F*   GEICPR - Geicpd file processing                             *
     F*   GEISR  - Geicpd file exception/error handling               *
     F*   IACSR  - Reiac file exception/error handling                *
     F*   INITPR - Work fields init processing                        *
     F*   MAIN   - Main processing                                    *
     F*   MTHEND - Establish if end of month falls between accrual    *
     F*            date and following working day                     *
     F****OVERSR*-*Processing*when*overflow*on*RE3664PR               *   CCB003
     F*   PLPR   - Profit and loss processing                         *
     F*   POSPR  - Update position records for alternate account      *
     F*            Processing                                         *
     F*   PRCHG  - Output of charges on RE3664PR                      *
     F*   PRCR   - Output of credit on RE3664PR                       *
     F*   PRDR   - Output of debit on RE3664PR                        *
     F*   REBSR  - Rehisbl file exception/error handling              *
     F****RECSR**-*Rehisbc*file*exception/error*handling              *   CCB003
     F*   RECSR  - Reintcpd file exception/error handling             *   CCB003
     F*   RELSR  - Rehisl file exception/error handling               *
     F*   REPSR  - Rehpospp file exception/error handling             *
     F*   RESSR  - Rehissl file exception/error handling              *
     F*   SETPR  - Setup accnt work fields processing                 *
     F*   SSETUP - Setup capitalisation record processing             *
     F*   SUSPR  - Suspense processing                                *
     F*   TOTAC  - Total account processing                           *
     F*   SRMOV  - Copy data from REINTCPD to REHISBC                 *   CCB003
     F*   TOTAL  - TRAILER PROCESSING                                 *
     F*   WVALD  - To add one day to VALD/HISD if LDAC not equal 'Y'  *   LN0106
     F*   ZDATE2 - To convert day number to date format               *
     F*   ZFDATE - Reformat date and ensure valid                     *
     F*   ZFRQA  - Increment a day number date by a period value      *
     F*   SRPNAR - Determine the posting narrative                    *   S01522
     F*****************************************************************
     F/EJECT
      *****************************************************************   CCB003
     E*
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZHOLE
     E*
     E                    ZA1        16  1               ZEDIT ARRAY
     E                    ZA2        16  1               ZEDIT ARRAY
     E                    CPY@    1   1 80
     E                    ABRC      900  3                                                  CRE083BK
     E                    ACUR      250  3                                                  CRE083BK
     E                    ANAR      300  2                                                  CRE083BK
     E                    ARET      250 12                                                  CRE083BK
     E                    CDAC      300 10 0                                                CRE083BK
      *                                                                                     CRE083BK
      ** Least recently used array and sorted LRU array                                     CRE083BK
      *                                                                                     CRE083BK
     E                    LRUA      300 13 0                                                CRE083BK
     E                    LRUS      300 13 0                                                CRE083BK
     E/COPY WNCPYSRC,RE3664E002
     E********************NAR        10 12                                B8200
     E********************DNAR       10 12                                B8200
     E********************NAR        10 30                           B8200057048
     E********************NAR        11 30                         057048 135401
     E**********          NAR        12 30                         135401 135809
     E********************NR16       10 16                                057048
     E********************DN07       10  7                                057048
     E********************NR16       11 16                         057048 135401
     E**********          NR16       12 16                         135401 135809
     E**********          DN07       11  7                         057048 135809
     E********************MGD        11  7                         S01522 135401
     E**********          MGD        12  7                         135401 135809
     E**********          NAR        13 30                                             135809 234438
     E**********          NR16       13 16                                             135809 234438
     E**********          DN07       13  7                                             135809 CGL029
     E**********          DN07       13  6                                             CGL029 234438
     E/COPY WNCPYSRC,RE3664E004
     E**********          MGD        13  7                                             135809 234438
     E                    NAR        14 30                                                    234438
     E                    NR16       14 16                                                    234438
     E                    DN07       14  6                                                    234438
     E                    MGD        14  7                                                    234438
     E/COPY WNCPYSRC,RE3664E003
     E                    ZFMD   12  12  2
     E                    POWER   1   7  7 3             POWER ARRAY
      *                                                                   085787
      ** Translate the JOB Name to Job Title                              085787
     E                    TAB1    1   2 10   TABA   14   ALT A/C title    085787
     E                    EUTXN2  1   1 30                                                  AR318139
     E/COPY WNCPYSRC,RE3664E001
      *                                                                                       CRE100
      ** System Values Array Definition                                                       CRE100
     E**********          SVAL    1   2 20                                           CRE100 MD034990
     E                    SVAL    1   3 20                                                  MD034990
      *****************************************************************   CCB003
     E/EJECT
      *****************************************************************   CCB003
     IACCNTXF
     I*
     I** RENAME ACCNTXF FORMAT FIELD
     I*
     I              RECI                            #RECI
     I              CNUM                            #CNUM
     I              CCY                             #CCY
     I              ACOD                            #ACOD
     I              ACSQ                            #ACSQ
     I              LTAB                            #LTAB
     I              LTAS                            #LTAS
     I              BRCA                            #BRCA
     I              ATYP                            #ATYP
     I              STYP                            #STYP
     I              MFFQ                            #MFFQ
     I              ACST                            #ACST
     I              DACO                            #DACO
     I              DACC                            #DACC
     I              ANAM                            #ANAM
     I              LDBL                            #LDBL
     I              CLBL                            #CLBL
     I              STFQ                            #STFQ
     I              STDY                            #STDY
     I              LSTD                            #LSTD
     I              NSTD                            #NSTD
     I              LSTP                            #LSTP
     I              CFSB                            #CFSB
     I              LMVD                            #LMVD
     I              EPLB                            #EPLB
     I              EPCB                            #EPCB
     I              YTDB                            #YTDB
     I              GLBT                            #GLBT
     I              ADREF1                          #ADRE1
     I              PRFC                            #PRFC
     I              LTAC                            #LTAC
     I              ORED                            #ORED
     I              DLIM                            #DLIM
     I              LRCR                            #LRCR
     I              RTCB                            #RTCB
     I              RTLB                            #RTLB
     I              DITM                            #DITM
     I              CITM                            #CITM
     I              ADREF2                          #ADRE2
     I              CDIR                            #CDIR
     I              CCIR                            #CCIR
     I              ACNO                            #ACNO
     I              RETB                            #RETB
     I              ODSC                            #ODSC
     I              ODLN                            #ODLN
     I              ODED                            #ODED
     I              DIOD                            #DIOD
     I              FACT                            #FACT
     I              FCNO                            #FCNO
     I              EFAC                            #EFAC
     I              HELD                            #HELD
     I              MINB                            #MINB
     I              LACD                            #LACD
     I              LISP                            #LISP
     I              RRNM                            #RRNM
     I              DRIB                            #DRIB
     I              DRIS                            #DRIS
     I              DRCD                            #DRCD
     I              DRIC                            #DRIC
     I              DRIF                            #DRIF
     I              DRDY                            #DRDY
     I              NDID                            #NDID
     I              LDID                            #LDID
     I              LDIA                            #LDIA
     I              SDAP                            #SDAP
     I              LPAR                            #LPAR
     I              DIIE                            #DIIE
     I              DAIC                            #DAIC
     I              MADI                            #MADI
     I              GADI                            #GADI
     I              DDIS                            #DDIS
     I              DDIA                            #DDIA
     I              OLDR                            #OLDR
     I              OLDB                            #OLDB
     I              OLDS                            #OLDS
     I              CRIB                            #CRIB
     I              CRIS                            #CRIS
     I              CRCD                            #CRCD
     I              CRIC                            #CRIC
     I              CRIF                            #CRIF
     I              CRDY                            #CRDY
     I              NCID                            #NCID
     I              LCID                            #LCID
     I              LCIA                            #LCIA
     I              SCAP                            #SCAP
     I              LPAP                            #LPAP
     I              CIIE                            #CIIE
     I              CAIC                            #CAIC
     I              MACI                            #MACI
     I              GACI                            #GACI
     I              CDIS                            #CDIS
     I              DCIA                            #DCIA
     I              OLCR                            #OLCR
     I              OLCB                            #OLCB
     I              OLCS                            #OLCS
     I              LCD                             #LCD
     I              CHTP                            #CHTP
     I              TNLU                            #TNLU
     I              ENOC                            #ENOC
     I              EPNO                            #EPNO
     I              ECFB                            #ECFB
      *                                                                   CCB003
     I***RETRGDF                                                                     250998 CRE083BK
      ****************************************************************               250998 CRE083BK
      ***Rename*RECI*field*in*RETRGDF*format**-*RETRG*file************               250998 CRE083BK
     I**********    RECI                            RECID                            250998 CRE083BK
     I**********    REBI                            REBID                            250998 CRE083BK
     IRETRGDF                                                                               MD021155
      *                                                                                     MD021155
      ** Rename RECI field in* ETRGDF format  - RETRG file                                  MD021155
     I              RECI                            RECID                                   MD021155
     I              REBI                            REBID                                   MD021155
      *                                                                                       250998
      ** RENAME REHISBC FORMAT FIELD                                      CCB003
     IREHISBP1                                                            CCB003
     I**********    RECI                            NRECI                            CCB003 CRE083BE
     I              RECID                           NRECID                                  CRE083BE
     I              BRCA                            NBRCA                 CCB003
     I              CNUM                            NCNUM                 CCB003
     I              CCY                             NCCY                  CCB003
     I              ACOD                            NACOD                 CCB003
     I              ACSQ                            NACSQ                 CCB003
     I**********    HISD                            NHISD                            CCB003 CRE083BE
     I**********    HISB                            NHISB                            CCB003 CRE083BE
     I**********    MNBL                            NMNBL                            CCB003 CRE083BE
     I**********    CHGAR                           NCHGAR                           CCB003 CRE083BE
     I**********    TCHGAR                          NTHGAR                           CCB003 CRE083BE
     I**********    CHGAN                           NCHGAN                           CCB003 CRE083BE
     I**********    TCHGAN                          NTHGAN                           CCB003 CRE083BE
     I**********    DMVT                            NDMVT                            CCB003 CRE083BE
     I**********    DICT                            NDICT                            CCB003 CRE083BE
     I**********    DRCB                            NDRCB                            CCB003 CRE083BE
     I**********    DRIR                            NDRIR                            CCB003 CRE083BE
     I**********    DRCD                            NDRCD                            CCB003 CRE083BE
     I**********    DAID                            NDAID                            CCB003 CRE083BE
     I**********    MADI                            NMADI                            CCB003 CRE083BE
     I**********    TMADI                           NTMADI                           CCB003 CRE083BE
     I**********    PDID                            NPDID                            CCB003 CRE083BE
     I**********    DMINT                           NDMINT                           CCB003 CRE083BE
     I**********    CMVT                            NCMVT                            CCB003 CRE083BE
     I**********    CICT                            NCICT                            CCB003 CRE083BE
     I**********    CRCB                            NCRCB                            CCB003 CRE083BE
     I**********    CRIR                            NCRIR                            CCB003 CRE083BE
     I**********    CRCD                            NCRCD                            CCB003 CRE083BE
     I**********    CAID                            NCAID                            CCB003 CRE083BE
     I**********    MACI                            NMACI                            CCB003 CRE083BE
     I**********    TMACI                           NTMACI                           CCB003 CRE083BE
     I**********    PCID                            NPCID                            CCB003 CRE083BE
     I**********    CMINT                           NCMINT                           CCB003 CRE083BE
     I**********    DICI                            NDICI                            CCB003 CRE083BE
     I**********    CICI                            NCICI                            CCB003 CRE083BE
     I**********    DRCI                            NDRCI                            CCB003 CRE083BE
     I**********    CRCI                            NCRCI                            CCB003 CRE083BE
     I**********    VDTC                            NVDTC                            CCB003 CRE083BE
     I**********    ADTY                            NADTY                            CCB003 CRE083BE
     I**********    ALTI                            NALTI                            CCB003 CRE083BE
     I**********    MNBCP                           NMNBCP                           CCB003 CRE083BE
     I              LGID                            NLGID                 CCB003
     I**********    VALL                            NVALL                            CCB003 CRE083BE
     I**********    LINK                            NLINK                            CCB003 CRE083BE
     I**********    AODR                            BAODR                            CRE002 CRE083BE
     I**********    ODRL                            BODRL                            CRE002 CRE083BE
     I**********    ODLI                            BODLI                            CRE002 CRE083BE
     I**********    ODIA                            BODIA                            CRE002 CRE083BE
      *                                                                   CCB003
     IREHISPDF
     I*
     I** RENAME REHISPDF FORMAT FIELDS
     I*
     I              LGID                            DLGID
      *                                                                   CCB003
     IREHISPPF
     I*
     I***RENAME*REHISPPF*FORMAT*FIELDS*-*REHISBC*FILE                     CCB003
     I***RENAME*REHISPPF*FORMAT*FIELDS*-*REINTCPD*FILE***************                CCB003 CRE083BE
      ** Rename REHISPPF format fields - REHISBC file                                       CRE083BE
     I*
     I              RECI                            BRECI
     I              BRCA                            BBRCA
     I              CNUM                            BCNUM
     I              CCY                             BCCY
     I              ACOD                            BACOD
     I              ACSQ                            BACSQ
     I              HISD                            BHISD
     I              HISB                            BHISB
     I              MNBL                            BMNBL
     I              CHGAR                           BCHGAR
     I              TCHGAR                          BTHGAR
     I              CHGAN                           BCHGAN
     I              TCHGAN                          BTHGAN
     I              DMVT                            BDMVT
     I              DICT                            BDICT
     I              DRCB                            BDRCB
     I              DRIR                            BDRIR
     I              DRCD                            BDRCD
     I              DAID                            BDAID
     I              MADI                            BMADI
     I              TMADI                           BTMADI
     I              PDID                            BPDID
     I              DMINT                           BDMINT
     I              CMVT                            BCMVT
     I              CICT                            BCICT
     I              CRCB                            BCRCB
     I              CRIR                            BCRIR
     I              CRCD                            BCRCD
     I              CAID                            BCAID
     I              MACI                            BMACI
     I              TMACI                           BTMACI
     I              PCID                            BPCID
     I              CMINT                           BCMINT
     I              DICI                            BDICI
     I              CICI                            BCICI
     I              DRCI                            BDRCI
     I              CRCI                            BCRCI
     I              VDTC                            BVDTC
     I              ADTY                            BADTY
     I              ALTI                            BALTI
     I              MNBCP                           BMNBCP
     I              LGID                            BLGID
     I              VALL                            BVALL
     I              LINK                            BLINK
      *                                                                   CCB003
     IREACRDF
     I*
     I** RENAME REACRDF  FORMAT FIELDS - REACRD  FILE
     I*
     I              RECI                            RERECI
     I              CUST                            RECUST
     I              ACCY                            REACCY
     I              ACOD                            REACOD
     I              ASEQ                            REASEQ
     I              BRCA                            REBRCA
     I              LCD                             RELCD
      *                                                                   CCB003
     IREHISPSF
     I*
     I** RENAME REHISPSF FORMAT FIELDS - REHISSL FILE
     I*
     I              RECI                            SRECI
     I              BRCA                            SBRCA
     I              CNUM                            SCNUM
     I              CCY                             SCCY
     I              ACOD                            SACOD
     I              ACSQ                            SACSQ
     I              HISD                            SHISD
     I              HISB                            SHISB
     I              MNBL                            SMNBL
     I              TCHGAR                          SCHGAR
     I              TCHGAN                          SCHGAN
     I              DICT                            SDICT
     I              DRCB                            SDRCB
     I              DRIR                            SDRIR
     I              DRCD                            SDRCD
     I              TMADI                           SMADI
     I              PDID                            SPDID
     I              DMINT                           SDMINT
     I              CICT                            SCICT
     I              CRCB                            SCRCB
     I              CRIR                            SCRIR
     I              CRCD                            SCRCD
     I              TMACI                           SMACI
     I              PCID                            SPCID
     I              CMINT                           SCMINT
     I              DRBR                            SDRBR                 123519
     I              CRBR                            SCRBR                 123519
     I              CHBR                            SCHBR                 123519
     I              AODR                            SAODR                 CRE002
     I              ODRL                            SODRL                 CRE002
     I              ODIA                            SODIA                 CRE002
      *                                                                   CCB003
     IACCRACJF
     I*
     I** RENAME ACCRACJF FORMAT FIELDS - ACCRACJ FILE
     I*
     I              RECI                            ARECI
     I              CNUM                            ACCNUM
     I              CCY                             ACCCY
     I              ACOD                            AACOD
     I              ACSQ                            AACSQ
     I              BRCA                            ABRCA
     I              ATYP                            AATYP
     I              ACNO                            AACNO
     I              DRCD                            ADRCD
     I              DAIC                            ADAIC
     I              CRCD                            ACRCD
     I              CAIC                            ACAIC
     I              DICT                            ADICT
     I              CICT                            ACICT
     I              HISB                            AHISB
     I              TEGLIS                          REGLIS
      *                                                                   CCB003
     IACNUMABF
     I*
     I** RENAME ACNUMABF FORMAT FIELDS - ACNUM FILE
     I*
     I              RECI                            RRRECI
     I              ACNO                            RACNO
     I              CNUM                            RCNUM
     I              CCY                             RCCY
     I              ACOD                            RACOD
     I              ACSQ                            RACSQ
     I              ATYP                            RATYP
     I              BRCA                            RBRCA
     I*                                                                   CAC001
     IREACNMF                                                             CAC001
     I              RECI                            TRECI                 CAC001
     I              ACNO                            TACNO                 CAC001
     I              CNUM                            TCNUM                 CAC001
     I              CCY                             TCCY                  CAC001
     I              ACOD                            TACOD                 CAC001
     I              ACSQ                            TACSQ                 CAC001
     I              ATYP                            TATYP                 CAC001
     I              BRCA                            TBRCA                 CAC001
     I              PRFC                            TPRFC                 CAC001
      *                                                                   CCB003
     IACCNTABF
     I*
     I** RENAME ACCNTABF FORMAT FIELDS - ACCNT FILE
     I*
     I              RECI                            AARECI
     I              ACNO                            AAACNO
     I              CNUM                            AACNUM
     I              CCY                             AACCY
     I              ACOD                            AAACOD
     I              ACSQ                            AAACSQ
     I              ATYP                            AAATYP
     I************* BRCA                            ABRCA                 049320
     I              BRCA                            AABRCA                049320
     I              PRFC                            AAPRFC                CAC001
     I              RRNM                            ARRNM
     I              DRIS                            ADRIS
     I              DRCD                            ADRCD
     I              DAIC                            ADAIC
     I              MADI                            AMADI
     I              GADI                            AGADI
     I              CRIS                            ACRIS
     I              CRCD                            ACRCD
     I              CAIC                            ACAIC
     I              MACI                            AMACI
     I              GACI                            AGACI
     I              BRTCA                           ABRTCA
     I              NACSG                           ANACSG
      *                                                                   CCB003
     IRECRGDF
     I*
     I** RENAME RECRGDF FORMAT FIELDS - RECRG FILE
     I*
     I              RECI                            RRECI
     I              ACOD                            CACOD
      *                                                                   CCB003
      ** RENAME REINCXD0 FORMAT FIELDS - REINCXPD FILE                    CCB003
     IREINCXD0                                                            CCB003
     I              CNUM                            RACNUM                CCB003
     I              CCY                             RACCY                 CCB003
     I              ACOD                            RAACOD                CCB003
     I              ACSQ                            RAACSQ                CCB003
     I              BRCA                            RABRCA                CCB003
     I              ACNO                            RAACNO                CCB003
     I              POST                            RAPOST                CCB003
     I              CPDA                            RACPDA                CCB003
     I              INTR                            RAINTR                CCB003
     I              INTP                            RAINTP                CCB003
     I              INST                            RAINST                CCB003
     I              MADJ                            RAMADJ                CCB003
     I              GADT                            RAGADT                CCB003
     I              AIAP                            RAAIAP                CCB003
     I              PTFL                            RAPTFL                CCB003
     I*
     ISDBRTDD0
     I              ACOD                            ACOD1
      *                                                                                       CGL020
     IAPOSTPDF                                                                                CGL020
     I              ACKEY                           ACKFLD                                    CGL020
     I**  Access BRT
     I/COPY WNCPYSRC,RE3664I001
     I*
     IACXDS       DS
     I                                     *STATUS  STSACX
     IACCDS       DS
     I                                     *STATUS  STSACC
     IACRDS       DS
     I                                     *STATUS  STSACR
     IIACDS       DS
     I                                     *STATUS  STSIAC
     IREBDS       DS
     I                                     *STATUS  STSREB
     IRECDS       DS
     I                                     *STATUS  STSREC
     IRELDS       DS
     I                                     *STATUS  STSREL
     IREPDS       DS
     I                                     *STATUS  STSREP
     IRESDS       DS
     I                                     *STATUS  STSRES
     IGEIDS       DS
     I                                     *STATUS  STSGEI
     I*
     I** DATA STRUCTURE FOR CURRENCY DECIMAL
     I*
     I            DS
     I                                        1  150MADI0
     I                                        1  151MADI1
     I                                        1  152MADI2
     I                                        1  153MADI3
     I*
     I            DS
     I                                        1  150GADI0
     I                                        1  151GADI1
     I                                        1  152GADI2
     I                                        1  153GADI3
     I*
     I            DS
     I                                        1  150DRCP0
     I                                        1  151DRCP1
     I                                        1  152DRCP2
     I                                        1  153DRCP3
     I*
     I            DS
     I                                        1  150MACI0
     I                                        1  151MACI1
     I                                        1  152MACI2
     I                                        1  153MACI3
     I*
     I            DS
     I                                        1  150GACI0
     I                                        1  151GACI1
     I                                        1  152GACI2
     I                                        1  153GACI3
     I*
     I            DS
     I                                        1  150CRCP0
     I                                        1  151CRCP1
     I                                        1  152CRCP2
     I                                        1  153CRCP3
     I*
     I*********** DS                                                      CCB003
     I***********                             1  150CHCP0                 CCB003
     I***********                             1  151CHCP1                 CCB003
     I***********                             1  152CHCP2                 CCB003
     I***********                             1  153CHCP3                 CCB003
     I*
     I** DATA STRUCTURE FOR DATE FORMAT DD/MM/YY
     I*
     I            DS
     I                                        1   60RESULT
     I                                        1   20ZDAY
     I                                        3   40ZMTH
     I                                        5   60ZYEAR
     I*                                                                   CRE002
     I** Data Structure for Capitalisation Narrative                      CRE002
     I*                                                                   CRE002
     I            DS                                                      CRE002
     I                                        1  14 NR16DS                CRE002
     I                                        1   7 NR16P1                CRE002
     I                                        8  14 NR16P2                CRE002
     I/COPY WNCPYSRC,REH00429
     I*
     I** KEYS DATA STRUCTURE : RKEY TO FILL DBKEY IF ERROR
     I**                       AKEY TO FILL DBKEY IF ERROR
     I*
     I            DS
     I**********                              1  20 RKEY                                      CGL029
     I**********                              3  20 AKEY                                      CGL029
     I                                        1  26 RKEY                                      CGL029
     I                                        3  26 AKEY                                      CGL029
     I                                        1   2 LGID
     I                                        3   5 BBRCA
     I**********                              6  20 RKEY4                                     CGL029
     I                                        6  26 RKEY4                                     CGL029
     I**********                              6  110BCNUM                                     CSD027
     I                                        6  11 BCNUM                                     CSD027
     I                                       12  14 BCCY
     I**********                             15  180BACOD                                     CGL029
     I**********                             19  200BACSQ                                     CGL029
     I**********                             21  39 RKEY2                                     CGL029
     I**********                             21  23 BRCA                                      CGL029
     I**********                             24  290CNUM                                      CGL029
     I**********                             30  32 CCY                                       CGL029
     I**********                             33  360ACOD                                      CGL029
     I**********                             37  380ACSQ                                      CGL029
     I                                       15  240BACOD                                     CGL029
     I                                       25  260BACSQ                                     CGL029
     I                                       27  50 RKEY2                                     CGL029
     I                                       27  29 BRCA                                      CGL029
     I**********                             30  350CNUM                               CGL029 CSD027
     I                                       30  35 CNUM                                      CSD027
     I                                       36  38 CCY                                       CGL029
     I                                       39  480ACOD                                      CGL029
     I                                       49  500ACSQ                                      CGL029
     I*
     I** DATA STRUCTURE : WORK RETAIL OR ACCOUNT KEY
     I*
     I            DS
     I**********                              1  18 WALT                                      CGL029
     I                                        1  24 WALT                                      CGL029
     I**********                              1   60WCNUM                                     CSD027
     I                                        1   6 WCNUM                                     CSD027
     I                                        7   9 WCCY
     I**********                             10  130WACOD                                     CGL029
     I**********                             14  150WACSQ                                     CGL029
     I**********                             16  18 WBRCA                                     CGL029
     I                                       10  190WACOD                                     CGL029
     I                                       20  210WACSQ                                     CGL029
     I                                       22  24 WBRCA                                     CGL029
     I                                       11  15 WALT5
     I                                        1  100WALT10
     I*
     I** KEY DATA STRUCTURE : CHKEY TO CHAIN TO RECRG FILE
     I*
     I            DS
     I                                        1  12 CHKEY
     I                                        1   1 ZZ001
     I                                        2   30CHGT
     I                                        4   80CHST
     I                                        9  11 ACCCY
     I                                       12  12 ENDK
      *                                                                                       232543
      ** Key Data Structure : Key Fields for SDCSINPD LFs                                     232543
      *                                                                                       232543
     I            DS                                                                          232543
     I                                        1   20KACSQ                                     232543
     I**********                              3   80KJOIN                             232543 CSD027A
     I                                        3   8 KJOIN                                    CSD027A
     I*
     I** DATA STRUCTURE : TO CHECK SAME ACCOUNT
     I*
     I            DS
     I**********                              1  18 OKEY                                      CGL029
     I                                        1  24 OKEY                                      CGL029
     I**********                              1   60OCNUM                                     CSD027
     I                                        1   6 OCNUM                                     CSD027
     I                                        7   9 OCCY
     I**********                             10  130OACOD                                     CGL029
     I**********                             14  150OACSQ                                     CGL029
     I**********                             16  18 OBRCA                                     CGL029
     I                                       10  190OACOD                                     CGL029
     I                                       20  210OACSQ                                     CGL029
     I                                       22  24 OBRCA                                     CGL029
     I** DATA STRUCTURE : TO CHECK RETRG                                                      250998
      *                                                                                       250998
     ITRGDS       DS                                                                          250998
     I                                        1   3 BLNKS                                     250998
     I**********                              4   80DTRTY                            250998 CRE083BK
     I                                        4   8 DTRTY                                   CRE083BK
     I                                        9  11 DCCY                                      250998
     I                                       12  12 D                                         250998
      *                                                                                       250998
     I*
     I** DATA STRUCTURE : POSTING NARRATIVE
     I*
     I            DS
     I                                        1  30 NARS
     I************                            1  19 NAR1                  B8200
     I                                        1  30 NAR1                  B8200
     I            DS
     I**********                              1  22 WNARS                                     CGL029
     I                                        1  24 WNARS                                     CGL029
     I                                        1   3 XBRCA
     I**********                              4   4 TIR1                                      CGL029
     I**********                              5  100XCNUM                                     CGL029
     I**********                              5  10 XCNUMA                             CRE008 CGL029
     I**********                             11  11 TIR2                                      CGL029
     I**********                             12  14 XCCY                                      CGL029
     I**********                             15  15 TIR3                                      CGL029
     I**********                             16  190XACOD                                     CGL029
     I**********                             20  20 TIR4                                      CGL029
     I**********                             21  220XACSQ                                     CGL029
     I**********                             21  22 XACSQA                             CRE008 CGL029
     I**********                             23  32 WACNO                                     CGL029
     I**********                             23  320WACN0                                     CGL029
     I**********                              4   90XCNUM                              CGL029 CSD027
     I                                        4   9 XCNUM                                     CSD027
     I                                        4   9 XCNUMA                                    CGL029
     I                                       10  12 XCCY                                      CGL029
     I                                       13  220XACOD                                     CGL029
     I                                       23  240XACSQ                                     CGL029
     I                                       23  24 XACSQA                                    CGL029
     I                                       25  34 WACNO                                     CGL029
     I                                       25  340WACN0                                     CGL029
     I*
     I** DATA STRUCTURE : POSTING NARRATIVE
     I*
     I            DS
     I                                        1   64NEXRT
     I*
     I** DATA STRUCTURE : HOLIDAY DATE
     I*
     I            DS
     I                                        1  12 KEY
     I                                        8  120HOL
     I*
     I**   FILE INFORMATION DATA STRUCTURE
     I**
     I*SPOOL*******DS                                                     CCB003
     I*************                          83  92 SFILE                 CCB003
     I*************                       B 123 1240SFNUM                 CCB003
      *                                                                   CCB003
     ISPOOLU      DS
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
     I/COPY WNCPYSRC,RE3664I004
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA       EUDSLDA                         256                       CCB003
      *                                                                   CCB003
     I*LDA******* UDS                            256                      CCB003
     I***********                           134 141 DBFILE                CCB003
     I***********                           142 170 DBKEY                 CCB003
     I***********                           171 180 DBPGM                 CCB003
     I***********                           181 1830DBASE                 CCB003
     I*
     I/COPY WNCPYSRC,RE3664I002
     IRUNDT       DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     I*
     I**  Data Area RUNDAT
     I*
      ** Commitment control size                                          CCB003
     ICBTASK    E DSCBTASKSP                                              CCB003
     I*
     IDSFDY     E DSDSFDY
     I*
     I** First DS for access programs, Short data structure
     I*
     IDSSDY     E DSDSSDY
     I*
     I** Second DS for access progrmas, Long data structure
     I*
     IDSLDY     E DSDSLDY                                                 CPB001
     I*                                                                   CPB001
     I** Third DS for access progrmas, Very Long data structure           CPB001
     I*                                                                   CPB001
     ISDBANK    E DSSDBANKPD
     I              BJURPT                          TITL
     I              BJCYCD                          BACCY
     I              BJDNWD                          DNWD
     I*
     I** Bank Details
     I*
     I***SDBRCH*   E DSSDBRCHPD                                                             CRE083BK
     ISDBRCH    E DSSDBRCHPD                900                                             CRE083BK
     I***********   A8BRNM                          BRNM                  CCB003
     I              A8BICN                          BICN
     I              A8DTAC                          NBACB
     I*
     I**  External DS for Branch Codes.
     I*
     I***SDCURR*   E DSSDCURRPD                                                             CRE083BK
     ISDCURR    E DSSDCURRPD                250                                             CRE083BK
     I              A6NBDP                          CDP
     I              A6SPRT                          SPOT
     I              A6MDIN                          MDIN
     I              A6ERLC                          ERLC
     I              A6TXND                          TNOT
     I              A6CYNM                          CCNM
     I              A6SPAE                          TACC
     I              A6SSNB                          SSNO
     I              A6TXCR                          TXCR                                      CGL165
     I*
     I**  External DS for Currency Codes.
     I*
     ISDGELR    E DSSDGELRPD
     I*****         BKAPDT                          APDA
     I              BKACCD                          COMS
     I              BKPRCU                          PCUS                  184965
     I              BKPCDU                          PCMU                  184965
     I*
     I**  General Ledger Details.
     I*
     ISDRETL    E DSSDRETLPD
     I              BMLDAI                          LDAC
     I              BMCBAI                          CBAI
     I              BMNDFV                          NDFV
     I              BMNDBI                          NDBI
     I              BMRCPI                          RCPT
     I              BMRANR                          RACN
     I              QQACCD                          QQACC1                                    CGL029
     I*
     I**  Retail Details
     I*
     ISDTRAD    E DSSDTRADPD
     I              BLSPTA                          SPAC
     I              QQACCD                          QQACC2                                    CGL029
     I*
     I**  Trading Details.
     I*
     ISDMMOD    E DSSDMMODPD
     I*
     I**  Access Midas Modules.
     I*
     ISDCTRY    E DSSDCTRYPD                                              CRE007
      ** Country Code Details                                             CRE007
      *                                                                   CRE007
     ISCSARD    E DSSCSARDPD                                              S01522
     I* SAR file details accessed via access program AOSARDR0             S01522
     I*                                                                   S01522
     ISDPCAC    E DSSDPCACPD                                              CAC001
     I**  Profit Centre Accounting ICD                                    CAC001
     I*                                                                   CAC001
     ISDPRFC    E DSSDPRFCPD                                              CAC001
     I**  Profit Centre Details                                           CAC001
     I*                                                                   CAC001
     ICGPNAR    E DSCGPNARPD                                              S01522
      * UDC Multi Language Narrative Datastructure                        S01522
     I/COPY WNCPYSRC,RE3664I005
      *                                                                   S01522
     I##PRM1      DS                                                      086125
      **  Data Structure for Customer and Branch                          086125
      *                                                                   086125
     I                                        1   6 A#CUST                086125
     I                                        7   9 A#BRCA                086125
      *                                                                   086125
     I***SDNARR*   E DSSDNARRPD                                                             CRE083BK
     ISDNARR    E DSSDNARRPD                300                                             CRE083BK
     I              ALDON                           NARD
     I*
     I**  Narrative Codes.
     I*
     I***SDACOD*   E DSSDACODPD                                                             CRE083BK
     ISDACOD    E DSSDACODPD                300                                             CRE083BK
     I              QQACCD                          QQACC4                                    CGL029
     I              QQFNIC                          QQFNI1                                    CGL029
     I              QQFNAA                          QQFNA1                                    CGL029
     I*
     I**  Access Account Codes.
     I*
     ISDCUST    E DSSDCUSTPD
     I              BBCRNM                          CRNM
     I              QQDFAC                          QQDFA1                                    CGL029
     I*
     I**  Access Account Codes.
     I*
     I/COPY ZSRSRC,ZHOLI
     I/COPY WNCPYSRC,RE3664I003
     I*
      ** Data Structure for Country of Tax Codes                                              CER048
      *                                                                                       CER048
     ISDCTTX    E DSSDCTTXPD                                                                  CER048
      *                                                                                       CER048
      ** Data Structure for Location Codes                                                    CER048
      *                                                                                       CER048
     ISDLOCN    E DSSDLOCNPD                                                                  CER048
     ISDRETR    E DSRETRGD                  250                                             CRE083BK
     I              RECI                            RECID                                   CRE083BK
     I              REBI                            REBID                                   CRE083BK
     I              KEY                             KEYD                                    CRE083BK
     I              LCD                             LCDD                                    CRE083BK
     I              ZZ001                           ZZ001D                                  CRE083BK
     I/COPY OFCPYSRCZ,CRE105_007                                                              CRE105
     IKYRETR      DS                             12                                         MD021155
     I                                        1   3 RETRBK                                  MD021155
     I                                        4   8 RETRID                                  MD021155
     I                                        9  11 RETRCY                                  MD021155
     I                                       12  12 RETRRC                                  MD021155
      *                                                                   085787
     IPGMDS      SDS                                                      085787
      * Pgm/Job information System-DS                                     085787
     I                                        1  10 PGNAME                085787
     I                                       81  90 PGLIBR                085787
     I                                      244 253 PGJBNM                085787
     I                                      254 263 PGUSER                085787
     I                                      264 269 PGJBNO                085787
      *                                                                   085787
      ** Data Structure for Finishing Date                                                    CER048
      *                                                                                       CER048
     I            DS                                                                          CER048
     I                                        1   60FRES                                      CER048
     I                                        1   20ZIFD                                      CER048
     I                                        3   40ZIFM                                      CER048
     I                                        5   60ZIFY                                      CER048
      *                                                                                       CER048
      ** Data Structure for Finishing Date MM/DD/YY                                           CER048
      *                                                                                       CER048
     I            DS                                                                          CER048
     I                                        1   60FRESX                                     CER048
     I                                        1   20ZIFMX                                     CER048
     I                                        3   40ZIFDX                                     CER048
     I                                        5   60ZIFYX                                     CER048
      *                                                                                       CER048
      ** Data structure for Begining date                                                     CER048
      *                                                                                       CER048
     I            DS                                                                          CER048
     I                                        1   60SRES                                      CER048
     I                                        1   20ZISD                                      CER048
     I                                        3   40ZISM                                      CER048
     I                                        5   60ZISY                                      CER048
      *                                                                                       CER048
      ** Data Structure for Begining Date MM/DD/YY                                            CER048
      *                                                                                       CER048
     I            DS                                                                          CER048
     I                                        1   60SRESX                                     CER048
     I                                        1   20ZISMX                                     CER048
     I                                        3   40ZISDX                                     CER048
     I                                        5   60ZISYX                                     CER048
      *                                                                                       CER048
      ** Data Structure for Date in DD/MM/YY                                                  CER048
      *                                                                                       CER048
     I            DS                                                                          CER048
     I                                        1   60WDATE6                                    CER048
     I                                        1   20WDD                                       CER048
     I                                        3   40WMM                                       CER048
     I                                        5   60WYY                                       CER048
      *                                                                                       CER048
     I              'REC64A    '          C         REC64A                085787
     I              'REC64N    '          C         REC64N                085787
     I              'BasCcyTaxRoundDown'  C         C#BASE                                    CDL081
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                    CDL081
      *                                                                   085787
     I              'MAIN TAX'            C         CPRITX                                  BUG23163
     I              'SECONDARY TAX'       C         C2NDTX                                  BUG23163
     I              'THIRD TAX'           C         C3RDTX                                  BUG24341
     I              'EU TAXATION'         C         EUTAXN                                 BUG23163A
     I              'PostNetInterest   '  C         PSNET                                   AR831847
      *                                                                                     BUG23163
     I/COPY WNCPYSRC,RE3664IIPG                                           S01408
     I*                                                                   S01408
      *                                                                                     CRE083BE
      ** End Record Key Data Structure                                                      CRE083BE
      *                                                                                     CRE083BE
     I            DS                                                                        CRE083BE
     I                                        1  26 ENDKEY                                  CRE083BE
     I                                        1   2 JLGID                                   CRE083BE
     I                                        3   5 JBRCA                                   CRE083BE
     I                                        6  11 JCNUM                                   CRE083BE
     I                                       12  14 JCCY                                    CRE083BE
     I                                       15  240JACOD                                   CRE083BE
     I                                       25  260JACSQ                                   CRE083BE
      *                                                                                     CRE083BE
      ** Next Record Key Data Structure                                                     CRE083BE
      *                                                                                     CRE083BE
     I            DS                                                                        CRE083BE
     I                                        1  26 NXTKEY                                  CRE083BE
     I                                        1   2 YLGID                                   CRE083BE
     I                                        3   5 YBRCA                                   CRE083BE
     I                                        6  11 YCNUM                                   CRE083BE
     I                                       12  14 YCCY                                    CRE083BE
     I                                       15  240YACOD                                   CRE083BE
     I                                       25  260YACSQ                                   CRE083BE
      *                                                                                     CRE083BE
      ** Last Record Key Data Structure                                                     CRE083BE
      *                                                                                     CRE083BE
     I            DS                                                                        CRE083BE
     I                                        1  26 LSTKEY                                  CRE083BE
     I                                        1   2 LLGID                                   CRE083BE
     I                                        3   5 LBRCA                                   CRE083BE
     I                                        6  11 LCNUM                                   CRE083BE
     I                                       12  14 LCCY                                    CRE083BE
     I                                       15  240LACOD                                   CRE083BE
     I                                       25  260LACSQ                                   CRE083BE
     I/EJECT
     C*===================================================================
     C                     MOVEACPY@      BIS@   80
     C*
     C** KEY LISTS
     C*
     C/COPY WNCPYSRC,RE3664CP26                                           S01408
      *                                                                                       CDL013
      ** Set up a key list to access GLWHTCL0                                                 CDL013
     C           HISKEY    KLIST                                                              CDL013
     C                     KFLD           ECUST                                               CDL013
     C                     KFLD           EDLAC                                               CDL013
     C                     KFLD           EDAIN                                               CDL013
     C*
     C** KEY FIELD TO ACCESS TO REHISL  FILE
     C*
     C           R3KEY     KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           HISD
      *                                                                                       CER048
      ** Partial key list to access REHISL file                                               CER048
      *                                                                                       CER048
     C           R3KEYA    KLIST                                                              CER048
     C                     KFLD           BRCA                                                CER048
     C                     KFLD           CNUM                                                CER048
     C                     KFLD           CCY                                                 CER048
     C                     KFLD           ACOD                                                CER048
     C                     KFLD           ACSQ                                                CER048
      *                                                                                     BUG23347
      ** Key list to access SDINPHPD file                                                   BUG23347
      *                                                                                     BUG23347
     C           R3KEYB    KLIST                                                            BUG23347
     C                     KFLD           KCNUM   6                                         BUG23347
     C                     KFLD           KBRCH   3                                         BUG23347
      *                                                                                     BUG24114
     C           KCILJ     KLIST                                                            BUG24114
     C                     KFLD           KMODI                                             BUG24114
     C                     KFLD           KCUST                                             BUG24114
     C                     KFLD           KSCCY                                             BUG24114
     C                     KFLD           KACDE                                             BUG24114
     C                     KFLD           KACSQ                                             BUG24114
     C                     KFLD           KBRCA                                             BUG24114
     C                     KFLD           KRDNB                                             BUG24114
     C*
     C** KEY FIELD TO ACCESS TO REHISBL FILE
     C*
     C           R2KEY     KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C*
     C** KEY FIELD TO ACCESS TO REHISSL FILE
     C*
     C***********R1KEY     KLIST                                          CCB003
     C***********          KFLD           LGID                            CCB003
     C***********          KFLD           BBRCA                           CCB003
     C***********          KFLD           BCNUM                           CCB003
     C***********          KFLD           BCCY                            CCB003
     C***********          KFLD           BACOD                           CCB003
     C***********          KFLD           BACSQ                           CCB003
     C*
     C** KEY FIELD TO ACCESS TO ACCRACJ FILE
     C*
     C********** ACKEY     KLIST                                                              CGL029
     C           ACKEY2    KLIST                                                              CGL029
     C                     KFLD           BBRCA
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C*
     C           ACKEY1    KLIST
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C                     KFLD           BBRCA
     C*
     C** KEY FIELD TO ACCESS TO ACCNT/REACR/REIAC FOR UPDATE
     C*
     C           R4KEY     KLIST
     C                     KFLD           BCNUM
     C                     KFLD           BCCY
     C                     KFLD           BACOD
     C                     KFLD           BACSQ
     C*
     C** KEY FIELD TO ACCESS TO ACCNT FILE
     C*
     C           WALTK     KLIST
     C                     KFLD           WCNUM
     C                     KFLD           WCCY
     C                     KFLD           WACOD
     C                     KFLD           WACSQ
     C                     KFLD           WBRCA
     C*****                                                               NNN
     C***** KEY FIELD TO ACCESS TO REHISBC FILE                           NNN
     C*****                                                               NNN
     C***********RBKEY     KLIST                                          NNN
     C***********          KFLD           BLGID                           NNN
     C***********          KFLD           BBRCA                           NNN
     C***********          KFLD           BCNUM                           NNN
     C***********          KFLD           BCCY                            NNN
     C***********          KFLD           BACOD                           NNN
     C***********          KFLD           BACSQ                           NNN
      *                                                                   CCB003
      ** Key field to access REHISBC file                                 CCB003
     C           KKEY01    KLIST                                          CCB003
     C                     KFLD           BLGID                           CCB003
     C                     KFLD           BBRCA                           CCB003
     C                     KFLD           BCNUM                           CCB003
     C                     KFLD           BCCY                            CCB003
     C                     KFLD           BACOD                           CCB003
     C                     KFLD           BACSQ                           CCB003
      *                                                                                     CRE083BE
      ** Key field to access first record of REHISBC file                                   CRE083BE
      *                                                                                     CRE083BE
     C           REHKEY    KLIST                                                            CRE083BE
     C                     KFLD           YLGID                                             CRE083BE
     C                     KFLD           YBRCA                                             CRE083BE
     C                     KFLD           YCNUM                                             CRE083BE
     C                     KFLD           YCCY                                              CRE083BE
     C                     KFLD           YACOD                                             CRE083BE
     C                     KFLD           YACSQ                                             CRE083BE
      *                                                                                       232543
      ** Key fields to access LF/SDCSINL7.                                                    232543
      *                                                                                       232543
     C           KCIL7     KLIST                                                              232543
     C                     KFLD           KRDNB   50                                          232543
     C                     KFLD           KMODI   1                                           232543
     C                     KFLD           KCUST   6                                           232543
     C                     KFLD           KSCCY   3                                           232543
     C                     KFLD           KACDE                                               232543
     C                     KFLD           KACSQ                                               232543
     C                     KFLD           KBRCA   3                                           232543
      *                                                                                       232543
      ** Key fields to access LF/SDCSINLC.                                                    232543
      *                                                                                       232543
     C           KCILC     KLIST                                                              232543
     C                     KFLD           KRDNB                                               232543
     C                     KFLD           KMODI                                               232543
     C                     KFLD           KJOIN                                               232543
     C                     KFLD           KSCCY                                               232543
     C                     KFLD           KACDE                                               232543
     C                     KFLD           KACSQ                                               232543
     C                     KFLD           KBRCA                                               232543
      *                                                                                     CRE083BE
      ** Key Fields for pointer                                                             CRE083BE
      *                                                                                     CRE083BE
     C*
     C** WORK FIELDS DEFINITION
     C*
     C           *LIKE     DEFN TRAT      WTRAT
     C           *LIKE     DEFN LGID      WLGID
     C           *LIKE     DEFN BKAPDT    NAPDA
     C           *LIKE     DEFN GADI      RGADI
     C           *LIKE     DEFN GACI      RGACI
     C           *LIKE     DEFN DAIC1     RDAIC
     C           *LIKE     DEFN CAIC1     RCAIC
     C           *LIKE     DEFN ATYP      WCOMST
     C           *LIKE     DEFN ATYP      WCAPDT
     C           *LIKE     DEFN ATYP      WCAPCT
     C           *LIKE     DEFN ATYP      WDIACT
     C           *LIKE     DEFN ATYP      WDIADT
     C           *LIKE     DEFN ATYP      WCIADT
     C           *LIKE     DEFN ATYP      WCIACT
     C           *LIKE     DEFN ATYP      WCHGT
     C********** *LIKE     DEFN CNUM      WDATE - 1                                           CSD027
     C                     Z-ADD*ZEROS    WDATE   50                                          CSD027
     C           *LIKE     DEFN RECI      WDRCR
     C           *LIKE     DEFN DAIC      WPSTA
     C           *LIKE     DEFN RUND      CNDID
     C           *LIKE     DEFN RUND      CNCID
     C           *LIKE     DEFN RUND      CTLDAT
     C********** *LIKE     DEFN CNUM      IND   - 3                                           CSD027
     C                     Z-ADD*ZEROS    IND     30                                          CSD027
     C           *LIKE     DEFN KEY       ERRDAT
     C********** *LIKE     DEFN CNUM      ZERROR- 5                                           CSD027
     C                     Z-ADD*ZEROS    ZERROR  10                                          CSD027
     C           *LIKE     DEFN NORE1     WNORE
     C           *LIKE     DEFN CDP       WBCDP
     C           *LIKE     DEFN SPOT      WBSPOT
     C           *LIKE     DEFN MDIN      WBMDIN
     C           *LIKE     DEFN TACC      WBTACC
     C           *LIKE     DEFN CDP       WOCDP
     C           *LIKE     DEFN SPOT      WOSPOT
     C           *LIKE     DEFN MDIN      WOMDIN
     C           *LIKE     DEFN TACC      WOTACC
     C           *LIKE     DEFN CDP       WACDP
     C           *LIKE     DEFN SPOT      WASPOT
     C           *LIKE     DEFN MDIN      WAMDIN
     C           *LIKE     DEFN TACC      WATACC
     C           *LIKE     DEFN CCY       ALCCY
     C           *LIKE     DEFN ACOD      ALACOD
     C           *LIKE     DEFN ACSQ      ALACSQ
     C           *LIKE     DEFN BRCA      ALBRCA
     C           *LIKE     DEFN CNUM      ALCNUM
     C           *LIKE     DEFN BICN      BBICN
     C           *LIKE     DEFN BICN      ALBICN
     C           *LIKE     DEFN BICN      BKBICN
     C           *LIKE     DEFN PSTA      WOPSTA
     C           *LIKE     DEFN PSTA      WPSTAA
     C           *LIKE     DEFN PSTA      WPSTAB
     C           *LIKE     DEFN DEXRT     EXRT
     C           *LIKE     DEFN A5DIPD    WDIPD
     C           *LIKE     DEFN A5DIPC    WDIPC
     C           *LIKE     DEFN A5CIPC    WCIPC
     C           *LIKE     DEFN A5CISU    WCISU
     C           *LIKE     DEFN A5CINS    WCINS
     C           *LIKE     DEFN A5WTAC    WWTAC
     C           *LIKE     DEFN A5MISU    WMISU
     C           *LIKE     DEFN A5ACTY    WTDIPD
     C           *LIKE     DEFN A5ACTY    WTDIPC
     C           *LIKE     DEFN A5ACTY    WTCIPC
     C           *LIKE     DEFN A5ACTY    WTCISU
     C           *LIKE     DEFN A5ACTY    WTCINS
     C           *LIKE     DEFN A5ACTY    WTWTAC
     C           *LIKE     DEFN ACOD      CIAC
     C           *LIKE     DEFN ACOD      CIAD
     C           *LIKE     DEFN ACOD      DIAC
     C           *LIKE     DEFN ACOD      DIAD
     C           *LIKE     DEFN ACOD      CAPC
     C           *LIKE     DEFN ACOD      CAPD
     C           *LIKE     DEFN NBACB     BNBACB
     C           *LIKE     DEFN A5ACTY    BNBACT
     C           *LIKE     DEFN NBACB     BNDFAC
     C           *LIKE     DEFN A5ACTY    BNDFAT
     C           *LIKE     DEFN A5ACTY    WATACT
     C           *LIKE     DEFN A5ACTY    WOTACT
     C           *LIKE     DEFN A5ACTY    WBTACT
     C           *LIKE     DEFN A5ACTY    WSPACT
     C           *LIKE     DEFN CINW      BCINW
     C           *LIKE     DEFN WOTACT    WATYP
     C           *LIKE     DEFN BICN      WBICN
     C           *LIKE     DEFN DINW      WCIWT
     C           *LIKE     DEFN DINW      WDIWT
     C           *LIKE     DEFN WOTACC    WTACC
     C           *LIKE     DEFN WPSTA     @WPSTA
     C           *LIKE     DEFN WPSTA     PACR1
     C           *LIKE     DEFN RUND      CTFDAT                         052739
     C           *LIKE     DEFN BRCA      @CBRCA                          130468
     C           *LIKE     DEFN BRCA      @SBRCA                          130468
     C           *LIKE     DEFN CCY       @CCCY                           130468
     C           *LIKE     DEFN CCY       @SCCY                           130468
     C           *LIKE     DEFN BICN      @CBICN                          130468
     C           *LIKE     DEFN BICN      @SBICN                          130468
     C           *LIKE     DEFN CNUM      @CCNUM                          130468
     C           *LIKE     DEFN ACOD      @CACOD                          130468
     C           *LIKE     DEFN ACSQ      @CACSQ                          130468
     C           *LIKE     DEFN ACNO      @CACNO                          130468
     C           *LIKE     DEFN PRFC      WFXPC                           130468
     C           *LIKE     DEFN PRFC      @CPRFC                          130468
     C           *LIKE     DEFN CAIC      @WCAIC                          130468
     C           *LIKE     DEFN BRTAMT    BRTAM2                          130468
     C           *LIKE     DEFN CAIC      @CRINT                          135809
     C           *LIKE     DEFN CAIC      @CRNET                          135809
     C           *LIKE     DEFN ATYP      @CATYP                          135809
     C           *LIKE     DEFN HISB      @RHISB                          135809
     C/COPY WNCPYSRC,REH00430
     C           *LIKE     DEFN TCHO      WTCHO                                               250998
     C           *LIKE     DEFN CHGA      WCHGA                                               250998
     C           *LIKE     DEFN PSTA      WPSTA2                                              250998
     C           *LIKE     DEFN TSWTAC    WEWTA                                               232543
     C           *LIKE     DEFN TSACOD    KACDE                                               232543
     C           *LIKE     DEFN HISD      WCDAT                                               CER048
     C           *LIKE     DEFN SHISB     WHISB                                               CER048
     C           *LIKE     DEFN RUND      ZIBEG                                               CER048
     C           *LIKE     DEFN RUND      ZIEND                                               CER048
     C           *LIKE     DEFN RUND      ZIBW1                                               CER048
     C           *LIKE     DEFN CRCB      ZICALC                                              CER048
     C           *LIKE     DEFN RUND      ZIDREM                                              CER048
     C           *LIKE     DEFN CICT      ZIMAN                                               CER048
     C           *LIKE     DEFN CICT      ZIDW1                                               CER048
     C           *LIKE     DEFN RUND      ZIDW2                                               CER048
     C           *LIKE     DEFN RUND      ZID1                                                CER048
     C           *LIKE     DEFN RUND      ZID2                                                CER048
     C           *LIKE     DEFN RUND      ZILPCP                                              CER048
     C           *LIKE     DEFN TSSTAC    WSTAC                                               CER048
     C           *LIKE     DEFN FACT      ZIFY2                                               CER048
     C           *LIKE     DEFN CICT      ZIM1                                                CER048
     C           *LIKE     DEFN FACT      ZIM2                                                CER048
     C           *LIKE     DEFN FACT      ZINOM                                               CER048
     C           *LIKE     DEFN RUND      ZIREM                                               CER048
     C           *LIKE     DEFN FACT      ZISY2                                               CER048
     C           *LIKE     DEFN CICT      ZIY1                                                CER048
     C           *LIKE     DEFN ACOD      ZLYCHK                                              CER048
     C           *LIKE     DEFN ACSQ      ZLYREM                                              CER048
     C           *LIKE     DEFN LCID      WSEDAT                                              CER048
      *                                                                                     CRE083BK
     C                     Z-ADD300       ARRSZ   30                                        CRE083BK
      *                                                                                     CRE083BK
     C                     Z-ADD0         LEASTE 130                                        CRE083BK
     C           *LIKE     DEFN LEASTE    RCSQ                                              CRE083BK
      *                                                                                     CRE083BK
     C                     Z-ADDARRSZ     TIDX    40                                        CRE083BK
     C           *LIKE     DEFN TIDX      PIDX                                              CRE083BK
     C           *LIKE     DEFN TIDX      E                                                 CRE083BK
     C           *LIKE     DEFN ACOD      KEYACD                                            CRE083BK
     C           *LIKE     DEFN DBASE     WDBASE                                            CRE083BK
     C                     MOVE *BLANKS   ACDALP 10                                         CRE083BK
      *                                                                                     CRE083BK
     C                     MOVE *BLANK    ACFIC   1                                         CRE083BK
     C*                    MOVE *BLANKS   KEYACD                                            CRE083BK
     C                     Z-ADDARRSZ     PIDX                                              CRE083BK
     C                     Z-ADDARRSZ     E                                                 CRE083BK
      *                                                                                     CRE083BK
     C           *LIKE     DEFN EWPARL    WLEVEL                                              CER048
     C           *LIKE     DEFN TSTTAC    WTTAC                                               CER054
     C           *LIKE     DEFN TRAT      SVTRAT                                            AR831847
     C           *LIKE     DEFN CAIC1     SVRCIC                                            AR831847
     C           *LIKE     DEFN CAIC      SVCAIC                                            AR831847
     C           *LIKE     DEFN CDP       WLCDP                                               CGL165
     C           *LIKE     DEFN SPOT      WLSPOT                                              CGL165
     C           *LIKE     DEFN MDIN      WLMDIN                                              CGL165
     C           *LIKE     DEFN TACC      WLTACC                                              CGL165
     C           *LIKE     DEFN A5ACTY    WLTACT                                              CGL165
     C           *LIKE     DEFN TXCR      WBTXCR                                              CGL165
     C           *LIKE     DEFN TXCR      WLTXCR                                              CGL165
     C           *LIKE     DEFN TXCR      WOTXCR                                              CGL165
     C/COPY WNCPYSRC,RE3664C038
     C*
     C/EJECT
     C*===================================================================
     C** P R O G R A M     S T A R T
     C*===================================================================
     C*                                                                   CCB003
     C           *ENTRY    PLIST                                          CCB003
     C                     PARM           RSTART  1        Restart if Y   CCB003
      *                                                                                       CGL020
      ** This is just a Dummy access. This will never be executed by                          CGL020
      ** the program                                                                          CGL020
      *                                                                                       CGL020
     C           *INLR     IFEQ '0'                                                           CGL020
     C           *INLR     ANDEQ'1'                                                           CGL020
     C                     READ APOSTPDF                 LR                                   CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CCB003
     C*
     C** FIRST CYCLE PROCESSING
     C*
     C           NFIRST    IFEQ ' '                                                         CRE083BE
     C                     EXSR FIRST
     C                     MOVE 'Y'       NFIRST  1                                         CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
     C                     MOVE 'N'       FCOMIT  1                                         MD022410
     C           CDL013    IFEQ '1'                                                         CRE083BE
      *                                                                                     CRE083BE
      ** Open & access WHT ICD extension file to retrieve WHT rate                          CRE083BE
      *                                                                                     CRE083BE
     C                     OPEN SDSTAAL1                                                    CRE083BE
     C           WTYPE     CHAINSDSTAAL1             40                                     CRE083BE
      *                                                                                     CRE083BE
      ** If CHAIN failed, terminate the program                                             CRE083BE
      *                                                                                     CRE083BE
     C           *IN40     IFEQ *ON                                                         CRE083BE
     C           *LOCK     IN   LDA                                                         CRE083BE
     C                     MOVEL'SDSTAAL1'DBFILE                                            CRE083BE
     C                     MOVELWTYPE     DBKEY                                             CRE083BE
     C                     Z-ADD141       DBASE                                             CRE083BE
     C                     OUT  LDA                                                         CRE083BE
     C                     EXSR *PSSR                                                       CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
      ** Open WHT Customer History file, Retail WHT Extract file,                           CRE083BE
      ** Account Details Extension file & Account Code Extension file.                      CRE083BE
     C                     OPEN GLWHTCL0                                                    CRE083BE
     C                     OPEN GLXTAXL0                                                    CRE083BE
     C                     OPEN ACCNTBY0                                                    CRE083BE
     C                     OPEN SDACOAL0                                                    CRE083BE
      *                                                                                     CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
      ** Initialize work fields                                                             CRE083BE
      *                                                                                     CRE083BE
     C                     MOVE *BLANKS   ZZ001                                             CRE083BE
     C                     MOVE *BLANKS   ZZ006                                             CRE083BE
     C                     MOVE *BLANKS   ZZ009                                             CRE083BE
     C                     MOVE *BLANKS   SWCR                                              CRE083BE
     C                     MOVE *BLANKS   DLREF                                             CRE083BE
     C                     MOVE *BLANKS   REBI                                              CRE083BE
     C                     MOVE *BLANKS   FACO                                              CRE083BE
     C                     MOVE *BLANKS   PREF                                              CRE083BE
     C                     MOVE 'D'       ENDK                                              CRE083BE
     C                     Z-ADD*ZEROS    NBRREC  50                                        CRE083BE
     C                     MOVE *BLANKS   DBCNUM                                            CRE083BE
     C                     Z-ADD*ZEROS    CHGA                                              CRE083BE
     C                     Z-ADD*ZEROS    DRIP                                              CRE083BE
     C                     Z-ADD*ZEROS    CRIP                                              CRE083BE
     C                     MOVEL'91060'   OTTP                                              CRE083BE
      *                                                                                     CRE083BE
     C           CRE008    IFEQ 'Y'                                                         CRE083BE
     C                     OPEN REGAHLJ2                                                    CRE083BE
     C                     OPEN REZSHLJ2                                                    CRE083BE
     C                     OPEN RECIEUL2                                                    CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
     C                     OPEN REINTCPD                                                    CRE083BE
      *                                                                                     CRE083BE
      ** Read END key from REINTCPD                                                         CRE083BE
      *                                                                                     CRE083BE
     C                     MOVE 'Z'       IXCKEY  1                                         CRE083BE
     C           IXCKEY    CHAINREINTCPD             38                                     CRE083BE
     C           *IN38     IFEQ *OFF                                                        CRE083BE
     C                     MOVE NLGID     JLGID                                             CRE083BE
     C                     MOVE NBRCA     JBRCA                                             CRE083BE
     C                     MOVE NCNUM     JCNUM                                             CRE083BE
     C                     MOVE NCCY      JCCY                                              CRE083BE
     C                     MOVE NACOD     JACOD                                             CRE083BE
     C                     MOVE NACSQ     JACSQ                                             CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
      ** Read START key from REINTCPD                                                       CRE083BE
      *                                                                                     CRE083BE
     C           *IN38     IFEQ *OFF                                                        CRE083BE
     C                     MOVE 'A'       IXCKEY                                            CRE083BE
     C           IXCKEY    CHAINREINTCPD             38                                     CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
     C           *IN38     IFEQ *ON                                                         CRE083BE
     C                     EXSR *PSSR                                                       CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
      ** Set pointer to the first record.                                                   CRE083BE
      *                                                                                     CRE083BE
     C                     MOVE NLGID     YLGID                                             CRE083BE
     C                     MOVE NBRCA     YBRCA                                             CRE083BE
     C                     MOVE NCNUM     YCNUM                                             CRE083BE
     C                     MOVE NCCY      YCCY                                              CRE083BE
     C                     MOVE NACOD     YACOD                                             CRE083BE
     C                     MOVE NACSQ     YACSQ                                             CRE083BE
     C                     MOVE *OFF      *IN19                                             CRE083BE
      *                                                                                     CRE083BE
     C           NXTKEY    IFGT ENDKEY                                                      CRE083BE
     C           NXTKEY    OREQ ENDKEY                                                      CRE083BE
     C           PROT      ANDEQ'C'                                                         CRE083BE
     C                     MOVE *ON       *IN19                                             CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
     C           *IN19     IFEQ *OFF                                                        CRE083BE
      *                                                                                     CRE083BE
     C           PROT      IFEQ ' '                                                         CRE083BE
     C           REHKEY    SETLLREHISBC                                                     CRE083BE
     C                     ELSE                                                             CRE083BE
     C           REHKEY    SETGTREHISBC                                                     CRE083BE
     C                     ENDIF                                                            CRE083BE
      *
     C*
     C** MAIN PROCESSING
     C*
     C***********          MOVE *ZERO     RKEY                            CCB003
     C***********          MOVE *BLANK    LGID                            CCB003
     C***********          MOVE *BLANK    BCCY                            CCB003
     C                     MOVE BBRCA     ZBRCA   3                       076557
     C***********          Z-ADD99        DBASE                           CRE002
     C                     Z-ADD001       DBASE            * DB ERROR 001*CRE002
     C*
     C                     MOVE *BLANKS   CCY#    3
     C                     MOVE *BLANKS   BRCA#   3
     C***********          MOVE *BLANKS   BBRCA                    071053 CCB003
     C*
     C***********R1KEY     SETLLREHISBC                                   CCB003
     C*
     C***********          Z-ADD98        DBASE                           CRE002
     C                     Z-ADD002       DBASE            * DB ERROR 002 CRE002
     C***********          READ REHISBC                  LR               CCB003
     C**********           READ REINTCPD                 LR                          CCB003 CRE083BE
     C                     READ REHISBC                  19                                 CRE083BE
     C                     ENDIF                                                            CRE083BE
     C*
     C* DEFINE IF ACCOUNT IS SECONDARY
     C*
     C                     SETOF                         50
     C********** ACKEY     SETLLRELINKL1                 50                                   CGL029
     C           ACKEY2    SETLLRELINKL1                 50                                   CGL029
     C/COPY WNCPYSRC,RE3664C039
     C                     MOVE ' '       BADTY
     C* SET NARRATIVE WNARS
     C                     MOVE BCNUM     XCNUM
     C                     MOVE BCCY      XCCY
     C                     MOVE BACOD     XACOD
     C                     MOVE BACSQ     XACSQ
     C                     MOVE BBRCA     XBRCA                           LN0120
     C                     MOVE BCNUM     ASOC                            080978
     C*
     C********** *INLR     DOWEQ'0'                        - B1                             CRE083BE
     C           *IN19     DOWEQ*OFF                                                        CRE083BE
     C/COPY WNCPYSRC,RE3664C018
     C                     SETOF                     41
     C*
     C** MULTIBRANCHING PROCESSING
     C*
     C           BBRCA     IFNE BRCA#
      *                                                                   CCB003
     C************IN87     IFEQ '1'                                       CCB003
     C***********                                                   085762CCB003
     C***IF*THERE*ARE*NO*DETAILS*FOR*THIS*BRANCH,*WRITE*NODET*FORMAT085762CCB003
     C************IN43     IFEQ '0'                                 085762CCB003
     C***********          WRITENODET                               085762CCB003
     C***********          END                                      085762CCB003
     C***********          WRITEENDP1                                     CCB003
     C***********          SETOF                     87                   CCB003
     C***********          END                                            CCB003
     C/COPY WNCPYSRC,RE3664C001
      *                                                                   CCB003
     C                     MOVE BBRCA     BRCA#
      *                                                                   CCB003
     C*********            CLOSERE3664P1                                  CCB003
     C*********            OPEN RE3664P1                                  CCB003
     C***********          SETON                     87                   CCB003
     C*********            Z-ADD0         PAGE                            081545
     C***********                                                         CCB003
     C***Ensure*Report*Spool*File*Recorded*by*RCF                         CCB003
     C***********                                                         CCB003
     C***********          Z-ADDSFNUM     ZSNUM   60                      CCB003
     C***********          CALL 'ZSFILE'                                  CCB003
     C***********          PARM *BLANKS   @SEQ    5                       CCB003
     C***********          PARM BBRCA     SENTY   3                       CCB003
     C***********          PARM           SFILE                           CCB003
     C***********          PARM           ZSNUM                           CCB003
     C***********          PARM *BLANKS   ZSERR   1                       CCB003
     C***********                                                         CCB003
     C***Error*During*ZSFILE*Processing,*Return*to*Calling*Program        CCB003
     C***********                                                         CCB003
     C***********ZSERR     IFEQ 'Y'                                       CCB003
     C***********          MOVE '1'       *INU7                           CCB003
     C***********          MOVE '1'       *INU8                           CCB003
     C***********          MOVE '1'       *INLR                           CCB003
     C************LOCK     IN   LDA                                       CCB003
     C***********          MOVEL'ZSFILE  'DBFILE           ***************CCB003
     C***********          MOVELBBRCA     DBKEY            * DB ERROR 35 *CCB003
     C***********          Z-ADD35        DBASE            ***************CCB003
     C***********          OUT  LDA                                       CCB003
     C***********          WRITEERRP1                                     CCB003
     C***********          EXSR *PSSR                                     CCB003
     C***********          RETRN                                          CCB003
     C***********          END                                            CCB003
     C*
     C** Retrieve Branch Name
     C*
     C                     Z-ADDCUBRCA    C                                                 CRE083BK
     C           BBRCA     LOKUPABRC,C                   16                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN16     IFEQ '1'                                                         CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C           1         OCUR SDBRCH                                                      MD021155
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BBRCA     @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C***********          MOVEL@BRCA     DBKEY            * DB ERROR 2  *CRE002
     C***********          Z-ADD2         DBASE            ***************CRE002
     C                     MOVEL@BRCA     DBKEY            * DB ERROR 004*CRE002
     C                     Z-ADD004       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     MOVE '1'       *INLR
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C***********          WRITEHEADP1                                    CCB003
     C/COPY WNCPYSRC,RE3664C002
     C                     END
     C*
     C/COPY WNCPYSRC,RE3664C201
     C                     EXSR MAIN
     C/COPY WNCPYSRC,RE3664C202
     C***********          Z-ADD97        DBASE                           CRE002
     C                     Z-ADD005       DBASE            * DB ERROR 005*CRE002
      *                                                                   CCB003
      ** Increase number of records processed                             CCB003
     C                     ADD  1         #COMIT                          CCB003
      ***************************************************************                CCB003 CRE083BE
      ***Delete*record*from*driving*file*****************************                CCB003 CRE083BE
     C**********           DELETREHISPPF                                             CCB003 CRE083BE
      *                                                                   CCB003
      ** Comit if restart status = 'Y' or number of records processed     CCB003
      ** has reached optimum defined in CBTASKSP                          CCB003
      *
     C                     MOVE BLGID     YLGID                                             CRE083BE
     C                     MOVE BBRCA     YBRCA                                             CRE083BE
     C                     MOVE BCNUM     YCNUM                                             CRE083BE
     C                     MOVE BCCY      YCCY                                              CRE083BE
     C                     MOVE BACOD     YACOD                                             CRE083BE
     C                     MOVE BACSQ     YACSQ                                             CRE083BE
     C                     MOVE NXTKEY    LSTKEY                                            CRE083BE
      *
     C           RSTART    IFEQ 'Y'                                       CCB003
     C           #COMIT    OREQ #OPTIM                                    CCB003
     C           FCOMIT    OREQ 'Y'                                                         MD022410
     C                     EXSR UPDPTR                                                      CRE083BE
     C                     COMIT                                          CCB003
     C                     MOVE 'N'       FCOMIT                                            MD022410
     C                     Z-ADD0         #COMIT                          CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C***********          READ REHISBC                  LR               CCB003
     C**********           READ REINTCPD                 LR                          CCB003 CRE083BE
     C                     READ REHISBC                  19                                 CRE083BE
      *                                                                                     CRE083BE
      ** Check if end record is read.                                                       CRE083BE
      **                                                                                    CRE083BE
     C           *IN19     IFEQ *OFF                                                        CRE083BE
     C                     MOVE BLGID     YLGID                                             CRE083BE
     C                     MOVE BBRCA     YBRCA                                             CRE083BE
     C                     MOVE BCNUM     YCNUM                                             CRE083BE
     C                     MOVE BCCY      YCCY                                              CRE083BE
     C                     MOVE BACOD     YACOD                                             CRE083BE
     C                     MOVE BACSQ     YACSQ                                             CRE083BE
      *                                                                                     CRE083BE
     C           NXTKEY    IFGT ENDKEY                                                      CRE083BE
     C                     MOVE *ON       *IN19                                             CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
     C           *IN19     IFEQ *ON                                                         CRE083BE
     C                     MOVE LSTKEY    NXTKEY                                            CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                   CCB003
      ** Comit if no records left in driving file and number of           CCB003
      ** records processed is not 0                                       CCB003
     C********** *INLR     IFEQ '1'                                                  CCB003 CRE083BE
     C           *IN19     IFEQ *ON                                                         CRE083BE
     C           #COMIT    ANDGT0                                         CCB003
     C                     EXSR UPDPTR                                                      CRE083BE
     C                     COMIT                                          CCB003
     C/COPY WNCPYSRC,RE3664C003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C                     SETOF                         50
     C********** ACKEY     SETLLRELINKL1                 50                                   CGL029
     C           ACKEY2    SETLLRELINKL1                 50                                   CGL029
     C/COPY WNCPYSRC,RE3664C040
     C                     MOVE ' '       BADTY
     C* SET NARRATIVE WNARS
     C                     MOVE BCNUM     XCNUM
     C                     MOVE BCCY      XCCY
     C                     MOVE BACOD     XACOD
     C                     MOVE BACSQ     XACSQ
     C                     MOVE BBRCA     XBRCA                           LN0120
     C                     MOVE BCNUM     ASOC                            080978
     C                     END                             - E1
     C*
     C***********          WRITETOTALS                                    CCB003
     C***********                                                         CCB003
     C***DO*NOT*PRODUCE*REPORT*FOR*BRANCH*000*IF*REHISBC*EMPTY      085762CCB003
     C****PRINT*'NO*DETAILS*TO*REPORT'*IF*FILE*REHISBC*IS*EMPTY***        085762
     C************                                                        085762
     C************IN41     IFEQ '1'                                       085762
     C************         OPEN RE3664P1                                  085762
     C************         MOVE ZBRCA     BRCA#                     076557085762
     C************         WRITEHEADP1                                    085762
     C************         WRITENODET                                     085762
     C************         CLOSERE3664P1                                  085762
     C************         END                                            085762
     C***********                                                         CCB003
     C****PRINT*'END OF BRANCH' NARRATIVE AT END OF PROGRAM ALSO          CCB003
     C***********                                                         CCB003
     C************IN87     IFEQ '1'                                       CCB003
     C***********          WRITEENDP1                                     CCB003
     C***********          END                                            CCB003
     C***********                                                         CCB003
     C***********          COMIT                                          CCB003
      *                                                                                     CRE083BE
      ** Release record lock and close file.                                                CRE083BE
      *                                                                                     CRE083BE
     C                     UNLCKACCNTX                                                      CRE083BE
     C                     UNLCKREHISBC                                                     CRE083BE
     C                     UNLCKREINTCPD                                                    CRE083BE
     C                     UNLCKREHISBL                                                     CRE083BE
     C                     UNLCKREHISL                                                      CRE083BE
     C                     UNLCKREHISSL                                                     CRE083BE
     C                     UNLCKACCNT                                                       CRE083BE
     C                     UNLCKREACR                                                       CRE083BE
     C                     UNLCKREIAC                                                       CRE083BE
     C                     UNLCKREINTCPA                                                    CRE083BE
     C                     UNLCKGLWHTCL0                                                    CRE083BE
     C                     UNLCKGEICPD                                                      CRE083BE
     C                     UNLCKREINCXPD                                                    CRE083BE
     C                     UNLCKSDINPHL2                                                    CRE083BE
     C                     UNLCKSDCSINLJ                                                    CRE083BE
      *                                                                                     CRE083BE
     C           CDL013    IFEQ '1'                                                         CRE083BE
     C                     CLOSESDSTAAL1                                                    CRE083BE
     C                     CLOSEGLWHTCL0                                                    CRE083BE
     C                     CLOSEGLXTAXL0                                                    CRE083BE
     C                     CLOSEACCNTBY0                                                    CRE083BE
     C                     CLOSESDACOAL0                                                    CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
     C           CRE008    IFEQ 'Y'                                                         CRE083BE
     C                     CLOSEREGAHLJ2                                                    CRE083BE
     C                     CLOSEREZSHLJ2                                                    CRE083BE
     C                     CLOSERECIEUL2                                                    CRE083BE
     C                     ENDIF                                                            CRE083BE
      *                                                                                     CRE083BE
     C                     CLOSEREINTCPD                                                    CRE083BE
      *                                                                                     CRE083BE
     C                     RETRN                                                            CRE083BE
     C*
     C*===================================================================
     C** P R O G R A M     E N D
     C*===================================================================
     C/EJECT
     C********************************************************************
     C**
     C** ACCPR subroutine to execute account processing
     C**
     C**     Called by       CREPR,DEBPR
     C**     Calls           GEICPR
     C**
      *****************************************************************   CCB003
     C           ACCPR     BEGSR                           **ACCPR BEGSR**
     C*
     C**********           Z-ADDBCNUM     CNUM                                                CSD027
     C                     MOVE BCNUM     CNUM                                                CSD027
     C                     MOVE BCCY      CCY
     C                     Z-ADDBACOD     ACOD
     C/COPY WNCPYSRC,RE3664C089
     C                     Z-ADDBACSQ     ACSQ
     C                     MOVE BBRCA     BRCA
     C                     MOVE WACNO     ACNO
     C                     Z-ADDSHISD     VALD
     C                     Z-ADDSHISD     HISD
     C                     MOVE '1'       RIND
     C                     MOVE 'R'       ATYP
     C***********          Z-ADD*ZEROS    ASOC                            080978
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C                     EXSR TAXSR
      *                                                                                       250998
     C           VALD      IFGT PSTD                                                          250998
     C           VALD      ANDLTDNWD                                                          250998
     C           TRAT      ANDEQ91060                                                         250998
     C           CHGT      ANDNE0                                                             250998
     C                     EXSR DETPR                                                         250998
     C                     ENDIF                                                              250998
      *                                                                   130468
      * Accumulate CR interest/adj. amount for calculation of BRT         130468
     C           S01383    IFEQ 'Y'                                       130468
     C           WDRCR     ANDEQ'1'                                       130468
     C                     SUB  WPSTA     @WCAIC                          130468
     C                     END                                            130468
     C*
     C** GEICPD FILE PROCESSING
     C*
     C                     EXSR GEICPR
     C/COPY WNCPYSRC,RE3664C196
     C*
     C           VALD      IFLE NAPDA                      - B1
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C041
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C***********          Z-ADD28        DBASE                           CRE002
     C                     Z-ADD006       DBASE            * DB ERROR 006*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C           WCHGA     IFNE 0                                                             250998
     C                     Z-ADDWCHGA     CHGA                                                250998
     C                     END                                                                250998
     C                     WRITEREHPOSPF
     C                     Z-ADD0         CHGA                                                250998
     C/COPY WNCPYSRC,RE3664C197
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** ACCESS POSITION RECORD FOR UPDATE OR ADD THEN UPDATE HEADER FIELDS
     C*
     C***********          Z-ADD88        DBASE                           CRE002
     C                     Z-ADD007       DBASE            * DB ERROR 007*CRE002
     C*
     C***********          MOVE 'Y'       @REL    1                       NNN
     C***********          EXCPTHISPD                                     NNN
     C           R3KEY     CHAINREHISPDF             40
     C                     Z-ADD*ZEROS    DBASE
     C           *IN40     IFEQ '1'                        - B1
     C                     MOVE 'D'       RECI
     C                     MOVE *BLANK    DLGID
     C                     Z-ADD*ZERO     VALL
     C                     MOVE *BLANK    LINK
     C                     MOVE *BLANK    DICI
     C                     MOVE *BLANK    CICI
     C                     MOVE *BLANK    DRCI
     C                     MOVE *BLANK    CRCI
     C                     MOVE *BLANK    ALTI
     C                     Z-ADD*ZERO     DRIR
     C                     Z-ADD*ZERO     CRIR
     C                     Z-ADD*ZERO     PDID
     C                     Z-ADD*ZERO     PCID
     C                     Z-ADD*ZERO     DICT
     C                     Z-ADD*ZERO     CICT
     C                     Z-ADD*ZERO     DRCB
     C                     Z-ADD*ZERO     CRCB
     C                     MOVE *BLANK    ADTY
     C                     Z-ADD*ZERO     MNBL
     C                     Z-ADD*ZERO     CHGAR
     C                     Z-ADD*ZERO     TCHGAR
     C                     Z-ADD*ZERO     CHGAN
     C                     Z-ADD*ZERO     TCHGAN
     C           WCHGA     IFNE 0                                                             250998
     C           REBID     IFEQ 'Y'                                                           250998
     C                     Z-ADDWCHGA     CHGAR                                               250998
     C                     Z-ADDWCHGA     TCHGAR                                              250998
     C                     ELSE                                                               250998
     C                     Z-ADDWCHGA     CHGAN                                               250998
     C                     Z-ADDWCHGA     TCHGAN                                              250998
     C                     END                                                                250998
     C                     END                                                                250998
     C                     Z-ADD*ZERO     DMVT
     C                     Z-ADD*ZERO     CMVT
     C                     Z-ADD*ZERO     DAID
     C                     Z-ADD*ZERO     MADI
     C                     Z-ADD*ZERO     TMADI
     C                     Z-ADD*ZERO     DMINT
     C                     Z-ADD*ZERO     CAID
     C                     Z-ADD*ZERO     MACI
     C                     Z-ADD*ZERO     TMACI
     C                     Z-ADD*ZERO     CMINT
     C                     Z-ADD*ZERO     MNBCP
     C                     Z-ADD*ZERO     DRCD
     C                     Z-ADD*ZERO     CRCD
     C                     Z-ADD*ZERO     VDTC
     C           DRCR      IFEQ 1                          - B2
     C                     Z-ADDPSTA      CMVT
     C                     ELSE                            - X2
     C                     Z-ADDPSTA      DMVT
     C                     END                             - E2
     C/COPY WNCPYSRC,RE3664C209
     C           SHISB     ADD  DMVT      HISB
     C                     SUB  CMVT      HISB
     C                     Z-ADD*ZERO     AODR                            CRE002
     C                     Z-ADD*ZERO     ODRL                            CRE002
     C                     MOVE *BLANK    ODLI                            CRE002
     C                     Z-ADD*ZERO     ODIA                            CRE002
     C***********          Z-ADD87        DBASE                           CRE002
     C                     Z-ADD008       DBASE            * DB ERROR 008*CRE002
     C                     WRITEREHISPDF
     C                     Z-ADD*ZEROS    DBASE
     C                     ELSE                            - X1
     C           DRCR      IFEQ 1                          - B2
     C                     ADD  PSTA      CMVT
     C                     ELSE                            - X2
     C                     ADD  PSTA      DMVT
     C                     END                             - E2
     C********** WDRCR     IFEQ '1'                                                   135809 135809R
     C********** @CRINT    ANDGT*ZERO                                                 135809 135809R
     C**********           SUB  @CRINT    HISB                                        135809 135809R
     C**********           END                                                        135809 135809R
     C           WDRCR     IFEQ '1'                                                         AR978914
     C           @CRINT    ANDGT*ZERO                                                       AR978914
     C                     SUB  @CRINT    HISB                                              AR978914
     C                     END                                                              AR978914
     C           WCHGA     IFNE 0                                                             250998
     C           REBID     IFEQ 'Y'                                                           250998
     C                     ADD  WCHGA     CHGAR                                               250998
     C                     ADD  WCHGA     TCHGAR                                              250998
     C                     ELSE                                                               250998
     C                     ADD  WCHGA     CHGAN                                               250998
     C                     ADD  WCHGA     TCHGAN                                              250998
     C                     END                                                                250998
     C                     END                                                                250998
     C/COPY WNCPYSRC,RE3664C137
     C***********          Z-ADD86        DBASE                           CRE002
     C                     Z-ADD009       DBASE            * DB ERROR 009*CRE002
     C                     UPDATREHISPDF
     C                     MOVE 'Y'       FCOMIT                                            MD022410
     C                     Z-ADD*ZEROS    DBASE
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3664C159
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C                     MOVE 'Y'       BADTY
     C           SHISD     IFLT BVDTC
     C                     MOVE SHISD     BVDTC
     C                     END
     C                     END                             - E1
      *                                                                                       250998
     C                     Z-ADD0         WCHGA                                               250998
     C*
     C* SET UP NARRATIVE FOR OTHER POSTINGS.
     C                     ENDSR                           **ACCPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ACCSR subroutine for ACCNT    file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           ACCSR     BEGSR                           **ACCSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'ACCNT'   DBFILE           ***************CCB003
     C                     MOVEL'ACCNT'   DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSACC    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'11'      *IN,88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **ACCSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ACXSR subroutine for ACCNTX   file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           ACXSR     BEGSR                           **ACXSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'ACCNTX'  DBFILE           ***************CCB003
     C                     MOVEL'ACCNTX'  DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSACX    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'11'      *IN,88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **ACXSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ACRSR subroutine for REACR    file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           ACRSR     BEGSR                           **ACRSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'REACR'   DBFILE           ***************CCB003
     C                     MOVEL'REACR'   DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSACR    DBSTAT           ***************
     C                     OUT  LDA
     C                     MOVEA'11'      *IN,88
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **ACRSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ALTPR subroutine to execute alternate processing
     C**
     C**     Called by       CHGPR,CREPR,DEBPR
     C**     Calls           DCIND,GEICPR,SUSPR,POSPR
     C**
      *****************************************************************   CCB003
     C           ALTPR     BEGSR                           **ALTPR BEGSR**
      *                                                                   CAC001
      **  Initially set profit centre to be profit centre of main a/c     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WMPRFC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C** CHECK ON DEBIT/CREDIT INDICATOR
     C*
     C           WDRCR     IFEQ '0'                        - B1
     C                     MOVELSDACP     WALT
     C***********          MOVELDRBR      WBRCA                           123519
     C                     MOVELSDRBR     WBRCA                           123519
     C                     ELSE                            - X1
     C           WDRCR     IFEQ '1'                        - B2
     C                     MOVELSCACP     WALT
     C***********          MOVELCRBR      WBRCA                           123519
     C                     MOVELSCRBR     WBRCA                           123519
     C                     ELSE                            - X2
     C           WDRCR     IFEQ '2'                        - B3
     C                     MOVELSCHAC     WALT
     C***********          MOVELCHBR      WBRCA                           123519
     C                     MOVELSCHBR     WBRCA                           123519
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           WALT5     IFEQ *BLANKS                    - B1
     C*
     C** CHECK IF RETAIL KEY
     C*
     C***********          Z-ADD29        DBASE                           CRE002
     C                     Z-ADD010       DBASE            * DB ERROR 010*CRE002
     C           WALT10    CHAINACNUM                99
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** ALTERNATE ACCOUNT NOT FOUND POST TO SUSPENS
     C*
     C           *IN99     IFEQ '1'                        - B2
     C*
     C** CHECKING DEBIT/CREDIT INDICATOR PROCESSING
     C*
     C                     EXSR DCIND
     C*
     C** SUSPENSE PROCESSING
     C*
     C                     EXSR SUSPR
     C*
     C                     ELSE                            - X2
     C*
     C** ALTERNATE ACCOUNT CLOSED POST TO SUSPENS
     C*
     C           RRRECI    IFNE 'D'                        - B3
     C*
     C                     MOVE 'P'       RECI
     C*********************Z-ADDRCNUM     ASOC                            080978
     C*
     C** CHECKING DEBIT/CREDIT INDICATOR PROCESSING
     C*
     C                     EXSR DCIND
     C*
     C** SUSPENSE PROCESSING
     C*
     C                     EXSR SUSPR
     C*
     C** RETAIL ACCOUNT FOUND FORMAT KEY
     C*
     C                     ELSE                            - X3
      **If*CR*interest*(not*adjustment)*and*a/c*liable*for*withholding**************  135809 135809R
      **tax,*save*alt.*a/c*details*and*post*gross*interest*to*main*a/c.*************  135809 135809R
     C********** WDRCR     IFEQ '1'                                                   135809 135809R
     C********** ATITAX    ANDEQ'Y'                                                   135809 135809R
     C********** SHISD     ANDEQCNCID                                                 135809 135809R
     C/COPY WNCPYSRC,REH00456
     C**********           Z-ADDCAIC      @CRINT                                      135809 135809R
     C**********           MOVE RBRCA     @CBRCA                                      135809 135809R
     C**********           Z-ADDRCNUM     @CCNUM                                       135809 CSD027
     C**********           MOVE RCNUM     @CCNUM                                      CSD027 135809R
     C**********           MOVE RCCY      @CCCY                                       135809 135809R
     C**********           Z-ADDRACOD     @CACOD                                      135809 135809R
     C**********           Z-ADDRACSQ     @CACSQ                                      135809 135809R
     C**********           Z-ADDWALT10    @CACNO                                      135809 135809R
     C**********           MOVE 'R'       @CATYP                                      135809 135809R
     C**********           MOVE *BLANK    @CPRFC                                      135809 135809R
     C**********           EXSR ACCPR                                                 135809 135809R
     C**********           ELSE                                                       135809 135809R
      *                                                                                     AR978914
      **  If CR interest (not adjustment) and a/c liable for withholding                    AR978914
      **  tax, save alt. a/c details and post gross interest to main a/c.                   AR978914
      *                                                                                     AR978914
     C           WDRCR     IFEQ '1'                                                         AR978914
     C           ATITAX    ANDEQ'Y'                                                         AR978914
     C           SHISD     ANDEQCNCID                                                       AR978914
     C                     Z-ADDCAIC      @CRINT                                            AR978914
     C                     MOVE RBRCA     @CBRCA                                            AR978914
     C                     MOVE RCNUM     @CCNUM                                            AR978914
     C                     MOVE RCCY      @CCCY                                             AR978914
     C                     Z-ADDRACOD     @CACOD                                            AR978914
     C                     Z-ADDRACSQ     @CACSQ                                            AR978914
     C                     Z-ADDWALT10    @CACNO                                            AR978914
     C                     MOVE 'R'       @CATYP                                            AR978914
     C                     MOVE *BLANK    @CPRFC                                            AR978914
     C                     EXSR ACCPR                                                       AR978914
     C                     ELSE                                                             AR978914
     C*
     C                     MOVE 'P'       RECI
     C**********           Z-ADDRCNUM     CNUM                                                CSD027
     C                     MOVE RCNUM     CNUM                                                CSD027
     C                     MOVE RCCY      CCY
     C                     Z-ADDRACOD     ACOD
     C/COPY WNCPYSRC,RE3664C090
     C                     Z-ADDWALT10    ACNO
     C                     Z-ADDSHISD     VALD
     C                     MOVE '1'       RIND
     C                     MOVE 'R'       ATYP
     C                     Z-ADDRACSQ     ACSQ
     C                     MOVE RBRCA     BRCA
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP33                                           S01408
      *                                                                   S01408
     C*
     C                     EXSR TAXSR
      *                                                                                       250998
     C           VALD      IFGT PSTD                                                          250998
     C           VALD      ANDLTDNWD                                                          250998
     C           TRAT      ANDEQ91060                                                         250998
     C                     EXSR DETPR                                                         250998
     C                     ENDIF                                                              250998
      *                                                                   CAC001
      **  If Analytical Accounting installed, get profit centre of        CAC001
      **  the alternate account                                           CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           WALT10    CHAINREACNMF              99                   CAC001
     C           *IN99     IFEQ '1'                                       CAC001
     C           *LOCK     IN   LDA                                       CAC001
     C                     MOVEL'REACNMPD'DBFILE           ************   CAC001
     C                     MOVELWALT10    DBKEY            * DBER 201 *   CAC001
     C                     Z-ADD201       DBASE            ************   CAC001
     C                     OUT  LDA                                       CAC001
     C                     EXSR *PSSR                                     CAC001
     C                     ELSE                                           CAC001
     C                     MOVE TPRFC     PRFC                            CAC001
      ** Save for possible need of restore                                                  MD022635
     C                     MOVE TPRFC     WSVPC                                             MD022635
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   130468
      * Accumulate CR interest/adj. amount for calculation of BRT.        130468
     C           S01383    IFEQ 'Y'                                       130468
     C           WDRCR     ANDEQ'1'                                       130468
     C                     SUB  WPSTA     @WCAIC                          130468
     C                     END                                            130468
     C/COPY WNCPYSRC,RE3664C019
     C*
     C** GEICPD FILE PROCESSING
     C*
     C           BCCY      IFEQ CCY                        - B4
     C           BRCA      ANDEQBBRCA
     C/COPY WNCPYSRC,RE3664C020
     C*
     C                     EXSR GEICPR
     C/COPY WNCPYSRC,RE3664C021
     C*
     C           VALD      IFLE NAPDA                      - B5
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C042
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD011       DBASE            * DB ERROR 011*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C           WCHGA     IFNE 0                                                             250998
     C                     Z-ADDWCHGA     CHGA                                                250998
     C                     END                                                                250998
     C                     WRITEREHPOSPF
     C                     Z-ADD0         CHGA                                                250998
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C/COPY WNCPYSRC,RE3664C210
     C*
     C                     END                             - E5
     C*
     C/COPY WNCPYSRC,RE3664C022
     C                     ELSE                            - X4
     C*
     C** IF DIFFERENT CURRENCY OR BRANCH PROCESS CROSS POSTING
     C*
     C                     EXSR CCYSR
     C                     END                             - E4
     C**********           END                                                        135809 135809R
     C                     END                                                              AR978914
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C** CHECK IF ACCOUNT KEY
     C*
     C***********          Z-ADD31        DBASE                           CRE002
     C                     Z-ADD012       DBASE            * DB ERROR 012*CRE002
     C           WALTK     CHAINACCNT               N99
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** ALTERNATE ACCOUNT NOT FOUND POST TO SUSPENS
     C           *IN99     IFEQ '1'                        - B2
     C*
     C** CHECKING DEBIT/CREDIT INDICATOR PROCESSING
     C*
     C                     EXSR DCIND
     C*
     C** SUSPENSE PROCESSING
     C*
     C                     EXSR SUSPR
     C*
     C                     ELSE                            - X2
     C*
     C** ALTERNATE ACCOUNT CLOSED POST TO SUSPENS
     C*
     C           AARECI    IFEQ 'D'                        - B3
      **If*CR*interest*(not*adjustment)*and*a/c*liable*for*withholding*************   135809 135809R
      **tax,*save*alt.*a/c*details*and*post*gross*interest*to*main*a/c.************   135809 135809R
     C********** WDRCR     IFEQ '1'                                                   135809 135809R
     C********** ATITAX    ANDEQ'Y'                                                   135809 135809R
     C********** SHISD     ANDEQCNCID                                                 135809 135809R
     C/COPY WNCPYSRC,REH00457
     C**********           Z-ADDCAIC      @CRINT                                      135809 135809R
     C**********           MOVE AABRCA    @CBRCA                                      135809 135809R
     C**********           Z-ADDAACNUM    @CCNUM                                       135809 CSD027
     C**********           MOVE AACNUM    @CCNUM                                      CSD027 135809R
     C**********           MOVE AACCY     @CCCY                                       135809 135809R
     C**********           Z-ADDAAACOD    @CACOD                                      135809 135809R
     C**********           Z-ADDAAACSQ    @CACSQ                                      135809 135809R
     C**********           Z-ADDAAACNO    @CACNO                                      135809 135809R
     C**********           MOVE AAATYP    @CATYP                                      135809 135809R
     C********** AAATYP    IFEQ 'R'                                                   135809 135809R
     C********** AAATYP    OREQ 'N'                                                   135809 135809R
     C**********           MOVE AAPRFC    @CPRFC                                      135809 135809R
     C**********           ELSE                                                       135809 135809R
     C**********           MOVE *BLANK    @CPRFC                                      135809 135809R
     C**********           END                                                        135809 135809R
     C**********           EXSR ACCPR                                                 135809 135809R
     C**********           ELSE                                                       135809 135809R
      *                                                                                     AR978914
      ** If CR interest (not adjustment) and a/c liable for withholding                     AR978914
      ** tax, save alt. a/c details and post gross interest to main a/c.                    AR978914
      *                                                                                     AR978914
     C           WDRCR     IFEQ '1'                                                         AR978914
     C           ATITAX    ANDEQ'Y'                                                         AR978914
     C           SHISD     ANDEQCNCID                                                       AR978914
     C                     Z-ADDCAIC      @CRINT                                            AR978914
     C                     MOVE AABRCA    @CBRCA                                            AR978914
     C                     MOVE AACNUM    @CCNUM                                            AR978914
     C                     MOVE AACCY     @CCCY                                             AR978914
     C                     Z-ADDAAACOD    @CACOD                                            AR978914
     C                     Z-ADDAAACSQ    @CACSQ                                            AR978914
     C                     Z-ADDAAACNO    @CACNO                                            AR978914
     C                     MOVE AAATYP    @CATYP                                            AR978914
     C           AAATYP    IFEQ 'R'                                                         AR978914
     C           AAATYP    OREQ 'N'                                                         AR978914
     C                     MOVE AAPRFC    @CPRFC                                            AR978914
     C                     ELSE                                                             AR978914
     C                     MOVE *BLANK    @CPRFC                                            AR978914
     C                     END                                                              AR978914
     C                     EXSR ACCPR                                                       AR978914
     C                     ELSE                                                             AR978914
     C*
     C                     MOVE 'P'       RECI
     C**********           Z-ADDAACNUM    CNUM                                                CSD027
     C                     MOVE AACNUM    CNUM                                                CSD027
     C                     MOVE AACCY     CCY
     C                     Z-ADDAAACOD    ACOD
     C/COPY WNCPYSRC,RE3664C091
     C                     Z-ADDAAACNO    ACNO
     C                     Z-ADDSHISD     VALD                            112808
     C                     MOVE AAATYP    ATYP
     C                     Z-ADDAAACSQ    ACSQ
     C*********************MOVE ABRCA     BRCA                            049320
     C                     MOVE AABRCA    BRCA                            049320
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP34                                           S01408
      *                                                                   S01408
     C*
     C                     EXSR TAXSR
      *                                                                                       250998
     C           VALD      IFGT PSTD                                                          250998
     C           VALD      ANDLTDNWD                                                          250998
     C           TRAT      ANDEQ91060                                                         250998
     C                     EXSR DETPR                                                         250998
     C                     ENDIF                                                              250998
      *                                                                   CAC001
      **  If Analytical Accounting installed, get profit centre of        CAC001
      **  the alternate account if it is retail or nostro                 CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           ATYP      IFEQ 'R'                                       CAC001
     C           ATYP      OREQ 'N'                                       CAC001
     C                     MOVE AAPRFC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   130468
      * Accumulate CR interest/adj. amount for calculation of BRT.        130468
     C           S01383    IFEQ 'Y'                                       130468
     C           WDRCR     ANDEQ'1'                                       130468
     C                     SUB  WPSTA     @WCAIC                          130468
     C                     END                                            130468
     C*
     C           ATYP      IFNE 'R'                        - B4
     C*
     C                     MOVE '0'       RIND
     C**********           Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C** GEICPD FILE PROCESSING
     C*
     C           BCCY      IFEQ CCY
     C           BRCA      ANDEQBBRCA
     C/COPY WNCPYSRC,RE3664C023
     C                     EXSR GEICPR
     C/COPY WNCPYSRC,RE3664C024
     C                     ELSE
     C                     EXSR CCYSR
     C                     END                              - E5
     C*
     C*
     C                     ELSE                            - X4
     C*
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C/COPY WNCPYSRC,RE3664C025
     C*
     C** GEICPD FILE PROCESSING
     C*
     C           BCCY      IFEQ CCY                        - B5
     C           BRCA      ANDEQBBRCA
     C/COPY WNCPYSRC,RE3664C026
     C                     EXSR GEICPR
     C/COPY WNCPYSRC,RE3664C027
     C*
     C           VALD      IFLE NAPDA                      - B6
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C043
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD32        DBASE                           CRE002
     C                     Z-ADD013       DBASE            * DB ERROR 013*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C           WCHGA     IFNE 0                                                             250998
     C                     Z-ADDWCHGA     CHGA                                                250998
     C                     END                                                                250998
     C                     WRITEREHPOSPF
     C                     Z-ADD0         CHGA                                                250998
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C/COPY WNCPYSRC,RE3664C211
     C*
     C                     END                             - E6
     C*
     C/COPY WNCPYSRC,RE3664C028
     C                     ELSE                            - X5
     C                     EXSR CCYSR
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C**********           END                                                        135809 135809R
     C                     END                                                              AR978914
     C*
     C                     ELSE                            - X3
     C*
     C                     MOVE 'P'       RECI
     C*********************Z-ADDAACNUM    ASOC                            080978
     C*
     C** CHECKING DEBIT/CREDIT INDICATOR PROCESSING
     C*
     C                     EXSR DCIND
     C*
     C** SUSPENSE PROCESSING
     C*
     C                     EXSR SUSPR
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP36                                           S01408
      *                                                                   S01408
     C*
     C                     ENDSR                           **ALTPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CCYSR subroutine to execute the capitalisation to an account
     C**       in different currency
     C**
     C**     Called by       ALTPR
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           CCYSR     BEGSR                           **CCYSR BEGSR**
     C*
     C** SAVE ACCOUNT OF ALTERNATE
     C*
     C                     MOVE CCY       ALCCY
     C                     MOVE BRCA      ALBRCA
     C**********           Z-ADDCNUM      ALCNUM                                              CSD027
     C                     MOVE CNUM      ALCNUM                                              CSD027
     C                     Z-ADDACOD      ALACOD
     C                     Z-ADDACSQ      ALACSQ
     C*
     C* SAVE ORIGINAL AMOUNT EARLIER.
     C                     Z-ADDWPSTA     WOPSTA
     C*
     C** CHECK IF ALTERNATE CURRENCY EXIST
     C*
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           ALCCY     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM ALCCY     @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 09 *CRE002
     C***********          Z-ADD009       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 014*CRE002
     C                     Z-ADD014       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C** SAVE PARM FOR CROSS CURRENCY
     C*
     C                     Z-ADDCDP       WACDP
     C                     Z-ADDSPOT      WASPOT
     C                     MOVE MDIN      WAMDIN
     C                     MOVE TACC      WATACC
     C*
     C**********           MOVE WATACC    KACOD   4                                           CGL029
     C                     MOVE WATACC    KACOD  10                                           CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD145       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                  CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSFDY                                      CGL029 CRE083BK
     C**********           PARM KACOD     @ACCD  10                                  CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C*
     C                     MOVE A5ACTY    WATACT
     C*
     C** CALCULATE THE BASE CURRENCY EQUIVALENT AMOUNT
     C*
     C                     MOVE BCCY      ZCCYI
     C                     Z-ADDWOSPOT    ZRATEF
     C                     MOVE WOCDP     ZCDPI
     C                     MOVE WOMDIN    ZMDINF
     C                     MOVE BACCY     ZCCYO
     C                     Z-ADDWBSPOT    ZRATET
     C                     MOVE WBCDP     ZCDPO
     C                     MOVE WBMDIN    ZMDINT
     C                     Z-ADDWPSTA     ZAMTCI
     C                     EXSR #CCYCN
     C                     Z-ADDZAMTCO    WPSTAB
     C*
     C           BCCY      IFNE ALCCY
     C*
     C** CALCULATE THE ALTERNATE CURRENCY EQUIVALENT AMOUNT
     C*
     C                     MOVE BCCY      ZCCYI
     C                     Z-ADDWOSPOT    ZRATEF
     C                     MOVE WOCDP     ZCDPI
     C                     MOVE WOMDIN    ZMDINF
     C                     MOVE ALCCY     ZCCYO
     C                     Z-ADDWASPOT    ZRATET
     C                     MOVE WACDP     ZCDPO
     C                     MOVE WAMDIN    ZMDINT
     C                     Z-ADDWPSTA     ZAMTCI
     C                     EXSR #CCYCN
     C                     Z-ADDZAMTCO    WPSTAA
     C*
     C*
     C** CALCUL THE EXCHANGE RATE
     C*
     C           WPSTAA    DIV  WPSTA     EXRT
     C*
     C           WDRCR     IFEQ '0'
     C                     Z-ADDEXRT      DEXRT
     C                     ELSE
     C           WDRCR     IFEQ '1'
     C                     Z-ADDEXRT      CEXRT
     C                     ELSE
     C           WDRCR     IFEQ '2'
     C                     Z-ADDEXRT      CHXRT
     C                     END
     C                     END
     C                     END
     C*
     C                     Z-ADDEXRT      NEXRT
     C                     Z-ADD4         ZADEC
     C                     Z-ADD2         ZADIG
     C                     MOVE NEXRT     ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    AEXRT   7
     C                     MOVE '%'       AEXRT1  8
     C                     MOVELAEXRT     AEXRT1
     C*
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C                     Z-ADDWPSTAA    WPSTA
     C*
     C                     END
     C*
     C                     EXSR GEICPR
     C*
     C           ATYP      IFEQ 'R'
     C*
     C** ALTERNATE IS A RETAIL ACCOUNT
     C*
     C           VALD      IFLE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C044
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD96        DBASE                           CRE002
     C                     Z-ADD015       DBASE            * DB ERROR 015*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END
     C*
     C                     END
     C*
     C                     Z-ADD*ZERO     ACNO
     C*
     C           BCCY      IFNE ALCCY
      *                                                                   CAC001
      **  Check if profit centre can hold FX Position                     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE PRFC      WSVPC   4                       CAC001
     C                     EXSR SRPRFC                                    CAC001
     C                     ENDIF                                          CAC001
     C*
     C** GENERATE THE POSTING FOR THE SPOT POSITION IN ALTERNATE
     C** CURRENCY
     C*
     C                     Z-SUBWPSTA     WPSTA
     C                     MOVE BBICN     CNUM
     C                     MOVE BBRCA     BRCA
     C                     MOVE SPAC      ACOD
     C                     MOVE WSPACT    ATYP
     C/COPY WNCPYSRC,RE3664C098
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C099
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C           ATYP      IFEQ 'R'
     C*
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C*
     C                     EXSR GEICPR
     C*
     C           VALD      IFLE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C045
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD95        DBASE                           CRE002
     C                     Z-ADD016       DBASE            * DB ERROR 016*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     EXSR POSPR
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       RIND
     C*************        Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C                     EXSR GEICPR
     C*
     C                     END
     C*
     C** GENERATE THE POSTING FOR THE SPOT EQUIVALENT ALTERNATE
     C** INTO BASE CURRENCY
     C*
     C                     MOVE BACCY     CCY
     C                     Z-ADDWPSTAB    WPSTA
     C                     MOVE WATACC    ACOD
     C                     MOVE WATACT    ATYP
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C           ATYP      IFEQ 'R'
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C*
     C                     EXSR GEICPR
     C*
     C           VALD      IFLE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C046
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD94        DBASE                           CRE002
     C                     Z-ADD017       DBASE            * DB ERROR 017*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     EXSR POSPR
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       RIND
     C*************        Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C                     EXSR GEICPR
     C*
     C                     END
      *                                                                                       228966
      ** Skip Base Ccy spot and Equivalent postings if the Original                           228966
      ** Ccy is Base and there is no Base Ccy Equivalent A/c of Base                          228966
      *                                                                                       228966
     C           BCCY      IFEQ BACCY                                                         228966
     C           WOTACC    ANDEQ*BLANKS                                                       228966
     C                     ELSE                                                               228966
     C*
     C** GENERATE THE POSTING FOR THE SPOT EQUIVALENT ORIGINAL
     C** CURRENCY INTO BASE CURRENCY
     C*
     C                     Z-SUBWPSTA     WPSTA
     C                     MOVE BBRCA     BRCA
     C                     MOVE BBICN     CNUM
     C/COPY WNCPYSRC,RE3664C100
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C101
     C                     MOVE WOTACC    ACOD
     C                     MOVE WOTACT    ATYP
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C           ATYP      IFEQ 'R'
     C*
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C*
     C                     EXSR GEICPR
     C*
     C           VALD      IFNE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C047
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD93        DBASE                           CRE002
     C                     Z-ADD018       DBASE            * DB ERROR 018*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     EXSR POSPR
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       RIND
     C*************        Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C                     EXSR GEICPR
     C*
     C                     END
     C*
     C** GENERATE THE POSTING FOR THE SPOT POSITION ACCOUNT
     C** CODE INTO ORIGINAL CURRENCY
     C*
     C                     Z-ADDWOPSTA    WPSTA
     C                     MOVE BCCY      CCY
     C                     MOVE SPAC      ACOD
     C                     MOVE WSPACT    ATYP
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C           ATYP      IFEQ 'R'
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C*
     C                     EXSR GEICPR
     C*
     C           VALD      IFLE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C048
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD92        DBASE                           CRE002
     C                     Z-ADD019       DBASE            * DB ERROR 019*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     EXSR POSPR
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       RIND
     C*************        Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C                     EXSR GEICPR
     C*
     C                     END
     C                     END                                                                228966
      *                                                                   CAC001
      **  Restore saved profit centre                                     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WSVPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C                     END
     C*
     C** CHECK IF MULTIBRANCH PROCESSING
     C*                                                       -B0
     C           MBIN      IFEQ 'Y'
     C*
     C** CHECK IF ORIGINAL BRANCH AND ALTERNATE BRANCH ARE THE SAME
     C*
     C           BBRCA     IFNE ALBRCA                        -B1
     C*
     C** GENERATE THE POSTING FOR THE ALTERNATE INTERBRANCH
     C*
      *                                                                   CAC001
      **  Use Primary Funding Centre for interbranch postings             CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE PRFC      WSVPC                           CAC001
     C                     MOVE FTPRFP    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C** ACCESS BRANCH CODES
     C*
     C                     Z-ADDCUBRCA    C                                                 CRE083BK
     C           ALBRCA    LOKUPABRC,C                   16                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN16     IFEQ '1'                                                         CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C           1         OCUR SDBRCH                                                      MD021155
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM ALBRCA    @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C***********          MOVEL@BRCA     DBKEY            * DB ERROR 24 *CRE002
     C***********          Z-ADD24        DBASE            ***************CRE002
     C                     MOVEL@BRCA     DBKEY            * DB ERROR 020*CRE002
     C                     Z-ADD020       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C                     MOVE BICN      ALBICN
     C                     MOVE BBICN     CNUM
     C           BKIEMB    IFEQ 'Y'
     C           BKMABR    IFNE BBRCA
     C           BKMABR    ANDNEALBRCA
     C                     MOVE BKBICN    CNUM
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,RE3664C102
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C103
     C                     MOVE ALCCY     CCY
     C           BCCY      IFNE ALCCY
     C                     Z-SUBWPSTAA    WPSTA
     C           WPSTAA    IFLT *ZEROS
     C                     MOVE A8DFAC    ACOD
     C                     ELSE
     C                     MOVE NBACB     ACOD
     C                     ENDIF
     C                     ELSE
     C                     Z-SUBWPSTA     WPSTA
     C           WPSTA     IFGT *ZEROS
     C                     MOVE A8DFAC    ACOD
     C                     ELSE
     C                     MOVE NBACB     ACOD
     C                     ENDIF
     C                     ENDIF
     C                     MOVE ALBRCA    BRCA
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE ACOD      KACOD   4                                           CGL029
     C                     MOVE ACOD      KACOD                                               CGL029
     C                     Z-ADD*ZEROS    DBASE
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD021       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                  CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSFDY                                      CGL029 CRE083BK
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 20 *CRE002
     C***********          Z-ADD020       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 024*           CRE002 CRE083BK
     C**********           Z-ADD021       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                                CCB003 CRE083BK
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    ATYP
     C*
     C           ATYP      IFEQ 'R'
     C*
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C*
     C                     EXSR GEICPR
     C*
     C           VALD      IFLE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C049
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD91        DBASE                           CRE002
     C                     Z-ADD022       DBASE            * DB ERROR 022*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     EXSR POSPR
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       RIND
     C*************        Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C                     EXSR GEICPR
     C*
     C                     END
     C*
     C** GENERATE THE POSTINGS INTER BRANCH ENTRIES VIA MAIN BRANCH
     C*
     C           BKIEMB    IFEQ 'Y'
     C           BKMABR    IFNE BBRCA
     C           BKMABR    ANDNEALBRCA
     C*
     C** ACCESS BRANCH CODES
     C*
     C                     Z-ADDCUBRCA    C                                                 CRE083BK
     C           BKMABR    LOKUPABRC,C                   16                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN16     IFEQ '1'                                                         CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C           1         OCUR SDBRCH                                                      MD021155
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BKMABR    @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C***********          MOVEL@BRCA     DBKEY            * DB ERROR 24 *CRE002
     C***********          Z-ADD24        DBASE            ***************CRE002
     C                     MOVEL@BRCA     DBKEY            * DB ERROR 023*CRE002
     C                     Z-ADD023       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C                     MOVE ALBICN    CNUM
     C           WPSTAA    IFLT *ZEROS
     C                     MOVE NBACB     ACOD
     C                     ELSE
     C                     MOVE A8DFAC    ACOD
     C                     ENDIF
     C/COPY WNCPYSRC,RE3664C104
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C105
     C                     MOVE ALCCY     CCY
     C                     Z-SUBWPSTA     WPSTA
     C                     MOVE BKMABR    BRCA
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE ACOD      KACOD   4                                           CGL029
     C                     MOVE ACOD      KACOD                                               CGL029
     C                     Z-ADD*ZEROS    DBASE
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD024       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 20 *CRE002
     C***********          Z-ADD020       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 024*           CRE002 CRE083BK
     C**********           Z-ADD024       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    ATYP
     C*
     C           ATYP      IFEQ 'R'
     C*
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C*
     C                     EXSR GEICPR
     C*
     C           VALD      IFLE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C050
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD91        DBASE                           CRE002
     C                     Z-ADD025       DBASE            * DB ERROR 025*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     EXSR POSPR
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       RIND
     C*************        Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C                     EXSR GEICPR
     C*
     C                     END
     C*
     C                     MOVE BBICN     CNUM
     C           WPSTAA    IFLT *ZEROS
     C                     MOVE A8DFAC    ACOD
     C                     ELSE
     C                     MOVE NBACB     ACOD
     C                     ENDIF
     C/COPY WNCPYSRC,RE3664C106
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C107
     C                     MOVE ALCCY     CCY
     C                     Z-SUBWPSTA     WPSTA
     C                     MOVE BKMABR    BRCA
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE ACOD      KACOD   4                                           CGL029
     C                     MOVE ACOD      KACOD                                               CGL029
     C                     Z-ADD*ZEROS    DBASE
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD026       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 20 *CRE002
     C***********          Z-ADD020       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 026*           CRE002 CRE083BK
     C**********           Z-ADD026       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    ATYP
     C*
     C           ATYP      IFEQ 'R'
     C*
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C*
     C                     EXSR GEICPR
     C*
     C           VALD      IFLE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C051
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD91        DBASE                           CRE002
     C                     Z-ADD027       DBASE            * DB ERROR 027*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     EXSR POSPR
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       RIND
     C*************        Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C                     EXSR GEICPR
     C*
     C                     END
     C*
     C                     ENDIF
     C*
     C                     ENDIF
     C*
     C** GENERATE THE POSTING FOR THE ORIGINAL INTERBRANCH
     C*
     C                     MOVE ALBICN    CNUM
     C           BKIEMB    IFEQ 'Y'
     C           BKMABR    IFNE BBRCA
     C           BKMABR    ANDNEALBRCA
     C                     MOVE BKBICN    CNUM
     C                     ENDIF
     C                     ENDIF
     C           WPSTA     IFGT *ZEROS
     C                     MOVE BNBACB    ACOD
     C                     MOVE BNBACT    ATYP
     C                     ELSE
     C                     MOVE BNDFAC    ACOD
     C                     MOVE BNDFAT    ATYP
     C                     ENDIF
     C/COPY WNCPYSRC,RE3664C108
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C109
     C                     MOVE ALCCY     CCY
     C                     MOVE BBRCA     BRCA
     C                     Z-SUBWPSTA     WPSTA
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C*
     C           ATYP      IFEQ 'R'
     C*
     C                     MOVE '1'       RIND
     C                     Z-ADDSHISD     VALD
     C*
     C                     EXSR GEICPR
     C*
     C           VALD      IFLE NAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C052
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD90        DBASE                           CRE002
     C                     Z-ADD028       DBASE            * DB ERROR 028*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     EXSR POSPR
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       RIND
     C*************        Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD                            100086
     C                     END                                            100086
     C*
     C                     EXSR GEICPR
     C*
     C                     END
      *                                                                   CAC001
      **  Restore saved profit centre                                     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WSVPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C                     END                             - E1
     C*
     C                     END                             - E0
     C*
     C                     Z-ADDWOPSTA    WPSTA
     C*
     C* RESTORE ORIGINAL ACCOUNT INFO
     C*
     C                     MOVE BCCY      CCY
     C                     MOVE BBRCA     BRCA
     C                     MOVE WACNO     ACNO
     C           1         OCUR SDBRCH                                                      MD022379
     C                     MOVE BBICN     BICN
     C                     MOVE BNBACB    NBACB
     C*
     C                     ENDSR                           **CCYSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CHGPR subroutine to execute charges processing
     C**
     C**     Called by       MAIN
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           CHGPR     BEGSR                           **CHGPR BEGSR**
     C*
     C                     Z-ADDTRAT      WTRAT
     C                     Z-ADD91050     TRAT
     C                     MOVEL'91050'   OTTP
     C*
     C                     MOVE '2'       WDRCR
     C                     Z-ADDCHGP      WPSTA
     C*********************Z-ADDBCNUM     ASOC                            080978
     C                     Z-ADDCNCID     CTLDAT
     C                     MOVELNAR,3     INPNAR
     C                     MOVELNR16,3    INP16
     C                     MOVELDN07,3    INP07
     C                     MOVELMGD,3     ##MGID                          S01522
     C/COPY WNCPYSRC,RE3664C010
     C*
     C** ACCESS RECRG FILE
     C*
     C***********          Z-ADD33        DBASE                           CRE002
     C                     Z-ADD029       DBASE            * DB ERROR 029*CRE002
     C                     MOVE *BLANK    ZZ001                           095656
     C           CHKEY     CHAINRECRG                99
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** ERROR IN RECRG
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C***********          Z-ADD1         DBASE            ***************CRE002
     C                     Z-ADD030       DBASE                           CRE002
     C***********          MOVE 'RECRG'   DBFILE           **DB ERROR 01**CCB003
     C                     MOVEL'RECRG'   DBFILE           **DB ERROR 01**CCB003
     C                     MOVELCHKEY     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             - E1
     C**********           MOVE CACOD     KACOD   4                                           CGL029
     C                     MOVE CACOD     KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD031       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 25 *CRE002
     C***********          Z-ADD025       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 031*           CRE002 CRE083BK
     C**********           Z-ADD031       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WCHGT
      *                                                                   CAC001
      **  Initially set profit centre to be profit centre of main a/c     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WMPRFC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C/COPY WNCPYSRC,RE3664CP12                                           S01408
     C*
     C** CHECK ON REFERENCE CHARGES INDICATOR :
     C** Y OR I = ACCOUNT PROCESSING
     C** A      = ALTERNATE PROCESSING
     C*
     C                     MOVE *BLANK    CSCHGI
     C           SCHGI     CASEQ'Y'       ACCPR
     C           SCHGI     CASEQ'I'       ACCPR
     C           SCHGI     CASEQ'A'       ALTPR
     C           SCHGI     CASEQ'P'       ALTPR
     C           SCHGI     CASEQ'Q'       ALTPR
     C           SCHGI     CASEQ'S'       SUSPR
     C           SCHGI     CASEQ'L'       ACCPR
     C           SCHGI     CASEQ'O'       ACCPR
     C                     END
     C*
     C                     Z-ADDCACOD     ACOD
     C                     MOVE WCHGT     ATYP
     C                     Z-SUBWPSTA     WPSTA
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVELCACOD     OTST                            CRE008
     C                     MOVE 'CACO'    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C*
     C* PROFIT AND LOSS PROCESSING
     C*
     C           SCHGI     IFNE ' '
     C                     EXSR PLPR
     C                     END
      *                                                                   CRE008
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVEL*BLANK    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C/COPY WNCPYSRC,RE3664C170
     C*
     C* SETUP CAPITALISATION RECORD PROCESSING
     C*
     C                     EXSR SSETUP
     C*
     C                     Z-ADDWTRAT     TRAT
     C                     MOVEL'91060'   OTTP
     C/COPY WNCPYSRC,RE3664C053
     C                     ENDSR                           **CHGPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CREPR subroutine to execute credit processing
     C**
     C**     Called by       MAIN
     C**     Calls           ACCPR,ALTPR,PLPR,SSETUP,SUSPR
     C**
      *****************************************************************   CCB003
     C           CREPR     BEGSR                           **CREPR BEGSR**
      *                                                                                     AR831847
      ** If German Tax is switched on and post net interest is 'Y'                          AR831847
      ** calculate and post net interest                                                    AR831847
      *                                                                                     AR831847
     C           CER048    IFEQ 'Y'                                                         AR831847
     C           WSV01     ANDEQ'Y'                                                         AR831847
     C           CAIC      ANDNE0                                                           AR831847
     C           SHISD     ANDEQCNCID                                                       MD032185
     C                     Z-ADD*ZERO     WTAOC                                             AR831847
     C                     Z-ADD*ZERO     WTATC                                             AR831847
     C                     Z-ADD*ZERO     WTABC                                             AR831847
     C                     MOVE 'N'       WEUTT                                             AR831847
      *                                                                                     AR831847
     C                     Z-ADD*ZEROS    WKSTXO                                            AR831847
     C                     Z-ADD*ZEROS    WKSTXT                                            AR831847
     C                     Z-ADD*ZEROS    WKSTXB                                            AR831847
     C                     Z-ADD*ZEROS    WKTTXO                                            AR831847
     C                     Z-ADD*ZEROS    WKTTXT                                            AR831847
     C                     Z-ADD*ZEROS    WKTTXB                                            AR831847
     C                     Z-ADDRCAIC     SVRCIC                                            AR831847
     C                     Z-ADDCAIC      RCAIC                                             AR831847
     C                     MOVE TRAT      SVTRAT                                            AR831847
     C                     EXSR SRRTAX                                                      AR831847
     C                     EXSR SREPOS                                                      AR831847
     C                     MOVE SVTRAT    TRAT                                              AR831847
     C                     Z-ADDCAIC      SVCAIC                                            AR831847
     C                     Z-ADDSVRCIC    RCAIC                                             AR831847
      *                                                                                     AR831847
     C           WTAOC     IFNE 0                                                           AR831847
     C           CAIC      IFGT 0                                                           AR831847
     C                     SUB  WTAOC     CAIC                                              AR831847
     C                     SUB  WKSTXO    CAIC                                              AR831847
     C                     SUB  WKTTXO    CAIC                                              AR831847
     C                     ELSE                                                             AR831847
     C                     ADD  WTAOC     CAIC                                              AR831847
     C                     ADD  WKSTXO    CAIC                                              AR831847
     C                     ADD  WKTTXO    CAIC                                              AR831847
     C                     ENDIF                                                            AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR676495
     C                     ELSE                                                             AR676495
      *                                                                                     AR676495
      ** CALCULATE/POST NET INTEREST OF INTEREST ADJUSTMENTS                                AR676495
      *                                                                                     AR676495
     C           CER048    IFEQ 'Y'                                                         AR676495
     C           WSV01     ANDEQ'Y'                                                         AR676495
     C           CAIC      ANDNE0                                                           AR676495
     C           SHISD     ANDLTCNCID                                                       AR676495
      *                                                                                     AR676495
     C                     Z-ADD*ZERO     WTAOC                                             AR676495
     C                     Z-ADD*ZERO     WTATC                                             AR676495
     C                     Z-ADD*ZERO     WTABC                                             AR676495
     C                     Z-ADD*ZERO     WKSTXO                                            AR676495
     C                     Z-ADD*ZERO     WKSTXT                                            AR676495
     C                     Z-ADD*ZERO     WKSTXB                                            AR676495
     C                     Z-ADD*ZERO     WKTTXO                                            AR676495
     C                     Z-ADD*ZERO     WKTTXT                                            AR676495
     C                     Z-ADD*ZERO     WKTTXB                                            AR676495
      *                                                                                     AR676495
     C                     Z-ADDRCAIC     SVRCIC                                            AR676495
     C                     Z-ADDCAIC      RCAIC                                             AR676495
     C                     MOVE TRAT      SVTRAT                                            AR676495
      *                                                                                     AR676495
     C                     EXSR SRINTA                                                      AR676495
     C                     EXSR SREPOS                                                      AR676495
      *                                                                                     AR676495
     C                     MOVE SVTRAT    TRAT                                              AR676495
     C                     Z-ADDCAIC      SVCAIC                                            AR676495
     C                     Z-ADDSVRCIC    RCAIC                                             AR676495
      *                                                                                     AR676495
     C           WTAOC     IFNE 0                                                           AR676495
     C           CAIC      IFGT 0                                                           AR676495
     C                     SUB  WTAOC     CAIC                                              AR676495
     C                     SUB  WKSTXO    CAIC                                              AR676495
     C                     SUB  WKTTXO    CAIC                                              AR676495
     C                     ELSE                                                             AR676495
     C           WTAOC     IFLT 0                                                           MD032185
     C                     SUB  WTAOC     CAIC                                              MD032185
     C                     SUB  WKSTXO    CAIC                                              MD032185
     C                     SUB  WKTTXO    CAIC                                              MD032185
     C                     ELSE                                                             MD032185
     C                     ADD  WTAOC     CAIC                                              AR676495
     C                     ADD  WKSTXO    CAIC                                              AR676495
     C                     ADD  WKTTXO    CAIC                                              AR676495
     C                     ENDIF                                                            MD032185
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     MOVE '1'       INTAD   1                                         AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR831847
     C*
     C/COPY WNCPYSRC,RE3664C138
     C           ZZ007     IFEQ 'DEB INT'                                                     CER049
     C                     MOVE *BLANKS   ZZ007                                               CER049
     C                     END                                                                CER049
     C                     MOVE '1'       WDRCR
     C*
     C/COPY WNCPYSRC,RE3664C160
     C           CAIC      IFNE 0                          - B0
     C                     Z-SUBCAIC      WPSTA
     C                     Z-ADDWPSTA     @WPSTA
     C*
     C                     MOVE *ZEROS    BRTAMT
     C                     MOVE *ZEROS    NETBRT
     C                     MOVE *ZEROS    STRBRT
     C                     MOVE *ZEROS    BSEBRT
      *                                                                   CAC001
      **  Initially set profit centre to be profit centre of main a/c     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WMPRFC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,RE3664C054
      *                                                                   179300
      **  Save the current value of NCID, to use later in BRT             179300
      **  processing.                                                     179300
      *                                                                   179300
     C                     MOVELNCID      NXTCID  50                      179300
      *                                                                   179300
     C*
     C****IF*BRT*SAR INSTALLED,                                           130468
     C****AND*IF*CREDIT INTEREST IS TO BE POSTED                          130468
     C*
     C********** S01383    IFEQ 'Y'                                       130468
     C********** SHISD     ANDEQCNCID                                     130468
     C********** S01383    OREQ 'Y'                                089741 130468
     C********** BDICI     ANDEQ'C'                                089741 130468
     C********** S01383    OREQ 'Y'                                089741 130468
     C********** BCICI     ANDEQ'C'                                089741 130468
     C********** SCCI      IFEQ 'Y'                                       130468
     C********** SCCI      OREQ 'I'                                       130468
     C********** WPSTA     ANDLT0
      *                                                                   CAC001
      ****Check*if profit centre can hold FX Position and then saveCAC001 130468
      ****the*FX*Position Profit Centre for later use              CAC001 130468
      *                                                                   CAC001
     C********** BGN0ST    IFEQ 'Y'                                CAC001 130468
     C**********           EXSR SRPRFC                             CAC001 130468
     C**********           MOVE PRFC      WFXPC   4                CAC001 130468
     C**********           ENDIF                                   CAC001 130468
     C**
     C****DO*BASIC*RATE TAX PROCESSING                                    130468
     C**
     C**********           EXSR BRTPRO                                    130468
     C**
     C**  OUTPUT BRT HISTORY RECORD IF NOT BRT EXEMPT
     C**
     C********** BRTCA     IFNE 'X'                                       130468
     C**********           EXSR OUTBRT                                    130468
     C**********           END                                            130468
     C*
     C**********           Z-SUBNETBRT    WPSTA                           130468
      *                                                                   CAC001
      ****Profit*centre set to main profit centre for subseq proc'gCAC001 130468
      *                                                                   CAC001
     C********** BGN0ST    IFEQ 'Y'                                CAC001 130468
     C**********           MOVE WMPRFC    PRFC                     CAC001 130468
     C**********           ENDIF                                   CAC001 130468
     C**********           END                                            130468
     C**********           END                                            130468
     C/COPY WNCPYSRC,RE3664C055
     C*
     C*********************Z-ADDBCNUM     ASOC                            080978
     C           CER048    IFEQ 'Y'                                                         AR831847
     C           WSV01     ANDEQ'Y'                                                         AR831847
     C                     ADD  SVCAIC    RCAIC                                             AR831847
     C                     ELSE                                                             AR831847
     C                     ADD  CAIC      RCAIC
     C                     ENDIF                                                            AR831847
     C/COPY WNCPYSRC,RE3664C139
     C*
     C           SHISD     IFEQ CNCID                      - B1
     C/COPY WNCPYSRC,RE3664C217
      *                                                                   104489
     C           BDICI     IFNE 'C'                        - B2           104489
     C                     MOVELNAR,2     INPNAR 30
     C                     MOVELNR16,2    INP16  16
     C**********           MOVELDN07,2    INP07   7                                           CGL029
     C                     MOVELDN07,2    INP07   6                                           CGL029
     C                     MOVELMGD,2     ##MGID                          S01522
     C**********           Z-ADD2         @INDX   20                                  135809 135809R
     C                     Z-ADD2         @INDX   20                                        AR978914
     C/COPY WNCPYSRC,RE3664C011
     C*********************ELSE                            - X1           104489
     C                     END                             - E2           104489
     C*                                                                   084082
     C***Default*narrative to 'BRT INTERESTI'                      084082 130468
     C**********           Z-ADD10        #                        084082 130468
     C*                                                                   057048
     C** IF CLOSURE CHANGE NARRATIVE                                      057048
     C***********BDICI     IFEQ 'C'                                057048 094681
     C***********BCICI     OREQ 'C'                                057048 094681
     C           BCICI     IFEQ 'C'                                       094681
     C           SCICI     ANDEQ'C'                                       094681
     C***********          MOVELNAR,11    NAR1                      057048087513
     C***********          Z-ADD11        #                         057048087513
     C***********          MOVELNR16,#    INP16                     057048087513
     C***********          MOVELDN07,#    INP07                     057048087513
     C***********          MOVELNAR,2     INPNAR                    087513088273
     C***********          MOVELNR16,2    INP16                     087513088273
     C***********          MOVELDN07,2    INP07                     087513088273
     C                     Z-ADD11        #                               088273
     C                     MOVELNAR,#     INPNAR                          088273
     C                     MOVELNR16,#    INP16                           088273
     C                     MOVELDN07,#    INP07                           088273
     C                     MOVELMGD,#     ##MGID                          189038
     C**********           Z-ADD#         @INDX                                       135809 135809R
     C                     Z-ADD#         @INDX                                             AR978914
     C                     END                             - E2           104489
      *                                                                   104489
     C                     ELSE                                           057048
     C***********          MOVELNAR,1     INPNAR                          135401
     C                     MOVELNAR,12    INPNAR                          135401
     C***********          MOVELNR16,1    INP16                           135401
     C*********            MOVELNR16,W    INP16                                        135401 235328
     C                     MOVELNR16,12   INP16                                               235328
     C                     MOVELDN07,12   INP07                                             MD022635
     C**********           MOVELDN07,1    INP07                                             MD022635
     C***********          MOVELMGD,1     ##MGID                   S01522 135401
     C                     MOVELMGD,12    ##MGID                          135401
     C/COPY WNCPYSRC,RE3664C184
     C**********           Z-ADD12        @INDX                                       135809 135809R
     C                     Z-ADD12        @INDX                                             AR978914
     C*
     C**  IF ADJUST INTEREST THEN SEND ON CHARGE OR PRODUCT
     C*
     C*********  SCCI      IFEQ 'S'
     C*********            MOVE 'L'       SCCI
     C*********            END
     C***********          END                                     057048 104489
     C/COPY WNCPYSRC,RE3664C012
     C*
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3664CP13                                           S01408
      *                                                                   S01408
     C** CHECK ON REFERENCE CREDIT CAPITALISATION INDICATOR :
     C** Y OR I = ACCOUNT PROCESSING
     C** S      = SUSPENSE PROCESSING
     C** A      = ALTERNATE PROCESSING
     C*
     C           WPSTA     IFNE 0
     C/COPY WNCPYSRC,RE3664C198
     C           SCCI      CASEQ'Y'       ACCPR
     C           SCCI      CASEQ'I'       ACCPR
     C           SCCI      CASEQ'S'       SUSPR
     C           SCCI      CASEQ'L'       SUSPR
     C           SCCI      CASEQ'O'       SUSPR
     C           SCCI      CASEQ'A'       ALTPR
     C                     END
     C/COPY WNCPYSRC,RE3664C199
     C                     END
     C/COPY WNCPYSRC,RE3664C056
     C*
     C********** S01383    IFEQ 'Y'                                       130468
     C********** BRTAMT    ANDNE0                                         130468
     C**********           CALL 'AOBRCHR0'
     C**********           PARM '*MSG   ' @RTCD
     C**********           PARM '*KEY   ' @OPTN
     C**********           PARM BBRCA     @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY
     C********** @RTCD     IFNE *BLANK
     C********** *LOCK     IN   LDA
     C**********           MOVEL'SDBRCHPD'DBFILE           ***************
     C**********           MOVEL@BRCA     DBKEY            * DB ERROR 30 *
     C**********           Z-ADD30        DBASE            ***************
     C**********           OUT  LDA
     C**********           WRITEERRP1
     C**********           EXSR *PSSR
     C**********           END
     C****************     MOVE BICN      CNUM
     C**********           MOVE BBICN     CNUM                            130468
     C**********           MOVE BCCY      CCY                             130468
     C*
     C**********           MOVE 'D'       RECI
     C********** RECI      CHAINSDBRTDD0             99    (99 = EOF)
     C***99*****           SETON                     U7LR  ** DB ERROR 98
     C***99*****           MOVEL'SDBRTDPD'DBFILE
     C***99*****           MOVELRECI      DBKEY
     C***99*****           Z-ADD98        DBASE
     C***99*****           EXSR *PSSR
     C*
     C**********           MOVE ACOD1     ACOD                            130468
     C/COPY WNCPYSRC,RE3664C110
     C**********           MOVE '01'      ACSQ                            130468
     C/COPY WNCPYSRC,RE3664C111
     C**********           Z-ADD0         ACNO                            130468
     C**********           Z-ADDRUND      PSTD                            130468
     C**********           Z-ADD91060     TRAT                            130468
     C**********           MOVEL'BRT '    @PNARX 12
     C**********           MOVE 'INTEREST'@PNARX
     C**********           MOVEL@PNARX    NARS
     C**********           MOVELNAR,#     INPNAR                          130468
     C**********           MOVELNR16,#    INP16                           130468
     C**********           MOVELDN07,#    INP07                           130468
     C**********           MOVELMGD,#     ##MGID                   S01522 130468
     C*
     C**********           Z-SUBBRTAMT    WPSTA                           130468
     C**********           MOVE '1'       DRCR
     C*********************MOVE BCNUM     ASOC                            080978
     C**********           Z-ADD0         CHQN                            130468
     C**********           MOVE ABRCA     BRCA                            130468
     C**********           Z-ADD0         REJC                            130468
     C*************        MOVE '000'     DPMT                            105084
     C**********           MOVE '   '     DPMT                      105084130468
     C**********           Z-ADD0         RRNM                            130468
     C**********           MOVE 'P'       RECI
     C*
     C**********           MOVE 'C'       GETP                            130468
     C**********           Z-ADD0         ACUM                            130468
     C**********           Z-ADD235959    PTIM                            130468
     C**********           Z-ADD0         VOIN                            130468
     C**********           Z-ADD0         LTAI                            130468
     C**********           Z-ADD0         DBCNUM                          130468
     C**********           MOVEL'91060'   OTTP                            130468
     C**********           Z-ADD0         SDCB                            130468
     C**********           Z-ADD0         SDLB                            130468
     C**********           Z-ADD1         NITMS                           130468
     C**********           Z-ADD0         CHGA                            130468
     C*
     C**********           EXSR PLPR                                      130468
     C**********           END                                            130468
     C/COPY WNCPYSRC,RE3664C057
      *                                                                                     AR831847
      ** Restore value of CAIC before reduction of taxes                                    AR831847
      *                                                                                     AR831847
     C           CER048    IFEQ 'Y'                                                         AR831847
     C           WSV01     ANDEQ'Y'                                                         AR831847
     C                     Z-ADDSVCAIC    CAIC                                              AR831847
     C                     Z-SUBSVCAIC    @WPSTA                                            AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C*
     C           SCCI      IFNE *BLANK                     - B1
     C/COPY WNCPYSRC,RE3664C224
     C                     Z-ADDCAPC      ACOD
     C/COPY WNCPYSRC,RE3664C127
     C                     MOVE WCAPCT    ATYP
     C*
     C* PROFIT AND LOSS PROCESSING
     C*
     C**********           Z-ADD@WPSTA    WPSTA
     C                     Z-SUB@WPSTA    WPSTA
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVELCAPC      OTST                            CRE008
     C                     MOVE 'CAPC'    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C**********           Z-ADD@INDX     #                                           135809 135809R
     C                     Z-ADD@INDX     #                                                 AR978914
     C**********           MOVELNAR,2     INPNAR                   071428 135809
     C**********           MOVELNR16,2    INP16                    071428 135809
     C**********           MOVELDN07,2    INP07                    071428 135809
     C**********           MOVELNAR,#     INPNAR                                      135809 135809R
     C**********           MOVELNR16,#    INP16                                       135809 135809R
     C                     MOVELNAR,#     INPNAR                                            AR978914
     C                     MOVELNR16,#    INP16                                             AR978914
     C**********           MOVELMGD,#     ##MGID                                     189038 AR577206
     C**********           MOVELDN07,#    INP07                                       135809 135809R
     C**********           MOVELNAR,2     INPNAR                                    135809R AR978914
     C**********           MOVELNR16,2    INP16                                     135809R AR978914
     C**********           MOVELDN07,2    INP07                                     135809R AR978914
     C                     MOVELDN07,#    INP07                                             AR978914
     C**********           MOVELMGD,2     ##MGID                                   AR577206 MD022635
     C                     MOVELMGD,#     ##MGID                                            MD022635
     C/COPY WNCPYSRC,RE3664C058
     C                     MOVE 'Y'       UPDCUS                                            MD027841
     C                     EXSR PLPR
     C                     MOVE *BLANKS   UPDCUS                                            MD027841
      *                                                                   CRE008
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVEL*BLANK    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C                     END                             - E0
      *                                                                   091680
     C                     END                             - E1           091680
     C*
     C/COPY WNCPYSRC,RE3664CP11                                           S01408
     C*                                                                   S01408
     C* SETUP CAPITALISATION RECORD PROCESSING
     C*
     C                     EXSR SSETUP
     C*
     C***********          END                             - E1           091680
     C*
     C/COPY WNCPYSRC,RE3664CCP7                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **CREPR ENDSR**
     C********************************************************************
     C/COPY WNCPYSRC,RE3664C128
     C/EJECT
     C********************************************************************
     C**
     C** ZDATE2  Subroutine to convert day number to date format
     C**
     C**       Called by
     C**
     C**       Calls       -
     C**
     C/COPY ZSRSRC,ZDATE2Z2
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZDATE1  Subroutine to validate and convert date to a day no.
     C**
     C**       Called by
     C**
     C**       Calls       -
     C**
     C/COPY ZSRSRC,ZDATE1Z2
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZCHKH  Subroutine to check if holiday
     C**
     C**       Called by
     C**
     C**       Calls       -
     C**
     C/COPY ZSRSRC,ZCHKH
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZACCH  Access the holiday file
     C**
     C**       Called by
     C**
     C**       Calls       -
     C**
     C/COPY ZSRSRC,ZACCH
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** *PSSR subroutine for database error handling
     C**
     C**     Called by       FIRST
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           *PSSR     BEGSR                           **PSSR BEGSR**
     C/COPY WNCPYSRC,RE3664C175
     C*
     C                     OPEN RE3664AU                                  CCB003
     C/COPY WNCPYSRC,RE3664C176
     C                     WRITEHEADAU                                    CCB003
      *                                                                   CCB003
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     WRITEERRAU
      *                                                                   CCB003
     C                     CLOSERE3664AU                                  CCB003
     C*
     C                     RETRN
     C*
     C                     ENDSR                           **PSSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DCIND subroutine to execute checking debit/credit indicator
     C**
     C**     Called by       ALTPR,SUSPR
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           DCIND     BEGSR                           **DCIND BEGSR**
     C*
     C           WDRCR     IFEQ '0'                        - B1
     C                     MOVE 'S'       SDCI
     C                     ELSE                            - X1
     C           WDRCR     IFEQ '1'                        - B2
     C                     MOVE 'S'       SCCI
     C                     ELSE                            - X2
     C           WDRCR     IFEQ '2'                        - B3
     C                     MOVE 'S'       SCHGI
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     ENDSR                           **DCIND ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DEBPR subroutine to execute debit processing
     C**
     C**     Called by       MAIN
     C**     Calls           ACCPR,ALTPR,PLPR,SSETUP,SUSPR
     C**
      *****************************************************************   CCB003
     C           DEBPR     BEGSR                           **DEBPR BEGSR**
     C*
     C                     MOVE '0'       WDRCR
     C/COPY WNCPYSRC,RE3664C161
     C           DAIC      IFNE 0                          - B0
     C                     Z-ADDDAIC      WPSTA
     C*********************Z-ADDBCNUM     ASOC                            080978
     C                     ADD  DAIC      RDAIC
     C/COPY WNCPYSRC,RE3664C129
     C*
     C           SHISD     IFEQ CNDID                      - B1
     C/COPY WNCPYSRC,RE3664C218
      *                                                                   104489
     C           BDICI     IFNE 'C'                                       104489
     C                     ADD  REGLIS    WPSTA
     C                     ADD  REGLIS    RDAIC
     C                     MOVELNAR,2     INPNAR
     C                     MOVELNR16,2    INP16
     C                     MOVELDN07,2    INP07                           S01522
     C                     MOVELMGD,2     ##MGID
     C                     END                             - E2           104489
     C/COPY WNCPYSRC,RE3664C013
     C***********          ELSE                            - X1           104489
     C*                                                                   084082
     C***Default*narrative to 'BRT INTERESTI'                      084082 130468
     C**********           Z-ADD10        #                        084082 130468
     C*                                                                   057048
     C** IF CLOSURE CHANGE NARRATIVE                                      057048
     C           BDICI     IFEQ 'C'                                       057048
     C***********BCICI     OREQ 'C'                                057048 094681
     C           SDICI     ANDEQ'C'                                       094681
     C***********          MOVELNAR,11    NAR1                      057048087513
     C***********          Z-ADD11        #                         057048087513
     C***********          MOVELNR16,#    INP16                     057048087513
     C***********          MOVELDN07,#    INP07                     057048087513
     C***********          MOVELNAR,2     INPNAR                    087513088273
     C***********          MOVELNR16,2    INP16                     087513088273
     C***********          MOVELDN07,2    INP07                     087513088273
     C                     Z-ADD11        #                               088273
     C                     MOVELNAR,#     INPNAR                          088273
     C                     MOVELNR16,#    INP16                           088273
     C                     MOVELDN07,#    INP07                           088273
     C                     MOVELMGD,#     ##MGID                          189038
     C/COPY WNCPYSRC,RE3664C185
     C                     END                                            104489
      *                                                                   104489
     C                     ELSE                                           057048
     C                     MOVELNAR,1     INPNAR
     C                     MOVELNR16,1    INP16
     C                     MOVELDN07,1    INP07
     C                     MOVELMGD,1     ##MGID                          S01522
     C*
     C**  IF ADJUST INTEREST THEN SEND ON CHARGE OR PRODUCT
     C*
     C           SDCI      IFEQ 'S'
     C                     MOVE 'L'       SDCI
     C                     END
     C***********          END                                     057048 104489
     C*
     C/COPY WNCPYSRC,RE3664C014
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3664C200
      *                                                                   CAC001
      **  Initially set profit centre to be profit centre of main a/c     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WMPRFC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C/COPY WNCPYSRC,RE3664CP14                                           S01408
      *                                                                   S01408
     C           ZZ007     IFEQ *BLANKS                                                       CER049
     C                     MOVE 'DEB INT' ZZ007                                               CER049
     C                     END                                                                CER049
     C** CHECK ON REFERENCE DEBIT CAPITALISATION INDICATOR :
     C** Y OR I = ACCOUNT PROCESSING
     C** S      = SUSPENSE PROCESSING
     C** A      = ALTERNATE PROCESSING
     C*
     C           SDCI      CASEQ'Y'       ACCPR
     C           SDCI      CASEQ'I'       ACCPR
     C           SDCI      CASEQ'S'       SUSPR
     C           SDCI      CASEQ'L'       SUSPR
     C           SDCI      CASEQ'O'       SUSPR
     C           SDCI      CASEQ'A'       ALTPR
     C                     END
     C/COPY WNCPYSRC,RE3664C092
     C           ZZ007     IFEQ 'DEB INT'                                                     CER049
     C                     MOVE *BLANKS   ZZ007                                               CER049
     C                     END                                                                CER049
     C*
     C           SDCI      IFNE *BLANK                     - B1
     C/COPY WNCPYSRC,RE3664C225
     C                     Z-ADDCAPD      ACOD
     C/COPY WNCPYSRC,RE3664C130
     C                     MOVE WCAPDT    ATYP
     C                     Z-SUBWPSTA     WPSTA
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVELCAPD      OTST                            CRE008
     C                     MOVE 'CAPD'    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C*
     C* PROFIT AND LOSS PROCESSING
     C*
     C                     MOVE 'Y'       UPDCUS                                            MD027841
     C                     EXSR PLPR
     C                     MOVE *BLANKS   UPDCUS                                            MD027841
     C/COPY WNCPYSRC,RE3664C226
      *                                                                   CRE008
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVEL*BLANK    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C                     END                             - E0
      *                                                                   091680
     C                     END                             - E1           091680
     C/COPY WNCPYSRC,RE3664C169
     C*
     C* SETUP CAPITALISATION RECORD PROCESSING
     C*
     C                     EXSR SSETUP
     C*
     C***********          END                             - E1           091680
     C*
     C/COPY WNCPYSRC,RE3664CCP8                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **DEBPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** FIRST subroutine to execute first cycle.
     C**
     C**     Called by       S T A R T
     C**     Calls           *PSSR,INITPR
     C**
      *****************************************************************   CCB003
     C           FIRST     BEGSR                           **FIRST BEGSR**
     C*
     C           *NAMVAR   DEFN           LDA
     C*
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C*
     C/COPY WNCPYSRC,RE3664CP10                                           S01408
      *                                                                                       CDL013
      ** Check if CDL013 is installed                                                         CDL013
     C                     CALL 'AOSARDR0'                                                    CDL013
     C                     PARM *BLANKS   @RTCD   7                                           CDL013
     C                     PARM '*VERIFY' @OPTN   7                                           CDL013
     C                     PARM 'CDL013'  @SARD   6                                           CDL013
     C                     PARM           DSFDY                                               CDL013
      *                                                                                       CDL013
      ** If CDL013 NOT installed, set CAR indicator to '0'                                    CDL013
     C           @RTCD     IFNE *BLANKS                                                       CDL013
     C                     MOVE '0'       CDL013  1                                           CDL013
      *                                                                                       CDL013
      ** If CDL013 installed                                                                  CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      ** Set CAR indicator to '1' and declare work field to                                   CDL013
      ** access WHT ICD extension file.                                                       CDL013
     C                     MOVE '1'       CDL013                                              CDL013
     C                     MOVEL'RETAIL'  WTYPE  10 P                                         CDL013
      ***************************************************************                CDL013 CRE083BE
      ***Open*&*access*WHT*ICD*extension*file*to*retrieve*WHT*rate***                CDL013 CRE083BE
     C**********           OPEN SDSTAAL1                                             CDL013 CRE083BE
     C********** WTYPE     CHAINSDSTAAL1             40                              CDL013 CRE083BE
      ***************************************************************                CDL013 CRE083BE
      ***If*CHAIN*failed,*terminate*the*program**********************                CDL013 CRE083BE
     C********** *IN40     IFEQ '1'                                                  CDL013 CRE083BE
     C********** *LOCK     IN   LDA                                                  CDL013 CRE083BE
     C**********           MOVEL'SDSTAAL1'DBFILE           ************              CDL013 CRE083BE
     C**********           MOVELWTYPE     DBKEY            * DBERR 141*              CDL013 CRE083BE
     C**********           Z-ADD141       DBASE            ************              CDL013 CRE083BE
     C**********           OUT  LDA                                                  CDL013 CRE083BE
     C**********           EXSR *PSSR                                                CDL013 CRE083BE
     C**********           ENDIF                                                     CDL013 CRE083BE
      ***************************************************************                CDL013 CRE083BE
      ***Open*WHT*Customer*History*file,*Retail*WHT*Extract*file,****                CDL013 CRE083BE
      ***Account*Details*Extension*file*&*Account*Code*Extension*file.               CDL013 CRE083BE
     C**********           OPEN GLWHTCL0                                             CDL013 CRE083BE
     C**********           OPEN GLXTAXL0                                             CDL013 CRE083BE
     C**********           OPEN ACCNTBY0                                             CDL013 CRE083BE
     C**********           OPEN SDACOAL0                                             CDL013 CRE083BE
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C*                                                                   S01408
     C** SET UP INDICATOR 98 BASED ON THE DATE FORMAT.
     C*
     C           DATF      IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ELSE
     C                     MOVE '0'       *IN98
     C                     END
     C*
     C                     SETON                     41
     C*
     C** INITIALISE LDA VARIABLES
     C*
     C***********          MOVE 'RE3664  'DBPGM                           CCB003
     C                     MOVEL'RE3664'  DBPGM     P                     CCB003
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C*
     C           MBIN      IFEQ 'Y'
     C                     SETON                     79
     C                     ELSE
     C                     SETOF                     79
     C                     END
     C*
     C***Ensure*Report*Spool*File*Recorded*by*RCF                         CCB003
     C***********                                                         CCB003
     C***********          Z-ADDSFNUMU    ZSNUMU  60                      CCB003
     C***********          CALL 'ZSFILE'                                  CCB003
     C***********          PARM *BLANKS   @SEQ    5                       CCB003
     C***********          PARM BBRCA     SENTY   3                       CCB003
     C***********          PARM           SFILEU                          CCB003
     C***********          PARM           ZSNUMU                          CCB003
     C***********          PARM *BLANKS   ZSERRU  1                       CCB003
     C***********                                                         CCB003
     C***Error*During*ZSFILE*Processing,*Return*to*Calling*Program        CCB003
     C***********                                                         CCB003
     C***********ZSERRU    IFEQ 'Y'                                       CCB003
     C***********          MOVE '1'       *INU7                           CCB003
     C***********          MOVE '1'       *INU8                           CCB003
     C***********          MOVE '1'       *INLR                           CCB003
     C************LOCK     IN   LDA                                       CCB003
     C***********          MOVEL'ZSFILE  'DBFILE           ***************CCB003
     C***********          MOVELBBRCA     DBKEY            * DB ERROR 36 *CCB003
     C***********          Z-ADD36        DBASE            ***************CCB003
     C***********          OUT  LDA                                       CCB003
     C*********************WRITEERRP1                                     088181
     C***********          EXSR *PSSR                                     CCB003
     C***********          RETRN                                          CCB003
     C***********          END                                            CCB003
     C*
     C** ACCESS SDMMODPD  TO CHECK IF CANTONAL TAX IS USED OR NOT
     C*
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDMMOD    PARM SDMMOD    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDMMODPD'DBFILE           ***************
     C***********          MOVEL@OPTN     DBKEY            * DBERROR 083 *CRE002
     C***********          Z-ADD083       DBASE            ***************CRE002
     C                     MOVEL@OPTN     DBKEY            * DBERROR 033 *CRE002
     C                     Z-ADD033       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   CAC001
      **  Access PF/SDPCACPD for Profit Centre Accounting ICD IF          CAC001
      **  Analytical Accounting is installed                              CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
     C                     CALL 'AOPCACR0'                                CAC001
     C                     PARM '*MSG   ' @RTCD                           CAC001
     C                     PARM '*FIRST ' @OPTN                           CAC001
     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC001
      *                                                                   CAC001
     C           @RTCD     IFNE *BLANK                                    CAC001
     C           *LOCK     IN   LDA                                       CAC001
     C                     MOVEL'SDPCACPD'DBFILE           ************   CAC001
     C                     MOVEL@OPTN     DBKEY            * DBER 200 *   CAC001
     C                     Z-ADD200       DBASE            ************   CAC001
     C                     OUT  LDA                                       CAC001
     C                     EXSR *PSSR                                     CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,REH00425
      *                                                                   S01522
      * Call SAR prog. for switchable feature                             S01522
     C           BGN1ST    IFEQ 'Y'                        B1             S01522
     C/COPY WNCPYSRC,REH00426
     C                     CALL 'AOSARDR0'                  1             S01522
     C                     PARM '       ' @RTCD             1             S01522
     C                     PARM '*VERIFY' @OPTN             1             S01522
     C                     PARM 'REPNAR'  @SARD   6         1             S01522
     C           SCSARD    PARM SCSARD    DSFDY             1             S01522
     C           @RTCD     IFNE *BLANK                     B2             S01522
     C           @RTCD     ANDNE'*NRF   '                   2             S01522
     C           *LOCK     IN   LDA                         2             S01522
     C                     MOVEL'SCSARDPD'DBFILE            ************* S01522
     C***********          MOVEL'067'     DBASE       *DBERROR 067* S01522CRE002
     C                     Z-ADD034       DBASE             *DBERROR 034  CRE002
     C                     MOVEL@SARD     DBKEY             ************* S01522
     C                     OUT  LDA                                       S01522
     C                     EXSR *PSSR                       2             S01522
     C                     END                             E2             S01522
     C           @RTCD     IFEQ *BLANK                     B2             S01522
     C                     MOVEL'Y'       REPNAR  1         2             S01522
     C                     END                             E2             S01522
     C                     END                             E1             S01522
     C/COPY WNCPYSRC,REH00168
     C*
     C* Tax installed access Tax ICD for rate. Default is ZERO.
     C*
     C                     Z-ADD0         TXWTRR
      *                                                                   CPB001
      **  If Private Banking Module is installed.                         CPB001
     C           BGN4ST    IFEQ 'Y'                         Begin BGN4ST  CPB001
      *                                                                   CPB001
      **  Set up Replication Processing Work field.                       CPB001
     C                     MOVE 'Y'       WUREPL  1                       CPB001
      *                                                                   CPB001
     C                     ENDIF                            End BGN4ST    CPB001
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CCP5                                           S01408
     C*                                                                   S01408
     C           BGNTST    IFEQ 'Y'
     C                     OPEN SDSTAXPD
     C           1         CHAINSDSTAXPD             93
     C                     CLOSESDSTAXPD
     C                     END
     C*
     C** ERROR IN SDSTAXPD
     C*
     C           *IN93     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C***********          Z-ADD84        DBASE            ***************CRE002
     C                     Z-ADD035       DBASE                           CRE002
     C***********          MOVE 'SDTAX'   DBFILE           **DB ERROR 84**CCB003
     C                     MOVEL'SDTAX'   DBFILE           **DB ERROR 84**CCB003
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3664CCP4                                           S01408
     C*                                                                   S01408
     C** ACCESS BANK DETAILS
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ***************
     C***********          MOVEL@OPTN     DBKEY            * DBERROR 004 *CRE002
     C***********          Z-ADD004       DBASE            ***************CRE002
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 036*CRE002
     C                     Z-ADD036       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   085787
      ** Setup JOB NAME title to indicate from which COB run of the       085787
      **  RE3664 this report is received.                                 085787
      *                                                                   085787
      ** Excluded from REFERENCE (JBNM1) are standard REC64A/N run        085787
      *                                                                   085787
     C                     MOVELPGJBNM    JBNM1  10                       085787
     C           PGJBNM    IFEQ REC64A                                    085787
     C           PGJBNM    OREQ REC64N                                    085787
     C                     MOVE *BLANKS   JBNM1                           085787
     C                     ENDIF                                          085787
      *                                                                   085787
      ** Print 'ALTERNATE A/Cs' if Alt Acc run being executed             085787
      *                                                                   085787
     C                     MOVE *BLANKS   JBNM2  14                       085787
     C           PGJBNM    LOKUPTAB1      TABA           99               085787
     C           *IN99     IFEQ *ON                                       085787
     C                     MOVELTABA      JBNM2                           085787
     C                     ENDIF                                          085787
     C                     MOVE *OFF      *IN99                           085787
     C*
     C/COPY WNCPYSRC,RE3664CCP6                                           S01408
     C*                                                                   S01408
     C***OUTPUT*AUDIT*HEADER                                              CCB003
     C***********                                                         CCB003
     C***********          WRITEHEADAU                                    CCB003
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C/COPY WNCPYSRC,RE3664C207
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDGELRPD'DBFILE           ***************
     C***********          MOVEL@OPTN     DBKEY            * DBERROR 005 *CRE002
     C***********          Z-ADD005       DBASE            ***************CRE002
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 037*CRE002
     C                     Z-ADD037       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                                     CRE083BK
      ** Full Cache SDCURRPD                                                                CRE083BK
      *                                                                                     CRE083BK
     C                     Z-ADD250       A       30                                        CRE083BK
     C**********           Z-ADD250       F       30                               CRE083BK MD021155
     C           A         OCUR SDCURR                                                      CRE083BK
     C********** F         OCUR SDRETR                                             CRE083BK MD021155
      *                                                                                     CRE083BK
     C                     OPEN SDCURRL1                                                      CGL165
     C                     READ SDCURRL1                 13                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN13     DOWEQ*OFF                                                        CRE083BK
      *          A         ANDGT1                                                           CRE083BK
     C********** A         ANDGT1                                                 AR1093681 MD021155
     C           A         ANDGT2                                                           MD021155
     C                     MOVE A6CYCD    ACUR,A                                            CRE083BK
     C                     MOVE A6NBDP    CDP                                               CRE083BK
     C                     MOVE A6SPRT    SPOT                                              CRE083BK
     C                     MOVE A6MDIN    MDIN                                              CRE083BK
     C                     MOVE A6ERLC    ERLC                                              CRE083BK
     C                     MOVE A6TXND    TNOT                                              CRE083BK
     C                     MOVE A6CYNM    CCNM                                              CRE083BK
     C                     MOVE A6SPAE    TACC                                              CRE083BK
     C                     MOVE A6SSNB    SSNO                                              CRE083BK
     C                     MOVE A6TXCR    TXCR                                              CGL165
      *                                                                                     CRE083BK
     C**********           MOVEL'   '     BLNKTR  8                                CRE083BK MD021155
     C**********           MOVE '91060'   BLNKTR                                   CRE083BK MD021155
     C**********           MOVELA6CYCD    CCYD    4                                CRE083BK MD021155
     C**********           MOVE 'D'       CCYD                                     CRE083BK MD021155
     C**********           MOVELBLNKTR    KEYTRG 12                                CRE083BK MD021155
     C**********           MOVE CCYD      KEYTRG                                   CRE083BK MD021155
     C**********           MOVE KEYTRG    ARET,F                                   CRE083BK MD021155
     C                     SUB  1         A                                                 CRE083BK
     C**********           SUB  1         F                                        CRE083BK MD021155
      *                                                                                     CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     READ SDCURRL1                 13                                 CRE083BK
     C********** *IN13     IFEQ *ON                                               CRE083BK AR1096650
     C**********           ADD  1         A                                       CRE083BK AR1096650
     C**********           ADD  1         F                                       CRE083BK AR1096650
     C**********           ENDIF                                                  CRE083BK AR1096650
     C                     ENDDO                                                            CRE083BK
      *                                                                                     CRE083BK
      ** If count less than array size                                                     AR1096650
      *                                                                                    AR1096650
     C           *IN13     IFEQ *ON                                                        AR1096650
     C           A         ANDLT250                                                        AR1096650
     C                     ADD  1         A                                                AR1096650
     C**********           ADD  1         F                                       AR1096650 MD021155
     C                     ENDIF                                                           AR1096650
      *                                                                                    AR1096650
      ** If count is at least equal to array size                                          AR1096650
      *                                                                                    AR1096650
     C********** A         IFEQ 1                                                 AR1096650 MD021155
     C           A         IFEQ 2                                                           MD021155
     C                     MOVE A6CYCD    ACUR,A                                           AR1096650
     C                     MOVE A6NBDP    CDP                                               MD021155
     C                     MOVE A6SPRT    SPOT                                              MD021155
     C                     MOVE A6MDIN    MDIN                                              MD021155
     C                     MOVE A6ERLC    ERLC                                              MD021155
     C                     MOVE A6TXND    TNOT                                              MD021155
     C                     MOVE A6CYNM    CCNM                                              MD021155
     C                     MOVE A6SPAE    TACC                                              MD021155
     C                     MOVE A6SSNB    SSNO                                              MD021155
     C                     MOVE A6TXCR    TXCR                                              CGL165
      *                                                                                     MD021155
     C**********           MOVEL'   '     BLNKTR                                  AR1096650 MD021155
     C**********           MOVE '91060'   BLNKTR                                  AR1096650 MD021155
     C**********           MOVELA6CYCD    CCYD                                    AR1096650 MD021155
     C**********           MOVE 'D'       CCYD                                    AR1096650 MD021155
     C**********           MOVELBLNKTR    KEYTRG                                  AR1096650 MD021155
     C**********           MOVE CCYD      KEYTRG                                  AR1096650 MD021155
     C**********           MOVE KEYTRG    ARET,F                                  AR1096650 MD021155
     C                     ENDIF                                                           AR1096650
      *                                                                                    AR1096650
     C                     Z-ADDA         CUCCYA  30                                        CRE083BK
     C**********           Z-ADDF         CURETR  30                               CRE083BK MD021155
      *                                                                                     MD021155
      ** Full Cache RETRGD                                                                  MD021155
      *                                                                                     MD021155
     C                     MOVE '91060'   KYSETF  8 P                                       MD021155
     C                     MOVELKYSETF    KEYSET 12 P                                       MD021155
     C                     Z-ADD250       F       30                                        MD021155
     C                     OCUR SDRETR                                                      MD021155
      *                                                                                     MD021155
     C           KEYSET    SETLLRETRG                                                       MD021155
     C                     READ RETRG                    13                                 MD021155
      *                                                                                     MD021155
     C           *IN13     DOWEQ*OFF                                                        MD021155
     C           F         ANDGT2                                                           MD021155
      *                                                                                     MD021155
     C                     MOVELKEY       KYRETR                                            MD021155
      *                                                                                     MD021155
     C           RETRBK    IFNE '   '                                                       MD021155
     C           RETRID    ANDNE'91060'                                                     MD021155
      *                                                                                     MD021155
     C           F         IFLT 250                                                         MD021155
     C                     ADD  1         F                                                 MD021155
     C                     ENDIF                                                            MD021155
      *                                                                                     MD021155
     C                     LEAVE                                                            MD021155
     C                     ENDIF                                                            MD021155
      *                                                                                     MD021155
     C           RETRRC    IFEQ 'D'                                                         MD021155
     C                     MOVE KYRETR    ARET,F                                            MD021155
     C                     MOVE KEY       KEYD                                              MD021155
     C                     MOVE LCD       LCDD                                              MD021155
     C                     MOVE ZZ001     ZZ001D                                            MD021155
     C                     SUB  1         F                                                 MD021155
     C                     ENDIF                                                            MD021155
      *                                                                                     MD021155
     C           F         OCUR SDRETR                                                      MD021155
     C                     READ RETRG                    13                                 MD021155
     C                     ENDDO                                                            MD021155
      *                                                                                     MD021155
      ** If count less than array size                                                      MD021155
      *                                                                                     MD021155
     C           *IN13     IFEQ *ON                                                         MD021155
     C           F         ANDLT250                                                         MD021155
     C                     ADD  1         F                                                 MD021155
     C                     ENDIF                                                            MD021155
      *                                                                                     MD021155
      ** If count is at least equal to array size                                           MD021155
      *                                                                                     MD021155
     C           F         IFEQ 2                                                           MD021155
     C                     MOVELKEY       KYRETR                                            MD021155
     C           RETRBK    IFEQ '   '                                                       MD021155
     C           RETRID    ANDEQ'91060'                                                     MD021155
     C           RETRRC    ANDEQ'D'                                                         MD021155
     C                     MOVE KYRETR    ARET,F                                            MD021155
     C                     MOVE KEY       KEYD                                              MD021155
     C                     MOVE LCD       LCDD                                              MD021155
     C                     MOVE ZZ001     ZZ001D                                            MD021155
     C                     ELSE                                                             MD021155
     C                     ADD  1         F                                                 MD021155
     C                     ENDIF                                                            MD021155
     C                     ENDIF                                                            MD021155
      *                                                                                     MD021155
     C                     Z-ADDF         CURETR  30                                        MD021155
      *                                                                                     CRE083BK
      ** Full Cache SDNARRPD                                                                CRE083BK
      *                                                                                     CRE083BK
     C                     Z-ADD300       B       30                                        CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
      *                                                                                     CRE083BK
     C                     READ SDNARRL1                 14                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN14     DOWEQ*OFF                                                        CRE083BK
     C********** B         ANDGT1                                                  CRE083BK MD021155
     C           B         ANDGT2                                                           MD021155
     C                     MOVE ALNVCD    ANAR,B                                            CRE083BK
     C                     MOVE ALDON     NARD                                              CRE083BK
     C                     SUB  1         B                                                 CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     READ SDNARRL1                 14                                 CRE083BK
     C********** *IN14     IFEQ *ON                                               CRE083BK AR1096650
     C**********           ADD  1         B                                       CRE083BK AR1096650
     C**********           ENDIF                                                  CRE083BK AR1096650
     C                     ENDDO                                                            CRE083BK
      *                                                                                     CRE083BK
      ** If count less than array size                                                     AR1096650
      *                                                                                    AR1096650
     C           *IN14     IFEQ *ON                                                        AR1096650
     C           B         ANDLT300                                                        AR1096650
     C                     ADD  1         B                                                AR1096650
     C                     ENDIF                                                           AR1096650
      *                                                                                    AR1096650
      ** If count is at least equal to array size                                          AR1096650
      *                                                                                    AR1096650
     C********** B         IFEQ 1                                                 AR1096650 MD021155
     C           B         IFEQ 2                                                           MD021155
     C                     MOVE ALNVCD    ANAR,B                                           AR1096650
     C                     MOVE ALDON     NARD                                              MD021155
     C                     ENDIF                                                           AR1096650
      *                                                                                    AR1096650
     C                     Z-ADDB         CUNARA  30                                        CRE083BK
      *                                                                                     CRE083BK
      ** Full Cache SDBRCHPD                                                                CRE083BK
      *                                                                                     CRE083BK
     C                     Z-ADD900       C       30                                        CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
      *                                                                                     CRE083BK
     C                     READ SDBRCHL1                 15                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN15     DOWEQ*OFF                                                        CRE083BK
     C********** C         ANDGT1                                                  CRE083BK MD021155
     C           C         ANDGT2                                                           MD021155
     C                     MOVE A8BRCD    ABRC,C                                            CRE083BK
     C                     MOVE A8BICN    BICN                                              CRE083BK
     C                     MOVE A8DTAC    NBACB                                             CRE083BK
     C                     SUB  1         C                                                 CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
     C                     READ SDBRCHL1                 15                                 CRE083BK
     C********** *IN15     IFEQ *ON                                               CRE083BK AR1096650
     C**********           ADD  1         C                                       CRE083BK AR1096650
     C**********           ENDIF                                                  CRE083BK AR1096650
     C                     ENDDO                                                            CRE083BK
      *                                                                                     CRE083BK
      ** If count less than array size                                                     AR1096650
      *                                                                                    AR1096650
     C           *IN15     IFEQ *ON                                                        AR1096650
     C           C         ANDLT900                                                        AR1096650
     C                     ADD  1         C                                                AR1096650
     C                     ENDIF                                                           AR1096650
      *                                                                                    AR1096650
      ** If count is at least equal to array size                                          AR1096650
      *                                                                                    AR1096650
     C********** C         IFEQ 1                                                 AR1096650 MD021155
     C           C         IFEQ 2                                                           MD021155
     C                     MOVE A8BRCD    ABRC,C                                           AR1096650
     C                     MOVE A8BICN    BICN                                              MD021155
     C                     MOVE A8DTAC    NBACB                                             MD021155
     C                     ENDIF                                                           AR1096650
      *                                                                                    AR1096650
     C                     Z-ADDC         CUBRCA  30                                        CRE083BK
     C*
     C           BKIEMB    IFEQ 'Y'
     C*
     C** ACCESS BRANCH CODES
     C*
     C                     Z-ADDCUBRCA    C                                                 CRE083BK
     C           BKMABR    LOKUPABRC,C                   16                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN16     IFEQ '1'                                                         CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C           1         OCUR SDBRCH                                                      MD021155
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BKMABR    @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C***********          MOVEL@BRCA     DBKEY            * DB ERROR 24 *CRE002
     C***********          Z-ADD24        DBASE            ***************CRE002
     C                     MOVEL@BRCA     DBKEY            * DB ERROR 038*CRE002
     C                     Z-ADD038       DBASE            ***************CRE002
     C                     OUT  LDA
     C*********************WRITEERRP1                                     088181
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C                     MOVE BICN      BKBICN
     C                     ENDIF
     C*
     C                     CALL 'AORETLR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDRETL    PARM SDRETL    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETLPD'DBFILE           ***************
     C***********          MOVEL@OPTN     DBKEY            * DBERROR 006 *CRE002
     C***********          Z-ADD006       DBASE            ***************CRE002
     C                     MOVEL@OPTN     DBKEY            * DBERROR 039 *CRE002
     C                     Z-ADD039       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   CCB003
      ** Access data area CBTASKSP for commit block size                  CCB003
     C           *NAMVAR   DEFN CBTASKSP  CBTASK                          CCB003
     C                     IN   CBTASK                                    CCB003
     C**********           MOVE CMTBLK    #OPTIM  60                                 CCB003 MD020687
     C                     MOVE CMTBLK    #OPTIM 100                                        MD020687
      *                                                                   CCB003
      ** Set commit counter to 1                                          CCB003
     C                     Z-ADD1         #COMIT  60                      CCB003
     C*
     C/COPY WNCPYSRC,RE3664CP15                                           S01408
      *                                                                   S01408
     C                     CALL 'AOTRADR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDTRADPD'DBFILE           ***************
     C***********          MOVEL@OPTN     DBKEY            * DBERROR 007 *CRE002
     C***********          Z-ADD007       DBASE            ***************CRE002
     C                     MOVEL@OPTN     DBKEY            * DBERROR 040 *CRE002
     C                     Z-ADD040       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C***CHECK*IF*RETAIL*NUMBER*USED                                      CCB003
     C***********                                                         CCB003
     C***********RACN      COMP 'Y'                      53               CCB003
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE COMS      KACOD   4                                           CGL029
     C                     MOVE COMS      KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD041       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 08 *CRE002
     C***********          Z-ADD008       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 041*           CRE002 CRE083BK
     C**********           Z-ADD041       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WCOMST
     C*
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE SPAC      KACOD   4                                           CGL029
     C                     MOVE SPAC      KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD042       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 12 *CRE002
     C***********          Z-ADD012       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 042*           CRE002 CRE083BK
     C**********           Z-ADD042       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WSPACT
     C*                                                                  052739
     C** INITIALIZE CONTROL DATE                                         052739
     C*                                                                  052739
     C           DNWD      SUB  1         WRK5    50                     052739
     C           WRK5      IFLE BKAPDT                                   052739
     C                     Z-ADDWRK5      CTFDAT                         052739
     C                     ELSE                                          052739
     C                     Z-ADDBKAPDT    CTFDAT                         052739
     C                     END                                           052739
     C           LDAC      IFNE 'Y'                                      052739
     C                     ADD  1         CTFDAT                         052739
     C                     END                                           052739
     C***************************************************************                       CRE083BE
     C***INITIALIZE*WORK*FIELDS**************************************                       CRE083BE
     C***************************************************************                       CRE083BE
     C**********           MOVE *BLANKS   ZZ001                                             CRE083BE
     C**********           MOVE *BLANKS   ZZ006                                             CRE083BE
     C**********           MOVE *BLANKS   ZZ009                                             CRE083BE
     C**********           MOVE *BLANKS   SWCR                                              CRE083BE
     C**********           MOVE *BLANKS   DLREF                                             CRE083BE
     C**********           MOVE *BLANKS   REBI                                              CRE083BE
     C**********           MOVE *BLANKS   FACO                                              CRE083BE
     C**********           MOVE *BLANKS   PREF                                              CRE083BE
     C**********           MOVE 'D'       ENDK                                              CRE083BE
     C**********           MOVE '-'       TIR1                                                CGL029
     C**********           MOVE '-'       TIR2                                                CGL029
     C**********           MOVE '-'       TIR3                                                CGL029
     C**********           MOVE '-'       TIR4                                                CGL029
     C**********           Z-ADD*ZEROS    NBRREC  50                                        CRE083BE
     C**********           Z-ADD*ZEROS    DBCNUM                                              CSD027
     C**********           MOVE *BLANKS   DBCNUM                                     CSD027 CRE083BE
     C**********           Z-ADD*ZEROS    CHGA                                              CRE083BE
     C**********           Z-ADD*ZEROS    DRIP                                              CRE083BE
     C**********           Z-ADD*ZEROS    CRIP                                              CRE083BE
     C*********            Z-ADD*ZEROS    PAGE                            081545
     C***********          MOVE '0'       *IN43                           CCB003
     C***********          MOVE '1'       *IN90                           075073
     C***********          MOVE '1'       *IN85                     075073081545
     C***********          MOVE '0'       *IN85                     085787CCB003
     C**********           MOVEL'91060'   OTTP                                              CRE083BE
     C***********          Z-ADD0         RECN                            CCB003
     C**
     C**   CALCULATE CONTROL DATE
     C**   ACCRUAL/PROFIT DATE IF NEEDED
     C           DNWD      SUB  1         NAPDA
     C**
     C           BKAPDT    IFLT DNWD                       - B1
     C                     Z-ADDBKAPDT    NAPDA
     C                     END                             - E1
     C*
     C** READ DEFAULT LANGUAGE CODE (SCUNT)
     C*
     C***********          Z-ADD40        DBASE                           CRE002
     C                     Z-ADD043       DBASE            * DBERROR 043 *CRE002
     C                     MOVE BJLANG    BJLANG  2
     C*
     C**   READ BASIC LANGUAGE CODE FOR BANK
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ***************
     C***********          MOVEL@OPTN     DBKEY            * DBERROR 005 *CRE002
     C***********          Z-ADD005       DBASE            ***************CRE002
     C                     MOVEL@OPTN     DBKEY            * DBERROR 044 *CRE002
     C                     Z-ADD044       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     MOVELBJLANG    XCUNT   2
     C/COPY WNCPYSRC,RE3664C133
      *                                                                   CRE002
      ** Check if Overdraft Interest Calculations feature is on           CRE002
      *                                                                   CRE002
     C                     MOVE 'N'       CRE002  1                       CRE002
     C                     MOVE '0'       *IN31                           CRE002
      *                                                                   CRE002
     C                     CALL 'AOSARDR0'                                CRE002
     C                     PARM *BLANKS   @RTCD   7                       CRE002
     C                     PARM '*VERIFY' @OPTN   7                       CRE002
     C                     PARM 'CRE002'  @SARD   6                       CRE002
      *                                                                   CRE002
     C           @RTCD     IFNE *BLANKS                                   CRE002
     C           @RTCD     ANDNE'*NRF   '                                 CRE002
     C                     SETON                     U7U8LR               CRE002
     C                     MOVEL'CRE002'  DBKEY                           CRE002
     C                     MOVE 'SCSARDPD'DBFILE           ***************CRE002
     C                     Z-ADD047       DBASE            * DBERR0R 047 *CRE002
     C                     EXSR *PSSR                      ***************CRE002
     C                     END                                            CRE002
      *                                                                   CRE002
     C           @RTCD     IFEQ *BLANKS                                   CRE002
     C                     MOVE 'Y'       CRE002                          CRE002
     C                     MOVE '1'       *IN31                           CRE002
     C                     END                                            CRE002
     C*                                                                   CRE008
     C** DETERMINE IF CASH MANAGEMENT IS INSTALLED                        CRE008
     C**                                                                  CRE008
     C                     CALL 'AOSARDR0'                                CRE008
     C                     PARM '       ' @RTCD                           CRE008
     C                     PARM '*VERIFY' @OPTN                           CRE008
     C                     PARM 'CRE008'  @SARD                           CRE008
      *                                                                   CRE008
     C           @RTCD     IFNE *BLANK                                    CRE008
     C           @RTCD     ANDNE'*NRF   '                                 CRE008
     C                     SETON                     U7U8LR               CRE008
     C                     MOVEL@RTCD     DBKEY                           CRE008
     C                     MOVEL'SCSARDPD'DBFILE           ***************CRE008
     C                     Z-ADD210       DBASE            * DBERROR 210 *CRE008
     C                     OUT  LDA                        ***************CRE008
     C                     EXSR *PSSR                                     CRE008
     C                     END                                            CRE008
      *                                                                   CRE008
     C           @RTCD     IFEQ *BLANK                                    CRE008
     C                     MOVEL'Y'       CRE008  1                       CRE008
     C**********           OPEN REGAHLJ2                                             CRE008 CRE083BE
     C**********           OPEN REZSHLJ2                                             CRE008 CRE083BE
     C**********           OPEN RECIEUL2                                             217910 CRE083BE
     C                     END                                            CRE008
      *                                                                                       CGL031
      ** Check if CGL031 is enabled.                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD   7                                           CGL031
     C                     PARM '*VERIFY' POPTN   7                                           CGL031
     C                     PARM 'CGL031'  PSARD   6                                           CGL031
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       CGL031  1                                           CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL031                                              CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE '*NRF   '                                                     CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     MOVEL'CGL031'  DBKEY                                               CGL031
     C                     Z-ADD301       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Access the Swiss ICD if necessary.                                                   CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C           BGNTST    ANDNE'Y'                                                           CGL031
      *                                                                                       CGL031
     C                     OPEN SDSTAXPD                                                      CGL031
     C           1         CHAINSDSTAXPD             84                                       CGL031
     C                     CLOSESDSTAXPD                                                      CGL031
      *                                                                                       CGL031
     C           *IN84     IFEQ *ON                                                           CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDSTAXPD'DBFILE                                              CGL031
     C                     MOVE *BLANKS   DBKEY                                               CGL031
     C                     Z-ADD302       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C*
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF BRT SAR IS INSTALLED
     C**
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01383'  @SARD   6
     C           @RTCD     IFNE *BLANK
     C           @RTCD     ANDNE'*NRF   '
     C                     SETON                     U7LR  ** DB ERROR 97
     C           *LOCK     IN   LDA
     C                     MOVEL'SCSARDPD'DBFILE
     C                     MOVEL@RTCD     DBKEY
     C***********          Z-ADD97        DBASE                           CRE002
     C                     Z-ADD045       DBASE            * DBERROR 045 *CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C           @RTCD     IFEQ *BLANK
     C                     MOVEL'Y'       S01383  1
     C                     END
     C*
     C** IF BRT SAR INSTALLED
     C*
     C           S01383    IFEQ 'Y'                        B001
     C*
     C** ACCESS BRT INSTALLATION CONTROL DATA
     C*
     C                     MOVE 'D'       RECI
     C           RECI      CHAINSDBRTDD0             99    (99 = EOF)
     C   99      *LOCK     IN   LDA
     C***99******          SETON                     U7LR  ** DB ERROR 98 CRE002
     C   99                SETON                     U7LR  ** DB ERROR 046CRE002
     C   99                MOVEL'SDBRTDPD'DBFILE
     C   99                MOVELRECI      DBKEY
     C***99******          Z-ADD98        DBASE                           CRE002
     C   99                Z-ADD046       DBASE                           CRE002
     C   99                OUT  LDA
     C   99                EXSR *PSSR
     C**
     C** STORE BASE CURRENCY
     C**
     C                     MOVE BACCY     BCCY1   3
     C**
     C/COPY WNCPYSRC,RE3664CCP3                                           S01408
     C*                                                                   S01408
     C** ACCESS A/C CODES FILE FOR CORRESP. ACCOUNT TYPE
     C**
     C**********           MOVE ACOD1     KACOD   4                                           CGL029
     C                     MOVE ACOD1     KACOD                                               CGL029
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD048       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 88 *CRE002
     C***********          Z-ADD088       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 048*           CRE002 CRE083BK
     C**********           Z-ADD048       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C**
     C                     MOVE A5ACTY    ATYP1   3
     C/COPY WNCPYSRC,RE3664C174
     C                     MOVE A5ACSC    ASEC1   2
     C*
     C                     CALL 'AOTRADR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDTRADPD'DBFILE           ***************
     C***********          MOVEL@OPTN     DBKEY            * DBERROR 089 *CRE002
     C***********          Z-ADD089       DBASE            ***************CRE002
     C                     MOVEL@OPTN     DBKEY            * DBERROR 049 *CRE002
     C                     Z-ADD049       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C**
     C** STORE STERLING CURRENCY
     C**
     C                     MOVE BLCYCD    STCY1   3
     C**
     C** ACCESS CURR. CODES FILE TO FIND FIELD VALUES FOR STERLING
     C**
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           STCY1     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM STCY1     @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 52 *CRE002
     C***********          Z-ADD052       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 050*CRE002
     C                     Z-ADD050       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C**********           MOVE TACC      TACC2   4                                           CGL029
     C                     MOVE TACC      TACC2  10                                           CGL029
     C**
     C**   CHECK IF STERLING A/C CODE EXISTS
     C**
     C***********TACC      IFEQ '0000'                                    088181
     C********** TACC      IFEQ '    '                                                 088181 239314
     C           TACC      IFEQ *BLANKS                                                       239314
     C                     SETON                     29
     C                     ELSE
     C**********           MOVE TACC      ACODA   4                                           CGL029
     C                     MOVE TACC      ACODA  10                                           CGL029
     C                     EXSR ACDCHN
     C                     MOVE A5ACSC    TSEC2   2
     C                     END
     C**
     C                     MOVE CDP       CDPS    10
     C                     MOVE SPOT      SPOTS  138
     C                     MOVE MDIN      MDINS   1
     C**
     C** ACCESS CURR. CODES FILE TO FIND FIELD VALUES FOR BASE CCY
     C**
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY1     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BCCY1     @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 53 *CRE002
     C***********          Z-ADD053       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 051*CRE002
     C                     Z-ADD051       DBASE            ***************CRE002
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*                                                                   CAC001
     C**  Access PF/SDPCACPD for Profit Centre Accounting ICD             CAC001
     C*                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C*                                                                   CAC001
     C                     CALL 'AOPCACR0'                                CAC001
     C                     PARM '*MSG   ' @RTCD                           CAC001
     C                     PARM '*FIRST ' @OPTN                           CAC001
     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC001
     C*                                                                   CAC001
     C           @RTCD     IFNE *BLANK                                    CAC001
     C           *LOCK     IN   LDA                                       CAC001
     C                     MOVEL'SDPCACPD'DBFILE                          CAC001
     C                     MOVEL@OPTN     DBKEY                           CAC001
     C                     Z-ADD053       DBASE                           CAC001
     C                     OUT  LDA                                       CAC001
     C                     EXSR *PSSR                                     CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   CAC001
     C                     ENDIF                                          CAC001
     C**
     C                     MOVE CDP       CDPB    10
     C                     MOVE SPOT      SPOTB  138
     C                     MOVE MDIN      MDINB   1
     C                     END                             E001
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '       ' @RTCD                                               CGL020
     C                     PARM '*VERIFY' @OPTN                                               CGL020
     C                     PARM 'CGL020'  @SARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           @RTCD     IFNE *BLANK                                                        CGL020
     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
     C                     MOVEL'RE3664'  DBPGM                                               CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     Z-ADD206       DBASE                                               CGL020
     C                     MOVEL@SARD     DBKEY                                               CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           @RTCD     IFEQ *BLANK                                                        CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      ** Check if CDL081 is installed                                                         CDL081
      *                                                                                       CDL081
     C                     MOVE 'N'       CDL081  1                                           CDL081
     C                     CALL 'AOSARDR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM '*VERIFY' POPTN                                               CDL081
     C                     PARM 'CDL081'  PSARD                                               CDL081
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           PRTCD     ANDNE'*NRF   '                                                     CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD206       DBASE                                               CDL081
     C                     MOVE 'SCSARDPD'DBFILE                                              CDL081
     C                     MOVEL'CDL081'  DBKEY                                               CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR *PSSR                                                         CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           PRTCD     IFEQ *BLANKS                                                       CDL081
     C                     MOVE 'Y'       CDL081                                              CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Access withholding tax round down system values if CDL081 is on                      CDL081
      *                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C                     CALL 'AOSVALR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM C#BASE    SVALK1 20                                           CDL081
     C                     PARM           SVAL1 200                                           CDL081
     C                     PARM C#NBAS    SVALK2 20                                           CDL081
     C                     PARM           SVAL2 200                                           CDL081
     C                     PARM *BLANK    SVALK3 20                                           CDL081
     C                     PARM           SVAL3 200                                           CDL081
     C                     PARM *BLANK    SVALK4 20                                           CDL081
     C                     PARM           SVAL4 200                                           CDL081
     C                     PARM *BLANK    SVALK5 20                                           CDL081
     C                     PARM           SVAL5 200                                           CDL081
     C                     PARM *BLANK    SVALK6 20                                           CDL081
     C                     PARM           SVAL6 200                                           CDL081
     C                     PARM *BLANK    SVALK7 20                                           CDL081
     C                     PARM           SVAL7 200                                           CDL081
     C                     PARM *BLANK    SVALK8 20                                           CDL081
     C                     PARM           SVAL8 200                                           CDL081
     C                     PARM *BLANK    SVALK9 20                                           CDL081
     C                     PARM           SVAL9 200                                           CDL081
     C                     PARM *BLANK    SVALK0 20                                           CDL081
     C                     PARM           SVAL10200                                           CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           *LOCK     IN   LDA                                                           CDL081
     C                     Z-ADD207       DBASE                                               CDL081
     C                     MOVE 'SDSVALPD'DBFILE                                              CDL081
     C           SVAL1     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK1    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C           SVAL2     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK2    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C                     OUT  LDA                                                           CDL081
     C                     EXSR *PSSR                                                         CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Setup tax amount rounding down indicators                                            CDL081
      *                                                                                       CDL081
     C                     MOVELSVAL1     W#BSRD  1                                           CDL081
     C                     MOVELSVAL2     W#NBRD  1                                           CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Check if CER048 is enabled.                                                          CER048
      *                                                                                       CER048
     C                     CALL 'AOSARDR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD   7                                           CER048
     C                     PARM '*VERIFY' POPTN   7                                           CER048
     C                     PARM 'CER048'  PSARD   6                                           CER048
     C           SCSARD    PARM SCSARD    DSFDY                                               CER048
      *                                                                                       CER048
     C                     MOVE 'N'       CER048  1                                           CER048
      *                                                                                       CER048
     C           PRTCD     IFEQ *BLANKS                                                       CER048
     C                     MOVE 'Y'       CER048                                              CER048
     C                     ELSE                                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE '*NRF   '                                                     CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     MOVEL'SCSARDPD'DBFILE                                              CER048
     C                     MOVEL'CER048'  DBKEY                                               CER048
     C                     Z-ADD320       DBASE                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER054
      ** Check if CER054 is enabled.                                                          CER054
      *                                                                                       CER054
     C                     CALL 'AOSARDR0'                                                    CER054
     C                     PARM *BLANKS   PRTCD                                               CER054
     C                     PARM '*VERIFY' POPTN                                               CER054
     C                     PARM 'CER054'  PSARD                                               CER054
     C           SCSARD    PARM SCSARD    DSFDY                                               CER054
      *                                                                                       CER054
     C                     MOVE 'N'       CER054  1                                           CER054
      *                                                                                       CER054
     C           PRTCD     IFEQ *BLANKS                                                       CER054
     C                     MOVE 'Y'       CER054                                              CER054
     C                     ELSE                                                               CER054
      *                                                                                       CER054
     C           PRTCD     IFNE '*NRF   '                                                     CER054
     C           *LOCK     IN   LDA                                                           CER054
     C                     MOVEL'SCSARDPD'DBFILE                                              CER054
     C                     MOVEL'CER054'  DBKEY                                               CER054
     C                     Z-ADD323       DBASE                                               CER054
     C                     OUT  LDA                                                           CER054
     C                     EXSR *PSSR                                                         CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                    BUG23097A
      ** Check if CER016 is enabled.                                                       BUG23097A
      *                                                                                    BUG23097A
     C                     CALL 'AOSARDR0'                                                 BUG23097A
     C                     PARM *BLANKS   PRTCD   7                                        BUG23097A
     C                     PARM '*VERIFY' POPTN   7                                        BUG23097A
     C                     PARM 'CER016'  PSARD   6                                        BUG23097A
     C           SCSARD    PARM SCSARD    DSFDY                                            BUG23097A
      *                                                                                    BUG23097A
     C                     MOVE 'N'       CER016  1                                        BUG23097A
      *                                                                                    BUG23097A
     C           PRTCD     IFEQ *BLANKS                                                    BUG23097A
     C                     MOVE 'Y'       CER016                                           BUG23097A
     C                     ELSE                                                            BUG23097A
      *                                                                                    BUG23097A
     C           PRTCD     IFNE '*NRF   '                                                  BUG23097A
     C           *LOCK     IN   LDA                                                        BUG23097A
     C                     MOVEL'SCSARDPD'DBFILE                                           BUG23097A
     C                     MOVEL'CER016'  DBKEY                                            BUG23097A
     C                     Z-ADD322       DBASE                                            BUG23097A
     C                     OUT  LDA                                                        BUG23097A
     C                     EXSR *PSSR                                                      BUG23097A
     C                     ENDIF                                                           BUG23097A
      *                                                                                    BUG23097A
     C                     ENDIF                                                           BUG23097A
      *                                                                                       CRE090
      ** Check if CRE090 is installed                                                         CRE090
      *                                                                                       CRE090
     C                     CALL 'AOSARDR0'                                                    CRE090
     C                     PARM *BLANKS   PRTCD                                               CRE090
     C                     PARM '*VERIFY' POPTN                                               CRE090
     C                     PARM 'CRE090'  PSARD                                               CRE090
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE090
      *                                                                                       CRE090
     C           PRTCD     IFEQ *BLANKS                                                       CRE090
     C                     MOVEL'Y'       CRE090  1                                           CRE090
     C                     ELSE                                                               CRE090
     C                     MOVEL'N'       CRE090                                              CRE090
     C                     ENDIF                                                              CRE090
     C/COPY OFCPYSRCZ,CRE105_008                                                              CRE105
      *                                                                                       CGL165
     C                     CALL 'AOSARDR0'                                                    CGL165
     C                     PARM *BLANKS   PRTCD                                               CGL165
     C                     PARM '*VERIFY' POPTN                                               CGL165
     C                     PARM 'CGL165'  PSARD                                               CGL165
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL165
      *                                                                                       CGL165
     C           PRTCD     IFEQ *BLANKS                                                       CGL165
     C                     MOVEL'Y'       CGL165  1                                           CGL165
     C                     ELSE                                                               CGL165
     C                     MOVEL'N'       CGL165                                              CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                     AR831847
      *                                                                                     AR831847
      ** Check if Net Interest is to be posted for German Taxes                             AR831847
      *                                                                                     AR831847
     C                     MOVE 'N'       WSV01   1                                         AR831847
     C           CER048    IFEQ 'Y'                                                         AR831847
      *                                                                                     AR831847
     C                     CALL 'AOSVALR0'                                                  AR831847
     C                     PARM *BLANKS   PRTCD                                             AR831847
     C                     PARM PSNET     PSV01  20                                         AR831847
     C                     PARM           PCS01 200                                         AR831847
     C                     PARM           PSV02  20                                         AR831847
     C                     PARM           PCS02 200                                         AR831847
     C                     PARM           PSV03  20                                         AR831847
     C                     PARM           PCS03 200                                         AR831847
     C                     PARM           PSV04  20                                         AR831847
     C                     PARM           PCS04 200                                         AR831847
     C                     PARM           PSV05  20                                         AR831847
     C                     PARM           PCS05 200                                         AR831847
     C                     PARM           PSV06  20                                         AR831847
     C                     PARM           PCS06 200                                         AR831847
     C                     PARM           PSV07  20                                         AR831847
     C                     PARM           PCS07 200                                         AR831847
     C                     PARM           PSV08  20                                         AR831847
     C                     PARM           PCS08 200                                         AR831847
     C                     PARM           PSV09  20                                         AR831847
     C                     PARM           PCS09 200                                         AR831847
     C                     PARM           PSV10  20                                         AR831847
     C                     PARM           PCS10 200                                         AR831847
      *                                                                                     AR831847
     C           PRTCD     IFEQ *BLANKS                                                     AR831847
     C                     MOVELPCS01     WSV01                                             AR831847
     C                     ELSE                                                             AR831847
      *                                                                                     AR831847
     C           PRTCD     IFNE '*NRF'                                                      AR831847
     C           *LOCK     IN   LDA                                                         AR831847
     C                     MOVEL'SDSVALPD'DBFILE                                            AR831847
     C                     MOVELPSV01     DBKEY                                             AR831847
     C                     Z-ADD144       DBASE                                             AR831847
     C                     OUT  LDA                                                         AR831847
     C                     EXSR *PSSR                                                       AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
      ** Determine system values whether internal postings for interest                       CRE100
      ** accruals and charges should be posted at customer level or                           CRE100
      ** bank level.                                                                          CRE100
      *                                                                                       CRE100
     C                     CALL 'AOSVALR0'                                                    CRE100
     C                     PARM *BLANKS   W0RTCD  7                                           CRE100
     C                     PARM SVAL,1    PVALK1 20                                           CRE100
     C                     PARM *BLANKS   PVAL1 200                                           CRE100
     C                     PARM SVAL,2    PVALK2 20                                           CRE100
     C                     PARM *BLANKS   PVAL2 200                                           CRE100
     C**********           PARM *BLANKS   PVALK3 20                                  CRE100 MD034990
     C                     PARM SVAL,3    PVALK3 20                                         MD034990
     C                     PARM *BLANKS   PVAL3 200                                           CRE100
     C                     PARM *BLANKS   PVALK4 20                                           CRE100
     C                     PARM *BLANKS   PVAL4 200                                           CRE100
     C                     PARM *BLANKS   PVALK5 20                                           CRE100
     C                     PARM *BLANKS   PVAL5 200                                           CRE100
     C                     PARM *BLANKS   PVALK6 20                                           CRE100
     C                     PARM *BLANKS   PVAL6 200                                           CRE100
     C                     PARM *BLANKS   PVALK7 20                                           CRE100
     C                     PARM *BLANKS   PVAL7 200                                           CRE100
     C                     PARM *BLANKS   PVALK8 20                                           CRE100
     C                     PARM *BLANKS   PVAL8 200                                           CRE100
     C                     PARM *BLANKS   PVALK9 20                                           CRE100
     C                     PARM *BLANKS   PVAL9 200                                           CRE100
     C                     PARM *BLANKS   PVALK0 20                                           CRE100
     C                     PARM *BLANKS   PVAL10200                                           CRE100
      *                                                                                       CRE100
     C           W0RTCD    IFEQ *BLANKS                                                       CRE100
      *                                                                                       CRE100
     C           PVAL1     IFEQ 'Y'                                                           CRE100
     C                     MOVE 'Y'       WINT    1                                           CRE100
     C                     ENDIF                                                              CRE100
      *                                                                                       CRE100
     C           PVAL2     IFEQ 'Y'                                                           CRE100
     C                     MOVE 'Y'       WCHRG   1                                           CRE100
     C                     ENDIF                                                              CRE100
      *                                                                                       CRE100
     C           PVAL3     IFEQ 'Y'                                                         MD034990
     C                     MOVE 'Y'       RETSEQ  1                                         MD034990
     C                     ENDIF                                                            MD034990
      *                                                                                     MD034990
     C                     ELSE                                                               CRE100
      *                                                                                       CRE100
     C           W0RTCD    IFNE '*NRF'                                                        CRE100
     C           *LOCK     IN   LDA                                                           CRE100
     C                     Z-ADD146       DBASE                                               CRE100
     C                     MOVEL'SDSVALPD'DBFILE                                              CRE100
      *                                                                                       CRE100
     C           PVAL1     IFEQ '*NRF'                                                        CRE100
     C                     MOVELPVALK1    DBKEY                                               CRE100
     C                     ENDIF                                                              CRE100
      *                                                                                       CRE100
     C           PVAL2     IFEQ '*NRF'                                                        CRE100
     C                     MOVELPVALK2    DBKEY                                               CRE100
     C                     ENDIF                                                              CRE100
      *                                                                                     MD034990
     C           PVAL3     IFEQ '*NRF'                                                      MD034990
     C                     MOVELPVALK3    DBKEY                                             MD034990
     C                     ENDIF                                                            MD034990
      *                                                                                       CRE100
     C                     OUT  LDA                                                           CRE100
     C                     EXSR *PSSR                                                         CRE100
     C                     ENDIF                                                              CRE100
      *                                                                                       CRE100
     C                     ENDIF                                                              CRE100
      *                                                                                       CRE100
      ** Initialize work variable UPDCUS and set to value 'Y' if                            MD027841
      ** postings are coming from DEBPR or CREPR subroutines.                               MD027841
      *                                                                                     MD027841
     C                     MOVE *BLANKS   UPDCUS  1                                         MD027841
      *                                                                                     MD027841
     C/COPY WNCPYSRC,RE3664C131
     C*
     C**   INITIALISE FIELDS FOR MANAGEMENT ACCOUNTING
     C                     Z-ADD0         VOIN    10
     C                     Z-ADD235959    PTIM    60
     C*
     C                     EXSR TOTAL
     C*
     C/COPY WNCPYSRC,RE3664C029
     C                     EXSR INITPR
     C/COPY WNCPYSRC,RE3664C030
     C*
      ** Dummy read for compilation purposes                              CCB003
     C                     MOVE '0'       *IN37                           CCB003
     C           *IN37     IFEQ '1'                                       CCB003
     C                     READ REINCXPD                 37               CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C                     Z-ADD0         WCHGP  257                                          250998
      *                                                                                       250998
     C                     CLOSESDCURRL1                                                      CGL165
     C                     ENDSR                           **FIRST ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** GEICPR subroutine to execute geicpd file processing
     C**
     C**     Called by       ACCPR,DCIND,PLPR,SUSPR
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           GEICPR    BEGSR                           **GEICPR BEGSR**
     C*                                                                   129099
     C** If Retail Account and Private Banking Module Switched ON         129099
     C** Split Transaction type '91060' and '91040' accordingly to        129099
     C** Debit / Credit processing                                        129099
     C*                                                                   129099
     C           BGN4ST    IFEQ 'Y'                        - B1           129099
     C***********ATYP      ANDEQ'R'                                129099 161803
     C                     MOVELOTTP      OTTPS   50                      161803
     C*                                                                   129099
     C** Debit processing                                                 129099
     C           WDRCR     IFEQ '0'                        - B2           129099
     C*                                                                   129099
     C***********TRAT      IFEQ 91060                      - B3    129099 161803
     C           OTTPS     IFEQ 91060                      - B3           161803
     C                     Z-ADD91061     TRAT                            129099
     C                     ENDIF                           - E3           129099
     C***********TRAT      IFEQ 91040                      - B3    129099 161803
     C           OTTPS     IFEQ 91040                      - B3           161803
     C                     Z-ADD91041     TRAT                            129099
     C                     ENDIF                           - E3           129099
     C*                                                                   129099
     C                     ENDIF                           - E2           129099
     C*                                                                   129099
     C** Credit processing                                                129099
     C           WDRCR     IFEQ '1'                        - B2           129099
     C*                                                                   129099
     C***********TRAT      IFEQ 91060                      - B3    129099 161803
     C***********TRAT      OREQ 91061                              150714 162319
     C           OTTPS     IFEQ 91060                                     162319
     C                     Z-ADD91062     TRAT                            129099
     C                     ENDIF                           - E3           129099
     C***********TRAT      IFEQ 91040                      - B3    129099 161803
     C***********TRAT      OREQ 91041                              150714 162319
     C           OTTPS     IFEQ 91040                      - B3           161803
     C                     Z-ADD91042     TRAT                            129099
     C                     ENDIF                           - E3           129099
     C*                                                                   129099
     C                     ENDIF                           - E2           129099
     C*                                                                   129099
     C                     ENDIF                           - E1           129099
     C*
     C           WEUTT     IFEQ 'Y'                                                           234003
     C                     MOVE TXTXTT    TRAT                                                234003
     C                     ENDIF                                                              234003
      *                                                                                       234003
     C           WPSTA     IFGT 0                          - B1
     C                     Z-ADDWPSTA     PSTA
     C                     MOVE '0'       DRCR
     C                     ELSE                            - X1
     C                     Z-SUBWPSTA     PSTA
     C                     MOVE '1'       DRCR
     C                     END                             - E1
     C*                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           WDRCR     IFEQ '2'                                                           CGL020
     C                     MOVE 'F'       FEEFLG                                              CGL020
     C                     Z-ADDPSTA      FEEVAL                                              CGL020
     C                     Z-ADD100       FEEPCT                                              CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C**********           MOVE ACOD      KACOD   4                                           CGL029
     C                     MOVE ACOD      KACOD                                               CGL029
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD052       WDBASE                                            CRE083BK
     C**********           EXSR CHKACD                                            CRE083BK AR1089863
     C                     EXSR ACDCCH                                                     AR1089863
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 20 *CRE002
     C***********          Z-ADD020       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 052*           CRE002 CRE083BK
     C**********           Z-ADD052       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C** WRITE NEW RECORD IN GEICPD FILE
     C*
     C                     MOVE A5ACTY    ATYP
     C                     MOVE A5ACSC    ACSC
     C                     MOVE 'P'       RECI
     C***********          Z-ADD41        DBASE                           CRE002
     C                     Z-ADD053       DBASE            * DB ERROR 053*CRE002
     C*
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     END
     C*
     C* NOT FOR SECONDARY
     C*
     C           *IN50     IFEQ '0'
      *                                                                   184965
     C* Use Profit Center of Main Account if PRFC is blank.               184965
      *                                                                   184965
     C           PRFC      IFEQ *BLANKS                                   184965
     C                     MOVE WMPRFC    PRFC                            184965
     C                     ENDIF                                          184965
     C*                                                                   184965
     C* Retrieve Profit Center from Default Matrix if PRFC still blank    184965
     C*                                                                   184965
     C                     MOVE TRAT      WTRATA  5                       184965
     C                     MOVE CNUM      WCNUMA  6                       184965
     C           PRFC      IFEQ *BLANKS                                   184965
     C           PCMU      ANDEQ'Y'                                       184965
     C                     CALL 'AOPRFMR0'                                184965
     C                     PARM *BLANKS   RTCDPR  1                       184965
     C                     PARM BOKC      BOOKPR  2                       184965
     C                     PARM WTRATA    TRTPPR  5                       184965
     C                     PARM *BLANKS   SUTPPR  2                       184965
     C**********           PARM BRCA      BRANPR  1                                    184965 211084
     C                     PARM BRCA      BRANPR  3                                           211084
     C**********           PARM DPMT      DEPTPR  2                                    184965 211084
     C                     PARM DPMT      DEPTPR  3                                           211084
     C**********           PARM *BLANKS   USERPR  5                                    184965 211084
     C                     PARM *BLANKS   USERPR 10                                           211084
     C                     PARM *BLANKS   ACOFPR  2                       184965
     C**********           PARM WCNUMA    CNUMPR  5                                    184965 211084
     C                     PARM WCNUMA    CNUMPR  6                                           211084
     C**********           PARM *BLANKS   PRFCPR  2                                    184965 211084
     C                     PARM *BLANKS   PRFCPR  4                                           211084
     C*                                                                   184965
     C           RTCDPR    IFNE '0'                                       184965
     C                     MOVE *BLANKS   PRFC                            184965
     C                     ELSE                                           184965
     C                     MOVE PRFCPR    PRFC                            184965
     C                     ENDIF                                          184965
     C                     ENDIF                                          184965
     C*                                                                   184965
     C** Blank Profit Center when not used.                               184965
     C*                                                                   184965
     C           PCUS      IFNE 'Y'                                       184965
     C                     MOVE *BLANKS   PRFC                            184965
     C                     ENDIF                                          184965
     C*                                                                   S01522
     C* Retrieve the posting narrative:                                   S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,REH00026
     C*                                                                   111921
     C           VALD      IFEQ *ZEROS                                    111921
     C                     Z-ADDRUND      VALD                            111921
     C                     END                                            111921
     C/COPY WNCPYSRC,REH00431
      *                                                                   CPB001
      **  If Replication Processing required.                             CPB001
     C           WUREPL    IFEQ 'Y'                        Begin WUREPL   CPB001
      *                                                                   CPB001
      **  If Transaction is not relating to charges.                      CPB001
     C           TRAT      IFNE 91050                      Begin TRAT     CPB001
     C                     EXSR REPLIC                                    CPB001
      *                                                                   CPB001
     C                     ENDIF                           End TRAT       CPB001
      *                                                                   CPB001
     C                     ENDIF                           End WUREPL     CPB001
     C*                                                                   S01522
     C/COPY WNCPYSRC,RE3664C004                                           S01408
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     EXSR ACCDET                                    CRE008
     C**********           ENDIF                                                     261620 MD022635
     C                     WRITEAPOSTPDF
     C                     Z-ADD*ZEROS    DBASE
     C/COPY OFCPYSRCZ,CRE105_009                                                              CRE105
     C*
     C/COPY WNCPYSRC,RE3664CP16                                           S01408
      *                                                                   S01408
     C** TRAILER PROCESSING
     C*
     C                     ADD  1         WNORE
     C           PSTA      DIV  1000      ZZAMT
     C/COPY WNCPYSRC,RE3664C031
     C                     EXSR GLZADD
     C/COPY WNCPYSRC,RE3664C032
     C                     END
     C*
     C                     ENDSR                           **GEICPR ENDSR**
     C********************************************************************
     C/EJECT                                                              CRE008
     C********************************************************************CRE008
     C           ACCDET    BEGSR                           **ACCDET BEGSR*CRE008
      *                                                                   CRE008
     C                     MOVELXBRCA     ORBR                            CRE008
     C                     MOVELXCCY      TRCCY                           CRE008
     C                     MOVEL*BLANK    FACO                            CRE008
     C                     MOVELXACOD     FACO                            CRE008
     C                     MOVEL*BLANK    OTRF                            CRE008
     C                     CAT  XCNUMA:0  OTRF                            CRE008
     C                     CAT  XACSQA:0  OTRF                            CRE008
     C                     MOVEL*BLANK    TRST                            CRE008
     C           CRE008    IFEQ 'Y'                                       CRE008
     C           CMACKY    CHAINREGAHLJ2             99                   CRE008
     C        N99          MOVEL'G'       TRST                            CRE008
     C           CMACKY    CHAINREZSHLJ2             99                   CRE008
     C        N99          MOVE 'Z'       TRST                            CRE008
     C                     ENDIF                                          CRE008
      *                                                                   CRE008
     C           CMACKY    KLIST                                          CRE008
     C                     KFLD           XCNUM                           CRE008
     C                     KFLD           XCCY                            CRE008
     C                     KFLD           XACOD                           CRE008
     C                     KFLD           XACSQ                           CRE008
     C                     KFLD           XBRCA                           CRE008
      *                                                                   CRE008
     C                     ENDSR                           **ACCDET ENDSR*CRE008
     C********************************************************************CRE008
     C/EJECT                                                              217910
     C********************************************************************217910
     C           RTVRE     BEGSR                           **RTVRE  BEGSR*217910
      *                                                                   217910
     C                     MOVELWACNO     XACNO  10                       217910
     C           EUACKY    CHAINRECIEUL2             99                   217910
     C           *IN99     IFEQ '0'                                       217910
     C                     MOVELRWEACN    XACNO                           217910
     C                     ENDIF                                          217910
      *                                                                   217910
     C           EUACKY    KLIST                                          217910
     C                     KFLD           XBRCA                           217910
     C                     KFLD           XCNUM                           217910
     C                     KFLD           XCCY                            217910
     C                     KFLD           XACOD                           217910
     C                     KFLD           XACSQ                           217910
      *                                                                   217910
     C                     ENDSR                           **RTVRE  ENDSR*217910
     C********************************************************************217910
     C/EJECT
     C********************************************************************
     C/COPY WNCPYSRC,RE3664C005                                           S01408
     C**
     C** GEISR subroutine for GEICPD file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           GEISR     BEGSR                           **GEISR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'GEIC '   DBFILE           ***************CCB003
     C                     MOVEL'GEIC'    DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSGEI    DBSTAT           ***************
     C                     MOVEA'11'      *IN,88
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **GEISR ENDSR**
     C********************************************************************
     C/COPY OFCPYSRCZ,CRE105_010                                                              CRE105
     C/EJECT
     C********************************************************************
     C**
     C** IACSR subroutine for REIAC    file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           IACSR     BEGSR                           **IACSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'REIAC'   DBFILE           ***************CCB003
     C                     MOVEL'REIAC'   DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSIAC    DBSTAT           ***************
     C                     MOVEA'11'      *IN,88
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **IACSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** INITPR subroutine to initialize works fields
     C**
     C**     Called by       FIRST
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           INITPR    BEGSR                           **INITPR BEGSR*
     C*
     C                     MOVE 'P'       RECI
     C                     Z-ADDRUND      PSTD
     C                     Z-ADD*ZEROS    CHQN
     C                     Z-ADD*ZEROS    REJC
     C                     Z-ADD*ZEROS    RRNM
     C                     Z-ADD*ZEROS    ACUM
     C************         MOVE '000'     DPMT                            105084
     C                     MOVE '   '     DPMT                            105084
     C                     BITOF'01234567'PRIN
     C                     MOVE *BLANKS   EXIN
     C                     MOVE '  GE-IC' SPOS
     C                     Z-ADD91060     TRAT
     C                     MOVEL'91060'   OTTP
     C                     MOVE 'C'       GETP
     C*
     C** SET DEFAULT NARRATIVE
     C*
     C                     MOVE XCUNT     WLGID
     C*
     C** ACCESS ADJUSTEMENT INTEREST NARRATIVE
     C*
     C                     MOVE 'R1'      LNARC   2
     C**********           MOVEL'INT ADJ' DN07,1                                              CGL029
     C                     MOVEL'INTADJ'  DN07,1                                              CGL029
     C***********          MOVEL'INTEREST'NR16,1                          135401
     C***********          MOVE ' ADJ.   'NR16,1                          135401
     C                     MOVEL'DR INT. 'NR16,1                          135401
     C                     MOVE 'ADJ.    'NR16,1                          135401
     C/COPY WNCPYSRC,RE3664C141
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C**********           MOVELNARD      NAR,1                                    MD020956 MD022635
     C                     MOVELNARD      NAR,2                                             MD022635
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C**********           MOVELNR16,1    NAR,1                           183947
     C                     MOVE *BLANKS   NAR,2                           183947
     C                     MOVEL'INT.CAP.'NAR,2                           183947
     C                     ELSE
     C***********          MOVELNARD      NAR,1                                             MD022635
     C                     MOVELNARD      NAR,2                                             MD022635
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0019'  MGD,1     P                     S01522
     C*                                                                   135401
     C                     MOVE 'RB'      LNARC                           135401
     C                     Z-ADD12        W       20                      135401
     C**********           MOVEL'INT ADJ' DN07,W                                       135809 CGL029
     C**********           MOVEL'INTADJ'  DN07,W                                      CGL029 135809R
     C                     MOVEL'INTADJ'  DN07,W                                            AR978914
     C                     MOVEL'CR INT. 'NR16,W                          135401
     C                     MOVE 'ADJ.    'NR16,W                          135401
     C*                                                                   135401
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,12                                            MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'                                135401
     C                     PARM *BLANKS   @RTCD                           135401
     C                     PARM '*KEY   ' @OPTN                           135401
     C                     PARM LNARC     @NVCD   2                       135401
     C           SDNARR    PARM SDNARR    DSFDY                           135401
     C           @RTCD     IFNE *BLANK                                    135401
     C                     MOVELNR16,W    NAR,12                          135401
     C                     ELSE                                           135401
     C                     MOVELNARD      NAR,12                          135401
     C                     END                                            135401
     C                     ENDIF                                                            CRE083BK
     C*                                                                   135401
     C                     MOVEL'GB00193' MGD,12    P                     135401
      *                                                                                       234438
      ** RC - European Taxation of Interest                                                   234438
      *                                                                                       234438
     C           CGL031    IFEQ 'Y'                                                           234870
     C                     MOVE 'RC'      LNARC                                               234438
     C                     Z-ADD14        W                                                   234438
     C                     MOVEL'EU TAX'  DN07,W                                              234438
     C                     MOVEL'EU TAXAT'NR16,W                                              234438
     C                     MOVE 'ION     'NR16,W                                              234438
      *                                                                                       234438
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,14                                            MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'                                                    234438
     C                     PARM *BLANKS   @RTCD                                               234438
     C                     PARM '*KEY   ' @OPTN                                               234438
     C                     PARM LNARC     @NVCD   2                                           234438
     C           SDNARR    PARM SDNARR    DSFDY                                               234438
      *                                                                                       234438
     C           @RTCD     IFNE *BLANK                                                        234438
     C                     MOVELNR16,W    NAR,14                                              234438
     C                     ELSE                                                               234438
     C                     MOVELNARD      NAR,14                                              234438
     C                     ENDIF                                                              234438
     C                     ENDIF                                                            CRE083BK
      *                                                                                       234438
     C**********           MOVEL'GB00243' MGD,14    P                                  234438 236352
     C                     MOVEL'GB0054 ' MGD,14    P                                         236352
     C                     ENDIF                                                              234870
     C*
     C** ACCESS INTEREST NARRATIVE
     C*
     C                     MOVE 'R2'      LNARC
     C**********           MOVEL'INT.   ' DN07,2                                              CGL029
     C                     MOVEL'INT.  '  DN07,2                                              CGL029
     C***********          MOVEL'INTEREST'NR16,2                          074598
     C/COPY WNCPYSRC,RE3664C006                                           S01408
     C                     MOVEL'INT.CAP.'FLD10                           074598
     C                     MOVE ' -'      FLD10                           074598
     C                     MOVELFLD10     NR16,2                          074598
     C/COPY WNCPYSRC,RE3664C007                                           S01408
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C**********           MOVELNARD      NAR,2                                    MD020956 MD022635
     C                     MOVELNARD      NAR,4                                             MD022635
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C           CRE002    IFNE 'Y'                                       183947
     C**********           MOVELNR16,2    NAR,2                           183947
     C                     MOVE *BLANKS   NAR,4                           183947
     C                     MOVEL'INT.CAP.'NAR,4                           183947
     C                     END                                            183947
     C                     ELSE
     C***********          MOVELNARD      NAR,2                                             MD022635
     C                     MOVELNARD      NAR,4                                             MD022635
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C**********           MOVEL'GB0020'  MGD,2     P                                S01522 MD022635
     C                     MOVEL'GB0020'  MGD,4     P                                       MD022635
     C*
     C** ACCESS CHARGES NARRATIVE
     C*
     C                     MOVE 'R3'      LNARC
     C**********           MOVEL'CHARGES' DN07,3                                              CGL029
     C                     MOVEL'CHARGE'  DN07,3                                              CGL029
     C                     MOVEL'CHARGES 'NR16,3
     C/COPY WNCPYSRC,RE3664C142
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,3                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,3    NAR,3
     C                     ELSE
     C                     MOVELNARD      NAR,3
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0021'  MGD,3     P                     S01522
     C*
     C** ACCESS ACCRUAL  NARRATIVE
     C*
     C           CRE002    IFEQ 'Y'                        B1             CRE002
     C                     MOVE 'R6'      LNARC                           CRE002
     C**********           MOVEL'CAPIT. ' DN07,4                                       CRE002 CGL029
     C                     MOVEL'CAPIT.'  DN07,4                                              CGL029
     C                     MOVEL'CAPITAL' NR16P1                          CRE002
     C                     MOVEL'ISATION' NR16P2                          CRE002
     C                     MOVELNR16DS    NR16,4                          CRE002
     C                     ELSE                            X1             CRE002
     C                     MOVE 'R4'      LNARC
     C**********           MOVEL'ACCRUAL' DN07,4                                              CGL029
     C                     MOVEL'ACCR. '  DN07,4                                              CGL029
     C***********          MOVEL'ACCRUALS'NR16,4                          074598
     C/COPY WNCPYSRC,RE3664C008                                           S01408
     C                     MOVEL'ACCR.A/C'FLD10  10                       074598
     C                     MOVE ' -'      FLD10                           074598
     C                     MOVELFLD10     NR16,4                          074598
     C/COPY WNCPYSRC,RE3664C009                                           S01408
     C                     ENDIF                           E1             CRE002
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,4                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C           CRE002    IFNE 'Y'                                       183947
     C**********           MOVELNR16,4    NAR,4                           183947
     C                     MOVE *BLANKS   NAR,4                           183947
     C                     MOVEL'INT.CAP.'NAR,4                           183947
     C                     END                                            183947
     C                     ELSE
     C                     MOVELNARD      NAR,4
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0022'  MGD,4     P                     S01522
     C/COPY WNCPYSRC,RE3664C227
     C*                                                                   057048
     C** ACCESS CLOSURE INTEREST NARRATIVE                                057048
     C*                                                                   057048
     C**********           MOVE 'R5'      LNARC                     057048189038
     C                     MOVE 'R2'      LNARC                           189038
     C                     Z-ADD11        #                               057048
     C***********          MOVEL'CLOSURE' DN07,#                    057048084082
     C***********          MOVEL'CLOSURE' NR16,#                    057048084082
     C***********          MOVEL'BRT INT' DN07,#                          088273
     C***********          MOVEL'BRT INTE'NR16,#                          088273
     C***********          MOVE 'REST    'NR16,#                          088273
     C**********           MOVEL'CLOSURE' DN07,#                                       088273 CGL029
     C                     MOVEL'CLOSUR'  DN07,#                                              CGL029
     C                     MOVEL'CLOS.INT'NR16,#                          088273
     C                     MOVE '. -     'NR16,#                          088273
     C/COPY WNCPYSRC,RE3664C143
     C*                                                                   057048
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,#                           057048            MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'                                057048
     C                     PARM *BLANKS   @RTCD                           057048
     C                     PARM '*KEY   ' @OPTN                           057048
     C                     PARM LNARC     @NVCD   2                       057048
     C           SDNARR    PARM SDNARR    DSFDY                           057048
     C           @RTCD     IFNE *BLANK                                    057048
     C                     MOVE '       ' NR16,#                          183947
     C                     MOVELNR16,#    NAR,#                           057048
     C                     MOVE '. -     'NR16,#                          183947
     C                     ELSE                                           057048
     C                     MOVELNARD      NAR,#                           057048
     C                     END                                            057048
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C**********           MOVEL'GB0023'  MGD,11    P                                S01522 MD022635
     C                     MOVEL'GB0023'  MGD,#     P                                       MD022635
     C*
     C** ACCESS TAXES NARRATIVE
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP27                                           S01408
     C*                                                                   S01408
     C********** TXWTRR    IFNE 0                          - B0                               CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
     C           CGL165    OREQ 'Y'                                                           CGL165
     C           CDL013    OREQ '0'                                                           CDL013
     C           TXWTRR    ANDNE0                                                             CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP28                                           S01408
     C*                                                                   S01408
     C                     MOVE 'T1'      LNARC
     C**********           MOVEL'W/TAX  ' DN07,5                                              CGL029
     C                     MOVEL'W/TAX '  DN07,5                                              CGL029
     C                     MOVEL'WITHHOLD'NR16,5
     C                     MOVE 'ING TAX 'NR16,5
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,5                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,5    NAR,5
     C                     ELSE
     C                     MOVELNARD      NAR,5
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0024'  MGD,5     P                     S01522
     C*
     C                     END                             - E0
     C*
     C           BGNTST    IFEQ 'Y'                        - B0
     C                     MOVE 'T2'      LNARC
     C**********           MOVEL'TOT. DR' DN07,6                                              CGL029
     C                     MOVEL'TOT.DR'  DN07,6                                              CGL029
     C                     MOVEL'TOTAL DE'NR16,6
     C                     MOVE 'BIT     'NR16,6
     C/COPY WNCPYSRC,RE3664C144
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,6                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,6    NAR,6
     C                     ELSE
     C                     MOVELNARD      NAR,6
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0025'  MGD,6     P                     S01522
     C*
     C                     MOVE 'T3'      LNARC
     C                     MOVEL'TOT. CR' DN07,7
     C                     MOVEL'TOTAL CR'NR16,7
     C                     MOVE 'EDIT    'NR16,7
     C/COPY WNCPYSRC,RE3664C145
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,7                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,7    NAR,7
     C                     ELSE
     C                     MOVELNARD      NAR,7
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0026'  MGD,7     P                     S01522
     C*
     C                     MOVE 'T4'      LNARC
     C                     MOVEL'CR SBJ'  DN07,8
     C                     MOVEL'TOT. CR 'NR16,8
     C                     MOVE 'SUBJ TAX'NR16,8
     C/COPY WNCPYSRC,RE3664C146
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,8                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,8    NAR,8
     C                     ELSE
     C                     MOVELNARD      NAR,8
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0027'  MGD,8     P                     S01522
     C*
     C                     MOVE 'T5'      LNARC
     C**********           MOVEL'CR NSBJ' DN07,9                                              CGL029
     C                     MOVEL'CR NSJ'  DN07,9                                              CGL029
     C                     MOVEL'TOT. CR 'NR16,9
     C                     MOVE 'NOT SUBJ'NR16,9
     C/COPY WNCPYSRC,RE3664C147
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,9                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,9    NAR,9
     C                     ELSE
     C                     MOVELNARD      NAR,9
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0028'  MGD,9     P                     S01522
      **Set*up*narrative*for*transfer*of*net*interest*to*alt.*a/c******************   135809 135809R
     C**********           MOVE 'T6'      LNARC                                       135809 135809R
     C**********           Z-ADD13        #                                           135809 135809R
     C**********           MOVEL'NET ALT' DN07,#                                       135809 CGL029
     C**********           MOVEL'NT ALT'  DN07,#                                      CGL029 135809R
     C**********           MOVEL'NET INT.'NR16,#                                      135809 135809R
     C**********           MOVE 'TO ALT. 'NR16,#                                      135809 135809R
     C**********           CALL 'AONARRR0'                                            135809 135809R
     C**********           PARM *BLANKS   @RTCD                                       135809 135809R
     C**********           PARM '*KEY   ' @OPTN                                       135809 135809R
     C**********           PARM LNARC     @NVCD                                       135809 135809R
     C********** SDNARR    PARM SDNARR    DSFDY                                       135809 135809R
     C********** @RTCD     IFNE *BLANK                                                135809 135809R
     C**********           MOVELNR16,#    NAR,#                                       135809 135809R
     C**********           ELSE                                                       135809 135809R
     C**********           MOVELNARD      NAR,#                                       135809 135809R
     C**********           END                                                        135809 135809R
      ****Set*up*Narrative*message:*rightmost*byte*blank***************************   135809 135809R
     C**********           MOVEL'GB0051'  MGD,#     P                                 135809 135809R
     C/COPY WNCPYSRC,REH00432
      * Set up narrative for transfer of net interest to*alt. a/c                           AR978914
     C                     MOVE 'T6'      LNARC                                             AR978914
     C                     Z-ADD13        #                                                 AR978914
     C                     MOVEL'NT ALT'  DN07,#                                            AR978914
     C                     MOVEL'NET INT.'NR16,#                                            AR978914
     C                     MOVE 'TO ALT. 'NR16,#                                            AR978914
      *                                                                                     MD021155
     C                     Z-ADDCUNARA    B                                                 MD021155
     C           LNARC     LOKUPANAR,B                   18                                 MD021155
      *                                                                                     MD021155
     C           *IN18     IFEQ '1'                                                         MD021155
     C           B         OCUR SDNARR                                                      MD021155
     C                     MOVELNARD      NAR,#                                             MD021155
     C                     ELSE                                                             MD021155
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'                                                  AR978914
     C                     PARM *BLANKS   @RTCD                                             AR978914
     C                     PARM '*KEY   ' @OPTN                                             AR978914
     C                     PARM LNARC     @NVCD                                             AR978914
     C           SDNARR    PARM SDNARR    DSFDY                                             AR978914
     C           @RTCD     IFNE *BLANK                                                      AR978914
     C                     MOVELNR16,#    NAR,#                                             AR978914
     C                     ELSE                                                             AR978914
     C                     MOVELNARD      NAR,#                                             AR978914
     C                     END                                                              AR978914
     C                     ENDIF                                                            MD021155
      *   Set up Narrative message: rightmost byte blank                                    AR978914
     C                     MOVEL'GB0051'  MGD,#     P                                       AR978914
     C*
     C                     END                             - E0
     C*
     C           S01383    IFEQ 'Y'
     C                     MOVE 'B1'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,#                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C*
     C                     Z-ADD10        #       20
     C**********           MOVEL'BRT INT' DN07,#                                              CGL029
     C                     MOVEL'BRT IN'  DN07,#                                              CGL029
     C                     MOVEL'BRT INTE'NR16,#
     C                     MOVE 'REST    'NR16,#
     C/COPY WNCPYSRC,RE3664C148
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,#    NAR,#
     C                     ELSE
     C                     MOVELNARD      NAR,#
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0029'  MGD,#     P                     S01522
     C*
     C                     END
     C*
     C** CHECK IF BASE CURRENCY EXIST
     C*
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BACCY     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C***********          CALL 'AOCURRR0'                                                    CGL165
     C                     CALL 'AOCURRR1'                                                    CGL165
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BACCY     @CYCD   3
     C***********SDCURR    PARM SDCURR    DSSDY                                               CGL165
     C           SDCURR    PARM SDCURR    DSLDY                                               CGL165
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 10 *CRE002
     C***********          Z-ADD010       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 054*CRE002
     C                     Z-ADD054       DBASE            ***************CRE002
     C                     OUT  LDA
     C*********************WRITEERRP1                                     088181
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C** SAVE PARM FOR CROSS CURRENCY
     C*
     C                     Z-ADDCDP       WBCDP
     C                     Z-ADDSPOT      WBSPOT
     C                     MOVE MDIN      WBMDIN
     C                     MOVE TACC      WBTACC
      *                                                                                       CGL165
      * If CGL165 is On, save Tax Conversion Rate                                             CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     Z-ADDTXCR      WBTXCR                                              CGL165
     C                     ENDIF                                                              CGL165
     C/COPY WNCPYSRC,RE3664C194
     C*                                                                                       CGL165
     C** If CGL165 is On, obtain and Save Local CCY details                                   CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     Z-ADDCUCCYA    A                                                   CGL165
     C           BJLCCY    LOKUPACUR,A                   17                                   CGL165
      *                                                                                       CGL165
     C           *IN17     IFEQ '1'                                                           CGL165
     C           A         OCUR SDCURR                                                        CGL165
     C                     ELSE                                                               CGL165
     C           1         OCUR SDCURR                                                        CGL165
     C                     CALL 'AOCURRR1'                                                    CGL165
     C                     PARM '*MSG   ' @RTCD                                               CGL165
     C                     PARM '*KEY   ' @OPTN                                               CGL165
     C                     PARM BACCY     @CYCD   3                                           CGL165
     C           SDCURR    PARM SDCURR    DSLDY                                               CGL165
     C           @RTCD     IFNE *BLANK                                                        CGL165
     C           *LOCK     IN   LDA                                                           CGL165
     C                     MOVEL'SDCURRPD'DBFILE           ***************                    CGL165
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 554*                    CGL165
     C                     Z-ADD554       DBASE            ***************                    CGL165
     C                     OUT  LDA                                                           CGL165
     C                     EXSR *PSSR                                                         CGL165
     C                     END                                                                CGL165
     C                     ENDIF                                                              CGL165
     C*                                                                                       CGL165
     C** SAVE PARM FOR CROSS CURRENCY                                                         CGL165
     C*                                                                                       CGL165
     C                     Z-ADDCDP       WLCDP                                               CGL165
     C                     Z-ADDSPOT      WLSPOT                                              CGL165
     C                     MOVE MDIN      WLMDIN                                              CGL165
     C                     MOVE TACC      WLTACC                                              CGL165
     C*************        Z-ADDTXCR      WBTXCR                                    CGL165 CC-CGL165
     C                     Z-ADDTXCR      WLTXCR                                           CC-CGL165
     C                     ENDIF                                                              CGL165
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C           WBTACC    IFNE *BLANKS                                   088181
     C**********           MOVE WBTACC    KACOD   4                                           CGL029
     C                     MOVE WBTACC    KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD055       WDBASE                                            CRE083BK
     C**********           EXSR CHKACD                                            CRE083BK AR1089863
     C                     EXSR ACDCCH                                                     AR1089863
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 78 *CRE002
     C***********          Z-ADD078       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 055*           CRE002 CRE083BK
     C**********           Z-ADD055       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C*********************WRITEERRP1                                     088181
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WBTACT
     C                     ENDIF                                          088181
     C*
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C           WLTACC    ANDNE*BLANKS                                                       CGL165
     C                     MOVE WBTACC    KACOD                                               CGL165
     C*                                                                                       CGL165
     C                     ADD  1         RCSQ                                                CGL165
     C                     MOVE KACOD     KEYACD                                              CGL165
     C                     Z-ADD555       WDBASE                                              CGL165
     C                     EXSR ACDCCH                                                        CGL165
     C*                                                                                       CGL165
     C                     MOVE A5ACTY    WLTACT                                              CGL165
     C                     ENDIF                                                              CGL165
     C/COPY WNCPYSRC,RE3664CCPG                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           **INITPR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** MAIN subroutine to execute main processing.
     C**
     C**     Called by       S T A R T
     C**     Calls           CHGPR,CREPR,*PSSR,DEBPR,SETPR,TOTAC
     C**
      *****************************************************************   CCB003
     C           MAIN      BEGSR                           **MAIN BEGSR**
     C*
     C** RESET NEW FIELDS FOR O/P ON BALANCE STATEMENTS
     C*
     C                     MOVE ' '       BRTF
     C                     Z-ADD0         BRTA
     C/COPY WNCPYSRC,RE3664C187
     C*
     C                     SETOF                     2627
     C**
     C**  IF BRT SAR INSTALLED
     C**  ON CHANGE OF CCY - ACCESS ARC FOR SPOT TRADE EQUIV. ACC. CODE
     C**
     C           S01383    IFEQ 'Y'                        B001
     C           BCCY      ANDNECCY#
     C*
     C                     MOVE BCCY      CCY#
     C*
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY      LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BCCY      @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 51 *CRE002
     C***********          Z-ADD051       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 56 *CRE002
     C                     Z-ADD056       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C**
     C**   MOVE ARRAY ELEMENT WITH CCY DETAILS INTO DATA STRUCTURE.
     C**
     C                     MOVE TACC      TACC1   4
     C           CDP       COMP 1                      8081
     C           CDP       COMP 2                    83  82
     C                     MOVE TACC      ACODA
     C           TACC      IFNE *BLANKS                                                       239314
     C                     EXSR ACDCHN
     C                     ENDIF                                                              239314
     C                     MOVE CDP       CDPW    10
     C                     MOVE SPOT      SPOTW  138
     C                     MOVE MDIN      MDINW   1
     C                     MOVE A5ACSC    TSEC1   2
     C**
     C                     END                             E001
     C*
     C** INITIALIZE WORK FIELDS
     C*
     C                     Z-ADD0         WDIWT
     C                     Z-ADD0         WCIWT
     C                     Z-ADD0         WTIWT  130
     C**********           Z-ADD*ZERO     @CRINT                                      135809 135809R
     C**********           Z-ADD*ZERO     @CRNET                                      135809 135809R
     C                     Z-ADD*ZERO     @CRINT                                            AR978914
     C                     Z-ADD*ZERO     @CRNET                                            AR978914
     C                     Z-ADD*ZERO     @WCAIC                          130468
     C*
     C** SET DEFAULT TAX TO APLLY
     C                     MOVE 'N'       ATITAX
     C*
     C                     MOVE '0'       *IN40                           106213
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP29                                           S01408
     C*                                                                   S01408
     C*                                                                   106213
     C           TXWTRR    IFNE 0
     C           CDL013    ANDNE'1'                                                           CDL013
      *                                                                                       CDL013
      ** If CDL013 installed, perform Tiered WHT Instructions.                                CDL013
      *                                                                                       CDL013
     C           CDL013    OREQ '1'                                                           CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP30                                           S01408
     C*                                                                   S01408
      ** If CGL165 installed, also ensure to access ACCNTBXC                                  CGL165
      *                                                                                       CGL165
     C           CGL165    OREQ 'Y'                                                           CGL165
     C***********          Z-ADD81        DBASE                           CRE002
     C                     Z-ADD057       DBASE            * DB ERROR 057*CRE002
     C           ACKEY1    CHAINACCNTBXC             40
     C                     MOVE BCNUM     BCNUMA  6
     C                     Z-ADD*ZEROS    DBASE
     C                     END
     C*
     C** READ ACCNT TO GET RETAIL NUMBER
     C*
     C           *IN40     IFEQ '0'
     C***********          Z-ADD48        DBASE                           CRE002
     C                     Z-ADD058       DBASE            * DB ERROR 058*CRE002
     C           ACKEY1    CHAINACCNT               N40
     C                     Z-ADD*ZEROS    DBASE
     C                     END
     C*
     C/COPY WNCPYSRC,RE3664C162
     C           *IN40     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C***********          Z-ADD03        DBASE            ***************CRE002
     C                     Z-ADD059       DBASE                           CRE002
     C***********          MOVE 'ACCNT'   DBFILE           **DB ERROR 03**CCB003
     C                     MOVEL'ACCNT'   DBFILE           **DB ERROR 03**CCB003
     C                     MOVELAKEY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             - E1
      *                                                                   CAC001
      **  Setup profit centre of main account                             CAC001
      *                                                                   CAC001
     C********** BGN0ST    IFEQ 'Y'                                CAC001 184965
     C                     MOVELAAPRFC    WMPRFC  4                       CAC001
      ** Save Profit center of main account                                                 MD022635
     C                     MOVE AAPRFC    WSVPC                                             MD022635
     C                     MOVE AAPRFC    PRFC                                              MD022635
     C**********           ENDIF                                   CAC001 184965
     C*
     C** SAVE RETAIL NUMBER IF NECESSARY
     C*
     C           AAATYP    IFEQ 'R'                        - B1
     C           RACN      ANDEQ'Y'                        - B1
     C                     MOVE AAACNO    WACNO
     C                     ELSE                            - X1
     C                     MOVE *BLANKS   WACNO
     C                     END                             - E1
     C/COPY WNCPYSRC,REH00446
     C*
     C***READ*RECORDS COUNTER                                             CCB003
     C***********                                                         CCB003
     C***********          ADD  1         RECN                            CCB003
     C*
     C** CHECK IF CURRENCY EXIST
     C*
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY      LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BCCY      @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 11 *CRE002
     C***********          Z-ADD011       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 061*CRE002
     C                     Z-ADD061       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C** SAVE PARM FOR CROSS CURRENCY
     C*
     C                     Z-ADDCDP       WOCDP
     C                     Z-ADDSPOT      WOSPOT
     C                     MOVE MDIN      WOMDIN
     C                     MOVE TACC      WOTACC
     C                     Z-ADDTXCR      WOTXCR                                              CGL165
     C/COPY WNCPYSRC,RE3664C195
     C*
     C** CHECK NUMBER OF DECIMAL OF CURRENCY
     C*
     C                     MOVEA'0000'    *IN,80
     C*
     C           CDP       IFEQ 0                          - B1
     C                     MOVE '1'       *IN80
     C                     ELSE                            - X1
     C           CDP       IFEQ 1                          - B2
     C                     MOVE '1'       *IN81
     C                     ELSE                            - X2
     C           CDP       IFEQ 2                          - B3
     C                     MOVE '1'       *IN82
     C                     ELSE                            - X3
     C                     MOVE '1'       *IN83
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C** POSITIONING ON HISTORY FILE (CAPITALISATION RECORDS)
     C*
     C                     Z-ADD*ZEROS    PMADI
     C                     Z-ADD*ZEROS    RGADI
     C                     Z-ADD*ZEROS    RDAIC
     C                     Z-ADD*ZEROS    PMACI
     C                     Z-ADD*ZEROS    RGACI
     C                     Z-ADD*ZEROS    RCAIC
     C                     Z-ADD*ZEROS    CHGP
     C                     Z-ADD*ZEROS    REGLIS
      *                                                                                     AR676495
      ** INITIALISE INTEREST ADJUSTMENT INDICATOR                                           AR676495
      *                                                                                     AR676495
     C                     MOVE '0'       INTAD                                             AR676495
     C*
     C***********          Z-ADD89        DBASE                           CRE002
     C                     Z-ADD062       DBASE            * DBERROR  062*CRE002
     C/COPY WNCPYSRC,RE3664C140
     C********** ACKEY     SETLLREHISSL                  60                                   CGL029
     C           ACKEY2    SETLLREHISSL                  60                                   CGL029
     C*
     C           *IN60     IFEQ '1'                        - B1
     C*
     C** CAPITALISATION RECORD FOUND WITH AMOUNT TO BE POSTED
     C*
     C***********          Z-ADD49        DBASE                           CRE002
     C                     Z-ADD063       DBASE            * DBERROR  063*CRE002
     C********** ACKEY     READEREHISSL                  60                                   CGL029
     C           ACKEY2    READEREHISSL                  60                                   CGL029
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** SETUP ACCNT WORK FIELDS PROCESSING
     C*
     C                     EXSR SETPR
     C*
     C** IF RECORD NOT FOUND, TOTAL ACCOUNT PROCESSING
     C** OTHERWISE, PROCESSING
     C*
     C           *IN60     DOWEQ'0'                        - B2
     C/COPY WNCPYSRC,RE3664C093
     C*
     C           BDICI     IFNE ' '                        - B3
     C           SDICI     IFEQ 'Y'                        - B4
     C           SDICI     OREQ 'D'
     C           SDICI     OREQ 'C'
     C***********          MOVE 'Y'       SDICI                           094681
     C           DAIC      IFNE 0                          - B5
     C           SGADI     ORNE 0
     C           PMADI     ORNE SMADI                                     091680
     C*
     C** DEBIT PROCESSING
     C*
     C                     EXSR DEBPR
     C*
     C                     END                             - E5
     C***********          MOVE 'Y'       SDICI                     094681098818
     C                     END                             - E4
     C                     END                             - E3
     C*
     C           BCICI     IFNE ' '                        - B3
     C           SCICI     IFEQ 'Y'                        - B4
     C           SCICI     OREQ 'D'
     C           SCICI     OREQ 'C'
     C***********          MOVE 'Y'       SCICI                           094681
     C           CAIC      IFNE 0                          - B5
     C           SGACI     ORNE 0
     C           PMACI     ORNE SMACI                                     091680
     C*
     C** CREDIT PROCESSING
     C*
     C                     EXSR CREPR
     C/COPY WNCPYSRC,REH00445
     C*
     C                     END                             - E5
     C***********          MOVE 'Y'       SCICI                     094681098818
     C                     END                             - E4
     C                     END                             - E3
     C*
     C           BCICI     IFNE ' '                        - B3
     C           SCHGI     ANDNE' '
     C           CHGP      ANDNE0
     C*
     C** CHARGES PROCESSING
     C*
     C                     EXSR CHGPR
     C*
     C                     END                             - E3
     C*
     C** CAPITALISATION RECORD PROCESSING
     C*
     C***********          Z-ADD50        DBASE                           CRE002
     C                     Z-ADD064       DBASE            * DBERROR  064*CRE002
     C                     MOVE *BLANKS   ZZ001                                             MD024001
     C                     UPDATREHISPSF
     C/COPY WNCPYSRC,RE3664C094
     C***********          Z-ADDDBASE     DBASE
     C                     Z-ADD0         DBASE
     C*
     C***********          Z-ADD51        DBASE                           CRE002
     C                     Z-ADD065       DBASE            * DBERROR  065*CRE002
     C********** ACKEY     READEREHISSL                  60                                   CGL029
     C           ACKEY2    READEREHISSL                  60                                   CGL029
     C***********          Z-ADDDBASE     DBASE
     C                     Z-ADD0         DBASE
     C*
     C                     END                             - E2
     C*
     C                     ELSE
     C                     EXSR SETPR
     C                     MOVE BCCY      CCY
     C                     MOVE BBRCA     BRCA
     C*
     C                     END                             - E1
     C*
     C** TOTAL ACCOUNT PROCESSING
     C*
     C/COPY WNCPYSRC,REH00447
     C                     EXSR TOTAC
     C*
     C                     ENDSR                           **MAIN ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***********                                                         CCB003
     C***OVERPR*subroutine for processing overflow on RE3664PR            CCB003
     C***********                                                         CCB003
     C*******Called by       PRDR,PRCR,PRCH                               CCB003
     C***********                                                         CCB003
     C*******Calls           -                                            CCB003
     C***********                                                         CCB003
     C***********OVERPR    BEGSR                           **OVERPR BEGSR*CCB003
     C***********                                                         CCB003
     C****CHECK*IF OVERFLOW ON RE3664P1                                   CCB003
     C***********                                                         CCB003
     C********** *IN90     IFEQ '1'                        - B1     075073CCB003
     C************IN85     IFEQ '1'                        - B1     075073CCB003
     C**********           ADD  1         PAGE                      085787CCB003
     C***********          WRITEHEADP1                                    CCB003
     C***********          MOVE '0'       *IN43                           CCB003
     C***********          MOVE '0'       *IN90                     075073CCB003
     C***********          MOVE '0'       *IN85                     075073CCB003
     C***********          END                             - E1           CCB003
     C***********                                                         CCB003
     C***********          ENDSR                           **OVERPR ENDSR*CCB003
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** PLPR subroutine to execute profit and loss processing
     C**
     C**     Called by       CREPR,DEBPR
     C**     Calls           GEICPR
     C**
      *****************************************************************   CCB003
     C           PLPR      BEGSR                           **PLPR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3664C059
     C                     MOVE BBICN     CNUM
     C/COPY WNCPYSRC,RE3664C112
     C           WCHRG     IFEQ 'Y'                                                           CRE100
     C           UPDCUS    ANDNE'Y'                                                         MD027841
     C           WINT      OREQ 'Y'                                                         MD027841
     C           UPDCUS    ANDEQ'Y'                                                         MD027841
     C                     MOVE BCNUM     CNUM                                                CRE100
     C                     ENDIF                                                              CRE100
     C                     Z-ADD1         ACSQ
      * Account Sequence                                                                    MD034990
     C           RETSEQ    IFEQ 'Y'                                                         MD034990
     C                     MOVE BACSQ     ACSQ                                              MD034990
     C                     ENDIF                                                            MD034990
     C/COPY WNCPYSRC,RE3664C113
     C                     MOVE BBRCA     BRCA
     C                     Z-ADD*ZEROS    ACNO
     C**********           Z-ADDBCNUM     ASOC                                         105084 CSD027
     C                     MOVE BCNUM     ASOC                                                CSD027
     C           VALD      IFEQ *ZEROS                                    100086
     C                     Z-ADDRUND      VALD
     C                     END                                            100086
     C******************** Z-ADD*ZERO     RIND
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C                     Z-ADD*ZERO     RIND
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     END
     C*
     C** GEICPD FILE PROCESSING
     C*
     C                     EXSR GEICPR
     C*
     C           ATYP      IFEQ 'R'
     C           VALD      ANDLENAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C060
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD066       DBASE            * DBERROR  066*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END
     C/COPY WNCPYSRC,RE3664C061
     C*
     C                     ENDSR                           **PLPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** POSPR subroutine to update position records for alternate account
     C**
     C**     Called by       ALTPR
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           POSPR     BEGSR                           **POSPR BEGSR**
     C*
     C** ACCESS POSITION RECORD FOR UPDATE OR ADD THEN UPDATE HEADER
     C*
     C***********          Z-ADD52        DBASE                           CRE002
     C                     Z-ADD067       DBASE            * DBERROR  067*CRE002
     C           R3KEY     CHAINREHISPDF             40
     C                     Z-ADD*ZEROS    DBASE
     C           *IN40     IFEQ '1'                        - B1
     C                     MOVE 'D'       RECI
     C                     MOVE *BLANK    DLGID
     C                     Z-ADD*ZERO     VALL
     C                     MOVE *BLANKS   LINK
     C                     MOVE *BLANK    DICI
     C                     MOVE *BLANK    CICI
     C                     MOVE *BLANK    DRCI
     C                     MOVE *BLANK    CRCI
     C                     MOVE *BLANK    ALTI
     C                     Z-ADD*ZERO     DRIR
     C                     Z-ADD*ZERO     CRIR
     C                     Z-ADD*ZERO     PDID
     C                     Z-ADD*ZERO     PCID
     C                     Z-ADD*ZERO     DICT
     C                     Z-ADD*ZERO     CICT
     C                     Z-ADD*ZERO     DRCB
     C                     Z-ADD*ZERO     CRCB
     C                     MOVE *BLANK    ADTY
     C                     Z-ADD*ZERO     MNBL
     C                     Z-ADD*ZERO     CHGAR
     C                     Z-ADD*ZERO     TCHGAR
     C                     Z-ADD*ZERO     CHGAN
     C                     Z-ADD*ZERO     TCHGAN
     C           WCHGA     IFNE 0                                                             250998
     C           REBID     IFEQ 'Y'                                                           250998
     C                     Z-ADDWCHGA     CHGAR                                               250998
     C                     Z-ADDWCHGA     TCHGAR                                              250998
     C                     ELSE                                                               250998
     C                     Z-ADDWCHGA     CHGAN                                               250998
     C                     Z-ADDWCHGA     TCHGAN                                              250998
     C                     END                                                                250998
     C                     END                                                                250998
     C                     Z-ADD*ZERO     DMVT
     C                     Z-ADD*ZERO     CMVT
     C                     Z-ADD*ZERO     DAID
     C                     Z-ADD*ZERO     MADI
     C                     Z-ADD*ZERO     TMADI
     C                     Z-ADD*ZERO     DMINT
     C                     Z-ADD*ZERO     CAID
     C                     Z-ADD*ZERO     MACI
     C                     Z-ADD*ZERO     TMACI
     C                     Z-ADD*ZERO     CMINT
     C                     Z-ADD*ZERO     MNBCP
     C                     Z-ADD*ZERO     DRCD
     C                     Z-ADD*ZERO     CRCD
     C                     Z-ADD*ZERO     VDTC
     C           DRCR      IFEQ 1                          - B2
     C                     Z-ADDPSTA      CMVT
     C                     ELSE                            - X2
     C                     Z-ADDPSTA      DMVT
     C                     END                             - E2
     C                     Z-ADD*ZERO     AODR                            CRE002
     C                     Z-ADD*ZERO     ODRL                            CRE002
     C                     MOVE *BLANK    ODLI                            CRE002
     C                     Z-ADD*ZERO     ODIA                            CRE002
     C***********          Z-ADD53        DBASE                           CRE002
     C                     Z-ADD068       DBASE            * DBERROR  068*CRE002
     C                     WRITEREHISPDF
     C                     Z-ADD*ZEROS    DBASE
     C                     ELSE                            - X1
     C           DRCR      IFEQ 1                          - B2
     C                     ADD  PSTA      CMVT
     C                     SUB  PSTA      HISB
     C                     ELSE                            - X2
     C                     ADD  PSTA      DMVT
     C                     ADD  PSTA      HISB
     C                     END                             - E2
     C           WCHGA     IFNE 0                                                             250998
     C           REBID     IFEQ 'Y'                                                           250998
     C                     ADD  WCHGA     CHGAR                                               250998
     C                     ADD  WCHGA     TCHGAR                                              250998
     C                     ELSE                                                               250998
     C                     ADD  WCHGA     CHGAN                                               250998
     C                     ADD  WCHGA     TCHGAN                                              250998
     C                     END                                                                250998
     C                     END                                                                250998
     C***********          Z-ADD54        DBASE                           CRE002
     C                     Z-ADD069       DBASE            * DBERROR  069*CRE002
     C                     UPDATREHISPDF
     C                     MOVE 'Y'       FCOMIT                                            MD022410
     C                     Z-ADD*ZEROS    DBASE
     C                     END                             - E1
      *                                                                                       250998
     C                     Z-ADD0         WCHGA                                               250998
     C/COPY WNCPYSRC,RE3664C163
     C*
     C** POSITIONING ON HISTORY FILE (HEADER RECORDS)
     C*
     C***********          Z-ADD55        DBASE                           CRE002
     C                     Z-ADD070       DBASE            * DBERROR  070*CRE002
     C           R2KEY     CHAINREHISPBF             40
     C                     Z-ADD*ZEROS    DBASE
     C*
     C           *IN40     IFEQ '1'                        - B1
     C*
     C** HEADER RECORD NOT FOUND
     C*
     C           *LOCK     IN   LDA
     C***********          Z-ADD14        DBASE            ***************CRE002
     C                     Z-ADD071       DBASE                           CRE002
     C***********          MOVE 'HISSL'   DBFILE           **DB ERROR 14**CCB003
     C                     MOVEL'HISSL'   DBFILE           **DB ERROR 14**CCB003
     C                     MOVELRKEY2     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     END                             - E1
     C*
     C           VDTC      IFGT SHISD                      - B1
     C                     Z-ADDSHISD     VDTC
     C                     END                             - E1
     C***********          MOVE 'Y'       ADTY                            122952
     C***********          Z-ADD56        DBASE                           CRE002
     C                     Z-ADD072       DBASE            * DBERROR  072*CRE002
     C                     UPDATREHISPBF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C                     ENDSR                           **POSPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** PRCHG subroutine for CHARGES OUTPUT
     C**
     C**     Called by       TOTAC
     C**     Calls           *PSSR, ZDATE2
     C**
      *****************************************************************   CCB003
     C           PRCHG     BEGSR                           **PRCHG BEGSR**
     C*
     C                     Z-ADD0         RAINTR           Interest rate  CCB003
     C                     Z-ADD0         RAMADJ           Manual adj amt CCB003
     C                     Z-ADD0         RAGADT           General int adjCCB003
     C**********           Z-ADDBCNUM     RACNUM           Customer number             CCB003 CSD027
     C                     MOVE BCNUM     RACNUM           Customer number                    CSD027
     C                     MOVE BCCY      RACCY            Currency       CCB003
     C                     Z-ADDBACOD     RAACOD           Account Code   CCB003
     C                     Z-ADDBACSQ     RAACSQ           Account SequencCCB003
     C                     MOVE BRCA#     RABRCA           Branch         CCB003
     C                     Z-ADDAACNO     RAACNO           Retail AC No.  CCB003
     C                     MOVE 'H'       RAPOST           Posting Type   CCB003
     C*
     C***********          Z-ADDLPAP      ZDAYNO                          CCB003
     C                     Z-ADDLPAP      RACPDA           Capital. date  CCB003
      *                                                                   CCB003
     C***********          EXSR ZDATE2                                    CCB003
     C***********                                                         CCB003
     C************IN99     IFEQ '1'                        - B3           CCB003
     C************LOCK     IN   LDA                                       CCB003
     C***********          Z-ADDLPAP      WDATE                           CCB003
     C***********          Z-ADD15        DBASE                           CCB003
     C***********          MOVE 'ZDATE2'  DBFILE           ***************CCB003
     C***********          MOVELWDATE     DBKEY            **DB ERROR 15**CCB003
     C***********          OUT  LDA                        ***************CCB003
     C***********          EXSR *PSSR                                     CCB003
     C***********          END                             - E1           CCB003
     C*
     C                     Z-ADDCHGT      RAINTP           Interest type  CCB003
     C                     Z-ADDCHST      RAINST           Interest SubTypeCB003
     C***********          Z-ADDCHGP      CHCP0                           CCB003
     C                     Z-ADDCHGP      RAAIAP           Accrued int adjCCB003
     C*
     C           SCHGI     IFEQ 'Y'                        - B1
     C           SCHGI     OREQ 'I'
     C***********          MOVE '1'       *IN71                           CCB003
     C                     MOVE 'Y'       RAPTFL           Posted today   CCB003
     C                     END                             - E1
     C*
     C           SCHGI     IFEQ 'S'                        - B1
     C***********          MOVE '1'       *IN72                           CCB003
     C                     MOVE 'S'       RAPTFL           Posted today   CCB003
     C                     END                             - E1
     C*
     C           SCHGI     IFEQ 'L'                        - B1
     C***********          MOVE '1'       *IN73                           CCB003
     C                     MOVE 'I'       RAPTFL           Posted today   CCB003
     C                     END                             - E1
     C*
     C           SCHGI     IFEQ 'O'                        - B1
     C***********          MOVE '1'       *IN74                           CCB003
     C                     MOVE 'L'       RAPTFL           Posted today   CCB003
     C                     END                             - E1
     C*
     C           SCHGI     IFEQ 'A'                        - B1
     C           SCHGI     OREQ 'P'
     C           SCHGI     OREQ 'Q'
     C***********          MOVE '1'       *IN75                           CCB003
     C                     MOVE 'A'       RAPTFL           Posted today   CCB003
     C                     END                             - E1
     C*                                                             075073085787
     C* If checks not allowed for against SCHGI false on indicator 61     075073
     C*                                                             075073085787
     C***********SCHGI     IFNE 'Y'                                 075073085787
     C***********SCHGI     ORNE 'I'                                 075073085787
     C***********SCHGI     ORNE 'S'                                 075073085787
     C***********SCHGI     ORNE 'L'                                 075073085787
     C***********SCHGI     ORNE 'O'                                 075073085787
     C***********SCHGI     ORNE 'A'                                 075073085787
     C***********SCHGI     ORNE 'P'                                 075073085787
     C***********SCHGI     ORNE 'Q'                                 075073085787
     C************IN61     ANDNE'1'                                 085787085787
     C************IN66     ANDNE'1'                                 085787085787
     C************IN71     IFEQ *OFF                                085787CCB003
     C************IN72     ANDEQ*OFF                                085787CCB003
     C************IN73     ANDEQ*OFF                                085787CCB003
     C************IN74     ANDEQ*OFF                                085787CCB003
     C************IN75     ANDEQ*OFF                                085787CCB003
     C***********          MOVE '1'       *IN71                     075073CCB003
     C***********          END                                      075073CCB003
     C*
     C           RAPTFL    IFEQ *BLANKS                                   CCB003
     C                     MOVE 'Y'       RAPTFL           Posted today   CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C           OKEY      IFNE AKEY                       - B1
     C                     MOVE '0'       *IN43
     C**********           Z-ADDBCNUM     OCNUM                                               CSD027
     C                     MOVE BCNUM     OCNUM                                               CSD027
     C                     MOVE BCCY      OCCY
     C                     Z-ADDBACOD     OACOD
     C                     Z-ADDBACSQ     OACSQ
     C                     MOVE BBRCA     OBRCA
     C                     END                             - E1
     C*
     C***********          EXSR OVERPR                                    CCB003
     C***********                                                         CCB003
     C***********          Z-ADD57        DBASE                           CCB003
     C***********          WRITEDETCH                                     CCB003
     C***********          Z-ADD*ZEROS    DBASE                           CCB003
     C***********          Z-ADD*ZEROS    CHCP0                           CCB003
     C***********          MOVE '1'       *IN43                           CCB003
     C***********          MOVEA'00000'   *IN,71                          CCB003
      *                                                                   CCB003
      ** Write record to Audit file                                       CCB003
     C                     WRITEREINCXD0                                  CCB003
     C                     CLEARREINCXD0                                  CCB003
     C*
     C                     ENDSR                           **PRCHG ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** PRCR  subroutine for CREDIT  OUTPUT
     C**
     C**     Called by       TOTAC
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           PRCR      BEGSR                           **PRCR  BEGSR**
      *                                                                   CCB003
     C**********           Z-ADDBCNUM     RACNUM           Customer number             CCB003 CSD027
     C                     MOVE BCNUM     RACNUM           Customer number                    CSD027
     C                     MOVE BCCY      RACCY            Currency       CCB003
     C                     Z-ADDBACOD     RAACOD           Account Code   CCB003
     C                     Z-ADDBACSQ     RAACSQ           Account SequencCCB003
     C                     MOVE BRCA#     RABRCA           Branch         CCB003
     C                     Z-ADDAACNO     RAACNO           Retail AC No.  CCB003
     C                     MOVE 'C'       RAPOST           Posting Type   CCB003
     C*
     C***********          Z-ADDLPAP      ZDAYNO                          CCB003
     C                     Z-ADDLPAP      RACPDA           Capitalisation CCB003
      *                                                                   CCB003
     C***********          EXSR ZDATE2                                    CCB003
     C***********                                                         CCB003
     C************IN99     IFEQ '1'                        - B3           CCB003
     C************LOCK     IN   LDA                                       CCB003
     C***********          Z-ADDLPAP      WDATE                           CCB003
     C***********          Z-ADD16        DBASE                           CCB003
     C***********          MOVE 'ZDATE2'  DBFILE           ***************CCB003
     C***********          MOVELWDATE     DBKEY            **DB ERROR 16**CCB003
     C***********          OUT  LDA                        ***************CCB003
     C***********          EXSR *PSSR                                     CCB003
     C***********          END                             - E1           CCB003
     C*
     C           SCICT     IFEQ *ZEROS                     - B1
     C           CCST      ANDEQ*ZEROS
      *                                                                   CCB003
     C***********CRIB      IFEQ *ZEROS                     - B2           CCB003
     C***********          Z-ADDACRIS     RATECR                          CCB003
     C***********          ELSE                            - X2           CCB003
     C***********          Z-ADDCCIR      RATECR                          CCB003
     C***********          END                             - E2           CCB003
     C***********          Z-ADDSCRIR     RATECR                          CCB003
     C***********          MOVE '0'       *IN36                           CCB003
      *                                                                   CCB003
     C                     Z-ADDSCRIR     RAINTR           Interest rate  CCB003
      *                                                                   CCB003
     C                     END                             - E1
     C*
     C                     Z-ADDACICT     RAINTP           Interest type  CCB003
     C                     Z-ADDCCST      RAINST           Interest subtypCCB003
     C                     Z-ADDMACI0     RAMADJ           Manual adj.    CCB003
     C                     Z-ADDGACI0     RAGADT           Generated      CCB003
     C                     Z-ADDCRCP0     RAAIAP           Accrued        CCB003
      *                                                                   CCB003
     C           SCCI      IFEQ 'Y'                        - B1
     C           SCCI      OREQ 'I'
     C***********          MOVE '1'       *IN66                           CCB003
     C                     MOVE 'Y'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*
     C           SCCI      IFEQ 'S'                        - B1
     C***********          MOVE '1'       *IN67                           CCB003
     C                     MOVE 'S'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*
     C           SCCI      IFEQ 'L'                        - B1
     C***********          MOVE '1'       *IN68                           CCB003
     C                     MOVE 'I'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*
     C           SCCI      IFEQ 'O'                        - B1
     C***********          MOVE '1'       *IN69                           CCB003
     C                     MOVE 'L'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*
     C           SCCI      IFEQ 'A'                        - B1
     C***********          MOVE '1'       *IN70                           CCB003
     C                     MOVE 'A'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*                                                                   075073
     C* If checks not allowed for against SCCI false on indicator 61      075073
     C*                                                                   075073
     C***********SCCI      IFNE 'Y'                                 075073085787
     C***********SCCI      ORNE 'I'                                 075073085787
     C***********SCCI      ORNE 'S'                                 075073085787
     C***********SCCI      ORNE 'L'                                 075073085787
     C***********SCCI      ORNE 'O'                                 075073085787
     C***********SCCI      ORNE 'A'                                 075073085787
     C************IN61     ANDNE'1'                                       085787
     C************IN71     ANDNE'1'                                       085787
     C************IN66     IFEQ *OFF                                      085787
     C************IN67     ANDEQ*OFF                                      085787
     C************IN68     ANDEQ*OFF                                      085787
     C************IN69     ANDEQ*OFF                                      085787
     C************IN70     ANDEQ*OFF                                      085787
     C***********          MOVE '1'       *IN66                           075073
     C***********          END                                            075073
     C*
     C           RAPTFL    IFEQ *BLANK                                    CCB003
     C                     MOVE 'Y'       RAPTFL           Posted Today   CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C           OKEY      IFNE AKEY                       - B1
     C                     MOVE '0'       *IN43
     C**********           Z-ADDBCNUM     OCNUM                                               CSD027
     C                     MOVE BCNUM     OCNUM                                               CSD027
     C                     MOVE BCCY      OCCY
     C                     Z-ADDBACOD     OACOD
     C                     Z-ADDBACSQ     OACSQ
     C                     MOVE BBRCA     OBRCA
     C                     END                             - E1
     C*
      *                                                                   085787
      * Print details even if accrued interest is zero.                   085787
     C***********CRCP0     IFNE *ZERO                      - B1           085787
     C***********MACI0     ORNE *ZERO                                     085787
     C***********GACI0     ORNE *ZERO                                     085787
     C***********                                                   085787CCB003
     C***Reset*posted today indicator if zero interest.             085787CCB003
     C***********CRCP0     IFEQ *ZERO                      - B1     085787CCB003
     C***********MACI0     ANDEQ*ZERO                               085787CCB003
     C***********GACI0     ANDEQ*ZERO                               085787CCB003
     C***********          MOVEA'00000'   *IN,66                    085787CCB003
     C***********          END                             - E1     085787CCB003
     C***********          EXSR OVERPR                                    CCB003
     C***********                                                         CCB003
     C/COPY WNCPYSRC,RE3664C083
     C***********          WRITEDETCR                                     CCB003
     C************         END                             - E1           085787
     C                     Z-ADD*ZEROS    MACI0
     C                     Z-ADD*ZEROS    GACI0
     C                     Z-ADD*ZEROS    CRCP0
     C***********          Z-ADD*ZEROS    RATECR                          CCB003
     C***********          MOVE '1'       *IN36                           CCB003
     C***********          MOVE '1'       *IN43                           CCB003
     C***********          MOVEA'00000'   *IN,66                          CCB003
      *                                                                   CCB003
      ** Write record to Audit file                                       CCB003
     C                     WRITEREINCXD0                                  CCB003
     C                     CLEARREINCXD0                                  CCB003
     C*
     C                     ENDSR                           **PRCR  ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** PRDR  subroutine for DEBIT   OUTPUT
     C**
     C**     Called by       TOTAC
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           PRDR      BEGSR                           **PRDR  BEGSR**
     C*
     C**********           Z-ADDBCNUM     RACNUM           Customer number             CCB003 CSD027
     C                     MOVE BCNUM     RACNUM           Customer number                    CSD027
     C                     MOVE BCCY      RACCY            Currency       CCB003
     C                     Z-ADDBACOD     RAACOD           Account Code   CCB003
     C                     Z-ADDBACSQ     RAACSQ           Account SequencCCB003
     C                     MOVE BRCA#     RABRCA           Branch         CCB003
     C                     Z-ADDAACNO     RAACNO           Retail AC No.  CCB003
     C                     MOVE 'D'       RAPOST           Posting type   CCB003
     C***********          Z-ADDLPAR      ZDAYNO                          CCB003
     C                     Z-ADDLPAR      RACPDA           Capitalisation CCB003
      *                                                                   CCB003
     C***********          EXSR ZDATE2                                    CCB003
     C***********                                                         CCB003
     C************IN99     IFEQ '1'                        - B3           CCB003
     C************LOCK     IN   LDA                                       CCB003
     C***********          Z-ADDLPAR      WDATE                           CCB003
     C***********          Z-ADD17        DBASE                           CCB003
     C***********          MOVE 'ZDATE2'  DBFILE           ***************CCB003
     C***********          MOVELWDATE     DBKEY            **DB ERROR 17**CCB003
     C***********          OUT  LDA                        ***************CCB003
     C***********          EXSR *PSSR                                     CCB003
     C***********          END                             - E1           CCB003
     C***********                                                         CCB003
      *                                                                   CCB003
     C           SDICT     IFEQ *ZEROS                     - B1
     C           DCST      ANDEQ*ZEROS
      *                                                                   CCB003
     C***********DRIB      IFEQ *ZEROS                     - B2
     C***********          Z-ADDADRIS     RATEDR
     C***********          ELSE                            - X2
     C***********          Z-ADDCDIR      RATEDR
     C***********          END                             - E2
     C***********          Z-ADDSDRIR     RATEDR                          CCB003
     C***********          MOVE '0'       *IN35                           CCB003
      *                                                                   CCB003
     C                     Z-ADDSDRIR     RAINTR           Interest rate  CCB003
      *                                                                   CCB003
     C                     END                             - E1
      *                                                                   CCB003
     C                     Z-ADDADICT     RAINTP           Interest type  CCB003
     C                     Z-ADDDCST      RAINST           Interest subtypCCB003
     C                     Z-ADDMADI0     RAMADJ           Manual adj.    CCB003
     C                     Z-ADDGADI0     RAGADT           Generated      CCB003
     C                     Z-ADDDRCP0     RAAIAP           Accrued        CCB003
     C*
     C           SDCI      IFEQ 'Y'                        - B1
     C           SDCI      OREQ 'I'
     C***********          MOVE '1'       *IN61                           CCB003
     C                     MOVE 'Y'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*
     C           SDCI      IFEQ 'S'                        - B1
     C***********          MOVE '1'       *IN62                           CCB003
     C                     MOVE 'S'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*
     C           SDCI      IFEQ 'L'                        - B1
     C***********          MOVE '1'       *IN63                           CCB003
     C                     MOVE 'I'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*
     C           SDCI      IFEQ 'O'                        - B1
     C***********          MOVE '1'       *IN64                           CCB003
     C                     MOVE 'L'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*
     C           SDCI      IFEQ 'A'                        - B1
     C***********          MOVE '1'       *IN65                           CCB003
     C                     MOVE 'A'       RAPTFL           Posted Today   CCB003
     C                     END                             - E1
     C*                                                                   075073
     C* If checks not allowed for against SDCI false on indicator 61      075073
     C*                                                                   075073
     C***********SDCI      IFNE 'Y'                                 075073085787
     C***********SDCI      ORNE 'I'                                 075073085787
     C***********SDCI      ORNE 'S'                                 075073085787
     C***********SDCI      ORNE 'L'                                 075073085787
     C***********SDCI      ORNE 'O'                                 075073085787
     C***********SDCI      ORNE 'A'                                 075073085787
     C************IN66     ANDNE'1'                                 085787085787
     C************IN71     ANDNE'1'                                 085787085787
     C************IN61     IFEQ *OFF                                085787CCB003
     C************IN62     ANDEQ*OFF                                085787CCB003
     C************IN63     ANDEQ*OFF                                085787CCB003
     C************IN64     ANDEQ*OFF                                085787CCB003
     C************IN65     ANDEQ*OFF                                085787CCB003
     C***********          MOVE '1'       *IN61                     075073CCB003
     C***********          END                                      075073CCB003
     C*
     C           RAPTFL    IFEQ *BLANK                                    CCB003
     C                     MOVE 'Y'       RAPTFL                          CCB003
     C                     ENDIF                                          CCB003
      *                                                                   CCB003
     C           OKEY      IFNE AKEY                       - B1
     C                     MOVE '0'       *IN43
     C**********           Z-ADDBCNUM     OCNUM                                               CSD027
     C                     MOVE BCNUM     OCNUM                                               CSD027
     C                     MOVE BCCY      OCCY
     C                     Z-ADDBACOD     OACOD
     C                     Z-ADDBACSQ     OACSQ
     C                     MOVE BBRCA     OBRCA
     C                     END                             - E1
      *                                                                   085787
      * Print details even if accrued interest is zero.                   085787
     C***********DRCP0     IFNE *ZERO                      - B1           085787
     C***********MADI0     ORNE *ZERO                                     085787
     C***********GADI0     ORNE *ZERO                                     085787
     C***********                                                   085787CCB003
     C***Reset*posted today indicator field if zero capitalisation  085787CCB003
     C***********DRCP0     IFEQ *ZERO                      - B1     085787CCB003
     C***********MADI0     ANDEQ*ZERO                               085787CCB003
     C***********GADI0     ANDEQ*ZERO                               085787CCB003
     C***********          MOVEA'00000'   *IN,61                    085787CCB003
     C***********          END                             - E1     085787CCB003
     C***********                                                         CCB003
     C***********          EXSR OVERPR                                    CCB003
     C***********                                                         CCB003
     C***********          Z-ADD58        DBASE                           CCB003
     C/COPY WNCPYSRC,RE3664C084
     C***********          WRITEDETDR                                     CCB003
     C***********          Z-ADD*ZEROS    DBASE                           CCB003
     C************         END                             - E1           085787
     C                     Z-ADD*ZEROS    MADI0
     C                     Z-ADD*ZEROS    GADI0
     C                     Z-ADD*ZEROS    DRCP0
     C***********          Z-ADD*ZEROS    RATEDR                          CCB003
     C***********          MOVE '1'       *IN35                           CCB003
     C***********          MOVE '1'       *IN43                           CCB003
     C***********          MOVEA'00000'   *IN,61                          CCB003
      *                                                                   CCB003
      ** Write record to Audit file                                       CCB003
     C                     WRITEREINCXD0                                  CCB003
     C                     CLEARREINCXD0                                  CCB003
     C*
     C                     ENDSR                           **PRDR  ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** REBSR subroutine for REHISBL  file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           REBSR     BEGSR                           **REBSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'HISB '   DBFILE           ***************CCB003
     C                     MOVEL'HISB'    DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSREB    DBSTAT           ***************
     C                     MOVEA'11'      *IN,88
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **REBSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C***RECSR*subroutine*for*REHISBC**file*exception/error*handling      CCB003
     C** RECSR subroutine for REINTCPD file exception/error handling      CCB003
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           RECSR     BEGSR                           **RECSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'HISBC'   DBFILE           ***************CCB003
     C                     MOVEL'REINTCPD'DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSREC    DBSTAT           ***************
     C                     MOVEA'11'      *IN,88
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **RECSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** RELSR subroutine for REHISL   file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           RELSR     BEGSR                           **RELSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'HISL '   DBFILE           ***************CCB003
     C                     MOVEL'HISL'    DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSREL    DBSTAT           ***************
     C                     MOVEA'11'      *IN,88
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **RELSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** REPSR subroutine for REHPOSPP file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           REPSR     BEGSR                           **REPSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'POSPL'   DBFILE           ***************CCB003
     C                     MOVEL'POSPL'   DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSREP    DBSTAT           ***************
     C                     MOVEA'11'      *IN,88
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **REPSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** RESSR subroutine for REHISSL  file exception/error handling
     C**
     C**     Called by       Input specifications
     C**     Calls           *PSSR
     C**
      *****************************************************************   CCB003
     C           RESSR     BEGSR                           **RESSR BEGSR**
     C*
     C           *LOCK     IN   LDA
     C***********          MOVE 'HISSL'   DBFILE           ***************CCB003
     C                     MOVEL'HISSL'   DBFILE           ***************CCB003
     C                     MOVE *BLANKS   DBKEY            **STATUS ERR **
     C                     MOVELSTSRES    DBSTAT           ***************
     C                     MOVEA'11'      *IN,88
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ENDSR                           **RESSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** SETPR subroutine to execute setup accnt work fields processing
     C**
     C**     Called by       MAIN
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           SETPR     BEGSR                           **SETPR BEGSR**
     C* If Swiss Taxes installed
     C*
     C           BGNTST    IFEQ 'Y'
     C                     EXSR WPT01
     C                     END
     C*
     C/COPY WNCPYSRC,RE3664CP18                                           S01408
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE BACOD     KACOD   4                                           CGL029
     C                     MOVE BACOD     KACOD                                               CGL029
     C/COPY WNCPYSRC,RE3664C135
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD078       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 59 *CRE002
     C***********          Z-ADD059       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 078*           CRE002 CRE083BK
     C**********           Z-ADD078       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5CIAC    CIAC
     C                     MOVE A5CIAD    CIAD
     C                     MOVE A5DIAC    DIAC
     C                     MOVE A5DIAD    DIAD
     C                     MOVE A5ICIC    CAPC
     C                     MOVE A5ICID    CAPD
     C/COPY WNCPYSRC,RE3664C082
      *                                                                                       CDL013
      ** If CDL013 installed, use appropriate account code                                    CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
     C                     MOVE BACOD     WBACOD 10                                           CDL013
      *                                                                                       CDL013
      ** CHAIN to SDACOAL0 to retrieve WHT Account Codes                                      CDL013
     C           WBACOD    CHAINSDACOAL0             40                                       CDL013
      *                                                                                       CDL013
      ** If CHAIN failed, terminate the program                                               CDL013
     C           *IN40     IFEQ '1'                                                           CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     MOVEL'SDACOAL0'DBFILE           ************                       CDL013
     C                     MOVELWBACOD    DBKEY            * DBERR 142*                       CDL013
     C                     Z-ADD142       DBASE            ************                       CDL013
     C                     OUT  LDA                                                           CDL013
     C                     EXSR *PSSR                                                         CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      ** Retrieve WHT Account Codes                                                           CDL013
     C                     MOVE EACRE     WRETAC 100                                          CDL013
     C                     MOVE EACCO     WCOTAC 100                                          CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE CAPD      KACOD   4                                           CGL029
     C                     MOVE CAPD      KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD079       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 60 *CRE002
     C***********          Z-ADD060       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 079*           CRE002 CRE083BK
     C**********           Z-ADD079       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WCAPDT
     C*
     C           CAPD      IFNE CAPC                       - B1
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE CAPC      KACOD   4                                           CGL029
     C                     MOVE CAPC      KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD080       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 61 *CRE002
     C***********          Z-ADD061       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 080*           CRE002 CRE083BK
     C**********           Z-ADD080       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     END                             - E1
     C*
     C                     MOVE A5ACTY    WCAPCT
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE DIAC      KACOD   4                                           CGL029
     C                     MOVE DIAC      KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD081       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 19 *CRE002
     C***********          Z-ADD019       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 081*           CRE002 CRE083BK
     C**********           Z-ADD081       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WDIACT
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE DIAD      KACOD   4                                           CGL029
     C                     MOVE DIAD      KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD082       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 20 *CRE002
     C***********          Z-ADD020       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 082*           CRE002 CRE083BK
     C**********           Z-ADD082       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WDIADT
     C*
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE CIAD      KACOD   4                                           CGL029
     C                     MOVE CIAD      KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD083       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 18 *CRE002
     C***********          Z-ADD018       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 083*           CRE002 CRE083BK
     C**********           Z-ADD083       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WCIADT
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE CIAC      KACOD   4                                           CGL029
     C                     MOVE CIAC      KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD084       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 21 *CRE002
     C***********          Z-ADD021       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 084*           CRE002 CRE083BK
     C**********           Z-ADD084       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WCIACT
     C/COPY WNCPYSRC,RE3664C228
     C*
     C** ACCESS ACCOUNT CODES
     C*
     C**********           MOVE WOTACC    KACOD   4                                           CGL029
      ** For Base Currency, the Equivalent account Code can be Blank                          228966
      *                                                                                       228966
     C           WOTACC    IFNE *BLANKS                                                       228966
     C                     MOVE WOTACC    KACOD                                               CGL029
     C*
     C           WOTACC    IFNE *BLANKS                                                       246184
      *                                                                                       246184
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD086       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRCGL029
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRCGL029
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 22 *CRE002
     C***********          Z-ADD022       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 086*           CRE002 CRE083BK
     C**********           Z-ADD086       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
      *                                                                                       246184
     C                     ENDIF                                                              246184
     C*
     C                     MOVE A5ACTY    WOTACT
     C                     END                                                                228966
     C*
     C** ACCESS ACCRACJ FILE
     C*
     C***********          Z-ADD62        DBASE                           CRE002
     C                     Z-ADD087       DBASE            * DB ERROR 087*CRE002
     C********** ACKEY     CHAINACCRACJ              99                                       CGL029
     C           ACKEY2    CHAINACCRACJ              99                                       CGL029
     C*
     C** ERROR IN ACCRACJ
     C*
     C           *IN99     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA
     C***********          MOVE 'ACCRA'   DBFILE           **DB ERROR 62**CCB003
     C                     MOVEL'ACCRA'   DBFILE           **DB ERROR 62**CCB003
     C                     MOVELAKEY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             - E1
     C/COPY WNCPYSRC,REH00165
     C*                                                                   092564
     C* Daily capitalisation has resulted in errors in ACCNTAB with       092564
     C* NDID and NCID in the past. This fix ensures the dates catch up.   092564
     C*                                                                   092564
     C           DRIF      IFEQ 'D'                                       092564
     C           NDID      IFLT RUND                                      092564
     C                     Z-ADDRUND      NDID                            092564
     C                     END                                            092564
     C                     END                                            092564
     C           CRIF      IFEQ 'D'                                       092564
     C           NCID      IFLT RUND                                      092564
     C                     Z-ADDRUND      NCID                            092564
     C                     END                                            092564
     C                     END                                            092564
     C*
     C** CALCULATE CNDID AND CNCID
     C*
     C                     Z-ADDNDID      CNDID
     C                     Z-ADDNCID      CNCID
     C           BDICI     IFEQ 'D'
     C           BDICI     OREQ 'C'
     C           BDICI     OREQ 'M'
     C                     Z-ADDRUND      CNDID
     C                     END
     C           BCICI     IFEQ 'D'
     C           BCICI     OREQ 'C'
     C           BCICI     OREQ 'M'
     C                     Z-ADDRUND      CNCID
     C                     END
     C/COPY WNCPYSRC,RE3664C219
     C           LDAC      IFNE 'Y'
     C           BDICI     IFNE 'C'                                       106604
     C                     ADD  1         CNDID
     C                     END                                            106604
     C           BCICI     IFNE 'C'                                       106604
     C                     ADD  1         CNCID
     C                     END                                            106604
     C                     END
     C*
     C* SETUP TRANSACTION TYPE FOR CLOSURE
     C*
     C                     Z-ADD91060     TRAT
     C                     MOVEL'91060'   OTTP
     C           BDICI     IFEQ 'C'
     C           BCICI     OREQ 'C'
     C                     Z-ADD91040     TRAT
     C                     MOVEL'91040'   OTTP
     C                     END
     C*
     C** ACCESS BRANCH CODES
     C*
     C                     Z-ADDCUBRCA    C                                                 CRE083BK
     C           BBRCA     LOKUPABRC,C                   16                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN16     IFEQ '1'                                                         CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C           1         OCUR SDBRCH                                                      MD021155
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BBRCA     @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C***********          MOVEL@BRCA     DBKEY            * DB ERROR 22 *CRE002
     C***********          Z-ADD22        DBASE            ***************CRE002
     C                     MOVEL@BRCA     DBKEY            * DB ERROR 088*CRE002
     C                     Z-ADD088       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C** SAVE BRANCH INTERNAL CUSTOMER OF THE ORIGINAL ACCOUNT
     C*
     C                     MOVE BICN      BBICN
     C/COPY WNCPYSRC,RE3664C114
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C115
     C                     MOVE NBACB     BNBACB
     C                     MOVE A8DFAC    BNDFAC
     C*
     C           MBIN      IFEQ 'Y'
     C*
     C**********           MOVE BNBACB    KACOD   4                                           CGL029
     C                     MOVE BNBACB    KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD089       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 23 *CRE002
     C***********          Z-ADD023       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 089*           CRE002 CRE083BK
     C**********           Z-ADD089       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    BNBACT
     C*
     C**********           MOVE BNDFAC    KACOD   4                                           CGL029
     C                     MOVE BNDFAC    KACOD                                               CGL029
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD090       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 23 *CRE002
     C***********          Z-ADD023       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 090*           CRE002 CRE083BK
     C**********           Z-ADD090       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    BNDFAT
     C*
     C                     END
     C*
     C** SET NARRATIVE FOR MULTILANGUAGE FOLLOWING LGID
     C*
     C                     MOVE XCUNT     LGID
     C*
     C** ACCESS ADJUSTEMENT INTEREST NARRATIVE
     C*
     C                     MOVE 'R1'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,1                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,1    NAR,1
     C                     ELSE
     C                     MOVELNARD      NAR,1
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*                                                                   135401
     C                     MOVE 'RB'      LNARC                           135401
     C*                                                                   135401
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,12                                            MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'                                135401
     C                     PARM *BLANKS   @RTCD                           135401
     C                     PARM '*KEY   ' @OPTN                           135401
     C                     PARM LNARC     @NVCD   2                       135401
     C           SDNARR    PARM SDNARR    DSFDY                           135401
     C           @RTCD     IFNE *BLANK                                    135401
     C**********           MOVELNR16,W    NAR,12                                       135401 235328
     C                     MOVELNR16,12   NAR,12                                              235328
     C                     ELSE                                           135401
     C                     MOVELNARD      NAR,12                          135401
     C                     END                                            135401
     C                     ENDIF                                                            CRE083BK
     C*
     C** ACCESS INTEREST NARRATIVE
     C*
     C                     MOVE 'R2'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,2                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C**********           MOVELNR16,2    NAR,2                           183947
     C                     MOVE *BLANKS   NAR,2                           183947
     C                     MOVEL'INT.CAP.'NAR,2                           183947
     C                     ELSE
     C                     MOVELNARD      NAR,2
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C** ACCESS CHARGES NARRATIVE
     C*
     C                     MOVE 'R3'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,3                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,3    NAR,3
     C                     ELSE
     C                     MOVELNARD      NAR,3
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*                                                                   057048
     C** ACCESS CLOSURE INTEREST NARRATIVE                                057048
     C*                                                                   057048
     C**********           MOVE 'R5'      LNARC                     057048189038
     C                     MOVE 'R2'      LNARC                           189038
     C*                                                                   057048
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     Z-ADD11        #                                                 MD022635
     C                     MOVELNARD      NAR,#                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'                                057048
     C                     PARM *BLANKS   @RTCD                           057048
     C                     PARM '*KEY   ' @OPTN                           057048
     C                     PARM LNARC     @NVCD   2                       057048
     C           SDNARR    PARM SDNARR    DSFDY                           057048
     C                     Z-ADD11        #                               057048
     C           @RTCD     IFNE *BLANK                                    057048
     C                     MOVE '       ' NR16,#                          183947
     C                     MOVELNR16,#    NAR,#                           057048
     C                     MOVE '. -     'NR16,#                          183947
     C                     ELSE                                           057048
     C                     MOVELNARD      NAR,#                           057048
     C                     END                                            057048
     C                     ENDIF                                                            CRE083BK
     C*
     C*
     C** ACCESS TAXES NARRATIVE
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP31                                           S01408
     C*                                                                   S01408
     C           TXWTRR    IFNE 0                          - B0
     C           CDL013    ANDNE'1'                                                           CDL013
      *                                                                                       CDL013
      ** If CDL013 installed, perform Tiered WHT Instructions.                                CDL013
      *                                                                                       CDL013
     C           CDL013    OREQ '1'                                                           CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP32                                           S01408
     C*                                                                   S01408
     C                     MOVE 'T1'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,5                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,5    NAR,5
     C                     ELSE
     C                     MOVELNARD      NAR,5
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C                     END                             - E0
     C*
     C           BGNTST    IFEQ 'Y'                        - B0
     C                     MOVE 'T2'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,6                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,6    NAR,6
     C                     ELSE
     C                     MOVELNARD      NAR,6
     C                     END
     C                     ENDIF                                                            CRE083BK
     C*
     C                     MOVE 'T3'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,7                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,7    NAR,7
     C                     ELSE
     C                     MOVELNARD      NAR,7
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0026'  MGD,7     P                     S01522
     C*
     C                     MOVE 'T4'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,8                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,8    NAR,8
     C                     ELSE
     C                     MOVELNARD      NAR,8
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0027'  MGD,8     P                     S01522
     C*
     C                     MOVE 'T5'      LNARC
     C*
     C                     Z-ADDCUNARA    B                                                 CRE083BK
     C           LNARC     LOKUPANAR,B                   18                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN18     IFEQ '1'                                                         CRE083BK
     C           B         OCUR SDNARR                                                      CRE083BK
     C                     MOVELNARD      NAR,9                                             MD020956
     C                     ELSE                                                             CRE083BK
      *                                                                                     MD021155
     C           1         OCUR SDNARR                                                      MD021155
     C                     CALL 'AONARRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM LNARC     @NVCD   2
     C           SDNARR    PARM SDNARR    DSFDY
     C           @RTCD     IFNE *BLANK
     C                     MOVELNR16,9    NAR,9
     C                     ELSE
     C                     MOVELNARD      NAR,9
     C                     END
     C                     ENDIF                                                            CRE083BK
      *                                                                   S01522
      **  Set up Narrative message: rightmost byte blank                  S01522
     C                     MOVEL'GB0028'  MGD,9     P                     S01522
     C/COPY WNCPYSRC,REH00433
     C*
     C                     END                             - E0
     C                     ENDSR                           **SETPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** SSETUP subroutine to execute setup capitalisation record processing
     C**
     C**     Called by       CREPR,DEBPR
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           SSETUP    BEGSR                           **SSETUP BEGSR**
     C*
     C** CHECK ON DEBIT/CREDIT INDICATOR
     C*
     C           WDRCR     IFEQ '0'                        - B1
     C/COPY WNCPYSRC,RE3664C171
     C*
     C           SDCI      IFEQ 'S'                        - B2
     C           SDCI      OREQ 'L'                        - B2
     C           SDCI      OREQ 'O'                        - B2
     C           DAIC      ADD  DRIS      DRIS
     C                     ADD  PMADI     DRIS
     C                     SUB  SMADI     DRIS
     C                     ELSE                            - X2
     C           DAIC      ADD  DRIP      DRIP
     C                     ADD  PMADI     DRIP
     C                     SUB  SMADI     DRIP
     C                     END                             - E2
     C*
     C           SHISD     IFEQ CNDID                      - B2
     C                     Z-ADDREGLIS    TEGLIS
     C                     END                             - E2
     C*
     C                     Z-ADDSMADI     PMADI
     C                     Z-ADD*ZEROS    SGADI
     C                     Z-ADD*ZEROS    DAIC
     C/COPY WNCPYSRC,RE3664C095
     C                     END                             - E1
     C*
     C           WDRCR     IFEQ '1'                        - B1
     C/COPY WNCPYSRC,RE3664C172
     C*
     C           SCCI      IFEQ 'S'                        - B2
     C           SCCI      OREQ 'L'                        - B2
     C           SCCI      OREQ 'O'                        - B2
     C           CAIC      ADD  CRIS      CRIS
     C                     ADD  PMACI     CRIS
     C                     SUB  SMACI     CRIS
     C                     ELSE                            - X2
     C           CAIC      ADD  CRIP      CRIP
     C                     ADD  PMACI     CRIP
     C                     SUB  SMACI     CRIP
     C                     END                             - E2
     C*
     C                     Z-ADDSMACI     PMACI
     C                     Z-ADD*ZEROS    SGACI
     C                     Z-ADD*ZEROS    CAIC
     C/COPY WNCPYSRC,RE3664C096
     C                     END                             - E1
     C*
     C           WDRCR     IFEQ '2'                        - B1
     C*
     C                     MOVE SCHGI     CSCHGI  1
     C                     MOVE *BLANK    SCHGI
     C*
     C           SHISD     IFEQ CNCID                      - B2
     C                     Z-ADDSCHGAR    PCHGAR
     C                     Z-ADDSCHGAN    PCHGAN
     C                     Z-ADD*ZEROS    SCHGAR
     C                     Z-ADD*ZEROS    SCHGAN
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     ENDSR                           **SSETUP ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** SUSPR subroutine to execute suspense processing
     C**
     C**     Called by       ALTPR, REPR,DEBPR
     C**     Calls           DCIND,GEICPR
     C**
      *****************************************************************   CCB003
     C           SUSPR     BEGSR                           **SUSPR BEGSR**
     C*
     C                     MOVE BBICN     CNUM
     C                     MOVE COMS      ACOD
     C/COPY WNCPYSRC,RE3664C097
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C116
     C                     MOVE BCCY      CCY
     C                     MOVE BBRCA     BRCA
     C                     Z-ADD*ZEROS    ACNO
     C*********            Z-ADDRUND      VALD                            082592
     C           VALD      IFEQ *ZEROS                                    120254
     C                     Z-ADDRUND      VALD                            120254
     C                     END                                            120254
     C                     Z-ADD*ZERO     RIND
     C                     MOVE WCOMST    ATYP
     C                     Z-ADD*ZERO     RIND
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     END
     C*
      *                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP35                                           S01408
      *                                                                   S01408
     C*
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C** CHECKING DEBIT/CREDIT INDICATOR PROCESSING
     C*
     C                     EXSR DCIND
      *                                                                   CAC001
      **  Use Primary Funding Profit Centre for Suspense Accounts         CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE PRFC      WSVPC   4                       CAC001
     C                     MOVE FTPRFP    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C** GEICPD FILE PROCESSING
     C*
     C                     EXSR GEICPR
      *                                                                   CAC001
      **  Restore saved profit centre                                     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WSVPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C           ATYP      IFEQ 'R'
     C           VALD      ANDLENAPDA
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C062
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD091       DBASE            * DB ERROR 091*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END
     C*
     C                     ENDSR                           **SUSPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DACPR subroutine to execute DEBIT ACCRUAL processing
     C**
     C**     Called by       TOTAC
     C**     Calls           DCIND,GEICPR
     C**
      *****************************************************************   CCB003
     C           DACPR     BEGSR                           **DACPR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3664C164
     C           CRE002    IFEQ 'Y'                        B1             CRE002
     C                     Z-ADDDIIE      WPSTA                           CRE002
     C                     ELSE                            X1             CRE002
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           NDID      ANDLTBJRDNB                                                        CRE090
     C           NDID      ANDNE0                                                             CRE090
     C           DAIC1     SUB  DIIE      WPSTA                                               CRE090
     C                     ADD  GADI      WPSTA                                             MD027245
     C                     ELSE                                                               CRE090
     C           RDAIC     SUB  DIIE      WPSTA
     C                     ENDIF                                                              CRE090
     C                     ENDIF                           E1             CRE002
     C*
     C* TEG IS NOW INCLUDED IN RDAIC
     C*
     C           WPSTA     IFNE 0
     C*
     C* POSTING TO INCOME ACCOUNT - CR IF INTEREST IS DEBIT
     C*
     C           CRE002    IFNE 'Y'                        B.2            CRE002
     C                     Z-SUBWPSTA     WPSTA
     C                     ENDIF                           E.2            CRE002
     C*
     C                     MOVELNAR,4     INPNAR
     C                     MOVELNR16,4    INP16
     C                     MOVELDN07,4    INP07
     C                     MOVELMGD,4     ##MGID                          S01522
     C/COPY WNCPYSRC,RE3664C186
     C*
     C***********          Z-ADDBICN      CNUM                            049320
     C                     MOVELBBICN     CNUM                            049320
     C                     MOVELBBRCA     BRCA                            049320
     C                     MOVELBCCY      CCY                             049320
     C                     Z-ADDDIAC      ACOD
     C/COPY WNCPYSRC,RE3664C117
     C           WINT      IFEQ 'Y'                                                           CRE100
     C                     MOVE BCNUM     CNUM                                                CRE100
     C                     ENDIF                                                              CRE100
     C                     Z-ADD1         ACSQ
      * Account Sequence                                                                    MD034990
     C           RETSEQ    IFEQ 'Y'                                                         MD034990
     C                     MOVE BACSQ     ACSQ                                              MD034990
     C                     ENDIF                                                            MD034990
     C/COPY WNCPYSRC,RE3664C118
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADDRUND      VALD
     C                     Z-ADD*ZERO     RIND
     C**********           Z-ADDBCNUM     ASOC                                         105084 CSD027
     C                     MOVE BCNUM     ASOC                                                CSD027
     C                     MOVE WDIACT    ATYP
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C                     MOVELDIAC      OTST                            CMX001
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVE 'DIAC'    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C*
     C** GEICPD FILE PROCESSING
     C*
     C                     EXSR GEICPR
     C*
     C* POSTING TO A.T.RECEIVABLE - DR IF INTEREST IS DEBIT
     C*
     C/COPY WNCPYSRC,RE3664C229
     C                     Z-SUBWPSTA     WPSTA
     C                     Z-ADDDIAD      ACOD
     C                     MOVE WDIADT    ATYP
     C                     MOVELDIAD      OTST                            CMX001
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVE 'DIAD'    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C*
     C** GEICPD FILE PROCESSING
     C*
     C                     EXSR GEICPR
     C                     MOVEL*BLANK    OTST                            CMX001
     C                     END
     C/COPY WNCPYSRC,RE3664C165
     C*
     C                     ENDSR                           **DACPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CACPR subroutine to execute CREDIT ACCRUAL processing
     C**
     C**     Called by       TOTAC
     C**     Calls           GEICPR
     C**
      *****************************************************************   CCB003
     C           CACPR     BEGSR                           **CACPR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3664C166
     C           CRE002    IFEQ 'Y'                        B1             CRE002
     C                     Z-ADDCIIE      WPSTA                           CRE002
     C                     ELSE                            X1             CRE002
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           NCID      ANDLTBJRDNB                                                        CRE090
     C           NCID      ANDNE0                                                             CRE090
     C           CAIC1     SUB  CIIE      WPSTA                                               CRE090
     C                     ADD  GACI      WPSTA                                             MD027245
     C                     ELSE                                                               CRE090
     C           RCAIC     SUB  CIIE      WPSTA
     C                     ENDIF                                                              CRE090
     C                     ENDIF                           E1             CRE002
     C*                                                                   CRE002
     C           WPSTA     IFNE 0
     C*
     C* POSTING TO INCOME ACCOUNT - DR IF INTEREST IS CREDIT
     C*
     C           CRE002    IFEQ 'Y'                        B.2            CRE002
     C                     Z-SUBWPSTA     WPSTA                           CRE002
     C                     ENDIF                           E.2            CRE002
     C*                                                                   CRE002
     C                     MOVELNAR,4     INPNAR
     C                     MOVELNR16,4    INP16
     C                     MOVELDN07,4    INP07
     C                     MOVELMGD,4     ##MGID                          189038
     C/COPY WNCPYSRC,RE3664C149
     C*
     C***********          Z-ADDBICN      CNUM                            049320
     C                     MOVELBBICN     CNUM                            049320
     C                     MOVELBBRCA     BRCA                            049320
     C                     MOVELBCCY      CCY                             049320
     C                     Z-ADDCIAD      ACOD
     C/COPY WNCPYSRC,RE3664C119
     C           WINT      IFEQ 'Y'                                                           CRE100
     C                     MOVE BCNUM     CNUM                                                CRE100
     C                     ENDIF                                                              CRE100
     C                     Z-ADD1         ACSQ
      * Account Sequence                                                                    MD034990
     C           RETSEQ    IFEQ 'Y'                                                         MD034990
     C                     MOVE BACSQ     ACSQ                                              MD034990
     C                     ENDIF                                                            MD034990
     C/COPY WNCPYSRC,RE3664C120
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADDRUND      VALD
     C                     Z-ADD*ZERO     RIND
     C                     MOVE WCIADT    ATYP
     C**********           Z-ADDBCNUM     ASOC                                         105084 CSD027
     C                     MOVE BCNUM     ASOC                                                CSD027
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C                     MOVELCIAD      OTST                            CMX001
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVE 'CIAD'    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C*
     C** GEICPD FILE PROCESSING
     C*
     C                     EXSR GEICPR
     C*
     C* POSTING TO A.T.RECEIVABLE - CR IF INTEREST IS CREDIT
     C*
     C/COPY WNCPYSRC,RE3664C230
     C                     Z-SUBWPSTA     WPSTA
     C                     Z-ADDCIAC      ACOD
     C                     MOVE WCIACT    ATYP
     C                     MOVELCIAC      OTST                            CMX001
     C********** CRE008    IFEQ 'Y'                                                  261620 MD022635
     C                     MOVE 'CIAC'    OTST                            CRE008
     C**********           ENDIF                                                     261620 MD022635
     C*
     C** GEICPD FILE PROCESSING
     C*
     C                     EXSR GEICPR
     C                     MOVEL*BLANK    OTST                            CMX001
     C                     END
     C/COPY WNCPYSRC,RE3664C167
     C*
     C                     ENDSR                           **CACPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** TAXSR subroutine
     C*
     C**     Called by       ACCPR,ALTPR
     C**     Calls           -
     C*
      *****************************************************************   CCB003
     C           TAXSR     BEGSR                           **TAXSR BEGSR**
     C*
     C** IF FROM DEBIT
     C           WDRCR     IFEQ '0'
     C*
     C** IF AMOUNT  IS DEBIT
     C                     ADD  WPSTA     WDIWT
     C                     END
     C*
     C** IF FROM CREDIT
     C           WDRCR     IFEQ '1'
     C*
     C** IF AMOUNT  IS CREDIT
     C                     SUB  WPSTA     WCIWT
     C                     END
     C/COPY WNCPYSRC,RE3664C188
     C*
     C                     ENDSR                           **TAXSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** TOTAC subroutine to execute total account processing
     C**
     C**     Called by       MAIN
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           TOTAC     BEGSR                           **TOTAC BEGSR**
     C*
     C** ACCESS AND UPDATE FILE REACR
     C*
     C***********          Z-ADD69        DBASE                           CRE002
     C                     Z-ADD092       DBASE            * DB ERROR 092*CRE002
     C           ACKEY1    CHAINREACR                40
     C                     Z-ADD*ZEROS    DBASE
     C*
     C           *IN40     IFEQ '1'                        - B1
     C*
     C** REACR RECORD NOT FOUND
     C*
     C           *LOCK     IN   LDA
     C***********          Z-ADD23        DBASE            ***************CRE002
     C                     Z-ADD093       DBASE                           CRE002
     C***********          MOVE 'REACR'   DBFILE           **DB ERROR 23**CCB003
     C                     MOVEL'REACR'   DBFILE           **DB ERROR 23**CCB003
     C                     MOVELAKEY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     END                             - E1
     C*
     C** ACCESS AND UPDATE FILE ACCNT
     C*
     C***********          Z-ADD70        DBASE                           CRE002
     C                     Z-ADD094       DBASE            * DB ERROR 094*CRE002
     C           ACKEY1    CHAINACCNT                40
     C                     Z-ADD*ZEROS    DBASE
     C*
     C           *IN40     IFEQ '1'                        - B1
     C*
     C** ACCNT RECORD NOT FOUND
     C*
     C           *LOCK     IN   LDA
     C***********          Z-ADD24        DBASE            ***************CRE002
     C                     Z-ADD095       DBASE                           CRE002
     C***********          MOVE 'ACCNT'   DBFILE           **DB ERROR 24**CCB003
     C                     MOVEL'ACCNT'   DBFILE           **DB ERROR 24**CCB003
     C                     MOVELAKEY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     END                             - E1
      *                                                                   CAC001
      **  Initially set profit centre to be profit centre of main a/c     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WMPRFC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*
     C/COPY WNCPYSRC,RE3664C063
     C* PREPARE UPDATED FIELD
     C*
     C*
     C* PREPARE UPDATED DEBIT FIELDS
     C*
     C           BDICI     IFNE ' '                        - B1
     C*
     C                     Z-ADDMADI      MADI0
     C                     Z-ADDGADI      GADI0
     C           RDAIC     SUB  MADI      DRCP0
     C                     SUB  GADI      DRCP0
     C*
     C*
     C* PROCESS ACCRUAL THIS MONTH DEBIT
     C*
     C/COPY WNCPYSRC,RE3664C064
     C                     EXSR DACPR
     C/COPY WNCPYSRC,RE3664C065
     C*
     C                     SUB  DRCP0     DAIC1
     C                     Z-ADD*ZERO     GADI
     C                     Z-ADD*ZERO     MADI
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           NDID      ANDLTBJRDNB                                                        CRE090
     C           NDID      ANDNE0                                                             CRE090
     C                     Z-ADDDAIC1     DIIE                                                CRE090
     C                     ELSE                                                               CRE090
     C                     Z-ADD*ZERO     DIIE
     C                     ENDIF                                                              CRE090
     C                     Z-ADDRDAIC     LDIA
     C*
     C* CALCULATE CAPITALISATION DATES
     C*
     C/COPY WNCPYSRC,RE3664C220
     C           BDICI     IFEQ 'C'                        - B2
     C           BDICI     OREQ 'D'
     C                     Z-ADDRUND      LDID
     C           NDID      IFLE LDID                       - B3
     C                     Z-ADDNDID      ZDAYNO
     C                     Z-ADDDRDY      ZMDAY
     C***********          MOVE BCCY      ZCCY                            092564
     C                     MOVE BJLCCY    ZCCY                            092564
     C                     MOVE BJSLCD    ZLOC                                                252356
     C/COPY WNCPYSRC,RE3664C203
     C                     MOVE DRIF      ZFREQ
     C           ZFREQ     IFNE 'Z'                                       069558
      *                                                                   164975
     C           ZFREQ     IFEQ 'W'                                       164975
     C           ZFREQ     OREQ 'F'                                       164975
     C           ZFREQ     OREQ 'S'                                       164975
     C           ZDAYNO    DOWLTDNWD                                      164975
     C                     EXSR ZFRQA                                     164975
     C                     ENDDO                                          164975
      *                                                                   164975
     C                     ELSE                                           164975
     C                     EXSR ZFRQA
     C                     ENDIF                                          164975
      *                                                                   164975
     C/COPY WNCPYSRC,RE3664C085
     C                     END                                            069558
     C           ZFREQ     IFEQ 'Z'
     C                     Z-ADD*ZERO     ZDAYNO
     C                     END
     C                     Z-ADDZDAYNO    NDID
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADDNDID      LDID
     C                     Z-ADDNDID      ZDAYNO
     C                     Z-ADDDRDY      ZMDAY
     C***********          MOVE BCCY      ZCCY                            092564
     C                     MOVE BJLCCY    ZCCY                            092564
     C                     MOVE BJSLCD    ZLOC                                                252356
     C/COPY WNCPYSRC,RE3664C204
     C                     MOVE DRIF      ZFREQ
     C           ZFREQ     IFNE 'Z'                                       069558
      *                                                                   164975
     C           ZFREQ     IFEQ 'W'                                       164975
     C           ZFREQ     OREQ 'F'                                       164975
     C           ZFREQ     OREQ 'S'                                       164975
     C           ZDAYNO    DOWLTDNWD                                      164975
     C                     EXSR ZFRQA                                     164975
     C                     ENDDO                                          164975
      *                                                                   164975
     C                     ELSE                                           164975
     C                     EXSR ZFRQA
     C                     ENDIF                                          164975
      *                                                                   164975
     C/COPY WNCPYSRC,RE3664C086
     C                     END                                            069558
     C           ZFREQ     IFEQ 'Z'
     C                     Z-ADD*ZERO     ZDAYNO
     C                     END
     C                     Z-ADDZDAYNO    NDID
      *                                                                                      BUG9030
      ** If Capitalisation Frequency is 'A', calculate the next accrual                      BUG9030
      ** profit date and make that as the next interest capitalisation                       BUG9030
      ** date.                                                                               BUG9030
      *                                                                                      BUG9030
     C           ZFREQ     IFEQ 'A'                                                          BUG9030
     C                     MOVE BKAPFQ    ZFREQ                                              BUG9030
     C                     MOVE BJLCCY    ZCCY                                               BUG9030
     C                     MOVE BKAPFD    ZMDAY                                              BUG9030
     C                     MOVE BKAPDT    ZDAYNO                                             BUG9030
     C                     EXSR ZFRQA                                                        BUG9030
     C                     Z-ADDZDAYNO    NDID                                               BUG9030
     C                     ENDIF                                                             BUG9030
      *                                                                                      BUG9030
     C                     END                             - E2
     C/COPY WNCPYSRC,RE3664C221
     C                     Z-ADDLDID      LPAR
     C           MADI0     IFNE *ZEROS                     - B2
     C           GADI0     ORNE *ZEROS
     C           DRCP0     ORNE *ZEROS
     C           *IN50     IFEQ '0'                                       156767
     C                     EXSR PRDR
     C                     ENDIF                                          156767
     C                     END                             - E2
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3664C173
     C*
     C           BCICI     IFNE ' '                        - B1
     C*
     C                     Z-SUBMACI      MACI0
     C                     Z-SUBGACI      GACI0
     C           RCAIC     SUB  MACI      CRCP0
     C                     SUB  GACI      CRCP0
     C*
     C* PROCESS ACCRUAL THIS MONTH CREDIT
     C*
     C/COPY WNCPYSRC,RE3664C066
     C                     EXSR CACPR
     C/COPY WNCPYSRC,RE3664C067
     C*
     C                     SUB  CRCP0     CAIC1
     C                     Z-ADD*ZERO     GACI
     C                     Z-ADD*ZERO     MACI
     C           CRE090    IFEQ 'Y'                                                           CRE090
     C           NCID      ANDLTBJRDNB                                                        CRE090
     C           NCID      ANDNE0                                                             CRE090
     C                     Z-ADDCAIC1     CIIE                                                CRE090
     C                     ELSE                                                               CRE090
     C                     Z-ADD*ZERO     CIIE
     C                     ENDIF                                                              CRE090
     C                     Z-ADDRCAIC     LCIA
     C                     Z-SUBCRCP0     CRCP0
     C*
     C* CALCULATE CAPITALISATION DATES
     C*
     C/COPY WNCPYSRC,RE3664C222
     C           BCICI     IFEQ 'C'                        - B2
     C           BCICI     OREQ 'D'
     C                     Z-ADDRUND      LCID
     C           NCID      IFLE LCID                       - B3
     C                     Z-ADDNCID      ZDAYNO
     C                     Z-ADDCRDY      ZMDAY
     C***********          MOVE BCCY      ZCCY                            092564
     C                     MOVE BJLCCY    ZCCY                            092564
     C                     MOVE BJSLCD    ZLOC                                                252356
     C/COPY WNCPYSRC,RE3664C205
     C                     MOVE CRIF      ZFREQ
     C           ZFREQ     IFNE 'Z'                                       069558
      *                                                                   164975
     C           ZFREQ     IFEQ 'W'                                       164975
     C           ZFREQ     OREQ 'F'                                       164975
     C           ZFREQ     OREQ 'S'                                       164975
     C           ZDAYNO    DOWLTDNWD                                      164975
     C                     EXSR ZFRQA                                     164975
     C                     ENDDO                                          164975
      *                                                                   164975
     C                     ELSE                                           164975
     C                     EXSR ZFRQA
     C                     ENDIF                                          164975
      *                                                                   164975
     C/COPY WNCPYSRC,RE3664C087
     C                     END                                            069558
     C           ZFREQ     IFEQ 'Z'
     C                     Z-ADD*ZERO     ZDAYNO
     C                     END
     C                     Z-ADDZDAYNO    NCID
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADDNCID      LCID
     C                     Z-ADDNCID      ZDAYNO
     C                     Z-ADDCRDY      ZMDAY
     C***********          MOVE BCCY      ZCCY                            092564
     C                     MOVE BJLCCY    ZCCY                            092564
     C                     MOVE BJSLCD    ZLOC                                                252356
     C/COPY WNCPYSRC,RE3664C206
     C                     MOVE CRIF      ZFREQ
     C           ZFREQ     IFNE 'Z'                                       069558
      *                                                                   164975
     C           ZFREQ     IFEQ 'W'                                       164975
     C           ZFREQ     OREQ 'F'                                       164975
     C           ZFREQ     OREQ 'S'                                       164975
     C           ZDAYNO    DOWLTDNWD                                      164975
     C                     EXSR ZFRQA                                     164975
     C                     ENDDO                                          164975
      *                                                                   164975
     C                     ELSE                                           164975
     C                     EXSR ZFRQA
     C                     ENDIF                                          164975
      *                                                                   164975
     C/COPY WNCPYSRC,RE3664C088
     C                     END                                            069558
     C           ZFREQ     IFEQ 'Z'
     C                     Z-ADD*ZERO     ZDAYNO
     C                     END
     C                     Z-ADDZDAYNO    NCID
      *                                                                                      BUG9030
      ** If Capitalisation Frequency is 'A', calculate the next accrual                      BUG9030
      ** profit date and make that as the next interest capitalisation                       BUG9030
      ** date.                                                                               BUG9030
      *                                                                                      BUG9030
     C           ZFREQ     IFEQ 'A'                                                          BUG9030
     C                     MOVE BKAPFQ    ZFREQ                                              BUG9030
     C                     MOVE BJLCCY    ZCCY                                               BUG9030
     C                     MOVE BKAPFD    ZMDAY                                              BUG9030
     C                     MOVE BKAPDT    ZDAYNO                                             BUG9030
     C                     EXSR ZFRQA                                                        BUG9030
     C                     Z-ADDZDAYNO    NCID                                               BUG9030
     C                     ENDIF                                                             BUG9030
      *                                                                                      BUG9030
     C                     END                             - E2
     C/COPY WNCPYSRC,RE3664C223
     C                     Z-ADDLCID      LPAP
     C           MACI0     IFNE *ZEROS                     - B2
     C           GACI0     ORNE *ZEROS
     C           CRCP0     ORNE *ZEROS
     C           *IN50     IFEQ '0'                                       156767
     C                     EXSR PRCR
     C                     ENDIF                                          156767
     C                     END                             - E2
     C           CSCHGI    IFNE ' '                        - B2
     C           CHGP      ANDNE0
     C           *IN50     ANDNE'1'                                       156767
     C*
     C                     EXSR PRCHG
     C*
     C                     ADD  CHGP      LCIA
     C*
     C** ACCESS AND UPDATE FILE REIAC IF CHARGES APPLY
     C*
     C***********          Z-ADD71        DBASE                           CRE002
     C                     Z-ADD096       DBASE            * DB ERROR 096*CRE002
     C           ACKEY1    CHAINREIAC                40
     C                     Z-ADD*ZEROS    DBASE
     C*
     C           *IN40     IFEQ '1'                        - B3
     C*
     C** REIAC RECORD NOT FOUND
     C*
     C           *LOCK     IN   LDA
     C***********          Z-ADD25        DBASE            ***************CRE002
     C                     Z-ADD097       DBASE                           CRE002
     C***********          MOVE 'REIAC'   DBFILE           **DB ERROR 25**CCB003
     C                     MOVEL'REIAC'   DBFILE           **DB ERROR 25**CCB003
     C                     MOVELAKEY      DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     END                             - E3
     C*
     C                     Z-ADDTCHO      WTCHO                                               250998
     C                     SUB  PCHGAN    NRCA
     C                     SUB  PCHGAR    RCA
     C***********          Z-ADD72        DBASE                           CRE002
     C                     Z-ADD098       DBASE            * DB ERROR 098*CRE002
     C                     UPDATREIACDF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     Z-ADD*ZERO     CINW
     C/COPY WNCPYSRC,RE3664C068
      *                                                                   101656
     C                     Z-ADD74        DBASE                           101656
     C                     UPDATACCNTABF                                  101656
     C                     Z-ADD*ZEROS    DBASE                           101656
      *                                                                                     AR813717
     C                     Z-ADDBJRDNB    KRDNB                                             AR813717
     C                     MOVE 'G'       KMODI                                             AR813717
     C********** CACP      IFEQ *BLANKS                                           AR851468 AR851468A
     C                     MOVE BCNUM     KCUST                                             AR813717
     C                     MOVE BCNUM     KJOIN                                             AR813717
     C                     MOVE BCCY      KSCCY                                             AR813717
     C                     Z-ADDBACOD     KACDE                                             AR813717
     C                     Z-ADDBACSQ     KACSQ                                             AR813717
     C                     MOVE BBRCA     KBRCA                                             AR813717
     C                     MOVE BCNUM     KJANO                                             AR813717
     C**********           ELSE                                                   AR851468 AR851468A
     C**********           EXSR BRTALT                                            AR851468 AR851468A
     C**********           MOVE @CCNUM    KCUST                                   AR851468 AR851468A
     C**********           MOVE @CCNUM    KJOIN                                   AR851468 AR851468A
     C**********           MOVE @CCCY     KSCCY                                   AR851468 AR851468A
     C**********           Z-ADD@CACOD    KACDE                                   AR851468 AR851468A
     C**********           Z-ADD@CACSQ    KACSQ                                   AR851468 AR851468A
     C**********           MOVE @CBRCA    KBRCA                                   AR851468 AR851468A
     C**********           MOVE @CCNUM    KJANO                                   AR851468 AR851468A
     C**********           ENDIF                                                  AR851468 AR851468A
     C           KJANO     CHAINSDJACCL1             84                                     AR813717
      *                                                                                     AR813717
     C                     MOVE 'N'       WJACC                                             AR813717
     C           *IN84     IFEQ *OFF                                                        AR813717
     C                     MOVE 'Y'       WJACC                                             AR813717
     C                     ENDIF                                                            AR813717
      *                                                                                     AR813717
     C           WJACC     IFEQ 'Y'                                                         AR813717
     C           KCILC     SETLLSDCSINLC                                                    AR813717
     C           KCILC     READESDCSINLC                 84                                 AR813717
     C                     ELSE                                                             AR813717
     C           KCIL7     SETLLSDCSINL7                                                    AR813717
     C           KCIL7     READESDCSINL7                 84                                 AR813717
     C                     ENDIF                                                            AR813717
      *                                                                                     AR813717
     C                     MOVE 'N'       WCSIN   1                                         AR813717
     C           *IN84     IFEQ *OFF                                                        AR813717
     C                     MOVE 'Y'       WCSIN                                             AR813717
     C                     ENDIF                                                            AR813717
      *                                                                                       CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
     C           ATITAX    ANDNE'0'                                                           CDL013
     C           ATITAX    ANDNE'Y'                                                           CDL013
     C                     EXSR TOTTAX                                                        CDL013
     C                     ENDIF                                                              CDL013
     C*
     C/COPY WNCPYSRC,RE3664CP25                                           S01408
     C*                                                                   S01408
     C           ATITAX    IFEQ 'Y'                                       101656
     C/COPY WNCPYSRC,RE3664C192
     C                     EXSR TOTTAX                                    101656
     C/COPY WNCPYSRC,RE3664C193
     C                     END                                            101656
      *                                                                   101656
     C           BGNTST    IFEQ 'Y'                                       101656
     C**********           Z-ADDHISB      @RHISB                                      135809 135809R
     C                     Z-ADDHISB      @RHISB                                            AR978914
     C           CGL031    IFEQ 'N'                                                        AR851468B
     C                     EXSR TDISR                                     101656
     C           WCSIN     IFEQ 'N'                                                         AR813717
     C                     EXSR TCISR                                     101656
     C                     ENDIF                                                            AR813717
     C                     ENDIF                                                           AR851468B
     C**********           Z-ADD@RHISB    HISB                                        135809 135809R
     C                     Z-ADD@RHISB    HISB                                              AR978914
     C                     END                                            101656
      *                                                                   101656
     C***********          Z-ADD73        DBASE                           CRE002
     C                     Z-ADD099       DBASE            * DB ERROR 099*CRE002
     C*
     C                     Z-ADDCTFDAT    RELCD
     C*
     C                     UPDATREACRDF
     C                     Z-ADD*ZEROS    DBASE
     C**********           Z-ADD74        DBASE                           101656
     C**********           UPDATACCNTABF                                  101656
     C**********           Z-ADD*ZEROS    DBASE                           101656
     C***********          MOVE *BLANK    BDICI                           091896
     C***********          MOVE *BLANK    BCICI                           091896
     C***********          Z-ADD75        DBASE                           CRE002
     C                     Z-ADD101       DBASE            * DB ERROR 101*CRE002
     C*
     C/COPY WNCPYSRC,RE3664CCP9                                           S01408
     C*                                                                   S01408
     C***********ATITAX    IFEQ 'Y'                                       101656
     C***********          EXSR TOTTAX                                    101656
     C***********          END                                            101656
     C*
     C***********BGNTST    IFEQ 'Y'                                       101656
     C***********          EXSR TDISR                                     101656
     C***********          EXSR TCISR                                     101656
     C***********          END                                            101656
      *                                                                   130468
      * If required calculate BRT on total CR interest & adjs. for a/c    130468
      * and output the relevant postings.                                 130468
     C           S01383    IFEQ 'Y'                                       130468
     C           @WCAIC    ANDGT*ZERO                                     130468
      *                                                                   130468
      * If a/c currently uses an alternative a/c to post CR interest,     130468
      * BRT is posted to that a/c; check it exists and is live as this    130468
      * may not have been done if int. for current cap. period is zero.   130468
     C           CACP      IFNE *BLANKS                                   130468
     C                     EXSR BRTALT                                    130468
     C                     END                                            130468
      *                                                                   130468
     C           @WCAIC    IFGT *ZERO                                     130468
      *                                                                   130468
      * Set profit centre to that of a/c or alt. a/c and retrieve FX      130468
      * position profit centre.                                           130468
     C           BGN0ST    IFEQ 'Y'                                       130468
     C           CACP      IFEQ *BLANKS                                   130468
     C                     MOVE WMPRFC    PRFC                            130468
     C                     ELSE                                           130468
     C                     MOVE @CPRFC    PRFC                            130468
     C                     END                                            130468
     C                     MOVE PRFC      WSVPC                           130468
     C                     EXSR SRPRFC                                    130468
     C                     MOVE PRFC      WFXPC                           130468
     C                     MOVE WSVPC     PRFC                            130468
     C                     END                                            130468
      *                                                                   130468
     C                     EXSR BRTPRO                                    130468
      *                                                                   130468
     C           BRTCA     IFNE 'X'                                       130468
     C                     EXSR OUTBRT                                    130468
     C                     END                                            130468
      *                                                                   130468
     C           BGN0ST    IFEQ 'Y'                                       130468
     C                     MOVE WMPRFC    PRFC                            130468
     C                     END                                            130468
      *                                                                   130468
     C                     END                                            130468
     C                     END                                            130468
      *                                                                   130468
     C                     Z-ADD*ZERO     WTAOC                                               234870
     C                     Z-ADD*ZERO     WTATC                                               234870
     C                     Z-ADD*ZERO     WTABC                                               234870
     C                     MOVE 'N'       WEUTT                                               234870
      *                                                                                       234870
     C                     Z-ADD*ZEROS    WKSTXO                                              CER048
     C                     Z-ADD*ZEROS    WKSTXT                                              CER048
     C                     Z-ADD*ZEROS    WKSTXB                                              CER048
     C                     Z-ADD*ZEROS    WKTTXO                                              CER054
     C                     Z-ADD*ZEROS    WKTTXT                                              CER054
     C                     Z-ADD*ZEROS    WKTTXB                                              CER054
      *                                                                                       CER048
      ** If required calculate EU withholding tax on total CR interest                        CGL031
      ** & adjs. for a/c and output the relevant postings.                                    CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C********** @WCAIC    ANDGT*ZERO                                                  CGL031 233720
     C********** RCAIC     ANDGT*ZERO                                                  233720 235875
     C           RCAIC     ANDNE*ZERO                                                         235875
      *                                                                                       CGL031
      ** If a/c currently uses an alternative a/c to post CR interest,                        CGL031
      ** tax is posted to that a/c; check if it exists and is live as this                    CGL031
      ** may not have been done if int. for current cap. period is zero.                      CGL031
      *                                                                                       CGL031
     C           CACP      IFNE *BLANKS                                                       CGL031
     C                     EXSR BRTALT                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C********** @WCAIC    IFGT *ZERO                                                  CGL031 233720
     C********** RCAIC     IFGT *ZERO                                                  233720 235875
     C           RCAIC     IFNE *ZERO                                                         235875
      *                                                                                       CGL031
      ** Set profit centre to that of a/c or alt. a/c and retrieve FX                         CGL031
      ** position profit centre.                                                              CGL031
      *                                                                                       CGL031
     C           BGN0ST    IFEQ 'Y'                                                           CGL031
     C           CACP      IFEQ *BLANKS                                                       CGL031
     C                     MOVE WMPRFC    PRFC                                                CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE @CPRFC    PRFC                                                CGL031
     C                     ENDIF                                                              CGL031
     C                     MOVE PRFC      WSVPC                                               CGL031
     C                     EXSR SRPRFC                                                        CGL031
     C                     MOVE PRFC      WFXPC                                               CGL031
     C                     MOVE WSVPC     PRFC                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Retrieve tax amount & generate postings.                                             CGL031
      *                                                                                       CGL031
     C           WSV01     IFEQ 'N'                                                         AR831847
     C                     EXSR SRRTAX                                                        CGL031
     C                     EXSR SRGPOS                                                        CGL031
     C                     ENDIF                                                            AR831847
      *                                                                                       CGL031
     C           BGN0ST    IFEQ 'Y'                                                           CGL031
     C                     MOVE WMPRFC    PRFC                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANK    BDICI                           091896
     C                     MOVE *BLANK    BCICI                           091896
     C*                                                                   S01408
     C** Rename duplicate hook name RE3664CCP4 to RE3664CP17              S01408
     C*COPY*WNCPYSRC,RE3664CCP4***                                        S01408
     C/COPY WNCPYSRC,RE3664CP17                                           S01408
     C*                                                                   S01408
      ***Access*information*from*REHISBC*****************************                CCB003 CRE083BE
     C********** KKEY01    CHAINREHISBC              38                              CCB003 CRE083BE
      *                                                                   CCB003
     C********** *IN38     IFEQ '1'                                                  CCB003 CRE083BE
     C********** *LOCK     IN   LDA                                                  CCB003 CRE083BE
     C**********           MOVEL'REHISBC' DBFILE           ************              CCB003 CRE083BE
     C**********           MOVELRKEY      DBKEY            * DBERR 41 *              122952 CRE083BE
     C***********          MOVEL'*NRF'    DBKEY            *********CCB003122952
     C**********           Z-ADD41        DBASE            ************              CCB003 CRE083BE
     C**********           MOVEL'RE3664'  DBPGM                                      122952 CRE083BE
     C**********           OUT  LDA                                                  CCB003 CRE083BE
     C**********           EXSR *PSSR                                                CCB003 CRE083BE
     C**********           ENDIF                                                     CCB003 CRE083BE
      ***************************************************************                CCB003 CRE083BE
      ***Copy*data*from*REINTCPD*to*REHISBC**************************                CCB003 CRE083BE
     C**********           EXSR SRMOV                                                CCB003 CRE083BE
      *                                                                   CCB003
     C**********           UPDATREHISBP1                                             CCB003 CRE083BE
     C*
     C***********          UPDATREHISPPF                                  CCB003
     C                     UPDATREHISPPF                                                    CRE083BE
     C                     Z-ADD*ZEROS    DBASE
     C*
     C* INCREMENT TRAILER AFTER BEFORE EACH COMMITMENT
     C*
     C                     EXSR TOTAL
     C*
     C***********          COMIT                                          CCB003
     C*
     C                     ENDSR                           **TOTAC ENDSR**
      *****************************************************************   CCB003
     C/EJECT                                                              CCB003
      *****************************************************************   CCB003
      *                                                               *   CCB003
      * SRMOV - Copy data from REINTCPD to REHISBC                    *   CCB003
      *                                                               *   CCB003
      *****************************************************************   CCB003
     C           SRMOV     BEGSR                                          CCB003
      *                                                                   CCB003
     C**********           MOVE BRECI     NRECI                                      CCB003 CRE083BE
     C                     MOVE BBRCA     NBRCA                           CCB003
     C**********           Z-ADDBCNUM     NCNUM                                        CCB003 CSD027
     C                     MOVE BCNUM     NCNUM                                               CSD027
     C                     MOVE BCCY      NCCY                            CCB003
     C                     Z-ADDBACOD     NACOD                           CCB003
     C                     Z-ADDBACSQ     NACSQ                           CCB003
     C**********           Z-ADDBHISD     NHISD                                      CCB003 CRE083BE
     C**********           Z-ADDBHISB     NHISB                                      CCB003 CRE083BE
     C**********           Z-ADDBMNBL     NMNBL                                      CCB003 CRE083BE
     C**********           Z-ADDBCHGAR    NCHGAR                                     CCB003 CRE083BE
     C**********           Z-ADDBTHGAR    NTHGAR                                     CCB003 CRE083BE
     C**********           Z-ADDBCHGAN    NCHGAN                                     CCB003 CRE083BE
     C**********           Z-ADDBTHGAN    NTHGAN                                     CCB003 CRE083BE
     C**********           Z-ADDBDMVT     NDMVT                                      CCB003 CRE083BE
     C**********           Z-ADDBDICT     NDICT                                      CCB003 CRE083BE
     C**********           Z-ADDBDRCB     NDRCB                                      CCB003 CRE083BE
     C**********           Z-ADDBDRIR     NDRIR                                      CCB003 CRE083BE
     C**********           Z-ADDBDRCD     NDRCD                                      CCB003 CRE083BE
     C**********           Z-ADDBDAID     NDAID                                      CCB003 CRE083BE
     C**********           Z-ADDBMADI     NMADI                                      CCB003 CRE083BE
     C**********           Z-ADDBTMADI    NTMADI                                     CCB003 CRE083BE
     C**********           Z-ADDBPDID     NPDID                                      CCB003 CRE083BE
     C**********           Z-ADDBDMINT    NDMINT                                     CCB003 CRE083BE
     C**********           Z-ADDBCMVT     NCMVT                                      CCB003 CRE083BE
     C**********           Z-ADDBCICT     NCICT                                      CCB003 CRE083BE
     C**********           Z-ADDBCRCB     NCRCB                                      CCB003 CRE083BE
     C**********           Z-ADDBCRIR     NCRIR                                      CCB003 CRE083BE
     C**********           Z-ADDBCRCD     NCRCD                                      CCB003 CRE083BE
     C**********           Z-ADDBCAID     NCAID                                      CCB003 CRE083BE
     C**********           Z-ADDBMACI     NMACI                                      CCB003 CRE083BE
     C**********           Z-ADDBTMACI    NTMACI                                     CCB003 CRE083BE
     C**********           Z-ADDBPCID     NPCID                                      CCB003 CRE083BE
     C**********           Z-ADDBCMINT    NCMINT                                     CCB003 CRE083BE
     C**********           MOVE BDICI     NDICI                                      CCB003 CRE083BE
     C**********           MOVE BCICI     NCICI                                      CCB003 CRE083BE
     C**********           MOVE BDRCI     NDRCI                                      CCB003 CRE083BE
     C**********           MOVE BCRCI     NCRCI                                      CCB003 CRE083BE
     C**********           Z-ADDBVDTC     NVDTC                                      CCB003 CRE083BE
     C**********           MOVE BADTY     NADTY                                      CCB003 CRE083BE
     C**********           MOVE BALTI     NALTI                                      CCB003 CRE083BE
     C**********           Z-ADDBMNBCP    NMNBCP                                     CCB003 CRE083BE
     C                     MOVE BLGID     NLGID                           CCB003
     C**********           Z-ADDBVALL     NVALL                                      CCB003 CRE083BE
     C**********           MOVE BLINK     NLINK                                      CCB003 CRE083BE
      *                                                                   CCB003
     C                     ENDSR                                          CCB003
     C********************************************************************
     C/EJECT                                                              130468
     C********************************************************************130468
     C**                                                                  130468
     C**   BRTALT SR: if BRT to be posted to alt. a/c, check a/c valid.   130468
     C**                                                                  130468
     C********************************************************************130468
      *                                                                   130468
     C           BRTALT    BEGSR                           ** BRTALT SR **130468
      *                                                                   130468
     C                     MOVELCACP      WALT                            130468
      *                                                                   130468
      * Alt. a/c is a RE a/c no.                                          130468
     C           WALT5     IFEQ *BLANKS                                   130468
     C           WALT10    CHAINACNUM                99                   130468
     C           *IN99     IFEQ '1'                                       130468
     C           RRRECI    OREQ 'C'                                       130468
     C                     Z-ADD*ZERO     @WCAIC                          130468
     C                     ELSE                                           130468
     C                     MOVE RBRCA     @CBRCA                          130468
     C**********           Z-ADDRCNUM     @CCNUM                                       130468 CSD027
     C                     MOVE RCNUM     @CCNUM                                              CSD027
     C                     MOVE RCCY      @CCCY                           130468
     C                     Z-ADDRACOD     @CACOD                          130468
     C                     Z-ADDRACSQ     @CACSQ                          130468
     C                     Z-ADDRACNO     @CACNO                          130468
      *                                                                   130468
      * Get profit centre of alt. a/c                                     130468
     C           BGN0ST    IFEQ 'Y'                                       130468
     C           WALT10    CHAINREACNMF              99                   130468
     C           *IN99     IFEQ '1'                                       130468
     C           *LOCK     IN   LDA                                       130468
     C                     MOVEL'REACNML0'DBFILE                          130468
     C                     MOVELWALT10    DBKEY                           130468
     C                     Z-ADD138       DBASE                           130468
     C                     OUT  LDA                                       130468
     C                     EXSR *PSSR                                     130468
     C                     ELSE                                           130468
     C                     MOVE TPRFC     @CPRFC                          130468
     C                     END                                            130468
     C                     END                                            130468
     C                     END                                            130468
      *                                                                   130468
     C                     ELSE                                           130468
      *                                                                   130468
      * Alt. a/c is a GL a/c no.                                          130468
     C                     MOVE CRBR      WBRCA                           130468
     C           WALTK     CHAINACCNT               N99                   130468
     C           *IN99     IFEQ '1'                                       130468
     C           AARECI    OREQ 'C'                                       130468
     C                     Z-ADD*ZERO     @WCAIC                          130468
     C                     ELSE                                           130468
     C                     MOVE ABRCA     @CBRCA                          130468
     C**********           Z-ADDAACNUM    @CCNUM                                       130468 CSD027
     C                     MOVE AACNUM    @CCNUM                                              CSD027
     C                     MOVE AACCY     @CCCY                           130468
     C                     Z-ADDAAACOD    @CACOD                          130468
     C                     Z-ADDAAACSQ    @CACSQ                          130468
     C                     Z-ADDAAACNO    @CACNO                          130468
      *                                                                   130468
      * Set profit centre if alt. a/c is retail/nostro                    130468
     C           BGN0ST    IFEQ 'Y'                                       130468
     C           AAATYP    IFEQ 'R'                                       130468
     C           AAATYP    OREQ 'N'                                       130468
     C                     MOVE AAPRFC    @CPRFC                          130468
     C                     ELSE                                           130468
     C                     MOVE WMPRFC    @CPRFC                          130468
     C                     END                                            130468
     C                     END                                            130468
     C                     END                                            130468
      *                                                                   130468
     C                     END                                            130468
      *                                                                   130468
     C                     ENDSR                                          130468
     C********************************************************************130468
     C/EJECT
     C********************************************************************
     C**
     C**   BRTPRO SR. TO PERFORM EXTRA PROCESSING FOR BRT
     C**   - CHECKS BRT LIABLE INDICATOR:  CALLS CALBRT & OUTBRT IF ON
     C**
     C********************************************************************
     C**
     C           BRTPRO    BEGSR                           ** BRTPRO SR **
     C**
     C**  INITIALISE OUTPUT AMOUNT FIELDS FOR BRT
     C**
     C                     Z-ADD0         BRTAMT
     C                     Z-ADD0         NETBRT
     C                     Z-ADD0         PACR1                           092064
     C                     Z-ADD0         BRTAM2                          130468
      *                                                                   130468
      * Use transaction type 91070 for BRT postings                       130468
     C                     MOVE TRAT      WTRAT                           130468
     C                     Z-ADD91070     TRAT                            130468
     C                     MOVEL'91070'   OTTP                            130468
      *                                                                   130468
      * Set up BRT narrative                                              130468
     C                     Z-ADD10        #                               130468
     C                     MOVELNAR,#     INPNAR                          130468
     C                     MOVELNR16,#    INP16                           130468
     C                     MOVELDN07,#    INP07                           130468
     C                     MOVELMGD,#     ##MGID                          130468
     C*
     C* ACCESS BRT CATEGORY & NEW ACCOUNT SIGNAL FROM ACCNTX
     C* (FIELDS BRTCA AND NACSG, ALL OTHERS PREFIXED # TO BE IGNORED)
     C*
     C           ACKEY1    CHAINACCNTX               99
     C*
     C      99             SETON                     U7LR  ** DB ERROR 99
     C      99             MOVEL'ACCNTX'  DBFILE
     C      99             MOVELAKEY      DBKEY
     C******99***          Z-ADD99        DBASE                           CRE002
     C      99             Z-ADD102       DBASE            * DB ERROR 102*CRE002
     C      99             GOTO ENDBRT
     C*
     C* CHECK IF BRT LIABLE OR PART LIABLE
     C*
     C           BRTCA     IFEQ 'L'
     C           BRTCA     OREQ 'P'
     C                     SETON                     26
     C                     END
     C*
     C           *IN26     IFEQ '1'
     C*
     C*  IF SO, CALCULATE BRT AMOUNT
      *  and output BRT postings                                          130468
     C*
     C                     EXSR CALBRT
     C*
     C*  ADD 1 TO RECORD COUNT FOR BRT POSTING
     C*
     C                     ADD  1         NBRREC
     C*
     C*  ELSE INTEREST NET OF BRT IS FULL POSTING AMOUNT.
     C*
     C                     ELSE
     C**********           Z-SUBWPSTA     NETBRT                          130468
     C                     Z-ADD@WCAIC    NETBRT                          130468
     C*                                                                   092064
     C* SET UP FIELD PACR1                                                092064
     C**********           Z-SUBWPSTA     PACR1                    092064 130468
     C                     Z-ADD@WCAIC    PACR1                           130468
     C*
     C                     END
     C*
     C* CHECK NEW A/C SIGNAL FROM ACCNT & UPDATE IF THIS IS A NEW ACCOUNT
     C*
     C           BRTCA     IFNE 'X'                        B1
     C           NACSG     ANDEQ' '
     C                     MOVEL'Y'       NACSG            (FOR INTPSDD)
     C                     UPDATACCNTXF
     C*
     C                     ELSE                            X1
     C                     EXCPTRACNTX
     C*
     C                     END                             E1
     C* ENSURE FILES UPDATED WITH CORRECT A/C DETAILS                     080978
     C*                                                                   080978
     C                     MOVE BBRCA     BRCA                            080978
     C**********           Z-ADDBCNUM     CNUM                                         080978 CSD027
     C                     MOVE BCNUM     CNUM                                                CSD027
     C                     MOVE BCCY      CCY                             080978
     C                     Z-ADDBACOD     ACOD                            080978
     C                     Z-ADDBACSQ     ACSQ                            080978
      *                                                                   130468
      * Reset transaction type                                            130468
     C                     Z-ADDWTRAT     TRAT                            130468
     C                     MOVELWTRAT     OTTP                            130468
     C*
     C           ENDBRT    ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   CALBRT SR. TO CALCULATE BRT CURRENCY AMOUNT
     C**              AND OUTPUT BRT POSTINGS TO RETAIL A/C & BRT A/C     130468
     C**
     C**
     C**   IF BRT CATEGORY = 'L'
     C**
     C**          BRT =  GROSS X BRT RATE
     C**                 ----------------
     C**                      100
     C**
     C**   IF BRT CATEGORY = 'P'
     C**
     C**          BRT =  GROSS X (BRT RATE X 0.5)
     C**                 ------------------------
     C**                      100
     C**
     C**   CALLS 'FRNBRT' IF NOT IN STERLING OR BASE CURRENCY NOT STG
     C**
     C** **************************************************************
     C*
     C           CALBRT    BEGSR                           ** CALBRT SR **
     C/COPY WNCPYSRC,RE3664C213
     C*
     C* IF DATE IS BEFORE 'DEFF' ON SDBRTDPD - USE PREV BRT RATE
     C* OTHERWISE - USE CURRENT BRT RATE.
     C*
     C           BCICI     IFEQ 'D'
     C           BCICI     OREQ 'M'
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '0'       *IN30
     C                     END
     C*
     C           LDAC      IFEQ 'Y'
     C*
     C           *IN30     IFEQ '1'
     C           RUND      IFLE DEFF
     C                     Z-ADDPBRTR     WRKRAT 135
     C                     ELSE
     C                     Z-ADDBRTR      WRKRAT
     C                     END
     C                     END
     C*
     C           BCICI     IFEQ 'C'
     C           RUND      IFLT DEFF
     C                     Z-ADDPBRTR     WRKRAT
     C                     ELSE
     C                     Z-ADDBRTR      WRKRAT
     C                     END
     C                     END
     C*
     C           *IN30     IFEQ '0'
     C           BCICI     ANDNE'C'
     C           NCID      IFLE DEFF
     C                     Z-ADDPBRTR     WRKRAT
     C                     ELSE
     C                     Z-ADDBRTR      WRKRAT
     C                     END
     C                     END
     C*
     C                     ELSE
     C*
     C           *IN30     IFEQ '1'
     C           BCICI     OREQ 'C'
     C           RUND      IFLT DEFF
     C                     Z-ADDPBRTR     WRKRAT
     C                     ELSE
     C                     Z-ADDBRTR      WRKRAT
     C                     END
     C                     END
     C*
     C           *IN30     IFEQ '0'
     C           BCICI     ANDNE'C'
     C           NCID      IFLT DEFF
     C                     Z-ADDPBRTR     WRKRAT
     C                     ELSE
     C                     Z-ADDBRTR      WRKRAT
     C                     END
     C                     END
     C*
     C                     END
     C*
     C           BRTCA     IFEQ 'P'
     C           WRKRAT    MULT 0.5       WRKRAT
     C                     END
     C*
     C*  ('PACR1' IS THE GROSS CREDIT AMOUNT TO BE POSTED)
     C*
     C********** WPSTA     IFLT 0                                         130468
     C**********           Z-SUBWPSTA     PACR1                           130468
     C**********           END                                            130468
     C                     Z-ADD@WCAIC    PACR1                           130468
     C*
     C           PACR1     DIV  100       WPACR1 112H
     C*
     C           WPACR1    MULT WRKRAT    WRKBRT 156H
     C*
     C*  ('BRTAMT' IS THE BRT CURRENCY AMOUNT)
     C*
     C                     Z-ADDWRKBRT    BRTAMT 130H
     C*
     C*  ('NETBRT' IS THE NET AMOUNT TO BE POSTED TO CUSTOMER A/C.)
     C*
     C           PACR1     SUB  BRTAMT    NETBRT 130
      *                                                                   130468
     C           BRTAMT    IFGT *ZERO                                     130468
     C                     Z-ADDBRTAMT    BRTAM2                          130468
      *                                                                   130468
      * If alternative a/c in different ccy convert BRT amount.           130468
     C           CACP      IFNE *BLANKS                                   130468
     C           @CCCY     IFNE BCCY                                      130468
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           @CCCY     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                130468
     C                     PARM '*MSG   ' @RTCD                           130468
     C                     PARM '*KEY   ' @OPTN                           130468
     C                     PARM @CCCY     @CYCD                           130468
     C           SDCURR    PARM SDCURR    DSSDY                           130468
     C           @RTCD     IFNE *BLANK                                    130468
     C           *LOCK     IN   LDA                                       130468
     C                     MOVEL'SDCURRPD'DBFILE           ***************130468
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 35 *130468
     C                     Z-ADD140       DBASE            ***************130468
     C                     OUT  LDA                                       130468
     C                     SETON                     U7U8LR               130468
     C                     EXSR *PSSR                                     130468
     C                     END                                            130468
     C                     ENDIF                                                            CRE083BK
      *                                                                   130468
     C                     Z-ADDBRTAMT    XAMNT1                          130468
     C                     Z-ADD*ZERO     XAMNT3                          130468
     C                     MOVE SPOTW     XSPOT1                          130468
     C                     MOVE MDINW     XMDIN1                          130468
     C                     Z-ADDCDPW      XCDP1                           130468
     C                     Z-ADD0         XAMNT2                          130468
     C                     Z-ADD0         XAMNT4                          130468
     C                     Z-ADDSPOT      XSPOT2                          130468
     C                     MOVE MDIN      XMDIN2                          130468
     C                     Z-ADDCDP       XCDP2                           130468
     C                     EXSR CNVERT                                    130468
     C                     Z-ADDXAMNT2    BRTAM2                          130468
     C                     END                                            130468
      *                                                                   130468
      * If alternative a/c in different branch, get branch details.       130468
     C                     MOVE BBICN     @CBICN                          130468
     C           @CBRCA    IFNE BBRCA                                     130468
     C                     Z-ADDCUBRCA    C                                                 CRE083BK
     C           @CBRCA    LOKUPABRC,C                   16                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN16     IFEQ '1'                                                         CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C**********           CALL 'AOBRCHR0'                                130468              CGL029
     C           1         OCUR SDBRCH                                                      MD021155
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           130468
     C                     PARM '*KEY   ' @OPTN                           130468
     C                     PARM @CBRCA    @BRCA   3                       130468
     C********** SDBRCH    PARM SDBRCH    DSFDY                           130468              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    130468
     C           *LOCK     IN   LDA                                       130468
     C                     MOVEL'SDBRCHPD'DBFILE           ***************130468
     C                     MOVEL@BRCA     DBKEY            * DB ERROR 36 *130468
     C                     Z-ADD136       DBASE            ***************130468
     C                     OUT  LDA                                       130468
     C                     SETON                     U7U8LR               130468
     C                     EXSR *PSSR                                     130468
     C                     END                                            130468
     C                     ENDIF                                                            CRE083BK
     C                     MOVE BICN      @CBICN                          130468
     C                     END                                            130468
     C                     END                                            130468
      *                                                                   130468
      * Output BRT as a DR to the retail a/c                              130468
     C           BRTAM2    IFGT *ZERO                                     130468
     C           CACP      IFEQ *BLANKS                                   130468
     C                     MOVE BBRCA     BRCA                            130468
     C**********           Z-ADDBCNUM     CNUM                                         130468 CSD027
     C                     MOVE BCNUM     CNUM                                                CSD027
     C                     MOVE BCCY      CCY                             130468
     C                     Z-ADDBACOD     ACOD                            130468
     C                     Z-ADDBACSQ     ACSQ                            130468
     C                     MOVE WACNO     ACNO                            130468
     C                     ELSE                                           130468
     C                     MOVE @CBRCA    BRCA                            130468
     C**********           Z-ADD@CCNUM    CNUM                                         130468 CSD027
     C                     MOVE @CCNUM    CNUM                                                CSD027
     C                     MOVE @CCCY     CCY                             130468
     C                     Z-ADD@CACOD    ACOD                            130468
     C                     Z-ADD@CACSQ    ACSQ                            130468
     C                     MOVE @CACNO    ACNO                            130468
     C                     END                                            130468
     C                     Z-ADDRUND      PSTD                            130468
     C                     Z-ADDCNCID     VALD                            130468
     C                     Z-ADDCNCID     HISD                            130468
     C                     Z-ADDBRTAM2    WPSTA                           130468
     C                     Z-ADD*ZERO     RRNM                            130468
     C                     EXSR SUBNAR                                    130468
     C                     MOVE NARS      PNAR                            130468
     C/COPY WNCPYSRC,REH00169
     C                     EXSR GEICPR                                    130468
      *                                                                   130468
      * Update history if required                                        130468
     C           ATYP      IFEQ 'R'                                       130468
     C           VALD      ANDLENAPDA                                     130468
     C           *IN50     ANDEQ'0'                                       130468
     C                     Z-ADD137       DBASE                           130468
     C                     MOVE 'N'       REACT                           130468
     C                     WRITEREHPOSPF                                  130468
      *                                                                   130468
     C           CACP      IFEQ *BLANKS                                   130468
      *                                                                   130468
     C           R3KEY     CHAINREHISPDF             40                   130468
     C           *IN40     IFEQ '1'                                       130468
     C                     MOVE 'D'       RECI                            130468
     C                     MOVE *BLANK    DLGID                           130468
     C                     Z-ADD*ZERO     VALL                            130468
     C                     MOVE *BLANK    LINK                            130468
     C                     MOVE *BLANK    DICI                            130468
     C                     MOVE *BLANK    CICI                            130468
     C                     MOVE *BLANK    DRCI                            130468
     C                     MOVE *BLANK    CRCI                            130468
     C                     MOVE *BLANK    ALTI                            130468
     C                     Z-ADD*ZERO     DRIR                            130468
     C                     Z-ADD*ZERO     CRIR                            130468
     C                     Z-ADD*ZERO     PDID                            130468
     C                     Z-ADD*ZERO     PCID                            130468
     C                     Z-ADD*ZERO     DICT                            130468
     C                     Z-ADD*ZERO     CICT                            130468
     C                     Z-ADD*ZERO     DRCB                            130468
     C                     Z-ADD*ZERO     CRCB                            130468
     C                     MOVE *BLANK    ADTY                            130468
     C                     Z-ADD*ZERO     MNBL                            130468
     C                     Z-ADD*ZERO     CHGAR                           130468
     C                     Z-ADD*ZERO     TCHGAR                          130468
     C                     Z-ADD*ZERO     CHGAN                           130468
     C                     Z-ADD*ZERO     TCHGAN                          130468
     C                     Z-ADD*ZERO     DMVT                            130468
     C                     Z-ADD*ZERO     CMVT                            130468
     C                     Z-ADD*ZERO     DAID                            130468
     C                     Z-ADD*ZERO     MADI                            130468
     C                     Z-ADD*ZERO     TMADI                           130468
     C                     Z-ADD*ZERO     DMINT                           130468
     C                     Z-ADD*ZERO     CAID                            130468
     C                     Z-ADD*ZERO     MACI                            130468
     C                     Z-ADD*ZERO     TMACI                           130468
     C                     Z-ADD*ZERO     CMINT                           130468
     C                     Z-ADD*ZERO     MNBCP                           130468
     C                     Z-ADD*ZERO     DRCD                            130468
     C                     Z-ADD*ZERO     CRCD                            130468
     C                     Z-ADD*ZERO     VDTC                            130468
     C           DRCR      IFEQ 1                                         130468
     C                     Z-ADDPSTA      CMVT                            130468
     C                     ELSE                                           130468
     C                     Z-ADDPSTA      DMVT                            130468
     C                     END                                            130468
     C                     Z-ADDDMVT      HISB                            130468
     C                     SUB  CMVT      HISB                            130468
     C                     Z-ADD139       DBASE                           130468
     C                     WRITEREHISPDF                                  130468
     C                     Z-ADD*ZEROS    DBASE                           130468
     C                     ELSE                                           130468
      *                                                                   130468
     C           DRCR      IFEQ 1                                         130468
     C                     ADD  PSTA      CMVT                            130468
     C                     ELSE                                           130468
     C                     ADD  PSTA      DMVT                            130468
     C                     END                                            130468
     C                     Z-ADD139       DBASE                           130468
     C                     UPDATREHISPDF                                  130468
     C                     MOVE 'Y'       FCOMIT                                            MD022410
     C                     Z-ADD*ZEROS    DBASE                           130468
     C                     END                                            130468
      *                                                                   130468
     C                     ELSE                                           130468
     C                     EXSR POSPR                                     130468
     C                     END                                            130468
     C                     END                                            130468
      *                                                                   130468
      * Output BRT as a CR to the internal BRT a/c in the RE a/c ccy.     130468
     C           CACP      IFEQ *BLANKS                                   130468
     C                     MOVE BBRCA     BRCA                            130468
     C                     MOVE BBICN     CNUM                            130468
     C                     MOVE BCCY      CCY                             130468
     C                     ELSE                                           130468
     C                     MOVE @CBRCA    BRCA                            130468
     C                     MOVE @CBICN    CNUM                            130468
     C                     MOVE @CCCY     CCY                             130468
     C                     END                                            130468
     C                     MOVE ACOD1     ACOD                            130468
     C                     Z-ADD01        ACSQ                            130468
     C                     Z-ADD*ZERO     ACNO                            130468
     C                     Z-ADDRUND      VALD                            130468
     C                     Z-SUBBRTAM2    WPSTA                           130468
     C/COPY WNCPYSRC,RE3664C212
     C                     EXSR SUBNAR                                    130468
     C                     MOVE NARS      PNAR                            130468
     C                     EXSR GEICPR                                    130468
      *                                                                   130468
      * Update history if required                                        130468
     C           ATYP      IFEQ 'R'                                       130468
     C           VALD      ANDLENAPDA                                     130468
     C           *IN50     ANDEQ'0'                                       130468
     C                     Z-ADD137       DBASE                           130468
     C                     MOVE 'N'       REACT                           130468
     C                     WRITEREHPOSPF                                  130468
     C                     EXSR POSPR                                     130468
     C                     END                                            130468
      *                                                                   130468
     C                     END                                            130468
     C*
     C*  IF NOT IN STERLING - CALL FRNBRT (FOREIGN POSTINGS)
     C*  ALSO IF BASE CCY NOT STERLING
     C*
     C***********CCY       IFNE STCY1                                     085054
     C           BCCY      IFNE STCY1                                     085054
     C           BCCY1     ORNE STCY1
     C           CACP      ORNE *BLANKS                                   130468
     C           @CCCY     ANDNEBCCY                                      130468
     C                     EXSR FRNBRT
     C           STRGRO    SUB  STRBRT    STRNET 130
     C           BSEGRO    SUB  BSEBRT    BSENET 130
     C                     ELSE
     C                     Z-ADDBRTAMT    STRBRT
     C                     Z-ADDPACR1     STRGRO
     C                     Z-ADDNETBRT    STRNET
     C*
     C                     Z-ADDBRTAMT    BSEBRT
     C                     Z-ADDPACR1     BSEGRO
     C                     Z-ADDNETBRT    BSENET
     C                     END
     C*
     C** SET UP NEW FIELDS FOR O/P ON BALANCE STATEMENTS
     C*
     C                     MOVE 'Y'       BRTF    1
     C                     Z-ADDBRTAMT    BRTA   150
      *                                                                   130468
     C                     END                                            130468
     C*
     C                     ENDSR                           **CALBRT ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   OUTBRT SR. TO OUTPUT A INTPSDD REC. FOR CREDIT INTEREST
     C**
     C**
     C**   CALLED BY:  CRFILL
     C**
     C** **************************************************************
     C*
     C           OUTBRT    BEGSR                           ** OUTBRT SR **
     C**
     C**  OUTPUT A HISTORY REC. TO INTPSDD.
     C**
     C                     MOVE 'D'       RECI
     C*
     C** RETRIEVE CRNM
     C*
     C                     MOVELBCNUM     CNUM#  10
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM CNUM#     @CNUM  10
     C                     PARM           @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCUSTPD'DBFILE           ***************
     C***********          MOVEL@CNUM     DBKEY            * DB ERROR 54 *CRE002
     C***********          Z-ADD054       DBASE            ***************CRE002
     C                     MOVEL@CNUM     DBKEY            * DB ERROR 103*CRE002
     C                     Z-ADD103       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C*
     C                     Z-ADD0         DLNO
     C*
     C** IF CAPITALISATION ON DEMAND OR ACCOUNT CLOSURE USE RUN DATE
     C*
     C           *IN30     IFEQ '1'
     C           BCICI     OREQ 'C'
     C                     Z-ADDRUND      IPDT
     C                     ELSE
     C** ELSE STORE CAPITALISATION DATE AS INTEREST PAYMENT DATE
     C***********          Z-ADDNCID      IPDT                            179300
      *                                                                   179300
      **  Use saved value of NCID, to ensure than the correct value is    179300
      **  taken.                                                          179300
      *                                                                   179300
     C                     Z-ADDNXTCID    IPDT                            179300
      *                                                                   179300
     C                     END
     C                     MOVE BRTCA     BRTCAT
     C*
     C** IF CUSTOMER NOT LIABLE FOR BRT, CALCULATE STG AND BCE GROSS
     C** INTEREST AMOUNTS
     C*
     C           *IN26     IFEQ '0'
     C/COPY WNCPYSRC,RE3664C216
     C                     Z-ADD0         BRTAMT
     C                     EXSR FRNBRT
     C                     END
     C*
     C                     Z-ADDPACR1     CCYGRI
     C                     Z-ADDSTRGRO    STGGRI
     C                     Z-ADDBSEGRO    BCEGRI
     C*
     C   26                Z-ADDBRTAMT    CCYBRT
     C  N26                Z-ADD0         CCYBRT
     C   26                Z-ADDBSEBRT    BCEBRT
     C  N26                Z-ADD0         BCEBRT
     C   26                Z-ADDSTRBRT    STGBRT
     C  N26                Z-ADD0         STGBRT
     C*
     C   26                Z-ADDNETBRT    CCYNTI
     C  N26                Z-ADDPACR1     CCYNTI
     C/COPY WNCPYSRC,RE3664C132
     C   26                Z-ADDSTRNET    STGNTI
     C  N26                Z-ADDSTRGRO    STGNTI
     C   26                Z-ADDBSENET    BCENTI
     C  N26                Z-ADDBSEGRO    BCENTI
     C*
     C** OUTPUT EXCHANGE RATE  (A/C CCY : STERLING)
     C*
     C           BCCY      IFEQ STCY1
     C                     Z-ADD1         EXRATE
     C*
     C                     ELSE
     C           BCCY1     IFEQ STCY1
     C                     MOVE SPOTW     EXRATE
     C*
     C                     ELSE
     C* CALCULATE GROSS RATE
     C                     MOVE MDINW     @@MDI1  1
     C                     MOVE MDINS     @@MDI2  1
     C                     MOVE SPOTW     @@RAT1 138
     C                     MOVE SPOTS     @@RAT2 138
     C                     EXSR ZA0900
     C                     MOVE @@CSRT    EXRATE
     C*
     C                     END
     C*
     C                     END
     C*
     C**********           Z-ADDBCNUM     CNUMK   60                                          CSD027
     C                     MOVE BCNUM     CNUMK   6                                           CSD027
     C           CNUMK     CHAINSDCBRTL1             99
     C           *IN99     IFEQ '1'                        B*2
     C                     MOVEL'SDCBRTPD'DBFILE
     C                     MOVELCNUM      DBKEY
     C***********          Z-ADD68        DBASE                           CRE002
     C                     Z-ADD104       DBASE            * DB ERROR 104*CRE002
     C                     SETON                     U7LR  ** DB ERROR 91
     C                     GOTO ENDTAG
     C                     END                             E*2
     C*
     C           BRTCA     IFEQ 'P'                        B*2
     C           H1BRTL    IFEQ 'Y'                        B**3
     C                     Z-ADDH1SEQN    LIAPTY
     C                     END                             E**3
     C           H2BRTL    IFEQ 'Y'                        B**3
     C                     Z-ADDH2SEQN    LIAPTY
     C                     END                             E**3
     C                     END                             E*2
     C*
     C           BRTCA     IFNE 'P'
     C                     Z-ADD0         LIAPTY
     C                     END
     C*
     C                     MOVE 'N'       S352RI
     C                     Z-ADD0         CRBRTS
     C                     Z-ADD0         CRBRTC
     C                     Z-ADD0         CRBRTE
     C*                                                                   087842
     C*  WRITE OUT DETAILS WITH CORRECT ACCOUNT DETAILS                   087842
     C*                                                                   087842
     C                     MOVE BBRCA     BRCA                            087842
     C                     MOVE BCNUM     CNUM                            087842
     C                     MOVE BCCY      CCY                             087842
     C                     MOVE BACOD     ACOD                            087842
     C                     MOVE BACSQ     ACSQ                            087842
     C*
     C*  IF CATEGORY NOT A BANK AND NOT CORPORATE CUSTOMER
     C*  AND NOT A REPORTABLE NON-RESIDENT.                               CRE007
     C*
     C           BRTCA     IFNE 'C'                        B1
     C           BRTCA     ANDNE'B'
     C           BRTCA     ANDNE'R'                                       CRE007
     C                     MOVE 'A'       RTYP
     C                     MOVE PSTR      PSTR1                           CRE007
     C                     WRITEINTPSDDF
     C                     ELSE                            X1
     C*                                                                   CRE007
     C*  IF CATEGORY IS REPORTABLE NON-RESIDENT                           CRE007
     C*                                                                   CRE007
     C           BRTCA     IFEQ 'R'                        B2             CRE007
     C                     MOVE 'R'       RTYP                            CRE007
     C                     MOVE PSTR      PSTR1                           CRE007
      *                                                                   CRE007
      **  Access Country Details to retrieve ISO Country code             CRE007
     C                     MOVE BBCOLC    @LCTR                           CRE007
     C                     CALL 'AOCTRYR0'                                CRE007
     C                     PARM *BLANKS   @RTCD                           CRE007
     C                     PARM '*KEY    '@OPTN                           CRE007
     C                     PARM           @LCTR   2                       CRE007
     C           SDCTRY    PARM SDCTRY    DSFDY                           CRE007
      *                                                                   CRE007
     C           A4ISOC    CHAINSDFRCTL0             99                   CRE007
     C           *IN99     IFEQ *OFF                       B3             CRE007
      *                                                                   CRE007
     C           F0FRDT    IFLE BJRDNB                     B4             CRE007
     C                     WRITEINTPSDDF                                  CRE007
     C                     ENDIF                           E4             CRE007
      *                                                                   CRE007
     C                     ELSE                                           CRE007
     C                     WRITEINTPSDDF                                  CRE007
     C                     ENDIF                           E3             CRE007
     C                     ENDIF                           E2             CRE007
     C*
     C*  IF CATEGORY IS A BANK AND BANKS INCLUDED IS YES
     C*
     C           BRTCA     IFEQ 'B'                        B2
     C           BTHY      ANDEQ'Y'
     C                     MOVE 'B'       RTYP
     C                     WRITECOINTDDF
     C                     END                             E2
     C*
     C*  IF CATEGORY IS A CORPORATE CUSTOMER
     C*
     C           BRTCA     IFEQ 'C'                        B2
     C                     MOVE 'C'       RTYP
     C                     WRITECOINTDDF
     C                     END                             E2
     C                     END                             E1
     C*
     C           ENDTAG    TAG
     C                     ENDSR                           **OUTBRT ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   FRNBRT SR. TO OUTPUT FOREIGN BRT POSTINGS
     C**
     C**   OUTPUT DEBIT CCY WITHHOLDING TAX A/C
     C**   OUTPUT CREDIT CCY SPOT POSITION
     C**   OUTPUT CREDIT BASE CCY EQUIV. A/C
     C**   OUTPUT DEBIT BASE CCY EQUIV. A/C
     C**   OUTPUT STERLING CCY WITHHOLDING TAX A/C
     C**   OUTPUT STERLING CCY SPOT POSITION A/C
     C**
     C*****************************************************************
     C**
     C           FRNBRT    BEGSR                           ** FRNBRT SR **
     C*
     C           *IN26     IFEQ '1'
     C*
     C*   SETON INDICATOR TO OUTPUT:
     C*                      -   DEBIT  CCY TAX HELD A/C.
     C*                      -   CREDIT CCY SPOT POSITION A/C.
     C*                      -   CREDIT BASE CCY EQUIV. A/C - LOCAL CCY
     C*                      -   DEBIT  BASE CCY EQUIV. A/C - CURRENCY
     C*                      -   CREDIT LOCAL CCY TAX HELD A/C
     C*                      -   DEBIT  LOCAL CCY SPOT POSITION A/C
     C*
     C                     SETON                     27
     C                     Z-ADD10        #                               071428
     C*
     C*  ADD 6 TO RECORD COUNT FOR THESE EXTRA POSTINGS
     C*
     C  N29                ADD  6         NBRREC
     C   29                ADD  4         NBRREC
     C*
     C                     END
     C*
     C**  CONVERT BRT AMT. TO BASE CCY (BRTAMT -> BSEBRT)
     C**  CONVERT GROSS AMT. TO BASE CCY (PACR1 -> BSEGRO)
     C*   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*   FROM VALUES
     C*
     C                     Z-ADDBRTAMT    XAMNT1
     C                     Z-ADDPACR1     XAMNT3
     C                     MOVE SPOTW     XSPOT1
     C                     MOVE MDINW     XMDIN1
     C                     Z-ADDCDPW      XCDP1
     C*
     C*   TO VALUES
     C*
     C                     Z-ADD0         XAMNT2
     C                     Z-ADD0         XAMNT4
     C                     Z-ADDSPOTB     XSPOT2
     C                     MOVE MDINB     XMDIN2
     C                     Z-ADDCDPB      XCDP2
     C*
     C                     EXSR CNVERT
     C*
     C*   PUT CONVERTED AMOUNT INTO 'BASE BRT AMOUNT' FIELD FOR OUTPUT.
     C*
     C                     Z-ADDXAMNT2    BSEBRT 130
     C                     Z-ADDXAMNT4    BSEGRO 130
     C*
     C** CONVERT BRT AMT. TO STERLING CCY
     C*  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C***********CCY       IFNE STCY1                                     071427
     C           BCCY      IFNE STCY1                                     071427
     C*
     C*  TO VALUES
     C*
     C                     Z-ADD0         XAMNT2
     C                     Z-ADD0         XAMNT4
     C                     Z-ADDSPOTS     XSPOT2
     C                     MOVE MDINS     XMDIN2
     C                     Z-ADDCDPS      XCDP2
     C*
     C                     EXSR CNVERT
     C*
     C*   PUT CONVERTED AMOUNT INTO 'STERLING AMOUNT' FIELD FOR O/P
     C*
     C                     Z-ADDXAMNT2    STRBRT 130
     C                     Z-ADDXAMNT4    STRGRO 130
     C*
     C                     ELSE
     C                     Z-ADDBRTAMT    STRBRT
     C                     Z-ADDPACR1     STRGRO
     C                     END
      *                                                                   130468
      * If alt. a/c use the relevant BICN, branch & ccy.                  130468
     C           CACP      IFNE *BLANKS                                   130468
     C                     MOVE BBICN     @SBICN                          130468
     C                     MOVE BBRCA     @SBRCA                          130468
     C                     MOVE BCCY      @SCCY                           130468
     C                     MOVE @CBICN    BBICN                           130468
     C                     MOVE @CBRCA    BBRCA                           130468
     C                     MOVE @CCCY     BCCY                            130468
     C                     END                                            130468
     C*
     C** OUTPUT POSTINGS IF STERLING SPOT TRADE A/C EQUIV. CODE IS
     C** NOT ZERO, EXECUTE 'PLPR' SUBROUTINE 6 TIMES
     C*
     C**  If Analytical Accounting is installed:                          CAC001
     C**    - If Posting to spot trade or trade equivalent account,       CAC001
     C**      use FX Position Profit Centre (already setup in SR/CREPR)   CAC001
     C**    - Otherwise, use profit centre of the main account            CAC001
     C*                                                                   CAC001
     C           *IN29     IFEQ '0'
     C*
     C**********           CALL 'AOBRCHR0'
     C**********           PARM '*MSG   ' @RTCD
     C**********           PARM '*KEY   ' @OPTN
     C**********           PARM BBRCA     @BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY
     C********** @RTCD     IFNE *BLANK
     C********** *LOCK     IN   LDA
     C**********           MOVEL'SDBRCHPD'DBFILE           ***************
     C**********           MOVEL@BRCA     DBKEY            * DB ERROR 32 *
     C**********           Z-ADD32        DBASE            ***************
     C**********           OUT  LDA
     C**********           WRITEERRP1
     C**********           EXSR *PSSR
     C**********           END
     C**********           MOVE BICN      CNUM
     C*
     C********** BRTAMT    IFNE 0                                         130468
     C           BRTAM2    IFNE 0                                         130468
     C                     MOVE BCCY      CCY
     C*
     C**********           MOVE 'D'       RECI
     C********** RECI      CHAINSDBRTDD0             99    (99 = EOF)
     C***99*****           SETON                     U7LR  ** DB ERROR 98
     C***99*****           MOVEL'SDBRTDPD'DBFILE
     C***99*****           MOVELRECI      DBKEY
     C***99*****           Z-ADD98        DBASE
     C***99*****           EXSR *PSSR
     C*
     C                     MOVE ACOD1     ACOD
     C********** BGN0ST    IFEQ 'Y'                                CAC001 130468
     C**********           MOVE WMPRFC    PRFC                     CAC001 130468
     C**********           ENDIF                                   CAC001 130468
     C**********           MOVE 'P'       RECI
     C                     MOVE *BLANKS   IPDN
     C**********           Z-ADD91060     TRAT                            130468
     C**********           MOVEL'BRT '    @PNARX 12
     C**********           MOVE 'INTEREST'@PNARX
     C**********           MOVEL@PNARX    NARS
     C**********           MOVELNAR,#     INPNAR                          130468
     C**********           MOVELNR16,#    INP16                           130468
     C**********           MOVELDN07,#    INP07                           130468
     C**********           MOVELMGD,#     ##MGID                   S01522 130468
     C/COPY WNCPYSRC,RE3664C150
     C*
     C**********           Z-ADDBRTAMT    WPSTA                           130468
     C                     Z-ADDBRTAM2    WPSTA                           130468
     C**********           MOVE '0'       DRCR
     C*********************MOVE BCNUM     ASOC                            080978
     C**********           MOVE ABRCA     BRCA
     C                     MOVE *BLANKS   MGTT
     C                     Z-ADD0         LTAI
     C                     MOVE *BLANKS   RINO
     C                     MOVE *BLANKS   SWCR
     C                     MOVE *BLANKS   DLREF
     C                     MOVE *BLANKS   FACO
     C**********           Z-ADD0         DBCNUM                                              CSD027
     C                     MOVE *BLANKS   DBCNUM                                              CSD027
     C                     MOVE *BLANKS   PREF
     C                     MOVE *BLANKS   OTRF
     C                     MOVE *BLANKS   OTST
     C**********           MOVEL'91060'   OTTP                            130468
     C                     Z-ADD0         SDCB
     C                     Z-ADD0         SDLB
     C                     MOVE *BLANKS   BOKC
     C                     Z-ADD1         NITMS
     C                     MOVE *BLANKS   REBI
     C                     Z-ADD0         CHGA
     C                     EXSR PLPR
     C*
     C**********           CALL 'AOTRADR0'
     C**********           PARM *BLANKS   @RTCD   7
     C**********           PARM '*FIRST ' @OPTN   7
     C********** SDTRAD    PARM SDTRAD    DSFDY
     C********** @RTCD     IFNE *BLANK
     C********** *LOCK     IN   LDA
     C**********           MOVEL'SDTRADPD'DBFILE           ***************
     C**********           MOVEL@OPTN     DBKEY            * DBERROR 007 *
     C**********           Z-ADD007       DBASE            ***************
     C**********           OUT  LDA
     C**********           EXSR *PSSR
     C**********           END
     C                     MOVE SPAC      ACOD
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WFXPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C**********           Z-SUBBRTAMT    WPSTA                           130468
     C                     Z-SUBBRTAM2    WPSTA                           130468
     C**********           Z-ADD1         DRCR
     C                     EXSR PLPR
     C                     END
     C*
     C           BSEBRT    IFNE 0
     C                     MOVE BACCY     CCY
     C*
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           STCY1     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM STCY1     @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 10 *CRE002
     C***********          Z-ADD010       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 105*CRE002
     C                     Z-ADD105       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C                     MOVE TACC      ACOD
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WFXPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C                     Z-SUBBSEBRT    WPSTA
     C                     EXSR PLPR
     C*
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY      LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BCCY      @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 10 *CRE002
     C***********          Z-ADD010       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 106*CRE002
     C                     Z-ADD106       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C                     MOVE TACC      ACOD
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WFXPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C                     Z-ADDBSEBRT    WPSTA
     C*********            Z-ADD0         DRCR
     C                     EXSR PLPR
     C                     END
     C*
     C           STRBRT    IFNE 0
     C                     MOVE STCY1     CCY
     C*
     C*****                MOVE 'D'       RECI
     C*****      RECI      CHAINSDBRTDD0             99    (99 = EOF)
     C   99      *LOCK     IN   LDA
     C***99                SETON                     U7LR  ** DB ERROR 98
     C***99                MOVEL'SDBRTDPD'DBFILE
     C***99                MOVELRECI      DBKEY
     C***99                Z-ADD98        DBASE
     C   99                OUT  LDA
     C***99                EXSR *PSSR
     C*
     C                     MOVE ACOD1     ACOD
     C/COPY WNCPYSRC,RE3664C214
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C**********           MOVE WMPRFC    PRFC                     CAC001 130468
     C                     MOVE WSVPC     PRFC                            130468
     C                     ENDIF                                          CAC001
     C******               MOVE 'P'       RECI
     C                     Z-SUBSTRBRT    WPSTA
     C******               Z-ADD1         DRCR
     C                     EXSR PLPR
     C*
     C*****                CALL 'AOTRADR0'
     C*****                PARM *BLANKS   @RTCD   7
     C****                 PARM '*FIRST ' @OPTN   7
     C***        SDTRAD    PARM SDTRAD    DSFDY
     C***        @RTCD     IFNE *BLANK
     C***        *LOCK     IN   LDA
     C***                  MOVEL'SDTRADPD'DBFILE           ***************
     C***                  MOVEL@OPTN     DBKEY            * DBERROR 007 *
     C***                  Z-ADD007       DBASE            ***************
     C***                  OUT  LDA
     C***                  EXSR *PSSR
     C***                  END
     C                     MOVE SPAC      ACOD
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WFXPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C                     Z-ADDSTRBRT    WPSTA
     C*****                Z-ADD0         DRCR
     C                     EXSR PLPR
     C                     END
     C*
     C                     ELSE
     C*
     C*****                CALL 'AOBRCHR0'
     C*****                PARM '*MSG   ' @RTCD
     C*****                PARM '*KEY   ' @OPTN
     C*****                PARM BBRCA     @BRCA   3
     C*****      SDBRCH    PARM SDBRCH    DSFDY
     C*****      @RTCD     IFNE *BLANK
     C*****      *LOCK     IN   LDA
     C*****                MOVEL'SDBRCHPD'DBFILE           ***************
     C****                 MOVEL@BRCA     DBKEY            * DB ERROR 42 *
     C****                 Z-ADD42        DBASE            ***************
     C*****                OUT  LDA
     C*****                WRITEERRP1
     C*****                EXSR *PSSR
     C*****                END
     C*****                MOVE BICN      CNUM
     C*
     C********** BRTAMT    IFNE 0                                         130468
     C           BRTAM2    IFNE 0                                         130468
     C                     MOVE BCCY      CCY
     C*
     C****                 MOVE 'D'       RECI
     C****       RECI      CHAINSDBRTDD0             99    (99 = EOF)
     C   99      *LOCK     IN   LDA
     C***99                SETON                     U7LR  ** DB ERROR 98
     C***99                MOVEL'SDBRTDPD'DBFILE
     C***99                MOVELRECI      DBKEY
     C***99                Z-ADD98        DBASE
     C   99                OUT  LDA
     C***99                EXSR *PSSR
     C*
     C                     MOVE ACOD1     ACOD
     C********** BGN0ST    IFEQ 'Y'                                CAC001 130468
     C**********           MOVE WMPRFC    PRFC                     CAC001 130468
     C**********           ENDIF                                   CAC001 130468
     C*****                MOVE 'P'       RECI
     C                     MOVE *BLANKS   IPDN
     C**********           Z-ADD91060     TRAT                            130468
     C*********            MOVEL'BRT '    @PNARX 12
     C*********            MOVE 'INTEREST'@PNARX
     C*********            MOVEL@PNARX    NARS
     C**********           MOVELNAR,#     INPNAR                          130468
     C**********           MOVELNR16,#    INP16                           130468
     C**********           MOVELDN07,#    INP07                           130468
     C**********           MOVELMGD,#     ##MGID                   S01522 130468
     C/COPY WNCPYSRC,RE3664C151
     C*
     C**********           Z-ADDBRTAMT    WPSTA                           130468
     C                     Z-ADDBRTAM2    WPSTA                           130468
     C**********           MOVE '0'       DRCR
     C*********************MOVE BCNUM     ASOC                            080978
     C                     MOVE ABRCA     BRCA
     C                     MOVE *BLANKS   MGTT
     C                     Z-ADD0         LTAI
     C                     MOVE *BLANKS   RINO
     C                     MOVE *BLANKS   SWCR
     C                     MOVE *BLANKS   DLREF
     C                     MOVE *BLANKS   FACO
     C**********           Z-ADD0         DBCNUM                                              CSD027
     C                     MOVE *BLANKS   DBCNUM                                              CSD027
     C                     MOVE *BLANKS   PREF
     C                     MOVE *BLANKS   OTRF
     C                     MOVE *BLANKS   OTST
     C**********           MOVEL'91060'   OTTP                            130468
     C                     Z-ADD0         SDCB
     C                     Z-ADD0         SDLB
     C                     MOVE *BLANKS   BOKC
     C                     Z-ADD1         NITMS
     C                     MOVE *BLANKS   REBI
     C                     Z-ADD0         CHGA
     C                     EXSR PLPR
     C*
     C*******              CALL 'AOTRADR0'
     C******               PARM *BLANKS   @RTCD   7
     C******               PARM '*FIRST ' @OPTN   7
     C****       SDTRAD    PARM SDTRAD    DSFDY
     C****       @RTCD     IFNE *BLANK
     C****       *LOCK     IN   LDA
     C****                 MOVEL'SDTRADPD'DBFILE           ***************
     C****                 MOVEL@OPTN     DBKEY            * DBERROR 007 *
     C****                 Z-ADD007       DBASE            ***************
     C****                 OUT  LDA
     C****                 EXSR *PSSR
     C****                 END
     C                     MOVE SPAC      ACOD
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WFXPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C**********           Z-SUBBRTAMT    WPSTA                           130468
     C                     Z-SUBBRTAM2    WPSTA                           130468
     C****                 Z-ADD1         DRCR
     C                     EXSR PLPR
     C                     END
     C*
     C           BSEBRT    IFNE 0
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY      LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BCCY      @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 10 *CRE002
     C***********          Z-ADD010       DBASE            ***************CRE002
     C                     MOVEL@CYCD     DBKEY            * DB ERROR 107*CRE002
     C                     Z-ADD107       DBASE            ***************CRE002
     C                     OUT  LDA
     C***********          WRITEERRP1                                     CCB003
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                            CRE083BK
     C                     MOVE TACC      ACOD
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WFXPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C*****                Z-ADD0         DRCR
     C                     MOVE BACCY     CCY
     C                     Z-ADDBSEBRT    WPSTA
     C                     EXSR PLPR
     C                     END
     C*
     C           STRBRT    IFNE 0
     C                     MOVE STCY1     CCY
     C*
     C******               MOVE 'D'       RECI
     C******     RECI      CHAINSDBRTDD0             99    (99 = EOF)
     C   99      *LOCK     IN   LDA
     C***99                SETON                     U7LR  ** DB ERROR 98
     C***99                MOVEL'SDBRTDPD'DBFILE
     C***99                MOVELRECI      DBKEY
     C***99                Z-ADD98        DBASE
     C   99                OUT  LDA
     C***99                EXSR *PSSR
     C*
     C                     MOVE ACOD1     ACOD
     C/COPY WNCPYSRC,RE3664C215
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C**********           MOVE WMPRFC    PRFC                     CAC001 130468
     C                     MOVE WSVPC     PRFC                            130468
     C                     ENDIF                                          CAC001
     C*******              MOVE 'P'       RECI
     C                     Z-SUBSTRBRT    WPSTA
     C*****                Z-ADD1         DRCR
     C                     EXSR PLPR
     C                     END
     C*
     C                     END
      *                                                                   130468
      * If alt. a/c restore the BICN, branch & ccy for the original a/c   130468
     C           CACP      IFNE *BLANKS                                   130468
     C                     MOVE @SBICN    BBICN                           130468
     C                     MOVE @SBRCA    BBRCA                           130468
     C                     MOVE @SCCY     BCCY                            130468
     C                     END                                            130468
     C*
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   CNVERT SR. TO CONVERT CURRENCY BRT AMOUNT
     C**
     C**
     C*****************************************************************
     C**
     C           CNVERT    BEGSR                           ** CNVERT SR **
     C*
     C*  SETUP 'FROM CURRENCY' VALUES
     C*
     C                     Z-ADDXAMNT1    XAMNT1 130
     C                     Z-ADDXAMNT3    XAMNT3 130
     C                     Z-ADDXSPOT1    XSPOT1 138
     C                     MOVELXMDIN1    XMDIN1  1
     C                     Z-ADDXCDP1     XCDP1   10
     C*
     C*  SETUP 'TO CURRENCY' VALUES
     C*
     C                     Z-ADDXAMNT2    XAMNT2 130
     C                     Z-ADDXAMNT4    XAMNT4 130
     C                     Z-ADDXSPOT2    XSPOT2 138
     C                     MOVELXMDIN2    XMDIN2  1
     C                     Z-ADDXCDP2     XCDP2   10
     C*
     C*
     C*  CALCULATE SCALING FACTOR (CDP DIFFERENCE)
     C*
     C           XCDP2     SUB  XCDP1     Z       10
     C                     ADD  4         Z
     C*
     C           XMDIN1    IFNE XMDIN2
     C           XSPOT1    MULT XSPOT2    XSPOT  138
     C                     END
     C*
     C           XMDIN1    IFEQ XMDIN2
     C           XSPOT1    DIV  XSPOT2    XSPOT  138
     C                     END
     C*
     C*
     C*  ADJUST CONVERSION RATE FOR NO. DECIMAL PLACES
     C*
     C           XMDIN1    IFEQ 'D'
     C           POWER,Z   DIV  XSPOT     XRATE  159
     C                     ELSE
     C           POWER,Z   MULT XSPOT     XRATE  159
     C                     END
     C*
     C*
     C*  CALCULATE NEW AMOUNT
     C*
     C           XAMNT1    MULT XRATE     XAMNT2    H
     C           XAMNT3    MULT XRATE     XAMNT4    H
     C                     ENDSR                           **CNVERT ENDSR*
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************S01522
     C**  Subroutine SRPNAR determines the required narrative.          **S01522
     C********************************************************************S01522
     C           SRPNAR    BEGSR                           * S R P N A R *S01522
     C*                                                                   S01522
     C* Define the data structure parameter:                              S01522
     C*                                                                   S01522
     C           *LIKE     DEFN CGPNAR    ##PNAR                          S01522
     C*                                                                   S01522
     C* If the facility is switched off or unavailable,                   S01522
     C*  or UDC is not installed, exit this subroutine:                   S01522
     C*                                                                   S01522
     C           REPNAR    IFNE 'Y'                                       S01522
     C                     GOTO EXPNAR                                    S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C* Determine the customer's name:                                    S01522
     C*                                                                   S01522
     C                     MOVELXCNUM     ##KEY     P                     S01522
     C*                                                                   S01522
     C                     CALL 'AOCUSTR0'                                S01522
     C                     PARM           ##RTN   7                       S01522
     C                     PARM '*KEY   ' ##OPT   7                       S01522
     C                     PARM           ##KEY  10                       S01522
     C                     PARM           ##STS   7                       S01522
     C           SDCUST    PARM SDCUST    DSSDY                           S01522
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C                     MOVEL'SDCUSTPD'DBFILE             *************S01522
     C***********          MOVEL'101'     DBASE        * DBERR 101 *S01522CRE002
     C                     Z-ADD108       DBASE              * DBERR 108 *CRE002
     C                     MOVEL##KEY     DBKEY              *************S01522
     C                     EXSR *PSSR                                     S01522
     C                     ENDIF                                          S01522
     C*...................................................................S01522
     C/EJECT                                                              S01522
     C*...................................................................S01522
     C* Determine the value for the narrative using AOPNARR0:             S01522
     C*                                                                   S01522
     C                     CLEARCGPNAR                                    S01522
     C                     CLEAR##PRM1                                    086125
     C                     MOVE 'RE'      MNMODI                          S01522
     C                     MOVE XBRCA     MNBRCA                          S01522
     C/COPY WNCPYSRC,REH00448
     C                     MOVE XCNUM     MNCUST                          S01522
     C/COPY WNCPYSRC,REH00449
     C                     MOVE XCCY      MNCYCD                          S01522
     C                     MOVE XACOD     MNACCD                          S01522
     C                     MOVE XACSQ     MNACSQ                          S01522
     C                     MOVE CRNM      MNCRNM                          S01522
     C                     MOVELPNAR      MNNARR    P                     S01522
     C                     MOVELASOC      MNASOC                          S01522
     C                     MOVELWACNO     MNRACN                          S01522
     C/COPY WNCPYSRC,REH00427
     C*                                                                   S01522
     C                     CALL 'AOPNARR0'                                S01522
     C                     PARM           ##RTN                           S01522
     C                     PARM           ##MGID  7                       S01522
     C                     PARM           ##PRM1                          086125
     C           CGPNAR    PARM CGPNAR    ##PNAR                          S01522
     C                     PARM           ##NARR 50                       S01522
     C/COPY WNCPYSRC,REH00428
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C                     MOVEL'CGPNARPD'DBFILE             *************S01522
     C***********          MOVEL'102'     DBASE        * DBERR 102 *S01522CRE002
     C                     Z-ADD109       DBASE              * DBERR 109 *CRE002
     C                     MOVELMNCUST    DBKEY              *************S01522
     C                     EXSR *PSSR                                     S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C                     MOVEL##NARR    PNAR      P                     S01522
     C*                                                                   S01522
     C           EXPNAR    TAG                             < EXPNAR       S01522
     C*                                                                   S01522
     C                     ENDSR                                          S01522
     C********************************************************************S01522
     C/EJECT
     C********************************************************************
     C           ZA0900    BEGSR
     C*
     C           @@RAT1    IFEQ *ZERO
     C                     Z-ADD1         @@RAT1
     C                     END
     C*
     C           @@RAT2    IFEQ *ZERO
     C                     Z-ADD1         @@RAT2
     C                     END
     C*
     C** IF THE FIRST RATE M/D INDICATOR IS '1' MULTIPLY, ELSE DIVIDE
     C*
     C           @@MDI1    IFEQ 'M'
     C                     Z-ADD@@RAT1    @@CSRT 138
     C                     ELSE
     C           1         DIV  @@RAT1    @@CSRT    H
     C                     END
     C*
     C** IF THE SECOND RATE M/D INDICATOR IS '0' MULTIPLY, ELSE DIVIDE
     C*
     C           @@MDI2    IFEQ 'D'
     C           @@CSRT    MULT @@RAT2    @@CSRT
     C                     ELSE
     C           @@CSRT    DIV  @@RAT2    @@CSRT    H
     C                     END
     C*
     C** SET FIRST CCY MULTIPLY/DIVIDE *IN TO MULTIPLY
     C*
     C                     MOVE 'M'       @@FCMD  1
     C*
     C                     ENDSR                           **ZA0900 ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*                 ACDCHN SUBROUTINE
     C*
     C*  SUBR TO PICK UP ACCOUNT CODE DETAILS FOR POSTINGS
     C*
      *****************************************************************   CCB003
     C           ACDCHN    BEGSR
     C*
     C*  ACCESS SDACODPD USING PASSED ACCOUNT CODE
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE ACODA     KEYACD                                            CRE083BK
     C                     Z-ADD110       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD   7                                         CRE083BK
     C**********           PARM '*KEY   ' @OPTN   7                                         CRE083BK
     C**********           PARM ACODA     @AFNB   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM ACODA     @AFNB  10                                  CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C****************************************************************                      CRE083BK
     C*****IF*-*NOT*A*VALID*RECORD************************************                      CRE083BK
     C****************************************************************                      CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C***********          Z-ADD5         DBASE                           CRE002
     C**********           Z-ADD110       DBASE                                      CRE002 CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           * DBERR 110*              CRE002 CRE083BK
     C***********          MOVEL'SDACODPD'DBFILE           * DBERR 05 *   CRE002
     C**********           MOVEL@AFNB     DBKEY                                             CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C**********           SETON                     U7U8LR                                 CRE083BK
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     ENDSR                           **ACDCHN ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** TOTAL subroutine to execute end processing.
     C**
     C**     Called by       S T A R T
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           TOTAL     BEGSR                           **TOTAL BEGSR**
     C*
     C***ACCESS*GEICZZ*TO*UPDATE*OR*CREATE                                CCB003
     C** ACCESS REINTCPA TO UPDATE OR CREATE                              CCB003
     C*
     C***********          OPEN GEICZZ                                    CCB003
     C***********          READ GEICZZ                   99               CCB003
     C                     OPEN REINTCPA                                  CCB003
     C                     READ REINTCPA                 99               CCB003
     C                     Z-ADD*ZEROS    DBASE
     C           *IN99     IFEQ '1'                        - B1
     C***********WNORE     ADD  2         NORE1                           CCB003
     C                     Z-ADDWNORE     NORE1                           CCB003
     C/COPY WNCPYSRC,RE3664C033
     C                     Z-ADDZZTOTD    HRDC
     C                     Z-ADDZZTOTI    HRWN
     C/COPY WNCPYSRC,RE3664C034
     C                     MOVE 'T'       RECI
     C                     WRITEAPOSTZZF
     C                     ELSE                            - X1
     C                     ADD  WNORE     NORE1
     C                     Z-ADDHRDC      ZZAMTD
     C                     Z-ADDHRWN      ZZAMTI
     C/COPY WNCPYSRC,RE3664C035
     C                     EXSR GLZSUM
     C                     Z-ADDZZTOTD    HRDC
     C                     Z-ADDZZTOTI    HRWN
     C***********          Z-ADD79        DBASE                           CRE002
     C                     Z-ADD111       DBASE            * DB ERROR 111*CRE002
     C                     UPDATAPOSTZZF
     C                     Z-ADD*ZEROS    DBASE
     C                     END                             - E1
     C                     Z-ADD*ZERO     WNORE
     C                     Z-ADD*ZERO     ZZTOTI
     C                     Z-ADD*ZERO     ZZTOTD
     C/COPY WNCPYSRC,RE3664C036
     C***********          Z-ADD80        DBASE                           CRE002
     C                     Z-ADD112       DBASE            * DB ERROR 112*CRE002
     C***********          CLOSEGEICZZ                                    CCB003
     C                     CLOSEREINTCPA                                  CCB003
     C                     Z-ADD*ZEROS    DBASE
     C*
     C/COPY WNCPYSRC,RE3664C037
     C***OUTPUT*AUDIT DETAIL                                              CCB003
     C***********                                                         CCB003
     C************INLR     IFEQ '1'                                       CCB003
     C***********          WRITETOTALS                                    CCB003
     C***********                                                         CCB003
     C***OUTPUT*AUDIT END                                                 CCB003
     C***********                                                         CCB003
     C***********          END                                            CCB003
     C*
     C                     ENDSR                           **TOTAL ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** TOTTAX subroutine
     C*
     C**     Called by       TOTAC
     C**     Calls           -
     C*
      *****************************************************************   CCB003
     C           TOTTAX    BEGSR
     C*
     C** CAPITALISATION CREDIT TODAY
     C*
     C           BCICI     IFEQ 'Y'
     C           BCICI     OREQ 'D'
     C           BCICI     OREQ 'C'
     C*
     C** WITHHOLDING TAX ON GROSS AMOUNT
     C*
     C           TXWNDI    IFNE 'Y'
     C                     Z-ADDWCIWT     WTIWT
     C*
     C** RESET DEBIT INTEREST CUMULATOR
     C*
     C                     Z-ADD*ZERO     DINW
     C*
     C           TXWNDI    IFEQ 'S'
     C                     SUB  WDIWT     WTIWT
     C                     END
     C*
     C** WITHHOLDING TAX ON NET AMOUNT
     C*
     C                     ELSE
     C*
     C           WCIWT     SUB  DINW      WTIWT
     C/COPY WNCPYSRC,REH00434
     C*
     C** INTEREST DEBIT CUMULATOR FOR NEW PERIOD
     C*
     C                     Z-ADDWDIWT     DINW
     C*
     C** DEBIT CAPITALISATION INCLUDED IN CREDIT PERIOD
     C*
     C           BDICI     IFEQ 'Y'
     C           BDICI     OREQ 'D'
     C           BDICI     OREQ 'C'
     C           LDID      ANDLELCID
     C                     SUB  WDIWT     WTIWT
     C                     Z-ADD*ZERO     DINW
     C*
     C                     END
     C                     END
     C*
     C** PROCESS TAX CALCULATION
     C*
     C/COPY WNCPYSRC,RE3664C069
     C                     Z-ADD0         CINW                                              AR813717
     C           WCSIN     IFEQ 'N'                                                         AR813717
     C                     EXSR TAXPOS
     C                     ENDIF                                                            AR813717
     C/COPY WNCPYSRC,RE3664C070
     C*
     C                     ELSE
     C*
     C** DEBIT CAPITALISATION ONLY
     C*
     C           BDICI     IFEQ 'Y'
     C           BDICI     OREQ 'D'
     C           BDICI     OREQ 'C'
     C*
     C** DEBIT INTEREST CUMULATOR
     C*
     C                     ADD  WDIWT     DINW
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR                           **TOTAX ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** TAXPOS subroutine
     C*
     C**     Called by       - TOTTAX
     C**     Calls           -
     C*
      *****************************************************************   CCB003
     C           TAXPOS    BEGSR
      **Save*history balance*******************************************               135809 135809R
     C**********           Z-ADDHISB      @RHISB                                      135809 135809R
      * Save history balance                                                                AR978914
     C                     Z-ADDHISB      @RHISB                                            AR978914
     C*
     C** INITIALIZE TOTAL FIELD
     C*
     C                     Z-ADD*ZERO     BCINW
     C*
     C** PROCESS ONLY IF TOTAL INTEREST IS CREDIT
     C*
     C/COPY WNCPYSRC,RE3664C189
     C           WTIWT     IFLT *ZERO                      * B1
     C                     Z-ADD*ZERO     WTIWT            *
     C                     END                             * E1
     C/COPY WNCPYSRC,RE3664C190
     C*
     C           WTIWT     IFGT *ZERO                      * B1
     C/COPY WNCPYSRC,REH00435
     C*                                                    *
     C** CALCULATE THE TAX AMOUNT IN ACCOUNT CURRENCY      *
     C*                                                    *
      *                                                                                       CDL013
      ** If CDL013 installed, calculate WHT amount                                            CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
      ** Access account details extension file                                                CDL013
     C           ACKEY1    CHAINACCNTBY0             40                                       CDL013
      *                                                                                       CDL013
      ** If CHAIN failed, terminate the program                                               CDL013
     C           *IN40     IFEQ '1'                                                           CDL013
     C           *LOCK     IN   LDA                                                           CDL013
     C                     MOVEL'ACCNTBY0'DBFILE           ************                       CDL013
     C                     MOVELAKEY      DBKEY            * DBERR 143*                       CDL013
     C                     Z-ADD143       DBASE            ************                       CDL013
     C                     OUT  LDA                                                           CDL013
     C                     EXSR *PSSR                                                         CDL013
     C                     ENDIF                                                              CDL013
     C/COPY WNCPYSRC,REH00015
      *                                                                                       CDL013
      ** Set WHT rate                                                                         CDL013
     C                     SELEC                                                              CDL013
     C           ATITAX    WHEQ '0'                                                           CDL013
     C                     Z-ADD0         WRATE   52                                          CDL013
     C           ATITAX    WHEQ '1'                                                           CDL013
     C                     Z-ADDETXR1     WRATE                                               CDL013
     C           ATITAX    WHEQ '2'                                                           CDL013
     C                     Z-ADDETXR2     WRATE                                               CDL013
     C           ATITAX    WHEQ '3'                                                           CDL013
     C                     Z-ADDETXR3     WRATE                                               CDL013
     C           ATITAX    WHEQ '4'                                                           CDL013
     C                     Z-ADDETXR4     WRATE                                               CDL013
     C           ATITAX    WHEQ '5'                                                           CDL013
     C                     Z-ADDETXR5     WRATE                                               CDL013
     C           ATITAX    WHEQ '6'                                                           CDL013
     C                     Z-ADDETXR6     WRATE                                               CDL013
     C           ATITAX    WHEQ '7'                                                           CDL013
     C                     Z-ADDETXR7     WRATE                                               CDL013
     C           ATITAX    WHEQ '8'                                                           CDL013
     C                     Z-ADDETXR8     WRATE                                               CDL013
     C           ATITAX    WHEQ '9'                                                           CDL013
     C                     Z-ADDETXR9     WRATE                                               CDL013
     C                     ENDSL                                                              CDL013
     C/COPY WNCPYSRC,REH00016
      *                                                                                       CDL013
      ** If WHT rate is 0, set Tax amount to 0                                                CDL013
     C           WRATE     IFEQ 0                                                             CDL013
     C                     Z-ADD0         CINW                                                CDL013
      *                                                                                       CDL013
      ** Otherwise, calculate WHT                                                             CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      ** If Ccy is equal to Base Ccy                                                          CDL013
      ** and CDL081 is off                                                                    CDL081
      *                                                                                       CDL081
     C           BCCY      IFEQ BACCY                                                         CDL013
     C           CDL081    ANDEQ'N'                                                           CDL081
      *                                                                                       CDL013
      ** Set work adjustment field according to decimal places.                               CDL013
     C           *IN80     IFEQ '1'                                                           CDL013
     C                     Z-ADD1         WADJ    40                                          CDL013
     C                     ENDIF                                                              CDL013
     C           *IN81     IFEQ '1'                                                           CDL013
     C                     Z-ADD10        WADJ                                                CDL013
     C                     ENDIF                                                              CDL013
     C           *IN82     IFEQ '1'                                                           CDL013
     C                     Z-ADD100       WADJ                                                CDL013
     C                     ENDIF                                                              CDL013
     C           *IN83     IFEQ '1'                                                           CDL013
     C                     Z-ADD1000      WADJ                                                CDL013
     C                     ENDIF                                                              CDL013
     C/COPY WNCPYSRC,REH00024
      *                                                                                       CDL013
      ** Round down Interest amount                                                           CDL013
     C           WTIWT     DIV  WADJ      BWTIWT 130                                          CDL013
     C                     MULT WADJ      BWTIWT                                              CDL013
     C/COPY WNCPYSRC,REH00025
      *                                                                                       CDL013
      ** Calculate WHT                                                                        CDL013
     C           BWTIWT    MULT WRATE     CINW                                                CDL013
     C                     DIV  100       CINW                                                CDL013
     C/COPY WNCPYSRC,REH00017
      *                                                                                       CDL013
      ** Round down WHT                                                                       CDL013
     C                     DIV  WADJ      CINW                                                CDL013
     C                     MULT WADJ      CINW                                                CDL013
     C/COPY WNCPYSRC,REH00018
      *                                                                                       CDL013
      ** If Ccy is NOT equal to Base Ccy                                                      CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      ** Calculate WHT without rounding down.                                                 CDL013
     C           WTIWT     MULT WRATE     CINW                                                CDL013
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           BCCY      IFEQ BACCY                                                         CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           BCCY      ORNE BACCY                                                         CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#NBRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       CINW                                                CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       CINW      H                                         CDL013
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C/COPY WNCPYSRC,REH00147
      *                                                                                       CDL013
      ** If CDL013 NOT installed                                                              CDL013
     C                     ELSE                                                               CDL013
     C/COPY WNCPYSRC,RE3664CP19                                           S01408
     C*                                                                   S01408
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C*                                                                                       CGL165
      * Zeroise Secondary Tax Amount, Secondary Tax Amount in Base CCY                        CGL165
      * and Main and Secondary Tax Amounts in Local CCY                                       CGL165
     C                     Z-ADD*ZERO     CINS   150                                          CGL165
     C                     Z-ADD*ZERO     BCINS  150                                          CGL165
     C                     Z-ADD*ZERO     LCINS  150                                          CGL165
     C                     Z-ADD*ZERO     LCINW  150                                          CGL165
      *                                                                                       CGL165
     C                     Z-ADDWTIWT     PINTA                                               CGL165
     C                     MOVELAACNO     PACNO                                               CGL165
     C**********           MOVELACOD      PACOD                                      CGL165 MD034383
     C                     MOVELAACOD     PACOD                                             MD034383
      *                                                                                       CGL165
     C                     CALL 'GL024000'                                                    CGL165
     C                     PARM           PRCOD1  1                                           CGL165
     C                     PARM 'RE3664'  PCPGM   6                                           CGL165
     C**********           PARM BRCA      PBRCA   3                                  CGL165 MD034383
     C**********           PARM CNUM      PCUST   6                                  CGL165 MD034383
     C                     PARM ABRCA     PBRCA   3                                         MD034383
     C                     PARM ACCNUM    PCUST   6                                         MD034383
     C                     PARM           PACNO  10                                           CGL165
     C                     PARM CCY       PCCY    3                                           CGL165
     C                     PARM           PINTA  150                                          CGL165
     C                     PARM ATTXC1    PTXC1   2                                           CGL165
     C                     PARM ATTXC2    PTXC2   2                                           CGL165
     C                     PARM *ZEROS    PCPDT   50                                          CGL165
     C                     PARM *ZEROS    PVDAT   50                                          CGL165
     C                     PARM *ZEROS    PMDAT   50                                          CGL165
     C                     PARM *ZEROS    PINTR  117                                          CGL165
     C                     PARM *BLANKS   PDTYP   2                                           CGL165
     C                     PARM *ZEROS    PPCPL  150                                          CGL165
     C                     PARM           PACOD  10                                           CGL165
     C                     PARM AACSQ     PACSQ   20                                          CGL165
     C                     PARM           PWTXA  150                                          CGL165
     C                     PARM           PSTXA  150                                          CGL165
      *                                                                                       CGL165
     C                     Z-ADDPWTXA     CINW                                                CGL165
     C                     Z-ADDPSTXA     CINS                                                CGL165
      *                                                                                       CGL165
     C                     ELSE                                                               CGL165
      *                                                                                       CGL165
     C           WTIWT     MULT TXWTRR    CINW             *
     C           CINW      DIV  100       CINW      H      *
      *                                                                                       CDL013
     C/COPY WNCPYSRC,REH00458
     C                     ENDIF                                                              CGL165
     C                     ENDIF                                                              CDL013
     C*                                                    *
     C/COPY WNCPYSRC,RE3664CP20                                           S01408
     C*                                                                   S01408
     C** CALCULATE THE TAX AMOUNT IN BASE CURRENCY         *
     C*                                                    *
     C           BCCY      IFEQ BACCY                      ** B2
     C                     Z-ADDCINW      BCINW            **
     C/COPY WNCPYSRC,REH00436
     C*                                                    **
     C                     ELSE                            ** X2
     C*                                                    **
     C** CALCULATE THE BCCY EQUIVALENT ONLY IF DIFFERENT CURRENCY
     C*                                                    **
     C                     MOVE BCCY      ZCCYI            **
     C                     Z-ADDWOSPOT    ZRATEF           **
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     Z-ADDWOTXCR    ZRATEF                                              CGL165
     C                     ENDIF                                                              CGL165
     C/COPY WNCPYSRC,REH00148
     C                     MOVE WOCDP     ZCDPI            **
     C                     MOVE WOMDIN    ZMDINF           **
     C                     MOVE BACCY     ZCCYO            **
     C                     Z-ADDWBSPOT    ZRATET           **
      *                                                                                       CGL165
      * If CGL165 is On, use Tax Conversion Rate                                              CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     Z-ADDWBTXCR    ZRATET                                              CGL165
     C                     ENDIF                                                              CGL165
     C/COPY WNCPYSRC,REH00151
     C                     MOVE WBCDP     ZCDPO            **
     C                     MOVE WBMDIN    ZMDINT           **
     C                     Z-ADDCINW      ZAMTCI           **
      *                                                                                       CDL081
      ** Set withholding tax conversion flag                                                  CDL081
      *                                                                                       CDL081
     C                     MOVE 'Y'       @WHTF   1                                           CDL081
     C*                                                    **
     C                     EXSR #CCYCN                     **
      *                                                                                       CDL081
     C                     MOVE *BLANK    @WHTF                                               CDL081
     C*                                                    **
     C                     Z-ADDZAMTCO    BCINW            **
     C/COPY WNCPYSRC,REH00437
     C*                                                    **
     C                     END                             ** E2
     C           CGL165    IFEQ 'Y'                        ** B2                              CGL165
     C** CALCULATE THE SECONDARY TAX AMOUNT IN BASE CURRENCY         *                        CGL165
     C*                                                    *                                  CGL165
     C           BCCY      IFEQ BACCY                      ** B3                              CGL165
     C                     Z-ADDCINS      BCINS            **                                 CGL165
     C/COPY WNCPYSRC,REH00436                                                                 CGL165
     C*                                                    **                                 CGL165
     C                     ELSE                            ** X3                              CGL165
     C*                                                    **                                 CGL165
     C** CALCULATE THE BCCY EQUIVALENT ONLY IF DIFFERENT CURRENCY                             CGL165
     C*                                                    **                                 CGL165
     C                     MOVE BCCY      ZCCYI            **                                 CGL165
     C                     Z-ADDWOSPOT    ZRATEF           **                                 CGL165
     C                     Z-ADDWOTXCR    ZRATEF                                              CGL165
     C                     MOVE WOCDP     ZCDPI            **                                 CGL165
     C                     MOVE WOMDIN    ZMDINF           **                                 CGL165
     C                     MOVE BACCY     ZCCYO            **                                 CGL165
     C                     Z-ADDWBTXCR    ZRATET           **                                 CGL165
     C                     MOVE WBCDP     ZCDPO            **                                 CGL165
     C                     MOVE WBMDIN    ZMDINT           **                                 CGL165
     C                     Z-ADDCINS      ZAMTCI           **                                 CGL165
      *                                                                                       CGL165
      ** Set withholding tax conversion flag                                                  CGL165
      *                                                                                       CGL165
     C                     MOVE 'Y'       @WHTF   1                                           CGL165
     C*                                                    **                                 CGL165
     C                     EXSR #CCYCN                     **                                 CGL165
      *                                                                                       CGL165
     C                     MOVE *BLANK    @WHTF                                               CGL165
     C*                                                    **                                 CGL165
     C                     Z-ADDZAMTCO    BCINS            **                                 CGL165
     C*                                                    **                                 CGL165
     C                     END                             ** E3                              CGL165
     C                     END                             ** E2                              CGL165
      *                                                                                       CGL165
      * If A/C Currency is Local Currency set Local Amount = A/C CCY                          CGL165
      * Amount,                                                                               CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C           BCCY      ANDEQBJLCCY                                                        CGL165
     C                     Z-ADDCINW      LCINW                                               CGL165
     C                     Z-ADDCINS      LCINS                                               CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CGL165
      * If CGL165 is On, also need the Tax Amounts in Local Currency                          CGL165
      * if Account CCY <> Local CCY                                                           CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C           BCCY      ANDNEBJLCCY                                                        CGL165
      *                                                                                       CGL165
      * If Base Currency is Local Currency set Local Amount = Base                            CGL165
      * Amount, else convert Base Currency Amount to Local Currency                           CGL165
     C           BJLCCY    IFEQ BACCY                                                         CGL165
     C                     Z-ADDBCINW     LCINW                                               CGL165
     C                     Z-ADDBCINS     LCINS                                               CGL165
     C                     ELSE                                                               CGL165
      *                                                                                       CGL165
      * Convert Main Tax                                                                      CGL165
     C                     MOVE BACCY     ZCCYI            **                                 CGL165
     C                     Z-ADDWBTXCR    ZRATEF           **                                 CGL165
     C                     MOVE WBCDP     ZCDPI            **                                 CGL165
     C                     MOVE WBMDIN    ZMDINF           **                                 CGL165
     C                     MOVE BJLCCY    ZCCYO            **                                 CGL165
     C                     Z-ADDWLTXCR    ZRATET           **                                 CGL165
     C                     MOVE WLCDP     ZCDPO            **                                 CGL165
     C                     MOVE WLMDIN    ZMDINT           **                                 CGL165
     C                     Z-ADDBCINW     ZAMTCI           **                                 CGL165
      *                                                                                       CGL165
      ** Set withholding tax conversion flag                                                  CGL165
      *                                                                                       CGL165
     C                     MOVE 'Y'       @WHTF   1                                           CGL165
     C*                                                    **                                 CGL165
     C                     EXSR #CCYCN                     **                                 CGL165
      *                                                                                       CGL165
     C                     MOVE *BLANK    @WHTF                                               CGL165
     C*                                                    **                                 CGL165
     C                     Z-ADDZAMTCO    LCINW            **                                 CGL165
      * Convert Secondary Tax                                                                 CGL165
     C                     MOVE BACCY     ZCCYI            **                                 CGL165
     C                     Z-ADDWBTXCR    ZRATEF           **                                 CGL165
     C                     MOVE WBCDP     ZCDPI            **                                 CGL165
     C                     MOVE WBMDIN    ZMDINF           **                                 CGL165
     C                     MOVE BJLCCY    ZCCYO            **                                 CGL165
     C                     Z-ADDWLTXCR    ZRATET           **                                 CGL165
     C                     MOVE WLCDP     ZCDPO            **                                 CGL165
     C                     MOVE WLMDIN    ZMDINT           **                                 CGL165
     C                     Z-ADDBCINS     ZAMTCI           **                                 CGL165
      *                                                                                       CGL165
      ** Set withholding tax conversion flag                                                  CGL165
      *                                                                                       CGL165
     C                     MOVE 'Y'       @WHTF   1                                           CGL165
     C*                                                    **                                 CGL165
     C                     EXSR #CCYCN                     **                                 CGL165
      *                                                                                       CGL165
     C                     MOVE *BLANK    @WHTF                                               CGL165
     C*                                                    **                                 CGL165
     C                     Z-ADDZAMTCO    LCINS            **                                 CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CGL165
     C*                                                    *
     C** IF BELOW MINIMUM NO TAX TO BE POSTED              *
     C*                                                    *
     C/COPY WNCPYSRC,RE3664CP21                                           S01408
     C*                                                                   S01408
      *                                                                                       CDL013
      ** If CDL013 installed, calculate Minimum WHT to be posted                              CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
     C           ATITAX    ANDNE'0'                                                           CDL013
      *                                                                                       CDL013
      ** Calculate Minimum WHT                                                                CDL013
     C           WMISU     MULT WRATE     WKMISU                                              CDL013
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           BCCY      IFEQ BACCY                                                         CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       WKMISU                                              CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       WKMISU    H                                         CDL013
     C                     ENDIF                                                              CDL081
     C/COPY WNCPYSRC,REH00019
      *                                                                                       CDL013
      ** If CDL013 NOT installed                                                              CDL013
     C                     ELSE                                                               CDL013
     C           WMISU     MULT TXWTRR    WKMISU 150       **
     C           WKMISU    DIV  100       WKMISU    H      **             091906
     C***********WMISU     DIV  100       WKMISU    H      **             091906
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C*                                                    *
     C/COPY WNCPYSRC,RE3664CP22                                           S01408
     C*                                                                   S01408
     C           BCINW     IFLT WKMISU                     **
     C                     Z-ADD*ZERO     BCINW            **
     C                     Z-ADD*ZERO     WTIWT            **
     C                     Z-ADD*ZERO     CINW             **
     C*                                                    **
     C                     END                             ** E2
     C/COPY WNCPYSRC,RE3664C191
     C                     END                             * E1
     C/COPY WNCPYSRC,REH00438
     C/COPY OFCPYSRCZ,CRE105_011                                                              CRE105
     C*
     C** TILL NOW TAX IS TO BE POSTED
     C*
     C********** BCINW     IFGT *ZERO                      * B1           135809
     C********** BCINW     IFGT *ZERO                                               135809R AR978914
     C*                                                    *
     C** CHECK FOR ALTERNATE ACCOUNT                       *
     C*                                                    *
      **If*alt.*a/c*and*CR*interest*for*this*cap.,*transfer*net********************   135809 135809R
      **interest*to*alt.*a/c.******************************************************   135809 135809R
      * If alt. a/c and CR interest for this cap., transfer net                             AR978914
      * interest to alt. a/c.                                                               AR978914
     C           CACP      IFNE *BLANKS                    ** B2
     C********** @CRINT    ANDNE*ZERO                                                 135809 135809R
     C********** @CRINT    SUB  CINW      @CRNET                                      135809 135809R
     C********** @CRNET    IFGT *ZERO                                                 135809 135809R
      **Debit*main*a/c*with*net*interest*******************************************   135809 135809R
     C**********           MOVE BBRCA     BRCA                                        135809 135809R
     C**********           Z-ADDBCNUM     CNUM                                         135809 CSD027
     C**********           MOVE BCNUM     CNUM                                        CSD027 135809R
     C**********           MOVE BCCY      CCY                                         135809 135809R
     C**********           Z-ADDBACOD     ACOD                                        135809 135809R
     C**********           Z-ADDBACSQ     ACSQ                                        135809 135809R
     C**********           MOVE WACNO     ACNO                                        135809 135809R
     C**********           Z-ADDCNCID     VALD                                        135809 135809R
     C**********           Z-ADDCNCID     HISD                                        135809 135809R
     C**********           MOVE '1'       RIND                                        135809 135809R
     C**********           MOVE 'R'       ATYP                                        135809 135809R
     C**********           Z-ADD@CRNET    WPSTA                                       135809 135809R
     C**********           Z-ADD13        #                                           135809 135809R
     C**********           MOVELNAR,#     INPNAR                                      135809 135809R
     C**********           MOVELNR16,#    INP16                                       135809 135809R
     C**********           MOVELDN07,#    INP07                                       135809 135809R
     C**********           MOVELMGD,#     ##MGID                                      135809 135809R
     C**********           EXSR SUBNAR                                                135809 135809R
     C**********           MOVELNARS      PNAR                                        135809 135809R
     C********** BGN0ST    IFEQ 'Y'                                                   135809 135809R
     C**********           MOVE WMPRFC    PRFC                                        135809 135809R
     C**********           END                                                        135809 135809R
     C**********           EXSR GEICPR                                                135809 135809R
     C********** VALD      IFLE NAPDA                                                 135809 135809R
     C********** *IN50     ANDEQ'0'                                                   135809 135809R
     C**********           Z-ADDVALD      HISD                                        135809 135809R
     C**********           Z-ADD141       DBASE                                       135809 135809R
     C**********           MOVE 'N'       REACT                                       135809 135809R
     C**********           WRITEREHPOSPF                                              135809 135809R
     C**********           Z-ADD142       DBASE                                       135809 135809R
     C********** R3KEY     CHAINREHISPDF             40                               135809 135809R
     C********** *IN40     IFEQ '0'                                                   135809 135809R
     C********** DRCR      IFEQ 1                                                     135809 135809R
     C**********           ADD  PSTA      CMVT                                        135809 135809R
     C**********           SUB  PSTA      HISB                                        135809 135809R
     C**********           ELSE                                                       135809 135809R
     C**********           ADD  PSTA      DMVT                                        135809 135809R
     C**********           ADD  PSTA      HISB                                        135809 135809R
     C**********           END                                                        135809 135809R
     C**********           UPDATREHISPDF                                              135809 135809R
      **Save*updated*history*balance***********************************************   135809 135809R
     C**********           Z-ADDHISB      @RHISB                                      135809 135809R
     C**********           Z-ADD*ZERO     DBASE                                       135809 135809R
     C**********           END                                                        135809 135809R
     C**********           END                                                        135809 135809R
     C           @CRINT    ANDNE*ZERO                                                       AR978914
     C           @CRINT    SUB  CINW      @CRNET                                            AR978914
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C           CINS      ANDNE0                                                             CGL165
     C           @CRNET    SUB  CINS      @CRNET                                              CGL165
     C                     ENDIF                                                              CGL165
     C           @CRNET    IFGT *ZERO                                                       AR978914
      * Debit main a/c with net interest                                                    AR978914
     C                     MOVE BBRCA     BRCA                                              AR978914
     C                     MOVE BCNUM     CNUM                                              AR978914
     C                     MOVE BCCY      CCY                                               AR978914
     C                     Z-ADDBACOD     ACOD                                              AR978914
     C                     Z-ADDBACSQ     ACSQ                                              AR978914
     C                     MOVE WACNO     ACNO                                              AR978914
     C                     Z-ADDCNCID     VALD                                              AR978914
     C                     Z-ADDCNCID     HISD                                              AR978914
     C                     MOVE '1'       RIND                                              AR978914
     C                     MOVE 'R'       ATYP                                              AR978914
     C                     Z-ADD@CRNET    WPSTA                                             AR978914
     C                     Z-ADD13        #                                                 AR978914
     C                     MOVELNAR,#     INPNAR                                            AR978914
     C                     MOVELNR16,#    INP16                                             AR978914
     C                     MOVELDN07,#    INP07                                             AR978914
     C                     MOVELMGD,#     ##MGID                                            AR978914
     C                     EXSR SUBNAR                                                      AR978914
     C                     MOVELNARS      PNAR                                              AR978914
     C           BGN0ST    IFEQ 'Y'                                                         AR978914
     C                     MOVE WMPRFC    PRFC                                              AR978914
     C                     END                                                              AR978914
     C                     EXSR GEICPR                                                      AR978914
     C           VALD      IFLE NAPDA                                                       AR978914
     C           *IN50     ANDEQ'0'                                                         AR978914
     C                     Z-ADDVALD      HISD                                              AR978914
     C                     Z-ADD141       DBASE                                             AR978914
     C                     MOVE 'N'       REACT                                             AR978914
     C                     WRITEREHPOSPF                                                    AR978914
     C                     Z-ADD142       DBASE                                             AR978914
     C           R3KEY     CHAINREHISPDF             40                                     AR978914
     C           *IN40     IFEQ '0'                                                         AR978914
     C           DRCR      IFEQ 1                                                           AR978914
     C                     ADD  PSTA      CMVT                                              AR978914
     C                     SUB  PSTA      HISB                                              AR978914
     C                     ELSE                                                             AR978914
     C                     ADD  PSTA      DMVT                                              AR978914
     C                     ADD  PSTA      HISB                                              AR978914
     C                     END                                                              AR978914
     C                     UPDATREHISPDF                                                    AR978914
     C                     MOVE 'Y'       FCOMIT                                            MD022410
      * Save updated history balance                                                        AR978914
     C                     Z-ADDHISB      @RHISB                                            AR978914
     C                     Z-ADD*ZERO     DBASE                                             AR978914
     C                     END                                                              AR978914
     C                     END                                                              AR978914
     C***********          MOVE CACP      WALT             **             101861
     C**********           MOVELCACP      WALT             **      101861 135809
     C**********           MOVELCACP      WALT                                      135809R AR978914
     C*                                                    **
     C***RETAIL*NUMBER*ENTERED******************************************* 135809
     C*                                                    **
     C********** WALT5     IFEQ *BLANKS                    *** B3         135809
     C********** WALT10    CHAINACNUM                99    ***            135809
     C********** WALT5     IFEQ *BLANKS                                             135809R AR978914
     C********** WALT10    CHAINACNUM                99                             135809R AR978914
     C*                                                    ***
     C***ALTERNATE*DOES*NOT*EXIST*OR*IS*CLOSED*DO*NOT*POST*TAX*********** 135809
     C*                                                    ***
     C********** *IN99     IFEQ '1'                        **** B4        135809
     C********** RRRECI    OREQ 'C'                        ****           135809
     C**********           Z-ADD*ZERO     BCINW            ****           135809
     C**********           Z-ADD*ZERO     CINW             ****           135809
     C**********           Z-ADD*ZERO     WTIWT            ****           135809
     C********** *IN99     IFEQ '1'                        **** B4                  135809R AR978914
     C********** RRRECI    OREQ 'C'                        ****                     135809R AR978914
     C**********           Z-ADD*ZERO     BCINW            ****                     135809R AR978914
     C**********           Z-ADD*ZERO     CINW             ****                     135809R AR978914
     C**********           Z-ADD*ZERO     WTIWT            ****                     135809R AR978914
     C*                                                    ****
     C***ALTERNATE*ACCOUNT*IS*LIVE*************************************** 135809
     C*                                                    ****
     C**********           ELSE                            **** X4        135809
     C**********           ELSE                            **** X4                  135809R AR978914
      * Credit the alt. a/c with net interest (a/c already verified)      135809
     C*                                                    ****
     C** SET UP FIELDS TO POST                             ****
     C*                                                    ****
     C**********           Z-ADDRCNUM     CNUM             ****           135809
     C**********           MOVE RCCY      CCY              ****           135809
     C**********           Z-ADD@CCNUM    CNUM             ****                        135809 CSD027
     C**********           MOVE @CCNUM    CNUM             ****                       CSD027 135809R
     C**********           MOVE RCNUM     CNUM             ****                     135809R AR978914
     C**********           MOVE RCCY      CCY              ****                     135809R AR978914
     C                     MOVE @CCNUM    CNUM             ****                             AR978914
     C**********           MOVE @CCCY     CCY              ****                       135809 135809R
     C                     MOVE @CCCY     CCY              ****                             AR978914
     C                     MOVE 'P'       RECI             ****
     C**********           Z-ADDRACOD     ACOD             ****           135809
     C**********           Z-ADDWALT10    ACNO             ****           135809
     C**********           Z-ADDRACOD     ACOD             ****                     135809R AR978914
     C**********           Z-ADDWALT10    ACNO             ****                     135809R AR978914
     C**********           Z-ADD@CACOD    ACOD             ****                       135809 135809R
     C**********           Z-ADD@CACNO    ACNO             ****                       135809 135809R
     C                     Z-ADD@CACOD    ACOD             ****                             AR978914
     C                     Z-ADD@CACNO    ACNO             ****                             AR978914
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C********** @CATYP    IFEQ 'R'                                                   135809 135809R
     C           @CATYP    IFEQ 'R'                                                         AR978914
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*********************EXSR WVALD                      ****     LN0106093582
     C                     MOVE '1'       RIND             ****
     C**********           MOVE 'R'       ATYP             ****           135809
     C**********           MOVE 'R'       ATYP             ****                     135809R AR978914
     C**********           ELSE                                                       135809 135809R
     C**********           Z-ADDRUND      VALD                                        135809 135809R
     C**********           Z-ADDRUND      HISD                                        135809 135809R
     C**********           MOVE '0'       RIND             ****                       135809 135809R
     C**********           END                                                        135809 135809R
     C**********           MOVE @CATYP    ATYP                                        135809 135809R
     C                     ELSE                                                             AR978914
     C                     Z-ADDRUND      VALD                                              AR978914
     C                     Z-ADDRUND      HISD                                              AR978914
     C                     MOVE '0'       RIND             ****                             AR978914
     C                     END                                                              AR978914
     C                     MOVE @CATYP    ATYP                                              AR978914
     C**********           Z-ADDRACSQ     ACSQ             ****           135809
     C**********           MOVE RBRCA     BRCA             ****           135809
     C**********           Z-ADDRACSQ     ACSQ             ****                     135809R AR978914
     C**********           MOVE RBRCA     BRCA             ****                     135809R AR978914
     C**********           Z-ADD@CACSQ    ACSQ             ****                       135809 135809R
     C**********           MOVE @CBRCA    BRCA             ****                       135809 135809R
     C                     Z-ADD@CACSQ    ACSQ             ****                             AR978914
     C                     MOVE @CBRCA    BRCA             ****                             AR978914
      *                                                                   CAC001
      **  If Analytical Accounting installed, get profit centre of        CAC001
      **  the alternate account                                           CAC001
     C********** @CPRFC    IFEQ *BLANKS                                               135809 135809R
     C********** @CACNO    IFNE *ZERO                                                 135809 135809R
     C           @CPRFC    IFEQ *BLANKS                                                     AR978914
     C           @CACNO    IFNE *ZERO                                                       AR978914
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C********** WALT10    CHAINREACNMF              99            CAC001 135809
     C********** WALT10    CHAINREACNMF              99                             135809R AR978914
     C********** @CACNO    CHAINREACNMF              99                               135809 135809R
     C           @CACNO    CHAINREACNMF              99                                     AR978914
     C           *IN99     IFEQ '1'                                       CAC001
     C           *LOCK     IN   LDA                                       CAC001
     C                     MOVEL'REACNMPD'DBFILE           ************   CAC001
     C                     MOVELWALT10    DBKEY            * DBER 202 *   CAC001
     C                     Z-ADD202       DBASE            ************   CAC001
     C                     OUT  LDA                                       CAC001
     C                     EXSR *PSSR                                     CAC001
     C                     ELSE                                           CAC001
     C                     MOVE TPRFC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C**********           END                                                        135809 135809R
     C**********           ELSE                                                       135809 135809R
     C**********           MOVE @CPRFC    PRFC                                        135809 135809R
     C**********           END                                                        135809 135809R
     C**********           MOVELNAR,2     INPNAR                                      135809 135809R
     C**********           MOVELNR16,2    INP16                                       135809 135809R
     C**********           MOVELDN07,2    INP07                                       135809 135809R
     C**********           MOVELMGD,2     ##MGID                                      135809 135809R
     C**********           EXSR SUBNAR                                                135809 135809R
     C**********           MOVELNARS      PNAR                                        135809 135809R
     C**********           Z-SUB@CRNET    WPSTA                                       135809 135809R
     C********** BCCY      IFEQ CCY                                                   135809 135809R
     C********** BBRCA     ANDEQBRCA                                                  135809 135809R
     C**********           EXSR GEICPR                                                135809 135809R
     C********** ATYP      IFEQ 'R'                                                   135809 135809R
     C********** VALD      ANDLENAPDA                                                 135809 135809R
     C********** *IN50     ANDEQ'0'                                                   135809 135809R
     C**********           Z-ADDVALD      HISD                                        135809 135809R
     C**********           Z-ADD143       DBASE                                       135809 135809R
     C**********           MOVE 'N'       REACT                                       135809 135809R
     C**********           WRITEREHPOSPF                                              135809 135809R
     C**********           Z-ADD*ZERO     DBASE                                       135809 135809R
     C**********           EXSR POSPR                                                 135809 135809R
     C**********           END                                                        135809 135809R
     C**********           ELSE                                                       135809 135809R
      **If*alt.*a/c*has*a*different*ccy*and/or*branch*to*the*main*a/c,************    135809 135809R
      **cross*ccy*and/or*interbranch*postings*are*required.***********************    135809 135809R
     C**********           EXSR CCYSR                                                 135809 135809R
     C**********           END                                                        135809 135809R
     C**********           END                                                        135809 135809R
     C**********           END                                                        135809 135809R
     C                     END                                                              AR978914
     C                     ELSE                                                             AR978914
     C                     MOVE @CPRFC    PRFC                                              AR978914
     C                     END                                                              AR978914
     C                     MOVELNAR,2     INPNAR                                            AR978914
     C                     MOVELNR16,2    INP16                                             AR978914
     C                     MOVELDN07,2    INP07                                             AR978914
     C                     MOVELMGD,2     ##MGID                                            AR978914
     C                     EXSR SUBNAR                                                      AR978914
     C                     MOVELNARS      PNAR                                              AR978914
     C                     Z-SUB@CRNET    WPSTA                                             AR978914
     C           BCCY      IFEQ CCY                                                         AR978914
     C           BBRCA     ANDEQBRCA                                                        AR978914
     C                     EXSR GEICPR                                                      AR978914
     C           ATYP      IFEQ 'R'                                                         AR978914
     C           VALD      ANDLENAPDA                                                       AR978914
     C           *IN50     ANDEQ'0'                                                         AR978914
     C                     Z-ADDVALD      HISD                                              AR978914
     C                     Z-ADD143       DBASE                                             AR978914
     C                     MOVE 'N'       REACT                                             AR978914
     C                     WRITEREHPOSPF                                                    AR978914
     C                     Z-ADD*ZERO     DBASE                                             AR978914
     C                     EXSR POSPR                                                       AR978914
     C                     END                                                              AR978914
     C                     ELSE                                                             AR978914
      * If alt. a/c has a different ccy and/or branch to the main a/c,                      AR978914
      * cross ccy and/or interbranch postings are required.                                 AR978914
     C                     EXSR CCYSR                                                       AR978914
     C                     END                                                              AR978914
     C                     END                                                              AR978914
     C                     END                                                              AR978914
     C**********           END                             **** E4        135809
     C**********           END                             **** E4                  135809R AR978914
     C*                                                    ***
     C**********           ELSE                            ***  X3        135809
     C**********           ELSE                            ***  X3                  135809R AR978914
     C*                                                    ***
     C***ACCOUNT*NUMBER*USED*FOR*ALTERNATE******************************* 135809
     C*                                                    ***
     C********** WALTK     CHAINACCNT               N99    ***            135809
     C********** WALTK     CHAINACCNT               N99    ***                      135809R AR978914
     C*                                                    ***
     C***ALTERNATE*DOES*NOT*EXIST*OR*IS*CLOSED*DO*NOT*POST*TAX*********** 135809
     C*                                                    ***
     C********** *IN99     IFEQ '1'                        **** B4        135809
     C********** AARECI    OREQ 'C'                        ****           135809
     C**********           Z-ADD*ZERO     BCINW            ****           135809
     C**********           Z-ADD*ZERO     CINW             ****           135809
     C**********           Z-ADD*ZERO     WTIWT            ****           135809
     C********** *IN99     IFEQ '1'                        **** B4                  135809R AR978914
     C********** AARECI    OREQ 'C'                        ****                     135809R AR978914
     C**********           Z-ADD*ZERO     BCINW            ****                     135809R AR978914
     C**********           Z-ADD*ZERO     CINW             ****                     135809R AR978914
     C**********           Z-ADD*ZERO     WTIWT            ****                     135809R AR978914
     C*                                                    ****
     C***ALTERNATE*ACCOUNT*IS*LIVE*************************************** 135809
     C*                                                    ****
     C**********           ELSE                            **** X4        135809
     C**********           ELSE                            **** X4                  135809R AR978914
     C*                                                    ****
     C***SET*UP*FIELDS*TO*POST******************************************* 135809
     C*                                                    ****
     C**********           Z-ADDAACNUM    CNUM             ****           135809
     C**********           MOVE AACCY     CCY              ****           135809
     C**********           MOVE 'P'       RECI             ****           135809
     C**********           Z-ADDAAACOD    ACOD             ****           135809
     C**********           Z-ADDAAACNO    ACNO             ****           135809
     C**********           MOVE AAATYP    ATYP             ****           135809
     C**********           Z-ADDAAACSQ    ACSQ             ****           135809
     C**********           MOVE ABRCA     BRCA             ****           135809
      ****If*Analytical*Accounting*installed,*get*profit*centre*of CAC001 135809
      ****the*alternate*account*if*it*is*retail*or*nostro********* CAC001 135809
     C********** BGN0ST    IFEQ 'Y'                                CAC001 135809
     C********** ATYP      IFEQ 'R'                                CAC001 135809
     C********** ATYP      OREQ 'N'                                CAC001 135809
     C**********           MOVE AAPRFC    PRFC                     CAC001 135809
     C**********           ENDIF                                   CAC001 135809
     C**********           ENDIF                                   CAC001 135809
     C********** ATYP      IFEQ 'R'                        ***** B5       135809
     C**********           MOVE '1'       RIND             *****          135809
     C**********           Z-ADDAACNUM    CNUM             ****                              135809R
     C**********           MOVE AACNUM    CNUM             ****                      CSD031 AR978914
     C**********           MOVE AACCY     CCY              ****                     135809R AR978914
     C**********           MOVE 'P'       RECI             ****                     135809R AR978914
     C**********           Z-ADDAAACOD    ACOD             ****                     135809R AR978914
     C**********           Z-ADDAAACNO    ACNO             ****                     135809R AR978914
     C**********           MOVE AAATYP    ATYP             ****                     135809R AR978914
     C**********           Z-ADDAAACSQ    ACSQ             ****                     135809R AR978914
     C**********           MOVE ABRCA     BRCA             ****                     135809R AR978914
      ****If*Analytical*Accounting*installed,*get*profit*centre*of*****             135809R AR978914
      ****the*alternate*account*if*it*is*retail*or*nostro**************             135809R AR978914
     C********** BGN0ST    IFEQ 'Y'                                                 135809R AR978914
     C********** ATYP      IFEQ 'R'                                                 135809R AR978914
     C********** ATYP      OREQ 'N'                                                 135809R AR978914
     C**********           MOVE AAPRFC    PRFC                                      135809R AR978914
     C**********           ENDIF                                                    135809R AR978914
     C**********           ENDIF                                                    135809R AR978914
     C********** ATYP      IFEQ 'R'                        ***** B5                 135809R AR978914
     C**********           MOVE '1'       RIND             *****                    135809R AR978914
     C***********          Z-ADDLCID      VALD             ***            060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C**********           Z-ADDCNCID     VALD             ****    060828 135809
     C**********           Z-ADDCNCID     HISD             ****    060828 135809
     C**********           Z-ADDCNCID     VALD                                      135809R AR978914
     C**********           Z-ADDCNCID     HISD                                      135809R AR978914
     C*********************EXSR WVALD                      ****     LN0106093582
     C*                                                    *****
     C***ACCOUNT*IS*NOT*RETAIL******************************************* 135809
     C*                                                    *****
     C**********           ELSE                            ***** X5       135809
     C**********           ELSE                            ***** X5                 135809R AR978914
     C*                                                    *****
     C**********           Z-ADD*ZEROS    ACNO             *****          135809
     C**********           MOVE *ZERO     RIND             *****          135809
     C**********           Z-ADDRUND      VALD             *****          135809
     C**********           Z-ADDRUND      HISD             *****          135809
     C**********           END                             ***** E5       135809
     C**********           END                             **** E4        135809
     C**********           END                             *** E3         135809
     C**********           Z-ADD*ZEROS    ACNO             *****                    135809R AR978914
     C**********           MOVE *ZERO     RIND             *****                    135809R AR978914
     C**********           Z-ADDRUND      VALD             *****                    135809R AR978914
     C**********           Z-ADDRUND      HISD             *****                    135809R AR978914
     C**********           END                             ***** E5                 135809R AR978914
     C**********           END                             **** E4                  135809R AR978914
     C**********           END                             *** E3                   135809R AR978914
     C***INITIALIZE*ACCOUNT*AMOUNT*TO*BE*POSTED************************** 135809
     C********** BCINW     IFGT 0                          *** B3         135809
     C********** CCY       IFEQ BCCY                       *** B4         135809
     C**********           Z-ADDCINW      WPSTA            ***            135809
     C**********           MOVE WOTACC    WTACC            ***            135809
     C**********           MOVE WOTACT    WATYP            ***            135809
     C**********           ELSE                            *** X4         135809
     C********** CCY       IFEQ BACCY                      **** B5        135809
     C**********           Z-ADDBCINW     WPSTA            ****           135809
     C**********           MOVE WBTACC    WTACC            ****           135809
     C**********           MOVE WBTACT    WATYP            ****           135809
     C**********           ELSE                            **** X5        135809
     C********** BCINW     IFGT 0                          *** B3                   135809R AR978914
     C********** CCY       IFEQ BCCY                       *** B4                   135809R AR978914
     C**********           Z-ADDCINW      WPSTA            ***                      135809R AR978914
     C**********           MOVE WOTACC    WTACC            ***                      135809R AR978914
     C**********           MOVE WOTACT    WATYP            ***                      135809R AR978914
     C**********           ELSE                            *** X4                   135809R AR978914
     C********** CCY       IFEQ BACCY                      **** B5                  135809R AR978914
     C**********           Z-ADDBCINW     WPSTA            ****                     135809R AR978914
     C**********           MOVE WBTACC    WTACC            ****                     135809R AR978914
     C**********           MOVE WBTACT    WATYP            ****                     135809R AR978914
     C**********           ELSE                            **** X5                  135809R AR978914
     C*                                                    ****
     C***CHECK*IF*ALTERNATE*CURRENCY*EXIST******************************* 135809
     C*                                                    ****
     C**********           CALL 'AOCURRR0'                                135809
     C**********           PARM '*MSG   ' @RTCD                           135809
     C**********           PARM '*KEY   ' @OPTN                           135809
     C**********           PARM CCY       @CYCD   3                       135809
     C********** SDCURR    PARM SDCURR    DSSDY                           135809
     C********** @RTCD     IFNE *BLANK                                    135809
     C********** *LOCK     IN   LDA                                       135809
     C**********           MOVEL'SDCURRPD'DBFILE           ***************135809
     C***********          MOVEL@CYCD     DBKEY            * DB ERROR 12 *CRE002
     C***********          Z-ADD012       DBASE            ***************CRE002
     C**********           MOVEL@CYCD     DBKEY     * DB ERROR 113*CRE002 135809
     C**********           Z-ADD113       DBASE     ***************CRE002 135809
     C**********           OUT  LDA                                       135809
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                     135809
     C**********           END                                            135809
     C**********           CALL 'AOCURRR0'                                          135809R AR978914
     C**********           PARM '*MSG   ' @RTCD                                     135809R AR978914
     C**********           PARM '*KEY   ' @OPTN                                     135809R AR978914
     C**********           PARM CCY       @CYCD   3                                 135809R AR978914
     C********** SDCURR    PARM SDCURR    DSSDY                                     135809R AR978914
     C********** @RTCD     IFNE *BLANK                                              135809R AR978914
     C********** *LOCK     IN   LDA                                                 135809R AR978914
     C**********           MOVEL'SDCURRPD'DBFILE           **************           135809R AR978914
     C**********           MOVEL@CYCD     DBKEY            *DB ERROR 113*           135809R AR978914
     C**********           Z-ADD113       DBASE            **************           135809R AR978914
     C**********           OUT  LDA                                                 135809R AR978914
     C**********           EXSR *PSSR                                               135809R AR978914
     C**********           END                                                      135809R AR978914
     C*                                                    ****
     C***SAVE*PARM*FOR*CROSS*CURRENCY************************************ 135809
     C*                                                    ****
     C**********           Z-ADDCDP       WACDP            ****           135809
     C**********           Z-ADDSPOT      WASPOT           ****           135809
     C**********           MOVE MDIN      WAMDIN           ****           135809
     C**********           MOVE TACC      WATACC           ****           135809
     C**********           Z-ADDCDP       WACDP            ****                     135809R AR978914
     C**********           Z-ADDSPOT      WASPOT           ****                     135809R AR978914
     C/COPY WNCPYSRC,REH00149
     C**********           MOVE MDIN      WAMDIN           ****                     135809R AR978914
     C**********           MOVE TACC      WATACC           ****                     135809R AR978914
     C*                                                    ****
     C***ACCESS*ACCOUNT*CODES******************************************** 135809
     C*                                                    ****
     C**********           MOVELWATACC    KACOD            ****           135809
     C**********           CALL 'AOACODR0'                                135809
     C**********           PARM '*MSG   ' @RTCD                           135809
     C**********           PARM '*KEY   ' @OPTN                           135809
     C**********           PARM KACOD     @ACCD   4                       135809
     C********** SDACOD    PARM SDACOD    DSFDY                           135809
     C********** @RTCD     IFNE *BLANK                                    135809
     C********** *LOCK     IN   LDA                                       135809
     C**********           MOVEL'SDACODPD'DBFILE           ***************135809
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 78 *CRE002
     C***********          Z-ADD078       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY     * DB ERROR 114*CRE002 135809
     C**********           Z-ADD114       DBASE     ***************CRE002 135809
     C**********           OUT  LDA                                       135809
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                     135809
     C**********           END                                            135809
     C**********           MOVELWATACC    KACOD            ****                     135809R AR978914
     C**********           CALL 'AOACODR0'                                          135809R AR978914
     C**********           PARM '*MSG   ' @RTCD                                     135809R AR978914
     C**********           PARM '*KEY   ' @OPTN                                     135809R AR978914
     C**********           PARM KACOD     @ACCD  10                                 135809R AR978914
     C********** SDACOD    PARM SDACOD    DSFDY                                     135809R AR978914
     C********** @RTCD     IFNE *BLANK                                              135809R AR978914
     C********** *LOCK     IN   LDA                                                 135809R AR978914
     C**********           MOVEL'SDACODPD'DBFILE           ***************          135809R AR978914
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 114*          135809R AR978914
     C**********           Z-ADD114       DBASE            ***************          135809R AR978914
     C**********           OUT  LDA                                                 135809R AR978914
     C**********           EXSR *PSSR                                               135809R AR978914
     C**********           END                                                      135809R AR978914
     C*                                                    ****
     C**********           MOVE A5ACTY    WATACT           ****           135809
     C**********           MOVE A5ACTY    WATACT           ****                     135809R AR978914
     C*                                                    ****
     C*                                                    ****
     C***CALCULATE*THE*BCCY*EQUIVALENT*ONLY*IF*DIFFERENT*CURRENCY******** 135809
     C*                                                    ****
     C**********           MOVE BCCY      ZCCYI            ****           135809
     C**********           Z-ADDWOSPOT    ZRATEF           ****           135809
     C**********           MOVE WOCDP     ZCDPI            ****           135809
     C**********           MOVE WOMDIN    ZMDINF           ****           135809
     C**********           MOVE CCY       ZCCYO            ****           135809
     C**********           Z-ADDWASPOT    ZRATET           ****           135809
     C**********           MOVE WACDP     ZCDPO            ****           135809
     C**********           MOVE WAMDIN    ZMDINT           ****           135809
     C**********           Z-ADDCINW      ZAMTCI           ****           135809
     C**********           MOVE BCCY      ZCCYI            ****                     135809R AR978914
     C**********           Z-ADDWOSPOT    ZRATEF           ****                     135809R AR978914
     C**********           MOVE WOCDP     ZCDPI            ****                     135809R AR978914
     C**********           MOVE WOMDIN    ZMDINF           ****                     135809R AR978914
     C**********           MOVE CCY       ZCCYO            ****                     135809R AR978914
     C**********           Z-ADDWASPOT    ZRATET           ****                     135809R AR978914
     C**********           MOVE WACDP     ZCDPO            ****                     135809R AR978914
     C**********           MOVE WAMDIN    ZMDINT           ****                     135809R AR978914
     C**********           Z-ADDCINW      ZAMTCI           ****                     135809R AR978914
      *                                                                                       CDL081
      ** Set withholding tax conversion flag                                                  CDL081
      *                                                                                       CDL081
     C                     MOVE 'Y'       @WHTF                                               CDL081
     C*                                                    ****
     C**********           EXSR #CCYCN                     ****           135809
     C**********           EXSR #CCYCN                     ****                     135809R AR978914
      *                                                                                       CDL081
     C                     MOVE *BLANK    @WHTF                                               CDL081
     C*                                                    ****
     C**********           Z-ADDZAMTCO    WPSTA            ****           135809
     C**********           MOVE WATACC    WTACC            ****           135809
     C**********           MOVE WATACT    WATYP            ****           135809
     C**********           Z-ADDZAMTCO    WPSTA            ****                     135809R AR978914
     C**********           MOVE WATACC    WTACC            ****                     135809R AR978914
     C**********           MOVE WATACT    WATYP            ****                     135809R AR978914
     C*                                                    ****
     C**********           END                             **** E5        135809
     C**********           END                             *** E4         135809
     C**********           END                             *** E3         135809
     C**********           END                             **** E5                  135809R AR978914
     C**********           END                             *** E4                   135809R AR978914
     C**********           END                             *** E3                   135809R AR978914
     C*                                                    **
     C***PROCESS*FOR*MULTIBRANCH***************************************** 135809
     C*                                                    **
     C********** BBRCA     IFEQ BRCA                       *** B3         135809
     C**********           MOVE BBICN     WBICN            ***            135809
     C**********           ELSE                            *** X3         135809
     C********** BBRCA     IFEQ BRCA                       *** B3                   135809R AR978914
     C**********           MOVE BBICN     WBICN            ***                      135809R AR978914
     C**********           ELSE                            *** X3                   135809R AR978914
     C*                                                    ***
     C***ACCESS*BRANCH*CODES********************************************* 135809
     C**********           CALL 'AOBRCHR0'                                135809
     C**********           PARM '*MSG   ' @RTCD                           135809
     C**********           PARM '*KEY   ' @OPTN                           135809
     C**********           PARM BRCA      @BRCA   3                       135809
     C********** SDBRCH    PARM SDBRCH    DSFDY                           135809
     C********** @RTCD     IFNE *BLANK                                    135809
     C********** *LOCK     IN   LDA                                       135809
     C**********           MOVEL'SDBRCHPD'DBFILE           ***************135809
     C***********          MOVEL@BRCA     DBKEY            * DB ERROR 25 *CRE002
     C***********          Z-ADD25        DBASE            ***************CRE002
     C**********           MOVEL@BRCA     DBKEY     * DB ERROR 115*CRE002 135809
     C**********           Z-ADD115       DBASE     ***************CRE002 135809
     C**********           OUT  LDA                                       135809
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                     135809
     C**********           END                                            135809
     C**********           CALL 'AOBRCHR0'                                          135809R AR978914
     C**********           PARM '*MSG   ' @RTCD                                     135809R AR978914
     C**********           PARM '*KEY   ' @OPTN                                     135809R AR978914
     C**********           PARM BRCA      @BRCA   3                                 135809R AR978914
     C********** SDBRCH    PARM SDBRCH    DSFDY                                     135809R AR978914
     C********** @RTCD     IFNE *BLANK                                              135809R AR978914
     C********** *LOCK     IN   LDA                                                 135809R AR978914
     C**********           MOVEL'SDBRCHPD'DBFILE           ***************          135809R AR978914
     C**********           MOVEL@BRCA     DBKEY            * DB ERROR 115*          135809R AR978914
     C**********           Z-ADD115       DBASE            ***************          135809R AR978914
     C**********           OUT  LDA                                                 135809R AR978914
     C**********           EXSR *PSSR                                               135809R AR978914
     C**********           END                                                      135809R AR978914
     C*                                                    ***
     C**********           MOVE BICN      WBICN            ***            135809
     C**********           MOVE BICN      WBICN            ***                      135809R AR978914
     C*                                                    ***
     C**********           END                             *** E3         135809
     C**********           ELSE                            ** X2          135809
     C**********           END                             *** E3                   135809R AR978914
     C**********           ELSE                            ** X2                    135809R AR978914
     C*                                                    **
     C***NO*ALTERNATE*ACCOUNT*USED*************************************** 135809
      * Withholding tax is always posted to the main a/c                  135809
     C********** CINW      IFGT *ZERO                                                 135809 135809R
     C********** BGN0ST    IFEQ 'Y'                                                   135809 135809R
     C**********           MOVE WMPRFC    PRFC                                        135809 135809R
     C**********           END                                                               135809R
     C           CINW      IFGT *ZERO                                                       AR978914
     C           BGN0ST    IFEQ 'Y'                                                         AR978914
     C                     MOVE WMPRFC    PRFC                                              AR978914
     C                     END                                                              AR978914
     C*                                                    **
     C** SET UP FIELDS TO POST                             **
     C*                                                    **
     C**********           Z-ADDBCNUM     CNUM             **                                 CSD027
     C                     MOVE BCNUM     CNUM             **                                 CSD027
     C                     MOVE BCCY      CCY              **
     C                     MOVE 'P'       RECI             **
     C                     Z-ADDBACOD     ACOD             **
     C                     MOVE WACNO     ACNO             **
     C                     MOVE 'R'       ATYP             **
     C                     Z-ADDBACSQ     ACSQ             **
     C                     MOVE BBRCA     BRCA             **
     C                     MOVE '1'       RIND             **
     C*********************Z-ADDLCID      VALD             ****           060828
     C*********************Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*********************EXSR WVALD                      ****     LN0106093582
     C                     Z-ADDCINW      WPSTA            **
     C                     MOVE WOTACC    WTACC            **
     C                     MOVE WOTACT    WATYP            **
     C                     MOVE BBICN     WBICN            **
     C*                                                    **
     C                     END                             ** E2
     C**********           END                             * E1           135809
     C**********           END                             * E1                     135809R AR978914
     C/COPY WNCPYSRC,REH00439
     C*
     C* IF STILL AMOUNT TO BE POSTED PROCESS OUTPUT.
     C*
     C           BCINW     IFGT *ZERO
     C/COPY WNCPYSRC,REH00440
     C*
     C                     MOVELNAR,5     INPNAR
     C                     MOVELNR16,5    INP16
     C                     MOVELDN07,5    INP07
     C                     MOVELMGD,5     ##MGID                          S01522
     C/COPY WNCPYSRC,RE3664C152
     C*
     C*
     C                     EXSR SUBNAR
     C                     MOVELNARS      PNAR
     C/COPY WNCPYSRC,RE3664C177
     C                     MOVE 'W'       WSTAX   1                                           CGL165
     C                     EXSR OUTTAX
     C                     MOVE ' '       WSTAX   1                                           CGL165
     C                     END
      *                                                                                       CGL165
      * If Secondary Tax <> 0 then call OUTTAX to generate all postings                       CGL165
      * separately for the Secondary Tax Amount                                               CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C           BCINS     ANDNE0                                                             CGL165
      *                                                                                       CGL165
     C                     MOVE BCNUM     CNUM             **                                 CGL165
     C                     MOVE BCCY      CCY              **                                 CGL165
     C                     MOVE 'P'       RECI             **                                 CGL165
     C                     Z-ADDBACOD     ACOD             **                                 CGL165
     C                     MOVE WACNO     ACNO             **                                 CGL165
     C                     MOVE 'R'       ATYP             **                                 CGL165
     C                     Z-ADDBACSQ     ACSQ             **                                 CGL165
     C                     MOVE BBRCA     BRCA             **                                 CGL165
     C                     MOVE '1'       RIND             **                                 CGL165
     C                     Z-ADDCNCID     VALD             ****                               CGL165
     C                     Z-ADDCNCID     HISD             ****                               CGL165
     C                     Z-ADDCINS      WPSTA            **                                 CGL165
     C                     MOVE WOTACC    WTACC            **                                 CGL165
     C                     MOVE WOTACT    WATYP            **                                 CGL165
     C                     MOVE BBICN     WBICN            **                                 CGL165
     C                     Z-ADDCINS      CINW                                                CGL165
     C                     Z-ADDBCINS     BCINW                                               CGL165
     C                     Z-ADDLCINS     LCINW                                               CGL165
      *                                                                                       CGL165
     C                     MOVE 'S'       WSTAX   1                                           CGL165
     C                     MOVELNAR,5     INPNAR                                              CGL165
     C                     MOVELNR16,5    INP16                                               CGL165
     C                     MOVELDN07,5    INP07                                               CGL165
     C                     MOVELMGD,5     ##MGID                                              CGL165
     C                     EXSR SUBNAR                                                        CGL165
     C                     MOVELNARS      PNAR                                                CGL165
     C                     EXSR OUTTAX                                                        CGL165
     C                     MOVE ' '       WSTAX   1                                           CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CGL165
      * Restore history balance                                           135809
     C**********           Z-ADD@RHISB    HISB                                        135809 135809R
     C                     Z-ADD@RHISB    HISB                                              AR978914
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C*******************************************************************
     C*
     C** OUTTAX subroutine to post witholding taxes
     C*
     C**     Called by       - TOTTAX
     C**     Calls           -
     C*
      *****************************************************************   CCB003
     C           OUTTAX    BEGSR
     C*
     C** IF SAME CURRENCY ONLY TWO POSTINGS
     C** IF NOT USE TRADE ACCOUNT AND TRADE EQUIVALENT ACCOUNT CODE
     C*
     C** FIRST POST TO ACCOUNT ON DEBIT SIDE
     C*
     C/COPY WNCPYSRC,RE3664C015
     C*                                                                   218393
     C                     MOVE 'WTAX'    OTST                            218393
     C*                                                                   218393
     C/COPY WNCPYSRC,REH00450
     C                     EXSR GEICPR
     C/COPY WNCPYSRC,REH00451
     C*                                                                   218393
     C                     MOVEL*BLANK    OTST                            218393
     C*
     C           ATYP      IFEQ 'R'
     C           VALD      ANDLENAPDA                      - B1
     C/COPY WNCPYSRC,RE3664C071
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD116       DBASE            * DB ERROR 116*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C/COPY WNCPYSRC,RE3664C178
     C                     Z-ADD*ZEROS    DBASE
     C********** CACP      IFEQ *BLANKS                                   135809
     C********** CACP      IFEQ *BLANKS                                             135809R AR978914
     C*
     C** ACCESS POSITION RECORD FOR UPDATE OR ADD THEN UPDATE HEADER FIELD
     C*
     C***********          Z-ADD88        DBASE                           CRE002
     C                     Z-ADD117       DBASE            * DB ERROR 117*CRE002
     C           R3KEY     CHAINREHISPDF             40
     C                     Z-ADD*ZEROS    DBASE
     C           *IN40     IFEQ '1'                        - B1
     C                     MOVE 'D'       RECI
     C                     MOVE *BLANK    DLGID
     C                     Z-ADD*ZERO     VALL
     C                     MOVE *BLANKS   LINK
     C                     MOVE *BLANK    DICI
     C                     MOVE *BLANK    CICI
     C                     MOVE *BLANK    DRCI
     C                     MOVE *BLANK    CRCI
     C                     MOVE *BLANK    ALTI
     C                     Z-ADD*ZERO     DRIR
     C                     Z-ADD*ZERO     CRIR
     C                     Z-ADD*ZERO     PDID
     C                     Z-ADD*ZERO     PCID
     C                     Z-ADD*ZERO     DICT
     C                     Z-ADD*ZERO     CICT
     C                     Z-ADD*ZERO     DRCB
     C                     Z-ADD*ZERO     CRCB
     C                     MOVE *BLANK    ADTY
     C                     Z-ADD*ZERO     MNBL
     C                     Z-ADD*ZERO     CHGAR
     C                     Z-ADD*ZERO     TCHGAR
     C                     Z-ADD*ZERO     CHGAN
     C                     Z-ADD*ZERO     TCHGAN
     C                     Z-ADD*ZERO     DMVT
     C                     Z-ADD*ZERO     CMVT
     C                     Z-ADD*ZERO     DAID
     C                     Z-ADD*ZERO     MADI
     C                     Z-ADD*ZERO     TMADI
     C                     Z-ADD*ZERO     DMINT
     C                     Z-ADD*ZERO     CAID
     C                     Z-ADD*ZERO     MACI
     C                     Z-ADD*ZERO     TMACI
     C                     Z-ADD*ZERO     CMINT
     C                     Z-ADD*ZERO     MNBCP
     C                     Z-ADD*ZERO     DRCD
     C                     Z-ADD*ZERO     CRCD
     C                     Z-ADD*ZERO     VDTC
     C           DRCR      IFEQ 1                          - B2
     C                     Z-ADDPSTA      CMVT
     C                     ELSE                            - X2
     C                     Z-ADDPSTA      DMVT
     C                     END                             - E2
     C           SHISB     ADD  DMVT      HISB
     C                     SUB  CMVT      HISB
     C                     Z-ADD*ZERO     AODR                            CRE002
     C                     Z-ADD*ZERO     ODRL                            CRE002
     C                     MOVE *BLANK    ODLI                            CRE002
     C                     Z-ADD*ZERO     ODIA                            CRE002
     C***********          Z-ADD87        DBASE                           CRE002
     C                     Z-ADD118       DBASE            * DB ERROR 118*CRE002
     C                     WRITEREHISPDF
     C                     Z-ADD*ZEROS    DBASE
     C                     ELSE                            - X1
     C           DRCR      IFEQ 1                          - B2
     C                     ADD  PSTA      CMVT
     C                     SUB  PSTA      HISB                            048430
     C                     ELSE                            - X2
     C                     ADD  PSTA      DMVT
     C                     ADD  PSTA      HISB                            048430
     C                     END                             - E2
     C***********          Z-ADD86        DBASE                           CRE002
     C                     Z-ADD119       DBASE            * DB ERROR 119*CRE002
     C                     UPDATREHISPDF
     C                     MOVE 'Y'       FCOMIT                                            MD022410
     C                     Z-ADD*ZEROS    DBASE
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3664C168
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C                     MOVE 'Y'       BADTY
     C           SHISD     IFLT BVDTC
     C                     MOVE SHISD     BVDTC
     C                     END
      * Save updated history balance                                      135809
     C/COPY WNCPYSRC,REH00452
     C**********           Z-ADDHISB      @RHISB                                      135809 135809R
     C                     Z-ADDHISB      @RHISB                                            AR978914
     C/COPY WNCPYSRC,REH00453
     C**********           ELSE                                           135809
     C***UPDATE*POSITION*RECORD*FOR*ALTERNATE*ACCOUNT*PROCESSING********* 135809
     C**********           EXSR POSPR                                     135809
     C**********           END                             - E1           135809
     C**********           ELSE                                                     135809R AR978914
     C**********           EXSR POSPR                                               135809R AR978914
     C**********           END                             - E1                     135809R AR978914
     C*
     C                     END                             - E1
     C/COPY WNCPYSRC,REH00454
     C*
     C                     MOVE WBICN     CNUM
     C/COPY WNCPYSRC,RE3664C121
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,RE3664C122
     C                     Z-SUBWPSTA     WPSTA
     C                     EXSR SUBNAR
     C                     MOVELNARS      PNAR                            B8200
     C*
     C           CCY       IFNE BACCY                      - B1
     C           CGL165    ANDNE'Y'                                                           CGL165
     C           CCY       ORNE BJLCCY                                                        CGL165
     C           CGL165    ANDEQ'Y'                                                           CGL165
     C/COPY WNCPYSRC,RE3664C016
      *                                                                   CAC001
      **  Check if profit centre can hold FX Position                     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE PRFC      WSVPC   4                       CAC001
     C                     EXSR SRPRFC                                    CAC001
     C                     ENDIF                                          CAC001
     C*
     C** POST TO SPOT TRADE ACCOUNT IN ACCOUNT CURRENCY CREDIT SIDE
     C*
      *                                                                                       239314
      ** Do not generate posting for Spot Trade Account of Base CCY                           239314
      ** if there is no Base CCY Spot Trade Account Equivalent                                239314
      *                                                                                       239314
     C           WBTACC    IFNE *BLANKS                                                       239314
     C                     MOVE SPAC      ACOD
     C                     MOVE WSPACT    ATYP
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C                     MOVE '1'       RIND             *****
     C                     Z-ADDLCID      VALD             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*********************Z-ADDLCID      HISD             *****          093582
     C*********************EXSR WVALD                      *****    LN0106093582
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X2
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO             *****
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E2
     C*
     C                     EXSR GEICPR
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C072
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD120       DBASE            * DB ERROR 120*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C/COPY WNCPYSRC,RE3664C179
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
     C                     END                                                                239314
     C*
     C** POST TO SPOT TRADE ACCOUNT IN BASE CURRENCY DEBIT SIDE
     C*
     C                     Z-ADDBCINW     WPSTA
     C                     MOVELCCY       WWCCY   3
     C                     MOVELBACCY     CCY
      *                                                                                       CGL165
      * If CGL165 is On, this posting should be to the Spot Trade                             CGL165
      * Account in Local Currency and using the amount converted                              CGL165
      * to Local Currency so replace values                                                   CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     Z-ADDLCINW     WPSTA                                               CGL165
     C                     MOVELBJLCCY    CCY                                                 CGL165
     C                     ENDIF                                                              CGL165
     C*
     C                     EXSR GEICPR
     C                     MOVELWWCCY     CCY
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C073
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD121       DBASE            * DB ERROR 121*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C/COPY WNCPYSRC,RE3664C180
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
     C*
     C** POST TO SPOT TRADE EQUIVALENT OF ACCOUNT CURRENCY DEBIT SIDE
     C*
      * If CGL165 is on,then restore Tax amount in Base Currency                              CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     Z-ADDBCINW     WPSTA                                               CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CGL165
     C                     MOVE WTACC     ACOD
     C                     MOVE WATYP     ATYP
     C                     MOVELCCY       WWCCY
     C                     MOVELBACCY     CCY
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C                     MOVE '1'       RIND             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*********************EXSR WVALD                      *****    LN0106093582
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X2
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO             *****
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E2
     C*
     C                     EXSR GEICPR
     C                     MOVELWWCCY     CCY
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C074
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD122       DBASE            * DB ERROR 122*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C/COPY WNCPYSRC,RE3664C181
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
     C*
     C** POST TO SPOT TRADE EQUIVALENT OF BASE CURRENCY CREDIT SIDE
     C*
      *                                                                                       239314
      ** Do not generate posting for Spot Trade Equivalent of Base CCY                        239314
      ** if there is no Base CCY Spot Trade Account Equivalent                                239314
      *                                                                                       239314
     C           WBTACC    IFNE *BLANKS                                                       239314
     C                     MOVE WBTACC    ACOD
     C                     MOVE WBTACT    ATYP
     C                     Z-SUBWPSTA     WPSTA
     C                     MOVELCCY       WWCCY
     C                     MOVELBACCY     CCY
     C*
      * If CGL165 is On, this posting should be to the Spot Trade                             CGL165
      * Equivalent of Local Currency so replace values                                        CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
     C                     MOVE WLTACC    ACOD                                                CGL165
     C                     MOVE WLTACT    ATYP                                                CGL165
     C                     Z-SUBBCINW     WPSTA                                               CGL165
     C                     ENDIF                                                              CGL165
     C/COPY WNCPYSRC,RE3664CP23                                           S01408
     C*                                                                   S01408
     C           ATYP      IFEQ 'R'                        ***** B2
     C                     MOVE '1'       RIND             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*********************EXSR WVALD                      *****    LN0106093582
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X2
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO             *****
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E2
     C*
     C                     EXSR GEICPR
     C                     END                                                                239314
     C                     MOVELWWCCY     CCY
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C075
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD123       DBASE            * DB ERROR 123*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C/COPY WNCPYSRC,RE3664C182
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
      *                                                                   CAC001
      **  Restore saved profit centre                                     CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE WSVPC     PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C                     END                             - E1
     C*
     C** POST TO WITHOLDING TAX ACCOUNT IN BASE CURRENCY CREDIT SIDE
     C*
     C/COPY WNCPYSRC,RE3664C134
     C                     MOVE WWTAC     ACOD
     C                     MOVE WTWTAC    ATYP
     C                     MOVELCCY       WWCCY
     C/COPY WNCPYSRC,REH00455
     C                     MOVELBACCY     CCY
     C/COPY WNCPYSRC,RE3664C017
      * If CGL165 is On, set up correct internal tax account to post tax to                   CGL165
     C           CGL165    IFEQ 'Y'                                                           CGL165
      *                                                                                       CGL165
     C           WSTAX     IFEQ 'W'                                                           CGL165
     C           ATTXC1    CHAINSDWTRCL0             99                                       CGL165
     C           *IN99     IFEQ *OFF                                                          CGL165
     C                     MOVELRITAC     ACOD                                                CGL165
     C                     ENDIF                                                              CGL165
     C                     ELSE                                                               CGL165
     C           ATTXC2    CHAINSDWTRCL0             99                                       CGL165
     C           *IN99     IFEQ *OFF                                                          CGL165
     C                     MOVELRITAC     ACOD                                                CGL165
     C                     ENDIF                                                              CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CGL165
      * Replace amount with Local Currency Amount and Currency with Local                     CGL165
      * Currency                                                                              CGL165
     C                     Z-SUBLCINW     WPSTA                                               CGL165
     C                     MOVELCCY       WWCCY                                               CGL165
     C                     MOVELBJLCCY    CCY                                                 CGL165
     C                     ENDIF                                                              CGL165
      *                                                                                       CDL013
      ** If CDL013 installed, check the Acc Type & update WHT Acc Code                        CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
     C           BBCSTY    IFEQ 'R'                                                           CDL013
     C                     MOVE WRETAC    ACOD                                                CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C           BBCSTY    IFEQ 'C'                                                           CDL013
     C                     MOVE WCOTAC    ACOD                                                CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C*
     C           ATYP      IFEQ 'R'                        ***** B1
     C                     MOVE '1'       RIND             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*********************EXSR WVALD                      ****           106604
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X1
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO             *****
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E1
     C*
     C                     EXSR GEICPR
     C/COPY WNCPYSRC,REH00020
     C                     MOVELWWCCY     CCY
     C*
     C           ATYP      IFEQ 'R'                        ***** B1
     C*
     C           VALD      IFLE NAPDA                      - B2
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C076
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD124       DBASE            * DB ERROR 124*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C/COPY WNCPYSRC,REH00021
     C                     WRITEREHPOSPF
     C/COPY WNCPYSRC,RE3664C183
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E2
     C                     END                             - E1
      *                                                                                       CDL013
      ** If CDL013 installed, update WHT files                                                CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
      ** Set the key fields for WHT by Customer history file                                  CDL013
     C                     MOVE BCNUM     ECUST                                               CDL013
     C                     Z-ADDAAACNO    EDLAC                                               CDL013
     C                     MOVE 'R'       EDAIN                                               CDL013
      *                                                                                       CDL013
      ** Access WHT by Customer history file                                                  CDL013
     C           HISKEY    CHAINGLWHTCL0             40                                       CDL013
      *                                                                                       CDL013
      ** If record NOT found                                                                  CDL013
     C           *IN40     IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
      ** Set up the fields to write a new record                                              CDL013
     C                     MOVE BBRCA     EBRCA                                               CDL013
     C                     MOVE BCCY      ECURR                                               CDL013
     C                     Z-ADDWTIWT     ECRTM                                               CDL013
     C                     Z-ADDCINW      EWTTM                                               CDL013
     C                     Z-ADDWTIWT     ECRYD                                               CDL013
     C                     Z-ADDCINW      EWTYD                                               CDL013
     C                     Z-ADDWTIWT     ECRTO                                               CDL013
     C                     Z-ADDCINW      EWTTO                                               CDL013
     C                     Z-ADDWRATE     EWTRT                                               CDL013
     C/COPY WNCPYSRC,REH00022
      *                                                                                       CDL013
      ** Write a new record                                                                   CDL013
     C                     WRITEGLWHTCD0                                                      CDL013
      *                                                                                       CDL013
      *                                                                                       CDL013
      ** If record found, update Interest & WHT fields                                        CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C                     ADD  WTIWT     ECRTM                                               CDL013
     C                     ADD  CINW      EWTTM                                               CDL013
     C                     ADD  WTIWT     ECRYD                                               CDL013
     C                     ADD  CINW      EWTYD                                               CDL013
     C                     ADD  WTIWT     ECRTO                                               CDL013
     C                     ADD  CINW      EWTTO                                               CDL013
     C/COPY WNCPYSRC,REH00023
      *                                                                                       CDL013
      ** Update the record                                                                    CDL013
     C                     UPDATGLWHTCD0                                                      CDL013
     C                     ENDIF                                                              CDL013
     C/COPY WNCPYSRC,REH00150
      *----------------------------------------------------------------                       CDL013
      *                                                                                       CDL013
      ** If Retail Account for non-base Ccy                                                   CDL013
     C           AAATYP    IFEQ 'R'                                                           CDL013
     C           BCCY      ANDNEBACCY                                                         CDL013
      *                                                                                       CDL013
      ** Set up the fields to write a new record to the                                       CDL013
      ** Dealing/Retail Tax Details extract file                                              CDL013
     C                     MOVE BCNUM     ECUST                                               CDL013
     C                     Z-ADDAAACNO    EDLAC                                               CDL013
     C                     MOVE 'R'       EDAIN                                               CDL013
     C                     MOVE BBRCA     EBRCA                                               CDL013
     C                     MOVE BCCY      ECURR                                               CDL013
     C                     MOVE BACOD     EACCD                                               CDL013
     C                     Z-ADDBACSQ     EACSQ                                               CDL013
     C                     Z-ADDCINW      ETAXA                                               CDL013
     C                     Z-ADDCNCID     EVDAT                                               CDL013
      *                                                                                       CDL013
      ** Write a record                                                                       CDL013
     C                     WRITEGLXTAXD0                                                      CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CP24                                           S01408
     C*                                                                   S01408
     C                     ENDSR
     C*******************************************************************
     C/EJECT                                                              LN0106
     C******************************************************************* LN0106
     C*                                                                   LN0106
     C** WVALD subroutine for Withholding Tax Value date                  LN0106
     C*                                                                   LN0106
     C**     Called by       - TAXPOS, OUTTAX                             LN0106
     C**     Calls           -                                            LN0106
     C*                                                                   LN0106
      *****************************************************************   CCB003
     C           WVALD     BEGSR                                          LN0106
     C*                                                                   LN0106
     C           LDAC      IFNE 'Y'                                       LN0106
     C                     ADD  1         VALD                            LN0106
     C                     ADD  1         HISD                            LN0106
     C                     END                                            LN0106
     C*                                                                   LN0106
     C                     ENDSR                                          LN0106
     C******************************************************************* LN0106
     C/EJECT
     C/COPY WNCPYSRC,REH00441
     C*******************************************************************
     C*
     C** TDISR subroutine to post total debit interest
     C*
     C**     Called by       - TOTTAX
     C**     Calls           -
     C*
      *****************************************************************   CCB003
     C           TDISR     BEGSR
     C*
     C           WDIWT     IFNE 0                          - B1
     C* If Withholding tax account codes are the same then suppress       131825
     C* postings as net amout will be zero to the same account.           131825
     C           WDIPD     ANDNEWDIPC                                     131825
     C*
     C** POST TO DEBIT INTEREST PAYMENT DEBIT ACCOUNT CODE DEBIT SIDE
     C*
     C                     MOVELNAR,6     INPNAR
     C                     MOVELNR16,6    INP16
     C                     MOVELDN07,6    INP07
     C                     MOVELMGD,6     ##MGID                          S01522
     C/COPY WNCPYSRC,RE3664C153
     C*
     C                     Z-ADDWDIWT     WPSTA
     C                     MOVE WDIPD     ACOD
     C                     MOVE WTDIPD    ATYP
     C                     MOVE BBRCA     BRCA
     C                     MOVE BBICN     CNUM
     C/COPY WNCPYSRC,RE3664C123
     C           WINT      IFEQ 'Y'                                                           CRE100
     C                     MOVE BCNUM     CNUM                                                CRE100
     C                     ENDIF                                                              CRE100
     C                     Z-ADD1         ACSQ
      * Account Sequence                                                                    MD034990
     C           RETSEQ    IFEQ 'Y'                                                         MD034990
     C                     MOVE BACSQ     ACSQ                                              MD034990
     C                     ENDIF                                                            MD034990
     C/COPY WNCPYSRC,RE3664C124
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C                     MOVE '1'       RIND             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X2
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E2
     C*
     C                     EXSR SUBNAR
     C                     MOVE NARS      PNAR
     C/COPY WNCPYSRC,RE3664C154
     C           ATYP      IFEQ 'R'                                                           CER049
     C                     MOVE 'DEB INT' ZZ007                                               CER049
     C                     END                                                                CER049
     C                     EXSR GEICPR
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C077
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD125       DBASE            * DB ERROR 125*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
     C*
     C** POST TO DEBIT INTEREST PAYMENT CREDIT ACCOUNT CODE
     C*
     C                     Z-SUBWPSTA     WPSTA
     C                     MOVE WDIPC     ACOD
     C                     MOVE WTDIPC    ATYP
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C                     MOVE '1'       RIND             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X2
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E2
     C*
     C/COPY WNCPYSRC,RE3664C208
     C           ZZ007     IFEQ 'DEB INT'                                                     CER049
     C                     MOVE *BLANKS   ZZ007                                               CER049
     C                     END                                                                CER049
     C                     EXSR GEICPR
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C078
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD126       DBASE            * DB ERROR 126*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C                     ENDSR
     C*******************************************************************
     C/EJECT
     C*******************************************************************
     C*
     C** TCISR subroutine to post total credit interest
     C*
     C**     Called by       - TOTTAC
     C**     Calls           -
     C*
      *****************************************************************   CCB003
     C           TCISR     BEGSR
     C*
     C                     MOVE BBRCA     BRCA
     C                     MOVE BBICN     CNUM
     C/COPY WNCPYSRC,RE3664C125
     C           WINT      IFEQ 'Y'                                                           CRE100
     C                     MOVE BCNUM     CNUM                                                CRE100
     C                     ENDIF                                                              CRE100
     C                     Z-ADD1         ACSQ
      * Account Sequence                                                                    MD034990
     C           RETSEQ    IFEQ 'Y'                                                         MD034990
     C                     MOVE BACSQ     ACSQ                                              MD034990
     C                     ENDIF                                                            MD034990
     C/COPY WNCPYSRC,RE3664C126
     C* If Withholding tax account codes are the same then suppress       131825
     C* postings as net amout will be zero to the same account.           131825
     C           WCIPC     IFNE WCISU                                     131825
     C           WCIPC     ANDNEWCINS                                     131825
     C*
     C           WCIWT     IFNE 0                          - B1
     C*
     C** POST TO CREDIT INTEREST PAYMENT CREDIT ACCOUNT CODE CREDIT SIDE
     C*
     C                     MOVELNAR,7     INPNAR
     C                     MOVELNR16,7    INP16
     C                     MOVELDN07,7    INP07
     C                     MOVELMGD,7     ##MGID                          S01522
     C/COPY WNCPYSRC,RE3664C155
     C*
     C                     Z-SUBWCIWT     WPSTA
     C                     MOVE WCIPC     ACOD
     C                     MOVE WTCIPC    ATYP
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C                     MOVE '1'       RIND             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X2
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E2
     C*
     C                     EXSR SUBNAR
     C                     MOVELNARS      PNAR
     C                     EXSR GEICPR
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C079
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD127       DBASE            * DB ERROR 127*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           WCIWT     SUB  WTIWT     WPSTA
     C*
     C** POST TO CREDIT INTEREST PAYMENT DEBIT NOT SUBJECT TO TAX
     C*
     C           WPSTA     IFNE 0                          - B1
     C                     MOVELNAR,9     INPNAR
     C                     MOVELNR16,9    INP16
     C                     MOVELDN07,9    INP07
     C                     MOVELMGD,9     ##MGID                          S01522
     C/COPY WNCPYSRC,RE3664C156
     C*
     C                     MOVE WCINS     ACOD
     C                     MOVE WTCINS    ATYP
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C                     MOVE '1'       RIND             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X2
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E2
     C*
     C                     EXSR SUBNAR
     C                     MOVELNARS      PNAR
     C                     EXSR GEICPR
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C080
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD128       DBASE            * DB ERROR 128*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C** POST TO CREDIT INTEREST PAYMENT DEBIT SUBJECT TO TAX
     C*
     C           WTIWT     IFNE 0                          - B1
     C                     MOVELNAR,8     INPNAR
     C                     MOVELNR16,8    INP16
     C                     MOVELDN07,8    INP07
     C                     MOVELMGD,8     ##MGID                          S01522
     C/COPY WNCPYSRC,RE3664C157
     C*
     C                     MOVE WCISU     ACOD
     C                     Z-ADDWTIWT     WPSTA
     C                     MOVE WTCISU    ATYP
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C                     MOVE '1'       RIND             *****
     C***********          Z-ADDLCID      VALD             ****           060828
     C***********          Z-ADDLCID      HISD             ****           060828
     C                     Z-ADDCNCID     VALD             ****           060828
     C                     Z-ADDCNCID     HISD             ****           060828
     C*                                                    *****
     C** ACCOUNT IS NOT RETAIL                             *****
     C*                                                    *****
     C                     ELSE                            ***** X2
     C*                                                    *****
     C                     Z-ADD*ZEROS    ACNO
     C                     MOVE *ZERO     RIND             *****
     C                     Z-ADDRUND      VALD             *****
     C                     Z-ADDRUND      HISD             *****
     C                     END                             ***** E2
     C*
     C                     EXSR SUBNAR
     C                     MOVELNARS      PNAR
     C                     EXSR GEICPR
     C*
     C           ATYP      IFEQ 'R'                        ***** B2
     C*
     C           VALD      IFLE NAPDA                      - B3
     C           *IN50     ANDEQ'0'
     C/COPY WNCPYSRC,RE3664C081
     C*
     C** WRITE NEW RECORD IN RETAIL HISTORY FILE - POSTINGS
     C*
     C                     Z-ADDVALD      HISD
     C***********          Z-ADD30        DBASE                           CRE002
     C                     Z-ADD129       DBASE            * DB ERROR 129*CRE002
     C                     MOVE 'N'       REACT                           CCB003
     C                     WRITEREHPOSPF
     C                     Z-ADD*ZEROS    DBASE
     C*
     C** UPDATE POSITION RECORD FOR ALTERNATE ACCOUNT PROCESSING
     C*
     C                     EXSR POSPR
     C*
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C                     END                                            131825
     C                     ENDSR
     C********************************************************************
      /EJECT                                                              CAC001
      *****************************************************************   CAC001
      **                                                              *   CAC001
      **   SRPRFC - Subroutine to determine if Profit Centre can      *   CAC001
      **            hold FX Position                                  *   CAC001
      **                                                              *   CAC001
      **   Called by: CCYSR, CREPR, OUTTAX                            *   CAC001
      **                                                              *   CAC001
      **   Calls    : *PSSR                                           *   CAC001
      **                                                              *   CAC001
      *****************************************************************   CAC001
     C           SRPRFC    BEGSR                                          CAC001
      *                                                                   CAC001
      **  Access Profit Centre details via access object                  CAC001
      *                                                                   CAC001
     C                     CALL 'AOPRFCR0'                                CAC001
     C                     PARM *BLANKS   WRTCD   7                       CAC001
     C                     PARM '*KEY   ' WOPTN   7                       CAC001
     C                     PARM PRFC      WPRFC   4                       CAC001
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC001
      *                                                                   CAC001
      **  Database error if not found                                     CAC001
      *                                                                   CAC001
     C           WRTCD     IFNE *BLANKS                                   CAC001
     C           *LOCK     IN   LDA                                       CAC001
     C                     Z-ADD203       DBASE            ************   CAC001
     C                     MOVELPRFC      DBKEY            * DBER 203 *   CAC001
     C                     MOVEL'SDPRFCPD'DBFILE           ************   CAC001
     C                     OUT  LDA                                       CAC001
     C                     EXSR *PSSR                                     CAC001
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  Use FX Position Profit Centre if it is not blank                CAC001
      *                                                                   CAC001
     C           DSFPPC    IFNE *BLANK                                    CAC001
     C                     MOVE DSFPPC    PRFC                            CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     ENDSR                                          CAC001
      ********************************************************************CAC001
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     CSR         GLZADD    BEGSR                           *** GLZADD ****
     C*
     CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     CSR                   EXSR GLZSUM
     CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
     C*
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     CSR         GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     CSR                   SETOF                     919293
     CSR                   SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     CSR         ZZAMTI    COMP 0                      9293
     CSR 93      ZZAMTD    COMP 0                      9293
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     CSR         ZZTOTI    COMP 0                      9193
     CSR 93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     CSR 93                Z-ADDZZAMTI    ZZTOTI
     CSR 93                Z-ADDZZAMTD    ZZTOTD
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     CSR 91N92
     CORN91 92             GOTO ZZOFPS
     C*
     CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     CSR         ZZWK2     COMP 999                  93    '93' = CARRY
     CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
     CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     CSRN99                Z-ADDZZWK2     ZZTOTD
     CSRN99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     CSR 99                Z-ADD0         ZZAMT  153
     CSR                   GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     CSR 92                Z-SUBZZAMTI    ZZAMTI 150
     CSR 92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     CSR 91                Z-SUBZZTOTI    ZZTOTI
     CSR 91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     CSR         ZZTOTI    COMP ZZAMTI               93  95
     CSR 95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     CSR 95                Z-ADD0         ZZTOTI
     CSR 95                Z-ADD0         ZZTOTD
     CSR 95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     CSR 93      ZZAMTD    COMP ZZTOTD               94
     CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
     CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
     CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     CSRN93      ZZTOTD    COMP ZZAMTD               94
     CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
     CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
     CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     CSR                   SETOF                     94
     CSR 93 91
     CORN93 92             SETON                     94
     CSR 94                Z-SUBZZTOTI    ZZTOTI
     CSR 94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     CSR 92                Z-SUBZZAMTI    ZZAMTI
     CSR 92                Z-SUBZZAMTD    ZZAMTD
     CSR         ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     CSR                   SETOF                     96
     CSR         ZZTOTD    COMP 0                        91
     CSR 91      ZZTOTI    COMP 0                      96
     CSR 96                MOVE '.000-'   ZZNEGD  5
     CSR                   ENDSR                             ** ENDSR **
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                        *
     C*  #CCYCN SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHER            *
     C*  CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES                  *
     C*
     C*                                                                        *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C*       ZAMTCI 150     AMOUNT IN 'FROM' CURRENCY                         *
     C*       ZCCYI   3A     FROM CURRENCY                                     *
     C*       ZCCYO   3A     TO CURRENCY                                       *
     C*       ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY                     *
     C*       ZRATET 138     SPOT RATE FOR 'TO' CURRENCY                       *
     C*       ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CURRENCY     *
     C*       ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURRENCY       *
     C*       ZCDPI   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURRENCY       *
     C*       ZCDPO   10     CURRENCY DECIMAL PLACES FOR 'TO' CURRENCY         *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZAMTCO 150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTED AMOUNT)    *
     C*       ZEXCH  138     CROSS EXCHANGE RATE                               *
     C*       ZMD     1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR              *
     C*                                                                        *
     C*                                                                        *
     C*  CALLED BY:                                                            *
     C*                                                                        *
     C**************************************************************************
     C*
     C           #CCYCN    BEGSR                           *** CCYCN * **
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADDZAMTCI    ZAMTCI 150
     C                     MOVE ZCCYI     ZCCYI   3
     C                     MOVE ZCCYO     ZCCYO   3
     C                     Z-ADDZRATEF    ZRATEF 138
     C                     Z-ADDZRATET    ZRATET 138
     C                     MOVE ZMDINF    ZMDINF  1
     C                     MOVE ZMDINT    ZMDINT  1
     C                     Z-ADDZCDPI     ZCDPI   10
     C                     Z-ADDZCDPO     ZCDPO   10
     C                     Z-ADDZAMTCO    ZAMTCO 150
     C                     Z-ADDZEXCH     ZEXCH  138
     C                     MOVE ZMD       ZMD     1
     C*
     C** IF 'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TO' CURRENCY
     C** EQUAL TO AMOUNT IN 'FROM' CURRENCY
     C           ZCCYI     IFEQ ZCCYO
     C                     Z-ADDZAMTCI    ZAMTCO
     C                     Z-ADD1         ZEXCH
     C                     MOVE 'M'       ZMD
     C                     GOTO CCYEND
     C                     END
     C*
     C** INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO
     C                     Z-ADD*ZEROS    ZEXCH
     C*
     C** IF MULT/DIV INDIC. FOR 'FROM' IS = MULT/DIV INDIC FOR 'TO' INDIC
     C**   AND SPOT RATE FOR 'TO' CURRENCY (ZRATET) IS NOT = ZERO
     C           ZMDINF    IFEQ ZMDINT
     C           ZRATET    ANDNE*ZEROS
     C           ZRATEF    DIV  ZRATET    ZEXCH
     C*
     C** IF MULT/DIV INDIC FOR 'FROM' IS NOT= MULT/DIV INDIC FOR 'TO' INDIC
     C** OR  SPOT RATE FOR 'TO' CURRENCY (ZRATET) IS  = ZERO
     C                     ELSE
     C           ZRATEF    MULT ZRATET    ZEXCH
     C                     END
     C*
     C** MOVE MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULT/DIV
     C** INDICATOR (ZMD)
     C*
     C                     MOVE ZMDINF    ZMD                             101847
     C*
     C** EXECUTE   SR ZCONV
     C*                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           @WHTF     ANDEQ'Y'                                                           CDL081
      *                                                                                       CDL081
      ** Convert in base currency without half adjust rounding                                CDL081
      *                                                                                       CDL081
     C                     EXSR WCONV                                                         CDL081
      *                                                                                       CDL081
     C                     ELSE                                                               CDL081
      *                                                                                       CDL081
     C                     EXSR ZCONV
      *                                                                                       CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
     C           CCYEND    ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C/COPY ZSRSRC,ZFRQAZ2
     C********************************************************************
     C/EJECT
     C********************************************************************
     C/COPY ZSRSRC,ZCONVZ1
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** WPT01 subroutine Save Witholding tax information
     C**
     C**     Called by       SETPR
     C**     Calls           -
     C**
      *****************************************************************   CCB003
     C           WPT01     BEGSR                           **WPT01 BEGSR**
     C*
     C***********          Z-ADD82        DBASE                           CRE002
     C                     Z-ADD130       DBASE            * DB ERROR 130*CRE002
     C*
     C** ACCESS SDACODX0
     C** ACCOUNT CODES USED ARE THESE DEFINE FOR THE ORIGINAL ACCOUNT
     C** EVEN IF AN ALTERNATE ACCOUNT EXIST
     C*
     C                     MOVELBACOD     KACOD
     C/COPY WNCPYSRC,RE3664C136
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD131       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 13 *CRE002
     C***********          Z-ADD013       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 131*           CRE002 CRE083BK
     C**********           Z-ADD131       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5DIPD    WDIPD
     C                     MOVE A5DIPC    WDIPC
     C                     MOVE A5CIPC    WCIPC
     C                     MOVE A5CISU    WCISU
     C                     MOVE A5CINS    WCINS
     C                     MOVE A5WTAC    WWTAC
     C                     Z-ADDA5MISU    WMISU
     C*
     C** ACCESS SDACODL0
     C*
     C                     MOVELWDIPD     KACOD
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD028       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 28 *                  CRE083BK
     C**********           Z-ADD028       DBASE            ***************                  CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C                     MOVE A5ACTY    WTDIPD
     C*
     C           WDIPC     IFNE WDIPD                      - B1
     C*
     C                     MOVELWDIPC     KACOD
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD133       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 29 *CRE002
     C***********          Z-ADD029       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 133*           CRE002 CRE083BK
     C**********           Z-ADD133       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C                     END                             - E1
     C                     MOVE A5ACTY    WTDIPC
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD134       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 30 *CRE002
     C***********          Z-ADD030       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 134*           CRE002 CRE083BK
     C**********           Z-ADD134       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C*
     C                     MOVE A5ACTY    WTCIPC
     C*
     C           WCISU     IFNE WCIPC                      - B1
     C                     MOVELWCISU     KACOD
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD135       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 31 *CRE002
     C***********          Z-ADD031       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 135*           CRE002 CRE083BK
     C**********           Z-ADD135       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C                     END                             - E1
     C                     MOVE A5ACTY    WTCISU
     C*
     C           WCINS     IFNE WCISU                      - B1
     C                     MOVELWCINS     KACOD
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD060       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 32 *CRE002
     C***********          Z-ADD032       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 060*           CRE002 CRE083BK
     C**********           Z-ADD060       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C                     END                             - E1
     C                     MOVE A5ACTY    WTCINS
     C*
     C                     MOVELWWTAC     KACOD
     C*
     C                     ADD  1         RCSQ                                              CRE083BK
     C                     MOVE KACOD     KEYACD                                            CRE083BK
     C                     Z-ADD085       WDBASE                                            CRE083BK
     C                     EXSR ACDCCH                                                      CRE083BK
     C**********           CALL 'AOACODR0'                                                  CRE083BK
     C**********           PARM '*MSG   ' @RTCD                                             CRE083BK
     C**********           PARM '*KEY   ' @OPTN                                             CRE083BK
     C**********           PARM KACOD     @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C**********           PARM KACOD     @ACCD                                      CGL029 CRE083BK
     C********** SDACOD    PARM SDACOD    DSSDY                                      CGL029 CRE083BK
     C********** @RTCD     IFNE *BLANK                                                      CRE083BK
     C********** *LOCK     IN   LDA                                                         CRE083BK
     C**********           MOVEL'SDACODPD'DBFILE           ***************                  CRE083BK
     C***********          MOVEL@ACCD     DBKEY            * DB ERROR 33 *CRE002
     C***********          Z-ADD033       DBASE            ***************CRE002
     C**********           MOVEL@ACCD     DBKEY            * DB ERROR 085*           CRE002 CRE083BK
     C**********           Z-ADD085       DBASE            ***************           CRE002 CRE083BK
     C**********           OUT  LDA                                                         CRE083BK
     C***********          WRITEERRP1                                     CCB003
     C**********           EXSR *PSSR                                                       CRE083BK
     C**********           END                                                              CRE083BK
     C                     MOVE A5ACTY    WTWTAC
     C*
     C/COPY WNCPYSRC,RE3664CCP1                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           ** WPT01 ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*  SUBNAR - Subroutine to standardised posting narratives.         *
     C*           If posted to the Retail Account, all 30 char. for      *
     C*           narrative is available. If posted to suspense, or      *
     C*           alternative account, or the Contra entry and Retail    *
     C*           no. is used then 19 char. is available and 10 char     *
     C*           is for the Retail no. otherwise only 7 char. for       *
     C*           narrative is available and the rest is for the         *
     C*           Midas account number.                                  *
     C*
     C*  Called by
     C*  Calls           -
     C*
     C********************************************************************
     C           SUBNAR    BEGSR                           *SUBNAR BEGSR*
      *                                                                   130468
     C                     MOVE *BLANKS   NARS                            130468
     C*
     C           BRCA      IFEQ XBRCA
     C           CNUM      ANDEQXCNUM
     C           CCY       ANDEQXCCY
     C           ACOD      ANDEQXACOD
     C           ACSQ      ANDEQXACSQ
     C                     MOVELINPNAR    NARS
      *                                                                   S01522
      **  Set up final character of MSGID according to Narrative Type     S01522
     C                     MOVE '0'       ##MGID                          S01522
     C                     ELSE
     C*
     C           RACN      IFEQ 'Y'
     C***********AAACNO    ANDNE0                                                      198082 231617
     C           WACN0     ANDNE0                                                             231617
     C                     MOVELINP16     NARS
     C***********          MOVE WACNO     NARS                            074598
     C                     MOVELWACNO     FLD15  15                       074598
     C           CRE008    IFEQ 'Y'                                       217910
     C           WACN0     ANDEQ0                                         217910
     C                     EXSR RTVRE                                     217910
     C                     MOVELXACNO     FLD15                           217910
     C                     ENDIF                                          217910
     C                     MOVE FLD15     NARS                            074598
      *                                                                   S01522
      **  Set up final character of MSGID according to Narrative Type     S01522
     C                     MOVE '1'       ##MGID                          S01522
     C                     ELSE
     C                     MOVELINP07     NARS
     C                     MOVE WNARS     NARS
      *                                                                   S01522
      **  Set up final character of MSGID according to Narrative Type     S01522
     C                     MOVE '2'       ##MGID                          S01522
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,RE3664C158
     C*
     C                     ENDSR                           **SUBNAR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**  ZEDIT SUBROUTINE TO INSERT A DECIMAL POINT INTO A NUMERIC FIELD*
     C**  AND TO BLANK OUT LEADING ZEROES.                               *
     C**      INPUT FIELDS:   ZFIELD 16/                                 *
     C*                       ZADEC                                      *
     C*                       ZADIG - NOT ACTUALLY USED                  *
     C*                                                                  *
     C*       ARRAYS    ZA1 ,ZA2   BOTH 16 ELEMENTS, EACH ONE BYTE LONG. *
     C*                                                                  *
     C*       OUTPUT FIELD   ZFIELD                                      *
     C*                                                                  *
     C/COPY ZSRSRC,ZEDITZ2
      *****************************************************************   CPB001
      /EJECT                                                              CPB001
      *****************************************************************   CPB001
      *                                                               *   CPB001
      *  REPLIC - Subroutine to write a posting in PB End of Day      *   CPB001
      *            Interest Postings File RPEODIPD.                   *   CPB001
      *                                                               *   CPB001
      *  Called by : GEICPR                                           *   CPB001
      *                                                               *   CPB001
      *  Calls     : None                                             *   CPB001
      *                                                               *   CPB001
      *****************************************************************   CPB001
     C           REPLIC    BEGSR                           ** REPLIC SR **CPB001
      *                                                                   CPB001
      **  Access Original Account Customer Details by using Access        CPB001
      **  Object, to retrieve Private Banking Customer Indicator.         CPB001
     C                     MOVE *BLANKS   @CNUM                           CPB001
     C                     MOVELBCNUM     @CNUM                           CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM '*MSG   ' @RTCD                           CPB001
     C                     PARM '*KEY   ' @OPTN                           CPB001
     C                     PARM           @CNUM  10                       CPB001
     C                     PARM           @KYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
      *                                                                   CPB001
      **  If Customer Details do not exist, handle Database Error.        CPB001
     C           @RTCD     IFEQ *ON                        Begin @RTCD    CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     MOVEL'SDCUSTPD'DBFILE           ***************CPB001
     C                     Z-ADD204       DBASE            * DB ERRO 204 *CPB001
     C                     MOVEL@CNUM     DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
      *                                                                   CPB001
     C                     ENDIF                           End @RTCD      CPB001
      *                                                                   CPB001
      **  If Original Account Customer is not a Private Banking Customer. CPB001
     C           BBPRBA    IFNE 'Y'                        Begin BBPRBA   CPB001
      *                                                                   CPB001
      **  Access Posting Account Customer Details by using Access         CPB001
      **  Object, to retrieve Private Banking Customer Indicator.         CPB001
     C                     MOVE *BLANKS   @CNUM                           CPB001
     C                     MOVELCNUM      @CNUM                           CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM '*MSG   ' @RTCD                           CPB001
     C                     PARM '*KEY   ' @OPTN                           CPB001
     C                     PARM           @CNUM  10                       CPB001
     C                     PARM           @KYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
      *                                                                   CPB001
      **  If Customer Details do not exist, handle Database Error.        CPB001
     C           @RTCD     IFEQ *ON                        Begin @RTCD    CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     MOVEL'SDCUSTPD'DBFILE           ***************CPB001
     C                     Z-ADD205       DBASE            * DB ERRO 205 *CPB001
     C                     MOVEL@CNUM     DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
      *                                                                   CPB001
     C                     ENDIF                           End @RTCD      CPB001
      *                                                                   CPB001
     C                     ENDIF                           End BBPRBA     CPB001
      *                                                                   CPB001
      **  If either the Original Account Customer or the Posting          CPB001
      **  Account Customer is a Private Banking Customer.                 CPB001
     C           BBPRBA    IFEQ 'Y'                        Begin BBPRBA   CPB001
      *                                                                   162319
      ** If internal posting,                                             162319
      ** not suspense account posting, don't write to TOF Interface files 162319
     C                     MOVELCNUM      BCNUMA                          162319
     C           BCNUMA    IFEQ BBICN                                     162319
     C**********           MOVE ACOD      TOCOMS  4                                    162319 CGL029
     C                     MOVE ACOD      TOCOMS 10                                           CGL029
     C           TOCOMS    CABNECOMS      BYP                             162319
     C                     ENDIF                                          162319
      *                                                                   CPB001
      **  Execute subroutine to set up Private Banking EOD Interest       CPB001
      **  Posting record fields.                                          CPB001
     C                     EXSR RPEODI                                    CPB001
      *                                                                   CPB001
      **  Write a new record in RPEODIPD.                                 CPB001
     C                     WRITERPEODID0                                  CPB001
      *                                                                   CPB001
     C           BYP       TAG                                            162319
     C                     ENDIF                           End BBPRBA     CPB001
      *                                                                   CPB001
     C                     ENDSR                                          CPB001
      ********************************************************************                    250998
      /EJECT                                                                                  250998
      ********************************************************************                    250998
      **                                                                                      250998
     C           DETPR     BEGSR                           **DETPR BEGSR**                    250998
      *                                                                                       250998
      ** If transaction charge overide is non zero then use this field                        250998
      *                                                                                       250998
     C                     Z-ADD0         WCHGP                                               250998
     C*                                                                                       250998
     C                     Z-ADD0         WCHGA                                               250998
     C*                                                                                       250998
     C           WPSTA     IFGT 0                          - B1                               250998
     C                     Z-ADDWPSTA     WPSTA2                                              250998
     C                     ELSE                            - X1                               250998
     C                     Z-SUBWPSTA     WPSTA2                                              250998
     C                     END                             - E1                               250998
     C*                                                                                       250998
     C**********           MOVE *BLANKS   BLNKS                                      250998 CRE083BK
     C**********           Z-ADD91060     DTRTY                                      250998 CRE083BK
     C**********           MOVELCCY       DCCY                                       250998 CRE083BK
     C**********           MOVEL'D'       D                                          250998 CRE083BK
     C                     MOVE *BLANKS   BLNKS                                             MD021155
     C                     MOVE '91060'   DTRTY                                             MD021155
     C                     MOVELCCY       DCCY                                              MD021155
     C                     MOVEL'D'       D                                                 MD021155
     C********** TRGDS     CHAINRETRGDF              99                              250998 CRE083BK
     C********** *IN99     IFEQ *OFF                                                 250998 CRE083BK
      *                                                                                       250998
     C                     Z-ADDCURETR    F                                                 CRE083BK
     C********** *LOVAL    SETLLRETRG                                              CRE083BK MD021155
     C**********           READ RETRG                    89                        CRE083BK MD021155
     C           TRGDS     LOKUPARET,F                   99                                 CRE083BK
     C********** *IN89     DOWNE*OFF                                               CRE083BK MD021155
     C********** *IN99     ORNE *ON                                                CRE083BK MD021155
     C**********           READ RETRG                    89                        CRE083BK MD021155
     C********** TRGDS     LOKUPARET,F                   99                        CRE083BK MD021155
     C**********           ENDDO                                                   CRE083BK MD021155
      *                                                                                     CRE083BK
     C********** F         OCUR SDRETR                                             CRE083BK MD021155
     C           *IN99     IFEQ *ON                                                         CRE083BK
     C           F         OCUR SDRETR                                             CRE083BK MD021155
     C                     MOVE KEYD      KEY                                               MD021155
     C                     MOVE LCDD      LCD                                               MD021155
     C                     MOVE ZZ001D    ZZ001                                             MD021155
     C           WTCHO     IFNE *ZEROS                     - B1                               250998
     C           DCAM      IFEQ 'C'                        - B2                               250998
     C           DCPC      OREQ 'C'                                                           250998
     C                     Z-SUBWTCHO     WCHGA                                               250998
     C                     ELSE                            - X2                               250998
     C                     Z-ADDWTCHO     WCHGA                                               250998
     C                     END                             - E2                               250998
      *                                                                                       250998
     C                     ELSE                                                               250998
      *                                                                                       250998
      ** Verify if Charge Amount > zero                                                       250998
      *                                                                                       250998
     C           CHAM      IFGT 0                          - B2                               250998
      *                                                                                       250998
      ** Test if Debit or Credit Amount                                                       250998
      *                                                                                       250998
     C           DCAM      IFEQ 'C'                        - B3                               250998
     C                     Z-SUBCHAM      WCHGA                                               250998
     C                     ELSE                            - X3                               250998
     C                     Z-ADDCHAM      WCHGA                                               250998
     C                     END                             - E3                               250998
      *                                                                                       250998
      ** Charge amount less or equal zero                                                     250998
      *                                                                                       250998
     C                     ELSE                            - X2                               250998
     C                     Z-ADD0         WCHGA                                               250998
     C                     END                             - E2                               250998
      *                                                                                       250998
      ** Test if Charge Percentage > 0                                                        250998
      *                                                                                       250998
     C           CHPC      IFGT 0                          - B2                               250998
     C           WPSTA2    MULT CHPC      WCHGP                                               250998
     C           WCHGP     DIV  100       WCHGP     H                                         250998
      *                                                                                       250998
      ** Test if Debit or credit Percentage                                                   250998
      *                                                                                       250998
     C           DCPC      IFEQ 'C'                        - B3                               250998
     C                     Z-SUBWCHGP     WCHGA                                               250998
     C                     ELSE                            - X3                               250998
     C                     Z-ADDWCHGP     WCHGA                                               250998
     C                     END                             - E3                               250998
      *                                                                                       250998
     C                     END                             - E2                               250998
      *                                                                                       250998
     C                     END                             - E1                               250998
      *                                                                                       250998
     C                     END                                                                250998
      *                                                                                       250998
     C                     ENDSR                           **DETPR ENDSR**                    250998
      *****************************************************************   CPB001
      /EJECT                                                              CPB001
      *****************************************************************   CPB001
      *                                                               *   CPB001
      *  RPEODI - Subroutine to set up Private Banking EOD Interest   *   CPB001
      *           Posting record fields.                              *   CPB001
      *                                                               *   CPB001
      *  Called by : REPLIC                                           *   CPB001
      *                                                               *   CPB001
      *  Calls     : None                                             *   CPB001
      *                                                               *   CPB001
      *****************************************************************   CPB001
     C           RPEODI    BEGSR                           ** RPEODI SR **CPB001
      *                                                                   CPB001
     C                     MOVE 'P'       PIRECI           Record Id      CPB001
     C**********           Z-ADDCNUM      PICNUM           Customer Number             CPB001 CSD027
     C                     MOVE CNUM      PICNUM           Customer Number                    CSD027
     C                     MOVE CCY       PICCY            Currency Code  CPB001
     C                     Z-ADDACOD      PIACOD           Account Code   CPB001
     C                     Z-ADDACSQ      PIACSQ           Account Seq.   CPB001
     C                     MOVE IPDN      PIIPDN           Input Document CPB001
     C                     Z-ADDACNO      PIACNO           Retail Account CPB001
     C                     Z-ADDPSTD      PIPSTD           Posting Date   CPB001
     C                     Z-ADDVALD      PIVALD           Value Date     CPB001
     C                     Z-ADDTRAT      PITRAT           Transact. Type CPB001
     C                     MOVE PNAR      PIPNAR           Posting Narr.  CPB001
     C                     Z-ADDPSTA      PIPSTA           Posting Amount CPB001
     C                     Z-ADDDRCR      PIDRCR           Deb/Cred. Ind. CPB001
     C**********           Z-ADDASOC      PIASOC           Associat. Cust.             CPB001 CSD027
     C                     MOVE ASOC      PIASOC           Associat. Cust.                    CSD027
     C                     Z-ADDCHQN      PICHQN           Cheque Number  CPB001
     C                     MOVE SPOS      PISPOS           Source Posting CPB001
     C                     MOVE BRCA      PIBRCA           Branch Code    CPB001
     C                     Z-ADDRIND      PIRIND           Retail Ind.    CPB001
     C                     Z-ADDREJC      PIREJC           Reject Code    CPB001
     C                     MOVE DPMT      PIDPMT           Department CodeCPB001
     C                     Z-ADDRRNM      PIRRNM           Relative Rec NoCPB001
     C                     MOVE *BLANKS   PIZZ09           Filler         CPB001
     C                     MOVE ATYP      PIATYP           Account Type   CPB001
     C                     MOVE *BLANKS   PIZZ02           Filler         CPB001
     C                     MOVE EXIN      PIEXIN           Extract Ind    CPB001
     C                     MOVE PRIN      PIPRIN           Pay/Receive IndCPB001
     C                     MOVE GETP      PIGETP           Gen. Entry TypeCPB001
     C                     Z-ADDACUM      PIACUM           Accumulator    CPB001
     C                     MOVE PRFC      PIPRFC           Profit Ccentre CPB001
     C                     Z-ADDPTIM      PIPTIM           Postingg Time  CPB001
     C                     Z-ADDVOIN      PIVOIN           Void Indicator CPB001
     C                     MOVE MGTT      PIMGTT           Msg Gen. Trans.CPB001
     C                     MOVE ACSC      PIACSC           Account SectionCPB001
     C                     Z-ADDLTAI      PILTAI           Late Accr. Ind.CPB001
     C                     MOVE *BLANKS   PIZZ07           Filler         CPB001
     C                     MOVE RINO      PIRINO           Retail Input NoCPB001
     C                     MOVE SWCR      PISWCR           Swift Comm. RefCPB001
     C                     MOVE DLREF     PIDLRF           Deal/Loan Ref. CPB001
     C                     MOVE FACO      PIFACO           For Account Of CPB001
     C**********           Z-ADDDBCNUM    PIDBCN           Dealt/Borr. Cus             CPB001 CSD027
     C                     MOVE DBCNUM    PIDBCN           Dealt/Borr. Cus                    CSD027
     C                     MOVELPREF      PIPREF           Tot. No. Post. CPB001
     C                     MOVE OTRF      PIOTRF           Original Trans.CPB001
     C                     MOVE OTST      PIOTST           Or. Trans. Ref.CPB001
     C                     MOVE OTTP      PIOTTP           Or. Trans. SubtCPB001
     C                     Z-ADDSDCB      PISDCB           Start Day ClBL CPB001
     C                     Z-ADDSDLB      PISDLB           Start Day LDBL CPB001
     C                     MOVE BOKC      PIBOKC           Book Code      CPB001
     C                     Z-ADDNITMS     PINITM           Number of ItemsCPB001
     C                     MOVE REBI      PIREBI           Rebatable Ind. CPB001
     C                     Z-ADDCHGA      PICHGA           Charge Amount  CPB001
     C                     MOVE *BLANKS   PIZZ19           Filler         CPB001
     C                     MOVE TLIN      PITLIN           Gen.-purp. Ind.CPB001
     C                     MOVE TCCY      PITCCY           Trans. CurrencyCPB001
     C                     MOVE STYP      PISTYP           Account SubtypeCPB001
     C                     MOVE CQRI      PICQRI           Cheq. Ind/ReverCPB001
     C                     MOVE PBTT      PIPBTT           Passbook TransaCPB001
     C                     MOVE ORBR      PIORBR           Origin. Branch CPB001
     C**********           MOVE ORAMT     PIORAM           Midas Amounts               CPB001 233719
     C**********           MOVE WTAOC     PIORAM                                       233719 234661
     C           CGL031    IFEQ 'Y'                                                           234661
     C           WEUTT     ANDEQ'Y'                                                           234661
     C                     MOVE WPSTA     PIORAM                                              234661
     C                     ELSE                                                               234661
     C                     MOVE ORAMT     PIORAM                                              234661
     C                     ENDIF                                                              234661
      *                                                                   CPB001
     C                     MOVE *BLANKS   PIOCCY           Original CurrenCPB001
     C                     Z-ADD*ZEROS    PIOAMT           Original AmountCPB001
      *                                                                   CPB001
     C**********           Z-ADDBCNUM     PIORCU           Origin. Cust.               CPB001 CSD027
     C                     MOVE BCNUM     PIORCU           Origin. Cust.                      CSD027
     C                     MOVE BCCY      PIORCY           Origin. Curr.  CPB001
     C                     Z-ADDBACOD     PIORAC           Origin. Acc. CoCPB001
     C                     Z-ADDBACSQ     PIORSE           Origin. Acc. SeCPB001
     C                     MOVE BBRCA     PIORBA           Origin. Branch CPB001
      *                                                                   CPB001
     C                     ENDSR                                          CPB001
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRRTAX - Retrieves tax amount for EU withholding tax         *                       CGL031
      *           accounting.                                         *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRRTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise relevant variables.                                                       CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZERO     WTAOC  130                                          CGL031
     C                     Z-ADD*ZERO     WTATC  130                                          CGL031
     C                     Z-ADD*ZERO     WTABC  130                                          CGL031
     C**********           Z-ADD*ZERO     WIAOC  130                                   CGL031 232543
     C**********           Z-ADD*ZERO     WIATC  130                                   CGL031 232543
     C**********           Z-ADD*ZERO     WIABC  130                                   CGL031 232543
     C                     Z-ADD*ZEROS    WKSTXO 150                                          CER048
     C                     Z-ADD*ZEROS    WKSTXT 150                                          CER048
     C                     Z-ADD*ZEROS    WKSTXB 150                                          CER048
     C                     Z-ADD*ZEROS    WKTTXO 150                                          CER054
     C                     Z-ADD*ZEROS    WKTTXT 150                                          CER054
     C                     Z-ADD*ZEROS    WKTTXB 150                                          CER054
     C**********           MOVEL'N'       WSATH   1                                  CER048 BUG23587
     C                     MOVEL'N'       WARTH   1                                           CER048
      *                                                                                       235174
      ** Save Transaction Type.                                                               235174
      *                                                                                       235174
     C                     Z-ADDTRAT      WTRAT                                               235174
     C                     MOVE TXTXTT    TRAT                                                235174
     C                     MOVE 'Y'       WEUTT   1                                           235174
      *                                                                                       235174
      ** Set up the narrative.                                                                235174
      *                                                                                       235174
     C                     MOVELNAR,14    INPNAR                                              235174
     C                     MOVELNR16,14   INP16                                               235174
     C                     MOVELDN07,14   INP07                                               235174
     C                     MOVELMGD,14    ##MGID                                              235174
      *                                                                                       235174
     C                     MOVE BBRCA     BRCA                                                235174
     C**********           Z-ADDBCNUM     CNUM                                        235174 CSD027A
     C                     MOVE BCNUM     CNUM                                               CSD027A
     C                     MOVE BCCY      CCY                                                 235174
     C                     Z-ADDBACOD     ACOD                                                235174
     C                     Z-ADDBACSQ     ACSQ                                                235174
     C                     MOVE WACNO     ACNO                                                235174
      *                                                                                       CGL031
      ** Check if the customer is actually a Joint A/c.                                       232543
      *                                                                                       232543
     C                     MOVE BCNUM     KJANO   6                                           232543
     C           KJANO     CHAINSDJACCL1             84                                       232543
      *                                                                                       232543
     C                     MOVE 'N'       WJACC   1                                           232543
     C           *IN84     IFEQ *OFF                                                          232543
     C                     MOVE 'Y'       WJACC                                               232543
     C                     ENDIF                                                              232543
      *                                                                                       CER048
      ** Check for the swithable feature                                                      CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
      ** Access branch details                                                                CER048
      *                                                                                       CER048
     C                     Z-ADDCUBRCA    C                                                 CRE083BK
     C           BBRCA     LOKUPABRC,C                   16                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN16     IFEQ '1'                                                         CRE083BK
     C           C         OCUR SDBRCH                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDBRCH                                                      MD021155
     C                     CALL 'AOBRCHR0'                                                    CER048
     C                     PARM '*MSG   ' PRTCD                                               CER048
     C                     PARM '*KEY   ' POPTN                                               CER048
     C                     PARM BBRCA     PBRCA   3                                           CER048
     C           SDBRCH    PARM SDBRCH    DSFDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANKS                                                       CER048
      *                                                                                       CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     MOVEL'RE3664'  DBPGM                                               CER048
     C                     MOVEL'SDBRCHPD'DBFILE                                              CER048
     C                     MOVELPBRCA     DBKEY                                               CER048
     C                     Z-ADD306       DBASE                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
     C                     ENDIF                                                            CRE083BK
      *                                                                                       CER048
      ** Access location details                                                              CER048
      *                                                                                       CER048
     C                     CALL 'AOLOCNR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*KEY   ' POPTN                                               CER048
     C                     PARM A8LCCD    PLOCN   3                                           CER048
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANKS                                                       CER048
      *                                                                                       CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     MOVEL'RE3664'  DBPGM                                               CER048
     C                     MOVEL'SDLOCNPD'DBFILE                                              CER048
     C                     MOVELPLOCN     DBKEY                                               CER048
     C                     Z-ADD307       DBASE                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Access customer details                                                              CER048
      *                                                                                       CER048
     C                     MOVELBCNUM     PCNUM                                               CER048
      *                                                                                       CER048
     C                     CALL 'AOCUSTR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD   7                                           CER048
     C                     PARM '*KEY   ' POPTN   7                                           CER048
     C                     PARM           PCNUM  10                                           CER048
     C                     PARM *BLANKS   PCNST   7                                           CER048
     C           SDCUST    PARM SDCUST    DSSDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANKS                                                       CER048
     C           *LOCK     IN   LDA                                                           CER048
      *                                                                                       CER048
     C                     MOVEL'SDCUSTPD'DBFILE                                              CER048
     C                     MOVELPCNUM     DBKEY                                               CER048
     C                     Z-ADD308       DBASE                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Access country of tax details                                                        CER048
      *                                                                                       CER048
     C                     CALL 'AOCTTXR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*KEY   ' POPTN                                               CER048
     C                     PARM DVCNCD    PCTRT   2                                           CER048
     C                     PARM BBCOLC    PCTRR   2                                           CER048
     C           SDCTTX    PARM SDCTTX    DSFDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFEQ '*NRF   '                                                     CER048
      *                                                                                       CER048
     C                     CALL 'AOCTTXR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*KEY   ' POPTN                                               CER048
     C                     PARM DVCNCD    PCTRT   2                                           CER048
     C                     PARM *BLANKS   PCTRR   2                                           CER048
     C           SDCTTX    PARM SDCTTX    DSFDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFNE *BLANKS                                                       CER048
      *                                                                                       CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     MOVEL'SDCTTXPD'DBFILE                                              CER048
     C                     MOVEL@BRCA     DBKEY                                               CER048
     C                     Z-ADD309       DBASE                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Check if the tax is done using Threshold                                             CER048
      *                                                                                       CER048
     C           EWTHMD    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
      ***Check*the*savings*threshold*for*accounts*that*accrue*credit                 CER048 BUG23587
      ***interest*yearly                                                             CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** CRIF      IFEQ 'Y'                                                  CER048 BUG23587
      **********                                                                     CER048 BUG23587
      ***Access*Country*Codes                                                        CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           CALL 'AOCTRYR0'                                           CER048 BUG23587
     C**********           PARM *BLANKS   PRTCD                                      CER048 BUG23587
     C**********           PARM '*KEY   ' POPTN                                      CER048 BUG23587
     C**********           PARM DVCNCD    PLCTR   2                                  CER048 BUG23587
     C********** SDCTRY    PARM SDCTRY    DSFDY                                      CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** PRTCD     IFNE *BLANKS                                              CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** *LOCK     IN   LDA                                                  CER048 BUG23587
     C**********           MOVE PLCTR     DBKEY                                      CER048 BUG23587
     C**********           MOVE 'SDCTRYPD'DBFILE                                     CER048 BUG23587
     C**********           MOVE 319       DBASE                                      CER048 BUG23587
     C**********           OUT  LDA                                                  CER048 BUG23587
     C**********           EXSR *PSSR                                                CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** 2         SUBSTBJMRDT:6  WXX     2                                  CER048 BUG23587
     C**********           MOVE WXX       WDT     20                                 CER048 BUG23587
     C********** WDT       SUB  1         WDT                                        CER048 BUG23587
     C**********           MOVE WDT       WY1     2                                  CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** A4ETXY    IFEQ *ZERO                                                CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** BJDFIN    IFEQ 'M'                                                  CER048 BUG23587
     C********** '1231'    CAT  WY1       WZZ                                        CER048 BUG23587
     C**********           ELSE                                                      CER048 BUG23587
     C********** '3112'    CAT  WY1       WZZ     6                                  CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           ELSE                                                      CER048 BUG23587
     C**********           MOVE A4ETXY    WETXY   4                                  CER048 BUG23587
     C********** WETXY     CAT  WY1       WZZ                                        CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           MOVE WZZ       ZDATE                                      CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           EXSR ZDATE1                                               CER048 BUG23587
      **********                                                                     CER048 BUG23587
      ***Verify*if*error                                                             CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** *IN99     IFEQ '1'                                                  CER048 BUG23587
     C********** *LOCK     IN   LDA                                                  CER048 BUG23587
     C**********           Z-ADD318       DBASE                                      CER048 BUG23587
     C**********           MOVE 'ZDATE1'  DBFILE                                     CER048 BUG23587
     C**********           MOVE *BLANKS   DBKEY                                      CER048 BUG23587
     C**********           OUT  LDA                                                  CER048 BUG23587
     C**********           EXSR *PSSR                                                CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           Z-ADDZDAYNO    WSEDAT                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
      ***Last*capitalisation*date,*is*before*or*same*as*previous*tax                 CER048 BUG23587
      ***year-end*date*Or*Last*Capitalisation*Date,*is*same*as*date                  CER048 BUG23587
      ***account*opened                                                              CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** LCID      IFLE WSEDAT                                               CER048 BUG23587
     C********** LCID      OREQ DACO                                                 CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           Z-ADDBJRDNB    KRDNB                                      CER048 BUG23587
     C**********           MOVE 'G'       KMODI                                      CER048 BUG23587
     C**********           MOVE BCNUM     KCUST                                      CER048 BUG23587
     C**********           MOVE BCNUM     KJOIN                                      CER048 BUG23587
     C**********           MOVE BCCY      KSCCY                                      CER048 BUG23587
     C**********           Z-ADDBACOD     KACDE                                      CER048 BUG23587
     C**********           Z-ADDBACSQ     KACSQ                                      CER048 BUG23587
     C**********           MOVE BBRCA     KBRCA                                      CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** WJACC     IFEQ 'Y'                                                  CER048 BUG23587
     C********** KCILC     SETLLSDCSINLC                                             CER048 BUG23587
     C********** KCILC     READESDCSINLC                 84                          CER048 BUG23587
     C**********           ELSE                                                      CER048 BUG23587
     C********** KCIL7     SETLLSDCSINL7                                             CER048 BUG23587
     C********** KCIL7     READESDCSINL7                 84                          CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** BCCY      IFEQ TSTXCY                                               CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** RCAIC     IFLT EWSATH                                               CER048 BUG23587
     C**********           MOVE 'Y'       WSATH                                      CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           ELSE                                                      CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           MOVELRCAIC     XAMNT1                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
      ***Access*account*currency*details                                             CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           CALL 'AOCURRR0'                                           CER048 BUG23587
     C**********           PARM *BLANKS   PRTCD                                      CER048 BUG23587
     C**********           PARM '*KEY  '  POPTN                                      CER048 BUG23587
     C**********           PARM BCCY      PCYCD   3                                  CER048 BUG23587
     C********** SDCURR    PARM SDCURR    DSSDY                                      CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** PRTCD     IFNE *BLANKS                                              CER048 BUG23587
     C********** *LOCK     IN   LDA                                                  CER048 BUG23587
     C**********           MOVEL'SDCURRPD'DBFILE                                     CER048 BUG23587
     C**********           MOVELPCYCD     DBKEY                                      CER048 BUG23587
     C**********           Z-ADD310       DBASE                                      CER048 BUG23587
     C**********           OUT  LDA                                                  CER048 BUG23587
     C**********           EXSR *PSSR                                                CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           Z-ADDCDP       XCDP1                                      CER048 BUG23587
     C**********           Z-ADDSPOT      XSPOT1                                     CER048 BUG23587
     C**********           MOVELMDIN      XMDIN1                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
      ***Check*if*margin*points*for*conversion*rate,*is*'Y'                          CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** EWMPCR    IFEQ 'Y'                                                  CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** MDIN      IFEQ 'M'                                                  CER048 BUG23587
     C********** SPOT      SUB  A6TCMP    XSPOT1                                     CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
      ***Access*Tax*Currency                                                         CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           CALL 'AOCURRR0'                                           CER048 BUG23587
     C**********           PARM *BLANKS   PRTCD                                      CER048 BUG23587
     C**********           PARM '*KEY  '  POPTN                                      CER048 BUG23587
     C**********           PARM TSTXCY    PCYCD   3                                  CER048 BUG23587
     C********** SDCURR    PARM SDCURR    DSSDY                                      CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** PRTCD     IFNE *BLANKS                                              CER048 BUG23587
     C********** *LOCK     IN   LDA                                                  CER048 BUG23587
     C**********           MOVEL'SDCURRPD'DBFILE                                     CER048 BUG23587
     C**********           MOVELPCYCD     DBKEY                                      CER048 BUG23587
     C**********           Z-ADD311       DBASE                                      CER048 BUG23587
     C**********           OUT  LDA                                                  CER048 BUG23587
     C**********           EXSR *PSSR                                                CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           Z-ADDCDP       XCDP2                                      CER048 BUG23587
     C**********           MOVELMDIN      XMDIN2                                     CER048 BUG23587
     C**********           Z-ADDSPOT      XSPOT2                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** EWMPCR    IFEQ 'Y'                                                  CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** MDIN      IFEQ 'M'                                                  CER048 BUG23587
     C********** SPOT      SUB  A6TCMP    XSPOT2                                     CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           EXSR CNVERT                                               CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C********** XAMNT2    IFLE EWSATH                                               CER048 BUG23587
     C**********           MOVEL'Y'       WSATH                                      CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      **********                                                                     CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
     C**********           ENDIF                                                     CER048 BUG23587
      *                                                                                       CER048
      ** Check the average rate threshold                                                     CER048
      *                                                                                       CER048
     C           SHISD     IFEQ CNCID                                                         CER048
      *                                                                                       CER048
      ** Work credit interest number                                                          CER048
      *                                                                                       CER048
     C                     Z-ADD*ZEROS    WCRIN  150                                          CER048
      *                                                                                       CER048
      ** Work credit interest                                                                 CER048
      *                                                                                       CER048
     C                     MOVEL'N'       WCRIT   1                                           CER048
      *                                                                                       CER048
      ** Work date                                                                            CER048
      *                                                                                       CER048
     C                     MOVELSPCID     WDATE                                               CER048
      *                                                                                       CER048
      ** Work capitalisation date                                                             CER048
      *                                                                                       CER048
     C                     MOVELSHISD     WCDAT                                               CER048
      *                                                                                       CER048
      ** Work balance                                                                         CER048
      *                                                                                       CER048
     C                     MOVELSHISB     WHISB                                               CER048
      *                                                                                       CER048
      ** Access account currency details                                                      CER048
      *                                                                                       CER048
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY      LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*KEY  '  POPTN                                               CER048
     C                     PARM BCCY      PCYCD   3                                           CER048
     C           SDCURR    PARM SDCURR    DSSDY                                               CER048
      *                                                                                       CER048
     C           @RTCD     IFNE *BLANKS                                                       CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     MOVEL'SDCURRPD'DBFILE                                              CER048
     C                     MOVELPCYCD     DBKEY                                               CER048
     C                     Z-ADD312       DBASE                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
     C                     ENDIF                                                              CER048
     C                     ENDIF                                                            CRE083BK
      *                                                                                       CER048
     C           4         ADD  CDP       FD      10                                          CER048
      *                                                                                       CER048
      ** Read previous history record to ensure include previous end                          CER048
      ** of month balance record                                                              CER048
      *                                                                                       CER048
     C                     MOVE BBRCA     BRCA                                                CER048
     C**********           Z-ADDBCNUM     CNUM                                         CER048 CER059
     C                     MOVE BCNUM     CNUM                                                CER059
     C                     MOVE BCCY      CCY                                                 CER048
     C                     Z-ADDBACOD     ACOD                                                CER048
     C                     Z-ADDBACSQ     ACSQ                                                CER048
     C                     Z-ADDWDATE     HISD                                                CER048
      *                                                                                       CER048
      ** Read previous history record                                                         CER048
      *                                                                                       CER048
     C           R3KEY     SETLLREHISL                                                        CER048
     C********** R3KEYA    READEREHISL                   40                          CER048 MD024557
     C           R3KEYA    READEREHISL              N    40                                 MD024557
      *                                                                                       CER048
     C           *IN40     DOUEQ*ON                                                           CER048
      *                                                                                       CER048
     C           *IN40     IFEQ *OFF                                                          CER048
      *                                                                                       CER048
     C           HISD      IFGT WCDAT                                                         CER048
     C                     LEAVE                                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     MOVELHISD      ZIEND                                               CER048
      *                                                                                       CER048
     C           CRCI      IFEQ 'Y'                                                           CER048
     C           HISD      ANDGTPCID                                                          CER048
     C           HISD      ANDLTWCDAT                                                         CER048
     C                     MOVEL'Y'       WCRIT                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ELSE                                                               CER048
      *                                                                                       CER048
     C                     MOVELWCDAT     ZIEND                                               CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     MOVELWDATE     ZIBEG                                               CER048
      *                                                                                       CER048
     C           ZIBEG     IFLT ZIEND                                                         CER048
      *                                                                                       CER048
     C                     Z-ADDCRCB      ZICALC                                              CER048
      *                                                                                       CER048
     C                     EXSR ZICD                                                          CER048
      *                                                                                       CER048
     C           WHISB     MULT ZDAYN2    WINUM  150                                          CER048
     C           WINUM     DIV  100       WINUM                                               CER048
     C           WINUM     DIV  POWER,FD  WINUM                                               CER048
      *                                                                                       CER048
      ** If work balance is less than zero                                                    CER048
      *                                                                                       CER048
     C           WHISB     IFLT *ZERO                                                         CER048
     C                     ADD  WINUM     WCRIN                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     Z-ADDHISB      WHISB                                               CER048
     C                     Z-ADDHISD      WDATE                                               CER048
      *                                                                                       CER048
     C           HISD      IFEQ WCDAT                                                         CER048
     C           RECI      ANDEQ'S'                                                           CER048
     C                     LEAVE                                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C********** R3KEYA    READEREHISL                   40                          CER048 MD024557
     C           R3KEYA    READEREHISL              N    40                                 MD024557
      *                                                                                       CER048
     C                     ENDDO                                                              CER048
      *                                                                                       CER048
      ** Check threshold                                                                      CER048
      *                                                                                       CER048
     C           CRCB      IFEQ 1                                                             CER048
     C           CRCB      OREQ 4                                                             CER048
      *                                                                                       CER048
     C                     Z-ADD365       WNDYR   30                                          CER048
      *                                                                                       CER048
     C                     ELSE                                                               CER048
      *                                                                                       CER048
     C           CRCB      IFEQ 6                                                             CER048
     C                     Z-ADD365       WNDYR                                               CER048
     C                     ELSE                                                               CER048
     C                     Z-ADD360       WNDYR                                               CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** If work credit interest number is not zero                                           CER048
      *                                                                                       CER048
     C           WCRIN     IFNE *ZEROS                                                        CER048
      *                                                                                       CER048
     C           RCAIC     MULT WNDYR     WCTOT  180                                          CER048
     C           WCTOT     DIV  WCRIN     AVRT   235                                          CER048
      *                                                                                       CER048
      ** Only calculate average rate to 2 decimals                                            CER048
      *                                                                                       CER048
     C           AVRT      DIV  POWER,FD  WAVRT  232H                                         CER048
     C                     Z-ADDWAVRT     AVRT                                                CER048
      *                                                                                       CER048
     C           AVRT      IFLT *ZEROS                                                        CER048
     C                     MULT -1        AVRT                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           WCRIT     IFNE 'Y'                                                           CER048
     C           SCICT     ANDEQ*ZEROS                                                        CER048
     C                     Z-ADDAVRT      SCRIR                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ELSE                                                               CER048
     C                     Z-ADD*ZEROS    AVRT                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           SHISD     IFGE EWRAED                                                        CER048
     C                     Z-ADDEWRARL    WLEVEL                                              CER048
     C                     ELSE                                                               CER048
     C                     Z-ADDEWPARL    WLEVEL                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           AVRT      IFLE WLEVEL                                                        CER048
     C                     MOVEL'Y'       WARTH                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           WARTH     IFEQ 'Y'                                                         BUG23347
      *                                                                                     BUG23347
     C**********           Z-ADDBJRDNB    KRDNB                                    BUG23347 BUG24114
     C                     MOVE 'G'       KMODI                                             BUG23347
     C                     MOVE BCNUM     KCUST                                             BUG23347
     C                     MOVE BCCY      KSCCY                                             BUG23347
     C                     Z-ADDBACOD     KACDE                                             BUG23347
     C                     Z-ADDBACSQ     KACSQ                                             BUG23347
     C                     MOVE BBRCA     KBRCA                                             BUG23347
     C                     Z-ADDLCID      KRDNB                                             BUG24114
      *                                                                                     BUG24114
     C                     Z-ADD*ZEROS    WNIBC  150                                        BUG24114
     C                     Z-ADD*ZEROS    WPTBC  150                                        BUG24114
     C                     Z-ADD*ZEROS    WTTAX  150                                        BUG24114
      *                                                                                     BUG23347
     C********** KCIL7     SETLLSDCSINL7                                           BUG23347 BUG24114
     C********** KCIL7     READESDCSINL7                 70                        BUG23347 BUG24114
     C           INTAD     IFEQ '1'                                                         AR676495
     C                     MOVE '0'       INTAD                                             AR676495
     C                     ELSE                                                             AR676495
     C           KCILJ     SETLLSDCSINLJ                                                    BUG24114
     C                     ENDIF                                                            AR676495
     C           KCILJ     READESDCSINLJ                 70                                 BUG24114
      *                                                                                     BUG23347
     C           *IN70     DOWEQ*OFF                                                        BUG23347
      *                                                                                     BUG23347
     C**********           MOVE TSNINB    WNIBC  150                               BUG23347 BUG24114
     C**********           MOVE TSPTHU    WPTBC  150                               BUG23347 BUG24114
     C                     ADD  TSNINB    WNIBC                                             BUG24114
     C                     ADD  TSPTHU    WPTBC                                             BUG24114
     C                     ADD  TSTXSB    WTTAX                                             BUG24114
     C                     ADD  TSSTDB    WTTAX                                             BUG24114
     C                     ADD  TSTTDB    WTTAX                                             BUG25295
      *                                                                                     BUG23347
     C                     MOVE *ZEROS    TSTXSR                                            BUG23347
     C                     MOVE *ZEROS    TSTXSS                                            BUG23347
     C                     MOVE *ZEROS    TSTXSC                                            BUG23347
     C                     MOVE *ZEROS    TSTXSB                                            BUG23347
     C                     MOVE *ZEROS    TSSTDO                                            BUG23347
     C                     MOVE *ZEROS    TSSTDS                                            BUG23347
     C                     MOVE *ZEROS    TSSTDT                                            BUG23347
     C                     MOVE *ZEROS    TSSTDB                                            BUG23347
     C                     MOVE *ZEROS    TSPTHU                                            BUG24114
     C                     MOVE *ZEROS    TSTTDO                                            BUG25295
     C                     MOVE *ZEROS    TSTTDS                                            BUG25295
     C                     MOVE *ZEROS    TSTTDT                                            BUG25295
     C                     MOVE *ZEROS    TSTTDB                                            BUG25295
      *                                                                                     BUG23347
     C                     MOVE TSGINT    TSNINT                                            BUG23347
     C                     MOVE TSGINS    TSNINS                                            BUG23347
     C                     MOVE TSGINC    TSNINC                                            BUG23347
     C                     MOVE TSGINB    TSNINB                                            BUG23347
      *                                                                                     BUG24114
     C                     UPDATSDCSINDJ                                                    BUG24114
      *                                                                                     BUG23347
     C********** KCIL7     READESDCSINL7                 70                        BUG23347 BUG24114
     C           KCILJ     READESDCSINLJ                 70                                 BUG24114
      *                                                                                     BUG23347
     C                     ENDDO                                                            BUG23347
      *                                                                                     BUG23347
     C                     MOVE TSCUST    KCNUM                                             BUG23347
     C                     MOVE TSBRCA    KBRCH                                             BUG23347
      *                                                                                     BUG23347
     C           R3KEYB    SETLLSDINPHL2                                                    BUG23347
     C           R3KEYB    READESDINPHL2                 71                                 BUG23347
      *                                                                                     BUG23347
     C           *IN71     IFEQ *OFF                                                        BUG23681
     C           TITOUT    SUB  WNIBC     TITOUT                                            BUG23347
     C           TIUTTH    SUB  WPTBC     TIUTTH                                            BUG23347
     C           TITTAX    SUB  WTTAX     TITTAX                                            BUG24114
      *                                                                                     BUG23347
     C                     UPDATSDINPHD0                                                    BUG23347
     C                     ENDIF                                                            BUG23681
      *                                                                                     BUG23347
     C           ACKEY1    CHAINREACR                40                                    BUG23309A
      *                                                                                    BUG23309A
      ** REACR Record not found                                                            BUG23309A
      *                                                                                    BUG23309A
     C           *IN40     IFEQ '1'                                                        BUG23309A
     C           *LOCK     IN   LDA                                                        BUG23309A
     C                     Z-ADD03        DBASE                                            BUG23309A
     C                     MOVEL'REACR'   DBFILE                                           BUG23309A
     C                     MOVELAKEY      DBKEY                                            BUG23309A
     C                     OUT  LDA                                                        BUG23309A
     C                     EXSR *PSSR                                                      BUG23309A
     C                     END                                                             BUG23309A
      *                                                                                    BUG23309A
     C           HISB      IFLE *ZEROS                                                     BUG23309A
     C           HISB      SUB  WTTAX     HISB                                             BUG23309A
     C                     ELSE                                                            BUG23309A
     C           HISB      ADD  WTTAX     HISB                                             BUG23309A
     C**********           UPDATREACRDF                                          BUG23309A BUG23309B
     C                     ENDIF                                                           BUG23309A
      *                                                                                    BUG23309A
     C                     UPDATREACRDF                                                    BUG23309B
      *                                                                                    BUG23309B
     C                     ENDIF                                                            BUG23347
      *                                                                                     BUG23347
     C           WARTH     IFEQ 'Y'                                                           CER048
     C********** WSATH     OREQ 'Y'                                                  CER048 BUG23587
     C                     ELSE                                                               CER048
      *                                                                                       CER048
      *                                                                                       232543
      ** Read customer income records.                                                        CGL031
      *                                                                                       CGL031
     C                     Z-ADDBJRDNB    KRDNB                                               CGL031
     C                     MOVE 'G'       KMODI                                               CGL031
     C                     MOVE BCNUM     KCUST                                               CGL031
     C                     MOVE BCNUM     KJOIN                                               232543
     C                     MOVE BCCY      KSCCY                                               CGL031
     C                     Z-ADDBACOD     KACDE                                               CGL031
     C                     Z-ADDBACSQ     KACSQ                                               CGL031
     C                     MOVE BBRCA     KBRCA                                               CGL031
      *                                                                                       CGL031
     C********** KCSIN     SETLLSDCSINL7                                               CGL031 232543
     C********** KCSIN     READESDCSINL7                 84                            CGL031 232543
      *                                                                                       CGL031
     C           WJACC     IFEQ 'Y'                                                           232543
     C           INTAD     IFEQ '1'                                                         AR676495
     C                     MOVE '0'       INTAD                                             AR676495
     C                     ELSE                                                             AR676495
     C           KCILC     SETLLSDCSINLC                                                      232543
     C                     ENDIF                                                            AR676495
     C           KCILC     READESDCSINLC                 84                                   232543
     C                     ELSE                                                               232543
     C           INTAD     IFEQ '1'                                                         AR676495
     C                     MOVE '0'       INTAD                                             AR676495
     C                     ELSE                                                             AR676495
     C           KCIL7     SETLLSDCSINL7                                                      232543
     C                     ENDIF                                                            AR676495
     C           KCIL7     READESDCSINL7                 84                                   232543
     C                     ENDIF                                                              232543
      *                                                                                       232543
     C           *IN84     DOWEQ*OFF                                                          CGL031
     C           TSSTAT    ANDEQ'T'                                                           CGL031
      *
      ***This*will*only*calculate*tax*with*tax*calc*date*equal*to*run*date         AR762246 AR813717
     C********** TSEDAT    IFEQ WDATE                                              AR762246 AR813717
      *                                                                                     BUG26900
      ** For non-joint account accumulate only if TSJOIN is zero                            BUG26900
     C           WJACC     IFEQ 'Y'                                                         BUG26900
     C           WJACC     OREQ 'N'                                                         BUG26900
     C********** TSJOIN    ANDEQ*ZERO                                              BUG26900 AR744480
     C           TSJOIN    ANDEQ*BLANKS                                                     AR744480
      *                                                                                       CGL031
      ** If original ccy is equal to tax ccy, accumulate tax amount in                        CGL031
      ** original ccy. Otherwise, accumulate tax amount and gross interest                    CGL031
      ** amount in original, tax, and base currencies.                                        CGL031
      *                                                                                       CGL031
     C           TSOCCY    IFEQ TSTXCY                                                        CGL031
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     ADD  TSSTDO    WKSTXO                                              CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     ADD  TSTTDO    WKTTXO                                              CER054
     C                     ENDIF                                                              CER054
     C                     ADD  TSTXSR    WTAOC                                               CGL031
     C                     ELSE                                                               CGL031
     C                     ADD  TSTXSR    WTAOC                                               CGL031
     C                     ADD  TSTXSC    WTATC                                               CGL031
     C                     ADD  TSTXSB    WTABC                                               CGL031
     C**********           ADD  TSGINT    WIAOC                                        CGL031 232543
     C**********           ADD  TSGINC    WIATC                                        CGL031 232543
     C**********           ADD  TSGINB    WIABC                                        CGL031 232543
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     ADD  TSSTDO    WKSTXO                                              CER048
     C                     ADD  TSSTDT    WKSTXT                                              CER048
     C                     ADD  TSSTDB    WKSTXB                                              CER048
     C                     ENDIF                                                              CER048
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     ADD  TSTTDO    WKTTXO                                              CER054
     C                     ADD  TSTTDT    WKTTXT                                              CER054
     C                     ADD  TSTTDB    WKTTXB                                              CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C********** KCSIN     READESDCSINL7                 84                            CGL031 232543
     C                     MOVE TSWTAC    WEWTA                                               235174
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     MOVE TSSTAC    WSTAC                                               CER048
     C                     ENDIF                                                              CER054
     C           CER054    IFEQ 'Y'                                                           CER054
     C                     MOVE TSTTAC    WTTAC                                               CER054
     C                     ENDIF                                                              CER048
      *                                                                                     BUG26900
      ** TSJOIN is zero                                                                     BUG26900
     C                     ENDIF                                                            BUG26900
      *                                                                                     AR762246
     C**********           ENDIF                                                   AR762246 AR813717
      *                                                                                       232543
     C           WJACC     IFEQ 'Y'                                                           232543
      *                                                                                       235174
      ** Generate EU a/c keys for tax amount.                                                 235174
      *                                                                                       235174
     C                     EXSR SREATA                                                        235174
      *                                                                                       235174
     C           KCILC     READESDCSINLC                 84                                   232543
     C                     ELSE                                                               232543
     C           KCIL7     READESDCSINL7                 84                                   232543
     C                     ENDIF                                                              232543
      *                                                                                       232543
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CER048
     C**********           Z-ADD*ZERO     BRTAMT                                       CGL031 232543
     C**********           Z-ADD*ZERO     NETBRT                                       CGL031 232543
     C**********           Z-ADD*ZERO     PACR1                                        CGL031 232543
     C**********           Z-ADD*ZERO     BRTAM2                                       CGL031 232543
      *                                                                                       CGL031
     C**********           Z-ADDTRAT      WTRAT                                        CGL031 232543
     C**********           MOVE TXTXTT    TRAT                                         CGL031 232543
      *                                                                                       CGL031
      ** Set up the narrative.                                                                CGL031
      *                                                                                       CGL031
     C**********           Z-ADD6         #                                            CGL031 235174
     C**********           MOVELNAR,#     INPNAR                                       CGL031 235174
     C**********           MOVELNR16,#    INP16                                        CGL031 235174
     C**********           MOVELDN07,#    INP07                                        CGL031 235174
     C**********           MOVELMGD,#     ##MGID                                       CGL031 235174
      *                                                                                       CGL031
     C**********           MOVE BBRCA     BRCA                                         CGL031 235174
     C**********           Z-ADDBCNUM     CNUM                                         CGL031 235174
     C**********           MOVE BCCY      CCY                                          CGL031 235174
     C**********           Z-ADDBACOD     ACOD                                         CGL031 235174
     C**********           Z-ADDBACSQ     ACSQ                                         CGL031 235174
     C**********           MOVE WACNO     ACNO                                         CGL031 235174
      *                                                                                       CGL031
     C**********           MOVE TSWTAC    WEWTA                                        232543 235174
      *                                                                                       232543
      ***Reset*transaction type.                                                       CGL031 232543
      ***********                                                                      CGL031 232543
     C***********          Z-ADDWTRAT     TRAT                                         CGL031 232543
     C***********          MOVELWTRAT     OTTP                                         CGL031 232543
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRGPOS - Generates postings for EU withholding tax           *                       CGL031
      *           accounting.                                         *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRGPOS    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Save Transaction Type.                                                               232543
      *                                                                                       232543
     C                     Z-ADDTRAT      WTRAT                                               232543
     C                     MOVE TXTXTT    TRAT                                                232543
     C                     MOVE 'Y'       WEUTT   1                                           234003
      *                                                                                       234438
     C                     MOVELNAR,14    INPNAR                                              234438
     C                     MOVELNR16,14   INP16                                               234438
     C                     MOVELDN07,14   INP07                                               234438
     C                     MOVELMGD,14    ##MGID                                              234438
      *                                                                                       232543
     C********** WTAOC     IFGT *ZERO                                                  232543 235875
     C           WTAOC     IFNE *ZERO                                                         235875
      *                                                                                       CGL031
      ** Output EU Withholding Tax as a DR to the retail a/c.                                 CGL031
      *                                                                                       CGL031
     C           CACP      IFEQ *BLANKS                                                     AR851468
     C                     MOVE BBRCA     BRCA                                                235917
     C**********           Z-ADDBCNUM     CNUM                                        235917 CSD027A
     C                     MOVE BCNUM     CNUM                                               CSD027A
     C                     MOVE BCCY      CCY                                                 235917
     C                     Z-ADDBACOD     ACOD                                                235917
     C                     Z-ADDBACSQ     ACSQ                                                235917
     C                     MOVE WACNO     ACNO                                                235917
     C                     ELSE                                                             AR851468
     C                     MOVE @CBRCA    BRCA                                              AR851468
     C                     MOVE @CCNUM    CNUM                                              AR851468
     C                     MOVE @CCCY     CCY                                               AR851468
     C                     Z-ADD@CACOD    ACOD                                              AR851468
     C                     Z-ADD@CACSQ    ACSQ                                              AR851468
     C                     MOVE @CACNO    ACNO                                              AR851468
     C                     ENDIF                                                            AR851468
      *                                                                                       235917
      ***PACR1*is the gross credit amount to be posted.                                CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-ADD@WCAIC    PACR1                                        CGL031 232543
      **********                                                                       CGL031 232543
      ***BRTAMT*is the accumulated tax amount in original ccy.                         CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-ADDWTAOC     BRTAMT    H                                  CGL031 232543
     C**********           SUB  BRTAMT    PACR1                                        CGL031 232543
      **********                                                                       CGL031 232543
     C********** BRTAMT    IFGT *ZERO                                                  CGL031 232543
     C**********           Z-ADDBRTAMT    BRTAM2                                       CGL031 232543
     C                     Z-ADDRUND      PSTD                                                CGL031
     C**********           Z-ADDCNCID     VALD                                         CGL031 234870
     C**********           Z-ADDCNCID     HISD                                         CGL031 234870
     C**********           Z-ADDNXTCID    VALD                                         234870 235368
     C**********           Z-ADDNXTCID    HISD                                         234870 235368
     C**********           Z-ADDSHISD     VALD                                      235368 BUG23097A
     C**********           Z-ADDSHISD     HISD                                      235368 BUG23097A
     C                     Z-ADDCNCID     VALD                                             BUG23097A
     C                     Z-ADDCNCID     HISD                                             BUG23097A
     C**********           Z-ADDBRTAM2    WPSTA                                        CGL031 232543
     C                     Z-ADDWTAOC     WPSTA                                               232543
     C                     Z-ADD*ZERO     RRNM                                                CGL031
     C                     EXSR SUBNAR                                                        CGL031
      ** Main Tax                                                                          BUG23163A
      *                                                                                    BUG23163A
     C           CER048    IFEQ 'Y'                                                        BUG23163A
     C           NARS      ANDEQEUTAXN                                                     BUG23163A
     C           CER048    OREQ 'Y'                                                         AR851468
     C           CACP      ANDNE*BLANK                                                      AR851468
     C           CER048    OREQ 'Y'                                                         AR318139
     C           NARS      ANDEQEUTXN2,1                                                    AR318139
     C           REPNAR    IFNE 'Y'                                                         AR318139
     C                     MOVELCPRITX    NARS      P                                      BUG23163A
     C                     ELSE                                                             AR318139
     C                     MOVE 'GB00543' ##MGID                                            AR318139
     C                     ENDIF                                                            AR318139
     C                     ENDIF                                                           BUG23163A
      *                                                                                    BUG23163A
     C                     MOVE NARS      PNAR                                                CGL031
     C                     EXSR GEICPR                                                        CGL031
      *                                                                                       CGL031
      ** Update history if required (first time).                                             CGL031
      *                                                                                       CGL031
     C           ATYP      IFEQ 'R'                                                           CGL031
     C           VALD      ANDLENAPDA                                                         CGL031
     C           *IN50     ANDEQ*OFF                                                          CGL031
      *                                                                                       CGL031
     C                     Z-ADD137       DBASE                                               CGL031
     C                     MOVE 'N'       REACT                                               CGL031
     C                     WRITEREHPOSPF                                                      CGL031
      *                                                                                       CGL031
     C           CACP      IFEQ *BLANKS                                                       CGL031
      *                                                                                       CGL031
     C           R3KEY     CHAINREHISPDF             40                                       CGL031
      *                                                                                       CGL031
     C           *IN40     IFEQ *ON                                                           CGL031
     C                     MOVE 'D'       RECI                                                CGL031
     C                     MOVE *BLANKS   DLGID                                               CGL031
     C                     Z-ADD*ZERO     VALL                                                CGL031
     C                     MOVE *BLANK    LINK                                                CGL031
     C                     MOVE *BLANK    DICI                                                CGL031
     C                     MOVE *BLANK    CICI                                                CGL031
     C                     MOVE *BLANK    DRCI                                                CGL031
     C                     MOVE *BLANK    CRCI                                                CGL031
     C                     MOVE *BLANK    ALTI                                                CGL031
     C                     Z-ADD*ZERO     DRIR                                                CGL031
     C                     Z-ADD*ZERO     CRIR                                                CGL031
     C                     Z-ADD*ZERO     PDID                                                CGL031
     C                     Z-ADD*ZERO     PCID                                                CGL031
     C                     Z-ADD*ZERO     DICT                                                CGL031
     C                     Z-ADD*ZERO     CICT                                                CGL031
     C                     Z-ADD*ZERO     DRCB                                                CGL031
     C                     Z-ADD*ZERO     CRCB                                                CGL031
     C                     MOVE *BLANK    ADTY                                                CGL031
     C                     Z-ADD*ZERO     MNBL                                                CGL031
     C                     Z-ADD*ZERO     CHGAR                                               CGL031
     C                     Z-ADD*ZERO     TCHGAR                                              CGL031
     C                     Z-ADD*ZERO     CHGAN                                               CGL031
     C                     Z-ADD*ZERO     TCHGAN                                              CGL031
     C                     Z-ADD*ZERO     DMVT                                                CGL031
     C                     Z-ADD*ZERO     CMVT                                                CGL031
     C                     Z-ADD*ZERO     DAID                                                CGL031
     C                     Z-ADD*ZERO     MADI                                                CGL031
     C                     Z-ADD*ZERO     TMADI                                               CGL031
     C                     Z-ADD*ZERO     DMINT                                               CGL031
     C                     Z-ADD*ZERO     CAID                                                CGL031
     C                     Z-ADD*ZERO     MACI                                                CGL031
     C                     Z-ADD*ZERO     TMACI                                               CGL031
     C                     Z-ADD*ZERO     CMINT                                               CGL031
     C                     Z-ADD*ZERO     MNBCP                                               CGL031
     C                     Z-ADD*ZERO     DRCD                                                CGL031
     C                     Z-ADD*ZERO     CRCD                                                CGL031
     C                     Z-ADD*ZERO     VDTC                                                CGL031
      *                                                                                       CGL031
     C           DRCR      IFEQ 1                                                             CGL031
     C                     Z-ADDPSTA      CMVT                                                CGL031
     C                     ELSE                                                               CGL031
     C                     Z-ADDPSTA      DMVT                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           SHISB     ADD  DMVT      HISB                                             BUG23097A
     C**********           Z-ADDDMVT      HISB                                      CGL031 BUG23097A
     C                     SUB  CMVT      HISB                                                CGL031
     C                     Z-ADD139       DBASE                                               CGL031
     C                     WRITEREHISPDF                                                      CGL031
     C                     Z-ADD*ZEROS    DBASE                                               CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           DRCR      IFEQ 1                                                             CGL031
     C                     ADD  PSTA      CMVT                                                CGL031
     C                     ELSE                                                               CGL031
     C                     ADD  PSTA      DMVT                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADD139       DBASE                                               CGL031
     C                     UPDATREHISPDF                                                      CGL031
     C                     MOVE 'Y'       FCOMIT                                            MD022410
     C                     Z-ADD*ZEROS    DBASE                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
     C                     EXSR POSPR                                                         CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Output EU withholding tax as a CR to the internal tax a/c in                         CGL031
      ***retail*a/c*currency.                                                          CGL031 232543
      ** retail a/c currency only if Tax Ccy = A/c Ccy.                                       232543
      *                                                                                       CGL031
     C           TSTXCY    IFEQ BCCY                                                          232543
      *                                                                                       232543
     C                     Z-SUBWTAOC     WPSTA                                               232543
     C                     MOVE BBICN     CNUM                                                CGL031
     C**********           Z-ADDTSWTAC    ACOD                                         CGL031 232543
     C                     Z-ADDWEWTA     ACOD                                                232543
     C                     Z-ADD1         ACSQ                                                CGL031
     C                     Z-ADD*ZERO     ACNO                                                CGL031
     C                     Z-ADDRUND      VALD                                                CGL031
     C                     EXSR SUBNAR                                                        CGL031
     C                     MOVE NARS      PNAR                                                CGL031
      *                                                                                       235174
      ** EU tax postings are written by subroutine SREATA per Joint A/c                       235174
      ** member given a Joint A/c.                                                            235174
      *                                                                                       235174
     C           WJACC     IFNE 'Y'                                                           235174
     C                     EXSR GEICPR                                                        CGL031
      *                                                                                       CGL031
      ** Update history if required (second time).                                            CGL031
      *                                                                                       CGL031
     C           ATYP      IFEQ 'R'                                                           CGL031
     C           VALD      ANDLENAPDA                                                         CGL031
     C           *IN50     ANDEQ*OFF                                                          CGL031
     C                     Z-ADD137       DBASE                                               CGL031
     C                     MOVE 'N'       REACT                                               CGL031
     C                     WRITEREHPOSPF                                                      CGL031
     C                     EXSR POSPR                                                         CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              235174
      *                                                                                       CGL031
     C                     ENDIF                                                              232543
      *                                                                                       232543
     C                     ENDIF                                                              232543
      *                                                                                       232543
      ***If*original ccy is not equal to tax ccy, generate postings in                 CGL031 232543
      ***foreign*ccy.                                                                  CGL031 232543
      **********                                                                       CGL031 232543
     C********** TSOCCY    IFNE TSTXCY                                                 CGL031 232543
      *                                                                                       232543
      ** Output additional postings if Tax Ccy <> A/c Ccy.                                    232543
      *                                                                                       232543
     C           TSTXCY    IFNE BCCY                                                          232543
     C                     EXSR SRFPOS                                                        CGL031
     C                     ENDIF                                                              232543
      *                                                                                       232543
     C********** STRGRO    SUB  STRBRT    STRNET                                       CGL031 232543
     C********** BSEGRO    SUB  BSEBRT    BSENET                                       CGL031 232543
     C**********           ELSE                                                        CGL031 232543
     C**********           Z-ADDBRTAMT    STRBRT                                       CGL031 232543
     C**********           Z-ADDPACR1     STRGRO                                       CGL031 232543
     C**********           Z-ADDNETBRT    STRNET                                       CGL031 232543
      *                                                                                       CGL031
     C**********           Z-ADDBRTAMT    BSEBRT                                       CGL031 232543
     C**********           Z-ADDPACR1     BSEGRO                                       CGL031 232543
     C**********           Z-ADDNETBRT    BSENET                                       CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      *                                                                                       232543
      ** Reset Transaction Type.                                                              232543
      *                                                                                       232543
     C                     Z-ADDWTRAT     TRAT                                                232543
     C                     MOVE 'N'       WEUTT                                               234003
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
     C           WTAOC     IFNE *ZEROS                                                        CER048
     C           WKSTXO    ANDNE*ZEROS                                                        CER048
      *                                                                                       CER048
     C                     MOVELWKSTXO    WPSTA                                               CER048
     C           CACP      IFEQ *BLANKS                                                     AR851468
     C                     MOVELBBRCA     BRCA                                                CER048
     C                     MOVELBCNUM     CNUM                                                CER048
     C                     MOVELBCCY      CCY                                                 CER048
     C                     MOVELBACOD     ACOD                                                CER048
     C                     MOVELBACSQ     ACSQ                                                CER048
     C                     MOVELWACNO     ACNO                                                CER048
     C                     ELSE                                                             AR851468
     C                     MOVE @CBRCA    BRCA                                              AR851468
     C                     MOVE @CCNUM    CNUM                                              AR851468
     C                     MOVE @CCCY     CCY                                               AR851468
     C                     Z-ADD@CACOD    ACOD                                              AR851468
     C                     Z-ADD@CACSQ    ACSQ                                              AR851468
     C                     MOVE @CACNO    ACNO                                              AR851468
     C                     ENDIF                                                            AR851468
     C                     MOVELRUND      PSTD                                                CER048
     C**********           MOVELSHISD     VALD                                      CER048 BUG23097A
     C**********           MOVELSHISD     HISD                                      CER048 BUG23097A
     C                     Z-ADDCNCID     VALD                                              BUG25530
     C                     Z-ADDCNCID     HISD                                              BUG25530
     C                     Z-ADD0         RRNM                                                CER048
      *                                                                                       CER048
     C                     EXSR SUBNAR                                                        CER048
      ** Secondary Tax                                                                     BUG23163A
      *                                                                                    BUG23163A
     C           NARS      IFEQ EUTAXN                                                     BUG23163A
     C           CACP      ORNE *BLANK                                                      AR851468
     C           NARS      OREQ EUTXN2,1                                                    AR318139
     C           REPNAR    IFNE 'Y'                                                         AR318139
     C                     MOVELC2NDTX    NARS      P                                      BUG23163A
     C                     ELSE                                                             AR318139
     C                     MOVE 'GB00544' ##MGID                                            AR318139
     C                     ENDIF                                                            AR318139
     C                     ENDIF                                                           BUG23163A
      *                                                                                    BUG23163A
     C                     MOVELNARS      PNAR                                                CER048
     C                     EXSR GEICPR                                                        CER048
      *                                                                                       CER048
      ** Update history if required (Third time)                                              CER048
      ** for the posting amount for the secondary tax.                                        CER048
      *                                                                                       CER048
     C           ATYP      IFEQ 'R'                                                           CER048
     C           VALD      ANDLENAPDA                                                         CER048
     C           *IN50     ANDEQ*OFF                                                          CER048
     C                     Z-ADD313       DBASE                                               CER048
     C                     MOVE 'N'       REACT                                               CER048
     C                     WRITEREHPOSPF                                                      CER048
     C           CACP      IFEQ *BLANKS                                                    BUG23097A
      *                                                                                    BUG23097A
     C           R3KEY     CHAINREHISPDF             40                                    BUG23097A
      *                                                                                    BUG23097A
     C           *IN40     IFEQ *ON                                                        BUG23097A
     C                     MOVE 'D'       RECI                                             BUG23097A
     C                     MOVE *BLANKS   DLGID                                            BUG23097A
     C                     Z-ADD*ZERO     VALL                                             BUG23097A
     C                     MOVE *BLANK    LINK                                             BUG23097A
     C                     MOVE *BLANK    DICI                                             BUG23097A
     C                     MOVE *BLANK    CICI                                             BUG23097A
     C                     MOVE *BLANK    DRCI                                             BUG23097A
     C                     MOVE *BLANK    CRCI                                             BUG23097A
     C                     MOVE *BLANK    ALTI                                             BUG23097A
     C                     Z-ADD*ZERO     DRIR                                             BUG23097A
     C                     Z-ADD*ZERO     CRIR                                             BUG23097A
     C                     Z-ADD*ZERO     PDID                                             BUG23097A
     C                     Z-ADD*ZERO     PCID                                             BUG23097A
     C                     Z-ADD*ZERO     DICT                                             BUG23097A
     C                     Z-ADD*ZERO     CICT                                             BUG23097A
     C                     Z-ADD*ZERO     DRCB                                             BUG23097A
     C                     Z-ADD*ZERO     CRCB                                             BUG23097A
     C                     MOVE *BLANK    ADTY                                             BUG23097A
     C                     Z-ADD*ZERO     MNBL                                             BUG23097A
     C                     Z-ADD*ZERO     CHGAR                                            BUG23097A
     C                     Z-ADD*ZERO     TCHGAR                                           BUG23097A
     C                     Z-ADD*ZERO     CHGAN                                            BUG23097A
     C                     Z-ADD*ZERO     TCHGAN                                           BUG23097A
     C                     Z-ADD*ZERO     DMVT                                             BUG23097A
     C                     Z-ADD*ZERO     CMVT                                             BUG23097A
     C                     Z-ADD*ZERO     DAID                                             BUG23097A
     C                     Z-ADD*ZERO     MADI                                             BUG23097A
     C                     Z-ADD*ZERO     TMADI                                            BUG23097A
     C                     Z-ADD*ZERO     DMINT                                            BUG23097A
     C                     Z-ADD*ZERO     CAID                                             BUG23097A
     C                     Z-ADD*ZERO     MACI                                             BUG23097A
     C                     Z-ADD*ZERO     TMACI                                            BUG23097A
     C                     Z-ADD*ZERO     CMINT                                            BUG23097A
     C                     Z-ADD*ZERO     MNBCP                                            BUG23097A
     C                     Z-ADD*ZERO     DRCD                                             BUG23097A
     C                     Z-ADD*ZERO     CRCD                                             BUG23097A
     C                     Z-ADD*ZERO     VDTC                                             BUG23097A
      *                                                                                    BUG23097A
     C           DRCR      IFEQ 1                                                          BUG23097A
     C                     Z-ADDPSTA      CMVT                                             BUG23097A
     C                     ELSE                                                            BUG23097A
     C                     Z-ADDPSTA      DMVT                                             BUG23097A
     C                     ENDIF                                                           BUG23097A
      *                                                                                    BUG23097A
     C           SHISB     ADD  DMVT      HISB                                             BUG23097A
     C                     SUB  CMVT      HISB                                             BUG23097A
     C                     Z-ADD321       DBASE                                            BUG23097A
     C                     WRITEREHISPDF                                                   BUG23097A
     C                     Z-ADD*ZEROS    DBASE                                            BUG23097A
     C                     ELSE                                                            BUG23097A
      *                                                                                    BUG23097A
     C           DRCR      IFEQ 1                                                          BUG23097A
     C                     ADD  PSTA      CMVT                                             BUG23097A
     C                     ELSE                                                            BUG23097A
     C                     ADD  PSTA      DMVT                                             BUG23097A
     C                     ENDIF                                                           BUG23097A
      *                                                                                    BUG23097A
     C                     Z-ADD321       DBASE                                            BUG23097A
     C                     UPDATREHISPDF                                                   BUG23097A
     C                     MOVE 'Y'       FCOMIT                                            MD022410
     C                     Z-ADD*ZEROS    DBASE                                            BUG23097A
     C                     ENDIF                                                           BUG23097A
      *                                                                                    BUG23097A
     C                     ELSE                                                            BUG23097A
     C                     EXSR POSPR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           TSTXCY    IFEQ BCCY                                                          CER048
      *                                                                                       CER048
     C**********           MOVELWKSTXB    WPSTA                                     CER048 BUG23097A
     C                     Z-SUBWKSTXO    WPSTA                                            BUG23097A
     C                     MOVELBBICN     CNUM                                                CER048
     C                     MOVELTSSTAC    ACOD                                                CER048
     C                     Z-ADD1         ACSQ                                                CER048
     C                     Z-ADD0         ACNO                                                CER048
     C                     MOVELRUND      VALD                                                CER048
      *                                                                                       CER048
     C                     EXSR SUBNAR                                                        CER048
     C                     MOVELNARS      PNAR                                                CER048
      *                                                                                       CER048
     C           WJACC     IFNE 'Y'                                                           CER048
     C                     EXSR GEICPR                                                        CER048
      *                                                                                       CER048
      ** Update history if required (Fourth time)                                             CER048
      ** for the posting amount for the secondary tax.                                        CER048
      *                                                                                       CER048
     C           ATYP      IFEQ 'R'                                                           CER048
     C           VALD      ANDLENAPDA                                                         CER048
     C           *IN50     ANDEQ*OFF                                                          CER048
     C                     Z-ADD314       DBASE                                               CER048
     C                     MOVE 'N'       REACT                                               CER048
     C                     WRITEREHPOSPF                                                      CER048
     C                     EXSR POSPR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER054
     C           CER054    IFEQ 'Y'                                                           CER054
      *                                                                                       CER054
     C           WTAOC     IFNE *ZEROS                                                        CER054
     C           WKTTXO    ANDNE*ZEROS                                                        CER054
      *                                                                                       CER054
     C                     MOVELWKTTXO    WPSTA                                               CER054
     C           CACP      IFEQ *BLANKS                                                     AR851468
     C                     MOVELBBRCA     BRCA                                                CER054
     C                     MOVELBCNUM     CNUM                                                CER054
     C                     MOVELBCCY      CCY                                                 CER054
     C                     MOVELBACOD     ACOD                                                CER054
     C                     MOVELBACSQ     ACSQ                                                CER054
     C                     MOVELWACNO     ACNO                                                CER054
     C                     ELSE                                                             AR851468
     C                     MOVE @CBRCA    BRCA                                              AR851468
     C                     MOVE @CCNUM    CNUM                                              AR851468
     C                     MOVE @CCCY     CCY                                               AR851468
     C                     Z-ADD@CACOD    ACOD                                              AR851468
     C                     Z-ADD@CACSQ    ACSQ                                              AR851468
     C                     MOVE @CACNO    ACNO                                              AR851468
     C                     ENDIF                                                            AR851468
     C                     MOVELRUND      PSTD                                                CER054
     C                     Z-ADDCNCID     VALD                                              BUG25530
     C                     Z-ADDCNCID     HISD                                              BUG25530
     C                     Z-ADD0         RRNM                                                CER054
      *                                                                                       CER054
     C                     EXSR SUBNAR                                                        CER054
      ** Third Tax                                                                          BUG24341
      *                                                                                     BUG24341
     C           NARS      IFEQ EUTAXN                                                      BUG24341
     C           CACP      ORNE *BLANK                                                      AR851468
     C                     MOVELC3RDTX    NARS      P                                       BUG24341
     C                     ENDIF                                                            BUG24341
      *                                                                                     BUG24341
     C                     MOVELNARS      PNAR                                                CER054
     C                     EXSR GEICPR                                                        CER054
      *                                                                                       CER054
      ** Update history if required                                                           CER054
      ** for the posting amount for the third tax.                                            CER054
      *                                                                                       CER054
     C           ATYP      IFEQ 'R'                                                           CER054
     C           VALD      ANDLENAPDA                                                         CER054
     C           *IN50     ANDEQ*OFF                                                          CER054
     C                     Z-ADD313       DBASE                                               CER054
     C                     MOVE 'N'       REACT                                               CER054
     C                     WRITEREHPOSPF                                                      CER054
     C           CACP      IFEQ *BLANKS                                                       CER054
      *                                                                                       CER054
     C           R3KEY     CHAINREHISPDF             40                                       CER054
      *                                                                                       CER054
     C           *IN40     IFEQ *ON                                                           CER054
     C                     MOVE 'D'       RECI                                                CER054
     C                     MOVE *BLANKS   DLGID                                               CER054
     C                     Z-ADD*ZERO     VALL                                                CER054
     C                     MOVE *BLANK    LINK                                                CER054
     C                     MOVE *BLANK    DICI                                                CER054
     C                     MOVE *BLANK    CICI                                                CER054
     C                     MOVE *BLANK    DRCI                                                CER054
     C                     MOVE *BLANK    CRCI                                                CER054
     C                     MOVE *BLANK    ALTI                                                CER054
     C                     Z-ADD*ZERO     DRIR                                                CER054
     C                     Z-ADD*ZERO     CRIR                                                CER054
     C                     Z-ADD*ZERO     PDID                                                CER054
     C                     Z-ADD*ZERO     PCID                                                CER054
     C                     Z-ADD*ZERO     DICT                                                CER054
     C                     Z-ADD*ZERO     CICT                                                CER054
     C                     Z-ADD*ZERO     DRCB                                                CER054
     C                     Z-ADD*ZERO     CRCB                                                CER054
     C                     MOVE *BLANK    ADTY                                                CER054
     C                     Z-ADD*ZERO     MNBL                                                CER054
     C                     Z-ADD*ZERO     CHGAR                                               CER054
     C                     Z-ADD*ZERO     TCHGAR                                              CER054
     C                     Z-ADD*ZERO     CHGAN                                               CER054
     C                     Z-ADD*ZERO     TCHGAN                                              CER054
     C                     Z-ADD*ZERO     DMVT                                                CER054
     C                     Z-ADD*ZERO     CMVT                                                CER054
     C                     Z-ADD*ZERO     DAID                                                CER054
     C                     Z-ADD*ZERO     MADI                                                CER054
     C                     Z-ADD*ZERO     TMADI                                               CER054
     C                     Z-ADD*ZERO     DMINT                                               CER054
     C                     Z-ADD*ZERO     CAID                                                CER054
     C                     Z-ADD*ZERO     MACI                                                CER054
     C                     Z-ADD*ZERO     TMACI                                               CER054
     C                     Z-ADD*ZERO     CMINT                                               CER054
     C                     Z-ADD*ZERO     MNBCP                                               CER054
     C                     Z-ADD*ZERO     DRCD                                                CER054
     C                     Z-ADD*ZERO     CRCD                                                CER054
     C                     Z-ADD*ZERO     VDTC                                                CER054
      *                                                                                       CER054
     C           DRCR      IFEQ 1                                                             CER054
     C                     Z-ADDPSTA      CMVT                                                CER054
     C                     ELSE                                                               CER054
     C                     Z-ADDPSTA      DMVT                                                CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C           SHISB     ADD  DMVT      HISB                                                CER054
     C                     SUB  CMVT      HISB                                                CER054
     C                     Z-ADD321       DBASE                                               CER054
     C                     WRITEREHISPDF                                                      CER054
     C                     Z-ADD*ZEROS    DBASE                                               CER054
     C                     ELSE                                                               CER054
      *                                                                                       CER054
     C           DRCR      IFEQ 1                                                             CER054
     C                     ADD  PSTA      CMVT                                                CER054
     C                     ELSE                                                               CER054
     C                     ADD  PSTA      DMVT                                                CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     Z-ADD321       DBASE                                               CER054
     C                     UPDATREHISPDF                                                      CER054
     C                     MOVE 'Y'       FCOMIT                                            MD022410
     C                     Z-ADD*ZEROS    DBASE                                               CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ELSE                                                               CER054
     C                     EXSR POSPR                                                         CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C           TSTXCY    IFEQ BCCY                                                          CER054
      *                                                                                       CER054
     C**********           Z-SUBWKTTXB    WPSTA                                      CER054 BUG25343
     C                     Z-SUBWKTTXO    WPSTA                                             BUG25343
     C                     MOVELBBICN     CNUM                                                CER054
     C                     MOVELTSTTAC    ACOD                                                CER054
     C                     Z-ADD1         ACSQ                                                CER054
     C                     Z-ADD0         ACNO                                                CER054
     C                     MOVELRUND      PSTD                                                CER054
      *                                                                                       CER054
     C                     EXSR SUBNAR                                                        CER054
     C                     MOVELNARS      PNAR                                                CER054
      *                                                                                       CER054
     C           WJACC     IFNE 'Y'                                                           CER054
     C                     EXSR GEICPR                                                        CER054
      *                                                                                       CER054
      ** Update history if required                                                           CER054
      ** for the posting amount for the third tax.                                            CER054
      *                                                                                       CER054
     C           ATYP      IFEQ 'R'                                                           CER054
     C           VALD      ANDLENAPDA                                                         CER054
     C           *IN50     ANDEQ*OFF                                                          CER054
     C                     Z-ADD314       DBASE                                               CER054
     C                     MOVE 'N'       REACT                                               CER054
     C                     WRITEREHPOSPF                                                      CER054
     C                     EXSR POSPR                                                         CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                              CER054
     C                     ENDIF                                                           BUG23097A
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRFPOS - Generates foreign postings for EU withholding tax   *                       CGL031
      *           accounting.                                         *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           SRFPOS    BEGSR                                                              CGL031
      *                                                                                       232543
     C********** *IN26     IFEQ *ON                                                    CGL031 232543
      **********                                                                       CGL031 232543
      ***Set*on*indicator to output:                                                   CGL031 232543
      ***-*DR*Ccy Tax Held A/C                                                         CGL031 232543
      ***-*CR*Ccy Spot Position A/C                                                    CGL031 232543
      ***-*CR*Base Ccy Equiv. A/C - Local Ccy                                          CGL031 232543
      ***-*DR*Base Ccy Equiv. A/C - Ccy                                                CGL031 232543
      ***-*CR*Local Ccy Tax Held A/C                                                   CGL031 232543
      ***-*DR*Local Ccy Spot Position A/C                                              CGL031 232543
      **********                                                                       CGL031 232543
     C**********           MOVE *ON       *IN27                                        CGL031 232543
     C**********           Z-ADD10        #                                            CGL031 232543
      **********                                                                       CGL031 232543
      ***Add*6*to record count for these extra postings.                               CGL031 232543
      **********                                                                       CGL031 232543
     C********** *IN29     IFEQ *OFF                                                   CGL031 232543
     C**********           ADD  6         NBRREC                                       CGL031 232543
     C**********           ELSE                                                        CGL031 232543
     C**********           ADD  4         NBRREC                                       CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
      ***Put*accumulated amounts into Base BRT Amount & Sterling Amount                CGL031 232543
      ***for*output.                                                                   CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-ADDWTABC     BSEBRT                                       CGL031 232543
     C**********           Z-ADDWIABC     BSEGRO                                       CGL031 232543
     C**********           Z-ADDWTATC     STRBRT                                       CGL031 232543
     C**********           Z-ADDWIATC     STRGRO                                       CGL031 232543
      **********                                                                       CGL031 232543
      ***Output*postings if Sterling Spot Trade A/C Equiv. Code is                     CGL031 232543
      ***not*zero. Execute SR/PLPR 6 times.                                            CGL031 232543
      **********                                                                       CGL031 232543
      ****If*Analytical Accounting is enabled:                                         CGL031 232543
      ****-*If*posting to spot trade or trade equivalent account,                      CGL031 232543
      ******use*FX Position Profit Centre (already setup in SR/CREPR).                 CGL031 232543
      ****-*Otherwise, use profit centre of the main account.                          CGL031 232543
      **********                                                                       CGL031 232543
     C********** *IN29     IFEQ *OFF                                                   CGL031 232543
      **********                                                                       CGL031 232543
     C********** BRTAM2    IFNE *ZERO                                                  CGL031 232543
     C**********           MOVE BCCY      CCY                                          CGL031 232543
     C**********           MOVE ACOD1     ACOD                                         CGL031 232543
     C**********           MOVE *BLANKS   IPDN                                         CGL031 232543
     C**********           Z-ADDBRTAM2    WPSTA                                        CGL031 232543
     C**********           MOVE *BLANKS   MGTT                                         CGL031 232543
     C**********           Z-ADD*ZERO     LTAI                                         CGL031 232543
     C**********           MOVE *BLANKS   RINO                                         CGL031 232543
     C**********           MOVE *BLANKS   SWCR                                         CGL031 232543
     C**********           MOVE *BLANKS   DLREF                                        CGL031 232543
     C**********           MOVE *BLANKS   FACO                                         CGL031 232543
     C**********           Z-ADD*ZERO     DBCNUM                                       CGL031 232543
     C**********           MOVE *BLANKS   PREF                                         CGL031 232543
     C**********           MOVE *BLANKS   OTRF                                         CGL031 232543
     C**********           MOVE *BLANKS   OTST                                         CGL031 232543
     C**********           Z-ADD*ZERO     SDCB                                         CGL031 232543
     C**********           Z-ADD*ZERO     SDLB                                         CGL031 232543
     C**********           MOVE *BLANKS   BOKC                                         CGL031 232543
     C**********           Z-ADD1         NITMS                                        CGL031 232543
     C**********           MOVE *BLANKS   REBI                                         CGL031 232543
     C**********           Z-ADD*ZERO     CHGA                                         CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
      **********                                                                       CGL031 232543
     C**********           MOVE SPAC      ACOD                                         CGL031 232543
      **********                                                                       CGL031 232543
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 232543
     C**********           MOVE WFXPC     PRFC                                         CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-SUBBRTAM2    WPSTA                                        CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
     C**********                                                                       CGL031 232543
     C********** BSEBRT    IFNE *ZERO                                                  CGL031 232543
     C**********           MOVE BACCY     CCY                                          CGL031 232543
     C**********                                                                       CGL031 232543
     C**********           CALL 'AOCURRR0'                                             CGL031 232543
     C**********           PARM '*MSG   ' PRTCD                                        CGL031 232543
     C**********           PARM '*KEY   ' POPTN                                        CGL031 232543
     C**********           PARM TSTXCY    PCYCD   3                                    CGL031 232543
     C********** SDCURR    PARM SDCURR    DSSDY                                        CGL031 232543
      **********                                                                       CGL031 232543
     C********** PRTCD     IFNE *BLANKS                                                CGL031 232543
     C********** *LOCK     IN   LDA                                                    CGL031 232543
     C**********           MOVEL'SDCURRPD'DBFILE                                       CGL031 232543
     C**********           MOVELPCYCD     DBKEY                                        CGL031 232543
     C**********           Z-ADD303       DBASE                                        CGL031 232543
     C**********           OUT  LDA                                                    CGL031 232543
     C**********           EXSR *PSSR                                                  CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           MOVE TACC      ACOD                                         CGL031 232543
      **********                                                                       CGL031 232543
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 232543
     C**********           MOVE WFXPC     PRFC                                         CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-SUBBSEBRT    WPSTA                                        CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
      **********                                                                       CGL031 232543
     C**********           CALL 'AOCURRR0'                                             CGL031 232543
     C**********           PARM '*MSG   ' PRTCD                                        CGL031 232543
     C**********           PARM '*KEY   ' POPTN                                        CGL031 232543
     C**********           PARM BCCY      PCYCD                                        CGL031 232543
     C********** SDCURR    PARM SDCURR    DSSDY                                        CGL031 232543
      **********                                                                       CGL031 232543
     C********** PRTCD     IFNE *BLANKS                                                CGL031 232543
     C********** *LOCK     IN   LDA                                                    CGL031 232543
     C**********           MOVEL'SDCURRPD'DBFILE                                       CGL031 232543
     C**********           MOVELPCYCD     DBKEY                                        CGL031 232543
     C**********           Z-ADD304       DBASE                                        CGL031 232543
     C**********           OUT  LDA                                                    CGL031 232543
     C**********           EXSR *PSSR                                                  CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           MOVE TACC      ACOD                                         CGL031 232543
      **********                                                                       CGL031 232543
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 232543
     C**********           MOVE WFXPC     PRFC                                         CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-ADDBSEBRT    WPSTA                                        CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C********** STRBRT    IFNE *ZERO                                                  CGL031 232543
     C**********           MOVE TSTXCY    CCY                                          CGL031 232543
     C**********           MOVE ACOD1     ACOD                                         CGL031 232543
      **********                                                                       CGL031 232543
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 232543
     C**********           MOVE WSVPC     PRFC                                         CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-SUBSTRBRT    WPSTA                                        CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
     C**********           MOVE SPAC      ACOD                                         CGL031 232543
      **********                                                                       CGL031 232543
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 232543
     C**********           MOVE WFXPC     PRFC                                         CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-ADDSTRBRT    WPSTA                                        CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           ELSE                                                        CGL031 232543
      **********                                                                       CGL031 232543
     C********** BRTAM2    IFNE *ZERO                                                  CGL031 232543
     C**********           MOVE BCCY      CCY                                          CGL031 232543
     C**********           MOVE ACOD1     ACOD                                         CGL031 232543
     C**********           MOVE *BLANKS   IPDN                                         CGL031 232543
     C**********           Z-ADDBRTAM2    WPSTA                                        CGL031 232543
     C**********           MOVE ABRCA     BRCA                                         CGL031 232543
     C**********           MOVE *BLANKS   MGTT                                         CGL031 232543
     C**********           Z-ADD*ZERO     LTAI                                         CGL031 232543
     C**********           MOVE *BLANKS   RINO                                         CGL031 232543
     C**********           MOVE *BLANKS   SWCR                                         CGL031 232543
     C**********           MOVE *BLANKS   DLREF                                        CGL031 232543
     C**********           MOVE *BLANKS   FACO                                         CGL031 232543
     C**********           Z-ADD*ZERO     DBCNUM                                       CGL031 232543
     C**********           MOVE *BLANKS   PREF                                         CGL031 232543
     C**********           MOVE *BLANKS   OTRF                                         CGL031 232543
     C**********           MOVE *BLANKS   OTST                                         CGL031 232543
     C**********           Z-ADD*ZERO     SDCB                                         CGL031 232543
     C**********           Z-ADD*ZERO     SDLB                                         CGL031 232543
     C**********           MOVE *BLANKS   BOKC                                         CGL031 232543
     C**********           Z-ADD1         NITMS                                        CGL031 232543
     C**********           MOVE *BLANKS   REBI                                         CGL031 232543
     C**********           Z-ADD*ZERO     CHGA                                         CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
      **********                                                                       CGL031 232543
     C**********           MOVE SPAC      ACOD                                         CGL031 232543
      **********                                                                       CGL031 232543
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 232543
     C**********           MOVE WFXPC     PRFC                                         CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-SUBBRTAM2    WPSTA                                        CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C********** BSEBRT    IFNE *ZERO                                                  CGL031 232543
     C**********           CALL 'AOCURRR0'                                             CGL031 232543
     C**********           PARM '*MSG   ' PRTCD                                        CGL031 232543
     C**********           PARM '*KEY   ' POPTN                                        CGL031 232543
     C**********           PARM BCCY      PCYCD                                        CGL031 232543
     C********** SDCURR    PARM SDCURR    DSSDY                                        CGL031 232543
      **********                                                                       CGL031 232543
     C********** PRTCD     IFNE *BLANKS                                                CGL031 232543
     C********** *LOCK     IN   LDA                                                    CGL031 232543
     C**********           MOVEL'SDCURRPD'DBFILE                                       CGL031 232543
     C**********           MOVELPCYCD     DBKEY                                        CGL031 232543
     C**********           Z-ADD305       DBASE                                        CGL031 232543
     C**********           OUT  LDA                                                    CGL031 232543
     C**********           EXSR *PSSR                                                  CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           MOVE TACC      ACOD                                         CGL031 232543
      **********                                                                       CGL031 232543
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 232543
     C**********           MOVE WFXPC     PRFC                                         CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           MOVE BACCY     CCY                                          CGL031 232543
     C**********           Z-ADDBSEBRT    WPSTA                                        CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C********** STRBRT    IFNE *ZERO                                                  CGL031 232543
     C**********           MOVE TSTXCY    CCY                                          CGL031 232543
      **********                                                                       CGL031 232543
     C**********           MOVE ACOD1     ACOD                                         CGL031 232543
      **********                                                                       CGL031 232543
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 232543
     C**********           MOVE WSVPC     PRFC                                         CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           Z-SUBSTRBRT    WPSTA                                        CGL031 232543
     C**********           EXSR PLPR                                                   CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
     C**********           ENDIF                                                       CGL031 232543
      **********                                                                       CGL031 232543
      *                                                                                       232543
      ** Initialise relevant fields.                                                          232543
      *                                                                                       232543
     C                     ADD  4         NBRREC                                              232543
     C                     MOVE *BLANKS   IPDN                                                232543
     C                     MOVE *BLANKS   MGTT                                                232543
     C                     Z-ADD*ZERO     LTAI                                                232543
     C                     MOVE *BLANKS   RINO                                                232543
     C                     MOVE *BLANKS   SWCR                                                232543
     C                     MOVE *BLANKS   DLREF                                               232543
     C                     MOVE *BLANKS   FACO                                                232543
     C**********           Z-ADD*ZERO     DBCNUM                                      232543 CSD027A
     C                     MOVE *BLANKS   DBCNUM                                             CSD027A
     C                     MOVE *BLANKS   PREF                                                232543
     C                     MOVE *BLANKS   OTRF                                                232543
     C                     MOVE *BLANKS   OTST                                                232543
     C                     Z-ADD*ZERO     SDCB                                                232543
     C                     Z-ADD*ZERO     SDLB                                                232543
     C                     MOVE *BLANKS   BOKC                                                232543
     C                     MOVE *BLANKS   REBI                                                232543
     C                     Z-ADD*ZERO     CHGA                                                232543
     C                     Z-ADD1         NITMS                                               232543
      *                                                                                       232543
      ** CR A/c Ccy Spot Trade                                                                232543
      ***DR*A/c*Ccy*EU*Withholding*Tax                                                 232543 235307
      *                                                                                       232543
     C           WTAOC     IFNE *ZERO                                                         232543
     C                     MOVE BCCY      CCY                                                 232543
      *                                                                                       232543
      ** Use the FX Position Profit Centre if posting to Spot Trade or Trade Equiv.           232543
      ** A/c. Use the Profit Centre of the main a/c otherwise.                                232543
      *                                                                                       232543
     C           BGN0ST    IFEQ 'Y'                                                           232543
     C                     MOVE WFXPC     PRFC                                                232543
     C                     ENDIF                                                              232543
      *                                                                                       232543
     C                     MOVE SPAC      ACOD                                                232543
     C                     Z-SUBWTAOC     WPSTA                                               232543
     C                     EXSR PLPR                                                          232543
      *                                                                                       232543
     C                     MOVE *BLANKS   PRFC                                                232543
      *                                                                                       232543
     C***********          MOVE WEWTA     ACOD                                         232543 235307
     C***********          Z-ADDWTAOC     WPSTA                                        232543 235307
     C***********          EXSR PLPR                                                   232543 235307
     C                     ENDIF                                                              232543
      *                                                                                       232543
      ** Get Base Ccy details.                                                                232543
      *                                                                                       232543
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BACCY     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    232543
     C                     PARM *BLANKS   PRTCD                                               232543
     C                     PARM '*KEY   ' POPTN                                               232543
     C                     PARM BACCY     PCCY    3                                           232543
     C           SDCURR    PARM SDCURR    DSSDY                                               232543
      *                                                                                       232543
     C           PRTCD     IFNE *BLANKS                                                       232543
     C           *LOCK     IN   LDA                                                           232543
     C                     MOVEL'SDCURRPD'DBFILE                                              232543
     C                     MOVELPCCY      DBKEY                                               232543
     C                     Z-ADD303       DBASE                                               232543
     C                     OUT  LDA                                                           232543
     C                     EXSR *PSSR                                                         232543
     C                     ENDIF                                                              232543
     C                     ENDIF                                                            CRE083BK
      *                                                                                       232543
      ** Generate Spot Trade Equiv. postings if necessary.                                    232543
      *                                                                                       232543
     C           BCCY      IFNE BACCY                                                         232543
     C           WTABC     ANDNE*ZERO                                                         232543
     C           BCCY      OREQ BACCY                                                         232543
     C           TACC      ANDNE*BLANKS                                                       232543
     C           WTABC     ANDNE*ZERO                                                         232543
      *                                                                                       232543
      ** DR Base Ccy Spot Trade Equiv. A/c Ccy                                                232543
      ** CR Base Ccy Spot Trade Equiv. Tax Ccy                                                232543
      *                                                                                       232543
     C           BGN0ST    IFEQ 'Y'                                                           232543
     C                     MOVE WFXPC     PRFC                                                232543
     C                     ENDIF                                                              232543
      *                                                                                       232543
     C                     ADD  2         NBRREC                                              232543
     C                     MOVE BACCY     CCY                                                 232543
      *                                                                                       232543
      ** Get A/c Ccy details.                                                                 232543
      *                                                                                       232543
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY      LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    232543
     C                     PARM *BLANKS   PRTCD                                               232543
     C                     PARM '*KEY   ' POPTN                                               232543
     C                     PARM BCCY      PCCY                                                232543
     C           SDCURR    PARM SDCURR    DSSDY                                               232543
      *                                                                                       232543
     C           PRTCD     IFNE *BLANKS                                                       232543
     C           *LOCK     IN   LDA                                                           232543
     C                     MOVEL'SDCURRPD'DBFILE                                              232543
     C                     MOVELPCCY      DBKEY                                               232543
     C                     Z-ADD304       DBASE                                               232543
     C                     OUT  LDA                                                           232543
     C                     EXSR *PSSR                                                         232543
     C                     ENDIF                                                              232543
     C                     ENDIF                                                            CRE083BK
      *                                                                                       232543
     C                     MOVE TACC      ACOD                                                232543
     C                     Z-ADDWTABC     WPSTA                                               232543
     C                     EXSR PLPR                                                          232543
      *                                                                                       232543
      ** Get Tax Ccy details.                                                                 232543
      *                                                                                       232543
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           TSTXCY    LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    232543
     C                     PARM *BLANKS   PRTCD                                               232543
     C                     PARM '*KEY   ' POPTN                                               232543
     C                     PARM TSTXCY    PCCY                                                232543
     C           SDCURR    PARM SDCURR    DSSDY                                               232543
      *                                                                                       232543
     C           PRTCD     IFNE *BLANKS                                                       232543
     C           *LOCK     IN   LDA                                                           232543
     C                     MOVEL'SDCURRPD'DBFILE                                              232543
     C                     MOVELPCCY      DBKEY                                               232543
     C                     Z-ADD305       DBASE                                               232543
     C                     OUT  LDA                                                           232543
     C                     EXSR *PSSR                                                         232543
     C                     ENDIF                                                              232543
     C                     ENDIF                                                            CRE083BK
      *                                                                                       232543
     C                     MOVE TACC      ACOD                                                232543
     C                     Z-SUBWTABC     WPSTA                                               232543
     C                     EXSR PLPR                                                          232543
      *                                                                                       232543
     C                     ENDIF                                                              232543
      *                                                                                       232543
      ** DR Tax Ccy Spot Trade A/c                                                            232543
      ** CR Tax Ccy EU Witholding Tax A/c                                                     232543
      *                                                                                       232543
     C           WTATC     IFNE *ZERO                                                         232543
     C                     MOVE TSTXCY    CCY                                                 232543
      *                                                                                       232543
     C                     MOVE SPAC      ACOD                                                232543
     C                     Z-ADDWTATC     WPSTA                                               232543
     C                     EXSR PLPR                                                          232543
      *                                                                                       232543
      ** EU tax postings are written by subroutine SREATA per Joint A/c                       235174
      ** member given a Joint A/c.                                                            235174
      *                                                                                       235174
     C           WJACC     IFNE 'Y'                                                           235174
     C                     MOVE WEWTA     ACOD                                                232543
     C                     Z-SUBWTATC     WPSTA                                               232543
     C                     EXSR PLPR                                                          232543
     C                     ENDIF                                                              235174
     C                     ENDIF                                                              232543
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
     C           WKSTXO    IFNE *ZEROS                                                        CER048
     C                     MOVELBCCY      CCY                                                 CER048
      *                                                                                       CER048
     C           BGN0ST    IFEQ 'Y'                                                           CER048
     C                     MOVELWFXPC     PRFC                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     MOVELSPAC      ACOD                                                CER048
     C**********           MOVELWKSTXO    WPSTA                                     CER048 BUG23097A
     C                     Z-SUBWKSTXO    WPSTA                                            BUG23097A
      *                                                                                       CER048
     C                     EXSR PLPR                                                          CER048
     C                     MOVEL*BLANKS   PRFC                                                CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BACCY     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    CER048
     C                     PARM '*MSG   ' @RTCD                                               CER048
     C                     PARM '*KEY   ' @OPTN                                               CER048
     C                     PARM BACCY     @CYCD                                               CER048
     C           SDCURR    PARM SDCURR    DSSDY                                               CER048
     C                     ENDIF                                                            CRE083BK
      *                                                                                       CER048
     C           BCCY      IFNE BACCY                                                         CER048
     C           WKSTXB    ANDNE*ZEROS                                                        CER048
     C           BCCY      OREQ BACCY                                                         CER048
     C           TACC      ANDNE*BLANKS                                                       CER048
     C           WKSTXB    ANDNE*ZEROS                                                        CER048
      *                                                                                       CER048
     C           BGN0ST    IFEQ 'Y'                                                           CER048
     C                     MOVELWFXPC     PRFC                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     Z-ADD2         NBRREC                                              CER048
     C                     MOVELBACCY     CCY                                                 CER048
      *                                                                                       CER048
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY      LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    CER048
     C                     PARM '*MSG   ' @RTCD                                               CER048
     C                     PARM '*KEY   ' @OPTN                                               CER048
     C                     PARM BCCY      @CYCD                                               CER048
     C           SDCURR    PARM SDCURR    DSSDY                                               CER048
     C                     ENDIF                                                            CRE083BK
      *                                                                                       CER048
     C                     MOVELTACC      ACOD                                                CER048
     C**********           MOVELWKSTXB    WPSTA                                     CER048 BUG23097A
     C                     Z-ADDWKSTXB    WPSTA                                            BUG23097A
      *                                                                                       CER048
     C                     EXSR PLPR                                                          CER048
      *                                                                                       CER048
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           TSTXCY    LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    CER048
     C                     PARM '*MSG   ' @RTCD                                               CER048
     C                     PARM '*KEY   ' @OPTN                                               CER048
     C                     PARM TSTXCY    @CYCD                                               CER048
     C           SDCURR    PARM SDCURR    DSSDY                                               CER048
     C                     ENDIF                                                            CRE083BK
      *                                                                                       CER048
     C                     MOVELTACC      ACOD                                                CER048
     C**********           MOVELWKSTXB    WPSTA                                     CER048 BUG23097A
     C                     Z-SUBWKSTXB    WPSTA                                            BUG23097A
     C                     EXSR PLPR                                                          CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           WKSTXT    IFNE *ZEROS                                                        CER048
      *                                                                                       CER048
     C                     MOVELTSTXCY    CCY                                                 CER048
     C                     MOVELSPAC      ACOD                                                CER048
     C**********           MOVELWKSTXT    WPSTA                                     CER048 BUG23097A
     C                     Z-ADDWKSTXT    WPSTA                                            BUG23097A
     C                     EXSR PLPR                                                          CER048
      *                                                                                       CER048
     C           WJACC     IFNE 'Y'                                                           CER048
      *                                                                                       CER048
     C                     MOVELWSTAC     ACOD                                                CER048
     C**********           MOVELWKSTXT    WPSTA                                     CER048 BUG23097A
     C                     Z-SUBWKSTXT    WPSTA                                            BUG23097A
     C                     EXSR PLPR                                                          CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER054
     C           CER054    IFEQ 'Y'                                                           CER054
      *                                                                                       CER054
     C           WKTTXO    IFNE *ZEROS                                                        CER054
     C                     MOVELBCCY      CCY                                                 CER054
      *                                                                                       CER054
     C           BGN0ST    IFEQ 'Y'                                                           CER054
     C                     MOVELWFXPC     PRFC                                                CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     MOVELSPAC      ACOD                                                CER054
     C                     Z-SUBWKTTXO    WPSTA                                               CER054
      *                                                                                       CER054
     C                     EXSR PLPR                                                          CER054
     C                     MOVEL*BLANKS   PRFC                                                CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BACCY     LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    CER054
     C                     PARM '*MSG   ' @RTCD                                               CER054
     C                     PARM '*KEY   ' @OPTN                                               CER054
     C                     PARM BACCY     @CYCD                                               CER054
     C           SDCURR    PARM SDCURR    DSSDY                                               CER054
     C                     ENDIF                                                            CRE083BK
      *                                                                                       CER054
     C           BCCY      IFNE BACCY                                                         CER054
     C           WKTTXB    ANDNE*ZEROS                                                        CER054
     C           BCCY      OREQ BACCY                                                         CER054
     C           TACC      ANDNE*BLANKS                                                       CER054
     C           WKTTXB    ANDNE*ZEROS                                                        CER054
      *                                                                                       CER054
     C           BGN0ST    IFEQ 'Y'                                                           CER054
     C                     MOVELWFXPC     PRFC                                                CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     Z-ADD2         NBRREC                                              CER054
     C                     MOVELBACCY     CCY                                                 CER054
      *                                                                                       CER054
     C                     Z-ADDCUCCYA    A                                                 CRE083BK
     C           BCCY      LOKUPACUR,A                   17                                 CRE083BK
      *                                                                                     CRE083BK
     C           *IN17     IFEQ '1'                                                         CRE083BK
     C           A         OCUR SDCURR                                                      CRE083BK
     C                     ELSE                                                             CRE083BK
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    CER054
     C                     PARM '*MSG   ' @RTCD                                               CER054
     C                     PARM '*KEY   ' @OPTN                                               CER054
     C                     PARM BCCY      @CYCD                                               CER054
     C           SDCURR    PARM SDCURR    DSSDY                                               CER054
     C                     ENDIF                                                            CRE083BK
      *                                                                                       CER054
     C                     MOVELTACC      ACOD                                                CER054
     C                     Z-ADDWKTTXB    WPSTA                                               CER054
      *                                                                                       CER054
     C                     EXSR PLPR                                                          CER054
      *                                                                                       CER054
     C                     Z-ADDCUCCYA    A                                                 MD021155
     C           BCCY      LOKUPACUR,A                   17                                 MD021155
      *                                                                                     MD021155
     C           *IN17     IFEQ '1'                                                         MD021155
     C           A         OCUR SDCURR                                                      MD021155
     C                     ELSE                                                             MD021155
     C           1         OCUR SDCURR                                                      MD021155
     C                     CALL 'AOCURRR0'                                                    CER054
     C                     PARM '*MSG   ' @RTCD                                               CER054
     C                     PARM '*KEY   ' @OPTN                                               CER054
     C                     PARM TSTXCY    @CYCD                                               CER054
     C           SDCURR    PARM SDCURR    DSSDY                                               CER054
     C                     ENDIF                                                            MD021155
      *                                                                                       CER054
     C                     MOVELTACC      ACOD                                                CER054
     C                     Z-SUBWKTTXB    WPSTA                                               CER054
     C                     EXSR PLPR                                                          CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C           WKTTXT    IFNE *ZEROS                                                        CER054
      *                                                                                       CER054
     C                     MOVELTSTXCY    CCY                                                 CER054
     C                     MOVELSPAC      ACOD                                                CER054
     C                     Z-ADDWKTTXT    WPSTA                                               CER054
     C                     EXSR PLPR                                                          CER054
      *                                                                                       CER054
     C           WJACC     IFNE 'Y'                                                           CER054
      *                                                                                       CER054
     C                     MOVELWSTAC     ACOD                                                CER054
     C                     Z-SUBWKTTXT    WPSTA                                               CER054
     C                     EXSR PLPR                                                          CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       232543
     C                     ENDSR                                                              CGL031
      *****************************************************************                       235174
      /EJECT                                                                                  235174
      *****************************************************************                       235174
      *                                                               *                       235174
      *  SREATA - EU a/c key generation for tax amount (Joint A/c).   *                       235174
      *                                                               *                       235174
      *****************************************************************                       235174
     C           SREATA    BEGSR                                                              235174
      *                                                                                       235174
     C********** TSTXSR    IFGT *ZERO                                                  235174 235875
     C           TSTXSR    IFNE *ZERO                                                         235875
     C           TSTXCY    IFEQ BCCY                                                          235174
      *                                                                                       235174
     C                     Z-SUBTSTXSR    WPSTA                                               235174
      *                                                                                     MD026742
      ** For Negative Cr. Int. Adj. with negative tax.                                      MD026742
      *                                                                                     MD026742
     C           CAIC      IFLT 0                                                           MD026742
     C           TSTXSR    ANDLT0                                                           MD026742
     C                     Z-ADDTSTXSR    WPSTA                                             MD026742
     C                     ENDIF                                                            MD026742
      *                                                                                     MD026742
     C                     MOVE BBICN     CNUM                                                235174
     C                     Z-ADDWEWTA     ACOD                                                235174
     C                     Z-ADD1         ACSQ                                                235174
     C                     Z-ADD*ZERO     ACNO                                                235174
     C                     Z-ADDRUND      VALD                                                235174
     C                     EXSR SUBNAR                                                        235174
      *                                                                                     BUG23163
     C           CER048    IFEQ 'Y'                                                         BUG23163
     C                     MOVELCPRITX    NARS      P                                       BUG23163
     C                     ENDIF                                                            BUG23163
      *                                                                                     BUG23163
     C                     MOVE NARS      PNAR                                                235174
     C                     EXSR GEICPR                                                        235174
      *                                                                                       235174
      ** Update history if required (second time).                                            235174
      *                                                                                       235174
     C           ATYP      IFEQ 'R'                                                           235174
     C           VALD      ANDLENAPDA                                                         235174
     C           *IN50     ANDEQ*OFF                                                          235174
     C                     Z-ADD137       DBASE                                               235174
     C                     MOVE 'N'       REACT                                               235174
     C                     WRITEREHPOSPF                                                      235174
     C                     EXSR POSPR                                                         235174
     C                     ENDIF                                                              235174
      *                                                                                       235174
     C                     ENDIF                                                              235174
     C                     ENDIF                                                              235174
      *                                                                                       235174
     C           TSTXSC    IFNE *ZERO                                                         235174
     C           TSTXCY    IFNE BCCY                                                          235917
     C                     MOVE TSTXCY    CCY                                                 235174
     C                     MOVE WEWTA     ACOD                                                235174
     C                     Z-SUBTSTXSC    WPSTA                                               235174
     C                     MOVE BBICN     CNUM                                                235917
     C                     Z-ADD1         ACSQ                                                235917
     C                     Z-ADD*ZERO     ACNO                                                235917
     C                     Z-ADDRUND      VALD                                                235917
     C                     EXSR PLPR                                                          235174
     C                     ENDIF                                                              235917
     C                     ENDIF                                                              235174
      *                                                                                       CER048
      ** Set up the account keys for secondary tax                                            CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
     C           TSTXSR    IFNE *ZEROS                                                        CER048
     C           TSSTDO    ANDNE*ZEROS                                                        CER048
      *                                                                                       CER048
     C           TSTXCY    IFEQ BCCY                                                          CER048
      *                                                                                       CER048
     C                     MOVELBCCY      CCY                                                 CER048
     C**********           MOVELTSSTDO    WPSTA                                     CER048 BUG23097A
     C                     Z-SUBTSSTDO    WPSTA                                            BUG23097A
      *                                                                                     MD026742
      ** For Negative Cr. Int. Adj. with negative tax.                                      MD026742
      *                                                                                     MD026742
     C           CAIC      IFLT 0                                                           MD026742
     C           TSTXSR    ANDLT0                                                           MD026742
     C           TSSTDO    ANDLT0                                                           MD026742
     C                     Z-ADDTSSTDO    WPSTA                                             MD026742
     C                     ENDIF                                                            MD026742
      *                                                                                     MD026742
     C                     MOVELBBICN     CNUM                                                CER048
     C                     MOVELTSSTAC    ACOD                                                CER048
     C                     Z-ADD1         ACSQ                                                CER048
     C                     Z-ADD0         ACNO                                                CER048
     C                     MOVELRUND      VALD                                                CER048
      *                                                                                       CER048
     C                     EXSR SUBNAR                                                        CER048
      *                                                                                       CER048
     C**********           MOVELPNAR      NARS                                       CER048 BUG23163
     C                     MOVELC2NDTX    NARS      P                                       BUG23163
     C                     MOVELNARS      PNAR                                              BUG23163
      *                                                                                       CER048
     C                     EXSR GEICPR                                                        CER048
      *                                                                                       CER048
      ** Update history if required (Third time)                                              CER048
      ** for the posting amount for the secondary tax.                                        CER048
      *                                                                                       CER048
     C           ATYP      IFEQ 'R'                                                           CER048
     C           VALD      ANDLENAPDA                                                         CER048
     C           *IN50     ANDEQ*OFF                                                          CER048
     C                     Z-ADD315       DBASE                                               CER048
     C                     MOVE 'N'       REACT                                               CER048
     C                     WRITEREHPOSPF                                                      CER048
     C                     EXSR POSPR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           TSTXSC    IFNE *ZEROS                                                        CER048
     C********** TSSTDB    ANDNE*ZEROS                                              CER048 BUG23097A
     C           TSSTDT    ANDNE*ZEROS                                                     BUG23097A
      *                                                                                       CER048
     C           TSTXCY    IFNE BCCY                                                          CER048
      *                                                                                       CER048
     C                     MOVELTSTXCY    CCY                                                 CER048
     C**********           MOVELTSSTDB    WPSTA                                     CER048 BUG23097A
     C                     Z-SUBTSSTDT    WPSTA                                            BUG23097A
     C                     MOVELBBICN     CNUM                                                CER048
     C                     MOVELTSSTAC    ACOD                                                CER048
     C                     Z-ADD1         ACSQ                                                CER048
     C                     Z-ADD0         ACNO                                                CER048
     C                     MOVELRUND      VALD                                                CER048
      *                                                                                       CER048
     C                     EXSR PLPR                                                          CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER054
      ** Set up the account keys for third tax                                                CER054
      *                                                                                       CER054
     C           CER054    IFEQ 'Y'                                                           CER054
      *                                                                                       CER054
     C           TSTXSR    IFNE *ZEROS                                                        CER054
     C           TSSTDO    ANDNE*ZEROS                                                        CER054
     C           TSTTDO    ANDNE*ZEROS                                                        CER054
      *                                                                                       CER054
     C           TSTXCY    IFEQ BCCY                                                          CER054
      *                                                                                       CER054
     C                     MOVELBCCY      CCY                                                 CER054
     C                     Z-SUBTSTTDO    WPSTA                                               CER054
      *                                                                                     MD026742
      ** For Negative Cr. Int. Adj. with negative tax.                                      MD026742
      *                                                                                     MD026742
     C           CAIC      IFLT 0                                                           MD026742
     C           TSTXSR    ANDLT0                                                           MD026742
     C           TSSTDO    ANDLT0                                                           MD026742
     C           TSTTDO    ANDLT0                                                           MD026742
     C                     Z-ADDTSTTDO    WPSTA                                             MD026742
     C                     ENDIF                                                            MD026742
      *                                                                                     MD026742
     C                     MOVELBBICN     CNUM                                                CER054
     C                     MOVELTSTTAC    ACOD                                                CER054
     C                     Z-ADD1         ACSQ                                                CER054
     C                     Z-ADD0         ACNO                                                CER054
     C                     MOVELRUND      VALD                                                CER054
      *                                                                                       CER054
     C                     EXSR SUBNAR                                                        CER054
      *                                                                                       CER054
     C**********           MOVELPNAR      NARS                                       CER054 BUG24341
     C                     MOVELC3RDTX    NARS      P                                       BUG24341
     C                     MOVELNARS      PNAR                                              BUG24341
      *                                                                                       CER054
     C                     EXSR GEICPR                                                        CER054
      *                                                                                       CER054
      ** Update history if required                                                           CER054
      ** for the posting amount for the third tax.                                            CER054
      *                                                                                       CER054
     C           ATYP      IFEQ 'R'                                                           CER054
     C           VALD      ANDLENAPDA                                                         CER054
     C           *IN50     ANDEQ*OFF                                                          CER054
     C                     Z-ADD315       DBASE                                               CER054
     C                     MOVE 'N'       REACT                                               CER054
     C                     WRITEREHPOSPF                                                      CER054
     C                     EXSR POSPR                                                         CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C           TSTXSC    IFNE *ZEROS                                                        CER054
     C********** TSSTDB    ANDNE*ZEROS                                               CER054 BUG25343
     C********** TSTTDB    ANDNE*ZEROS                                               CER054 BUG25343
     C           TSSTDT    ANDNE*ZEROS                                                      BUG25343
     C           TSTTDT    ANDNE*ZEROS                                                      BUG25343
      *                                                                                       CER054
     C           TSTXCY    IFNE BCCY                                                          CER054
      *                                                                                       CER054
     C                     MOVELTSTXCY    CCY                                                 CER054
     C**********           Z-SUBTSTTDB    WPSTA                                      CER054 BUG25343
     C                     Z-SUBTSTTDT    WPSTA                                             BUG25343
     C                     MOVELBBICN     CNUM                                                CER054
     C                     MOVELTSTTAC    ACOD                                                CER054
     C                     Z-ADD1         ACSQ                                                CER054
     C                     Z-ADD0         ACNO                                                CER054
     C                     MOVELRUND      VALD                                                CER054
      *                                                                                       CER054
     C                     EXSR PLPR                                                          CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       235174
     C                     ENDSR                                                              235174
      *****************************************************************                       CDL081
      /EJECT                                                                                  CDL081
      *****************************************************************                       CDL081
      *                                                               *                       CDL081
      *  WCONV - Convert Amount from One Currency to Another          *                       CDL081
      *                                                               *                       CDL081
      *****************************************************************                       CDL081
      **##########################################################                            CDL081
      **##                                                      ##                            CDL081
      **## THIS ROUTINE IS A COPY OF ZSRSRC/ZCONVZ1             ##                            CDL081
      **## BUT THE HALF ADJUST ROUNDING HAS BEEN REMOVED.       ##                            CDL081
      **##                                                      ##                            CDL081
      **##  *** Changes done to ZCONVZ1 may need to be   ***    ##                            CDL081
      **##  *** applied in this sub-routine too.         ***    ##                            CDL081
      **##                                                      ##                            CDL081
      **##########################################################                            CDL081
      *                                                                                       CDL081
      **   INPUT  - ZAMTCI (15,0) Amount input                                                CDL081
      **            ZEXCH  (13,8) Exchange rate                                               CDL081
      **            ZMD    (1)    Multiply/divide indicator                                   CDL081
      **            ZCCYI  (3)    Currency input                                              CDL081
      **            ZCCYO  (3)    Currency to be converted to                                 CDL081
      **            POWER   -     Compile time array must be included                         CDL081
      **                          in the program source                                       CDL081
      **            ZCDPI  (1,0)  (FROM) Currency decimal places                              CDL081
      **            ZCDPO  (1,0)  (TO) Currency decimal places                                CDL081
      **                                                                                      CDL081
      **  OUTPUT -  ZAMTCO (15,0) Amount output                                               CDL081
      **                                                                                      CDL081
      *****************************************************************                       CDL081
     C           WCONV     BEGSR                                                              CDL081
      *                                                                                       CDL081
      ** Define input and output fields                                                       CDL081
      *                                                                                       CDL081
     C                     MOVE ZCCYI     ZCCYI   3                                           CDL081
     C                     MOVE ZCCYO     ZCCYO   3                                           CDL081
     C                     Z-ADDZCDPI     ZCDPI   10                                          CDL081
     C                     Z-ADDZCDPO     ZCDPO   10                                          CDL081
     C                     Z-ADDZAMTCI    ZAMTCI 150                                          CDL081
     C                     Z-ADD0         ZAMTCO 150                                          CDL081
     C                     Z-ADDZEXCH     ZEXCH  138                                          CDL081
     C                     MOVE ZMD       ZMD     1                                           CDL081
      *                                                                                       CDL081
      ** If exchange rate is 0 - output currency amount is zero                               CDL081
      *                                                                                       CDL081
     C           ZEXCH     IFEQ 0                                                             CDL081
     C                     Z-ADD0         ZAMTCO                                              CDL081
     C                     GOTO EWCONV                                                        CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
      ** If decimal places are the same for both currencies                                   CDL081
      *                                                                                       CDL081
     C           ZCDPI     IFEQ ZCDPO                                                         CDL081
      *                                                                                       CDL081
      ** Calculate output currency amount by dividing exchange rate into                      CDL081
      ** or multiplying exchange rate by currency amount input depending                      CDL081
      ** on indicator                                                                         CDL081
      *                                                                                       CDL081
      ** When converting from base ccy back to EUR , inverted value of                        CDL081
      ** MDIN should be used. Check for unique field WUFLAG to validate                       CDL081
      ** it has been called from DL0410 .                                                     CDL081
      *                                                                                       CDL081
      ** Define new fields lengths                                                            CDL081
      *                                                                                       CDL081
     C                     MOVE WBINCY    WBINCY  1                                           CDL081
     C                     MOVE WUFLAG    WUFLAG  1                                           CDL081
     C           WUFLAG    IFEQ 'Y'                                                           CDL081
     C           WBINCY    ANDNE'Y'                                                           CDL081
      *                                                                                       CDL081
     C           ZMD       IFEQ 'D'                                                           CDL081
     C           ZAMTCI    MULT ZEXCH     ZAMTCO                                              CDL081
     C                     ELSE                                                               CDL081
     C           ZAMTCI    DIV  ZEXCH     ZAMTCO                                              CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     ELSE                                                               CDL081
     C           ZMD       IFEQ 'D'                                                           CDL081
     C           ZAMTCI    DIV  ZEXCH     ZAMTCO                                              CDL081
     C                     ELSE                                                               CDL081
     C           ZAMTCI    MULT ZEXCH     ZAMTCO                                              CDL081
     C                     END                                                                CDL081
     C*                                                                                       CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     ELSE                                                               CDL081
      *                                                                                       CDL081
      ** If decimal places differ -                                                           CDL081
      ** Calculate difference in decimal places to use as power index                         CDL081
      *                                                                                       CDL081
     C           ZCDPO     SUB  ZCDPI     ZPX     10                                          CDL081
     C                     ADD  4         ZPX                                                 CDL081
      *                                                                                       CDL081
      ** Calculate currency amount output by multiplying input amount by                      CDL081
      ** power array entry and then multiplying result by exchange rate                       CDL081
      ** depending on indicator                                                               CDL081
      *                                                                                       CDL081
     C           POWER,ZPX IFLT 1                                                             CDL081
     C           ZAMTCI    MULT POWER,ZPX Z15#3  153                                          CDL081
      *                                                                                       CDL081
      ** Do the same procedure if converting from base ccy back to EUR                        CDL081
      *                                                                                       CDL081
     C           WUFLAG    IFEQ 'Y'                                                           CDL081
     C           WBINCY    ANDNE'Y'                                                           CDL081
      *                                                                                       CDL081
     C           ZMD       IFEQ 'D'                                                           CDL081
     C           Z15#3     MULT ZEXCH     ZAMTCO                                              CDL081
     C                     ELSE                                                               CDL081
     C           Z15#3     DIV  ZEXCH     ZAMTCO                                              CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     ELSE                                                               CDL081
      *                                                                                       CDL081
     C           ZMD       IFEQ 'D'                                                           CDL081
     C           Z15#3     DIV  ZEXCH     ZAMTCO                                              CDL081
     C                     ELSE                                                               CDL081
     C           Z15#3     MULT ZEXCH     ZAMTCO                                              CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     ELSE                                                               CDL081
     C           ZAMTCI    MULT POWER,ZPX ZAMTCI                                              CDL081
      *                                                                                       CDL081
     C           WUFLAG    IFEQ 'Y'                                                           CDL081
     C           WBINCY    ANDNE'Y'                                                           CDL081
      *                                                                                       CDL081
     C           ZMD       IFEQ 'D'                                                           CDL081
     C           ZAMTCI    MULT ZEXCH     ZAMTCO                                              CDL081
     C                     ELSE                                                               CDL081
     C           ZAMTCI    DIV  ZEXCH     ZAMTCO                                              CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     ELSE                                                               CDL081
      *                                                                                       CDL081
     C           ZMD       IFEQ 'D'                                                           CDL081
     C           ZAMTCI    DIV  ZEXCH     ZAMTCO                                              CDL081
     C                     ELSE                                                               CDL081
     C           ZAMTCI    MULT ZEXCH     ZAMTCO                                              CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           EWCONV    ENDSR                                                              CDL081
      *                                                                                       CER048
      *****************************************************************                       CER048
      /EJECT                                                                                  CER048
      *****************************************************************                       CER048
      *                                                               *                       CER048
      *  ZICD - Subroutine to find number of days to calculate        *                       CER048
      *         interest according to calculation basis               *                       CER048
      *                                                               *                       CER048
      *  Called by: SRRTAX                                            *                       CER048
      *  Calls: None                                                  *                       CER048
      *                                                               *                       CER048
      *****************************************************************                       CER048
     C           ZICD      BEGSR                                                              CER048
      *                                                                                       CER048
      ** To determine number of days interest to be calculated                                CER048
      *                                                                                       CER048
     C           ZIEND     SUB  ZIBEG     ZDAYN2  94                                          CER048
      *                                                                                       CER048
      ** Check for interest calculation basis                                                 CER048
      *                                                                                       CER048
     C           ZICALC    IFEQ 3                                                             CER048
     C           ZICALC    OREQ 0                                                          BUG23097A
     C           ZIEND     IFGT ZIBEG                                                         CER048
      *                                                                                       CER048
      ** Calculating date from day number (beginning date)                                    CER048
      *                                                                                       CER048
     C                     Z-ADDZIBEG     ZDAYNO                                              CER048
      *                                                                                       CER048
      ** *IN99 set off as ZDATE2Z2 does not reset. ZDATE2Z4 not used.                         CER048
      *                                                                                       CER048
     C                     SETOF                     99                                       CER048
     C                     EXSR ZDATE2                                                        CER048
      *                                                                                       CER048
      ** Verify if error                                                                      CER048
      *                                                                                       CER048
     C           *IN99     IFEQ '1'                                                           CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     Z-ADD316       DBASE                                               CER048
     C                     MOVE 'ZDATE2'  DBFILE                                              CER048
     C                     MOVE *BLANKS   DBKEY                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           *IN98     IFEQ '0'                                                           CER048
     C                     Z-ADDZDATE     SRES                                                CER048
     C                     ELSE                                                               CER048
     C                     Z-ADDZDATE     SRESX                                               CER048
     C                     Z-ADDZISDX     ZISD                                                CER048
     C                     Z-ADDZISMX     ZISM                                                CER048
     C                     Z-ADDZISYX     ZISY                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Calculating date from day number (finishing date)                                    CER048
      *                                                                                       CER048
     C                     Z-ADDZIEND     ZDAYNO                                              CER048
      *                                                                                       CER048
      ** *IN99 set off as ZDATE2Z2 does not reset. ZDATE2Z4 not used                          CER048
      *                                                                                       CER048
     C                     SETOF                     99                                       CER048
     C                     EXSR ZDATE2                                                        CER048
      *                                                                                       CER048
      ** Verify if error                                                                      CER048
      *                                                                                       CER048
     C           *IN99     IFEQ '1'                                                           CER048
     C           *LOCK     IN   LDA                                                           CER048
     C                     Z-ADD317       DBASE                                               CER048
     C                     MOVE 'ZDATE2'  DBFILE                                              CER048
     C                     MOVE *BLANKS   DBKEY                                               CER048
     C                     OUT  LDA                                                           CER048
     C                     EXSR *PSSR                                                         CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           *IN98     IFEQ '0'                                                           CER048
     C                     Z-ADDZDATE     FRES                                                CER048
     C                     ELSE                                                               CER048
     C                     Z-ADDZDATE     FRESX                                               CER048
     C                     Z-ADDZIFDX     ZIFD                                                CER048
     C                     Z-ADDZIFMX     ZIFM                                                CER048
     C                     Z-ADDZIFYX     ZIFY                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** In order for the finish year to be less than the start year                          CER048
      ** if ziend is greater than zibeg, then the date ziend must                             CER048
      ** be in a different century to zibeg. if so add 100 years to it                        CER048
      *                                                                                       CER048
     C           ZIFY      IFLT ZISY                                                          CER048
     C           ZIFY      ADD  100       ZIFY2                                               CER048
     C                     ELSE                                                               CER048
     C                     Z-ADDZIFY      ZIFY2                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     Z-ADDZISY      ZISY2                                               CER048
      *                                                                                       CER048
      ** Determine whether start year is a leap year and if start                             CER048
      ** month is february then consider last day of february as date                         CER048
      ** 30nd. of the month                                                                   CER048
      *                                                                                       CER048
     C/COPY WNCPYSRC,RE3662C076                                                               CER048
      *                                                                                       CER048
     C           ZICALC    IFEQ 3                                                          BUG23097A
     C           ZICALC    OREQ 0                                                          BUG23097A
     C           CER016    ANDEQ'N'                                                        BUG23097A
     C           ZISM      IFEQ 2                                                             CER048
      *                                                                                       CER048
     C           ZISY2     ADD  1900      ZLYCHK                                              CER048
     C           ZLYCHK    DIV  4         ZLYCHK                                              CER048
     C                     MVR            ZLYREM                                              CER048
      *                                                                                       CER048
     C           ZLYREM    IFEQ 0                                                             CER048
      *                                                                                       CER048
     C           ZISD      IFEQ 29                                                            CER048
     C                     Z-ADD30        ZISD                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ELSE                                                               CER048
      *                                                                                       CER048
     C           ZISD      IFEQ 28                                                            CER048
     C                     Z-ADD30        ZISD                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                           BUG23097A
      *                                                                                    BUG23097A
     C/COPY WNCPYSRC,RE3662C077                                                               CER048
      *                                                                                       CER048
     C           30        SUB  ZISD      ZID1                                                CER048
      *                                                                                       CER048
     C           ZID1      IFLT 0                                                             CER048
     C                     Z-ADD*ZEROS    ZID1                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           ZISM      IFEQ 12                                                            CER048
     C                     Z-ADD*ZEROS    ZISM                                                CER048
     C                     ADD  1         ZISY                                                CER048
     C                     ADD  1         ZISY2                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Determine whether end year is a leap year and                                        CER048
      ** if end month is february                                                             CER048
      *                                                                                       CER048
     C/COPY WNCPYSRC,RE3662C078                                                               CER048
     C           ZICALC    IFEQ 3                                                          BUG23097A
     C           ZICALC    OREQ 0                                                          BUG23097A
     C           CER016    ANDEQ'N'                                                        BUG23097A
     C           ZIFM      IFEQ 2                                                             CER048
      *                                                                                       CER048
     C           ZIFY2     ADD  1900      ZLYCHK                                              CER048
     C           ZLYCHK    DIV  4         ZLYCHK                                              CER048
     C                     MVR            ZLYREM                                              CER048
      *                                                                                       CER048
     C           ZLYREM    IFEQ 0                                                             CER048
      *                                                                                       CER048
     C           ZIFD      IFEQ 29                                                            CER048
     C                     Z-ADD30        ZIFD                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ELSE                                                               CER048
      *                                                                                       CER048
     C           ZIFD      IFEQ 28                                                            CER048
     C                     Z-ADD30        ZIFD                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                    BUG23097A
     C                     ENDIF                                                           BUG23097A
     C/COPY WNCPYSRC,RE3662C079                                                               CER048
      *                                                                                       CER048
     C           ZIFD      IFEQ 31                                                            CER048
     C                     ADD  30        ZID1                                                CER048
     C                     ELSE                                                               CER048
     C                     ADD  ZIFD      ZID1                                                CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     SUB  1         ZIFM                                                CER048
      *                                                                                       CER048
     C           ZISY      IFEQ ZIFY                                                          CER048
     C           ZIFM      SUB  ZISM      ZINOM                                               CER048
     C                     ELSE                                                               CER048
     C           12        SUB  ZISM      ZIM1                                                CER048
     C                     Z-ADD1         ZISM                                                CER048
      *                                                                                       CER048
      ** Use enlarge fields that can handle 1999 onwards                                      CER048
      *                                                                                       CER048
     C                     ADD  1         ZISY2                                               CER048
     C           ZIFY2     SUB  ZISY2     ZIY1                                                CER048
     C           ZIY1      MULT 12        ZIM2                                                CER048
     C           ZIM2      ADD  ZIFM      ZIM2                                                CER048
     C           ZIM2      ADD  ZIM1      ZINOM                                               CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           ZINOM     MULT 30        ZID2                                                CER048
     C           ZID2      ADD  ZID1      ZDAYN2                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           ZICALC    IFEQ 4                                                             CER048
     C           ZICALC    OREQ 5                                                             CER048
      *                                                                                       CER048
      ** One day is subtracted from ZDAYN2 for each occurance of                              CER048
      ** 29 feb in the interest calculation period inclusive of                               CER048
      ** ZIBEG and ZIEND                                                                      CER048
      *                                                                                       CER048
      ** Find no of four year periods between dates                                           CER048
      *                                                                                       CER048
     C           ZDAYN2    DIV  1461      ZIMAN                                               CER048
     C                     MVR            ZIREM                                               CER048
      *                                                                                       CER048
      ** Find next 29 feb day no. on or after zibeg                                           CER048
      *                                                                                       CER048
     C           ZIBEG     SUB  60        ZIBW1                                               CER048
     C           ZIBW1     DIV  1461      ZIDW1                                               CER048
     C                     MVR            ZIDREM                                              CER048
      *                                                                                       CER048
     C           ZIDREM    IFEQ 0                                                             CER048
     C                     Z-ADDZIBEG     ZIDW2                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Round up result                                                                      CER048
      *                                                                                       CER048
     C           ZIDW1     ADD  1         ZIDW2                                               CER048
      *                                                                                       CER048
      ** Calculate next 29 Feb.                                                               CER048
      *                                                                                       CER048
     C           ZIDW2     MULT 1461      ZIDW2                                               CER048
     C           ZIDW2     ADD  60        ZIDW2                                               CER048
      *                                                                                       CER048
      ** If this next 29 feb. dayno - ZIBEG is greater or equal to                            CER048
      ** ZIREM then  add 1 to ZIMAN                                                           CER048
      *                                                                                       CER048
     C           ZIDW2     SUB  ZIBEG     ZILPCP                                              CER048
      *                                                                                       CER048
     C           ZIREM     IFGE ZILPCP                                                        CER048
     C                     ADD  1         ZIMAN                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
      ** Subtract ZIMAN from ZDAYN2 to give value of ZDAYN2 required                          CER048
      ** for this interest calculation                                                        CER048
      *                                                                                       CER048
     C           ZDAYN2    SUB  ZIMAN     ZDAYN2                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDSR                                                              CER048
      *                                                                                       CER048
      *****************************************************************                     AR831847
      /EJECT                                                                                AR831847
      *****************************************************************                     AR831847
      *                                                               *                     AR831847
      *  SREPOS - Generates postings for EU withholding tax           *                     AR831847
      *           accounting. Credit retail account only              *                     AR831847
      *                                                               *                     AR831847
      *****************************************************************                     AR831847
     C           SREPOS    BEGSR                                                            AR831847
      *                                                                                     AR831847
      ** Save Transaction Type.                                                             AR831847
      *                                                                                     AR831847
     C                     Z-ADDTRAT      WTRAT                                             AR831847
     C                     MOVE TXTXTT    TRAT                                              AR831847
     C                     MOVE 'Y'       WEUTT                                             AR831847
      *                                                                                     AR831847
     C                     MOVELNAR,14    INPNAR                                            AR831847
     C                     MOVELNR16,14   INP16                                             AR831847
     C                     MOVELDN07,14   INP07                                             AR831847
     C                     MOVELMGD,14    ##MGID                                            AR831847
     C           WTAOC     IFNE *ZERO                                                       AR831847
      *                                                                                     AR831847
      ** Output EU withholding tax as a CR to the internal tax a/c in                       AR831847
      ** retail a/c currency only if Tax Ccy = A/c Ccy.                                     AR831847
      *                                                                                     AR831847
     C           TSTXCY    IFEQ BCCY                                                        AR831847
      *                                                                                     AR831847
     C                     Z-SUBWTAOC     WPSTA                                             AR831847
     C                     MOVE BBICN     CNUM                                              AR831847
     C                     Z-ADDWEWTA     ACOD                                              AR831847
     C                     Z-ADD1         ACSQ                                              AR831847
     C                     Z-ADD*ZERO     ACNO                                              AR831847
     C                     Z-ADDRUND      VALD                                              AR831847
     C                     EXSR SUBNAR                                                      AR831847
     C                     MOVE NARS      PNAR                                              AR831847
      *                                                                                     AR831847
      ** EU tax postings are written by subroutine SREATA per Joint A/c                     AR831847
      ** member given a Joint A/c.                                                          AR831847
      *                                                                                     AR831847
     C           WJACC     IFNE 'Y'                                                         AR831847
     C                     EXSR GEICPR                                                      AR831847
      *                                                                                     AR831847
      ** Update history if required                                                         AR831847
      *                                                                                     AR831847
     C           ATYP      IFEQ 'R'                                                         AR831847
     C           VALD      ANDLENAPDA                                                       AR831847
     C           *IN50     ANDEQ*OFF                                                        AR831847
     C                     Z-ADD148       DBASE                                             AR831847
     C                     MOVE 'N'       REACT                                             AR831847
     C                     WRITEREHPOSPF                                                    AR831847
     C                     EXSR POSPR                                                       AR831847
     C                     ENDIF                                                            AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
      ** Output additional postings if Tax Ccy <> A/c Ccy.                                  AR831847
      *                                                                                     AR831847
     C           TSTXCY    IFNE BCCY                                                        AR831847
     C                     EXSR SRFPOS                                                      AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
      ** Reset Transaction Type.                                                            AR831847
      *                                                                                     AR831847
     C                     Z-ADDWTRAT     TRAT                                              AR831847
     C                     MOVE 'N'       WEUTT                                             AR831847
      *                                                                                     AR831847
     C           CER048    IFEQ 'Y'                                                         AR831847
      *                                                                                     AR831847
     C           WTAOC     IFNE *ZEROS                                                      AR831847
     C           WKSTXO    ANDNE*ZEROS                                                      AR831847
      *                                                                                     AR831847
     C           TSTXCY    IFEQ BCCY                                                        AR831847
      *                                                                                     AR831847
     C                     Z-SUBWKSTXO    WPSTA                                             AR831847
     C                     MOVELBBICN     CNUM                                              AR831847
     C                     MOVELTSSTAC    ACOD                                              AR831847
     C                     Z-ADD1         ACSQ                                              AR831847
     C                     Z-ADD0         ACNO                                              AR831847
     C                     MOVELRUND      VALD                                              AR831847
      *                                                                                     AR831847
     C                     EXSR SUBNAR                                                      AR831847
     C                     MOVELNARS      PNAR                                              AR831847
      *                                                                                     AR831847
     C           WJACC     IFNE 'Y'                                                         AR831847
     C                     EXSR GEICPR                                                      AR831847
      *                                                                                     AR831847
      ** Update history if required                                                         AR831847
      ** for the posting amount for the secondary tax.                                      AR831847
      *                                                                                     AR831847
     C           ATYP      IFEQ 'R'                                                         AR831847
     C           VALD      ANDLENAPDA                                                       AR831847
     C           *IN50     ANDEQ*OFF                                                        AR831847
     C                     Z-ADD152       DBASE                                             AR831847
     C                     MOVE 'N'       REACT                                             AR831847
     C                     WRITEREHPOSPF                                                    AR831847
     C                     EXSR POSPR                                                       AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C           CER054    IFEQ 'Y'                                                         AR831847
      *                                                                                     AR831847
     C           WTAOC     IFNE *ZEROS                                                      AR831847
     C           WKTTXO    ANDNE*ZEROS                                                      AR831847
      *                                                                                     AR831847
     C           TSTXCY    IFEQ BCCY                                                        AR831847
      *                                                                                     AR831847
     C                     Z-SUBWKTTXO    WPSTA                                             AR831847
     C                     MOVELBBICN     CNUM                                              AR831847
     C                     MOVELTSTTAC    ACOD                                              AR831847
     C                     Z-ADD1         ACSQ                                              AR831847
     C                     Z-ADD0         ACNO                                              AR831847
     C                     MOVELRUND      PSTD                                              AR831847
      *                                                                                     AR831847
     C                     EXSR SUBNAR                                                      AR831847
     C                     MOVELNARS      PNAR                                              AR831847
      *                                                                                     AR831847
     C           WJACC     IFNE 'Y'                                                         AR831847
     C                     EXSR GEICPR                                                      AR831847
      *                                                                                     AR831847
      ** Update history if required                                                         AR831847
      ** for the posting amount for the third tax.                                          AR831847
      *                                                                                     AR831847
     C           ATYP      IFEQ 'R'                                                         AR831847
     C           VALD      ANDLENAPDA                                                       AR831847
     C           *IN50     ANDEQ*OFF                                                        AR831847
     C                     Z-ADD314       DBASE                                             AR831847
     C                     MOVE 'N'       REACT                                             AR831847
     C                     WRITEREHPOSPF                                                    AR831847
     C                     EXSR POSPR                                                       AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDIF                                                            AR831847
     C                     ENDIF                                                            AR831847
     C                     ENDIF                                                            AR831847
      *                                                                                     AR831847
     C                     ENDSR                                                            AR831847
     C*****************************************************************                     CRE083BE
     C**                                                              *                     CRE083BE
     C**  UPDPTR subroutine updates REFIXCPD with Start Key.          *                     CRE083BE
     C**                                                              *                     CRE083BE
     C**  Called By:  Mainline code.                                  *                     CRE083BE
     C**  Calls:      -                                               *                     CRE083BE
     C**                                                              *                     CRE083BE
     C**  Indicators: -                                               *                     CRE083BE
     C**                                                              *                     CRE083BE
     C**  Arrays:     -                                               *                     CRE083BE
     C**                                                              *                     CRE083BE
     C**  Fields:                                                     *                     CRE083BE
     C**                                                              *                     CRE083BE
      *****************************************************************                     CRE083BE
     C           UPDPTR    BEGSR                                                            CRE083BE
      *                                                                                     CRE083BE
     C                     MOVE 'A'       IXCKEY                                            CRE083BE
     C                     MOVE NXTKEY    LSTKEY                                            CRE083BE
     C           IXCKEY    CHAINREINTCPD             38                                     CRE083BE
     C           *IN38     IFEQ *OFF                                                        CRE083BE
     C                     MOVE LSTKEY    NXTKEY                                            CRE083BE
     C                     MOVE LLGID     NLGID                                             CRE083BE
     C                     MOVE LBRCA     NBRCA                                             CRE083BE
     C                     MOVE LCNUM     NCNUM                                             CRE083BE
     C                     MOVE LCCY      NCCY                                              CRE083BE
     C                     MOVE LACOD     NACOD                                             CRE083BE
     C                     MOVE LACSQ     NACSQ                                             CRE083BE
     C                     MOVE 'C'       PROT                                              CRE083BE
     C                     UPDATREHISBP1                                                    CRE083BE
     C                     END                                                              CRE083BE
      *                                                                                     CRE083BE
     C                     ENDSR                                                            CRE083BE
      *****************************************************************                     CRE083BK
      *                                                               *                     CRE083BK
      *  CHKACD - Check Account Code details in array                 *                     CRE083BK
      *                                                               *                     CRE083BK
      *****************************************************************                     CRE083BK
     C           CHKACD    BEGSR                                                            CRE083BK
      *                                                                                     CRE083BK
     C                     MOVEL*BLANK    ACFIC                                             CRE083BK
     C                     SETOF                         42                                 CRE083BK
     C           KEYACD    IFNE 0                                                           CRE083BK
     C                     Z-ADDPIDX      E                                                 CRE083BK
     C           E         IFEQ 0                                                           CRE083BK
     C                     Z-ADDTIDX      E                                                 CRE083BK
     C                     ENDIF                                                            CRE083BK
      *                                                                                     CRE083BK
     C           KEYACD    IFEQ CDAC,E                                                      CRE083BK
     C                     SETON                         42                                 CRE083BK
     C                     ELSE                                                             CRE083BK
      *                                                                                     CRE083BK
     C           TIDX      IFEQ 0                                                           CRE083BK
     C                     Z-ADD1         E                                                 CRE083BK
     C                     ELSE                                                             CRE083BK
     C                     Z-ADDTIDX      E                                                 CRE083BK
     C                     ENDIF                                                            CRE083BK
      *                                                                                     CRE083BK
     C           KEYACD    LOKUPCDAC,E                   42                                 CRE083BK
     C                     ENDIF                                                            CRE083BK
      *                                                                                     CRE083BK
     C           *IN42     IFEQ *ON                                                         CRE083BK
     C                     MOVE RCSQ      LRUA,E                                            CRE083BK
     C                     Z-ADDE         PIDX                                              CRE083BK
     C                     MOVEL'Y'       ACFIC                                             CRE083BK
     C                     ENDIF                                                            CRE083BK
     C                     ENDIF                                                            CRE083BK
      *                                                                                     CRE083BK
     C                     ENDSR                                                            CRE083BK
      *****************************************************************                     CRE083BK
      *                                                               *                     CRE083BK
      *  ACDCCH - Account Code Cache Processing                       *                     CRE083BK
      *                                                               *                     CRE083BK
      *****************************************************************                     CRE083BK
     C           ACDCCH    BEGSR                                                            CRE083BK
     C                     EXSR CHKACD                                                      CRE083BK
     C           ACFIC     IFEQ 'Y'                                                         CRE083BK
     C           E         OCUR SDACOD                                                      CRE083BK
     C**********           SETON                     70                           CRE083BK AR1096650
     C                     ELSE                                                             CRE083BK
     C           TIDX      IFNE 0                                                           CRE083BK
     C                     Z-ADDTIDX      E                                                 CRE083BK
     C                     ELSE                                                             CRE083BK
     C                     Z-ADD1         E                                                 CRE083BK
     C                     MOVEALRUA      LRUS                                              CRE083BK
     C                     SORTALRUS                                                        CRE083BK
     C                     Z-ADDLRUS,1    LEASTE                                            CRE083BK
     C           LEASTE    LOKUPLRUA,E                   42                                 CRE083BK
     C                     ENDIF                                                            CRE083BK
     C           E         OCUR SDACOD                                                      CRE083BK
     C                     MOVE KEYACD    ACDALP                                            CRE083BK
     C                     CALL 'AOACODR0'                                                  CRE083BK
     C                     PARM '*MSG   ' @RTCD                                             CRE083BK
     C                     PARM '*KEY   ' @OPTN                                             CRE083BK
     C                     PARM           ACDALP                                            CRE083BK
     C           SDACOD    PARM SDACOD    DSSDY                                             CRE083BK
      *                                                                                     CRE083BK
     C           @RTCD     IFNE *BLANK                                                      CRE083BK
     C           *LOCK     IN   LDA                                                         CRE083BK
     C                     Z-ADDWDBASE    DBASE                                             CRE083BK
     C                     MOVEL'SDACODPD'DBFILE                                            CRE083BK
     C                     MOVELACDALP    DBKEY                                             CRE083BK
     C                     OUT  LDA                                                         CRE083BK
     C                     SETON                     U7U8LR                                 CRE083BK
     C                     EXSR *PSSR                                                       CRE083BK
     C                     ELSE                                                             CRE083BK
     C                     EXSR ADDACD                                                      CRE083BK
     C                     END                                                              CRE083BK
     C                     ENDIF                                                            CRE083BK
      *                                                                                     CRE083BK
     C                     ENDSR                                                            CRE083BK
      *****************************************************************                     CRE083BK
      *                                                               *                     CRE083BK
      *  ADDACD - Add account code details to array                   *                     CRE083BK
      *                                                               *                     CRE083BK
      *****************************************************************                     CRE083BK
     C           ADDACD    BEGSR                                                            CRE083BK
      *                                                                                     CRE083BK
     C           TIDX      IFNE 0                                                           CRE083BK
     C                     SUB  1         TIDX                                              CRE083BK
     C                     ENDIF                                                            CRE083BK
      *                                                                                     CRE083BK
     C**********           MOVELACOD      CDAC,E                                  CRE083BK AR1089863
     C                     MOVELKEYACD    CDAC,E                                           AR1089863
     C                     MOVE RCSQ      LRUA,E                                            CRE083BK
      *                                                                                     CRE083BK
     C                     Z-ADDE         PIDX                                              CRE083BK
      *                                                                                     CRE083BK
     C                     ENDSR                                                            CRE083BK
      *****************************************************************                     AR676495
      /EJECT                                                                                AR676495
      *****************************************************************                     AR676495
      *                                                               *                     AR676495
      *  SRINTA - SUBROUTINE FOR INTEREST ADJUSTMENT POSTINGS         *                     AR676495
      *           CREDIT RETAIL ACCOUNT ONLY                          *                     AR676495
      *                                                               *                     AR676495
      *  CALLED BY: CREPR                                             *                     AR676495
      *                                                               *                     AR676495
      *  CALLS: *PSSR                                                 *                     AR676495
      *                                                               *                     AR676495
      *****************************************************************                     AR676495
     C           SRINTA    BEGSR                                                            AR676495
      *                                                                                     AR676495
      ** RESET THE FIELD/INDICATOR.                                                         AR676495
      *                                                                                     AR676495
     C                     MOVEL'N'       WARTH   1                                         AR676495
      *                                                                                     AR676495
      ** Save Transaction Type.                                                             AR676495
      *                                                                                     AR676495
     C                     Z-ADDTRAT      WTRAT                                             AR676495
     C                     MOVE TXTXTT    TRAT                                              AR676495
     C                     MOVE 'Y'       WEUTT   1                                         AR676495
      *                                                                                     AR676495
      ** SET UP THE NARRATIVE.                                                              AR676495
      *                                                                                     AR676495
     C                     MOVELNAR,14    INPNAR                                            AR676495
     C                     MOVELNR16,14   INP16                                             AR676495
     C                     MOVELDN07,14   INP07                                             AR676495
     C                     MOVELMGD,14    ##MGID                                            AR676495
      *                                                                                     AR676495
     C                     MOVE BBRCA     BRCA                                              AR676495
     C                     MOVE BCNUM     CNUM                                              AR676495
     C                     MOVE BCCY      CCY                                               AR676495
     C                     Z-ADDBACOD     ACOD                                              AR676495
     C                     Z-ADDBACSQ     ACSQ                                              AR676495
     C                     MOVE WACNO     ACNO                                              AR676495
      *                                                                                     AR676495
      ** Check if the customer is actually a Joint A/c.                                     AR676495
      *                                                                                     AR676495
     C                     MOVE BCNUM     KJANO   6                                         AR676495
     C           KJANO     CHAINSDJACCL1             84                                     AR676495
      *                                                                                     AR676495
     C                     MOVE 'N'       WJACC   1                                         AR676495
     C           *IN84     IFEQ *OFF                                                        AR676495
     C                     MOVE 'Y'       WJACC                                             AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
      ** CHECK FOR THE SwITHABLE FEATURE                                                    AR676495
      *                                                                                     AR676495
     C           CER048    IFEQ 'Y'                                                         AR676495
      *                                                                                     AR676495
      ** ACCESS BRANCH DETAILS                                                              AR676495
      *                                                                                     AR676495
     C                     Z-ADDCUBRCA    C                                                 MD032185
     C           BBRCA     LOKUPABRC,C                   16                                 MD032185
      *                                                                                     MD032185
     C           *IN16     IFEQ '1'                                                         MD032185
     C           C         OCUR SDBRCH                                                      MD032185
     C                     ELSE                                                             MD032185
     C                     CALL 'AOBRCHR1'                                                  AR676495
     C                     PARM '*MSG   ' PRTCD                                             AR676495
     C                     PARM '*KEY   ' POPTN                                             AR676495
     C                     PARM BBRCA     PBRCA   3                                         AR676495
     C           SDBRCH    PARM SDBRCH    DSSDY                                             AR676495
      *                                                                                     AR676495
     C           PRTCD     IFNE *BLANKS                                                     AR676495
      *                                                                                     AR676495
     C           *LOCK     IN   LDA                                                         AR676495
     C                     MOVEL'RE3664'  DBPGM                                             AR676495
     C                     MOVEL'SDBRCHPD'DBFILE                                            AR676495
     C                     MOVELPBRCA     DBKEY                                             AR676495
     C                     Z-ADD330       DBASE                                             AR676495
     C                     OUT  LDA                                                         AR676495
     C                     EXSR *PSSR                                                       AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
     C                     ENDIF                                                            MD032185
      *                                                                                     AR676495
      ** ACCESS LOCATION DETAILS                                                            AR676495
      *                                                                                     AR676495
     C                     CALL 'AOLOCNR0'                                                  AR676495
     C                     PARM *BLANKS   PRTCD                                             AR676495
     C                     PARM '*KEY   ' POPTN                                             AR676495
     C                     PARM A8LCCD    PLOCN   3                                         AR676495
     C           SDLOCN    PARM SDLOCN    DSFDY                                             AR676495
      *                                                                                     AR676495
     C           PRTCD     IFNE *BLANKS                                                     AR676495
      *                                                                                     AR676495
     C           *LOCK     IN   LDA                                                         AR676495
     C                     MOVEL'RE3664'  DBPGM                                             AR676495
     C                     MOVEL'SDLOCNPD'DBFILE                                            AR676495
     C                     MOVELPLOCN     DBKEY                                             AR676495
     C                     Z-ADD331       DBASE                                             AR676495
     C                     OUT  LDA                                                         AR676495
     C                     EXSR *PSSR                                                       AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
      ** Access customer details                                                            AR676495
      *                                                                                     AR676495
     C                     MOVELBCNUM     PCNUM                                             AR676495
      *                                                                                     AR676495
     C                     CALL 'AOCUSTR0'                                                  AR676495
     C                     PARM *BLANKS   PRTCD   7                                         AR676495
     C                     PARM '*KEY   ' POPTN   7                                         AR676495
     C                     PARM           PCNUM  10                                         AR676495
     C                     PARM *BLANKS   PCNST   7                                         AR676495
     C           SDCUST    PARM SDCUST    DSSDY                                             AR676495
      *                                                                                     AR676495
     C           PRTCD     IFNE *BLANKS                                                     AR676495
     C           *LOCK     IN   LDA                                                         AR676495
      *                                                                                     AR676495
     C                     MOVEL'SDCUSTPD'DBFILE                                            AR676495
     C                     MOVELPCNUM     DBKEY                                             AR676495
     C                     Z-ADD332       DBASE                                             AR676495
     C                     OUT  LDA                                                         AR676495
     C                     EXSR *PSSR                                                       AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
      ** ACCESS COUNTRY OF TAX DETAILS                                                      AR676495
      *                                                                                     AR676495
     C                     CALL 'AOCTTXR0'                                                  AR676495
     C                     PARM *BLANKS   PRTCD                                             AR676495
     C                     PARM '*KEY   ' POPTN                                             AR676495
     C                     PARM DVCNCD    PCTRT   2                                         AR676495
     C                     PARM BBCOLC    PCTRR   2                                         AR676495
     C           SDCTTX    PARM SDCTTX    DSFDY                                             AR676495
      *                                                                                     AR676495
     C           PRTCD     IFEQ '*NRF   '                                                   AR676495
      *                                                                                     AR676495
     C                     CALL 'AOCTTXR0'                                                  AR676495
     C                     PARM *BLANKS   PRTCD                                             AR676495
     C                     PARM '*KEY   ' POPTN                                             AR676495
     C                     PARM DVCNCD    PCTRT   2                                         AR676495
     C                     PARM *BLANKS   PCTRR   2                                         AR676495
     C           SDCTTX    PARM SDCTTX    DSFDY                                             AR676495
      *                                                                                     AR676495
     C           PRTCD     IFNE *BLANKS                                                     AR676495
      *                                                                                     AR676495
     C           *LOCK     IN   LDA                                                         AR676495
     C                     MOVEL'SDCTTXPD'DBFILE                                            AR676495
     C                     MOVEL@BRCA     DBKEY                                             AR676495
     C                     Z-ADD333       DBASE                                             AR676495
     C                     OUT  LDA                                                         AR676495
     C                     EXSR *PSSR                                                       AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
      ** CHECK IF THE tAx IS DONE USING THRESHOLD                                           AR676495
      *                                                                                     AR676495
     C           EWTHMD    IFEQ 'Y'                                                         AR676495
     C           CER054    ANDNE'Y'                                                        AR676495A
      *                                                                                     AR676495
      ** WORK CREDIT INTEREST NUMBER                                                        AR676495
      *                                                                                     AR676495
     C                     Z-ADD*ZEROS    WCRIN  150                                        AR676495
      *                                                                                     AR676495
      ** WORK CREDIT INTEREST                                                               AR676495
      *                                                                                     AR676495
     C                     MOVEL'N'       WCRIT   1                                         AR676495
      *                                                                                     AR676495
      ** WORK DATE                                                                          AR676495
      *                                                                                     AR676495
     C                     MOVELSPCID     WDATE                                             AR676495
      *                                                                                     AR676495
      ** WORK CAPITALISATION DATE                                                           AR676495
      *                                                                                     AR676495
     C                     MOVELSHISD     WCDAT                                             AR676495
      *                                                                                     AR676495
      ** WORK BALANCE                                                                       AR676495
      *                                                                                     AR676495
     C                     MOVELSHISB     WHISB                                             AR676495
      *                                                                                     AR676495
      ** ACCESS ACCOUNT CURRENCY DETAILS                                                    AR676495
      *                                                                                     AR676495
     C                     CALL 'AOCURRR0'                                                  AR676495
     C                     PARM *BLANKS   PRTCD                                             AR676495
     C                     PARM '*KEY  '  POPTN                                             AR676495
     C                     PARM BCCY      PCYCD   3                                         AR676495
     C           SDCURR    PARM SDCURR    DSSDY                                             AR676495
      *                                                                                     AR676495
     C           @RTCD     IFNE *BLANKS                                                     AR676495
     C           *LOCK     IN   LDA                                                         AR676495
     C                     MOVEL'SDCURRPD'DBFILE                                            AR676495
     C                     MOVELPCYCD     DBKEY                                             AR676495
     C                     Z-ADD334       DBASE                                             AR676495
     C                     OUT  LDA                                                         AR676495
     C                     EXSR *PSSR                                                       AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C           4         ADD  CDP       FD      10                                        AR676495
      *                                                                                     AR676495
      ** READ PREVIOUS HISTORY RECORD TO ENSURE INCLUDE PREVIOus end                        AR676495
      ** OF MONTH BALANCE RECORD                                                            AR676495
      *                                                                                     AR676495
     C                     MOVE BBRCA     BRCA                                              AR676495
     C                     MOVE BCNUM     CNUM                                              AR676495
     C                     MOVE BCCY      CCY                                               AR676495
     C                     Z-ADDBACOD     ACOD                                              AR676495
     C                     Z-ADDBACSQ     ACSQ                                              AR676495
     C                     Z-ADDWDATE     HISD                                              AR676495
      *                                                                                     AR676495
      ** READ PREVIOUS HISTORY RECORD                                                       AR676495
      *                                                                                     AR676495
     C           R3KEY     SETLLREHISL                                                      AR676495
     C           R3KEYA    READEREHISL                   40                                 AR676495
      *                                                                                     AR676495
     C           *IN40     DOUEQ*ON                                                         AR676495
      *                                                                                     AR676495
     C           *IN40     IFEQ *OFF                                                        AR676495
      *                                                                                     AR676495
     C           HISD      IFGT WCDAT                                                       AR676495
     C                     LEAVE                                                            AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     MOVELHISD      ZIEND                                             AR676495
      *                                                                                     AR676495
     C           CRCI      IFEQ 'Y'                                                         AR676495
     C           HISD      ANDGTPCID                                                        AR676495
     C           HISD      ANDLTWCDAT                                                       AR676495
     C                     MOVEL'Y'       WCRIT                                             AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     ELSE                                                             AR676495
      *                                                                                     AR676495
     C                     MOVELWCDAT     ZIEND                                             AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     MOVELWDATE     ZIBEG                                             AR676495
      *                                                                                     AR676495
     C           ZIBEG     IFLT ZIEND                                                       AR676495
      *                                                                                     AR676495
     C                     Z-ADDCRCB      ZICALC                                            AR676495
      *                                                                                     AR676495
     C                     EXSR ZICD                                                        AR676495
      *                                                                                     AR676495
     C           WHISB     MULT ZDAYN2    WINUM  150                                        AR676495
     C           WINUM     DIV  100       WINUM                                             AR676495
     C           WINUM     DIV  POWER,FD  WINUM                                             AR676495
      *                                                                                     AR676495
      ** IF WORK BALANCE IS LESS THAN ZERO                                                  AR676495
      *                                                                                     AR676495
     C           WHISB     IFLT *ZERO                                                       AR676495
     C                     ADD  WINUM     WCRIN                                             AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     Z-ADDHISB      WHISB                                             AR676495
     C                     Z-ADDHISD      WDATE                                             AR676495
      *                                                                                     AR676495
     C           HISD      IFEQ WCDAT                                                       AR676495
     C           RECI      ANDEQ'S'                                                         AR676495
     C                     LEAVE                                                            AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C           R3KEYA    READEREHISL                   40                                 AR676495
      *                                                                                     AR676495
     C                     ENDDO                                                            AR676495
      *                                                                                     AR676495
      ** CHECK THRESHOlD                                                                    AR676495
      *                                                                                     AR676495
     C           CRCB      IFEQ 1                                                           AR676495
     C           CRCB      OREQ 4                                                           AR676495
      *                                                                                     AR676495
     C                     Z-ADD365       WNDYR   30                                        AR676495
      *                                                                                     AR676495
     C                     ELSE                                                             AR676495
      *                                                                                     AR676495
     C           CRCB      IFEQ 6                                                           AR676495
     C                     Z-ADD365       WNDYR                                             AR676495
     C                     ELSE                                                             AR676495
     C                     Z-ADD360       WNDYR                                             AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
      ** IF WORK CREDIT INTEREST NUMBER IS NOT ZERO                                         AR676495
      *                                                                                     AR676495
     C           WCRIN     IFNE *ZEROS                                                      AR676495
      *                                                                                     AR676495
     C           RCAIC     MULT WNDYR     WCTOT  180                                        AR676495
     C           WCTOT     DIV  WCRIN     AVRT   235                                        AR676495
      *                                                                                     AR676495
      ** ONLY CALCULATE AVERAGE RATE TO 2 DECIMALS                                          AR676495
      *                                                                                     AR676495
     C           AVRT      DIV  POWER,FD  WAVRT  232H                                       AR676495
     C                     Z-ADDWAVRT     AVRT                                              AR676495
      *                                                                                     AR676495
     C           AVRT      IFLT *ZEROS                                                      AR676495
     C                     MULT -1        AVRT                                              AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C           WCRIT     IFNE 'Y'                                                         AR676495
     C           SCICT     ANDEQ*ZEROS                                                      AR676495
     C                     Z-ADDAVRT      SCRIR                                             AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     ELSE                                                             AR676495
     C                     Z-ADD*ZEROS    AVRT                                              AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C           SHISD     IFGE EWRAED                                                      AR676495
     C                     Z-ADDEWRARL    WLEVEL                                            AR676495
     C                     ELSE                                                             AR676495
     C                     Z-ADDEWPARL    WLEVEL                                            AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C           AVRT      IFLE WLEVEL                                                      AR676495
     C                     MOVEL'Y'       WARTH                                             AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
      ** CHECK FOR AVErAgE RATE THRESHOLD                                                   AR676495
      *                                                                                     AR676495
     C           WARTH     IFEQ 'Y'                                                         AR676495
      *                                                                                     AR676495
     C                     MOVE 'G'       KMODI                                             AR676495
     C                     MOVE BCNUM     KCUST                                             AR676495
     C                     MOVE BCCY      KSCCY                                             AR676495
     C                     Z-ADDBACOD     KACDE                                             AR676495
     C                     Z-ADDBACSQ     KACSQ                                             AR676495
     C                     MOVE BBRCA     KBRCA                                             AR676495
     C                     Z-ADDLCID      KRDNB                                             AR676495
      *                                                                                     AR676495
     C                     Z-ADD*ZEROS    WNIBC  150                                        AR676495
     C                     Z-ADD*ZEROS    WPTBC  150                                        AR676495
     C                     Z-ADD*ZEROS    WTTAX  150                                        AR676495
      *                                                                                     AR676495
     C           INTAD     IFNE '1'                                                         AR676495
     C           KCILJ     SETLLSDCSINLJ                                                    AR676495
     C                     ENDIF                                                            AR676495
     C           KCILJ     READESDCSINLJ                 70                                 AR676495
      *                                                                                     AR676495
     C           *IN70     IFEQ *OFF                                                        AR676495
      *                                                                                     AR676495
     C                     ADD  TSNINB    WNIBC                                             AR676495
     C                     ADD  TSPTHU    WPTBC                                             AR676495
     C                     ADD  TSTXSB    WTTAX                                             AR676495
     C                     ADD  TSSTDB    WTTAX                                             AR676495
     C                     ADD  TSTTDB    WTTAX                                             AR676495
      *                                                                                     AR676495
     C                     MOVE *ZEROS    TSTXSR                                            AR676495
     C                     MOVE *ZEROS    TSTXSS                                            AR676495
     C                     MOVE *ZEROS    TSTXSC                                            AR676495
     C                     MOVE *ZEROS    TSTXSB                                            AR676495
     C                     MOVE *ZEROS    TSSTDO                                            AR676495
     C                     MOVE *ZEROS    TSSTDS                                            AR676495
     C                     MOVE *ZEROS    TSSTDT                                            AR676495
     C                     MOVE *ZEROS    TSSTDB                                            AR676495
     C                     MOVE *ZEROS    TSPTHU                                            AR676495
     C                     MOVE *ZEROS    TSTTDO                                            AR676495
     C                     MOVE *ZEROS    TSTTDS                                            AR676495
     C                     MOVE *ZEROS    TSTTDT                                            AR676495
     C                     MOVE *ZEROS    TSTTDB                                            AR676495
      *                                                                                     AR676495
     C                     MOVE TSGINT    TSNINT                                            AR676495
     C                     MOVE TSGINS    TSNINS                                            AR676495
     C                     MOVE TSGINC    TSNINC                                            AR676495
     C                     MOVE TSGINB    TSNINB                                            AR676495
      *                                                                                     AR676495
     C                     UPDATSDCSINDJ                                                    AR676495
      *                                                                                     AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     MOVE TSCUST    KCNUM                                             AR676495
     C                     MOVE TSBRCA    KBRCH                                             AR676495
      *                                                                                     AR676495
     C           R3KEYB    SETLLSDINPHL2                                                    AR676495
     C           R3KEYB    READESDINPHL2                 71                                 AR676495
      *                                                                                     AR676495
     C           *IN71     IFEQ *OFF                                                        AR676495
     C           TITOUT    SUB  WNIBC     TITOUT                                            AR676495
     C           TIUTTH    SUB  WPTBC     TIUTTH                                            AR676495
     C           TITTAX    SUB  WTTAX     TITTAX                                            AR676495
      *                                                                                     AR676495
     C                     UPDATSDINPHD0                                                    AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C           ACKEY1    CHAINREACR                40                                     AR676495
      *                                                                                     AR676495
      ** REACR RECORD NOT FOUND                                                             AR676495
      *                                                                                     AR676495
     C           *IN40     IFEQ '1'                                                         AR676495
     C           *LOCK     IN   LDA                                                         AR676495
     C                     Z-ADD335       DBASE                                             AR676495
     C                     MOVEL'REACR'   DBFILE                                            AR676495
     C                     MOVELAKEY      DBKEY                                             AR676495
     C                     OUT  LDA                                                         AR676495
     C                     EXSR *PSSR                                                       AR676495
     C                     END                                                              AR676495
      *                                                                                     AR676495
     C           HISB      IFLE *ZEROS                                                      AR676495
     C           HISB      SUB  WTTAX     HISB                                              AR676495
     C                     ELSE                                                             AR676495
     C           HISB      ADD  WTTAX     HISB                                              AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     UPDATREACRDF                                                     AR676495
      *                                                                                     AR676495
     C                     ELSE                                                             AR676495
      *                                                                                     AR676495
     C                     Z-ADDBJRDNB    KRDNB                                             AR676495
     C                     MOVE 'G'       KMODI                                             AR676495
     C                     MOVE BCNUM     KCUST                                             AR676495
     C                     MOVE BCNUM     KJOIN                                             AR676495
     C                     MOVE BCCY      KSCCY                                             AR676495
     C                     Z-ADDBACOD     KACDE                                             AR676495
     C                     Z-ADDBACSQ     KACSQ                                             AR676495
     C                     MOVE BBRCA     KBRCA                                             AR676495
      *                                                                                     AR676495
      ** Read customer income file                                                          AR676495
      ** DO NOT SETLL IF A PREVIOUS INTEREST ADJUSTMENT OCCURED                             AR676495
      *                                                                                     AR676495
     C           WJACC     IFEQ 'Y'                                                         AR676495
     C           INTAD     IFNE '1'                                                         AR676495
     C           KCILC     SETLLSDCSINLC                                                    AR676495
     C                     ENDIF                                                            AR676495
     C           KCILC     READESDCSINLC                 84                                 AR676495
     C                     ELSE                                                             AR676495
     C           INTAD     IFNE '1'                                                         AR676495
     C           KCIL7     SETLLSDCSINL7                                                    AR676495
     C                     ENDIF                                                            AR676495
     C           KCIL7     READESDCSINL7                 84                                 AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
      ** COMPUTE NET INTEREST FOR INTEREST ADJUSTMENT                                       AR676495
      *                                                                                     AR676495
     C           *IN84     IFEQ *OFF                                                        AR676495
     C           TSSTAT    ANDEQ'T'                                                         AR676495
     C           TSEDAT    ANDLTTSRDNB                                                      AR676495
     C           TSOCCY    IFEQ TSTXCY                                                      AR676495
     C           CER048    IFEQ 'Y'                                                         AR676495
     C                     ADD  TSSTDO    WKSTXO                                            AR676495
     C                     ENDIF                                                            AR676495
     C           CER054    IFEQ 'Y'                                                         AR676495
     C                     ADD  TSTTDO    WKTTXO                                            AR676495
     C                     ENDIF                                                            AR676495
     C                     ADD  TSTXSR    WTAOC                                             AR676495
     C                     ELSE                                                             AR676495
     C                     ADD  TSTXSR    WTAOC                                             AR676495
     C                     ADD  TSTXSC    WTATC                                             AR676495
     C                     ADD  TSTXSB    WTABC                                             AR676495
     C           CER048    IFEQ 'Y'                                                         AR676495
     C                     ADD  TSSTDO    WKSTXO                                            AR676495
     C                     ADD  TSSTDT    WKSTXT                                            AR676495
     C                     ADD  TSSTDB    WKSTXB                                            AR676495
     C                     ENDIF                                                            AR676495
     C           CER054    IFEQ 'Y'                                                         AR676495
     C                     ADD  TSTTDO    WKTTXO                                            AR676495
     C                     ADD  TSTTDT    WKTTXT                                            AR676495
     C                     ADD  TSTTDB    WKTTXB                                            AR676495
     C                     ENDIF                                                            AR676495
     C                     ENDIF                                                            AR676495
     C                     ENDIF                                                            AR676495
      *                                                                                     AR676495
     C                     MOVE TSWTAC    WEWTA                                             AR676495
     C           CER048    IFEQ 'Y'                                                         AR676495
     C                     MOVE TSSTAC    WSTAC                                             AR676495
     C                     ENDIF                                                            AR676495
     C           CER054    IFEQ 'Y'                                                         AR676495
     C                     MOVE TSTTAC    WTTAC                                             AR676495
     C                     ENDIF                                                            AR676495
     C           WJACC     IFEQ 'Y'                                                         AR676495
      *                                                                                     AR676495
      ** GENERATE EU A/C KEYS FOR TAX AMOUNT.                                               AR676495
      *                                                                                     AR676495
     C                     EXSR SREATA                                                      AR676495
     C                     ENDIF                                                            AR676495
     C                     ENDIF                                                            AR676495
     C                     ENDSR                                                            AR676495
      *****************************************************************   CPB001
      /EJECT                                                              CPB001
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE3664CCP2                                           S01408
     C*                                                                   S01408
     C********************************************************************
     O*********REHISPPFE                HISPD
     OACCNTXF E                RACNTX
     O/COPY WNCPYSRC,RE3664O001
     O*****************************************************************
      /COPY ZSRSRC,ZDATE2Z3
**  CPY@  OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**  ZFMD
312831303130313130313031
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  TAB1= JOB NAME,  TABA= ALTERNATE A/Cs  (14A)                          085787
REC64A    ALTERNATE A/Cs
REC64AD   ALTERNATE A/Cs
**  EUTXN2                                                                                  AR318139
European Taxation of Interest
**  SVAL  -  System Values Array                                                              CRE100
RET_INTAC_CUST_LVL                                                                            CRE100
RET_CHG_CUST_LVL                                                                              CRE100
RET_SEQ_CUST_LVL                                                                            MD034990
