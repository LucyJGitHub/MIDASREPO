     H        1
      *****************************************************************
/*S*D****RPGBASE*******************************************************                       CSD053
/*STD *  RPGBNOCVT                                                    *                       CSD053
/*EXS *  RPGCVTOPT1                                                   *                       CSD053
/*EXI *  TEXT('Midas RE Interest statement print ICD 5')              *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Retail Module
     F*                                                               *
     F*  RE3765  - INTEREST STATEMENT PRINT ICD 5                     *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CRE075             Date 06Dec10               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 BUG23123           Date 09Mar09               *
      *                 CER048             Date 19May08               *
      *                 CER016             Date 19May08               *
      *                 CER047             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD053             Date 01Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 11May06               *
      *                 CSD027             Date 09Dec05               *
      *                 235917             Date 08Sep05               *
      *                 CGL035             Date 05Jul04               *
      *                 CGL031             Date 05Jul04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 182037             Date 22Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 194059             Date 06Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CDE002             Date 21Dec99               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 180892             Date 14Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CFT004             Date 27Jul99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 130468             Date 30Apr99               *
      *                 104618             Date 19May98               *
     F*                 CRE001             Date 18Feb97               *
     F*                 098818             Date 15Apr96               *
     F*                 094431             Date 16Oct95               *
     F*                 087284             DATE 04MAY95               *
     F*                 084174             DATE 02MAR95               *
     F*                 S01413 *CREATE     DATE 13APR93               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *                     (Recompile)                               *
      *  CER048 - German Features - Taxes                             *
      *  CER016 - German Interest Calculation: Upgrade of FGE059      *
      *           to Midas Plus                                       *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CRE026 - Consumer Banking                                    *
      *  CSD053 - Correspondence Manager Multilanguage Upgrade.       *
      *         - Recompile only due to changes in RE3765DC,         *
      *           RE3765HC and RE3765CH.                             *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  235917 - No EU tax printed for joint accounts                *
      *  CGL035 - EUSD Upgrade to MidasPlus                           *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  182037 - For capitalisations due for both credit and debit   *
      *           side: the Fixed Commission must be included in the  *
      *           computation of the total interest even if there is  *
      *           no interest to capitalise on the debit side.        *
      *  194059 - Rename TRAT in files REHRDJ and REHRCJ.             *
      *  CDE002  -  Revenue Analysis - Recompiled due to changes in   *
      *             PF/RECCYD.                                        *
      *  180892 - Incorrect coding of CRE001 for overdraft printing.  *
      *           Re-apply CRE001 correctly for overdraft printing.   *
      *  CFT004 - Straight Through Processing Phase 2                 *
      *           International Bank Account Numbers (IBAN)           *
      *  CGL007 - Account Postings Enquiry.  Recompile.               *
     F*  130468 - BRT not deducted from CR interest adjustments.      *
     F*           Also report total adjustments (CSGADI/CSGACI).      *
     F*  104618 - Choose correct BRT rate in same way as RE3664.      *
     F*  CRE001 - Overdraft Interest Calculations:                    *
     F*         - Include O/D Line and O/D Interest Rate Changes to   *
     F*           Debit Capitalisation Report.                        *
     F*  098818 - Allow for interest capital indicator on REHISPS     *
     F*           to retain its original values of 'C' 'D' 'Y' &      *
     F*           ' ' to be used by input cycle enquiries.            *
     F*  094431 - Recompiled over changed REHISSL and REHPOPH.        *
     F*  087284 - Use AOCUSTR0 to retrieve address reference B        *
     F*  084174 - Use AOALTNR0 to retrieve alternative addresses      *
     F*  S01413 - Retail 3 Incorporation                              *
     F*                                                               *
     F*****************************************************************
     FRECAPML IF  E           K        DISK
     FCLINT   IF  E           K        DISK
     F            CLINTCCF                          KIGNORE               084174
     FSDCSINL7IF  E           K        DISK                                                   CGL031
      ** Midas SD Customer Income - Customer Number Retrieve Index                            235917
     FSDCSINLCIF  E           K        DISK                                                   235917
     F            SDCSIND0                          KRENAMESDCSINDC                           235917
      ** Midas SD Customer Income - Joint A/c Number Retrieve Index                           235917
     FSDJACCL1IF  E           K        DISK                                                   235917
      ** Midas SD Joint A/c Member Details - Retrieve Index                                   235917
     FREHISL  IF  E           K        DISK
     FREHISSL IF  E           K        DISK
     F            REHISPSF                          KRENAMEREADJF
     FRECOM   IF  E           K        DISK
     FREHPOPL IF  E           K        DISK
     F            REHPOSPF                          KRENAMEREHPOPLF
     FREHPOPH IF  E           K        DISK
     F            REHPOSPF                          KRENAMEREHPOPHF
     FACCRACJ IF  E           K        DISK
     FREHRDJ  IF  E           K        DISK
     FREHRCJ  IF  E           K        DISK
     FACCNT   IF  E           K        DISK
     FSDBRTDL1IF  E           K        DISK
     FRECCY   IF  E           K        DISK
     F            RECCYAF                           KIGNORE
     F            RECCYZF                           KIGNORE
     FCLEAR   IF  E           K        DISK
     F            APOSTHHF                          KIGNORE
     F            APOSTZZF                          KIGNORE
     FTABTBRE IF  E                    DISK                           UC
     FSDCURRL0IF  E           K        DISK
     FTABLEV4 IF  E                    DISK
     F/COPY WNCPYSRC,RE3765F001
     FRE3765HCO   E             74     PRINTER      KINFDS SPOOL      UC
     FRE3765DCO   E             73     PRINTER      KINFDS SPOOL1     UC
     FRE3765AUO   E             72     PRINTER      KINFDS SPOOLU
     F/COPY WNCPYSRC,RE3765F002
     F/EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*  01  DEBIT CAPITALISATION                                     *
     F*  02  CREDIT CAPITALISATION                                    *
     F*  20  IN CASE OF BACK VALUE PROCESSING ACCESS REHISSL          *
     F*  22  OUTPUT BRT DETAILS TO REPORT                             *
     F*  30  CAPITALISATION IS ON DEMAND OR FOR MANAGEMENT STMT.      *   104618
     F*  33  IF EXEMPT OF TURNOVER COMMISSION                         *
     F*  41  TO PRINT SIGN FOR WITHHOLDING TAX                        *
     F*  48  TOTAL CREDITED                                           *
     F*  49  TOTAL DEBITED                                            *
     F*  50  USE WITH REHPOPL & REHPOPH                               *
     F*  51  USE WITH REHISL                                          *
     F*  52  USE WITH REHISL                                          *
     F*  53  USE WITH CLEARL1                                         *
     F*  54  TURNOVER COMMISSION ON FOR THIS ACCOUNT                  *
     F*  60  USE WITH REHRDJ AND REHRCJ                               *
     F*  70  MANAGEMENT STATEMENT PRINT                               *
     F*  72  OVERFLOW INDICATORE ON PRINTER FOR AUDIT                 *
     F*  73  OVERFLOW INDICATORE ON PRINTER FOR DEBIT AND CREDIT      *
     F*  74  OVERFLOW INDICATORE ON PRINTER FOR CHARGES               *
     F*  80  NUMBER OF DECIMAL POSITION WITH CURRENCY = 0             *
     F*  81  NUMBER OF DECIMAL POSITION WITH CURRENCY = 1             *
     F*  82  NUMBER OF DECIMAL POSITION WITH CURRENCY = 2             *
     F*  83  NUMBER OF DECIMAL POSITION WITH CURRENCY = 3             *
     F*  85  MULTIBRANCHING OUTPUT INDICATOR                          *
     F*  86  MULTIBRANCHING INDICATOR MBIN = 'Y'                      *
     F*  89  USE TO PRINT END OF AUDIT WHEN DB ERROR                  *
     F*  96  CURRENCIES ARRAY IS FULL                                 *
     F*  97  USE IF CURRENCY EXIST                                    *
     F*  98  DATF = M                                                 *
     F*  99  USE WITH ACCRACJ AND CLINT FILES                         *
     F*                                                               *
     F*  U7  DATABASE ERROR                                           *
     F*  U8  DATABASE ERROR                                           *
     F*  LR  END OF PROGRAM                                           *
     F*                                                               *
     F*  DB ERROR NUMBER MAXIMUM 52 (INCLUDE)                         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  BOTHSR - Credit and Debit processing                         *
     F*  B1EQ   - When debit and credit begin at the same date        *
     F*  B1GT   - When debit begin before credit                      *
     F*  B1LT   - When credit begin before debit                      *
     F*  CALBRT - Calculate base rate tax                             *
     F*  CALEUT - Calculate EU withholding tax                        *                       CGL031
     F*  CLMSG  - Clear message                                       *
     F*  CRSR   - Credit only processing                              *
     F*  DAYTSR - Prepare and output days total                       *
     F*  DBSR   - Database error handling                             *
     F*  DRSR   - Debit only processing                               *
     F*  DETPR  - Detail processing                                   *
     F*  FIRST  - First cycle                                         *
     F*  ITYPCR - Interest type greater than 2                        *
     F*  ITYPDR - Interest type greater than 2                        *
     F*  MAIN   - Main processing                                     *
     F*  OPENCR - Credit opening bal and credit opening rate ouput    *
     F*  OPENDR - Debit opening bal and debit opening rate output     *
     F*  OVERDC - Subroutine for processing overflow on RE3764DC      *
     F*  POSTSR - Posting output                                      *
     F*  RATEC  - Prepare and output credit rate change               *
     F*  RATED  - Prepare and output debit rate change                *
     F*  RATESR - Rate change processing                              *
     F*  RCRSR  - Credit rate change output                           *
     F*  RDRSR  - Debit rate change output                            *
     F*  TOTAL  - Total processing                                    *
     F*  TOTSR  - Days total output for crdeit and debit              *
     F*  ZICD   - Find number of days to calculate interest according *
     F*           to calculation basis                                *
     F*  *PSSR  - Error subroutine for certain access object errors   *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     E                    CCYA      200  3
     E                    DPA       200  1 0
     E                    CMD     1   1 39
     E                    CPY@    1   1 80
     E/COPY WNCPYSRC,RE3765E001
     E********************NAR        34 39                                CRE001
     E                    NAR        37 39                                CRE001
     E/COPY WNCPYSRC,RE3765E002
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    CURR      150  3               CURRENCY
     E                    AMAX      150 13 0             ACCOUNT MAXIMUM
     E                    AMIN      150 13 0             ACCOUNT MINIMUM
     E                    ARET      150 10 8             COMMISSION RATE
     E**
     E*    STORE THE EIGHT GROUP EACH CUSTOMER IS ASSOCIATED
     E*
     E                    CGRP        9  1               CUSTOMER GROUP
     E                    AGRP        9  1               ACCOUNT COMMISS.
     ICLINTCBF
     I*
     I** RENAME CLINTCBF FORMAT FIELDS - CLINT FILE
     I*
     I              CUGRP                           CCGRP
     I/COPY WNCPYSRC,RE3765I001
     IREADJF
     I*
     I** RENAME READJF FORMAT FIELDS - REHISSL FILE
     I*
     I              RECI                            ARECI
     I              BRCA                            ABRCA
     I              CNUM                            ACNUM
     I              CCY                             ACCY
     I              ACOD                            AACOD
     I              ACSQ                            AACSQ
     I              HISD                            AHISD
     I              HISB                            AHISB
     I              MNBL                            AMNBL
     I              PCHGAR                          ACHGAR
     I              TCHGAR                          ATHGAR
     I              PCHGAN                          ACHGAN
     I              TCHGAN                          ATHGAN
     I              DICT                            ADICT
     I              DRCB                            ADRCB
     I              DRCD                            ADRCD
     I              DAIC                            ADAIC
     I              PMADI                           APMADI
     I              TMADI                           ATMADI
     I              PDID                            APDID
     I              DMINT                           ADMINT
     I              DRIP                            ADRIP
     I              DRIS                            ADRIS
     I              CICT                            ACICT
     I              CRCB                            ACRCB
     I              CRCD                            ACRCD
     I              CAIC                            ACAIC
     I              PMACI                           APMACI
     I              TMACI                           ATMACI
     I              PCID                            APCID
     I              CMINT                           ACMINT
     I              CRIP                            ACRIP
     I              CRIS                            ACRIS
     I              STBL                            ASTBL
     I              CHGP                            ACHGP
     IREHISPSF
     I*
     I** RENAME REHISPSF FORMAT FIELDS - REHISL  FILE
     I*
     I              RECI                            DRECI
     I              BRCA                            SBRCA
     I              CNUM                            SCNUM
     I              CCY                             SCCY
     I              ACOD                            SACOD
     I              ACSQ                            SACSQ
     I              HISD                            DHISD
     I              HISB                            DHISB
     I              MNBL                            SMNBL
     I              PCHGAR                          SCHGAR
     I              TCHGAR                          STHGAR
     I              PCHGAN                          SCHGAN
     I              TCHGAN                          STHGAN
     I              DICT                            DDICT
     I              DRCB                            SDRCB
     I              DRCD                            SDRCD
     I              DAIC                            SDAIC
     I              PMADI                           SPMADI
     I              TMADI                           STMADI
     I              PDID                            SPDID
     I              DMINT                           SDMINT
     I              DRIP                            SDRIP
     I              DRIS                            SDRIS
     I              CICT                            DCICT
     I              CRCB                            SCRCB
     I              CRCD                            SCRCD
     I              CAIC                            SCAIC
     I              PMACI                           SPMACI
     I              TMACI                           STMACI
     I              PCID                            SPCID
     I              CMINT                           SCMINT
     I              CRIP                            SCRIP
     I              CRIS                            SCRIS
     I              STBL                            SSTBL
     I              CHGP                            SCHGP
     IREHISPPF
     I*
     I** RENAME REHISPPF FORMAT FIELDS - REHISL  FILE
     I*
     I              RECI                            DRECI
     I              BRCA                            DBRCA
     I              CNUM                            DCNUM
     I              CCY                             DCCY
     I              ACOD                            DACOD
     I              ACSQ                            DACSQ
     I              HISD                            DHISD
     I              HISB                            DHISB
     I              MNBL                            DMNBL
     I              CHGAR                           DCHGAR
     I              TCHGAR                          DTHGAR
     I              CHGAN                           DCHGAN
     I              TCHGAN                          DTHGAN
     I              DMVT                            DDMVT
     I              DICT                            DDICT
     I              DRCB                            DDRCB
     I              DRCD                            DDRCD
     I              DAID                            DDAID
     I              MADI                            DMADI
     I              TMADI                           DTMADI
     I              PDID                            DPDID
     I              DMINT                           DDMINT
     I              CMVT                            DCMVT
     I              CICT                            DCICT
     I              CRCB                            DCRCB
     I              CRCD                            DCRCD
     I              CAID                            DCAID
     I              MACI                            DMACI
     I              TMACI                           DTMACI
     I              PCID                            DPCID
     I              CMINT                           DCMINT
     I              DICI                            DDICI
     I              CICI                            DCICI
     I              DRCI                            DDRCI
     I              CRCI                            DCRCI
     I              VDTC                            DVDTC
     I              ADTY                            DADTY
     I              ALTI                            DALTI
     I              MNBCP                           DMNBCP
     IREHISPMF
     I*
     I** RENAME REHISPMF FORMAT FIELDS - REHISL  FILE
     I*
     I              RECI                            DRECI
     I              HISD                            MHISD
     I*
     IREHRDJF
     I*
     I** RENAME REHRDJF  FORMAT FIELDS - REHRDJ FILE
     I*
     I              RECI                            RRECI
     I              PSTD                            RPSTD
     I              VALD                            RVALD
     I              HISD                            RHISD
     I              PNAR                            RPNAR
     I              DRCR                            RDRCR
     I              TRAT                            RTRAT                                     194059
     I*
     IREHRCJF
     I*
     I** RENAME REHRCJF  FORMAT FIELDS - REHRCJ FILE
     I*
     I              RECI                            RRECI
     I              PSTD                            RPSTD
     I              VALD                            RVALD
     I              HISD                            RHISD
     I              PNAR                            RPNAR
     I              DRCR                            RDRCR
     I              TRAT                            RTRAT                                     194059
     I*
     IACCRACJF
     I*
     I** RENAME ACCRACJF FORMAT FIELDS - ACCRACJ FILE
     I*
     I              TEGLIS                          CTGLIS
     I*
     I* BRT ICD
     ISDBRTDD0
     I              ACOD                            ACODXX
     I*
     ICPYR@#      DS
     I*
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I*
     ISDBANK    E DSSDBANKPD
     I              BJURPT                          TITL
     I              BJDNWD                          DNWD
     I**  EXTERNAL DS FOR BANK DETAILS
     I**
     I*
     ISDRETL    E DSSDRETLPD                                              104618
     I              BMLDAI                          LDAC                  104618
     I              BMCBAI                          CBAI                  104618
     I              BMNDFV                          NDFV                  104618
     I              BMNDBI                          NDBI                  104618
     I              BMRCPI                          RCPT                  104618
     I              BMRANR                          RACN                  104618
     I**  Retail Details                                                  104618
     I*                                                                   104618
     I** DATA STRUCTURE FOR BEGINNING DATE
     I*
     I            DS
     I                                        1   60SRES
     I                                        1   20ZISD
     I                                        3   40ZISM
     I                                        5   60ZISY
     I*
     I** DATA STRUCTURE FOR FINISHING DATE
     I*
     I            DS
     I                                        1   60FRES
     I                                        1   20ZIFD
     I                                        3   40ZIFM
     I                                        5   60ZIFY
     I*
     I** DATA STRUCTURE FOR CURRENCY DECIMAL
     I*
     I            DS
     I                                        1  150HISB0
     I                                        1  151HISB1
     I                                        1  152HISB2
     I                                        1  153HISB3
     I*
     I            DS
     I                                        1  150TCHR0
     I                                        1  151TCHR1
     I                                        1  152TCHR2
     I                                        1  153TCHR3
     I*
     I            DS
     I                                        1  150TCHN0
     I                                        1  151TCHN1
     I                                        1  152TCHN2
     I                                        1  153TCHN3
     I*
     I            DS
     I                                        1  150CHGP0
     I                                        1  151CHGP1
     I                                        1  152CHGP2
     I                                        1  153CHGP3
     I*
     I            DS
     I                                        1  150CHGR0
     I                                        1  151CHGR1
     I                                        1  152CHGR2
     I                                        1  153CHGR3
     I*
     I            DS
     I                                        1  150CHGN0
     I                                        1  151CHGN1
     I                                        1  152CHGN2
     I                                        1  153CHGN3
     I*
     I            DS
     I                                        1  120TINT0
     I                                        1  121TINT1
     I                                        1  122TINT2
     I                                        1  123TINT3
     I*
     I            DS
     I                                        1  150TGINT0
     I                                        1  151TGINT1
     I                                        1  152TGINT2
     I                                        1  153TGINT3
     I*
     I            DS
     I                                        1  150BRTOT0
     I                                        1  151BRTOT1
     I                                        1  152BRTOT2
     I                                        1  153BRTOT3
     I*
     I            DS                                                                          CGL031
     I                                        1  150EUTAX0                                    CGL031
     I                                        1  151EUTAX1                                    CGL031
     I                                        1  152EUTAX2                                    CGL031
     I                                        1  153EUTAX3                                    CGL031
      *                                                                                       CGL031
     I            DS                                                                          CER048
     I                                        1  150STAX0                                     CER048
     I                                        1  151STAX1                                     CER048
     I                                        1  152STAX2                                     CER048
     I                                        1  153STAX3                                     CER048
      *                                                                                       CER048
     I            DS
     I                                        1  150PSTD0
     I                                        1  151PSTD1
     I                                        1  152PSTD2
     I                                        1  153PSTD3
     I*
     I            DS
     I                                        1  120INT0
     I                                        1  121INT1
     I                                        1  122INT2
     I                                        1  123INT3
     I*
     I            DS
     I                                        1  150OBAL01
     I                                        1  151OBAL11
     I                                        1  152OBAL21
     I                                        1  153OBAL31
     I*
     I            DS
     I                                        1  150OBAL02
     I                                        1  151OBAL12
     I                                        1  152OBAL22
     I                                        1  153OBAL32
     I*
     I            DS
     I                                        1  150OBAL03
     I                                        1  151OBAL13
     I                                        1  152OBAL23
     I                                        1  153OBAL33
     I*
     I** DATA STRUCTURE FOR RATE SPREAD
     I*
     I            DS
     I                                        1  36 RAT2
     I                                    P   1   67RAT21
     I                                    P   7  127RAT22
     I                                    P  13  187RAT23
     I                                    P  19  247RAT24
     I                                    P  25  307RAT25
     I                                    P  31  367RAT26
     I                                        1   6 RATC21
     I                                        7  12 RATC22
     I                                       13  18 RATC23
     I                                       19  24 RATC24
     I                                       25  30 RATC25
     I                                       31  36 RATC26
     I*
     I            DS
     I                                        1  36 RAT3
     I                                    P   1   67RAT31
     I                                    P   7  127RAT32
     I                                    P  13  187RAT33
     I                                    P  19  247RAT34
     I                                    P  25  307RAT35
     I                                    P  31  367RAT36
     I                                        1   6 RATC31
     I                                        7  12 RATC32
     I                                       13  18 RATC33
     I                                       19  24 RATC34
     I                                       25  30 RATC35
     I                                       31  36 RATC36
     I*
     I** DATA STRUCTURE FOR BALANCE
     I*
     I            DS
     I                                        1  48 BAL2
     I                                    P   1   80BAL21
     I                                    P   9  160BAL22
     I                                    P  17  240BAL23
     I                                    P  25  320BAL24
     I                                    P  33  400BAL25
     I                                    P  41  480BAL26
     I                                        1   8 BALC21
     I                                        9  16 BALC22
     I                                       17  24 BALC23
     I                                       25  32 BALC24
     I                                       33  40 BALC25
     I                                       41  48 BALC26
     I*
     I            DS
     I                                        1  48 BAL3
     I                                    P   1   80BAL31
     I                                    P   9  160BAL32
     I                                    P  17  240BAL33
     I                                    P  25  320BAL34
     I                                    P  33  400BAL35
     I                                    P  41  480BAL36
     I                                        1   8 BALC31
     I                                        9  16 BALC32
     I                                       17  24 BALC33
     I                                       25  32 BALC34
     I                                       33  40 BALC35
     I                                       41  48 BALC36
     I*
     I** DATA STRUCTURE FOR DATE FORMAT DD/MM/YY
     I*
     I            DS
     I                                        1   60RESULT
     I                                        1   20ZDAY
     I                                        3   40ZMTH
     I                                        5   60ZYEAR
     I*
     I**  DATA STRUCTURE FOR CHANGE OF ACCOUNT
     I*
     IOKEYD       DS
     I**********                              1  18 OKEY                                      CGL029
     I                                        1  24 OKEY                                      CGL029
     I                                        1   3 OBRCA
     I**********                              4   90OCNUM                                     CSD027
     I                                        4   9 OCNUM                                     CSD027
     I                                       10  12 OCCY
     I**********                             13  160OACOD                                     CGL029
     I**********                             17  180OACSQ                                     CGL029
     I**********                          P  19  210OLDID                                     CGL029
     I                                       13  220OACOD                                     CGL029
     I                                       23  240OACSQ                                     CGL029
     I                                    P  25  270OLDID                                     CGL029
     I*
     I**   NAME OF MESSAGE FILE
     I*
     I            DS
     I                                        1  39 CMD1
     I                                       16  17 FILT1
     I                                       33  34 FILT2
     I*
     I**  DATA STRUCTURE FOR REFERENCE ADDRESS
     I*
     I                                        1   8 ADREF1
     I                                        1   1 WRCDT
     I*
     I**  DATA STRUCTURE FOR TABLEV4
     I*
     IKEY         DS
     I                                        1   20RECT
     I                                        3  12 ZZ010
     I*
     I**  DATA STRUCTURE IN CASE OF DATA BASE ERROR
     I*
     IRKEY2       DS
     I                                        1  18 RKEY
     I                                        1   3 CBRCA
     I**********                              4   90CCNUM                                     CSD027
     I                                        4   9 CCNUM                                     CSD027
     I                                       10  12 CCCY
     I**********                             13  160CACOD                                     CGL029
     I**********                             17  180CACSQ                                     CGL029
     I**********                             19  230WDATE                                     CGL029
     I                                       13  220CACOD                                     CGL029
     I                                       23  240CACSQ                                     CGL029
     I                                       25  290WDATE                                     CGL029
     I                                        1   3 CBRCA2
     I**********                              4  18 AKEY                                      CGL029
     I                                        4  24 AKEY                                      CGL029
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA        UDS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I********************************************************************
     I**
     I**   FILE INFORMATION DATA STRUCTURE - P1
     I**
     ISPOOL       DS
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
     I**
     ISPOOL1      DS
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I**
     I**   FILE INFORMATION DATA STRUCTURE - AU
     I**
     ISPOOLU      DS
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
     I**
     I** DATA AREA RUNDAT
     I**
     IRUNDT       DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     I/COPY WNCPYSRC,RE3765I003
     ISDBRCH    E DSSDBRCHPD
     I**
     I              A8BRNM                          BRNM
     I*
     ISDCUST    E DSSDCUSTPD
     I** Customer Details
     I              BBCGRP                          CUCGRP
     I              QQDFAC                          QQDFA1                                    CGL029
     I*
     ISCSARD    E DSSCSARDPD                                              CFT004
      ** MIDAS Switchable Features Accessed Via Access Program            CFT004
      *                                                                   CFT004
     IACCNTB    E DSACCNTAB                                               CFT004
      ** MIDAS Account Master Details Accessed Via Access Program         CFT004
      *                                                                   CFT004
     I              ADREF1                          ADREFX                CFT004
     I              LCD                             LCDX                  CFT004
     IDSFDY     E DSDSFDY
     I* First DS for access programs, short data structure
     I*
     I/COPY WNCPYSRC,RE3765I002
     IDSSDY     E DSDSSDY
     I* Second DS for access programs, long data structure
     I*                                                                   084174
     I*___________________________________________________________________084174
     I* 084174                                                            084174
     I*                                                                   084174
     I***P#CORR    E DSCGCORRPD                                     084174087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     IP#ALTN    E DSSDALTNPD                                              087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     I* 084174                                                            084174
     I*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~084174
     I*
     C*===================================================================
     C                     MOVEACPY@      BIS@   80
     C           *NAMVAR   DEFN           LDA
     C*
     C** KEY LISTS
     C*
     C*
     C** KEY FIELD TO ACCESS TO FILE
     C*
     C**  KLIST TO ACCESS RECOM
     C*
     C           KLIST0    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C*
     C**  KLIST TO ACCESS REHISL, REHPOPL, REHPOPH, REHISSL & ACCRACJ
     C*
     C           KLIST1    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C*
     C**  KLIST TO ACCESS REHISL, REHPOPH & REHPOPL
     C*
     C           KLIST2    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           CLDID
     C*
     C**  KLIST TO ACCESS REHISL, REHPOPH & REHPOPL
     C*
     C           KLIST3    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           CLCID
     C*
     C**  KLIST TO ACCESS CLINT
     C*
     C           KLIST4    KLIST
     C                     KFLD           CCNUM
     C                     KFLD           RCDT
     C*
     C**  KLIST TO ACCESS REHRDJ
     C*
     C           KLIST5    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           DDRCD
     C*
     C**  KLIST TO ACCESS REHRCJ
     C*
     C           KLIST6    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           DCRCD
     C*
      **  KLIST TO ACCESS SDCSINL7                                                            CGL031
      *                                                                                       CGL031
     C           KLIST7    KLIST                                                              CGL031
     C                     KFLD           RUND                                                CGL031
     C                     KFLD           MODI    1                                           CGL031
     C                     KFLD           P#NUM   6                                           CGL031
     C                     KFLD           CCCY                                                CGL031
     C                     KFLD           CACOD                                               CGL031
     C                     KFLD           CACSQ                                               CGL031
     C                     KFLD           CBRCA                                               CGL031
     C*                                                                                       CGL031
      ** Key fields to access LF/SDCSINLC.                                                    235917
      *                                                                                       235917
     C           KLISTC    KLIST                                                              235917
     C                     KFLD           RUND                                                235917
     C                     KFLD           MODI                                                235917
     C                     KFLD           KJOIN                                               235917
     C                     KFLD           CCCY                                                235917
     C                     KFLD           CACOD                                               235917
     C                     KFLD           CACSQ                                               235917
     C                     KFLD           CBRCA                                               235917
     C*                                                                                       235917
     C**  KLIST TO ACCESS CLEAR
     C*
     C           KCLEAR    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C*
     C**  KLIST TO ACCESS ACCNT
     C*
     C           KACCNT    KLIST
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           CBRCA
     C*
     C**  KLIST TO ACCESS REEODLF
     C*
     C           KEODLF    KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           KDATE
     C*
     C**  KLIST TO ACCESS REHPOPH
     C*
     C           KREHP     KLIST
     C                     KFLD           CBRCA
     C                     KFLD           CCNUM
     C                     KFLD           CCCY
     C                     KFLD           CACOD
     C                     KFLD           CACSQ
     C                     KFLD           KDATE
     C                     KFLD           KDATE2
     C*
     C** PARAMTER SEND BY THE CL: IT IS THE LANGUAGE CODE DEFAULT
     C*
     C           *ENTRY    PLIST
     C                     PARM           DLGID
     C*
     C** SET UP PARAMETER TO FORM OUTPUT LINE
     C*
     C           ZA1311    PLIST
     C                     PARM           MSGID   7
     C                     PARM           MSGDT0 40
     C                     PARM           MSGDT1 40
     C                     PARM           MSGDT2 40
     C                     PARM           MSGDT3 40
     C                     PARM           MSGDT4 40
     C                     PARM           MSGDT5 40
     C                     PARM           MSGDT6 40
     C                     PARM           MSGDT7 40
     C                     PARM           MSGDT8 40
     C                     PARM           MSGDT9 40
     C                     PARM           MNARR 200
     C*
     C** WORK FIELDS DEFINITION
     C*
     C           *LIKE     DEFN LGID      OLGID
     C           *LIKE     DEFN DDAID     WDAID
     C           *LIKE     DEFN DCAID     WCAID
     C           *LIKE     DEFN LGID      DLGID
     C           *LIKE     DEFN DBKEY     ERRDAT
     C********** *LIKE     DEFN CNUM      I     - 3                                           CSD027
     C                     Z-ADD*ZEROS    I       30                                          CSD027
     C           *LIKE     DEFN RUND      PPSTD
     C********** *LIKE     DEFN CNUM      PSTDO                                               CSD027
     C                     Z-ADD*ZEROS    PSTDO   60                                          CSD027
     C           *LIKE     DEFN RUND      PVALD
     C********** *LIKE     DEFN CNUM      VALDO                                               CSD027
     C                     Z-ADD*ZEROS    VALDO   60                                          CSD027
     C           *LIKE     DEFN ACNO      WACNO
     C           *LIKE     DEFN DCRCB     WCRCB
     C           *LIKE     DEFN DDRCB     WDRCB
     C           *LIKE     DEFN DHISB     WHISB
     C           *LIKE     DEFN DHISD     WHISD
     C           *LIKE     DEFN DHISD     WWHISD
     C           *LIKE     DEFN DHISD     WHISDC
     C           *LIKE     DEFN DHISD     WHISDD
     C           *LIKE     DEFN MNBL      WMNBL
     C           *LIKE     DEFN DHISB     W1STBL
     C           *LIKE     DEFN DHISB     W2STBL
     C           *LIKE     DEFN DHISB     DOHISB
     C           *LIKE     DEFN DHISB     COHISB
     C********** *LIKE     DEFN CNUM      ZERROR- 5                                           CSD027
     C                     Z-ADD*ZEROS    ZERROR  10                                          CSD027
     C           *LIKE     DEFN RUND      ZIBEG
     C           *LIKE     DEFN RUND      ZIBW1
     C           *LIKE     DEFN RUND      ZIDREM
     C           *LIKE     DEFN CICT      ZIDW1
     C           *LIKE     DEFN RUND      ZIDW2
     C           *LIKE     DEFN RUND      ZID1
     C           *LIKE     DEFN RUND      ZID2
     C           *LIKE     DEFN RUND      ZIEND
     C           *LIKE     DEFN RUND      ZILPCP
     C           *LIKE     DEFN CICT      ZIMAN
     C           *LIKE     DEFN CICT      ZIM1
     C           *LIKE     DEFN RUND      ZIREM
     C           *LIKE     DEFN CICT      ZIY1
     C*
     C/COPY WNCPYSRC,RE3765C001
     C*===================================================================
     C*
     C/EJECT
     C*===================================================================
     C** P R O G R A M     S T A R T
     C*===================================================================
     C*
     C** FIRST CYCLE PROCESSING
     C*
     C                     EXSR FIRST
     C*
     C** MAIN PROCESSING
     C*
     C                     EXSR MAIN
     C*
     C** TOTAL PROCESSING
     C*
     C                     EXSR TOTAL
     C*
     C*===================================================================
     C** P R O G R A M     E N D
     C*===================================================================
     C/EJECT
     C********************************************************************
     C**
     C** BOTHSR subroutine for debit and credit output processing
     C**
     C**     Called by       D E T P R
     C**
     C**     Calls           DBSR, B1EQ, B1LT, B1GT, POSTSR, RATESR
     C**                     TOTSR, ZICD
     C**
     C           BOTHSR    BEGSR                           **BOTHSR BEGSR*
     C*
     C           KLIST2    CHAINREHISL               52
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD1         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 01**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADD*ZEROS    W1STBL
     C                     Z-ADDDDRCD     WWDRCD  50
     C                     Z-ADDDCRCD     WWCRCD  50
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     W1STBL
     C                     Z-ADDSDRCD     WWDRCD
     C                     Z-ADDSCRCD     WWCRCD
     C                     ELSE                            - X2
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD2         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 02**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E2
     C                     END                             - E1
     C                     Z-ADDDHISB     DOHISB
     C                     Z-ADDCLDID     WHISDD
     C*
     C           KLIST3    CHAINREHISL               52
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD3         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 03**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADD*ZEROS    W2STBL
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     W2STBL
     C                     ELSE                            - X2
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD4         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 04**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E2
     C                     END                             - E1
     C                     Z-ADDDHISB     COHISB
     C                     Z-ADDCLCID     WHISDC
     C*
     C           CLDID     IFLT CLCID                      - B1
     C           KLIST2    CHAINREHISL               52
     C                     END                             - E1
     C*
     C                     MOVE '0'       *IN65
     C           ACNO      IFNE *ZEROS
     C                     MOVE '1'       *IN65
     C                     END
     C/COPY WNCPYSRC,RE3765C010
     C                     WRITEHEADDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B1
     C           CCHGP     ANDNE*ZERO
     C/COPY WNCPYSRC,RE3765C011
     C                     WRITEHEADCH
     C                     END                             - E1
     C*
     C                     MOVE *BLANKS   VALDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,1     TNARR
     C*
     C           CLDID     IFLT CLCID                      - B1
     C                     Z-SUBW1STBL    HISB0
     C                     ELSE                            - X1
     C                     Z-SUBW2STBL    HISB0
     C                     END                             - E1
     C                     Z-ADDDHISB     WHISB
     C*
     C**  B/F BALANCE OUTPUT
     C*
     C                     WRITETITLEDC
     C*
     C**  PROCESS BACK VALUE AND OPENING
     C*
     C           CLDID     CASEQCLCID     B1EQ
     C           CLDID     CASLTCLCID     B1LT
     C           CLDID     CASGTCLCID     B1GT
     C                     CAS            DBSR
     C                     END
     C*
     C           DRECI     IFEQ 'S'                        - B1
     C                     Z-ADDDHISD     WWHISD
     C                     Z-ADDDHISB     WHISB
     C                     Z-ADDSMNBL     WMNBL
     C                     Z-ADDDDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           WWHISD    ANDNEDHISD
     C           DRECI     ANDNE'S'
     C*
     C           CDICT     IFLT 3                          - B3
     C           CCICT     ANDLT3
     C*
     C**  PROCESS IN CASE OF INTEREST TYPE ARE BOTH LESS THAN 3
     C*
     C           WHISB     IFGT *ZEROS                     - B4
     C*
     C**  PROCESS WHEN CHANGE RATE DEBIT
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBDOHISB    HISB0
     C*
     C           *IN80     IFEQ '1'                        - B5
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X5
     C           *IN81     IFEQ '1'                        - B6
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X6
     C           *IN82     IFEQ '1'                        - B7
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X7
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
     C*
     C           DCAID     SUB  DDAID     INT0
     C*
     C           DAYS      IFNE *ZEROS                     - B5
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B6
     C           DTHGAR    IFNE *ZERO                      - B7
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E7
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     ELSE                            - X4
     C*
     C**  PROCESS WHEN CHANGE RATE CREDIT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBCOHISB    HISB0
     C*
     C           *IN80     IFEQ '1'                        - B5
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X5
     C           *IN81     IFEQ '1'                        - B6
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X6
     C           *IN82     IFEQ '1'                        - B7
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X7
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
     C*
     C           DCAID     SUB  DDAID     INT0
     C*
     C           DAYS      IFNE *ZEROS                     - B5
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B6
     C           DTHGAR    IFNE *ZERO                      - B7
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E7
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     ELSE                            - X3
     C*
     C           CDICT     IFGT 2                          - B4
     C           CCICT     ANDGT2
     C*
     C**  PROCESS IN CASE OF INTEREST TYPE ARE BOTH GREATER THAN 3
     C*
     C**  PROCESS OUTPUT CHANGING DAY
     C*
     C                     Z-SUBWMNBL     HISB0
     C                     EXSR OVERDC
     C                     WRITEODAYDC
     C*
     C           DRECI     IFEQ 'M'                        - B5
     C*
     C           DSDAT     IFNE *ZEROS                     - B6
     C           MNBL      ANDGT*ZEROS
     C*
     C**  PROCESS DEBIT
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBDINT      INT0
     C*
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C*
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X9
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           CSDAT     IFNE *ZEROS                     - B6
     C           MNBL      ANDLT*ZEROS
     C*
     C**  PROCESS CREDIT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDCINT      INT0
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C*
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X9
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C**  PROCESS UNTIL READING OTHER THAN 'M'
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C*
     C           DSDAT     IFNE *ZEROS                     - B9
     C           MNBL      ANDGT*ZEROS
     C*
     C**  PROCESS DEBIT
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBDINT      INT0
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B10
     C*
     C                     ELSE                            - X10
     C           *IN81     IFEQ '1'                        - B11
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X11
     C           *IN82     IFEQ '1'                        - B12
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X12
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E12
     C                     END                             - E11
     C                     END                             - E10
     C                     Z-SUBNUMB0     NUMB0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E9
     C*
     C           CSDAT     IFNE *ZEROS                     - B9
     C           MNBL      ANDLT*ZEROS
     C*
     C**  PROCESS CREDIT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDCINT      INT0
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B10
     C*
     C                     ELSE                            - X10
     C           *IN81     IFEQ '1'                        - B11
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X11
     C           *IN82     IFEQ '1'                        - B12
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X12
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E12
     C                     END                             - E11
     C                     END                             - E10
     C                     Z-SUBNUMB0     NUMB0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E9
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C*
     C**  PROCESS A S RECORD
     C*
     C***********SDICI     IFEQ 'Y'                        - B10         098818
     C           SDICI     IFNE *BLANKS                    - B10         098818
     C*
     C**  PROCESS IF DEBIT CAPITALISATION
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B11
     C*
     C                     ELSE                            - X11
     C           *IN81     IFEQ '1'                        - B12
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X12
     C           *IN82     IFEQ '1'                        - B13
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X13
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E13
     C                     END                             - E12
     C                     END                             - E11
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B11
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X11
     C                     Z-ADDCINT      INT0
     C                     END                             - E11
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E10
     C*
     C***********SCICI     IFEQ 'Y'                        - B10         098818
     C           SCICI     IFNE *BLANKS                    - B10         098818
     C*
     C**  PROCESS IF CREDIT CAPITALISATION
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B11
     C*
     C                     ELSE                            - X11
     C           *IN81     IFEQ '1'                        - B12
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X12
     C           *IN82     IFEQ '1'                        - B13
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X13
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E13
     C                     END                             - E12
     C                     END                             - E11
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B11
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X11
     C                     Z-ADDCINT      INT0
     C                     END                             - E11
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E10
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     ELSE                            - X4
     C*
     C           CDICT     IFGT 2                          - B5
     C           CCICT     ANDLT3
     C*
     C**  PROCESS IN CASE OF INTEREST TYPE CREDIT IS LESS THAN 3
     C**  AND INTEREST TYPE DEBIT IS GREATER THAN 2
     C*
     C**  PROCESS OUTPUT CHANGING DAY
     C*
     C                     Z-SUBWMNBL     HISB0
     C                     EXSR OVERDC
     C                     WRITEODAYDC
     C*
     C           DCRCI     IFEQ 'Y'                        - B6
     C*
     C**  PROCESS WHEN CHANGE RATE CREDIT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X9
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C           DDAID     SUB  WDAID     INT0
     C           INT0      SUB  WCAID     INT0
     C           INT0      ADD  DCAID     INT0
     C                     Z-SUBINT0      INT0
     C*
     C           DAYS      IFNE *ZEROS                     - B7
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B8
     C           DTHGAR    IFNE *ZERO                      - B9
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E9
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C**  PROCESS END OF MONTH OR CHANGE RATE FOR DEBIT
     C*
     C           DRECI     IFEQ 'M'                        - B6
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C*
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X9
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B7
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X7
     C                     Z-ADDCINT      INT0
     C                     END                             - E7
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B9
     C*
     C                     ELSE                            - X9
     C           *IN81     IFEQ '1'                        - B10
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X10
     C           *IN82     IFEQ '1'                        - B11
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X11
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E11
     C                     END                             - E10
     C                     END                             - E9
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B9
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X9
     C                     Z-ADDCINT      INT0
     C                     END                             - E9
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B10
     C*
     C                     ELSE                            - X10
     C           *IN81     IFEQ '1'                        - B11
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X11
     C           *IN82     IFEQ '1'                        - B12
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X12
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E12
     C                     END                             - E11
     C                     END                             - E10
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B10
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X10
     C                     Z-ADDCINT      INT0
     C                     END                             - E10
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     ELSE                            - X5
     C*
     C**  PROCESS IN CASE OF INTEREST TYPE DEBIT IS LESS THAN 3
     C**  AND INTEREST TYPE CREDIT IS GREATER THAN 2
     C*
     C**  PROCESS OUTPUT CHANGING DAY
     C*
     C                     Z-SUBWMNBL     HISB0
     C                     EXSR OVERDC
     C                     WRITEODAYDC
     C*
     C           DDRCI     IFEQ 'Y'                        - B6
     C*
     C**  DEBIT RATE CHANGE
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X9
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C*
     C           DAYS      IFNE *ZEROS                     - B7
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B8
     C           DTHGAR    IFNE *ZERO                      - B9
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E9
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C**  CREDIT END OF MONTH OR CREDIT RATE CHANGE
     C*
     C           DRECI     IFEQ 'M'                        - B6
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C*
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X9
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B7
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X7
     C                     Z-ADDCINT      INT0
     C                     END                             - E7
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B9
     C*
     C                     ELSE                            - X9
     C           *IN81     IFEQ '1'                        - B10
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X10
     C           *IN82     IFEQ '1'                        - B11
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X11
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E11
     C                     END                             - E10
     C                     END                             - E9
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B9
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X9
     C                     Z-ADDCINT      INT0
     C                     END                             - E9
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B10
     C*
     C                     ELSE                            - X10
     C           *IN81     IFEQ '1'                        - B11
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X11
     C           *IN82     IFEQ '1'                        - B12
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X12
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E12
     C                     END                             - E11
     C                     END                             - E10
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B10
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X10
     C                     Z-ADDCINT      INT0
     C                     END                             - E10
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
      ** If CRE001 is switched ON and Overdraft Processed Ind. is 'Y'     CRE001
      ** then Output Overdraft Limit                                      CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                          B1           CRE001
     C           ODLI      ANDEQ'Y'                          A1           CRE001
      *                                                                   CRE001
     C                     MOVE *BLANKS   ODLI                            CRE001
     C                     MOVE *BLANKS   PSTDO                           CRE001
     C                     Z-ADD*ZEROS    PPSTD                           CRE001
     C                     MOVE *BLANKS   PSTDA                           CRE001
      *                                                                   CRE001
      ** Convert Retail History Debit Date to DDMMMYY format              CRE001
     C           PVALD     IFNE WWHISD                       B2           CRE001
     C                     MOVELWWHISD    ZDAYNO                          CRE001
     C                     EXSR ZDATE2                                    CRE001
     C                     MOVE ZADATE    VALDO                           CRE001
      *                                                                   CRE001
      **  Handle Conversion Error.                                        CRE001
      *                                                                   CRE001
     C           ZERROR    IFNE 0                          - B3           CRE001
     C                     Z-ADDWWHISD    WDATE                           CRE001
     C                     Z-ADD421       DBASE                           CRE001
     C                     MOVEL'ZDAT2'   DBFILE           ***************CRE001
     C                     MOVELWDATE     DBKEY            **DB ERROR 421*CRE001
     C                     MOVEA'1'       *IN,89           ***************CRE001
     C                     EXSR DBSR                                      CRE001
     C                     ENDIF                           - E3           CRE001
      *                                                                   CRE001
      ** Set Pervious Posting Value to Current Retail History DR Date     CRE001
     C                     Z-ADDWWHISD    PVALD                           CRE001
      *                                                                   CRE001
     C                     ENDIF                           - E2           CRE001
      *                                                                   CRE001
     C                     MOVE VALDO     VALDA                           CRE001
      *                                                                   CRE001
     C                     MOVELNAR,37    NARR                            CRE001
      *                                                                   CRE001
     C                     Z-ADD*ZERO     WODRL  150                      CRE001
     C                     SELEC                                          CRE001
     C           DPA,I     WHEQ 0                                         CRE001
     C                     Z-ADDODRL      WODRL                           CRE001
     C           DPA,I     WHEQ 1                                         CRE001
     C           ODRL      MULT 10        WODRL                           CRE001
     C           DPA,I     WHEQ 2                                         CRE001
     C           ODRL      MULT 100       WODRL                           CRE001
     C           DPA,I     WHEQ 3                                         CRE001
     C           ODRL      MULT 1000      WODRL                           CRE001
     C                     ENDSL                                          CRE001
      *                                                                   CRE001
     C           WODRL     IFGT *ZEROS                     - B2           CRE001
     C                     Z-ADDWODRL     PSTD0                           CRE001
     C                     ELSE                            - X2           CRE001
     C                     Z-SUBWODRL     PSTD0                           CRE001
     C                     ENDIF                           - E2           CRE001
      *                                                                   CRE001
      **  Output Posting for Debit and Credit                             CRE001
      *                                                                   CRE001
     C                     EXSR OVERDC                                    CRE001
     C                     WRITEPOSTDC                                    CRE001
      *                                                                   CRE001
     C                     ENDIF                             E1           CRE001
      *                                                                   CRE001
     C           *IN51     DOWEQ'0'                        - B1
     C           DHISD     ANDLTCHISD
     C*
     C**  PROCESS POSTING AT THE SAME DATE
     C*
     C           *IN50     DOWEQ'0'                        - B2
     C           DHISD     ANDEQHISD
     C*
     C                     EXSR POSTSR
     C*
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     END                             - E2
     C*
     C**  PROCESS IN CASE THERE IS ONE RATE CHANGE
     C*
     C                     EXSR RATESR
     C*
     C**  OUTPUT SUBTOTAL LINE
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           DHISD     ANDLTCHISD
     C*
     C**  CHECK INTEREST TYPE
     C*
     C           CDICT     IFLT 3                          - B3
     C           CCICT     ANDLT3
     C*
     C**  PROCESS IN CASE OF INTEREST TYPE ARE BOTH LESS THAN 3
     C*
     C           WHISB     IFGT *ZEROS                     - B4
     C*
     C**  PROCESS WHEN CHANGE RATE DEBIT
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B5
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X5
     C           *IN81     IFEQ '1'                        - B6
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X6
     C           *IN82     IFEQ '1'                        - B7
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X7
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
     C*
     C           DDAID     SUB  WDAID     INT0
     C           INT0      SUB  DCAID     INT0
     C           INT0      ADD  WCAID     INT0
     C                     Z-SUBINT0      INT0
     C*
     C           DAYS      IFNE *ZEROS                     - B5
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B6
     C           DTHGAR    IFNE *ZERO                      - B7
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E7
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     ELSE                            - X4
     C*
     C**  PROCESS WHEN CHANGE RATE CREDIT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B5
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X5
     C           *IN81     IFEQ '1'                        - B6
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X6
     C           *IN82     IFEQ '1'                        - B7
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X7
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
     C*
     C           DDAID     SUB  WDAID     INT0
     C           INT0      SUB  DCAID     INT0
     C           INT0      ADD  WCAID     INT0
     C                     Z-SUBINT0      INT0
     C*
     C           DAYS      IFNE *ZEROS                     - B5
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B6
     C           DTHGAR    IFNE *ZERO                      - B7
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E7
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     ELSE                            - X3
     C*
     C           CDICT     IFGT 2                          - B4
     C           CCICT     ANDGT2
     C*
     C**  PROCESS IN CASE OF INTEREST TYPE ARE BOTH GREATER THAN 3
     C*
     C**  PROCESS OUTPUT CHANGING DAY
     C*
     C                     Z-SUBWMNBL     HISB0
     C                     EXSR OVERDC
     C                     WRITEODAYDC
     C*
     C           DRECI     IFEQ 'M'                        - B5
     C*
     C           DSDAT     IFNE *ZEROS                     - B6
     C           MNBL      ANDGT*ZEROS
     C*
     C**  PROCESS DEBIT
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBDINT      INT0
     C*
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C*
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X9
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           CSDAT     IFNE *ZEROS                     - B6
     C           MNBL      ANDLT*ZEROS
     C*
     C**  PROCESS CREDIT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDCINT      INT0
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C*
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X9
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C**  PROCESS UNTIL READING OTHER THAN 'M'
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C*
     C           DSDAT     IFNE *ZEROS                     - B9
     C           MNBL      ANDGT*ZEROS
     C*
     C**  PROCESS DEBIT
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBDINT      INT0
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B10
     C*
     C                     ELSE                            - X10
     C           *IN81     IFEQ '1'                        - B11
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X11
     C           *IN82     IFEQ '1'                        - B12
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X12
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E12
     C                     END                             - E11
     C                     END                             - E10
     C                     Z-SUBNUMB0     NUMB0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E9
     C*
     C           CSDAT     IFNE *ZEROS                     - B9
     C           MNBL      ANDLT*ZEROS
     C*
     C**  PROCESS CREDIT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-ADDCINT      INT0
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B10
     C*
     C                     ELSE                            - X10
     C           *IN81     IFEQ '1'                        - B11
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X11
     C           *IN82     IFEQ '1'                        - B12
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X12
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E12
     C                     END                             - E11
     C                     END                             - E10
     C                     Z-SUBNUMB0     NUMB0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E9
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C*
     C**  PROCESS A S RECORD
     C*
     C***********SDICI     IFEQ 'Y'                        - B10         098818
     C           SDICI     IFNE *BLANKS                    - B10         098818
     C*
     C**  PROCESS IF DEBIT CAPITALISATION
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B11
     C*
     C                     ELSE                            - X11
     C           *IN81     IFEQ '1'                        - B12
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X12
     C           *IN82     IFEQ '1'                        - B13
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X13
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E13
     C                     END                             - E12
     C                     END                             - E11
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B11
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X11
     C                     Z-ADDCINT      INT0
     C                     END                             - E11
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E10
     C*
     C***********SCICI     IFEQ 'Y'                        - B10         098818
     C           SCICI     IFNE *BLANKS                    - B10         098818
     C*
     C**  PROCESS IF CREDIT CAPITALISATION
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B11
     C*
     C                     ELSE                            - X11
     C           *IN81     IFEQ '1'                        - B12
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X12
     C           *IN82     IFEQ '1'                        - B13
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X13
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E13
     C                     END                             - E12
     C                     END                             - E11
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B11
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X11
     C                     Z-ADDCINT      INT0
     C                     END                             - E11
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E10
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     ELSE                            - X4
     C*
     C           CDICT     IFGT 2                          - B5
     C           CCICT     ANDLT3
     C*
     C**  PROCESS IN CASE OF INTEREST TYPE CREDIT IS LESS THAN 3
     C**  AND INTEREST TYPE DEBIT IS GREATER THAN 2
     C*
     C**  PROCESS OUTPUT CHANGING DAY
     C*
     C                     Z-SUBWMNBL     HISB0
     C                     EXSR OVERDC
     C                     WRITEODAYDC
     C*
     C           DCRCI     IFEQ 'Y'                        - B6
     C*
     C**  PROCESS WHEN CHANGE RATE CREDIT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X9
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C           DDAID     SUB  WDAID     INT0
     C           INT0      SUB  WCAID     INT0
     C           INT0      ADD  DCAID     INT0
     C                     Z-SUBINT0      INT0
     C*
     C           DAYS      IFNE *ZEROS                     - B7
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B8
     C           DTHGAR    IFNE *ZERO                      - B9
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E9
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C**  PROCESS END OF MONTH OR CHANGE RATE FOR DEBIT
     C*
     C           DRECI     IFEQ 'M'                        - B6
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C*
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X9
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B7
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X7
     C                     Z-ADDCINT      INT0
     C                     END                             - E7
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B9
     C*
     C                     ELSE                            - X9
     C           *IN81     IFEQ '1'                        - B10
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X10
     C           *IN82     IFEQ '1'                        - B11
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X11
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E11
     C                     END                             - E10
     C                     END                             - E9
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B9
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X9
     C                     Z-ADDCINT      INT0
     C                     END                             - E9
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDMHISD     WHISDD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B10
     C*
     C                     ELSE                            - X10
     C           *IN81     IFEQ '1'                        - B11
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X11
     C           *IN82     IFEQ '1'                        - B12
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X12
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E12
     C                     END                             - E11
     C                     END                             - E10
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B10
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X10
     C                     Z-ADDCINT      INT0
     C                     END                             - E10
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     ELSE                            - X5
     C*
     C**  PROCESS IN CASE OF INTEREST TYPE DEBIT IS LESS THAN 3
     C**  AND INTEREST TYPE CREDIT IS GREATER THAN 2
     C*
     C**  PROCESS OUTPUT CHANGING DAY
     C*
     C                     Z-SUBWMNBL     HISB0
     C                     EXSR OVERDC
     C                     WRITEODAYDC
     C*
     C           DDRCI     IFEQ 'Y'                        - B6
     C*
     C**  DEBIT RATE CHANGE
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X9
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C*
     C           DAYS      IFNE *ZEROS                     - B7
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B8
     C           DTHGAR    IFNE *ZERO                      - B9
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E9
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C**  CREDIT END OF MONTH OR CREDIT RATE CHANGE
     C*
     C           DRECI     IFEQ 'M'                        - B6
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B7
     C*
     C                     ELSE                            - X7
     C           *IN81     IFEQ '1'                        - B8
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X8
     C           *IN82     IFEQ '1'                        - B9
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X9
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E9
     C                     END                             - E8
     C                     END                             - E7
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B7
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X7
     C                     Z-ADDCINT      INT0
     C                     END                             - E7
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E6
     C*
     C           DRECI     DOWEQ'M'                        - B6
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B7
     C*
     C           DRECI     IFEQ 'M'                        - B8
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B9
     C*
     C                     ELSE                            - X9
     C           *IN81     IFEQ '1'                        - B10
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X10
     C           *IN82     IFEQ '1'                        - B11
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X11
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E11
     C                     END                             - E10
     C                     END                             - E9
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B9
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X9
     C                     Z-ADDCINT      INT0
     C                     END                             - E9
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDMHISD     WHISDC
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X8
     C*
     C           DRECI     IFEQ 'S'                        - B9
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B10
     C*
     C                     ELSE                            - X10
     C           *IN81     IFEQ '1'                        - B11
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X11
     C           *IN82     IFEQ '1'                        - B12
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X12
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E12
     C                     END                             - E11
     C                     END                             - E10
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B10
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X10
     C                     Z-ADDCINT      INT0
     C                     END                             - E10
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTODDC
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E9
     C*
     C                     END                             - E8
     C*
     C                     END                             - E7
     C*
     C                     END                             - E6
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
      *                                                                   CRE001
      ** If CRE001 is switched ON and Overdraft Processed Ind. is 'Y'     CRE001
      ** then Output Overdraft Limit                                      CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                          B3           CRE001
     C           ODLI      ANDEQ'Y'                          A3           CRE001
      *                                                                   CRE001
     C                     MOVE *BLANKS   ODLI                            CRE001
     C                     MOVE *BLANKS   PSTDO                           CRE001
     C                     Z-ADD*ZEROS    PPSTD                           CRE001
     C                     MOVE *BLANKS   PSTDA                           CRE001
      *                                                                   CRE001
     C           PVALD     IFNE DHISD                      - B4           CRE001
      *                                                                   CRE001
      ** Convert History Debit Capitalisation Date to DDMMMYY Format      CRE001
     C                     MOVELDHISD     ZDAYNO                          CRE001
     C                     EXSR ZDATE2                                    CRE001
     C                     MOVE ZADATE    VALDO                           CRE001
      *                                                                   CRE001
      ** Handle Conversion Error.                                         CRE001
      *                                                                   CRE001
     C           ZERROR    IFNE 0                          - B5           CRE001
     C                     Z-ADDDHISD     WDATE                           CRE001
     C                     Z-ADD421       DBASE                           CRE001
     C                     MOVEL'ZDAT2'   DBFILE           ***************CRE001
     C                     MOVELWDATE     DBKEY            **DB ERROR 421*CRE001
     C                     MOVEA'1'       *IN,89           ***************CRE001
     C                     EXSR DBSR                                      CRE001
     C                     ENDIF                           - E5           CRE001
      *                                                                   CRE001
     C                     Z-ADDDHISD     PVALD                           CRE001
      *                                                                   CRE001
     C                     ENDIF                           - E4           CRE001
      *                                                                   CRE001
     C                     MOVE VALDO     VALDA                           CRE001
      *                                                                   CRE001
     C                     MOVELNAR,37    NARR                            CRE001
      *                                                                   CRE001
     C                     Z-ADD*ZERO     WODRL  150                      CRE001
     C                     SELEC                                          CRE001
     C           DPA,I     WHEQ 0                                         CRE001
     C                     Z-ADDODRL      WODRL                           CRE001
     C           DPA,I     WHEQ 1                                         CRE001
     C           ODRL      MULT 10        WODRL                           CRE001
     C           DPA,I     WHEQ 2                                         CRE001
     C           ODRL      MULT 100       WODRL                           CRE001
     C           DPA,I     WHEQ 3                                         CRE001
     C           ODRL      MULT 1000      WODRL                           CRE001
     C                     ENDSL                                          CRE001
      *                                                                   CRE001
     C           WODRL     IFGT *ZEROS                     - B4           CRE001
     C                     Z-ADDWODRL     PSTD0                           CRE001
     C                     ELSE                            - X4           CRE001
     C                     Z-SUBWODRL     PSTD0                           CRE001
     C                     ENDIF                           - E4           CRE001
      *                                                                   CRE001
      **  Output Posting for Debit and Credit                             CRE001
      *                                                                   CRE001
     C                     EXSR OVERDC                                    CRE001
     C                     WRITEPOSTDC                                    CRE001
      *                                                                   CRE001
     C                     ENDIF                             E3           CRE001
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE CHISD                      - B1
     C                     Z-ADDCHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     MOVE CHISD     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C*
     C           WHISB     IFGT *ZEROS                     - B1
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C           WDAID     SUB  CDAIC     INT0
     C                     ELSE                            - X1
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C           CCAIC     SUB  WCAID     INT0
     C                     END                             - E1
     C*
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B1
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X1
     C           *IN81     IFEQ '1'                        - B2
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X2
     C           *IN82     IFEQ '1'                        - B3
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X3
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C** PRINT TOTAL NUMBER
     C*
     C                     MOVE *BLANKS   BLAN    1
     C                     EXSR OVERDC
     C                     WRITETOTNB
     C*
     C                     MOVELNAR,25    NARRD
     C                     Z-ADDWWTND     TNUMD
     C                     EXSR OVERDC
     C                     WRITETOTND
     C*
     C                     EXSR OVERDC
     C                     WRITETOTNB
     C*
     C                     MOVELNAR,26    NARRC
     C                     Z-ADDWWTNC     TNUMC
     C                     EXSR OVERDC
     C                     WRITETOTNC
     C*
     C                     MOVE *BLANKS   BLAN
     C                     EXSR OVERDC
     C                     WRITETOTNB
     C*
     C** PREPARE C/F BALANCE
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,6     TNARR
     C*
     C                     Z-SUBCHISB     HISB0
     C                     Z-SUBCHISB     WWHISB 150
     C*
     C**  OUTPUT BALANCE C/F
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C**  PREPARE TOTAL INTEREST OUTPUT
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDCLDID     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,5     XNARR
     C*
     C           CCAIC     SUB  CDAIC     TINT0
     C*
     C**  Calculate base rate tax
     C***   Calling subroutine is BOTHSR
     C*
     C**********           MOVE 'B'       CALLSR  1                       130468
     C                     EXSR CALBRT
     C/COPY WNCPYSRC,RE3765C027
     C*
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     EXSR CALEUT                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C**  OUTPUT TOTAL INTEREST
     C*
     C                     EXSR OVERDC
     C                     WRITETOTALDC
      *                                                                   130468
      * Report total generated adjustments                                130468
     C           CSGADI    IFNE *ZEROS                                    130468
     C                     EXSR CLMSG                                     130468
     C                     Z-SUBCSGADI    TINT0                           130468
     C                     MOVELNAR,23    DNARR                           130468
     C                     EXSR OVERDC                                    130468
     C                     WRITETOTDDC                                    130468
     C                     END                                            130468
     C           CSGACI    IFNE *ZERO                                     130468
     C                     EXSR CLMSG                                     130468
     C                     Z-ADDCSGACI    TINT0                           130468
     C                     MOVELNAR,23    DNARR                           130468
     C                     EXSR OVERDC                                    130468
     C                     WRITETOTDDC                                    130468
     C                     END                                            130468
      *                                                                   130468
      * Report BRT if required                                            130468
     C           *IN22     IFEQ '1'                                       130468
     C                     EXSR OVERDC                                    130468
     C                     WRITETOTBRT                                    130468
     C                     END                                            130468
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     EXSR OVERDC                                                        CGL031
     C                     WRITEEUWTAX                                                        CGL031
      *                                                                                       CER048
      ** Print Secondary Tax Amount                                                           CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
     C                     EXSR OVERDC                                                        CER048
     C                     WRITESECTAX                                                        CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CGL031
     C*
     C**  PREPARE TOTAL COMMISSION OUTPUT
     C*
     C*
     C**  PREPARE FIXED COMMISSION OUTPUT
     C*
     C           FXDC      IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,16    DNARR
     C*
     C                     Z-SUBFXDC      TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3765C002
     C*
     C**  PREPARE COMMISSION ON DEBIT INTEREST
     C*
     C           *IN70     IFEQ '1'                        - B1
     C*
     C           CDIE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,17    DNARR
     C*
     C                     Z-SUBCDIE      TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE ACCOUNT COMMISSION
     C*
     C           ACCEA     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,18    DNARR
     C*
     C                     Z-SUBACCEA     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE H/O COMMISSION
     C*
     C           CHDBE     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,19    DNARR
     C*
     C                     Z-SUBCHDBE     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE COMMISSION ON MINIMUM BALANCE
     C*
     C           CMBE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,20    DNARR
     C*
     C                     Z-SUBCMBE      TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C           CDICA     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,17    DNARR
     C*
     C           CCDIC     SUB  CDICA     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE ACCOUNT COMMISSION
     C*
     C           *IN54     IFEQ '1'                        - B2
     C*
     C* PREPARE PREVIOUS PERIOD COMMISSIONS TOTAL NOT POSTED.
     C*
     C           GVDPC     IFNE *ZERO
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,33    DNARR
     C           GVDPC     SUB  TOTPST    TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C* PREPARE ADJUSTMENT TO COMMISSIONS
     C*
     C                     EXSR CLMSG
     C           GVDPC     MULT ACCRA     CALC   180
     C           CALC      DIV  100       CALC
     C                     MOVELNAR,34    DNARR
     C           CALC      SUB  ACCC      TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,28    DNARR
     C                     Z-ADDTOTPST    TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,29    DNARR
     C                     Z-ADDTOTNPS    TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,30    QNARR
     C                     Z-ADDACCRA     RATET
     C                     EXSR OVERDC
     C                     WRITETURRAT
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,18    DNARR
     C*
     C** CACCC IS SET TO ZERO IN PREVIOUS PROGRAM  RE3116
     C                     Z-ADDACCC      TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C                     END                             - E2
     C*
     C                     END                             - E2
     C*
     C**  PREPARE H/O COMMISSION
     C*
     C           CHDBC     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,19    DNARR
     C*
     C           CCHDBC    SUB  CHDBC     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE COMMISSION ON MINIMUM BALANCE
     C*
     C           CMBC      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,20    DNARR
     C*
     C           CCMBC     SUB  CMBC      TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE VAT
     C*
     C           VATAM     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,24    DNARR
     C*
     C                     Z-SUBVATAM     TINT0
     C           WWHISB    SUB  VATAM     WWHISB
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C**  PREPARE TOTAL CHARGES
     C*
     C           CCHGP     IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,22    DNARR
     C*
     C                     Z-SUBCCHGP     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E1
     C**  PREPARE CTGLIS
     C*
     C           CTGLIS    IFLT 0
     C                     Z-SUBCTGLIS    TINT0
     C                     EXSR CLMSG
     C                     MOVELNAR,27    DNARR
     C*
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C**  PREPARE TOTAL
     C*
     C                     Z-ADD*ZERO     TINT0
     C           *IN70     IFEQ '0'                        - B1
     C                     ADD  CDICA     TINT0
     C           *IN54     IFEQ '1'                        - B2
     C                     ADD  ACCC      TINT0
     C                     END                             - E2
     C                     ADD  CHDBC     TINT0
     C                     ADD  CMBC      TINT0
     C                     ADD  VATAM     TINT0
     C                     ELSE                            - X1
     C                     ADD  CDIE      TINT0
     C                     ADD  ACCEA     TINT0
     C                     ADD  CHDBE     TINT0
     C                     ADD  CMBE      TINT0
     C                     END                             - E1
     C           CSDCI     IFEQ 'Y'                        - B1
     C           CSDCI     OREQ 'I'
     C           CSDCI     OREQ 'A'
     C**********           ADD  FXDC      TINT0                           182037
     C/COPY WNCPYSRC,RE3765C003
     C                     ADD  CDAIC     TINT0
     C                     END                             - E1
      *                                                                   182037
      ** If there is interest to capitalise, add the Fixed Commission     182037
      ** to the total interest to capitalise.                             182037
      *                                                                   182037
     C                     ADD  FXDC      TINT0                           182037
      *                                                                   182037
     C           CSCCI     IFEQ 'Y'                        - B1
     C           CSCCI     OREQ 'I'
     C           CSCCI     OREQ 'A'
     C                     SUB  CCAIC     TINT0
     C/COPY WNCPYSRC,RE3765C028
     C                     END                             - E1
      *                                                                   130468
      * Add BRT if applicable                                             130468
     C           *IN22     IFEQ '1'                                       130468
     C                     ADD  BRTOT0    TINT0                           130468
     C                     END                                            130468
      *                                                                   130468
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     ADD  EUTAX0    TINT0                                               CGL031
      *                                                                                       CER048
      ** Add Secondary Tax, if applicable                                                     CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     ADD  STAX0     TINT0                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     END                                                                CGL031
      *                                                                                       CGL031
     C           CSCHGI    IFEQ 'Y'                        - B1
     C           CSCHGI    OREQ 'I'
     C           CSCHGI    OREQ 'A'
     C                     ADD  CCHGP     TINT0
     C                     END                             - E1
      *                                                                   130468
     C                     ADD  CSGADI    TINT0                           130468
     C                     SUB  CSGACI    TINT0                           130468
      *                                                                   130468
     C*
     C           CTGLIS    IFLT 0
     C* (TINT0 = INT + COM  SIGNE +) CTGLIS SIGNE - VIENT EN MOINS
     C* DES INTERETS
     C                     ADD  CTGLIS    TINT0
     C*
     C                     END
     C*
     C                     Z-SUBTINT0     TINT0
     C                     EXSR CLMSG
     C                     MOVELNAR,21    DNARR
     C*
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C*
     C** WRITE THE FUTURE POSTINGS FOR CLEARED BALANCE
     C*
     C                     Z-ADDCHISD     KDATE   50
     C                     Z-ADDCHISD     KDATE2  50
     C*
     C           KREHP     SETLLREHPOPH
     C           KREHP     READEREHPOPH                  58
     C*
     C** WRITE TITLE OF FUTURE VALUE
     C*
     C           *IN58     IFEQ '0'                        - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,32    RNARR
     C                     EXSR OVERDC
     C                     WRITEFUTVAL
     C                     MOVE '1'       *IN59
     C                     END                             - E1
     C*
     C           *IN58     DOWEQ'0'                        - B1
     C*
     C           PPSTD     IFNE PSTD                       - B2
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E2
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE HISD                       - B2
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E2
     C*
     C                     MOVE VALDO     VALDA
     C*
     C                     MOVELPNAR      NARR
     C*
     C           DRCR      IFEQ 0                          - B2
     C                     Z-SUBPSTA      PSTD0
     C           WWHISB    SUB  PSTA      WWHISB
     C                     ELSE                            - X2
     C                     Z-ADDPSTA      PSTD0
     C           WWHISB    ADD  PSTA      WWHISB
     C                     END                             - E2
     C*
     C**  OUTPUT POSTING FOR DEBIT AND CREDIT
     C*
     C                     EXSR OVERDC
     C                     WRITEPOSTDC
     C*
     C           KREHP     READEREHPOPH                  58
     C*
     C                     END                             - E1
     C*
     C           KCLEAR    SETLLAPOSTPDF
     C           KCLEAR    READEAPOSTPDF                 53
     C*
     C** WRITE TITLE OF FUTURE VALUE
     C*
     C           *IN53     IFEQ '0'                        - B1
     C           *IN59     ANDEQ'0'
     C                     EXSR CLMSG
     C                     MOVELNAR,32    RNARR
     C                     EXSR OVERDC
     C                     WRITEFUTVAL
     C                     END                             - E1
     C*
     C           *IN53     DOWEQ'0'                        - B1
     C*
     C           VALD      IFGE DNWD                       - B2
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE VALD                       - B3
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDVALD      PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C*
     C                     MOVELPNAR      NARR
     C*
     C           DRCR      IFEQ 0                          - B3
     C                     Z-SUBPSTA      PSTD0
     C           WWHISB    SUB  PSTA      WWHISB
     C                     ELSE                            - X3
     C                     Z-ADDPSTA      PSTD0
     C           WWHISB    ADD  PSTA      WWHISB
     C                     END                             - E3
     C*
     C**  OUTPUT POSTING FOR DEBIT AND CREDIT
     C*
     C                     EXSR OVERDC
     C                     WRITEPOSTDC
     C*
     C                     END                             - E2
     C*
     C           KCLEAR    READEAPOSTPDF                 53
     C*
     C                     END                             - E1
     C*
     C                     MOVE '0'       *IN59
     C                     MOVE '0'       *IN58
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,31    TNARR
     C*
     C                     Z-ADDWWHISB    HISB0
     C                     MOVE *BLANKS   VALDA
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C           *IN70     IFEQ '1'                        - B1
     C                     EXSR OVERDC
     C                     WRITETOTMAN
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3765C007
     C                     ENDSR                           **BOTHSR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** B1EQ subroutine for begin when same date
     C**
     C**     Called by       B O T H S R
     C**
     C**     Calls           DBSR, POSTSR
     C**
     C           B1EQ      BEGSR                           **B1EQ   BEGSR*
     C*
     C           KLIST2    SETLLREHPOPH
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C**  BACK VALUE PROCESSING
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDGECLDID
     C*
     C           HISD      IFLT CLDID                      _ B2
     C           PSTD      ANDGTCLDID
     C*
     C                     EXSR POSTSR
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C           *IN70     IFEQ '1'                        - B1
     C           KLIST1    SETLLREHISSL                  20
     C*
     C           *IN20     IFEQ '1'                        - B2
     C           KLIST1    READEREADJF                   20
     C           *IN20     DOWEQ'0'                        - B3
     C*
     C** PRINT INTEREST OF THE BACK VALUE DATE
     C*
     C                     MOVELNAR,23    NARR
     C                     Z-SUBAHISB     HISB0
     C*
     C           ACAIC     SUB  ADAIC     INT0
     C*
     C                     EXSR OVERDC
     C                     WRITEMADJDC
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C*
     C                     END                             - E2
     C                     END                             - E1
     C*
     C**  PREPARE OPENING BALANCE
     C*
     C           PVALD     IFNE CLDID                      - B1
     C                     Z-ADDCLDID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLDID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C*
     C                     Z-SUBDOHISB    HISB0
     C*
     C**  OPENING BALANCE DEBIT OUPUT
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,15    TNARR
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C                     Z-SUBCOHISB    HISB0
     C*
     C**  OPENING BALANCE CREDIT OUTPUT
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,16    TNARR
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C**                   MOVELNAR,3     RNARR
     C*
     C**  ACCESS REHRDJ (REHPOSR1 REHPOSR2 REHPOSR3) WHICH CONTAINS
     C**  THE GOOD DATES FOR DEBIT RATE CHANGE TO
     C*
     C                     Z-ADDWWDRCD    KDATE
     C           KEODLF    CHAINREHRDJ               60
     C*
     C           *IN60     IFEQ '1'                        - B1
     C                     Z-ADD*ZEROS    DRIR
     C                     END                             - E1
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,3     RNARR
     C*
     C                     MOVE *BLANKS   PSTDA
     C                     MOVE *BLANKS   VALDA
     C*
     C**  OUTPUT DEBIT RATE CHANGE TO
     C*
     C                     EXSR RDRSR
      *                                                                   CRE001
      ** If CRE001 is switched ON                                         CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
      *                                                                   CRE001
      **    Output Overdraft Limit                                        CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVELNAR,36    ONARR                           CRE001
     C                     MOVE ODRL      OODRL                           CRE001
     C                     EXSR OVERDC                                    CRE001
     C                     WRITEODLNDC                                    CRE001
      *                                                                   CRE001
      **    Output Additional Overdraft Rate                              CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVELNAR,35    ONARR                           CRE001
     C                     MOVE AODR      OAODR                           CRE001
     C                     EXSR OVERDC                                    CRE001
     C                     WRITEAODRDC                                    CRE001
      *                                                                   CRE001
     C                     ENDIF                                          CRE001
     C*
     C**  ACCESS REHRCJ (REHPOSR1 REHPOSR2 REHPOSR3) WHICH CONTAINS
     C**  THE GOOD DATES FOR CREDIT RATE CHANGE TO
     C*
     C                     Z-ADDWWCRCD    KDATE
     C           KEODLF    CHAINREHRCJ               60
     C*
     C           *IN60     IFEQ '1'                        - B1
     C                     Z-ADD*ZEROS    CRIR
     C                     END                             - E1
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,8     RNARR
     C*
     C                     MOVE *BLANKS   PSTDA
     C                     MOVE *BLANKS   VALDA
     C*
     C**  OUTPUT DEBIT RATE CHANGE TO
     C*
     C                     EXSR RCRSR
     C*
     C           KLIST2    SETLLREHPOPL
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     ENDSR                           **B1EQ   ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** B1GT subroutine for begin when debit greater than credit
     C**
     C**     Called by       B O T H S R
     C**
     C**     Calls           DBSR, POSTSR, OPENCR, OPENDR
     C**
     C           B1GT      BEGSR                           **B1GT   BEGSR*
     C*
     C           KLIST3    SETLLREHPOPH
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDLTCHISD
     C*
     C           HISD      IFLT CLCID                      - B2
     C*
     C**  BACK VALUE PROCESSING FOR DEBIT AND CREDIT
     C*
     C                     EXSR POSTSR
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C           *IN70     IFEQ '1'                        - B1
     C           KLIST1    SETLLREHISSL                  20
     C*
     C           *IN20     IFEQ '1'                        - B2
     C           KLIST1    READEREADJF                   20
     C           *IN20     DOWEQ'0'                        - B3
     C*
     C** PRINT INTEREST OF THE BACK VALUE DATE
     C*
     C                     MOVELNAR,23    NARR
     C                     Z-SUBAHISB     HISB0
     C*
     C           ACAIC     SUB  ADAIC     INT0
     C*
     C                     EXSR OVERDC
     C                     WRITEMADJDC
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C*
     C                     END                             - E2
     C                     END                             - E1
     C*
     C**  OPENING BALANCE AND OPENING RATE FOR CREDIT
     C*
     C                     EXSR OPENCR
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDLTCHISD
     C*
     C           HISD      IFLT CLDID                      - B2
     C*
     C**  BACK VALUE PROCESSING FOR DEBIT AND POSTING FOR CREDIT
     C*
     C                     EXSR POSTSR
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C           *IN70     IFEQ '1'                        - B1
     C           KLIST1    SETLLREHISSL                  20
     C*
     C           *IN20     IFEQ '1'                        - B2
     C           KLIST1    READEREADJF                   20
     C           *IN20     DOWEQ'0'                        - B3
     C*
     C** PRINT INTEREST OF THE BACK VALUE DATE (INTEREST ADJUSTEMENT)
     C*
     C                     MOVELNAR,23    NARR
     C                     Z-SUBAHISB     HISB0
     C*
     C           ACAIC     SUB  ADAIC     INT0
     C*
     C                     EXSR OVERDC
     C                     WRITEMADJDC
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C*
     C                     END                             - E2
     C                     END                             - E1
     C*
     C**  OPENING BALANCE AND OPENING RATE FOR DEBIT
     C*
     C                     EXSR OPENDR
     C*
     C           KLIST3    SETLLREHPOPL
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     ENDSR                           **B1GT   ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** B1LT subroutine for begin when debit lower than credit
     C**
     C**     Called by       B O T H S R
     C**
     C**     Calls           DBSR, POSTSR, OPENCR, OPENDR
     C**
     C           B1LT      BEGSR                           **B1LT   BEGSR*
     C*
     C           KLIST2    SETLLREHPOPH
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDLTCHISD
     C*
     C**  BACK VALUE PROCESSING FOR DEBIT AND CREDIT
     C*
     C           HISD      IFLT CLDID                      - B2
     C*
     C                     EXSR POSTSR
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C           *IN70     IFEQ '1'                        - B1
     C           KLIST1    SETLLREHISSL                  20
     C*
     C           *IN20     IFEQ '1'                        - B2
     C           KLIST1    READEREADJF                   20
     C           *IN20     DOWEQ'0'                        - B3
     C*
     C** PRINT INTEREST OF THE BACK VALUE DATE
     C*
     C                     MOVELNAR,23    NARR
     C                     Z-SUBAHISB     HISB0
     C*
     C           ACAIC     SUB  ADAIC     INT0
     C*
     C                     EXSR OVERDC
     C                     WRITEMADJDC
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C*
     C                     END                             - E2
     C                     END                             - E1
     C*
     C**  OPENING BALANCE AND OPENING RATE FOR DEBIT
     C*
     C                     EXSR OPENDR
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDLTCHISD
     C*
     C**  BACK VALUE PROCESSING FOR CREDIT AND POSTING FOR DEBIT
     C*
     C           HISD      IFLT CLCID                      - B2
     C*
     C                     EXSR POSTSR
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C           *IN70     IFEQ '1'                        - B1
     C           KLIST1    SETLLREHISSL                  20
     C*
     C           *IN20     IFEQ '1'                        - B2
     C           KLIST1    READEREADJF                   20
     C           *IN20     DOWEQ'0'                        - B3
     C*
     C** PRINT INTEREST OF THE BACK VALUE DATE
     C*
     C                     MOVELNAR,23    NARR
     C                     Z-SUBAHISB     HISB0
     C*
     C           ACAIC     SUB  ADAIC     INT0
     C*
     C                     EXSR OVERDC
     C                     WRITEMADJDC
     C*
     C           KLIST1    READEREADJF                   20
     C                     END                             - E3
     C*
     C                     END                             - E2
     C                     END                             - E1
     C*
     C**  OPENING BALANCE AND OPENING RATE FOR CREDIT
     C*
     C                     EXSR OPENCR
     C*
     C           KLIST2    SETLLREHPOPL
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     ENDSR                           **B1LT   ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***
     C***   CLEAR INPUT VARIABLES OF MESSAGE
     C***
     C           CLMSG     BEGSR                           ** SR CLMSG **
     C                     MOVEL*BLANK    MSGDT0
     C                     MOVEL*BLANK    MSGDT1
     C                     MOVEL*BLANK    MSGDT2
     C                     MOVEL*BLANK    MSGDT3
     C                     MOVEL*BLANK    MSGDT4
     C                     MOVEL*BLANK    MSGDT5
     C                     MOVEL*BLANK    MSGDT6
     C                     MOVEL*BLANK    MSGDT7
     C                     MOVEL*BLANK    MSGDT8
     C                     MOVEL*BLANK    MSGDT9
     C                     MOVEL*BLANK    MNARR
     C                     ENDSR                           **CLMSG ENDSR**
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CRSR subroutine for credit output processing
     C**
     C**     Called by       DETPR
     C**
     C**     Calls           DBSR, DAYTSR, RATEC, ITYPCR, ZICD, OVERDC
     C**
     C           CRSR      BEGSR                           **CRSR BEGSR**
     C*
     C**  OUTPUT HEADER LINES
     C*
     C                     MOVE '0'       *IN65
     C           ACNO      IFNE *ZEROS
     C                     MOVE '1'       *IN65
     C                     END
     C/COPY WNCPYSRC,RE3765C012
     C                     WRITEHEADDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B1
     C           CCHGP     ANDNE*ZERO
     C/COPY WNCPYSRC,RE3765C013
     C                     WRITEHEADCH
     C                     END                             - E1
     C*
     C**  ACCESS REHISL WITH LAST CREDIT CAPITALISATION DATE
     C*
     C           KLIST3    CHAINREHISL               52
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD5         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 05**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           *IN52     DOWEQ'0'                        - B1
     C           DRECI     ANDEQ'S'
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C           SCICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN52     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DCRCI     ANDEQ*BLANKS
     C           DDRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   52
     C*
     C                     END                             - E1
     C*
     C**  PREPARE B/F BALANCE
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-SUBDHISB     HISB0
     C                     Z-ADDDHISB     COHISB
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADD*ZEROS    HISB0
     C                     Z-ADDDHISB     COHISB
     C                     ELSE                            - X2
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD6         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 06**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     MOVE *BLANKS   VALDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,1     TNARR
     C*
     C**  OUTPUT B/F BALANCE
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C           KLIST3    SETLLREHPOPH
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C**  BACK VALUE PROCESSING START
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDGTCLCID
     C*
     C           HISD      IFLT CLCID                      - B2
     C           PSTD      ANDGTCLCID
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVELPNAR      NARR
     C                     MOVE VALDO     VALDA
     C*
     C**  CHECK IF DEBIT OR CREDIT
     C*
     C           DRCR      IFEQ 0                          - B3
     C                     Z-SUBPSTA      PSTD0
     C*
     C** CHECK IF TURNOVER OR NOT
     C*
     C           TURN      IFNE 'Y'                        - B4
     C                     MOVE '1'       *IN33
     C                     ADD  PSTA      TOTNPS
     C                     ELSE                            - X4
     C                     ADD  PSTA      TOTPST
     C                     END                             - E4
     C                     ELSE                            - X3
     C                     Z-ADDPSTA      PSTD0
     C                     END                             - E3
     C*
     C**  OUTPUT BACK VALUE
     C*
     C                     EXSR OVERDC
     C                     WRITEPOSTDC
     C*
     C                     MOVE '0'       *IN33
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B3
     C           CHGA      ANDNE*ZERO
     C           REBI      IFEQ 'Y'                        - B4
     C                     Z-SUBCHGA      CHGR0
     C                     Z-SUB*ZERO     CHGN0
     C                     ELSE                            - X4
     C                     Z-SUBCHGA      CHGN0
     C                     Z-SUB*ZERO     CHGR0
     C                     END                             - E4
     C                     WRITEPOSTCH
     C/COPY WNCPYSRC,RE3765C020
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C*
     C                     MOVE '0'       *IN50
     C*
     C           KLIST3    SETLLREHPOPL                  50
     C           KLIST1    READEREHPOPL                  50
     C*
     C**  BACK VALUE PROCESSING END
     C*
     C**  PREPARE OPENING BALANCE OUTPUT
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADDDHISB     WHISB
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     WHISB
     C                     END                             - E2
     C                     END                             - E1
     C                     Z-SUBCOHISB    HISB0
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,2     TNARR
     C*
     C**  SAVE IN CASE OF NO POSTING
     C*
     C                     Z-ADDCLCID     WHISD
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           CLCID     IFNE PVALD                      - B1
     C*
     C                     Z-ADDCLCID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLCID     PVALD
     C*
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C*
     C**  OUTPUT OPENING BALANCE
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C**  PREPARE OPENING RATE OUTPUT
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,8     RNARR
     C*
     C**  OUTPUT OPENING RATE
     C*
     C                     Z-ADDCRIR      RATE
     C                     EXSR OVERDC
     C                     WRITERATEDC
     C*
     C           DRECI     IFEQ 'S'                        - B1
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     Z-ADDSMNBL     WMNBL
     C                     Z-ADDDDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           WHISD     ANDNEDHISD
     C*
     C           CCICT     IFLT 3                          - B3
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR DAYTSR
     C                     ELSE                            - X3
     C                     EXSR ITYPCR
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           *IN51     DOWEQ'0'                        - B1
     C           DHISD     ANDLTCHISD
     C*
     C**  PROCESS POSTING AT THE SAME DATE
     C*
     C           *IN50     DOWEQ'0'                        - B2
     C           DHISD     ANDEQHISD
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     END                             - E3
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE PSTDO     PSTDA
     C                     MOVELPNAR      NARR
     C*
     C**  CHECK IF DEBIT OR CREDIT
     C*
     C           DRCR      IFEQ 0                          - B3
     C                     Z-SUBPSTA      PSTD0
     C*
     C** CHECK IF TURNOVER OR NOT
     C*
     C           TURN      IFNE 'Y'                        - B4
     C                     MOVE '1'       *IN33
     C                     ADD  PSTA      TOTNPS
     C                     ELSE                            - X4
     C                     ADD  PSTA      TOTPST
     C                     END                             - E4
     C                     ELSE                            - X3
     C                     Z-ADDPSTA      PSTD0
     C                     END                             - E3
     C*
     C**  OUTPUT POSTING
     C*
     C                     EXSR OVERDC
     C                     WRITEPOSTDC
     C*
     C                     MOVE '0'       *IN33
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B3
     C           CHGA      ANDNE*ZERO
     C           REBI      IFEQ 'Y'                        - B4
     C                     Z-SUBCHGA      CHGR0
     C                     Z-ADD*ZERO     CHGN0
     C                     ELSE                            - X4
     C                     Z-SUBCHGA      CHGN0
     C                     Z-ADD*ZERO     CHGR0
     C                     END                             - E4
     C                     WRITEPOSTCH
     C/COPY WNCPYSRC,RE3765C021
     C                     END                             - E3
     C*
     C                     Z-ADDPSTD      PPSTD
     C                     Z-ADDHISD      PVALD
     C*
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     END                             - E2
     C*
     C**  CREDIT RATE CHANGE TO
     C*
     C           DCRCI     IFEQ 'Y'                        - B2
     C           DRECI     ANDNE'B'
     C*
     C                     EXSR RATEC
     C*
     C                     END                             - E2
     C*
     C**  SAVE REHISL  AS PREVIOUS
     C*
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     MOVE DDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C                     Z-ADDDCAID     WCAID
     C                     Z-ADDDDAID     WDAID
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B2
     C           DRECI     ANDEQ'S'
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C           SCICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DCRCI     ANDEQ*BLANKS
     C           DDRCI     ANDEQ'Y'
     C           DDMVT     ANDEQ*ZEROS
     C           DCMVT     ANDEQ*ZEROS
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     END                             - E2
     C*
     C**  OUTPUT SUBTOTAL LINE
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           DHISD     ANDLTCHISD
     C*
     C           CCICT     IFLT 3                          - B3
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR DAYTSR
     C                     ELSE                            - X3
     C                     EXSR ITYPCR
     C                     END                             - E3
     C*
     C           *IN51     DOWEQ'0'                        - B3
     C           DHISD     ANDLTHISD
     C           CHISD     ANDLTHISD
     C*
     C**  CHECK IF READ RECORD IS A CHANGE RATE
     C*
     C           DCRCI     IFEQ 'Y'                        - B4
     C           DRECI     ANDNE'B'
     C*
     C                     EXSR RATEC
     C*
     C*
     C**  SAVE REHISL  AS PREVIOUS
     C*
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     MOVE DDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C                     Z-ADDDCAID     WCAID
     C                     Z-ADDDDAID     WDAID
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B5
     C           DRECI     ANDEQ'S'
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C           SCICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DCRCI     ANDEQ*BLANKS
     C           DDRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     END                             - E5
     C*
     C           CCICT     IFLT 3                          - B5
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR DAYTSR
     C                     ELSE                            - X5
     C                     EXSR ITYPCR
     C                     END                             - E5
     C*
     C                     ELSE                            - X4
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B5
     C           DRECI     ANDEQ'S'
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C           SDICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DDRCI     ANDEQ*BLANKS
     C           DCRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           KLIST3    SETLLREHISL                   52
     C*
     C           *IN52     IFEQ '0'                        - B1
     C                     Z-ADDCLCID     WDATE
     C                     Z-ADD7         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 07**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           KLIST1    READEREHISL                   52
     C*
     C           *IN52     DOWEQ'0'                        - B1
     C           DRECI     ANDEQ'S'
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C           SCICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN52     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DCRCI     ANDEQ*BLANKS
     C           DDRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   52
     C*
     C                     END                             - E1
     C*
     C           DCICT     IFLT 3                          - B1
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C*
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     Z-SUBWHISB     HISB0
     C           HISB0     MULT DAYS      NUMB0
     C*
     C           WHISB     IFGT *ZEROS                     - B2
     C           CDAIC     SUB  WDAID     INT0
     C                     Z-SUBINT0      INT0
     C                     ELSE                            - X2
     C           CCAIC     SUB  WCAID     INT0
     C                     END                             - E2
     C*
     C**  OUTPUT SUBTOTAL
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B2
     C           DTHGAR    IFNE *ZERO                      - B3
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E3
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C** PRINT TOTAL NUMBER
     C*
     C                     MOVELNAR,25    NARRD
     C                     Z-ADDWWTND     TNUMD
     C*
     C                     MOVELNAR,26    NARRC
     C                     Z-ADDWWTNC     TNUMC
     C                     EXSR OVERDC
     C                     WRITETOTND
     C*
     C** PREPARE C/F BALANCE
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,6     TNARR
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE CHISD                      - B1
     C                     Z-ADDCHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     MOVE CHISD     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     Z-SUBCHISB     HISB0
     C*
     C**  OUTPUT BALANCE C/F
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C**  PREPARE TOTAL INTEREST OUTPUT
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDCLCID     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,5     XNARR
     C*
     C                     Z-SUBCCAIC     TINT0
     C*
     C**  Calculate base rate tax
     C***   Calling subroutine is CRSR
     C*
     C**********           MOVE 'C'       CALLSR                          130468
     C                     EXSR CALBRT
     C/COPY WNCPYSRC,RE3765C029
     C*
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     EXSR CALEUT                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C**  OUTPUT TOTAL INTEREST
     C*
     C                     EXSR OVERDC
     C                     WRITETOTALDC
      *                                                                   130468
      * Output total CR generated adjustments                             130468
     C           CSGACI    IFNE *ZEROS                                    130468
     C                     EXSR CLMSG                                     130468
     C                     Z-SUBCSGACI    TINT0                           130468
     C                     MOVELNAR,23    DNARR                           130468
     C                     EXSR OVERDC                                    130468
     C                     WRITETOTDDC                                    130468
     C                     END                                            130468
      *                                                                   130468
      * Report BRT if required                                            130468
     C           *IN22     IFEQ '1'                                       130468
     C                     EXSR OVERDC                                    130468
     C                     WRITETOTBRT                                    130468
     C                     END                                            130468
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     EXSR OVERDC                                                        CGL031
     C                     WRITEEUWTAX                                                        CGL031
      *                                                                                       CER048
      ** Print Secondary Tax Amount                                                           CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
     C                     EXSR OVERDC                                                        CER048
     C                     WRITESECTAX                                                        CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     END                                                                CGL031
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B1
     C           CCHGP     ANDNE*ZERO
     C                     Z-SUBCCHGP     CHGP0
     C                     WRITETOTALCH
     C                     END                             - E1
     C*
     C**  PREPARE TOTAL CHARGES
     C*
     C           CCHGP     IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,22    DNARR
     C*
     C                     Z-SUBCCHGP     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E1
     C*
     C**  PREPARE TOTAL
     C*
     C                     Z-ADD*ZERO     TINT0
     C           CSCCI     IFEQ 'Y'                        - B1
     C           CSCCI     OREQ 'I'
     C           CSCCI     OREQ 'A'
     C*
     C                     Z-SUBCCAIC     TINT0
     C/COPY WNCPYSRC,RE3765C030
     C                     END                             - E1
      *                                                                   130468
      * Add BRT if applicable                                             130468
     C           *IN22     IFEQ '1'                                       130468
     C                     ADD  BRTOT0    TINT0                           130468
     C                     END                                            130468
      *                                                                   130468
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     ADD  EUTAX0    TINT0                                               CGL031
      *                                                                                       CER048
      ** Add Secondary Tax, if applicable                                                     CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C                     ADD  STAX0     TINT0                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           CSCHGI    IFEQ 'Y'                        - B1
     C           CSCHGI    OREQ 'I'
     C           CSCHGI    OREQ 'A'
     C*
     C                     ADD  CCHGP     TINT0
     C                     END                             - E1
     C                     SUB  CSGACI    TINT0                           130468
      *                                                                   130468
     C                     EXSR CLMSG
     C                     MOVELNAR,21    DNARR
     C                     Z-SUBTINT0     TINT0
     C*
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C*
     C**  PREPARE TOTAL CREDITED OUTPUT
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,10    DNARR
     C*
     C**  OUTPUT TOTAL CREDITED
     C*
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C*
     C           *IN70     IFEQ '1'                        - B1
     C                     EXSR OVERDC
     C                     WRITETOTMAN
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3765C008
     C                     ENDSR                           **CRSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DAYTSR subroutine to prepare and output days total
     C**
     C**     Called by       CRSR, DRSR
     C**
     C**     Calls           ZICD
     C**
     C           DAYTSR    BEGSR                           **DAYTSR BEGSR*
     C*
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B1
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X1
     C           *IN81     IFEQ '1'                        - B2
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X2
     C           *IN82     IFEQ '1'                        - B3
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X3
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           WHISB     IFGT *ZEROS                     - B1
     C           DDAID     SUB  WDAID     INT0
     C                     Z-SUBINT0      INT0
     C                     ELSE                            - X1
     C           DCAID     SUB  WCAID     INT0
     C                     END                             - E1
      *                                                                   CRE001
      ** If CRE001 is switched ON, then output 'Overdraft Limit'          CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVELNAR,36    ONARR                           CRE001
     C                     MOVE ODRL      OODRL                           CRE001
     C                     EXSR OVERDC                                    CRE001
     C                     WRITEODLNDC                                    CRE001
     C                     ENDIF                                          CRE001
     C*
     C**  OUTPUT SUBTOTAL
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B1
     C           DTHGAR    IFNE *ZERO                      - B2
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     ENDSR                           **DAYTSR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DBSR subroutine for database error handling
     C**
     C**     Called by       DETPR, DRSR, RATED, RATEC, CRSR, RDRSR,
     C**                     RCRSR, BOTHSR, B1LT, B1GT, B1EQ, POSTSR,
     C**                     OPENDR, OPENCR, ZICD, FIRST
     C**
     C**     Calls           -
     C**
     C           DBSR      BEGSR                           **DBSR BEGSR**
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     WRITEERRAU
     C*
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C*
     C           *IN72     IFEQ '1'                        - B1
     C                     ADD  1         PAGU
     C                     WRITEHEADAU
     C                     MOVE '0'       *IN72
     C                     END                             - E1
     C*
     C                     ENDSR                           **DBSR ENDSR**
     C/COPY WNCPYSRC,RE3765C022
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DRSR subroutine for debit output processing
     C**
     C**     Called by       D E T P R
     C**
     C**     Calls           DBSR, DAYTSR, ITYPDR, RATED, ZICD, OVERDC
     C**
     C           DRSR      BEGSR                           **DRSR BEGSR**
     C*
     C**  OUTPUT HEADER LINES
     C*
     C                     MOVE '0'       *IN65
     C           ACNO      IFNE *ZEROS
     C                     MOVE '1'       *IN65
     C                     END
     C/COPY WNCPYSRC,RE3765C014
     C                     WRITEHEADDC
     C*
     C**  ACCESS REHISL WITH LAST DEBIT CAPITALISATION DATE
     C*
     C           KLIST2    CHAINREHISL               52
     C*
     C           *IN52     IFEQ '1'                        - B1
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD8         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 08**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           *IN52     DOWEQ'0'                        - B1
     C           DRECI     ANDEQ'S'
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C           SDICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN52     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DDRCI     ANDEQ*BLANKS
     C           DCRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   52
     C*
     C                     END                             - E1
     C*
     C**  PREPARE B/F BALANCE
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-SUBDHISB     HISB0
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-SUBSSTBL     HISB0
     C                     ELSE                            - X2
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD9         DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 09**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E2
     C                     END                             - E1
     C                     Z-ADDDHISB     DOHISB
     C*
     C                     MOVE *BLANKS   VALDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,1     TNARR
     C*
     C**  OUTPUT B/F BALANCE
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C           KLIST2    SETLLREHPOPH
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C**  BACK VALUE PROCESSING START
     C*
     C           *IN50     DOWEQ'0'                        - B1
     C           PSTD      ANDGTCLDID
     C*
     C           HISD      IFLT CLDID                      - B2
     C           PSTD      ANDGTCLDID
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVELPNAR      NARR
     C                     MOVE VALDO     VALDA
     C*
     C**  CHECK IF DEBIT OR CREDIT
     C*
     C           DRCR      IFEQ 0                          - B3
     C                     Z-SUBPSTA      PSTD0
     C*
     C** CHECK IF TURNOVER OR NOT
     C*
     C           TURN      IFNE 'Y'                        - B4
     C                     MOVE '1'       *IN33
     C                     ADD  PSTA      TOTNPS
     C                     ELSE                            - X4
     C                     ADD  PSTA      TOTPST
     C                     END                             - E4
     C                     ELSE                            - X3
     C                     Z-ADDPSTA      PSTD0
     C                     END                             - E3
     C*
     C**  OUTPUT BACK VALUE
     C*
     C                     EXSR OVERDC
     C                     WRITEPOSTDC
     C*
     C                     MOVE '0'       *IN33
     C*
     C                     END                             - E2
     C*
     C           KLIST1    READEREHPOPH                  50
     C*
     C                     END                             - E1
     C*
     C                     MOVE '0'       *IN50
     C*
     C           KLIST2    SETLLREHPOPL                  50
     C           KLIST1    READEREHPOPL                  50
     C*
     C**  BACK VALUE PROCESSING END
     C*
     C**  PREPARE OPENING BALANCE OUTPUT
     C*
     C           DRECI     IFEQ 'B'                        - B1
     C                     Z-ADDDHISB     WHISB
     C                     ELSE                            - X1
     C           DRECI     IFEQ 'S'                        - B2
     C                     Z-ADDSSTBL     WHISB
     C                     END                             - E2
     C                     END                             - E1
     C                     Z-SUBDOHISB    HISB0
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,2     TNARR
     C*
     C**  SAVE IN CASE OF NO POSTING
     C*
     C                     Z-ADDCLDID     WHISD
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           CLDID     IFNE PVALD                      - B1
     C*
     C                     Z-ADDCLDID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLDID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C*
     C**  OUTPUT OPENING BALANCE
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C**  PREPARE OPENING RATE OUTPUT
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,3     RNARR
     C*
     C**  OUTPUT OPENING RATE
     C*
     C                     Z-ADDDRIR      RATE
     C                     EXSR OVERDC
     C                     WRITERATEDC
     C*
     C           DRECI     IFEQ 'S'                        - B1
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     Z-ADDSMNBL     WMNBL
     C                     Z-ADDDDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           WHISD     ANDNEHISD
     C*
     C           CDICT     IFLT 3                          - B3
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR DAYTSR
     C                     ELSE                            - X3
     C                     EXSR ITYPDR
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           *IN51     DOWEQ'0'                        - B1
     C           DHISD     ANDLTCHISD
     C*
     C**  PROCESS POSTING AT THE SAME DATE
     C*
     C           *IN50     DOWEQ'0'                        - B2
     C           DHISD     ANDEQHISD
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PPSTD     IFNE PSTD                       - B3
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E3
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE HISD                       - B3
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E3
     C*
     C                     MOVE VALDO     VALDA
     C                     MOVE PSTDO     PSTDA
     C                     MOVELPNAR      NARR
     C*
     C**  CHECK IF DEBIT OR CREDIT
     C*
     C           DRCR      IFEQ 0                          - B3
     C                     Z-SUBPSTA      PSTD0
     C*
     C** CHECK IF TURNOVER OR NOT
     C*
     C           TURN      IFNE 'Y'                        - B4
     C                     MOVE '1'       *IN33
     C                     ADD  PSTA      TOTNPS
     C                     ELSE                            - X4
     C                     ADD  PSTA      TOTPST
     C                     END                             - E4
     C                     ELSE                            - X3
     C                     Z-ADDPSTA      PSTD0
     C                     END                             - E3
     C*
     C**  OUPUT POSTING
     C*
     C                     EXSR OVERDC
     C                     WRITEPOSTDC
     C*
     C                     MOVE '0'       *IN33
     C*
     C           KLIST1    READEREHPOPL                  50
     C*
     C                     END                             - E2
     C*
     C**  DEBIT RATE CHANGE TO
     C*
     C           DDRCI     IFEQ 'Y'                        - B2
     C           DRECI     ANDNE'B'
     C*
     C                     EXSR RATED
     C*
     C                     END                             - E2
     C*
     C**  SAVE REHISL  AS PREVIOUS
     C*
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     MOVE DDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C                     Z-ADDDCAID     WCAID
     C                     Z-ADDDDAID     WDAID
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B2
     C           DRECI     ANDEQ'S'
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C           SDICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DDRCI     ANDEQ*BLANKS
     C           DCRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     END                             - E2
     C*
     C**  OUTPUT SUBTOTAL LINE
     C*
     C           *IN51     IFEQ '0'                        - B2
     C           DHISD     ANDLTCHISD
     C*
     C           CDICT     IFLT 3                          - B3
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR DAYTSR
     C                     ELSE                            - X3
     C                     EXSR ITYPDR
     C                     END                             - E3
     C*
     C           *IN51     DOWEQ'0'                        - B3
     C           DHISD     ANDLTHISD
     C           CHISD     ANDLTHISD
     C*
     C**  CHECK IF READ RECORD IS A CHANGE RATE
     C*
     C           DDRCI     IFEQ 'Y'                        - B4
     C           DRECI     ANDNE'B'
     C*
     C                     EXSR RATED
     C*
     C**  SAVE REHISL  AS PREVIOUS
     C*
     C                     Z-ADDDHISD     WHISD
     C                     Z-ADDDHISB     WHISB
     C                     MOVE DDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C                     Z-ADDDCAID     WCAID
     C                     Z-ADDDDAID     WDAID
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B5
     C           DRECI     ANDEQ'S'
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C           SDICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DDRCI     ANDEQ*BLANKS
     C           DCRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     END                             - E5
     C*
     C           CDICT     IFLT 3                          - B5
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     EXSR DAYTSR
     C                     ELSE                            - X5
     C                     EXSR ITYPDR
     C                     END                             - E5
     C*
     C                     ELSE                            - X4
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     DOWEQ'0'                        - B5
     C           DRECI     ANDEQ'S'
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C           SDICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN51     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DDRCI     ANDEQ*BLANKS
     C           DCRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     END                             - E5
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           KLIST2    SETLLREHISL                   52
     C*
     C           *IN52     IFEQ '0'                        - B1
     C                     Z-ADDCLDID     WDATE
     C                     Z-ADD10        DBASE
     C                     MOVE 'REHISL'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 10**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           KLIST1    READEREHISL                   52
     C*
     C           *IN52     DOWEQ'0'                        - B1
     C           DRECI     ANDEQ'S'
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C           SDICI     ANDEQ*BLANKS
     C           DHISD     ANDLTCHISD
     C           *IN52     OREQ '0'
     C           DRECI     ANDEQ'D'
     C           DDRCI     ANDEQ*BLANKS
     C           DCRCI     ANDEQ'Y'
     C*
     C           KLIST1    READEREHISL                   52
     C*
     C                     END                             - E1
     C*
     C           DDICT     IFLT 3                          - B1
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C*
     C                     EXSR ZICD
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B2
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X2
     C           *IN81     IFEQ '1'                        - B3
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X3
     C           *IN82     IFEQ '1'                        - B4
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X4
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E4
     C                     END                             - E3
     C                     END                             - E2
     C*
     C           WHISB     IFGT *ZEROS                     - B2
     C           CDAIC     SUB  WDAID     INT0
     C                     Z-SUBINT0      INT0
     C                     ELSE                            - X2
     C           CCAIC     SUB  WCAID     INT0
     C                     END                             - E2
     C*
     C**  OUTPUT SUBTOTAL
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B2
     C           DTHGAR    IFNE *ZERO                      - B3
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E3
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C** PREPARE C/F BALANCE
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,6     TNARR
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE CHISD                      - B1
     C                     Z-ADDCHISD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     MOVE CHISD     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C                     Z-SUBCHISB     HISB0
     C*
     C**  OUTPUT BALANCE C/F
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C**  PREPARE TOTAL INTEREST OUTPUT
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDCLDID     ZIBEG
     C                     Z-ADDCHISD     ZIEND
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,5     XNARR
     C*
     C                     Z-SUBCDAIC     TINT0
     C*
     C**  OUTPUT TOTAL INTEREST
     C*
     C                     EXSR OVERDC
     C                     WRITETOTALDC
      *                                                                   130468
      * Output total DR generated adjustments                             130468
     C           CSGADI    IFNE *ZEROS                                    130468
     C                     EXSR CLMSG                                     130468
     C                     Z-SUBCSGADI    TINT0                           130468
     C                     MOVELNAR,23    DNARR                           130468
     C                     EXSR OVERDC                                    130468
     C                     WRITETOTDDC                                    130468
     C                     END                                            130468
     C*
     C**  PREPARE TOTAL COMMISSION OUTPUT
     C*
     C*
     C**  PREPARE FIXED COMMISSION OUTPUT
     C*
     C           FXDC      IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,16    DNARR
     C*
     C                     Z-SUBFXDC      TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E1
     C/COPY WNCPYSRC,RE3765C004
     C*
     C**  PREPARE COMMISSION ON DEBIT INTEREST
     C*
     C           *IN70     IFEQ '1'                        - B1
     C*
     C           CDIE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,17    DNARR
     C*
     C                     Z-SUBCDIE      TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE ACCOUNT COMMISSION
     C*
     C           ACCEA     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,18    DNARR
     C*
     C                     Z-SUBACCEA     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE H/O COMMISSION
     C*
     C           CHDBE     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,19    DNARR
     C*
     C                     Z-SUBCHDBE     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE COMMISSION ON MINIMUM BALANCE
     C*
     C           CMBE      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,20    DNARR
     C*
     C                     Z-SUBCMBE      TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C           CDICA     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,17    DNARR
     C*
     C           CDICA     SUB  CCDIC     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE ACCOUNT COMMISSION
     C*
     C* PREPARE PREVIOUS PERIOD COMMISSIONS TOTAL NOT POSTED.
     C*
     C           GVDPC     IFNE *ZERO
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,33    DNARR
     C           GVDPC     SUB  TOTPST    TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C* PREPARE AJUSTEMENT TO COMMISSIONS
     C*
     C                     EXSR CLMSG
     C           GVDPC     MULT ACCRA     CALC   180
     C           CALC      DIV  100       CALC
     C                     MOVELNAR,34    DNARR
     C           CALC      SUB  ACCC      TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C**         ACCC      IFNE *ZERO                      - B2
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,28    DNARR
     C                     Z-ADDTOTPST    TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,29    DNARR
     C                     Z-ADDTOTNPS    TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,30    QNARR
     C                     Z-ADDACCRA     RATET
     C                     EXSR OVERDC
     C                     WRITETURRAT
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,18    DNARR
     C*
     C** CACCC IS SET TO ZERO IN PREVIOUS PROGRAM  RE3116
     C                     Z-ADDACCC      TINT0
     C           TINT0     IFNE *ZERO
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END
     C                     END                             - E2
     C*
     C**  PREPARE H/O COMMISSION
     C*
     C           CHDBC     IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,19    DNARR
     C*
     C           CHDBC     SUB  CCHDBC    TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE COMMISSION ON MINIMUM BALANCE
     C*
     C           CMBC      IFNE *ZERO                      - B2
     C                     EXSR CLMSG
     C                     MOVELNAR,20    DNARR
     C*
     C           CMBC      SUB  CCMBC     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E2
     C*
     C**  PREPARE VAT
     C*
     C           VATAM     IFNE *ZERO                      - B1
     C                     EXSR CLMSG
     C                     MOVELNAR,24    DNARR
     C*
     C                     Z-ADDVATAM     TINT0
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C                     END                             - E1
     C*
     C                     END                             - E1
     C*
     C**  PREPARE TOTAL
     C*
     C                     Z-ADD*ZERO     TINT0
     C           CSDCI     IFEQ 'Y'                        - B1
     C           CSDCI     OREQ 'I'
     C           CSDCI     OREQ 'A'
     C           CDAIC     ADD  FXDC      TINT0
     C/COPY WNCPYSRC,RE3765C005
     C                     ADD  CDICA     TINT0
     C                     ADD  ACCC      TINT0
     C                     ADD  CHDBC     TINT0
     C                     ADD  CMBC      TINT0
     C                     ADD  VATAM     TINT0
     C                     END                             - E1
     C                     ADD  CSGADI    TINT0                           130468
      *                                                                   130468
     C                     Z-SUBTINT0     TINT0
     C                     EXSR CLMSG
     C                     MOVELNAR,21    DNARR
     C*
     C                     EXSR OVERDC
     C                     WRITETOTDDC
     C*
     C           *IN70     IFEQ '1'                        - B1
     C                     EXSR OVERDC
     C                     WRITETOTMAN
     C                     END                             - E1
     C*
     C/COPY WNCPYSRC,RE3765C009
     C                     ENDSR                           **DRSR ENDSR**
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** DETPR subroutine for detail processing
     C**
     C**     Called by       M A I N
     C**
     C**     Calls         BOTHSR, DRSR, CRSR, DBSR
     C**
     C           DETPR     BEGSR                           **DETPR BEGSR**
     C*
     C**  ACCESS ACCRACJ (ACCNTAB, REIACD, REACRD)
     C*
     C           KLIST1    CHAINACCRACJ              99
     C           *IN99     IFEQ '1'                        - B1
     C                     Z-ADD11        DBASE            ***************
     C                     MOVE 'ACCRACJ' DBFILE           **DB ERROR 11**
     C                     MOVELRKEY      DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C*********** ACCESS CLINT FOR CLIENT INFORMATION (ADDRESS, NAME, ETC)084174
     C***********                                                         084174
     C***********          MOVE WRCDT     RCDT                            084174
     C********** KLIST4    CHAINCLINT                99                   084174
     C********** *IN99     IFEQ '1'                        - B1           084174
     C***********          MOVELCCNUM     DBKEY                           084174
     C***********          Z-ADD12        DBASE            ***************084174
     C***********          MOVE 'CLINT'   DBFILE           **DB ERROR 12**084174
     C***********          MOVELRCDT      DBKEY            ***************084174
     C***********          MOVEA'1'       *IN,89                          084174
     C***********          EXSR DBSR                                      084174
     C***********          END                             - E1           084174
     C*                                                                   084174
     C* Retrieve correspondent details from CGCORRPD via AOALTNR0:        084174
     C*                                                                   084174
     C                     MOVELCCNUM     P#CUST                          084174
     C                     MOVELRCDT      P#ADCD                          084174
     C                     MOVEL*BLANKS   P#CUS1                          087284
     C                     MOVELCCNUM     P#CUS1                          087284
      *                                                                   CFT004
     C                     MOVEL*BLANKS   RIBAN                           CFT004
     C                     MOVE '0'       *IN04                           CFT004
     C           CFT004    IFEQ 'Y'                                       CFT004
     C                     MOVELCCNUM     WCNUM   6                       CFT004
     C**********           MOVELCACOD     WACOD   4                                    CFT004 CGL029
     C                     MOVELCACOD     WACOD  10                                           CGL029
     C                     MOVELCACSQ     WACSQ   2                       CFT004
     C                     CALL 'AOACCTR0'                                CFT004
     C                     PARM *BLANKS   PRTCD                           CFT004
     C                     PARM '*KEY   ' POPTN                           CFT004
     C                     PARM *BLANK    PRETL  10                       CFT004
     C                     PARM WCNUM     PCNUM   6                       CFT004
     C                     PARM CCCY      PCUCD   3                       CFT004
     C**********           PARM WACOD     PACCD   4                                    CFT004 CGL029
     C                     PARM WACOD     PACCD  10                                           CGL029
     C                     PARM WACSQ     PACSQ   2                       CFT004
     C                     PARM CBRCA     PBRCA   3                       CFT004
     C           ACCNTB    PARM ACCNTB    DSSDY                           CFT004
      *                                                                   CFT004
     C           PRTCD     IFNE *BLANKS                                   CFT004
     C                     Z-ADD30        DBASE            ************   CFT004
     C                     MOVEL'ACCNTAB' DBFILE           * DBERR 30 *   CFT004
     C                     MOVELRKEY      DBKEY            ************   CFT004
     C                     MOVE '1'       *IN89                           CFT004
     C                     EXSR DBSR                                      CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
      ** Format International Bank Account Numbers                        CFT004
      *                                                                   CFT004
     C           IBAN      IFNE *BLANKS                                   CFT004
     C                     CALL 'AOIBANR3'                                CFT004
     C                     PARM *BLANKS   PRTCD   7                       CFT004
     C                     PARM IBAN      PIBAN  47                       CFT004
     C                     PARM *BLANKS   PIWITH 47                       CFT004
     C                     PARM *BLANKS   PINOBL 34                       CFT004
      *                                                                   CFT004
     C           PRTCD     IFEQ *BLANKS                                   CFT004
     C                     MOVELPIWITH    RIBAN                           CFT004
     C                     MOVE '1'       *IN04                           CFT004
     C                     ENDIF                                          CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
      *                                                                   087284
      * If address reference is B use AOCUSTRO else AOALTNR0              087284
      *                                                                   087284
     C           RCDT      IFEQ 'B'                                       087284
     C                     CALL 'AOCUSTR0'             9090               087284
     C                     PARM *BLANKS   P#RTCD  7                       087284
     C                     PARM '*KEY   ' P#OPTN  7                       087284
     C                     PARM           P#CUS1 10                       087284
     C                     PARM *BLANKS   P#KYST  7                       087284
     C           SDCUST    PARM *BLANKS   DSSDY                           087284
      *                                                                   087284
     C           *IN90     IFEQ '1'                                       087284
     C                     MOVEL'AOCUSTR0'DBFILE           ***************087284
     C                     MOVELCCNUM     DBKEY            * DB ERROR 22 *087284
     C                     Z-ADD22        DBASE            ***************087284
     C                     MOVEA'1'       *IN,89                          087284
     C                     EXSR DBSR                                      087284
     C                     END                                            087284
     C                     ELSE                                           087284
     C*                                                                   084174
     C                     CALL 'AOALTNR0'                                084174
     C                     PARM *BLANKS   P#RTCD  7        B:Return code  084174
     C                     PARM '*KEY   ' P#OPTN  7        I:Option       084174
     C                     PARM           P#CUST  6        I:Customer no. 084174
     C                     PARM           P#ADCD  1        I:Address code 084174
     C***********P#CORR    PARM P#CORR    DSFDY            O:Format 084174087284
     C           P#ALTN    PARM P#ALTN    DSFDY            O:Format       087284
     C*                                                                   084174
     C                     ENDIF                                          087284
      *                                                                   087284
     C           P#RTCD    IFNE *BLANKS                                   084174
     C                     MOVELCCNUM     DBKEY                           084174
     C                     Z-ADD12        DBASE            ***************084174
     C                     MOVE 'CLINT'   DBFILE           **DB ERROR 12**084174
     C                     MOVELRCDT      DBKEY            ***************084174
     C                     MOVEA'1'       *IN,89                          084174
     C                     EXSR DBSR                                      084174
     C                     ELSE                                           084174
     C***********          MOVELCDADD1    CNA1   35                 084174087284
     C***********          MOVELCDADD2    CNA2   35                 084174087284
     C***********          MOVELCDADD3    CNA3   35                 084174087284
     C***********          MOVELCDADD4    CNA4   35                 084174087284
      *                                                                   087284
      * Move in address fields                                            087284
      *                                                                   087284
     C           RCDT      IFEQ 'B'                                       087284
     C                     MOVELBBCNA1    CNA1                            087284
     C                     MOVELBBCNA2    CNA2                            087284
     C                     MOVELBBCNA3    CNA3                            087284
     C                     MOVELBBCNA4    CNA4                            087284
     C                     ELSE                                           087284
     C                     MOVELBCCNA1    CNA1   35                       087284
     C                     MOVELBCCNA2    CNA2   35                       087284
     C                     MOVELBCCNA3    CNA3   35                       087284
     C                     MOVELBCCNA4    CNA4   35                       087284
     C                     ENDIF                                          087284
     C                     ENDIF                                          084174
     C**********           END                                            084174
     C*
     C                     MOVE 'A'       RCDT
     C           KLIST4    CHAINCLINT                99
     C           *IN99     IFEQ '1'                        - B1
     C                     MOVELCCNUM     DBKEY
     C                     Z-ADD13        DBASE            ***************
     C                     MOVE 'CLINT'   DBFILE           **DB ERROR 13**
     C                     MOVELRCDT      DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C                     MOVELCCNUM     AXCNUM  6
     C*
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           AXCNUM
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C*
     C           @RTCD     IFNE *BLANKS                    - B1
     C                     MOVELAXCNUM    DBKEY
     C                     Z-ADD14        DBASE            ***************
     C                     MOVE 'SDCUSTPD'DBFILE           **DB ERROR 14**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C** CHECK CUSTOMER GROUP ONLY IF ONE COMMISSION IS ON
     C*
     C           *IN67     IFEQ '1'
     C*
     C* IF THE CUSTOMER GROUP IS SUBJECT TO COMMISSION
     C*
     C                     Z-ADD1         Y
     C           CUCGRP    LOKUPCGRP,Y                   57
     C           *IN57     IFEQ '0'                        - B1
     C                     MOVE 'TABLEV4' DBFILE
     C                     MOVELCUCGRP    DBKEY            ***************
     C                     Z-ADD15        DBASE            **DB ERROR 15**
     C                     MOVE '1'       *IN89            ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           AGRP,Y    IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN54
     C                     ELSE                            - X1
     C                     MOVE '0'       *IN54
     C                     END                             - E1
     C*
     C                     END
     C*
     C**  ACCESS ACCNTAB
     C*
     C           KACCNT    CHAINACCNT                99
     C           *IN99     IFEQ '1'                        - B1
     C                     Z-ADD16        DBASE            ***************
     C                     MOVE 'ACCNT'   DBFILE           **DB ERROR 16**
     C                     MOVELRKEY      DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C           *IN54     IFEQ '1'                        - B1
     C           CEXB      IFEQ 'E'                        - B2
     C                     MOVE '0'       *IN54
     C                     ELSE                            - X1
     C                     MOVE '1'       *IN54
     C                     END                             - E2
     C                     END                             - E1
     C*
     C** CHECK IF CURRENCY EXIST
     C*
     C                     Z-ADD1         I
     C           CCCY      LOKUPCCYA,I                   97
     C*
     C           *IN97     IFEQ *ZERO                      - B1
     C                     Z-ADD17        DBASE            ***************
     C                     MOVE 'SDCURRPD'DBFILE           **DB ERROR 17**
     C                     MOVELCCCY      DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C                     MOVE ACNO      WACNO
     C*
     C** CHECK NUMBER OF DECIMAL OF CURRENCY
     C*
     C                     MOVEA'0000'    *IN,80
     C*
     C           DPA,I     IFEQ 0                          - B1
     C                     MOVE '1'       *IN80
     C                     ELSE                            - X1
     C           DPA,I     IFEQ 1                          - B2
     C                     MOVE '1'       *IN81
     C                     ELSE                            - X2
     C           DPA,I     IFEQ 2                          - B3
     C                     MOVE '1'       *IN82
     C                     ELSE                            - X3
     C                     MOVE '1'       *IN83
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     MOVEA'00'      *IN,01
     C*
     C**  DEFINE CAPITALISATION TO BE PROCESSED
     C*
     C           CDICI     IFNE *BLANKS                    - B1
     C                     MOVE '1'       *IN01
     C                     END                             - E1
     C*
     C           CCICI     IFNE *BLANKS                    - B1
     C                     MOVE '1'       *IN02
     C                     END                             - E1
     C*
     C           CCICI     IFNE *BLANKS                    - B1
     C           CDICI     ANDNE*BLANKS
     C                     EXSR BOTHSR
     C                     ELSE                            - X1
     C           CCICI     IFNE *BLANKS                    - B2
     C                     EXSR CRSR
     C                     END                             - E2
     C           CDICI     IFNE *BLANKS                    - B2
     C                     EXSR DRSR
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     EXSR INITPR
     C*
     C                     ENDSR                           **DETPR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** FIRST subroutine to execute first cycle.
     C**
     C**     Called by       S T A R T
     C**     Calls           DBSR
     C**
     C           FIRST     BEGSR                           **FIRST BEGSR**
     C*
     C** PREPARE DBPGM, DBKEY AND ERRDAT VARIABLES
     C*
     C                     MOVE 'RE3765  'DBPGM
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBASE
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C           MBIN      IFEQ 'Y'
     C                     SETON                     86
     C                     END
     C*
     C           DATF      IFEQ 'M'                        - B1
     C                     MOVE '1'       *IN98
     C                     END                             - E1
     C**
     C**   ACCESS BANK DETAILS
     C**
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDBANKPD'DBFILE
     C                     MOVEL@OPTN     DBKEY            ***************
     C                     MOVEL@OPTN     DBOPTN  7        **DB ERROR 18**
     C                     Z-ADD18        DBASE            ***************
     C                     EXSR DBSR
     C                     GOTO ENDFST
     C                     END
     C*                                                                   104618
     C**   Access Retail Details.                                         104618
     C*                                                                   104618
     C                     CALL 'AORETLR0'                                104618
     C                     PARM *BLANKS   @RTCD   7                       104618
     C                     PARM '*FIRST ' @OPTN   7                       104618
     C           SDRETL    PARM SDRETL    DSFDY                           104618
     C           @RTCD     IFNE *BLANK                                    104618
     C           *LOCK     IN   LDA                                       104618
     C                     MOVEL'SDRETLPD'DBFILE           ***************104618
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 29 *104618
     C                     MOVEL@OPTN     DBOPTN  7        ***************104618
     C                     Z-ADD029       DBASE                           104618
     C                     OUT  LDA                                       104618
     C                     EXSR DBSR                                      104618
     C                     GOTO ENDFST                                    104618
     C                     END                                            104618
     C*
     C* STORE ALL RETAIL ICD BY CURRENCY RECORDS
     C*
     C                     Z-ADD1         X       30
     C*
     C                     READ RECCYDF                  55
     C*
     C           *IN55     DOWEQ'0'                        READ UNTIL EOF
     C           RECI      IFEQ 'D'
     C                     MOVE KEY       CUR     4
     C                     MOVELCUR       CURR,X
     C                     MOVE ACMX      AMAX,X
     C                     MOVE ACMN      AMIN,X
     C                     Z-ADDACRT      ARET,X
     C                     ADD  1         X
     C                     END
     C                     READ RECCYDF                  55
     C                     END
     C*
     C* STORE THE EIGHT GROUPS RECORDS FROM THE RETAIL TABLE
     C*
     C                     Z-ADD1         Y       10
     C*
     C                     MOVEL'81      'CTKEY  12
     C                     MOVE '    '    CTKEY
     C           1         SETLLTABLEV4
     C*
     C                     READ TABLEV4                  56
     C                     MOVELCTKEY     CT      2
     C*
     C           *IN56     DOUEQ'1'                        READ UNTIL EOF
     C           RECI      IFEQ 'D'
     C           CT        IFEQ '81'
     C                     MOVE KEY       CGRP,Y
     C                     MOVE ACMI      AGRP,Y
     C                     ADD  1         Y
     C                     END
     C                     READ TABLEV4                  56
     C                     MOVELCTKEY     CT      2
     C                     END
     C                     END
     C*
     C** OUTPUT AUDIT HEADER
     C*
     C                     WRITEHEADAU
     C*
     C** INITIALISE WORK FIELDS
     C*
     C                     Z-ADD*ZEROS    PPSTD
     C                     Z-ADD*ZEROS    PVALD
     C                     Z-ADD1         PAGH
     C                     Z-ADD1         PAGF
     C                     Z-ADD1         PAGU
     C                     Z-ADD*ZEROS    DHISD
     C                     Z-ADD*ZEROS    WHISD
     C                     Z-ADD*ZEROS    DAYS
     C                     Z-ADD*ZEROS    NUMB0
     C                     Z-ADD*ZEROS    HISB0
     C                     Z-ADD*ZEROS    INT0
     C                     Z-ADD*ZEROS    TINT0
     C                     Z-ADD*ZEROS    ZICALC  20
     C                     Z-ADD*ZEROS    ZDAYN1
     C                     Z-ADD*ZEROS    WDAID
     C                     Z-ADD*ZEROS    WCAID
     C                     Z-ADD*ZEROS    WWTND
     C                     Z-ADD*ZEROS    WWTNC
     C*
     C                     Z-ADD*ZEROS    TOTPST
     C                     Z-ADD*ZEROS    TOTNPS
     C*
     C**  SET UP WORK FIELD FOR OVERRIDE MESSAGE FILE
     C*
     C                     Z-ADD39        MSGLEN 155
     C*
     C** OPEN ICD TABLE FOR RETAIL
     C*
     C                     OPEN TABTBRE
     C           1         CHAINTABTBRE              99
     C*
     C           *IN99     IFEQ '1'                        - B1
     C           RECI      ORNE 'D'
     C                     Z-ADD19        DBASE            ***************
     C                     MOVE 'TABTBRE' DBFILE           **DB ERROR 19**
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     MOVEA'0'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C** COMMISSION ON DEBIT TURNOVER
     C*
     C           CDTO      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN67
     C                     END                             - E1
     C*
     C** COMMISSION ON HIGHEST OVERDRAFT
     C*
     C           CMDR      IFEQ 'Y'                        - B1
     C           MDPF      ANDEQ'Y'                        - B1
     C                     MOVE '1'       *IN67
     C                     END                             - E1
     C*
     C** FIXED ACCOUNT CHARGE
     C*
     C           FXAC      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN67
     C                     END                             - E1
     C*
     C** CHARGE ON NUMBER OF DAILY STATEMENTS
     C*
     C           CNDS      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN67
     C                     END                             - E1
     C*
     C** COMMISSION ON DEBIT INTEREST
     C*
     C           CDRI      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN67
     C                     END                             - E1
     C*
     C** COMMISSION ON MINIMUM AVERAGE BALANCE
     C*
     C           CMBL      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN67
     C                     END                             - E1
     C*
     C** CHARGE ON INACTIVE ACCOUNT
     C*
     C           CINA      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN67
     C                     END                             - E1
     C*
     C** VAT PROCESSING
     C*
     C           VATP      IFEQ 'Y'                        - B1
     C                     MOVE '1'       *IN67
     C                     END                             - E1
      *                                                                   CRE001
      ** Access SAR Details File to determine if CRE001 is installed      CRE001
      *                                                                   CRE001
     C                     CALL 'AOSARDR0'                                CRE001
     C                     PARM *BLANKS   @RTCD   7                       CRE001
     C                     PARM '*VERIFY' @OPTN                           CRE001
     C                     PARM 'CRE001'  @SARD   6                       CRE001
      *                                                                   CRE001
      ** Handle Datebase Error.                                           CRE001
     C           @RTCD     IFNE *BLANK                                    CRE001
     C           @RTCD     ANDNE'*NRF   '                  ***************CRE001
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 25**CRE001
     C                     MOVEL@RTCD     DBKEY            ***************CRE001
     C                     Z-ADD25        DBASE                           CRE001
     C                     EXSR DBSR                                      CRE001
     C                     GOTO ENDFST                                    CRE001
     C                     ENDIF                                          CRE001
     C/COPY WNCPYSRC,RE3765C016
      *                                                                   CRE001
      ** CRE001 is installed                                              CRE001
     C           @RTCD     IFEQ *BLANK                                    CRE001
     C                     MOVE 'Y'       CRE001  1                       CRE001
     C                     ELSE                                           CRE001
     C                     MOVE 'N'       CRE001                          CRE001
     C                     ENDIF                                          CRE001
     C/COPY WNCPYSRC,RE3765C018
      *                                                                   CRE001
      ** Access SAR Details File to determine if CGL031 is installed                          CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD   7                                           CGL031
     C                     PARM '*VERIFY' POPTN   7                                           CGL031
     C                     PARM 'CGL031'  DSFDY                                               CGL031
      *                                                                                       CGL031
      ** Handle Datebase Error.                                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANK                                                        CGL031
     C           PRTCD     ANDNE'*NRF   '                                                     CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     MOVEL'CGL031'  DBKEY                                               CGL031
     C                     MOVE 31        DBASE                                               CGL031
     C                     EXSR DBSR                                                          CGL031
     C                     GOTO ENDFST                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** CGL031 is installed                                                                  CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANK                                                        CGL031
     C                     MOVE 'Y'       CGL031  1                                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'N'       CGL031                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     EXSR MULTL
     C**
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF BRT SAR IS INSTALLED
     C**
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01383'  @SARD   6
     C           @RTCD     IFNE *BLANK
     C           @RTCD     ANDNE'*NRF   '                  ***************
     C                     MOVEL'SCSARDPD'DBFILE           * DB ERROR 20 *
     C                     MOVEL@RTCD     DBKEY            ***************
     C                     Z-ADD20        DBASE
     C                     EXSR DBSR
     C                     GOTO ENDFST
     C                     END
     C           @RTCD     IFEQ *BLANK
     C                     MOVEL'Y'       S01383  1
     C                     END
     C*
     C** IF BRT SAR INSTALLED
     C*
     C           S01383    IFEQ 'Y'                        B001
     C*
     C** ACCESS BRT INSTALLATION CONTROL DATA
     C*
     C                     MOVE 'D'       RECI
     C           RECI      CHAINSDBRTDD0             99
     C           *IN99     IFEQ '1'                        ***************
     C                     MOVEL'SDBRTDPD'DBFILE           * DB ERROR 21 *
     C                     MOVELRECI      DBKEY            ***************
     C                     Z-ADD21        DBASE
     C                     EXSR DBSR
     C                     GOTO ENDFST
     C                     END
     C                     END                             E001
     C*
     C/COPY WNCPYSRC,RE3765C019
     C                     Z-ADDTGINT0    TGINT0
     C                     Z-ADDWKBRT     WKBRT   75
     C                     Z-ADDBRTOT0    BRTOT0
     C                     Z-ADDBRTOT1    BRTOT1 151
     C/COPY WNCPYSRC,RE3765C031
     C*
     C                     EXSR CCYARR
      *                                                                   CFT004
      **  Access SAR details file to see if CFT004 is installed.          CFT004
      *                                                                   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM *BLANKS   PRTCD   7                       CFT004
     C                     PARM '*VERIFY' POPTN   7                       CFT004
     C                     PARM 'CFT004'  PSARD   6                       CFT004
     C           SCSARD    PARM SCSARD    DSSDY                           CFT004
     C*                                                                   CFT004
     C                     MOVE 'N'       CFT004                          CFT004
     C           PRTCD     IFEQ *BLANKS                                   CFT004
     C                     MOVE 'Y'       CFT004  1                       CFT004
     C                     ENDIF                                          CFT004
     C*
      ** Check if CER048 is enabled                                                           CER048
      *                                                                                       CER048
     C                     CALL 'AOSARDR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*VERIFY' POPTN                                               CER048
     C                     PARM 'CER048'  PSARD                                               CER048
     C           SCSARD    PARM SCSARD    DSFDY                                               CER048
      *                                                                                       CER048
     C                     MOVE 'N'       CER048  1                                           CER048
      *                                                                                       CER048
     C           PRTCD     IFEQ *BLANKS                                                       CER048
      *                                                                                       CER048
     C                     MOVE 'Y'       CER048                                              CER048
     C                     ELSE                                                               CER048
     C           PRTCD     IFNE '*NRF'                                                        CER048
      *                                                                                       CER048
     C                     MOVE 'SCSARDPD'DBFILE                                              CER048
     C                     MOVE 'CER048'  DBKEY                                               CER048
     C                     MOVE 32        DBASE                                               CER048
     C                     EXSR DBSR                                                          CER048
     C                     GOTO ENDFST                                                        CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C           ENDFST    TAG
     C*
      *                                                                                       CER016
      ** Access SAR Details File to determine if CER016 is installed                          CER016
      *                                                                                       CER016
     C                     CALL 'AOSARDR0'                                                    CER016
     C                     PARM *BLANKS   PRTCD                                               CER016
     C                     PARM '*VERIFY' POPTN                                               CER016
     C                     PARM 'CER016'  PSARD                                               CER016
     C           SCSARD    PARM SCSARD    DSSDY                                               CER016
      *                                                                                       CER016
      ** CER016 is installed                                                                  CER016
      *                                                                                       CER016
     C           PRTCD     IFEQ *BLANKS                                                       CER016
     C                     MOVE 'Y'       CER016  1                                           CER016
      *                                                                                       CER016
     C                     ELSE                                                               CER016
     C                     MOVE 'N'       CER016                                              CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
      ** Database error                                                                       CER016
      *                                                                                       CER016
     C           PRTCD     IFNE *BLANKS                                                       CER016
     C           PRTCD     ANDNE'*NRF   '                                                     CER016
      *                                                                                       CER016
     C           *LOCK     IN   LDA                                                           CER016
     C                     MOVEL'SCSARDPD'DBFILE                                              CER016
     C                     MOVEL'CER016'  DBKEY                                               CER016
     C                     Z-ADD032       DBASE                                               CER016
     C                     OUT  LDA                                                           CER016
     C                     EXSR *PSSR                                                         CER016
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
      *                                                                                       CER016
     C                     ENDSR                           **FIRST ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** INITPR SUBROUTINE TO INITIALIZE ALL FIELDS TO BE PRINTED
     C**
     C**     Called by       DETPR
     C**     Calls           -
     C**
     C           INITPR    BEGSR                           **INITPR BEGSR**
     C*
     C                     MOVE *BLANKS   PSTDA
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   NARR
     C                     MOVE *BLANKS   RNARR
     C                     MOVE *BLANKS   TNARR
     C                     MOVE *BLANKS   XNARR
     C                     MOVE *BLANKS   DNARR
     C                     MOVE *BLANKS   BNARR
     C*
     C                     Z-ADD*ZEROS    PSTD0
     C                     Z-ADD*ZEROS    RATE
     C                     Z-ADD*ZEROS    DAYS
     C                     Z-ADD*ZEROS    NUMB0
     C                     Z-ADD*ZEROS    HISB0
     C                     Z-ADD*ZEROS    INT0
     C                     Z-ADD*ZEROS    TINT0
     C                     Z-ADD*ZEROS    ORAT1
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL01
     C                     Z-ADD*ZEROS    OBAL02
     C                     Z-ADD*ZEROS    OBAL03
     C                     Z-ADD*ZEROS    WWTND  150
     C                     Z-ADD*ZEROS    WWTNC  150
     C                     Z-ADD*ZEROS    DDAID
     C                     Z-ADD*ZEROS    DCAID
     C*
     C                     Z-ADD*ZEROS    TOTPST 120
     C                     Z-ADD*ZEROS    TOTNPS 120
     C                     Z-ADD*ZEROS    TGINT0
     C                     Z-ADD*ZEROS    WKBRT
     C                     Z-ADD*ZEROS    BRTOT0
     C                     Z-ADD*ZEROS    BRTOT1
     C                     Z-ADD*ZEROS    EUTAX0                                              CGL031
     C                     Z-ADD*ZEROS    STAX0                                               CER048
     C/COPY WNCPYSRC,RE3765C032
     C*
     C                     ENDSR                           **INITPR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** MULTL MULTILANGUAGE SUBROUTINE
     C**
     C**     Called by       FIRST, MAIN
     C**     Calls           ZA1310
     C**
     C           MULTL     BEGSR                           **MULTL BEGSR**
     C                     EXSR CLMSG
     C                     MOVEL'RES0001' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,1
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0002' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,2
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0003' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,3
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0004' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,4
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0005' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,5
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0006' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,6
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0007' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,7
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0008' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,8
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0009' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,9
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0010' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,10
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0011' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,11
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0012' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,12
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0013' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,13
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0014' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,14
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0015' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,15
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0016' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,16
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0017' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,17
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0018' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,18
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0019' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,19
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0020' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,20
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0021' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,21
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0022' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,22
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0023' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,23
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0024' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,24
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0025' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,25
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0026' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,26
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0027' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,27
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0028' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,28
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0029' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,29
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0030' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,30
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0031' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,31
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0032' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,32
     C                     MOVEL*BLANKS   MNARR
     C*
     C* ADDITIONAL NARRATIVE FOR TURNOVER COMMISSION
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0033' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,33
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'RES0034' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,34
     C                     MOVEL*BLANKS   MNARR
      *                                                                   CRE001
      ** If CRE001 is switched ON                                         CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
      *                                                                   CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVEL'RES0034' MSGID                           CRE001
     C                     CALL 'ZA1310'  ZA1311                          CRE001
     C                     MOVELMNARR     NAR,35                          CRE001
     C                     MOVEL*BLANKS   MNARR                           CRE001
      *                                                                   CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVEL'RES0033' MSGID                           CRE001
     C                     CALL 'ZA1310'  ZA1311                          CRE001
     C                     MOVELMNARR     NAR,36                          CRE001
     C                     MOVEL*BLANKS   MNARR                           CRE001
      *                                                                   CRE001
     C                     EXSR CLMSG                                     CRE001
     C                     MOVEL'RES0037' MSGID                           CRE001
     C                     CALL 'ZA1310'  ZA1311                          CRE001
     C                     MOVELMNARR     NAR,37                          CRE001
     C                     MOVEL*BLANKS   MNARR                           CRE001
      *                                                                   CRE001
     C                     ENDIF                                          CRE001
     C/COPY WNCPYSRC,RE3765C006
     C*
     C                     ENDSR                           **MULTL ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ITYPCR subroutine for interest type greater than 2
     C**
     C**     Called by       CRSR, TOTSR
     C**
     C**     Calls           ZICD
     C**
     C           ITYPCR    BEGSR                           **ITYPCR BEGSR*
     C*
     C**  CHECK IF END OF MONTH OR RATE CHANGE CREDIT
     C*
     C           DRECI     IFEQ 'M'                        - B1
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     Z-ADDWCRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B2
     C*
     C                     ELSE                            - X2
     C           *IN81     IFEQ '1'                        - B3
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X3
     C           *IN82     IFEQ '1'                        - B4
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X4
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E4
     C                     END                             - E3
     C                     END                             - E2
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B2
     C                     Z-SUBDINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B3
     C           DTHGAR    IFNE *ZERO                      - B4
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E4
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     Z-ADDCINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B3
     C           DTHGAR    IFNE *ZERO                      - B4
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E4
     C                     END                             - E3
     C                     END                             - E2
     C*
     C                     Z-ADDMHISD     WHISD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E1
     C*
     C           DRECI     DOWEQ'M'                        - B1
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFNE '1'                        - B2
     C*
     C           DRECI     IFEQ 'M'                        - B3
     C           CSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     Z-ADDWCRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B4
     C*
     C                     ELSE                            - X4
     C           *IN81     IFEQ '1'                        - B5
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X5
     C           *IN82     IFEQ '1'                        - B6
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X6
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E6
     C                     END                             - E5
     C                     END                             - E4
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B4
     C                     Z-SUBDINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B5
     C           DTHGAR    IFNE *ZERO                      - B6
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E6
     C                     END                             - E5
     C                     ELSE                            - X4
     C                     Z-ADDCINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B5
     C           DTHGAR    IFNE *ZERO                      - B6
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E6
     C                     END                             - E5
     C                     END                             - E4
     C*
     C                     Z-ADDMHISD     WHISD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X3
     C*
     C           DRECI     IFEQ 'S'                        - B4
     C***********SCICI     ANDEQ'Y'                                      098818
     C           SCICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     Z-ADDWCRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B5
     C*
     C                     ELSE                            - X5
     C           *IN81     IFEQ '1'                        - B6
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X6
     C           *IN82     IFEQ '1'                        - B7
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X7
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B5
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X5
     C                     Z-ADDCINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B6
     C           DTHGAR    IFNE *ZERO                      - B7
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
     C*
     C                     Z-ADDDHISD     WHISD
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **ITYPCR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ITYPDR subroutine for interest type greater than 2
     C**
     C**     Called by       DRSR; TOTSR
     C**
     C**     Calls           ZICD
     C**
     C           ITYPDR    BEGSR                           **ITYPDR BEGSR*
     C*
     C**  CHECK IF END OF MONTH OR DEBIT RATE CHANGE
     C*
     C           DRECI     IFEQ 'M'                        - B1
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     Z-ADDWDRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B2
     C*
     C                     ELSE                            - X2
     C           *IN81     IFEQ '1'                        - B3
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X3
     C           *IN82     IFEQ '1'                        - B4
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X4
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E4
     C                     END                             - E3
     C                     END                             - E2
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B2
     C                     Z-SUBDINT      INT0
     C                     ELSE                            - X2
     C                     Z-ADDCINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B3
     C           DTHGAR    IFNE *ZERO                      - B4
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E4
     C                     END                             - E3
     C                     END                             - E2
     C*
     C                     Z-ADDMHISD     WHISD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     END                             - E1
     C*
     C           DRECI     DOWEQ'M'                        - B1
     C           *IN51     ANDEQ'0'
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C           *IN51     IFNE '1'                        - B2
     C*
     C           DRECI     IFEQ 'M'                        - B3
     C           DSDAT     ANDNE*ZEROS
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDMHISD     ZIEND
     C                     Z-ADDWDRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           MNBL      MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B4
     C*
     C                     ELSE                            - X4
     C           *IN81     IFEQ '1'                        - B5
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X5
     C           *IN82     IFEQ '1'                        - B6
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X6
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E6
     C                     END                             - E5
     C                     END                             - E4
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           MNBL      IFGT *ZEROS                     - B4
     C                     Z-SUBDINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B5
     C           DTHGAR    IFNE *ZERO                      - B6
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E6
     C                     END                             - E5
     C                     ELSE                            - X4
     C                     Z-ADDCINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B5
     C           DTHGAR    IFNE *ZERO                      - B6
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E6
     C                     END                             - E5
     C                     END                             - E4
     C*
     C                     Z-ADDMHISD     WHISD
     C                     Z-ADDMNBL      WMNBL
     C*
     C                     ELSE                            - X3
     C*
     C           DRECI     IFEQ 'S'                        - B4
     C***********SDICI     ANDEQ'Y'                                      098818
     C           SDICI     ANDNE*BLANKS                                  098818
     C*
     C                     Z-ADDWHISD     ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C                     Z-ADDWDRCB     ZICALC
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C           SMNBL     MULT DAYS      NUMB0
     C*
     C           *IN80     IFEQ '1'                        - B5
     C*
     C                     ELSE                            - X5
     C           *IN81     IFEQ '1'                        - B6
     C           NUMB0     DIV  10        NUMB0
     C                     ELSE                            - X6
     C           *IN82     IFEQ '1'                        - B7
     C           NUMB0     DIV  100       NUMB0
     C                     ELSE                            - X7
     C           NUMB0     DIV  1000      NUMB0
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
     C                     Z-SUBNUMB0     NUMB0
     C*
     C           SMNBL     IFGT *ZEROS                     - B5
     C                     Z-SUBDINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B6
     C           DTHGAR    IFNE *ZERO                      - B7
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E7
     C                     END                             - E6
     C                     ELSE                            - X5
     C                     Z-ADDCINT      INT0
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B6
     C           DTHGAR    IFNE *ZERO                      - B7
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E7
     C                     END                             - E6
     C                     END                             - E5
     C*
     C                     Z-ADDDHISD     WHISD
     C*
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **ITYPDR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** MAIN subroutine to execute main processing.
     C**
     C**     Called by       S T A R T
     C**
     C**     Calls           DETPR
     C**
     C           MAIN      BEGSR                           **MAIN BEGSR**
     C*
     C           *INLR     IFEQ '1'
     C                     GOTO END
     C                     END
     C*
     C** ACCESS RECAPM SEQUENTIALY
     C*
     C                     READ RECAPML                  LR
     C*
     C**  Call ZSFILE for initial OPEN
     C*
     C           *INLR     IFNE '1'
     C                     SETON                     85
     C                     OPEN RE3765HC
     C                     Z-ADDSFNUM     ZSNUM
     C                     OUT  LDA
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM CBRCA     SENTY
     C                     PARM           SFILE
     C                     PARM           ZSNUM   60
     C                     PARM           ZSERR   1
     C           *LOCK     IN   LDA
     C*
     C           ZSERR     IFEQ 'Y'
     C** ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM
     C** DBASE, DBFILE AND DBKEY SET WITHIN ZSFILE
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     RETRN
     C                     END
     C*
     C                     OPEN RE3765DC
     C                     Z-ADDSFNUM1    ZSNUM1
     C                     OUT  LDA
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM CBRCA     SENTY
     C                     PARM           SFILE1
     C                     PARM           ZSNUM1  60
     C                     PARM           ZSERR   1
     C           *LOCK     IN   LDA
     C*
     C           ZSERR     IFEQ 'Y'
     C** ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM
     C** DBASE, DBFILE AND DBKEY SET WITHIN ZSFILE
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     RETRN
     C                     END
     C*
     C                     END
     C**
     C*
     C**  SAVE KEY TO CHECK BREAK
     C*
     C                     MOVE RKEY      OKEY
     C*
     C**  EXECUTE UNTIL EOF RECAPM
     C*
     C           *INLR     DOWEQ'0'                        - B1
     C/COPY WNCPYSRC,RE3765C023
     C*
     C**  TEST FOR MULTIBRANCH OUTPUT
     C*
     C           OBRCA     IFNE CBRCA
     C                     CLOSERE3765DC
     C                     CLOSERE3765HC
     C                     SETON                     85
     C                     OPEN RE3765DC
     C                     Z-ADDSFNUM     ZSNUM
     C                     OUT  LDA
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM CBRCA     SENTY
     C                     PARM           SFILE
     C                     PARM           ZSNUM   60
     C                     PARM           ZSERR   1
     C           *LOCK     IN   LDA
     C*
     C           ZSERR     IFEQ 'Y'
     C** ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM
     C** DBASE, DBFILE AND DBKEY SET WITHIN ZSFILE
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     RETRN
     C                     END
     C*
     C                     OPEN RE3765HC
     C                     Z-ADDSFNUM1    ZSNUM1
     C                     OUT  LDA
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM CBRCA     SENTY
     C                     PARM           SFILE1
     C                     PARM           ZSNUM1  60
     C                     PARM           ZSERR   1
     C           *LOCK     IN   LDA
     C*
     C           ZSERR     IFEQ 'Y'
     C** ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM
     C** DBASE, DBFILE AND DBKEY SET WITHIN ZSFILE
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     RETRN
     C                     END
     C**
     C*    ACCESS BRANCH DETAILS
     C**
     C** GET BRANCH NAME, ONLY WHEN MBIN = 'Y'
     C**
     C           MBIN      IFEQ 'Y'
     C*
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM CBRCA     @DSNB   3
     C**********           PARM           SDBRCH                                              CGL029
     C                     PARM           DSSDY                                               CGL035
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL@DSNB     DBKEY
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C                     Z-ADD22        DBASE            **DB ERROR 22**
     C                     EXSR DBSR                       ***************
     C                     EXSR *PSSR
     C                     END
     C*
     C                     END
     C*
     C   U8                GOTO END
     C                     END
     C*
     C                     EXSR PRNO
     C           PRYES     IFEQ 'Y'                        - B2
     C*
     C**  CHECK IF IT IS THE SAME ACCOUNT
     C*
     C           RKEY      IFNE OKEY                       - B3
     C                     Z-ADD1         PAGH
     C                     Z-ADD1         PAGF
     C                     MOVE RKEY      OKEY
     C*****************************************************************
     C** Multilanguage processing is currently not in use.
     C** Codings are asterisked but retained for future use.
     C*
     C** PROCESS FOR MULTILANGUAGE
     C*
     C***********LGID      IFEQ *BLANKS                    - B4
     C***********LGID      OREQ '00'
     C***********LGID      OREQ *LOVAL
     C***********          MOVE DLGID     LGID             - E4
     C***********          END                             - E4
     C*                                                    - B4
     C***********LGID      IFNE OLGID                      - B4
     C*
     C*
     C**  DEFINE MESSAGE FILE
     C*
     C                     MOVE CMD,1     CMD1
     C***********          MOVELOLGID     FILT1
     C***********          MOVELLGID      FILT2
     C***********          CALL 'QCMDEXC' CMD1
     C***********          PARM           MSGLEN
     C*
     C***********          MOVE LGID      OLGID
     C***********          EXSR MULTL
     C*
     C***********          END                             - E4
     C*****************************************************************
     C*
     C                     END                             - E3
     C*
     C/COPY WNCPYSRC,RE3765C034
     C                     EXSR DETPR
     C                     SETOF                     U7U8
     C*
     C** NUMBER OF PROCESSED RECORDS
     C*
     C                     ADD  1         NBRREC
     C/COPY WNCPYSRC,RE3765C035
     C*
     C                     END                             - E2
     C*
     C* RESET OVERFLOW INDICATOR AT CHANGE OF ACCOUNT
     C*
     C                     MOVEA'00'      *IN,73
     C                     MOVE '0'       *IN51
     C                     Z-ADD*ZEROS    WDAID
     C                     Z-ADD*ZEROS    WCAID
     C                     READ RECAPML                  LR
     C                     END                             - E1
     C*
     C           END       TAG
     C                     ENDSR                           **MAIN ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** PRNO   subroutine TO DECIDE IF RECORD TO PRINT OR NO
     C**
     C**
     C**     Called by       START
     C**
     C**     Calls           -
     C**
     C           PRNO      BEGSR                           **PRNO   BEGSR*
     C*
     C                     MOVE 'N'       PRYES
     C                     MOVE '0'       *IN70
     C*
     C*  FOR MANAGEMENT OR DEMAND PRINT
     C*
     C           CDICI     IFEQ 'M'                        - B1
     C           CCICI     OREQ 'M'
     C           CDICI     OREQ 'D'
     C           CCICI     OREQ 'D'
     C                     MOVE 'Y'       PRYES   1
     C                     END                             - E1
     C           CDICI     IFEQ 'M'                        - B1
     C           CCICI     OREQ 'M'
     C                     MOVE '1'       *IN70
     C/COPY WNCPYSRC,RE3765C015
     C                     END                             - E1
     C*
     C** ACCESS RECOM ONLY IF ONE COMMISSION IS ON
     C*
     C           *IN67     IFEQ '1'
     C*
     C*  ACCESS RECOM FOR COMMISSION DETAILS
     C*
     C           KLIST0    CHAINRECOM                99
     C           *IN99     IFEQ '1'                        - B1***********
     C                     Z-ADD23        DBASE            **DB ERROR 23**
     C                     MOVE 'RECOM  ' DBFILE           ***************
     C                     MOVELRKEY      DBKEY
     C                     EXSR DBSR
     C                     END                             - E1
     C           CDICI     IFEQ 'C'                        - B1
     C           CDICI     OREQ ' '
     C                     Z-ADD*ZERO     FXDC
     C                     END                             - E1
     C           CDICA     SUB  CCDIC     CDICA
     C           ACCC      SUB  CACCC     ACCC
     C           CHDBC     SUB  CCHDBC    CHDBC
     C           CMBC      SUB  CCMBC     CMBC
     C*
     C                     END
     C*
     C*  IF CAPITALISATION OCCURS AT LEAST ONE AMOUNT MUST BE DIFFERENT
     C*  OF ZERO TO BE PRINTED.
     C*
     C           CDICI     IFNE ' '                        - B1
     C           CDAIC     IFNE *ZERO                      - B2
     C           CPMADI    ORNE *ZERO
     C           CTMADI    ORNE *ZERO
     C           CDMINT    ORNE *ZERO
     C           CSGADI    ORNE *ZERO
     C           FXDC      ORNE *ZERO
     C           ACCC      ORNE *ZERO
     C           CHDBC     ORNE *ZERO
     C           CMBC      ORNE *ZERO
     C           CDICA     ORNE *ZERO
     C                     MOVE 'Y'       PRYES   1
     C                     END                             - E2
     C                     END                             - E1
     C*
     C           CCICI     IFNE ' '                        - B1
     C           CCAIC     IFNE *ZERO                      - B2
     C           CPMACI    ORNE *ZERO
     C           CTMACI    ORNE *ZERO
     C           CCMINT    ORNE *ZERO
     C           CSGACI    ORNE *ZERO
     C           CCHGP     ORNE *ZERO
     C                     MOVE 'Y'       PRYES   1
     C                     END                             - E2
     C                     END                             - E1
     C*
     C** ALWAYS PRINTED
     C*
     C                     MOVE 'Y'       PRYES   1
     C                     ENDSR                           **NOPR   ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** OPENCR subroutine for credit output - opening balance and
     C**                                       opening rate
     C**
     C**     Called by       B1LT, B1GT
     C**
     C**     Calls           DBSR
     C**
     C           OPENCR    BEGSR                           **OPENCR BEGSR*
     C*
     C                     Z-SUBW2STBL    HISB0
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,15    TNARR
     C*
     C           PVALD     IFNE CLCID                      - B1
     C                     Z-ADDCLCID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLCID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C*
     C**  OUTPUT OPENING BALANCE
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,8     RNARR
     C*
     C                     Z-ADDCRIR      RATE
     C*
     C**  OUTPUT OPENING RATE
     C*
     C                     EXSR OVERDC
     C                     WRITERATEDC
     C*
      ***If*CRE001*is*switched*ON,*then*output*'Overdraft Limit'** CRE001 180892
      **********                                                   CRE001 180892
     C********** CRE001    IFEQ 'Y'                                CRE001 180892
     C**********           EXSR CLMSG                              CRE001 180892
     C**********           MOVELNAR,36    ONARR                    CRE001 180892
     C**********           MOVE ODRL      OODRL                    CRE001 180892
     C**********           EXSR OVERDC                             CRE001 180892
     C**********           WRITEODLNDC                             CRE001 180892
     C**********           ENDIF                                   CRE001 180892
      **********                                                   CRE001 180892
     C                     ENDSR                           **OPENCR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** OPENDR subroutine for debit output - opening balance and
     C**                                      opening rate
     C**
     C**     Called by       B1LT, B1GT
     C**
     C**     Calls           DBSR
     C**
     C           OPENDR    BEGSR                           **OPENDR BEGSR*
     C*
     C                     Z-SUBW1STBL    HISB0
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,16    TNARR
     C*
     C           PVALD     IFNE CLDID                      - B1
     C                     Z-ADDCLDID     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDCLDID     PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C*
     C**  OUTPUT OPENING BALANCE
     C*
     C                     EXSR OVERDC
     C                     WRITETITLEDC
     C*
     C                     MOVE *BLANKS   VALDA
     C                     MOVE *BLANKS   PSTDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,3     RNARR
     C*
     C                     Z-ADDDRIR      RATE
     C*
     C**  OUTPUT OPENING RATE
     C*
     C                     EXSR OVERDC
     C                     WRITERATEDC
     C*
      ** If CRE001 is switched ON, then output 'Overdraft Limit'          180892
      *                                                                   180892
     C           CRE001    IFEQ 'Y'                                       180892
     C                     EXSR CLMSG                                     180892
     C                     MOVELNAR,28    ONARR                           180892
     C                     MOVE ODRL      OODRL                           180892
     C                     EXSR OVERDC                                    180892
     C                     WRITEODLNDC                                    180892
     C                     ENDIF                                          180892
      *                                                                   180892
     C                     ENDSR                           **OPENDR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** OVERDC subroutine for processing overflow on RE3764DC
     C**
     C**     Called by       CRSR, DRSR, POSTSR
     C**
     C**     Calls           -
     C**
     C           OVERDC    BEGSR                           **OVERDC BEGSR*
     C/COPY WNCPYSRC,RE3765C017
     C*
     C**  CHECK IF OVERFLOW ON RE3764DC
     C*
     C           *IN73     IFEQ '1'                        - B1
     C                     ADD  1         PAGF
     C                     MOVE WACNO     ACNO
     C                     MOVE '0'       *IN65
     C           ACNO      IFNE *ZEROS
     C                     MOVE '1'       *IN65
     C                     END
     C                     WRITEHEADDC
     C                     MOVE '0'       *IN73
     C                     END                             - E1
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           *IN74     IFEQ '1'                        - B1
     C           CCICI     IFNE *BLANK                     - B2
     C           CCHGP     ANDNE*ZERO
     C                     ADD  1         PAGH
     C                     WRITEHEADCH
     C                     MOVE '0'       *IN74
     C                     END                             - E2
     C                     END                             - E1
     C*
     C                     ENDSR                           **OVERDC ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** POSTSR subroutine for posting output
     C**
     C**     Called by       BOTHSR, B1EQ, B1LT, B1GT
     C**
     C**     Calls           DBSR, OVERDC
     C**
     C           POSTSR    BEGSR                           **POSTSR BEGSR*
     C*
     C           PPSTD     IFNE PSTD                       - B1
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDPSTD      PPSTD
     C                     END                             - E1
     C*
     C                     MOVE PSTDO     PSTDA
     C*
     C           PVALD     IFNE HISD                       - B1
     C                     Z-ADDHISD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDHISD      PVALD
     C                     END                             - E1
     C*
     C                     MOVE VALDO     VALDA
     C*
     C                     MOVELPNAR      NARR
     C*
     C           DRCR      IFEQ 0                          - B1
     C                     Z-SUBPSTA      PSTD0
     C*
     C** CHECK IF TURNOVER OR NOT
     C*
     C           TURN      IFNE 'Y'                        - B2
     C                     MOVE '1'       *IN33
     C                     ADD  PSTA      TOTNPS
     C                     ELSE                            - X2
     C                     ADD  PSTA      TOTPST
     C                     END                             - E2
     C                     ELSE                            - X1
     C                     Z-ADDPSTA      PSTD0
     C                     END                             - E1
     C*
     C**  OUTPUT POSTING FOR DEBIT AND CREDIT
     C*
     C                     EXSR OVERDC
     C                     WRITEPOSTDC
     C*
     C                     MOVE '0'       *IN33
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B1
     C           CHGA      ANDNE*ZERO
     C           REBI      IFEQ 'Y'                        - B2
     C                     Z-SUBCHGA      CHGR0
     C                     Z-SUB*ZERO     CHGN0
     C                     ELSE                            - X2
     C                     Z-SUBCHGA      CHGN0
     C                     Z-SUB*ZERO     CHGR0
     C                     END                             - E2
     C                     WRITEPOSTCH
     C                     END                             - E1
     C*
     C                     ENDSR                           **POSTSR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** RATEC subroutine to prepare and output credit rate change
     C**
     C**     Called by       CRSR, RATESR
     C**
     C**     Calls           DBSR, RCRSR
     C**
     C           RATEC     BEGSR                           **RATEC BEGSR**
     C*
     C**  ACCESS REHRCJ (REHPOSR1 REHPOSR2 REHPOSR3) WHICH CONTAINS
     C**  THE GOOD DATES FOR CREDIT RATE CHANGE TO
     C*
     C           KLIST6    CHAINREHRCJ               60
     C*
     C           *IN60     IFEQ '1'                        - B1
     C                     Z-ADDDCRCD     WDATE
     C                     Z-ADD24        DBASE
     C                     MOVE 'REHRCJ'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 24**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE RVALD                      - B1
     C                     Z-ADDRVALD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDRVALD     PVALD
     C                     END                             - E1
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PPSTD     IFNE RPSTD                      - B1
     C                     Z-ADDRPSTD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRPSTD     PPSTD
     C                     END                             - E1
     C*
     C**  PREPARE DEBIT RATE CHANGE TO OUTPUT
     C*
     C                     MOVE PSTDO     PSTDA
     C                     MOVE VALDO     VALDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,9     RNARR
     C*
     C**  OUTPUT DEBIT RATE CHANGE TO
     C*
     C                     EXSR RCRSR
     C*
     C                     ENDSR                           **RATEC ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** RATED subroutine to prepare and output debit rate change
     C**
     C**     Called by       DRSR, RATESR
     C**
     C**     Calls           DBSR, RDRSR
     C**
     C           RATED     BEGSR                           **RATED BEGSR**
     C*
     C**  ACCESS REHRDJ (REHPOSR1 REHPOSR2 REHPOSR3) WHICH CONTAINS
     C**  THE GOOD DATES FOR DEBIT RATE CHANGE TO
     C*
     C           KLIST5    CHAINREHRDJ               60
     C*
     C           *IN60     IFEQ '1'                        - B1
     C                     Z-ADDDDRCD     WDATE
     C                     Z-ADD25        DBASE
     C                     MOVE 'REHRDJ'  DBFILE           ***************
     C                     MOVELRKEY2     DBKEY            **DB ERROR 25**
     C                     MOVEA'1'       *IN,89           ***************
     C                     EXSR DBSR
     C                     END                             - E1
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PVALD     IFNE RVALD                      - B1
     C                     Z-ADDRVALD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     VALDO
     C                     Z-ADDRVALD     PVALD
     C                     END                             - E1
     C*
     C**  TRANSFER DATE MIDAS INTO DDMMMYY
     C*
     C           PPSTD     IFNE RPSTD                      - B1
     C                     Z-ADDRPSTD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     PSTDO
     C                     Z-ADDRPSTD     PPSTD
     C                     END                             - E1
     C*
     C**  PREPARE DEBIT RATE CHANGE TO OUTPUT
     C*
     C                     MOVE PSTDO     PSTDA
     C                     MOVE VALDO     VALDA
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,4     RNARR
     C*
     C**  OUTPUT DEBIT RATE CHANGE TO
     C*
     C                     EXSR RDRSR
     C*
      ** If CRE001 is switched ON, Output Additional Overdraft Rate       CRE001
      *                                                                   CRE001
     C           CRE001    IFEQ 'Y'                                       CRE001
     C                     EXSR CLMSG                                     CRE001
     C**********           MOVELNAR,35    ONARR                    CRE001 180892
     C                     MOVELNAR,37    ONARR                           180892
     C                     MOVE AODR      OAODR                           CRE001
     C                     EXSR OVERDC                                    CRE001
     C                     WRITEAODRDC                                    CRE001
     C                     ENDIF                                          CRE001
      *                                                                   CRE001
     C                     ENDSR                           **RATED ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** RATESR subroutine for debit and credit rate change
     C**
     C**     Called by       B O T H S R
     C**
     C**     Calls           RATEC,RATED
     C**
     C           RATESR    BEGSR                           **RATESR BEGSR*
     C*
     C                     Z-ADDDHISD     WWHISD
     C*
     C           DDRCI     IFEQ 'Y'                        - B1
     C           DRECI     ANDNE'B'
     C*
     C**  DEBIT RATE CHANGE
     C*
     C                     EXSR RATED
     C*
     C                     Z-ADDDHISD     WHISDD
     C*
     C                     END                             - E1
     C*
     C           DCRCI     IFEQ 'Y'                        - B1
     C           DRECI     ANDNE'B'
     C*
     C**  CREDIT RATE CHANGE
     C*
     C                     EXSR RATEC
     C*
     C                     Z-ADDDHISD     WHISDC
     C*
     C                     END                             - E1
     C*
     C           DDRCI     IFEQ *BLANKS                    - B1
     C           DCRCI     ANDEQ*BLANKS
     C*
     C           CDICT     IFLT 3                          - B2
     C                     Z-ADDDHISD     WHISDD
     C                     END                             - E2
     C*
     C           CCICT     IFLT 3                          - B2
     C                     Z-ADDDHISD     WHISDC
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C**  SAVE REHISL  AS PREVIOUS
     C*
     C                     Z-ADDDMNBL     WMNBL
     C                     Z-ADDDHISB     WHISB
     C                     MOVE DDRCB     WDRCB
     C                     Z-ADDDCRCB     WCRCB
     C                     Z-ADDDDAID     WDAID
     C                     Z-ADDDCAID     WCAID
     C*
     C*
     C           KLIST1    READEREHISL                   51
     C*
     C                     ENDSR                           **RATESR ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** RCRSR subroutine for credit rate output processing
     C**
     C**     Called by     RATEC
     C**
     C**     Calls         DBSR
     C**
     C           RCRSR     BEGSR                           **RCRSR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3765C024
     C                     EXSR OVERDC
     C*
     C           DCICT     IFEQ *ZEROS                     - B1
     C*
     C                     Z-ADDCRIR      RATE
     C*
     C**  OUTPUT RATE CHANGE
     C*
     C                     EXSR OVERDC
     C                     WRITERATEDC
     C*
     C                     ELSE                            - X1
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,12    RNARR
     C*
     C                     EXSR OVERDC
     C                     WRITERAT1DC
     C*
     C           INTH      IFGT *ZEROS                     - B2
     C                     Z-SUBINTH      HISB0
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,13    BNARR
     C*
     C                     ELSE                            - X2
     C                     Z-ADDINTH      HISB0
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,14    BNARR
     C*
     C                     END                             - E2
     C*
     C                     EXSR OVERDC
     C                     WRITERAT2DC
     C*
     C           RAT21     IFNE *ZEROS                     - B2
     C           BAL21     ORNE *ZEROS
     C                     Z-ADDRAT21     ORAT1
     C                     Z-ADDBAL21     OBAL01
     C                     ELSE                            - X2
     C                     Z-ADDCHISD     WDATE
     C                     Z-ADD26        DBASE            ***************
     C                     MOVE 'RATE '   DBFILE           **DB ERROR 26**
     C                     MOVELWDATE     DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E2
     C*
     C           RAT22     IFNE *ZEROS                     - B2
     C           BAL22     ORNE *ZEROS
     C                     Z-ADDRAT22     ORAT2
     C                     Z-ADDBAL22     OBAL02
     C           RAT23     IFNE *ZEROS                     - B3
     C           BAL23     ORNE *ZEROS
     C                     Z-ADDRAT23     ORAT3
     C                     Z-ADDBAL23     OBAL03
     C                     ELSE                            - X3
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL03
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     MOVE '1'       *IN85
     C                     MOVE '1'       *IN84
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    OBAL02
     C                     END                             - E2
     C*
     C                     EXSR OVERDC
     C                     WRITERAT3DC
     C                     EXSR OVERDC
     C                     WRITERAT4DC
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       *IN85
     C*
     C           RAT24     IFNE *ZEROS                     - B2
     C           BAL24     ORNE *ZEROS
     C           RATC24    IFNE *BLANKS
     C           BALC24    ORNE *BLANKS
     C                     Z-ADDRAT24     ORAT1
     C                     Z-ADDBAL24     OBAL01
     C           RAT25     IFNE *ZEROS                     - B3
     C           BAL25     ORNE *ZEROS
     C           RATC25    IFNE *BLANKS
     C           BALC25    ORNE *BLANKS
     C                     Z-ADDRAT25     ORAT2
     C                     Z-ADDBAL25     OBAL02
     C           RAT26     IFNE *ZEROS                     - B4
     C           BAL26     ORNE *ZEROS
     C                     Z-ADDRAT26     ORAT3
     C                     Z-ADDBAL26     OBAL03
     C                     ELSE                            - X4
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL03
     C                     END
     C                     END                             - E4
     C                     ELSE                            - X3
     C                     MOVE '1'       *IN84
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    OBAL02
     C                     END                             - E3
     C*
     C                     EXSR OVERDC
     C                     WRITERAT3DC
     C                     EXSR OVERDC
     C                     WRITERAT4DC
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       *IN85
     C*
     C           RAT31     IFNE *ZEROS                     - B3
     C           BAL31     ORNE *ZEROS
     C           RATC31    IFNE *BLANKS
     C           BALC31    ORNE *BLANKS
     C                     Z-ADDRAT31     ORAT1
     C                     Z-ADDBAL31     OBAL01
     C           RAT32     IFNE *ZEROS                     - B4
     C           BAL32     ORNE *ZEROS
     C           RATC32    IFNE *BLANKS
     C           BALC32    ORNE *BLANKS
     C                     Z-ADDRAT32     ORAT2
     C                     Z-ADDBAL32     OBAL02
     C           RAT33     IFNE *ZEROS                     - B5
     C           BAL33     ORNE *ZEROS
     C                     Z-ADDRAT33     ORAT3
     C                     Z-ADDBAL33     OBAL03
     C                     ELSE                            - X5
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL03
     C                     END                             - E5
     C                     END
     C                     ELSE                            - X4
     C                     MOVE '1'       *IN84
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    OBAL02
     C                     END                             - E4
     C*
     C                     EXSR OVERDC
     C                     WRITERAT3DC
     C                     EXSR OVERDC
     C                     WRITERAT4DC
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       *IN85
     C*
     C           RAT34     IFNE *ZEROS                     - B4
     C           BAL34     ORNE *ZEROS
     C           RATC34    IFNE *BLANKS
     C           BALC34    ORNE *BLANKS
     C                     Z-ADDRAT34     ORAT1
     C                     Z-ADDBAL34     OBAL01
     C           RAT35     IFNE *ZEROS                     - B5
     C           BAL35     ORNE *ZEROS
     C           RATC35    IFNE *BLANKS
     C           BALC35    ORNE *BLANKS
     C                     Z-ADDRAT35     ORAT2
     C                     Z-ADDBAL35     OBAL02
     C           RAT36     IFNE *ZEROS                     - B6
     C           BAL36     ORNE *ZEROS
     C                     Z-ADDRAT36     ORAT3
     C                     Z-ADDBAL36     OBAL03
     C                     ELSE                            - X6
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL03
     C                     END                             - E6
     C                     END
     C                     ELSE                            - X5
     C                     MOVE '1'       *IN84
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    OBAL02
     C                     END                             - E5
     C*
     C                     EXSR OVERDC
     C                     WRITERAT3DC
     C                     EXSR OVERDC
     C                     WRITERAT4DC
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       *IN85
     C*
     C                     END
     C*
     C                     END                             - E4
     C*
     C                     END
     C*
     C                     END                             - E3
     C*
     C                     END
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **RCRSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** RDRSR subroutine for debit rate output processing
     C**
     C**     Called by     RATED
     C**
     C**     Calls         DBSR
     C**
     C           RDRSR     BEGSR                           **RDRSR BEGSR**
     C*
     C/COPY WNCPYSRC,RE3765C025
     C                     EXSR OVERDC
     C*
     C           DDICT     IFEQ *ZEROS                     - B1
     C*
     C                     Z-ADDDRIR      RATE
     C*
     C**  OUTPUT RATE CHANGE
     C*
     C                     EXSR OVERDC
     C                     WRITERATEDC
     C*
     C                     ELSE                            - X1
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,11    RNARR
     C*
     C                     EXSR OVERDC
     C                     WRITERAT1DC
     C*
     C           INTH      IFGT *ZEROS                     - B2
     C                     Z-SUBINTH      HISB0
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,13    BNARR
     C*
     C                     ELSE                            - X2
     C                     Z-ADDINTH      HISB0
     C*
     C                     EXSR CLMSG
     C                     MOVELNAR,14    BNARR
     C*
     C                     END                             - E2
     C*
     C                     EXSR OVERDC
     C                     WRITERAT2DC
     C*
     C           RAT21     IFNE *ZEROS                     - B2
     C           BAL21     ORNE *ZEROS
     C                     Z-ADDRAT21     ORAT1
     C                     Z-ADDBAL21     OBAL01
     C                     ELSE                            - X2
     C                     Z-ADDCHISD     WDATE
     C                     Z-ADD27        DBASE            ***************
     C                     MOVE 'RATE '   DBFILE           **DB ERROR 27**
     C                     MOVELWDATE     DBKEY            ***************
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END                             - E2
     C*
     C           RAT22     IFNE *ZEROS                     - B2
     C           BAL22     ORNE *ZEROS
     C                     Z-ADDRAT22     ORAT2
     C                     Z-ADDBAL22     OBAL02
     C           RAT23     IFNE *ZEROS                     - B3
     C           BAL23     ORNE *ZEROS
     C                     Z-ADDRAT23     ORAT3
     C                     Z-ADDBAL23     OBAL03
     C                     ELSE                            - X3
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL03
     C                     END                             - E3
     C                     ELSE                            - X2
     C                     MOVE '1'       *IN84
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    OBAL02
     C                     END                             - E2
     C*
     C                     EXSR OVERDC
     C                     WRITERAT3DC
     C                     EXSR OVERDC
     C                     WRITERAT4DC
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       *IN85
     C*
     C           RAT24     IFNE *ZEROS                     - B2
     C           BAL24     ORNE *ZEROS
     C           RATC24    IFNE *BLANKS
     C           BALC24    ORNE *BLANKS
     C                     Z-ADDRAT24     ORAT1
     C                     Z-ADDBAL24     OBAL01
     C           RAT25     IFNE *ZEROS                     - B3
     C           BAL25     ORNE *ZEROS
     C           RATC25    IFNE *BLANKS
     C           BALC25    ORNE *BLANKS
     C                     Z-ADDRAT25     ORAT2
     C                     Z-ADDBAL25     OBAL02
     C           RAT26     IFNE *ZEROS                     - B4
     C           BAL26     ORNE *ZEROS
     C                     Z-ADDRAT26     ORAT3
     C                     Z-ADDBAL26     OBAL03
     C                     ELSE                            - X4
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL03
     C                     END                             - E4
     C                     END
     C                     ELSE                            - X3
     C                     MOVE '1'       *IN84
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    OBAL02
     C                     END                             - E3
     C*
     C                     EXSR OVERDC
     C                     WRITERAT3DC
     C                     EXSR OVERDC
     C                     WRITERAT4DC
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       *IN85
     C*
     C           RAT31     IFNE *ZEROS                     - B3
     C           BAL31     ORNE *ZEROS
     C           RATC31    IFNE *BLANKS
     C           BALC31    ORNE *BLANKS
     C                     Z-ADDRAT31     ORAT1
     C                     Z-ADDBAL31     OBAL01
     C           RAT32     IFNE *ZEROS                     - B4
     C           BAL32     ORNE *ZEROS
     C           RATC32    IFNE *BLANKS
     C           BALC32    ORNE *BLANKS
     C                     Z-ADDRAT32     ORAT2
     C                     Z-ADDBAL32     OBAL02
     C           RAT33     IFNE *ZEROS                     - B5
     C           BAL33     ORNE *ZEROS
     C                     Z-ADDRAT33     ORAT3
     C                     Z-ADDBAL33     OBAL03
     C                     ELSE                            - X5
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL03
     C                     END                             - E5
     C                     END
     C                     ELSE                            - X4
     C                     MOVE '1'       *IN84
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    OBAL02
     C                     END                             - E4
     C*
     C                     EXSR OVERDC
     C                     WRITERAT3DC
     C                     EXSR OVERDC
     C                     WRITERAT4DC
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       *IN85
     C*
     C           RAT34     IFNE *ZEROS                     - B4
     C           BAL34     ORNE *ZEROS
     C           RATC34    IFNE *BLANKS
     C           BALC34    ORNE *BLANKS
     C                     Z-ADDRAT34     ORAT1
     C                     Z-ADDBAL34     OBAL01
     C           RAT35     IFNE *ZEROS                     - B5
     C           BAL35     ORNE *ZEROS
     C           RATC35    IFNE *BLANKS
     C           BALC35    ORNE *BLANKS
     C                     Z-ADDRAT35     ORAT2
     C                     Z-ADDBAL35     OBAL02
     C           RAT36     IFNE *ZEROS                     - B6
     C           BAL36     ORNE *ZEROS
     C                     Z-ADDRAT36     ORAT3
     C                     Z-ADDBAL36     OBAL03
     C                     ELSE                            - X6
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT3
     C                     Z-ADD*ZEROS    OBAL03
     C                     END                             - E6
     C                     END
     C                     ELSE                            - X5
     C                     MOVE '1'       *IN84
     C                     MOVE '1'       *IN85
     C                     Z-ADD*ZEROS    ORAT2
     C                     Z-ADD*ZEROS    OBAL02
     C                     END                             - E5
     C*
     C                     EXSR OVERDC
     C                     WRITERAT3DC
     C                     EXSR OVERDC
     C                     WRITERAT4DC
     C                     MOVE '0'       *IN84
     C                     MOVE '0'       *IN85
     C*
     C                     END
     C*
     C                     END                             - E4
     C*
     C                     END
     C*
     C                     END                             - E3
     C*
     C                     END
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **RDRSR ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** TOTAL subroutine for total processing
     C**
     C**     Called by       S T A R T
     C**
     C**     Calls           -
     C**
     C           TOTAL     BEGSR                           **TOTAL BEGSR**
     C**
     C** SET UP FOR CONTROL REPORT
     C**
     C                     Z-ADDSFNUMU    ZSNUMU
     C                     OUT  LDA
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM *BLANK    SENTY   3
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU  60
     C                     PARM           ZSERR   1
     C           *LOCK     IN   LDA
     C*
     C           ZSERR     IFEQ 'Y'
     C** ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM
     C** DBASE, DBFILE AND DBKEY SET WITHIN ZSFILE
     C                     MOVEA'1'       *IN,89
     C                     EXSR DBSR
     C                     END
     C*
     C                     WRITETOTALS
     C*
     C                     ENDSR                           **TOTAL ENDSR**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** TOTSR subroutine for days total output for credit and debit
     C**
     C**     Called by       B O T H S R
     C**
     C**     Calls           ZICD, ITYPDR, ITYPCR
     C**
     C           TOTSR     BEGSR                           **TOTSR  BEGSR*
     C*
     C           CDICT     IFLT 3                          - B1
     C*
     C           DDRCI     IFEQ 'Y'                        - B2
     C*
     C                     Z-ADDWDRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B3
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X3
     C           *IN81     IFEQ '1'                        - B4
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X4
     C           *IN82     IFEQ '1'                        - B5
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X5
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E5
     C                     END                             - E4
     C                     END                             - E3
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B3
     C           DTHGAR    IFNE *ZERO                      - B4
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E4
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     ELSE                            - X1
     C*
     C                     EXSR ITYPDR
     C*
     C                     END                             - E1
     C*
     C           DCRCI     IFEQ 'Y'                        - B1
     C*
     C           CCICT     IFLT 3                          - B2
     C*
     C                     Z-ADDWCRCB     ZICALC
     C                     Z-ADDWWHISD    ZIBEG
     C                     Z-ADDDHISD     ZIEND
     C*
     C                     EXSR ZICD
     C*
     C                     Z-ADDZDAYN1    DAYS
     C                     Z-SUBWHISB     HISB0
     C*
     C           *IN80     IFEQ '1'                        - B3
     C           HISB0     MULT DAYS      NUMB0
     C                     ELSE                            - X3
     C           *IN81     IFEQ '1'                        - B4
     C           HISB1     MULT DAYS      NUMB0
     C                     ELSE                            - X4
     C           *IN82     IFEQ '1'                        - B5
     C           HISB2     MULT DAYS      NUMB0
     C                     ELSE                            - X5
     C           HISB3     MULT DAYS      NUMB0
     C                     END                             - E5
     C                     END                             - E4
     C                     END                             - E3
     C*
     C           NUMB0     IFLT *ZEROS
     C                     ADD  NUMB0     WWTND
     C                     ELSE
     C                     ADD  NUMB0     WWTNC
     C                     END
     C                     EXSR OVERDC
     C                     WRITESTOTDC
     C*
     C* CHARGE REPORT IF NECESSARY
     C*
     C           CCICI     IFNE *BLANK                     - B3
     C           DTHGAR    IFNE *ZERO                      - B4
     C           DTHGAN    ORNE *ZERO
     C                     Z-SUBDTHGAR    CHGR0
     C                     Z-SUBDTHGAN    CHGN0
     C                     WRITEPOSTCH
     C                     END                             - E4
     C                     END                             - E3
     C*
     C                     ELSE                            - X2
     C*
     C                     EXSR ITYPCR
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **TOTSR  ENDSR*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** CALBRT subroutine to calculate base rates tax
     C**
     C**     Called by       BOTHSR, CRSR
     C**
     C**     Calls           none
     C**
     C           CALBRT    BEGSR                           **CALBRT BEGSR*
     C*
     C** If BRT SAR installed
     C*
     C           S01383    IFEQ 'Y'                        B001
      *                                                                   130468
     C                     MOVE '0'       *IN22                           130468
     C*
     C** Access ACCNT to check if BRT liable
     C*
     C           KACCNT    CHAINACCNT                99
     C*
     C** Chain failure
     C*
     C           *IN99     IFEQ '1'                        B002***********
     C                     MOVEL'ACCNT'   DBFILE           **DB ERROR 28**
     C                     MOVELRKEY      DBKEY            ***************
     C                     Z-ADD28        DBASE
     C                     EXSR DBSR
     C                     END                             E002
     C**********           END                             E001           130468
      *                                                                   130468
      * Include CR interest adjustments when calculating BRT              130468
     C                     Z-ADDTINT0     TGINT0                          130468
     C           CCAIC     ADD  CSGACI    TINT0                           130468
     C*
     C** If BRT liable
     C*
     C           BRTCA     IFEQ 'L'                        B001
     C           BRTCA     OREQ 'P'
     C*
     C**    and credit interest to be paid
     C*
     C********** CALLSR    IFEQ 'B'                                       130468
     C********** CCAIC     ANDGT0                                         130468
     C********** CALLSR    ORNE 'B'                                       130468
     C********** TINT0     ANDLT0                                         130468
     C           TINT0     IFGT *ZERO                                     130468
     C*
     C** Process record with BRT applied
     C*
     C                     SETON                     22
     C*
     C** Apply new or old rate?
     C*
     C***********HISD      IFGE DEFF                       B003           104618
     C***********          Z-ADDBRTR      BRT1    75                      104618
     C***********          ELSE                            X003           104618
     C***********          Z-ADDPBRTR     BRT1    75                      104618
     C***********          END                             E003           104618
     C*                                                                   104618
     C* IF DATE IS BEFORE 'DEFF' ON SDBRTDPD - USE PREV BRT RATE          104618
     C* OTHERWISE - USE CURRENT BRT RATE.                                 104618
     C*                                                                   104618
     C           CCICI     IFEQ 'D'                                       104618
     C           CCICI     OREQ 'M'                                       104618
     C                     MOVE '1'       *IN30                           104618
     C                     ELSE                                           104618
     C                     MOVE '0'       *IN30                           104618
     C                     END                                            104618
     C*                                                                   104618
     C           LDAC      IFEQ 'Y'                                       104618
     C*                                                                   104618
     C           *IN30     IFEQ '1'                                       104618
     C           RUND      IFLE DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1    75                      104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C           CCICI     IFEQ 'C'                                       104618
     C           RUND      IFLT DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1                            104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C           *IN30     IFEQ '0'                                       104618
     C           CCICI     ANDNE'C'                                       104618
     C           NCID      IFLE DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1                            104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C                     ELSE                                           104618
     C*                                                                   104618
     C           *IN30     IFEQ '1'                                       104618
     C           CCICI     OREQ 'C'                                       104618
     C           RUND      IFLT DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1                            104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C           *IN30     IFEQ '0'                                       104618
     C           CCICI     ANDNE'C'                                       104618
     C           NCID      IFLT DEFF                                      104618
     C                     Z-ADDPBRTR     BRT1                            104618
     C                     ELSE                                           104618
     C                     Z-ADDBRTR      BRT1                            104618
     C                     END                                            104618
     C                     END                                            104618
     C*                                                                   104618
     C                     END                                            104618
     C*
     C           BRTCA     IFEQ 'L'
     C                     Z-ADDBRT1      WKBRT   75
     C                     ELSE
     C           BRT1      MULT 0.5       WKBRT
     C                     END
     C*
     C****Calculate*BRT total against accrued credit interest if          130468
     C******called*from SR/BRTOT, otherwise calculate against             130468
     C******total*interest                                                130468
     C*
     C********** CALLSR    IFEQ 'B'                                       130468
     C********** CCAIC     MULT WKBRT     BRTOT0                          130468
     C**********           ELSE                                           130468
     C           TINT0     MULT WKBRT     BRTOT0
     C**********           END                                            130468
     C*
     C           BRTOT0    DIV  100       BRTOT0    H
     C*
     C**********           Z-ADDTINT0     TGINT0                          130468
     C**********           SUB  BRTOT0    TINT0                           130468
     C                     END                             E002
     C*
     C                     END                             E001
      *                                                                   130468
     C                     Z-ADDTGINT0    TINT0                           130468
     C                     END                                            130468
     C*
     C           TINT0     COMP 0                    4948
     C                     ENDSR
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  CALEUT - Subroutine to calculate the EU Withholding Tax      *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
     C           CALEUT    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Check if the customer is actually a Joint A/c.                                       235917
      *                                                                                       235917
     C                     MOVELCCNUM     KJANO   6                                           235917
     C           KJANO     CHAINSDJACCL1             74                                       235917
      *                                                                                       235917
     C                     MOVE 'N'       WJACC   1                                           235917
     C           *IN53     IFEQ *OFF                                                          235917
     C                     MOVE 'Y'       WJACC                                               235917
     C                     ENDIF                                                              235917
      *                                                                                       235917
     C                     MOVE *ON       *IN21                                               CGL031
     C                     Z-ADD0         EUTAX0                                              CGL031
     C                     Z-ADD*ZEROS    STAX0                                               CER048
      *                                                                                       CGL031
     C                     MOVE 'G'       MODI                                                CGL031
     C                     MOVELCCNUM     P#NUM                                               CGL031
     C***********          MOVELCCNUM     KJOIN   60                                  235917 CSD027A
     C                     MOVELCCNUM     KJOIN   6                                          CSD027A
     C           WJACC     IFEQ 'Y'                                                           235917
     C           KLISTC    SETLLSDCSINLC                                                      235917
     C           KLISTC    READESDCSINLC                 53                                   235917
     C                     ELSE                                                               235917
     C           KLIST7    SETLLSDCSINL7                                                      CGL031
     C           KLIST7    READESDCSINL7                 53                                   CGL031
     C                     ENDIF                                                              235917
     C           *IN53     DOWEQ*OFF                                                          CGL031
     C           TSSTAT    IFEQ 'T'                                                           CGL031
      *                                                                                       CER048
      ** Accumulate Secondary Tax Amount in Original Currency                                 CER048
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
     C           STAX0     ADD  TSSTDO    STAX0                                               CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     ADD  TSTXSR    EUTAX0                                              CGL031
     C                     ENDIF                                                              CGL031
     C*                                                                                       235917
     C           WJACC     IFEQ 'Y'                                                           235917
     C           KLISTC    READESDCSINLC                 53                                   235917
     C                     ELSE                                                               235917
     C           KLIST7    READESDCSINL7                 53                                   CGL031
     C                     ENDIF                                                              235917
     C*                                                                                       235917
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
     C********************************************************************
     C**
     C**   SR. TO SET UP AN ARRAY OF CURRENCIES AND AN ARRAY OF
     C**   DECIMAL PLACES FOR THOSE CURRENCIES.
     C**
     C           CCYARR    BEGSR                           *** CCYARR  ***
     C**
     C**   SET OFF ERROR INDICATOR
     C                     SETOF                     99
     C**
     C**   SET ARRAY INDEX TO ZERO.
     C                     Z-ADD0         X       30
     C**
     C**   SET UP KEY FOR CURRENCY TABLE.
     C                     MOVE *BLANKS   W@CKEY  3
     C**
     C**   SET LOWER LIMIT AND READ CURRENCY TABLE HEADER.
     C           W@CKEY    SETLLSDCURRL0
     C**
     C**   LOOP TO READ CURRENCY DETAIL RECORDS.
     C           XLOOP     TAG                             ** XLOOP TAG **
     C                     READ SDCURRL0                 99
     C**
     C**   END IF ALL CURRENCY RECORDS PROCESSED
     C   99                GOTO XEND
     C**
     C**   INCREMENT ARRAY INDEX.
     C           X         ADD  1         X
     C**
     C**   MOVE DATA INTO ARRAYS.
     C                     MOVE A6CYCD    CCYA,X
     C                     MOVE A6NBDP    DPA,X
     C**
     C**   CHECK FOR FULL ARRAY.96 ON IF FULL.
     C           X         COMP 200                      96
     C**
     C**   GO TO READ NEXT RECORD.
     C  N96                GOTO XLOOP
     C**
     C           XEND      TAG                             ** XEND TAG  **
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C** ZICD subroutine to find number of days to calculate interest
     C**      according to calculation basis
     C**
     C**     Called by       BOTHSR, CRSR, DAYTSR, DRSR, ITYPCR,
     C**                     ITYPDR, TOTSR
     C**
     C**     Calls           DBSR
     C**
     C           ZICD      BEGSR                           **ZICD BEGSR**
     C*
     C* TO DETERMINE NUMBER OF DAYS INTEREST TO BE CALCULATED
     C*
     C           ZIEND     SUB  ZIBEG     ZDAYN1
     C*
     C* CHECK FOR INTEREST CALCULATION BASIS
     C*
     C           ZICALC    IFEQ 3                          - B1
     C           ZICALC    OREQ 0                                                             CER016
     C/COPY WNCPYSRC,RE3765C026
     C           ZIEND     IFGT ZIBEG                      - B2
     C*
     C** CALCULATING DATE FROM DAY NUMBER (BEGINNING DATE)
     C*
     C                     Z-ADDZIBEG     ZDAYNO
     C                     EXSR ZDATE2
     C*
     C                     Z-ADDZDATE     SRES
     C*
     C** CALCULATING DATE FROM DAY NUMBER (FINISHING DATE)
     C*
     C                     Z-ADDZIEND     ZDAYNO
     C                     EXSR ZDATE2
     C*
     C                     Z-ADDZDATE     FRES
     C*
     C** IN ORDER FOR THE FINISH YEAR TO BE LESS THAN THE START YEAR IF ZIEND
     C** IS GREATER THAN ZIBEG, THEN THE DATE ZIEND MUST BE IN A DIFFERENT
     C** CENTURY TO ZIBEG. IF SO ADD 100 YEARS TO IT.
     C*
     C           ZIFY      IFLT ZISY                       - B3
     C           ZIFY      ADD  100       ZIFY2   30
     C                     ELSE                            - X3
     C                     Z-ADDZIFY      ZIFY2
     C                     END                             - E3
     C*
     C                     Z-ADDZISY      ZISY2   30
     C*
     C** DETERMINE WHETHER START YEAR IS A LEAP YEAR AND IF START MONTH
     C** IS FEBRUARY  THEN CONSIDER LAST DAY OF FEBRUARY AS DATE 30ND. OF THE
     C*  MONTH
     C*
     C           ZICALC    IFEQ 3                                                             CER016
     C           ZICALC    OREQ 0                                                             CER016
     C           CER016    ANDEQ'N'                                                           CER016
      *                                                                                       CER016
     C           ZISM      IFEQ 2                          - B3
     C           ZISY2     ADD  1900      ZLYCHK  40
     C           ZLYCHK    DIV  4         ZLYCHK
     C                     MVR            ZLYREM  20
     C           ZLYREM    IFEQ 0                          - B4
     C           ZISD      IFEQ 29                         - B5
     C                     Z-ADD30        ZISD
     C                     END                             - E5
     C                     ELSE                            - X4
     C           ZISD      IFEQ 28                         - B5
     C                     Z-ADD30        ZISD
     C                     END                             - E5
     C                     END                             - E4
     C                     END                             - E3
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
     C*
     C           30        SUB  ZISD      ZID1
     C*
     C           ZID1      IFLT 0                          - B3
     C                     Z-ADD*ZEROS    ZID1
     C                     END                             - E3
     C*
     C           ZISM      IFEQ 12                         - B3
     C                     Z-ADD*ZEROS    ZISM
     C                     ADD  1         ZISY
     C                     ADD  1         ZISY2
     C                     END                             - E3
     C*
     C** DETERMINE WHETHER END YEAR IS A LEAP YEAR AND IF END MONTH IS FEBRUARY
     C*
     C           ZICALC    IFEQ 3                                                             CER016
     C           ZICALC    OREQ 0                                                             CER016
     C           CER016    ANDEQ'N'                                                           CER016
      *                                                                                       CER016
     C           ZIFM      IFEQ 2                          - B3
     C           ZIFY2     ADD  1900      ZLYCHK  40
     C           ZLYCHK    DIV  4         ZLYCHK
     C                     MVR            ZLYREM  20
     C           ZLYREM    IFEQ 0                          - B4
     C           ZIFD      IFEQ 29                         - B5
     C                     Z-ADD30        ZIFD
     C                     END                             - E5
     C                     ELSE                            - X4
     C           ZIFD      IFEQ 28                         - B5
     C                     Z-ADD30        ZIFD
     C                     END                             - E5
     C                     END                             - E4
     C                     END                             - E3
      *                                                                                       CER016
     C                     ENDIF                                                              CER016
     C*
     C           ZIFD      IFEQ 31                         - B3
     C                     ADD  30        ZID1
     C                     ELSE                            - X3
     C                     ADD  ZIFD      ZID1
     C                     END                             - E3
     C*
     C                     SUB  1         ZIFM
     C*
     C           ZISY      IFEQ ZIFY                       - B3
     C           ZIFM      SUB  ZISM      ZINOM   30
     C                     ELSE                            - X3
     C           12        SUB  ZISM      ZIM1
     C                     Z-ADD1         ZISM
     C*
     C** USE ENLARGE FIELDS THAT CAN HANDLE 1999 ONWARDS
     C*
     C                     ADD  1         ZISY2
     C           ZIFY2     SUB  ZISY2     ZIY1
     C           ZIY1      MULT 12        ZIM2    30
     C           ZIM2      ADD  ZIFM      ZIM2
     C           ZIM2      ADD  ZIM1      ZINOM
     C*
     C                     END                             - E3
     C*
     C           ZINOM     MULT 30        ZID2
     C           ZID2      ADD  ZID1      ZDAYN1
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C           ZICALC    IFEQ 4                          - B1
     C           ZICALC    OREQ 5
     C*
     C** ONE DAY IS SUBTRACTED FROM ZDAYN1 FOR EACH OCCURANCE OF 29 FEB IN THE
     C** THE INTEREST CALCULATION PERIOD INCLUSIVE OF ZIBEG AND ZIEND
     C*
     C** FIND NO OF FOUR YEAR PERIODS BETWEEN DATES
     C*
     C           ZDAYN1    DIV  1461      ZIMAN
     C                     MVR            ZIREM
     C*
     C** FIND NEXT 29 FEB DAY NO. ON OR AFTER ZIBEG.
     C*
     C           ZIBEG     SUB  60        ZIBW1
     C           ZIBW1     DIV  1461      ZIDW1
     C                     MVR            ZIDREM
     C*
     C           ZIDREM    IFEQ 0                          - B2
     C                     Z-ADDZIBEG     ZIDW2
     C                     END                             - E2
     C*
     C** ROUND UP RESULT
     C*
     C           ZIDW1     ADD  1         ZIDW2
     C*
     C** CALCULATE NEXT 29 FEB.
     C*
     C           ZIDW2     MULT 1461      ZIDW2
     C           ZIDW2     ADD  60        ZIDW2
     C*
     C** IF THIS NEXT 29 FEB. DAYNO - ZIBEG IS GREATER OR EQUAL TO ZIREM THEN
     C** ADD 1 TO ZIMAN.
     C*
     C           ZIDW2     SUB  ZIBEG     ZILPCP
     C*
     C           ZIREM     IFGE ZILPCP                     - B2
     C                     ADD  1         ZIMAN
     C                     END                             - E2
     C*
     C** SUBTRACT ZIMAN FROM ZDAYN1 TO GIVE VALUE OF ZDAYN1 REQUIRED FOR THIS
     C** INTEREST CALCULATION
     C*
     C           ZDAYN1    SUB  ZIMAN     ZDAYN1
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           **ZICD ENDSR**
     C********************************************************************
     C*
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS
     C*
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS
     C*
     C* CALLS: NOTHING
     C*
     C********************************************************************
     C*
     C           *PSSR     BEGSR                           ** *PSSR **
     C*
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
     C*
     C                     ENDSR                           ** *PSSR **
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO ZDEND2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C/COPY WNCPYSRC,RE3765C033
     C**
     C********************************************************************
**   CMD - COMMAND TO OVERIDE MESSAGE FILE
OVRMSGF MSGF(  REPTMSGF) TOMSGF(GBREPTMSGF)
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
