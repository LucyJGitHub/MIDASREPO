     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE GL transfer - cash in/out')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Retail Module                                        *
     F*                                                               *
     F*  RE4111 - GL Account Transfer - Cash In/Out                   *
     F*                                                               *
     F*  Function:  This program accepts and validates treasury to    *
     F*   (I/C)     teller till transactions of cash transfer and     *
     F*             updates the teller totals file with the           *
     F*             transaction totals.  A transaction confirmation   *
     F*             slip is generated during this transaction, as a   *
     F*             receipt for the customer.                         *
     F*                                                               *
     F*  Called By: Retail Teller System Menu                         *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. 218877             Date 23Sep15               *     
      *  Prev Amend No. MD042745           Date 20Nov16               *
      *                 CCG016             Date 13Sep16               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 253894 (BUG17971)  Date 28Apr08               *
      *                 BUG16738A          Date 04Apr08               *
      *                 BUG13078           Date 31Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 BUG8514            Date 14Jun06               *
      *                 CRT026             Date 22May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG8067            Date 05Sep05               *
      *                 BUG7819            Date 30Aug05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3855            Date 03Aug04               *
      *                 BUG2849            Date 06Jun04               *
      *                 CLE025             Date 20Oct03               *
      *                 CRE019             Date 12Mar04               *
      *                 CGL029             Date 01Sep03               *
      *                 CRT012             Date 26Nov02               *
      * Midas Release 4.01 -------------------------------------------*
     F*                 CRT007             Date 14Jan02
      *                 CRT005             Date 27Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 194978             Date 28Jun01               *
      *                 CRT006             Date 17Apr01               *
      *                 190137             Date 18Apr01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 184553             Date 05Oct00               *
     F*                 180663             Date 05Oct00               *
      * Midas DBA 3.03 -----------------------------------------------*
     F*                 140770             Date 14Aug00               *
     F*                 169719             Date 14Aug00               *
     F*                 179321             Date 26May00               *
     F*                 176443             Date 18Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
     F*                 142092             Date 12NOV98               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130543             Date 13FEB98               *
     F*                 104034 (060910)    DATE 22JUL96               *
     F*                 104270             DATE 17SEP97               *
     F*                 120880             DATE 06AUG97               *
     F*                 114621             DATE 21FEB97               *
     F*                 CRT002             DATE 01DEC95               *
     F*                 098801             DATE 14JUN96               *
     F*                 S01408             DATE 14FEB96               *
     F*                 S01408             DATE 12FEB96               *
     F*                 093545             DATE  8SEP95               *
     F*                 091241             DATE 17JUL95               *
     F*                 CRT001  *CREATE    DATE 28FEB95               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  218877 - Recompiled due to changes in RTCCYSC1               *
      *         - Applied for MD-28376                                *     
      *  MD042745 - Travellers Cheque Number is 12 char long.         *
      *  CCG016 - Correspondence Manager for Retail Teller System.    *
      *  253894 - Recompiled due to changes in display file RE4111DF  *
      *  BUG16738A- Error with Selling travellers cqs if Issuer is an *
      *             Alphanumeric Customer. Recompile due to changes in*
      *             RBSLTCC1                                          *
      *  BUG13078 - DBERRCTL-Database error control (Recompile)       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG8514 - Issue regarding teller overrides(Recompile)        *
      *  CRT026 - Retail Teller Password Change                       *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG8067 - Add Transaction Time (Recompile)                   *
      *  BUG7819 - If a retail account has insufficient funds,        *
      *            the system simply drop a Cash Withdrawal           *
      *            (non-account currency) transaction                 *
      *            Recompiled due to changes in the dspf RE4111DF     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  Bug3855 - Incorrect field definitions by CRT002              *
      *  BUG2849 - CRE019 amendments for Cashier Interface (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CRE019 - Cheque Processing and Maintenance (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CRT012 - Recompile over changed TTRANPD                      *
     F*  CRT007 - Cashier Branch Offline Checking                     *
     F*  CRT005 - Recompiled due to changes in RTTWIDC1               *
      *  194978 - Recompiled due to changes in RTTWIDC1.              *
      *  CRT006 - Cashier Reserve Transactions.                       *
     F*  190137 - Addition of further warning messages                *
     F*  184553 - Further processing to ensure that travellers        *
     F*           cheques can be sold more than one at a time.        *
     F*  180663 - Travellers cheques can only be sold one at a time   *
     F*           in cashier.  Process a range of cheques copied in   *
     F*           RBSLTCF1 and RBSLTCC1.  All cheques must be in the  *
     F*           same denomination.  New file RETCRCL2.              *
     F*           Fix patterned after 134981.                         *
     F*  140770 - When selling a trav. cheque, the cheque number was  *
     F*           not found due to wrong no. of dec. places used.     *
     F*  169719 - Amended to perform checking for Cash-In/Cash-Out    *
     F*           so that beyond teller Cash/Non-Cash limit,          *
     F*           transaction will not be accepted. Partially applied *
     F*           105809.                                             *
     F*  179321 - Addition of extra warning messages, includes        *
     F*           fix number 164475.                                  *
     F*  176443 - Avoid MCH3601 to be sent.                           *
     F*           Pass correct parameter to AOCUSTR0.                 *
     F*  142092 - Cannot get full description of errors appearing on  *
     F*           teller screen in Cashier.                           *
     F*  130543 - Changed the array index for teller processing from  *
     F*           @I (2,0) to @J (3,0).  /COPY RBLDTLC1 and RBLDTLE1  *
     F*           were likewise amended.                              *
     F*  104034 - NO TELLER LIMIT CHECK ON GL CASH IN/OUT (060910-upg)*
     F*           ADD 062979 FOR PREVENTATIVE MAINTENANCE.            *
     F*           062979 -ADVICES INCORRECT FOR CCYS WITH 0 DEC PLACES*
     F*  104270 - Recompile due to changes to /COPYs RT*.             *
     F*  120880 - Store and Forward Function.                         *
     F*  114621 - Replace blank with 'X' to mean not to validate      *
     F*           condition.                                          *
     F*  CRT002 - Retail Branch Access.                               *
     F*  098801 - If Cash in/Cash out done for an account where there *
     F*           is an account with the same CNUM/CCY/ADOD/ACSQ in   *
     F*           another branch, pgm will pick up the first one - if *
     F*           this doesn't have the correct branch, transaction   *
     F*           fails. Fix is to add branch code to KLACNT keylist. *
     F*  S01408 - Addition of core hook RE41111OOP1                   *
     F*  S01408 - Addition of core hook RE41111FFP1                   *
     F*           Addition of core hook RE41111EEP1                   *
     F*           Addition of core hook RE41111CCP1                   *
     F*           Addition of core hook RE41111CCP2                   *
     F*           Addition of core hook RE41111CCP3                   *
     F*  093545 - Recompile due to changes in PRTF/RE4111P1 --        *
     F*           standardize pagesize.                               *
     F*  091241 - ATM Interface.  Recompiled.                         *
     F*  CRT001 - Retail Teller System.                               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N   P A R A M E T E R S                        *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     FACCNT   IF  E           K        DISK
     F**  Account master
     F*
     FTTRNT   UF  E           K        DISK         KINFSR *PSSR
     F**  Teller Trans. Control file
     F                                              KCOMIT
     F*
     F***TTRANPD*O   E                    DISK         KINFSR *PSSR       CRT002
     FTTRANPD O   E                    DISK         KINFSR *PSSR      UC  CRT002
     F**  Teller Trans. Details file
     F                                              KCOMIT
     F*
     F***TTRANPT*UF  E                    DISK         KINFSR *PSSR       CRT002
     FTTRANPT UF  E                    DISK         KINFSR *PSSR      UC  CRT002
     F**  Teller Trans. Trailer file
     F                                              KCOMIT
     F*
     F***RE4111DFCF  E                    WORKSTN      KINFSR *PSSR       CRT002
     FRE4111DFCF  E                    WORKSTN      KINFSR *PSSR      UC  CRT002
     F**  Display file - General ledger account transfers
     F*
     FTTNARPD O   E                    DISK         KINFSR *PSSR
     F**  Teller transfer/cross narratives files
     F                                              KCOMIT
     F*
     FRE4111P1O   E                    PRINTER                        UC
     F**  Spool file for ADVICES
     F*
     F/COPY ZSRSRC,RBWLOGF1                                               CRT002
     F*                                                                   CRT002
     F/COPY ZSRSRC,RBLDTLF1                                               CRT002
     F*                                                                   CRT002
     F/COPY ZSRSRC,RBSLTCF1                                               CRT002
     F**  Travellers Cheque Register Control and Detail                   CRT002
     F*                                                                   CRT002
     F/COPY ZSRSRC,RTCCYSF1                                               104043
     F*                                                                   104043
     F*
     F/COPY WNCPYSRC,RE4111FFP1
     F*
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F*                                                               *
     F*     F U N C T I O N   O F   I N D I C A T O R S               *
     F*                                                               *
     F*      KC          Exit Program                                 *
     F*      KE          Refresh Screen                               *
     F*                                                               *
     F*      01          Help                                         *
     F*                                                               *
     F*      09          Cash Out                                     *
     F*     N09          Cash In                                      *
     F*      10          Message Subfile End Indicator (SFLEND)       *
     F*                                                               *
     F*      11          Error in SCCY  -Currency code or             *
     F*                           SOVTI -Override teller-id           *
     F*      12          Error in SDCUS - Debit customer number or    *
     F*                           SOVPC - Override teller passcode    *
     F*      13          Error in SDAC  - Debit a/c code              *
     F*      14          Error in SDSEQ - Debit a/c seq               *
     F*      15          Error in SAMT  - Amount                      *
     F*      16          Error in SCCUS - Credit customer number      *
     F*      17          Error in SCAC  - Credit a/c code             *
     F*      18          Error in SCSEQ - Credit a/c seq              *
     F*      19          Error in SDEPC - Department code             *
     F*                                                               *
     F*      20          Terminal errors found                        *
     F*      21          Override prompt required                     *
     F*      22          Currency selected                            *
     F*      23          Display override user id / password          *                       CRT026
     F*      24          Condition display of trans.comp.successfully *
     F*      26          Error in SNARR - Narrative                   *
     F*      27          Allow default account to be retail           *
     F*                                                               *
     F*      30          Error in debit a/c no.                       *
     F*      31          Error in credit a/c no.                      *
     F*      35          GENERAL LEDGER CASH IN                       *
     F*      36          GENERAL LEDGER CASH OUT                      *
     F*      40          Buying Travellers Cheque in Cash Ccy         *   CRT002
     F*      41          Selling Travellers Cheque in Cash Ccy        *   CRT002
     F*      45          '?' present in chq issuer no field           *   CRT002
     F*      46          Error in cheque issuer no                    *   CRT002
     F*      47          Error in cheque serial no                    *   CRT002
     F*      48          Error in buyer's id type                     *   CRT002
     F*      49          Error in travellers chq amt                  *   CRT002
     F*                                                               *
     F*      50          Invalid input indicator                      *
     F*      51          Error in override validation                 *
     F*      52          Error in override details validation         *
     F*      53          Error in cheque amount                       *   180663
     F*      54          Error in cheque book status                  *   180663
     F*      66          Error indicator for cust.cd in a/c no.       *
     F*      67          Error indicator for a/c code in a/c no.      *
     F*      68          Error in a/c no.                             *
     F*      69          General error indicator                      *
     F*                                                               *
     F*      70          General Indicator Used For CHAIN             *
     F*                                                               *
     F*   U7-U8          Set on if database error occurs              *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  DBERR  - Database Error Handling                             *
     F*  DSPFMT - Display screen formats                              *
     F*  FIRST  - Initial Processing                                  *
     F*  IFLDS  - Initialize screen/work fields                       *
     F*  INT01  - Initialise error indicators                         *
     F*  LAST   - Final processing - terminate pgm.                   *
     F*  MAIN   - Control Process                                     *
     F*  MOVDTL - Move details to send to outgoing dataQ              *   CRT002
     F*  PCMTXT - Prepare comit text                                  *
     F*  RFRESH - Refresh screen                                      *
     F*  SCRINP - Detail screen input                                 *
     F*  SETDSP - Set indicators for display                          *
     F*  SNDMSG - Send program message parameters                     *
     F*  TRNOVR - Transaction override process                        *
     F*  UPDRTN - Control rtn. for updates                            *
     F*  UPTRL  - Update Control Trailer Record                       *
     F*  UPDTCC - Update travellers cheque control                    *   CRT002
     F*  VALAMT - Validate amount                                     *
     F*  VALACC - Validate a/c number                                 *
     F*  VALCCY - Validate Currency                                   *
     F*  VALDET - Validate Details                                    *
     F*  VALFMT - Validate input formats                              *
     F*  VALOVR - Validate override conditions                        *
     F*  VOVDET - Validate override details                           *
     F*  WRTLPD - Write SDTELDPD Record                               *
     F*  WRTTCD - Write travellers cheque detail                      *   CRT002
     F*  ZA0150 - Get Midas Rundate & Setup Indicator                 *
     F*  *PSSR  - Program error                                       *
     F*                                                               *
     F*                                                               *
     F*  Standard RTS Subroutines                                     *
     F*                                                               *
     F*  RDQMS  - Receive dataqueue message                           *   CRT002
     F*  RTVMSG - Retrieve message from Message file                  *   CRT002
     F*  SDQMS  - Send dataqueue messages                             *   CRT002
     F*  WRLOG  - Update corresponding record in log file             *   CRT002
     F*  VALCQS - Validate cheque serial no                           *   CRT002
     F*  RTACLG - Account closing Check                               *
     F*  RTTCCY - Teller currency conditions check                    *
     F*  RTTOTS - Teller total updates                                *
     F*  RTTWID - Teller workstation conditions check                 *
     F*  RTENCP - Encript passcode                                    *
     F*  RTTLMT - Teller limit check                                  *   104034
     F*                                                               *
     F*                                                               *
     F*  Standard MIDAS Subroutines                                   *
     F*                                                               *
     F*  ZALIGN - Validate amount fields                              *
     F*  ZFRPED - Format and edit amount field                        *
     F*  ZTNLU1 - Access dataarea for next transaction no.            *
     F*                                                               *
     F*                                                               *
     F*  External Routines                                            *
     F*                                                               *
     F*  SCC0250- Clear Message Queue                                 *
     F*  SCC0240- Send Message to program queue                       *
     F*                                                               *
     F*  DBERRCTL Program error                                       *
     F*                                                               *
     F*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E*
     E/COPY WNCPYSRC,RE4111EEP1
     E*
     E/COPY ZSRSRC,RTXXXXE1
     E**  Array for SR.RTBKDR, SR.RTBKCR, SR.RTRFDR, SR.RTRFCR, SR.RTIACT
     E*
     E/COPY ZSRSRC,ZALIGNZ1
     E**  Array for both SR.ZALIGN AND SR.ZEDIT
     E*
     E/COPY ZSRSRC,ZFRPEDZ1
     E**  Array for SR.ZFRPED
     E*
     E                    @CY        24  3
     E**  Teller currencies array
     E*
     E/COPY ZSRSRC,RTENCPE1
     E**  Array for SR.RTENCP
      /COPY ZSRSRC,RTCCYSE1                                               104034
      ** Array for SR.RTCCYS                                              104034
      *                                                                   104034
     E*
     E                    @TXT    1   4 80               Text strings     CRT002
      *                                                                   CRT002
     E                    INP         6  1                                CRT002
      **  Array for cust no                                               CRT002
      *                                                                   CRT002
     E                    @CA        20  1                                CRT002
      **  Cheque presented array                                          CRT002
      *                                                                   CRT002
     E/COPY ZSRSRC,RBMODTE1                                               CRT002
      **  Array for SR.MOVDET                                             CRT002
      *                                                                   CRT002
     E/COPY ZSRSRC,RBLDTLE1                                               CRT002
      **  Array for SR.LODTLR                                             CRT002
      *                                                                   CRT002
      *****************************************************************
     I/EJECT
     I*****************************************************************
     I*
     ITTRNTM2F
     I**  Renamed fields in PF/TTRNTM2
     I              NATN                            TTNATN
     I*
     ITTRANPTF
     I**  Renamed fields in PF/TTRANPT
     I              TBTN                            TRTBTN
     I*
     I*
     I            DS                              5
     I**  Data structure to hold key fields of LF/TTRNT
     I                                        1   5 @TTRNT
     I                                        1   1 KTBRI
     I                                        2   4 KTBID
     I                                        5   5 KRCTP
     I*
     I**********  DS                             15                                           CGL029
     I            DS                             21                                           CGL029
     I**  Data structure to define debit a/c no
     I**********                              1  15 @DACNO                                    CGL029
     I                                        1  21 @DACNO                                    CGL029
     I                                        1   6 SDCUS
     I                                        7   9 @DCUR
     I**********                             10  13 SDAC                                      CGL029
     I**********                             14  15 SDSEQ                                     CGL029
     I                                       10  19 SDAC                                      CGL029
     I                                       20  21 SDSEQ                                     CGL029
     I*
     I**********  DS                             15                                           CGL029
     I            DS                             21                                           CGL029
     I**  Data structure to define credit a/c no
     I**********                              1  15 @CACNO                                    CGL029
     I                                        1  21 @CACNO                                    CGL029
     I                                        1   6 SCCUS
     I                                        7   9 @CCUR
     I**********                             10  13 SCAC                                      CGL029
     I**********                             14  15 SCSEQ                                     CGL029
     I                                       10  19 SCAC                                      CGL029
     I                                       20  21 SCSEQ                                     CGL029
     I*
     I            DS                             72
     I**  Data structure to redefine currency array
     I                                        1  72 CCYR1
     I                                        1  72 @CY
     I*
     I            DS                                                      CRT002
      ** Data structure to hold string constants for QCMDEXC              CRT002
      *                                                                   CRT002
     I                                        1  80 @CMD                  CRT002
     I                                       30  30 @BRI                  CRT002
     I                                       31  33 @BID                  CRT002
      *                                                                   CRT002
     I            DS                                                      CRT002
      ** Data structure to hold string constants for QCMDEXC              CRT002
      *                                                                   CRT002
     I                                        1  80 @CMDT                 CRT002
     I                                       30  30 @BRIT                 CRT002
     I                                       31  33 @BIDT                 CRT002
      *                                                                   CRT002
     I            DS                                                      CRT002
      *                                                                   CRT002
      ** Traveller's Cheques Processing                                   CRT002
     I**    Narrative Line 2 positions 1 - 6 :  issuer number             CRT002
     I**                               7 - 26:  buyer's name              CRT002
     I**                              27 - 28:  buyer's ID type           CRT002
      *                                                                   CRT002
     I                                        1  35 @RANR2                CRT002
     I                                        1   6 @SCIN                 CRT002
     I                                        7  26 @SBNM                 CRT002
     I                                       27  28 @SBIT                 CRT002
      *                                                                   CRT002
     I            DS                                                      CRT002
      *                                                                   CRT002
      ** Traveller's Cheques Processing                                   CRT002
     I**    Narrative Line 3 positions 1 - 12:  serial number             CRT002
     I**                              13 - 32:  buyer's ID number         CRT002
      *                                                                   CRT002
     I                                        1  35 @RANR3                CRT002
     I                                        1  12 @SCSN                 CRT002
     I                                       13  32 @SBIN                 CRT002
      *                                                                   CRT002
     I            DS                              6                       CRT002
      **  Data structure to redefine chq issuer no field                  CRT002
      *                                                                   CRT002
     I                                        1   6 SCIN                  CRT002
     I                                        1   6 INP                   CRT002
      *                                                                   CRT002
     I/COPY ZSRSRC,RBOITMI1                                               CRT002
      *                                                                   CRT002
     I/COPY ZSRSRC,RBWLOGI1                                               CRT002
      *                                                                   CRT002
     I/COPY ZSRSRC,RBMODTI1                                               CRT002
      *                                                                   CRT002
     I/COPY ZSRSRC,RBLDTLI1                                               CRT002
      *                                                                   CRT002
     I/COPY ZSRSRC,RBSLTCI1                                               CRT002
      **  Data structure for trav chq amt's decimal and integer values    CRT002
      *                                                                   CRT002
     I/COPY ZSRSRC,RTTOTSI1
     I**  Multiple occurrence data structures for SR.RTTOTS
     I*
     I/COPY WNCPYSRC,RE4111I002
     I/COPY ZSRSRC,RTXXXXI2
     I** Data structure for 15 character account number
     I*
     I/COPY ZSRSRC,ZFRPEDZ2
     I** Data structure for SR.ZFRPED
     I*
     I*
     I@@NARR      DS                             30
     I**  Data structure to setup narrative for file
     I                                        1   50@@TBTN
     I                                        6   6 @@SLSH
     I                                        7   9 @@TBID
     I                                       10  10 @@UNDS
     I                                       11  30 SNARR
     I*
     I@AMTDS      DS                             16
     I**  Data structure to hold amount(SAMT) returned by zalign
     I                                        1  14 @SAMT
     I*
     I***CMTTXT*     DS                             81                                        CGL029
     I***CMTTXT*     DS                            101                                 CGL029 CRT026
     ICMTTXT      DS                            121                                           CRT026
     I**  Comit text
     I                                        1   50@NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  34 USRIDX
     I                                       35  37 @CMCCY
     I                                       38  43 @DCUS
     I**********                             44  47 @DAC                                      CGL029
     I                                       44  47 @DACQQ                                    CGL029
     I                                       48  49 @DSEQ
     I                                       50  63 SAMT
     I                                       64  69 @CCUS
     I**********                             70  73 @CAC                                      CGL029
     I                                       70  73 @CACQQ                                    CGL029
     I                                       74  75 @CSEQ
     I                                       76  78 SDEPC
     I                                       79  81 SOVTI
     I                                       82  91 @DAC                                      CGL029
     I                                       92 101 @CAC                                      CGL029
     I                                      102 111 SOVUR                                     CRT026
     I                                      112 121 SOVPW                                     CRT026
      *                                                                   CRT002
     ITTIME       DS                             12                       CRT002
      *                                                                   CRT002
     I                                        1   2 WTHR                  CRT002
     I                                        3   4 WTMN                  CRT002
     I                                        5   6 WTSS                  CRT002
     I                                        1   60WTIME                 CRT002
      *                                                                   CRT002
     I                                        7   8 WDT1                  CRT002
     I                                        9  10 WDT2                  CRT002
     I                                       11  12 WDT3                  CRT002
     I                                        7  120WDATE                 CRT002
      *                                                                   CRT002
     I                                        1  120WTMDS                 CRT002
     I*
     IPSDS       SDS
     I**  Program Status Data Structure
     I*
     I                                        1  10 @PGM
     I**  Field containing Program name
     I                                      244 253 @JOB
     I**  Field containing Workstation ID
     I                                      254 263 @USER
     I**  Field Containing User ID
     I*
     ILDA         DS                            256
     I**  Local data area for data base errors.
     I                                        1   3 ERTLID
     I                                       11  20 ERTWID
     I                                       21  30 ERWSID
     I*
     I**  Field combining the following fields
     I                                      134 177 DBLOT
     I**  Name of database file in error
     I                                      134 141 DBFILE
     I**  Key value causing database error
     I                                      142 170 DBKEY
     I**  Name of program causing database error
     I                                      171 180 DBPGM
     I**  Number of database error
     I                                      181 1830DBASE
     I*
     IRTSDTA     UDS                            256
     I**  Job dataarea data structure
     I                                        1   3 PTLID
     I                                        4   6 PTLBC
     I                                        7   7 PSPVI
     I                                        8  32 POVIN
     I                                    P  33  390PCHTL
     I                                    P  40  460PNCTL
     I                                       47  76 PTLNM
     I                                       77  800PTLMG
     I                                       81  840PTLSL
     I                                       85  890PTLTO
     I                                       90  92 PDEPC
     I*
     II#PARM      DS                           1024                                           CCG016
      ** Passed fields                                                                        CCG016
      **  Classification                                                                      CCG016
     I                                        1   3 I#BRCT                                    CCG016
     I                                        4   6 I#TLID                                    CCG016
     I                                        7   9 I#TBID                                    CCG016
     I                                       10  14 I#TBTN                                    CCG016
     I                                       15  17 I#FUNC                                    CCG016
     I                                       18  18 I#CLOS                                    CCG016
     I**********                             19  28 I#CHQN                           CCG016 MD042745
     I                                       19  30 I#CHQN                                  MD042745
      **  Accounts single, dr and cr                                                          CCG016
     I                                       41  46 I#CNUM                                    CCG016
     I                                       47  49 I#CCY                                     CCG016
     I                                       50  59 I#ACOD                                    CCG016
     I                                       60  61 I#ACSQ                                    CCG016
     I                                       62  64 I#BRCA                                    CCG016
     I                                       41  64 I#GLAR                                    CCG016
     I                                       65  74 I#ACNO                                    CCG016
     I                                       77  82 I#CNU1                                    CCG016
     I                                       83  85 I#CCY1                                    CCG016
     I                                       86  89 I#ACO1                                    CCG016
     I                                       90  91 I#ACS1                                    CCG016
     I                                       92  94 I#BRC1                                    CCG016
     I                                       77  94 I#GLA1                                    CCG016
     I                                       95 104 I#ACN1                                    CCG016
     I                                      107 112 I#CNU2                                    CCG016
     I                                      113 115 I#CCY2                                    CCG016
     I                                      116 119 I#ACO2                                    CCG016
     I                                      120 121 I#ACS2                                    CCG016
     I                                      122 124 I#BRC2                                    CCG016
     I                                      107 124 I#GLA2                                    CCG016
     I                                      125 134 I#ACN2                                    CCG016
      **  Transaction dets                                                                    CCG016
     I                                    P 137 1440I#AMNT                                    CCG016
     I                                      145 147 I#CCYT                                    CCG016
     I                                      148 198 I#NARR                                    CCG016
     I                                    P 199 2060I#CHQA                                    CCG016
     I                                    P 207 2138I#EXRT                                    CCG016
     I                                    P 217 2240I#BUYA                                    CCG016
     I                                      225 227 I#BUYC                                    CCG016
     I                                    P 228 2350I#SELA                                    CCG016
     I                                      236 238 I#SELC                                    CCG016
     I                                      239 288 I#NAR1                                    CCG016
     I                                      289 338 I#NAR2                                    CCG016
     I                                    P 347 3540I#INTA                                    CCG016
     I                                      355 357 I#INTC                                    CCG016
     I                                      358 407 I#INTN                                    CCG016
     I                                    P 417 4240I#TAXA                                    CCG016
     I                                      425 427 I#TAXC                                    CCG016
     I                                      428 477 I#TAXN                                    CCG016
     I                                    P 487 4940I#CHGA                                    CCG016
     I                                      495 497 I#CHGC                                    CCG016
     I                                      498 557 I#CHGN                                    CCG016
     I                                    P 567 5740I#TOTA                                    CCG016
     I                                      575 577 I#TOTC                                    CCG016
     I                                      578 627 I#TOTN                                    CCG016
     IO#PARM      DS                            256                                           CCG016
     I                                        1  10 O#ITEM                                    CCG016
     I                                       11  20 O#CUST                                    CCG016
     I                                       21  25 O#RSEQ                                    CCG016
     I                                       26  26 O#RLVL                                    CCG016
     I                                       27  29 O#RBCH                                    CCG016
     I                                       30  30 O#RARC                                    CCG016
      *                                                                                       CCG016
     I/COPY ZSRSRC,RTXXXXI1
     I** Data structure to positions of validation indicators
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     I** Data structure to update last transaction number
     I*
     I*
     ISDBANK    E DSSDBANKPD
     I**  Midas Bank details
     I*
     ISDCURR    E DSSDCURRPD
     I**  Midas Currency details
     I*
     ISDBRCH    E DSSDBRCHPD
     I**  Midas Branch details
     I*
     ISDDEPT    E DSSDDEPTPD
     I**  Midas Department details
     I*
     ISDRETR    E DSSDRETRPD
     I**  Midas Retail Transaction details
     I*
     ISDFNCD    E DSSDFNCDPD
     I**  Midas Function Code details
     I*
     ISDTELD    E DSSDTELDPD
     I**  Midas Teller ID details
     I*
     I*SDGELR    E DSSDGELRPD
     I**  Midas General Ledger Details
     I*
     ISDCUST    E DSSDCUSTPD                                              CRT002
     I              QQDFAC                          QQDFC1                                    CGL029
     I**  Midas Customer details                                          CRT002
     I*                                                                   CRT002
     IDSSDY     E DSDSSDY
     I**  Long data structure
     I*
     IDSFDY     E DSDSFDY
     I**  Short data structure
     I/COPY WNCPYSRC,RE4111I001
     I*
     ISCSARD    E DSSCSARDPD                                              104034
     I** Switchable SARs                                                  104034
     I*                                                                   104034
     IMUSER     E DSMUSERDD                                                                   CRT026
     I** External data structure for User Details                                             CRT026
     I** Renamed fields in PF/MUSERDD                                                         CRT026
     I              LCD                             LCDU                                      CRT026
     I*
     I*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*            MAIN   - Control Process                           *
     C*                                                               *
     C* CALLS      FIRST  - Initial Processing                        *
     C*            LAST   - Final processing - terminate pgm.         *
     C*            SCRINP - Detail screen input                       *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C*****************************************************************
     C*
     C**  Initial processing
     C*
     C                     EXSR FIRST
     C*
     C**  Do while cmd/3 is not pressed
     C*
     C           *INKC     DOWEQ'0'
     C*
     C**  Perform detail screen input
     C*
     C                     EXSR SCRINP
     C*
     C                     END
     C*
     C**  Final Processing
     C*
     C                     EXSR LAST
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*            SCRINP - Detail screen input                       *
     C*                                                               *
     C* CALLS      DSPFMT - Display screen formats                    *
     C*            LAST   - Final processing - terminate pgm.         *
     C*            RFRESH - Refresh screen                            *
     C*            UPDRTN - Control rtn. for updates                  *
     C*            VALFMT - Validate input formats                    *
     C*                                                               *
     C* CALLED BY  MAIN   - Control Process                           *
     C*                                                               *
     C*****************************************************************
     C           SCRINP    BEGSR                           ** SCRINP **
     C*
     C**  Do while input not valid
     C*
     C           *IN50     DOWEQ'1'
     C*
     C**  Display appropriate screen format
     C*
     C                     EXSR DSPFMT
     C*
     C**  Process the input depending on the key pressed
     C*
     C**  If cmd/3 is pressed - terminate the program
     C*
     C           *INKC     CASEQ'1'       LAST
     C*
     C**  If cmd/5 is pressed - refresh the screen & redisplay appr.scrn
     C*
     C           *INKE     CASEQ'1'       RFRESH
     C*
     C**  If enter key is pressed - validate the screen input
     C                     CAS            VALFMT
     C*
     C                     ENDCS
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           *IN50     ANDEQ'1'                                       CRT002
     C                     MOVE '1'       *IN20                           CRT002
     C                     LEAVE                                          CRT002
     C                     ENDIF                                          CRT002
     C*
     C                     ENDDO
     C*
     C**  If no terminal errors, perform transaction update
     C*
     C           *IN20     IFEQ '0'
     C                     EXSR UPDRTN
     C*
     C**  Seton indicator for transaction completed text
     C*
     C                     SETON                     24
     C*
     C                     END
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
      *                                                                   CRT002
     C                     EXSR MOVDTL                                    CRT002
      *                                                                   CRT002
     C                     MOVELREPOIO    P@QDS                           CRT002
     C                     EXSR SDQMS                                     CRT002
     C                     EXSR DQERR                                     CRT002
      *                                                                   CRT002
     C                     MOVE RACMSQ    WCMSQ                           CRT002
     C                     MOVELRABRNM    WBRCA                           CRT002
     C                     MOVELRAUSID    WUSID                           CRT002
     C                     MOVELREPOIO    WCMSG                           CRT002
     C                     EXSR WRLOG                                     CRT002
     C                     EXSR PCMTXT                                    CRT002
     C           CMTTXT    COMIT                                          CRT002
     C                     MOVEL*BLANKS   REPOIO                          CRT002
      *                                                                   CRT002
     C                     ENDIF                                          CRT002
     C*
     C**  Perform initialisation
     C*
     C                     EXSR RFRESH
     C*
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            DSPFMT - Display screen formats                    *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  SCRINP - Detail screen input                       *
      *                                                               *
      *****************************************************************
     C           DSPFMT    BEGSR                           ** DSPFMT **
      *                                                                   CRT002
     C                     SELEC                                          CRT002
      *                                                                   CRT002
     C           PMODE     WHEQ 'I'                                       CRT002
      *
      ** Display message subfile control record
     C                     WRITERE4111C0
      *
      ** Display appropriate screen format
      *
      ** If any terminal errors - display tran.terminated screen
     C           *IN20     IFEQ '1'
     C                     EXFMTRE4111F2
      *
     C                     ELSE
      *
      ** If currency selected successfully - display details screen
     C           *IN22     IFEQ '1'
     C                     EXFMTRE4111F3
      *
     C                     ELSE
      *
      ** Otherwise display initial input screen
     C                     EXFMTRE4111F1
      *
     C                     END
      *
     C                     END
      *                                                                   CRT002
     C           PMODE     WHEQ 'P'                                       CRT002
      *                                                                   CRT002
     C                     MOVEL*BLANKS   REPOII                          CRT002
     C                     EXSR RDQMS                                     CRT002
     C                     EXSR DQERR                                     CRT002
      *                                                                   CRT002
     C                     MOVE P@QDR     REPOII                          CRT002
      *                                                                   CRT002
     C           RAMSTY    IFNE '*END'                                    CRT002
      *                                                                   CRT002
     C                     MOVELRAFWST    WFWST   1                       120880
     C                     MOVELRACCY1    SCCY                            CRT002
     C                     MOVE RATRA1    SAMT                            CRT002
     C                     MOVELRANRL1    SNARR                           CRT002
      *                                                                   CRT002
     C           PFNCD     IFEQ '00X'                                     CRT002
     C                     MOVEL*BLANKS   @RANR2                          CRT002
     C                     MOVELRANRL2    @RANR2                          CRT002
     C                     MOVEL@SCIN     SCIN                            CRT002
     C                     MOVEL@SBNM     SBNM                            CRT002
     C                     MOVEL@SBIT     SBIT                            CRT002
      *                                                                   CRT002
     C                     MOVEL*BLANKS   @RANR3                          CRT002
     C                     MOVELRANRL3    @RANR3                          CRT002
     C                     MOVEL@SCSN     SCSN                            CRT002
     C                     MOVEL@SBIN     SBIN                            CRT002
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
     C                     CLEARLOGDS                                     CRT002
     C                     CLEARWCMSG                                     CRT002
      *                                                                   CRT002
     C                     MOVE RACMSQ    WCMSQ                           CRT002
     C                     MOVELRABRNM    WBRCA                           CRT002
     C                     MOVELRAUSID    WUSID                           CRT002
     C                     MOVE 'N'       WSUCM                           CRT002
     C                     MOVE 'DR'      WSTAT                           CRT002
     C                     TIME           WTMDS  120                      CRT002
     C           WTHR      CAT  ':'       WA      3                       CRT002
     C           WTMN      CAT  ':'       WB      3                       CRT002
     C           WA        CAT  WB        WC      6                       CRT002
     C           WC        CAT  WTSS      WSTTM                           CRT002
     C                     MOVE WSTTM     WRCTM   8                       CRT002
     C           WDT1      CAT  '/'       WA      3                       CRT002
     C           WDT2      CAT  '/'       WB      3                       CRT002
     C           WA        CAT  WB        WC      6                       CRT002
     C           WC        CAT  WDT3      WRCDT   8                       CRT002
     C                     MOVELP@QDR     WCMSG                           CRT002
     C                     EXSR WRLOG                                     CRT002
     C                     EXSR PCMTXT                                    CRT002
     C           CMTTXT    COMIT                                          CRT002
      *                                                                   CRT002
     C                     MOVE '0'       *INKA                           CRT002
     C                     MOVE '0'       *INKC                           CRT002
     C                     MOVE '0'       *INKE                           CRT002
     C                     MOVE '0'       *INKL                           CRT002
      *                                                                   CRT002
     C                     ELSE                                           CRT002
      *                                                                   CRT002
     C                     MOVE '1'       *INKC                           CRT002
      *                                                                   CRT002
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
     C                     ENDSL                                          CRT002
     C*
     C**  Clear program message queue and terminal & warning msg. lines
     C*
     C                     CALL 'SCC0250'
     C                     MOVEL*BLANKS   SMSG1
     C                     MOVEL*BLANKS   SMSG2
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            RFRESH - Refresh screen                            *
      *                                                               *
      * CALLS      IFLDS  - Initialize screen/work fields             *
      *            INT01  - Initialise error indicators               *
      *                                                               *
      * CALLED BY  SCRINP - Detail screen input                       *
      *                                                               *
      *****************************************************************
     C           RFRESH    BEGSR                           ** RFRESH **
      *
      ** Initialize all indicators
     C                     EXSR INT01
      *
      ** Initialize screen/work fields
     C                     EXSR IFLDS
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            VALFMT - Validate input formats                    *
      *                                                               *
      * CALLS      INT01  - Initialise error indicators               *
      *            RTTWID - Teller workstation conditions check       *
      *            VALCCY - Validate Currency                         *
      *            VALDET - Validate Details                          *
      *                                                               *
      * CALLED BY  SCRINP - Detail screen input                       *
      *                                                               *
      *****************************************************************
     C           VALFMT    BEGSR                           ** VALFMT **
      *
      ** Intialise error indicators
     C                     EXSR INT01
      *
      ** Setof indicator for invalid input
     C                     SETOF                     50
      *
     C                     Z-ADD0         @TI     20
     C                     Z-ADD0         @WI     20
     C                     MOVE *BLANKS   @W
     C                     MOVE *BLANKS   @T
      *
      ** perform check for multiple sign on
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C***********          Z-ADD1         @I                       CRT002 130543
     C                     Z-ADD1         @J                              130543
     C                     MOVEL@TLID     @@PTL                           CRT002
     C                     MOVELRAUSID    @TLID                           CRT002
     C                     MOVELPTLBC     @@TLB   3                       CRT002
     C           @TLID     IFNE @@PTL                                     CRT002
     C***********@TLID     LOKUPWTL,@I                   60        CRT002 130543
     C           @TLID     LOKUPWTL,@J                   60               130543
     C           *IN60     IFEQ '1'                                       CRT002
     C***********@I        OCUR TELDS                  60          CRT002 130543
     C           @J        OCUR TELDS                  60                 130543
     C           *IN60     IFEQ '0'                                       CRT002
     C                     MOVELD@TLID    PTLID                           CRT002
     C                     MOVELD@TLBC    PTLBC                           CRT002
     C                     MOVELD@SPVI    PSPVI                           CRT002
     C                     MOVELD@OVRI    POVIN                           CRT002
     C**********           MOVELD@CHTL    PCHTL                                       CRT002 Bud3855
     C**********           MOVELD@NCTL    PNCTL                                       CRT002 Bud3855
     C                     Z-ADDD@CHTL    PCHTL                                              Bud3855
     C                     Z-ADDD@NCTL    PNCTL                                              Bud3855
     C                     MOVELD@DEPC    PDEPC                           CRT002
     C                     ENDIF                                          CRT002
     C                     ENDIF                                          CRT002
     C                     ENDIF                                          CRT002
     C                     MOVE PDEPC     SDEPC                           CRT002
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
     C                     MOVELPTLID     @TLID                           CRT002
      *                                                                   CRT002
      **  Get the teller branch internal customer no.                     CRT002
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           PTLBC     ANDNE@@TLB                                     CRT002
     C           PMODE     OREQ 'P'                                       CRT002
     C           @@FST     ANDNE'1'                                       CRT002
     C**********           CALL 'AOBRCHR0'                                             CRT002 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       CRT002
     C                     PARM '*KEY  '  @OPTN   7                       CRT002
     C                     PARM PTLBC     @BRCD   3                       CRT002
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        CRT002 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   CRT002
     C           @RTCD     IFNE *BLANKS                                   CRT002
     C           *LOCK     IN   LDA                                       CRT002
     C                     Z-ADD9         DBASE                           CRT002
     C                     MOVEL'SDBRCHPD'DBFILE                          CRT002
     C                     MOVEL@BRCD     DBKEY                           CRT002
     C                     EXSR DBERR                                     CRT002
     C                     END                                            CRT002
     C                     MOVE '1'       @@FST   1                       CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     EXSR RTTWID
      *
      ** Validate currency or details depending on screen
     C           PMODE     IFEQ 'I'                                       CRT002
     C           *IN22     IFEQ '0'
     C                     EXSR VALCCY
     C                     ELSE
     C                     EXSR VALDET
     C/COPY WNCPYSRC,RE4111C001
     C                     END
     C                     END                                            CRT002
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C                     EXSR VALCCY                                    CRT002
     C           *IN11     IFEQ '0'                                       CRT002
     C                     MOVE '0'       *IN50                           CRT002
     C                     EXSR VALDET                                    CRT002
     C                     END                                            CRT002
     C                     END                                            CRT002
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            INT01  - Initialise error indicators               *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  FIRST  - Initial Processing                        *
      *            RFRESH - Refresh screen                            *
      *            VALFMT - Validate input formats                    *
      *                                                               *
      *****************************************************************
     C           INT01     BEGSR                           ** INT01  **
      *
      ** Setof screen conditioning & error indicators
     C                     SETOF                     111213
     C                     SETOF                     141516
     C                     SETOF                     171819
     C                     SETOF                     3031
     C                     SETOF                     666768
     C                     SETOF                     26
      *                                                                   CRT002
     C                     MOVE '0'       *IN46                           CRT002
     C                     MOVE '0'       *IN47                           CRT002
     C                     MOVE '0'       *IN48                           CRT002
     C                     MOVE '0'       *IN49                           CRT002
      *
      ** Setof indicator for override required
     C                     SETOF                     51
      *
      ** Seton indicator for invalid input
     C                     SETON                     50
      *
      ** If screen is to be refreshed - then setof 22 24
     C           *INKE     IFEQ '1'
     C                     SETOF                     2224
     C                     END
      *
     C                     ENDSR
      *****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*            VALCCY - Validate Currency                         *
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY  VALFMT - Validate input formats                    *
     C*                                                               *
     C*****************************************************************
     C           VALCCY    BEGSR                           ** VALCCY **
     C*
     C**  Setof indicators conditioning warn. & term. errors & succ.comp
     C*
     C                     SETOF                     202124
     C*
     C**  If currency code is blanks
     C*
     C           SCCY      IFEQ *BLANKS                            B001
     C                     SETON                     1150
     C                     MOVEL'USR0076' @MSGID
     C                     EXSR SNDMSG
     C*
     C**  otherwise check whether currency is present in currency table
     C*
     C                     ELSE                                    X001
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C           SCCY      PARM SCCY      @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C*
     C**  If record not found: Message - currency code not found
     C*
     C           @RTCD     IFNE *BLANKS                            B002
     C                     SETON                     1150
     C                     MOVEL'USR0049' @MSGID
     C                     EXSR SNDMSG
     C*
     C**  otherwise check whether currency has cash account code
     C*
     C                     ELSE                                    X002
     C           A6CSCD    IFEQ *BLANKS                            B003
     C                     SETON                     1150
     C                     MOVEL'USR0204' @MSGID
     C                     EXSR SNDMSG
     C                     END                                     E003
     C*
      ** Store decimal places for transaction currency                    104034
     C                     Z-ADDA6NBDP    @6NBDP  10                      104034
     C                     END                                     E002
     C*
     C                     END                                     E001
     C*
     C**  If Currency OK setup up screen details
     C*
     C           *IN50     IFEQ '0'
     C                     SETON                     22
     C                     MOVE PDEPC     SDEPC
     C           *IN09     IFEQ '0'                        CASH IN
     C                     MOVE A8BICN    SDCUS
     C                     MOVE A6CSCD    SDAC
     C                     MOVE '01'      SDSEQ
      *                                                                   CRT002
     C           PFNCD     IFEQ '00X'                                     CRT002
     C                     MOVE A8BICN    SCCUS                           CRT002
     C                     MOVE @CASGL    SCAC                            CRT002
     C                     MOVE '01'      SCSEQ                           CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     ELSE                            CASH OUT
     C                     MOVE A8BICN    SCCUS
     C                     MOVE A6CSCD    SCAC
     C                     MOVE '01'      SCSEQ
      *                                                                   CRT002
     C           PFNCD     IFEQ '00S'                                     CRT002
     C                     MOVE A8BICN    SDCUS                           CRT002
     C                     MOVE @DASGL    SDAC                            CRT002
     C                     MOVE '01'      SDSEQ                           CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     END
     C*
     C**  Seton indicator for invalid input to prevent file update
     C*
     C                     SETON                     50
     C*
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
      *****************************************************************
      *                                                               *
      *            VALDET - Validate Details                          *
      *                                                               *
      * CALLS      RTACLG - Account closing Check                     *
      *            RTTCCY - Teller currency conditions check          *
      *            SNDMSG - Send program message parameters           *
      *            TRNOVR - Transaction override process              *
      *            VALACC - Validate a/c number                       *
      *            VALAMT - Validate amount                           *
      *            VALOVR - Validate override conditions              *
      *                                                               *
      * CALLED BY  VALFMT - Validate input formats                    *
      *                                                               *
      *****************************************************************
     C           VALDET    BEGSR                           ** VALDET **
      *
      ** Setof indicators conditioning warn. & term. errors & succ.comp
     C                     SETOF                     202124
     C                     MOVE *OFF      *IN23                                               CRT026
      *
      ** Validate debit  - a/c code
     C                     MOVELSCCY      @DCUR
     C                     MOVEL@DACNO    @ACCN
      *
      *  If debit is default, allow it to be retail.
      *
     C           *IN09     IFEQ '0'
     C                     SETON                     27
     C                     ELSE
     C                     SETOF                     27
     C                     END
      *
     C                     EXSR VALACC
      *
      ** If error in cust.no - seton 12
     C           *IN66     IFEQ '1'
     C                     SETON                     12
     C                     END
      *
      ** If error in a/c code - seton 13
     C           *IN67     IFEQ '1'
     C                     SETON                     13
     C                     END
      *
      ** If error in debit a/c no.  - seton 30
     C           *IN68     IFEQ '1'
     C                     SETON                     30
     C                     END
      *
      ** If no error in debit a/c no.
     C           *IN30     IFEQ '0'
      *
      ** Move seq no to screen seq no.
     C                     MOVE @ACSQ     SDSEQ
      *
      ** Store branch code and a/c status of debit a/c no.
     C                     MOVE BRCA      @DBRCD  3
     C                     MOVE ACST      @DACST  1
      *
     C                     END
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           *IN50     ANDEQ'1'                                       CRT002
     C                     GOTO ERRDET                                    CRT002
     C                     END                                            CRT002
      *
      ** Validate amount - only if currency code is valid
     C           *IN11     IFEQ '0'
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C                     MOVEL*BLANKS   ZFIELD                          CRT002
     C                     MOVE SAMT      ZFIELD                          CRT002
     C                     Z-ADDA6NBDP    ZADEC                           CRT002
     C                     EXSR ZEDIT                                     CRT002
     C                     MOVE ZFIELD    SAMT                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     EXSR VALAMT
     C                     END
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           *IN50     ANDEQ'1'                                       CRT002
     C                     GOTO ERRDET                                    CRT002
     C                     END                                            CRT002
      *
      ** If Credit a/c no. is same as debit a/c no.
     C                     MOVELSCCY      @CCUR
     C           SCSEQ     IFEQ *ZEROS
     C                     MOVE 1         SCSEQ
     C                     END
     C           @CACNO    IFEQ @DACNO
     C                     SETON                     3150
     C                     MOVEL'USR0080' @MSGID
     C                     EXSR SNDMSG
      *
     C                     ELSE
      *
      ** Validate credit  - a/c code
     C                     MOVEL@CACNO    @ACCN
      *
      ** Reset lf/accnt before second chain
     C           *LOVAL    SETLLACCNTABF             70
      *
      *  If credit is default, allow it to be retail.
      *
     C           *IN09     IFEQ '0'
     C                     SETOF                     27
     C                     ELSE
     C                     SETON                     27
     C                     END
      *
     C                     EXSR VALACC
      *
      ** If error in cust.no - seton 16
     C           *IN66     IFEQ '1'
     C                     SETON                     16
     C                     END
      *
      ** If error in a/c code - seton 17
     C           *IN67     IFEQ '1'
     C                     SETON                     17
     C                     END
      *
      ** If error in credit a/c no.  - seton 31
     C           *IN68     IFEQ '1'
     C                     SETON                     31
     C                     END
      *
      ** If no error in credit a/c no.
     C           *IN31     IFEQ '0'
      *
      ** Move seq no to screen seq no.
     C                     MOVE @ACSQ     SCSEQ
      *
      ** Store branch code and a/c status of credit a/c no.
     C                     MOVE BRCA      @CBRCD  3
     C                     MOVE ACST      @CACST  1
      *
      ** credit a/c branch code must be same as debit a/c branch code
     C           *IN50     IFEQ '0'
     C           @CBRCD    ANDNE@DBRCD
     C                     SETON                     3150
     C                     MOVEL'USR0082' @MSGID
     C                     EXSR SNDMSG
     C                     END
      *
     C                     END
      *
     C                     END
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           *IN50     ANDEQ'1'                                       CRT002
     C                     GOTO ERRDET                                    CRT002
     C                     END                                            CRT002
      *
      ** If department code is blanks
      ** message - department code is required
     C           SDEPC     IFEQ *BLANK
     C                     SETON                     1950
     C                     MOVEL'USR0055' @MSGID
     C                     EXSR SNDMSG
     C*
     C**  Access department details
     C*
     C                     ELSE
     C*
     C                     CALL 'AODEPTR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C           SDEPC     PARM SDEPC     @DPCD   3
     C           SDDEPT    PARM SDDEPT    DSFDY
     C*
     C**  If record not found: message - department code not found
     C*
     C           @RTCD     IFNE *BLANKS
     C                     SETON                     1950
     C                     MOVE 'USR0054' @MSGID
     C                     EXSR SNDMSG
     C                     END
      *
     C                     END
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           *IN50     ANDEQ'1'                                       CRT002
     C                     GOTO ERRDET                                    CRT002
     C                     END                                            CRT002
      *
      ** Narrative field must be entered
     C           SNARR     IFEQ *BLANKS
     C                     SETON                     2650
     C                     MOVE 'USR0070' @MSGID
     C                     EXSR SNDMSG
     C                     END
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           *IN50     ANDEQ'1'                                       CRT002
     C                     GOTO ERRDET                                    CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Selling Travellers Cheques in Cash ccy fields validation         CRT002
      *                                                                   CRT002
     C           PFNCD     IFEQ '00X'                                     CRT002
      *                                                                   CRT002
      ** Validate Cheque issuer no.                                       CRT002
      *                                                                   CRT002
     C           SCIN      IFNE *BLANKS                                   CRT002
     C           SCIN      ANDNE*ZEROS                                    CRT002
     C*                                                                   CRT002
     C** Resolve ? before validation                                      CRT002
     C*                                                                   CRT002
     C           '?'       LOKUPINP                      45               CRT002
     C*                                                                   CRT002
     C           *IN45     IFEQ '1'                                       CRT002
     C*                                                                   CRT002
     C                     SELEC                                          CRT002
     C           PMODE     WHEQ 'I'                                       CRT002
     C                     CALL 'AOCUSTR0'                                CRT002
     C                     PARM *BLANKS   @RTCD   7                       CRT002
     C                     PARM '*KEY'    @OPTN   7                       CRT002
     C                     PARM '?'       @CUST  10                       CRT002
     C                     PARM *BLANKS   @KSTS   7                       CRT002
     C***********SDCUST    PARM SDCUST    DSFDY                     CRT002176443
     C           SDCUST    PARM SDCUST    DSSDY                           176443
     C*                                                                   CRT002
     C** If selection made, move value to screen field                    CRT002
     C*                                                                   CRT002
     C           @RTCD     IFEQ *BLANKS                                   CRT002
     C                     MOVELBBCUST    SCIN                            CRT002
     C                     ELSE                                           CRT002
     C                     MOVE *BLANKS   SCIN                            CRT002
     C                     END                                            CRT002
     C*                                                                   CRT002
     C           PMODE     WHEQ 'P'                                       CRT002
     C                     MOVE '1'       *IN46                           CRT002
     C                     MOVE '1'       *IN50                           CRT002
     C                     MOVE 'USR1025' @MSGID                          CRT002
     C                     EXSR SNDMSG                                    CRT002
     C                     ENDSL                                          CRT002
      *                                                                   CRT002
      ** If issuer selected through '?', bypass validation                CRT002
      *                                                                   CRT002
     C                     ELSE                                           CRT002
      *                                                                   CRT002
     C                     CALL 'AOCUSTR0'                                CRT002
     C                     PARM *BLANKS   @RTCD   7                       CRT002
     C                     PARM '*KEY'    @OPTN   7                       CRT002
     C                     PARM SCIN      @CUST  10                       CRT002
     C                     PARM *BLANKS   @KSTS   7                       CRT002
     C***********SDCUST    PARM SDCUST    DSFDY                     CRT002176443
     C           SDCUST    PARM SDCUST    DSSDY                           176443
      *                                                                   CRT002
     C           @RTCD     IFNE *BLANKS                                   CRT002
     C           @KSTS     OREQ '*SHNAME'                                 CRT002
     C                     MOVE '1'       *IN46                           CRT002
     C                     MOVE '1'       *IN50                           CRT002
     C                     MOVE 'USR1025' @MSGID                          CRT002
     C                     EXSR SNDMSG                                    CRT002
     C                     END                                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C           SCIN      IFEQ *BLANKS                                   CRT002
     C           SCIN      OREQ *ZEROS                                    CRT002
     C                     MOVE '1'       *IN46                           CRT002
     C                     MOVE '1'       *IN50                           CRT002
     C                     MOVE 'USR0083' @MSGID                          CRT002
     C                     EXSR SNDMSG                                    CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Validate the cheque serial no and amount                         CRT002
      *                                                                   CRT002
     C           *IN46     IFEQ '0'                                       CRT002
     C           *IN15     ANDEQ'0'                                       CRT002
     C                     MOVELSCIN      H@CIN                           CRT002
     C                     MOVELSCCY      H@CCY                           CRT002
     C                     MOVELSAMT      H@AMT                           CRT002
     C                     MOVELSCSN      H@CSN                           CRT002
     C**********           Z-ADDA6NBDP    H@NDC                    CRT002 140770
     C                     Z-ADD@6NBDP    H@NDC                           140770
      *                                                                   184553
     C           PMODE     IFEQ 'P'                                       184553
     C                     Z-ADD0         ZADEC                           184553
     C                     Z-ADD3         ZADIG                           184553
     C                     MOVE *BLANKS   ZFIELD                          184553
     C                     MOVE WCHQNM    ZFIELD                          184553
     C                     EXSR ZALIGN                                    184553
     C                     MOVE ZFIELD    WCQNUM  30                      184553
     C                     ENDIF                                          184553
      *                                                                   184553
     C                     EXSR VALCQS                                    CRT002
     C                     MOVE *IN49     *IN15                           CRT002
     C           *IN47     IFEQ '1'                                       CRT002
     C           *IN49     OREQ '1'                                       CRT002
     C           *IN53     OREQ '1'                                       180663
     C           *IN54     OREQ '1'                                       180663
     C                     MOVE '1'       *IN50                           CRT002
     C                     MOVE '0'       *IN53                           180663
     C                     MOVE '0'       *IN54                           180663
     C                     END                                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           *IN50     ANDEQ'1'                                       CRT002
     C                     GOTO ERRDET                                    CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Validate Buyer's Id type                                         CRT002
      *                                                                   CRT002
     C           SBIT      IFEQ 'RC'                                      CRT002
     C           SBIT      OREQ 'RS'                                      CRT002
     C                     MOVE '1'       *IN48                           CRT002
     C                     MOVE '1'       *IN50                           CRT002
     C                     MOVE 'USR0185' @MSGID                          CRT002
     C                     EXSR SNDMSG                                    CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     END                             00X            CRT002
      *
      ** If there are no errors in validation
     C           *IN50     IFEQ '0'
      *
      ** Check teller currency conditions for any terminal condition
     C                     MOVELSCCY      @CCY
     C                     EXSR RTTCCY
      *
      ** For debit a/c no. - Set acc. indicator to '1'
     C                     MOVE '1 '      @ACIN   2
      *
      ** Account closing check
     C***********@V,@AC    IFNE ' '                                       114621
     C           @V,@AC    IFNE 'X'                                       114621
     C                     MOVEL@DACST    @ACST
     C                     EXSR RTACLG
     C                     END
      *
      ** For credit a/c no. - Set acc. indicator to '2'
     C                     MOVE '2 '      @ACIN
      *                                                                                       CRT026
      ** Only check the credit account if no warning error found                              CRT026
      ** in debit account                                                                     CRT026
      *
      ** Account closing check
     C***********@V,@AC    IFNE ' '                                       114621
     C           @V,@AC    IFNE 'X'                                       114621
     C           @O,@AC    ANDEQ' '                                                           CRT026
     C                     MOVEL@CACST    @ACST
     C                     EXSR RTACLG
     C                     END
      *
      ** Move screen fields to work fields required for comit text &
      ** displaying on the screen when transaction terminated
     C                     MOVE SDCUS     @DCUS
     C                     MOVE SDAC      @DAC
     C                     MOVE SDSEQ     @DSEQ
     C                     MOVE SCCUS     @CCUS
     C                     MOVE SCAC      @CAC
     C                     MOVE SCSEQ     @CSEQ
      *
      ** If terminal error(s) exist
     C           @TI       IFGT 0
     C***********          SETON                     20                   CRT002
     C           PMODE     IFEQ 'I'                                       CRT002
     C                     MOVE *ON       *IN20                           CRT002
     C                     ENDIF                                          CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C                     MOVE *OFF      *IN20                           CRT002
     C                     ENDIF                                          CRT002
     C                     MOVEA@T,1      SMSG1
     C                     MOVEA@T,10     SMSG2
      *
     C                     ELSE
      *
      ** If warning error(s) exist and different from previous error(s)
     C           @WI       IFGT 0
     C                     MOVEA@W,1      SMSG1
     C                     MOVEA@W,10     SMSG2
      *                                                                   CRT002
     C           PMODE     IFEQ 'I'                                       CRT002
      *
      ** Move overrride indicators from rtsdta to teller ovr.ind.array
     C                     MOVEAPOVIN     @R
      *
      ** Perform ovr.validation to check whether signon teller has
      ** authority to override - otherwise override prompt is required
     C                     EXSR VALOVR
      *
      ** If no successful override - override prompt is required
     C           *IN51     IFEQ '1'
      *
      ** If CRT026 is switch on use User Id instead of Teller ID                              CRT026
      *                                                                                       CRT026
     C           CRT026    IFEQ 'Y'                                                           CRT026
     C                     MOVE *ON       *IN23                                               CRT026
     C                     ELSE                                                               CRT026
     C                     SETON                     21
     C                     ENDIF                                                              CRT026
      *
     C                     END
      *
      ** Perform transaction override process
     C                     EXSR TRNOVR
      *                                                                   CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C                     MOVE *OFF      *IN20                           CRT002
     C                     ENDIF                                          CRT002
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C           ERRDET    TAG                                            CRT002
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            VALAMT - Validate amount                           *
      *                                                               *
      * CALLS      SNDMSG - Send program message parameters           *
      *            ZALIGN - Validate amount fields                    *
      *            ZFRPED - Format and edit amount field              *
      *                                                               *
      * CALLED BY  VALDET - Validate Details                          *
      *                                                               *
      *****************************************************************
     C           VALAMT    BEGSR                           ** VALAMT **
      *
      ** Check if amount field is blanks or zeros
     C           SAMT      IFEQ *ZEROS
     C           SAMT      OREQ *BLANKS
     C                     SETON                     1550
     C                     MOVE 'USR0008' @MSGID
     C                     EXSR SNDMSG
      *
     C                     ELSE
      *
      ** Set up decimal values
     C**********           Z-ADDA6NBDP    ZADEC                           104034
     C                     Z-ADD@6NBDP    ZADEC                           104034
     C********** 13        SUB  A6NBDP    ZADIG                           104034
     C           13        SUB  @6NBDP    ZADIG                           104034
      *
      ** Align amount - and move it to numeric field
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE SAMT      ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    @TAMT  150
      *
      ** If error found?  Set up error message
     C           *IN99     IFEQ '1'
     C           ZFIELD    OREQ *ZERO
     C                     SETON                     1550
     C                     MOVE 'USR0008' @MSGID
     C                     EXSR SNDMSG
     C                     END
      *
      *
      ** Continue if no error in amount field.                            169719
      *                                                                   169719
     C           *IN99     IFEQ '0'                                       169719
     C           ZFIELD    ANDNE*ZERO                                     169719
      *                                                                   169719
      ** Perform excess cash check if Cash out.                           169719
      *                                                                   169719
     C           *IN09     IFEQ '1'                                       169719
     C                     MOVELPTLID     @TLID                           169719
     C                     MOVELSCCY      @CCY                            169719
     C                     Z-ADD@TAMT     @TNAM  150                      169719
     C                     EXSR RTCASH                                    169719
     C                     END                                            169719
      *                                                                   104034
      ** Teller limit check                                               104034
     C                     MOVELSCCY      @TCCY                           104034
     C                     MOVELBJLCCY    @LCCY                           104034
     C                     Z-ADD@TAMT     @TAM1                           104034
     C                     Z-ADD0         @TAM2                           104034
     C                     MOVEL@DCSIN    @TCI1                           104034
     C                     MOVEL@CCSIN    @TCI2                           104034
     C                     Z-ADDPCHTL     @CHTL                           104034
     C                     Z-ADDPNCTL     @NCTL                           104034
     C           @V,@TL    IFEQ ' '                                       104034
     C                     MOVE 'N'       @V,@TL                          104034
     C                     END                                            104034
     C*                                                                   104034
     C                     EXSR RTTLMT                                    104034
     C*                                                                   104034
     C           @V,@TL    IFEQ 'N'                                       104034
     C                     MOVE ' '       @V,@TL                          104034
     C                     END                                            104034
      *
     C                     END                                            169719
     C                     END
      *
      ** If there are no errors - edit the amount field - insert dec.pt
     C           *IN15     IFEQ '0'
     C**********           Z-ADDA6NBDP    ZDECS                           104034
     C                     Z-ADD@6NBDP    ZDECS                           104034
     C                     MOVE 'L'       ZECODE
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE @TAMT     ZFLD15
     C                     EXSR ZFRPED
     C                     MOVE *BLANKS   @AMTDS
     C                     MOVE *BLANKS   SAMT
     C                     MOVE ZOUT22    @AMTDS
     C                     MOVEL@SAMT     SAMT
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            VALACC - Validate a/c number                       *
      *                                                               *
      * CALLS      SNDMSG - Send program message parameters           *
      *                                                               *
      * CALLED BY  VALDET - Validate Details                          *
      *                                                               *
      *****************************************************************
     C           VALACC    BEGSR                           ** VALACC **
      *
      ** Validate customer no.
     C********** @CNUM     IFEQ *ZEROS                                                        CSD027
     C           @CNUM     IFEQ *BLANKS                                                       CSD027
     C                     SETON                     6650
     C                     MOVE 'USR0083' @MSGID
     C                     EXSR SNDMSG
     C                     END
      *
      ** Setof error indicators
     C                     SETOF                     666768
      *
      ** a/c code must not be blanks
     C           @ACOD     IFEQ *ZEROS
     C                     SETON                     6750
     C                     MOVEL'USR0079' @MSGID
     C                     EXSR SNDMSG
     C                     END
      *
      ** a/c seq if not entered - must default to 01
     C           @ACSQ     IFEQ *ZEROS
     C                     MOVE 01        @ACSQ
     C                     END
      *
      ** Access lf/accnt for account number
     C           KLACNT    CHAINACCNTABF             70
      *
      ** If no live record found
     C           *IN70     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     SETON                     6850
     C                     MOVEL'USR0050' @MSGID
     C                     EXSR SNDMSG
      *
     C                     ELSE
      *
      ** Account referred to must not be retail type
      ** Only if it isnot the defaulted one.
     C           ATYP      IFEQ 'R'
     C           *IN27     ANDEQ'0'
     C                     SETON                     6850
     C                     MOVE 'USR0084' @MSGID
     C                     EXSR SNDMSG
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            VALOVR - Validate override conditions              *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  VALDET - Validate Details                          *
      *            VOVDET - Validate override details                 *
      *                                                               *
      *****************************************************************
     C           VALOVR    BEGSR                           ** VALOVR **
      *
      ** Setof error indicator
     C                     SETOF                     51
      *
      ** Set array index to 1
     C                     Z-ADD1         IX      20
      *
     C           IX        DOUGT25
     C           *IN51     OREQ '1'
      *
     C           @O,IX     IFEQ 'Y'
     C           @R,IX     ANDEQ'N'
     C                     SETON                     51
      *
     C                     ELSE
      *
     C                     ADD  1         IX
      *
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            TRNOVR - Transaction override process              *
      *                                                               *
      * CALLS             -                                           *
      *            LAST   - Final processing - terminate pgm.         *
      *            SETDSP - Set indicators for display                *
      *            VOVDET - Validate override details                 *
      *                                                               *
      * CALLED BY  VALDET - Validate Details                          *
      *                                                               *
      *****************************************************************
     C           TRNOVR    BEGSR                           ** TRNOVR **
      *
      ** Do until successful override
     C           *IN51     DOUEQ'0'
      *
      ** Display message subfile control record
     C                     WRITERE4111C0
      *
      ** Display override screen format
     C                     EXFMTRE4111F4
     C*
     C**  Clear program message queue and terminal & warning msg. lines
     C*
     C                     CALL 'SCC0250'
      *
      ** Process the input depending on the key pressed
      *
      ** If cmd/3 is pressed - terminate the program
     C           *INKC     CASEQ'1'       LAST
      *
      ** If cmd/1 is pressed - validate override details
     C           *INKA     CASEQ'1'       VOVDET
      *
      ** If cmd/12 or enter key is pressed - Set indicators for dsplay
     C                     CAS            SETDSP
      *
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            VOVDET - Validate override details                 *
      *                                                               *
      * CALLS      SNDMSG - Send program message parameters           *
      *            VALOVR - Validate override conditions              *
      *            RTENCP - Encript passcode                          *
      *                                                               *
      * CALLED BY  TRNOVR - Transaction override process              *
      *                                                               *
      *****************************************************************
     C           VOVDET    BEGSR                           ** VOVDET **
      *
      ** Validation is to be done only if override prompt is displayed
      ** Otherwise - setof 51 to come out of loop
     C           *IN21     IFEQ '0'
     C           *IN23     ANDEQ'0'                                                           CRT026
     C                     SETOF                     51
      *
     C                     ELSE
      *
      ** Setof error indicators
     C                     SETOF                     111252
      *
      ** Override teller if blanks
      ** If CRT026 is switch ON User Id is required                                           CRT026
      *                                                                                       CRT026
     C           SOVTI     IFEQ *BLANKS
     C           SOVUR     ANDEQ*BLANKS                                                       CRT026
     C                     SETON                     1152
     C           CRT026    IFEQ 'Y'                                                           CRT026
     C                     MOVE 'USR1500' @MSGID                                              CRT026
     C                     ELSE                                                               CRT026
     C                     MOVE 'USR0032' @MSGID
     C                     ENDIF                                                              CRT026
     C                     EXSR SNDMSG
      *
     C                     ELSE
      *                                                                                       CRT026
      ** Access user id details to obtain the teller id attached                              CRT026
      ** to the user id                                                                       CRT026
      *                                                                                       CRT026
     C           CRT026    IFEQ 'Y'                                                           CRT026
     C                     CALL 'AOUSERR0'                                                    CRT026
     C                     PARM *BLANKS   @RTCD   7                                           CRT026
     C                     PARM '*KEY'    @OPTN   7                                           CRT026
     C                     PARM SOVUR     @USRP  10                                           CRT026
     C           MUSER     PARM MUSER     DSSDY                                               CRT026
      *                                                                                       CRT026
     C           @RTCD     IFNE *BLANKS                                                       CRT026
     C           @RTCD     ANDNE'*NRF   '                                                     CRT026
     C           *LOCK     IN   LDA                                                           CRT026
     C                     MOVEL'MUSERDD' DBFILE           ***************                    CRT026
     C                     Z-ADD11        DBASE            ** DB ERR 11 **                    CRT026
     C                     MOVELSOVUR     DBKEY            ***************                    CRT026
     C                     EXSR DBERR                                                         CRT026
     C                     ENDIF                                                              CRT026
      *                                                                                       CRT026
     C           @RTCD     IFNE *BLANKS                                                       CRT026
     C                     MOVE *ON       *IN11                                               CRT026
     C                     MOVE *ON       *IN52                                               CRT026
     C                     MOVEL'USR1501' @MSGID                                              CRT026
     C                     EXSR SNDMSG                                                        CRT026
      ** If user id is valid use the teller attached to this user                             CRT026
      ** to obtain the teller details                                                         CRT026
     C                     ELSE                                                               CRT026
     C                     MOVE TLID      @TELD                                               CRT026
     C                     ENDIF                                                              CRT026
      ** If CRT026 enhancement is switch OFF use the teller id                                CRT026
      ** entered to obtain the teller details                                                 CRT026
     C                     ELSE                                                               CRT026
     C                     MOVE SOVTI     @TELD                                               CRT026
     C                     ENDIF                                                              CRT026
      *                                                                                       CRT026
      ** If no validation errors exist                                                        CRT026
     C*
     C**  Access teller id details
     C*
     C           *IN52     IFEQ *OFF                                                          CRT026
     C                     CALL 'AOTELDR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C**********           PARM SOVTI     @TELD   3                                           CRT026
     C                     PARM           @TELD   3                                           CRT026
     C           SDTELD    PARM SDTELD    DSFDY
     C*
     C**  If record not found: Message - Teller identifier not found
     C*
     C           @RTCD     IFNE *BLANKS
     C                     SETON                     1152
     C           CRT026    IFEQ 'Y'                                                           CRT026
     C                     MOVEL'USR1509' @MSGID                                              CRT026
     C                     ELSE                                                               CRT026
     C                     MOVEL'USR0030' @MSGID
     C                     ENDIF                                                              CRT026
     C                     EXSR SNDMSG
     C                     END
     C                     ENDIF                                                              CRT026
      *
     C                     END
      *                                                                                       CRT026
      ** If no validation errors exist                                                        CRT026
      *                                                                                       CRT026
     C           *IN52     IFEQ *OFF                                                          CRT026
      *
      ** Check if passcode is blanks
      ** message - Teller passcode is required
      ** If CRT026 enhancement is ON check the password instead                               CRT026
      ** message - User password is required                                                  CRT026
     C           SOVPC     IFEQ *BLANKS
     C           SOVPW     ANDEQ*BLANKS                                                       CRT026
     C                     SETON                     1252
     C           CRT026    IFEQ 'Y'                                                           CRT026
     C                     MOVEL'USR1502' @MSGID                                              CRT026
     C                     ELSE                                                               CRT026
     C                     MOVEL'USR0033' @MSGID
     C                     ENDIF                                                              CRT026
     C                     EXSR SNDMSG
      *
     C                     ELSE
      *                                                                                       CRT026
      ** If CRT026 enhancement is ON check the password via REC4170                           CRT026
     C           CRT026    IFEQ 'Y'                                                           CRT026
     C                     CALL 'REC4170'                                                     CRT026
     C                     PARM           SOVUR                                               CRT026
     C                     PARM           SOVPW                                               CRT026
     C                     PARM *BLANKS   @RTCD   7                                           CRT026
      *                                                                                       CRT026
     C           @RTCD     IFNE *BLANKS                                                       CRT026
     C                     SELEC                                                              CRT026
     C           @RTCD     WHEQ 'CPF2204'                                                     CRT026
     C                     MOVE 'USR1501' @MSGID                                              CRT026
     C                     MOVE *ON       *IN11                                               CRT026
     C           @RTCD     WHEQ 'CPF22E3'                                                     CRT026
     C                     MOVE 'USR1506' @MSGID                                              CRT026
     C                     MOVE *ON       *IN11                                               CRT026
     C           @RTCD     WHEQ 'CPF2203'                                                     CRT026
     C                     MOVE 'USR1507' @MSGID                                              CRT026
     C                     MOVE *ON       *IN11                                               CRT026
     C           @RTCD     WHEQ 'CPF2213'                                                     CRT026
     C                     MOVE 'USR1508' @MSGID                                              CRT026
     C                     MOVE *ON       *IN11                                               CRT026
     C           @RTCD     WHEQ 'CPF22E5'                                                     CRT026
     C                     MOVE 'USR1505' @MSGID                                              CRT026
     C           @RTCD     WHEQ 'CPF22E2'                                                     CRT026
     C                     MOVE 'USR1503' @MSGID                                              CRT026
     C           @RTCD     WHEQ 'CPF22E4'                                                     CRT026
     C                     MOVE 'USR1504' @MSGID                                              CRT026
     C           @RTCD     WHEQ 'CPF22E6'                                                     CRT026
     C                     MOVE 'USR1510' @MSGID                                              CRT026
     C           @RTCD     WHEQ 'CPF22E9'                                                     CRT026
     C                     MOVE 'USR1511' @MSGID                                              CRT026
     C           @RTCD     WHEQ 'CPF2225'                                                     CRT026
     C                     MOVE 'USR1512' @MSGID                                              CRT026
     C                     ENDSL                                                              CRT026
     C                     MOVE *ON       *IN12                                               CRT026
     C                     MOVE *ON       *IN52                                               CRT026
     C                     EXSR SNDMSG                                                        CRT026
     C                     ENDIF                                                              CRT026
      *                                                                                       CRT026
     C                     ELSE                                                               CRT026
      *
      ** Check if passcode matches with that in file
      ** message - Teller passcode
      *
      ** Encript the passcode
     C                     MOVEASOVPC     BPWD
     C                     Z-ADD6         X       10
     C                     EXSR RTENCP
     C                     MOVEAEPWD      SOVPC
      *
     C           SOVPC     IFNE FRTLPC
     C                     SETON                     1252
     C                     MOVEL'USR0039' @MSGID
     C                     EXSR SNDMSG
     C                     END
     C                     ENDIF                                                              CRT026
      *
     C                     END
     C                     ENDIF                                                              CRT026
      *
      ** If no errors in validation
     C           *IN52     IFEQ '0'
      *
      ** move override indicators from SDTELDPD to override ind.array
     C                     MOVEAFROVRI    @R
      *
      ** Perform override validation
     C                     EXSR VALOVR
      *
      ** If override unsuccessful -
      ** message - teller override failed
     C           *IN51     IFEQ '1'
     C                     MOVEL'USR0029' @MSGID
     C                     EXSR SNDMSG
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SETDSP - Set indicators for display                *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  TRNOVR - Transaction override process              *
      *                                                               *
      *****************************************************************
     C           SETDSP    BEGSR                           ** SETDSP **
      *
      ** If cmd/12 is pressed - display prev.screen
     C           *INKL     IFEQ '1'
      *
      ** Setof indicator to come out override screen loop
     C                     SETOF                     51
      *
      ** Setof common screen error indicators
     C                     SETOF                     1112
      *
      ** Seton indicator to loop to display previous screen
     C                     SETON                     50
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            UPDRTN - Control rtn. for updates                  *
      *                                                               *
      * CALLS      DBERR  - Database Error Handling                   *
      *            PCMTXT - Prepare comit text                        *
      *            RTTOTS - Teller total updates                      *
      *            UPTRL  - Update Control Trailer Record             *
      *            WRTLPD - Write SDTELDPD Record                     *
      *            ZTNLU1 - Access dataarea for next transaction no.  *
      *                                                               *
      * CALLED BY  SCRINP - Detail screen input                       *
      *                                                               *
      *****************************************************************
     C           UPDRTN    BEGSR                           ** UPDRTN **
      *
      ** Update next available transaction number
     C                     EXSR ZTNLU1
      *
      ** Prepare commmitment control text
     C                     EXSR PCMTXT
      *
      ** Move fields to key list.
     C                     MOVEL'T'       KTBRI
     C           PMODE     IFEQ 'I'                                       CRT002
     C                     MOVELPTLID     KTBID
     C                     ELSE                                           CRT002
     C                     MOVEL@TLID     KTBID                           CRT002
     C                     ENDIF                                          CRT002
     C                     MOVEL'1'       KRCTP
      *
      ** Access teller controls - TTRNTM2 - to get transaction number
     C           KLTRNT    CHAINTTRNTM2F             70
      *
     C/COPY WNCPYSRC,RE4111C002
      ** Write Teller transaction details file
     C                     EXSR WRTLPD
      *
      ** Write Narrative file
     C                     MOVEL'D'       RECI
     C                     MOVEL'T'       TBRI
     C                     MOVELPTLID     TBID
     C                     MOVE TBTN      @@TBTN
     C                     MOVE TBID      @@TBID
     C                     MOVE @@NARR    TTNARR
     C                     WRITETTNARPDF
      *
      ** Update trailer
     C                     EXSR UPTRL
      *
      ** Access teller controls - TTRNTM2 -
     C                     MOVEL'1'       KRCTP
     C           KLTRNT    CHAINTTRNTM2F             70
      *
      ** If record not found - database error
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************
     C                     Z-ADD1         DBASE            ** DB ERR 01 **
     C                     MOVE 'TTRNTM2' DBFILE           ***************
     C                     MOVEL@TTRNT    DBKEY
     C                     EXSR DBERR
      *
     C                     ELSE
      *
      ** Increment next available transaction number
     C                     ADD  1         TTNATN
      *
      ** Use transaction ccy to look up currencies array
     C                     Z-ADD1         @I      20
     C           @CCY      LOKUP@CY,@I                   82
      *
      ** If element not found
     C           *IN82     IFEQ '0'
      *
      ** Check if an empty element is present in array
     C           '   '     LOKUP@CY,@I                   82
      *
      ** If empty element is present
     C           *IN82     IFEQ '1'
     C                     MOVEA@CCY      @CY,@I
     C                     END
      *
     C                     END
      *
      ** Update the record
     C                     UPDATTTRNTM2F
      *
     C                     END
      *
      ** Access teller controls - TTRNTM3 -
     C                     MOVEL'2'       KRCTP
     C           KLTRNT    CHAINTTRNTM3F             70
      *
      ** If record not found - database error
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA                        ***************
     C                     Z-ADD2         DBASE            ** DB ERR 02 **
     C                     MOVE 'TTRNTM3' DBFILE           ***************
     C                     MOVEL@TTRNT    DBKEY
     C                     EXSR DBERR
      *
     C                     ELSE
      *
      ** Obtain currency totals for debit trans-type 1
     C           *IN09     IFEQ '1'                                       169719
     C                     MOVEL@DRVIN    @RVIN
     C                     MOVEL@DDCIN    @DCIN
     C                     MOVEL@DCSIN    @CSIN
     C                     MOVEL@DCLIN    @CLIN
     C                     EXSR RTTOTS
     C                     ELSE                                           169719
      *
      ** Obtain currency totals for credit trans-type 1
     C                     MOVEL@CRVIN    @RVIN
     C                     MOVEL@CDCIN    @DCIN
     C                     MOVEL@CCSIN    @CSIN
     C                     MOVEL@CCLIN    @CLIN
     C                     EXSR RTTOTS
     C                     END                                            169719
      *
      ** Move teller transaction number to file & screen field
     C                     Z-ADDTBTN      TNLU
     C                     Z-ADDTBTN      TTLU                                                CRT006
     C                     Z-ADDTBTN      @TTRNO
      *
      ** Update the record
     C                     UPDATTTRNTM3F
     C/COPY WNCPYSRC,RE4111C007
      *
      ** Print the advice
      *                                                                                       CCG016
     C                     MOVEL'N'       ##COPD                                              CCG016
     C           CCG016    IFEQ 'Y'                                                           CCG016
     C                     EXSR SNDUDC                                                        CCG016
     C                     END                                                                CCG016
     C           ##COPD    IFEQ 'N'                                                           CCG016
      *                                                                                       CCG016
     C           PMODE     IFEQ 'I'                                       CRT002
     C/COPY WNCPYSRC,RE4111C008
     C                     OPEN RE4111P1
     C*
     C/COPY WNCPYSRC,RE4111CCP1
     C*
     C                     WRITEDETAIL
     C                     CLOSERE4111P1
     C/COPY WNCPYSRC,RE4111C003
     C                     END                                            CRT002
      *                                                                                       CCG016
     C                     ENDIF                                                              CCG016
      *                                                                                       CCG016
      *
     C                     END
      *                                                                   CRT002
      ** Write new travellers cheque register detail, and update          CRT002
      ** the travellers cheque register control                           CRT002
      *                                                                   CRT002
     C           PFNCD     IFEQ '00X'                                     CRT002
     C/COPY WNCPYSRC,RE4111C004
      *                                                                   180663
      ** Process range of Travellers cheques by looping round existing    180663
      ** code for each cheque                                             180663
      *                                                                   180663
     C           KSERE     KLIST                                          180663
     C                     KFLD           ROISSU                          180663
     C                     KFLD           ROTCSN                          180663
     C                     Z-ADD0         @@AMT                           180663
      *                                                                   180663
      ** Replace purchased amount by denomination to comply with previous 180663
      ** processing.                                                      180663
      *                                                                   180663
     C                     Z-ADD@IVLN     @@IVLN 130                      180663
     C                     Z-ADDRNDNOM    @IVLN                           180663
     C**********           Z-ADDH@CINN    ROISSU                                       180663 CSD027
     C                     MOVELH@CINN    ROISSU                                              CSD027
      *                                                                   180663
      ** Process individual cheques bypassing existing ones               180663
      *                                                                   180663
     C           @@AMT     DOWLT@@IVLN                                    180663
     C**********           Z-ADDH@CINN    ROISSU                                       184553 CSD027
     C                     MOVELH@CINN    ROISSU                                              CSD027
     C                     Z-ADDH@CSNN    ROTCSN                          180663
     C           KSERE     CHAINRETCRDD0             70                   180663
     C           *IN70     IFEQ '1'                                       180663
     C                     EXSR WRTTCD                                    CRT002
      *                                                                   180663
      ** Update cheque book using correct starting number to allow for    180663
      ** previously used cheques and cheque books within range            180663
      *                                                                   180663
     C           KRCRE     SETLLRETCRCD0             71                   180663
     C           ROTCSN    DOUGERNSTCN                                    180663
     C           ROTCSN    ANDLERNETCN                                    180663
     C                     READ RETCRCD0                 71               180663
     C                     END                                            180663
      *                                                                   180663
      ** When cheque book has been found, update for each cheque          180663
      *                                                                   180663
     C           *IN71     IFEQ '0'                                       180663
     C                     EXSR UPDTCC                                    CRT002
     C                     END                                            180663
     C                     ADD  RNDNOM    @@AMT                           180663
     C                     END                                            180663
     C                     ADD  1         H@CSNN                          180663
     C                     END                                            180663
     C*                                                                   180663
     C/COPY WNCPYSRC,RE4111C006
     C                     END                                            CRT002
      *
      ** End of commitment cycle
     C           PMODE     IFEQ 'I'                                       CRT002
     C           CMTTXT    COMIT
     C                     END                                            CRT002
      *
     C                     ENDSR
      *****************************************************************
      *****************************************************************                       CCG016
      /EJECT                                                                                  CCG016
      *****************************************************************                       CCG016
      *                                                               *                       CCG016
      *            SNDUDC - Send advice to UDC                        *                       CCG016
      *                                                               *                       CCG016
      * CALLS      external pgm                                       *                       CCG016
      *                                                               *                       CCG016
      * CALLED BY  same as PRTTRN                                     *                       CCG016
      *                                                               *                       CCG016
      * FLDS USED         -                                           *                       CCG016
      *                                                               *                       CCG016
      *****************************************************************                       CCG016
     C           SNDUDC    BEGSR                                                              CCG016
      *                                                                                       CCG016
     C                     MOVELITLB      I#BRCT    P                                         CCG016
     C                     MOVELPTLID     I#TLID    P                                         CCG016
     C                     MOVELTBID      I#TBID    P                                         CCG016
     C                     MOVE TBTN      I#TBTN    P                                         CCG016
     C                     MOVELPFNCD     I#FUNC    P                                         CCG016
     C                     MOVEL'N'       I#CLOS    P                                         CCG016
     C                     MOVEL*ZEROS    I#CHQN                                              CCG016
     C           I#FUNC    IFEQ '0JV'                                                         CCG016
     C           I#FUNC    OREQ '00X'                                                         CCG016
     C                     MOVE SDCUS     I#CNUM                                              CCG016
     C                     MOVEL@DCUR     I#CCY                                               CCG016
     C                     MOVE SDAC      I#ACOD                                              CCG016
     C                     MOVE SDSEQ     I#ACSQ                                              CCG016
     C                     MOVEL@DBRCD    I#BRCA                                              CCG016
     C                     END                                                                CCG016
     C           I#FUNC    IFEQ '0JT'                                                         CCG016
     C           I#FUNC    OREQ '00S'                                                         CCG016
     C                     MOVE SCCUS     I#CNUM                                              CCG016
     C                     MOVEL@CCUR     I#CCY                                               CCG016
     C                     MOVE SCAC      I#ACOD                                              CCG016
     C                     MOVE SCSEQ     I#ACSQ                                              CCG016
     C                     MOVEL@CBRCD    I#BRCA                                              CCG016
     C                     END                                                                CCG016
     C                     MOVEL*ZEROS    I#ACNO    P                                         CCG016
     C                     MOVEL*ZEROS    I#CNU1                                              CCG016
     C                     MOVEL*BLANKS   I#CCY1                                              CCG016
     C                     MOVEL*ZEROS    I#ACO1                                              CCG016
     C                     MOVEL*ZEROS    I#ACS1                                              CCG016
     C                     MOVEL*BLANKS   I#BRC1                                              CCG016
     C                     MOVEL*ZEROS    I#ACN1                                              CCG016
     C                     MOVEL*ZEROS    I#CNU2                                              CCG016
     C                     MOVEL*BLANKS   I#CCY2                                              CCG016
     C                     MOVEL*ZEROS    I#ACO2                                              CCG016
     C                     MOVEL*ZEROS    I#ACS2                                              CCG016
     C                     MOVEL*BLANKS   I#BRC2                                              CCG016
     C                     MOVEL*ZEROS    I#ACN2                                              CCG016
     C                     Z-ADD@TAMT     I#AMNT                                              CCG016
     C                     MOVEL@CCUR     I#CCYT    P                                         CCG016
     C                     MOVELSNARR     I#NARR    P                                         CCG016
     C                     Z-ADD0         I#CHQA                                              CCG016
     C                     Z-ADD0         I#EXRT                                              CCG016
     C                     Z-ADD0         I#BUYA                                              CCG016
     C                     MOVEL*BLANKS   I#BUYC                                              CCG016
     C                     Z-ADD0         I#SELA                                              CCG016
     C                     MOVEL*BLANKS   I#SELC                                              CCG016
     C                     MOVE *BLANKS   I#NAR1                                              CCG016
     C                     MOVE *BLANKS   I#NAR2                                              CCG016
     C                     Z-ADD0         I#INTA                                              CCG016
     C                     MOVEL*BLANKS   I#INTC                                              CCG016
     C                     MOVEL*BLANKS   I#INTN                                              CCG016
     C                     Z-ADD0         I#TAXA                                              CCG016
     C                     MOVEL*BLANKS   I#TAXC                                              CCG016
     C                     MOVEL*BLANKS   I#TAXN                                              CCG016
     C                     Z-ADD0         I#CHGA                                              CCG016
     C                     MOVEL*BLANKS   I#CHGC                                              CCG016
     C                     MOVEL*BLANKS   I#CHGN                                              CCG016
     C                     Z-ADD0         I#TOTA                                              CCG016
     C                     MOVEL*BLANKS   I#TOTC                                              CCG016
     C                     MOVEL*BLANKS   I#TOTN                                              CCG016
      *                                                                                       CCG016
     C                     CALL 'CGC3605'                                                     CCG016
     C                     PARM '*PREPARE'ACTION  8                                           CCG016
      *                                                                                       CCG016
     C                     CALL 'CG0501'                                                      CCG016
     C                     PARM           W0RTN   7                                           CCG016
     C                     PARM 'YES'     W0CMT   3                                           CCG016
     C                     PARM *BLANKS   ##COPD  1                                           CCG016
     C                     PARM *BLANKS   ##AUTO  1                                           CCG016
     C                     PARM           I#PARM                                              CCG016
     C                     PARM           O#PARM                                              CCG016
      *                                                                                       CCG016
     C                     CALL 'CGC3604'                                                     CCG016
      *                                                                                       CCG016
     C           ##COPD    IFNE 'N'                                                           CCG016
     C                     CALL 'CGC0524'                                                     CCG016
     C                     PARM *BLANKS   W7A1    7                                           CCG016
     C                     PARM O#PARM    W50A1  50                                           CCG016
     C                     PARM *BLANKS   W10A1  10                                           CCG016
     C                     END                                                                CCG016
      *                                                                                       CCG016
     C                     ENDSR                                                              CCG016
      *****************************************************************                       CCG016
     C/COPY WNCPYSRC,RE4111C009
      /EJECT
      *****************************************************************
      *                                                               *
      *            WRTLPD - Write SDTELDPD Record                     *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  UPDRTN - Control rtn. for updates                  *
      *                                                               *
      *****************************************************************
     C           WRTLPD    BEGSR                           ** WRTLPD **
      *                                                                   CRT002
      ** If not the first time, delete previous overrides                 CRT002
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
      *                                                                   CRT002
     C           @CMD      IFNE *BLANKS                                   CRT002
     C                     MOVEL*BLANKS   @CMD                            CRT002
     C                     MOVEL@TXT,3    @CMD                            CRT002
     C                     CALL 'QCMDEXC'              70                 CRT002
     C                     PARM           @CMD                            CRT002
     C                     PARM 80        @LEN   155                      CRT002
      *                                                                   CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Perform override to PF/TTRANPD & open file                       CRT002
      *                                                                   CRT002
     C                     MOVEL*BLANKS   @CMD                            CRT002
     C                     MOVEL@TXT,1    @CMD                            CRT002
     C                     MOVEL'T'       @BRI                            CRT002
     C                     MOVEL@TLID     @BID                            CRT002
     C                     CALL 'QCMDEXC'              70                 CRT002
     C                     PARM           @CMD                            CRT002
     C                     PARM 80        @LEN   155                      CRT002
      *                                                                   CRT002
     C                     MOVEL'QCMDEXC' P@QRS                           CRT002
     C                     MOVEL@CMDT     P@QKY                           CRT002
     C                     EXSR DQERR                                     CRT002
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
     C                     OPEN TTRANPD                70                 CRT002
      *
      ** Acknowledged Flag will be processed from the transaction                             CRT006
      ** application data queue message if running in batch mode.                             CRT006
      ** Interactively, Acknowledged Flag will be set to 'Y'.                                 CRT006
     C           PMODE     IFEQ 'P'                                                           CRT006
     C                     MOVE RAACKF    ACKF                                                CRT006
     C                     ELSE                                                               CRT006
     C                     MOVE 'Y'       ACKF                                                CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     MOVEL'D'       RECI
     C                     MOVEL'T'       TBRI
     C                     MOVELPTLID     TBID
     C                     Z-ADDTTNATN    TBTN
     C                     MOVELPFNCD     FNCD
     C                     MOVELSCCY      CCY1
     C                     Z-ADD@TAMT     AMT1
     C                     MOVELSDCUS     CUS1
     C                     MOVELSDAC      ACD1
     C                     MOVELSDSEQ     ACSQ1
     C                     MOVEL@DBRCD    DBBRCA
     C                     MOVELSCCUS     CUS2
     C                     MOVELSCAC      ACD2
     C                     MOVELSCSEQ     ACSQ2
     C                     MOVEL@CBRCD    CRBRCA
     C                     MOVELSDEPC     DEPC
     C                     MOVELPTLBC     ITLB
     C                     MOVEL@JOB      TWID
     C                     TIME           TIME
     C**********           MOVELSOVTI     OVTI                                                CRT026
     C                     MOVEL@TELD     OVTI                                                CRT026
     C                     MOVEA@W,1      MSG1
     C                     MOVEA@W,10     MSG2
     C                     Z-ADDBJRDNB    VLDT
     C                     WRITETTRANPDF
      *
     C                     CLOSETTRANPD                70                 CRT002
      *                                                                   CRT002
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            UPTRL  - Update Control Trailer Record             *
      *                                                               *
      * CALLS      DBERR  - Database Error Handling                   *
      *                                                               *
      * CALLED BY  UPDRTN - Control rtn. for updates                  *
      *                                                               *
      *****************************************************************
     C           UPTRL     BEGSR                           ** UPTRL  **
      *                                                                   CRT002
      ** If not the first time, delete previous overrides                 CRT002
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
      *                                                                   CRT002
     C           @CMDT     IFNE *BLANKS                                   CRT002
     C                     MOVEL*BLANKS   @CMDT                           CRT002
     C                     MOVEL@TXT,4    @CMDT                           CRT002
     C                     CALL 'QCMDEXC'              70                 CRT002
     C                     PARM           @CMDT                           CRT002
     C                     PARM 80        @LEN   155                      CRT002
      *                                                                   CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Perform override to PF/TTRANPT & open file                       CRT002
      *                                                                   CRT002
     C                     MOVEL*BLANKS   @CMDT                           CRT002
     C                     MOVEL@TXT,2    @CMDT                           CRT002
     C                     MOVEL'T'       @BRIT                           CRT002
     C                     MOVEL@TLID     @BIDT                           CRT002
     C                     CALL 'QCMDEXC'              70                 CRT002
     C                     PARM           @CMDT                           CRT002
     C                     PARM 80        @LEN   155                      CRT002
      *                                                                   CRT002
     C                     MOVEL'QCMDEXC' P@QRS                           CRT002
     C                     MOVEL@CMDT     P@QKY                           CRT002
     C                     EXSR DQERR                                     CRT002
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
     C                     OPEN TTRANPT                70                 CRT002
      *
     C           1         CHAINTTRANPTF             70
      *
      ** If no record is present -
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA                        *************
     C                     Z-ADD3         DBASE            ** DB ERR 03 *
     C                     MOVEL'TTRANPT' DBFILE           *************
     C                     MOVEL'1       'DBKEY
     C                     EXSR DBERR
      *
     C                     ELSE
      *
     C                     ADD  1         NORE
     C                     UPDATTTRANPTF
      *
     C                     CLOSETTRANPT                70                 CRT002
      *                                                                   CRT002
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT                                                              CRT002
      *****************************************************************   CRT002
      *                                                               *   CRT002
      * MOVDTL  -  Move Details to Send to Outgoing DataQ             *   CRT002
      *                                                               *   CRT002
      * CALLS             -                                           *   CRT002
      *                                                               *   CRT002
      * CALLED BY  SCRINP -  Detail screen input (in P mode)          *   CRT002
      *                                                               *   CRT002
      *****************************************************************   CRT002
     C           MOVDTL    BEGSR                           ** MOVDTL **   CRT002
      *                                                                   CRT002
      **  Message Type and Host Message Id.                               CRT002
      *                                                                   CRT002
     C                     MOVELRAMSTY    RBMSTY                          CRT002
     C                     MOVEL*BLANKS   RBHMSI                          CRT002
      *                                                                   CRT002
      **  Terminal or Warning Errors Exist.                               CRT002
      *                                                                   CRT002
     C           @TI       IFGT 0                                         CRT002
     C           @WI       ORGT 0                                         CRT002
      *                                                                   CRT002
      ** Convert warning messages to Cashier Format                       CRT002
      *                                                                   CRT002
     C                     MOVEA*BLANKS   WMS1                            CRT002
     C                     MOVEA*BLANKS   WMS2                            CRT002
     C                     MOVEASMSG1     WMS1                            CRT002
     C                     Z-ADD1         X                               CRT002
      *                                                                   CRT002
     C           WMS1,X    DOWNE*BLANKS                                   CRT002
     C           X         ANDLE7                                         CRT002
      *                                                                   CRT002
     C           WMS1,X    LOKUPTABC1     TABC2          25               CRT002
     C           *IN25     IFEQ '1'                                       CRT002
     C                     MOVELTABC2     WMS2,X                          CRT002
     C                     ELSE                                           CRT002
     C                     MOVEL'CDNF'    WMS2,X                          CRT002
     C                     END                                            CRT002
     C                     ADD  1         X                               CRT002
      *                                                                   CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     SUB  1         X                               CRT002
     C                     MOVE X         WWNUM                           CRT002
     C                     MOVELWHSMS     RBHSMS                          CRT002
      *                                                                   CRT002
     C                     MOVEL'W'       RBHMSS                          CRT002
     C                     MOVEL'1'       RBAEFL                          CRT002
     C                     MOVEL'N'       WSUCM                           CRT002
      *                                                                   CRT002
     C           WFWST     IFEQ 'Y'                                       120880
     C                     MOVEL'S'       RBFPSF                          120880
     C                     ENDIF                                          120880
      *                                                                   120880
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
      **  Errors exist before detail screen appears.                      CRT002
      *                                                                   CRT002
     C           *IN50     IFEQ '1'                                       CRT002
     C                     MOVEL'E'       RBHMSS                          CRT002
     C                     MOVEL'1'       RBAEFL                          CRT002
      *                                                                   120880
     C           WFWST     IFEQ 'Y'                                       120880
     C                     MOVEL'E'       RBFPSF                          120880
     C                     ENDIF                                          120880
      *                                                                   120880
     C                     MOVE @MSGID    RBHMSI                          CRT002
     C                     MOVEL*BLANKS   @MSGDT                          CRT002
     C                     MOVEL'N'       WSUCM                           CRT002
      *                                                                   CRT002
     C                     EXSR RTVMSG                                    CRT002
     C                     MOVEL@MSGTX    RBHSMS                          CRT002
      *                                                                   CRT002
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
      **  Valid record received.                                          CRT002
      *                                                                   CRT002
     C           @TI       IFEQ 0                                         CRT002
     C           @WI       ANDEQ0                                         CRT002
     C           *IN50     ANDEQ'0'                                       CRT002
      *                                                                   CRT002
      **  Completed Severity.  Transaction Reference should be comprised  CRT002
      **  of the Teller Id and Transaction Number.                        CRT002
      *                                                                   CRT002
     C                     MOVEL'C'       RBHMSS                          CRT002
      *                                                                   120880
     C           WFWST     IFEQ 'Y'                                       120880
     C                     MOVEL'Y'       RBFPSF                          120880
     C                     MOVEL*BLANK    RBHMSS                          120880
     C                     ENDIF                                          120880
      *                                                                   120880
     C                     MOVELPTLID     @WRK8   8                       CRT002
     C                     MOVE TBTN      @WRK8                           CRT002
     C                     MOVEL@WRK8     RBTRN1                          CRT002
     C                     MOVEL'Y'       WSUCM                           CRT002
     C                     TIME           WTMDS                           CRT002
     C           WTHR      CAT  ':'       WA                              CRT002
     C           WTMN      CAT  ':'       WB                              CRT002
     C           WA        CAT  WB        WC                              CRT002
     C           WC        CAT  WTSS      WCMTM                           CRT002
      *                                                                   CRT002
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
     C                     MOVEL'DS'      WSTAT                           CRT002
     C                     TIME           WTMDS                           CRT002
     C           WTHR      CAT  ':'       WA                              CRT002
     C           WTMN      CAT  ':'       WB                              CRT002
     C           WA        CAT  WB        WC                              CRT002
     C           WC        CAT  WTSS      WSTTM                           CRT002
     C                     MOVELRABRNM    WBRCA                           CRT002
      *                                                                   CRT002
     C                     ENDSR                                          CRT002
      *****************************************************************   CRT002
      /EJECT                                                              CRT002
      *****************************************************************   CRT002
      *                                                               *   CRT002
      *            WRTTCD - Write travellers cheque register detail   *   CRT002
      *                                                               *   CRT002
      * CALLS             -                                           *   CRT002
      *                                                               *   CRT002
      * CALLED BY  UPDRTN - Control rtn. for updates                  *   CRT002
      *                                                               *   CRT002
      *****************************************************************   CRT002
     C           WRTTCD    BEGSR                           ** WRTTCD **   CRT002
      *                                                                   CRT002
     C**********           Z-ADDH@CINN    ROISSU                                       CRT002 CSD027
     C                     MOVELH@CINN    ROISSU                                              CSD027
     C                     Z-ADDH@CSNN    ROTCSN                          CRT002
     C                     MOVELSFCN      ROTCNO                          CRT002
     C                     MOVELSBNM      ROBYNM                          CRT002
     C                     MOVELSBIT      ROIDTP                          CRT002
     C                     MOVELSBIN      ROBYID                          CRT002
      *                                                                   CRT002
     C                     Z-ADDBJRDNB    ROSOLD                          CRT002
     C                     MOVELPTLBC     ROBRCA                          CRT002
     C                     MOVE 'Y'       ROTCSE                          CRT002
     C                     MOVE 'I'       ROCHTP                          CRT002
     C                     Z-ADDBJRDNB    ROLCD                           CRT002
     C                     WRITERETCRDD0                                  CRT002
      *                                                                   CRT002
     C                     ENDSR                                          CRT002
      *****************************************************************   CRT002
      /EJECT                                                              CRT002
      *****************************************************************   CRT002
      *                                                               *   CRT002
      *            UPDTCC - Update travellers cheque register control *   CRT002
      *                                                               *   CRT002
      * CALLS             -                                           *   CRT002
      *                                                               *   CRT002
      * CALLED BY  UPDRTN - Control rtn. for updates                  *   CRT002
      *                                                               *   CRT002
      *****************************************************************   CRT002
     C           UPDTCC    BEGSR                           ** UPDTCC **   CRT002
      *                                                                   CRT002
     C           KSERN     KLIST                                          CRT002
     C                     KFLD           RNISSU                          CRT002
     C                     KFLD           RNSTCN                          CRT002
      *                                                                   CRT002
      ** If the cheque serial no is valid, the last read record in        CRT002
      ** RETCRCL0 (subr VALCQS) is the one to be amended.                 CRT002
      *                                                                   CRT002
     C           RNBSTS    IFEQ 'U'                                       CRT002
     C                     MOVE 'P'       RNBSTS                          CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C           RNBSTS    IFEQ 'P'                                       CRT002
     C           KSERN     SETLLRETCRDD0             70                   CRT002
     C                     READ RETCRDD0                 70               CRT002
     C                     Z-ADDRNSTCN    H@SERN 120                      CRT002
      *                                                                   CRT002
     C           RNISSU    DOWEQROISSU                                    CRT002
     C           H@SERN    ANDLERNETCN                                    CRT002
     C           *IN70     ANDEQ'0'                                       CRT002
      *                                                                   CRT002
      ** The range of chq serial no is all used up                        CRT002
      *                                                                   CRT002
     C           H@SERN    IFEQ ROTCSN                                    CRT002
     C           H@SERN    ANDEQRNETCN                                    CRT002
     C                     MOVE 'S'       RNBSTS                          CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** A still available chq serial no was found                        CRT002
      *                                                                   CRT002
     C           H@SERN    IFNE ROTCSN                                    CRT002
     C                     LEAVE                                          CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     ADD  1         H@SERN                          CRT002
     C                     READ RETCRDD0                 70               CRT002
      *                                                                   CRT002
     C                     END                                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Update cheque sold status array                                  CRT002
      *                                                                   CRT002
     C                     MOVEARNCOPS    @CA,1                           CRT002
      *                                                                   CRT002
      ** Calculate cheque presented status array index                    CRT002
      *                                                                   CRT002
     C           H@CSNN    SUB  RNSTCN    @OFSET  80                      CRT002
     C           @OFSET    DIV  8         @I      20                      CRT002
     C                     MVR            @BITN   10                      CRT002
     C                     ADD  1         @I                              CRT002
      *                                                                   CRT002
     C           @BITN     IFEQ 0                                         CRT002
     C                     BITON'0'       @CA,@I                          CRT002
     C                     END                                            CRT002
     C           @BITN     IFEQ 1                                         CRT002
     C                     BITON'1'       @CA,@I                          CRT002
     C                     END                                            CRT002
     C           @BITN     IFEQ 2                                         CRT002
     C                     BITON'2'       @CA,@I                          CRT002
     C                     END                                            CRT002
     C           @BITN     IFEQ 3                                         CRT002
     C                     BITON'3'       @CA,@I                          CRT002
     C                     END                                            CRT002
     C           @BITN     IFEQ 4                                         CRT002
     C                     BITON'4'       @CA,@I                          CRT002
     C                     END                                            CRT002
     C           @BITN     IFEQ 5                                         CRT002
     C                     BITON'5'       @CA,@I                          CRT002
     C                     END                                            CRT002
     C           @BITN     IFEQ 6                                         CRT002
     C                     BITON'6'       @CA,@I                          CRT002
     C                     END                                            CRT002
     C           @BITN     IFEQ 7                                         CRT002
     C                     BITON'7'       @CA,@I                          CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     MOVEA@CA,1     RNCOPS                          CRT002
      *                                                                   CRT002
     C                     MOVE 'A'       RNCHTP                          CRT002
     C                     Z-ADDBJRDNB    RNLCD                           CRT002
     C                     UPDATRETCRCD0                                  CRT002
      *                                                                   CRT002
     C                     ENDSR                                          CRT002
      *****************************************************************   CRT002
      /EJECT
      *****************************************************************
      *                                                               *
      *            PCMTXT - Prepare comit text                        *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  UPDRTN - Control rtn. for updates                  *
      *                                                               *
      *****************************************************************
     C           PCMTXT    BEGSR                           ** PCMTXT **
      *
      ** Prepare the comit text CMTTXT
     C                     MOVE 'RE'      MDID
     C                     MOVEL@PGM      PGMN
     C                     MOVE SWID      WSIDX
     C                     MOVELSCCY      @CMCCY
     C                     TIME           MTIME
     C                     MOVE @USER     USRIDX
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            LAST   - Final processing - terminate pgm.         *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  MAIN   - Control Process                           *
      *            SCRINP - Detail screen input                       *
      *            TRNOVR - Transaction override process              *
      *                                                               *
      *****************************************************************
     C           LAST      BEGSR                           ** LAST   **
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            *PSSR  - Program error                             *
      *                                                               *
      * CALLS      DBERRCTL                                           *
      *                                                               *
      * CALLED BY  DBERR  - Database Error Handling                   *
      *                                                               *
      *****************************************************************
     C           *PSSR     BEGSR                           ** *PSSR  **
      *
     C** Check to see that *PSSR has not been called yet
     C*
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     SETON                     U7U8LR
     C                     DUMP
     C*
     C** Call standard database error program
     C*
     C           PMODE     IFEQ 'I'                                       CRT002
     C                     CALL 'DBERRCTL'
     C                     END                                            CRT002
      *                                                                   CRT002
     C           PMODE     IFEQ 'P'                                       CRT002
     C           @FIRST    ANDEQ'0'                                       CRT002
      *                                                                   CRT002
     C                     ROLBK                                          CRT002
      *                                                                   CRT002
     C                     MOVELRAMSTY    RBMSTY                          CRT002
     C                     MOVELDBLOT     RBHSMS                          CRT002
     C                     MOVEL'DBER'    RBHMSI                          CRT002
     C                     MOVEL'1'       RBAEFL                          CRT002
     C                     MOVEL'E'       RBHMSS                          CRT002
      *                                                                   CRT002
     C                     CLEARLOGDS                                     CRT002
      *                                                                   CRT002
     C                     MOVEL'USR0010' @MSGID                          CRT002
     C                     MOVELDBLOT     @MSGDT                          CRT002
     C                     EXSR RTVMSG                                    CRT002
     C                     MOVEL@MSGTX    RBHSMS                          CRT002
      *                                                                   CRT002
     C                     MOVE RACMSQ    WCMSQ                           CRT002
     C                     MOVELRABRNM    WBRCA                           CRT002
     C                     MOVELRAUSID    WUSID                           CRT002
     C                     MOVE 'N'       WSUCM                           CRT002
     C                     MOVE 'DS'      WSTAT                           CRT002
     C                     TIME           WTMDS                           CRT002
     C           WTHR      CAT  ':'       WA                              CRT002
     C           WTMN      CAT  ':'       WB                              CRT002
     C           WA        CAT  WB        WC                              CRT002
     C           WC        CAT  WTSS      WSTTM                           CRT002
      *                                                                   CRT002
     C                     MOVELREPOIO    P@QDS                           CRT002
      *                                                                   CRT002
     C                     CLEARWCMSG                                     CRT002
     C                     MOVELREPOIO    WCMSG                           CRT002
      *                                                                   CRT002
     C                     EXSR SDQMS                                     CRT002
     C                     EXSR DQERR                                     CRT002
     C                     EXSR WRLOG                                     CRT002
     C                     EXSR PCMTXT                                    CRT002
     C           CMTTXT    COMIT                                          CRT002
     C                     MOVEL*BLANKS   REPOIO                          CRT002
      *                                                                   CRT002
     C                     ENDIF                                          CRT002
     C*
     C                     END
     C*
     C** If *PSSR already run, then just end the program here
     C*
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            FIRST  - Initial Processing                        *
      *                                                               *
      * CALLS      DBERR  - Database Error Handling                   *
      *            IFLDS  - Initialize screen/work fields             *
      *            INT01  - Initialise error indicators               *
      *            ZA0150 - Get Midas Rundate & Setup Indicator       *
      *                                                               *
      * CALLED BY  MAIN   - Control Process                           *
      *                                                               *
      *****************************************************************
     C           FIRST     BEGSR                           ** FIRST  **
      *
      ** Input parameter(s) :
     C           *ENTRY    PLIST                           Entry parameter list
     C                     PARM           PFNCD   3        Function code
     C                     PARM           PMODE   1        Processing ModeCRT002
      *
      ** Define Keylist(s)
      *
      ** Account master
     C           KLACNT    KLIST
     C                     KFLD           @CNUM
     C                     KFLD           @CCY
     C                     KFLD           @ACOD
     C                     KFLD           @ACSQ
     C                     KFLD           @BRCD                           098801
     C*
     C/COPY WNCPYSRC,RE4111CCP2
     C*
      *
      ** Retrieve RTS job dataarea
     C           *NAMVAR   DEFN           RTSDTA
     C                     IN   RTSDTA
     C           PMODE     IFEQ 'I'                                       CRT002
     C                     MOVELPTLID     @TLID
     C                     ENDIF                                          CRT002
      *
      * Prepare LDA
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVEL*BLANK    DBLOT
     C                     OUT  LDA
      *                                                                                       CRT026
      ** Check if CRT026 is switched on                                                       CRT026
      *                                                                                       CRT026
     C                     CALL 'AOSARDR0'                                                    CRT026
     C                     PARM *BLANKS   @RTCD   7                                           CRT026
     C                     PARM '*VERIFY' @OPTN   7                                           CRT026
     C                     PARM 'CRT026'  @SARD   6                                           CRT026
     C           SCSARD    PARM SCSARD    DSFDY                                               CRT026
      *                                                                                       CRT026
     C           @RTCD     IFNE *BLANKS                                                       CRT026
     C           @RTCD     ANDNE'*NRF   '                                                     CRT026
     C           *LOCK     IN   LDA                                                           CRT026
     C                     MOVEL'SCSARDPD'DBFILE           ***************                    CRT026
     C                     Z-ADD10        DBASE            ** DB ERR 10 **                    CRT026
     C                     MOVEL'CRT026'  DBKEY            ***************                    CRT026
     C                     EXSR DBERR                                                         CRT026
     C                     ENDIF                                                              CRT026
      *                                                                                       CRT026
     C           @RTCD     IFEQ *BLANKS                                                       CRT026
     C                     MOVE 'Y'       CRT026  1                                           CRT026
     C                     ELSE                                                               CRT026
     C                     MOVE 'N'       CRT026                                              CRT026
     C                     ENDIF                                                              CRT026
      *                                                                                       CCG016
      ** Check if CCG016 is switched on                                                       CCG016
      *                                                                                       CCG016
     C                     CALL 'AOSARDR0'                                                    CCG016
     C                     PARM *BLANKS   @RTCD   7                                           CCG016
     C                     PARM '*VERIFY' @OPTN   7                                           CCG016
     C                     PARM 'CCG016'  @SARD   6                                           CCG016
     C           SCSARD    PARM SCSARD    DSFDY                                               CCG016
      *                                                                                       CCG016
     C           @RTCD     IFNE *BLANKS                                                       CCG016
     C           @RTCD     ANDNE'*NRF   '                                                     CCG016
     C           *LOCK     IN   LDA                                                           CCG016
     C                     MOVEL'SCSARDPD'DBFILE           ***************                    CCG016
     C                     Z-ADD11        DBASE            ** DB ERR 10 **                    CCG016
     C                     MOVEL'CCG016'  DBKEY            ***************                    CCG016
     C                     EXSR DBERR                                                         CCG016
     C                     ENDIF                                                              CCG016
      *                                                                                       CCG016
     C           @RTCD     IFEQ *BLANKS                                                       CCG016
     C                     MOVE 'Y'       CCG016  1                                           CCG016
     C                     ELSE                                                               CCG016
     C                     MOVE 'N'       CCG016                                              CCG016
     C                     ENDIF                                                              CCG016
      *                                                                   CRT002
      ** If PMODE = 'I', open display file RE4111DF                       CRT002
      *                                                                   CRT002
     C           PMODE     IFEQ 'I'                                       CRT002
     C                     OPEN RE4111DF                                  CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Initialise MSG text and MSG return code                          CRT002
      *                                                                   CRT002
     C                     MOVE *BLANKS   @MSGTX                          CRT002
      *                                                                   CRT002
      ** Initialise MSDID and MSG file fields                             CRT002
      *                                                                   CRT002
     C                     MOVE *BLANKS   @MSGID                          CRT002
     C                     MOVEL'RTSMSGF' @MSGF                           CRT002
      *                                                                   CRT002
     C                     MOVE '1'       @FIRST  1                       CRT002
     C*
     C**  Initialize parameters for SCC0240- build program message Q
     C*
     C                     MOVE *BLANKS   @MSGID  7
     C                     MOVEL'RTSMSGF' @MSGF  10
      *
      ** Set Cash In/Out indicator (0JT - cash in, 0JV - cash out)
     C           PFNCD     IFEQ '0JV'
     C           PFNCD     OREQ '00S'                                     CRT002
     C                     SETON                     09
     C                     END
      *                                                                   CRT002
      ** Set Buying Travellers Cheque For Cash in Cash Ccy indicator      CRT002
     C           PFNCD     IFEQ '00S'                                     CRT002
     C                     MOVE '1'       *IN40                           CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Set Selling Travellers Cheque For Cash in Cash Ccy indicator     CRT002
     C           PFNCD     IFEQ '00X'                                     CRT002
     C                     MOVE '1'       *IN41                           CRT002
     C                     END                                            CRT002
      *
      ** Initialize screen message queue
     C                     MOVEL'*'       SPGMQ
      *
      ** Seton  message subfile end indicator
     C                     MOVE '1'       *IN10
      *
     C                     MOVEL@JOB      SWID
     C                     MOVEL@USER     SUSER
     C                     MOVE *BLANKS   SMRDT
      *
     C** Call subroutine to access sdbankpd for Midas Run Date.
     C                     EXSR ZA0150
      *
      ** Move midas run date to screen field
     C                     MOVELBJMRDT    SMRDT
     C/COPY WNCPYSRC,RE4111C005
     C*
     C**  Access function code details
     C*
     C                     CALL 'AOFNCDR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM PFNCD     @FNCD   3
     C           SDFNCD    PARM SDFNCD    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD4         DBASE            ***************
     C                     MOVEL'SDFNCDPD'DBFILE           *DB ERROR 004 *
     C                     MOVEL@FNCD     DBKEY            ***************
     C                     EXSR DBERR
     C                     END
      *
      ** Store validation indicators in an array
     C                     MOVEAFQVWIN    @V
     C*
     C**  Access retail transaction details for debit transaction code 1
     C*
     C                     CALL 'AORETRR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY  '  @OPTN   7
     C                     PARM FQDRC1    @RTTY   5
     C           SDRETR    PARM SDRETR    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD5         DBASE            ***************
     C                     MOVEL'SDRETRPD'DBFILE           *DB ERROR 005 *
     C                     MOVEL@RTTY     DBKEY            ***************
     C                     EXSR DBERR
      *
     C                     ELSE
      *
      ** Store dr/cr,cash,clearing & reversal indicators for later use
     C                     MOVEL' '       @DRVIN  1
     C                     MOVELA1DCIN    @DDCIN  1
     C                     MOVELA1CIND    @DCSIN  1
     C                     MOVELA1CLIN    @DCLIN  1
     C           PFNCD     IFEQ '00S'                                     CRT002
     C**********           MOVELA1ASGL    @DASGL  4                                    CRT002 CGL029
     C                     MOVELA1ASGL    @DASGL 10                                           CGL029
     C                     END                                            CRT002
      *
     C                     END
     C*
     C**  Access retail transaction details for credit transaction code 1
     C*
     C                     CALL 'AORETRR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY  '  @OPTN   7
     C                     PARM FQCRC1    @RTTY   5
     C           SDRETR    PARM SDRETR    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD6         DBASE            ***************
     C                     MOVEL'SDRETRPD'DBFILE           *DB ERROR 006 *
     C                     MOVEL@RTTY     DBKEY            ***************
     C                     EXSR DBERR
      *
     C                     ELSE
      *
      ** Store dr/cr,cash,clearing & reversal indicators for later use
     C                     MOVEL' '       @CRVIN  1
     C                     MOVELA1DCIN    @CDCIN  1
     C                     MOVELA1CIND    @CCSIN  1
     C                     MOVELA1CLIN    @CCLIN  1
     C           PFNCD     IFEQ '00X'                                     CRT002
     C**********           MOVELA1ASGL    @CASGL  4                                    CRT002 CGL029
     C                     MOVELA1ASGL    @CASGL 10                                           CGL029
     C                     END                                            CRT002
      *
     C                     END
     C*
     C**  Access teller branch details
     C*
     C           PMODE     IFEQ 'I'                                       CRT002
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY  '  @OPTN   7
     C                     PARM PTLBC     @BRCD   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD7         DBASE            ***************
     C                     MOVEL'SDBRCHPD'DBFILE           *DB ERROR 007 *
     C                     MOVEL@BRCD     DBKEY            ***************
     C                     EXSR DBERR
     C                     END
     C                     END                                            CRT002
      *
      ** Initialise all screen/work fields and indicators
     C                     EXSR INT01
     C                     EXSR IFLDS
      *
      ** Initialise fields for narrative output
     C                     MOVE '/'       @@SLSH
     C                     MOVE '_'       @@UNDS
      *
      ** Set GL CASH IN/OUT INDICATOR
     C/COPY WNCPYSRC,RE4111C010
      ** and Buying/Selling Travellers Cheques For Cash in Cash Ccy Ind   CRT002
     C           PFNCD     IFEQ '0JT'
     C           PFNCD     OREQ '00X'                                     CRT002
     C                     SETON                     35
     C                     ELSE
     C                     SETON                     36
     C                     END
     C*
     C**  Clear program message queue and terminal & warning msg. lines
     C*
     C                     CALL 'SCC0250'
      *                                                                   CRT002
      ** Load tellers to array.                                           CRT002
      *                                                                   CRT002
     C                     EXSR LODTLR                                    CRT002
      *                                                                   CRT002
     C                     MOVE '0'       @FIRST                          CRT002
      *                                                                   CRT002
     C                     SELEC                                          CRT002
      *                                                                   CRT002
      **  Buy Travellers Cheque in Cash Currency                          CRT002
      *                                                                   CRT002
     C           PFNCD     WHEQ '00S'                                     CRT002
     C                     MOVEL'RE4111'  P@QRC                           CRT002
     C                     MOVE '00S '    P@QRC                           CRT002
      *                                                                   CRT002
      **  Sell Travellers Cheque in Cash Currency                         CRT002
      *                                                                   CRT002
     C           PFNCD     WHEQ '00X'                                     CRT002
     C                     MOVEL'RE4111'  P@QRC                           CRT002
     C                     MOVE '00X '    P@QRC                           CRT002
      *                                                                   CRT002
     C                     ENDSL                                          CRT002
      *                                                                   CRT002
     C/COPY ZSRSRC,RBOITMC1                                               CRT002
      *                                                                   CRT002
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            IFLDS  - Initialize screen/work fields             *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  FIRST  - Initial Processing                        *
      *            RFRESH - Refresh screen                            *
      *                                                               *
      *****************************************************************
     C           IFLDS     BEGSR                           ** IFLDS  **
      *
     C           *IN22     IFEQ '0'
     C                     MOVE *BLANKS   SCCY
     C                     END
      *
     C           *IN09     IFEQ '1'
     C                     MOVE *BLANKS   SDCUS
     C                     MOVE *BLANKS   SDAC
     C                     MOVE *BLANKS   SDSEQ
     C                     ELSE
     C                     MOVE *BLANKS   SCCUS
     C                     MOVE *BLANKS   SCAC
     C                     MOVE *BLANKS   SCSEQ
     C                     END
      *
     C                     MOVE *BLANKS   SAMT
     C                     MOVE PDEPC     SDEPC
     C                     MOVE *BLANKS   SOVTI
     C                     MOVE *BLANKS   SOVPC
     C                     MOVE *BLANKS   SOVUR                                               CRT026
     C                     MOVE *BLANKS   SOVPW                                               CRT026
     C                     MOVE *BLANKS   @W
     C                     MOVE *BLANKS   @T
     C                     Z-ADD1         @COUNT  10
     C                     MOVE *BLANKS   SNARR
      *                                                                   CRT002
     C           PFNCD     IFEQ '00X'                                     CRT002
     C                     MOVE *BLANKS   SCIN                            CRT002
     C                     MOVE *BLANKS   SCSN                            CRT002
     C                     MOVE *BLANKS   SBIT                            CRT002
     C                     MOVE *BLANKS   SBIN                            CRT002
     C                     MOVE *BLANKS   SBNM                            CRT002
     C                     MOVE *BLANKS   SFCN                            CRT002
     C                     END                                            CRT002
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            ZA0150 - Get Midas Rundate & Setup Indicator       *
      *                                                               *
      * CALLS      DBERR  - Database Error Handling                   *
      *                                                               *
      * CALLED BY  FIRST  - Initial Processing                        *
      *                                                               *
      *****************************************************************
     C           ZA0150    BEGSR                           ** ZA0150 **
     C*
     C** Access bank details for the run date
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     MOVEL'*FIRST'  DBKEY            * DBERR 008*
     C                     Z-ADD8         DBASE            ************
     C                     EXSR DBERR
     C                     END
     C*
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SNDMSG - Send program message parameters           *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  VALACC - Validate a/c number                       *
      *            VALAMT - Validate amount                           *
      *            VALDET - Validate Details                          *
      *            VOVDET - Validate override details                 *
      *                                                               *
      *****************************************************************
     C           SNDMSG    BEGSR                           ** SNDMSG **
     C*
     C                     CALL 'SCC0240'
     C                     PARM           @MSGID
     C                     PARM           @MSGF
      *                                                                   CRT002
     C*
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            DBERR  - Database Error Handling                   *
      *                                                               *
      * CALLS      *PSSR  - Program  error                            *
      *                                                               *
      * CALLED BY  FIRST  - Initial Processing                        *
      *            UPDRTN - Control rtn. for updates                  *
      *            UPTRL  - Update Control Trailer Record             *
      *            ZA0150 - Get Midas Rundate & Setup Indicator       *
      *                                                               *
      *****************************************************************
     C           DBERR     BEGSR                           ** DBERR  **
      *
     C                     MOVEL@PGM      DBPGM
     C                     OUT  LDA
      *
     C                     EXSR *PSSR
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
     C*
     C/COPY WNCPYSRC,RE4111CCP3
     C*
      ** SR.ZALIGN subroutine
      /COPY ZSRSRC,ZALIGNZ2
      *
      *****************************************************************
      /EJECT                                                              CRT002
      ** SR.ZEDIT subroutine                                              CRT002
      /COPY ZSRSRC,ZEDITZ2                                                CRT002
      *                                                                   CRT002
      *****************************************************************   CRT002
      /EJECT
      ** SR.ZTNLU1 subroutine
      /COPY ZSRSRC,ZTNLU1Z2
      *
      *****************************************************************
      /EJECT
      ** SR.ZFRPED Subroutine
      /COPY ZSRSRC,ZFRPEDZ3
      *
      *****************************************************************
      /EJECT
      ** SR.RTTCCY Subroutine
      /COPY ZSRSRC,RTTCCYC1
      *
      *****************************************************************
      /EJECT
      /COPY ZSRSRC,RTTWIDC1
      ** Array for SR.RTTWID
      *****************************************************************
      /EJECT
      ** SR.RTACLG Subroutine
      /COPY ZSRSRC,RTACLGC1
      *****************************************************************
      /EJECT
      ** SR.RTTOTS Subroutine
      /COPY ZSRSRC,RTTOTSC1
     C/COPY WNCPYSRC,RE4111C011
      *
      *****************************************************************
      /EJECT                                                              CRT002
      /COPY ZSRSRC,RBSDQMS                                                CRT002
      *                                                                   CRT002
      /EJECT                                                              CRT002
      /COPY ZSRSRC,RBRDQMS                                                CRT002
      *                                                                   CRT002
      /EJECT                                                              CRT002
      /COPY ZSRSRC,RBDQERR                                                CRT002
      *                                                                   CRT002
      /EJECT                                                              CRT002
      /COPY ZSRSRC,RBRMSGC1                                               CRT002
      *                                                                   CRT002
      /EJECT                                                              CRT002
      /COPY ZSRSRC,RBWLOGC1                                               CRT002
      *                                                                   CRT002
      /EJECT                                                              CRT002
      /COPY ZSRSRC,RBLDTLC1                                               CRT002
      *                                                                   CRT002
      /EJECT                                                              CRT002
      ** SR.VALCQS Subroutine                                             CRT002
      /COPY ZSRSRC,RBSLTCC1                                               CRT002
      *                                                                   CRT002
      *****************************************************************   CRT002
      /EJECT
      /COPY ZSRSRC,RTENCPC1
      ** Passcode encription
      /EJECT
      /COPY ZSRSRC,RTTLMTC1                                               104034
      ** Teller limit check                                               104034
      *                                                                   104034
      *****************************************************************   169719
      /EJECT                                                              169719
      /COPY ZSRSRC,RTCASHC1                                               169719
      ** Excess cash check                                                169719
      *                                                                   169719
      *****************************************************************   104034
      /EJECT                                                              104034
      /COPY ZSRSRC,RTCCYSC1                                               104034
      ** Currency setup and retrieval                                     104034
      *                                                                   104034
      *****************************************************************   104034
      /EJECT                                                              104034
      /COPY ZSRSRC,RTLCNVC1                                               104034
      ** Local currency conversion                                        104034
      *                                                                   104034
      *****************************************************************   104034
      /EJECT                                                              104034
      *****************************************************************
      *
      ** Teller totals
     OTTRNTM2FE                @RELTT
      *                                                                   169719
      ** Teller totals                                                    169719
     OTTRNTM3FE                @RELT3                                     169719
      *****************************************************************
      *                                                                   S01408
     O/COPY WNCPYSRC,RE4111OOP1                                           S01408
** - @P   - Array to hold the positions of the validation indicators
01020304050607080910111213141516171819202122232425
**  alphanumeric table
ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789
**  encription code table
SDKJFIENVQPWOCMUXZ293847501LRBAGYHT6ZSDKJ
FIENVQPWOCMUXZ293847501LRBAGYHT6ZSDKJFIEN
** @TXT - Large text strings                                              CRT002
OVRDBF     FILE(TTRANPD) MBR(XXXX) SECURE(*YES) SHARE(*YES) SEQONLY(*NO)
OVRDBF     FILE(TTRANPT) MBR(XXXX) SECURE(*YES) SHARE(*YES) SEQONLY(*NO)
DLTOVR     FILE(TTRANPD)
DLTOVR     FILE(TTRANPT)
**  WTEXT WARNING TEXT MESSAGE                                            CRT002
KSM2329  Multiple referrals exist ( ) -                                   CRT002
**  TABC1/TABC2 - WARNING MESSAGE CONVERTION TABLE                        CRT002
HOLDS   HLDS                                                              CRT002
EXCESS  EXCS                                                              CRT002
FLOAT   FLOT                                                              CRT002
CLS.O/D CSOD                                                              CRT002
SVG.O/D SVOD                                                              CRT002
MAX.CCY MXCY                                                              CRT002
CHQBKER CQBK                                                              CRT002
N.S.F.  NSF                                                               CRT002
EX.O/D  EXOD                                                              CRT002
BLW.MIN BLMN                                                              CRT002
AC.CLG  ACCL                                                              CRT002
N.ASGL1 NAG1                                                              CRT002
N.ASGL2 NAG2                                                              CRT002
N.ASGL3 NAG3                                                              179321
BADDPT  BDDT                                                              CRT002
BLOCKCR BLCR                                                              CRT002
BLOCKDR BLDR                                                              CRT002
BNKRPT  BKRP                                                              CRT002
BR.DIF  BRDF                                                              CRT002
BR.DIF1 BRD1                                                              190137
BR.DIF2 BRD2                                                              190137
BFBVIC  BVCQ                                                              CRT002
CHQPRES CQPR                                                              CRT002
CHQRNG  CQRN                                                              CRT002
INACTV  INAC                                                              CRT002
INACTV1 INA1                                                              179321
INACTV2 INA2                                                              179321
REFERCR RFCR                                                              CRT002
REFERDR RFDR                                                              CRT002
STOPCHQ STCQ                                                              CRT002
TLIMIT  TLLM                                                              CRT002
N.WKDAY NWKD                                                              CRT002
XRTWARN XRTW                                                              CRT002
TLIMIT1 TLLM                                                              142092
TLIMIT2 TLLM                                                              142092
CLOSED  CLOS                                                              142092
BLOCKED BLOK                                                              142092
NOTZERO NZRO                                                              142092
BR.OFF  BOFF                                                              CRT007
BR.OFF1 BOF1                                                              CRT007
BR.OFF2 BOF2                                                              CRT007
