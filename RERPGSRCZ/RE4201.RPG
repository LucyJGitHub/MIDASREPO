     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Teller transaction entry generation')         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Retail Module                                        *
     F*                                                               *
     F*  RE4201 - Teller Transaction Entry Generation                 *
     F*                                                               *
     F*  Function:  This program will generate accounting entries     *
     F*  (I/C)      for teller transactions input, and also write     *
     F*             to the interbranch posting file for any           *
     F*             interbranch transactions.                         *
     F*                                                               *
     F*  Called By: Teller Transaction Entry Generation               *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *                                                               *
      *  Last Amend No. 252591             Date 08Jun20               *
      *  Prev Amend No. MD055860           Date 05Jun20               *                                                  
      *  Prev Amend No. MD055557           Date 13Apr20               *
      *                 MD054623           Date 14Jan19               *
      *                 MD046248           Date 27Oct17               *
      *                 CGL154             Date 13Oct14               *
      *                 CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP204             Date 09Feb10               *
      *                 BUG27119           Date 24Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 244720             Date 27Jun07               *
      *                 249906             Date 24Aug07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 243652             Date 20Nov06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG9062 (Reopen)   Date 20Jun06               *
      *                 BUG9062            Date 20Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG7675            Date 12Oct05               *
      *                 BUG8510            Date 05Oct05               *
      *                 BUG8553            Date 28Sep05               *
      *                 BUG8080            Date 15Aug05               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG4311            Date 23Sep04               *
      *                 BUG3526            Date 06Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CRE019             Date 12Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CRT012             Date 26Nov02               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 202295             Date 02Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CRT005             Date 09Aug01               *
      *                 197289             Date 31Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 195607             Date 12Jul01               *
      *                 190687             Date 05Mar01               *
      *                 151104             Date 15Jun01               *
      *                 189955             Date 22Nov00               *
      *                 139524             Date 22Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 163729             DATE 13Jun00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 153249             DATE 05Oct99               *
      *                 164970             Date 28Jul99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 153393             Date 17Sep99               *
      *                 151095             Date 17Sep99               *
      *                 159167             DATE 17Sep99               *
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 02MAR99               *
      *                 142084             DATE 29Mar99               *
      *                 CTI002             DATE 09Sep98               *
      *                 146200             Date 05Oct98               *
      *                 147070             Date 09Nov98               *
      *                 141386             Date 27Aug98               *
      *                 CEU025             Date 31Aug98               *
      *                 140953             Date 19Aug98               *
      *                 140254             Date 06Aug98               *
      *                 CEU024             Date 14Jul98               *
      *                 130021             Date 05Feb98               *
      *                 130020             Date 02Feb98               *
     F*                 109175             DATE 16Feb98               *
     F*                 125391             Date 07Nov97               *
     F*                 118271             Date 02Jun97               *
     F*                 109102             DATE 13MAY97               *
     F*                 094753             DATE 18MAR97               *
     F*                 107926             Date 16SEP96               *
     F*                 CRT002             Date  1DEC95               *
     F*                 096179             Date 21NOV95               *
     F*                 CAC002             DATE 15SEP96               *
     F*                 100002             DATE 11JUN96               *
     F*                 097905             DATE 03JUN96               *
     F*                 S01408             DATE 17APR96               *
     F*                 093749             DATE 17SEP95               *
     F*                 091241             DATE 17JUL95               *
     F*                 CRT001  *CREATE    DATE 28FEB95               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  252591 - INCORRECT MARGIN CALCULATION                        *
      *         - Removed the unncessary adjustment of decimal places *
      *           of subroutines SRMACC and SRMALC to calculate the   *
      *           margin amount of the transaction.                   *
      *         - Applied for MD-55876.                               *
      *  MD055557 - GLC4114 00003 Halted during COB due to FOOB.      *
      *             Ensure correct LF override when FNCD = '***'.     *
      *             Switch on U7 and U8 for correct error handling.   *
      *  MD054623 - Use the format 'Transation Number/Teller ID +     *
      *             Narrative or Transaction Title if the             *
      *             RTSNarrFormat = 'Y'                               *
      *             Applied for MD055669                              *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CAP204 - Teller Related APIs - Account Transfer (Recompile)  *
      *  BUG27119 - REC4223 00001- File out of Balance                *
      *             (Apply GEMS SC# 255116)                           *
      *  244720  - Write cheque number to GETTPD file for cheque      *
      *            deposits in non-a/c ccy                            *
      *  249906 - Include relevant details to field OTRF.             *
      *  243652  - Cheque number/transaction amount overlap in PNAR   *
      *            for Clearing cheque deposit in non-account ccy.    *
      *  BUG9062 - Consider type of cheque deposits when adding       *
      *            cheque number to narrative.                        *
      *  BUG9062 - Add cheque number to narrative.                    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG7675 - Amount in report RE0566P1 is wrong                 *
      *  BUG8510 - Correct posting narrative which is blank.          *
      *  BUG8553 - For F/X, include sell transaction in posting       *
      *  BUG8080 - For interbranch in-house cheques, ensure that BRCA *
      *            MOV003 subroutine is populated with correct branch *
      *            @BRCA1.                                            *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG4311- In stmt of a/c, cheque no. is missing for RTS tran- *
      *           sactions like cash withdrawal. Applied fix 222337.  *
      *  BUG3526 - LDA is not allocated for output of DB error.       *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CRE019 - Cheque Processing and Maintenance                   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CRT012 - Midas/Cashier Interface - Multiple Charges          *
      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
      *           Information (Recompile)                             *
     F*  202295 - Include processing to correctly process rounding amt*
      *  CRT005 - Cashier Enhancement for Cash In/Cash Out            *
      *  197289 - TTRANL1 under user control to ensure override is ok *
      *           when a COB is running.                              *
      *           Also, condition updates on posting phase switch.    *
      *  195607 - Wrong calculation of Margin Amount on sr/SRMACC.    *
      *  CRT006 - Cashier Reserve Transactions.                       *
      *  190687 - Even after the Euro transition period, the Euro spot*
      *           rate should still be used to determine the exchange *
      *           rate between the two currencies.                    *
      *  151104 - Increase size of branch code & related array so that*
      *           it can hold up to 900 elements.                     *
     F*  189955 - Correct RIND where Cashier posts to missing Account *
     F*  139524 - Added condition statements so that the newly opened *
     F*           account(s) will be posted as suspense account if    *
     F*           there is no associated GL code.  Also amended 100002*
      *           to compare A1ASGL to *BLANKS.                       *
      *  163729 - Initialize XRFI and XRFN as no duplication of ref   *
      *           file for EMU posting narrative is allowed, also the *
      *           next availlable ref number should be written after  *
      *           the write to GETT1APD .                            *
      *  153249 - Call AOACODR0 before write to APOSTPDF to prevent   *
      *           blank ACSC field. (Fix 156520)                      *
      *           PTIM = 235959 for COB generated postings, from      *
      *           SPOS GE-TT. (Fix 164970)                            *
      *  164970 - PTIM=235959 for ALL COB generated postings          *
      *           from SPOS GE-TT, GE-GLEU or GE-SF                   *
      *  153393 - GL Account code not being set up correctly for some *
      *           FX transactions. Also, amend error fix 151095 so    *
      *           that it checks the cash indicator of the transaction*
      *           type before using the cash GL code, and correct the *
      *           processing so that if the transaction type is blank *
      *           the system uses the cash account code.              *
      *  153389 - SETTTY not getting called for Traveller's Cheques   *
      *  151095 - For cash transactions (e.g. FX), make sure that     *
      *           the SETCSH subroutine is called to get the A/C code *
      *           from the currencies file if GL A/C code on the      *
      *           transaction type is blank                           *
      *  159167 - If a record in TTRANL2 has a zero ret acc introduced*
      *           by cashier, use the other acc details in TTRANL2    *
      *           instead of the ret acc nb TRACNO .                  *
      *  CGL007 - Account Postings Enquiry.  Recompile.               *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  142084 - For cheque deposit functions, do not output cheque  *
      *           no. on postings as it is irrelevant.                *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
      *  146200 - Euro ccy rates become zero                          *
      *  147070 - DR amount not equal to CR amount in RE4201AU causes *
      *           REC4223 to fallover. Calculated margin amount is    *
      *           negative.                                           *
      *  141386 - GLC30 failed in COB, OOB in GL0340                  *
      *  CEU025 - EMU Midas-Cashier Interface                         *
      *  140953 - Error on the currency and amount posted on GETT1APD *
      *  140254 - REC4223 failed in COB, OOB in RE4201                *
      *  CEU024 - EMU Retail Teller Support Enhancement               *
     F*  130021 - DR amount not equal to CR amount in RE4201AU causes *
     F*           REC4223 to fall over.  Related to 118271.           *
     F*  130020 - Incorporation of 109102 to core was incorrect.      *
     F*           The BV-PRG version has to be referred at.           *
     F*  109175 - Call to AOPNARR0 if switchable feature installed    *
     F*           and UDC present                                     *
     F*  125391 - Ensure that hard-coding of account code 2121 is     *
     F*           always conditioned on the presence of CRT102        *
     F*  118271 - Correct non-account CCY transaction balances        *
     F*           generated entries posting amounts.                  *
     F*  109102 - Correction to Value Date for second posting.        *
     F*           Also correct 2 other missed fields. (098444)        *
     F*  094753 - The entered GL cash in/out narrative should be      *
     F*           shown on the posting narrative of the account       *
     F*           enquiries.  Applied fix 084745.                     *
     F*         - Setup retail fields correctly for foreign exchange  *
     F*           transaction (0JI).  Re-aaply fix 093730 as          *
     F*           preventative maintenance.                           *
     F*  107926 - If no associated GL account code results in non-    *
     F*           generation of a contra-posting, post against the    *
     F*           suspense account.                                   *
     F*  CRT002 - Retail Branch Access.                               *
     F*  096179 - Add Default Transaction Types for Interbranch and   *
     F*           Main Branch Generated Entries.                      *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           If Analytical Accounting is available, the profit   *
     F*           centre of any posting to a retail account will be   *
     F*           changed to the profit centre of that account.       *
     F*  100002 - 1) After accessing Trans Type, move A1ASGL to ACOD  *
     F*              to load the associated GL code for output.       *
     F*           2) If no associated GL code has been set up, use    *
     F*              Suspense A/C Code.                               *
     F*  097905 - Incorrect transaction type details retrieved for    *
     F*           the second transaction (FX sell)                    *
     F*  S01408 - Addition of core hook RE4201CP13                    *
     F*           Addition of core hook RE4201CP12                    *
     F*           Addition of core hook RE4201CP11                    *
     F*           Addition of core hook RE4201CP10                    *
     F*           Addition of core hook RE4201CCP9                    *
     F*           Addition of core hook RE4201CCP8                    *
     F*           Addition of core hook RE4201CCP7                    *
     F*           Addition of core hook RE4201CCP6                    *
     F*           Addition of core hook RE4201CCP5                    *
     F*           Addition of core hook RE4201CCP4                    *
     F*           Addition of core hook RE4201CCP3                    *
     F*           Addition of core hook RE4201CCP2                    *
     F*           Addition of core hook RE4201CCP1                    *
     F*  093749 - If narrative is not entered for the transaction, use*
     F*           the DR narrative for the DR posting and the CR      *
     F*           narrative for the CR posting generated.  When all   *
     F*           these are not entered, then use the narrative from  *
     F*           PF/SDRETRPD for the transaction type.               *
     F*  091241 - ATM Interface.  Recompiled.                         *
     F*  CRT001 - Retail Teller System                                *
     F*                                                               *
     F*****************************************************************
     F***TTRANL2 IF  E           K        DISK                                                CRT006
     FTTRANL2 UF  E           K        DISK         KINFSR *PSSR                              CRT006
     F            TTRANPTF                          KRENAMETTRANPT2                           CRT006
      ** Teller transactions by function code sequence
      *
     F*TTRANL1*UF**E****       K        DISK         KINFSR *PSSR                      CRT006 197289
     FTTRANL1 UF  E           K        DISK         KINFSR *PSSR      UC                      197289
     F            TTRANPDF                          KRENAMETTRANPD1                           CRT006
      ** Teller transaction trailer.                                                          CRT006
      *                                                                                       CRT006
     FSDBACTL0IF  E           K        DISK         KINFSR *PSSR      UC                      CRT012
      ** Cashier Commission Transaction Types                                                 CRT012
      *                                                                                       CRT012
     FABSFAC01IF  E           K        DISK         KINFSR *PSSR      UC                      CRT012
      ** VAT file                                                                             CRT012
      *                                                                                       CRT012
     FSDCTPOL0IF  E           K        DISK         KINFSR *PSSR      UC                      CRT012
      ** Cashier Transaction Posting Details                                                  CRT012
      *                                                                                       CRT012
     FTTRNTM3 IF  E           K        DISK         KINFSR *PSSR                              CRT005
      ** Teller batch/totals                                                                  CRT005
      *                                                                                       CRT005
     F            TTRNTM3F                          KRENAMETTRNM3F                            CRT005
     FACCNT   IF  E           K        DISK
      ** Account master
      *
     FACNUM   IF  E           K        DISK
      ** Account Numbers Cross Reference File
     F            ACCNTABF                          KRENAMEACNUMABF
      *
     FTTACMTL1IF  E           K        DISK
      ** Teller shadow postings file
      *
     FGETTPD  O   E           K        DISK         KINFSR *PSSR
      ** Generated teller trans. entries details
      *
     FGETTPH  O   E           K        DISK         KINFSR *PSSR
      ** Generated teller trans. entries header
      *
     FGETTPZ  O   E           K        DISK         KINFSR *PSSR
      ** Generated teller trans. entries trailer
      *
     FTTIBPD  O   E           K        DISK         KINFSR *PSSR
      ** Interbranch*posting*file details
      *
     FTTIBPH  O   E           K        DISK         KINFSR *PSSR
      ** Interbranch*posting*file header
      *
     FTTIBPZ  O   E           K        DISK         KINFSR *PSSR
      ** Interbranch*posting file trailer
      *
     FRE4201AUO   E                    PRINTER
      ** Audit report
      *
     FTTCHGL0 IF  E           K        DISK
      ** Teller FX charges detail
      *
     FTTNARL0 IF  E           K        DISK
      ** Teller transfer/cross narratives file
      *
     FSDTCHGL1IF  E           K        DISK                               096179
      * RTV : Midas SD RTS Dft charges tran type retrieval                096179
     F/COPY WNCPYSRC,RE4201F001
      *                                                                   096179
     FGLAPNAPDUF  E                    DISK         KCOMIT       A    UC  CEU024
      ** Account Posting Narr. Next Available Number                      CEU024
      *                                                                   CEU024
     FGETT1APDO   E                    DISK                           UC  CEU024
      ** RTS Posting Extension for Narrative                              CEU024
      *                                                                   CEU024
     FREBDCRPDIF  E           K        DISK         KINFSR *PSSR      UC  CEU025
      ** Currency Details Extention No. 2                                 CEU025
      *                                                                   CEU025
     FREBDCCPDIF  E           K        DISK         KINFSR *PSSR      UC  CEU025
      ** Exchange Rate Control Table                                      CEU025
      *                                                                   CEU025
     FTTRNT   UF  E           K        DISK         KINFSR *PSSR                              CRT006
      ** Teller Totals                                                                        CRT006
      *                                                                                       CRT006
     FCHQBKPD UF  E           K        DISK         KINFSR *PSSR                              CRT006
      ** Cheque Book file                                                                     CRT006
      *                                                                                       CRT006
     FCHQDPPD UF  E           K        DISK         KINFSR *PSSR                              CRT006
      ** Cheque Deposited file                                                                CRT006
      *                                                                                       CRT006
      *****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F* F U N C T I O N   O F   I N D I C A T O R S                   *
     F*                                                               *
     F*  50  -  Transaction balance check report                      *
     F*  55  -  No charges exist for FX transaction                   *
     F*         or other transaction                                  *
     F*  67  -  Value of debit and credit are different               *
     F*  68  -  Value of trans processed and on file are different    *
     F*  69  -  General error indicator                               *
     F*                                                               *
     F*  70  -  General Indicator Used For CHAIN                      *
      *  71  -  Invalid Cheque Number indicator.                      *                       CRT006
     F*  79  -  EOF indicator                                         *
     F*                                                               *
      *  86  -  Look up indicator for the transaction ccy             *   CEU024
      *  87     Look up indicator for the account ccy                 *   CEU024
      *  88  -  EOF for GLAPNAPD                                      *   CEU024
     F*  U1       No output to GETTP* or TTIBP* files                 *
     F*  U7+U8    Set on if database error occurs                     *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  CHARGE - Generate charge entry                               *
     F*  CHFRC1 - Check foreign currency and setup -1                 *
     F*  CHFRC2 - Check foreign currency and setup -2                 *
     F*  CHKBAL - Monitor the balance per branch-currency             *                     BUG27119
     F*  DBERR  - Database Error Handling : Terminate pgm.            *
      *  SRDELD - SR to delete the record from file, LF/TTRANL2 and   *                       CRT006
      *           update the teller totals.                           *                       CRT006
     F*  FIRST  - Initial Processing                                  *
     F*  GENBOE - Generate batch offset entry                         *
     F*  GENENT - Generate entries                                    *
     F*  GEN00N - Generate entry for fn.code '00N'                    *
     F*  GEN0KQ - Generate entry for fn.code '00K' & '00Q'            *
     F*                                      '00R'                    *   CRT002
     F*  GEN0HP - Generate entry for fn.code '00H' & '00P'            *
     F*  GEN0JN - Generate entry for fn.code '0JN'                    *
     F*  GENJKQ - Generate entry for fn.code '0JK' '0JQ'              *
     F*                                      '0JR'                    *   CRT002
     F*  GENJHP - Generate entry for fn.code '0JH' '0JP'              *
     F*  GEN00O - Generate entry for fn.code '00O'                    *
     F*  GEN00L - Generate entry for fn.code '00L'                    *
     F*                                      '00W'                    *   CRT002
     F*  GEN0JO - Generate entry for fn.code '0JO'                    *
     F*  GEN0JL - Generate entry for fn.code '0JL'                    *
     F*                                      '0JW'                    *   CRT002
     F*  GEN00A - Generate entry for fn.code '00A'                    *
     F*  GEN00I - Generate entry for fn.code '00I'                    *
     F*  GENBAT - Generate entry for fn.code '***'                    *
     F*  GEN0JI - Generate entry for fn.code '0JI'                    *
     F*                                      '0JS', '0JX'             *   CRT002
     F*  GEN0JA - Generate entry for fn.code '0JA'                    *
     F*  GEN00E - Generate entry for fn.code '00E'                    *
     F*  GEN00F - Generate entry for fn.code '00F'                    *
     F*  GEN0JE - Generate entry for fn.code '0JE'                    *
     F*  GEN0JF - Generate entry for fn.code '0JF'                    *
     F*  GETACD - Get account details                                 *
     F*  GETACT - Get account type                                    *
     F*  GETNAR - Get narrative from TTNARPD file                     *
     F*  HSHTOT - Perform hash totals                                 *
     F*  ITBAEN - Interbranch a/c entry                               *
     F*  ITRDET - Initialise trans.type details                       *
     F*  LAST   - Final processing - terminate pgm.                   *
     F*  MAIN   - Control Process                                     *
     F*  MOVEXC - Move values for exchange transactions               *
     F*  MOVITB - Move values for interbranch posting                 *
     F*  MOV001 - Move values for generating entry-1                  *
     F*  MOV002 - Move values for generating entry-2                  *
     F*  MOV003 - Move values for generating entry-3                  *
     F*  MOV004 - Move values for generating entry-4                  *
     F*  PRODET - Process details                                     *
     F*  PROEXC - Process exchange transactions                       *
     F*  PROITB - Process interbranch transactions                    *
     F*  PROSUS - Create Suspense Posting                             *                     BUG27119
     F*  SETBRD - Setup branch details                                *
     F*  SETCDT - Setup currency details                              *
     F*  SETPSI - Setup posting indicator                             *
     F*  SETTTY - Set up transaction types (details)                  *
     F*  SRNARR - Additional posting narrative                        *   CEU024
     F*  TITBEN - Teller interbranch entry                            *
      *  SRUCHD - Update PF/CHQDPPD                                   *                       CRT006
      *  SRUCHK - Update PF/CHQBKPD                                   *                       CRT006
     F*  WRTRL  - Write trailer records                               *
     F*  *PSSR  - Program error                                       *
     F*                                                               *
     F*       Standard RTS Subroutines                                *
     F*                                                               *
     F*  RTCONV - Currency conversion                                 *
     F*                                                               *
     F*       Standard MIDAS Subroutines                              *
     F*                                                               *
     F*  ZFRPED - Format and edit amount field                        *
     F*  ZHASH  - Perform hash totals                                 *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
      *                                                                   CAC002
     E                    AP      1  10 10 0                              CAC002
      ** Array - Powers of Ten.                                           CAC002
      *                                                                   CAC002
     E                    @TXT    1   2 80                                                    CRT006
      ** Array containing commands.                                                           CRT006
      *                                                                                       CRT006
      /COPY ZSRSRC,ZFRPEDZ1
      ** Array for SR.ZFRPED
      /COPY ZSRSRC,ZDATE1Z1                                               CEU024
      ** Array for SR.ZDATE1                                              CEU024
     E                    POWER   1   7  7 3                                                  CGL020
      *
     E                    INT         3 15 0             ZHASH INTEGERS
     E                    DEC         3  3 0             ZHASH DECIMALS
      ** Array for SR.ZHASH
      *
     E***********         BCD        20  3                                151104
     E                    BCD       900  3                                151104
      ** Array for branch codes
      *
     E***********         ICN        20  6 0                              151104
     E**********          ICN       900  6 0                                           151104 CSD027
     E                    ICN       900  6                                                    CSD027
      ** Array for internal customer number
      *
     E***********         IGT        20  4 0                              151104
     E**********          IGT       900  4 0                                           151104 CGL029
     E                    IGT       900 10 0                                                  CGL029
      ** Array for branch 'Due To' gl-code
      *
     E***********         IGF        20  4 0                              151104
     E**********          IGF       900  4 0                                           151104 CGL029
     E                    IGF       900 10 0                                                  CGL029
      ** Array for branch 'Due From' gl-code
      *
     E***********         ITT        20  1                                151104
     E                    ITT       900  1                                151104
      ** Array for branch 'Due To' gl-type
      *
     E***********         IFT        20  1                                151104
     E                    IFT       900  1                                151104
      ** Array for branch 'Due From' gl-type
      *
     E                    CYC        50  3
      ** Array for currency codes
      *
     E                    CDP        50  1 0
      ** Array for currency decimal places
      *
     E                    CMD        50  1
      ** Array for currency mult/div indicator
      *
     E                    SPT        50 13 8
      ** Array for currency spot rate
      *
     E**********          TEQ        50  4 0                                                  CGL029
     E                    TEQ        50 10 0                                                  CGL029
      ** Array for currency's trade equivalent a/c codes
      *
     E**********          CYCD      200  3   CACD    4 0                                      CGL029
     E                    CYCD      200  3   CACD   10 0                                      CGL029
      ** Array for currencies cash account code
      *                                                                   CEU024
     E                    CURR      200  3                                CEU024
      ** Array for currency codes of all 'in' currencies                  CEU024
      *                                                                   CEU024
     E                    @CY        24  3                                                    CRT006
      ** Teller currencies array                                                              CRT006
      *                                                                                       CRT006
     E                    @CA        20  1                                                    CRT006
      ** Cheque presented status array                                                        CRT006
      *                                                                                       CRT006
     E                    BCC      5000  6                                                  BUG27119
      ** Branch-Currency combination                                                        BUG27119
     E                    BAL      5000 15 0                                                BUG27119
      ** Balance of each Branch-Currency combination                                        BUG27119
     E/COPY ZSRSRC,ZHOLE                                                                      CRT012
      *****************************************************************
      /EJECT
      *****************************************************************
      *
     ITTRANPDF
      ** Renamed fields in LF/TTRANL2
     I              ACNO                            TRACNO
     I              TTP1                            TRTP1
     I              TTP2                            TRTP2
      *
     IACCNTABF
      ** Renamed fields in LF/ACCNT
     I              ACNO                            ACACNO
     I              PRFC                            ACPRFC                CAC002
     I/COPY WNCPYSRC,RE4201I001
      *
     I@NARDS      DS                             30
      ** DS to define narrative for generated transaction.
     I                                        1   6 @NAR16
     I                                        7   9 TBID
     I                                       10  10 @NA100
     I                                       11  150@TTRNO
     I                                        1  15 @NA115
     I                                        7  15 @NA715                109175
     I                                       16  20 @N1620
     I                                       21  300TRACNO
     I                                        1  20 @NA120
      *
     I@NA2DS      DS                             32
      ** DS to define narrative for generated transaction.
     I                                        1   9 @NAR19
     I                                       10  12 TRCCY
     I                                       13  13 @NA133
     I                                       14  32 @NAMT2
     I@NA3DS      DS                             30
      ** DS to define narrative for generated transaction.
     I                                        1  15 @N3115
     I                                       16  20 @N3162
     I                                       21  25 @N3215
     I                                       21  27 @N3217
     I                                       26  27 @N3267
     I                                       21  28 @N3218
     I                                       26  28 @N3268
      *
     I@BNADS      DS                             20
      ** DS to define narrative for generated batch transaction.
     I                                        1   5 @BNA15
     I                                        6  10 @BN610
     I                                       11  13 @PTBID
     I                                       14  20 @BN142
      *
     I            DS
      ** DS to define amount field for hash totals
     I                                    P   1   80@VGETT
     I                                    P   9  160@VGETD
     I                                    P  17  240@VGETC
     I                                    P  25  320@VTTIB
     I                                       33  330@VGED1
     I                                       33  360@VGEDD
     I                                    P  37  380@VTIDD
      *
     I***@@ACKY*     DS                             21                                        CGL029
     I@@ACKY      DS                             24                                           CGL029
      ** DS to save accnt key
     I**********                              1   60@@CNUM                                    CSD027
     I                                        1   6 @@CNUM                                    CSD027
     I                                        7   9 @@CCY
     I**********                             10  130@@ACOD                                    CGL029
     I**********                             14  150@@ACSQ                                    CGL029
     I**********                             16  18 @@BRCA                                    CGL029
     I                                       10  190@@ACOD                                    CGL029
     I                                       20  210@@ACSQ                                    CGL029
     I                                       22  24 @@BRCA                                    CGL029
      *
      ** DS for key to TTNARL0
     I            DS
     I                                        1   3 @TBID
     I                                        4   80TBTN
     I                                        1   8 TTNARK
      *                                                                                       CRT006
      ** Data structure to hold string constants for QCMDEXC                                  CRT006
     I            DS                                                                          CRT006
     I                                        1  80 @CMDT                                     CRT006
     I                                       30  30 @BRIT                                     CRT006
     I                                       31  33 @BIDT                                     CRT006
      *                                                                                       CRT006
     I/COPY WNCPYSRC,RE4201I002
      *
      /COPY ZSRSRC,ZFRPEDZ2
      ** Data structure for SR.ZFRPED
      *
      /COPY ZSRSRC,ZHASHZ2
      ** Data structure for SR.ZHASH
      *
     IPSDS       SDS
      **  Program Status Data Structure
      *
     I                                        1  10 @PGM
      **  Field containing Program name
     I                                      244 253 @JOB
      **  Field containing Workstation ID
     I                                      254 263 @USER
      **  Field Containing User ID
      *
      *
     I*
     I** DATA AREA RUNDAT
     I*
     IRUNDT       DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     ILDA         DS                            256
      **  Local data area for data base errors.
     I                                        1   3 ERTLID
     I                                       11  20 ERTWID
     I                                       21  30 ERWSID
      *
      **  Field combining the following fields
     I                                      134 183 DBLOT
      **  Name of database file in error
     I                                      134 141 DBFILE
      **  Key value causing database error
     I                                      142 170 DBKEY
      **  Name of program causing database error
     I                                      171 180 DBPGM
      **  Number of database error
     I                                      181 1830DBASE
      *
     I**********  DS                             24                                           CRT006
      ***Data*structure*to*redefine*currency*array*********************                       CRT006
     I**********                              1  24 CCYR1                                     CRT006
     I**********                              1  24 @CY                                       CRT006
      *                                                                                       CRT006
     I            DS                             72                                           CRT006
      ** Data structure to redefine currency array                                            CRT006
     I                                        1  72 CCYR1                                     CRT006
     I                                        1  72 @CY                                       CRT006
      *                                                                                       CRT006
      *
     I            DS                              3
      ** Data structure to redefine function code
     I                                        1   3 FNCD
     I                                        1   2 @FN12
     I*
      * Data structure for AOSVALR0 string                                CRT012
     I            DS                                                      CRT012
     I                                        1 200 SVAL1                 CRT012
     I                                        1   1 SVAL11                CRT012
     I            DS                                                                        MD054623
     I                                        1 200 RTSN1                                   MD054623
     I                                        1   1 RTSN11                                  MD054623
      *                                                                   CRT012
      * System Value                                                      CRT012
     I            DS                                                      CRT012
     I I            'CashierMultCharge'       1  20 SVALK1                CRT012
     I            DS                                                                        MD054623
     I I            'RTSNarrFormat'           1  20 RTSNK1                                  MD054623
      *                                                                   CRT012
     ISCSARD    E DSSCSARDPD
     I** External DS for SAR details
     ISDMMOD    E DSSDMMODPD                                              CAC002
      ** MIDAS Modules                                                    CAC002
     I* Module Details Accessed via access program                        109175
     I*                                                                   109175
     ICGPNAR    E DSCGPNARPD                                              109175
     I* UDC Multi Language Narrative Data Structure                       109175
     I*                                                                   109175
     I##PRM1      DS                                                      109175
      **  Data Structure for Customer and Branch                          109175
      *                                                                   109175
     I                                        1   6 A#CUST                109175
     I                                        7   9 A#BRCA                109175
      *                                                                   109175
     ISDCUST    E DSSDCUSTPD                                              109175
     I* Customer Details Data Structure                                   109175
     I*                                                                   109175
     I*
     ISDBANK    E DSSDBANKPD
     I** Bank Details
     I*
     ISDCURR    E DSSDCURRPD
     I** Currency file Details
     I*
     ISDBRCH    E DSSDBRCHPD
     I** Branch Code Details
     I              QQDFAC                          QQDFA1                                    CGL029
     I*
     ISDTRAD    E DSSDTRADPD
     I** SD Trading ICD Details
     I              QQACCD                          QQACCX                                    CGL029
     I*
     ISDGELR    E DSSDGELRPD
     I** General Ledger Details
     I              QQACCD                          QQACCY                                    CGL029
     I*
     ISDACOD    E DSSDACODPD
     I** Accoun Code Details
     I              QQACCD                          QQACCZ                                    CGL029
     I*
     ISDRETR    E DSSDRETRPD
     I** Retail Transaction Types Details
     I*
     ISDFNCD    E DSSDFNCDPD
     I** Function Code  Details
     I*
     ISDPRFC    E DSSDPRFCPD                                              CAC002
      ** Profit Centre Details                                            CAC002
      *                                                                   CAC002
     ISDPCAC    E DSSDPCACPD                                              CAC002
      ** PCA ICD                                                          CAC002
     I              QQFNAA                          QQFNA1                                    CGL029
     I              QQFNIC                          QQFNI1                                    CGL029
      *                                                                   CAC002
     ISDTCHG    E DSSDTCHGPD                                              CAC002
      ** Teller Default Charges                                           CAC002
      *                                                                   CAC002
     ISDNARR    E DSSDNARRPD                                              CRT012
     I** Narrative Details                                                CRT012
     I*                                                                   CRT012
     IDSFDY     E DSDSFDY
     I* First DS For access programs, Short data structure
     I*
     IDSSDY     E DSDSSDY
     I* Second DS For access programs, Long data structure
      *                                                                   109175
     I              'RTS IMBALANCE ENTRY' C         SUSNAR                                  BUG27119
      *                                                                                     BUG27119
     I***DSPNAR*     DS                             30                                 109175 CGL029
     IDSPNAR      DS                             36                                           CGL029
      **  DS to set up Posting Narrative                                  109175
     I                                        1  11 D#TXT                 109175
      *                                                                   109175
     I                                       12  17 D#CNUM                109175
     I                                       18  20 D#CCY                 109175
     I**********                             21  24 D#ACOD                             109175 CGL029
     I**********                             25  26 D#ACSQ                             109175 CGL029
     I**********                             27  29 D#BRCA                             109175 CGL029
     I                                       21  30 D#ACOD                                    CGL029
     I                                       31  32 D#ACSQ                                    CGL029
     I                                       33  35 D#BRCA                                    CGL029
      *                                                                   109175
     I                                       14  23 D#ACNO                109175
      *                                                                   109175
      /COPY ZSRSRC,RTTOTSI1                                                                   CRT006
      *                                                                                       CRT006
     I            DS                             18                                           CRT006
      ** Data structure to hold key fields of PF/CHQBKPD                                      CRT006
     I                                        1  18 @CQBKY                                    CRT006
     I                                        1  100KACNO                                     CRT006
     I                                       11  180KSCQN                                     CRT006
      *                                                                                       CRT006
     I            DS                             11                                           CRT006
      ** Data structure to hold key fields of PF/CHQDPPD                                      CRT006
     I                                        1  11 @CQDKY                                    CRT006
     I                                        1   3 KTLID                                     CRT006
     I                                    P   4   60KTRNO                                     CRT006
     I                                        7  110KSEQN                                     CRT006
     INC15        DS                                                                          CRT012
      ** Data structure for VAT A/C code                                                      CRT012
     I                                       10  13 VATAC                                     CRT012
     IPN          DS                                                                          CRT012
      ** Data structure for Posting Narrative                                                 CRT012
     I                                        1   3 PN1                                       CRT012
     I                                        4   4 PN4                                       CRT012
     I                                        5   9 PN5                                       CRT012
     I                                       11  30 PN11                                      CRT012
     E/COPY ZSRSRC,ZHOLI                                                                      CRT012
      *                                                                                       CRT012
      *****************************************************************
     C/EJECT
      *****************************************************************
      *                                                               *
      *            MAIN   - Control Process                           *
      *                                                               *
      * CALLS      FIRST  - Initial Processing                        *
      *            GENBOE - Generate batch offset entry               *
      *            LAST   - Final Processing                          *
      *            PRODET - Process details                           *
      *                                                               *
      * CALLED BY         -                                           *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
      *
     C                     MOVEACPY@      BIS@   80
     C*
     C*                                                                   109175
     C* Call Module Prog. for module details.                             109175
     C                     CALL 'AOMMODR0'                                109175
     C                     PARM '*MSG   ' @RTCD                           109175
     C                     PARM '*FIRST ' @OPTN                           109175
     C           SDMMOD    PARM SDMMOD    DSFDY                           109175
     C*                                                                   109175
     C           @RTCD     IFNE *BLANK                     B1             109175
     C           *LOCK     IN   LDA                         1             109175
     C                     MOVEL'SDMMODPD'DBFILE           * * * * * * *  109175
     C                     Z-ADD86        DBASE            * DBERR 086 *  109175
     C                     MOVEL@OPTN     DBKEY            * * * * * * *  109175
     C                     SETON                     U7LR   1             109175
     C                     EXSR *PSSR                       1             109175
     C                     ELSE                            X1             109175
     C*                                                                   109175
     C* Call SAR Prog. for Switchable feature                             109175
     C                     MOVE 'N'       REPNAR  1                       109175
     C                     MOVE '0'       *IN65                           109175
     C           BGN1ST    IFEQ 'Y'                        B2             109175
     C*                                                                   109175
     C                     CALL 'AOSARDR0'                  2             109175
     C                     PARM '       ' @RTCD             2             109175
     C                     PARM '*VERIFY' @OPTN             2             109175
     C                     PARM 'REPNAR'  @SARD   6         2             109175
     C           SCSARD    PARM SCSARD    DSFDY             2             109175
     C*                                                                   109175
     C           @RTCD     IFNE *BLANK                     B3             109175
     C           @RTCD     ANDNE'*NRF   '                   3             109175
     C           *LOCK     IN   LDA                         1             109175
     C                     MOVEL'SCSARDPD'DBFILE            ************* 109175
     C                     Z-ADD87        DBASE             *DBERROR 087* 109175
     C                     MOVEL@SARD     DBKEY             ************* 109175
     C                     SETON                     U7LR   3             109175
     C                     EXSR *PSSR                       3             109175
     C                     ENDIF                           E3             109175
     C*                                                                   109175
     C           @RTCD     IFEQ *BLANK                     B3             109175
     C                     MOVE 'Y'       REPNAR            3             109175
     C                     MOVE '1'       *IN65             3             109175
     C                     ENDIF                           E3             109175
     C                     ENDIF                           E2             109175
     C                     ENDIF                           E1             109175
     C** Access SAR details file to determine if RTS AMENDMENT -
     C** FOREIGN CASH CONTRA ENTRY is switched on
     C*
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*VERIFY' @OPTN   7
     C                     PARM 'CRT102'  @SARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS
     C           @RTCD     ANDNE'*NRF   '
     C           *LOCK     IN   LDA                                                          BUG3526
     C                     Z-ADD11        DBASE            ***********
     C                     MOVEL'SCSARDPD'DBFILE           DB ERROR 11
     C                     MOVEL'CRT102'  DBKEY            ***********
     C                     EXSR DBERR
     C                     END
     C*
     C           @RTCD     IFEQ *BLANK
     C                     MOVEL'Y'       CRT102  1
     C                     ELSE
     C                     MOVEL'N'       CRT102
     C                     END
      *                                                                                       CRT005
      ** Determine if SAR CRT005 Cashier Cash In/Cash Out is ins -                            CRT005
      ** talled.                                                                              CRT005
      *                                                                                       CRT005
     C                     CALL 'AOSARDR0'                                                    CRT005
     C                     PARM *BLANKS   PRTCD   7                                           CRT005
     C                     PARM '*VERIFY 'POPTN   7                                           CRT005
     C                     PARM 'CRT005'  PSARD   6                                           CRT005
     C           SCSARD    PARM SCSARD    DSFDY                                               CRT005
      *                                                                                       CRT005
     C           PRTCD     IFNE *BLANKS                                                       CRT005
     C           PRTCD     ANDNE'*NRF   '                                                     CRT005
     C           *LOCK     IN   LDA                                                           CRT005
     C                     MOVEL'SCSARDPD'DBFILE                                              CRT005
     C                     Z-ADD18        DBASE                                               CRT005
     C                     MOVEL'CRT005'  DBKEY                                               CRT005
     C                     OUT  LDA                                                           CRT005
     C                     MOVE *ON       *INU7                                               CRT005
     C                     EXSR *PSSR                                                         CRT005
     C                     ENDIF                                                              CRT005
      *                                                                                       CRT005
     C           PRTCD     IFEQ *BLANKS                                                       CRT005
     C                     MOVE 'Y'       CRT005  1                                           CRT005
     C                     ELSE                                                               CRT005
     C                     MOVE 'N'       CRT005                                              CRT005
     C                     ENDIF                                                              CRT005
     C/COPY WNCPYSRC,RE4201C004
      *
      ** Initial processing
     C                     EXSR FIRST
      *
      ** Start file lf/ttranl2
     C           *LOVAL    SETLLTTRANL2
      *
      ** Read next record
     C                     READ TTRANL2                  79
      *
      ** Do while not end-of-file
     C           *IN79     DOWEQ'0'
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE PRFC      WWPRFC  4                       CAC002
     C                     ENDIF                                          CAC002
      *
      ** If detail record read - add 1 to trans.processed count
     C           RECI      IFEQ 'D'
      *
     C                     ADD  1         @TPCNT  50
     C/COPY WNCPYSRC,RE4201C001
      *
     C                     ELSE
      *
      ** If trailer record read - add 1 to no.of record on file count
     C           RECI      IFEQ 'T'
      *
     C                     ADD  NORE      @NRECF  50
      *
     C                     END
      *
     C                     END
      *
      ** If not FD trans. and not reversed trans. and not a/c closure
      ** trans. and detail record -
     C           @FN12     IFNE '01'
     C           CRTN      ANDEQ0
     C           FNCD      ANDNE'MJM'
     C           RECI      ANDEQ'D'
      *                                                                                       CRT006
      ** Get TCP/IP details via access object AOBRCHR1                                        CRT006
      *                                                                                       CRT006
     C                     CALL 'AOBRCHR1'                                                    CRT006
     C                     PARM *BLANKS   PRTCD                                               CRT006
     C                     PARM '*KEY   ' POPTN                                               CRT006
     C                     PARM ITLB      PBRCA   3                                           CRT006
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CRT006
      *                                                                                       CRT006
     C           PRTCD     IFNE *BLANK                                                        CRT006
     C           *LOCK     IN   LDA                                                           CRT006
     C                     MOVEL'SDBRCHPD'DBFILE           ************                       CRT006
     C                     Z-ADD47        DBASE            * DBERR 47 *                       CRT006
     C                     MOVELITLB      DBKEY            ************                       CRT006
     C                     EXSR DBERR                                                         CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C           A8TCPP    IFNE *ZEROS                                                        CRT006
     C           ACKF      IFEQ *BLANKS                                                       CRT006
     C           *INU1     ANDEQ*OFF                                                          197289
     C                     MOVE *BLANK    WCSHIO  1                                           CRT005
     C           CRT005    IFEQ 'Y'                                                           CRT005
     C           FNCD      IFEQ '0JE'                                                         CRT005
     C           FNCD      OREQ '0JF'                                                         CRT005
     C           FNCD      OREQ '00E'                                                         CRT005
     C           FNCD      OREQ '00F'                                                         CRT005
      *                                                                                       CRT005
      ** Set cash in/out workfield.                                                           CRT005
      *                                                                                       CRT005
     C                     MOVE 'Y'       WCSHIO                                              CRT005
      *                                                                                       CRT005
      ** Set up key list for TTRNTM3.                                                         CRT005
      *                                                                                       CRT005
     C           FNCD      IFEQ '***'                                                       MD055557
     C                     MOVEL'B'       KTBRI                                             MD055557
     C                     ELSE                                                             MD055557
     C                     MOVEL'T'       KTBRI                                               CRT005
     C                     ENDIF                                                            MD055557
     C                     MOVELTBID      KTBID                                               CRT005
     C                     MOVEL'2'       KRCTP                                               CRT005
      *                                                                                       CRT005
      ** Retrieve Teller's transaction number of last update.                                 CRT005
      *                                                                                       CRT005
     C           KTTRNT    CHAINTTRNTM3              72                                       CRT005
      *                                                                                       CRT005
     C           *IN72     IFEQ *OFF                                                          CRT005
     C                     Z-ADDTTLU      WTTLU   50                                          CRT005
     C                     ENDIF                                                              CRT005
     C                     ENDIF                                                              CRT005
     C                     ENDIF                                                              CRT005
      *                                                                                       CRT005
      ** Execute SRDELD only when transaction is not a cash in/out or a cash in/out           CRT005
      ** and is the last transaction for the teller.                                          CRT005
      *                                                                                       CRT005
     C           WCSHIO    IFEQ *BLANK                                                        CRT005
     C           WCSHIO    OREQ 'Y'                                                           CRT005
     C           TBTN      ANDEQWTTLU                                                         CRT005
     C                     EXSR SRDELD                                                        CRT006
     C                     ENDIF                                                              CRT005
     C                     ENDIF                                                              CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Continue processing if transaction was not deleted.                                  CRT006
     C           RECI      IFEQ 'D'                                                           CRT006
      *
      ** Process details
     C                     EXSR PRODET
     C                     ENDIF                                                              CRT006
      *
     C                     END
      *
     C                     READ TTRANL2                  79
      *
      ** If end-of-file - generate batch offset if necessary
     C           *IN79     IFEQ '1'
      *
      ** If last transaction processed was batch
     C           @PTBRI    IFEQ 'B'
      *
      ** Generate batch offset entry for the last transaction
     C                     EXSR GENBOE
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *                                                                                     BUG27119
      ** Process to check the balance per branch-currency and                               BUG27119
      ** generate a suspense posting if the balance is not zero.                            BUG27119
      *                                                                                     BUG27119
     C                     EXSR PROSUS                                                      BUG27119
      *
      **  Final Processing
     C                     EXSR LAST
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            FIRST  - Initial Processing                        *
      *                                                               *
      **CALLS******ZA0150*-*Get*Midas*Rundate*&*Setup Indicator       *
      * CALLS      DBERR  - Database Error Handling : Terminate pgm.  *
      *            GETACT - Get account type                          *
      *            SETCDT - Setup currency details                    *
      *                                                               *
      * CALLED BY  Main   - Control Process                           *
      *                                                               *
      *****************************************************************
     C           FIRST     BEGSR                           ** FIRST  **
      *
      ** Account master
     C           KLACNT    KLIST
     C**********           KFLD           @CNUM   60                                          CSD027
     C                     KFLD           @CNUM   6                                           CSD027
     C                     KFLD           @CCY    3
     C**********           KFLD           @ACOD   40                                          CGL029
     C                     KFLD           @ACOD  100                                          CGL029
     C                     KFLD           @ACSQ   20
     C                     KFLD           @BRCA   3
      *
      ** Teller shadow postings file
     C           KLTACM    KLIST
     C                     KFLD           KTBID   3
     C                     KFLD           KTBTN   6
      *
      ** Teller shadow postings file for Func. code '00A'
     C           KLTAC1    KLIST
     C                     KFLD           KTBI1   3
     C                     KFLD           KTBT1   6
     C                     KFLD           KDORC   10
     C*                                                                   096179
     C* Check for existing record                                         096179
     C*                                                                   096179
     C           KRTV      KLIST                                          096179
     C                     KFLD           FSTCHG           Default Charge 096179
      *
     C           KTRNL1    KLIST                                                              CRT006
     C                     KFLD           KBRI    1                                           CRT006
     C                     KFLD           KBID    3                                           CRT006
     C                     KFLD           KTBTN1  50                                          CRT006
      *                                                                                       CRT005
     C           KTTRNT    KLIST                                                              CRT005
     C                     KFLD           KTBRI   1                                           CRT005
     C                     KFLD           KTBID   3                                           CRT005
     C                     KFLD           KRCTP   1                                           CRT005
      *                                                                                       CRT005
     C           KBRCT     KLIST                                                              CRT012
     C                     KFLD           KITLB   3                                           CRT012
     C                     KFLD           KCSHTT  4                                           CRT012
      *                                                                                       CRT012
     C/COPY WNCPYSRC,RE4201C027
      *
      ** Prepare LDA
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD0         DBASE
     C                     OUT  LDA
     C*
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
      *                                                                   CRT002
     C                     MOVEL*BLANK    PMODE   1                       CRT002
      *
      ** Set indicator for report output if balance check report
     C           *INU1     IFEQ '1'
     C                     SETON                     50
     C                     END
      *
      ** Initialise narrative required for generated transactions
     C                     MOVEL'TTRAN-'  @NAR16
     C                     MOVEL'/'       @NA100
     C                     MOVEL'_A/C-'   @N1620
     C                     MOVEL'_FX -'   @N3162
     C                     MOVEL'BATCH'   @BNA15
     C                     MOVEL' NO. '   @BN610
     C                     MOVEL' OFFSET' @BN142
      *
      ** Access PF/SDBANKPD for Midas Run Date
     C                     CALL 'AOBANKR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** If record does not exist
     C           @RTCD     IFNE *BLANK
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ***************
     C                     Z-ADD1         DBASE            ** DB ERR 01 **
     C                     MOVEL@OPTN     DBKEY            ***************
     C                     EXSR DBERR
      *
     C                     END
      *
      ** Move midas run date to screen field
     C                     MOVELBJMRDT    @MRDT   7
      *
      ** Store base currency code
     C                     MOVE BJCYCD    @BSCY   3
      *
      ** Store date format indicator
     C                     MOVELBJDFIN    @DTFMT  1
      *                                                                   CEU024
      ** Check if CEU024 is on                                            CEU024
      *                                                                   CEU024
     C                     MOVE 'N'       CEU024  1                       CEU024
     C                     CALL 'AOSARDR0'                                CEU024
     C                     PARM *BLANKS   @RTCD                           CEU024
     C                     PARM '*VERIFY' @OPTN                           CEU024
     C                     PARM 'CEU024'  @SARD                           CEU024
      *                                                                   CEU024
     C           @RTCD     IFEQ *BLANK                                    CEU024
     C                     MOVE 'Y'       CEU024                          CEU024
     C           BJDFIN    IFEQ 'M'                                       CEU024
     C                     MOVE *ON       *IN98                           CEU024
     C                     ENDIF                                          CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C           @RTCD     IFNE *BLANKS                                   CEU024
     C           @RTCD     ANDNE'*NRF   '                                 CEU024
     C           *LOCK     IN   LDA                                       CEU024
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU024
     C                     MOVEL'CEU024'  DBKEY            * DBERR  12*   CEU024
     C                     Z-ADD12        DBASE            ************   CEU024
     C                     EXSR DBERR                                     CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
      ** Check if CEU013 is on                                            CEU024
      *                                                                   CEU024
     C                     MOVE 'N'       CEU013  1                       CEU024
     C                     CALL 'AOSARDR0'                                CEU024
     C                     PARM *BLANKS   @RTCD                           CEU024
     C                     PARM '*VERIFY' @OPTN                           CEU024
     C                     PARM 'CEU013'  @SARD                           CEU024
      *                                                                   CEU024
     C           @RTCD     IFEQ *BLANK                                    CEU024
     C                     MOVE 'Y'       CEU013                          CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C           @RTCD     IFNE *BLANKS                                   CEU024
     C           @RTCD     ANDNE'*NRF   '                                 CEU024
     C           *LOCK     IN   LDA                                       CEU024
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU024
     C                     MOVEL'CEU013'  DBKEY            * DBERR  13*   CEU024
     C                     Z-ADD13        DBASE            ************   CEU024
     C                     EXSR DBERR                                     CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU025
      ** Check if CEU025 is on                                            CEU025
      *                                                                   CEU025
     C                     MOVE 'N'       CEU025  1                       CEU025
     C                     CALL 'AOSARDR0'                                CEU025
     C                     PARM *BLANKS   @RTCD                           CEU025
     C                     PARM '*VERIFY' @OPTN                           CEU025
     C                     PARM 'CEU025'  @SARD                           CEU025
      *                                                                   CEU025
     C           @RTCD     IFEQ *BLANK                                    CEU025
     C                     MOVE 'Y'       CEU025                          CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C           @RTCD     IFNE *BLANKS                                   CEU025
     C           @RTCD     ANDNE'*NRF   '                                 CEU025
     C           *LOCK     IN   LDA                                       CEU025
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU025
     C                     MOVEL'CEU025'  DBKEY            * DBERR  14*   CEU025
     C                     Z-ADD14        DBASE            ************   CEU025
     C                     EXSR DBERR                                     CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
      ** Check if CRT104 is on                                            CEU025
      *                                                                   CEU025
     C                     MOVE 'N'       CRT104  1                       CEU025
     C                     CALL 'AOSARDR0'                                CEU025
     C                     PARM *BLANKS   @RTCD                           CEU025
     C                     PARM '*VERIFY' @OPTN                           CEU025
     C                     PARM 'CRT104'  @SARD                           CEU025
      *                                                                   CEU025
     C           @RTCD     IFEQ *BLANK                                    CEU025
     C                     MOVE 'Y'       CRT104                          CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C           @RTCD     IFNE *BLANKS                                   CEU025
     C           @RTCD     ANDNE'*NRF   '                                 CEU025
     C           *LOCK     IN   LDA                                       CEU025
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU025
     C                     MOVEL'CRT104'  DBKEY            * DBERR  15*   CEU025
     C                     Z-ADD15        DBASE            ************   CEU025
     C                     EXSR DBERR                                     CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
      ** Check if CRT003 is on                                            CEU025
      *                                                                   CEU025
     C                     MOVE 'N'       CRT003  1                       CEU025
     C                     CALL 'AOSARDR0'                                CEU025
     C                     PARM *BLANKS   @RTCD                           CEU025
     C                     PARM '*VERIFY' @OPTN                           CEU025
     C                     PARM 'CRT003'  @SARD                           CEU025
      *                                                                   CEU025
     C           @RTCD     IFEQ *BLANK                                    CEU025
     C                     MOVE 'Y'       CRT003                          CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C           @RTCD     IFNE *BLANKS                                   CEU025
     C           @RTCD     ANDNE'*NRF   '                                 CEU025
     C           *LOCK     IN   LDA                                       CEU025
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU025
     C                     MOVEL'CRT003'  DBKEY            * DBERR  17*   CEU025
     C                     Z-ADD17        DBASE            ************   CEU025
     C                     EXSR DBERR                                     CEU025
     C                     ENDIF                                          CEU025
      *                                                                                       CGL020
      ** Check if Compliance Watch - Anti Money Laundering (CGL020) is installed              CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM *BLANKS   PRTCD                                               CGL020
     C                     PARM '*VERIFY' POPTN                                               CGL020
     C                     PARM 'CGL020'  PSARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           PRTCD     IFEQ *BLANK                                                        CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           PRTCD     IFNE *BLANKS                                                       CGL020
     C           PRTCD     ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     MOVEL'CGL020'  DBKEY                                               CGL020
     C                     Z-ADD50        DBASE                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR DBERR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      *                                                                   CEU025
      ** Access lf/sdtradl1 for spot trade account code
     C*
     C                     CALL 'AOTRADR0'
     C                     PARM '*BLANK ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      ** If record not found or is not a live record - db error
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDTRADPD'DBFILE           ***************
     C                     Z-ADD2         DBASE            ** DB ERR 02 *
     C                     MOVEL@OPTN     DBKEY            ***************
     C                     EXSR DBERR
     C                     END
      *
      ** Store details
     C**********           MOVELBLSPTA    @STRAC  4                                           CGL029
     C                     MOVELBLSPTA    @STRAC 10                                           CGL029
      *
      ** Get account type for spot trade a/c code
     C**********           MOVEL@STRAC    @ACD    4                                           CGL029
     C                     MOVEL@STRAC    @ACD   10                                           CGL029
     C                     EXSR GETACT
     C                     MOVEL@ACT      @STRAT  1
      *
      ** Get account type for foreign cash a/c (2121)
     C           CRT102    IFEQ 'Y'
     C**********           MOVEL'2121'    @ACD    4                                           CGL029
     C                     MOVEL'2121'    @ACD                                                CGL029
     C                     EXSR GETACT
     C                     MOVEL@ACT      @AGLT   1
     C                     END
      *
      ** Access lf/sdgelrl1 for computer suspense account code
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*BLANK ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
      ** If record not found or is not a live record - db error
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDGELRPD'DBFILE           **************
     C                     MOVEL@OPTN     DBKEY            ** DB ERR 03 **
     C                     Z-ADD3         DBASE            ***************
     C                     EXSR DBERR
     C                     END
      *                                                                   CEU024
      ** Move all 'in' currencies within the transition period to         CEU024
      ** the currency array                                               CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU025    OREQ 'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A       30                      CEU024
     C                     MOVEL'*FIRST  '@OPTN                           CEU024
      *                                                                   CEU024
     C           @RTCD     DOUEQ'*EOF'                                    CEU024
     C           @RTCD     ORNE *BLANKS                                   CEU024
      *                                                                   CEU024
     C                     CALL 'AOCURRR0'                                CEU024
     C                     PARM *BLANKS   @RTCD                           CEU024
     C                     PARM           @OPTN                           CEU024
     C                     PARM           @CYCD                           CEU024
     C           SDCURR    PARM SDCURR    DSSDY                           CEU024
      *                                                                   CEU024
     C           @RTCD     IFEQ *BLANK                                    CEU024
     C           A6INCY    ANDEQ'Y'                                       CEU024
     C           BJRDNB    ANDGEA6TPSD                                    CEU024
     C********** BJRDNB    ANDLEA6TPED                             CEU024 190687
     C           @RTCD     OREQ *BLANK                                    CEU024
     C           A6CYCD    ANDEQBKEURO                                    CEU024
     C                     MOVE A6CYCD    CURR,A                          CEU024
     C                     ADD  1         A                               CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     MOVEL'*NEXT   '@OPTN                           CEU024
     C                     ENDDO                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
      ** Open files if CEU024 and CEU013 are on                           CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
     C           *INU1     ANDEQ'0'                                       CEU024
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
     C           *INU1     ANDEQ'0'                                       CEU025
     C                     OPEN GLAPNAPD                                  CEU024
     C                     OPEN GETT1APD                                  CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
      ** Access PF/GLAPNAPD and retrieve the next available no.           CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
     C           *INU1     ANDEQ'0'                                       CEU024
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
     C           *INU1     ANDEQ'0'                                       CEU025
     C                     READ GLAPNAPF                 88               CEU024
      *                                                                   CEU024
      ** If a record is not found, initialize GLNARN                      CEU024
      *                                                                   CEU024
     C           *IN88     IFEQ *ON                                       CEU024
     C                     Z-ADD0         GLNARN                          CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     Z-ADDGLNARN    WNARN  100                      CEU024
     C                     ENDIF                                          CEU024
      *
      *
      ** Store computer suspense a/c code
     C**********           MOVELBKACCD    @CSAC   4                                           CGL029
     C                     MOVELBKACCD    @CSAC  10                                           CGL029
      *
      ** Get account type for computer suspense a/c code
     C                     MOVEL@CSAC     @ACD
     C                     EXSR GETACT
     C                     MOVEL@ACT      @CSAT   1
     C*                                                                   096179
     C* Setup key                                                         096179
     C*                                                                   096179
     C                     MOVEL'TCHG'    FSTCHG           Default Charge 096179
     C           KRTV      CHAIN@TCHGL1              91                   096179
     C*                                                                   096179
     C* If record does not exist, then signal error                       096179
     C*                                                                   096179
     C           *IN91     IFEQ '0'                                       096179
     C                     MOVELFSFINT    @CHGIN  50                      096179
     C                     MOVELFSFMNB    @CHGMN  50                      096179
     C*                                                                   096179
     C                     ELSE                                           096179
     C           *LOCK     IN   LDA                                       096179
     C                     Z-ADD28        DBASE                           096179
     C                     MOVEL'SDTCHGPD'DBFILE                          096179
     C                     MOVEL'*FIRST'  DBKEY                           096179
     C                     EXSR DBERR                                     096179
     C                     END                                            096179
      *
      ** Setup currency details for base currency
     C                     MOVEL@BSCY     @SCY    3
     C                     EXSR SETCDT
      *
      ** Store data from resp.arrays(index I)
     C                     Z-ADDCDP,I     @BDP    10
     C                     MOVELCMD,I     @BMD    1
     C                     Z-ADDSPT,I     @BSPRT 138
     C**********           MOVELTEQ,I     @BEQ    40                                          CGL029
     C                     MOVELTEQ,I     @BEQ   100                                          CGL029
      *
      ** Setup branch details for main branch
     C                     MOVE BKMABR    @BRCA   3
     C                     EXSR SETBRD
     C**********           Z-ADDICN,I     @MICN   60                                          CSD027
     C                     MOVE ICN,I     @MICN   6                                           CSD027
     C**********           Z-ADDIGT,I     @MIGT   40                                          CGL029
     C**********           Z-ADDIGF,I     @MIGF   40                                          CGL029
     C                     Z-ADDIGT,I     @MIGT  100                                          CGL029
     C                     Z-ADDIGF,I     @MIGF  100                                          CGL029
     C                     MOVELITT,I     @MITT   1
     C                     MOVELIFT,I     @MIFT   1
     C                     MOVE @BRCA     @MBRCA  3
      *
      ** Write headers to pf/gettph & pf/ttibph
     C           *INU1     IFEQ '0'
     C                     MOVEL'H'       RECI
     C                     WRITEGETTPHF
     C                     WRITETTIBPHF
     C                     END
      *
      ** Add 1 to record count of both files
     C                     Z-ADD1         @GECNT  50
     C                     Z-ADD1         @TICNT  50
     C                     Z-ADD1         T       40                                        BUG27119
      *
      ** Initialise batch total
     C                     Z-ADD0         @BATOT 150
      *
      ** Define work fields from file
      *
     C           *LIKE     DEFN PNAR      @PNAR
      *
     C           *LIKE     DEFN CNUM      @PNUM1
     C           *LIKE     DEFN CCY       @PCCY1
     C           *LIKE     DEFN ACOD      @PACD1
     C           *LIKE     DEFN ACSQ      @PASQ1
     C           *LIKE     DEFN VALD      @PVLD1
     C           *LIKE     DEFN TRTP1     @PTRT1
     C           *LIKE     DEFN PNAR      @PNAR1
     C           *LIKE     DEFN PSTA      @PPSA1
     C           *LIKE     DEFN DRCR      @PDC1
     C           *LIKE     DEFN SPOS      @PPOS1
     C           *LIKE     DEFN BRCA      @PBCA1
     C           *LIKE     DEFN RIND      @PRND1
     C           *LIKE     DEFN ATYP      @PTYP1
     C           *LIKE     DEFN STYP      @PSTP1
     C           *LIKE     DEFN PRIN      @PIND1
     C           *LIKE     DEFN GETP      @PGTP1
     C           *LIKE     DEFN PBTT      @PPBT1
     C           *LIKE     DEFN ORBR      @PORB1
      *
     C           *LIKE     DEFN CNUM      @PNUM2
     C           *LIKE     DEFN CCY       @PCCY2
     C           *LIKE     DEFN ACOD      @PACD2
     C           *LIKE     DEFN ACSQ      @PASQ2
     C           *LIKE     DEFN VALD      @PVLD2
     C           *LIKE     DEFN TRTP1     @PTRT2
     C           *LIKE     DEFN PNAR      @PNAR2
     C           *LIKE     DEFN PSTA      @PPSA2
     C           *LIKE     DEFN DRCR      @PDC2
     C           *LIKE     DEFN SPOS      @PPOS2
     C           *LIKE     DEFN BRCA      @PBCA2
     C           *LIKE     DEFN RIND      @PRND2
     C           *LIKE     DEFN ATYP      @PTYP2
     C           *LIKE     DEFN STYP      @PSTP2
     C           *LIKE     DEFN PRIN      @PIND2
     C           *LIKE     DEFN GETP      @PGTP2
     C           *LIKE     DEFN PBTT      @PPBT2
     C           *LIKE     DEFN ORBR      @PORB2
      *                                                                                       CRE019
     C           *LIKE     DEFN CNUM      @PNUMH                                              CRE019
     C           *LIKE     DEFN CCY       @PCCYH                                              CRE019
     C           *LIKE     DEFN ACOD      @PACDH                                              CRE019
     C           *LIKE     DEFN ACSQ      @PASQH                                              CRE019
     C           *LIKE     DEFN VALD      @PVLDH                                              CRE019
     C           *LIKE     DEFN TRTP1     @PTRTH                                              CRE019
     C           *LIKE     DEFN PNAR      @PNARH                                              CRE019
     C           *LIKE     DEFN PSTA      @PPSAH                                              CRE019
     C           *LIKE     DEFN DRCR      @PDCH                                               CRE019
     C           *LIKE     DEFN SPOS      @PPOSH                                              CRE019
     C           *LIKE     DEFN BRCA      @PBCAH                                              CRE019
     C           *LIKE     DEFN RIND      @PRNDH                                              CRE019
     C           *LIKE     DEFN ATYP      @PTYPH                                              CRE019
     C           *LIKE     DEFN STYP      @PSTPH                                              CRE019
     C           *LIKE     DEFN PRIN      @PINDH                                              CRE019
     C           *LIKE     DEFN GETP      @PGTPH                                              CRE019
     C           *LIKE     DEFN PBTT      @PPBTH                                              CRE019
     C           *LIKE     DEFN ORBR      @PORBH                                              CRE019
     C           *LIKE     DEFN PSTA      WBAL                                              BUG27119
      *
      ** Initialise hash totals array
     C                     DO   3         I
     C                     Z-ADD0         INT,I
     C                     Z-ADD0         DEC,I
     C                     END
      *                                                                   CAC002
      **  Access MIDAS Modules                                            CAC002
      *                                                                   CAC002
     C                     CALL 'AOMMODR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVEL'SDMMODPD'DBFILE           ***************CAC002
     C                     MOVEL@OPTN     DBKEY            ** DB ERR 31 **CAC002
     C                     Z-ADD31        DBASE            ***************CAC002
     C                     EXSR DBERR                                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Access SDPCACPD and SDTCHGPD if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      **  Retrieve Primary Funding Profit Centre from SDPCACPD            CAC002
      *                                                                   CAC002
     C                     CALL 'AOPCACR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVEL'SDPCACPD'DBFILE           ***************CAC002
     C                     MOVEL@OPTN     DBKEY            ** DB ERR 32 **CAC002
     C                     Z-ADD32        DBASE            ***************CAC002
     C                     EXSR DBERR                                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Retrieve Teller Profit Centre from SDTCHGPD                     CAC002
      *                                                                   CAC002
     C                     CALL 'AOTCHGR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDTCHG    PARM SDTCHG    DSFDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVEL'SDTCHGPD'DBFILE           ***************CAC002
     C                     MOVEL@OPTN     DBKEY            ** DB ERR 33 **CAC002
     C                     Z-ADD33        DBASE            ***************CAC002
     C                     EXSR DBERR                                     CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *
      *                                                                                       CRT012
      * Check if CRT012 is switched on                                                        CRT012
     C                     CALL 'AOSARDR0'                                                    CRT012
     C                     PARM           PRTCD   7                                           CRT012
     C                     PARM '*VERIFY' POPTN   7                                           CRT012
     C                     PARM 'CRT012'  PSARD   6                                           CRT012
      *                                                                                       CRT012
     C           PRTCD     IFEQ *BLANKS                                                       CRT012
      *                                                                                       CRT012
      * Check if Cashier Multiple Charges is On                                               CRT012
     C                     MOVE *BLANKS   SVALK2                                              CRT012
     C                     MOVE *BLANKS   SVALK3                                              CRT012
     C                     MOVE *BLANKS   SVALK4                                              CRT012
     C                     MOVE *BLANKS   SVALK5                                              CRT012
     C                     MOVE *BLANKS   SVALK6                                              CRT012
     C                     MOVE *BLANKS   SVALK7                                              CRT012
     C                     MOVE *BLANKS   SVALK8                                              CRT012
     C                     MOVE *BLANKS   SVALK7                                              CRT012
     C                     MOVE *BLANKS   SVALK8                                              CRT012
      *                                                                                       CRT012
     C                     CALL 'AOSVALR0'                                                    CRT012
     C                     PARM *BLANKS   RTNCDE  7                                           CRT012
     C                     PARM           SVALK1 20                                           CRT012
     C                     PARM           SVAL1 200                                           CRT012
     C                     PARM           SVALK2 20                                           CRT012
     C                     PARM           SVAL2 200                                           CRT012
     C                     PARM           SVALK3 20                                           CRT012
     C                     PARM           SVAL3 200                                           CRT012
     C                     PARM           SVALK4 20                                           CRT012
     C                     PARM           SVAL4 200                                           CRT012
     C                     PARM           SVALK5 20                                           CRT012
     C                     PARM           SVAL5 200                                           CRT012
     C                     PARM           SVALK6 20                                           CRT012
     C                     PARM           SVAL6 200                                           CRT012
     C                     PARM           SVALK7 20                                           CRT012
     C                     PARM           SVAL7 200                                           CRT012
     C                     PARM           SVALK8 20                                           CRT012
     C                     PARM           SVAL8 200                                           CRT012
     C                     PARM           SVALK9 20                                           CRT012
     C                     PARM           SVAL9 200                                           CRT012
     C                     PARM           SVALK0 20                                           CRT012
     C                     PARM           SVAL10200                                           CRT012
      *                                                                                       CRT012
     C           RTNCDE    IFNE *BLANKS                                                       CRT012
     C           SVAL10    IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK0    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL9     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK9    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL8     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK8    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL7     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK7    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL6     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK6    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL5     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK5    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL4     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK4    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL3     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK3    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL2     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK2    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL1     IFEQ '*NRF'                                                        CRT012
     C                     MOVE SVALK1    DBKEY                                               CRT012
     C                     ENDIF                                                              CRT012
     C           *LOCK     IN   LDA                                                           CRT012
     C                     MOVEL'SDSVALPD'DBFILE           *************                      CRT012
     C                     Z-ADD37        DBASE            * DB ERR 37 *                      CRT012
     C                     EXSR DBERR                      *************                      CRT012
     C                     ENDIF                                                              CRT012
     C           SVAL11    IFEQ 'Y'                                                           CRT012
     C                     MOVE 'Y'       CRT012  1                                           CRT012
     C                     ELSE                                                               CRT012
     C                     MOVE 'N'       CRT012                                              CRT012
     C                     ENDIF                                                              CRT012
     C*                                                                                       CRT012
     C                     ELSE                                                               CRT012
     C                     MOVE 'N'       CRT012                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                     MD054623
      * Check if RTSNarrFormat is set to 'Y'                                                MD054623
     C                     MOVE *BLANKS   RTSNK2                                            MD054623
     C                     MOVE *BLANKS   RTSNK3                                            MD054623
     C                     MOVE *BLANKS   RTSNK4                                            MD054623
     C                     MOVE *BLANKS   RTSNK5                                            MD054623
     C                     MOVE *BLANKS   RTSNK6                                            MD054623
     C                     MOVE *BLANKS   RTSNK7                                            MD054623
     C                     MOVE *BLANKS   RTSNK8                                            MD054623
     C                     MOVE *BLANKS   RTSNK7                                            MD054623
     C                     MOVE *BLANKS   RTSNK8                                            MD054623
      *                                                                                     MD054623
     C                     CALL 'AOSVALR0'                                                  MD054623
     C                     PARM *BLANKS   RTNCDE  7                                         MD054623
     C                     PARM           RTSNK1 20                                         MD054623
     C                     PARM           RTSN1 200                                         MD054623
     C                     PARM           RTSNK2 20                                         MD054623
     C                     PARM           RTSN2 200                                         MD054623
     C                     PARM           RTSNK3 20                                         MD054623
     C                     PARM           RTSN3 200                                         MD054623
     C                     PARM           RTSNK4 20                                         MD054623
     C                     PARM           RTSN4 200                                         MD054623
     C                     PARM           RTSNK5 20                                         MD054623
     C                     PARM           RTSN5 200                                         MD054623
     C                     PARM           RTSNK6 20                                         MD054623
     C                     PARM           RTSN6 200                                         MD054623
     C                     PARM           RTSNK7 20                                         MD054623
     C                     PARM           RTSN7 200                                         MD054623
     C                     PARM           RTSNK8 20                                         MD054623
     C                     PARM           RTSN8 200                                         MD054623
     C                     PARM           RTSNK9 20                                         MD054623
     C                     PARM           RTSN9 200                                         MD054623
     C                     PARM           RTSNK0 20                                         MD054623
     C                     PARM           RTSN10200                                         MD054623
      *                                                                                     MD054623
     C           RTNCDE    IFNE *BLANKS                                                     MD054623
     C           RTSN10    IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK0    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN9     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK9    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN8     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK8    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN7     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK7    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN6     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK6    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN5     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK5    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN4     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK4    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN3     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK3    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN2     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK2    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN1     IFEQ '*NRF'                                                      MD054623
     C                     MOVE RTSNK1    DBKEY                                             MD054623
     C                     ENDIF                                                            MD054623
     C           *LOCK     IN   LDA                                                         MD054623
     C                     MOVEL'SDSVALPD'DBFILE           *************                    MD054623
     C                     Z-ADD40        DBASE            ** DB ERR 40 **                  MD054623
     C                     EXSR DBERR                      *************                    MD054623
     C                     ENDIF                                                            MD054623
     C           RTSN11    IFEQ 'Y'                                                         MD054623
     C                     MOVE 'Y'       RTSNAR  1                                         MD054623
     C                     ELSE                                                             MD054623
     C                     MOVE 'N'       RTSNAR                                            MD054623
     C                     ENDIF                                                            MD054623
      *                                                                                       CRE019
      ** Check if CRE019 is switched on                                                       CRE019
      *                                                                                       CRE019
     C                     MOVE 'N'       CRE019                                              CRE019
     C                     CALL 'AOSARDR0'                                                    CRE019
     C                     PARM           PRTCD                                               CRE019
     C                     PARM '*VERIFY' POPTN                                               CRE019
     C                     PARM 'CRE019'  PSARD                                               CRE019
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE019
      *                                                                                       CRE019
     C           PRTCD     IFEQ *BLANKS                                                       CRE019
     C                     MOVE 'Y'       CRE019  1                                           CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
     C           PRTCD     IFNE *BLANKS                                                       CRE019
     C           PRTCD     ANDNE'*NRF   '                                                     CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     MOVEL'SCSARDPD'DBFILE                                              CRE019
     C                     Z-ADD107       DBASE                                               CRE019
     C                     MOVEL'CRE019'  DBKEY                                               CRE019
     C                     EXSR DBERR                                                         CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRT012
      * Open VAT file reade record                                                            CRT012
     C           KAKEY     KLIST                                                              CRT012
     C                     KFLD           GAKEY                                               CRT012
     C                     KFLD           SGAKEY                                              CRT012
     C                     MOVEL'TVA 18.6'GAKEY                                               CRT012
     C                     MOVEL'A PAYER 'SGAKEY                                              CRT012
      *                                                                                       CRT012
     C                     OPEN ABSFAC01                                                      CRT012
     C           KAKEY     CHAINABSFACF1             90                                       CRT012
     C           *IN90     IFEQ *ON                                                           CRT012
     C           *LOCK     IN   LDA                                                          BUG3526
     C                     Z-ADD106       DBASE            ************                       CRT012
     C                     MOVEL'ABSFAC01'DBFILE           DB ERROR 106                       CRT012
     C                     EXSR DBERR                      ************                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * Open Cashier Commission Transaction Types File                                        CRT012
     C                     OPEN SDBACTL0                                                      CRT012
      *                                                                                       CRT012
      * Open Cashier Transaction Posting Details File                                         CRT012
     C                     OPEN SDCTPOL0                                                      CRT012
      *                                                                                       CRT012
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            PRODET - Process details                           *
      *                                                               *
      * CALLS      DBERR  - Database Error Handling : Terminate pgm.  *
      *            GENBOE - Generate batch offset entry               *
      *            GENENT - Generate entries                          *
      *            GETACD - Get account details                       *
      *            PROEXC - Process exchange transactions             *
      *            PROITB - Process interbranch transactions          *
      *            SETBRD - Setup branch details                      *
      *            SETTTY - Set up transaction types (details)        *
      *                                                               *
      * CALLED BY  Main   - Control Process                           *
      *                                                               *
      *****************************************************************
     C           PRODET    BEGSR                           ** PRODET **
      *
     C                     SETOF                     55
      *
      ** If previous transaction was batch and batch.no has changed
      ** or                               function code has changed
     C           @PTBRI    IFEQ 'B'
     C           TBID      IFNE @PTBID
     C           FNCD      ORNE @PFNCD
      *
      ** Generate batch offset entry for previous transaction
     C                     EXSR GENBOE
      *
     C                     END
      *
     C                     END
      *
      ** If transaction type is batch and batch.no has changed
     C           TBRI      IFEQ 'B'
     C           TBRI      IFNE @PTBRI
     C           TBID      ORNE @PTBID
      *
      ** Set up transaction types (details) for new batch
     C                     EXSR SETTTY
      *
     C                     END
     C                     END
      *
      ** If function code has changed
     C           FNCD      IFNE @PFNCD
      *
      ** Access LF/SDFNCDL1 for new function code record
     C                     CALL 'AOFNCDR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           FNCD
     C           SDFNCD    PARM SDFNCD    DSFDY
      *
      ** If record does not exist or is deleted - database errors
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDFNCDPD'DBFILE           ***************
     C                     Z-ADD6         DBASE            ** DB ERR 06 **
     C                     MOVELFNCD      DBKEY            ***************
     C                     EXSR DBERR
     C                     END
      *
      ** If function code is not '00I' and not '0JI' and not '***'
      **                               and not '0JS' and not '0JX'        CRT002
      *                                                                   CRT002
     C           FNCD      IFNE '00I'
     C           FNCD      ANDNE'0JI'
     C           FNCD      ANDNE'0JS'                                     CRT002
     C           FNCD      ANDNE'0JX'                                     CRT002
     C           FNCD      ANDNE'***'
      *
      ** Set up transaction types(details) for new function code
     C                     EXSR SETTTY
      *
     C                     END
      *
     C                     ELSE
      *
      ** Restore GL code and Account type
     C           CRT102    IFEQ 'Y'
     C                     Z-ADD@GL1      @ASGL1
     C                     Z-ADD@GL2      @ASGL2
     C                     MOVEL@GLT1     @AGLT1
     C                     MOVEL@GLT2     @AGLT2
     C                     END
      *
     C                     END
      *
      ** If function code 0JN, 0JO, 00N, 00O, 00E or 00F set transaction
      ** type details to ensure correct a/c code is used
      *
     C           FNCD      IFEQ '0JN'
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '00N'
     C           FNCD      OREQ '00O'
     C           FNCD      OREQ '00E'
     C           FNCD      OREQ '00F'
     C                     MOVE *BLANKS   @PFNCD
     C                     END
      *
      ** If function code is '00I' or '0JI'
     C           FNCD      IFEQ '00I'
     C           FNCD      OREQ '0JI'
     C           FNCD      OREQ '0JS'                                     153389
     C           FNCD      OREQ '0JX'                                     153389
     C           FNCD      OREQ '0JE'                                                         CRT005
     C           CRT005    ANDEQ'Y'                                                           CRT005
     C           FNCD      OREQ '0JF'                                                         CRT005
     C           CRT005    ANDEQ'Y'                                                           CRT005
      *
      ***If*transaction*types*have*changed*************************       153393
     C***********TRTP1     IFNE @PTTP1                                    153393
     C***********TRTP2     ORNE @PTTP2                                    153393
      *
      ** Set up transaction types(details) for new function code
     C                     EXSR SETTTY
      *
     C***********          END                                            153393
      *
     C                     END
      *
      ** If retail a/c no. is non-zero
     C           TRACNO    IFNE *ZEROS
      *
      ** Get customer a/c details from lf/acnum
     C                     Z-ADDTRACNO    @ACNO  100
     C                     EXSR GETACD
     C**********           Z-ADDCNUM      @CNUM1  60                                          CSD027
     C                     MOVE CNUM      @CNUM1  6                                           CSD027
     C**********           Z-ADDACOD      @ACOD1  40                                          CGL029
     C                     Z-ADDACOD      @ACOD1 100                                          CGL029
     C                     Z-ADDACSQ      @ACSQ1  20
     C                     MOVELCCY       @CCY1   3
     C                     MOVE BRCA      @BRCA1  3
     C                     MOVE ATYP      @ATYP1  1
     C                     MOVE STYP      @STYP1  1
      *
     C                     ELSE                                           159167
     C                     Z-ADDTRACNO    @ACNO                           159167
     C                     MOVELCUS1      @CNUM1                          159167
     C                     Z-ADDACD1      @ACOD1                          159167
     C                     Z-ADDACSQ1     @ACSQ1                          159167
     C                     MOVELCCY1      @CCY1                           159167
     C                     MOVE ITLB      @BRCA1                          159167
     C                     Z-ADD0         RIND                            189955
     C                     MOVEL@CSAT     ATYP                            189955
     C                     END
     C/COPY WNCPYSRC,RE4201C005
      *
      ** For retail transfer (00a)
     C           FNCD      IFEQ '00A'
      *
      ** Get credit a/c details from lf/acnum
     C                     MOVELTTAC      @ACNO
     C                     EXSR GETACD
     C**********           Z-ADDCNUM      @CNUM2  60                                          CSD027
     C                     MOVE CNUM      @CNUM2  6                                           CSD027
     C**********           Z-ADDACOD      @ACOD2  40                                          CGL029
     C                     Z-ADDACOD      @ACOD2 100                                          CGL029
     C                     Z-ADDACSQ      @ACSQ2  20
     C                     MOVELCCY       @CCY2   3
     C                     MOVE BRCA      @BRCA2  3
     C                     MOVE ATYP      @ATYP2  1
     C                     MOVE STYP      @STYP2  1
      *
     C                     END
      *                                                                                       CRE019
      ** If House check account is entered                                                    CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         SPSTA                                               CRE019
     C                     Z-ADD0         SORAMT                                              CRE019
     C                     MOVE 'N'       WHCFLG  1                                           CRE019
     C                     MOVE HCAC      HCACN  100                                          CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           HCACN     ANDNE*ZEROS                                                        CRE019
      *                                                                                       CRE019
     C                     MOVELHCAC      @ACNO                                               CRE019
     C                     EXSR GETACD                                                        CRE019
     C**********           Z-ADDCNUM      @CNUM2                                       CRE019 CSD027
     C                     MOVE CNUM      @CNUM2                                              CSD027
     C                     Z-ADDACOD      @ACOD2                                              CRE019
     C                     Z-ADDACSQ      @ACSQ2                                              CRE019
     C                     MOVELCCY       @CCY2                                               CRE019
     C                     MOVE BRCA      @BRCA2                                              CRE019
     C                     MOVE ATYP      @ATYP2                                              CRE019
     C                     MOVE STYP      @STYP2                                              CRE019
      *                                                                                       CRE019
     C                     MOVE 'Y'       WHCFLG                                              CRE019
     C                     ENDIF                                                              CRE019
      *
      *
      ** Setup branch details for teller branch
     C                     MOVE ITLB      @BRCA   3
     C                     EXSR SETBRD
     C**********           Z-ADDICN,I     @TICN   60                                          CSD027
     C                     MOVE ICN,I     @TICN   6                                           CSD027
     C**********           Z-ADDIGT,I     @TIGT   40                                          CGL029
     C**********           Z-ADDIGF,I     @TIGF   40                                          CGL029
     C                     Z-ADDIGT,I     @TIGT  100                                          CGL029
     C                     Z-ADDIGF,I     @TIGF  100                                          CGL029
     C                     MOVELITT,I     @TITT   1
     C                     MOVELIFT,I     @TIFT   1
      *
      ** Setup branch for cust-a/c if retail a/c no. is not zeros
     C           TRACNO    IFNE *ZEROS
      *
     C                     MOVE @BRCA1    @BRCA
     C                     EXSR SETBRD
     C**********           Z-ADDICN,I     @ICN1   60                                          CSD027
     C                     MOVE ICN,I     @ICN1   6                                           CSD027
     C**********           Z-ADDIGT,I     @IGT1   40                                          CGL029
     C**********           Z-ADDIGF,I     @IGF1   40                                          CGL029
     C                     Z-ADDIGT,I     @IGT1  100                                          CGL029
     C                     Z-ADDIGF,I     @IGF1  100                                          CGL029
     C                     MOVELITT,I     @ITT1   1
     C                     MOVELIFT,I     @IFT1   1
      *
     C                     END
      *                                                                                       CRE019
      ** Setup branch for cust-a/c if house cheque  a/c no. is not zeros                      CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           HCACN     ANDNE*ZEROS                                                        CRE019
     C           WHCFLG    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
     C                     MOVE @BRCA2    @BRCA                                               CRE019
     C                     EXSR SETBRD                                                        CRE019
     C**********           Z-ADDICN,I     @ICNH   60                                   CRE019 CSD027
     C                     MOVE ICN,I     @ICNH   6                                           CSD027
     C                     Z-ADDIGT,I     @IGTH  100                                          CRE019
     C                     Z-ADDIGF,I     @IGFH  100                                          CRE019
     C                     MOVELITT,I     @ITTH   1                                           CRE019
     C                     MOVELIFT,I     @IFTH   1                                           CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *
      ** Setup branch for credit-a/c if retail transfer(00a)
      **
     C           FNCD      IFEQ '00A'
      *
     C                     MOVE @BRCA2    @BRCA
     C                     EXSR SETBRD
     C**********           Z-ADDICN,I     @ICN2   60                                          CSD027
     C                     MOVE ICN,I     @ICN2   6                                           CSD027
     C**********           Z-ADDIGT,I     @IGT2   40                                          CGL029
     C**********           Z-ADDIGF,I     @IGF2   40                                          CGL029
     C                     Z-ADDIGT,I     @IGT2  100                                          CGL029
     C                     Z-ADDIGF,I     @IGF2  100                                          CGL029
     C                     MOVELITT,I     @ITT2   1
     C                     MOVELIFT,I     @IFT2   1
      *
     C                     END
      *                                                                                       249906
      ** Set Transaction details                                                              249906
      *                                                                                       249906
     C           TBRI      CAT  TBID      UWRK09  9                                           249906
     C                     MOVE TBTN      UWRK09                                              249906
     C                     MOVELUWRK09    OTRF      P                                         249906
     C                     MOVE FNCD      OTRF                                                249906
      *                                                                                       249906
      *
      ** Perform generate entry
     C                     EXSR GENENT
      *
      ** Perform process exchange transactions only for the foll.trans.
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '0JN'
     C           FNCD      OREQ '0JK'
     C           FNCD      OREQ '0JQ'
     C           FNCD      OREQ '0JR'                                     CRT002
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C           FNCD      OREQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C                     EXSR PROEXC
     C                     END
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           WHCFLG    ANDEQ'Y'                                                           CRE019
     C           CCY1      ANDNE*BLANKS                                                       CRE019
     C           @CCY2     ANDNE*BLANKS                                                       CRE019
     C           CCY1      ANDNE@CCY2                                                         CRE019
     C                     EXSR PROEX2                                                        CRE019
     C                     ENDIF                                                              CRE019
      *
      ** Perform process interbranch transactions for any trans.other
      ** than the following -
     C           FNCD      IFNE '***'
     C           FNCD      ANDNE'0JI'
     C           FNCD      ANDNE'0JS'                                     CRT002
     C           FNCD      ANDNE'0JX'                                     CRT002
     C           FNCD      ANDNE'0JA'
     C           FNCD      ANDNE'0JT'
     C           FNCD      ANDNE'00X'                                     CRT002
     C           FNCD      ANDNE'0JV'
     C           FNCD      ANDNE'00S'                                     CRT002
     C           FNCD      ANDNE'00E'
     C           FNCD      ANDNE'00F'
     C           FNCD      ANDNE'0JE'
     C           FNCD      ANDNE'0JF'
     C                     EXSR PROITB
     C                     END
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           WHCFLG    ANDEQ'Y'                                                           CRE019
     C           @BRCA2    ANDNEITLB                                                          CRE019
     C                     EXSR PROIT2                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C/COPY WNCPYSRC,RE4201C028
      *                                                                   130021
      ** Reset the relevant fields from TTCHGPD to avoid the charges      130021
      ** from previous transactions to be used on the transactions        130021
      ** without charge.                                                  130021
     C                     MOVEL*BLANKS   CCY3                            130021
     C                     Z-ADD0         AMT3                            130021
     C                     Z-ADD0         TTP3                            130021
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SETTTY - Set up transaction types (details)        *
      *                                                               *
      * CALLS      DBERR  - Database Error Handling : Terminate pgm.  *
      *            GETACT - Get account type                          *
      *            ITRDET - Initialise trans.type details             *
      *                                                               *
      * CALLED BY  PRODET - Process details                           *
      *                                                               *
      *****************************************************************
     C           SETTTY    BEGSR                           ** SETTTY **
      *
      ** Store the fn.code, teller/batch ind., batch no.,tran.type 1,2
     C                     MOVELFNCD      @PFNCD  3
     C                     MOVELTBRI      @PTBRI  1
     C                     MOVELTBID      @PTBID  3
     C                     MOVE TRTP1     @PTTP1  50
     C                     MOVE TRTP2     @PTTP2  50
      *
      ** Initialise trans.types needed to access LF/SDRETRL0
     C                     Z-ADD0         @TTYP1  50
     C                     Z-ADD0         @TTYP2  50
     C                     Z-ADD0         @TTYPH  50                                          CRE019
      *
      ** Initialise trans.type details
     C                     EXSR ITRDET
      *
      ** If function code is '00N' or ... - select tran.type as CR #1
     C           FNCD      IFEQ '00N'
     C           FNCD      OREQ '00K'
     C           FNCD      OREQ '00Q'
     C           FNCD      OREQ '00R'                                     CRT002
     C           FNCD      OREQ '0JN'
     C           FNCD      OREQ '0JK'
     C           FNCD      OREQ '0JQ'
     C           FNCD      OREQ '0JR'                                     CRT002
     C           FNCD      OREQ '00E'
     C                     MOVELFQCRC1    @TTYP1
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C                     MOVELFQDRC1    @TTYPH                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     END
      *
      ** If function code is '00O' or ... - select tran.type as DR #1
     C           FNCD      IFEQ '00O'
     C           FNCD      OREQ '00L'
     C           FNCD      OREQ '00W'                                     CRT002
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C           FNCD      OREQ '00F'
     C                     MOVELFQDRC1    @TTYP1
     C                     END
      *
      ** If function code is '00H' or ... - select tran.type as CR #1
      **                                                     &  CR #2
     C           FNCD      IFEQ '00H'
     C           FNCD      OREQ '00P'
     C           FNCD      OREQ '0JH'
     C           FNCD      OREQ '0JP'
     C                     MOVELFQCRC1    @TTYP1
     C                     MOVELFQCRC2    @TTYP2
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C                     MOVELFQDRC1    @TTYPH                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     END
      *
      ** If function code is '00A' or ... - select tran.type as DR #1
      **                                                     &  CR #1
     C           FNCD      IFEQ '00A'
     C           FNCD      OREQ '0JA'
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
     C           FNCD      OREQ '0JF'
     C                     MOVELFQDRC1    @TTYP1
     C                     MOVELFQCRC1    @TTYP2
     C                     END
      *
      ** If function code is '0JE' - select tran.type as DR #1 & CR # 1
     C           FNCD      IFEQ '0JE'
     C                     MOVELFQCRC1    @TTYP1
     C                     MOVELFQDRC1    @TTYP2
     C                     END
      *
      ** If function code is '00I' or '0JI' select from ttran.type1,2
      **                     '0JS' or '0JX'                               CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '00I'
     C           FNCD      OREQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C                     MOVELTRTP1     @TTYP1
     C                     MOVELTRTP2     @TTYP2
     C                     END
      *
      ** If function code is '***' select from ttran.type1
     C           FNCD      IFEQ '***'
     C                     MOVELTRTP1     @TTYP1
      *
      ** Store currency code and branch code of batch
     C                     MOVELCCY1      @BTCCY  3
     C                     MOVE ITLB      @BTBCA  3
     C                     END
      *
      ** Access LF/SDRETRL0 for transaction details
      *
      ** If @ttyp1 is not zero
     C           @TTYP1    IFNE *ZERO
     C*
     C                     MOVE @TTYP1    WTTYP1  5
     C                     CALL 'AORETRR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           WTTYP1
     C           SDRETR    PARM SDRETR    DSFDY
      *
      ** If record does not exist -
      *
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETRPD'DBFILE           ***************
     C                     Z-ADD7         DBASE            ** DB ERR 07 **
     C                     MOVEL@TTYP1    DBKEY            ***************
     C                     EXSR DBERR
      *
     C                     ELSE
      *
     C                     MOVELA1RTNM    @TTNM1
     C                     MOVELA1DCIN    @DCIN1
     C                     MOVELA1COIN    @COIN1
     C                     MOVE A1ASGL    @ASGL1
     C                     MOVELA1PASB    @PBPT1
      *                                                                                       CRT005
      ** Move Teller Over/Under account code to GL account code workfield                     CRT005
      ** if transaction is a balance cash (account code not zero).                            CRT005
      *                                                                                       CRT005
     C           CRT005    IFEQ 'Y'                                                           CRT005
      *                                                                                       CRT005
     C           FNCD      IFEQ '0JE'                                                         CRT005
     C           ACD1      ANDNE*ZERO                                                         CRT005
     C           FNCD      OREQ '0JF'                                                         CRT005
     C           ACD1      ANDNE*ZERO                                                         CRT005
     C                     Z-ADDACD1      @ASGL1                                              CRT005
     C                     ENDIF                                                              CRT005
      *                                                                                       CRT005
     C                     ENDIF                                                              CRT005
      *                                                                                       CRT005
     C                     MOVE *BLANKS   @AGLT1
     C           CRT102    IFEQ 'Y'
     C                     MOVE A1ASGL    @GL1
     C                     MOVELA1CIND    @CSIN1
     C                     END
      *                                                                   153393
     C                     ENDIF                                          153393
     C                     ENDIF                                          153393
      *
      ** If function code is '0JN', '0JO', '00N', '00O', '00E', '00F'
      ** '0JI', '0JS' or '0JX'                                            151095
      ** use cash account code from transaction currency
      *
      ** Only get cash account code if transaction type flagged as cash   153393
      ** OR transaction type is 0                                         153393
      *                                                                   153393
     C           A1CIND    IFEQ 'Y'                                       153393
     C           @TTYP1    OREQ *ZERO                                     153393
      *                                                                   153393
     C           FNCD      IFEQ '00E'
     C           FNCD      OREQ '00F'
     C           FNCD      OREQ '0JN'
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '00N'
     C           FNCD      OREQ '00O'
     C           FNCD      OREQ '0JI'                                     151095
     C           FNCD      OREQ '0JS'                                     151095
     C           FNCD      OREQ '0JX'                                     151095
     C                     MOVE CCY1      WKCCY   3                       151095
     C                     EXSR SETCSH
     C                     MOVE @@ASGL    @ASGL1
     C                     END
      *                                                                   153393
     C                     ENDIF                                          153393
      *
      ** Get account type for associated gl if non-zero
     C           @ASGL1    IFNE 0
     C                     MOVE @ASGL1    @ACD
     C                     EXSR GETACT
     C                     MOVEL@ACT      @AGLT1
     C           CRT102    IFEQ 'Y'
     C                     MOVEL@ACT      @GLT1
     C                     END
      *
     C                     END
      *
     C***********          END                                            153393
      *
     C***********          END                                            153393
      *
     C*
      ** If @ttyp2 is not zero
     C*
     C           @TTYP2    IFNE *ZERO
     C*
     C*********************MOVE @TTYP1    WTTYP2  5                       097905
     C                     MOVE @TTYP2    WTTYP2  5                       097905
     C                     CALL 'AORETRR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           WTTYP2
     C           SDRETR    PARM SDRETR    DSFDY
      *
      ** If record does not exist -
     C           @RTCD     IFNE *BLANK
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETRPD'DBFILE           ***************
     C                     Z-ADD8         DBASE            ** DB ERR 08 **
     C                     MOVEL@TTYP2    DBKEY            ***************
     C                     EXSR DBERR
      *
     C                     ELSE
      *
     C                     MOVELA1RTNM    @TTNM2
     C                     MOVELA1DCIN    @DCIN2
     C                     MOVELA1COIN    @COIN2
     C                     MOVE A1ASGL    @ASGL2
     C                     MOVELA1PASB    @PBPT2
      *                                                                                       CRT005
      ** Move Teller Over/Under account code to GL account code workfield                     CRT005
      ** if transaction is a balance cash (account code not zero).                            CRT005
      *                                                                                       CRT005
     C           CRT005    IFEQ 'Y'                                                           CRT005
      *                                                                                       CRT005
     C           FNCD      IFEQ '0JE'                                                         CRT005
     C           ACD1      ANDNE*ZERO                                                         CRT005
     C           FNCD      OREQ '0JF'                                                         CRT005
     C           ACD1      ANDNE*ZERO                                                         CRT005
     C                     Z-ADDACD1      @ASGL2                                              CRT005
     C                     ENDIF                                                              CRT005
      *                                                                                       CRT005
     C                     ENDIF                                                              CRT005
      *                                                                                       CRT005
     C                     MOVE *BLANKS   @AGLT2
     C           CRT102    IFEQ 'Y'
     C                     MOVE A1ASGL    @GL2
     C                     MOVELA1CIND    @CSIN2
     C                     END
      *                                                                   153393
     C                     ENDIF                                          153393
     C                     ENDIF                                          153393
      *                                                                   153393
      ** If function code is '0JI', '0JS' or '0JX'                        151095
      ** use cash account code from transaction currency                  151095
      *                                                                   151095
     C           A1CIND    IFEQ 'Y'                                       153393
     C           @TTYP2    OREQ *ZERO                                     153393
      *                                                                   153393
     C           FNCD      IFEQ '0JI'                                     151095
     C           FNCD      OREQ '0JS'                                     151095
     C           FNCD      OREQ '0JX'                                     151095
     C                     MOVE CCY2      WKCCY                           151095
     C                     EXSR SETCSH                                    151095
     C                     MOVE @@ASGL    @ASGL2                          151095
     C                     END                                            151095
      *                                                                   153393
     C                     ENDIF                                          153393
      *
      ** Get account type for associated gl if non-zero
     C           @ASGL2    IFNE 0
     C                     MOVE @ASGL2    @ACD
     C                     EXSR GETACT
     C                     MOVEL@ACT      @AGLT2
     C           CRT102    IFEQ 'Y'
     C                     MOVEL@ACT      @GLT2
     C                     END
     C                     END
      *
      ** If @TTYPH is not zero                                                                CRE019
      *                                                                                       CRE019
     C           @TTYPH    IFNE *ZERO                                                         CRE019
     C*                                                                                       CRE019
     C                     MOVE @TTYPH    WTTYPH  5                                           CRE019
     C                     CALL 'AORETRR0'                                                    CRE019
     C                     PARM '*BLANKS' @RTCD   7                                           CRE019
     C                     PARM '*KEY   ' @OPTN   7                                           CRE019
     C                     PARM           WTTYPH                                              CRE019
     C           SDRETR    PARM SDRETR    DSFDY                                               CRE019
      *                                                                                       CRE019
      ** If record does not exist -                                                           CRE019
      *                                                                                       CRE019
     C           @RTCD     IFNE *BLANK                                                        CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     MOVEL'SDRETRPD'DBFILE                                              CRE019
     C                     Z-ADD108       DBASE                                               CRE019
     C                     MOVEL@TTYPH    DBKEY                                               CRE019
     C                     EXSR DBERR                                                         CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
     C                     MOVELA1RTNM    @TTNMH                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
     C***********          END                                            153393
      *
     C***********          END                                            153393
      *
     C                     ENDSR
      *****************************************************************
      *                                                               *
      *            ITRDET - Initialise trans.type details             *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  SETTTY - Set up transaction types (details)        *
      *                                                               *
      *****************************************************************
     C           ITRDET    BEGSR                           ** ITRDET **
      *
     C                     MOVE *BLANKS   @TTNM1 30
     C                     MOVE *BLANKS   @DCIN1  1
     C                     MOVE *BLANKS   @COIN1  1
     C                     MOVE *BLANKS   @PBPT1  2
     C**********           MOVE *ZEROS    @ASGL1  40                                          CGL029
     C                     MOVE *ZEROS    @ASGL1 100                                          CGL029
     C                     MOVE *BLANKS   @AGLT1  1
      *
     C                     MOVE *BLANKS   @TTNM2 30
     C                     MOVE *BLANKS   @DCIN2  1
     C                     MOVE *BLANKS   @COIN2  1
     C                     MOVE *BLANKS   @PBPT2  2
     C**********           MOVE *ZEROS    @ASGL2  40                                          CGL029
     C                     MOVE *ZEROS    @ASGL2 100                                          CGL029
     C                     MOVE *BLANKS   @AGLT2  1
      *                                                                                       CRE019
     C                     MOVE *BLANKS   @TTNMH 30                                           CRE019
      *
     C           CRT102    IFEQ 'Y'
     C**********           MOVE *ZEROS    @GL1    40                                          CGL029
     C                     MOVE *ZEROS    @GL1   100                                          CGL029
     C                     MOVE *BLANKS   @GLT1   1
     C                     MOVE *BLANKS   @CSIN1  1
     C**********           MOVE *ZEROS    @GL2    40                                          CGL029
     C                     MOVE *ZEROS    @GL2   100                                          CGL029
     C                     MOVE *BLANKS   @GLT2   1
     C                     MOVE *BLANKS   @CSIN2  1
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GENENT - Generate entries                          *
      *                                                               *
      * CALLS      GEN00N - Generate entry for fn.code '00N'          *
      *            GEN0KQ - Generate entry for fn.code '00K' & '00Q'  *
      *                                                '00R'          *   CRT002
      *            GEN0HP - Generate entry for fn.code '00H' & '00P'  *
      *            GEN0JN - Generate entry for fn.code '0JN'          *
      *            GENJKQ - Generate entry for fn.code '0JK' '0JQ'    *
      *                                                '0JR'          *   CRT002
      *            GENJHP - Generate entry for fn.code '0JH' '0JP'    *
      *            GEN00O - Generate entry for fn.code '00O'          *
      *            GEN00L - Generate entry for fn.code '00L'          *
      *                                                '00W'          *   CRT002
      *            GEN0JO - Generate entry for fn.code '0JO'          *
      *            GEN0JL - Generate entry for fn.code '0JL'          *
      *                                                '0JW'          *   CRT002
      *            GEN00A - Generate entry for fn.code '00A'          *
      *            GEN00I - Generate entry for fn.code '00I'          *
      *            GENBAT - Generate entry for fn.code '***'          *
      *            GEN0JI - Generate entry for fn.code '0JI'          *
      *                                                '0JS'          *   CRT002
      *                                                '0JX'          *   CRT002
      *            GEN0JA - Generate entry for fn.code '0JA'          *
      *                     '0JT' & '0JV'                             *
      *                     '00X' & '00S'                             *   CRT002
      *            GEN00E - Generate entry for fn.code '00E'          *
      *            GEN00F - Generate entry for fn.code '00F'          *
      *            GEN0JE - Generate entry for fn.code '0JE'          *
      *            GEN0JF - Generate entry for fn.code '0JF'          *
      *                                                               *
      * CALLED BY  PRODET - Process details                           *
      *                                                               *
      *****************************************************************
     C           GENENT    BEGSR                           ** GENENT **
      *
      ** Generate entries depending on function code
      *
     C           FNCD      CASEQ'00N'     GEN00N
     C           FNCD      CASEQ'00K'     GEN0KQ
     C           FNCD      CASEQ'00Q'     GEN0KQ
     C           FNCD      CASEQ'00R'     GEN0KQ                          CRT002
     C           FNCD      CASEQ'00H'     GEN0HP
     C           FNCD      CASEQ'00P'     GEN0HP
     C           FNCD      CASEQ'0JN'     GEN0JN
     C           FNCD      CASEQ'0JK'     GENJKQ
     C           FNCD      CASEQ'0JQ'     GENJKQ
     C           FNCD      CASEQ'0JR'     GENJKQ                          CRT002
     C           FNCD      CASEQ'0JH'     GENJHP
     C           FNCD      CASEQ'0JP'     GENJHP
     C           FNCD      CASEQ'00O'     GEN00O
     C           FNCD      CASEQ'00L'     GEN00L
     C           FNCD      CASEQ'00W'     GEN00L                          CRT002
     C           FNCD      CASEQ'0JO'     GEN0JO
     C           FNCD      CASEQ'0JL'     GEN0JL
     C           FNCD      CASEQ'0JW'     GEN0JL                          CRT002
     C           FNCD      CASEQ'00A'     GEN00A
     C           FNCD      CASEQ'00I'     GEN00I
     C           FNCD      CASEQ'***'     GENBAT
     C           FNCD      CASEQ'0JI'     GEN0JI
     C           FNCD      CASEQ'0JS'     GEN0JI                          CRT002
     C           FNCD      CASEQ'0JX'     GEN0JI                          CRT002
     C           FNCD      CASEQ'0JA'     GEN0JA
     C           FNCD      CASEQ'0JT'     GEN0JA
     C           FNCD      CASEQ'00X'     GEN0JA                          CRT002
     C           FNCD      CASEQ'0JV'     GEN0JA
     C           FNCD      CASEQ'00S'     GEN0JA                          CRT002
     C           FNCD      CASEQ'00E'     GEN00E
     C           FNCD      CASEQ'00F'     GEN00F
     C           FNCD      CASEQ'0JE'     GEN0JE
     C           FNCD      CASEQ'0JF'     GEN0JF
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            PROEXC - Process exchange transactions             *
      *                                                               *
      *            Generate Spot trade and trade equiv entries for    *
      *            - FX transactions '0JI'                            *
      *                              '0JS', '0JX'                     *   CRT002
      *            - Non a/c ccy transactions '0JH' '0JP' '0JN' '0JL' *
      *                                       '0JO' '0JK' '0JQ'       *
      *                                       '0JW' '0JR'             *   CRT002
      *                                                               *
      * CALLS      GETACT - Get account type                          *
      *            MOVEXC - Move values for exchange transactions     *
      *            SETCDT - Setup currency details                    *
      *            RTCONV - Currency conversion                       *
      *                                                               *
      * CALLED BY  PRODET - Process details                           *
      *                                                               *
      *****************************************************************
     C           PROEXC    BEGSR                           ** PROEXC **
      ** Set CCY2 to that of customer a/c ccy for non-fx transactions
     C           FNCD      IFNE '0JI'
     C           FNCD      ANDNE'0JS'                                     CRT002
     C           FNCD      ANDNE'0JX'                                     CRT002
     C                     MOVE @CCY1     CCY2
     C                     END
      *
      ** Initialise flag to indicate generation of trade eq.
     C                     MOVE *BLANK    TRADE   1
      *
      ** IF buy/trans ccy is the same as base ccy and eq.a/c is nonzero
     C           CCY1      IFEQ @BSCY
     C           @BEQ      ANDNE*ZEROS
      *
      ** OR if sell/a/c ccy is the same as base ccy & eq.a/c is nonzero
     C           CCY2      OREQ @BSCY
     C           @BEQ      ANDNE*ZEROS
      *
      ** OR if both currencies are not base currency
     C           CCY1      ORNE @BSCY
     C           CCY2      ANDNE@BSCY
      *
     C                     MOVE 'Y'       TRADE   1
      *
     C                     END
      *                                                                   CAC002
      **  If analytical accounting is available...                        CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      **  Calculate margin amount for non-FX transactions                 CAC002
      *                                                                   CAC002
     C           FNCD      IFNE '0JI'                                     CAC002
     C           FNCD      ANDNE'0JS'                                     CAC002
     C           FNCD      ANDNE'0JX'                                     CAC002
     C                     EXSR SRMACC                                    CAC002
      *                                                                   CAC002
      **  Calculate margin amount for Bureau de Change FX transactions    CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     EXSR SRMALC                                    CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Output new margin posting.                                      CAC002
      *                                                                   CAC002
     C           WWMAMT    IFNE 0                                         CAC002
     C           CCY2      ANDNE@BSCY                                     140254
     C                     EXSR SRWMAR                                    CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Check if teller profit centre can hold an FX position.          CAC002
      *                                                                   CAC002
     C                     CALL 'AOPRFCR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM FSTEPC    WPRFC   4                       CAC002
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVEL'SDPRFCPD'DBFILE           ***************CAC002
     C                     MOVELFSTEPC    DBKEY            ** DB ERR 36 **CAC002
     C                     Z-ADD36        DBASE            ***************CAC002
     C                     EXSR DBERR                                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Use FX Position Profit Centre if not blank.                     CAC002
      *                                                                   CAC002
     C           DSFPPC    IFNE *BLANKS                                   CAC002
     C                     MOVE DSFPPC    PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE FSTEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *
     C**
     C**   SUPPRESS IF CCY1 IS BSCY, PROCEED TO CCY2 ENTRIES
     C**
     C           TRADE     IFEQ ' '
     C           CCY1      ANDEQ@BSCY
     C                     GOTO BYPCY1
     C                     END
     C**
      *
      ** For TRANS/BUY Ccy SPOT TRADE entry ------------------- entry 1
      *
      ** Move fields to record for buy ccy.spot trade
     C                     EXSR MOVEXC
      *
     C                     MOVELCCY1      CCY
      *
      ** Move amount depending on function code
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           AMT1      ADD  AMT2      PSTA
     C                     ELSE
      *                                                                   118271
      **  Include charge if not in account currency (ie, charge in        118271
      **  transaction currency).                                          118271
      *                                                                   118271
     C                     SELEC                                          118271
      *                                                                   118271
     C           FNCD      WHEQ '0JO'                                     118271
     C           FNCD      OREQ '0JL'                                     118271
     C           FNCD      OREQ '0JW'                                     118271
      *                                                                   118271
     C           CCY3      IFEQ CCY                                       118271
     C           AMT1      ADD  AMT3      PSTA                            118271
     C                     ELSE                                           118271
     C                     Z-ADDAMT1      PSTA                            118271
     C                     ENDIF                                          118271
      *                                                                   118271
     C           FNCD      WHNE '00S'                                     118271
     C           FNCD      ANDNE'00X'                                     118271
     C           FNCD      ANDNE'0JI'                                     118271
     C           FNCD      ANDNE'0JS'                                     118271
     C           FNCD      ANDNE'0JX'                                     118271
      *                                                                   118271
     C           CCY3      IFEQ CCY                                       118271
     C           AMT1      SUB  AMT3      PSTA                            118271
     C                     ELSE                                           118271
     C                     Z-ADDAMT1      PSTA
     C                     ENDIF                                          118271
      *                                                                   118271
     C                     OTHER                                          118271
     C                     Z-ADDAMT1      PSTA                            118271
     C                     ENDSL                                          118271
      *
     C                     END
      *                                                                   CAC002
      **  Subtract margin amount from posting amount if buy currency is   CAC002
      **  the local currency and analytical accounting is installed       CAC002
      *                                                                   CAC002
     C           CCY1      IFEQ BJLCCY                                    CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C           FNCD      IFEQ '0JI'                                     CAC002
     C           FNCD      OREQ '0JS'                                     CAC002
     C           FNCD      OREQ '0JX'                                     CAC002
     C                     SUB  WWMAMT    PSTA                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *
      ** Move dr/cr ind. depending on function code
     C           FNCD      IFEQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
      *
      ** If function code is '0ji' - move narration accordingly
      **                  or '0JS' or '0JX'                               CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C                     Z-ADDTBTN      @TTRNO
     C                     MOVE *BLANK    @N3115
     C                     MOVE *BLANK    @N3215
     C                     MOVEL@NA115    @N3115
     C                     MOVEL' BUY'    @N3215
     C                     MOVE *BLANK    PNAR
     C                     MOVEL@NA3DS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C                     MOVE 'GB00930' ##MGID                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                             109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP1                                           S01408
     C*                                                                   S01408
     C                     END
      *
      ** If a/c type is 'R'
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     END
     C/COPY WNCPYSRC,RE4201C006
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write record to pf/gettpd for buy ccy spot trade
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Store the narration for the next entry
     C                     MOVE *BLANK    @PNAR
     C                     MOVELPNAR      @PNAR
      *
      *
      ** For TRANS/BUY Ccy SPOT TRADE EQUIVALENT -------------- entry 2
      *
      ** Only generate if (a) none of the currencies is base ccy;
      **               or (b) one of the currencies is base ccy and
      **                      base ccy trade equiv a/c is not zero
      *
      ** IF entry needs to be generated
      *
      ** Setup currency details to get the trade eq. a/c
     C                     MOVELCCY1      @SCY
     C                     EXSR SETCDT
     C**********           MOVELTEQ,I     @TEQ    40                                          CGL029
     C                     MOVELTEQ,I     @TEQ   100                                          CGL029
      *
      ** Get account type for trade eq. a/c code
     C                     MOVE @TEQ      @ACD
     C                     EXSR GETACT
     C                     MOVEL@ACT      @EQACT  1
      *
      ** Move fields to record for buy ccy.eq. a/c ------ entry 2
     C                     EXSR MOVEXC
      *
     C                     Z-ADD@TEQ      ACOD
     C                     MOVEL@BSCY     CCY
     C                     MOVEL@EQACT    ATYP
      *
      ** Setup posting amount field
      *
      ** If the contra ccy (cust./sell ccy) is same as base ccy
      **    set amount to be the sell/cust acc amount
     C           CCY2      IFEQ @BSCY
      *
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           CVAM      ADD  CVAM2     PSTA
      *
     C                     ELSE
      *
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C                     Z-ADDAMT2      PSTA
      *
     C                     ELSE
      *
     C                     Z-ADDCVAM      PSTA
     C                     END
      *
     C                     END
      *
     C                     ELSE
      *
      ** If the first ccy (buy/trans ccy) is same as base ccy
      **    set amount to be the buy/trans amount
     C           CCY1      IFEQ @BSCY
      *
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           AMT1      ADD  AMT2      PSTA
      *
     C                     ELSE
      *                                                                   118271
      **  Include charge if not in account currency (ie, charge in        118271
      **  transaction currency).                                          118271
      *                                                                   118271
     C                     SELEC                                          118271
      *                                                                   118271
     C           FNCD      WHEQ '0JO'                                     118271
     C           FNCD      OREQ '0JL'                                     118271
     C           FNCD      OREQ '0JW'                                     118271
      *                                                                   118271
     C           CCY3      IFEQ CCY                                       118271
     C           AMT1      ADD  AMT3      PSTA                            118271
     C                     ELSE                                           118271
     C                     Z-ADDAMT1      PSTA                            118271
     C                     ENDIF                                          118271
      *                                                                   118271
     C           FNCD      WHNE '00S'                                     118271
     C           FNCD      ANDNE'00X'                                     118271
     C           FNCD      ANDNE'0JI'                                     118271
     C           FNCD      ANDNE'0JS'                                     118271
     C           FNCD      ANDNE'0JX'                                     118271
      *                                                                   118271
     C           CCY3      IFEQ CCY                                       118271
     C           AMT1      SUB  AMT3      PSTA                            118271
     C                     ELSE                                           118271
     C                     Z-ADDAMT1      PSTA
     C                     ENDIF                                          118271
      *                                                                   118271
     C                     OTHER                                          118271
     C                     Z-ADDAMT1      PSTA                            118271
      *                                                                   118271
     C                     ENDSL                                          118271
      *
     C                     END
      *                                                                   CAC002
      **  Subtract margin amount from posting amount if buy currency is   CAC002
      **  the local currency and analytical accounting is installed       CAC002
      *                                                                   CAC002
     C           CCY1      IFEQ BJLCCY                                    CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C           FNCD      IFEQ '0JI'                                     CAC002
     C           FNCD      OREQ '0JS'                                     CAC002
     C           FNCD      OREQ '0JX'                                     CAC002
     C                     SUB  WWMAMT    PSTA                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *
     C                     ELSE
      *
      ** If the contra ccy (cust./sell ccy) is not same as base ccy
      ** and the first ccy (trans/buy ccy) is not same as base ccy
      **   obtain the base ccy.amt.equivalent of buy amt.
      *
     C                     MOVE CCY1      @TCCY
     C                     Z-ADDAMT1      @TCAM
     C                     Z-ADDCDP,I     @TCDP
     C                     MOVE CMD,I     @TCMD
     C                     MOVE @BSCY     @EQCY
     C                     Z-ADD@BDP      @EQDP
     C                     MOVE @BMD      @EQMD
     C                     Z-ADDSPT,I     @EXRT
      *
     C                     EXSR RTCONV
      *
     C                     Z-ADD@EQAM     @BSCEQ 150
     C                     Z-ADD@BSCEQ    PSTA
      *
     C                     END
      *
     C                     END
      *
      *
      ** Move dr/cr ind. opposite to that of trade entry-1
     C           FNCD      IFEQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
      *
      ** If a/c type is 'R'
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     END
      *
     C                     MOVEL@PNAR     PNAR
     C/COPY WNCPYSRC,RE4201C007
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write record to pf/gettpd for buy ccy eq. a/c
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ********************************************************************
     C           BYPCY1    TAG                             ** BYPCY1 TAG *
     C**
     C**   SUPPRESS IF CCY2 IS BSCY, EXIT FROM SUBROUTINE
     C**
     C           TRADE     IFEQ ' '
     C           CCY2      ANDEQ@BSCY
     C                     GOTO BYPCY2
     C                     END
      *
      *
      ** For CUST/SELL SPOT TRADE entry ----------------- entry 3
      *
      ** Move fields to record for sell ccy.spot trade
     C                     EXSR MOVEXC
      *
     C                     MOVELCCY2      CCY
      *
      ** Move amount depending on function code
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           CVAM      ADD  CVAM2     PSTA
      *
     C                     ELSE
      *
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C                     Z-ADDAMT2      PSTA
      *
     C                     ELSE
      *
     C                     Z-ADDCVAM      PSTA
      *
     C                     END
      *
     C                     END
      *                                                                   CAC002
      **  Add margin amt to posting amt if anal acctg is installed        CAC002
      *                                                                   CAC002
     C           FNCD      IFNE '0JI'                                     CAC002
     C           FNCD      ANDNE'0JS'                                     CAC002
     C           FNCD      ANDNE'0JX'                                     CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C           CCY2      OREQ BJLCCY                                    CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C                     ADD  WWMAMT    PSTA                            CAC002
     C                     ENDIF                                          CAC002
      *
      ** Move dr/cr ind. depending on function code
     C           FNCD      IFEQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
      *
      ** If a/c type is 'R'
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     END
      *
      ** If function code is '0ji' - move narration accordingly
      **                  or '0JS', '0JX'                                 CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C                     MOVE *BLANKS   @N3215
     C                     MOVEL' SELL'   @N3215
     C                     MOVE *BLANK    PNAR
     C                     MOVEL@NA3DS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C                     MOVE 'GB00940' ##MGID                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP2                                           S01408
     C*                                                                   S01408
     C                     END
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write record to pf/gettpd for sell ccy spot trade
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Store the narration for the next entry
     C                     MOVE *BLANK    @PNAR
     C                     MOVELPNAR      @PNAR
      *
      *
      ** For CUST/SELL SPOT TRADE EQUIVALENT------------- entry 3
      *
      ** If trade equivalent entry is to be generated
      *
      ** Setup currency details to get the trade eq. a/c
     C                     MOVELCCY2      @SCY
     C                     EXSR SETCDT
     C                     MOVELTEQ,I     @TEQ
      *
      ** Get account type for trade eq. a/c code
     C                     MOVE @TEQ      @ACD
     C                     EXSR GETACT
     C                     MOVEL@ACT      @EQACT
      *
      ** Move fields to record for sell ccy.eq. a/c ----- entry 4
     C                     EXSR MOVEXC
      *
     C                     Z-ADD@TEQ      ACOD
     C                     MOVEL@BSCY     CCY
     C                     MOVEL@EQACT    ATYP
      *
      ** If the contra ccy (cust./sell ccy) is same as base ccy
      **    set amount to be sell/cust a/c amount
     C           CCY2      IFEQ @BSCY
      *
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           CVAM      ADD  CVAM2     PSTA
      *
     C                     ELSE
      *
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C                     Z-ADDAMT2      PSTA
      *
     C                     ELSE
      *
     C                     Z-ADDCVAM      PSTA
      *
     C                     END
      *
     C                     END
      *                                                                   CAC002
      **  Add margin amt to posting amt if anal acctg is installed        CAC002
      *                                                                   CAC002
     C           FNCD      IFNE '0JI'                                     CAC002
     C           FNCD      ANDNE'0JS'                                     CAC002
     C           FNCD      ANDNE'0JX'                                     CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C           CCY2      OREQ BJLCCY                                    CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C                     ADD  WWMAMT    PSTA                            CAC002
     C                     ENDIF                                          CAC002
      *
     C                     ELSE
      *
      ** If the first ccy is same as base ccy
      **    set amount to be buy/trans amount
     C           CCY1      IFEQ @BSCY
      *
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           AMT1      ADD  AMT2      PSTA
      *
     C                     ELSE
      *                                                                   118271
      **  Include charge if not in account currency (ie, charge in        118271
      **  transaction currency).                                          118271
      *                                                                   118271
     C                     SELEC                                          118271
      *                                                                   118271
     C           FNCD      WHEQ '0JO'                                     118271
     C           FNCD      OREQ '0JL'                                     118271
     C           FNCD      OREQ '0JW'                                     118271
      *                                                                   118271
     C           CCY3      IFEQ CCY                                       118271
     C           AMT1      ADD  AMT3      PSTA                            118271
     C                     ELSE                                           118271
     C                     Z-ADDAMT1      PSTA                            118271
     C                     ENDIF                                          118271
      *                                                                   118271
     C           FNCD      WHNE '00S'                                     118271
     C           FNCD      ANDNE'00X'                                     118271
     C           FNCD      ANDNE'0JI'                                     118271
     C           FNCD      ANDNE'0JS'                                     118271
     C           FNCD      ANDNE'0JX'                                     118271
      *                                                                   118271
     C           CCY3      IFEQ CCY                                       118271
     C           AMT1      SUB  AMT3      PSTA                            118271
     C                     ELSE                                           118271
     C                     Z-ADDAMT1      PSTA
     C                     ENDIF                                          118271
      *                                                                   118271
     C                     OTHER                                          118271
     C                     Z-ADDAMT1      PSTA                            118271
      *                                                                   118271
     C                     ENDSL                                          118271
      *
      *
     C                     END
      *
     C                     ELSE
      *
     C                     Z-ADD@BSCEQ    PSTA
      *
     C                     END
      *
     C                     END
      *
      ** Move dr/cr ind. opposite to that of trade entry-2
     C           FNCD      IFEQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
      *
      ** If a/c type is 'R'
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     END
      *
     C                     MOVEL@PNAR     PNAR
     C/COPY WNCPYSRC,RE4201C026
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write record to pf/gettpd for buy ccy eq. a/c
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                   CAC002
      **  If anal acctg is installed, output new margin posting           CAC002
      *                                                                   CAC002
     C***********BGN0ST    IFEQ 'Y'                                CAC002 140254
     C***********          EXSR SRWMAR                             CAC002 140254
     C***********          ENDIF                                   CAC002 140254
      *
      ********************************************************************
     C           BYPCY2    TAG                             ** BYPCY2 TAG *
      *
     C           PRAM      IFNE *ZEROS                                    CRT002
     C                     EXSR PROPRP                                    CRT002
     C                     ENDIF                                          CRT002
      *                                                                   CRT002
     C           RDAM      IFNE *ZEROS                                    202295
     C           FNCD      IFEQ '0JO'                                     202295
     C           FNCD      OREQ '0JN'                                     202295
     C                     EXSR PRORAM                                    202295
     C                     ENDIF                                          202295
     C                     ENDIF                                          202295
      *                                                                   202295
     C                     ENDSR
      *****************************************************************
      /EJECT                                                              CRT002
      *****************************************************************   CRT002
      *                                                               *   CRT002
      *            PROPRP - Process pay/receive postings              *   CRT002
      *                                                               *   CRT002
      *            Generate Spot trade and trade equiv pay/receive    *   CRT002
      *              entries for                                      *   CRT002
      *              - FX transactions '0JI'                          *   CRT002
      *              - Travellers Cheques transactions '0JS' '0JX'    *   CRT002
      *                  '0JR' '0JW'                                  *   CRT002
      *                                                               *   CRT002
      * CALLS             -                                           *   CRT002
      *                                                               *   CRT002
      * CALLED BY  PROEXC - Process exchange transactions             *   CRT002
      *                                                               *   CRT002
      *****************************************************************   CRT002
     C           PROPRP    BEGSR                           ** PROPRP **   CRT002
      *                                                                   CRT002
      ** For TRANS/BUY Ccy SPOT TRADE entry ------------------- entry 1   CRT002
      ** Move fields to record for buy ccy.spot trade                     CRT002
      *                                                                   CRT002
     C                     EXSR MOVEXC                                    CRT002
      *                                                                   CRT002
     C                     MOVEL@BSCY     CCY                             CRT002
     C                     Z-ADDPRAM      PSTA                            CRT002
      *                                                                   CRT002
     C           PYRC      IFEQ 'P'                                       CRT002
     C                     Z-ADD0         DRCR                            CRT002
     C                     ELSE                                           CRT002
     C                     Z-ADD1         DRCR                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** If function code is '0JI', '0JS' or '0JX' - move narration       CRT002
      ** accordingly                                                      CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '0JI'                                     CRT002
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C                     Z-ADDTBTN      @TTRNO                          CRT002
     C                     MOVE *BLANK    @N3115                          CRT002
     C                     MOVE *BLANK    @N3218                          CRT002
     C                     MOVEL@NA115    @N3115                          CRT002
     C                     MOVEL' PAY/'   @N3218                          CRT002
     C                     MOVE 'REC'     @N3218                          CRT002
     C                     MOVE *BLANK    PNAR                            CRT002
     C                     MOVEL@NA3DS    PNAR                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
      ** Accumulate hash totals on posting amount                         CRT002
      *                                                                   CRT002
     C                     EXSR HSHTOT                                    CRT002
      *                                                                   CRT002
      ** Write record to pf/gettpd for buy ccy spot trade                 CRT002
      *                                                                   CRT002
     C           *INU1     IFEQ '0'                                       CRT002
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF                                  CRT002
     C                     END                                            CRT002
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                   CRT002
      ** Store the narration for the next entry                           CRT002
      *                                                                   CRT002
     C                     MOVE *BLANK    @PNAR                           CRT002
     C                     MOVELPNAR      @PNAR                           CRT002
      *                                                                   CRT002
      ** For TRANS/BUY Ccy SPOT TRADE EQUIVALENT -------------- entry 2   CRT002
      ** Setup currency details to get the trade eq. a/c                  CRT002
      *                                                                   CRT002
     C                     MOVEL@BSCY     @SCY                            CRT002
     C                     EXSR SETCDT                                    CRT002
     C**********           MOVELTEQ,I     @TEQ    40                                   CRT002 CGL029
     C                     MOVELTEQ,I     @TEQ                                                CGL029
      *                                                                   CRT002
      ** Get account type for trade eq. a/c code                          CRT002
      *                                                                   CRT002
     C                     MOVE @TEQ      @ACD                            CRT002
     C                     EXSR GETACT                                    CRT002
     C                     MOVEL@ACT      @EQACT  1                       CRT002
      *                                                                   CRT002
      ** Move fields to record for buy ccy. eq. a/c ----------- entry 2   CRT002
      *                                                                   CRT002
     C                     EXSR MOVEXC                                    CRT002
      *                                                                   CRT002
     C                     Z-ADD@TEQ      ACOD                            CRT002
     C                     MOVEL@BSCY     CCY                             CRT002
     C                     MOVEL@EQACT    ATYP                            CRT002
      *                                                                   CRT002
      ** Setup posting amount field                                       CRT002
      *                                                                   CRT002
     C                     Z-ADDPRAM      PSTA                            CRT002
      *                                                                   CRT002
      ** Move dr/cr ind. opposite to that of trade entry-1                CRT002
      *                                                                   CRT002
     C           PYRC      IFEQ 'P'                                       CRT002
     C                     Z-ADD1         DRCR                            CRT002
     C                     ELSE                                           CRT002
     C                     Z-ADD0         DRCR                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     MOVEL@PNAR     PNAR                            CRT002
      *                                                                   CRT002
      ** Accumulate hash totals on posting amount                         CRT002
      *                                                                   CRT002
     C                     EXSR HSHTOT                                    CRT002
      *                                                                   CRT002
      ** Write record to pf/gettpd for buy ccy eq. a/c                    CRT002
      *                                                                   CRT002
     C           *INU1     IFEQ '0'                                       CRT002
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF                                  CRT002
     C                     END                                            CRT002
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                   CRT002
      ** For CASH A/C entry ----------------------------------- entry 3   CRT002
      ** Move fields to record for cash a/c                               CRT002
      *                                                                   CRT002
     C                     MOVELCCY1      @SVCY   3                       CRT002
     C                     MOVEL@BSCY     CCY1                            CRT002
     C                     EXSR SETCSH                                    CRT002
     C**********           MOVEL@@ASGL    WACOD   4                                    CRT002 CGL029
     C                     MOVEL@@ASGL    WACOD  10                                           CGL029
     C                     MOVEL@@ASGL    @ACD                            CRT002
     C                     EXSR GETACT                                    CRT002
     C                     MOVEL@ACT      WACTY   1                       CRT002
     C                     MOVEL@SVCY     CCY1                            CRT002
      *                                                                   CRT002
     C                     EXSR MOVEXC                                    CRT002
      *                                                                   CRT002
     C                     MOVEL@BSCY     CCY                             CRT002
     C                     MOVELWACOD     ACOD                            CRT002
     C                     MOVELWACTY     ATYP                            CRT002
     C                     Z-ADDPRAM      PSTA                            CRT002
      *                                                                   CRT002
      ** Move dr/cr ind. depending on pay/receive flag                    CRT002
      *                                                                   CRT002
     C           PYRC      IFEQ 'P'                                       CRT002
     C                     Z-ADD1         DRCR                            CRT002
     C                     ELSE                                           CRT002
     C                     Z-ADD0         DRCR                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     MOVEL@PNAR     PNAR                            CRT002
      *                                                                   CRT002
      ** Accumulate hash totals on posting amount                         CRT002
      *                                                                   CRT002
     C                     EXSR HSHTOT                                    CRT002
      *                                                                   CRT002
      ** Write record to pf/gettpd for sell ccy spot trade                CRT002
      *                                                                   CRT002
     C           *INU1     IFEQ '0'                                       CRT002
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF                                  CRT002
     C                     END                                            CRT002
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                   CRT002
      ** For CASH A/C EQUIVALENT ------------------------------ entry 4   CRT002
      ** Setup currency details to get the trade eq. a/c                  CRT002
      *                                                                   CRT002
     C           RDCY      IFEQ '1'                                       CRT002
     C                     MOVELCCY1      @SCY                            CRT002
     C                     ELSE                                           CRT002
     C                     MOVELCCY2      @SCY                            CRT002
     C                     ENDIF                                          CRT002
     C                     EXSR SETCDT                                    CRT002
     C                     MOVELTEQ,I     @TEQ                            CRT002
      *                                                                   CRT002
      ** Get account type for trade eq. a/c code                          CRT002
      *                                                                   CRT002
     C                     MOVE @TEQ      @ACD                            CRT002
     C                     EXSR GETACT                                    CRT002
     C                     MOVEL@ACT      @EQACT                          CRT002
      *                                                                   CRT002
      ** Move fields to record for sell ccy. eq. a/c ---------- entry 4   CRT002
      *                                                                   CRT002
     C                     EXSR MOVEXC                                    CRT002
      *                                                                   CRT002
     C                     Z-ADD@TEQ      ACOD                            CRT002
     C                     MOVEL@BSCY     CCY                             CRT002
     C                     MOVEL@EQACT    ATYP                            CRT002
      *                                                                   CRT002
     C                     Z-ADDPRAM      PSTA                            CRT002
      *                                                                   CRT002
      ** Move dr/cr ind. opposite to that of entry 3                      CRT002
      *                                                                   CRT002
     C           PYRC      IFEQ 'P'                                       CRT002
     C                     Z-ADD0         DRCR                            CRT002
     C                     ELSE                                           CRT002
     C                     Z-ADD1         DRCR                            CRT002
     C                     END                                            CRT002
      *                                                                   CRT002
     C                     MOVEL@PNAR     PNAR                            CRT002
      *                                                                   CRT002
      ** Accumulate hash totals on posting amount                         CRT002
      *                                                                   CRT002
     C                     EXSR HSHTOT                                    CRT002
      *                                                                   CRT002
      ** Write record to pf/gettpd for buy ccy eq. a/c                    CRT002
      *                                                                   CRT002
     C           *INU1     IFEQ '0'                                       CRT002
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF                                  CRT002
     C                     END                                            CRT002
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                   CRT002
     C                     ENDSR                                          CRT002
      *****************************************************************   CRT002
      /EJECT                                                              202295
      *****************************************************************   202295
      *                                                               *   202295
      *            PRORAM - Process Rounding Amount postings          *   202295
      *                                                               *   202295
      *            Generate Cash a/c and commission a/c               *   202295
      *              entries for                                      *   202295
      *              - Cash Withdrawals (Non a/c ccy)                 *   202295
      *              - Cash Deposits (Non a/c ccy)                    *   202295
      *                                                               *   202295
      * CALLS             -                                           *   202295
      *                                                               *   202295
      * CALLED BY  PROEXC - Process exchange transactions             *   202295
      *                                                               *   202295
      *****************************************************************   202295
     C           PRORAM    BEGSR                           ** PRORAM **   202295
      *                                                                   202295
      ** For CASH A/C Entry ------------------------------------ entry 1  202295
      ** Move fields to record for cash a/c                               202295
      *                                                                   202295
     C                     MOVELCCY1      WKCCY                           202295
      *                                                                   202295
     C                     EXSR SETCSH                                    202295
     C           @@ASGL    IFEQ *ZEROS                                    202295
     C                     MOVEL@CSAC     @@ASGL                          202295
     C                     ENDIF                                          202295
     C**********           MOVEL@@ASGL    WACOD   4                                    202295 CGL029
     C                     MOVEL@@ASGL    WACOD                                               CGL029
     C                     MOVEL@@ASGL    @ACD                            202295
     C                     EXSR GETACT                                    202295
     C                     MOVEL@ACT      WACTY   1                       202295
      *                                                                   202295
     C                     EXSR MOVEXC                                    202295
      *                                                                   202295
     C                     MOVELWKCCY     CCY                             202295
     C                     MOVELWACOD     ACOD                            202295
     C                     MOVELWACTY     ATYP                            202295
     C                     Z-ADDRDAM      PSTA                            202295
      *                                                                   202295
      ** If function code is '0JO' - Cash withdrawal (non a/c ccy)        202295
      *                                                                   202295
     C           FNCD      IFEQ '0JO'                                     202295
     C                     Z-ADD0         DRCR                            202295
     C                     MOVEL@PNAR     PNAR                            202295
     C                     END                                            202295
      *                                                                   202295
      ** If function code is '0JN' - Cash deposit (non a/c ccy)           202295
      *                                                                   202295
     C           FNCD      IFEQ '0JN'                                     202295
     C                     Z-ADD1         DRCR                            202295
     C                     MOVEL@PNAR     PNAR                            202295
     C                     END                                            202295
      *                                                                   202295
      ** Accumulate Hash Totals on posting amount                         202295
      *                                                                   202295
     C                     EXSR HSHTOT                                    202295
     C                     MOVELACOD      @ACD                            202295
     C                     EXSR GETACT                                    202295
     C                     MOVELW#ACSC    ACSC                            202295
      *                                                                   202295
      ** If the posting amount is negative then correct, and              202295
      ** alter debit/credit indicator accordingly.                        202295
      *                                                                   202295
     C           PSTA      IFLE 0                                         202295
     C                     Z-SUBPSTA      PSTA                            202295
     C           DRCR      IFEQ 0                                         202295
     C                     Z-ADD1         DRCR                            202295
     C                     ELSE                                           202295
     C                     Z-ADD0         DRCR                            202295
     C                     ENDIF                                          202295
     C                     ENDIF                                          202295
      *                                                                   202295
     C                     WRITEAPOSTPDF                                  202295
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                   202295
      ** For Commission entry ---------------------------------- entry 2  202295
      ** Move fields to record for commission                             202295
      *                                                                   202295
      **  Retrieve Tranaction Type from SDTCHGPD                          202295
      *                                                                   202295
     C                     CALL 'AOTCHGR0'                                202295
     C                     PARM *BLANKS   @RTCD                           202295
     C                     PARM '*FIRST ' @OPTN                           202295
     C           SDTCHG    PARM SDTCHG    DSFDY                           202295
      *                                                                   202295
     C           @RTCD     IFNE *BLANKS                                   202295
     C           *LOCK     IN   LDA                                       202295
     C                     MOVEL'SDTCHGPD'DBFILE           ***************202295
     C                     MOVEL@OPTN     DBKEY            ** DB ERR 38 **202295
     C                     Z-ADD38        DBASE            ***************202295
     C                     EXSR DBERR                                     202295
     C                     ENDIF                                          202295
      *                                                                   202295
      ** Retrieve Associate GL code from SDRETRPD                         202295
      *                                                                   202295
     C           FSF0JO    IFNE *BLANK                                    202295
     C           FNCD      ANDEQ'0JO'                                     202295
      *                                                                   202295
     C                     CALL 'AORETRR0'                                202295
     C                     PARM *BLANKS   PRTCD                           202295
     C                     PARM '*KEY   ' POPTN                           202295
     C                     PARM FSF0JO    PRETR                           202295
     C           SDRETR    PARM SDRETR    DSFDY                           202295
      *                                                                   202295
      ** If record does not exist                                         202295
      *                                                                   202295
     C           @RTCD     IFNE *BLANK                                    202295
     C           *LOCK     IN   LDA                        ************   202295
     C                     Z-ADD39        DBASE            * DBERR 39 *   202295
     C                     MOVE 'SDRETRPD'DBFILE           ************   202295
     C                     MOVELFSF0JO    DBKEY                           202295
     C                     OUT  LDA                                       202295
     C                     EXSR DBERR                                     202295
     C                     ENDIF                                          202295
      *                                                                   202295
      ** Set up debit/credit indicator and narrative                      202295
      *                                                                   202295
     C                     Z-ADD1         DRCR                            202295
     C                     MOVEL@PNAR     PNAR                            202295
     C                     ENDIF                                          202295
      *                                                                   202295
      ** Retrieve Associate GL code from SDRETRPD                         202295
      *                                                                   202295
     C           FSF0JN    IFNE *BLANK                                    202295
     C           FNCD      ANDEQ'0JN'                                     202295
      *                                                                   202295
     C                     CALL 'AORETRR0'                                202295
     C                     PARM *BLANKS   PRTCD                           202295
     C                     PARM '*KEY   ' POPTN                           202295
     C                     PARM FSF0JN    PRETR                           202295
     C           SDRETR    PARM SDRETR    DSFDY                           202295
      *                                                                   202295
      ** If record does not exist                                         202295
      *                                                                   202295
     C           @RTCD     IFNE *BLANK                                    202295
     C           *LOCK     IN   LDA                        ************   202295
     C                     Z-ADD40        DBASE            * DBERR 40 *   202295
     C                     MOVE 'SDRETRPD'DBFILE           ************   202295
     C                     MOVELFSF0JN    DBKEY                           202295
     C                     OUT  LDA                                       202295
     C                     EXSR DBERR                                     202295
     C                     ENDIF                                          202295
      *                                                                   202295
      ** Set up debit/credit indicator and narrative                      202295
      *                                                                   202295
     C                     Z-ADD0         DRCR                            202295
     C                     MOVEL@PNAR     PNAR                            202295
     C                     ENDIF                                          202295
      *                                                                   202295
      ** If associated GL a/c code is blanks, change to system suspense   202295
      *                                                                   202295
     C           A1ASGL    IFEQ *BLANKS                                   202295
     C                     MOVEL@CSAC     ACOD                            202295
     C                     ELSE                                           202295
     C                     MOVE A1ASGL    ACOD                            202295
     C                     END                                            202295
      *                                                                   202295
     C                     MOVELWACTY     ATYP                            202295
     C                     Z-ADDRDAM      PSTA                            202295
      *                                                                   202295
      ** Accumulate Hash Totals on posting amount                         202295
      *                                                                   202295
     C                     EXSR HSHTOT                                    202295
     C                     MOVELACOD      @ACD                            202295
     C                     EXSR GETACT                                    202295
     C                     MOVELW#ACSC    ACSC                            202295
      *                                                                   202295
      ** If the posting amount is negative then correct, and              202295
      ** alter debit/credit indicator accordingly.                        202295
      *                                                                   202295
     C           PSTA      IFLE 0                                         202295
     C                     Z-SUBPSTA      PSTA                            202295
     C           DRCR      IFEQ 0                                         202295
     C                     Z-ADD1         DRCR                            202295
     C                     ELSE                                           202295
     C                     Z-ADD0         DRCR                            202295
     C                     ENDIF                                          202295
     C                     ENDIF                                          202295
      *                                                                   202295
     C                     WRITEAPOSTPDF                                  202295
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                   202295
     C                     ENDSR                                          202295
      *                                                                   202295
      /EJECT
      *****************************************************************
      *                                                               *
      *            PROITB - Process interbranch transactions          *
      *                                                               *
      * CALLS      ITBAEN - Interbranch a/c entry                     *
      *            TITBEN - Teller interbranch entry                  *
      *                                                               *
      * CALLED BY  PRODET - Process details                           *
      *                                                               *
      *****************************************************************
     C           PROITB    BEGSR                           ** PROITB **
      *
      ** If function code is '00a' - retail transfer
     C           FNCD      IFEQ '00A'
      *
      ** If debit or credit cust a/c branch not equal to teller branch
     C           @BRCA1    IFNE ITLB
     C           @BRCA2    ORNE ITLB
      *
      ** perform teller interbranch entry
     C                     EXSR TITBEN
      *
     C                     END
      *
      ** If debit cust a/c branch not equal to credit cust a/c branch
     C           @BRCA1    IFNE @BRCA2
      *
      ** perform interbranch a/c entry
     C                     EXSR ITBAEN
      *
     C                     END
      *
      ** If Interbranch entries via main branch is 'Y'
     C           BKIEMB    IFEQ 'Y'
      *
      ** If debit cust a/c branch not equal to main branch
      ** OR credit cust a/c branch not equal to main branch
     C           @BRCA1    IFNE BKMABR
     C           @BRCA2    ANDNEBKMABR
      *
      ** perform main branch interbranch entry
     C                     EXSR MBITEN
      *
     C                     END
      *
     C                     END
      *
     C                     ELSE
      *
      ** If customer a/c branch not equal to teller branch
     C           @BRCA1    IFNE ITLB
      *
      ** perform teller interbranch entry
     C                     EXSR TITBEN
      *
      ** perform interbranch a/c entry
     C                     EXSR ITBAEN
      *
      ** If Interbranch entries via main branch is 'Y'
     C           BKIEMB    IFEQ 'Y'
      *
      ** If cust a/c branch not equal to main branch
     C           @BRCA1    IFNE BKMABR
     C           ITLB      ANDNEBKMABR
      *
      ** perform main branch interbranch entry
     C                     EXSR MBITEN
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            TITBEN - Teller interbranch entry                  *
      *                                                               *
      * CALLS      MOVITB - Move values for interbranch posting       *
      *            ZHASH  - Perform hash totals                       *
      *                                                               *
      * CALLED BY  PROITB - Process interbranch transactions          *
      *                                                               *
      *****************************************************************
     C           TITBEN    BEGSR                           ** TITBEN **
      *                                                                   CAC002
      **  Assign primary funding prft cntr if anal acctg is available     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
      ** Accumulate hash totals on posting amount
     C                     MOVE @PPSA1    ZZAMT
     C                     Z-ADD1         S
     C                     Z-ADD1         Z
     C                     EXSR ZHASH
      *
      ** Add 1 to output record count
     C                     ADD  1         @TICNT
      *
      ** Move details to output record
     C                     EXSR MOVITB
      *
      ** Write the record to pf/ttibpd
     C           *INU1     IFEQ '0'
     C                     WRITETTIBPDF
     C                     END
      *
      ** If second posting has been generated -
     C           @PST2     IFEQ 1
      *
      ** Reset flag indicating second posting
     C                     Z-ADD0         @PST2
      *
      ** Setup flag to move values of second a/c posting
     C                     Z-ADD1         @VAL2   10
      *
      ** Accumulate hash totals on posting amount
     C                     MOVE @PPSA2    ZZAMT
     C                     Z-ADD1         S
     C                     Z-ADD1         Z
     C                     EXSR ZHASH
      *
      ** Add 1 to output record count
     C                     ADD  1         @TICNT
      *
      ** Move details to output record
     C                     EXSR MOVITB
      *
      ** Reset flag indicating values of second a/c posting
     C                     Z-ADD0         @VAL2
      *
      ** Write the record to pf/ttibpd
     C           *INU1     IFEQ '0'
     C                     WRITETTIBPDF
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            ITBAEN - Interbranch a/c entry                     *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *                                                               *
      * CALLED BY  PROITB - Process interbranch transactions          *
      *                                                               *
      *****************************************************************
     C           ITBAEN    BEGSR                           ** ITBAEN **
      *
      ** If function code is any of the following -
     C           FNCD      IFEQ '00H'
     C           FNCD      OREQ '00P'
     C           FNCD      OREQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '00I'
      *
     C           @PPSA1    ADD  @PPSA2    PSTA
      *
     C                     ELSE
      *
     C                     Z-ADD@PPSA1    PSTA
      *
     C                     END
      *
      ** Store posting amount for second entry
     C                     Z-ADDPSTA      @PSTA  130
      *
      ** If function code is 00a -
     C           FNCD      IFEQ '00A'
      *
     C**********           Z-ADD@ICN1     @CNUM                                               CSD027
     C                     MOVE @ICN1     @CNUM                                               CSD027
     C                     MOVE @BRCA2    BRCA
     C*
      *
      **  Use interbranch account code of the other branch
     C           @INTDC    IFEQ 0
     C                     Z-ADD@IGT1     @ACOD
     C                     MOVE @ITT1     ATYP
     C                     ELSE
     C                     Z-ADD@IGF1     @ACOD
     C                     MOVE @IFT1     ATYP
     C                     ENDIF
      *
      **  Branch not equal main branch
     C           BKIEMB    IFEQ 'Y'
     C**********           Z-ADD@MICN     @CNUM                                               CSD027
     C                     MOVE @MICN     @CNUM                                               CSD027
      *
      **  Use interbranch account code of the main branch
     C           @INTDC    IFEQ 0
     C                     Z-ADD@MIGT     @ACOD
     C                     MOVE @MITT     ATYP
     C                     ELSE
     C                     Z-ADD@MIGF     @ACOD
     C                     MOVE @MIFT     ATYP
     C                     END
     C                     END
      *
     C                     ELSE
      *
     C**********           Z-ADD@TICN     @CNUM                                               CSD027
     C                     MOVE @TICN     @CNUM                                               CSD027
     C                     MOVE @BRCA1    BRCA
      *
      **  Use interbranch account code of the other branch
     C           @INTDC    IFEQ 1
     C                     Z-ADD@TIGT     @ACOD
     C                     MOVE @TITT     ATYP
     C                     ELSE
     C                     Z-ADD@TIGF     @ACOD
     C                     MOVE @TIFT     ATYP
     C                     ENDIF
     C*
     C*
      *
      **  Branch not equal to main branch
     C           BKIEMB    IFEQ 'Y'
     C**********           Z-ADD@MICN     @CNUM                                               CSD027
     C                     MOVE @MICN     @CNUM                                               CSD027
      *
      **  Use interbranch account code of the main branch
     C           @INTDC    IFEQ 1
     C                     Z-ADD@MIGT     @ACOD
     C                     MOVE @MITT     ATYP
     C                     ELSE
     C                     Z-ADD@MIGF     @ACOD
     C                     MOVE @MIFT     ATYP
     C                     END
     C                     END
      *
     C                     END
      *
     C                     MOVEL@CCY1     @CCY
     C                     Z-ADD1         @ACSQ
     C                     MOVE *BLANK    STYP
      *
      ** If any of the interbank gl a/cs has account type 'R'
     C           ATYP      IFEQ 'R'
      *
      ** Check whether a/c is a valid record in lf/accnt
     C                     MOVE BRCA      @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
      ** If valid record does not exist
     C           *IN70     IFEQ '1'
      *
      ** Move suspense a/c code
     C                     MOVE @CSAC     @ACOD
     C                     MOVE @CSAT     ATYP
      *
     C                     END
      *
     C                     END
      *
      ** Move fields for interbranch a/c entry-1
     C**********           Z-ADD@CNUM     CNUM                                                CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY
     C                     MOVE @ACOD     ACOD
     C                     Z-ADD@ACSQ     ACSQ
      *
      ** If gl type is 'R' -
     C           ATYP      IFEQ 'R'
      *
      ** Move retail a/c no. from lf/accnt and move 1 to retail ind.
     C                     Z-ADDACACNO    ACNO
     C                     Z-ADD1         RIND
     C***********          MOVEL'INTBR'   TRAT                            096179
     C                     MOVEL@CHGIN    TRAT                            096179
     C           @CHGIN    IFEQ 0                                         096179
     C           *LOCK     IN   LDA                                       096179
     C                     Z-ADD24        DBASE                           096179
     C                     MOVEL'SDTCHGPD'DBFILE                          096179
     C                     MOVEL@CHGIN    DBKEY                           096179
     C                     EXSR DBERR                                     096179
     C                     END                                            096179
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           KLACNT    CHAINACCNTABF             70                   CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     MOVEL'INTBR'   TRAT
      *
     C                     ELSE
      *
     C                     Z-ADD0         ACNO
     C                     Z-ADD0         RIND
     C                     MOVE *BLANK    TRAT
      *
     C                     END
      *
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE *BLANKS   PNAR
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP3                                           S01408
     C*                                                                   S01408
      *
      ** Move dr/cr ind. opposite to that of internal posting
      ** for all functions except retail transfer
     C           FNCD      IFEQ '00A'
     C                     Z-ADD0         DRCR
     C                     ELSE
     C           @INTDC    IFEQ 0
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
     C                     END
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
     C                     MOVEL'P'       RECI                            141386
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVEL'  GE-TT' SPOS
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
      *
      *
     C                     Z-ADD0         REJC
     C                     MOVE *BLANK    DPMT
     C                     Z-ADD0         RRNM
     C                     MOVE *BLANK    TLIN
     C                     MOVE *BLANK    TRCCY
     C                     BITOF'01234567'PRIN
     C                     MOVEL'N'       GETP
     C                     Z-ADD0         ACUM
     C                     MOVE *BLANK    PBTT
     C                     MOVE ITLB      ORBR
     C                     Z-ADD0         ORAMT
     C/COPY WNCPYSRC,RE4201C008
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write the record
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Move fields for interbranch a/c entry-2
      *                                                                   CAC002
      **  Assign primary funding prft cntr if anal acctg is available     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
      ** Posting amount is same as 1st entry
     C                     Z-ADD@PSTA     PSTA
      *
     C           FNCD      IFEQ '00A'
      *
     C**********           Z-ADD@ICN2     @CNUM                                               CSD027
     C                     MOVE @ICN2     @CNUM                                               CSD027
     C                     MOVE @BRCA1    BRCA
     C*
      **  Use interbranch account code of the other branch
     C           @PDC1     IFEQ 0
     C                     Z-ADD@IGT2     @ACOD
     C                     MOVE @ITT2     ATYP
     C                     ELSE
     C                     Z-ADD@IGF2     @ACOD
     C                     MOVE @IFT2     ATYP
     C                     ENDIF
      *
      **  Branch not equal to main branch
     C           BKIEMB    IFEQ 'Y'
     C**********           Z-ADD@MICN     @CNUM                                               CSD027
     C                     MOVE @MICN     @CNUM                                               CSD027
      *
      **  Use interbranch account code of the main branch
     C           @PDC1     IFEQ 0
     C                     Z-ADD@MIGT     @ACOD
     C                     MOVE @MITT     ATYP
     C                     ELSE
     C                     Z-ADD@MIGF     @ACOD
     C                     MOVE @MIFT     ATYP
     C                     END
     C                     END
      *
     C                     ELSE
      *
     C**********           Z-ADD@ICN1     @CNUM                                               CSD027
     C                     MOVE @ICN1     @CNUM                                               CSD027
     C                     MOVE ITLB      BRCA
     C*
      **  Use interbranch account code of the other branch
     C           @PDC1     IFEQ 1
     C                     Z-ADD@IGT1     @ACOD
     C                     MOVE @ITT1     ATYP
     C                     ELSE
     C                     Z-ADD@IGF1     @ACOD
     C                     MOVE @IFT1     ATYP
     C                     ENDIF
      *
      **  Branch not equal to main branch
     C           BKIEMB    IFEQ 'Y'
     C**********           Z-ADD@MICN     @CNUM                                               CSD027
     C                     MOVE @MICN     @CNUM                                               CSD027
      *
      **  Use interbranch account code of the main branch
     C           @PDC1     IFEQ 1
     C                     Z-ADD@MIGT     @ACOD
     C                     MOVE @MITT     ATYP
     C                     ELSE
     C                     Z-ADD@MIGF     @ACOD
     C                     MOVE @MIFT     ATYP
     C                     END
     C                     END
      *
     C                     END
      *
     C                     MOVEL@CCY1     @CCY
     C                     Z-ADD1         @ACSQ
     C                     MOVE *BLANK    STYP
      *
      ** If branch interbank gl a/c type is 'R'
     C           ATYP      IFEQ 'R'
      *
      ** Check whether a/c is a valid record in lf/accnt
     C                     MOVE BRCA      @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
      ** If valid record does not exist
     C           *IN70     IFEQ '1'
      *
      ** Move suspense a/c code
     C                     MOVE @CSAC     @ACOD
     C                     MOVE @CSAT     ATYP
      *
     C                     END
      *
     C                     END
      *
     C**********           Z-ADD@CNUM     CNUM                                                CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY
     C                     MOVE @ACOD     ACOD
     C                     Z-ADD@ACSQ     ACSQ
      *
      ** If gl type is 'R' -
     C           ATYP      IFEQ 'R'
      *
      ** Move retail a/c no. from lf/accnt and move 1 to retail ind.
     C                     Z-ADDACACNO    ACNO
     C                     Z-ADD1         RIND
     C***********          MOVEL'INTBR'   TRAT                            096179
     C                     MOVEL@CHGIN    TRAT                            096179
     C           @CHGIN    IFEQ 0                                         096179
     C           *LOCK     IN   LDA                                       096179
     C                     Z-ADD25        DBASE                           096179
     C                     MOVEL'SDTCHGPD'DBFILE                          096179
     C                     MOVEL@CHGIN    DBKEY                           096179
     C                     EXSR DBERR                                     096179
     C                     END                                            096179
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           KLACNT    CHAINACCNTABF             70                   CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     MOVEL'INTBR'   TRAT
      *
     C                     ELSE
      *
     C                     Z-ADD0         ACNO
     C                     Z-ADD0         RIND
     C                     MOVE *BLANK    TRAT
      *
     C                     END
      *
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE *BLANKS   PNAR
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP4                                           S01408
     C*                                                                   S01408
      *
      ** Move dr/cr ind. opposite to that of customer posting
      ** for all functions except retail transfer
     C           FNCD      IFEQ '00A'
     C                     Z-ADD1         DRCR
     C                     ELSE
     C           @PDC1     IFEQ 0
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
     C                     END
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
     C                     MOVEL'P'       RECI                            141386
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVEL'  GE-TT' SPOS
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
      *
     C                     Z-ADD0         REJC
     C                     MOVE *BLANK    DPMT
     C                     Z-ADD0         RRNM
     C                     MOVE *BLANK    TLIN
     C                     MOVE *BLANK    TRCCY
     C                     BITOF'01234567'PRIN
     C                     MOVEL'N'       GETP
     C                     Z-ADD0         ACUM
     C                     MOVE *BLANK    PBTT
     C                     MOVE ITLB      ORBR
     C                     Z-ADD0         ORAMT
     C/COPY WNCPYSRC,RE4201C009
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write the record
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            MBITEN - Main branch interbranch entry             *
      *                                                               *
      * CALLS
      *                                                               *
      * CALLED BY
      *                                                               *
      *****************************************************************
     C           MBITEN    BEGSR                           ** MBITEN **
      *                                                                   CAC002
      **  Assign primary funding prft cntr if anal acctg is available     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
      ** If function code is any of the following -
     C           FNCD      IFEQ '00H'
     C           FNCD      OREQ '00P'
     C           FNCD      OREQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '00I'
      *
     C           @PPSA1    ADD  @PPSA2    PSTA
      *
     C                     ELSE
      *
     C                     Z-ADD@PPSA1    PSTA
      *
     C                     END
      *
      ** Store posting amount for second entry
     C                     Z-ADDPSTA      @PSTA  130
      *
      ** If function code is 00a -
     C           FNCD      IFEQ '00A'
      *
     C**********           Z-ADD@ICN2     @CNUM                                               CSD027
     C                     MOVE @ICN2     @CNUM                                               CSD027
      *
      ** Use interbranch account code of the other branch
     C           @PDC1     IFEQ 0
     C                     Z-ADD@IGT2     @ACOD
     C                     MOVE @ITT2     ATYP
     C                     ELSE
     C                     Z-ADD@IGF2     @ACOD
     C                     MOVE @IFT2     ATYP
     C                     ENDIF
      *
     C                     ELSE
     C*
     C**********           Z-ADD@ICN1     @CNUM                                               CSD027
     C                     MOVE @ICN1     @CNUM                                               CSD027
      *
      ** Use interbranch account code of the other branch
     C           @PDC1     IFEQ 1
     C                     Z-ADD@IGT1     @ACOD
     C                     MOVE @ITT1     ATYP
     C                     ELSE
     C                     Z-ADD@IGF1     @ACOD
     C                     MOVE @IFT1     ATYP
     C                     ENDIF
      *
     C                     END
     C*
     C                     MOVE @MBRCA    BRCA
      *
     C                     MOVEL@CCY1     @CCY
     C                     Z-ADD1         @ACSQ
     C                     MOVE *BLANK    STYP
      *
      ** If any of the interbank gl a/cs has account type 'R'
     C           ATYP      IFEQ 'R'
      *
      ** Check whether a/c is a valid record in lf/accnt
     C                     MOVE BRCA      @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
      ** If valid record does not exist
     C           *IN70     IFEQ '1'
      *
      ** Move suspense a/c code
     C                     MOVE @CSAC     @ACOD
     C                     MOVE @CSAT     ATYP
      *
     C                     END
      *
     C                     END
      *
      ** Move fields for interbranch a/c entry-1
     C**********           Z-ADD@CNUM     CNUM                                                CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY
     C                     MOVE @ACOD     ACOD
     C                     Z-ADD@ACSQ     ACSQ
      *                                                                   CAC002
      **  Assign primary funding prft cntr if anal acctg is available     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
      ** If gl type is 'R' -
     C           ATYP      IFEQ 'R'
      *
      ** Move retail a/c no. from lf/accnt and move 1 to retail ind.
     C                     Z-ADDACACNO    ACNO
     C                     Z-ADD1         RIND
     C***********          MOVEL'99599'   TRAT                            096179
     C                     MOVEL@CHGMN    TRAT                            096179
     C           @CHGMN    IFEQ 0                                         096179
     C           *LOCK     IN   LDA                                       096179
     C                     Z-ADD26        DBASE                           096179
     C                     MOVEL'SDTCHGPD'DBFILE                          096179
     C                     MOVEL@CHGIN    DBKEY                           096179
     C                     EXSR DBERR                                     096179
     C                     END                                            096179
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           KLACNT    CHAINACCNTABF             70                   CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     MOVEL'99599'   TRAT
      *
     C                     ELSE
      *
     C                     Z-ADD0         ACNO
     C                     Z-ADD0         RIND
     C                     MOVE *BLANK    TRAT
      *
     C                     END
      *
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE *BLANKS   PNAR
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
      *
      ** Move dr/cr ind. opposite to that of internal posting
      ** for all functions except retail transfer
     C           FNCD      IFEQ '00A'
     C                     Z-ADD1         DRCR
     C                     ELSE
     C           @PDC1     IFEQ 1
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     END
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
     C                     MOVEL'P'       RECI                            141386
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVEL'  GE-TT' SPOS
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
      *
      *
     C                     Z-ADD0         REJC
     C                     MOVE *BLANK    DPMT
     C                     Z-ADD0         RRNM
     C                     MOVE *BLANK    TLIN
     C                     MOVE *BLANK    TRCCY
     C                     BITOF'01234567'PRIN
     C                     MOVEL'N'       GETP
     C                     Z-ADD0         ACUM
     C                     MOVE *BLANK    PBTT
     C                     MOVE ITLB      ORBR
     C                     Z-ADD0         ORAMT
     C/COPY WNCPYSRC,RE4201C010
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write the record
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Move fields for interbranch a/c entry-2
      *
      ** Posting amount is same as 1st entry
     C                     Z-ADD@PSTA     PSTA
      *
     C           FNCD      IFEQ '00A'
     C**********           Z-ADD@ICN1     @CNUM                                               CSD027
     C                     MOVE @ICN1     @CNUM                                               CSD027
      *
      ** Use interbranch account code of the other branch
     C           @PDC1     IFEQ 1
     C                     Z-ADD@IGT1     @ACOD
     C                     MOVE @ITT1     ATYP
     C                     ELSE
     C                     Z-ADD@IGF1     @ACOD
     C                     MOVE @IFT1     ATYP
     C                     ENDIF
      *
     C                     ELSE
      *
     C**********           Z-ADD@TICN     @CNUM                                               CSD027
     C                     MOVE @TICN     @CNUM                                               CSD027
      *
      ** Use interbranch account code of the other branch
     C           @PDC1     IFEQ 0
     C                     Z-ADD@TIGT     @ACOD
     C                     MOVE @TITT     ATYP
     C                     ELSE
     C                     Z-ADD@TIGF     @ACOD
     C                     MOVE @TIFT     ATYP
     C                     ENDIF
     C                     END
      *
     C                     MOVE @MBRCA    BRCA
      *
     C                     MOVEL@CCY1     @CCY
     C                     Z-ADD1         @ACSQ
     C                     MOVE *BLANK    STYP
      *
      ** If branch interbank gl a/c type is 'R'
     C           ATYP      IFEQ 'R'
      *
      ** Check whether a/c is a valid record in lf/accnt
     C                     MOVE BRCA      @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
      ** If valid record does not exist
     C           *IN70     IFEQ '1'
      *
      ** Move suspense a/c code
     C                     MOVE @CSAC     @ACOD
     C                     MOVE @CSAT     ATYP
      *                                                                   CAC002
      **  Assign primary funding prft cntr if anal acctg is available     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
     C                     END
      *
     C                     END
      *
     C**********           Z-ADD@CNUM     CNUM                                                CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY
     C                     MOVE @ACOD     ACOD
     C                     Z-ADD@ACSQ     ACSQ
      *
      ** If gl type is 'R' -
     C           ATYP      IFEQ 'R'
      *
      ** Move retail a/c no. from lf/accnt and move 1 to retail ind.
     C                     Z-ADDACACNO    ACNO
     C                     Z-ADD1         RIND
     C***********          MOVEL'99599'   TRAT                            096179
     C                     MOVEL@CHGMN    TRAT                            096179
     C           @CHGMN    IFEQ 0                                         096179
     C           *LOCK     IN   LDA                                       096179
     C                     Z-ADD27        DBASE                           096179
     C                     MOVEL'SDTCHGPD'DBFILE                          096179
     C                     MOVEL@CHGIN    DBKEY                           096179
     C                     EXSR DBERR                                     096179
     C                     END                                            096179
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           KLACNT    CHAINACCNTABF             70                   CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     MOVEL'99599'   TRAT
      *
     C                     ELSE
      *
     C                     Z-ADD0         ACNO
     C                     Z-ADD0         RIND
     C                     MOVE *BLANK    TRAT
      *
     C                     END
      *
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE *BLANKS   PNAR
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
      *
      ** Move dr/cr ind. opposite to that of customer posting
      ** for all functions except retail transfer
     C           FNCD      IFEQ '00A'
     C                     Z-ADD0         DRCR
     C                     ELSE
     C           @INTDC    IFEQ 1
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     END
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
     C                     MOVEL'P'       RECI                            141386
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVEL'  GE-TT' SPOS
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
      *
     C                     Z-ADD0         REJC
     C                     MOVE *BLANK    DPMT
     C                     Z-ADD0         RRNM
     C                     MOVE *BLANK    TLIN
     C                     MOVE *BLANK    TRCCY
     C                     BITOF'01234567'PRIN
     C                     MOVEL'N'       GETP
     C                     Z-ADD0         ACUM
     C                     MOVE *BLANK    PBTT
     C                     MOVE ITLB      ORBR
     C                     Z-ADD0         ORAMT
     C/COPY WNCPYSRC,RE4201C011
      *                                                                   CAC002
      **  Assign teller profit centre if anal acctg is available          CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FSTEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write the record
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GENBOE - Generate batch offset entry               *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *                                                               *
      * CALLED BY  Main   - control routine                           *
      *                                                               *
      *****************************************************************
     C           GENBOE    BEGSR                           ** GENBOE **
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
     C                     MOVEL'P'       RECI
      *
     C                     MOVEL@ICN1     CNUM
      *
      ** Hard code GL code to 2121 if Cash indicator is 'Y' and foreign
      ** currency
     C           CRT102    IFEQ 'Y'
     C           @CSIN1    IFEQ 'Y'
     C           @BTCCY    IFNE BJLCCY
     C                     Z-ADD2121      @ASGL1
     C                     MOVEL@AGLT     @AGLT1
     C                     END
     C                     END
     C                     END
      *
     C                     MOVEL@BTCCY    CCY
     C                     MOVE @ASGL1    ACOD
     C                     Z-ADD1         ACSQ
     C                     Z-ADD0         ACNO
     C                     MOVE @TTYP1    TRAT
      *
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE *BLANK    PNAR
     C                     MOVEL@BNADS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@PTBID    MNTRNO                          109175
     C                     MOVE 'GB00960' ##MGID                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP5                                           S01408
     C*                                                                   S01408
     C                     Z-ADD@BATOT    PSTA
      *
      ** Move dr/cr ind. opposite to that of customer posting
     C           @DCIN1    IFEQ 'D'
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
      *
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVEL'  GE-TT' SPOS
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
     C                     MOVE @BRCA1    BRCA
     C                     Z-ADD0         RIND
      *
     C                     Z-ADD0         REJC
     C                     MOVE *BLANK    DPMT
     C                     Z-ADD0         RRNM
     C                     MOVE *BLANK    TLIN
     C                     MOVE *BLANK    TRCCY
     C                     MOVEL@AGLT1    ATYP
     C                     MOVE *BLANK    STYP
     C                     BITOF'01234567'PRIN
     C                     MOVEL'N'       GETP
     C                     Z-ADD0         ACUM
     C                     MOVE *BLANK    PBTT
     C                     MOVE @BTBCA    ORBR
     C                     Z-ADD0         ORAMT
     C/COPY WNCPYSRC,RE4201C002
      *
      ** Accumulate hash totals on posting amount
     C                     EXSR HSHTOT
      *
      ** Write the record
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                     BUG27119
     C/COPY WNCPYSRC,RE4201C003
      *
      ** Initialise batch total amount
     C                     Z-ADD0         @BATOT
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN00N - Generate entry for fn.code '00N'          *
      *                     (Cash deposit in a/c ccy)                 *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *            CHFRC1 - Check foreign currency and setup-1        *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN00N    BEGSR                           ** GEN00N **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP   1
     C                     MOVEL@COIN1    @COIN   1
     C                     EXSR SETPSI
     C/COPY WNCPYSRC,RE4201C029
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      ADD  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM  60                                   CRT012 CSD027
     C                     MOVE CNUM      TRCNUM  6                                           CSD027
      *                                                                                       CRT012
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
      * POST DEBIT POSTING FOR TOTAL CHARGE AMOUNT                                            CRT012
     C                     MOVE '0'       DRCR                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE '1'       DRCR                                                CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD 10                                           CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM   60                                   CRT012 CSD027
     C                     MOVE CNUM      WCNUM   6                                           CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0KQ - Generate entry for fn.code '00K' & '00Q'  *
      *                     (Cheque deposit in a/c ccy)               *
      *                     Also for '00R' (Buy TCs to a/c in a/c CCY)*   CRT002
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0KQ    BEGSR                           ** GEN0KQ **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      ADD  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and Customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM                                       CRT012 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
      * POST DEBIT POSTING FOR TOTAL CHARGE AMOUNT                                            CRT012
     C                     MOVE '0'       DRCR                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE '1'       DRCR                                                CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
      ** If house check flag is not 'Y'                                                       CRE019
      *                                                                                       CRE019
     C           CRE019    IFNE 'Y'                                                           CRE019
     C           CRE019    OREQ 'Y'                                                           CRE019
     C           WHCFLG    ANDNE'Y'                                                           CRE019
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           WHCFLG    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
      ** Process debit posting to the house cheque account                                    CRE019
      *                                                                                       CRE019
     C                     EXSR MOV005                                                        CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
     C                     EXSR MOV006                                                        CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0HP - Generate entry for fn.code '00H' & '00P'  *
      *                     (Combined cash/cheque deposit, a/c ccy)   *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            MOV003 - Move values for generating entry-3        *
      *            MOV004 - Move values for generating entry-4        *
      *            SETPSI - Setup posting indicator                   *
      *            CHFRC1 - Check foreign currency and setup-1        *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0HP    BEGSR                           ** GEN0HP **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** If charge exists split between cash & cheque amounts
     C                     Z-ADD0         @CACHG 150
     C                     Z-ADD0         @CHCHG 150
     C           *IN55     IFEQ '0'
     C           AMT1      ADD  AMT2      @SUM   150
     C           AMT1      DIV  @SUM      @FRACT  75
     C           AMT3      MULT @FRACT    @CACHG
     C           AMT3      SUB  @CACHG    @CHCHG
     C                     END
      *
      ** Generate entry 1 - Customer a/c entry for cash amount
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C**********           Z-ADDCNUM      TRCNUM                                       CRT012 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      ADD  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM  60                                   CRT012 CSD027
     C                     MOVE CNUM      TRCNUM  6                                           CSD027
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C********** PSTA      IFEQ 0                                                      CRT012 CRE019
     C           PSTA      IFNE 0                                                             CRE019
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * POST DEBIT POSTING FOR TOTAL CHARGE AMOUNT                                            CRT012
     C                     MOVE '0'       DRCR                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE '1'       DRCR                                                CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 3 - Customer a/c entry for cheque amount
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN2    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry-3
     C                     EXSR MOV003
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C**********           Z-ADDCNUM      TRCNUM                                              CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      ADD  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM  60                                          CSD027
     C                     MOVE CNUM      TRCNUM  6                                           CSD027
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C********** PSTA      IFEQ 0                                                      CRT012 CRE019
     C           PSTA      IFNE 0                                                             CRE019
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * POST DEBIT POSTING FOR TOTAL CHARGE AMOUNT                                            CRT012
     C                     MOVE '0'       DRCR                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE '1'       DRCR                                                CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      *
      ** Generate entry 2 - Contra entry for cash amount
      **********************only*if*associated*gl*code*is*non-zeros**     107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *
     C***********          END                                            107926
      *
      *
      ** Generate entry 4 - Contra entry for cheque amount
      **********************only*if*associated*gl*code*is*non-zeros**     107926
     C***********@ASGL2    IFNE *ZEROS                                    107926
      *
      ** Move values for entry-4
     C                     EXSR MOV004
      *
      ** Process if house check flag is not 'Y'                                               CRE019
      *                                                                                       CRE019
     C           CRE019    IFNE 'Y'                                                           CRE019
     C           CRE019    OREQ 'Y'                                                           CRE019
     C           WHCFLG    ANDNE'Y'                                                           CRE019
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           WHCFLG    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
      ** Process debit posting to the house cheque account                                    CRE019
      *                                                                                       CRE019
     C                     EXSR MOV005                                                        CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
     C                     EXSR MOV006                                                        CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0JN - Generate entry for fn.code '0JN'          *
      *                     (Cash deposit in non-a/c ccy )            *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0JN    BEGSR                           ** GEN0JN **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      ADD  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and Customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM                                       CRT012 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
      * POST DEBIT POSTING FOR TOTAL CHARGE AMOUNT                                            CRT012
     C                     MOVE '0'       DRCR                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE '1'       DRCR                                                CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                   CEU024
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GENJKQ - Generate entry for fn.code '0JK' '0JQ'    *
      *                     (Cheque deposit, non-a/c ccy )            *
      *                     Also for '0JR' (Buy TCs to a/c in non-a/c *   CRT002
      *                     CCY)                                      *   CRT002
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GENJKQ    BEGSR                           ** GENJKQ **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      ADD  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and Customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM                                       CRT012 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
      *                                                                                       CRT012
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      * POST DEBIT POSTING FOR TOTAL CHARGE AMOUNT                                            CRT012
     C                     MOVE '0'       DRCR                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE '1'       DRCR                                                CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
      ** Process if house check flag is not 'Y'                                               CRE019
      *                                                                                       CRE019
     C           CRE019    IFNE 'Y'                                                           CRE019
     C           CRE019    OREQ 'Y'                                                           CRE019
     C           WHCFLG    ANDNE'Y'                                                           CRE019
     C           CRE019    OREQ 'Y'                                                           CRE019
     C           CCY1      ANDNE@CCY2                                                         CRE019
     C           CCY1      ANDNE*BLANKS                                                       CRE019
     C           @CCY2     ANDNE*BLANKS                                                       CRE019
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
      *                                                                                       CRT012
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           WHCFLG    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
      ** Process debit posting to the house cheque account                                    CRE019
      *                                                                                       CRE019
     C                     EXSR MOV005                                                        CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
      ** Process credit posting to the syspense account                                       CRE019
      *                                                                                       CRE019
     C                     EXSR MOV006                                                        CRE019
      *                                                                                       CRE019
     C           CCY1      IFNE @CCY2                                                         CRE019
      *                                                                                       CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GENJHP - Generate entry for fn.code '0JH' '0JP'    *
      *                     (Combined cash/chq dep, non-a/c ccy)      *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            MOV003 - Move values for generating entry-3        *
      *            MOV004 - Move values for generating entry-4        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GENJHP    BEGSR                           ** GENJHP **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** If charge exists split between cash & cheque amounts
     C                     Z-ADD0         @CACHG 150
     C                     Z-ADD0         @CHCHG 150
     C           *IN55     IFEQ '0'
     C           CVAM      ADD  CVAM2     @SUM   150
     C           CVAM      DIV  @SUM      @FRACT  75
     C           AMT3      MULT @FRACT    @CACHG
     C           AMT3      SUB  @CACHG    @CHCHG
     C                     END
      *
      ** Generate entry 1 - Customer a/c entry for cash amount
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C**********           Z-ADDCNUM      TRCNUM                                              CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      ADD  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM  60                                          CSD027
     C                     MOVE CNUM      TRCNUM  6                                           CSD027
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * POST DEBIT POSTING FOR TOTAL CHARGE AMOUNT                                            CRT012
     C                     MOVE '0'       DRCR                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE '1'       DRCR                                                CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 3 - Customer a/c entry for cheque amount
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN2    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry-3
     C                     EXSR MOV003
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C**********           Z-ADDCNUM      TRCNUM                                              CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      ADD  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM  60                                          CSD027
     C                     MOVE CNUM      TRCNUM  6                                           CSD027
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                   CEU024
     C********** PSTA      IFEQ 0                                                      CRT012 CRE019
     C           PSTA      IFNE 0                                                             CRE019
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * POST DEBIT POSTING FOR TOTAL CHARGE AMOUNT                                            CRT012
     C                     MOVE '0'       DRCR                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE '1'       DRCR                                                CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 2 - Contra entry for cash amount
      **********************only*if*associated*gl*code*is*non-zeros**     107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                     BUG27119
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *
     C***********          END                                            107926
      *
      ** Generate entry 4 - Contra entry for cheque amount
      **********************only*if*associated*gl*code*is*non-zeros**     107926
     C***********@ASGL2    IFNE *ZEROS                                    107926
      *
      ** Move values for entry-4
     C                     EXSR MOV004
      *                                                                                       CRE019
      ** Process if house cheque flag is not 'Y'                                              CRE019
      *                                                                                       CRE019
     C           CRE019    IFNE 'Y'                                                           CRE019
     C           CRE019    OREQ 'Y'                                                           CRE019
     C           WHCFLG    ANDNE'Y'                                                           CRE019
     C           CRE019    OREQ 'Y'                                                           CRE019
     C           CCY1      ANDNE@CCY2                                                         CRE019
     C           CCY1      ANDNE*BLANKS                                                       CRE019
     C           @CCY2     ANDNE*BLANKS                                                       CRE019
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C                     END
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           WHCFLG    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
      ** Process debit posting to the house cheque account                                    CRE019
      *                                                                                       CRE019
     C                     EXSR MOV005                                                        CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
      ** Process credit posting to the syspense account                                       CRE019
      *                                                                                       CRE019
     C                     EXSR MOV006                                                        CRE019
      *                                                                                       CRE019
     C           CCY1      IFNE @CCY2                                                         CRE019
      *                                                                                       CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN00O - Generate entry for fn.code '00O'          *
      *                     (Cash withdrawal a/c ccy)                 *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN00O    BEGSR                           ** GEN00O **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
     C/COPY WNCPYSRC,RE4201C030
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      SUB  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and Customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM                                       CRT012 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
      *                                                                                       CRT012
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
      * POST CREDIT POSTING FOR TOTAL CHARGE AMOUNT                                           CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C                     MOVELCNUM      WCNUM                                               CRT012
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C***********          END                                            107926
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN00L - Generate entry for fn.code '00L'          *
      *                     (Cheq withdrawal a/c ccy)                 *
      *                     Also for '00W' (Sell TCs from a/c in a/c  *   CRT002
      *                     CCY)                                      *   CRT002
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN00L    BEGSR                           ** GEN00L **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      SUB  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and Customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM                                       CRT012 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
      * POST CREDIT POSTING FOR TOTAL CHARGE AMOUNT                                           CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0JO - Generate entry for fn.code '0JO'          *
      *                     (Cash withdrawal, non-a/c ccy)            *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0JO    BEGSR                           ** GEN0JO **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      SUB  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and Customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
     C**********           Z-ADDCNUM      TRCNUM                                       CRT012 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
      * POST CREDIT POSTING FOR TOTAL CHARGE AMOUNT                                           CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and Account Code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     MOVELACOD      WWACOD                                              CRT012
     C                     MOVELACSQ      WACSQ                                               CRT012
     C**********           Z-ADDCNUM      WCNUM                                        CRT012 CSD027
     C                     MOVE CNUM      WCNUM                                               CSD027
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C**********           Z-ADDWCNUM     CNUM                                         CRT012 CSD027
     C                     MOVE WCNUM     CNUM                                                CSD027
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0JL - Generate entry for fn.code '0JL'          *
      *                     (Cheq withdrawal, non-a/c ccy)            *
      *                     Also for '0JW' (Sell TCs from a/c in non- *   CRT002
      *                     a/c CCY)                                  *   CRT002
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0JL    BEGSR                           ** GEN0JL **
      *
      ** Read Transaction charges file for teller/transaction
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      * Access SDCTPOPD to see if posting amount should be gross amount                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C                     Z-ADDPSTA      W#PSTA 130                                          CRT012
     C           PSTA      SUB  AMT3      PSTA                                                CRT012
      *                                                                                       CRT012
      * Save Narrative and Value Date and Customer                                            CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD   50                                          CRT012
     C**********           Z-ADDCNUM      TRCNUM                                       CRT012 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
      *                                                                                       CRT012
      * See if any changes to be made before posting full amount to                           CRT012
      * retail account.                                                                       CRT012
     C                     EXSR SRRPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           CPGROS    ANDEQ'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
      *                                                                                       CRT012
      * POST CREDIT POSTING FOR TOTAL CHARGE AMOUNT                                           CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     MOVE *BLANKS   PNAR                                                CRT012
     C                     MOVEL'COMM. '  PNAR                                                CRT012
      *                                                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     Z-ADDVALD      WVALD                                               CRT012
      *                                                                                       CRT012
      * See if any changes to be made before posting full charge                              CRT012
      * amount to retail account.                                                             CRT012
     C                     EXSR SRRPCA                                                        CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
     C                     EXSR HSHTOT                                                        CRT012
      *                                                                                       CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     Z-ADDWVALD     VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     Z-ADDW#PSTA    PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           CRT012    IFNE 'Y'                                                           CRT012
     C           CPGROS    ORNE 'Y'                                                           CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
      *                                                                                       CRT012
      * See if any changes to be made before posting amount to the                            CRT012
      * internal account.                                                                     CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and account code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
     C                     MOVELACSQ      WACSQ   2                                           CRT012
     C                     MOVELCNUM      WCNUM                                               CRT012
     C                     EXSR SRIPFA                                                        CRT012
     C                     ENDIF                                                              CRT012
     C           PSTA      IFNE 0                                                             CRT012
     C                     WRITEAPOSTPDF
     C                     ENDIF                                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C                     MOVELWCNUM     CNUM                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C           PSTA      IFNE 0                                                             CRT012
     C                     EXSR HSHTOT
     C                     ENDIF                                                              CRT012
      *
     C***********          END                                            107926
      *
      ** If charge exists create charge posting
     C           *IN55     IFEQ '0'
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR CHARGE
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN00A - Generate entry for fn.code '00A'          *
      *                     (Retail A/c Transfer)                     *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            SETPSI - Setup posting indicator                   *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN00A    BEGSR                           ** GEN00A **
      *
      ** Generate entry 1 - Debit Customer A/C entry
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                                       CRT012
      * If CRT012 is ON then check if narrative has been set up for this                      CRT012
      * cashier transaction type and if so replace existing narrative                         CRT012
     C                     MOVE *BLANKS   FAPNAR                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVEL*BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * If Narrative Code has been entered then overwrite narrative                           CRT012
      * with narative from Narrative Table.                                                   CRT012
     C           CPNARR    IFNE *BLANKS                                                       CRT012
     C                     CALL 'AONARRR0'                                                    CRT012
     C                     PARM           @RTCD                                               CRT012
     C                     PARM '*KEY'    @OPTN                                               CRT012
     C                     PARM           CPNARR                                              CRT012
     C           SDNARR    PARM SDNARR    DSFDY                                               CRT012
      *                                                                                       CRT012
      * Set up narrative                                                                      CRT012
     C           @RTCD     IFEQ *BLANKS                                                       CRT012
     C                     MOVELTBID      PN1                                                 CRT012
     C                     MOVE '/'       PN4                                                 CRT012
     C                     MOVELTBTN      PN5                                                 CRT012
     C                     MOVELALDON     PN11                                                CRT012
     C                     MOVELPN        PNAR                                                CRT012
     C                     MOVELPN        FAPNAR                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
      ** Generate entry 2 - Credit Customer A/C entry
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP2    @STYP
     C                     MOVEL@COIN2    @COIN
     C                     SETON                     50
     C                     EXSR SETPSI
     C                     SETOF                     50
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
      ** Move account sub-type
     C                     MOVEL@STYP     STYP
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           FAPNAR    ANDNE*BLANKS                                                       CRT012
     C                     MOVELFAPNAR    PNAR                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN00I - Generate entry for fn.code '00I'          *
      *                     (Credits / Charges )                      *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *            MOV003 - Move values for generating entry-3        *
      *            MOV004 - Move values for generating entry-4        *
      *            SETPSI - Setup posting indicator                   *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN00I    BEGSR                           ** GEN00I **
      *
      ** Initialise fields for second amount which is optional
      *
     C                     Z-ADD0         @PPSA2
      *
      ** Generate entry 1 - Customer A/C entry for first amount
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
      ** If transaction amt.2 is non-zeros
     C           AMT2      IFNE *ZEROS
      *
      ** Generate entry 3 - Customer A/C entry for 2nd amount
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN2    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry-3
     C                     EXSR MOV003
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C                     END
      *
      ** Generate entry 2 - Contra a/c entry for first amount
      ***Generate*entry*2*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move values for entry-2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C***********          END                                            107926
      *
      ** Generate entry 4 - Contra a/c entry for 2nd amount
      *
      ** If transaction amt.2 is non-zeros
     C           AMT2      IFNE *ZEROS
      ***Generate*entry*4*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL2    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC2
     C                     END
      *
      ** Move values for entry-4
     C                     EXSR MOV004
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C***********          END                                            107926
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GENBAT - Generate entry for fn.code '***'          *
      *                     (Clearing/Payroll)                        *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            SETPSI - Setup posting indicator                   *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GENBAT    BEGSR                           ** GENBAT **
      *
      ** Generate entry 1
      *
      ** Setup posting indicator -
     C                     MOVEL@STYP1    @STYP
     C                     MOVEL@COIN1    @COIN
     C                     EXSR SETPSI
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Add posting amount to total for batch
     C                     ADD  PSTA      @BATOT
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0JI - Generate entry for fn.code '0JI'          *
      *                     (Foreign Exchange)                        *
      *                     Also for '0JS' and '0JX'                  *   CRT002
      *                     (Buy TCs for cash in other CCY)           *   CRT002
      *                     (Sell TCs for cash in other CCY)          *   CRT002
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0JI    BEGSR                           ** GEN0JI **
      *                                                                                       CGL020
      ** Save amount 1 & 2 to a work field                                                    CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     Z-ADDAMT1      WAAMT1 150                                          CGL020
     C                     Z-ADDAMT2      WAAMT2 150                                          CGL020
     C                     ENDIF                                                              CGL020
      *
      ** Read Teller FX Charges file for teller/transaction
     C           KFXCHG    KLIST
     C                     KFLD           TBID
     C                     KFLD           TBTN
      *
      * If CRT012 is On then                                                                  CRT012
      * accunulate all individual charges.                                                    CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRACCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C           KFXCHG    CHAINTTCHGL0              55
     C                     ENDIF                                                              CRT012
      *
      ** If charge exists for transaction:
      **   If 0JS (Buy TC for Cash in Non-Cash CCY)                       CEU025
      **     if charge on buy currency posting amount is AMT1 + AMT3      CEU025
      **     if charge on sell currency posting amount is AMT2 - AMT3     CEU025
      **   else,                                                          CEU025
      **     if charge on buy currency posting amount is AMT1 - AMT3
      **     if charge on sell currency posting amount is AMT2 + AMT3
      **
     C           *IN55     IFEQ '0'
      *                                                                   CEU025
     C           FNCD      IFEQ '0JS'                                     CEU025
     C           CEU025    ANDEQ'Y'                                       CEU025
      *                                                                   CEU025
     C           CCY1      IFEQ CCY3                                      CEU025
     C                     ADD  AMT3      AMT1                            CEU025
     C                     ELSE                                           CEU025
     C                     SUB  AMT3      AMT2                            CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C                     ELSE                                           CEU025
      *                                                                   CEU025
     C           CEU025    IFEQ 'N'                                       CEU025
      *                                                                   CEU025
     C           CCY1      IFEQ CCY3
     C                     SUB  AMT3      AMT1
     C                     ELSE
     C                     ADD  AMT3      AMT2
     C                     END
      *                                                                   CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C                     END
      *                                                                   CEU025
     C                     ENDIF                                          CEU025
      *
      ** Generate entry 1 - For Buy amount
      ***Generate*entry*1*only*if*associated*gl*code*is*non-zeros*****    100002
      ** If associated GL is zero, generate to suspense.                  100002
      *                                                                   100002
     C           @ASGL1    IFEQ *ZEROS                                    100002
     C                     MOVEL@CSAC     @ASGL1                          100002
     C                     END                                            100002
      *                                                                   100002
     C***********@ASGL1    IFNE *ZEROS                                    100002
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move other values for entry -1
     C                     EXSR MOV001
      *                                                                   094753
     C           ATYP      IFEQ 'R'                                       094753
     C                     Z-ADDACACNO    ACNO                            094753
     C                     END                                            094753
      *
      ** Store retail account number for entry 2
     C                     MOVE ACNO      @@ACNO 100
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and Account Code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     MOVELACOD      WWACOD                                              CRT012
     C                     MOVELACSQ      WACSQ                                               CRT012
      *                                                                                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVEL*BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * Overwrite A/C code and A/C seq with values from SDCTPOPD                              CRT012
     C                     MOVELCPACOD    ACOD                                                CRT012
     C                     MOVELCPACSQ    ACSQ                                                CRT012
      *                                                                                       CRT012
      * If Narrative Code has been entered then overwrite narrative                           CRT012
      * with narative from Narrative Table.                                                   CRT012
     C           CPNARR    IFNE *BLANKS                                                       CRT012
     C                     CALL 'AONARRR0'                                                    CRT012
     C                     PARM           @RTCD                                               CRT012
     C                     PARM '*KEY'    @OPTN                                               CRT012
     C                     PARM           CPNARR                                              CRT012
     C           SDNARR    PARM SDNARR    DSFDY                                               CRT012
      *                                                                                       CRT012
      * Set up narrative                                                                      CRT012
     C           @RTCD     IFEQ *BLANKS                                                       CRT012
     C                     MOVELTBID      PN1                                                 CRT012
     C                     MOVE '/'       PN4                                                 CRT012
     C                     MOVELTBTN      PN5                                                 CRT012
     C                     MOVELALDON     PN11                                                CRT012
     C                     MOVELPN        PNAR                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     WRITEAPOSTPDF
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C*********************END                                            100002
      *
      ** Generate entry 2 - For Sell amount
      ***Generate*entry*2*-*only*if*associated*gl*code*is*non*zeros****   100002
      ** If associated GL is zero, generate to suspense.                  100002
      *                                                                   100002
     C           @ASGL2    IFEQ *ZEROS                                    100002
     C                     MOVEL@CSAC     @ASGL2                          100002
     C                     END                                            100002
      *                                                                   100002
     C***********@ASGL2    IFNE *ZEROS                                    100002
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC2
     C                     END
      *
      ** Move values for entry -2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and Account Code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     MOVELACOD      WWACOD                                              CRT012
     C                     MOVELACSQ      WACSQ                                               CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *OFF                                                          CRT012
     C                     MOVELCPACOD    ACOD                                                CRT012
     C                     MOVELCPACSQ    ACSQ                                                CRT012
     C           CPNARR    IFNE *BLANKS                                                       CRT012
     C                     MOVELPN        PNAR                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     WRITEAPOSTPDF
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C*********************END                                            100002
      *
      ** If charge exists generate entries 3 and 4
      *
     C           *IN55     IFEQ '0'
      *
      ** Set up fields for both postings
     C                     MOVE CCY3      CCY
     C                     Z-ADDAMT3      PSTA
      *
      ** Entry 3
     C           CCY1      IFEQ CCY3
     C                     MOVE @ASGL1    ACOD
     C                     MOVE @PRND1    RIND
     C                     MOVE @PTYP1    ATYP
     C                     MOVE @PSTP1    STYP
     C                     MOVE @@ACNO    ACNO
     C                     END
     C                     MOVE *BLANK    TRAT
     C                     MOVEL' CHARGE '@N3218
     C/COPY WNCPYSRC,RE4201C017
     C                     MOVEL@NA3DS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C                     MOVE 'GB00950' ##MGID                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP6                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANKS   @N3268
     C                     Z-ADD0         DRCR
     C           *INU1     IFEQ '0'
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and Account Code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     MOVELACOD      WWACOD                                              CRT012
     C                     MOVELACSQ      WACSQ                                               CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *OFF                                                          CRT012
     C                     MOVELCPACOD    ACOD                                                CRT012
     C                     MOVELCPACSQ    ACSQ                                                CRT012
     C           CPNARR    IFNE *BLANKS                                                       CRT012
     C                     MOVELPN        PNAR                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     WRITEAPOSTPDF
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     MOVELWACSQ     ACSQ                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
      ** Entry 4
      ** Access LF/SDRETRL0 for transaction details
     C*
      * If CRT012 is On then                                                                  CRT012
      * execute new SR to Post Multiple Charges                                               CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     EXSR SRPMCH                                                        CRT012
     C                     ELSE                                                               CRT012
     C                     MOVE TTP3      @TTP3   5
     C                     CALL 'AORETRR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @TTP3
     C           SDRETR    PARM SDRETR    DSFDY
      ** If record does not exist -
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETRPD'DBFILE           ***************
     C                     Z-ADD21        DBASE            ** DB ERR 21 **
     C                     MOVEL@TTP3     DBKEY            **************
     C                     EXSR DBERR
     C                     END
      *
     C                     MOVE TTP3      TRAT
     C                     Z-ADD1         DRCR
      *
      ** Check whether a/c is a valid record in lf/accnt
      ** - save accnt key first
     C                     MOVE @CNUM     @@CNUM
     C                     MOVE @CCY      @@CCY
     C                     MOVE @ACOD     @@ACOD
     C                     MOVE @ACSQ     @@ACSQ
     C                     MOVE @BRCA     @@BRCA
      *
      ** If associated GL is zero, generate to suspense.                  100002
      *                                                                   100002
     C********** A1ASGL    IFEQ *ZEROS                             100002 139524
     C           A1ASGL    IFEQ *BLANKS                            100002 139524
     C                     MOVEL@CSAC     @ACOD                           100002
     C                     ELSE                                           100002
     C                     MOVE A1ASGL    @ACOD
     C                     END                                            100002
      *                                                                   100002
     C                     MOVE CCY3      @CCY
     C           KLACNT    CHAINACCNTABF             70
      *
     C           *INU1     IFEQ '0'
     C                     MOVE 'P'       RECI
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     MOVEL*BLANKS   TRAT                            094753
     C                     END
     C                     MOVE ACNO      @ACNOS 100
     C                     MOVE ACACNO    ACNO
     C                     MOVE @ACOD     ACOD                            100002
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     MOVE @ACNOS    ACNO
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
      ** Chain back to last accnt record
     C                     MOVE @@CNUM    @CNUM
     C                     MOVE @@CCY     @CCY
     C                     MOVE @@ACOD    @ACOD
     C                     MOVE @@ACSQ    @ACSQ
     C                     MOVE @@BRCA    @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
      ** Force reset of transaction types for next transaction type
     C                     MOVE *BLANKS   @PTTP1
     C                     MOVE *BLANKS   @PTTP2
      *
     C                     ENDIF                                                              CRT012
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0JA - Generate entry for fn.code '0JA'          *
      *                     '0JT' & '0JV'                             *
      *                     (GL Transfer)                             *
      *                     '00X' & '00S'                             *   CRT002
      *                     (Traveller's Cheques)                     *   CRT002
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0JA    BEGSR                           ** GEN0JA **
      *
      ** Generate entry 1
      *
      ** Move values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     MOVE *BLANKS   FAPNAR                                              CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
      * Save Narrative and Account Code                                                       CRT012
     C                     MOVELPNAR      WPNAR                                               CRT012
     C                     MOVELACOD      WWACOD                                              CRT012
     C                     MOVELACSQ      WACSQ                                               CRT012
      *                                                                                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVEL*BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * Overwrite A/C code and A/C seq with values from SDCTPOPD                              CRT012
     C                     MOVELCPACOD    ACOD                                                CRT012
     C                     MOVELCPACSQ    ACSQ                                                CRT012
      *                                                                                       CRT012
      * If Narrative Code has been entered then overwrite narrative                           CRT012
      * with narative from Narrative Table.                                                   CRT012
     C           CPNARR    IFNE *BLANKS                                                       CRT012
     C                     CALL 'AONARRR0'                                                    CRT012
     C                     PARM           @RTCD                                               CRT012
     C                     PARM '*KEY'    @OPTN                                               CRT012
     C                     PARM           CPNARR                                              CRT012
     C           SDNARR    PARM SDNARR    DSFDY                                               CRT012
      *                                                                                       CRT012
      * Set up narrative                                                                      CRT012
     C           @RTCD     IFEQ *BLANKS                                                       CRT012
     C                     MOVELTBID      PN1                                                 CRT012
     C                     MOVE '/'       PN4                                                 CRT012
     C                     MOVELTBTN      PN5                                                 CRT012
     C                     MOVELALDON     PN11                                                CRT012
     C                     MOVELPN        PNAR                                                CRT012
     C                     MOVELPN        FAPNAR                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
      ** Generate entry 2
      *
      ** Move values for entry -2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C           FAPNAR    ANDNE*BLANKS                                                       CRT012
     C                     MOVELFAPNAR    PNAR                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN00E - Generate entry for fn.code '00E'          *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN00E    BEGSR                           ** GEN00E **
      *
      ***Generate*entry*1*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move other values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C***********          END                                            107926
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN00F - Generate entry for fn.code '00F'          *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN00F    BEGSR                           ** GEN00F **
      *
      ***Generate*entry*1*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move other values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C***********          END                                            107926
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0JE - Generate entry for fn.code '0JE'          *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0JE    BEGSR                           ** GEN0JE **
      *
      ***Generate*entry*1*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move other values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C***********          END                                            107926
      *
      ***Generate*entry*2*-*only*if*associated*gl*code*is*non-zeros**     107926
     C***********@ASGL2    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC2
     C                     END
      *
      ** Move other values for entry -2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C***********          END                                            107926
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GEN0JF - Generate entry for fn.code '0JF'          *
      *                                                               *
      * CALLS      HSHTOT - Perform hash totals                       *
      *            MOV001 - Move values for generating entry-1        *
      *            MOV002 - Move values for generating entry-2        *
      *                                                               *
      * CALLED BY  GENENT - Generate entries                          *
      *                                                               *
      *****************************************************************
     C           GEN0JF    BEGSR                           ** GEN0JF **
      *
      ***Generate*entry*1*only*if*associated*gl*code*is*non-zeros**       107926
     C***********@ASGL1    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC1
     C                     END
      *
      ** Move other values for entry -1
     C                     EXSR MOV001
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C***********          END                                            107926
      *
      ***Generate*entry*2*-*only*if*associated*gl*code*is*non-zeros**     107926
     C***********@ASGL2    IFNE *ZEROS                                    107926
      *
      ** Check for foreign currency and setup accordingly
     C           CRT102    IFEQ 'Y'
     C                     EXSR CHFRC2
     C                     END
      *
      ** Move values for entry -2
     C                     EXSR MOV002
      *
     C           *INU1     IFEQ '0'
      *                                                                   CEU024
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'     CEU024
      ** currency, execute subroutine SRNARR                              CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
      *                                                                   CEU025
      ** or CEU025 is on and CEU013 is on                                 CEU025
      *                                                                   CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
      *                                                                   CEU024
     C                     Z-ADD1         A                               CEU024
     C           CCY1      LOKUPCURR,A                   86               CEU024
     C                     Z-ADD1         A                               CEU024
     C***********@CCY1     LOKUPCURR,A                   87        CEU024 140953
     C           CCY2      LOKUPCURR,A                   87               140953
      *                                                                   CEU024
     C           *IN86     IFEQ *ON                                       CEU024
     C           *IN87     ANDEQ*ON                                       CEU024
     C                     EXSR SRNARR                                    CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     ENDIF                                          CEU024
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      *                                                                   CEU024
     C                     WRITEAPOSTPDF
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *
      ** Perform hash totals on the posting amount
     C                     EXSR HSHTOT
      *
     C***********          END                                            107926
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            CHFRC1 - Check foreign currency and setup-1        *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  SETTTY - Set up transaction types (details)        *
      *                                                               *
      *****************************************************************
     C           CHFRC1    BEGSR                           ** CHFRC1 **
      *
      ** Check these function code for foriegn currency
     C           FNCD      IFEQ '00N'
     C           FNCD      OREQ '00H'
     C           FNCD      OREQ '00P'
     C           FNCD      OREQ '00O'
     C           FNCD      OREQ '00E'
     C           FNCD      OREQ '00F'
     C           FNCD      OREQ '0JN'
     C           FNCD      OREQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C           FNCD      OREQ '0JE'
     C           FNCD      OREQ '0JF'
     C           FNCD      OREQ '***'
      *
      ** If not equal to the local currency Hard code @ASGL1 to 2121
     C           CRT102    IFEQ 'Y'                                       125391
     C           CCY1      IFNE BJLCCY
     C                     Z-ADD2121      @ASGL1
     C                     MOVEL@AGLT     @AGLT1
     C                     END
     C                     END                                            125391
      *
     C                     END
      *
      ** For Charges/Credit Cash indicator for the transaction type
      ** should be 'Y'
     C           FNCD      IFEQ '00I'
     C           @CSIN1    ANDEQ'Y'
      *
      ** If not equal to the local currency Hard code @ASGL1 to 2121
     C           CRT102    IFEQ 'Y'                                       125391
     C           CCY1      IFNE BJLCCY
     C                     Z-ADD2121      @ASGL1
     C                     MOVEL@AGLT     @AGLT1
     C                     END
     C                     END                                            125391
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            CHFRC2 - Check foreign currency and setup-2        *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  SETTTY - Set up transaction types (details)        *
      *                                                               *
      *****************************************************************
     C           CHFRC2    BEGSR                           ** CHFRC2 **
      *
      ** If not equal to the local currency Hard code @ASGL2 to 2121
     C           CRT102    IFEQ 'Y'                                       125391
     C           FNCD      IFEQ '0JE'
     C           FNCD      OREQ '0JF'
     C           CCY1      IFNE BJLCCY
     C                     Z-ADD2121      @ASGL2
     C                     MOVEL@AGLT     @AGLT2
     C                     END
     C                     END
     C                     END                                            125391
      *
      ** If not equal to the local currency Hard code @ASGL2 to 2121
     C           CRT102    IFEQ 'Y'                                       125391
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C***********CCY2      ANDNEBJLCCY                                    139524
     C           CCY2      IFNE BJLCCY                                    139524
     C                     Z-ADD2121      @ASGL2
     C                     MOVEL@AGLT     @AGLT2
     C                     ENDIF                                          139524
     C                     END
     C                     END                                            125391
      *
      ** For Charges/Credit Cash indicator for the transaction type
      ** should be 'Y'
     C           FNCD      IFEQ '00I'
     C           @CSIN2    ANDEQ'Y'
      *
      ** If not equal to the local currency Hard code @ASGL2 to 2121
     C           CRT102    IFEQ 'Y'                                       125391
     C           CCY1      IFNE BJLCCY
     C                     Z-ADD2121      @ASGL2
     C                     MOVEL@AGLT     @AGLT2
     C                     END
     C                     END                                            125391
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            MOV001 - Move values for generating entry-1        *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  All GENXXX for generating customer a/c entry 1     *
      *            or internal a/c entry 1                            *
      *                                                               *
      *****************************************************************
     C           MOV001    BEGSR                           ** MOV001 **
      *
     C                     MOVE *BLANK    PNAR
     C                     MOVE *BLANK    STYP
     C                     MOVE *BLANK    PBTT
      *                                                                   CAC002
      **  Assign teller profit centre if anal acctg is available          CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FSTEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
      **  If associated GL account code is zero, post against suspense.   107926
      *
      ** If function code is not '0ja','0ji','00e','00f','0je','0jf'
      **                         '0jt','0jv'
      **                         '00s,'00x','0js','0jx'                   CRT002
      ** i.e. for all non-internal a/cs
     C           FNCD      IFNE '0JA'
     C           FNCD      ANDNE'0JT'
     C           FNCD      ANDNE'00X'                                     CRT002
     C           FNCD      ANDNE'0JV'
     C           FNCD      ANDNE'00S'                                     CRT002
     C           FNCD      ANDNE'0JI'
     C           FNCD      ANDNE'0JS'                                     CRT002
     C           FNCD      ANDNE'0JX'                                     CRT002
     C           FNCD      ANDNE'00E'
     C           FNCD      ANDNE'00F'
     C           FNCD      ANDNE'0JE'
     C           FNCD      ANDNE'0JF'
      *
     C**********           Z-ADD@CNUM1    @CNUM                                               CSD027
     C                     MOVE @CNUM1    @CNUM                                               CSD027
     C                     MOVEL@CCY1     @CCY
     C                     Z-ADD@ACOD1    @ACOD
     C                     Z-ADD@ACSQ1    @ACSQ
     C                     MOVE @ATYP1    ATYP
     C                     MOVE @STYP1    STYP
     C                     MOVE @BRCA1    BRCA
     C                     MOVEL@PBPT1    PBTT
      *
      ** If function code is 00a,
      **   chain to ACCNT for profit centre
     C           FNCD      IFEQ '00A'
     C                     MOVEL@BRCA1    @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *                                                                   107926
     C           *IN70     IFEQ '1'                                       107926
     C                     MOVELA8BICN    @CNUM                           107926
     C                     MOVEL@CCY1     @CCY                            107926
     C                     MOVEL@CSAC     @ACOD                           107926
     C                     MOVEL'01'      @ACSQ                           107926
     C                     ENDIF                                          107926
      *                                                                   107926
     C                     END
      *
     C                     ELSE
      *
      ** If function code is not gl transfer
      ** i.e for all internal postings except gl transfer
     C           FNCD      IFNE '0JA'
     C           FNCD      ANDNE'0JT'
     C           FNCD      ANDNE'00X'                                     CRT002
     C           FNCD      ANDNE'0JV'
     C           FNCD      ANDNE'00S'                                     CRT002
      *
      ** Move to key fields
     C**********           Z-ADD@TICN     @CNUM                                               CSD027
     C                     MOVE @TICN     @CNUM                                               CSD027
     C                     MOVELCCY1      @CCY
     C                     MOVE @ASGL1    @ACOD
     C                     Z-ADD1         @ACSQ
     C                     MOVEL@AGLT1    ATYP
     C                     MOVE ITLB      BRCA
     C                     MOVE BRCA      @BRCA
      *
      ** Check whether a/c is a valid record in lf/accnt for these fns.
     C           KLACNT    CHAINACCNTABF             70
      *
      ***If*valid*record*does*not*exist*and*a/c*type*is*'R'-*suspense*    139524
      ** If record not found and no associated GL code - suspense         139524
      *                                                                   139524
     C           *IN70     IFEQ '1'
     C           ATYP      ANDEQ'R'                                       139524
     C           @ASGL1    OREQ 0                                         139524
     C***********ATYP      ANDEQ'R'                                       107926
     C                     MOVE @CSAC     @ACOD
     C                     MOVEL@CSAT     ATYP
      *                                                                   CAC002
      **  Assign primary funding prft cntr if anal acctg is available     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     END
      *
     C                     END
      *
     C                     END
      *
      ** If function code is '0ja' -
      **                  or '0jt', '0jv'
      **                  or '00s', '00x'                                 CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '0JA'
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
     C                     MOVE CUS1      @CNUM
     C                     MOVELCCY1      @CCY
     C                     Z-ADDACD1      @ACOD
     C                     Z-ADDACSQ1     @ACSQ
     C                     MOVELDBBRCA    @BRCA
      *
      ** Chain to ACCNT for account details - branch code, a/c type etc
     C           KLACNT    CHAINACCNTABF             70
     C                     MOVEL@BRCA     BRCA
      *
     C           @ACOD     IFNE 0                                         139524
     C                     MOVE @ACOD     @ACD                            139524
     C                     EXSR GETACT                                    139524
     C                     MOVEL@ACT      ATYP                            139524
     C                     ENDIF                                          139524
     C           *IN70     IFEQ '1'                                       107926
     C           ATYP      ANDEQ'R'                                       139524
     C           @ACOD     OREQ 0                                         139524
     C                     MOVELA8BICN    @CNUM                           107926
     C                     MOVELCCY1      @CCY                            107926
     C                     MOVEL@CSAC     @ACOD                           107926
     C                     MOVEL'01'      @ACSQ                           107926
     C                     MOVEL@CSAT     ATYP                            139524
     C                     ENDIF                                          107926
      *                                                                   107926
     C                     END
      *
     C**********           Z-ADD@CNUM     CNUM                                                CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY
     C                     MOVE @ACOD     ACOD
     C                     Z-ADD@ACSQ     ACSQ
      *
     C                     Z-ADDTRACNO    ACNO
     C                     Z-ADDBJRDNB    PSTD
     C                     MOVEL@TTYP1    TRAT
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
      *
      ** For cash transactions, ensure there's no cheque reference no.
      ** Also for cheque deposit, where cheque no. is irrelevant.         142084
     C           FNCD      IFEQ '00H'
     C           FNCD      OREQ '00P'
     C           FNCD      OREQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '00K'                                     142084
     C           FNCD      OREQ '00Q'                                     142084
     C           FNCD      OREQ '0JK'                                     142084
     C           FNCD      OREQ '0JQ'                                     142084
     C**********           MOVEL*BLANKS   CHQN                            142084
     C                     Z-ADD*ZEROS    CHQN                            142084
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           CQNF      ANDNE*BLANKS                                                       CRE019
     C           FNCD      IFEQ '00P'                                                         CRE019
     C           FNCD      OREQ '0JP'                                                         CRE019
     C           FNCD      OREQ '00Q'                                                         CRE019
     C           FNCD      OREQ '0JQ'                                                         CRE019
     C           FNCD      OREQ '0JK'                                                         244720
     C                     MOVELCQNF      CHQN                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     ELSE
     C                     MOVELCQNF      CHQN
     C                     END
      *
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           KLACNT    CHAINACCNTABF             70                   CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     Z-ADD0         ACNO                            094753
     C                     Z-ADD0         CHQN                            094753
     C                     MOVEL*BLANKS   TRAT                            094753
     C                     END
      *
     C                     Z-ADD0         REJC
     C                     MOVELDEPC      DPMT
     C                     Z-ADD0         RRNM
      *
     C           FNCD      IFEQ '***'
     C                     MOVEL'N'       GETP
     C                     MOVEL'  GE-TT' SPOS
     C                     ELSE
     C                     MOVEL'N'       GETP
     C                     MOVEL'  GE-TT' SPOS
     C                     END
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
      *
     C                     Z-ADD0         ACUM
     C                     MOVEL'Y'       TLIN
     C                     MOVE ITLB      ORBR
     C                     Z-ADDAMT1      ORAMT
      *
      ** If function code is one of the foll. move 0 to dr/cr ind
     C           FNCD      IFEQ '00O'
     C           FNCD      OREQ '00L'
     C           FNCD      OREQ '00W'                                     CRT002
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C           FNCD      OREQ '00A'
     C           FNCD      OREQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C           FNCD      OREQ '0JA'
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
     C           FNCD      OREQ '00E'
     C           FNCD      OREQ '0JE'
     C                     Z-ADD0         DRCR
      *
     C                     ELSE
      *
     C           FNCD      IFEQ '00I'
     C           FNCD      OREQ '***'
      *
      ** Move dr/cr.ind according to dcin of trans.type 1
     C           @DCIN1    IFEQ 'D'
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
      *
     C                     ELSE
      *
     C                     Z-ADD1         DRCR
      *
     C                     END
      *
     C                     END
      *
      ** If function code is one of the foll. move cvam to posting amt.
     C           FNCD      IFEQ '0JN'
     C           FNCD      OREQ '0JK'
     C           FNCD      OREQ '0JQ'
     C           FNCD      OREQ '0JR'                                     CRT002
     C           FNCD      OREQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C                     Z-ADDCVAM      PSTA
      *
     C                     ELSE
      *
     C                     Z-ADDAMT1      PSTA
      *
     C                     END
      *                                                                                       CGL020
      ** Initialise fee detail fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE ' '       FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
      *
      ** If charge exists:
     C           *IN55     IFEQ '0'
      *
      ** - If 0JH or 0JP subtract cash amount only
      ** also if 00H or 00P subtract cash amount only
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '00H'
     C           FNCD      OREQ '00P'
      *                                                                                       CGL020
      ** Set Fee details                                                                      CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'N'       FEEFLG                                              CGL020
     C                     Z-ADD@CACHG    FEEVAL                                              CGL020
     C           @CACHG    DIV  PSTA      WFEPCT 158                                          CGL020
     C           WFEPCT    MULT 100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     SUB  @CACHG    PSTA
     C                     ELSE
      *                                                                   118271
      **  Include charge only if it is in account currency.               118271
      *                                                                   118271
     C           CCY3      IFEQ CCY                                       118271
      *
      ** - If deposit subtract charge
     C           FNCD      IFEQ '00K'
     C           FNCD      OREQ '00Q'
     C           FNCD      OREQ '00R'                                     CRT002
     C           FNCD      OREQ '0JN'
     C           FNCD      OREQ '0JK'
     C           FNCD      OREQ '0JQ'
     C           FNCD      OREQ '0JR'                                     CRT002
     C           FNCD      OREQ '00N'
      *                                                                                       CGL020
      ** Set Fee details                                                                      CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'N'       FEEFLG                                              CGL020
     C                     Z-ADDAMT3      FEEVAL                                              CGL020
     C           AMT3      DIV  PSTA      WFEPCT                                              CGL020
     C           WFEPCT    MULT 100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     SUB  AMT3      PSTA
     C                     ELSE
      *
      ** - If withdrawal add charge
     C           FNCD      IFEQ '00L'
     C           FNCD      OREQ '00W'                                     CRT002
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C           FNCD      OREQ '00O'
      *                                                                                       CGL020
      ** Set Fee details                                                                      CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'N'       FEEFLG                                              CGL020
     C                     Z-ADDAMT3      FEEVAL                                              CGL020
     C           AMT3      DIV  PSTA      WFEPCT                                              CGL020
     C           WFEPCT    MULT 100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ADD  AMT3      PSTA
     C                     END
     C                     END
     C                     END                                            118271
      *                                                                                       CGL020
      ** If not equal to account currency                                                     CGL020
      *                                                                                       CGL020
     C           CCY3      IFNE CCY                                                           CGL020
     C           CGL020    ANDEQ'Y'                                                           CGL020
      *                                                                                       CGL020
      ** - If deposit subtract charge                                                         CGL020
      *                                                                                       CGL020
     C           FNCD      IFEQ '00K'                                                         CGL020
     C           FNCD      OREQ '00Q'                                                         CGL020
     C           FNCD      OREQ '00R'                                                         CGL020
     C           FNCD      OREQ '0JN'                                                         CGL020
     C           FNCD      OREQ '0JK'                                                         CGL020
     C           FNCD      OREQ '0JQ'                                                         CGL020
     C           FNCD      OREQ '0JR'                                                         CGL020
     C           FNCD      OREQ '00N'                                                         CGL020
     C           FNCD      OREQ '00L'                                                         CGL020
     C           FNCD      OREQ '00W'                                                         CGL020
     C           FNCD      OREQ '0JO'                                                         CGL020
     C           FNCD      OREQ '0JL'                                                         CGL020
     C           FNCD      OREQ '0JW'                                                         CGL020
     C           FNCD      OREQ '00O'                                                         CGL020
      *                                                                                       CGL020
      ** Convert charge amount to account currency                                            CGL020
      *                                                                                       CGL020
     C                     MOVE CCY3      WFRCCY  3                                           CGL020
     C                     MOVE CCY       WTOCCY  3                                           CGL020
      *                                                                                       CGL020
      ** Setup input and output amount                                                        CGL020
      *                                                                                       CGL020
     C                     Z-ADDAMT3      WAMNTI 150                                          CGL020
     C                     Z-ADD0         WAMNTO 150                                          CGL020
      *                                                                                       CGL020
     C                     EXSR SRCONV                                                        CGL020
      *                                                                                       CGL020
      ** Set Fee details                                                                      CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       FEEFLG                                              CGL020
     C                     Z-ADDWAMNTO    FEEVAL                                              CGL020
     C           FEEVAL    DIV  PSTA      WFEPCT                                              CGL020
     C           WFEPCT    MULT 100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     END
      *
     C                     END
      *
      *
      ** If function code is one of the foll. move runday number
     C           FNCD      IFEQ '00H'
     C           FNCD      OREQ '00P'
     C           FNCD      OREQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
     C           FNCD      OREQ '0JA'
     C           FNCD      OREQ '00E'
     C           FNCD      OREQ '00F'
     C           FNCD      OREQ '0JE'
     C           FNCD      OREQ '0JF'
     C                     Z-ADDBJRDNB    VALD
      *
     C                     ELSE
      *
     C                     Z-ADDVLDT      VALD
      *
     C                     END
      *
      ** If function code is one of the foll.- move a/c ccy
     C           FNCD      IFEQ '00N'
     C           FNCD      OREQ '00K'
     C           FNCD      OREQ '00Q'
     C           FNCD      OREQ '00R'                                     CRT002
     C           FNCD      OREQ '00H'
     C           FNCD      OREQ '00P'
     C           FNCD      OREQ '00O'
     C           FNCD      OREQ '00L'
     C           FNCD      OREQ '00W'                                     CRT002
     C           FNCD      OREQ '00A'
     C           FNCD      OREQ '00I'
     C           FNCD      OREQ '***'
     C                     MOVEL@CCY1     TRCCY
      *
     C                     ELSE
      *
     C                     MOVELCCY1      TRCCY
      *
     C                     END
      *
      ** If function code is one of the foll.- setup narration
     C           FNCD      IFEQ '0JN'
     C           FNCD      OREQ '0JK'
     C           FNCD      OREQ '0JQ'
     C           FNCD      OREQ '0JR'                                     CRT002
     C           FNCD      OREQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
      *
      ** Get no.of decimal places of currency
     C                     CALL 'AOCURRR0'
     C***********          PARM '*BLANK ' @RTCD   7                       CEU024
     C                     PARM *BLANK    @RTCD   7                       CEU024
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM TRCCY     @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
     C*
     C           @RTCD     IFEQ *BLANK
     C                     Z-ADDA6NBDP    ZDECS
     C                     ELSE
     C                     Z-ADD0         ZDECS
     C                     END
      *
      ** Edit the amount field - for narrative
     C                     MOVE 'J'       ZECODE
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE AMT1      ZFLD15
     C                     EXSR ZFRPED
     C                     MOVE *BLANKS   @NAMT2
     C                     MOVE ZOUT22    @NAMT2
      *
     C                     MOVE *BLANK    @NAR19
     C                     MOVE *BLANK    @NA133
     C                     MOVE '_'       @NAR19
     C                     MOVE '_'       @NA133
      *
     C           FNCD      IFEQ '0JO'
     C                     MOVEL'CASH_WDR'@NAR19
     C/COPY WNCPYSRC,RE4201C018
     C                     MOVE 'GB00890' ##MGID                          109175
     C                     END
     C           FNCD      IFEQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C                     MOVEL'CHEQ_WDR'@NAR19
     C/COPY WNCPYSRC,RE4201C019
     C                     MOVE 'GB00900' ##MGID                          109175
     C                     END
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C                     MOVEL'CASH_DEP'@NAR19
     C/COPY WNCPYSRC,RE4201C020
     C                     MOVE 'GB00910' ##MGID                          109175
     C                     END
     C           FNCD      IFEQ '0JK'
     C           FNCD      OREQ '0JQ'
     C           FNCD      OREQ '0JR'                                     CRT002
     C                     MOVEL'CHEQ_DEP'@NAR19
     C/COPY WNCPYSRC,RE4201C021
     C                     MOVE 'GB00920' ##MGID                          109175
     C                     END
     C           FNCD      IFEQ '0JN'
     C                     MOVEL'CASH_DEP'@NAR19
     C/COPY WNCPYSRC,RE4201C022
     C                     MOVE 'GB00910' ##MGID                          109175
     C                     END
      *
     C                     MOVEL@NA2DS    PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C           TTNR      IFNE *BLANKS                                                     MD054623
     C                     MOVELTTNR      PNAR                                              MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ELSE                                                             MD054623
     C                     EXSR GETNAR                                                      MD054623
     C           DRCR      IFEQ 0                                                           MD054623
     C           TTNARR    ANDNE*BLANKS                                                     MD054623
     C                     MOVELTTNARR    PNAR                                              MD054623
     C                     ELSE                                                             MD054623
     C           DRCR      IFEQ 1                                                           MD054623
     C           TTNAR2    ANDNE*BLANKS                                                     MD054623
     C                     MOVELTTNAR2    PNAR                                              MD054623
     C                     ELSE                                                             MD054623
     C                     MOVELTTNARR    PNAR                                              MD054623
     C                     END                                                              MD054623
     C                     END                                                              MD054623
     C                     END                                                              MD054623
     C                     ENDIF                                                            MD054623
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C           RTSNAR    ANDNE'Y'                                                         MD054623
     C                     CLEARCGPNAR                                    109175
     C                     MOVE TRCCY     MNCYCD                          109175
     C                     MOVEL@NAMT2    MNOAMT                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
      *                                                                                      BUG9062
     C           FNCD      IFEQ '0JK'                                                        BUG9062
     C           CQNF      IFNE *BLANKS                                                     MD055860
     C**********           MOVE *BLANKS   @@CQNF 17                                  243652 MD054623
     C                     MOVE *BLANKS   @@CQNF 10                                         MD054623
     C                     MOVE CQNF      @@CQNF                                              243652
     C                     MOVE @@CQNF    PNAR                                                243652
     C**********           MOVE CQNF      PNAR                                        BUG9062 243652
     C                     ENDIF                                                            MD055860
     C                     ENDIF                                                             BUG9062
      *
     C                     ELSE
      *
     C           FNCD      IFEQ '00A'
      *
      ** If trans.narration is non-blanks, move it to the narrative fld
     C           TTNR      IFNE *BLANKS
     C                     MOVELTTNR      PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
     C                     ELSE
     C                     EXSR GETNAR                                    093749
     C           DRCR      IFEQ 0                                         093749
     C           TTNARR    ANDNE*BLANKS                                   093749
     C                     MOVELTTNARR    PNAR                            093749
     C                     ELSE                                           093749
     C           DRCR      IFEQ 1                                         093749
     C           TTNAR2    ANDNE*BLANKS                                   093749
     C                     MOVELTTNAR2    PNAR                            093749
     C                     ELSE                                           093749
     C                     MOVEL@TTNM1    PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
     C                     END
     C                     END                                            093749
     C                     END                                            093749
      *
     C                     ELSE
      *
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
      *                                                                                       CGL020
      ** Set Fee details                                                                      CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           CCY1      ANDEQCCY3                                                          CGL020
     C                     MOVE 'N'       FEEFLG                                              CGL020
     C                     Z-ADDAMT3      FEEVAL                                              CGL020
     C           AMT3      DIV  WAAMT1    WFEPCT                                              CGL020
     C           WFEPCT    MULT 100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDTBTN      @TTRNO
     C                     MOVE *BLANK    @N3115
     C                     MOVE *BLANK    @N3215
     C                     MOVEL@NA115    @N3115
     C                     MOVEL' BUY  '  @N3218
     C/COPY WNCPYSRC,RE4201C023
     C                     MOVEL@NA3DS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C                     MOVE 'GB00930' ##MGID                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C                     MOVE *BLANKS   @N3268
      *
     C                     ELSE
      *                                                                                      BUG4311
      ** Include cheque no. in posting narative for cash withdrawal,                         BUG4311
      ** cheuqe withrawal, cash deposit and house cheque deposit.                            BUG4311
      *                                                                                      BUG4311
     C           FNCD      IFEQ '00O'                                                        BUG4311
     C           FNCD      OREQ '00L'                                                        BUG4311
     C           FNCD      OREQ '00N'                                                        BUG4311
     C           FNCD      OREQ '00Q'                                                        BUG4311
     C           FNCD      OREQ '00K'                                                        BUG9062
     C                     MOVEL@TTNM1    PNAR                                               BUG4311
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR GETNAR                                                      MD054623
     C           TTNARR    IFNE *BLANKS                                                     MD054623
     C                     MOVE TTNARR    PNAR                                              MD054623
     C                     ELSE                                                             MD054623
     C                     MOVEL@TTNM1    PNAR                                              MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
     C                     ENDIF                                                            MD054623
     C           FNCD      IFNE '00K'                                                        BUG9062
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C           CQNF      ANDNE*BLANKS                                                     MD054623
     C           CHECKL    ANDEQ@TTNM1                                                      MD054623
     C           20        SUBSTPNAR:1    @@NARR 30                                         MD054623
     C                     MOVEL@@NARR    PNAR                                              MD054623
     C                     ENDIF                                                            MD054623
     C           CQNF      IFNE *BLANKS                                                     MD055860
     C                     MOVE *BLANKS   WRK10  10                                         MD055860
     C                     MOVE WRK10     PNAR                                              MD055860
     C                     MOVE CQNF      PNAR                                               BUG4311
     C                     ENDIF                                                            MD055860
     C                     ENDIF                                                             BUG9062
      *                                                                                      BUG4311
     C                     ELSE                                                              BUG4311
      *
      ** Get trans.narration from TTNARPD?
     C           FNCD      IFEQ '0JA'
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
     C           FNCD      OREQ '00E'
     C           FNCD      OREQ '00F'
     C           FNCD      OREQ '00H'                                                       MD054623
     C           FNCD      OREQ '0JH'                                                       MD054623
     C           FNCD      OREQ '00K'                                                       MD054623
     C           FNCD      OREQ '0JK'                                                       MD054623
     C           FNCD      OREQ '00L'                                                       MD054623
     C           FNCD      OREQ '0JL'                                                       MD054623
     C           FNCD      OREQ '00N'
     C           FNCD      OREQ '0JN'                                                       MD054623
     C           FNCD      OREQ '00O'                                                       MD054623
     C           FNCD      OREQ '0JO'                                                       MD054623
     C           FNCD      OREQ '00P'                                                       MD054623
     C           FNCD      OREQ '0JP'                                                       MD054623
     C           FNCD      OREQ '00Q'                                                       MD054623
     C           FNCD      OREQ '0JQ'                                                       MD054623
     C           FNCD      OREQ '0JR'                                                       MD054623
     C                     EXSR GETNAR
     C           TTNARR    IFNE *BLANKS
     C                     MOVE TTNARR    PNAR
     C                     ELSE
     C                     MOVEL@TTNM1    PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
     C                     END
     C           CHECKL    IFEQ *BLANKS
     C                     MOVEL@TTNM1    PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
     C                     ENDIF
     C                     ELSE
      *
     C                     MOVEL@TTNM1    PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
     C/COPY WNCPYSRC,RE4201C031
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     ENDIF                                                             BUG4311
      *                                                                                      BUG4311
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP7                                           S01408
     C*                                                                   S01408
     C                     MOVEL'P'       RECI
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
      ** Store details required for interbranch posting
     C**********           Z-ADDCNUM      @PNUM1                                              CSD027
     C                     MOVE CNUM      @PNUM1                                              CSD027
     C                     MOVELCCY       @PCCY1
     C                     MOVE ACOD      @PACD1
     C                     Z-ADDACSQ      @PASQ1
     C                     Z-ADDVALD      @PVLD1
     C                     MOVELTRAT      @PTRT1
     C                     MOVE *BLANK    @PNAR1
     C                     MOVELPNAR      @PNAR1
     C                     Z-ADDPSTA      @PPSA1
     C                     Z-ADDDRCR      @PDC1
     C                     MOVELSPOS      @PPOS1
     C                     MOVE BRCA      @PBCA1
     C                     Z-ADDRIND      @PRND1
     C                     MOVELATYP      @PTYP1
     C                     MOVELSTYP      @PSTP1
     C                     MOVELPRIN      @PIND1
     C                     MOVELGETP      @PGTP1
     C                     MOVELPBTT      @PPBT1
     C                     MOVELORBR      @PORB1
      *
     C                     ENDSR
      *****************************************************************                       CGL020
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      *  SRCONV - Convert amount from one ccy to another              *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
      *                                                                                       CGL020
     C           SRCONV    BEGSR                                                              CGL020
      *                                                                                       CGL020
      ** Get details of from ccy                                                              CGL020
      *                                                                                       CGL020
     C                     CALL 'AOCURRR0'                                                    CGL020
     C                     PARM *BLANK    PRTCD                                               CGL020
     C                     PARM '*KEY   ' POPTN                                               CGL020
     C                     PARM WFRCCY    PCURR   3                                           CGL020
     C           SDCURR    PARM SDCURR    DSSDY                                               CGL020
      *                                                                                       CGL020
     C           PRTCD     IFNE *BLANK                                                        CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     Z-ADD19        DBASE                                               CGL020
     C                     MOVELPCURR     DBKEY                                               CGL020
     C                     MOVEL'SDCURRPD'DBFILE                                              CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR DBERR                                                         CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE A6MDIN    ZMDI1                                               CGL020
     C                     Z-ADDA6SPRT    ZRATE1                                              CGL020
     C                     Z-ADDA6NBDP    WNBDP1  10                                          CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      ** Get details of to ccy                                                                CGL020
      *                                                                                       CGL020
     C                     CALL 'AOCURRR0'                                                    CGL020
     C                     PARM *BLANK    PRTCD                                               CGL020
     C                     PARM '*KEY   ' POPTN                                               CGL020
     C                     PARM WTOCCY    PCURR                                               CGL020
     C           SDCURR    PARM SDCURR    DSSDY                                               CGL020
      *                                                                                       CGL020
     C           PRTCD     IFNE *BLANK                                                        CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     Z-ADD20        DBASE                                               CGL020
     C                     MOVELPCURR     DBKEY                                               CGL020
     C                     MOVEL'SDCURRPD'DBFILE                                              CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR DBERR                                                         CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE A6MDIN    ZMDI2                                               CGL020
     C                     Z-ADDA6SPRT    ZRATE2                                              CGL020
     C                     Z-ADDA6NBDP    WNBDP2  10                                          CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     EXSR ZXRATE                                                        CGL020
      *                                                                                       CGL020
     C                     Z-ADDZRATEX    ZEXCH                                               CGL020
     C                     MOVE ZMDIX     ZMD                                                 CGL020
     C                     MOVE CCY3      ZCCYI                                               CGL020
     C                     MOVE CCY       ZCCYO                                               CGL020
     C                     Z-ADDWNBDP1    ZCDPI                                               CGL020
     C                     Z-ADDWNBDP2    ZCDPO                                               CGL020
     C                     Z-ADDWAMNTI    ZAMTCI                                              CGL020
      *                                                                                       CGL020
     C                     EXSR ZCONV                                                         CGL020
      *                                                                                       CGL020
     C                     Z-ADDZAMTCO    WAMNTO                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *                                                                                       CGL020
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            MOV002 - Move values for generating entry-2        *
      *                                                               *
      *            Credit a/c entry for fn.code '00A' '0JA' transfers *
      *                                       & '0JT' '0JV' transfers *
      *                                       & '00X' '00S' TCs       *   CRT002
      *            Sell ccy entry for fn.code '0JI' foreign exchange  *
      *                                       & '0JS' '0JX' TCs       *   CRT002
      *            and Contra entry for other fn.code                 *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  GEN00A/GEN0JA - Gen credit a/c entry               *
      *            GEN0JI - Generate sell ccy contra entry            *
      *            Others - Generate contra entry for 1st entry       *
      *                                                               *
      *****************************************************************
     C           MOV002    BEGSR                           ** MOV002 **
      *
     C                     MOVE *BLANK    PNAR
     C                     MOVE *BLANK    STYP
     C                     MOVE *BLANKS   PBTT
      *                                                                   CAC002
      **  Assign teller profit centre if anal acctg is available          CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FSTEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
      **  If associated GL account code is zero, post against suspense.   107926
      *                                                                   107926
     C           FNCD      IFEQ '0JI'                                     107926
     C           FNCD      OREQ '0JE'                                     107926
     C           FNCD      OREQ '0JF'                                     107926
     C           FNCD      OREQ '0JS'                                     107926
     C           FNCD      OREQ '0JX'                                     107926
     C**********           Z-ADD@ASGL2    @ASGL   40                                   107926 CGL029
     C                     Z-ADD@ASGL2    @ASGL  100                                          CGL029
     C                     ELSE                                           107926
     C                     Z-ADD@ASGL1    @ASGL                           107926
     C                     ENDIF                                          107926
      *
      ** If function code is not gl transfer(0ja) and not ret.trf(00a)
     C           FNCD      IFNE '0JA'
     C           FNCD      ANDNE'0JT'
     C           FNCD      ANDNE'00X'                                     CRT002
     C           FNCD      ANDNE'0JV'
     C           FNCD      ANDNE'00S'                                     CRT002
     C           FNCD      ANDNE'00A'
      *
      ** Move fields to klist
     C**********           Z-ADD@TICN     @CNUM                                               CSD027
     C                     MOVE @TICN     @CNUM                                               CSD027
     C                     Z-ADD1         @ACSQ
     C                     MOVE ITLB      BRCA
     C                     Z-ADD0         ACNO
      *
      ** If function code is foreign exchange (oji)
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
      *
     C                     Z-ADD@ASGL2    @ACOD
     C                     MOVELCCY2      @CCY
     C                     MOVEL@AGLT2    ATYP
      *
     C                     ELSE
      *
      ** If function code is treasury in or out (0je,0jf)
     C           FNCD      IFEQ '0JE'
     C           FNCD      OREQ '0JF'
      *
     C                     Z-ADD@ASGL2    @ACOD
     C                     MOVELCCY1      @CCY
     C                     MOVEL@AGLT2    ATYP
      *
     C                     ELSE
      *
     C                     Z-ADD@ASGL1    @ACOD
     C                     MOVELCCY1      @CCY
     C                     MOVEL@AGLT1    ATYP
      *
     C                     END
      *
     C                     END
      *
      ** Check whether a/c is a valid record in lf/accnt
     C                     MOVE BRCA      @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
      ***If*no*record*and*a/c*type*is*'R'*-*suspense*a/c***********       139524
      ** If no record and no associated GL code - suspense a/c            139524
      *                                                                   139524
     C           *IN70     IFEQ '1'
     C           ATYP      ANDEQ'R'                                       139524
     C           @ACOD     OREQ 0                                         139524
     C***********ATYP      ANDEQ'R'                                       107926
     C                     MOVE @CSAC     @ACOD
     C                     MOVE @CSAT     ATYP
      *                                                                   CAC002
      **  Assign primary funding prft cntr if anal acctg is available     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     END
      *
     C                     END
      *
      ** If function code is 0ja
      **                  or 0jt, 0jv
      **                  or 00s, 00x                                     CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '0JA'
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
      *
     C                     MOVE CUS2      @CNUM
     C                     MOVELCCY1      @CCY
     C                     Z-ADDACD2      @ACOD
     C                     Z-ADDACSQ2     @ACSQ
     C                     MOVELCRBRCA    @BRCA
      *
      ** Chain to ACCNT for account details - branch code, a/c type etc
     C           KLACNT    CHAINACCNTABF             70
     C                     MOVEL@BRCA     BRCA
      *
     C                     END
      *
      *
      ** If function code is 00a
     C           FNCD      IFEQ '00A'
      *
     C**********           Z-ADD@CNUM2    CNUM                                                CSD027
     C                     MOVE @CNUM2    CNUM                                                CSD027
     C                     MOVEL@CCY2     CCY
     C                     Z-ADD@ACOD2    ACOD
     C                     Z-ADD@ACSQ2    ACSQ
     C                     MOVEL@ATYP2    ATYP
     C                     MOVEL@STYP2    STYP
     C                     MOVE @BRCA2    BRCA
     C                     MOVEL@PBPT2    PBTT
     C                     MOVE TTAC      ACNO
     C                     MOVE TTAC      ACACNO
      *
     C                     MOVE @CNUM2    @CNUM
     C                     MOVEL@CCY2     @CCY
     C                     Z-ADD@ACOD2    @ACOD
     C                     Z-ADD@ACSQ2    @ACSQ
     C                     MOVEL@BRCA2    @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
     C                     ELSE
      *
     C**********           Z-ADD@CNUM     CNUM                                                CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY
     C                     MOVE @ACOD     ACOD
     C                     Z-ADD@ACSQ     ACSQ
      *
     C                     END
      *
     C           KLACNT    CHAINACCNTABF             70                   107926
     C           @ACOD     IFNE 0                                         139524
     C                     MOVE @ACOD     @ACD                            139524
     C                     EXSR GETACT                                    139524
     C                     MOVEL@ACT      ATYP                            139524
     C                     ENDIF                                          139524
     C           *IN70     IFEQ '1'                                       107926
     C           ATYP      ANDEQ'R'                                       139524
     C           @ACOD     OREQ 0                                         139524
     C                     MOVELA8BICN    @CNUM                           107926
     C                     MOVELCCY1      @CCY                            107926
     C                     MOVEL@CSAC     @ACOD                           107926
     C                     MOVEL'01'      @ACSQ                           107926
     C                     MOVE @CSAT     ATYP                            107926
      *                                                                   107926
     C                     ENDIF                                          107926
      *
     C                     Z-ADDBJRDNB    PSTD
      *                                                                   109102
      **  Use entered Value Date for Retail A/C Transfer.                 109102
     C           FNCD      IFEQ '00A'                                     109102
     C                     Z-ADDVLDT      VALD                            109102
     C                     ELSE                                           109102
     C                     Z-ADDBJRDNB    VALD
     C                     END                                            109102
      *
     C                     Z-ADDTBTN      @TTRNO
      *
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVEL'  GE-TT' SPOS
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
      *
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     Z-ADDACACNO    ACNO
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           KLACNT    CHAINACCNTABF             70                   CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     Z-ADD0         ACNO
     C                     MOVE *BLANKS   TRAT
     C                     END
      *
     C                     Z-ADD0         REJC
     C                     MOVELDEPC      DPMT
     C                     Z-ADD0         RRNM
      *                                                                   130020
      ***********                                                  109102 130020
      ***Don't*blank*Teller*input*details*if*this*is*an*RE*Transfer109102 130020
     C***********FNCD      IFNE '00A'                              109102 130020
     C                     MOVE *BLANKS   TLIN
     C                     MOVE *BLANKS   TRCCY
     C***********          END                                     109102 130020
      ***********                                                  109102 130020
      *                                                                   130020
     C                     MOVEL'N'       GETP
     C                     Z-ADD0         ACUM
     C                     MOVE ITLB      ORBR
     C                     Z-ADD0         ORAMT
      *                                                                                      BUG8553
      ** If foreign exchange, tag as Teller's Input                                          BUG8553
      *                                                                                      BUG8553
     C           FNCD      IFEQ '0JI'                                                        BUG8553
     C                     MOVE 'Y'       TLIN                                               BUG8553
     C                     MOVELCCY2      TRCCY                                              BUG8553
     C                     Z-ADDAMT2      ORAMT                                              BUG8553
     C                     ENDIF                                                             BUG8553
      *
      *
      ** If function code is fx or treasury in or out (0ji,0je,0jf)
      **                           traveller's cheque (0js,0jx            CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C           FNCD      OREQ '0JE'
     C           FNCD      OREQ '0JF'
     C           FNCD      OREQ '00A'
     C           FNCD      OREQ '0JA'
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
      *
     C           ATYP      IFEQ 'R'                                       094753
     C                     MOVEL@TTYP2    TRAT
     C                     END                                            094753
      *
     C                     ELSE
      *
     C                     END
      *
      ** If function code is fx(0ji)
      **                  or tc(0jx, 0jx)                                 CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
      *
     C                     Z-ADDAMT2      PSTA
      *
     C                     ELSE
      *
     C                     Z-ADDAMT1      PSTA
      *
     C                     END
      *                                                                                       CGL020
      ** Initialise fee detail fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE ' '       FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
      ** If function code is one of the foll.- move 1 to dr/cr
     C           FNCD      IFEQ '00O'
     C           FNCD      OREQ '00L'
     C           FNCD      OREQ '00W'                                     CRT002
     C           FNCD      OREQ '0JO'
     C           FNCD      OREQ '0JL'
     C           FNCD      OREQ '0JW'                                     CRT002
     C           FNCD      OREQ '00A'
     C           FNCD      OREQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
     C           FNCD      OREQ '0JA'
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
     C           FNCD      OREQ '0JE'
      *
     C                     Z-ADD1         DRCR
      *
     C                     ELSE
      *
      ** If function code is 00i -
     C           FNCD      IFEQ '00I'
      *
      ** Move dr/cr.ind opposite to dcin of trans.type 1
     C           @DCIN1    IFEQ 'D'
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
      *
     C                     ELSE
      *
     C                     Z-ADD0         DRCR
      *
     C                     END
      *
     C                     END
      *
      ** If function code is treasury in/out or ret.trf (0je,0jf,0ja)
     C           FNCD      IFEQ '0JE'
     C           FNCD      OREQ '0JF'
      *
     C                     MOVEL@TTNM2    PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
      *
     C                     ELSE
      *
      ** If function code is 00a
     C           FNCD      IFEQ '00A'
      *
      ** If trans.narration is non-blanks, move it to the narrative fld
     C           TTNR      IFNE *BLANKS
      *
     C                     MOVELTTNR      PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
      *
     C                     ELSE
      *
     C                     EXSR GETNAR                                    093749
     C           DRCR      IFEQ 0                                         093749
     C           TTNARR    ANDNE*BLANKS                                   093749
     C                     MOVELTTNARR    PNAR                            093749
      *                                                                   093749
     C                     ELSE                                           093749
      *                                                                   093749
     C           DRCR      IFEQ 1                                         093749
     C           TTNAR2    ANDNE*BLANKS                                   093749
     C                     MOVELTTNAR2    PNAR                            093749
      *                                                                   093749
     C                     ELSE                                           093749
      *                                                                   093749
     C                     MOVEL@TTNM2    PNAR
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     EXSR SETNAR                                                      MD054623
     C                     ENDIF                                                            MD054623
      *
     C                     END
     C                     END                                            093749
     C                     END                                            093749
      *
     C                     ELSE
      *
      ** If function code is 0ji
      **                  or 0js, 0jx                                     CRT002
      *                                                                   CRT002
     C           FNCD      IFEQ '0JI'
     C           FNCD      OREQ '0JS'                                     CRT002
     C           FNCD      OREQ '0JX'                                     CRT002
      *
     C                     MOVE *BLANK    @N3115
     C                     MOVE *BLANK    @N3215
     C                     MOVEL@NA115    @N3115
     C                     MOVEL' SELL  ' @N3218
     C/COPY WNCPYSRC,RE4201C024
     C                     MOVEL@NA3DS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C                     MOVE 'GB00940' ##MGID                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C                     MOVE *BLANKS   @N3268
      *
     C                     ELSE
      *
      ** Get trans.narration from TTNARPD?
     C           FNCD      IFEQ '0JA'
     C           FNCD      OREQ '0JT'
     C           FNCD      OREQ '00X'                                     CRT002
     C           FNCD      OREQ '0JV'
     C           FNCD      OREQ '00S'                                     CRT002
     C           FNCD      OREQ '00E'
     C           FNCD      OREQ '00F'
     C           FNCD      OREQ '00H'                                                       MD054623
     C           FNCD      OREQ '0JH'                                                       MD054623
     C           FNCD      OREQ '00K'                                                       MD054623
     C           FNCD      OREQ '0JK'                                                       MD054623
     C           FNCD      OREQ '00L'                                                       MD054623
     C           FNCD      OREQ '0JL'                                                       MD054623
     C           FNCD      OREQ '00N'
     C           FNCD      OREQ '0JN'                                                       MD054623
     C           FNCD      OREQ '00O'                                                       MD054623
     C           FNCD      OREQ '0JO'                                                       MD054623
     C           FNCD      OREQ '00P'                                                       MD054623
     C           FNCD      OREQ '0JP'                                                       MD054623
     C           FNCD      OREQ '00Q'                                                       MD054623
     C           FNCD      OREQ '0JQ'                                                       MD054623
     C           FNCD      OREQ '0JR'                                                       MD054623
     C                     EXSR GETNAR
     C           TTNARR    IFNE *BLANKS
     C                     MOVE TTNARR    PNAR
     C                     ELSE
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C                     END
     C           CHECKL    IFEQ *BLANKS
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C                     ENDIF
     C                     ELSE
      *
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP8                                           S01408
     C*                                                                   S01408
     C                     MOVEL'P'       RECI
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
      ** Store dr/cr indicator required for interbranch posting
     C                     Z-ADDDRCR      @INTDC  10
      *
      ** For retail transfer
     C           FNCD      IFEQ '00A'
      *
      ** Store details required for interbranch posting
      *
      ** Setup flag to indicate that second posting has been done
     C                     Z-ADD1         @PST2   10
      *
     C**********           Z-ADDCNUM      @PNUM2                                              CSD027
     C                     MOVE CNUM      @PNUM2                                              CSD027
     C                     MOVELCCY       @PCCY2
     C                     MOVE ACOD      @PACD2
     C                     Z-ADDACSQ      @PASQ2
     C                     Z-ADDVALD      @PVLD2
     C                     MOVELTRAT      @PTRT2
     C                     MOVE *BLANK    @PNAR2
     C                     MOVELPNAR      @PNAR2
     C                     Z-ADDPSTA      @PPSA2
     C                     Z-ADDDRCR      @PDC2
     C                     MOVELSPOS      @PPOS2
     C                     MOVE BRCA      @PBCA2
     C                     Z-ADDRIND      @PRND2
     C                     MOVELATYP      @PTYP2
     C                     MOVELSTYP      @PSTP2
     C                     MOVELPRIN      @PIND2
     C                     MOVELGETP      @PGTP2
     C                     MOVELPBTT      @PPBT2
     C                     MOVELORBR      @PORB2
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            MOV003 - Move values for generating entry-3        *
      *                                                               *
      *            Generate second entry to customer a/c for function *
      *            codes that involve two amounts                     *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  GEN0HP - Generate entries for fn.code '00H' '00P'  *
      *            GENJHP - Generate entries for fn.code '0JH' '0JP'  *
      *            GEN00I - Generate entries for fn.code '00I'        *
      *                                                               *
      *****************************************************************
     C           MOV003    BEGSR                           ** MOV003 **
      *                                                                                       CGL020
      ** Initialise fee detail fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE ' '       FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
     C                     MOVE @BRCA1    BRCA                                               BUG8080
     C                     MOVE *BLANK    PNAR
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDVLDT      VALD
     C                     MOVEL@TTYP2    TRAT
     C                     MOVEL@PBPT2    PBTT
     C                     Z-ADDAMT2      ORAMT
      *                                                                   142084
      ** For cheque deposit do not output cheque no. to posting.          142084
     C           FNCD      IFEQ '00H'                                     142084
     C           FNCD      OREQ '00P'                                     142084
     C           FNCD      OREQ '0JH'                                     142084
     C           FNCD      OREQ '0JP'                                     142084
     C                     Z-ADD*ZEROS    CHQN                            142084
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           CQNF      ANDNE*BLANKS                                                       CRE019
     C           FNCD      IFEQ '00P'                                                         CRE019
     C           FNCD      OREQ '0JP'                                                         CRE019
     C                     MOVELCQNF      CHQN                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     ELSE                                           142084
     C                     MOVE CQNF      CHQN
     C                     ENDIF                                          142084
      *
      ** If function code is 00I
     C           FNCD      IFEQ '00I'
      *
      ** Move dr/cr.ind according to dcin of trans.type 2
     C           @DCIN2    IFEQ 'D'
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
      *
     C                     ELSE
      *
     C                     Z-ADD1         DRCR
      *
     C                     END
      *
      ** If function code is 0jh,0jp
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
      *
     C                     Z-ADDCVAM2     PSTA
     C                     MOVELCCY1      TRCCY
      *
     C                     ELSE
      *
     C                     Z-ADDAMT2      PSTA
     C                     MOVELCCY1      TRCCY
      *
     C                     END
      *
      ** If charge exists subtract from posting amount
      ** - If 0JH or 0JP subtract cheque amount only
     C           *IN55     IFEQ '0'
      *
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
     C           FNCD      OREQ '00H'
     C           FNCD      OREQ '00P'
      *                                                                                       CGL020
      ** Set Fee details                                                                      CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'N'       FEEFLG                                              CGL020
     C                     Z-ADD@CHCHG    FEEVAL                                              CGL020
     C           @CHCHG    DIV  PSTA      WFEPCT                                              CGL020
     C           WFEPCT    MULT 100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     SUB  @CHCHG    PSTA
     C                     END
      *
     C                     END
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           CCY1      ANDEQCCY2                                                          CGL020
     C           FNCD      IFEQ '0JI'                                                         CGL020
     C           FNCD      OREQ '0JS'                                                         CGL020
     C           FNCD      OREQ '0JX'                                                         CGL020
      *                                                                                       CGL020
      ** Set Fee details                                                                      CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       FEEFLG                                              CGL020
     C                     Z-ADDAMT3      FEEVAL                                              CGL020
     C           AMT3      DIV  WAAMT2    WFEPCT                                              CGL020
     C           WFEPCT    MULT 100       FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
     C                     ENDIF                                                              CGL020
      *
      *
      ** If function code is 0jh,0jp
     C           FNCD      IFEQ '0JH'
     C           FNCD      OREQ '0JP'
      *
      ** Edit the amount field - for narrative
     C                     MOVE 'J'       ZECODE
     C                     MOVE *BLANKS   ZFLD15
     C**********           MOVE CVAM2     ZFLD15                                             BUG7675
     C                     MOVE AMT2      ZFLD15                                             BUG7675
     C                     EXSR ZFRPED
     C                     MOVE *BLANKS   @NAMT2
     C                     MOVE ZOUT22    @NAMT2
      *
     C                     MOVE *BLANK    @NAR19
     C                     MOVE *BLANK    @NA133
     C                     MOVEL'CHEQ_DEP'@NAR19
     C/COPY WNCPYSRC,RE4201C025
     C                     MOVE '_'       @NAR19
     C                     MOVE '_'       @NA133
     C                     MOVEL@NA2DS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVE TRCCY     MNCYCD                          109175
     C                     MOVEL@NAMT2    MNOAMT                          109175
     C                     MOVE 'GB00920' ##MGID                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
      *
     C                     ELSE
      *
     C                     MOVEL@TTNM2    PNAR
     C           FNCD      IFEQ '00H'                                                        BUG9062
     C           CQNF      ANDNE*BLANKS                                                      BUG9062
     C           FNCD      OREQ '00P'                                                        BUG9062
     C           CQNF      ANDNE*BLANKS                                                      BUG9062
     C                     MOVE *BLANKS   WRK10                                             MD055860
     C                     MOVE WRK10     PNAR                                              MD055860
     C                     MOVE CQNF      PNAR                                               BUG9062
     C                     ENDIF                                                             BUG9062
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     MOVELTTNARR    PNAR                                              MD054623
     C                     ENDIF                                                            MD054623
      *
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CCP9                                           S01408
     C*                                                                   S01408
      *
     C                     MOVEL'P'       RECI
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
      ** Store details required for interbranch posting
      *
      ** Setup flag to indicate that second posting has been done
     C                     Z-ADD1         @PST2   10
      *
     C**********           Z-ADDCNUM      @PNUM2                                              CSD027
     C                     MOVE CNUM      @PNUM2                                              CSD027
     C                     MOVELCCY       @PCCY2
     C                     MOVE ACOD      @PACD2
     C                     Z-ADDACSQ      @PASQ2
     C                     Z-ADDVALD      @PVLD2
     C                     MOVELTRAT      @PTRT2
     C                     MOVE *BLANK    @PNAR2
     C                     MOVELPNAR      @PNAR2
     C                     Z-ADDPSTA      @PPSA2
     C                     Z-ADDDRCR      @PDC2
     C                     MOVELSPOS      @PPOS2
     C                     MOVE BRCA      @PBCA2
     C                     Z-ADDRIND      @PRND2
     C                     MOVELATYP      @PTYP2
     C                     MOVELSTYP      @PSTP2
     C                     MOVELPRIN      @PIND2
     C                     MOVELGETP      @PGTP2
     C                     MOVELPBTT      @PPBT2
     C                     MOVELORBR      @PORB2
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            MOV004 - Move values for generating entry-4        *
      *                                                               *
      *            Generate contra entry for second customer a/c entry*
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  GEN0HP - Generate entries for fn.code '00H' '00P'  *
      *            GENJHP - Generate entries for fn.code '0JH' '0JP'  *
      *            GEN00I - Generate entries for fn.code '00I'        *
      *                                                               *
      *****************************************************************
     C           MOV004    BEGSR                           ** MOV004 **
      *
     C                     MOVE *BLANK    PNAR
     C                     MOVE *BLANKS   STYP
     C                     MOVE *BLANKS   PBTT
      *                                                                                       CGL020
      ** Initialise fee detail fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE ' '       FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CAC002
      **  Assign teller profit centre if anal acctg is available          CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FSTEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   107926
      **  If associated GL account code is zero, post against suspense.   107926
      *                                                                   107926
     C           @ASGL2    IFNE *ZEROS                                    107926
      *
      ** Move fields to klist
     C**********           Z-ADD@TICN     @CNUM                                               CSD027
     C                     MOVE @TICN     @CNUM                                               CSD027
     C                     MOVELCCY1      @CCY
     C                     Z-ADD1         @ACSQ
     C                     Z-ADD@ASGL2    @ACOD
     C                     MOVE @AGLT2    ATYP
     C                     MOVE ITLB      @BRCA
      *
      ** Check whether a/c is a valid record in lf/accnt
     C           KLACNT    CHAINACCNTABF             70
      *
      ** If no valid record and  a/c type 'R'- suspense a/c
     C           *IN70     IFEQ '1'
     C           ATYP      ANDEQ'R'                                       139524
     C***********ATYP      ANDEQ'R'                                       107926
     C                     MOVE @CSAC     @ACOD
     C                     MOVE @CSAT     ATYP
      *                                                                   CAC002
      **  Assign primary funding prft cntr if anal acctg is available     CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     END
      *
     C                     ELSE                                           107926
      *                                                                   107926
     C                     MOVELA8BICN    @CNUM                           107926
     C                     MOVELCCY1      @CCY                            107926
     C                     MOVEL@CSAC     @ACOD                           107926
     C                     MOVEL'01'      @ACSQ                           107926
      *                                                                   107926
     C                     ENDIF                                          107926
      *                                                                   107926
     C**********           Z-ADD@CNUM     CNUM                                                CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY
     C                     MOVE @ACOD     ACOD
     C                     Z-ADD@ACSQ     ACSQ
      *
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
      *
     C                     Z-ADDTBTN      @TTRNO
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CP10                                           S01408
     C*                                                                   S01408
      *
     C                     Z-ADDAMT2      PSTA
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVEL'  GE-TT' SPOS
     C                     MOVE ITLB      BRCA
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
      *
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     Z-ADDACACNO    ACNO
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           KLACNT    CHAINACCNTABF             70                   CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     Z-ADD0         ACNO
     C                     MOVE *BLANKS   TRAT
     C                     END
      *
     C                     Z-ADD0         REJC
     C                     MOVELDEPC      DPMT
     C                     Z-ADD0         RRNM
      *                                                                   109102
      *  Don't blank Teller input details if this is an RE Transfer.      109102
     C           FNCD      IFNE '00A'                                     109102
     C                     MOVE *BLANKS   TLIN
     C                     MOVE *BLANKS   TRCCY
     C                     END                                            109102
      *                                                                   109102
     C                     MOVEL'N'       GETP
     C                     Z-ADD0         ACUM
     C                     MOVE ITLB      ORBR
     C                     Z-ADD0         ORAMT
      *
      ** If function code is crdchg (00i)
     C           FNCD      IFEQ '00I'
      *
      ** Move dr/cr.ind opposite to dcin of trans.type 2
     C           @DCIN2    IFEQ 'D'
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
      *
     C                     ELSE
      *
     C                     Z-ADD0         DRCR
      *
     C                     END
      *
     C                     MOVEL'P'       RECI
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
     C/COPY WNCPYSRC,RE4201C012
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            CHARGE - Generate charge entry                     *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  All GENXXX with transaction charges (except 0JI)   *
      *                                                               *
      *****************************************************************
     C           CHARGE    BEGSR                           ** CHARGE **
      *
     C                     Z-ADD0         ORAMT
     C                     Z-ADDAMT3      PSTA
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * posting amount is amount from Post Multiple Charges Sub Routine.                      CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     Z-ADDWCAMT     PSTA                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     MOVE CCY3      CCY
     C                     MOVE *BLANKS   CHQN
     C                     MOVE *BLANKS   TRCCY
     C                     MOVELTTP3      TRAT
     C                     Z-ADD1         DRCR
      *                                                                   CAC002
      **  Assign teller profit centre if anal acctg is available          CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FSTEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *
      ** get details for charge transaction type
      *
     C*
     C                     MOVE TTP3      @TTP3
      * If CRT012 is On then                                                                  CRT012
      * bypass call to AORETRR0 as charge account Has already been                            CRT012
      * ascertained                                                                           CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     ELSE                                                               CRT012
     C                     MOVE TTP3      @TTP3
     C                     CALL 'AORETRR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @TTP3
     C           SDRETR    PARM SDRETR    DSFDY
      *
      ** If record does not exist -
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDRETRPD'DBFILE           ***************
     C                     Z-ADD23        DBASE            ** DB ERR 23 *
     C                     MOVEL@TTP3     DBKEY            ***************
     C                     EXSR DBERR
     C                     END
     C                     ENDIF                                                              CRT012
      *
      ** Get a/c details
      ** - save accnt key first
     C                     MOVE @CNUM     @@CNUM
     C                     MOVE @CCY      @@CCY
     C                     MOVE @ACOD     @@ACOD
     C                     MOVE @ACSQ     @@ACSQ
     C                     MOVE @BRCA     @@BRCA
      *
     C                     MOVE CNUM      @CNUM
     C                     MOVE CCY       @CCY
     C           A1ASGL    IFNE *BLANKS                                   107926
     C                     MOVE A1ASGL    @ACOD
     C                     ELSE                                           107926
     C                     MOVE @CSAC     @ACOD                           107926
     C                     ENDIF                                          107926
      *                                                                                       CRT012
      * If CRT012 is On then                                                                  CRT012
      * account code is account from Post Multiple Charges Sub Routine                        CRT012
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     MOVE WCACOD    @ACOD                                               CRT012
     C                     ENDIF                                                              CRT012
     C                     MOVE ACSQ      @ACSQ
     C                     MOVE BRCA      @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
      ** If record exists,  move details into relevant fields
      *
     C                     MOVE 'P'       RECI                                                CRT012
     C           *IN70     IFEQ '0'
      *
     C                     MOVE 'P'       RECI
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
      *                                                                   CAC002
      **  Assign account profit centre if anal acctg is available         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE ACPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     END
      *
     C                     MOVE ACNO      @ACNOS 100
     C                     MOVE ACACNO    ACNO
     C                     END
      *
     C                     MOVELA1PASB    PBTT
     C           A1ASGL    IFNE *BLANKS                                   107926
     C                     MOVE A1ASGL    ACOD
     C                     ELSE                                           107926
     C                     MOVE @CSAC     ACOD                            107926
     C                     ENDIF                                          107926
     C           CRT012    IFEQ 'Y'                                                           CRT012
     C                     ELSE                                                               CRT012
     C                     MOVE *BLANKS   PNAR
     C                     MOVEL@NA115    PNAR
     C                     ENDIF                                                              CRT012
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CP11                                           S01408
     C*                                                                   S01408
      *
     C           *INU1     IFEQ '0'
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
     C*                                                                   163729
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
      * Save current narrative and Account Code                                               CRT012
     C                     MOVELPNAR      WPNAR  30                                           CRT012
     C**********           MOVELACOD      WWACOD  4                                    CRT012 CGL029
     C                     MOVELACOD      WWACOD                                              CGL029
      *                                                                                       CRT012
      * See if a record exists on SDBACTPD, if so obtain narrative                            CRT012
      * if narrative code has been entered.                                                   CRT012
     C                     MOVELCODE      K1CODE                                              CRT012
     C                     MOVELCTRT      K1CTRT                                              CRT012
     C                     MOVELITLB      K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             85                                       CRT012
      *                                                                                       CRT012
     C           *IN85     IFEQ *ON                                                           CRT012
      *                                                                                       CRT012
     C                     MOVE *BLANKS   K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             85                                       CRT012
     C           *IN85     IFEQ *ON                                                           CRT012
      *                                                                                       CRT012
     C                     MOVELITLB      K1BRCH                                              CRT012
     C                     MOVE *BLANKS   K1CTRT                                              CRT012
     C           KCCTT     CHAINSDBACTL0             85                                       CRT012
     C           *IN85     IFEQ *ON                                                           CRT012
      *                                                                                       CRT012
     C                     MOVE *BLANKS   K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             85                                       CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           *IN85     IFEQ *OFF                                                          CRT012
     C           CCNARR    ANDNE*BLANKS                                                       CRT012
     C                     CALL 'AONARRR0'                                                    CRT012
     C                     PARM           @RTCD                                               CRT012
     C                     PARM '*KEY'    @OPTN                                               CRT012
     C                     PARM           CCNARR                                              CRT012
     C           SDNARR    PARM SDNARR    DSFDY                                               CRT012
      *                                                                                       CRT012
      * Set up narrative                                                                      CRT012
     C           @RTCD     IFEQ *BLANKS                                                       CRT012
     C                     MOVELTBID      PN1                                                 CRT012
     C                     MOVE '/'       PN4                                                 CRT012
     C                     MOVELTBTN      PN5                                                 CRT012
     C                     MOVELALDON     PN11                                                CRT012
     C                     MOVELPN        PNAR                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
     C                     WRITEAPOSTPDF
     C                     MOVELWPNAR     PNAR                                                CRT012
     C                     MOVELWWACOD    ACOD                                                CRT012
     C                     END
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                     BUG27119
     C                     MOVE @ACNOS    ACNO
      *
      ** Chain back to last accnt record
      *
     C                     MOVE @@CNUM    @CNUM
     C                     MOVE @@CCY     @CCY
     C                     MOVE @@ACOD    @ACOD
     C                     MOVE @@ACSQ    @ACSQ
     C                     MOVE @@BRCA    @BRCA
     C           KLACNT    CHAINACCNTABF             70
      *
      ** Perform hash totals on the charge posting amount
     C                     EXSR HSHTOT
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GETNAR - Get narrative from TTNARPD file           *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  GEN0JA - Generate entries for fn.code '0JA'        *
      *            GEN0JT - Generate entries for fn.code '0JT'        *
      *                                                  '00X'        *   CRT002
      *            GEN0JV - Generate entries for fn.code '0JV'        *
      *                                                  '00S'        *   CRT002
      *            GEN00E - Generate entries for fn.code '00E'        *
      *            GEN00F - Generate entries for fn.code '00F'        *
      *                                                               *
      *****************************************************************
     C           GETNAR    BEGSR                           ** GETNAR **
      *
      ** Read Teller Narratives file for teller/transaction
     C           KNARR     KLIST
     C                     KFLD           TBID
     C                     KFLD           TBTN
      *
     C           KNARR     CHAINTTNARL0              70
      ** If record does not exist -
     C           *IN70     IFEQ '1'
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C           TTNARR    CAT  @TTNM2:1  TTNAR2                                            MD054623
     C           TTNARR    CAT  @TTNM1:1  TTNARR                                            MD054623
     C                     ENDIF                                                            MD054623
     C           *LOCK     IN   LDA
     C                     MOVEL'TTNAR'   DBFILE           ***************
     C                     MOVEL'22'      DBASE            ** DB ERR 22 *
     C                     MOVE TBID      @TBID            ***************
     C                     MOVELTTNARK    DBKEY
     C                     EXSR DBERR
     C                     ELSE
     C           FNCD      IFEQ '00N'
     C           FNCD      OREQ '0JT'                                     094753
     C           FNCD      OREQ '0JV'                                     094753
     C           RTSNAR    OREQ 'Y'                                                         MD054623
     C                     CLEARCHECKL
     C                     MOVE TTNARR    CHECKL 20
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C                     MOVELTTNARR    CHECKL                                            MD054623
     C                     ENDIF                                                            MD054623
     C                     ENDIF
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT                                                                                MD054623
      *****************************************************************                     MD054623
      *                                                               *                     MD054623
      *            SETNAR - SETS UP THE NARRATIVE STRUCTURE           *                     MD054623
      *                                                               *                     MD054623
      *****************************************************************                     MD054623
     C           SETNAR    BEGSR                           ** SETNAR **                     MD054623
      *                                                                                     MD054623
     C                     MOVELPNAR      PNAR                                              MD054623
     C                     MOVE *BLANKS   WNAR   30                                         MD054623
      *                                                                                     MD054623
     C                     MOVELTBTN      WNAR                                              MD054623
     C           WNAR      CAT  '/':0     WNAR                                              MD054623
     C           WNAR      CAT  TBID:0    WNAR                                              MD054623
     C           WNAR      CAT  PNAR:1    WNAR                                              MD054623
     C                     MOVELWNAR      PNAR                                              MD054623
      *                                                                                     MD054623
     C                     ENDSR                           ** ENDNAR **                     MD054623
      *****************************************************************                     MD054623
      /EJECT
      *****************************************************************
      *                                                               *
      *            MOVEXC - Move values for exchange transactions     *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  PROEXC - Process exchange transactions             *
      *                                                               *
      *****************************************************************
     C           MOVEXC    BEGSR                           ** MOVEXC **
      *                                                                                       CGL020
      ** Initialise fee detail fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE ' '       FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
     C                     MOVEL'P'       RECI
      *
     C**********           Z-ADD@TICN     CNUM                                                CSD027
     C                     MOVE @TICN     CNUM                                                CSD027
     C                     MOVE @STRAC    ACOD
     C                     Z-ADD1         ACSQ
     C                     MOVE @STRAT    ATYP
     C                     MOVE *BLANK    STYP
      *
     C                     Z-ADD0         ACNO
     C                     Z-ADDBJRDNB    PSTD
     C                     Z-ADDBJRDNB    VALD
     C                     MOVE *BLANKS   TRAT
      *
     C                     Z-ADDTBTN      @TTRNO
     C                     MOVE *BLANK    PNAR
     C                     MOVEL@NARDS    PNAR
      ** Translate narrative if required                                  109175
     C           REPNAR    IFEQ 'Y'                                       109175
     C                     CLEARCGPNAR                                    109175
     C                     MOVEL@NA715    MNTRNO                          109175
     C           TRACNO    IFEQ 0                                         109175
     C                     MOVE 'GB00880' ##MGID                          109175
     C                     ELSE                                           109175
     C                     MOVE TRACNO    MNRACN                          109175
     C                     MOVE 'GB00881' ##MGID                          109175
     C                     END                                            109175
     C                     EXSR SRPNAR                                    109175
     C                     END                                            109175
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CP12                                           S01408
     C*                                                                   S01408
      *
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVEL'  GE-TT' SPOS
     C                     MOVE ITLB      BRCA
     C                     Z-ADD235959    PTIM                            164970
     C                     Z-ADD0         VOIN                            153249
      *
     C                     Z-ADD0         REJC
     C                     MOVE *BLANKS   DPMT
     C                     Z-ADD0         RRNM
     C                     MOVE *BLANKS   TLIN
     C                     MOVE *BLANKS   TRCCY
     C                     BITOF'01234567'PRIN
     C                     MOVEL'N'       GETP
     C                     Z-ADD0         ACUM
     C                     MOVE *BLANKS   PBTT
     C                     MOVE ITLB      ORBR
     C                     Z-ADD0         ORAMT
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *
     C/COPY WNCPYSRC,RE4201C013
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            MOVITB - Move values for interbranch posting       *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  TITBEN - Teller interbranch entry                  *
      *                                                               *
      *****************************************************************
     C           MOVITB    BEGSR                           ** MOVITB **
      *                                                                                       CGL020
      ** Initialise fee detail fields                                                         CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE ' '       FEEFLG                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
     C                     MOVEL'P'       RECI
     C                     Z-ADDTRACNO    ACNO
     C                     Z-ADDBJRDNB    PSTD
     C                     MOVELTBID      TELI
     C                     Z-ADDTBTN      TREFN
      *
      ** Move values depending on first posting or second
      *
      ** If posting for second a/c
     C           @VAL2     IFEQ 1
      *
     C**********           Z-ADD@PNUM2    CNUM                                                CSD027
     C                     MOVE @PNUM2    CNUM                                                CSD027
     C                     MOVEL@PCCY2    CCY
     C                     MOVE @PACD2    ACOD
     C                     Z-ADD@PASQ2    ACSQ
     C                     Z-ADD@PVLD2    VALD
     C                     MOVEL@PTRT2    TRAT
     C                     MOVEL@PNAR2    PNAR
     C*                                                                   S01408
     C/COPY WNCPYSRC,RE4201CP13                                           S01408
     C*                                                                   S01408
     C                     Z-ADD@PPSA2    PSTA
     C                     Z-ADD@PDC2     DRCR
     C                     MOVEL@PPOS2    SPOS
     C                     MOVE @PBCA2    BRCA
     C                     Z-ADD@PRND2    RIND
     C                     MOVEL@PTYP2    ATYP
     C                     MOVEL@PSTP2    STYP
     C                     MOVEL@PIND2    PRIN
     C                     MOVEL@PGTP2    GETP
     C                     MOVEL@PPBT2    PBTT
     C                     MOVEL@PORB2    ORBR
      *
      ** If function code is retail a/c (00a)
     C           FNCD      IFEQ '00A'
     C                     MOVELTRACNO    ORAN
     C                     ELSE
     C                     MOVEL*BLANKS   ORAN
     C                     END
      *
     C                     ELSE
      *
     C**********           Z-ADD@PNUM1    CNUM                                                CSD027
     C                     MOVE @PNUM1    CNUM                                                CSD027
     C                     MOVEL@PCCY1    CCY
     C                     MOVE @PACD1    ACOD
     C                     Z-ADD@PASQ1    ACSQ
     C                     Z-ADD@PVLD1    VALD
     C                     MOVEL@PTRT1    TRAT
     C                     MOVEL@PNAR1    PNAR
     C                     Z-ADD@PPSA1    PSTA
     C                     Z-ADD@PDC1     DRCR
     C                     MOVEL@PPOS1    SPOS
     C                     MOVE @PBCA1    BRCA
     C                     Z-ADD@PRND1    RIND
     C                     MOVEL@PTYP1    ATYP
     C                     MOVEL@PSTP1    STYP
     C                     MOVEL@PIND1    PRIN
     C                     MOVEL@PGTP1    GETP
     C                     MOVEL@PPBT1    PBTT
     C                     MOVEL@PORB1    ORBR
      *
      ** If function code is retail a/c (00a)
     C           FNCD      IFEQ '00A'
     C                     MOVELTTAC      ORAN
     C                     ELSE
     C                     MOVEL*BLANKS   ORAN
     C                     END
      *
     C                     END
      *
     C/COPY WNCPYSRC,RE4201C014
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SETPSI - Setup posting indicator                   *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  GEN00N -                                           *
      *                                                               *
      *****************************************************************
     C           SETPSI    BEGSR                           ** SETPSI **
      *
      ** Setof all bits of posting indicator
     C                     BITOF'01234567'PRIN
      *
      ** If customer originated indicator is 'Y'
     C           @COIN     IFEQ 'Y'
     C                     BITON'0'       PRIN
     C                     END
      *
      ** If account sub-type is 'S' (savings a/c)
     C           @STYP     IFEQ 'S'
      *
      ** Setup key to access shadow posting record off lf/ttacmtl1
     C                     MOVE TBTN      @TBTN   5
     C                     MOVE *BLANKS   KTBTN
     C                     MOVE @TBTN     KTBTN
     C                     MOVELTBID      KTBID
      *
      ** Access shadow posting record off lf/ttacmtl1
     C           FNCD      IFEQ '00A'
     C           *IN50     ANDEQ'1'
     C*
     C** Move key fields
     C                     MOVE KTBID     KTBI1
     C                     MOVE KTBTN     KTBT1
     C                     Z-ADD1         KDORC
     C           KLTAC1    CHAINTTACMTL1             70
     C                     ELSE
     C           KLTACM    CHAINTTACMTL1             70
     C                     END
     C*
     C           *IN70     IFEQ '0'
      *
     C           APBI      IFEQ 'Y'
     C                     BITON'3'       PRIN
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            LAST   - Final Processing                          *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  Main   - Control Process                           *
      *            SCRINP - Detail screen input                       *
      *            TRNOVR - Transaction override process              *
      *                                                               *
      *****************************************************************
     C           LAST      BEGSR                           ** LAST   **
      *
      ** Compare trans.processed count and tran.on file count -
      ** Seton U8 and 68 if different
     C           @TPCNT    COMP @NRECF               6868
     C           *IN68     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'TTRANL2' DBFILE
     C                     MOVEL@PGM      DBPGM
     C                     OUT  LDA
     C                     SETON                     U8
     C                     END
      *
      ** Move hash totals from array to work fields for printing
     C                     Z-ADDINT,1     @VTTIB
     C                     Z-ADDINT,1     @PTTIB
     C                     Z-ADDDEC,1     @VTIDD
     C                     Z-ADDDEC,1     @PTIDD
     C                     Z-ADDINT,2     @VGETD
     C                     Z-ADDINT,2     @PGETD
     C                     Z-ADDDEC,2     @PGEDD
     C                     Z-ADDINT,3     @VGETC
     C                     Z-ADDINT,3     @PGETC
     C                     Z-ADDDEC,3     @PGECD
      *
      ** Compare value of debits & credits generated -
      ** Seton 67 if different
     C           @VGETD    COMP @VGETC               6767
     C  N67      @PGEDD    COMP @PGECD               6767
     C           *IN67     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'TTRANL2' DBFILE
     C                     MOVEL@PGM      DBPGM
     C                     OUT  LDA
     C                     SETON                     U8
     C                     END
      *
      ** Add debit and credit hash totals to get gett total
     C           @VGETD    ADD  @VGETC    @VGETT
     C           DEC,2     ADD  DEC,3     @VGEDD
     C**
      ** Include overflow digit from @VGEDD (if any)
     C                     ADD  @VGED1    @VGETT
      *
      ** Add 1 to output rec.count for files gettpd & ttibpd
     C                     ADD  1         @GECNT
     C                     ADD  1         @TICNT
      *
      ** Write trailer records for pf/gettpz & pf/ttibpz
     C                     EXSR WRTRL
      *
      ** Write printer record for file controls
     C                     WRITEAUDREC
      *
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU013    ANDEQ'Y'                                       CEU024
     C           *INU1     ANDEQ'0'                                       CEU024
     C           CEU025    OREQ 'Y'                                       CEU025
     C           CEU013    ANDEQ'Y'                                       CEU025
     C           *INU1     ANDEQ'0'                                       CEU025
     C                     MOVE '001'     GLNARI                          CEU024
     C                     Z-ADDWNARN     GLNARN                          CEU024
     C           *IN88     IFEQ *ON                                       CEU024
     C                     WRITEGLAPNAPF                                  CEU024
     C                     ELSE                                           CEU024
     C                     UPDATGLAPNAPF                                  CEU024
     C                     ENDIF                                          CEU024
     C                     COMIT                                          CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CEU024
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            WRTRL  - Write trailer records                     *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  LAST   - Final processing                          *
      *                                                               *
      *****************************************************************
     C           WRTRL     BEGSR                           ** WRTRL  **
      *
      ** Write generated trailer record (pf/gettpz)
     C                     MOVEL'T'       RECI
     C                     Z-ADD@GECNT    NORE1
     C                     Z-ADD@VGETT    HRWN
     C                     Z-ADD@VGEDD    HRDC
     C           *INU1     IFEQ '0'
     C                     WRITEAPOSTZZF
     C                     END
      *
      ** Write interbranch trailer record (pf/ttibpz)
     C                     MOVEL'T'       RECI
     C                     Z-ADD@TICNT    NORE
     C                     Z-ADD@VTTIB    HRWN
     C                     Z-ADD@VTIDD    HRDC
     C           *INU1     IFEQ '0'
     C                     WRITETTIBPZF
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            *PSSR  - Program error                             *
      *                                                               *
      * CALLS -                                                       *
      *                                                               *
      * CALLED BY                                                     *
      *                                                               *
      *****************************************************************
     C           *PSSR     BEGSR                           ** *PSSR  **
      *
      ** Transaction failed.  Re-input necessary.
     C                     DUMP
     C                     CLOSE*ALL
     C**********           SETON                     LR                                     MD055557
     C                     SETON                     U7U8LR                                 MD055557
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GETACT - Get account type                          *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  FIRST  - Initial Processing                        *
      *****************************************************************
     C           GETACT    BEGSR                           ** GETACT **
      *
     C*
     C                     CALL 'AOACODR0'
     C                     PARM '*BLANK ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C**********           PARM @ACD      @ACCD   4                                           CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C                     PARM @ACD      @ACCD  10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *
      ** If record not found
      ** Set account code to zero - suspense a/c                          139524
     C           @RTCD     IFNE *BLANK
     C                     MOVEL*BLANKS   @ACD                            139524
     C********** *LOCK     IN   LDA                                       139524
     C**********           MOVEL'SDACODPD'DBFILE           ************** 139524
     C**********           Z-ADD4         DBASE            ** DB ERR 04 **139524
     C**********           MOVEL@ACD      DBKEY            ***************139524
     C**********           EXSR DBERR                                     139524
     C                     END
      *
      ** Retrieve a/c type
     C                     MOVELA5ACTY    @ACT    1
      ** Retrieve a/c section to work field                               153249
     C                     MOVELA5ACSC    W#ACSC  2                       153249
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            GETACD - Get account details                       *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  PRODET - Process details                           *
      *****************************************************************
     C           GETACD    BEGSR                           ** GETACD **
      *
     C           @ACNO     CHAINACNUMABF             70
      *
      ** If record not found
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'ACNUM   'DBFILE           ***************
     C                     Z-ADD9         DBASE            ** DB ERR 09 **
     C                     MOVEL@ACNO     DBKEY            ***************
     C                     EXSR DBERR
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *                                                               *
      *            SETCSH - Setup cash account code                   *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  SETTTY - Set up transaction type details           *
      *                                                               *
      *****************************************************************
     C           SETCSH    BEGSR                           ** SETCSH **
      *
      ** Look up array to check whether curr.details exists in the arr.
     C                     Z-ADD1         X       30
     C***********CCY1      LOKUPCYCD,X                   69               151095
     C           WKCCY     LOKUPCYCD,X                   69               151095
      *
      ** If element is not found get details from currencies extension
      ** file and store in first empty space
     C           *IN69     IFEQ '0'
     C                     CALL 'AOCURRR0'
     C***********          PARM '*BLANK ' @RTCD   7                       CEU024
     C                     PARM *BLANK    @RTCD                           CEU024
     C                     PARM '*KEY   ' @OPTN   7
     C***********          PARM           CCY1                            151095
     C                     PARM           WKCCY                           151095
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** If record does not exist - database errors
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C                     MOVEL'21'      DBASE            ** DB ERR 21 *
     C***********          MOVELCCY1      DBKEY            ***************151095
     C                     MOVELWKCCY     DBKEY            ***************151095
     C                     EXSR DBERR
     C                     END
      *
     C                     Z-ADD1         X       30
     C           '   '     LOKUPCYCD,X                   69
     C           *IN69     IFEQ '0'
     C                     Z-ADD1         X
     C                     END
      *
     C                     MOVE A6CYCD    CYCD,X
     C                     MOVE A6CSCD    CACD,X
      *
     C                     END
      *
     C**********           MOVEACACD,X    @@ASGL  40                                          CGL029
     C                     MOVEACACD,X    @@ASGL 100                                          CGL029
      *
     C                     ENDSR
      *****************************************************************
      *                                                               *
      *            SETCDT - Setup currency details                    *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  FIRST  - Initial Processing                        *
      *****************************************************************
     C           SETCDT    BEGSR                           ** SETCDT **
      *
     C***********          Z-ADD1         I       20                      151104
     C                     Z-ADD1         I       30                      151104
     C                     SETOF                     69
      *
      ** Look up array to check whether curr.details exists in the arr.
     C           @SCY      LOKUPCYC,I                    69
      *
      ** If element is found, corresponding elements in other arrays
      ** are retrieved (accessed via index I)
      **
      ** If element is not found
     C           *IN69     IFEQ '0'
      *
      ** Get currency details from file lf/sdcurrl0
     C*
     C                     CALL 'AOCURRR0'
     C***********          PARM '*BLANK ' @RTCD   7                       CEU024
     C                     PARM *BLANK    @RTCD   7                       CEU024
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM @SCY      @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** If record found
     C           @RTCD     IFEQ *BLANK
      *
     C           '   '     LOKUPCYC,I                    69
      *
      ** If an empty space does not exist in the array- put it in 1st.
     C           *IN69     IFEQ '0'
     C                     Z-ADD1         I
     C                     END
      *
     C                     MOVEL@SCY      CYC,I
     C                     Z-ADDA6NBDP    CDP,I
     C                     MOVELA6MDIN    CMD,I
     C                     Z-ADDA6SPRT    SPT,I
     C                     MOVELA6SPAE    TEQ,I
      *
     C                     ELSE
      *
      ** If record not found in lf/sdcurrl0 - db error
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C                     Z-ADD5         DBASE            ** DB ERR 05 **
     C                     MOVEL@SCY      DBKEY            **************
     C                     EXSR DBERR
      *
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      *                                                               *
      *            SETBRD - Setup branch details                      *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  PRODET - Process details                           *
      *****************************************************************
     C           SETBRD    BEGSR                           ** SETBRD **
      *
     C***********          Z-ADD1         I       20                      151104
     C                     Z-ADD1         I       30                      151104
     C                     SETOF                     69
      *
      ** Look up array to check whether branch code  exists in the arr.
     C           @BRCA     LOKUPBCD,I                    69
      *
      ** If element is found, corresponding elements in other arrays
      ** are retrieved (accessed via index I)
      **
      ** If element is not found
     C           *IN69     IFEQ '0'
      *
      ** Get branch details from file lf/sdbrchl1
     C*
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*BLANK ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM @BRCA     #BRCA   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      ** If record found
     C           @RTCD     IFEQ *BLANK
      *
     C           '   '     LOKUPBCD,I                    69
      *
      ** If an empty space does not exist in the array- put it in 1st.
     C           *IN69     IFEQ '0'
     C                     Z-ADD1         I
     C                     END
      *
     C                     MOVEL@BRCA     BCD,I
     C                     MOVE A8BICN    ICN,I
     C*
     C** Move 'Due To' and 'Due From' fields to array
     C                     MOVELA8DTAC    IGT,I
     C                     MOVELA8DFAC    IGF,I
     C*
      *
      ** Get account types for branch/HO interbank a/c codes only if
      ** multi branching is 'Y'.
     C           MBIN      IFEQ 'Y'
     C*
     C** Get account type for branch 'Due From' a/c code
     C                     MOVELA8DTAC    @ACD
     C                     EXSR GETACT
     C                     MOVEL@ACT      ITT,I
     C*
     C** Get account type for branch 'Due To' a/c code
     C                     MOVELA8DFAC    @ACD
     C                     EXSR GETACT
     C                     MOVEL@ACT      IFT,I
      *
     C                     END
      *
     C                     ELSE
      *
      ** If record not found in lf/sdbrchl1 - db error
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C                     Z-ADD10        DBASE            ** DB ERR 10 **
     C                     MOVEL@BRCA     DBKEY            **************
     C                     EXSR DBERR
      *
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            HSHTOT - Perform hash totals                       *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY  GEN00N - Generate                                  *
      *                                                               *
      *****************************************************************
     C           HSHTOT    BEGSR                           ** HSHTOT **
      *
     C           PSTA      DIV  1000      ZZAMT
      *
      ** If dr/cr indicator is '0' - debit
     C           DRCR      IFEQ 0
     C                     Z-ADD2         S
     C                     Z-ADD1         Z
     C                     EXSR ZHASH
     C                     END
      *
      ** If dr/cr indicator is '1' - credit
     C           DRCR      IFEQ 1
     C                     Z-ADD3         S
     C                     Z-ADD1         Z
     C                     EXSR ZHASH
     C                     END
      *
      ** Add 1 to the output record count
     C                     ADD  1         @GECNT
      *
     C                     ENDSR
     C/COPY WNCPYSRC,RE4201C016
      *****************************************************************
      /EJECT
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine   :  SRMACC                                       *   CAC002
      *  Function     :  Calculates margin in customer/account ccy    *   CAC002
      *                                                               *   CAC002
      *  Called by    :  PROEXC - Process exchange transactions       *   CAC002
      *  Calls        :  SRCURR - Retrieve pay/settle ccy details     *   CAC002
      *                  SRDRAT - Calculate default cross rate        *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           SRMACC    BEGSR                           ** SRMACC **   CAC002
      *                                                                   CAC002
     C                     Z-ADD0         WMAMT  163                      CAC002
     C                     Z-ADD0         WWMAMT 130                      CAC002
      *                                                                   CAC002
      **  Access settle and pay currency details                          CAC002
      *                                                                   CAC002
     C                     MOVE CCY1      WCCY1   3                       CAC002
     C                     MOVE CCY2      WCCY2   3                       CAC002
     C                     EXSR SRCURR                                    CAC002
      *                                                                   CAC002
      **  Calculate default cross-currency rate                           CAC002
      *                                                                   CAC002
     C                     EXSR SRDRAT                                    CAC002
      *                                                                   CAC002
      ** Set up factoring to adjust for decimal places.                   CAC002
      *                                                                   CAC002
     C           ZNBDP2    SUB  ZNBDP1    ZNBDPX  10                      CAC002
      *                                                                   CAC002
     C           ZNBDPX    IFGE 0                                         CAC002
     C           ZNBDPX    ADD  1         ZB      20                      CAC002
     C           1         MULT AP,ZB     ZFACTR  73                      CAC002
     C                     ELSE                                           CAC002
     C                     Z-SUBZNBDPX    ZNBDPX                          CAC002
     C           ZNBDPX    ADD  1         ZB                              CAC002
     C           1         DIV  AP,ZB     ZFACTR                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C           ZNBDP1    ADD  1         ZB                              CAC002
     C           FNCD      IFEQ '0JH'                                     140254
     C           AMT1      ADD  AMT2      WTAMT                           140254
     C           WTAMT     DIV  AP,ZB     WPYAM                           140254
     C                     ELSE                                           140254
     C           AMT1      DIV  AP,ZB     WPYAM  163                      CAC002
     C                     ENDIF                                          140254
      *                                                                   CAC002
     C           FNCD      IFEQ '0JH'                                     CAC002
     C           FNCD      OREQ '0JL'                                     CAC002
     C           ZNBDP2    ADD  1         ZB                              CAC002
     C***********AMT2      DIV  AP,ZB     WSMAM  163               CAC002 140254
     C           CVAM      ADD  CVAM2     WTAMT  150                      140254
     C           WTAMT     DIV  AP,ZB     WSMAM  163                      140254
     C                     ELSE                                           CAC002
      *                                                                   CAC002
     C           EXCR      IFGE 1                                         CAC002
     C           WZRATE    ANDGE1                                         CAC002
     C           EXCR      ORLE 1                                         CAC002
     C           WZRATE    ANDLE1                                         CAC002
     C           WPYAM     MULT EXCR      WSMAM     H                     CAC002
     C                     ELSE                                           CAC002
     C           WPYAM     DIV  EXCR      WSMAM     H                     CAC002
     C                     ENDIF                                          CAC002
     C**********           DIV  ZFACTR    WSMAM     H                                  195607 252591
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Margin rate = diff of cross rate & trans exch rate (EXCR)       CAC002
      *                                                                   CAC002
     C           ZRATEX    IFGE EXCR                                      CAC002
     C           ZRATEX    SUB  EXCR      WFXMR  138                      CAC002
     C                     ELSE                                           CAC002
     C           EXCR      SUB  ZRATEX    WFXMR                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If sell/customer a/c amount > buy/transaction amount            CAC002
      **     Margin amount = buy/transaction amount * margin rate         CAC002
      *                                                                   CAC002
     C           WSMAM     IFGT WPYAM                                     CAC002
     C           EXCR      ANDGT1                                         CAC002
     C           WSMAM     ORLT WPYAM                                     CAC002
     C           EXCR      ANDLT1                                         CAC002
      *                                                                   CAC002
     C           WPYAM     MULT WFXMR     WMAMT  163H                     CAC002
     C**********           DIV  ZFACTR    WMAMT     H                                  CAC002 252591
      *                                                                   CAC002
      **  If sell/customer a/c amount < buy/transaction amount            CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
      *                                                                   CAC002
      **  If profit:                                                      CAC002
      **                                            buy/trans amount      CAC002
      **     Margin amount = sell cust a/c amount - ----------------      CAC002
      **                                               spot rate          CAC002
      *                                                                   CAC002
     C           ZRATEX    IFGE EXCR                                      CAC002
     C           ZRATEX    ANDGT1                                         CAC002
     C           WPYAM     ANDGEWSMAM                                     CAC002
     C           ZRATEX    ORGE EXCR                                      CAC002
     C           ZRATEX    ANDLT1                                         CAC002
     C           WPYAM     ANDLEWSMAM                                     CAC002
     C           ZRATEX    ORLE EXCR                                      CAC002
     C           ZRATEX    ANDGT1                                         CAC002
     C           WPYAM     ANDLEWSMAM                                     CAC002
     C           ZRATEX    ORLE EXCR                                      CAC002
     C           ZRATEX    ANDLT1                                         CAC002
     C           WPYAM     ANDGEWSMAM                                     CAC002
     C           WPYAM     DIV  ZRATEX    WWSMAM 163H                     CAC002
     C**********           DIV  ZFACTR    WWSMAM    H                                  CAC002 252591
     C           WSMAM     SUB  WWSMAM    WMAMT                           CAC002
      *                                                                   CAC002
      **  If loss:                                                        CAC002
      **                     buy/trans amount                             CAC002
      **     Margin amount = ---------------- - sell/cust a/c amount      CAC002
      **                        spot rate                                 CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
     C           WPYAM     DIV  ZRATEX    WWSMAM    H                     CAC002
     C**********           DIV  ZFACTR    WWSMAM    H                                  CAC002 252591
     C           WWSMAM    SUB  WSMAM     WMAMT                           CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C           ZNBDP2    ADD  1         ZB                              CAC002
     C           WMAMT     MULT AP,ZB     WWMAMT                          CAC002
      *                                                                   CAC002
     C                     ENDSR                                          CAC002
      *****************************************************************   CAC002
      /EJECT                                                              CAC002
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine   :  SRMALC                                       *   CAC002
      *  Function     :  Calculates margin in local currency          *   CAC002
      *                                                               *   CAC002
      *  Called by    :  PROEXC - Process exchange transactions       *   CAC002
      *  Calls        :  SRCURR - Retrieve pay/settle ccy details     *   CAC002
      *                  SRDRAT - Calculate default cross rate        *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           SRMALC    BEGSR                           ** SRMALC **   CAC002
      *                                                                   CAC002
     C                     Z-ADD0         WMAMT  163                      CAC002
     C                     Z-ADD0         WWMAMT 130                      CAC002
      *                                                                   CAC002
      **  Process subroutine if either currencies is the local currency   CAC002
      *                                                                   CAC002
     C           CCY1      IFEQ BJLCCY                                    CAC002
     C           CCY2      OREQ BJLCCY                                    CAC002
      *                                                                   CAC002
      **  Determine local and non-local currency                          CAC002
      *                                                                   CAC002
     C           CCY1      IFEQ BJLCCY                                    CAC002
     C                     MOVE CCY2      WCCY1                           CAC002
     C                     MOVE CCY1      WCCY2                           CAC002
     C                     Z-ADDAMT2      WAMT1  150                      CAC002
     C                     Z-ADDAMT1      WAMT2  150                      CAC002
     C                     ELSE                                           CAC002
     C                     MOVE CCY1      WCCY1                           CAC002
     C                     MOVE CCY2      WCCY2                           CAC002
     C                     Z-ADDAMT1      WAMT1                           CAC002
     C                     Z-ADDAMT2      WAMT2                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Access settle and pay currency details                          CAC002
      *                                                                   CAC002
     C                     EXSR SRCURR                                    CAC002
      *                                                                   CAC002
      **  Calculate default cross-currency rate                           CAC002
      *                                                                   CAC002
     C                     EXSR SRDRAT                                    CAC002
      *                                                                   CAC002
      ** Set up factoring to adjust for decimal places.                   CAC002
      *                                                                   CAC002
     C           ZNBDP2    SUB  ZNBDP1    ZNBDPX  10                      CAC002
      *                                                                   CAC002
     C           ZNBDPX    IFGE 0                                         CAC002
     C           ZNBDPX    ADD  1         ZB      20                      CAC002
     C           1         MULT AP,ZB     ZFACTR  73                      CAC002
     C                     ELSE                                           CAC002
     C                     Z-SUBZNBDPX    ZNBDPX                          CAC002
     C           ZNBDPX    ADD  1         ZB                              CAC002
     C           1         DIV  AP,ZB     ZFACTR                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C           ZNBDP2    ADD  1         ZB                              CAC002
     C           WAMT2     DIV  AP,ZB     WLOAM  163                      CAC002
     C           ZNBDP1    ADD  1         ZB                              CAC002
     C           WAMT1     DIV  AP,ZB     WNLAM  163                      CAC002
      *                                                                   CAC002
      **     Margin rate = Cross rate - transaction exch rate (EXCR)      CAC002
      *                                                                   CAC002
     C           ZRATEX    IFGE EXCR                                      CAC002
     C           ZRATEX    SUB  EXCR      WFXMR  138                      CAC002
     C                     ELSE                                           CAC002
     C           EXCR      SUB  ZRATEX    WFXMR                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If local currency amount > non-local currency amount            CAC002
      **     Margin amount = non-local currency amount * margin rate      CAC002
      *                                                                   CAC002
     C           WLOAM     IFGT WNLAM                                     CAC002
     C           EXCR      ANDGT1                                         CAC002
     C           CCY1      ANDEQBJLCCY                                    CAC002
     C           WLOAM     ORLT WNLAM                                     CAC002
     C           EXCR      ANDLT1                                         CAC002
     C           CCY2      ANDEQBJLCCY                                    CAC002
      *                                                                   CAC002
     C           WNLAM     MULT WFXMR     WMAMT     H                     CAC002
     C*********            DIV  ZFACTR    WMAMT     H                                  CAC002 252591
      *                                                                   CAC002
      **  If local currency amount < non-local currency amount            CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
      *                                                                   CAC002
      **  If profit:                                                      CAC002
      **                                        non-local ccy amount      CAC002
      **     Margin amount = local ccy amount - --------------------      CAC002
      **                                             spot rate            CAC002
      *                                                                   CAC002
     C           ZRATEX    IFGE EXCR                                      CAC002
     C           ZRATEX    ANDGT1                                         CAC002
     C           WNLAM     ANDGEWLOAM                                     CAC002
     C           ZRATEX    ORGE EXCR                                      CAC002
     C           ZRATEX    ANDLT1                                         CAC002
     C           WNLAM     ANDLEWLOAM                                     CAC002
     C           ZRATEX    ORLE EXCR                                      CAC002
     C           ZRATEX    ANDGT1                                         CAC002
     C           WNLAM     ANDLEWLOAM                                     CAC002
     C           ZRATEX    ORLE EXCR                                      CAC002
     C           ZRATEX    ANDLT1                                         CAC002
     C           WNLAM     ANDGEWLOAM                                     CAC002
      *                                                                   CAC002
     C           WNLAM     IFGE WLOAM                                     CAC002
     C           EXCR      ANDGT1                                         CAC002
     C           WNLAM     ORLE WLOAM                                     CAC002
     C           EXCR      ANDLT1                                         CAC002
     C           WNLAM     DIV  ZRATEX    WWLOAM 163H                     CAC002
     C                     ELSE                                           CAC002
     C           WNLAM     MULT ZRATEX    WWLOAM    H                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C*********            DIV  ZFACTR    WWLOAM    H                                  CAC002 252591
      *                                                                   CEU025
     C           CEU025    IFEQ 'Y'                                       CEU025
     C           FNCD      ANDEQ'0JX'                                     CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           FNCD      ANDEQ'0JI'                                     CEU025
      *                                                                   CEU025
     C           CCY1      IFEQ CCY3                                      CEU025
     C           CCY1      ANDEQBJLCCY                                    CEU025
     C           CCY1      OREQ BJCYCD                                    CEU025
     C           AMT3      DIV  100       WWAMT  132                      CEU025
     C           WWLOAM    SUB  WWAMT     WWLOAM    H                     CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C           WLOAM     SUB  WWLOAM    WMAMT                           CAC002
      *                                                                   CAC002
      **  If loss:                                                        CAC002
      **                     non-local ccy amount                         CAC002
      **     Margin amount = -------------------- - local ccy amount      CAC002
      **                          spot rate                               CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
      *                                                                   CAC002
     C           CCY1      IFEQ BJLCCY                                    CAC002
     C           WNLAM     DIV  ZRATEX    WWLOAM 163H                     CAC002
     C                     ELSE                                           CAC002
     C           WNLAM     MULT ZRATEX    WWLOAM    H                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C**********           DIV  ZFACTR    WWLOAM    H                                  CAC002 252591
      *                                                                   CEU025
     C           CEU025    IFEQ 'Y'                                       CEU025
     C           FNCD      ANDEQ'0JX'                                     CEU025
     C           CEU025    OREQ 'Y'                                       CEU025
     C           FNCD      ANDEQ'0JI'                                     CEU025
      *                                                                   CEU025
     C           CCY1      IFEQ CCY3                                      CEU025
     C           CCY1      ANDEQBJLCCY                                    CEU025
     C           CCY1      OREQ BJCYCD                                    CEU025
     C           AMT3      DIV  100       WWAMT                           CEU025
     C           WWLOAM    SUB  WWAMT     WWLOAM    H                     CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C           WWLOAM    SUB  WLOAM     WMAMT                           CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C           ZNBDP2    ADD  1         ZB                              CAC002
     C           WMAMT     MULT AP,ZB     WWMAMT                          CAC002
      *                                                                   CAC002
     C                     ENDSR                                          CAC002
      *****************************************************************   CAC002
      /EJECT                                                              CAC002
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine  :  SRCURR                                        *   CAC002
      *  Function    :  Get Settlement and Pay Currencies Details     *   CAC002
      *                                                               *   CAC002
      *  Called by   :  SRMACC - Margin in customer/account currency  *   CAC002
      *                 SRMALC - Margin in local currency             *   CAC002
      *  Calls       :  AOCURRR0 - Currency Details Access Program    *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           SRCURR    BEGSR                           ** SRCURR **   CAC002
      *                                                                   CAC002
      **  Get Settlement Currency Details.                                CAC002
      *                                                                   CAC002
     C                     CALL 'AOCURRR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM WCCY1     WCURR   3                       CAC002
     C           SDCURR    PARM SDCURR    DSSDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVEL'SDCURRPD'DBFILE           ***************CAC002
     C                     Z-ADD34        DBASE            * DB ERROR 34 *CAC002
     C                     MOVELWCCY1     DBKEY            ***************CAC002
     C                     EXSR DBERR                                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     Z-ADDA6NBDP    ZNBDP1  10                      CAC002
     C                     Z-ADDA6NQDP    ZNQDP1  10                      CAC002
     C                     Z-ADDA6SPRT    ZRATE1 138                      CAC002
     C                     MOVE A6MDIN    ZMDI1   1                       CAC002
      *                                                                   CEU025
      ** Get exchange rate details on PF/REBDCRPD                         CEU025
     C           CRT003    IFEQ 'Y'                        B*1            CEU025
     C           CRT104    ANDEQ'Y'                                       CEU025
      *                                                                   CEU025
     C                     MOVELWCCY1     WCCY    3                       CEU025
     C                     EXSR GETSPT                                    CEU025
     C                     Z-ADDWWRATE    ZRATE1                          CEU025
      *                                                                   CEU025
     C                     ENDIF                           E*1            CEU025
      *                                                                   CEU024
      ** Keep Euro rates if within transition period                      CEU024
      *                                                                   CEU024
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           CEU025    OREQ 'Y'                                       CEU025
     C                     Z-ADDIVLD      ZDATE                           CEU024
     C                     EXSR ZDATE1                                    CEU024
     C                     MOVE *BLANKS   WICY1                           CEU024
     C           A6INCY    IFEQ 'Y'                                       CEU024
     C           ZDAYNO    ANDGEA6TPSD                                    CEU024
     C********** ZDAYNO    ANDLEA6TPED                             CEU024 190687
     C           WCURR     OREQ BKEURO                                    CEU024
     C                     MOVE 'Y'       WICY1   1                       CEU024
     C                     Z-ADDA6EUER    WERT1  138                      CEU024
     C                     MOVE A6EUMD    WEMD1   1                       CEU024
     C                     ENDIF                                          CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CAC002
      **  Get Pay Currency Details.                                       CAC002
      *                                                                   CAC002
     C                     CALL 'AOCURRR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM WCCY2     WCURR   3                       CAC002
     C           SDCURR    PARM SDCURR    DSSDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVEL'SDCURRPD'DBFILE           ***************CAC002
     C                     Z-ADD35        DBASE            * DB ERROR 35 *CAC002
     C                     MOVELWCCY2     DBKEY            ***************CAC002
     C                     EXSR DBERR                                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     Z-ADDA6NBDP    ZNBDP2  10                      CAC002
     C                     Z-ADDA6NQDP    ZNQDP2  10                      CAC002
     C                     Z-ADDA6SPRT    ZRATE2 138                      CAC002
     C                     MOVE A6MDIN    ZMDI2   1                       CAC002
      *                                                                   CEU025
      ** Get exchange rate details on PF/REBDCRPD                         CEU025
     C           CRT003    IFEQ 'Y'                        B*1            CEU025
     C           CRT104    ANDEQ'Y'                                       CEU025
      *                                                                   CEU025
     C                     MOVELWCCY2     WCCY                            CEU025
     C                     EXSR GETSPT                                    CEU025
     C                     Z-ADDWWRATE    ZRATE2                          CEU025
      *                                                                   CEU025
     C                     ENDIF                           E*1            CEU025
      *                                                                   CEU024
      ** Use Euro rates if within transition period                       CEU024
      *                                                                   CEU024
     C                     MOVE *BLANKS   WICY2   1                       146200
     C           CEU024    IFEQ 'Y'                                       CEU024
     C           WICY1     ANDEQ'Y'                                       CEU024
     C           CEU025    OREQ 'Y'                                       CEU025
     C           WICY1     ANDEQ'Y'                                       CEU025
     C           A6INCY    IFEQ 'Y'                                       CEU024
     C           ZDAYNO    ANDGEA6TPSD                                    CEU024
     C********** ZDAYNO    ANDLEA6TPED                             CEU024 190687
     C           WCURR     OREQ BKEURO                                    CEU024
     C                     MOVE 'Y'       WICY2                           146200
     C                     Z-ADDWERT1     ZRATE1                          CEU024
     C                     MOVE WEMD1     ZMDI1                           CEU024
     C                     Z-ADDA6EUER    ZRATE2                          CEU024
     C                     MOVE A6EUMD    ZMDI2                           CEU024
     C                     ENDIF                                          CEU024
     C                     ENDIF                                          CEU024
      *                                                                   CAC002
     C           SRCUR9    ENDSR                           ** SRCUR9 **   CAC002
      *                                                                   CAC002
      *****************************************************************   CAC002
      /EJECT                                                              CAC002
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine  :  SRDRAT                                        *   CAC002
      *  Function    :  Get Default Cross-Currency Rate               *   CAC002
      *                                                               *   CAC002
      *  Called by   :  SRMACC - Margin in customer/account currency  *   CAC002
      *                 SRMALC - Margin in local currency             *   CAC002
      *  Calls       :  ZXRATE - Obtain Cross-Exchange Rate between   *   CAC002
      *                          2 Currencies                         *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           SRDRAT    BEGSR                           ** SRDRAT **   CAC002
      *                                                                   CAC002
      **  Obtain cross-exchange rate between settlement and pay ccys.     CAC002
      *                                                                   CAC002
     C           CEU024    IFEQ 'Y'                                       146200
     C           WICY2     ANDEQ'Y'                                       146200
     C                     SELEC                                          146200
     C           WCCY1     WHEQ BKEURO                                    146200
     C                     Z-ADDZRATE2    ZRATEX                          146200
     C           WCCY2     WHEQ BKEURO                                    146200
     C                     Z-ADDZRATE1    ZRATEX                          146200
     C                     OTHER                                          146200
     C                     EXSR ZXRATE                                    146200
     C                     ENDSL                                          146200
     C                     ELSE                                           146200
     C                     EXSR ZXRATE                                    CAC002
     C                     ENDIF                                          146200
     C                     Z-ADDZRATEX    WZRATE 158                      CAC002
      *                                                                   CAC002
     C           EXCR      IFGT 1                                         CAC002
     C           ZRATEX    ANDLT1                                         CAC002
     C           EXCR      ORLT 1                                         CAC002
     C           ZRATEX    ANDGT1                                         CAC002
     C           1         DIV  ZRATEX    ZRATEX    H                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C           SRDRA9    ENDSR                           ** SRDRA9 **   CAC002
      *                                                                   CAC002
      *****************************************************************   CAC002
      /EJECT                                                              CAC002
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine   :  SRWMAR                                       *   CAC002
      *  Function     :  Write new margin posting to GETTPD           *   CAC002
      *                                                               *   CAC002
      *  Called by    :  PROEXC - Process exchange transactions       *   CAC002
      *  Calls        :  None                                         *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           SRWMAR    BEGSR                           ** SRWMAR **   CAC002
     C*                                                                   163729
     C**Initialize the extension ref file fields for EMU posting nar      163729
     C                     MOVEL*BLANKS   XRFI                            163729
     C                     Z-ADD0         XRFN                            163729
      *                                                                   141386
     C                     MOVEL'P'       RECI                            141386
      *                                                                   CAC002
      **  Write posting record if non-zero margin amount                  CAC002
      *                                                                   CAC002
     C           WWMAMT    IFNE 0                                         CAC002
     C                     MOVE @TICN     CNUM                            CAC002
     C                     MOVE FTFMAC    ACOD                            CAC002
     C                     MOVE '01'      ACSQ                            CAC002
     C                     MOVE ITLB      BRCA                            CAC002
      *                                                                   147070
     C           WWMAMT    IFGT 0                                         147070
     C                     Z-ADDWWMAMT    PSTA                            CAC002
     C                     ELSE                                           147070
     C                     Z-SUBWWMAMT    PSTA                            147070
     C                     ENDIF                                          147070
      *                                                                   140254
     C           FNCD      IFNE '00L'                                     140254
     C           FNCD      ANDNE'00W'                                     140254
     C           FNCD      ANDNE'0JO'                                     140254
     C           FNCD      ANDNE'0JL'                                     140254
     C           FNCD      ANDNE'0JW'                                     140254
     C           FNCD      ANDNE'00O'                                     140254
      *                                                                   147070
     C           WWMAMT    IFGT 0                                         147070
     C                     MOVE '1'       DRCR                            CAC002
     C                     ELSE                                           147070
     C                     MOVE '0'       DRCR                            147070
     C                     ENDIF                                          147070
      *                                                                   147070
     C                     ELSE                                           140254
      *                                                                   147070
     C           WWMAMT    IFGT 0                                         147070
     C                     MOVE '0'       DRCR                            140254
     C                     ELSE                                           147070
     C                     MOVE '1'       DRCR                            147070
     C                     ENDIF                                          147070
      *                                                                   147070
     C                     ENDIF                                          140254
      *                                                                   CAC002
      **  Retrieve account code details                                   CAC002
      *                                                                   CAC002
     C                     CALL 'AOACODR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C**********           PARM FTFMAC    WACOD   4                                    CAC002 CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                        CAC002 CGL029
     C                     PARM FTFMAC    WACOD                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
      *                                                                   CAC002
      ** If a/c code is not found, set to zero - suspense a/c.            139524
      *                                                                   CAC002
     C                     MOVEL*BLANKS   WACOD                           139524
     C********** *LOCK     IN   LDA                                CAC002 139524
     C**********           MOVEL'SDACODPD'DBFILE    ***************CAC002 139524
     C**********           Z-ADD37        DBASE     * DB ERROR 37 *CAC002 139524
     C**********           MOVELWACOD     DBKEY     ***************CAC002 139524
     C**********           EXSR DBERR                              CAC002 139524
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     MOVE A5ACTY    ATYP                            CAC002
     C                     MOVE A5ACSC    ACSC                            CAC002
      *                                                                   CAC002
      **  Determine currency                                              CAC002
      *                                                                   CAC002
     C           FNCD      IFNE '0JI'                                     CAC002
     C           FNCD      ANDNE'0JS'                                     CAC002
     C           FNCD      ANDNE'0JX'                                     CAC002
     C                     MOVE CCY2      CCY                             CAC002
     C                     ELSE                                           CAC002
     C           CCY1      IFEQ BJLCCY                                    CAC002
     C           CCY2      OREQ BJLCCY                                    CAC002
     C                     MOVE BJLCCY    CCY                             CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Accumulate hash totals on posting amount                        CAC002
      *                                                                   CAC002
     C                     EXSR HSHTOT                                    CAC002
      *                                                                   CAC002
      **  Write margin posting to PF/GETTPD                               CAC002
      *                                                                   CAC002
     C           *INU1     IFEQ *OFF                                      CAC002
     C                     MOVELACOD      @ACD                            153249
     C                     EXSR GETACT                                    153249
     C                     MOVELW#ACSC    ACSC                            153249
     C                     WRITEAPOSTPDF                                  CAC002
     C                     ENDIF                                          CAC002
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                     BUG27119
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDSR                                          CAC002
      *****************************************************************   CAC002
      /EJECT                                                              CAC002
      *****************************************************************   CEU024
      *                                                               *   CEU024
      *  SRNARR - Additional Posting Narrative                        *   CEU024
      *                                                               *   CEU024
      *  Called by: PROEXC - Process exchange transactions            *   CEU024
      *             PROPRP - Process pay/receive postings             *   CEU024
      *             GEN0JN - Generate entry for fn. code '0JN'        *   CEU024
      *             GENJKQ - Generate entry for fn. code '0JK' '0JQ'  *   CEU024
      *                                                  '0JR'        *   CEU024
      *             GENJHP - Generate entry for fn. code '0JH' '0JP'  *   CEU024
      *             GEN0JO - Generate entry for fn. code '0JO'        *   CEU024
      *             GEN0JL - Generate entry for fn. code '0JL' '0JW'  *   CEU024
      *             GEN0JI - Generate entry for fn. code '0JI' '0JS'  *   CEU024
      *                                                  '0JX'        *   CEU024
      *             GEN0JE - Generate entry for fn.code '0JE'         *   CEU024
      *             GEN0JF - Generate entry for fn. code '0JF'        *   CEU024
      *                                                               *   CEU024
      *  Calls:     None                                              *   CEU024
      *                                                               *   CEU024
      *****************************************************************   CEU024
     C           SRNARR    BEGSR                                          CEU024
      *                                                                   CEU024
     C***********          ADD  1         WNARN                    CEU024*163729
      *                                                                   CEU024
     C                     MOVE '001'     XRFI                            CEU024
     C                     Z-ADDWNARN     XRFN                            CEU024
      *                                                                   CEU024
     C                     MOVE '001'     RFID                            CEU024
     C                     Z-ADDWNARN     RFNO                            CEU024
     C                     MOVE CCY1      OCCY                            CEU024
     C                     Z-ADDAMT1      OAMT                            CEU024
      *                                                                   CEU024
     C                     WRITEGETT1AD0                                  CEU024
      *                                                                   CEU024
     C                     ADD  1         WNARN                           163729
      *                                                                   163729
     C                     ENDSR                                          CEU024
      *****************************************************************   CEU024
      /EJECT                                                              CEU024
      *****************************************************************
      *                                                               *
      *            DBERR  - Database Error Handling : Terminate pgm.  *
      *                                                               *
      * CALLED BY  ZA0150 - Get Midas Rundate & Setup Indicator(01)   *
      *            FIRST  - Initial processing              (02 03 04)*
      *            UPTRL  - Update Control Trailer Record      (05)   *
      *            UPDRTN - Control rtn. for updates           (06 07)*
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           DBERR     BEGSR                           ** DBERR  **
      *
     C                     MOVEL@PGM      DBPGM
     C                     OUT  LDA
     C                     DUMP
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
     C**  Subroutine SRPNAR determines the required narratives.         **109175
     C********************************************************************109175
     C           SRPNAR    BEGSR                           * S R P N A R *109175
     C*                                                                   109175
     C* Define the data structure parameter:                              109175
     C*                                                                   109175
     C           *LIKE     DEFN CGPNAR    ##PNAR                          109175
     C*                                                                   109175
     C* Save the input narrative field:                                   109175
     C*                                                                   109175
     C                     MOVE *BLANKS   ##NARR                          109175
     C                     MOVELPNAR      ##NARR                          109175
     C*...................................................................109175
     C* Determine the value for the narrative using AOPNARR0:             109175
     C*                                                                   109175
     C                     CLEAR##PRM1                                    109175
      *                                                                   109175
     C                     MOVE 'RE'      MNMODI                          109175
     C                     MOVE CNUM      MNCUST                          109175
     C                     MOVE BRCA      MNBRCA                          109175
     C                     MOVEL##NARR    MNNARR    P                     109175
     C*                                                                   109175
     C                     CALL 'AOPNARR0'                                109175
     C                     PARM           ##RTN   7                       109175
     C                     PARM           ##MGID  7                       109175
     C                     PARM           ##PRM1                          109175
     C           CGPNAR    PARM CGPNAR    ##PNAR                          109175
     C                     PARM           ##NARR 50                       109175
     C*                                                                   109175
     C           ##RTN     IFNE *BLANKS                                   109175
     C                     MOVEL'CGPNARPD'DBFILE             *************109175
     C                     MOVEL'102'     DBASE              * DBERR 102 *109175
     C                     MOVELMNCUST    DBKEY              *************109175
     C                     EXSR *PSSR                                     109175
     C                     ENDIF                                          109175
     C*                                                                   109175
     C                     MOVEL##NARR    PNAR                            109175
     C           RTSNAR    IFEQ 'Y'                                                         MD054623
     C           TTNARR    IFNE *BLANKS                                                     MD054623
     C                     MOVELTTNARR    PNAR                                              MD054623
     C                     ENDIF                                                            MD054623
     C                     ENDIF                                                            MD054623
     C*                                                                   109175
     C                     ENDSR                                          109175
     C********************************************************************109175
      /EJECT                                                              CEU025
      *****************************************************************   CEU025
      *                                                               *   CEU025
      *            GETSPT - Process update for PF/RECIEUPD            *   CEU025
      *                                                               *   CEU025
      * CALLS             -                                           *   CEU025
      *                                                               *   CEU025
      * CALLED BY         - Main Processing                           *   CEU025
      *                                                               *   CEU025
      * FLDS USED         -                                           *   CEU025
      *                                                               *   CEU025
      *****************************************************************   CEU025
     C           GETSPT    BEGSR                                          CEU025
      *                                                                   CEU025
     C                     OPEN REBDCCPD                                  CEU025
     C                     OPEN REBDCRPD                                  CEU025
      *                                                                   CEU025
     C                     SELEC                                          CEU025
      *                                                                   CEU025
     C           FNCD      WHEQ '0JR'                                     CEU025
     C                     MOVEL'0JK'     WKEY                            CEU025
      *                                                                   CEU025
     C           FNCD      WHEQ '0JW'                                     CEU025
     C                     MOVEL'0JL'     WKEY                            CEU025
      *                                                                   CEU025
     C           FNCD      WHEQ '0JS'                                     CEU025
     C           FNCD      OREQ '0JX'                                     CEU025
     C                     MOVEL'0JI'     WKEY                            CEU025
      *                                                                   CEU025
     C                     OTHER                                          CEU025
      *                                                                   CEU025
     C                     MOVELFNCD      WKEY    3                       CEU025
      *                                                                   CEU025
     C                     ENDSL                                          CEU025
      *                                                                   CEU025
      ** Find function code in Exchange Rate Control Table                CEU025
      *                                                                   CEU025
     C           WKEY      CHAINREBDCCD0             70                   CEU025
      *                                                                   CEU025
      ** If record not found?                                             CEU025
      *                                                                   CEU025
     C           *IN70     IFEQ *ON                                       CEU025
     C           *LOCK     IN   LDA                        ***************CEU025
     C                     Z-ADD16        DBASE            ** DB ERR 16 **CEU025
     C                     MOVEL'REBDCCPD'DBFILE           ***************CEU025
     C                     MOVELFNCD      DBKEY                           CEU025
     C                     EXSR DBERR                                     CEU025
     C                     END                                            CEU025
      *                                                                   CEU025
     C           WCCY      CHAINREBDCRD0             70                   CEU025
      *                                                                   CEU025
      ** Move exchange rate in accordance with function and currency code CEU025
      *                                                                   CEU025
     C                     Z-ADD0         WWRATE 138                      CEU025
     C                     SELEC                                          CEU025
     C           NAC       WHEQ 'DN'                                      CEU025
     C           FEDNRT    DIV  FEAMNT    WWRATE    H                     CEU025
     C           NAC       WHEQ 'DP'                                      CEU025
     C           FEDPRT    DIV  FEAMNT    WWRATE    H                     CEU025
     C           NAC       WHEQ 'DS'                                      CEU025
     C           FEDSRT    DIV  FEAMNT    WWRATE    H                     CEU025
     C           NAC       WHEQ 'VN'                                      CEU025
     C           FEVNRT    DIV  FEAMNT    WWRATE    H                     CEU025
     C           NAC       WHEQ 'VP'                                      CEU025
     C           FEVPRT    DIV  FEAMNT    WWRATE    H                     CEU025
     C           NAC       WHEQ 'VS'                                      CEU025
     C           FEVSRT    DIV  FEAMNT    WWRATE    H                     CEU025
     C                     ENDSL                                          CEU025
      *                                                                   CEU025
     C                     CLOSEREBDCCPD                                  CEU025
     C                     CLOSEREBDCRPD                                  CEU025
      *                                                                   CEU025
     C                     ENDSR                                          CEU025
      *****************************************************************   CEU025
      /EJECT                                                                                  CRT006
      *****************************************************************                       CRT006
      *  SRDELD - SR to delete the record from file, LF/TTRANL2 and   *                       CRT006
      *           update the teller totals.                           *                       CRT006
      *                                                               *                       CRT006
      *  Called by: MAIN - Main Processing                            *                       CRT006
      *****************************************************************                       CRT006
      *                                                                                       CRT006
     C           SRDELD    BEGSR                                                              CRT006
      *                                                                                       CRT006
      ** Set Reversal Indicator to "Y"                                                        CRT006
      *                                                                                       CRT006
     C                     MOVEL'Y'       @RVIN                                               CRT006
      *                                                                                       CRT006
      ** Access TTRNTM3, teller controls, using transaction teller                            CRT006
      ** branch, teller ID and record type set to '2'.                                        CRT006
      *                                                                                       CRT006
     C           KTTRN     KLIST                                                              CRT006
     C                     KFLD           KTBRI   1                                           CRT006
     C                     KFLD           KTBID   3                                           CRT006
     C                     KFLD           KRCTP   1                                           CRT006
      *                                                                                       CRT006
     C                     MOVE TBRI      KTBRI                                               CRT006
     C                     MOVE TBID      KTBID                                               CRT006
     C                     MOVEL'1'       KRCTP                                               CRT006
      *                                                                                       CRT006
     C           KTTRN     CHAINTTRNTM2F             70                                       CRT006
     C           TBRI      CAT  TBID:1    TRNDBK  5                                           CRT006
      *                                                                                       CRT006
      ** If record not found - database error                                                 CRT006
      *                                                                                       CRT006
     C           *IN70     IFEQ '1'                                                           CRT006
     C           *LOCK     IN   LDA                        ************                       CRT006
     C                     Z-ADD41        DBASE            * DBERR 41 *                       CRT006
     C                     MOVE 'TTRNTM2' DBFILE           ************                       CRT006
     C                     MOVELTRNDBK    DBKEY                                               CRT006
     C                     OUT  LDA                                                           CRT006
     C                     EXSR DBERR                                                         CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     MOVE TBRI      KTBRI                                               CRT006
     C                     MOVE TBID      KTBID                                               CRT006
     C                     MOVEL'2'       KRCTP                                               CRT006
      *                                                                                       CRT006
     C           KTTRN     CHAINTTRNTM3F             70                                       CRT006
     C           TBRI      CAT  TBID:1    TRNDBK  5                                           CRT006
      *                                                                                       CRT006
      ** If record not found - database error                                                 CRT006
      *                                                                                       CRT006
     C           *IN70     IFEQ '1'                                                           CRT006
     C           *LOCK     IN   LDA                        ************                       CRT006
     C                     Z-ADD46        DBASE            * DBERR 46 *                       CRT006
     C                     MOVE 'TTRNTM3' DBFILE           ************                       CRT006
     C                     MOVELTRNDBK    DBKEY                                               CRT006
     C                     OUT  LDA                                                           CRT006
     C                     EXSR DBERR                                                         CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Access function code record from PF/SDFNCDPD                                         CRT006
      *                                                                                       CRT006
     C                     CALL 'AOFNCDR0'                                                    CRT006
     C                     PARM *BLANKS   PRTCD   7                                           CRT006
     C                     PARM '*KEY   ' POPTN   7                                           CRT006
     C                     PARM           FNCD                                                CRT006
     C           SDFNCD    PARM SDFNCD    DSFDY                                               CRT006
      *                                                                                       CRT006
     C           PRTCD     IFNE *BLANK                                                        CRT006
     C           *LOCK     IN   LDA                                                           CRT006
     C                     MOVEL'SDFNCDPD'DBFILE           ************                       CRT006
     C                     Z-ADD42        DBASE            * DBERR 42 *                       CRT006
     C                     MOVELFNCD      DBKEY            ************                       CRT006
     C                     OUT  LDA                                                           CRT006
     C                     EXSR DBERR                                                         CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Initialise work transaction types                                                    CRT006
      *                                                                                       CRT006
     C                     MOVE *BLANKS   @TTP1   5                                           CRT006
     C                     MOVE *BLANKS   @TTP2   5                                           CRT006
      *                                                                                       CRT006
     C                     SELEC                                                              CRT006
      *                                                                                       CRT006
      ** If function code is any of the following                                             CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '00N'                                                         CRT006
     C           FNCD      OREQ '00K'                                                         CRT006
     C           FNCD      OREQ '00Q'                                                         CRT006
     C           FNCD      OREQ '00R'                                                         CRT006
     C           FNCD      OREQ '00H'                                                         CRT006
     C           FNCD      OREQ '00P'                                                         CRT006
     C           FNCD      OREQ '0JN'                                                         CRT006
     C           FNCD      OREQ '0JK'                                                         CRT006
     C           FNCD      OREQ '0JQ'                                                         CRT006
     C           FNCD      OREQ '0JR'                                                         CRT006
     C           FNCD      OREQ '0JH'                                                         CRT006
     C           FNCD      OREQ '0JP'                                                         CRT006
     C           FNCD      OREQ '00E'                                                         CRT005
     C           FNCD      OREQ '0JE'                                                         CRT005
      *                                                                                       CRT006
      ** Use Credit Transaction 1 from PF/SDFNCDPD                                            CRT006
      *                                                                                       CRT006
     C                     MOVELFQCRC1    @TTP1                                               CRT006
      *                                                                                       CRT006
      ** If function code is any of the following                                             CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '00O'                                                         CRT006
     C           FNCD      OREQ '00L'                                                         CRT006
     C           FNCD      OREQ '00W'                                                         CRT006
     C           FNCD      OREQ '0JO'                                                         CRT006
     C           FNCD      OREQ '0JL'                                                         CRT006
     C           FNCD      OREQ '0JW'                                                         CRT006
     C           FNCD      OREQ '00A'                                                         CRT006
     C           FNCD      OREQ '00F'                                                         CRT005
     C           FNCD      OREQ '0JF'                                                         CRT005
      *                                                                                       CRT006
      ** Use Debit Transaction 1 from PF/SDFNCDPD                                             CRT006
      *                                                                                       CRT006
     C                     MOVELFQDRC1    @TTP1                                               CRT006
      *                                                                                       CRT006
      ** If function code is any of the following                                             CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '00I'                                                         CRT006
     C           FNCD      OREQ '0JI'                                                         CRT006
     C           FNCD      OREQ '0JS'                                                         CRT006
     C           FNCD      OREQ '0JX'                                                         CRT006
     C           FNCD      OREQ '***'                                                         CRT006
      *                                                                                       CRT006
      ** Use Transaction Type 1 from TTRANL2                                                  CRT006
      *                                                                                       CRT006
     C                     MOVELTRTP1     @TTP1                                               CRT006
      *                                                                                       CRT006
     C                     ENDSL                                                              CRT006
      *                                                                                       CRT006
     C                     SELEC                                                              CRT006
      ** If the Function Code is any of the following                                         CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '00H'                                                         CRT006
     C           FNCD      OREQ '00P'                                                         CRT006
     C           FNCD      OREQ '0JH'                                                         CRT006
     C           FNCD      OREQ '0JP'                                                         CRT006
      *                                                                                       CRT006
      ** Use Credit Transaction 2 from PF/SDFNCDPD                                            CRT006
      *                                                                                       CRT006
     C                     MOVELFQCRC2    @TTP2                                               CRT006
      *                                                                                       CRT006
      ** If the function code is any of the following                                         CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '00A'                                                         CRT006
      *                                                                                       CRT006
      ** Use Credit Transaction 1 from PF/SDFNCDPD                                            CRT006
      *                                                                                       CRT006
     C                     MOVELFQCRC1    @TTP2                                               CRT006
      *                                                                                       CRT006
      ** If the Function Code is any of the following                                         CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '00I'                                                         CRT006
     C           FNCD      OREQ '0JI'                                                         CRT006
     C           FNCD      OREQ '0JS'                                                         CRT006
     C           FNCD      OREQ '0JX'                                                         CRT006
      *                                                                                       CRT006
      ** Use Transaction Type 2 from TTRANL2                                                  CRT006
      *                                                                                       CRT006
     C           TRTP2     IFNE *ZERO                                                         CRT006
     C                     MOVELTRTP2     @TTP2                                               CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     ENDSL                                                              CRT006
      *                                                                                       CRT006
      ** If Transaction Type 1 is not blank - access PF/SDRETRPD                              CRT006
      *                                                                                       CRT006
     C           @TTP1     IFNE *BLANK                                                        CRT006
      *                                                                                       CRT006
     C                     CALL 'AORETRR0'                                                    CRT006
     C                     PARM *BLANKS   PRTCD                                               CRT006
     C                     PARM '*KEY   ' POPTN                                               CRT006
     C                     PARM @TTP1     PRETR   5                                           CRT006
     C           SDRETR    PARM SDRETR    DSFDY                                               CRT006
      *                                                                                       CRT006
      ** If record does not exist                                                             CRT006
      *                                                                                       CRT006
     C           PRTCD     IFNE *BLANK                                                        CRT006
     C           *LOCK     IN   LDA                        ************                       CRT006
     C                     Z-ADD43        DBASE            * DBERR 43 *                       CRT006
     C                     MOVE 'SDRETRPD'DBFILE           ************                       CRT006
     C                     MOVEL@TTP1     DBKEY                                               CRT006
     C                     OUT  LDA                                                           CRT006
     C                     EXSR DBERR                                                         CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Obtain currency totals for trans-type 1                                              CRT006
      *                                                                                       CRT006
     C                     MOVELA1DCIN    @DCIN                                               CRT006
     C                     MOVELA1CIND    @CSIN                                               CRT006
     C                     MOVELA1CLIN    @CLIN1  1                                           CRT006
     C                     MOVEL@CLIN1    @CLIN                                               CRT006
     C                     MOVELA1PASB    @PBTP1  2                                           CRT006
      *                                                                                       CRT006
      ** Setup Currency and Amount to be updated                                              CRT006
      *                                                                                       CRT006
     C                     MOVELCCY1      @CCY                                                CRT006
     C                     Z-ADDAMT1      @TAMT                                               CRT006
      *                                                                                       CRT006
     C                     EXSR RTTOTS                                                        CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** If Transaction Type 2 is not blank - access PF/SDRETRPD                              CRT006
      *                                                                                       CRT006
     C           @TTP2     IFNE *BLANK                                                        CRT006
      *                                                                                       CRT006
     C                     CALL 'AORETRR0'                                                    CRT006
     C                     PARM *BLANKS   PRTCD                                               CRT006
     C                     PARM '*KEY   ' POPTN                                               CRT006
     C                     PARM @TTP2     PRETR                                               CRT006
     C           SDRETR    PARM SDRETR    DSFDY                                               CRT006
      *                                                                                       CRT006
      ** If record does not exist                                                             CRT006
      *                                                                                       CRT006
     C           @RTCD     IFNE *BLANK                                                        CRT006
     C           *LOCK     IN   LDA                        ************                       CRT006
     C                     Z-ADD44        DBASE            * DBERR 44 *                       CRT006
     C                     MOVE 'SDRETRPD'DBFILE           ************                       CRT006
     C                     MOVEL@TTP2     DBKEY                                               CRT006
     C                     OUT  LDA                                                           CRT006
     C                     EXSR DBERR                                                         CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Obtain currency totals for trans-type 2                                              CRT006
      *                                                                                       CRT006
     C                     MOVELA1DCIN    @DCIN                                               CRT006
     C                     MOVELA1CIND    @CSIN                                               CRT006
     C                     MOVELA1CLIN    @CLIN2  1                                           CRT006
     C                     MOVEL@CLIN2    @CLIN                                               CRT006
     C                     MOVELA1PASB    @PBTP2  2                                           CRT006
      *                                                                                       CRT006
      ** Setup Currency and Amount to be updated                                              CRT006
      *                                                                                       CRT006
     C                     SELEC                                                              CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '00A'                                                         CRT006
     C                     MOVELCCY1      @CCY                                                CRT006
     C                     Z-ADDAMT1      @TAMT                                               CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '0JI'                                                         CRT006
     C           FNCD      OREQ '0JS'                                                         CRT006
     C           FNCD      OREQ '0JX'                                                         CRT006
     C                     MOVELCCY2      @CCY                                                CRT006
     C                     Z-ADDAMT2      @TAMT                                               CRT006
      *                                                                                       CRT006
     C           FNCD      WHEQ '00I'                                                         CRT006
     C           CCY2      ANDEQ*BLANKS                                                       CRT006
     C                     MOVELCCY1      @CCY                                                CRT006
     C                     Z-ADDAMT2      @TAMT                                               CRT006
      *                                                                                       CRT006
     C                     OTHER                                                              CRT006
     C                     MOVELCCY1      @CCY                                                CRT006
     C                     Z-ADDAMT2      @TAMT                                               CRT006
      *                                                                                       CRT006
     C                     ENDSL                                                              CRT006
      *                                                                                       CRT006
     C                     Z-ADD1         @COUNT                                              CRT006
      *                                                                                       CRT006
     C                     EXSR RTTOTS                                                        CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Update the record                                                                    CRT006
      *                                                                                       CRT006
     C                     UPDATTTRNTM3F                                                      CRT006
      *                                                                                       CRT006
      ** If a cheque has been presented with the transaction                                  CRT006
      *                                                                                       CRT006
     C           UCQB      IFEQ 'Y'                                                           CRT006
      *                                                                                       CRT006
      ** Reverse update on Pf/CHQBKPD                                                         CRT006
      *                                                                                       CRT006
     C                     EXSR SRUCHK                                                        CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** If the Function Code is one of the following:                                        CRT006
      *                                                                                       CRT006
     C           FNCD      IFEQ '00K'                                                         CRT006
     C           FNCD      OREQ '00R'                                                         CRT006
     C           FNCD      OREQ '0JK'                                                         CRT006
     C           FNCD      OREQ '0JR'                                                         CRT006
     C           FNCD      OREQ '00H'                                                         CRT006
     C           FNCD      OREQ '0JH'                                                         CRT006
     C           FNCD      OREQ '00P'                                                         CRT006
     C           FNCD      OREQ '0JP'                                                         CRT006
     C           FNCD      OREQ '00Q'                                                         CRT006
     C           FNCD      OREQ '0JQ'                                                         CRT006
      *                                                                                       CRT006
      ** Reverse update on PF/CHQDPPD                                                         CRT006
      *                                                                                       CRT006
     C                     EXSR SRUCHD                                                        CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Delete the transaction record from file, LF/TTRANL2                                  CRT006
      *                                                                                       CRT006
     C                     MOVE '*'       RECI                                                CRT006
     C                     UPDATTTRANPDF                                                      CRT006
      *                                                                                       CRT006
      ** Perform override to PF/TTRANPT & open file                                           CRT006
      *                                                                                       CRT006
     C                     MOVEL*BLANKS   @CMDT                                               CRT006
     C                     MOVEL@TXT,1    @CMDT                                               CRT006
     C           FNCD      IFEQ '***'                                                       MD055557
     C                     MOVEL'B'       @BRIT                                             MD055557
     C                     ELSE                                                             MD055557
     C                     MOVEL'T'       @BRIT                                               CRT006
     C                     ENDIF                                                            MD055557
     C                     MOVELTBID      @BIDT                                               CRT006
     C                     CALL 'QCMDEXC'              80                                     CRT006
     C                     PARM           @CMDT                                               CRT006
     C                     PARM 80        @LEN   155                                          CRT006
      *                                                                                       CRT006
     C           FNCD      IFEQ '***'                                                       MD055557
     C                     MOVEL'B'       KBRI                                              MD055557
     C                     ELSE                                                             MD055557
     C                     MOVE 'T'       KBRI                                                CRT006
     C                     ENDIF                                                            MD055557
     C                     MOVE TBID      KBID                                                CRT006
     C                     Z-ADD99999     KTBTN1                                              CRT006
     C                     OPEN TTRANL1                                                       197289
     C           *LOVAL    SETLLTTRANPTF                                                      CRT006
     C           KTRNL1    CHAINTTRANPTF             80                                       CRT006
      *                                                                                       CRT006
      ** If no record is present -                                                            CRT006
     C           *IN80     IFEQ '1'                                                           CRT006
     C           *LOCK     IN   LDA                                                           CRT006
     C                     Z-ADD48        DBASE                                               CRT006
     C                     MOVEL'TTRANPT' DBFILE                                              CRT006
     C                     MOVEL'1       'DBKEY                                               CRT006
     C                     EXSR DBERR                                                         CRT006
      *                                                                                       CRT006
     C                     ELSE                                                               CRT006
      *                                                                                       CRT006
      ** Update the number of records on file, PF/TTRANPT.                                    CRT006
     C                     SUB  1         NORE                                                CRT006
     C                     UPDATTTRANPTF                                                      CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
     C                     CLOSETTRANL1                                                       197289
      *                                                                                       CRT006
      ** Delete previous overrride.                                                           CRT006
     C                     MOVEL*BLANKS   @CMDT                                               CRT006
     C                     MOVEL@TXT,2    @CMDT                                               CRT006
     C                     CALL 'QCMDEXC'              70                                     CRT006
     C                     PARM           @CMDT                                               CRT006
     C                     PARM 80        @LEN                                                CRT006
      *                                                                                       CRT006
     C                     ENDSR                                                              CRT006
      *****************************************************************                       CRT006
      /EJECT                                                                                  CRT006
      *****************************************************************                       CRT006
      *  SRUCHK - Update PF/CHQBKPD                                   *                       CRT006
      *                                                               *                       CRT006
      *  called by:  SRDELD - Control Routine for Updates             *                       CRT006
      *                                                               *                       CRT006
      *****************************************************************                       CRT006
      *                                                                                       CRT006
     C           SRUCHK    BEGSR                                                              CRT006
      *                                                                                       CRT006
      ** Define key list                                                                      CRT006
      ** Cheque book details                                                                  CRT006
      *                                                                                       CRT006
     C           KLCQBK    KLIST                                                              CRT006
     C                     KFLD           KACNO  100                                          CRT006
     C                     KFLD           KSCQN   80                                          CRT006
      *                                                                                       CRT006
      ** Set up key - Move account number & Cheque Number from TTRANL2                        CRT006
      *                                                                                       CRT006
     C                     MOVE TRACNO    @ACNO                                               CRT006
     C                     MOVE CQNF      @CQNF   80                                          CRT006
      *                                                                                       CRT006
     C                     Z-ADD@ACNO     KACNO                                               CRT006
     C                     Z-ADD@CQNF     KSCQN                                               CRT006
      *                                                                                       CRT006
      ** Set limit greater than account no. & cheque no.                                      CRT006
      *                                                                                       CRT006
     C           KLCQBK    SETGTCHQBKPD                                                       CRT006
      *                                                                                       CRT006
     C                     READPCHQBKPD                  70                                   CRT006
      *                                                                                       CRT006
      ** If record found, release record                                                      CRT006
      *                                                                                       CRT006
     C           *IN70     IFEQ '0'                                                           CRT006
      *                                                                                       CRT006
      ** If retail account number equal to account number,                                    CRT006
      ** Add (no. of cheques -1) to start cheque no. to give the                              CRT006
      ** end cheque number                                                                    CRT006
      *                                                                                       CRT006
     C           ACNO      IFEQ @ACNO                                                         CRT006
     C           NOCQ      SUB  1         @ECQN   80                                          CRT006
     C                     ADD  SCQN      @ECQN                                               CRT006
      *                                                                                       CRT006
      ** If cheque number less than start cheque number                                       CRT006
      ** or cheque number greater than end cheque number                                      CRT006
      *                                                                                       CRT006
     C           @CQNF     IFLT SCQN                                                          CRT006
     C           @CQNF     ORGT @ECQN                                                         CRT006
     C                     MOVE *ON       *IN71                                               CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     ELSE                                                               CRT006
      *                                                                                       CRT006
     C                     MOVE *ON       *IN71                                               CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     ELSE                                                               CRT006
      *                                                                                       CRT006
     C                     MOVE *ON       *IN71                                               CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** If record not found, or retail account numbers not equal                             CRT006
      ** or cheque out of range - DB Error                                                    CRT006
      *                                                                                       CRT006
     C           *IN71     IFEQ '1'                                                           CRT006
     C           *LOCK     IN   LDA                        ************                       CRT006
     C                     Z-ADD45        DBASE            * DBERR 45 *                       CRT006
     C                     MOVE 'CHQBKPD' DBFILE           ************                       CRT006
     C                     MOVEL@CQBKY    DBKEY                                               CRT006
     C                     OUT  LDA                                                           CRT006
     C                     EXSR DBERR                                                         CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Move cheque presented array from file to array                                       CRT006
      *                                                                                       CRT006
     C                     MOVEACQPS      @CA                                                 CRT006
      *                                                                                       CRT006
      ** Calculate cheque presented status array index                                        CRT006
      *                                                                                       CRT006
     C           @CQNF     SUB  SCQN      @OFSET  80                                          CRT006
     C           @OFSET    DIV  8         @I      20                                          CRT006
     C                     MVR            @BITN   10                                          CRT006
     C                     ADD  1         @I                                                  CRT006
      *                                                                                       CRT006
      ** Test corresponding bit-position of element for cheque                                CRT006
      ** presented                                                                            CRT006
      *                                                                                       CRT006
     C           @BITN     IFEQ 0                                                             CRT006
     C                     BITOF'0'       @CA,@I                                              CRT006
     C                     ENDIF                                                              CRT006
     C           @BITN     IFEQ 1                                                             CRT006
     C                     BITOF'1'       @CA,@I                                              CRT006
     C                     ENDIF                                                              CRT006
     C           @BITN     IFEQ 2                                                             CRT006
     C                     BITOF'2'       @CA,@I                                              CRT006
     C                     ENDIF                                                              CRT006
     C           @BITN     IFEQ 3                                                             CRT006
     C                     BITOF'3'       @CA,@I                                              CRT006
     C                     ENDIF                                                              CRT006
     C           @BITN     IFEQ 4                                                             CRT006
     C                     BITOF'4'       @CA,@I                                              CRT006
     C                     ENDIF                                                              CRT006
     C           @BITN     IFEQ 5                                                             CRT006
     C                     BITOF'5'       @CA,@I                                              CRT006
     C                     ENDIF                                                              CRT006
     C           @BITN     IFEQ 6                                                             CRT006
     C                     BITOF'6'       @CA,@I                                              CRT006
     C                     ENDIF                                                              CRT006
     C           @BITN     IFEQ 7                                                             CRT006
     C                     BITOF'7'       @CA,@I                                              CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** Move array to file                                                                   CRT006
      *                                                                                       CRT006
     C                     MOVEA@CA       CQPS                                                CRT006
      *                                                                                       CRT006
      ** Update the record                                                                    CRT006
      *                                                                                       CRT006
     C                     UPDATCHQBKPDF                                                      CRT006
      *                                                                                       CRT006
     C                     ENDSR                                                              CRT006
      *****************************************************************                       CRT006
      /EJECT                                                                                  CRT006
      *****************************************************************                       CRT006
      *  SRUCHD - Update PF/CHQDPPD                                   *                       CRT006
      *                                                               *                       CRT006
      *  Called by: SRDELD - Control routine for updates              *                       CRT006
      *                                                               *                       CRT006
      *****************************************************************                       CRT006
      *                                                                                       CRT006
     C           SRUCHD    BEGSR                                                              CRT006
      *                                                                                       CRT006
      ** Define key list                                                                      CRT006
      ** Cheque deposited details                                                             CRT006
      *                                                                                       CRT006
     C           KLCQDP    KLIST                                                              CRT006
     C                     KFLD           KTLID                                               CRT006
     C                     KFLD           KTRNO                                               CRT006
     C                     KFLD           KSEQN                                               CRT006
      *                                                                                       CRT006
      ** If function code is one of the following                                             CRT006
      *                                                                                       CRT006
     C           FNCD      IFEQ '00H'                                                         CRT006
     C           FNCD      OREQ '0JH'                                                         CRT006
     C           FNCD      OREQ '00P'                                                         CRT006
     C           FNCD      OREQ '0JP'                                                         CRT006
      *                                                                                       CRT006
      ** And the clearing indicator of transaction type 2 is 'Y'                              CRT006
      *                                                                                       CRT006
     C           @CLIN2    ANDEQ'Y'                                                           CRT006
      *                                                                                       CRT006
      ** Move fields to key list                                                              CRT006
      *                                                                                       CRT006
     C                     MOVELTBID      KTLID                                               CRT006
     C                     Z-ADDTBTN      KTRNO                                               CRT006
      *                                                                                       CRT006
      ** If cheque number is blank                                                            CRT006
      *                                                                                       CRT006
     C           CQNF      IFEQ *BLANK                                                        CRT006
      *                                                                                       CRT006
     C                     Z-ADD*ZEROS    KSEQN                                               CRT006
      *                                                                                       CRT006
     C                     ELSE                                                               CRT006
      *                                                                                       CRT006
     C                     Z-ADD99999     KSEQN                                               CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** If function code is one of the following                                             CRT006
      *                                                                                       CRT006
     C           FNCD      IFEQ '00K'                                                         CRT006
     C           FNCD      OREQ '00R'                                                         CRT006
     C           FNCD      OREQ '0JK'                                                         CRT006
     C           FNCD      OREQ '0JR'                                                         CRT006
     C           FNCD      OREQ '00Q'                                                         CRT006
     C           FNCD      OREQ '0JQ'                                                         CRT006
      *                                                                                       CRT006
      ** And the clearing indicator of transaction type 2 is 'Y'                              CRT006
      *                                                                                       CRT006
     C           @CLIN1    ANDEQ'Y'                                                           CRT006
      *                                                                                       CRT006
      ** Move fields to key list                                                              CRT006
      *                                                                                       CRT006
     C                     MOVELTBID      KTLID                                               CRT006
     C                     Z-ADDTBTN      KTRNO                                               CRT006
      *                                                                                       CRT006
      ** If cheque number is blanks                                                           CRT006
      *                                                                                       CRT006
     C           CQNF      IFEQ *BLANK                                                        CRT006
      *                                                                                       CRT006
     C                     Z-ADD*ZEROS    KSEQN                                               CRT006
      *                                                                                       CRT006
     C                     ELSE                                                               CRT006
      *                                                                                       CRT006
     C                     Z-ADD99999     KSEQN                                               CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
      ** If Function Code is one of the following                                             CRT006
      *                                                                                       CRT006
     C           FNCD      IFEQ '00H'                                                         CRT006
     C           FNCD      OREQ '0JH'                                                         CRT006
     C           FNCD      OREQ '00P'                                                         CRT006
     C           FNCD      OREQ '0JP'                                                         CRT006
     C           FNCD      OREQ '00K'                                                         CRT006
     C           FNCD      OREQ '00R'                                                         CRT006
     C           FNCD      OREQ '0JK'                                                         CRT006
     C           FNCD      OREQ '0JR'                                                         CRT006
     C           FNCD      OREQ '00Q'                                                         CRT006
     C           FNCD      OREQ '0JQ'                                                         CRT006
      *                                                                                       CRT006
      ** Access record off PF/CHQDPPD                                                         CRT006
      *                                                                                       CRT006
     C           KLCQDP    CHAINCHQDPPD              70                                       CRT006
      *                                                                                       CRT006
      ** If record found - update the record                                                  CRT006
      *                                                                                       CRT006
     C           *IN70     IFEQ '0'                                                           CRT006
      *                                                                                       CRT006
     C                     MOVEL'*'       RECI                                                CRT006
     C                     MOVEL'R'       UPDI                                                CRT006
     C                     UPDATCHQDPPDF                                                      CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     ENDIF                                                              CRT006
      *                                                                                       CRT006
     C                     ENDSR                                                              CRT006
      *****************************************************************                       CRT006
      /EJECT
      /EJECT                                                                                  CRT012
      *****************************************************************                       CRT012
      *  SRACCH - Accumulate Charges                                  *                       CRT012
      *                                                               *                       CRT012
      *  Called by: GEN00N, GEN0KQ, GEN0HP, GENJKQ, GENJHP, GEN00O    *                       CRT012
      *             GEN00L, GEN0JO, GEN0JL, GEN0JI                    *                       CRT012
      *                                                               *                       CRT012
      *****************************************************************                       CRT012
      *                                                                                       CRT012
     C           SRACCH    BEGSR                                                              CRT012
      *                                                                                       CRT012
      * Read all records on TTCHGPD (up to 4) and accumulate all                              CRT012
      * the charges                                                                           CRT012
      *                                                                                       CRT012
     C                     Z-ADD0         TOTCHG 130                                          CRT012
     C           KFXCHG    SETLLTTCHGL0                                                       CRT012
     C           KFXCHG    READETTCHGL0                  55                                   CRT012
     C           *IN55     DOWEQ*OFF                                                          CRT012
     C                     ADD  AMT3      TOTCHG                                              CRT012
     C           KFXCHG    READETTCHGL0                  55                                   CRT012
     C                     ENDDO                                                              CRT012
      *                                                                                       CRT012
     C                     Z-ADD0         AMT3                                                CRT012
     C                     Z-ADDTOTCHG    AMT3                                                CRT012
      *                                                                                       CRT012
      * If there are any charges then set off *IN55                                           CRT012
     C           AMT3      IFNE 0                                                             CRT012
     C                     MOVE *OFF      *IN55                                               CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDSR                                                              CRT012
      *****************************************************************                       CRT012
      /EJECT                                                                                  CRT012
      *****************************************************************                       CRT012
      *  SRPMCH - Post Multiple Charges                               *                       CRT012
      *                                                               *                       CRT012
      *  Called by: GEN00N, GEN0KQ, GEN0HP, GENJKQ, GENJHP, GEN00O    *                       CRT012
      *             GEN00L, GEN0JO, GEN0JL, GEN0JI                    *                       CRT012
      *                                                               *                       CRT012
      *****************************************************************                       CRT012
      *                                                                                       CRT012
     C           SRPMCH    BEGSR                                                              CRT012
      *                                                                                       CRT012
      * Set up KLIST for CHAIN to Cashier Commission Transaction Types file                   CRT012
     C           KCCTT     KLIST                                                              CRT012
     C                     KFLD           K1CODE  2                                           CRT012
     C                     KFLD           K1CTRT  4                                           CRT012
     C                     KFLD           K1BRCH  3                                           CRT012
      *                                                                                       CRT012
      * Save charge amount                                                                    CRT012
     C                     Z-ADDAMT3      TOTAMT 150                                          CRT012
      * Read all records on TTCHGPD (up to 4) and accumulate all                              CRT012
      * the charges                                                                           CRT012
      *                                                                                       CRT012
     C           KFXCHG    SETLLTTCHGL0                                                       CRT012
     C           KFXCHG    READETTCHGL0                  55                                   CRT012
     C           *IN55     DOWEQ*OFF                                                          CRT012
      *                                                                                       CRT012
      * Access Cashier Commission Transaction Types to see if a match                         CRT012
      * is found.                                                                             CRT012
      * First CHAIN on Commission Code/Tran Type/Branch                                       CRT012
     C                     MOVELCODE      K1CODE                                              CRT012
     C                     MOVELCTRT      K1CTRT                                              CRT012
     C                     MOVELITLB      K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             55                                       CRT012
      *                                                                                       CRT012
      * If record found then set up charge code and posting amount and                        CRT012
      * execute SR/CHARGE. Then read next record on TTCHGL0.                                  CRT012
      * Otherwise CHAIN on Commission Code and Transaction Type                               CRT012
     C           *IN55     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * If VAT flag is 'N' then save Account Code, otherwise execute VAT                      CRT012
      * processing.                                                                           CRT012
     C           CCVATF    IFEQ 'N'                                                           CRT012
     C                     MOVE CCACOD    WCACOD  4                                           CRT012
     C                     Z-ADDAMT3      WCAMT  120                                          CRT012
      *                                                                                       CRT012
      * Only post if amount not zero.                                                         CRT012
     C           AMT3      IFNE 0                                                             CRT012
     C                     EXSR CHARGE                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR SRVATP                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     GOTO NXTCHG                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * Second CHAIN on Commission Code/Tran Type                                             CRT012
     C                     MOVE *BLANKS   K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             55                                       CRT012
      *                                                                                       CRT012
      * If record found then set up charge code and posting amount and                        CRT012
      * execute SR/CHARGE. Then read next record on TTCHGL0.                                  CRT012
      * Otherwise CHAIN on Commission Code and Branch                                         CRT012
     C           *IN55     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * If VAT flag is 'N' then save Account Code, otherwise execute VAT                      CRT012
      * processing.                                                                           CRT012
     C           CCVATF    IFEQ 'N'                                                           CRT012
     C                     MOVE CCACOD    WCACOD                                              CRT012
     C                     Z-ADDAMT3      WCAMT                                               CRT012
      * Only post if amount not zero.                                                         CRT012
     C           AMT3      IFNE 0                                                             CRT012
     C                     EXSR CHARGE                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR SRVATP                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     GOTO NXTCHG                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * Third CHAIN on Commission Code/Branch                                                 CRT012
     C                     MOVE *BLANKS   K1CTRT                                              CRT012
     C                     MOVELITLB      K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             55                                       CRT012
      *                                                                                       CRT012
      * If record found then set up charge code and posting amount and                        CRT012
      * execute SR/CHARGE. Then read next record on TTCHGL0.                                  CRT012
      * Otherwise CHAIN on Commission Code only                                               CRT012
     C           *IN55     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * If VAT flag is 'N' then save Account Code, otherwise execute VAT                      CRT012
      * processing.                                                                           CRT012
     C           CCVATF    IFEQ 'N'                                                           CRT012
     C                     MOVE CCACOD    WCACOD                                              CRT012
     C                     Z-ADDAMT3      WCAMT  120                                          CRT012
      * Only post if amount not zero.                                                         CRT012
     C           AMT3      IFNE 0                                                             CRT012
     C                     EXSR CHARGE                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR SRVATP                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     GOTO NXTCHG                                                        CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * Finally CHAIN on Commission Code only                                                 CRT012
     C                     MOVELCODE      K1CODE                                              CRT012
     C                     MOVE *BLANKS   K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             55                                       CRT012
      *                                                                                       CRT012
      * If record found then set up charge code and read next record                          CRT012
      * on TTCHGL0 otherwise execute SR CHARGE                                                CRT012
     C           *IN55     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * If VAT flag is 'N' then save Account Code, otherwise execute VAT                      CRT012
      * processing.                                                                           CRT012
     C           CCVATF    IFEQ 'N'                                                           CRT012
     C                     MOVE CCACOD    WCACOD                                              CRT012
     C                     Z-ADDAMT3      WCAMT                                               CRT012
      * Only post if amount not zero.                                                         CRT012
     C           AMT3      IFNE 0                                                             CRT012
     C                     EXSR CHARGE                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     ELSE                                                               CRT012
     C                     EXSR SRVATP                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     ELSE                                                               CRT012
     C                     MOVE @CSAC     WCACOD                                              CRT012
     C                     Z-ADDAMT3      WCAMT                                               CRT012
      * Only post if amount not zero.                                                         CRT012
     C           AMT3      IFNE 0                                                             CRT012
     C                     EXSR CHARGE                                                        CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           NXTCHG    TAG                                                                CRT012
     C           KFXCHG    READETTCHGL0                  55                                   CRT012
     C                     ENDDO                                                              CRT012
      *                                                                                       CRT012
      * Move charge amount back                                                               CRT012
     C                     Z-ADDTOTAMT    AMT3                                                CRT012
     C                     ENDSR                                                              CRT012
      *****************************************************************                       CRT012
      /EJECT                                                                                  CRT012
      *****************************************************************                       CRT012
      *  SRVATP - VAT Postings                                        *                       CRT012
      *                                                               *                       CRT012
      *  Called by:                                                   *                       CRT012
      *                                                               *                       CRT012
      *                                                               *                       CRT012
      *****************************************************************                       CRT012
      *                                                                                       CRT012
     C           SRVATP    BEGSR                                                              CRT012
      *                                                                                       CRT012
      * Only post a VAT record if the posting amount is not 0                                 CRT012
     C           AMT3      IFNE 0                                                             CRT012
      *                                                                                       CRT012
      *Set up Branch, Customer and A/C sequence for postings                                  CRT012
     C                     MOVE ITLB      @BRCA                                               CRT012
     C                     MOVE A8BICN    @CNUM                                               CRT012
     C                     Z-ADD1         @ACSQ                                               CRT012
     C                     MOVE ITLB      BRCA                                                CRT012
     C                     MOVE A8BICN    CNUM                                                CRT012
     C                     Z-ADD1         ACSQ                                                CRT012
      *                                                                                       CRT012
      * If Transaction currency is the same as local currency                                 CRT012
 B1  C           CCY3      IFEQ BJLCCY                                                        CRT012
      *                                                                                       CRT012
      * Currency is transaction currency and A/C is Cashier code                              CRT012
     C                     MOVE CCY3      @CCY                                                CRT012
     C                     MOVE CCACOD    @ACOD                                               CRT012
      *                                                                                       CRT012
      * Check A/C is a valid account and if not post to suspense A/C                          CRT012
     C           KLACNT    CHAINACCNTABF             70                                       CRT012
      *                                                                                       CRT012
 B2  C           *IN70     IFEQ *ON                                                           CRT012
     C                     MOVE @CSAC     @ACOD                                               CRT012
 E2  C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE @CCY      CCY                                                 CRT012
     C                     MOVE @ACOD     ACOD                                                CRT012
      *                                                                                       CRT012
      * Set up other fields on APOSTPD                                                        CRT012
     C                     MOVE 'P'       RECI                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C                     Z-ADD0         CHQN                                                CRT012
     C                     MOVE *BLANKS   TRAT                                                CRT012
     C                     Z-ADD1         DRCR                                                CRT012
     C                     Z-ADD0         ACNO                                                CRT012
     C                     Z-ADDBJRDNB    PSTD                                                CRT012
     C                     Z-ADDBJRDNB    VALD                                                CRT012
     C                     MOVE *BLANKS   TRAT                                                CRT012
     C                     MOVEL'  GE-TT' SPOS                                                CRT012
     C**********           Z-ADD0         ASOC                                         CRT012 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         RIND                                                CRT012
     C                     MOVELA1PASB    PBTT                                                CRT012
     C                     MOVE ITLB      ORBR                                                CRT012
     C                     Z-ADD0         ORAMT                                               CRT012
     C                     MOVE *BLANKS   TLIN                                                CRT012
     C                     MOVE *BLANKS   TRCCY                                               CRT012
      *                                                                                       CRT012
      **  Assign teller profit centre if anal acctg is available                              CRT012
      *                                                                                       CRT012
     C           BGN0ST    IFEQ 'Y'                                                           CRT012
     C                     MOVE FSTEPC    PRFC                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C**Initialize the extension ref file fields for EMU posting nar                          CRT012
     C                     MOVEL*BLANKS   XRFI                                                CRT012
     C                     Z-ADD0         XRFN                                                CRT012
      *                                                                                       CRT012
     C                     MOVELVATAC     ACOD                                                CRT012
     C                     MOVELACOD      @ACD                                                CRT012
     C                     EXSR GETACT                                                        CRT012
     C                     MOVELW#ACSC    ACSC                                                CRT012
      *                                                                                       CRT012
      * Set up Posting Narrative, first saving @N1620                                         CRT012
     C                     MOVE @N1620    WN1620  5                                           CRT012
     C                     MOVE '_TVA-'   @N1620                                              CRT012
     C                     MOVEL@NARDS    PNAR                                                CRT012
     C                     MOVE WN1620    @N1620                                              CRT012
      *                                                                                       CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
      *                                                                                       CRT012
      ** Perform hash totals on the VAT posting amount                                        CRT012
     C                     EXSR HSHTOT                                                        CRT012
      *                                                                                       CRT012
 X1  C                     ELSE                                                               CRT012
      * Transaction currency is not the same as local currency                                CRT012
      * Setup currency details to get the local currency a/c details                          CRT012
      * and Transaction currency                                                              CRT012
     C                     MOVELBJLCCY    @SCY                                                CRT012
     C                     EXSR SETCDT                                                        CRT012
      *                                                                                       CRT012
     C                     MOVELCCY3      @SCY                                                CRT012
     C                     EXSR SETCDT                                                        CRT012
      * Credit VAT amount in transaction currency to Spot Trade A/C                           CRT012
      *                                                                                       CRT012
      * Currency is transaction currency and A/C from DL ICD                                  CRT012
     C                     MOVE CCY3      @CCY                                                CRT012
     C                     MOVE @STRAC    @ACOD                                               CRT012
      *                                                                                       CRT012
      * Check A/C is a valid account and if not post to suspense A/C                          CRT012
     C           KLACNT    CHAINACCNTABF             70                                       CRT012
      *                                                                                       CRT012
 B2  C           *IN70     IFEQ *ON                                                           CRT012
     C                     MOVE @CSAC     @ACOD                                               CRT012
 E2  C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE @CCY      CCY                                                 CRT012
     C                     MOVE @ACOD     ACOD                                                CRT012
      *                                                                                       CRT012
      * Set up other fields on APOSTPD                                                        CRT012
     C                     MOVE 'P'       RECI                                                CRT012
     C                     Z-ADDAMT3      PSTA                                                CRT012
     C                     Z-ADD0         CHQN                                                CRT012
     C                     MOVE *BLANKS   TRAT                                                CRT012
     C                     Z-ADD1         DRCR                                                CRT012
     C                     Z-ADD0         ACNO                                                CRT012
     C                     Z-ADDBJRDNB    PSTD                                                CRT012
     C                     Z-ADDBJRDNB    VALD                                                CRT012
     C                     MOVE *BLANKS   TRAT                                                CRT012
     C                     MOVEL'  GE-TT' SPOS                                                CRT012
     C**********           Z-ADD0         ASOC                                         CRT012 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         RIND                                                CRT012
     C                     MOVELA1PASB    PBTT                                                CRT012
     C                     MOVE ITLB      ORBR                                                CRT012
     C                     Z-ADD0         ORAMT                                               CRT012
     C                     MOVE *BLANKS   TLIN                                                CRT012
     C                     MOVE *BLANKS   TRCCY                                               CRT012
      *                                                                                       CRT012
      **  Assign teller profit centre if anal acctg is available                              CRT012
      *                                                                                       CRT012
     C           BGN0ST    IFEQ 'Y'                                                           CRT012
     C                     MOVE FSTEPC    PRFC                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C**Initialize the extension ref file fields for EMU posting nar                          CRT012
     C                     MOVEL*BLANKS   XRFI                                                CRT012
     C                     Z-ADD0         XRFN                                                CRT012
      *                                                                                       CRT012
     C                     MOVELACOD      @ACD                                                CRT012
     C                     EXSR GETACT                                                        CRT012
     C                     MOVELW#ACSC    ACSC                                                CRT012
      *                                                                                       CRT012
      * Set up Posting Narrative, first saving @N1620                                         CRT012
     C                     MOVE @N1620    WN1620  5                                           CRT012
     C                     MOVE '_TVA-'   @N1620                                              CRT012
     C                     MOVEL@NARDS    PNAR                                                CRT012
     C                     MOVE WN1620    @N1620                                              CRT012
      *                                                                                       CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
      *                                                                                       CRT012
      * Debit VAT amount in local currency to Spot Trade A/C                                  CRT012
      *                                                                                       CRT012
      ** Perform hash totals on the VAT posting amount                                        CRT012
     C                     EXSR HSHTOT                                                        CRT012
      *                                                                                       CRT012
      * Set up fields for Transaction currency to pass to RTCONV                              CRT012
      * Obtain details of Transaction currency                                                CRT012
     C           CCY3      LOKUPCYC,I                    69                                   CRT012
     C                     MOVELCYC,I     @TCCY                                               CRT012
     C                     Z-ADDAMT2      @TCAM                                               CRT012
     C                     Z-ADDCDP,I     @TCDP                                               CRT012
     C                     MOVELCMD,I     @TCMD                                               CRT012
     C                     Z-ADDSPT,I     @EXRT                                               CRT012
     C                     MOVE @BSCY     @BSCY                                               CRT012
      *                                                                                       CRT012
      * Save A/C code for Base ccy equiv of transaction ccy                                   CRT012
     C                     MOVE TEQ,I     TEQTRN  4                                           CRT012
      *                                                                                       CRT012
      * Obtain details of Local currency                                                      CRT012
     C           BJLCCY    LOKUPCYC,I                    69                                   CRT012
     C                     MOVELCYC,I     @EQCY                                               CRT012
     C                     Z-ADDCDP,I     @EQDP                                               CRT012
     C                     MOVELCMD,I     @EQMD                                               CRT012
      *                                                                                       CRT012
      * Save A/C code for Base ccy equiv of local ccy                                         CRT012
     C                     MOVE TEQ,I     TEQLOC  4                                           CRT012
      *                                                                                       CRT012
     C                     EXSR RTCONV                                                        CRT012
      *                                                                                       CRT012
      * Currency is local currency                                                            CRT012
     C                     MOVE BJLCCY    @CCY                                                CRT012
      *                                                                                       CRT012
      * Check A/C is a valid account and if not post to suspense A/C                          CRT012
     C           KLACNT    CHAINACCNTABF             70                                       CRT012
      *                                                                                       CRT012
 B2  C           *IN70     IFEQ *ON                                                           CRT012
     C                     MOVE @CSAC     @ACOD                                               CRT012
 E2  C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE @CCY      CCY                                                 CRT012
     C                     MOVE @ACOD     ACOD                                                CRT012
      *                                                                                       CRT012
      * Set up fields on APOSTPD that are different from CR posting                           CRT012
      * to Spot Trade A/C in Transaction ccy.                                                 CRT012
     C                     Z-ADD@EQAM     PSTA                                                CRT012
     C                     Z-ADD0         DRCR                                                CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
      *                                                                                       CRT012
      ** Perform hash totals on the VAT posting amount                                        CRT012
     C                     EXSR HSHTOT                                                        CRT012
      *                                                                                       CRT012
      * Credit VAT amount converted to local currency to VAT A/C                              CRT012
      *                                                                                       CRT012
      * A/C is from Cashier Code table                                                        CRT012
     C                     MOVE CCACOD    @ACOD                                               CRT012
      *                                                                                       CRT012
      * Check A/C is a valid account and if not post to suspense A/C                          CRT012
     C           KLACNT    CHAINACCNTABF             70                                       CRT012
      *                                                                                       CRT012
 B2  C           *IN70     IFEQ *ON                                                           CRT012
     C                     MOVE @CSAC     @ACOD                                               CRT012
 E2  C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE @ACOD     ACOD                                                CRT012
      *                                                                                       CRT012
      * All other fields are same as DR Spot Trade posting apart from Dr/Cr ind.              CRT012
     C                     Z-ADD1         DRCR                                                CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
      *                                                                                       CRT012
      ** Perform hash totals on the VAT posting amount                                        CRT012
     C                     EXSR HSHTOT                                                        CRT012
      *                                                                                       CRT012
      * Debit VAT amount converted to base currency to Base CCY Equiv                         CRT012
      * of Transaction CCY A/C.                                                               CRT012
      *                                                                                       CRT012
      * Obtain details of Base currency                                                       CRT012
     C           @BSCY     LOKUPCYC,I                    69                                   CRT012
     C                     MOVELCYC,I     @EQCY                                               CRT012
     C                     Z-ADDCDP,I     @EQDP                                               CRT012
     C                     MOVELCMD,I     @EQMD                                               CRT012
      *                                                                                       CRT012
     C                     EXSR RTCONV                                                        CRT012
      *                                                                                       CRT012
      * Currency is base currency                                                             CRT012
     C                     MOVE @BSCY     @CCY                                                CRT012
      *                                                                                       CRT012
      * Check A/C is a valid account and if not post to suspense A/C                          CRT012
     C                     MOVE TEQTRN    @ACOD                                               CRT012
      *                                                                                       CRT012
     C           KLACNT    CHAINACCNTABF             70                                       CRT012
      *                                                                                       CRT012
 B2  C           *IN70     IFEQ *ON                                                           CRT012
     C                     MOVE @CSAC     @ACOD                                               CRT012
 E2  C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE @CCY      CCY                                                 CRT012
     C                     MOVE @ACOD     ACOD                                                CRT012
      *                                                                                       CRT012
      * Set up fields on APOSTPD that are different from CR posting                           CRT012
      * to Spot Trade A/C in Transaction ccy.                                                 CRT012
     C                     Z-ADD@EQAM     PSTA                                                CRT012
     C                     Z-ADD0         DRCR                                                CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
      *                                                                                       CRT012
      * Credit VAT amount converted to base currency to Base CCY Equiv                        CRT012
      * of Local CCY A/C.                                                                     CRT012
     C                     MOVE TEQLOC    @ACOD                                               CRT012
      *                                                                                       CRT012
      * Check A/C is a valid account and if not post to suspense A/C                          CRT012
     C           KLACNT    CHAINACCNTABF             70                                       CRT012
      *                                                                                       CRT012
 B2  C           *IN70     IFEQ *ON                                                           CRT012
     C                     MOVE @CSAC     @ACOD                                               CRT012
 E2  C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     MOVE @ACOD     ACOD                                                CRT012
      *                                                                                       CRT012
      * Set up fields on APOSTPD that are different from CR posting                           CRT012
      * to Spot Trade A/C in Transaction ccy.                                                 CRT012
     C                     Z-ADD1         DRCR                                                CRT012
     C                     WRITEAPOSTPDF                                                      CRT012
      *                                                                                       CRT012
 E1  C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                     BUG27119
     C                     ENDSR                                                              CRT012
      *****************************************************************                       CRT012
      /EJECT                                                                                  CRT012
      *****************************************************************                       CRT012
      *  SRRPFA - Retail Posting For Full Amount                      *                       CRT012
      *                                                               *                       CRT012
      *  Called by:                                                   *                       CRT012
      *                                                               *                       CRT012
      *                                                               *                       CRT012
      *****************************************************************                       CRT012
      *                                                                                       CRT012
     C           SRRPFA    BEGSR                                                              CRT012
      *                                                                                       CRT012
     C                     MOVELITLB      KITLB                                               CRT012
     C                     MOVELCSHTT     KCSHTT                                              CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C           *IN84     IFEQ *ON                                                           CRT012
     C                     MOVE *BLANKS   KITLB                                               CRT012
     C           KBRCT     CHAINSDCTPOL0             84                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * If Use value date flag is 'Y'                                                         CRT012
     C           CPVALD    IFEQ 'Y'                                                           CRT012
     C                     Z-ADDVLDT      VALD                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * If Standard Days field is filled add or subtract this                                 CRT012
      * number of working days from value date.                                               CRT012
     C           CPSTDY    IFNE ' '                                                           CRT012
      *                                                                                       CRT012
     C                     Z-ADD0         ZDYNBR                                              CRT012
     C                     Z-ADDVALD      ZDAYNO  50                                          CRT012
     C                     MOVE CPSTDY    ZNRDYS  20                                          CRT012
     C           CPPLMI    IFEQ '-'                                                           CRT012
     C                     MOVELBJLCCY    ZCCY    3                                           CRT012
     C                     EXSR ZBKDT                                                         CRT012
      *                                                                                       CRT012
     C                     Z-ADDZDYNBR    VALD                                                CRT012
      *                                                                                       CRT012
     C                     ELSE                                                               CRT012
     C                     CALL 'ZFWDT'                                                       CRT012
     C                     PARM           ZDAYNO                                              CRT012
     C                     PARM           ZNRDYS                                              CRT012
     C                     PARM           ZDYNBR  50                                          CRT012
     C                     PARM           BJLCCY                                              CRT012
     C                     PARM           BJSLCD                                              CRT012
      *                                                                                       CRT012
     C                     Z-ADDZDYNBR    VALD                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * If Include cheque clearing days is 'Y' then add this number to                        CRT012
      * the value date. Only to be done for cheques                                           CRT012
     C           FNCD      IFEQ '00K'                                                         CRT012
     C           FNCD      OREQ '00Q'                                                         CRT012
     C           FNCD      OREQ '00R'                                                         CRT012
     C           FNCD      OREQ '0JK'                                                         CRT012
     C           FNCD      OREQ '0JQ'                                                         CRT012
     C           FNCD      OREQ '0JR'                                                         CRT012
     C           FNCD      OREQ '00L'                                                         CRT012
     C           FNCD      OREQ '00W'                                                         CRT012
     C           FNCD      OREQ '0JL'                                                         CRT012
     C           FNCD      OREQ '0JW'                                                         CRT012
     C           CPCHQC    IFEQ 'Y'                                                           CRT012
      * Obtain cheque clearing days for local currency, then re-access                        CRT012
      * SDCURR with currenct value of A6CYCD.                                                 CRT012
     C                     MOVE A6CYCD    W6CYCD  3                                           CRT012
      *                                                                                       CRT012
     C                     CALL 'AOCURRR0'                                                    CRT012
     C                     PARM *BLANKS   @RTCD                                               CRT012
     C                     PARM '*KEY   ' @OPTN                                               CRT012
     C                     PARM           BJLCCY                                              CRT012
     C           SDCURR    PARM SDCURR    DSSDY                                               CRT012
     C                     ADD  A6CQCD    VALD                                                CRT012
      *                                                                                       CRT012
     C                     Z-ADD0         ZDYNBR                                              CRT012
     C                     Z-ADDVALD      ZDAYNO  50                                          CRT012
     C                     Z-ADDA6CQCD    ZNRDYS  20                                          CRT012
      *
     C                     CALL 'ZFWDT'                                                       CRT012
     C                     PARM           ZDAYNO                                              CRT012
     C                     PARM           ZNRDYS                                              CRT012
     C                     PARM           ZDYNBR  50                                          CRT012
     C                     PARM           BJLCCY                                              CRT012
     C                     PARM           BJSLCD                                              CRT012
      *                                                                                       CRT012
     C                     Z-ADDZDYNBR    VALD                                                CRT012
      *
     C                     CALL 'AOCURRR0'                                                    CRT012
     C                     PARM *BLANKS   @RTCD                                               CRT012
     C                     PARM '*KEY   ' @OPTN                                               CRT012
     C                     PARM           W6CYCD                                              CRT012
     C           SDCURR    PARM SDCURR    DSSDY                                               CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * If Narrative Code has been entered then overwrite narrative                           CRT012
      * with narative from Narrative Table.                                                   CRT012
     C                     MOVE *BLANKS   FAPNAR                                              CRT012
     C           CPNARR    IFNE *BLANKS                                                       CRT012
     C                     CALL 'AONARRR0'                                                    CRT012
     C                     PARM           @RTCD                                               CRT012
     C                     PARM '*KEY'    @OPTN                                               CRT012
     C                     PARM           CPNARR                                              CRT012
     C           SDNARR    PARM SDNARR    DSFDY                                               CRT012
      *                                                                                       CRT012
      * Set up narrative                                                                      CRT012
     C           @RTCD     IFEQ *BLANKS                                                       CRT012
     C                     MOVELTBID      PN1                                                 CRT012
     C                     MOVE '/'       PN4                                                 CRT012
     C                     MOVELTBTN      PN5                                                 CRT012
     C                     MOVELALDON     PN11                                                CRT012
     C                     MOVELPN        PNAR                                                CRT012
     C                     MOVELPN        FAPNAR 30                                           CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDSR                                                              CRT012
      *****************************************************************                       CRT012
      /EJECT                                                                                  CRT012
      *****************************************************************                       CRT012
      *  SRRPCA - Retail Posting For Charge Amount                    *                       CRT012
      *                                                               *                       CRT012
      *  Called by:                                                   *                       CRT012
      *                                                               *                       CRT012
      *                                                               *                       CRT012
      *****************************************************************                       CRT012
      *                                                                                       CRT012
     C           SRRPCA    BEGSR                                                              CRT012
      *                                                                                       CRT012
     C                     MOVEL*BLANKS   K1CODE                                              CRT012
     C                     MOVELCTRT      K1CTRT                                              CRT012
     C                     MOVELITLB      K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             85                                       CRT012
      *                                                                                       CRT012
     C           *IN85     IFEQ *ON                                                           CRT012
      *                                                                                       CRT012
     C                     MOVE *BLANKS   K1BRCH                                              CRT012
     C           KCCTT     CHAINSDBACTL0             85                                       CRT012
     C           *IN85     IFEQ *ON                                                           CRT012
      *                                                                                       CRT012
     C                     MOVELITLB      K1BRCH                                              CRT012
     C                     MOVE *BLANKS   K1CODE                                              CRT012
     C           KCCTT     CHAINSDBACTL0             85                                       CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C           *IN85     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * If Value date for commission is filled add or subtract this                           CRT012
      * number of working days from Posting Date                                              CRT012
     C                     Z-ADDPSTD      VALD                                                CRT012
     C           CCSTDY    IFNE ' '                                                           CRT012
      *                                                                                       CRT012
     C                     Z-ADD0         ZDYNBR                                              CRT012
     C                     Z-ADDVALD      ZDAYNO  50                                          CRT012
     C                     MOVE CCSTDY    ZNRDYS  20                                          CRT012
     C           CCPLMI    IFEQ '-'                                                           CRT012
     C                     MOVELBJLCCY    ZCCY    3                                           CRT012
     C                     EXSR ZBKDT                                                         CRT012
      *                                                                                       CRT012
     C                     Z-ADDZDYNBR    VALD                                                CRT012
      *                                                                                       CRT012
     C                     ELSE                                                               CRT012
     C                     CALL 'ZFWDT'                                                       CRT012
     C                     PARM           ZDAYNO                                              CRT012
     C                     PARM           ZNRDYS                                              CRT012
     C                     PARM           ZDYNBR  50                                          CRT012
     C                     PARM           BJLCCY                                              CRT012
     C                     PARM           BJSLCD                                              CRT012
      *                                                                                       CRT012
     C                     Z-ADDZDYNBR    VALD                                                CRT012
     C                     ENDIF                                                              CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * If Narrative Code has been entered then overwrite narrative                           CRT012
      * with narative from Narrative Table.                                                   CRT012
     C           CCNARR    IFNE *BLANKS                                                       CRT012
     C                     CALL 'AONARRR0'                                                    CRT012
     C                     PARM           @RTCD                                               CRT012
     C                     PARM '*KEY'    @OPTN                                               CRT012
     C                     PARM           CCNARR                                              CRT012
     C           SDNARR    PARM SDNARR    DSFDY                                               CRT012
      *                                                                                       CRT012
      * Set up narrative                                                                      CRT012
     C           @RTCD     IFEQ *BLANKS                                                       CRT012
     C                     MOVELTBID      PN1                                                 CRT012
     C                     MOVE '/'       PN4                                                 CRT012
     C                     MOVELTBTN      PN5                                                 CRT012
     C                     MOVELALDON     PN11                                                CRT012
     C                     MOVELPN        PNAR                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDSR                                                              CRT012
      *****************************************************************                       CRT012
      /EJECT                                                                                  CRT012
      *****************************************************************                       CRT012
      *  SRIPFA - Internal Posting For Full Amount                    *                       CRT012
      *                                                               *                       CRT012
      *  Called by:                                                   *                       CRT012
      *                                                               *                       CRT012
      *                                                               *                       CRT012
      *****************************************************************                       CRT012
      *                                                                                       CRT012
     C           SRIPFA    BEGSR                                                              CRT012
      *                                                                                       CRT012
     C           *IN84     IFEQ *OFF                                                          CRT012
      *                                                                                       CRT012
      * Overwrite A/C code and A/C seq with values from SDCTPOPD                              CRT012
      * only if account code is not blank                                                     CRT012
     C           CPACOD    IFNE 0                                                             CRT012
     C                     MOVELCPACOD    ACOD                                                CRT012
     C                     MOVELCPACSQ    ACSQ                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
      * If Use Customer number in Account flag is 'Y' replace
      * branch internal customer with customer of transaction (this
      * was saved when retail posting was made).
     C           CPCUST    IFEQ 'Y'
     C**********           Z-ADDTRCNUM    CNUM                                                CSD027
     C                     MOVE TRCNUM    CNUM                                                CSD027
     C                     ENDIF
      *
      * If Narrative has been set up for retail posting of full amount                        CRT012
      * use same narrative for internal posting.                                              CRT012
     C           FAPNAR    IFNE *BLANKS                                                       CRT012
     C                     MOVELFAPNAR    PNAR                                                CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDIF                                                              CRT012
      *                                                                                       CRT012
     C                     ENDSR                                                              CRT012
      *****************************************************************                       CRT012
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  PROEX2 - Process exchange transactions for house cheque      *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           PROEX2    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE @CCY2     CCY2                                                CRE019
      *                                                                                       CRE019
      ** Initialise flag to indicate generation of trade eq.                                  CRE019
      *                                                                                       CRE019
     C                     MOVE *BLANK    TRADE                                               CRE019
      *                                                                                       CRE019
      ** IF same transaction and base ccy and eq.a/c is nonzero                               CRE019
      ** OR same house and base ccy and eq.a/c is nonzero                                     CRE019
      ** OR neither transaction nor house ccy is base                                         CRE019
      *                                                                                       CRE019
     C           CCY1      IFEQ @BSCY                                                         CRE019
     C           @BEQ      ANDNE*ZEROS                                                        CRE019
     C           CCY2      OREQ @BSCY                                                         CRE019
     C           @BEQ      ANDNE*ZEROS                                                        CRE019
     C           CCY1      ORNE @BSCY                                                         CRE019
     C           CCY2      ANDNE@BSCY                                                         CRE019
     C                     MOVE 'Y'       TRADE   1                                           CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Generate Spot Trade                                                                  CRE019
      *                                                                                       CRE019
     C           TRADE     IFEQ 'Y'                                                           CRE019
     C           CCY1      ORNE @BSCY                                                         CRE019
     C                     EXSR SHCP1                                                         CRE019
     C                     EXSR SHCP2                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           TRADE     IFEQ 'Y'                                                           CRE019
     C           CCY2      ORNE @BSCY                                                         CRE019
     C                     EXSR SHCP3                                                         CRE019
     C                     EXSR SHCP4                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  SHCP1 - Generates the spot trade entry for the transaction   *                       CRE019
      *          currency                                             *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           SHCP1     BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     EXSR MOVEXC                                                        CRE019
      *                                                                                       CRE019
     C                     MOVELCCY1      CCY                                                 CRE019
      *                                                                                       CRE019
     C           FNCD      IFEQ '00Q'                                                         CRE019
     C           FNCD      OREQ '0JQ'                                                         CRE019
     C                     Z-ADDAMT1      PSTA                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           FNCD      IFEQ '00P'                                                         CRE019
     C           FNCD      OREQ '0JP'                                                         CRE019
     C                     Z-ADDAMT2      PSTA                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         DRCR                                                CRE019
      *                                                                                       CRE019
      ** If a/c type is 'R'                                                                   CRE019
      *                                                                                       CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
      *                                                                                       CRE019
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'                         CRE019
      ** currency, execute subroutine SRNARR                                                  CRE019
      *                                                                                       CRE019
     C           CEU024    IFEQ 'Y'                                                           CRE019
     C           CEU013    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
      ** or CEU025 is on and CEU013 is on                                                     CRE019
      *                                                                                       CRE019
     C           CEU025    OREQ 'Y'                                                           CRE019
     C           CEU013    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
     C                     Z-ADD1         A                                                   CRE019
     C           CCY1      LOKUPCURR,A                   86                                   CRE019
     C                     Z-ADD1         A                                                   CRE019
     C           CCY2      LOKUPCURR,A                   87                                   CRE019
      *                                                                                       CRE019
     C           *IN86     IFEQ *ON                                                           CRE019
     C           *IN87     ANDEQ*ON                                                           CRE019
     C                     EXSR SRNARR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVELACOD      @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVELW#ACSC    ACSC                                                CRE019
      *                                                                                       CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Store the narration for the next entry                                               CRE019
     C                     MOVE *BLANK    @PNAR                                               CRE019
     C                     MOVELPNAR      @PNAR                                               CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  SHCP2 - Generates the spot trade equivalent entry for the    *                       CRE019
      *          transaction currency                                 *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           SHCP2     BEGSR                                                              CRE019
      *                                                                                       CRE019
      ** Determine spot trade equivalent account                                              CRE019
      *                                                                                       CRE019
     C                     MOVELCCY1      @SCY                                                CRE019
     C                     EXSR SETCDT                                                        CRE019
     C                     MOVELTEQ,I     @TEQ                                                CRE019
      ** Get account type for trade eq. a/c code                                              CRE019
     C                     MOVELTEQ,I     @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVEL@ACT      @EQACT                                              CRE019
      ** Set up fields                                                                        CRE019
     C                     EXSR MOVEXC                                                        CRE019
      *                                                                                       CRE019
     C                     Z-ADD@TEQ      ACOD                                                CRE019
     C                     MOVEL@BSCY     CCY                                                 CRE019
     C                     MOVEL@EQACT    ATYP                                                CRE019
      *                                                                                       CRE019
      ** Setup posting amount field                                                           CRE019
      *                                                                                       CRE019
     C                     SELEC                                                              CRE019
      *                                                                                       CRE019
      ** Base and house currencies are the same                                               CRE019
      *                                                                                       CRE019
     C           CCY2      WHEQ @BSCY                                                         CRE019
     C                     Z-ADDSPSTA     PSTA                                                CRE019
      *                                                                                       CRE019
      ** Base and transaction currencies are the same                                         CRE019
      *                                                                                       CRE019
     C           CCY1      WHEQ @BSCY                                                         CRE019
     C                     Z-ADDSORAMT    PSTA                                                CRE019
      *                                                                                       CRE019
      ** Base and house currencies are not the same                                           CRE019
      ** Base and transaction currencies are not the same                                     CRE019
      *                                                                                       CRE019
     C                     OTHER                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE CCY1      @TCCY                                               CRE019
     C                     Z-ADDSORAMT    @TCAM                                               CRE019
     C                     Z-ADDCDP,I     @TCDP                                               CRE019
     C                     MOVE CMD,I     @TCMD                                               CRE019
     C                     MOVE @BSCY     @EQCY                                               CRE019
     C                     Z-ADD@BDP      @EQDP                                               CRE019
     C                     MOVE @BMD      @EQMD                                               CRE019
     C                     Z-ADDSPT,I     @EXRT                                               CRE019
      *                                                                                       CRE019
     C                     EXSR RTCONV                                                        CRE019
      *                                                                                       CRE019
     C                     Z-ADD@EQAM     @BSCEQ                                              CRE019
     C                     Z-ADD@BSCEQ    PSTA                                                CRE019
      *                                                                                       CRE019
     C                     ENDSL                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADD1         DRCR                                                CRE019
      *                                                                                       CRE019
      ** If a/c type is 'R'                                                                   CRE019
      *                                                                                       CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     END                                                                CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
      *                                                                                       CRE019
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'                         CRE019
      ** currency, execute subroutine SRNARR                                                  CRE019
      *                                                                                       CRE019
     C           CEU024    IFEQ 'Y'                                                           CRE019
     C           CEU013    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
      ** or CEU025 is on and CEU013 is on                                                     CRE019
      *                                                                                       CRE019
     C           CEU025    OREQ 'Y'                                                           CRE019
     C           CEU013    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
     C                     Z-ADD1         A                                                   CRE019
     C           CCY1      LOKUPCURR,A                   86                                   CRE019
     C                     Z-ADD1         A                                                   CRE019
     C           CCY2      LOKUPCURR,A                   87                                   CRE019
      *                                                                                       CRE019
     C           *IN86     IFEQ *ON                                                           CRE019
     C           *IN87     ANDEQ*ON                                                           CRE019
     C                     EXSR SRNARR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVELACOD      @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVELW#ACSC    ACSC                                                CRE019
      *                                                                                       CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  SHCP3 - Generates the spot trade entry for the house cheque  *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           SHCP3     BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     EXSR MOVEXC                                                        CRE019
      *                                                                                       CRE019
     C                     MOVELCCY2      CCY                                                 CRE019
      *                                                                                       CRE019
      ** Set PSTA to correct amount field                                                     CRE019
      *                                                                                       CRE019
     C                     Z-ADDSPSTA     PSTA                                                CRE019
      *                                                                                       CRE019
     C                     Z-ADD1         DRCR                                                CRE019
      *                                                                                       CRE019
      ** If a/c type is 'R'                                                                   CRE019
      *                                                                                       CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
      *                                                                                       CRE019
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'                         CRE019
      ** currency, execute subroutine SRNARR                                                  CRE019
      *                                                                                       CRE019
     C           CEU024    IFEQ 'Y'                                                           CRE019
     C           CEU013    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
      ** or CEU025 is on and CEU013 is on                                                     CRE019
      *                                                                                       CRE019
     C           CEU025    OREQ 'Y'                                                           CRE019
     C           CEU013    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
     C                     Z-ADD1         A                                                   CRE019
     C           CCY1      LOKUPCURR,A                   86                                   CRE019
     C                     Z-ADD1         A                                                   CRE019
     C           CCY2      LOKUPCURR,A                   87                                   CRE019
      *                                                                                       CRE019
     C           *IN86     IFEQ *ON                                                           CRE019
     C           *IN87     ANDEQ*ON                                                           CRE019
     C                     EXSR SRNARR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEL@ACOD2    @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVELW#ACSC    ACSC                                                CRE019
      *                                                                                       CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Store the narration for the next entry                                               CRE019
     C                     MOVE *BLANK    @PNAR                                               CRE019
     C                     MOVELPNAR      @PNAR                                               CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  SHCP4 - Generates the spot trade equivalent entry for the    *                       CRE019
      *          house cheque account                                 *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           SHCP4     BEGSR                                                              CRE019
      *                                                                                       CRE019
      ** Determine spot trade equivalent account                                              CRE019
      *                                                                                       CRE019
     C                     MOVELCCY2      @SCY                                                CRE019
     C                     EXSR SETCDT                                                        CRE019
     C                     MOVELTEQ,I     @TEQ                                                CRE019
      ** Get account type for trade eq. a/c code                                              CRE019
     C                     MOVELTEQ,I     @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVEL@ACT      @EQACT                                              CRE019
      ** Set up fields                                                                        CRE019
     C                     EXSR MOVEXC                                                        CRE019
      *                                                                                       CRE019
     C                     Z-ADD@TEQ      ACOD                                                CRE019
     C                     MOVEL@BSCY     CCY                                                 CRE019
     C                     MOVEL@EQACT    ATYP                                                CRE019
      *                                                                                       CRE019
      ** Setup posting amount field                                                           CRE019
      *                                                                                       CRE019
     C                     SELEC                                                              CRE019
      *                                                                                       CRE019
      ** Base and house currencies are the same                                               CRE019
      *                                                                                       CRE019
     C           CCY2      WHEQ @BSCY                                                         CRE019
     C                     Z-ADDSPSTA     PSTA                                                CRE019
      *                                                                                       CRE019
      ** Base and transaction currencies are the same                                         CRE019
      *                                                                                       CRE019
     C           CCY1      WHEQ @BSCY                                                         CRE019
     C                     Z-ADDSORAMT    PSTA                                                CRE019
      *                                                                                       CRE019
      ** Base and house currencies are not the same                                           CRE019
      ** Base and transaction currencies are not the same                                     CRE019
      *                                                                                       CRE019
     C                     OTHER                                                              CRE019
     C                     Z-ADD@BSCEQ    PSTA                                                CRE019
     C                     ENDSL                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         DRCR                                                CRE019
      *                                                                                       CRE019
      ** If a/c type is 'R'                                                                   CRE019
      *                                                                                       CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     END                                                                CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
      *                                                                                       CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
      *                                                                                       CRE019
      ** If CEU024 is on and CEU013 is on and the currencies are 'in'                         CRE019
      ** currency, execute subroutine SRNARR                                                  CRE019
      *                                                                                       CRE019
     C           CEU024    IFEQ 'Y'                                                           CRE019
     C           CEU013    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
      ** or CEU025 is on and CEU013 is on                                                     CRE019
      *                                                                                       CRE019
     C           CEU025    OREQ 'Y'                                                           CRE019
     C           CEU013    ANDEQ'Y'                                                           CRE019
      *                                                                                       CRE019
     C                     Z-ADD1         A                                                   CRE019
     C           CCY1      LOKUPCURR,A                   86                                   CRE019
     C                     Z-ADD1         A                                                   CRE019
     C           CCY2      LOKUPCURR,A                   87                                   CRE019
      *                                                                                       CRE019
     C           *IN86     IFEQ *ON                                                           CRE019
     C           *IN87     ANDEQ*ON                                                           CRE019
     C                     EXSR SRNARR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVELACOD      @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVELW#ACSC    ACSC                                                CRE019
      *                                                                                       CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  MOV005 - Process cash/house cheque deposits                  *                       CRE019
      *         - Debit postings                                      *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           MOV005    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@CNUM2    CNUM                                         CRE019 CSD027
     C                     MOVE @CNUM2    CNUM                                                CSD027
     C                     MOVEL@CCY2     CCY                                                 CRE019
     C                     MOVE @ACOD2    ACOD                                                CRE019
     C                     Z-ADD@ACSQ2    ACSQ                                                CRE019
     C                     MOVEL@ATYP2    ATYP                                                CRE019
     C                     MOVEL@STYP2    STYP                                                CRE019
     C                     MOVE @BRCA2    BRCA                                                CRE019
     C                     MOVE HCAC      ACNO                                                CRE019
     C                     Z-ADDBJRDNB    PSTD                                                CRE019
     C                     MOVEL@TTYPH    TRAT                                                CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     MOVEL'N'       GETP                                                CRE019
     C                     MOVEL'  GE-TT' SPOS                                                CRE019
     C                     Z-ADD235959    PTIM                                                CRE019
     C                     MOVEL'Y'       TLIN                                                CRE019
     C                     MOVE ITLB      ORBR                                                CRE019
      *                                                                                       CRE019
      ** Set up narrative                                                                     CRE019
      *                                                                                       CRE019
     C                     MOVELA1RTNM    @TTNMH                                             BUG8510
     C                     MOVEL@TTNMH    PNAR                                                CRE019
     C           CQNF      IFNE *BLANKS                                                      BUG9062
     C                     MOVE *BLANKS   WRK10                                             MD055860
     C                     MOVE WRK10     PNAR                                              MD055860
     C                     MOVE CQNF      PNAR                                               BUG9062
     C                     ENDIF                                                             BUG9062
      *                                                                                       CRE019
     C           FNCD      IFEQ '00Q'                                                         CRE019
     C           FNCD      OREQ '0JQ'                                                         CRE019
     C                     Z-ADDAMT1      ORAMT                                               CRE019
     C                     ENDIF                                                              CRE019
     C           FNCD      IFEQ '00P'                                                         CRE019
     C           FNCD      OREQ '0JP'                                                         CRE019
     C                     Z-ADDAMT2      ORAMT                                               CRE019
     C                     ENDIF                                                              CRE019
     C           CCY1      IFEQ @CCY2                                                         CRE019
     C                     Z-ADDORAMT     PSTA                                                CRE019
     C                     ELSE                                                               CRE019
     C                     MOVELCCY1      WFRCCY                                              CRE019
     C                     MOVEL@CCY2     WTOCCY                                              CRE019
     C                     Z-ADDORAMT     WAMNTI                                              CRE019
     C                     Z-ADD0         WAMNTO                                              CRE019
     C                     EXSR SRCONV                                                        CRE019
     C                     Z-ADDWAMNTO    PSTA                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           *LIKE     DEFN PSTA      SPSTA                                               CRE019
     C           *LIKE     DEFN ORAMT     SORAMT                                              CRE019
     C                     Z-ADDPSTA      SPSTA                                               CRE019
     C                     Z-ADDORAMT     SORAMT                                              CRE019
     C                     Z-ADD0         DRCR                                                CRE019
     C**********           Z-ADD0         ASOC                                         CRE019 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C           CQNF      IFEQ *BLANKS                                                       CRE019
     C                     Z-ADD0         CHQN                                                CRE019
     C                     ELSE                                                               CRE019
     C                     MOVELCQNF      CHQN                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     Z-ADD0         REJC                                                CRE019
     C                     Z-ADD0         RRNM                                                CRE019
     C                     Z-ADD0         VOIN                                                CRE019
     C                     Z-ADD0         ACUM                                                CRE019
     C                     Z-ADD0         XRFN                                                CRE019
      *                                                                                       CRE019
     C           CGL020    IFEQ 'Y'                                                           CRE019
     C                     MOVE ' '       FEEFLG                                              CRE019
     C                     Z-ADD0         FEEVAL                                              CRE019
     C                     Z-ADD0         FEEPCT                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVEL*BLANKS   XRFI                                                CRE019
     C                     Z-ADDVLDT      VALD                                                CRE019
     C                     MOVEL@CCY1     TRCCY                                               CRE019
     C                     MOVEL'P'       RECI                                                CRE019
      ** Store dr/cr indicator required for interbranch posting                               CRE019
     C                     Z-ADDDRCR      @INHDC  10                                          CRE019
      *                                                                                       CRE019
      ** Store details required for interbranch posting                                       CRE019
      *                                                                                       CRE019
      ** Setup flag to indicate that second posting has been done                             CRE019
     C                     Z-ADD1         @PST2                                               CRE019
      *                                                                                       CRE019
     C**********           Z-ADDCNUM      @PNUMH                                       CRE019 CSD027
     C                     MOVE CNUM      @PNUMH                                              CSD027
     C                     MOVELCCY       @PCCYH                                              CRE019
     C                     MOVE ACOD      @PACDH                                              CRE019
     C                     Z-ADDACSQ      @PASQH                                              CRE019
     C                     Z-ADDVALD      @PVLDH                                              CRE019
     C                     MOVELTRAT      @PTRTH                                              CRE019
     C                     MOVE *BLANK    @PNARH                                              CRE019
     C                     MOVELPNAR      @PNARH                                              CRE019
     C                     Z-ADDPSTA      @PPSAH                                              CRE019
     C                     Z-ADDDRCR      @PDCH                                               CRE019
     C                     MOVELSPOS      @PPOSH                                              CRE019
     C                     MOVE BRCA      @PBCAH                                              CRE019
     C                     Z-ADDRIND      @PRNDH                                              CRE019
     C                     MOVELATYP      @PTYPH                                              CRE019
     C                     MOVELSTYP      @PSTPH                                              CRE019
     C                     MOVELPRIN      @PINDH                                              CRE019
     C                     MOVELGETP      @PGTPH                                              CRE019
     C                     MOVELPBTT      @PPBTH                                              CRE019
     C                     MOVELORBR      @PORBH                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  MOV006 - Process cash/house cheque deposits                  *                       CRE019
      *         - Credit postings                                     *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           MOV006    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE *BLANK    PNAR                                                CRE019
     C                     MOVE *BLANK    STYP                                                CRE019
     C                     MOVE *BLANKS   PBTT                                                CRE019
      *                                                                                       CRE019
      **  Assign teller profit centre if anal acctg is available                              CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C                     MOVE FSTEPC    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **  If associated GL account code is zero, post against suspense.                       CRE019
      *                                                                                       CRE019
     C                     Z-ADD@ASGL1    @ASGL                                               CRE019
      *                                                                                       CRE019
      ** Move fields to klist                                                                 CRE019
     C**********           Z-ADD@TICN     @CNUM                                        CRE019 CSD027
     C                     MOVE @TICN     @CNUM                                               CSD027
     C                     Z-ADD1         @ACSQ                                               CRE019
     C                     MOVE ITLB      BRCA                                                CRE019
     C                     Z-ADD0         ACNO                                                CRE019
      *                                                                                       CRE019
     C                     Z-ADD@ASGL1    @ACOD                                               CRE019
     C                     MOVELCCY1      @CCY                                                CRE019
     C                     MOVEL@AGLT1    ATYP                                                CRE019
      *                                                                                       CRE019
      ** Check whether a/c is a valid record in lf/accnt                                      CRE019
     C                     MOVE BRCA      @BRCA                                               CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
      *                                                                                       CRE019
      ** If no record and no associated GL code - suspense a/c                                CRE019
      *                                                                                       CRE019
     C           *IN70     IFEQ '1'                                                           CRE019
     C           ATYP      ANDEQ'R'                                                           CRE019
     C           @ACOD     OREQ 0                                                             CRE019
     C                     MOVE @CSAC     @ACOD                                               CRE019
     C                     MOVE @CSAT     ATYP                                                CRE019
      *                                                                                       CRE019
      **  Assign primary funding prft cntr if anal acctg is available                         CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C                     MOVE FTPRFP    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@CNUM     CNUM                                         CRE019 CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY                                                 CRE019
     C                     MOVE @ACOD     ACOD                                                CRE019
     C                     Z-ADD@ACSQ     ACSQ                                                CRE019
      *                                                                                       CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
     C           @ACOD     IFNE 0                                                             CRE019
     C                     MOVE @ACOD     @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVEL@ACT      ATYP                                                CRE019
     C                     ENDIF                                                              CRE019
     C           *IN70     IFEQ '1'                                                           CRE019
     C           ATYP      ANDEQ'R'                                                           CRE019
     C           @ACOD     OREQ 0                                                             CRE019
     C                     MOVELA8BICN    @CNUM                                               CRE019
     C                     MOVELCCY1      @CCY                                                CRE019
     C                     MOVEL@CSAC     @ACOD                                               CRE019
     C                     MOVEL'01'      @ACSQ                                               CRE019
     C                     MOVE @CSAT     ATYP                                                CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADDBJRDNB    PSTD                                                CRE019
      *                                                                                       CRE019
     C                     Z-ADDBJRDNB    VALD                                                CRE019
     C                     Z-ADDTBTN      @TTRNO                                              CRE019
     C**********           Z-ADD0         ASOC                                         CRE019 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN                                                CRE019
     C                     MOVEL'  GE-TT' SPOS                                                CRE019
     C                     Z-ADD235959    PTIM                                                CRE019
     C                     Z-ADD0         VOIN                                                CRE019
      *                                                                                       CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     Z-ADDACACNO    ACNO                                                CRE019
      *                                                                                       CRE019
      **  Assign account profit centre if anal acctg is available                             CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
     C                     MOVE ACPRFC    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     Z-ADD0         ACNO                                                CRE019
     C                     MOVE *BLANKS   TRAT                                                CRE019
     C                     END                                                                CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         REJC                                                CRE019
     C                     MOVELDEPC      DPMT                                                CRE019
     C                     Z-ADD0         RRNM                                                CRE019
      *                                                                                       CRE019
     C                     MOVE *BLANKS   TLIN                                                CRE019
     C                     MOVE *BLANKS   TRCCY                                               CRE019
      *                                                                                       CRE019
     C                     MOVEL'N'       GETP                                                CRE019
     C                     Z-ADD0         ACUM                                                CRE019
     C                     MOVE ITLB      ORBR                                                CRE019
     C                     Z-ADD0         ORAMT                                               CRE019
      *                                                                                       CRE019
     C           FNCD      IFEQ '00Q'                                                         CRE019
     C           FNCD      OREQ '0JQ'                                                         CRE019
     C                     Z-ADDAMT1      PSTA                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADDAMT2      PSTA                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Initialise fee detail fields                                                         CRE019
      *                                                                                       CRE019
     C           CGL020    IFEQ 'Y'                                                           CRE019
     C                     MOVE ' '       FEEFLG                                              CRE019
     C                     Z-ADD0         FEEVAL                                              CRE019
     C                     Z-ADD0         FEEPCT                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADD1         DRCR                                                CRE019
      *                                                                                       CRE019
     C                     MOVEL@NARDS    PNAR                                                CRE019
      ** Translate narrative if required                                                      CRE019
      *                                                                                       CRE019
     C           REPNAR    IFEQ 'Y'                                                           CRE019
     C                     CLEARCGPNAR                                                        CRE019
     C                     MOVEL@NA715    MNTRNO                                              CRE019
     C           TRACNO    IFEQ 0                                                             CRE019
     C                     MOVE 'GB00880' ##MGID                                              CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE TRACNO    MNRACN                                              CRE019
     C                     MOVE 'GB00881' ##MGID                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     EXSR SRPNAR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVEL'P'       RECI                                                CRE019
      *                                                                                       CRE019
      **Initialize the extension ref file fields for EMU posting nar                          CRE019
     C                     MOVEL*BLANKS   XRFI                                                CRE019
     C                     Z-ADD0         XRFN                                                CRE019
      *                                                                                       CRE019
      ** Store dr/cr indicator required for interbranch posting                               CRE019
      *                                                                                       CRE019
     C                     Z-ADDDRCR      @INHDC                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  PROIT2 - Process interbranch transactions for house cheque   *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                                                       CRE019
     C           PROIT2    BEGSR                                                              CRE019
      *                                                                                       CRE019
      ** perform teller interbranch entry                                                     CRE019
     C                     EXSR TITBN2                                                        CRE019
      *                                                                                       CRE019
      ** perform interbranch a/c entry                                                        CRE019
     C                     EXSR ITBAN2                                                        CRE019
      *                                                                                       CRE019
      ** If Interbranch entries via main branch is 'Y'                                        CRE019
     C           BKIEMB    IFEQ 'Y'                                                           CRE019
      *                                                                                       CRE019
      ** If cust a/c branch not equal to main branch                                          CRE019
     C           @BRCA2    IFNE BKMABR                                                        CRE019
     C           ITLB      ANDNEBKMABR                                                        CRE019
      *                                                                                       CRE019
      ** perform main branch interbranch entry                                                CRE019
     C                     EXSR MBITN2                                                        CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  TITBN2 - Teller interbranch entry for house cheque           *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           TITBN2    BEGSR                                                              CRE019
      *                                                                                       CRE019
      **  Assign primary funding prft cntr if anal acctg is available                         CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C                     MOVE FTPRFP    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
     C                     MOVE @PPSAH    ZZAMT                                               CRE019
     C                     Z-ADD1         S                                                   CRE019
     C                     Z-ADD1         Z                                                   CRE019
     C                     EXSR ZHASH                                                         CRE019
      *                                                                                       CRE019
      ** Add 1 to output record count                                                         CRE019
     C                     ADD  1         @TICNT                                              CRE019
      *                                                                                       CRE019
      ** Move details to output record                                                        CRE019
      ** Move values for interbranch postings                                                 CRE019
      *                                                                                       CRE019
      ** Initialise fee detail fields                                                         CRE019
      *                                                                                       CRE019
     C           CGL020    IFEQ 'Y'                                                           CRE019
     C                     MOVE ' '       FEEFLG                                              CRE019
     C                     Z-ADD0         FEEVAL                                              CRE019
     C                     Z-ADD0         FEEPCT                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVEL'P'       RECI                                                CRE019
     C                     Z-ADDHCACN     ACNO                                                CRE019
     C                     Z-ADDBJRDNB    PSTD                                                CRE019
     C                     MOVELTBID      TELI                                                CRE019
     C                     Z-ADDTBTN      TREFN                                               CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@PNUMH    CNUM                                         CRE019 CSD027
     C                     MOVE @PNUMH    CNUM                                                CSD027
     C                     MOVEL@PCCYH    CCY                                                 CRE019
     C                     MOVE @PACDH    ACOD                                                CRE019
     C                     Z-ADD@PASQH    ACSQ                                                CRE019
     C                     Z-ADD@PVLDH    VALD                                                CRE019
     C                     MOVEL@PTRTH    TRAT                                                CRE019
     C                     MOVEL@PNARH    PNAR                                                CRE019
     C                     Z-ADD@PPSAH    PSTA                                                CRE019
     C                     Z-ADD@PDCH     DRCR                                                CRE019
     C                     MOVEL@PPOSH    SPOS                                                CRE019
     C                     MOVE @PBCAH    BRCA                                                CRE019
     C                     Z-ADD@PRNDH    RIND                                                CRE019
     C                     MOVEL@PTYPH    ATYP                                                CRE019
     C                     MOVEL@PSTPH    STYP                                                CRE019
     C                     MOVEL@PINDH    PRIN                                                CRE019
     C                     MOVEL@PGTPH    GETP                                                CRE019
     C                     MOVEL@PPBTH    PBTT                                                CRE019
     C                     MOVEL@PORBH    ORBR                                                CRE019
      *                                                                                       CRE019
     C                     MOVEL*BLANKS   ORAN                                                CRE019
      *                                                                                       CRE019
      ** Write the record to pf/ttibpd                                                        CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
     C                     WRITETTIBPDF                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  ITBAN2 - Interbranch a/c entry for house cheque              *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           ITBAN2    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADD@PPSAH    PSTA                                                CRE019
      *                                                                                       CRE019
      ** Store posting amount for second entry                                                CRE019
     C                     Z-ADDPSTA      @PSTA                                               CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@TICN     @CNUM                                        CRE019 CSD027
     C                     MOVE @TICN     @CNUM                                               CSD027
     C                     MOVE @BRCA2    BRCA                                                CRE019
      *                                                                                       CRE019
      **  Use interbranch account code of the other branch                                    CRE019
     C           @INHDC    IFEQ 0                                                             CRE019
     C                     Z-ADD@TIGT     @ACOD                                               CRE019
     C                     MOVE @TITT     ATYP                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD@TIGF     @ACOD                                               CRE019
     C                     MOVE @TIFT     ATYP                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **  Branch not equal to main branch                                                     CRE019
     C           BKIEMB    IFEQ 'Y'                                                           CRE019
     C**********           Z-ADD@MICN     @CNUM                                        CRE019 CSD027
     C                     MOVE @MICN     @CNUM                                               CSD027
      *                                                                                       CRE019
      **  Use interbranch account code of the main branch                                     CRE019
     C           @INHDC    IFEQ 0                                                             CRE019
     C                     Z-ADD@MIGT     @ACOD                                               CRE019
     C                     MOVE @MITT     ATYP                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD@MIGF     @ACOD                                               CRE019
     C                     MOVE @MIFT     ATYP                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVEL@CCY2     @CCY                                                CRE019
     C                     Z-ADD1         @ACSQ                                               CRE019
     C                     MOVE *BLANK    STYP                                                CRE019
      *                                                                                       CRE019
      ** If any of the interbank gl a/cs has account type 'R'                                 CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
      *                                                                                       CRE019
      ** Check whether a/c is a valid record in lf/accnt                                      CRE019
     C                     MOVE BRCA      @BRCA                                               CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
      *                                                                                       CRE019
      ** If valid record does not exist                                                       CRE019
     C           *IN70     IFEQ '1'                                                           CRE019
      *                                                                                       CRE019
      ** Move suspense a/c code                                                               CRE019
     C                     MOVE @CSAC     @ACOD                                               CRE019
     C                     MOVE @CSAT     ATYP                                                CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Move fields for interbranch a/c entry-1                                              CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@CNUM     CNUM                                         CRE019 CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY                                                 CRE019
     C                     MOVE @ACOD     ACOD                                                CRE019
     C                     Z-ADD@ACSQ     ACSQ                                                CRE019
      *                                                                                       CRE019
      ** If gl type is 'R' -                                                                  CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
      *                                                                                       CRE019
      ** Move retail a/c no. from lf/accnt and move 1 to retail ind.                          CRE019
     C                     Z-ADDACACNO    ACNO                                                CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     MOVEL@CHGIN    TRAT                                                CRE019
     C           @CHGIN    IFEQ 0                                                             CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     Z-ADD108       DBASE                                               CRE019
     C                     MOVEL'SDTCHGPD'DBFILE                                              CRE019
     C                     MOVEL@CHGIN    DBKEY                                               CRE019
     C                     EXSR DBERR                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **  Assign account profit centre if anal acctg is available                             CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
     C                     MOVE ACPRFC    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEL'INTBR'   TRAT                                                CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         ACNO                                                CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     MOVE *BLANK    TRAT                                                CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADDBJRDNB    PSTD                                                CRE019
     C                     Z-ADDBJRDNB    VALD                                                CRE019
     C                     MOVE *BLANKS   PNAR                                                CRE019
     C                     MOVEL@NARDS    PNAR                                                CRE019
      ** Translate narrative if required                                                      CRE019
     C           REPNAR    IFEQ 'Y'                                                           CRE019
     C                     CLEARCGPNAR                                                        CRE019
     C                     MOVEL@NA715    MNTRNO                                              CRE019
     C           HCACN     IFEQ 0                                                             CRE019
     C                     MOVE 'GB00880' ##MGID                                              CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE HCACN     MNRACN                                              CRE019
     C                     MOVE 'GB00881' ##MGID                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     EXSR SRPNAR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Move dr/cr ind. opposite to that of internal posting                                 CRE019
      ** for all functions except retail transfer                                             CRE019
     C           @INHDC    IFEQ 0                                                             CRE019
     C                     Z-ADD0         DRCR                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD1         DRCR                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **Initialize the extension ref file fields for EMU posting nar                          CRE019
     C                     MOVEL*BLANKS   XRFI                                                CRE019
     C                     Z-ADD0         XRFN                                                CRE019
      *                                                                                       CRE019
     C                     MOVEL'P'       RECI                                                CRE019
     C**********           Z-ADD0         ASOC                                         CRE019 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN                                                CRE019
     C                     MOVEL'  GE-TT' SPOS                                                CRE019
     C                     Z-ADD235959    PTIM                                                CRE019
     C                     Z-ADD0         VOIN                                                CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         REJC                                                CRE019
     C                     MOVE *BLANK    DPMT                                                CRE019
     C                     Z-ADD0         RRNM                                                CRE019
     C                     MOVE *BLANK    TLIN                                                CRE019
     C                     MOVE *BLANK    TRCCY                                               CRE019
     C                     BITOF'01234567'PRIN                                                CRE019
     C                     MOVEL'N'       GETP                                                CRE019
     C                     Z-ADD0         ACUM                                                CRE019
     C                     MOVE *BLANK    PBTT                                                CRE019
     C                     MOVE ITLB      ORBR                                                CRE019
     C                     Z-ADD0         ORAMT                                               CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
      ** Write the record                                                                     CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
     C                     MOVELACOD      @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVELW#ACSC    ACSC                                                CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Move fields for interbranch a/c entry-2                                              CRE019
      *                                                                                       CRE019
      **  Assign primary funding prft cntr if anal acctg is available                         CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C                     MOVE FTPRFP    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Posting amount is same as 1st entry                                                  CRE019
     C                     Z-ADD@PSTA     PSTA                                                CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@ICNH     @CNUM                                        CRE019 CSD027
     C                     MOVE @ICNH     @CNUM                                               CSD027
     C                     MOVE ITLB      BRCA                                                CRE019
      *                                                                                       CRE019
      **  Use interbranch account code of the other branch                                    CRE019
     C           @PDCH     IFEQ 0                                                             CRE019
     C                     Z-ADD@IGTH     @ACOD                                               CRE019
     C                     MOVE @ITTH     ATYP                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD@IGFH     @ACOD                                               CRE019
     C                     MOVE @IFTH     ATYP                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **  Branch not equal to main branch                                                     CRE019
     C           BKIEMB    IFEQ 'Y'                                                           CRE019
     C**********           Z-ADD@MICN     @CNUM                                        CRE019 CSD027
     C                     MOVE @MICN     @CNUM                                               CSD027
      *                                                                                       CRE019
      **  Use interbranch account code of the main branch                                     CRE019
     C           @PDCH     IFEQ 0                                                             CRE019
     C                     Z-ADD@MIGT     @ACOD                                               CRE019
     C                     MOVE @MITT     ATYP                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD@MIGF     @ACOD                                               CRE019
     C                     MOVE @MIFT     ATYP                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVEL@CCY2     @CCY                                                CRE019
     C                     Z-ADD1         @ACSQ                                               CRE019
     C                     MOVE *BLANK    STYP                                                CRE019
      *                                                                                       CRE019
      ** If branch interbank gl a/c type is 'R'                                               CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
      *                                                                                       CRE019
      ** Check whether a/c is a valid record in lf/accnt                                      CRE019
     C                     MOVE BRCA      @BRCA                                               CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
      *                                                                                       CRE019
      ** If valid record does not exist                                                       CRE019
     C           *IN70     IFEQ '1'                                                           CRE019
      *                                                                                       CRE019
      ** Move suspense a/c code                                                               CRE019
     C                     MOVE @CSAC     @ACOD                                               CRE019
     C                     MOVE @CSAT     ATYP                                                CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@CNUM     CNUM                                         CRE019 CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY                                                 CRE019
     C                     MOVE @ACOD     ACOD                                                CRE019
     C                     Z-ADD@ACSQ     ACSQ                                                CRE019
      *                                                                                       CRE019
      ** If gl type is 'R' -                                                                  CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
      *                                                                                       CRE019
      ** Move retail a/c no. from lf/accnt and move 1 to retail ind.                          CRE019
     C                     Z-ADDACACNO    ACNO                                                CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     MOVEL@CHGIN    TRAT                                                CRE019
     C           @CHGIN    IFEQ 0                                                             CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     Z-ADD109       DBASE                                               CRE019
     C                     MOVEL'SDTCHGPD'DBFILE                                              CRE019
     C                     MOVEL@CHGIN    DBKEY                                               CRE019
     C                     EXSR DBERR                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **  Assign account profit centre if anal acctg is available                             CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
     C                     MOVE ACPRFC    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEL'INTBR'   TRAT                                                CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         ACNO                                                CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     MOVE *BLANK    TRAT                                                CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADDBJRDNB    PSTD                                                CRE019
     C                     Z-ADDBJRDNB    VALD                                                CRE019
     C                     MOVE *BLANKS   PNAR                                                CRE019
     C                     MOVEL@NARDS    PNAR                                                CRE019
      ** Translate narrative if required                                                      CRE019
     C           REPNAR    IFEQ 'Y'                                                           CRE019
     C                     CLEARCGPNAR                                                        CRE019
     C                     MOVEL@NA715    MNTRNO                                              CRE019
     C           HCACN     IFEQ 0                                                             CRE019
     C                     MOVE 'GB00880' ##MGID                                              CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE HCACN     MNRACN                                              CRE019
     C                     MOVE 'GB00881' ##MGID                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     EXSR SRPNAR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Move dr/cr ind. opposite to that of customer posting                                 CRE019
     C           @PDCH     IFEQ 0                                                             CRE019
     C                     Z-ADD0         DRCR                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD1         DRCR                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **Initialize the extension ref file fields for EMU posting nar                          CRE019
      *                                                                                       CRE019
     C                     MOVEL*BLANKS   XRFI                                                CRE019
     C                     Z-ADD0         XRFN                                                CRE019
      *                                                                                       CRE019
     C                     MOVEL'P'       RECI                                                CRE019
     C**********           Z-ADD0         ASOC                                         CRE019 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN                                                CRE019
     C                     MOVEL'  GE-TT' SPOS                                                CRE019
     C                     Z-ADD235959    PTIM                                                CRE019
     C                     Z-ADD0         VOIN                                                CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         REJC                                                CRE019
     C                     MOVE *BLANK    DPMT                                                CRE019
     C                     Z-ADD0         RRNM                                                CRE019
     C                     MOVE *BLANK    TLIN                                                CRE019
     C                     MOVE *BLANK    TRCCY                                               CRE019
     C                     BITOF'01234567'PRIN                                                CRE019
     C                     MOVEL'N'       GETP                                                CRE019
     C                     Z-ADD0         ACUM                                                CRE019
     C                     MOVE *BLANK    PBTT                                                CRE019
     C                     MOVE ITLB      ORBR                                                CRE019
     C                     Z-ADD0         ORAMT                                               CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
      ** Write the record                                                                     CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
     C                     MOVELACOD      @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVELW#ACSC    ACSC                                                CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      /EJECT                                                                                  CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *  MBITN2 - Main branch interbranch entry                       *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           MBITN2    BEGSR                                                              CRE019
      *                                                                                       CRE019
      **  Assign primary funding prft cntr if anal acctg is available                         CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C                     MOVE FTPRFP    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADD@PPSAH    PSTA                                                CRE019
      *                                                                                       CRE019
      ** Store posting amount for second entry                                                CRE019
     C                     Z-ADDPSTA      @PSTA                                               CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@ICNH     @CNUM                                        CRE019 CSD027
     C                     MOVE @ICNH     @CNUM                                               CSD027
      *                                                                                       CRE019
      ** Use interbranch account code of the other branch                                     CRE019
     C           @PDCH     IFEQ 0                                                             CRE019
     C                     Z-ADD@IGTH     @ACOD                                               CRE019
     C                     MOVE @ITTH     ATYP                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD@IGFH     @ACOD                                               CRE019
     C                     MOVE @IFTH     ATYP                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE @MBRCA    BRCA                                                CRE019
      *                                                                                       CRE019
     C                     MOVEL@CCY2     @CCY                                                CRE019
     C                     Z-ADD1         @ACSQ                                               CRE019
     C                     MOVE *BLANK    STYP                                                CRE019
      *                                                                                       CRE019
      ** If any of the interbank gl a/cs has account type 'R'                                 CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
      *                                                                                       CRE019
      ** Check whether a/c is a valid record in lf/accnt                                      CRE019
     C                     MOVE BRCA      @BRCA                                               CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
      *                                                                                       CRE019
      ** If valid record does not exist                                                       CRE019
     C           *IN70     IFEQ '1'                                                           CRE019
      *                                                                                       CRE019
      ** Move suspense a/c code                                                               CRE019
     C                     MOVE @CSAC     @ACOD                                               CRE019
     C                     MOVE @CSAT     ATYP                                                CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Move fields for interbranch a/c entry-1                                              CRE019
     C**********           Z-ADD@CNUM     CNUM                                         CRE019 CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY                                                 CRE019
     C                     MOVE @ACOD     ACOD                                                CRE019
     C                     Z-ADD@ACSQ     ACSQ                                                CRE019
      *                                                                                       CRE019
      **  Assign primary funding prft cntr if anal acctg is available                         CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C                     MOVE FTPRFP    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** If gl type is 'R' -                                                                  CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
      *                                                                                       CRE019
      ** Move retail a/c no. from lf/accnt and move 1 to retail ind.                          CRE019
     C                     Z-ADDACACNO    ACNO                                                CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     MOVEL@CHGMN    TRAT                                                CRE019
     C           @CHGMN    IFEQ 0                                                             CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     Z-ADD110       DBASE                                               CRE019
     C                     MOVEL'SDTCHGPD'DBFILE                                              CRE019
     C                     MOVEL@CHGIN    DBKEY                                               CRE019
     C                     EXSR DBERR                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **  Assign account profit centre if anal acctg is available                             CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
     C                     MOVE ACPRFC    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEL'99599'   TRAT                                                CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         ACNO                                                CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     MOVE *BLANK    TRAT                                                CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADDBJRDNB    PSTD                                                CRE019
     C                     Z-ADDBJRDNB    VALD                                                CRE019
     C                     MOVE *BLANKS   PNAR                                                CRE019
     C                     MOVEL@NARDS    PNAR                                                CRE019
      ** Translate narrative if required                                                      CRE019
     C           REPNAR    IFEQ 'Y'                                                           CRE019
     C                     CLEARCGPNAR                                                        CRE019
     C                     MOVEL@NA715    MNTRNO                                              CRE019
     C           HCACN     IFEQ 0                                                             CRE019
     C                     MOVE 'GB00880' ##MGID                                              CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE HCACN     MNRACN                                              CRE019
     C                     MOVE 'GB00881' ##MGID                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     EXSR SRPNAR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Move dr/cr ind. opposite to that of internal posting                                 CRE019
     C           @PDCH     IFEQ 1                                                             CRE019
     C                     Z-ADD1         DRCR                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD0         DRCR                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **Initialize the extension ref file fields for EMU posting nar                          CRE019
     C                     MOVEL*BLANKS   XRFI                                                CRE019
     C                     Z-ADD0         XRFN                                                CRE019
      *                                                                                       CRE019
     C                     MOVEL'P'       RECI                                                CRE019
     C**********           Z-ADD0         ASOC                                         CRE019 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN                                                CRE019
     C                     MOVEL'  GE-TT' SPOS                                                CRE019
     C                     Z-ADD235959    PTIM                                                CRE019
     C                     Z-ADD0         VOIN                                                CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         REJC                                                CRE019
     C                     MOVE *BLANK    DPMT                                                CRE019
     C                     Z-ADD0         RRNM                                                CRE019
     C                     MOVE *BLANK    TLIN                                                CRE019
     C                     MOVE *BLANK    TRCCY                                               CRE019
     C                     BITOF'01234567'PRIN                                                CRE019
     C                     MOVEL'N'       GETP                                                CRE019
     C                     Z-ADD0         ACUM                                                CRE019
     C                     MOVE *BLANK    PBTT                                                CRE019
     C                     MOVE ITLB      ORBR                                                CRE019
     C                     Z-ADD0         ORAMT                                               CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
      ** Write the record                                                                     CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
     C                     MOVELACOD      @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVELW#ACSC    ACSC                                                CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
      ** Move fields for interbranch a/c entry-2                                              CRE019
      *                                                                                       CRE019
      ** Posting amount is same as 1st entry                                                  CRE019
     C                     Z-ADD@PSTA     PSTA                                                CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@TICN     @CNUM                                        CRE019 CSD027
     C                     MOVE @TICN     @CNUM                                               CSD027
      *                                                                                       CRE019
      ** Use interbranch account code of the other branch                                     CRE019
     C           @PDCH     IFEQ 1                                                             CRE019
     C                     Z-ADD@TIGT     @ACOD                                               CRE019
     C                     MOVE @TITT     ATYP                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD@TIGF     @ACOD                                               CRE019
     C                     MOVE @TIFT     ATYP                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE @MBRCA    BRCA                                                CRE019
      *                                                                                       CRE019
     C                     MOVEL@CCY2     @CCY                                                CRE019
     C                     Z-ADD1         @ACSQ                                               CRE019
     C                     MOVE *BLANK    STYP                                                CRE019
      *                                                                                       CRE019
      ** If branch interbank gl a/c type is 'R'                                               CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
      *                                                                                       CRE019
      ** Check whether a/c is a valid record in lf/accnt                                      CRE019
     C                     MOVE BRCA      @BRCA                                               CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
      *                                                                                       CRE019
      ** If valid record does not exist                                                       CRE019
     C           *IN70     IFEQ '1'                                                           CRE019
      *                                                                                       CRE019
      ** Move suspense a/c code                                                               CRE019
     C                     MOVE @CSAC     @ACOD                                               CRE019
     C                     MOVE @CSAT     ATYP                                                CRE019
      *                                                                                       CRE019
      **  Assign primary funding prft cntr if anal acctg is available                         CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C                     MOVE FTPRFP    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C**********           Z-ADD@CNUM     CNUM                                         CRE019 CSD027
     C                     MOVE @CNUM     CNUM                                                CSD027
     C                     MOVEL@CCY      CCY                                                 CRE019
     C                     MOVE @ACOD     ACOD                                                CRE019
     C                     Z-ADD@ACSQ     ACSQ                                                CRE019
      *                                                                                       CRE019
      ** If gl type is 'R' -                                                                  CRE019
     C           ATYP      IFEQ 'R'                                                           CRE019
      *                                                                                       CRE019
      ** Move retail a/c no. from lf/accnt and move 1 to retail ind.                          CRE019
     C                     Z-ADDACACNO    ACNO                                                CRE019
     C                     Z-ADD1         RIND                                                CRE019
     C                     MOVEL@CHGMN    TRAT                                                CRE019
     C           @CHGMN    IFEQ 0                                                             CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     Z-ADD111       DBASE                                               CRE019
     C                     MOVEL'SDTCHGPD'DBFILE                                              CRE019
     C                     MOVEL@CHGIN    DBKEY                                               CRE019
     C                     EXSR DBERR                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **  Assign account profit centre if anal acctg is available                             CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C           KLACNT    CHAINACCNTABF             70                                       CRE019
     C                     MOVE ACPRFC    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEL'99599'   TRAT                                                CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         ACNO                                                CRE019
     C                     Z-ADD0         RIND                                                CRE019
     C                     MOVE *BLANK    TRAT                                                CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     Z-ADDBJRDNB    PSTD                                                CRE019
     C                     Z-ADDBJRDNB    VALD                                                CRE019
     C                     MOVE *BLANKS   PNAR                                                CRE019
     C                     MOVEL@NARDS    PNAR                                                CRE019
      *                                                                                       CRE019
      ** Translate narrative if required                                                      CRE019
     C           REPNAR    IFEQ 'Y'                                                           CRE019
     C                     CLEARCGPNAR                                                        CRE019
     C                     MOVEL@NA715    MNTRNO                                              CRE019
     C           HCACN     IFEQ 0                                                             CRE019
     C                     MOVE 'GB00880' ##MGID                                              CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE HCACN     MNRACN                                              CRE019
     C                     MOVE 'GB00881' ##MGID                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     EXSR SRPNAR                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Move dr/cr ind. opposite to that of customer posting                                 CRE019
      *                                                                                       CRE019
     C           @INHDC    IFEQ 1                                                             CRE019
     C                     Z-ADD1         DRCR                                                CRE019
     C                     ELSE                                                               CRE019
     C                     Z-ADD0         DRCR                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      **Initialize the extension ref file fields for EMU posting nar                          CRE019
     C                     MOVEL*BLANKS   XRFI                                                CRE019
     C                     Z-ADD0         XRFN                                                CRE019
      *                                                                                       CRE019
     C                     MOVEL'P'       RECI                                                CRE019
     C**********           Z-ADD0         ASOC                                         CRE019 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN                                                CRE019
     C                     MOVEL'  GE-TT' SPOS                                                CRE019
     C                     Z-ADD235959    PTIM                                                CRE019
     C                     Z-ADD0         VOIN                                                CRE019
      *                                                                                       CRE019
     C                     Z-ADD0         REJC                                                CRE019
     C                     MOVE *BLANK    DPMT                                                CRE019
     C                     Z-ADD0         RRNM                                                CRE019
     C                     MOVE *BLANK    TLIN                                                CRE019
     C                     MOVE *BLANK    TRCCY                                               CRE019
     C                     BITOF'01234567'PRIN                                                CRE019
     C                     MOVEL'N'       GETP                                                CRE019
     C                     Z-ADD0         ACUM                                                CRE019
     C                     MOVE *BLANK    PBTT                                                CRE019
     C                     MOVE ITLB      ORBR                                                CRE019
     C                     Z-ADD0         ORAMT                                               CRE019
      *                                                                                       CRE019
      **  Assign teller profit centre if anal acctg is available                              CRE019
      *                                                                                       CRE019
     C           BGN0ST    IFEQ 'Y'                                                           CRE019
     C                     MOVE FSTEPC    PRFC                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Accumulate hash totals on posting amount                                             CRE019
     C                     EXSR HSHTOT                                                        CRE019
      *                                                                                       CRE019
      ** Write the record                                                                     CRE019
     C           *INU1     IFEQ '0'                                                           CRE019
     C                     MOVELACOD      @ACD                                                CRE019
     C                     EXSR GETACT                                                        CRE019
     C                     MOVELW#ACSC    ACSC                                                CRE019
     C                     WRITEAPOSTPDF                                                      CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                     BUG27119
      ** Monitor the balance per branch-currency combination                                BUG27119
      *                                                                                     BUG27119
     C                     EXSR CHKBAL                                                      BUG27119
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                     BUG27119
      /EJECT                                                                                BUG27119
      *****************************************************************                     BUG27119
      *                                                               *                     BUG27119
      *            CHKBAL - Monitor the balance per branch/currency   *                     BUG27119
      *                     combination for all postings generated    *                     BUG27119
      *                     in GETTPD file.                           *                     BUG27119
      *                                                               *                     BUG27119
      * CALLED BY  GENXXX - Generate entries                          *                     BUG27119
      *            REVENT - Generate Reversal Entry                   *                     BUG27119
      *            CHARGE - Generate Charge Entry                     *                     BUG27119
      *            PROEXC - Process Exchange Transactions             *                     BUG27119
      *            MBITEN - Main Branch Interbranch Entry             *                     BUG27119
      *            ITBAEN - Interbranch A/C Entry                     *                     BUG27119
      *                                                               *                     BUG27119
      * CALLS                                                         *                     BUG27119
      *                                                               *                     BUG27119
      *****************************************************************                     BUG27119
     C           CHKBAL    BEGSR                                                            BUG27119
      *                                                                                     BUG27119
      ** Determine if it is a debit or credit posting                                       BUG27119
      *                                                                                     BUG27119
     C           DRCR      IFEQ 1                                                           BUG27119
     C                     Z-SUBPSTA      WBAL                                              BUG27119
     C                     ELSE                                                             BUG27119
     C                     Z-ADDPSTA      WBAL                                              BUG27119
     C                     END                                                              BUG27119
      *                                                                                     BUG27119
      ** The balance per Branch-Currency combination is stored                              BUG27119
      ** in an array.                                                                       BUG27119
      *                                                                                     BUG27119
     C                     Z-ADD1         B       40                                        BUG27119
     C                     MOVE CCY       WKEY1   6                                         BUG27119
     C                     MOVELBRCA      WKEY1                                             BUG27119
     C           WKEY1     LOKUPBCC,B                    59                                 BUG27119
     C           *IN59     IFEQ '0'                                                         BUG27119
     C                     MOVELWKEY1     BCC,T                                             BUG27119
     C                     Z-ADDWBAL      BAL,T                                             BUG27119
     C                     ADD  1         T                                                 BUG27119
      *                                                                                     BUG27119
     C                     ELSE                                                             BUG27119
     C           WBAL      ADD  BAL,B     BAL,B                                             BUG27119
     C                     ENDIF                                                            BUG27119
      *                                                                                     BUG27119
     C                     ENDSR                                                            BUG27119
      *****************************************************************                     BUG27119
      /EJECT                                                                                BUG27119
      *****************************************************************                     BUG27119
      *                                                               *                     BUG27119
      *            PROSUS - Create Suspense Posting                   *                     BUG27119
      *                                                               *                     BUG27119
      * CALLS      HSHTOT - Perform Hash Totals                       *                     BUG27119
      *            GETACT - Get account type                          *                     BUG27119
      *            SETBRD - Setup branch details                      *                     BUG27119
      *                                                               *                     BUG27119
      * CALLED BY  Main   - Control Process                           *                     BUG27119
      *                                                               *                     BUG27119
      *****************************************************************                     BUG27119
     C           PROSUS    BEGSR                                                            BUG27119
      *                                                                                     BUG27119
      ** Generate a posting per branch-ccy combination if its tabulated                     BUG27119
      ** balance from all Teller Transactions is not equal to zero.                         BUG27119
      *                                                                                     BUG27119
     C                     Z-ADD0         ACNO                                              BUG27119
     C                     MOVE *BLANKS   ASOC                                              BUG27119
     C                     Z-ADD0         CHQN                                              BUG27119
     C                     Z-ADD0         ORAMT                                             BUG27119
     C                     Z-ADD0         REJC                                              BUG27119
     C                     Z-ADD0         RRNM                                              BUG27119
     C                     Z-ADD1         ACSQ                                              BUG27119
     C                     MOVE *BLANKS   TLIN                                              BUG27119
     C                     MOVE *BLANKS   TRAT                                              BUG27119
     C                     MOVE *BLANKS   TRCCY                                             BUG27119
     C                     MOVE *BLANKS   STYP                                              BUG27119
     C                     MOVE *BLANKS   PBTT                                              BUG27119
     C                     MOVE *BLANKS   ORBR                                              BUG27119
     C                     MOVE *BLANKS   ZZ019                                             BUG27119
     C                     MOVE *BLANKS   DPMT                                              BUG27119
     C                     MOVE BKACCD    ACOD                                              BUG27119
     C                     MOVE 'N'       GETP                                              BUG27119
     C                     MOVEL'  GE-TT' SPOS                                              BUG27119
     C                     BITOF'01234567'PRIN                                              BUG27119
     C                     MOVEL@CSAT     ATYP                                              BUG27119
     C           ATYP      IFEQ 'R'                                                         BUG27119
     C                     Z-ADD1         RIND                                              BUG27119
     C                     ELSE                                                             BUG27119
     C                     Z-ADD*ZERO     RIND                                              BUG27119
     C                     ENDIF                                                            BUG27119
     C                     Z-ADDBJRDNB    VALD                                              BUG27119
     C                     Z-ADDBJRDNB    PSTD                                              BUG27119
     C                     MOVE 'P'       RECI                                              BUG27119
     C           T         DOWGT1                                                           BUG27119
     C                     SUB  1         T                                                 BUG27119
     C           BAL,T     IFNE 0                                                           BUG27119
     C                     MOVE BCC,T     CCY                                               BUG27119
     C                     MOVELBCC,T     BRCA                                              BUG27119
     C                     MOVE BRCA      @BRCA                                             BUG27119
     C                     EXSR SETBRD                                                      BUG27119
     C                     MOVE ICN,I     CNUM                                              BUG27119
     C                     Z-ADDBAL,T     PSTA                                              BUG27119
     C           BAL,T     IFGT 0                                                           BUG27119
     C                     MOVE 1         DRCR                                              BUG27119
     C                     ELSE                                                             BUG27119
     C                     MOVE 0         DRCR                                              BUG27119
     C                     Z-SUBPSTA      PSTA                                              BUG27119
     C                     ENDIF                                                            BUG27119
     C                     MOVE *BLANKS   PNAR                                              BUG27119
     C                     MOVELBRCA      M1      4                                         BUG27119
     C                     MOVE '-'       M1                                                BUG27119
     C                     MOVE CCY       M2      7                                         BUG27119
     C                     MOVELM1        M2                                                BUG27119
     C                     MOVELSUSNAR    M3     27                                         BUG27119
     C                     MOVE M2        M3                                                BUG27119
     C                     MOVELM3        PNAR                                              BUG27119
      *                                                                                     BUG27119
      ** Perform hash totals on the posting amount.                                         BUG27119
      *                                                                                     BUG27119
     C                     EXSR HSHTOT                                                      BUG27119
     C           *INU1     IFEQ '0'                                                         BUG27119
     C                     WRITEAPOSTPDF                                                    BUG27119
     C                     ENDIF                                                            BUG27119
     C                     ENDIF                                                            BUG27119
     C                     ENDDO                                                            BUG27119
      *                                                                                     BUG27119
     C                     ENDSR                                                            BUG27119
      *****************************************************************                       CRE019
      /EJECT
      *****************************************************************                       CRT012
     C/COPY WNCPYSRC,RE4201C015
      ** SR.ZFRPED Subroutine
      /COPY ZSRSRC,ZFRPEDZ3
      *
      *****************************************************************
      /EJECT
      /COPY ZSRSRC,RTCONVC1
      ** C-specs for SR.RTCONV
      *****************************************************************
      /EJECT
      /COPY ZSRSRC,ZHASHZ3
      /EJECT                                                              CAC002
      /COPY ZSRSRC,ZXRATEZ1                                               CAC002
      /EJECT                                                              CEU024
      /COPY ZSRSRC,ZDATE1Z2                                               CEU024
      ** C-specs for SR.ZHASH
     C/COPY ZSRSRC,RTTOTSC1                                                                   CRT006
     C/COPY ZSRSRC,ZBKDT                                                                      CRT012
     C/COPY ZSRSRC,ZACCH                                                                      CRT012
      /TITLE SR/ZCONV                                                                         CGL020
     C/COPY ZSRSRC,ZCONVZ1                                                                    CGL020
      *****************************************************************
**  CPY@
(c) Finastra International Limited 2001
** AP - Array of powers of 10.                                            CAC002
0000000001                                                                CAC002
0000000010                                                                CAC002
0000000100                                                                CAC002
0000001000                                                                CAC002
0000010000                                                                CAC002
0000100000                                                                CAC002
0001000000                                                                CAC002
0010000000                                                                CAC002
0100000000                                                                CAC002
1000000000                                                                CAC002
** @TXT - Large text strings                                                                  CRT006
OVRDBF     FILE(TTRANL1) MBR(XXXX)                                                            CRT006
DLTOVR     FILE(TTRANL1)                                                                      CRT006
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                      CEU024
0366073110961461                                                          CEU024
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                        CEU024
000031059090120151181212243273304334365                                   CEU024
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                                           CGL020
0000001                                                                                       CGL020
0000010                                                                                       CGL020
0000100                                                                                       CGL020
0001000                                                                                       CGL020
0010000                                                                                       CGL020
0100000                                                                                       CGL020
1000000                                                                                       CGL020
