     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas RE Cash Mgt Check Field is = Sender')            *
      *****************************************************************
      *                                                               *
      *  Midas - Retail Module                                        *
      *                                                               *
      *  RECMSNDR - RE Cash Management Check Field is = Sender        *
      *                                                               *
      *  Function:  This user check program will check if the         *
      *             given field is the same as the sender of the      *
      *             message                                           *
      *                                                               *
      *  Called By: ME1501  -  Auto-Gen Criteria Analysis             *
      *                                                               *
      *  (c) Finastra International Limited 2002                      *
      *                                                               *
      *  Last Amend No. 254598             Date 20Feb20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 AR972613           Date 15Feb13               *
      *                 CRE075             Date 06Dec10               *
      *                 AR676213           Date 19Nov10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG24998           Date 17Jul09               *
      *                 CSW209             Date 01Apr09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 16May06               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 215582             Date 05Mar03               *
      *                 CRE008  *CREATE    Date 15Apr02               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  254598 - Increase length of DP32B and DATA2 (JMI106/113)     *
      *           (Recompile)                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  AR972613 - Program has an unconditioned DUMP. Reversed this  *
      *             part of the source. (Child:AR972614)              *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  AR676213 - Incorrect definition of CLGLAI field (Recompile)  *
      *             (Child: AR676229)                                 *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  BUG24998 - Bank operation code is missing (Recompile)        *
      *  CSW209 - SWIFT 2009 Changes                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  215582 - Fld57  must be equal to Destination BIC in          *
      *           the hierarchy.                                      *
      *  CRE008 - Cash Management                                     *
      *                                                               *
      *****************************************************************
     F*                                                                    215582
     FREZSHLJ1IF  E           K        DISK                                215582
      *
     E                    CPY@    1   1 80
      ** Array containing Copyright statement
      *
     E/COPY MECPYSRC,SRERRE
     I/COPY MECPYSRC,SME1100P
     IACCT      E DSACCNTAB                                                215582
     IDSFDY     E DSDSFDY                                                  215582
     IDSSDY     E DSDSSDY                                                  215582
     ISDCUST    E DSSDCUSTPD                                               215582
     ISDNOST    E DSSDNOSTPD                                               215582
     ISCSARD    E DSSCSARDPD                                               215582
     I              LCD                             WLCD                   215582
     I*                                                                    215582
     IDLDA        DS                            256                        215582
     I                                      134 141 DBFILE                 215582
     I                                      142 170 DBKEY                  215582
     I                                      171 180 DBPGM                  215582
     I                                      181 1830DBASE                  215582
     I            DS
      *
      *  Split the detail fields into field tag name and contents
      *
     I                                        1 256 WUFDDT
     I                                        1   5 WUMTAG
     I                                        6   6 WUFDIN
     I                                        6 256 WUTGCK
     I                                        7 256 WUTGVL
     I**********                              7  24 WUACCO                                    CGL029
     I                                        7  30 WUACCO                                    CGL029
     I                                        7  120WUCNUM
     I                                        7  12 WUCNUA
     I                                       13  15 WUCURR
     I**********                             16  190WUACCD                                    CGL029
     I**********                             16  19 WUACCA                                    CGL029
     I**********                             20  210WUACSQ                                    CGL029
     I**********                             20  21 WUACSA                                    CGL029
     I**********                             22  24 WUBRCA                                    CGL029
     I**********                             25 256 WUORIG                                    CGL029
     I                                       16  250WUACCD                                    CGL029
     I                                       16  25 WUACCA                                    CGL029
     I                                       26  270WUACSQ                                    CGL029
     I                                       26  27 WUACSA                                    CGL029
     I                                       28  30 WUBRCA                                    CGL029
     I                                       31 256 WUORIG                                    CGL029
      *
     I**********                             25  59 @SNDR                                     CGL029
     I**********                             25  32 @SNDR8                                    CGL029
     I**********                             33  35 @SNDR3                                    CGL029
     I**********                             36 256 @REST                                     CGL029
     I                                       31  65 @SNDR                                     CGL029
     I                                       31  38 @SNDR8                                    CGL029
     I                                       39  41 @SNDR3                                    CGL029
     I                                       42 256 @REST                                     CGL029
     I            DS
     I                                        1  20 WSNDR
     I                                        1   8 WSNDR8
     I                                        9  11 WSNDR3
     I            DS                                                       215582
     I                                        1  20 HDEST                  215582
     I                                        1   8 HDEST8                 215582
     I                                        9  11 HDEST3                 215582
      *                                                                    215582
     I            DS                                                       215582
     I                                        1  35 @TOP                   215582
     I                                        1   1 @SLSHE                 215582
     I                                        2  110@RETL                  215582
     I                                       12  35 @BL24                  215582
      *                                                                    215582
     I**********                              2  19 @GL                                215582 CGL029
     I                                        2  25 @GL                                       CGL029
     I                                        2   4 @BRCA                  215582
     I                                        5  100@CNUM                  215582
     I                                       11  13 @CCY                   215582
     I**********                             14  170@ACOD                              215582 CGL029
     I**********                             18  190@ACSQ                              215582 CGL029
     I**********                             20  35 @BL16                              215582 CGL029
     I                                       14  230@ACOD                                     CGL029
     I                                       24  250@ACSQ                                     CGL029
     I                                       26  35 @BL16                                     CGL029
      *                                                                    215582
     I                                        2  35 @IBAN                  215582
     I*
      *****************************************************************
      *
      ** Define entry parameters
     C           *ENTRY    PLIST
      ** Return Code Parameter
     C                     PARM           RTNCDE  7
      ** Incoming Message Header
     C                     PARM           PHEAD
      ** Incoming Message Data
     C                     PARM           PDATA
     C                     PARM           PDAT2                                               CSW209
      ** Subset of FT message data relating for a specific message tag
     C                     PARM           SBSMSG251
      ** Pattern which can be applied to the function
     C                     PARM           PATTRN 32
      ** Operator (GE, LE, GT, LT)
     C                     PARM           POPER   2
      ** Message tag
     C                     PARM           PMTAG   5
      ** Logging require
     C                     PARM           PREPT   1
      ** Program for messages
     C                     PARM           PCPGM  10
      ** Return Field
     C                     PARM           RETFLD256
      * Define Key List                                                    215582
     C           KYACCO    KLIST                                           215582
     C**********           KFLD           KCNUM   60                                  215582 CSD027A
     C                     KFLD           KCNUM   6                                          CSD027A
     C                     KFLD           KCCY    3                        215582
     C**********           KFLD           KACCD   40                                   215582 CGL029
     C                     KFLD           KACCD  100                                          CGL029
     C                     KFLD           KACSQ   20                       215582
     C                     KFLD           KBRCA   3                        215582
      *                                                                    215582
     C                     MOVEACPY@      CPY2@  80
      *
     C           *NAMVAR   DEFN LDA       DLDA                             215582
      *                                                                    215582
      *  Check if IBAN feature is installed                                215582
     C                     CALL 'AOSARDR0'                                 215582
     C                     PARM *BLANKS   P@RTCD  7                        215582
     C                     PARM '*VERIFY' P@OPTN  7                        215582
     C                     PARM 'CFT004'  P@SARD  6                        215582
     C           SCSARD    PARM *BLANKS   DSFDY                            215582
      *                                                                    215582
      ** Allow IBAN processing                                             215582
      *                                                                    215582
     C           P@RTCD    IFEQ *BLANKS                                    215582
     C                     MOVE 'Y'       CFT004  1                        215582
     C                     ELSE                                            215582
     C                     MOVE 'N'       CFT004                           215582
     C                     END                                             215582
      *
      * Begin Processing
      *
     C                     MOVE *BLANK    Q       50
     C                     MOVE PCPGM     ##PGM  10
     C                     MOVEL'F'       RTNCDE    P
     C                     MOVELSBSMSG    WUTGCK
     C                     MOVELPSNDR     WSNDR
     C                     MOVE *BLANK    RETFLD
     C                     MOVE 'N'       FOUND   1
      *
      * use Generic branch if baln provided
     C           @SNDR3    IFEQ *BLANK
     C                     MOVEL'XXX'     @SNDR3
     C                     ENDIF
     C           WSNDR3    IFEQ *BLANK
     C                     MOVEL'XXX'     WSNDR3
     C                     ENDIF
     C*
     C* Compare field entry against message sender
     C*
     C***********@SNDR     IFEQ WSNDR                                      215582
     C***********POPER     ANDEQ'EQ'                                       215582
     C***********          MOVEL'T'       RTNCDE    P                      215582
     C***********          ENDIF                                           215582
      *
     C           @SNDR     IFNE WSNDR                                      215582
      *  Log, if test failed.
     C           PREPT     IFEQ 'Y'
     C***********RTNCDE    ANDNE'T      '                                  215582
     C           MEMSDT    CAT  PMTAG:0   MEMSDT    P
     C                     MOVELPCPGM     MEPGMQ
     C                     MOVEL'RE75408' MEMSID
     C                     MOVEL'REUSRMSG'MEMSGF           Msg file
     C                     EXSR MESNMS
     C                     ENDIF
     C                     GOTO RETN                                       215582
     C                     ENDIF                                           215582
     C*                                                                    215582
     C* Now, get top account to retrieve Destination BIC                   215582
     C                     MOVELPH50      DSTRAN                           215582
     C                     MOVELTMLIN     @TOP                             215582
     C*                                                                    215582
     C           @SLSHE    IFEQ '/'                                        215582
     C                     SELEC                                           215582
     C* Get GL account if retail given                                     215582
     C           @BL24     WHEQ *BLANK                                     215582
     C                     MOVEL@RETL     P@RETL                           215582
     C                     CALL 'AOACCTR0'             90                  215582
     C                     PARM           P@RTCD  7                        215582
     C                     PARM '*KEY   ' P@OPTN  7                        215582
     C                     PARM           P@RETL 10                        215582
     C                     PARM *BLANK    P@CNUM  6                        215582
     C                     PARM *BLANK    P@CUCD  3                        215582
     C**********           PARM *BLANK    P@ACCD  4                                    215582 CGL029
     C                     PARM *BLANK    P@ACCD 10                                           CGL029
     C                     PARM *BLANK    P@ACSQ  2                        215582
     C                     PARM *BLANK    P@BRCA  3                        215582
     C           ACCT      PARM           ACCT                             215582
     C*                                                                    215582
     C           P@RTCD    IFEQ *BLANK                                     215582
     C           RECI      ANDEQ'D'                                        215582
     C                     MOVELBRCA      KBRCA                            215582
     C**********           Z-ADDCNUM      KCNUM                                       215582 CSD027A
     C                     MOVE CNUM      KCNUM                                              CSD027A
     C                     MOVELCCY       KCCY                             215582
     C                     Z-ADDACOD      KACCD                            215582
     C                     Z-ADDACSQ      KACSQ                            215582
     C                     MOVEL'Y'       FOUND                            215582
     C                     ENDIF                                           215582
     C*                                                                    215582
     C* CHECK  IF GL ACCOUNT                                               215582
     C           @BL16     WHEQ *BLANK                                     215582
     C                     MOVEL@BRCA     P@BRCA                           215582
     C                     MOVE @CNUM     P@CNUM                           215582
     C                     MOVEL@CCY      P@CUCD                           215582
     C                     MOVE @ACOD     P@ACCD                           215582
     C                     MOVE @ACSQ     P@ACSQ                           215582
     C                     CALL 'AOACCTR0'             90                  215582
     C                     PARM           P@RTCD  7                        215582
     C                     PARM '*KEY   ' P@OPTN  7                        215582
     C                     PARM *BLANK    P@RETL 10                        215582
     C                     PARM           P@CNUM  6                        215582
     C                     PARM           P@CUCD  3                        215582
     C**********           PARM           P@ACCD  4                                    215582 CGL029
     C                     PARM           P@ACCD                                              CGL029
     C                     PARM           P@ACSQ  2                        215582
     C                     PARM           P@BRCA  3                        215582
     C           ACCT      PARM           ACCT                             215582
     C*                                                                    215582
     C           P@RTCD    IFEQ *BLANK                                     215582
     C           RECI      ANDEQ'D'                                        215582
     C                     MOVELBRCA      KBRCA                            215582
     C**********           Z-ADDCNUM      KCNUM                                       215582 CSD027A
     C                     MOVE CNUM      KCNUM                                              CSD027A
     C                     MOVELCCY       KCCY                             215582
     C                     Z-ADDACOD      KACCD                            215582
     C                     Z-ADDACSQ      KACSQ                            215582
     C                     MOVEL'Y'       FOUND                            215582
     C                     ENDIF                                           215582
     C*                                                                    215582
     C* Get GL account if IBAN given                                       215582
     C           CFT004    WHEQ 'Y'                                        215582
     C                     CALL 'AOIBANR4'             90                  215582
     C                     PARM           P@RTCD                           215582
     C                     PARM '*VERIFY' P@OPTN                           215582
     C                     PARM           @IBAN                            215582
     C           ACCT      PARM ACCT      DSSDY                            215582
     C*                                                                    215582
     C           P@RTCD    IFEQ *BLANK                                     215582
     C           RECI      ANDEQ'D'                                        215582
     C                     MOVELBRCA      KBRCA                            215582
     C**********           Z-ADDCNUM      KCNUM                                       215582 CSD027A
     C                     MOVE CNUM      KCNUM                                              CSD027A
     C                     MOVELCCY       KCCY                             215582
     C                     Z-ADDACOD      KACCD                            215582
     C                     Z-ADDACSQ      KACSQ                            215582
     C                     MOVEL'Y'       FOUND                            215582
     C                     ENDIF                                           215582
     C*                                                                    215582
     C                     ENDSL                                           215582
     C                     ENDIF                                           215582
     C*                                                                    215582
     C* Check if Top Account                                               215582
     C           FOUND     IFEQ 'Y'                                        215582
     C           KYACCO    CHAINREZSHLJ1             70                    215582
     C*                                                                    215582
     C           *IN70     IFEQ '0'                                        215582
     C* It is top account, now get destination BIC address                 215582
     C* according to destination type                                      215582
     C                     MOVEL*BLANKS   HDEST                            215582
     C                     SELEC                                           215582
     C           ZDDSTT    WHEQ 'S'                                        215582
     C                     MOVELZDDEST    HDEST                            215582
     C           ZDDSTT    WHEQ 'R'                                        215582
     C                     MOVELZDDEST    P@RETL                           215582
     C                     CALL 'AOACCTR0'             90                  215582
     C                     PARM           P@RTCD  7                        215582
     C                     PARM '*KEY   ' P@OPTN  7                        215582
     C                     PARM           P@RETL 10                        215582
     C                     PARM *BLANK    P@CNUM  6                        215582
     C                     PARM *BLANK    P@CUCD  3                        215582
     C**********           PARM *BLANK    P@ACCD  4                                    215582 CGL029
     C                     PARM *BLANK    P@ACCD                                              CGL029
     C                     PARM *BLANK    P@ACSQ  2                        215582
     C                     PARM *BLANK    P@BRCA  3                        215582
     C           ACCT      PARM           ACCT                             215582
     C           P@RTCD    IFNE *BLANK                                     215582
     C           *LOCK     IN   DLDA                                       215582
     C                     Z-ADD1         DBASE                            215582
     C                     MOVEL@RETL     DBKEY                            215582
     C                     MOVEL'AOACCT'  DBFILE                           215582
     C                     OUT  DLDA                                       215582
     C                     MOVEL'1'       *INU7                            215582
     C                     MOVEL'1'       *INU8                            215582
     C                     MOVEL'1'       *INLR                            215582
     C                     DUMP                                            215582
     C                     RETRN                                           215582
     C                     ENDIF                                           215582
     C                     MOVELCNUM      @KEY1                            215582
     C           ZDDSTT    WHEQ 'N'                                        215582
     C                     MOVELZDDEST    @NONB                            215582
     C                     CALL 'AONOSTR0'             90                  215582
     C                     PARM           @RTCD   7                        215582
     C                     PARM '*KEY   ' @OPTN   7                        215582
     C                     PARM           @CUST   6                        215582
     C                     PARM CLCCCY    @CYCD   3                        215582
     C                     PARM *BLANK    @ACCD   4                        215582
     C                     PARM *BLANK    @ACSN   2                        215582
     C                     PARM           @NONB   2                        215582
     C                     PARM *BLANK    @BRCD   3                        215582
     C                     PARM *BLANK    @CSSN  10                        215582
     C                     PARM *BLANK    @PNOI   1                        215582
     C           SDNOST    PARM SDNOST    DSFDY                            215582
     C           @RTCD     IFNE *BLANK                                     215582
     C           *LOCK     IN   DLDA                                       215582
     C                     Z-ADD3         DBASE                            215582
     C                     MOVEL'*CALL'   DBKEY                            215582
     C                     MOVEL'AONOST'  DBFILE                           215582
     C                     OUT  DLDA                                       215582
     C                     MOVEL'1'       *INU7                            215582
     C                     MOVEL'1'       *INU8                            215582
     C                     MOVEL'1'       *INLR                            215582
     C                     DUMP                                            215582
     C                     RETRN                                           215582
     C                     ENDIF                                           215582
     C                     MOVELA7CUST    @KEY1                            215582
     C                     OTHER                                           215582
     C                     MOVEL*BLANK    HDEST                            215582
     C                     ENDSL                                           215582
     C*  Access customer file to get SWIFT Id                              215582
     C*                                                                    215582
     C           @KEY1     IFNE *BLANK                                     215582
     C                     CALL 'AOCUSTR0'                                 215582
     C                     PARM *BLANKS   @RTCD   7                        215582
     C                     PARM '*KEY   ' @OPTN   7                        215582
     C                     PARM           @KEY1  10                        215582
     C                     PARM *BLANK    @KYST   7                        215582
     C           SDCUST    PARM SDCUST    DSSDY                            215582
     C           @RTCD     IFNE *BLANK                                     215582
     C           *LOCK     IN   DLDA                                       215582
     C                     Z-ADD2         DBASE                            215582
     C                     MOVEL@KEY1     DBKEY                            215582
     C                     MOVEL'SDCUST'  DBFILE                           215582
     C                     OUT  DLDA                                       215582
     C                     MOVEL'1'       *INU7                            215582
     C                     MOVEL'1'       *INU8                            215582
     C                     MOVEL'1'       *INLR                            215582
     C                     DUMP                                            215582
     C                     RETRN                                           215582
     C                     ENDIF                                           215582
     C                     MOVELBBCSID    HDEST                            215582
     C                     ENDIF                                           215582
     C*                                                                    215582
     C* Default branch to 'XXX' if blank                                   215582
     C           HDEST3    IFEQ *BLANK                                     215582
     C                     MOVE 'XXX'     HDEST3                           215582
     C                     ENDIF                                           215582
     C*                                                                    215582
     C* Destination Bic must be equal to that in fld 57A                   215582
     C           @SNDR     IFEQ HDEST                                      215582
     C           POPER     ANDEQ'EQ'                                       215582
     C                     MOVEL'T'       RTNCDE    P                      215582
     C                     ENDIF                                           215582
     C                     ENDIF                                           215582
     C                     ENDIF                                           215582
      *                                                                    215582
      *  Log, if test failed.                                              215582
     C           PREPT     IFEQ 'Y'                                        215582
     C           RTNCDE    ANDNE'T      '                                  215582
     C           MEMSDT    CAT  PMTAG:0   MEMSDT    P                      215582
     C                     MOVELPCPGM     MEPGMQ                           215582
     C                     MOVEL'RE75963' MEMSID                           215582
     C                     MOVEL'REUSRMSG'MEMSGF           Msg file        215582
     C                     EXSR MESNMS                                     215582
     C                     ENDIF                                           215582
      *                                                                    215582
     C           RETN      TAG                                             215582
     C**********           DUMP                                                      215582 AR972613
     C                     RETRN
     C/COPY MECPYSRC,SMESNMSC
      *****************************************************************
      /EJECT
      *****************************************************************
**  CPY@
(c) Finastra International Limited 2002
