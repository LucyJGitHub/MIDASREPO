/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI    DFTACTGRP(*NO)                                              */
/*EXI *  TEXT('Midas FRS Extract Process - Start')                   */
/*********************************************************************/
/*                                                                   */
/*       MidasPlus - FRS Regulatory Reporting                        */
/*                                                                   */
/*       RNC000010 - Extract Process - Start                         */
/*                                                                   */
/*       (c) Misys International Banking Systems Ltd. 2005           */
/*                                                                   */
/* Bank Fusion Midas 1.4 Base ---------------------------------------*/
/* Midas Plus 1.4 Base 04 -------------------------------------------*/
/* Midas Plus 1.4 Base ----------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base -----------------------------*/
/*       Last Amend No. CRN001  *CREATE    Date 27Sep05              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       CRN001 - FRS Regulatory Reporting                           */
/*                                                                   */
/*********************************************************************/
 
             PGM
 
/* Audit/exception file names.                                       */
/*/COPY RNCPYSRC,RNAUFILNAM                                          */
 
/* Extract file names.                                               */
/*/COPY RNCPYSRC,RNXTFILNAM                                          */
 
             DCL        VAR(&POS) TYPE(*UINT)
             DCL        VAR(&FILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&T__FILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&RTNERR) TYPE(*LGL)
             DCL        VAR(&MSGTEXT) TYPE(*CHAR) VALUE('RNC000010 - +
                          Regulatory Reporting Extract Process Start')
 
             COPYRIGHT  TEXT('(c) Misys International Banking +
                          Systems Ltd. 2005')
 
/* Global monitor message */
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(ABNOR))
 
             SNDPGMMSG  MSG(&MSGTEXT) TOMSGQ(MRUNQ)
 
             CHGDTAARA  DTAARA(LDA) VALUE(' ')
             CHGJOB     SWS(XXXXXX00)
 
 
/* The following file members must exist. */
 
/* Audit and exception: */
             CHKOBJ     OBJ(RNAUCFPD) OBJTYPE(*FILE) MBR(DLEV)
             CHKOBJ     OBJ(RNAUCFPD) OBJTYPE(*FILE) MBR(LEEV)
             CHKOBJ     OBJ(RNAUCFPD) OBJTYPE(*FILE) MBR(PDUE)
             CHKOBJ     OBJ(RNXCCFPD) OBJTYPE(*FILE) MBR(DLEV)
             CHKOBJ     OBJ(RNXCCFPD) OBJTYPE(*FILE) MBR(LEEV)
             CHKOBJ     OBJ(RNXCCFPD) OBJTYPE(*FILE) MBR(PDUE)
             CHKOBJ     OBJ(RNAUMVPD) OBJTYPE(*FILE) MBR(DLKY)
             CHKOBJ     OBJ(RNAUMVPD) OBJTYPE(*FILE) MBR(FTKY)
             CHKOBJ     OBJ(RNAUMVPD) OBJTYPE(*FILE) MBR(LEKY)
             CHKOBJ     OBJ(RNXCMVPD) OBJTYPE(*FILE) MBR(DLKY)
             CHKOBJ     OBJ(RNXCMVPD) OBJTYPE(*FILE) MBR(FTKY)
             CHKOBJ     OBJ(RNXCMVPD) OBJTYPE(*FILE) MBR(LEKY)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(FXDL)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(LDNI)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(FRAS)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(SWAP)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(CFCO)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(LOAN)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(FCLT)
             CHKOBJ     OBJ(RNAUPNPD) OBJTYPE(*FILE) MBR(NASP)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(FXDL)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(LDNI)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(FRAS)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(SWAP)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(CFCO)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(LOAN)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(FCLT)
             CHKOBJ     OBJ(RNXCPNPD) OBJTYPE(*FILE) MBR(NASP)
 
/* Extract files: */
             CHKOBJ     OBJ(RN_CASFLOA) OBJTYPE(*FILE) MBR(DLEV)
             CHKOBJ     OBJ(RN_CASFLOA) OBJTYPE(*FILE) MBR(LEEV)
             CHKOBJ     OBJ(RN_CASFLOA) OBJTYPE(*FILE) MBR(PDUE)
             CHKOBJ     OBJ(RN_CASHFLO) OBJTYPE(*FILE) MBR(DLEV)
             CHKOBJ     OBJ(RN_CASHFLO) OBJTYPE(*FILE) MBR(LEEV)
             CHKOBJ     OBJ(RN_CASHFLO) OBJTYPE(*FILE) MBR(PDUE)
             CHKOBJ     OBJ(RN_COLAMO) OBJTYPE(*FILE) MBR(COLL)
             CHKOBJ     OBJ(RN_COLLATE) OBJTYPE(*FILE) MBR(COLL)
             CHKOBJ     OBJ(RN_COLLUS) OBJTYPE(*FILE) MBR(COLL)
             CHKOBJ     OBJ(RN_COUNAPJ) OBJTYPE(*FILE) MBR(CPTY)
             CHKOBJ     OBJ(RN_COUNTER) OBJTYPE(*FILE) MBR(CPTY)
             CHKOBJ     OBJ(RN_COUNUS) OBJTYPE(*FILE) MBR(CPTY)
             CHKOBJ     OBJ(RN_CTPFIM) OBJTYPE(*FILE) MBR(CPTY)
             CHKOBJ     OBJ(RN_CTPFIMU) OBJTYPE(*FILE) MBR(CPTY)
             CHKOBJ     OBJ(RN_CUAAMO) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_CUSACCA) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_CUSACCU) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_CUSTACC) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_DERAMO) OBJTYPE(*FILE) MBR(FXDL)
             CHKOBJ     OBJ(RN_DERAMO) OBJTYPE(*FILE) MBR(FRAS)
             CHKOBJ     OBJ(RN_DERAMO) OBJTYPE(*FILE) MBR(SWAP)
             CHKOBJ     OBJ(RN_DERAMO) OBJTYPE(*FILE) MBR(CFCO)
             CHKOBJ     OBJ(RN_DERIUS) OBJTYPE(*FILE) MBR(FXDL)
             CHKOBJ     OBJ(RN_DERIUS) OBJTYPE(*FILE) MBR(FRAS)
             CHKOBJ     OBJ(RN_DERIUS) OBJTYPE(*FILE) MBR(SWAP)
             CHKOBJ     OBJ(RN_DERIUS) OBJTYPE(*FILE) MBR(CFCO)
             CHKOBJ     OBJ(RN_DERIVAT) OBJTYPE(*FILE) MBR(FXDL)
             CHKOBJ     OBJ(RN_DERIVAT) OBJTYPE(*FILE) MBR(FRAS)
             CHKOBJ     OBJ(RN_DERIVAT) OBJTYPE(*FILE) MBR(SWAP)
             CHKOBJ     OBJ(RN_DERIVAT) OBJTYPE(*FILE) MBR(CFCO)
             CHKOBJ     OBJ(RN_GELAMO) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_GENELED) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_GENLEDA) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_GENLEDU) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_GUAAMO) OBJTYPE(*FILE) MBR(LOAN)
             CHKOBJ     OBJ(RN_GUARANT) OBJTYPE(*FILE) MBR(LOAN)
             CHKOBJ     OBJ(RN_LIMIAMO) OBJTYPE(*FILE) MBR(FCLT)
             CHKOBJ     OBJ(RN_LIMIT) OBJTYPE(*FILE) MBR(FCLT)
             CHKOBJ     OBJ(RN_LOADEPA) OBJTYPE(*FILE) MBR(LDNI)
             CHKOBJ     OBJ(RN_LOADEPA) OBJTYPE(*FILE) MBR(LOAN)
             CHKOBJ     OBJ(RN_LOADEPU) OBJTYPE(*FILE) MBR(LDNI)
             CHKOBJ     OBJ(RN_LOADEPU) OBJTYPE(*FILE) MBR(LOAN)
             CHKOBJ     OBJ(RN_LOANDEP) OBJTYPE(*FILE) MBR(LDNI)
             CHKOBJ     OBJ(RN_LOANDEP) OBJTYPE(*FILE) MBR(LOAN)
             CHKOBJ     OBJ(RN_LODAMO) OBJTYPE(*FILE) MBR(LDNI)
             CHKOBJ     OBJ(RN_LODAMO) OBJTYPE(*FILE) MBR(LOAN)
             CHKOBJ     OBJ(RN_MOVEMEN) OBJTYPE(*FILE) MBR(DLKY)
             CHKOBJ     OBJ(RN_MOVEMEN) OBJTYPE(*FILE) MBR(FTKY)
             CHKOBJ     OBJ(RN_MOVEMEN) OBJTYPE(*FILE) MBR(LEKY)
             CHKOBJ     OBJ(RN_MOVLEG) OBJTYPE(*FILE) MBR(DLKY)
             CHKOBJ     OBJ(RN_MOVLEG) OBJTYPE(*FILE) MBR(FTKY)
             CHKOBJ     OBJ(RN_MOVLEG) OBJTYPE(*FILE) MBR(LEKY)
             CHKOBJ     OBJ(RN_MOVLEGA) OBJTYPE(*FILE) MBR(DLKY)
             CHKOBJ     OBJ(RN_MOVLEGA) OBJTYPE(*FILE) MBR(FTKY)
             CHKOBJ     OBJ(RN_MOVLEGA) OBJTYPE(*FILE) MBR(LEKY)
             CHKOBJ     OBJ(RN_PRLAMO) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_PROFLOS) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_PROFLOU) OBJTYPE(*FILE) MBR(ACCT)
             CHKOBJ     OBJ(RN_RATIEXT) OBJTYPE(*FILE) MBR(CPTY)
             CHKOBJ     OBJ(RN_SECAMO) OBJTYPE(*FILE) MBR(NASP)
             CHKOBJ     OBJ(RN_SECUAPJ) OBJTYPE(*FILE) MBR(NASP)
             CHKOBJ     OBJ(RN_SECURIT) OBJTYPE(*FILE) MBR(NASP)
             CHKOBJ     OBJ(RN_SECUUS) OBJTYPE(*FILE) MBR(NASP)
             CHKOBJ     OBJ(RN_UICUSA) OBJTYPE(*FILE) MBR(FTKY)
             CHKOBJ     OBJ(RN_UIDER) OBJTYPE(*FILE) MBR(DLKY)
             CHKOBJ     OBJ(RN_UILOAD) OBJTYPE(*FILE) MBR(DLKY)
             CHKOBJ     OBJ(RN_UILOAD) OBJTYPE(*FILE) MBR(LEKY)
             CHKOBJ     OBJ(RN_UISEC) OBJTYPE(*FILE) MBR(DLKY)
 
 
/* Audit / exception files:                                          */
/* loop thru variable containing file names;                         */
/* remove logical file members (rnc000012);                          */
/* clear physical file members (rnc000013).                          */
 
             CHGVAR     VAR(&POS) VALUE(1)
 NXT_AUFIL:
             CHGVAR     VAR(&FILE) VALUE(%SST(&AUFILNAM &POS 10))
             MONMSG     MSGID(CPF0804) EXEC(GOTO CMDLBL(END_AUFIL))
 
             IF         COND(&FILE = ' ') THEN(GOTO CMDLBL(BYPAS_AU))
 
             CALL       PGM(RNC000012) PARM(&RTNERR &FILE '*RMV')
             IF         COND(&RTNERR) THEN(GOTO CMDLBL(ABNOR))
 
             CALL       PGM(RNC000013) PARM(&RTNERR &FILE)
             IF         COND(&RTNERR) THEN(GOTO CMDLBL(ABNOR))
 
 BYPAS_AU:
             CHGVAR     VAR(&POS) VALUE(&POS + 10)
             GOTO       CMDLBL(NXT_AUFIL)
 
 END_AUFIL:
 
 
/* Extract files:                                                    */
/* loop thru variable containing file names;                         */
/* clear physical file members (rnc000013).                          */
 
             CHGVAR     VAR(&POS) VALUE(1)
 NXT_XTFIL:
             CHGVAR     VAR(&FILE) VALUE(%SST(&XTFILNAM &POS 10))
             MONMSG     MSGID(CPF0804) EXEC(GOTO CMDLBL(END_XTFIL))
 
             IF         COND(&FILE = ' ') THEN(GOTO CMDLBL(BYPAS_XT))
 
/* Clear the single member T__... file (sql table). */
             IF         COND(%SST(&FILE 1 3) = 'RN_') THEN(DO)
             CHGVAR     VAR(&T__FILE) VALUE('T__' *CAT %SST(&FILE 4 7))
             CLRPFM     FILE(&T__FILE)
             ENDDO
 
             CALL       PGM(RNC000013) PARM(&RTNERR &FILE)
             IF         COND(&RTNERR) THEN(GOTO CMDLBL(ABNOR))
 
 BYPAS_XT:
             CHGVAR     VAR(&POS) VALUE(&POS + 10)
             GOTO       CMDLBL(NXT_XTFIL)
 
 END_XTFIL:
             GOTO       CMDLBL(ENDPGM)
 
 ABNOR:
             CHGJOB     SWS(XXXXXX11)
 
 ENDPGM:
             RCLACTGRP  ACTGRP(*ELIGIBLE)
             MONMSG     MSGID(CPF0000)
 
             ENDPGM
