     H
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas Abnormal termination report')
     F********************************************************************
     F*                                                                  *
     F*  Midas - Restart Recovery Module
     F*                                                                  *
     F*       SD1797 - Delete 'CM' entries outside recovery areas        *
     F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
     F*                                                                  *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. E13205             Date 23/02/89              *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*     New Program Overview                                         *
     F*                                                                  *
      *  MD046248 - Finastra Rebranding                               *
     F*     E13205 - Delete all 'CM' entries from JRNEXS which do        *
     F*              not apply with this recovery run. Places all        *
     F*              these in JRNEX2.                                    *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
     F*     CHANGE DESCRIPTIONS                                          *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*     CREATION REQUIREMENTS                                        *
     F*                                                                  *
     F*****************************************************************
     F*
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FJRNEXS  UF  E           K        DISK
     F            QJORDJE                           KRENAMEJRNEX1F
     FJRNEX2  O   E                    DISK                      A    U1
     F            QJORDJE                           KRENAMEJRNEX2F
     F*                                                                 **
     F* ID F  C  H  L    Funtion of Indicators
     F*                                                                 **
     F*       45         End of file indicator                          **
     F*                                                                 **
     E                    CPY@    1   1 80
     I*
     I* Data structure for field definition for entry type 'ER'
     I*
     I            DS
     I                                        1  50 INFO
     I                                        1  100SQNRTP
     C                     MOVEACPY@      BIS@   80
     C*
     C                     READ JRNEXS                   45
     C*
     C           *IN45     DOWEQ'0'
     C*
     C* Journal entry type'ER', save sequence number for range of
     C* deletes
     C*
     C           JOENTT    IFEQ 'ER'
     C                     EXSR DELCMS
     C                     END
     C*
     C                     READ JRNEXS                   45
     C                     END
     C*
     C                     SETON                     LR
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*  Subroutine DELCMS - delete commit entries                   *
     C*                                                              *
     C****************************************************************
     CSR         DELCMS    BEGSR
     C*
     C                     Z-ADDSQNRTP    ERSQN  100
     C   U1                WRITEJRNEX2F
     C                     READ JRNEXS                   45
     C*
     C*   Read file until EOF or outside sequence number range
     C*
     C           JOSEQN    DOWGTERSQN
     C           *IN45     ANDEQ'0'
     C*
     C*   Delete record if a commit entry
     C*
     C   U1                WRITEJRNEX2F
     C           JOENTT    IFEQ 'CM'
     C                     DELETJRNEX1F
     C                     END
     C*
     C                     READ JRNEXS                   45
     C                     END
     C*
     CSR         DELEXT    ENDSR
**  CPY@
(c) Finastra International Limited 2001
