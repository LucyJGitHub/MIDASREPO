/*********************************************************************/
/*STD    CLPBASEMOD                                                  */
/*EXI *  TEXT('Midas SC Check if data replication to run')           */
/*********************************************************************/
/*                                                                   */
/*       Midas - System Control Module                               */
/*                                                                   */
/*       SCC000600 - Check if Data Replication to Run                */
/*                                                                   */
/*       (c) Finastra International Limited 2001                     */
/*                                                                   */
/*       Last Amend No. MD046248           Date 27Oct17              */
/* Bank Fusion Midas 1.4 Base ---------------------------------------*/
/* Midas Plus 1.4 Base 04 -------------------------------------------*/
/* Midas Plus 1.4 Base ----------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base -----------------------------*/
/* Midas Release 4.01 -----------------------------------------------*/
/*       Prev Amend No. CSC011  *CREATE    Date 18Sep01              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       MD046248 - Finastra Rebranding                              */
/*       CSC011 - 24x7 Midas Availability                            */
/*                                                                   */
/*********************************************************************/
             PGM
 
             DCL        VAR(&SBATCH) TYPE(*CHAR) LEN(1)
             DCL        VAR(&BTCHNO) TYPE(*CHAR) LEN(1)
             DCL        VAR(&SCDRSTAT) TYPE(*CHAR) LEN(256)
             DCL        VAR(&SUPP) TYPE(*CHAR) LEN(2)
             DCL        VAR(&SXLIB) TYPE(*CHAR) LEN(6)
             DCL        VAR(&SCREEN) TYPE(*CHAR) LEN(10)
             DCL        VAR(&PGM) TYPE(*CHAR) LEN(10)
             DCL        VAR(&REPLY) TYPE(*CHAR) LEN(1)
             DCL        VAR(&JOBTYPE) TYPE(*CHAR) LEN(1)
 
             COPYRIGHT TEXT('(c) Finastra International Limited +
                          2002')
 
/** Global monitor message */
 
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(ABNOR))
             CHGJOB     SWS(00000000)
 
             RTVJOBA    TYPE(&JOBTYPE)
             RTVDTAARA  DTAARA(SC24X7 (3 2)) RTNVAR(&SUPP)
             CHGVAR     VAR(&SXLIB) VALUE(&SUPP *CAT 'XLIB')
 
             RTVDTAARA  DTAARA(SCDRSTAT) RTNVAR(&SCDRSTAT)
             RTVDTAARA  DTAARA(SCDRSTAT (4 1)) RTNVAR(&SBATCH)
 
             SNDPGMMSG  MSG('SCC000600 - Data replication start up +
                          commenced') TOMSGQ(MOPERQ SC24X7Q)
 
 /**/
 /** A Data Replication Configurator error exists */
 /**/
             IF         COND(%SST(&SCDRSTAT 2 1) *EQ 'Y') THEN(DO)
                IF         COND(&JOBTYPE = '1') THEN(DO)
                  CHGVAR     VAR(&PGM) VALUE('SCC000600')
                  CHGVAR     VAR(&REPLY) VALUE(' ')
                  CHGVAR     VAR(&SCREEN) VALUE('SDC0700F3')
                  CALL       PGM(SDC0700) PARM(&PGM &SCREEN &REPLY)
                ENDDO
                SNDPGMMSG  MSG('SCC000600 - A Data Replication +
                           Configurator Error Exists. The job is +
                           terminated.') TOMSGQ(MOPERQ SC24X7Q)
                MONMSG     MSGID(CPF0000 MCH0000)
                GOTO       CMDLBL(END)
             ENDDO
 /**/
 /** Stop data replication from running */
 /**/
             IF         COND(%SST(&SCDRSTAT 1 1) *EQ 'Y') THEN(DO)
                IF         COND(&JOBTYPE = '1') THEN(DO)
                  CHGVAR     VAR(&PGM) VALUE('SCC000600')
                  CHGVAR     VAR(&REPLY) VALUE(' ')
                  CHGVAR     VAR(&SCREEN) VALUE('SDC0700F2')
                  CALL       PGM(SDC0700) PARM(&PGM &SCREEN &REPLY)
                ENDDO
                SNDPGMMSG  MSG('SCC000600 - General Error on Data +
                           Replication.  The job is terminated') +
                           TOMSGQ(MOPERQ SC24X7Q)
                MONMSG     MSGID(CPF0000 MCH0000)
                GOTO       CMDLBL(END)
             ENDDO
 
             SBMJOB     CMD(CALL PGM(SCC000606)) JOB(DRMONITOR) +
                          JOBD(&SXLIB/DRJOBD) JOBQ(&SXLIB/DRJOBQ) +
                          PRTDEV(*JOBD) OUTQ(*JOBD) USER(*JOBD) +
                          INLLIBL(*JOBD) LOG(4 0 *SECLVL) +
                          LOGCLPGM(*YES)
 /**/
 /** Single batch replication */
 /**/
             IF         COND(&SBATCH *EQ 'Y') THEN(DO)
                IF         COND(%SST(&SCDRSTAT 15 1) *EQ ' ') THEN(DO)
                    CHGVAR   VAR(&BTCHNO) VALUE('0')
                    CALL     PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
             ENDDO
             ELSE (DO)
 /**/
 /** Multiple batch replication */
 /**/
 /** Batch 0 */
 /**/
                IF         COND((%SST(&SCDRSTAT 5 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 15 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('0')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 1 */
 /**/
                IF         COND((%SST(&SCDRSTAT 6 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 16 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('1')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 2 */
 /**/
                IF         COND((%SST(&SCDRSTAT 7 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 17 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('2')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 3 */
 /**/
                IF         COND((%SST(&SCDRSTAT 8 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 18 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('3')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 4 */
 /**/
                IF         COND((%SST(&SCDRSTAT 9 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 19 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('4')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 5 */
 /**/
                IF         COND((%SST(&SCDRSTAT 10 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 20 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('5')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 6 */
 /**/
                IF         COND((%SST(&SCDRSTAT 11 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 21 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('6')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 7 */
 /**/
                IF         COND((%SST(&SCDRSTAT 12 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 22 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('7')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 8 */
 /**/
                IF         COND((%SST(&SCDRSTAT 13 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 23 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('8')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
 /**/
 /** Batch 9 */
 /**/
                IF         COND((%SST(&SCDRSTAT 14 1) *EQ 'Y') *AND  +
                           (%SST(&SCDRSTAT 24 1) *EQ ' ')) THEN(DO)
                              CHGVAR VAR(&BTCHNO) VALUE('9')
                              CALL PGM(SCC000605) PARM(&BTCHNO)
                ENDDO
             ENDDO
 
             SNDPGMMSG  MSG('SCC000600 - Data Replication start up +
                          completed successfully.') TOMSGQ(MOPERQ +
                          SC24X7Q)
             GOTO       CMDLBL(END)
 
/** Abnormal termination */
 
 ABNOR:      CHGJOB     SWS(XXXXXX11)
             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program +
                          SCC000600 ended abnormally - see joblog') +
                          TOMSGQ(MOPERQ SC24X7Q)
             MONMSG     MSGID(CPF0000 MCH0000)
 
/** End program */
 
 END:        ENDPGM
