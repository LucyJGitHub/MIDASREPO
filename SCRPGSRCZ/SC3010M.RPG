     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SC Switchable features maintenance')             *
      *****************************************************************
      *                                                               *
      *  Midas - System Control Module                                *
      *                                                               *
      *  SC3010M - Switchable Features Maintenance Subfile.           *
      *                                                               *
      *  Function:  This program allows the maintenance of the        *
      *             switchable features file.                         *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. AR754826           Date 13May11               *
      *  Prev Amend No. CUP007             Date 12Apr06               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG10771           Date 12Apr06               *
      *                 CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 05Oct01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSC010             Date 19Jan99               *
      *                 CSC008             Date 08May98               *
      *                 CSC007             Date 08May98               *
      *                 139358             Date 22JUL98               *
      *                 CCB008             Date 02JAN98               *
      *                 S01486             Date 21OCT94               *
      *                 S01488             Date 08AUG94               *
      *                 S01459             Date 08AUG94               *
      *                 S01430                  07JUL93               *
      *                 S01407                  20JAN93               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  AR754826 - UTMENU should check for corresponding Global      *
      *             feature status (Child: AR754827)                  *
      *  CUP007 - 10771 not complete                                  *
      *  BUG10771 - Automatically replicate SFMENUPD to GZSFMENUPD    *
      *             and SCSARDPD to GZSCSARDPD. Then, call APCCRTNDFL.*
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CPK014 - Release 4 packaging:                                *
      *           - Remove journalling maintenance processing.        *
      *  CSC010 - Disable/enable switchable feature user option added *
      *  CSC008 - These lines of code should be deleted at DBAR3      *
      *           when the password switchable feature ceases to      *
      *           become an option.                                   *
      *  CSC007 - Switchable Features Enhancements phase 2.           *
      *           Amendments to Switchable Features suite of          *
      *           programs to allow switching on via passwords.       *  *
      *           New code to coincide with these amendments are      *  *
      *           under CSC005.                                       *  *
      *  139358 - Addition of call to the automatic journalling       *
      *           program.                                            *
      *  CCB008 - Synon Closedown Project (CB):                       *
      *           - Program removed from CB model.                    *
      *  S01486 - Validation added to prevent internal switchable     *
      *           features from being inserted or deleted.            *
      *  S01488 - Addition of switchable features insert/delete       *
      *           precheck.                                           *
      *  S01459 - Addition of headerbox and PSSR processing.          *
      *  S01430 - Switchability Enhancements Phase 2:                 *
      *           - Inclusion of switchable feature initialisation    *
      *             programs.                                         *
      *  S01407 - Switchability Enhancements.                         *
      *                                                               *
      *****************************************************************
     FSC3010M#CF  E                    WORKSTN                        UC
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
     F                                              KINFSR *PSSR
      * DSP: Midas SC Switchable features maintenance
      *
     F*CSARDL1IF**E*********  K        DISK                           UC  CSC010
      *
      * Displays features appearing on SCSARDPD plus all disabled
      * features.
      *
     FSCSAREL1IF  E           K        DISK                           UC  CSC010
     F                                              KINFDS INFDS1
     F                                              KINFSR *PSSR
      * RTV : Midas SC Switchable features description
      *
     FSCSARPL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0001
     F                                              KINFSR *PSSR
      * RTV : Midas SC Switchable f - initialisation pgm
      *
     F*CSARDL0UF**E***********K        DISK                      A    UC  CSC010
     FSCSAREL0UF  E           K        DISK                      A    UC  CSC010
     F                                              KINFDS ID0002
     F                                              KINFSR *PSSR
      * UPD : Midas SC Switchable features description
      *
     E                    ARNA    1   2 78
      *
      ** Change mode                                                      S01229
      *
     E* Description     : Copyright notice for inclusion in all programs
     E*
     E********************************************************************
     E                    CPY@    1   1 80               Copyright array
     I*
     I* Description     : Copyright notice for inclusion in all programs
     I*
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I****@1DBRC    E DSSCSARDL0                                          CSC010
     I@1DBRC    E DSSCSAREL0                                              CSC010
      * UPD : Midas SC Switchable features description
      * Current/previous master file format fields for change control
      *
     IDSFDY     E DSDSFDY                                                 CSC010
     I**  Short data structure for access objects
     I*
     ISCSARD    E DSSCSARDPD                                              CSC010
     IA@CPY       DS
     I* Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNB
     I                                       11  11 SUC
     I                                       12  12 DFF
     I                                       13  13 MBIN
     IYRSW0A      DS                           9999
     IYRSW0B      DS                           9999
     IYRSW0C      DS                           9999
     IYRSW0D      DS                           9999
     IID0001      DS                            528
      * File information data structure
      *
     IID0002      DS                            528
      * File information data structure
      *
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Internal feature not vald'
      * Switchable Feature Number
     I                                        1   6 ZA0001
      * Message data for 'Switch F Rept - One'
      * Switchable Feature Number
     I                                        1   6 ZA0002
      * Message data for 'SwitchF Descr not entered'
      * Description
     I                                        1  50 ZA0003
      * Message data for 'S/Feature cannot be added'
      * Switchable Feature Number
     I                                        1   6 ZA0004
      * Message data for 'S/Feature cannot be delet'
      * Switchable Feature Number
     I                                        1   6 ZA0005
      * Message data for 'Internal feature not vald'
      * Switchable Feature Number
     I                                        1   6 ZA0006
      * Message data for 'Init pgm call successful'
      * Program Name
     I                                        1  10 ZA0007
      * Switchable Feature Number
     I                                       11  16 ZA0008
      * Message data for 'Init pgm call error'
      * Program Name
     I                                        1  10 ZA0009
      * Switchable Feature Number
     I                                       11  16 ZA0010
      * Message data for 'Init pgm call error once'
      * Switchable Feature Number
     I                                        1   6 ZA0011
      * Global switchable feature status                                                    AR754826
     I                                        7   9 ZA0012                                  AR754826
      ** Assign Midas GP Global switchable features access object to constant               AR754826
     I              'GPAOSARDR0'          C         GPAOSA                                  AR754826
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     MOVEL'Disabled'#DSSTS  8                       CSC010
     C                     EXSR INACHK                                    CSC010
     C           P0RTN     IFEQ 'B'                                       CSC007
     C                     MOVE *ON       *IN36                           CSC007
     C                     ENDIF                                          CSC007
     C           P0RTN     IFEQ 'C'                                       CSC007
     C                     MOVE *ON       *IN35                           CSC007
     C                     ENDIF                                          CSC007
     C           P0RTN     IFEQ 'B'                                       CSC007
     C           P0RTN     OREQ 'C'                                       CSC007
     C                     MOVELP0RTN     CORFLG  1                       CSC007
     C                     MOVE *BLANKS   W0RTN                           CSC007
     C                     ENDIF                                          CSC007
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display all inactive features, or confirm all features active
     C   15                CAS            INACTF                          CSC010
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      *................................................................
      * If CHANGE mode, then position file:
     C           W0PMD     IFNE 'ADD'
     C           *LIKE     DEFN #2SARN    WZSARN
     C                     MOVEL#2SARN    WZSARN           Switchable Feat
     C           KPOS      KLIST
     C                     KFLD           ABSARN           Switchable Feat
      * Setup key
     C                     MOVEL#2SARN    ABSARN           Switchable Feat
      * 82=EOF
     C******     KPOS      SETLL@SARDL1              82    *    CSC010
     C           KPOS      SETLLSCSAREL1             82    *    CSC010
      * 82=EOF
     C**N82***             READ @SARDL1                9182*    CSC010
     C  N82                READ SCSAREL1               9182*    CSC010
     C                     ELSE
     C                     SETOF                     82    *
     C                     END
      * Load subfile page
     C                     EXSR BBLDSF
      * If no records (first time only), switch to add mode and load agai
     C           W0APM     IFEQ 'Y'
     C           ##RR      ANDEQ*ZERO
     C                     MOVEL'ADD'     W0PMD
     C                     SETOF                     82    *
     C                     EXSR BBLDSF
     C                     END
     C                     MOVEL'N'       W0APM   1
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page (write empty page if add mode)
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27      W0PMD     IFNE 'ADD'
     C**N82****            READP@SARDL1                  90     CSC010
     C**N82****            READ @SARDL1                  90     CSC010
     C  N82                READPSCSAREL1                 90     CSC010
     C  N82                READ SCSAREL1                 90     CSC010
     C                     END
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  3
     C                     MOVE *ALL'1'   WKIND1  3
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFLN                     DO
     C                     ADD  1         ##RR
     C                     MOVEAWKIND0    *IN,32
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * If CHANGE mode, load subfile fields
     C           W0PMD     IFNE 'ADD'
     C                     EXSR MBFL#1
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialize subfile record (existing record)
      * Load additonal footer text
      * SC3010M Additional Footer - Switchable Features  *
     C           W0PMD     IFNE 'ADD'                                     S01229
     C                     MOVEAARNA,2    ##ARNA                          S01229
     C                     ELSE
     C                     MOVE *BLANKS   ##ARNA                          S01229
     C                     END
      *
      * If record dropped...
     C                     SUB  1         ##RR
     C           W0RSL     CABNE'Y'       BB020
     C                     ADD  1         ##RR
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
     C                     ELSE
      * USER: Initialize subfile record (new record)
      * Do not load additional footer text
      * SC3010M Additional Footer - Switchable Features  *
     C           W0PMD     IFNE 'ADD'                                     S01229
     C                     MOVEAARNA,2    ##ARNA                          S01229
     C                     ELSE
     C                     MOVE *BLANKS   ##ARNA                          S01229
     C                     END
     C                     END
      * Output to subfile
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C           W0PMD     IFNE 'ADD'
      * 82=EOF
     C*******              READ SCSARDL1                 82*    CSC010
     C                     READ SCSAREL1                 82     CSC010
     C                     END
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C           W0PMD     IFEQ 'CHG'
      * When re-enabling a switchable feature, clear subfile
     C           ACTCOD    IFEQ '+'                                       CSC010
     C           WQ0021    OREQ '-'                                       CSC010
     C           WQ0021    OREQ 'D'                                       CSC010
     C                     EXSR BAIZSF                                    CSC010
     C                     ENDIF                                          CSC010
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
     C                     MOVE *BLANKS   #1SEL                           CSC010
     C                     MOVE *BLANKS   #1SARN                          CSC010
     C                     MOVE *BLANKS   #1SARD                          CSC010
     C                     MOVE *BLANKS   ACTCOD                          CSC010
     C                     MOVE *BLANKS   WQ0021                          CSC010
     C                     ENDIF
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
     C           W0PMD     IFNE 'ADD'
      * Change of position specified
     C           WZSARN    CASNE#2SARN    FBRQRL           Switchable Feat
     C                     END
     C                     END
      * USER: Validate subfile control
      * F11=Print Pressed
      * CASE: CTL.*CMD key is CF11
     C           *IN11     IFEQ '1'                        *IF
      * Print  Switchable F - All - Switchable Features  *
     C                     CALL 'SC3010P'              90  Print  Switchab
     C                     PARM *BLANK    W0RTN   7
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3010P' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Send message 'Switch F Rept - All'
     C                     MOVEL'CBM0035' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      * Switch between *ADD/*CHANGE modes
     C   09                EXSR FACHMD
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,32
      * No errors
     C                     SETOF                     98
      * No SFLNXTCHG
     C                     SETOF                     84
     C           W0PMD     IFEQ 'ADD'
      * Check for null record
     C                     EXSR DDNLRC
     C           W0NLR     IFEQ 'Y'
     C                     GOTO DCEXIT
     C                     END
      * If not null record, continue
     C                     END
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
     C           #1SEL     IFEQ '*'                                       CSC010
      *
      * Check if feature is on disabled file
      *
     C           #1SARN    CHAINSCSARED0             54                   CSC010
      *
      * If the feature is on the disabled file, the
      * user is trying to re-enable it.
      *
      * *IN54 is used to condition the display of the DISABLED flag
      * on the maintenance subfile display.
      *
     C           *IN54     IFEQ *OFF                                      CSC010
      *
      * call dependency checking program, to see if the user
      * may re-enable the feature, as other dependent features
      * may have been switched of  or disabled since.
      *
      * Follow the same dependency checking as the insert action code,
      * but do not insert a password on the password file
      *
     C                     CALL 'SC3010X'                                 CSC010
     C                     PARM           RTN     7                       CSC010
      * '+' means 'enable'.
     C                     PARM '+'       ACTCOD  1                       CSC010
     C                     PARM           #1SARN                          CSC010
     C                     PARM           ALLOW   1                       CSC010
      *
      * set up fields for call to error handling subroutine ZASNMS
      *
     C                     MOVEL'SC3010M' ZAPGMQ                          CSC010
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC010
      *
      * if dependency checking program disallows the enabling of the
      * feature, send an error message.
      *
     C           ALLOW     IFNE 'Y'                                       CSC010
     C                     MOVE 'CBM0229' ZAMSID                          CSC010
     C                     MOVEL#1SARN    ZAMSDA                          CSC010
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC010
     C                     EXSR ZASNMS                                    CSC010
     C                     ELSE                                           CSC010
      *
      * if dependency checking program allows the enabling of the
      * feature, write the feature back to SCSARDPD from the
      * file which holds temporarily disabled features
      *
     C                     MOVE 'CBM0239' ZAMSID                          CSC010
     C                     MOVEL#1SARN    ZAMSDA                          CSC010
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC007
     C                     EXSR ZASNMS                                    CSC010
      *                                                                                     AR754826
      ** Check the global SF status                                                         AR754826
      *                                                                                     AR754826
     C                     EXSR CHKGFS                                                      AR754826
      ** If corresponding global feature is OFF, tell user to switched ON                   AR754826
     C           'off'     IFEQ ZA0012                                                      AR754826
     C                     MOVEL'on '     ZA0012                                            AR754826
     C                     MOVE 'CBM0252' ZAMSID                                            AR754826
     C                     MOVEL#1SARN    ZAMSDA                                            AR754826
     C                     MOVEL'CBUSRMSG'ZAMSGF                                            AR754826
     C                     EXSR ZASNMS                                                      AR754826
     C                     ENDIF                                                            AR754826
     C                     WRITE@SARDL0                91                 CSC010
      *                                                                                        10771
      * Call SCC0430 to replicate SFMENUPD to GZSFMENUPD and                                   10771
      *      SCSARDPD to GZSCSARDPD. Then, call APCCRTNDFL.                                    10771
      *                                                                                        10771
     C           *IN91     IFEQ *OFF                                                           10771
     C                     CALL 'SCC0430'                                                      10771
     C                     ENDIF                                                               10771
      *                                                                                        10771
     C                     DELETSCSARED0               91                 CSC010
     C                     ENDIF                                          CSC010
     C                     ELSE                                           CSC010
      *
      * the feature has already been successfully switched on using
      * password access, but now the user wants to disable it
      * Follow the same dependency checking as the delete action code,
      * but do not delete the password from the password file
      *
     C                     GOTO DCEXIT                                    CSC010
     C                     ENDIF                                          CSC010
     C                     ENDIF                                          CSC010
      * If delete request, bypass validation
     C           #1SEL     IFEQ 'D'
     C                     GOTO DCEXIT
     C                     END
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
     C           #1SARN    CABNE*BLANK    DDEXIT           Switchable Feat
     C           #1SARD    CABNE*BLANK    DDEXIT           Description
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * USER: Validate subfile record fields
      * Start of change S01486.
      * Insert prechecking
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      * Internal feature numbers may not be inserted by this function.
     C                     Z-ADD2         YRSW03
     C                     Z-ADD2         ZQ      50
     C           YRSW03    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW03    ORGT 00006
     C           ZQ        ORGT 00006
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW03    SUBST#1SARN:ZQ WUIFCF    P  90  Int Feature Che
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
      * Check for an internal feature number.
      * CASE: WRK.Int Feature Check Field is Internal feature list
     C           WUIFCF    IFEQ 'QQ'                       *IF
      * Setup message data for message
     C                     MOVEL#1SARN    ZA0001           Switchable Feat
      * Send message 'Internal feature not vald'
     C                     MOVEL'CBM0103' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * End of change S01486.
      * If Select field has a Switchable Feature value
      * CASE: RCD.*SFLSEL is Switchable Features Value
     C           #1SEL     IFEQ '2'                        *IF
     C           #1SEL     OREQ '6'
     C           #1SEL     OREQ '5'
     C           #1SEL     OREQ '3'
     C           #1SEL     OREQ 'D'
     C           #1SEL     OREQ 'P'
     C********** #1SEL     OREQ '4'                                                           CPK014
     C           #1SEL     OREQ '7'
     C           #1SEL     OREQ '8'
     C           #1SEL     OREQ '*'                                       CSC010
      * Print Switchable Feature - One
      * CASE: RCD.*SFLSEL is Print
     C           #1SEL     IFEQ 'P'                        *IF
      * Print  Switchable F - One - Switchable Features  *
     C                     CALL 'SC3011P'              90  Print  Switchab
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1SARN    WQ0001  6        Switchable Feat
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3011P' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9833  *
     C                     END
      * Setup message data for message
     C                     MOVEL#1SARN    ZA0002           Switchable Feat
      * Send message 'Switch F Rept - One'
     C                     MOVEL'CBM0036' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * Switchable Features by COB Components
      * CASE: RCD.*SFLSEL is COB Components
     C           #1SEL     IFEQ '2'                        *IF
      * Switchable F - COB Compnt - Switchable F - COB Compnt  *
     C                     CALL 'SC3020M'              90  Edit   Switchab
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1SARN    WQ0002  6        Switchable Feat
     C                     PARM #1SARD    WQ0003 50        Description
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3020M' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     983334*
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * Switchable Features by Report Name
      * CASE: RCD.*SFLSEL is Report Names
     C           #1SEL     IFEQ '3'                        *IF
      * Edit   Switchable F - Rep - Switchable F - Rep Name  *
     C                     CALL 'SC3030M'              90  Edit   Switchab
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1SARN    WQ0004  6        Switchable Feat
     C                     PARM #1SARD    WQ0005 50        Description
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3030M' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     983334*
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      **Switchable*Features*by*Journal*Files****************************************          CPK014
      **CASE:*RCD.*SFLSEL*is*Journal*Files******************************************          CPK014
     C********** #1SEL     IFEQ '4'                        *IF                                CPK014
      **Edit***Switchable*F*-*PF*-*Switchable*F*-*Objects*** ***********************          CPK014
     C**********           CALL 'SC3070M'              90  Edit   Switchab                    CPK014
     C**********           PARM *BLANK    W0RTN   7                                           CPK014
     C**********           PARM #1SARN    WQ0006  6        Switchable Feat                    CPK014
     C**********           PARM #1SARD    WQ0007 50        Description                        CPK014
      **********                                                                              CPK014
     C********** *IN90     IFEQ '1'                                                           CPK014
      **Call*to*program*ended*in*error**********************************************          CPK014
     C**********           MOVEL'Y2U0032' W0RTN                                               CPK014
     C**********           MOVEL*BLANKS   W0CLPG 10                                           CPK014
     C**********           MOVEL'SC3070M' W0CLPG                                              CPK014
      **Send*message*'*Error*occured*on*CALL...'************************************          CPK014
     C**********           MOVEL'Y2U0032' ZAMSID                                              CPK014
     C**********           MOVEL'Y2USRMSG'ZAMSGF                                              CPK014
     C**********           MOVELW0CLPG    ZAMSDA           Message data                       CPK014
     C**********           EXSR ZASNMS                                                        CPK014
     C**********           END                                                                CPK014
      **********                                                                              CPK014
      **Error*detected?*************************************************************          CPK014
     C********** W0RTN     IFNE *BLANK                                                        CPK014
     C**********           SETON                     983334*                                  CPK014
     C**********           END                                                                CPK014
      **CASE:*PGM.*Return*code*is**User*QUIT*requested******************************          CPK014
     C********** W0RTN     IFEQ 'Y2U9999'                  *IF                                CPK014
     C**********           MOVEL*BLANK    W0RTN            *Return code                       CPK014
     C**********           MOVELW0RTN     P0RTN            *Return code                       CPK014
     C**********           EXSR ZYEXPG                                                        CPK014
     C**********           END                             *FI                                CPK014
     C**********           MOVEL'Y'       W0RSF            *Reload subfile                    CPK014
     C**********           END                             *FI                                CPK014
      * Switchable Features by Report Components
      * CASE: RCD.*SFLSEL is Report Components
     C           #1SEL     IFEQ '5'                        *IF
      * Switchable F - Rep Compnt - Switchable F - Rep Compnt  *
     C                     CALL 'SC3050M'              90  Edit   Switchab
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1SARN    WQ0008  6        Switchable Feat
     C                     PARM #1SARD    WQ0009 50        Description
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3050M' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     983334*
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * Switchable Features by Menu Items
      * CASE: RCD.*SFLSEL is Menu Items
     C           #1SEL     IFEQ '6'                        *IF
      * Edit   Switchable F - Men - Switchable F - Menu Items  *
     C                     CALL 'SC3060M'              90  Edit   Switchab
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1SARN    WQ0010  6        Switchable Feat
     C                     PARM #1SARD    WQ0011 50        Description
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3060M' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     983334*
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * Switchable Features by Report Print Files
      * CASE: RCD.*SFLSEL is Report Print Files
     C           #1SEL     IFEQ '7'                        *IF
      * Edit   Switchable F -PRTF - Switchable F - Objects  *
     C                     CALL 'SC3080M'              90  Edit   Switchab
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1SARN    WQ0012  6        Switchable Feat
     C                     PARM #1SARD    WQ0013 50        Description
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3080M' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     983334*
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * //Start of S01430 - Include Initialisation Programs
      * Switchable Features by Initialisation Programs
      * CASE: RCD.*SFLSEL is Initialisation Programs
     C           #1SEL     IFEQ '8'                        *IF
      * Edit   Switchable F - Ini - Switchable F - Init Pgm  *
     C                     CALL 'SC3090M'              90  Edit   Switchab
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1SARN    WQ0014  6        Switchable Feat
     C                     PARM #1SARD    WQ0015 50        Description
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3090M' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     983334*
     C                     END
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
      * //End of S01430 - Include Initialisation Programs
     C                     END                             *FI
      * Validate subfile record relations
     C                     EXSR DFV2RC
      * Switchable Feature Number required
     C           #1SARN    IFEQ *BLANK                     IF
     C                     SETON                     9833  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * USER: Validate subfile record relations
      * Validate Switchable Feature Description
      * CASE: RCD.Description is Blank
     C           #1SARD    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1SARD    ZA0003           Description
      * Send message 'SwitchF Descr not entered'
     C                     MOVEL'CBM0043' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     END                             *FI
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0RSF
     C                     ELSE
     C                     MOVEL'N'       W0RSF
     C                     END
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C                     MOVEL*BLANK    #1SEL
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,32
     C                     SETOF                     98
      *
     C           W0PMD     IFEQ 'ADD'
      * Process add request
     C           #1SEL     IFNE 'D'
     C           #1SEL     OREQ '*'                                       CSC010
     C           *IN54     ANDEQ*ON                                       CSC010
     C                     EXSR DDNLRC
     C           W0NLR     IFNE 'Y'
     C                     EXSR ECADRQ
     C                     END
     C                     END
     C                     ELSE
     C           #1SEL     IFEQ 'D'
     C           #1SEL     OREQ '*'                                       CSC010
     C           *IN54     ANDEQ*ON                                       CSC010
      * Process delete request
     C                     EXSR EDDLRQ
     C**********           ELSE
      * Process change request
     C**********           EXSR EECHRQ
     C                     END
     C                     END
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     ELSE
      * USER: Extra processing after DBF update
      * //Start of S01430 - Include Initialisation Programs
      * If inserting feature, check if initialisation programs
      * exist for feature. If so, call the maintenance program for
      * the initialisation programs so that the user is prompted to
      * call those programs
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      * Rtv init pgm - Switchable F - Init Pgm  *
     C                     EXSR SARVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Edit   Switchable F - Ini - Switchable F - Init Pgm  *
     C                     CALL 'SC3090M'              90  Edit   Switchab
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1SARN    WQ0016  6        Switchable Feat
     C                     PARM #1SARD    WQ0017 50        Description
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3090M' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     983334*
     C                     END
      * If CF3 was pressed, do not exit but return to subfile program
      * CASE: PGM.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     END                             *FI
      * Call auto-journal program                                         139358
     C                     CALL 'SCC3095'                                 139358
     C                     PARM           #1SARN                          139358
     C                     END                             *FI
      * //End of S01430 - Include Initialisation Programs
      * Start of change S01488.
      * Validate delete return code.
      * CASE: WRK.*Return code is Refuse
     C           WURTN     IFEQ 'REFUSE'                   *IF
      * Re-initialise fields - Switchable Features  *
     C                     MOVELWWSARN    #1SARN           Switchable Feat
     C                     MOVELWWSARD    #1SARD           Description
     C                     Z-ADDWWLCD     #1LCD            Last change dat
     C                     MOVELWWTYLC    #1TYLC           Type of the Las
     C                     END                             *FI
      * End of change S01488.
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * Create Switchable Feature - Switchable Features  *
     C                     EXSR SBCRRC
     C           W0RTN     IFNE *BLANK
      * Write error detected
      * Screen errors
     C                     MOVEAWKIND1    *IN,32
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
     C                     ELSE
      * DBF write successful
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request
      *================================================================
      * USER: Delete DBF record
      * Call initpgm, del feature - Switchable Features  *
     C                     EXSR SCDLRC
     C           W0RTN     IFNE *BLANK
      * Delete unsuccessful
      * Screen errors
     C                     MOVEAWKIND1    *IN,32
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * If record altered, reset subfile record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF delete successful
      * Blank out record and protect from entry
     C                     EXSR MAIZ#1
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
      * Reload subfile
     C                     MOVEL'Y'       W0RSF   1
     C                     END
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Change Switchable Feature - Switchable Features  *
     C                     EXSR SECHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,32
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C***********W0PMD     IFNE 'ADD'                                     CSC007
     C*********************MOVEL'ADD'     W0PMD                           CSC007
     C                     MOVEL*BLANKS   W0RTN                           CSC007
     C                     MOVEL*BLANKS   #1SARD                          CSC007
     C                     MOVEL*BLANKS   #1SARN                          CSC007
     C           CORFLG    IFEQ 'C'                                       CSC008
     C                     MOVEL'C'       W0RTN                           CSC007
     C                     CALL 'SC0430S'                                 CSC007
     C                     PARM           W0RTN                           CSC007
     C                     PARM           #1SARD                          CSC007
     C                     PARM           #1SARN                          CSC007
      *                                                                                     AR754826
     C           W0RTN     IFEQ *BLANKS                                                     AR754826
      *                                                                                     AR754826
      ** Check the global SF status                                                         AR754826
      *                                                                                     AR754826
     C                     EXSR CHKGFS                                                      AR754826
      ** If corresponding global feature is OFF, tell user to switched ON                   AR754826
     C           'off'     IFEQ ZA0012                                                      AR754826
     C                     MOVEL'on '     ZA0012                                            AR754826
     C                     MOVE 'CBM0252' ZAMSID                                            AR754826
     C                     MOVEL#1SARN    ZAMSDA                                            AR754826
     C                     EXSR ZASNMS                                                      AR754826
     C                     ENDIF                                                            AR754826
      *                                                                                     AR754826
     C                     ENDIF                                                            AR754826
      *                                                                                     AR754826
     C                     ENDIF                                          CSC008
     C*
     C           CORFLG    IFEQ 'B'                                       CSC008
     C                     MOVEL'PASSWD'  PASSWD  6                       CSC008
     C******     PASSWD    CHAINSCSARDL1             78           CSC010  CSC008
     C           PASSWD    CHAINSCSAREL1             78           CSC010  CSC008
     C           *IN78     IFEQ *OFF                                      CSC008
     C                     MOVEL'B'       W0RTN                           CSC007
     C                     CALL 'SC0430S'                                 CSC008
     C                     PARM           W0RTN                           CSC008
     C                     PARM           #1SARD                          CSC008
     C                     PARM           #1SARN                          CSC008
      *                                                                                     AR754826
     C           W0RTN     IFEQ *BLANKS                                                     AR754826
      *                                                                                     AR754826
      ** Check the global SF status                                                         AR754826
      *                                                                                     AR754826
     C                     EXSR CHKGFS                                                      AR754826
      ** If corresponding global feature is OFF, tell user to switched ON                   AR754826
     C           'off'     IFEQ ZA0012                                                      AR754826
     C                     MOVEL'on '     ZA0012                                            AR754826
     C                     MOVE 'CBM0252' ZAMSID                                            AR754826
     C                     MOVEL#1SARN    ZAMSDA                                            AR754826
     C                     EXSR ZASNMS                                                      AR754826
     C                     ENDIF                                                            AR754826
      *                                                                                     AR754826
     C                     ENDIF                                                            AR754826
      *                                                                                     AR754826
     C                     ELSE                                           CSC008
     C                     CALL 'SC0435'                                  CSC008
     C                     PARM           W0RTN                           CSC008
     C                     ENDIF                                          CSC008
     C                     ENDIF                                          CSC008
     C*********************ELSE                                           CSC007
     C*********************END                                            CSC007
     C                     MOVE 'CHG'     W0PMD
     C           W0RTN     IFEQ *BLANKS                                   CSC007
     C                     MOVE *BLANKS   WUAIDF                          CSC007
     C           #1SARN    IFNE *BLANKS                                   CSC007
     C                     MOVE 'ADD'     W0PMD
     C                     EXSR EBPRSR
     C                     MOVE 'CHG'     W0PMD
     C                     ENDIF
      *
      *create switchable feature and refresh screen                       CSC007
      *                                                                   CSC007
     C*********************EXSR SBCRRC                                    CSC007
     C                     EXSR FBRQRL
     C                     ENDIF                                          CSC007
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN79
     C           W0PMD     IFEQ 'ADD'                      *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     C           INACHK    BEGSR                                          CSC010
     C                     EXSR PASCHK                                    CSC010
     C                     CALL 'SC0432'                                  CSC010
     C                     PARM 'Check  ' @RETRN  7                       CSC010
     C                     PARM           PASSON  1                       CSC010
     C           @RETRN    IFEQ 'Errors '                                 CSC010
     C                     MOVEL'CBM0244' ZAMSID                          CSC010
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC010
     C                     EXSR ZASNMS                                    CSC010
     C                     ENDIF                                          CSC010
     C                     ENDSR                                          CSC010
     C*
     C           INACTF    BEGSR                                          CSC010
     C                     EXSR PASCHK                                    CSC010
     C                     CALL 'SC0432'                                  CSC010
     C                     PARM 'Check'   @RETRN  7                       CSC010
     C                     PARM           PASSON  1                       CSC010
     C           @RETRN    IFEQ 'Errors '                                 CSC010
     C                     EXSR WINACT                                    CSC010
     C                     ELSE                                           CSC010
     C                     MOVEL'CBM0243' ZAMSID                          CSC010
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC010
     C                     MOVE *ON       *IN66                           CSC010
     C                     EXSR ZASNMS                                    CSC010
     C                     ENDIF                                          CSC010
     C                     MOVE *BLANKS   @RETRN                          CSC010
     C                     ENDSR                                          CSC010
     C*
     C           PASCHK    BEGSR                                          CSC010
     C                     MOVEL'PASSWD'  @SARD   6                       CSC010
     C                     CALL 'AOSARDR0'PPARM                           CSC010
     C           @RTCD     IFEQ *BLANKS                                   CSC010
     C                     MOVEL'Y'       PASSON  1                       CSC010
     C                     ELSE                                           CSC010
     C                     MOVEL'N'       PASSON  1                       CSC010
     C                     ENDIF                                          CSC010
     C                     ENDSR                                          CSC010
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     MOVEL*BLANK    #RSSAR           Select Feature
     C                     Z-ADD*ZERO     #1LCD            Last change dat
     C                     MOVEL*BLANK    #1TYLC           Type of the Las
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #1SARN           Switchable Feat
     C                     MOVEL*BLANK    #1SARD           Description
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @SARDL1 fields to subfile
      *================================================================
     C           ABSARN    CHAINSCSARED0             54                   CSC010
     C           *IN54     IFEQ *OFF                                      CSC010
     C                     MOVE *ON       *IN54                           CSC010
     C                     ELSE                                           CSC010
     C                     MOVE *OFF      *IN54                           CSC010
     C                     ENDIF                                          CSC010
     C                     Z-ADDABLCD     #1LCD            Last change dat
     C                     MOVELABTYLC    #1TYLC           Type of the Las
     C                     MOVELABSARN    #1SARN           Switchable Feat
     C                     MOVELABSARD    #1SARD           Description
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVEL*BLANK    #2SARN           Switchable Feat
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv init pgm - Switchable F - Init Pgm  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN AKSARN    WQSA01           Switchable Feat
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           WQSA01           Switchable Feat
      * Move fields to key list
     C                     MOVEL#1SARN    WQSA01           Switchable Feat
     C           KRSSA     SETLL@SARPL1                    *
     C           KRSSA     READE@SARPL1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'CBM0056' W0RTN   7
      * USER: Processing if Data record not found
      * If no initialisation programs found for the switchable feature
      * then the program return code is 'record not found *NRF'
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'*NRF'    W0RTN            *Return code
     C                     GOTO SAEXIT                     *QUIT
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * If at least one initialisation program exists for the switchable
      * feature, the program return code is normal
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO SAEXIT                     *QUIT
     C           KRSSA     READE@SARPL1                  90*
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * Create Switchable Feature - Switchable Features  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @SARDL0
     C                     MOVEL#1SARN    ABSARN           Switchable Feat
     C                     MOVEL#1SARD    ABSARD           Description
     C                     Z-ADDWUAKTX    ABLCD            Last change dat
     C                     MOVEL'I'       ABTYLC           Type of the Las
      *
      * USER: Processing before Data update
      * Start of change S01486.
      * Internal feature numbers may not be inserted by this function.
     C                     Z-ADD2         YRSW03
     C                     Z-ADD2         ZQ      50
     C           YRSW03    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW03    ORGT 00006
     C           ZQ        ORGT 00006
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW03    SUBST#1SARN:ZQ WUIFCF    P  90  Int Feature Che
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
      * Check for an internal feature number.
      * CASE: WRK.Int Feature Check Field is Internal feature list
     C******     WUIFCF    IFEQ 'QQ'                       *IF
     C******               MOVEL*BLANK    W0RTN            *Return code
     C******               ELSE
      * CASE: *OTHERWISE
     C******               MOVEL*BLANK    W0RTN            *Return code
     C******               MOVEL'REFUSE'  W0RTN            *Return code
     C******               END                             *FI
      * End of change S01486.
      * Start of change S01488.
      * Save screen fields - Switchable Features  *
     C                     MOVEL#1SARN    WWSARN  6        Switchable Feat
     C                     MOVEL#1SARD    WWSARD 50        Description
     C                     Z-ADD#1LCD     WWLCD   50       Last change dat
     C                     MOVEL#1TYLC    WWTYLC  1        Type of the Las
      * Switchable Feature Prechk - Switchable Features  *
     C******               CALL 'SC3010X'              90  Switchable FeatCSC007
     C******               PARM *BLANK    W0RTN   7                       CSC007
     C******               PARM 'I'       WQ0018  1        Action Code    CSC007
     C******               PARM #1SARN    WQ0019  6        Switchable FeatCSC007
     C******     WUAIDF    PARM *BLANK    WQ0020  1        Allow INS/DEL oCSC007
      ******
     C******     *IN90     IFEQ '1'                                       CSC007
      **Call to program ended in error
     C******               MOVEL'Y2U0032' W0RTN                           CSC007
     C******               MOVEL*BLANKS   W0CLPG 10
     C******               MOVEL'SC3010X' W0CLPG
      **Send message '*Error occured on CALL...'
     C******               MOVEL'Y2U0032' ZAMSID
     C******               MOVEL'Y2USRMSG'ZAMSGF
     C******               MOVELW0CLPG    ZAMSDA           Message data   CSC007
     C******               EXSR ZASNMS                                    CSC007
     C******               END                                            CSC007
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9833  *
     C                     END
      * Check pre-checks return code.
      * CASE: WRK.Allow INS/DEL of Feature is Refuse insert/delete
     C           WUAIDF    IFEQ 'N'                        *IF
      * Seton W0RTN for preckecks - Switchable Features  *
     C                     MOVEL*BLANKS   W0RTN
     C                     MOVEL'REFUSE'  W0RTN
     C                     MOVEL*BLANK    WURTN            *Return code
     C                     MOVEL'REFUSE'  WURTN            *Return code
      * Setup message data for message
     C                     MOVEL#1SARN    ZA0004           Switchable Feat
      * Send message 'S/Feature cannot be added'
     C                     MOVEL'CBM0100' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     GOTO SBEXIT                     *QUIT
     C                     END                             *FI
      * End of change S01488.
     C           KLCRSB    KLIST
     C                     KFLD           ABSARN           Switchable Feat
      * Check for duplicate primary key
     C******     KLCRSB    SETLL@SARDL0                  90*    CSC010
     C           KLCRSB    SETLLSCSAREL0                 90*    CSC010
     C           *IN90     IFEQ '1'
     C                     MOVEL'CBM0005' W0RTN   7
      * Send message 'Switchable Features    EX'
     C                     MOVEL'CBM0005' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     END
      *
     C                     WRITE@SARDL0                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Call SCC0430 to replicate SFMENUPD to GZSFMENUPD and                                  CUP007
      *      SCSARDPD to GZSCSARDPD. Then, call APCCRTNDFL.                                   CUP007
     C                     CALL 'SCC0430'                                                     CUP007
      *
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCDLRC    BEGSR
      *================================================================
      * Call initpgm, del feature - Switchable Features  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data update
      * Start of change S01488.
      * Save screen fields - Switchable Features  *
     C                     MOVEL#1SARN    WWSARN  6        Switchable Feat
     C                     MOVEL#1SARD    WWSARD 50        Description
     C                     Z-ADD#1LCD     WWLCD   50       Last change dat
     C                     MOVEL#1TYLC    WWTYLC  1        Type of the Las
      * Switchable Feature Prechk - Switchable Features  *
     C           #1SEL     IFEQ 'D'                                       CSC010
     C                     CALL 'SC3010X'              90  Switchable Feat
     C                     PARM *BLANK    W0RTN   7
     C                     PARM 'D'       WQ0021  1        Action Code
     C                     PARM #1SARN    WQ0022  6        Switchable Feat
     C           WUAIDF    PARM *BLANK    WQ0023  1        Allow INS/DEL o
     C                     ENDIF                                          CSC010
     C           #1SEL     IFEQ '*'                                       CSC010
     C           *IN54     ANDEQ*ON                                       CSC010
     C                     CALL 'SC3010X'              90                 CSC010
     C                     PARM *BLANK    W0RTN   7                       CSC010
     C                     PARM '-'       WQ0021  1                       CSC010
     C                     PARM #1SARN    WQ0022  6                       CSC010
     C           WUAIDF    PARM *BLANK    WQ0023  1                       CSC010
     C                     ENDIF                                          CSC010
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SC3010X' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9833  *
     C                     END
      * Check pre-checks return code.
      * CASE: WRK.Allow INS/DEL of Feature is Refuse insert/delete
     C           WUAIDF    IFEQ 'N'                        *IF
     C                     MOVEL*BLANK    WURTN            *Return code
     C                     MOVEL'REFUSE'  WURTN            *Return code
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'REFUSE'  W0RTN            *Return code
      * Setup message data for message
     C                     MOVEL#1SARN    ZA0005           Switchable Feat
      * Send message 'S/Feature cannot be delet'
     C*********************MOVEL'CBM0101' ZAMSID                          CSC007
     C                     MOVEL'CBM0234' ZAMSID                          CSC007
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC010
     C                     MOVEL#1SARN    ZAMSDA                          CSC010
     C           WQ0021    IFEQ '-'                                       CSC010
     C                     MOVE *OFF      *IN54                           CSC010
     C                     ENDIF                                          CSC010
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
      * End of change S01488.
      * Start of change S01486.
      * Internal feature numbers may not be deleted by this function.
     C                     Z-ADD2         YRSW03
     C                     Z-ADD2         ZQ      50
     C           YRSW03    IFLT 1
     C           ZQ        ORLT 1
     C           YRSW03    ORGT 00006
     C           ZQ        ORGT 00006
     C                     MOVEL'Y2U0510' W0RTN
     C                     ELSE
     C           YRSW03    SUBST#1SARN:ZQ WUIFCF    P  90  Int Feature Che
     C   90                MOVEL'Y2U0510' W0RTN
     C                     END
      * Check for an internal feature number.
      * CASE: WRK.Int Feature Check Field is Internal feature list
     C           WUIFCF    IFEQ 'QQ'                       *IF
      * Setup message data for message
     C                     MOVEL#1SARN    ZA0006           Switchable Feat
      * Send message 'Internal feature not vald'
     C                     MOVEL'CBM0103' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'REFUSE'  W0RTN            *Return code
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
      * End of change S01486.
      * //Start of S01430 - Include Initialisation Programs
      * Call Initialisation programs in delete mode before trying
      * to delete the Switchable Feature
      * Rtv and call init pgm - Switchable F - Init Pgm  *
     C                     EXSR SDRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1SARN    ZA0011           Switchable Feat
      * Send message 'Init pgm call error once'
     C                     MOVEL'CBM0065' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
      * //End of S01430 - Include Initialisation Programs
      * Move key fields to @SARDL0
     C                     MOVEL#1SARN    ABSARN           Switchable Feat
      *
     C           KLDLSC    KLIST
     C                     KFLD           ABSARN           Switchable Feat
     C******     KLDLSC    CHAIN@SARDL0              9091                 CSC010
     C           KLDLSC    CHAINSCSAREL0             9091                 CSC010
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C*******    KLDLSC    SETLL@SARDL0              9091  *              CSC010
     C           KLDLSC    SETLLSCSAREL0             9091                 CSC010
     C                     GOTO SCEXIT
     C                     END                             FI #1DBRC
      *................................................................
     C*
     C* disable the feature
     C*
     C           #1SEL     IFEQ '*'                                       CSC010
     C           *IN54     ANDEQ*ON                                       CSC010
     C                     WRITESCSARED0               91                 CSC010
     C                     DELET@SARDL0                91  *
     C                     ENDIF                                          CSC010
     C*
     C           #1SEL     IFEQ 'D'                                       CSC010
     C           #1SARN    CHAINSCSARED0             55                   CSC010
     C           *IN55     IFEQ *OFF                                      CSC010
     C                     DELETSCSARED0               91                 CSC010
     C                     ELSE                                           CSC010
     C           #1SARN    DELET@SARDL0              5591                 CSC010
     C                     ENDIF                                          CSC010
     C                     ENDIF                                          CSC010
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE                                           CSC007
     C                     MOVEL'CBM0233' ZAMSID                          CSC007
     C                     MOVEL#1SARN    ZAMSDA                          CSC010
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC007
     C                     EXSR ZASNMS                                               CSC007 AR754826
     C           #1SEL     IFEQ '*'                                       CSC010
     C           WQ0021    ANDEQ'-'                                       CSC010
     C                     MOVEL'CBM0238' ZAMSID                          CSC010
     C                     MOVEL#1SARN    ZAMSDA                          CSC010
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC010
     C                     EXSR ZASNMS                                               CSC007 AR754826
      *                                                                                     AR754826
      ** Check the global SF status                                                         AR754826
      *                                                                                     AR754826
     C                     EXSR CHKGFS                                                      AR754826
      ** If corresponding global feature is ON, tell user to switched OFF                   AR754826
     C           'on'      IFEQ ZA0012                                                      AR754826
     C                     MOVEL'off'     ZA0012                                            AR754826
     C                     MOVEL'CBM0252' ZAMSID                                            AR754826
     C                     MOVEL#1SARN    ZAMSDA                                            AR754826
     C                     MOVEL'CBUSRMSG'ZAMSGF                                            AR754826
     C                     EXSR ZASNMS                                                      AR754826
     C                     ENDIF                                                            AR754826
     C                     END                                            CSC010
     C**********           EXSR ZASNMS                                               CSC007 AR754826
      *                                                                                        10771
      * Call SCC0430 to replicate SFMENUPD to GZSFMENUPD and                                   10771
      *      SCSARDPD to GZSCSARDPD. Then, call APCCRTNDFL.                                    10771
      *                                                                                        10771
     C                     CALL 'SCC0430'                                                      10771
      *                                                                                        10771
     C                     END
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Rtv and call init pgm - Switchable F - Init Pgm  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN AKSARN    WQSD01           Switchable Feat
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Switchable Feat
      * Move fields to key list
     C                     MOVEL#1SARN    WQSD01           Switchable Feat
     C           KRSSD     SETLL@SARPL1                    *
     C           KRSSD     READE@SARPL1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'CBM0056' W0RTN   7
      * USER: Processing if Data record not found
      * If no initialisation programs exist for the switchable feature
      * then ensure the program return code is normal, and quit
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO SDEXIT                     *QUIT
     C                     GOTO SDEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Call Initialisation program when deleting a switchable feature;
      * the mode of the Initialisation program is Delete mode
     C                     MOVELAKPNAM    WUPNAM           Program Name
     C                     MOVEL*BLANK    WURTCD           Access Obj Retu
     C                     MOVEL'3'       WUPMOD           Initialisation
      * Call Initialisation Pgm - Standard functions  *
     C                     CALL 'SCC3090'              90  Call Initialisa
     C                     PARM WUPNAM    WQ0024 10        Program Name
     C           WURTCD    PARM WURTCD    WQ0025  7        Access Obj Retu
     C                     PARM WUPMOD    WQ0026  1        Initialisation
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SCC3090' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * CASE: WRK.Access Obj Return Code is Normal - no errors found
     C           WURTCD    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVELAKPNAM    ZA0007           Program Name
     C                     MOVEL#1SARN    ZA0008           Switchable Feat
      * Send message 'Init pgm call successful'
     C                     MOVEL'CBM0063' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVELAKPNAM    ZA0009           Program Name
     C                     MOVEL#1SARN    ZA0010           Switchable Feat
      * Send message 'Init pgm call error'
     C                     MOVEL'CBM0061' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'*ERROR'  W0RTN            *Return code
     C                     END                             *FI
     C           KRSSD     READE@SARPL1                  90*
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Change Switchable Feature - Switchable Features  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @SARDL0
     C                     MOVEL#1SARN    ABSARN           Switchable Feat
      *
     C           KLCHSE    KLIST
     C                     KFLD           ABSARN           Switchable Feat
     C******     KLCHSE    CHAIN@SARDL0              9091                 CSC010
     C           KLCHSE    CHAINSCSAREL0             9091                 CSC010
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SEEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C******     KLCHSE    SETLL@SARDL0              9091  *              CSC010
     C           KLCHSE    SETLLSCSAREL0             9091  *              CSC010
     C                     GOTO SEEXIT
     C                     END                             FI #1DBRC
      * Move non-key fields to @SARDL0
     C                     MOVEL#1SARD    ABSARD           Description
     C                     Z-ADDWUAKTX    ABLCD            Last change dat
     C                     MOVEL'A'       ABTYLC           Type of the Las
      *
     C                     UPDAT@SARDL0                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
     C                     END
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     C           WINACT    BEGSR                                          CSC010
     C                     CALL 'SC0431W0'                                CSC010
     C                     PARM *BLANKS   @RETRN  7                       CSC010
     C                     PARM *BLANKS   SWFSEL  6                       CSC010
     C                     PARM           PASSON  1                       CSC010
     C*                                                                   CSC010
     C* All features are active if @RETRN = ALLACT                        CSC010
     C*                                                                   CSC010
     C           @RETRN    IFEQ 'ALLACT'                                  CSC010
     C                     MOVE 'CBM0243' ZAMSID                          CSC010
     C                     MOVEL'CBUSRMSG'ZAMSGF                          CSC010
     C                     EXSR ZASNMS                                    CSC010
     C                     ENDIF                                          CSC010
     C                     ENDSR                                          CSC010
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C******               MOVEL'CBUSRMSG'ZAMSGF                          CSC010 CSC007
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     EXSR PASCHK                                    CSC010
     C                     CALL 'SC0432'                                  CSC010
     C                     PARM           @RETRN  7                       CSC010
     C                     PARM           PASSON  1                       CSC010
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
      *                                                                   CSC010
      * Set up Parameter List for calling AOSARDR0                        CSC010
      *                                                                   CSC010
     C           PPARM     PLIST                                          CSC010
     C                     PARM *BLANKS   @RTCD   7                       CSC010
     C                     PARM '*VERIFY' @OPTN   7                       CSC010
     C                     PARM           @SARD   6                       CSC010
     C           SCSARD    PARM SCSARD    DSFDY                           CSC010
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN CBMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Int Feature Check Field
     C                     MOVEL*BLANK    WUIFCF  2
      * Define work field *Return code
     C                     MOVEL*BLANK    WURTN   7
      * Define work field run day number
     C                     Z-ADD*ZERO     WUAKTX  50
      * Define work field Allow INS/DEL of Feature
     C                     MOVEL*BLANK    WUAIDF  1
      * Define work field Program Name
     C                     MOVEL*BLANK    WUPNAM 10
      * Define work field Access Obj Return Code
     C                     MOVEL*BLANK    WURTCD  7
      * Define work field Initialisation Pgm mode
     C                     MOVEL*BLANK    WUPMOD  1
      * Define work field midas rundate
     C                     MOVEL*BLANK    WUAANA  7
      * Define work field Set Up Complete
     C                     MOVEL*BLANK    WUAUST  1
      * Define work field date format flag
     C                     MOVEL*BLANK    WUE3ST  1
      * Define work field Multi-branching Indicator
     C                     MOVEL*BLANK    WUF1ST  1
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW02  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW03  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW04  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW05  50       *Synon (5,0) wo
     C                     MOVEL*BLANKS   YRSW06  1        *String work fi
     C                     MOVEL*BLANKS   YRSW07  1        *String work fi
     C                     MOVEL*BLANKS   YRSW08  7        *Return code
     C                     MOVEL*BLANKS   YRSW09  1        *String work fi
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0A           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0B           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0C           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0D           *Synon (9999) w
     C                     MOVEL*BLANKS   YRSW0E  1        *String work fi
     C                     MOVEL*BLANKS   YRSW0F  1        *String work fi
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
      * Open files
     C                     OPEN SC3010M#
     C******               OPEN SCSARDL1                                  CSC010
     C                     OPEN SCSAREL1                                  CSC010
     C                     OPEN SCSARPL1
     C******               OPEN SCSARDL0                                  CSC010
     C                     OPEN SCSAREL0                                  CSC010
     C                     MOVEL'N'       W0PMT   1
      *
     C                     Z-ADD12        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD500       W0SLM   50
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL'Y'       W0APM   1
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Start of change S01459.
      * SC3010M Precompiler - Switchable Features  *
      * Remove Last Amend Box and Creation Parameters functions.
      * End of change S01459.
      * Copyright Statement 1993 - Standard functions  *
      * Get Rundate - Rundate  *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##AANA  7
     C                     MOVE MRDT      WUAANA
     C                     MOVE RDNB      WUAKTX
     C                     MOVE SUC       WUAUST
     C                     MOVE DFF       WUE3ST
     C                     MOVE MBIN      WUF1ST
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT
     CSR         *PSSR     BEGSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
      *
      * Core function specific processing.
      *
     C/COPY WNCPYSRC,SC3010MPSC
      *
      * Start of PSSR user point.
      *
     C/COPY WNCPYSRC,SC3010MPS1
      *
      * Standard Midas PSSR processing.
      *
     C/COPY CBCPYSRC,CBPSSRINS
      *
      * End of PSSR user point.
      *
     C/COPY WNCPYSRC,SC3010MPS2
      *
      *================================================================
     CSR                   ENDSR
      *================================================================
      /EJECT                                                                                AR754826
     CSR         CHKGFS    BEGSR                                                            AR754826
      *================================================================                     AR754826
      * Check corresponding global feature and status                                       AR754826
      *================================================================                     AR754826
     C                     CALL 'GP270000'                                                  AR754826
     C                     PARM *BLANKS   PRTCD   7                                         AR754826
     C                     PARM #1SARN    PSARD   6                                         AR754826
      *                                                                                     AR754826
     C           *BLANKS   IFEQ PRTCD                                                       AR754826
      *                                                                                     AR754826
     C                     CALL GPAOSA                                                      AR754826
     C                     PARM *BLANKS   PRTCD                                             AR754826
     C                     PARM '*VERIFY' POPTN   7                                         AR754826
     C                     PARM #1SARN    PSARD                                             AR754826
      *                                                                                     AR754826
     C           PRTCD     IFEQ *BLANKS                                                     AR754826
     C                     MOVEL'on'      ZA0012                                            AR754826
     C                     ELSE                                                             AR754826
     C                     MOVEL'off'     ZA0012                                            AR754826
     C                     ENDIF                                                            AR754826
      *                                                                                     AR754826
     C                     ENDIF                                                            AR754826
      *                                                                                     AR754826
     CSR                   ENDSR                                                            AR754826
      *================================================================                     AR754826
**
2=COB Components  3=Report Names  5=Report Components
6=Menu Items  7=Report Print Files  8=Initialisation Programs
** CPY@     : Copyright notice for inclusion in all programs
(c) Misys International Banking Systems Ltd. 2001
