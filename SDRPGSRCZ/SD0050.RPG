0001 H
      *****************************************************************
/*OVR *  OVRDBF FILE(GZSDBANK) TOFILE(GZSDBANKL2)                     *                       CSD031
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SD Update of account keys')                      *
/*OVRF*: OVRDBF TABLE TABSDU                                        : *
      *****************************************************************
      *                                                               *
      *  Midas  Standing Data Module                                  *
      *                                                               *
      *     SD0050 - ACCOUNT KEYS FILE MAINTENANCE                    *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD042920           Date 06Dec16               *
      *  Prev Amend No. CFT156             Date 15Aug14               *
      *                 AR900498           Date 02Feb12               *
      *                 CER049             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      *                 CSC043             Date 18Jun10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CGL047             Date 30Jun06               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 249490             Date 31Jul07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 237300             Date 04Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 220371             Date 31Oct03               *
      *                 BUG12492           Date 10Nov06               *
      *                 BUG11835           Date 08Aug06               *
      *                 BUG11780           Date 27Jul06               *
      *                 BUG11762           Date 25Jul06               *
      *                 BUG11712           Date 19Jul06               *
      *                 BUG11700           Date 17Jul06               *
      *                 233194             Date 06Jun06               *
      *                 BUG11450           Date 14Jun06               *
      *                 CSD031             Date 20Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CGL014             Date 20Oct03               *
      *                 CAAA03             Date 14Apr04               *
      *                 TDA090             Date 27Mar04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 188106             Date 10Jan01               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 135145             Date 03Jun98               *
      *                 146015             Date 09Nov98               *
      *                 S01408             DATE 26Jan98               *
      *                 S01408             DATE 24MAY96               *
     F*                    085179             DATE 13APR95               *
0009 F*                    082749             DATE 11APR95               *
0009 F*                    047369             DATE 10JAN94               *
0009 F*                    054223             DATE 08JUN93               *
0009 F*                    E21769             DATE 25SEP90               *
0009 F*                    S01199             DATE 25SEP90               *
0009 F*                    E11609             DATE 21/09/87              *
0009 F*                    E10863             DATE 28/05/87              *
0010 F*                                                                  *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD042920 - GLC000620 00002 failed during COB (Recompile)     *
      *  CFT156 - Enhancement to the posting narrative on FT          *
      *           transactions                                        *
      *  AR900498 - Account Keys Maintenance have extra fields with   *
      *             no labels (Recompile)                             *
      *  CER049 - Stamp Tax                                           *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CSC043 - MidasPlus IASP Enablement                           *
      *  CGL047 - Midas Generic Posting Interface                        *
      *  249490 - Posting references4 and 5 should be allowed with    *
      *           Syndications Manager.                               *
      *  237300 - Suppress limitation 01 to 50 for the narrative code *
      *           as it is in the A/C keys generator.                 *
      *  220371 - DBASE Error 15 on DL0295, file ACKEY.               *
      *           New value of Accrual Summary Indicator is not       *
      *           retrieved after call to AOGELRR1.                   *
      *  BUG12492 - SCC0411 00001 Failed                              *
      *  BUG11835 - Review From field defaults to a certain value     *
      *  BUG11780 - Central Data and Eff. Date is blank (Recompile)   *
      *  BUG11762 - Data was not dumped to the acceptance file        *
      *  BUG11712 - White fields in the entry list view (Recompile)   *
      *  BUG11700 - Account Code changes upon pressing Enter button   *
      *  233194 - During insert, posting reference 3 is not checked   *
      *           against the value of the Accrual Key Summary        *
      *           Indicator.                                          *
      *  BUG11450 - Delete F10 command key on display for action I,A,E*
      *             and on initial screen                             *
      *  CSD031 - Enhanced Centralized Static Data                    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type                              *
      *  CGL014 - Collaterals Processing                              *
      *  CAAA03 - Webfacing Changes (recompile)                       *
      *  TDA090 - Error in acccount code doesn't show                 *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  188106 - Posting ref. in ACKEYAL file is updated incorrectly.   *
     F*  135145  -  Allow Posting Reference 4 for Lending keys
      *  146015 - Posting Reference '5' required Parts Purch and      *
      *           Parts Sold                                          *
     F*  S01408  -  Duplicate Hook SD0050C001 renamed SD0050CPP1
     F*             Duplicate Hook SD0050C002 renamed SD0050CPP2
     F*             Duplicate Hook SD0050C003 renamed SD0050CPP3
     F*             Duplicate Hook SD0050C004 renamed SD0050CPP4
     F*             Duplicate Hook SD0050C005 renamed SD0050CPP5
     F*             Duplicate Hook SD0050F001 renamed SD0050CPP6
     F*  S01408  -  Core hook SD0050CCP1 added.
     F*             Core hook SD0050IIP1 added.
     F*  085179  -  Program dumped if another user was in Account Key    *
     F*             Generators function (program AKC10) because that     *
     F*             program puts exclusive locks on the files used in    *
     F*             this program.                                        *
     F*             Change files to user controlled. If there is an      *
     F*             error on the open then give user a nice error        *
     F*             message and force them to take F3 to exit.           *
     F*  082749  -  For Accrual Keys, if Accrual Key Summary Indicator   *
     F*             is 'Y', Posting Ref must be '1', else it must be     *
     F*             '1' or '3'.                                          *
     F*     047369  -  NARRATIVE CODES SHOULD BE ALPHA AND NOT NUMERIC.  *
     F*                AMEND FIX 054223 - DEFINE NARR CODES AS ALPHA     *
     F*                AND ADD PROCESSING TO BLANK NARR CODE IF '00'     *
0010 F*     054223  -  NON-DISPLAY OF 00 NARRATIVE CODE                  *
0010 F*     E21769  -  S01199 INCOMPLETE. HELP INDICATOR SHOULD HAVE     *
0010 F*                BEEN REMOVED FROM 'I' SPECS                       *
0010 F*     S01199  -  ABS help system. (BHF662)                         *
0010 F*     E11609  -  Account codes set up as blanks instead of zeros   *E11609
0010 F*                if left blank .                                   *E11609
0010 F*     E10863  -  FIELD NREC1 TO BE USED INSTEAD OF NREC SO THAT    *E10863
0010 F*                MORE ACCOUNT KEYS CAN BE HELD IN THE SYSTEM.      *E10863
0010 F*                                                                  *E10863
0011 F********************************************************************
0012 F**
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/COPY WNCPYSRC,SD0050F001
0015 F*D0050FMCF**F*****242            WORKSTN      KPASS  *NOIND         085179
0015 F***SD0050FMCF  F     243            WORKSTN      KPASS  *NOIND                   085179 CGL029
     F***SD0050FMCF  F     279            WORKSTN      KPASS  *NOIND                   CGL029 CSD031
     F***SD0050FMCF  F     339            WORKSTN      KPASS  *NOIND                 CSD031 BUG11700
     F***SD0050FMCF  F     343            WORKSTN      KPASS  *NOIND                 BUG11700 CER049
     FSD0050FMCF  F     356            WORKSTN      KPASS  *NOIND                             CER049
     FSD0050DFCF  E                    WORKSTN                        UC                      CSD031
     F                                        @@RRN KSFILE SD0050S1                           CSD031
     F                                              KINFDS INFDS#                             CSD031
     F                                              KINFSR *PSSR                              CSD031
     F/COPY WNCPYSRC,SD0050F002
0017 F*CKEY***UF**F******96 12AI     2 DISK                               085179
     F***ACKEY** UF  F      96 12AI     2 DISK                           UC            085179 CGL029
     F*ACKEY**UF**F*****156*12AI*****2*DISK                           UC               CGL029 CDL038
     F***ACKEY** UF  F     170 14AI     2 DISK                           UC            CDL038 CSD031
     F***ACKEY   UF  F     215 12AI     2 DISK                           UC          CSD031 BUG11700
     F***ACKEY** UF  F     215 14AI     2 DISK                           UC          BUG11700 CER049
     FACKEY   UF  F     227 14AI     2 DISK                           UC                      CER049
     F                                              KCOMIT
     F*CKEYAL*O***F******96            DISK                      A        085179
     F***ACKEYAL O   F      96            DISK                      A    UC            085179 CGL029
     F*ACKEYALO***F*****156************DISK                      A    UC               CGL029 CDL038
     F***ACKEYAL O   F     170            DISK                      A    UC            CDL038 CSD031
     F***ACKEYAL O   F     215            DISK                      A    UC            CSD031 CER049
     FACKEYAL O   F     227            DISK                      A    UC                      CER049
     F                                              KCOMIT
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
0020 F***TABLE** IF  F      96 12AI     2 DISK                                                CSD031
     FTABLE   IF  F      96 12AI     2 DISK                           UC                      CSD031
     FSDAAKYL0UF  E           K        DISK                           UC                      CSD031
     F                                              KCOMIT                                    CSD031
     F            ACKEYALF                          KRENAMEACKEYAL1                           CSD031
     FSDAAKYL1IF  E           K        DISK                                                   CSD031
     F            ACKEYALF                          KRENAMEACKEYAL2                           CSD031
      ** Midas SD Account Key Acceptance file                                                 CSD031
     FGPZONEL0IF  E           K        DISK                                                   CSD031
      ** Zone                                                                                 CSD031
     FGZSDBANKIF  E           K        DISK                           UC                      CSD031
     F                                              KINFSR *PSSR                              CSD031
      ** Bank Details ICD Keyed on DNWD                                                       CSD031
0021 F**
0022 F* ID F  C  H  L    FUNCTION OF INDICATORS
0023 F* 01            WRKSTN - INITIAL   SCREEN, CODE SF.
0024 F* 02                   - INSERTION SCREEN, CODE SI.
0025 F* 03                   - AMENDMENT SCREEN, CODE SA.
0026 F* 04                   - DELETION  SCREEN, CODE SD.
0027 F* 05                   - ENQUIRY   SCREEN, CODE SE.
0028 F* 06            ACKEY  - FILE HEADER RECORD.
0013 F*  07   USED TO CONDITION FIRST TIME PASS THROUGH RPG CALC CYCLE  *
0029 F* 08                   - DETAIL RECORD-ACTIVE.
0030 F* 09                   - DETAIL RECORD-DELETED.
0034 F* 13            TABLE  - ACCOUNT CODE-ACTIVE.
0035 F* 14                   - NARRATIVE-ACTIVE.
0035 F* 15           CATCHALL
0014 F*       16      ERROR DURING READ FROM THE WORK STATION /         *
     F****************HELP*INDICATOR**                                    S01199
0036 F**
0038 F*    20         WRKSTN-ACCOUNT KEY IN ERROR.
0039 F*       21      A/C KEY BLANK - CONTROL INDICATOR
0040 F*    22         ACKEY-ACCOUNT CODE 1 PRESENT.
0041 F*    23              -ACCOUNT CODE 2 PRESENT.
0042 F*    24              -ACCOUNT CODE 3 PRESENT.
0043 F*    25              -ACCOUNT CODE 4 PRESENT.
0044 F*    26              -ACCOUNT CODE 5 PRESENT.
0045 F*    27              -ACCOUNT CODE 6 PRESENT.
 046 F*    28              -NARRATIVE CODE 1 BLANK
 047 F*    29              -NARRATIVE CODE 2 BLANK
 048 F*    30              -NARRATIVE CODE 3 BLANK
 049 F*    31              -NARRATIVE CODE 4 BLANK
 050 F*    32              -NARRATIVE CODE 5 BLANK
 051 F*    33              -NARRATIVE CODE 6 BLANK
0052 F*    34              -POSTING REFERENCE 1 PRESENT.
0053 F*    35              -POSTING REFERENCE 2 PRESENT.
0054 F*    36              -POSTING REFERENCE 3 PRESENT.
0055 F*    37              -POSTING REFERENCE 4 PRESENT.
0056 F*    38              -POSTING REFERENCE 5 PRESENT.
0057 F*    39              -POSTING REFERENCE 6 PRESENT.
0058 F**
0059 F*       40      PREVENT OUTPUT TO WORKSTN, OVERRIDEN BY 41.
0060 F*       41      OUTPUT INITIAL SCREEN, ID.SF, TO WORKSTN.
0061 F*       42      PASS INITIAL FIELDS FROM INPUT TO OUTPUT WORKSTN.
0062 F*       43      PASS OTHER FIELDS FROM INPUT TO OUTPUT WORKSTN.
0063 F*       44      PASS FIELDS FROM ACKEY RECORD TO WORKSTN.
0064 F*       45      OUTPUT TO ACKEY FILE TO RELEASE.
0064 F*       46      NARRATIVE CODE 1 ERROR
0064 F*       47      NARRATIVE CODE 2 ERROR
0064 F*       48      NARRATIVE CODE 3 ERROR
0064 F*       49      NARRATIVE CODE 4 ERROR
0064 F*       50      NARRATIVE CODE 5 ERROR
0064 F*       51      NARRATIVE CODE 6 ERROR
0067 F*       52      ACTION CODE IS 'I' - INSERTION.
0068 F*       53      ACTION CODE IS 'A' - AMENDMENT.
0069 F*       54      ACTION CODE IS 'D' - DELETION.
0070 F*       55      ACTION CODE IS 'E' - ENQUIRY.
0071 F*       56      ACTION CODE NOT I, A, D OR E, ERROR.
0071 F*             - OR ACKEYAL LOCKED BY ANOTHER JOB.                   085179
     F*       57      SYSTEM SETUP FLAG ON - NO DELETES ALLOWED
     F*       58      Customer Lending Account Key                        135145
0072 F*       60      ACCOUNT KEY CONTAINS INVALID CHARACTER.
0073 F*       61      AT LEAST ONE ACCOUNT CODE IN ERROR.
0074 F*       62      AT LEAST ONE NARRATIVE CODE IN ERROR.
0075 F*       63      AT LEAST ONE POSTING REFERENCE IN ERROR.
0076 F*       64      POSTING REFERENCE IS 2
0064 F*       65      ACCOUNT CODE 1 ERROR
0078 F*       66      NARRATIVE CODE IS NOT IN RANGE 01-50
0079 F*       67      ACCOUNT CODE IS NOT TITLE-ONLY
     F*
     F*       68      LETTERS OF CREDIT CREDIT ACCOUNT KEY.
     F*
0080 F**
0081 F*               EXCEPTION OUTPUT/UPDATE INDICATORS ARE-
0082 F*       69      CHAIN TO ACKEY FAILED.
0064 F*       70      ACCOUNT CODE 2 ERROR
 084 F*       71      UPDATE ACKEY DETAIL RECORD.
 085 F*       72      UPDATE ACKEY HEADER RECORD.
0064 F*       74      ACCOUNT CODE 3 ERROR
0064 F*       75      ACCOUNT CODE 4 ERROR
0087 F**
0088 F*       76      CHAIN TO TABLE FILE FAILED IF ON.
0064 F*       77      ACCOUNT CODE 5 ERROR
0064 F*       78      ACCOUNT CODE 6 ERROR
0091 F**
0092 F*       79      RECORD UPDATED BY ANOTHER WORKSTATION.
0093 F**
0094 F*       80      IF ACTION AND LOCAL INSTITUTION CODES VALID PROTECT
0095 F*               BOTH FIELDS ON SCREEN AND OUTPUT NEW SCREEN ID.
0096 F*       81      NON-DISPLAY OUTPUT LABELS OTHER THAN ACTION & ACKEY.
0097 F*       82      PROTECT OUTPUT FIELDS OTHER THAN ACTION & A/C KEY.
0098 F*       83      ERROR CODE LINE IS NON-DISPLAY IF ON.
0099 F*       84      ERROR MESSAGE LINE IS NON DISPLAY IF ON.
0100 F**
     F*       86      WORK INDICATOR FOR NARRATIVE CODE VALIDATION
     F*       87      WORK INDICATOR FOR NARRATIVE CODE VALIDATION
0101 F*       88      WORK INDICATOR.
0102 F*       89      WORK INDICATOR.
0064 F*       90      POSTING REFERENCE 1 ERROR
0064 F*       91      POSTING REFERENCE 2 ERROR
0064 F*       92      POSTING REFERENCE 3 ERROR
0064 F*       93      POSTING REFERENCE 4 ERROR
0064 F*       94      POSTING REFERENCE 5 ERROR
0064 F*       95      POSTING REFERENCE 6 ERROR
0103 F**
0104 F*       98      ZSYSTM, DATE FORMAT MMDDYY IF ON.
0105 F*       99      ZSYSTM, INSTALLATION CONTROL DATA RECORD NOT FOUND.
0106 F**
0107 F*       KJ      CMD10 DELETE RECORD REQUEST, VALID IF DELETE SCREEN.
0108 F*       KL      CMD12 INITIAL SCREEN REQUEST.
0109 F*       KC      CMD3, END OF PROGRAM REQUEST.
0110 F**
0115 F*          U8   DATABASE ERROR, REQUIRED RECORDS NOT FOUND.
     F*               U8 ENDS THE PROGRAM AND CONDITION
0117 F*                    FOLLOWING OCL EXECUTION.
0118 F**
     F/COPY WNCPYSRC,SD0050F003
0119 E**********          ERRMSG  1   6 47               ERROR MESSAGES   082749
0119 E**********          ERRMSG  1   8 47               ERROR MESSAGES                085179 CSD031
     E                    ERRMSG  1   9 47               ERROR MESSAGES                       CSD031
     E/COPY WNCPYSRC,SD0050E001
0120 E                    ERCD       18  4               ERROR CODE OUTPUT
0121 E**
0122 E                    CHAR   37  37  1               A-Z, 0-9, & BLANK
0123 E                    ACKY       14  1               ARRAY FOR A/C KEY                    CDL038
0123 E********************ACKY       10  1               ARRAY FOR A/C KEY                    CDL038
0124 E**********          SACD        6  4               ACCOUNT CODES                        CGL029
     E                    SACD        6 10                                                    CGL029
     E/COPY WNCPYSRC,SD0050E002
     E                    SASQ        6  2               SEQUENCE NUMBERS                     CER049
0125 E                    SNCD        6  2               NARRATIVE CODES
0126 E                    SPRF        6  1               POSTING REFRENCES
     E**********          SANP        6 13                                             CSD031 CER049
     E                    SANP        6 15                                                    CER049
     E                    ACR     1   8  2               ACCRUAL IDENT.   082749
     E                    CPY@    1   1 80               COPYRIGHT STATEMENT
     E                    OVRC    1   1 80                                                    CSD031
     E                    ERCE       18  4                                                  BUG12492
      * OVERRIDE DATABASE FILE                                                                CSD031
0127 E**
0128 I**   WORKSTATION FILE.
0129 I**
0130 I*D0050FMNS**01   2 CS   3 CF                                        E21769
0131 I*******OR***02   2 CS   3 CI                                        E21769
0132 I*******OR***03   2 CS   3 CA                                        E21769
0133 I*******OR***04   2 CS   3 CD                                        E21769
0134 I*******OR***05   2 CS   3 CE                                        E21769
0135 I****************************************1   1 *IN16                 E21769
0135 I****************************************2   3 STID                  E21769
0136 I****************************************4   4 ACTCD                 E21769
0137 I****************************************5  14 SAKEY           20    E21769
0138 I****************************************5  14 ACKY                  E21769
     I****************************************                            E21769
     I****************************************5   6 SAKYF2                E21769
     I****************************************                            E21769
0139 I***************************************15  18 SACD,1                E21769
0140 I***************************************19  20 SNCD,1                E21769
0141 I***************************************21  21 SPRF,1                E21769
0142 I***************************************22  25 SACD,2                E21769
0143 I***************************************26  27 SNCD,2                E21769
0144 I***************************************28  28 SPRF,2                E21769
0145 I***************************************29  32 SACD,3                E21769
0146 I***************************************33  34 SNCD,3                E21769
0147 I***************************************35  35 SPRF,3                E21769
0148 I***************************************36  39 SACD,4                E21769
0149 I***************************************40  41 SNCD,4                E21769
0150 I***************************************42  42 SPRF,4                E21769
0151 I***************************************43  46 SACD,5                E21769
0152 I***************************************47  48 SNCD,5                E21769
0153 I***************************************49  49 SPRF,5                E21769
0154 I***************************************50  53 SACD,6                E21769
0155 I***************************************54  55 SNCD,6                E21769
0156 I***************************************56  56 SPRF,6                E21769
0157 I*************************************** 2  56 LOTSCN                E21769
0158 I*************************************** 5  56 SCFLDS                E21769
0130 ISD0050FMNS  01   1 CS   2 CF                                        E21769
0131 I       OR   02   1 CS   2 CI                                        E21769
0132 I       OR   03   1 CS   2 CA                                        E21769
0133 I       OR   04   1 CS   2 CD                                        E21769
0134 I       OR   05   1 CS   2 CE                                        E21769
0135 I                                        1   2 STID                  E21769
0136 I                                        3   3 ACTCD                 E21769
0137 I****************************************4  13 SAKEY           20                 E21769 CDL038
0138 I****************************************4  13 ACKY                               E21769 CDL038
     I**                                                                  E21769
     I****************************************4   5 SAKYF2                             E21769 CDL038
     I****************************************4   4 SAKYF1                             135145 CDL038
     I*                                                                   S01408
     I/COPY WNCPYSRC,SD0050IIP1                                           S01408
     I*                                                                   S01408
     I**                                                                  E21769
0139 I**********                             14  17 SACD,1                             E21769 CGL029
0140 I**********                             18  19 SNCD,1                             E21769 CGL029
0141 I**********                             20  20 SPRF,1                             E21769 CGL029
0142 I**********                             21  24 SACD,2                             E21769 CGL029
0143 I**********                             25  26 SNCD,2                             E21769 CGL029
0144 I**********                             27  27 SPRF,2                             E21769 CGL029
0145 I**********                             28  31 SACD,3                             E21769 CGL029
0146 I**********                             32  33 SNCD,3                             E21769 CGL029
0147 I**********                             34  34 SPRF,3                             E21769 CGL029
0148 I**********                             35  38 SACD,4                             E21769 CGL029
0149 I**********                             39  40 SNCD,4                             E21769 CGL029
0150 I**********                             41  41 SPRF,4                             E21769 CGL029
0151 I**********                             42  45 SACD,5                             E21769 CGL029
0152 I**********                             46  47 SNCD,5                             E21769 CGL029
0153 I**********                             48  48 SPRF,5                             E21769 CGL029
0154 I**********                             49  52 SACD,6                             E21769 CGL029
0155 I**********                             53  54 SNCD,6                             E21769 CGL029
0156 I**********                             55  55 SPRF,6                             E21769 CGL029
     I***************************************14  23 SACD,1                             CGL029 CDL038
     I***************************************24  25 SNCD,1                             CGL029 CDL038
     I***************************************26  26 SPRF,1                             CGL029 CDL038
     I***************************************27  36 SACD,2                             CGL029 CDL038
     I***************************************37  38 SNCD,2                             CGL029 CDL038
     I***************************************39  39 SPRF,2                             CGL029 CDL038
     I***************************************40  49 SACD,3                             CGL029 CDL038
     I***************************************50  51 SNCD,3                             CGL029 CDL038
     I***************************************52  52 SPRF,3                             CGL029 CDL038
     I***************************************53  62 SACD,4                             CGL029 CDL038
     I***************************************63  64 SNCD,4                             CGL029 CDL038
     I***************************************65  65 SPRF,4                             CGL029 CDL038
     I***************************************66  75 SACD,5                             CGL029 CDL038
     I***************************************76  77 SNCD,5                             CGL029 CDL038
     I***************************************78  78 SPRF,5                             CGL029 CDL038
     I***************************************79  88 SACD,6                             CGL029 CDL038
     I***************************************89  90 SNCD,6                             CGL029 CDL038
     I***************************************91  91 SPRF,6                             CGL029 CDL038
0137 I                                        4  17 SAKEY           20                        CDL038
0138 I                                        4  17 ACKY                                      CDL038
     I                                        4   5 SAKYF2                                    CDL038
     I                                        4   4 SAKYF1                                    CDL038
     I                                       18  27 SACD,1                                    CDL038
     I**********                             28  29 SNCD,1                             CDL038 CER049
     I**********                             30  30 SPRF,1                             CDL038 CER049
     I**********                             31  40 SACD,2                             CDL038 CER049
     I**********                             41  42 SNCD,2                             CDL038 CER049
     I**********                             43  43 SPRF,2                             CDL038 CER049
     I**********                             44  53 SACD,3                             CDL038 CER049
     I**********                             54  55 SNCD,3                             CDL038 CER049
     I**********                             56  56 SPRF,3                             CDL038 CER049
     I**********                             57  66 SACD,4                             CDL038 CER049
     I**********                             67  68 SNCD,4                             CDL038 CER049
     I**********                             69  69 SPRF,4                             CDL038 CER049
     I**********                             70  79 SACD,5                             CDL038 CER049
     I**********                             80  81 SNCD,5                             CDL038 CER049
     I**********                             82  82 SPRF,5                             CDL038 CER049
     I**********                             83  92 SACD,6                             CDL038 CER049
     I**********                             93  94 SNCD,6                             CDL038 CER049
     I**********                             95  95 SPRF,6                             CDL038 CER049
     I**********                             96  96 SZONE                              CDL038 CER049
     I**********                             97 102 SEFFDT                             CDL038 CER049
     I**********                              1  95 LOTSCN                             CDL038 CER049
     I**********                              4  95 SCFLDS                             CDL038 CER049
     I**********                             14  95 SAFLDS                           CSD031 BUG11700
     I**********                             18  95 SAFLDS                           BUG11700 CER049
     I                                       28  29 SASQ,1                                    CER049
     I                                       30  31 SNCD,1                                    CER049
     I                                       32  32 SPRF,1                                    CER049
     I                                       33  42 SACD,2                                    CER049
     I                                       43  44 SASQ,2                                    CER049
     I                                       45  46 SNCD,2                                    CER049
     I                                       47  47 SPRF,2                                    CER049
     I                                       48  57 SACD,3                                    CER049
     I                                       58  59 SASQ,3                                    CER049
     I                                       60  61 SNCD,3                                    CER049
     I                                       62  62 SPRF,3                                    CER049
     I                                       63  72 SACD,4                                    CER049
     I                                       73  74 SASQ,4                                    CER049
     I                                       75  76 SNCD,4                                    CER049
     I                                       77  77 SPRF,4                                    CER049
     I                                       78  87 SACD,5                                    CER049
     I                                       88  89 SASQ,5                                    CER049
     I                                       90  91 SNCD,5                                    CER049
     I                                       92  92 SPRF,5                                    CER049
     I                                       93 102 SACD,6                                    CER049
     I                                      103 104 SASQ,6                                    CER049
     I                                      105 106 SNCD,6                                    CER049
     I                                      107 107 SPRF,6                                    CER049
     I/COPY WNCPYSRC,SDH00570
     I                                      108 108 SZONE                                     CER049
     I                                      109 114 SEFFDT                                    CER049
     I                                        1 107 LOTSCN                                    CER049
     I                                        4 107 SCFLDS                                    CER049
     I                                       18 107 SAFLDS                                    CER049
     I/COPY WNCPYSRC,SD0050I001
0157 I**********                              1  55 LOTSCN                             E21769 CGL029
0158 I**********                              4  55 SCFLDS                             E21769 CGL029
     I****************************************1  91 LOTSCN                             CGL029 CDL038
     I****************************************4  91 SCFLDS                             CGL029 CDL038
     I/COPY WNCPYSRC,SD0050I002
0159 I**
0160 I**   CATCHALL.
0161 I        NS  15
0162 I**
0163 I**
0164 I**   ACCOUNT KEYS FILE - HEADER RECORD.
0165 I**
0166 IACKEY   NS  06   1 CH
0167 I                                        1   1 RECI
0168 I                                       97 110 AKEY                                      CDL038
T168 I****************************************2  11 AKEY                                      CDL038
0169 I***************************************14  170NREC                  E10863
0170 I                                       18  210NINS
0171 I                                       22  250NDEL
0172 I                                       26  290NAMD
     I                                    P  30  320NREC1                 E10863
0173 I**********                              1  96 LOT                                       CGL029
     I****************************************1 156 LOT                                CGL029 CDL038
     I**********                              1 170 LOT                                CDL038 CSD031
     I**********                              1 215 LOT                                CSD031 CER049
     I                                        1 227 LOT                                       CER049
0174 I**
0175 I**   ACCOUNT KEYS FILE - DETAIL RECORD.
0176 I**
0177 I        NS  08   1 CD
0178 I       OR   09   1NCD
0179 I                                        1   1 RECI
0180 I                                      157 170 AKEY                                      CDL038
0180 I****************************************2  11 AKEY                                      CDL038
0181 I**********                             14  170ACD1        22                            CGL029
0182 I**********                             18  210ACD2        23                            CGL029
0183 I**********                             22  250ACD3        24                            CGL029
0184 I**********                             26  290ACD4        25                            CGL029
0185 I**********                             30  330ACD5        26                            CGL029
0186 I**********                             34  370ACD6        27                            CGL029
     I                                       14  170ACD1QQ                                    CGL029
     I                                       18  210ACD2QQ                                    CGL029
     I                                       22  250ACD3QQ                                    CGL029
     I                                       26  290ACD4QQ                                    CGL029
     I                                       30  330ACD5QQ                                    CGL029
     I                                       34  370ACD6QQ                                    CGL029
0187 I**************                         38  39 NCD1            28    054223
0188 I**************                         40  41 NCD2            29    054223
0189 I**************                         42  43 NCD3            30    054223
0190 I**************                         44  45 NCD4            31    054223
0191 I**************                         46  47 NCD5            32    054223
0192 I**************                         48  49 NCD6            33    054223
0187 I**************                   38  390NCD1            28    054223047369
0188 I**************                   40  410NCD2            29    054223047369
0189 I**************                   42  430NCD3            30    054223047369
0190 I**************                   44  450NCD4            31    054223047369
0191 I**************                   46  470NCD5            32    054223047369
0192 I**************                   48  490NCD6            33    054223047369
     I                                       38  39 NCD1            28    047369
     I                                       40  41 NCD2            29    047369
     I                                       42  43 NCD3            30    047369
     I                                       44  45 NCD4            31    047369
     I                                       46  47 NCD5            32    047369
     I                                       48  49 NCD6            33    047369
0193 I                                       50  500PRF1        34
0194 I                                       51  510PRF2        35
0195 I                                       52  520PRF3        36
0196 I                                       53  530PRF4        37
0197 I                                       54  540PRF5        38
0198 I                                       55  550PRF6        39
0199 I                                    P  90  920LCD
0200 I                                       93  93 CHTP
0201 I                                    P  94  960TNLU
     I                                       97 1060ACD1        22                            CGL029
     I                                      107 1160ACD2        23                            CGL029
     I                                      117 1260ACD3        24                            CGL029
     I                                      127 1360ACD4        25                            CGL029
     I                                      137 1460ACD5        26                            CGL029
     I                                      147 1560ACD6        27                            CGL029
     I**********                            197 197 AACC                             CSD031 BUG11700
     I**********                          P 198 2000EACC                             CSD031 BUG11700
     I**********                            201 201 GPDT                             CSD031 BUG11700
     I                                      211 211 AACC                                    BUG11700
     I                                    P 212 2140EACC                                    BUG11700
     I                                      215 215 GPDT                                    BUG11700
     I                                      216 217 ASQ1                                      CER049
     I                                      218 219 ASQ2                                      CER049
     I                                      220 221 ASQ3                                      CER049
     I                                      222 223 ASQ4                                      CER049
     I                                      224 225 ASQ5                                      CER049
     I                                      226 227 ASQ6                                      CER049
0202 I**********                              1  96 LOT                                       CGL029
     I****************************************1 156 LOT                                CGL029 CDL038
     I**********                              1 170 LOT                                CDL038 CSD031
     I**********                              1 215 LOT                                CSD031 CER049
     I                                        1 227 LOT                                       CER049
0203 I**
0204 I**   CATCHALL.
0205 I        NS  15
0206 I**
0258 I**
0259 I**   TABLE FILE - INSTALLATION CONTROL DATA RECORD 1.
0260 I**
0261 ITABLE   NS  15   2 C0   3 C1  12 C1
0262 I       AND      13 C0
0263 I                                        1   1 RECI
0264 I                                        2   30RECT
0265 I                                       12  130RCDE
0266 I                                       14  66 TITL
0267 I                                       67  67 DATF
0268 I                                       68  700DFBR
0269 I                                       74  74 MODI1
0270 I                                       75  75 MODI2
0271 I                                       76  76 MODI3
0272 I                                    P  77  790RUND
0273 I                                       80  86 RUNA
0274 I                                       87  870SFLG
0275 I                                    P  90  920LCD
0276 I                                       93  93 CHTP
0277 I                                    P  94  960TNLU
0278 I**********                              1  96 LOT                                       CGL029
0279 I**
0280 I**   TABLE FILE - ACCOUNT CODES RECORD 1.
0281 I**
0282 I********NS  13   1 CD   2 C3   3 C0                                                     CGL029
0283 I*******AND      13 C1                                                                   CGL029
0284 I**********                              1   1 RECI                                      CGL029
0285 I**********                              2   30RECT                                      CGL029
0286 I**********                              9  120ACOD                                      CGL029
0287 I**********                             13  130SREC                                      CGL029
0288 I**********                             14  38 ACKN                                      CGL029
0289 I**********                             39  39 ATYP                                      CGL029
0290 I**********                             40  430SHLC                                      CGL029
0291 I**********                             44  470SHFC                                      CGL029
0292 I**********                             48  48 TITO                                      CGL029
0293 I**********                             49  520BSDR                                      CGL029
0294 I**********                             53  560BSCR                                      CGL029
0295 I**********                             57  600PLDR                                      CGL029
0296 I**********                             61  640PLCR                                      CGL029
0297 I**********                             65  740RPCD                                      CGL029
0298 I**********                             75  76 ACCS                                      CGL029
0299 I**********                          P  90  920LCD                                       CGL029
0300 I**********                             93  93 CHTP                                      CGL029
0301 I**********                          P  94  960TNLU                                      CGL029
0302 I**********                              1  96 LOT                                       CGL029
0303 I**
0304 I**   TABLE FILE - NARRATIVE CODES RECORD.
0305 I**
0306 I        NS  14   1 CD   2 C9   3 C0
0307 I                                        1   1 RECI
0308 I                                        2   30RECT
0309 I                                       12  13 NARC
0310 I                                       14  43 NARD
0311 I                                    P  90  920LCD
0312 I                                       93  93 CHTP
0313 I                                    P  94  960TNLU
0314 I**********                              1  96 LOT                                       CGL029
0315 I**
0316 I**   CATCHALL FOR DELETED RECORDS.
0317 I        NS  15
0318 I**
     I/COPY WNCPYSRC,SD0050I005
0319 I**
0320 I**   DATA STRUCTURE FOR LAST UPDATE DATA.
0321 I**
0322 I            DS
0323 I                                        1   50LCD
0324 I                                        6   6 CHTP
0325 I                                        7  110TNLU
0326 I                                        1  11 LSTC
0327 I                                       12  160LCDS
0328 I                                       17  17 CHTPS
0329 I                                       18  220TNLUS
0330 I                                       12  22 LSTCS
     I*
     I*  DATA STRUCTURE FOR VALIDATING NARRATIVE CODE
     I            DS
     I                                        1   2 SNCDC
     I                                        1   1 NCDCH1
     I                                        2   2 NCDCH2
     IPSDS       SDS
     I                                        1  10 ##PGM                                     CSD031
     I                                      244 246 WSID
     I                                      245 246 WSID2
     I                                      254 263 USRID
     I**
     I**  DATA STRUCTURE  TO UPDATE LAST TRANSACTION NUMBER DTAARA
     I**
     IDNATN       DS                              5
     I                                        1   50FNATN
0331 I**
     I**  ACCOUNT KEY DATA STRUCTURE                                      082749
     I            DS                                                      082749
     I****************************************1  10 AKEY           082749 CDL038
     I                                        1  14 AKEY                  CDL038
     I                                        3   3 EVCOD                 082749
     I                                       10  10 EVSUB                 082749
      *                                                                                       233194
     I            DS                                                                          233194
     I                                        1  14 SAKEY                                     233194
     I                                        3   3 SEVCD                                     233194
     I                                       10  10 SEVSB                                     233194
0332 I**
     I**  DATA STRUCTURE FOR ERROR HANDLING SUROUTINE
     I**
     IINFDS#    E DSY2I#DSP                                                                   CSD031
      * Display file information data structure                                               CSD031
      *                                                                                       CSD031
     I            DS                                                                          CSD031
     I                                        1   40@@RRN                                     CSD031
     I                                        5   80@SRRN                                     CSD031
     I                                        9  140ZD1                                       CSD031
     IINFDS       DS
     I                                     *STATUS  STATUS
     I**
     I**  DATA STRUCTURE TO PROVIDE TEXT ON COMIT ENTRY IN JOURNAL
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTCD
     I                                       26  35 USRIDX
     I/COPY WNCPYSRC,SD0050I003
     I**********                             51 105 LOTSCN                                    CGL029
     I***************************************51 141 LOTSCN                             CGL029 CDL038
     I**********                             51 145 LOTSCN                             CDL038 CER049
     I                                       51 157 LOTSCN                                    CER049
     I/COPY WNCPYSRC,SD0050I004
     ILDA         DS                            256                                           CSD031
     I** *LOCK IN LDA immediately before and OUT LDA immediately                              CSD031
     I** after each database error handling.                                                  CSD031
     I                                      134 183 DBLOT                                     CSD031
     I                                      134 141 DBFILE                                    CSD031
     I                                      142 170 DBKEY                                     CSD031
     I                                      171 180 DBPGM                                     CSD031
     I                                      181 1830DBASE                                     CSD031
      *                                                                                       CFT156
     ISVAL1       DS                            200                                           CFT156
     I                                        1   2 SVAL12                                    CFT156
      ** DS for AOSVALR0                                                                      CFT156
      *                                                                                       CFT156
     I              'FTRelRefNarrCode   ' C         SVALKA                                    CFT156
      *                                                                                       CSD031
     I*                                                                   082749
     ISDGELR    E DSSDGELRPD                                              082749
     I* GENERAL LEDGER DETAILS ACCESSED VIA ACCESS PROGRAM                082749
     C**
     ISDACOD    E DSSDACODPD                                                                  CGL029
     I              QQACCD                          QQACD1                                    CGL029
     I              A5TOIN                          TITO                                      CGL029
      ** Account codes details                                                                CGL029
      *                                                                                       CGL029
     ISDNARR    E DSSDNARRPD                                                                  CGL014
      ** Narrative Details                                                                    CGL014
      *                                                                                       CGL014
     ISCSARD    E DSSCSARDPD                                                                  CGL014
     I              LCD                             SCLCD                                     CGL014
      ** SAR Details                                                                          CGL014
      *                                                                                       CGL014
     IDSFDY     E DSDSFDY                                                 082749
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                082749
     I*                                                                   082749
     I/COPY WNCPYSRC,SD0050I006
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
      *                                                                                       CSD031
     IGPACOD    E DSGPACODPD                                                                  CSD031
      ** Global Account Code                                                                  CSD031
      *                                                                                       CSD031
     ISDBANK    E DSSDBANKPD                                                                  CSD031
      ** Bank details file                                                                    CSD031
      *                                                                                       CSD031
     I@1DBRC    E DSACKEYAL                                                                   CSD031
     I              RECI                            RECI2                                     CSD031
     I              AKEY                            AKEY2                                     CSD031
     I              LCD                             LCD2                                      CSD031
     I              CHTP                            CHTP2                                     CSD031
     I              TNLU                            TNLU2                                     CSD031
     I              AACC                            AACC2                                     CSD031
     I              ZONE                            ZONE2                                     CSD031
      *                                                                                       CSD031
     IWDTQ        DS                                                                          CSD031
     I                                        1  10 WPFNAM                                    CSD031
     I                                       11  40 WKEYS                                     CSD031
     I                                       41 296 WDATA                                     CSD031
      *                                                                                       CSD031
     IPDQMSG      DS                           4040                                           CSD031
      *                                                                                       CSD031
     I              'GBSDUSRMSG'          C         WMSGQ1                                    CSD031
     I              'Y2USRMSG  '          C         WMSGQ2                                    CSD031
     I              'Central Data  :'     C         WGPDTA                                    CSD031
     I              'Accept to Zone:'     C         WSZONE                                    CSD031
     I              'Effective Date:'     C         WSEFDT                                    CSD031
     I              '1234567890'          C         DIGITS                                    CSD031
     I**********    'XLIB/SDCSNDDTQ'      C         PGMB                               CSD031 CSC043
     I              'XPLIB/SDCSNDDTQ'     C         PGMB                                      CSC043
      *                                                                                       CSD031
     ISFMT        DS                                                                          CSD031
     I                                        1  10 SACOD                                     CSD031
     I**********                             11  12 SNARR                              CSD031 CER049
     I**********                             13  13 SPOST                              CSD031 CER049
     I                                       11  12 SACSQ                                     CER049
     I                                       13  14 SNARR                                     CER049
     I                                       15  15 SPOST                                     CER049
     C                     MOVEACPY@      BIS@   80
     C**   FROM ERROR HANDLING SUBROUTINE RETURN TO EXIT POINT
     C           STATUS    IFEQ 01021
     C                     Z-ADD0         STATUS  50
     C                     GOTO INFTAG
     C                     END
      *                                                                                       CFT156
      ** Check system values                                                                  CFT156
      *                                                                                       CFT156
     C                     CALL 'AOSVALR0'                                                    CFT156
     C                     PARM           @RTCD                                               CFT156
     C                     PARM SVALKA    SVALK1 20                                           CFT156
     C                     PARM           SVAL1 200                                           CFT156
     C                     PARM *BLANK    SVALK2 20                                           CFT156
     C                     PARM           SVAL2 200                                           CFT156
     C                     PARM *BLANK    SVALK3 20                                           CFT156
     C                     PARM           SVAL3 200                                           CFT156
     C                     PARM *BLANK    SVALK4 20                                           CFT156
     C                     PARM           SVAL4 200                                           CFT156
     C                     PARM *BLANK    SVALK5 20                                           CFT156
     C                     PARM           SVAL5 200                                           CFT156
     C                     PARM *BLANK    SVALK6 20                                           CFT156
     C                     PARM           SVAL6 200                                           CFT156
     C                     PARM *BLANK    SVALK7 20                                           CFT156
     C                     PARM           SVAL7 200                                           CFT156
     C                     PARM *BLANK    SVALK8 20                                           CFT156
     C                     PARM           SVAL8 200                                           CFT156
     C                     PARM *BLANK    SVALK9 20                                           CFT156
     C                     PARM           SVAL9 200                                           CFT156
     C                     PARM *BLANK    SVALK0 20                                           CFT156
     C                     PARM           SVAL10200                                           CFT156
      *                                                                                       CFT156
     C           @RTCD     IFNE *BLANK                                                        CFT156
     C                     MOVELSVALKA    DBKEY                                               CFT156
     C                     MOVEL'SDSVALPD'DBFILE                                              CFT156
     C                     Z-ADD3         DBASE                                               CFT156
     C                     EXSR *PSSR                                                         CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     MOVE SVAL12    FTNCD   2                                           CFT156
     C**
     C                     MOVE *BLANKS   WUMTXT 80                                           CSD031
      *                                                                                       CSD031
     C*    READ WORKSTATION FILE /*HELP*FACILITY***                       S01199
     C**
     C           *IN07     IFEQ '1'
     C************IN16     DOUEQ'0'                                       S01199
     C                     READ SD0050FM                 16
     C************IN16     IFEQ '1'                                       S01199
     C*********************MOVEAERCD      HERCD 160                       S01199
     C*********************MOVEL'SD0050'  HBPGM   8                       S01199
     C*********************CALL 'MHELP'                                   S01199
     C*********************PARM           HBPGM                           S01199
     C*********************PARM           HERCD                           S01199
     C*********************END                                            S01199
     C*********************END                                            S01199
      * IF FILES NOT SUCCESSFULLY OPENED USER MUST EXIT USING F3          085179
      * IGNORE ALL OTHER ACTIONS.                                         085179
     C           #OPEN     IFNE 'Y'                                       085179
     C                     GOTO ENDD                                      085179
     C                     END                                            085179
     C                     GOTO ENDFC
     C                     END
     C/COPY WNCPYSRC,SD0050C021
      *                                                                                       CFT156
      ** Check if CFT156 is switched on                                                       CFT156
      *                                                                                       CFT156
     C                     CALL 'AOSARDR0'                                                    CFT156
     C                     PARM '       ' @RTCD   7                                           CFT156
     C                     PARM '*VERIFY' @OPTN   7                                           CFT156
     C                     PARM 'CFT156'  @SARD   6                                           CFT156
      *                                                                                       CFT156
     C           @RTCD     IFEQ *BLANK                                                        CFT156
     C                     MOVEL'Y'       CFT156  1                                           CFT156
     C                     ELSE                                                               CFT156
     C                     MOVEL'N'       CFT156                                              CFT156
     C                     END                                                                CFT156
      *                                                                                       CFT156
     C*
0333 C**   FIRST CYCLE ONLY CALCULATIONS.
0335 C  N07                SETON                     07
0339 C**
      *                                                                   085179
      * ASSUME IF ERROR ON OPEN OF FILE THAT IT IS LOCKED. (TO BE MORE    085179
      * SURE WE COULD CHECK FOR CPF4128 IN INFDS AND IF IT IS ANY OTHER   085179
      * ERROR THEN RETRY OPEN WITHOUT THE INDICATOR TO CAUSE A DUMP)      085179
      * IF FILE LOCKED THEN FORCE USER TO EXIT USING F3.                  085179
      *                                                                   085179
     C                     OPEN ACKEY                  56                 085179
     C           *IN56     IFEQ '0'                                       085179
     C                     OPEN ACKEYAL                56                 085179
     C/COPY WNCPYSRC,SD0050C010
     C                     END                                            085179
      *                                                                   085179
     C           *IN56     IFEQ '1'                                       085179
     C                     SETON                     0181                 085179
     C**********           MOVE ERRMSG,8  ERMSG                                        085179 CSD031
     C                     MOVELERRMSG,8  ERMSG     P                                         CSD031
     C                     GOTO ENDD                                      085179
     C                     END                                            085179
      *                                                                   085179
     C                     MOVE 'Y'       #OPEN   1                       085179
      *                                                                   085179
0340 C**   GET INSTALLATION CONTROL DATA RECORD AND RELEASE.
0341 C                     EXSR ZSYSTM
0342 C   99                SETON                     U840  NOT FOUND,
0343 C   99                GOTO ENDD                       DATABASE ERROR.
     C**
     C**   CHECK IF SYSTEM SETUP FLAG IS ON
     C           SFLG      COMP 1                        57
0344 C**
0345 C**   SETUP BLANK AND ZERO FIELDS.
0346 C                     MOVE ' '       BLANKS150
0347 C                     Z-ADD0         ZERO05  50
0348 C**
0349 C**   SET UP CONSTANT FOR ACCOUNT CODES KEY.
0350 C                     MOVE '1'       ACODKY  5
     C/COPY WNCPYSRC,SD0050C001
      *                                                                                       CGL047
      ** Check for CGL047                                                                     CGL047
      *                                                                                       CGL047
     C                     CALL 'AOSARDR0'                                                    CGL047
     C                     PARM '       ' ##RTCD  7                                           CGL047
     C                     PARM '*VERIFY' ##OPTN  7                                           CGL047
     C                     PARM 'CGL047'  ##SARD  6                                           CGL047
     C           SCSARD    PARM *BLANKS   SCSARD                                              CGL047
      *                                                                                       CGL047
     C           ##RTCD    IFEQ *BLANK                                                        CGL047
     C                     MOVEL'Y'       CGL047  1                                           CGL047
     C                     END                                                                CGL047
      *                                                                                       CGL047
0351 C**
0352 C           ENDFC     TAG                             ** ENDFC TAG **
0353 C**
0354 C**
0355 C**   RESET INDICATORS.
0356 C                     SETOF                     404142
0357 C                     SETOF                     434455
0358 C                     SETOF                     566061
0359 C                     SETOF                     626379
0360 C                     SETOF                     808182
0361 C                     SETOF                     21
     C                     SETOF                     657074
     C                     SETOF                     757778
     C                     SETOF                     464748
     C                     SETOF                     495051
     C                     SETOF                     909192
     C                     SETOF                     939495
     C                     MOVE *OFF      *IN73                                               CSD031
     C                     MOVE *OFF      *IN10                                               CSD031
     C                     MOVE *OFF      *IN11                                               CSD031
     C                     MOVE *OFF      *IN13                                               CSD031
     C                     MOVEA'00'      *IN,18                                              CSD031
     C                     MOVE *OFF      *IN52                                             BUG11450
     C                     MOVE *OFF      *IN53                                             BUG11450
     C                     MOVE *OFF      *IN54                                             BUG11450
     C                     MOVE *OFF      *IN55                                             BUG11450
     C/COPY WNCPYSRC,SD0050C002
     C                     SETOF                     5896                                     CER049
0362 C**
0363 C                     SETON                     8384
0364 C**
0365 C**
0366 C**   CLEAR ERROR OUTPUT AREA AND WORKFIELD.
0367 C                     MOVE BLANKS    ERCD
0368 C                     Z-ADD0         S       20
0369 C**
0370 C**
0371 C**   RESET LAST UPDATE DATA FIELDS FOR NEW TRANSACTION.
0372 C   01                Z-ADD0         LCDS
0373 C   01                MOVE ' '       CHTPS
0374 C   01                Z-ADD0         TNLUS
0375 C**
0376 C**
0377 C**   HANDLE INPUT AND TAKE APPROPRIATE ACTION.
0378 C**
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     IFEQ *OFF                                                          CSD031
     C           *INKK     ANDEQ*ON                                                           CSD031
     C           CSD033    ANDEQ'Y'                                                           CSD031
     C                     MOVE 'Y'       WPGEMD  1                                           CSD031
     C                     MOVEA*IN,10    WIND10 10                                           CSD031
      *                                                                                       CSD031
      ** Clear messages from program message queue                                            CSD031
      *                                                                                       CSD031
     C                     CALL 'Y2CLMSC'                                                     CSD031
     C                     PARM ##PGM     ZAPGMQ 10                                           CSD031
     C                     PARM '*SAME'   ZAPGRL  5                                           CSD031
     C                     Z-ADD@#SFRC    @@RRN1                                              CSD031
      *                                                                                       CSD031
     C                     EXSR SRBLSF                                                        CSD031
     C                     MOVEAWIND10    *IN,10                                              CSD031
     C                     MOVE *OFF      *IN20                                               CSD031
     C                     MOVE *OFF      *IN17                                               CSD031
     C           *INKK     IFEQ *ON                                                           CSD031
     C                     GOTO SFOUT                                                         CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
0379 C**   COMMAND KEY TESTS, SET WRKSTN CONTROL INDS. AS REQUIRED.
0380 C   KC                SETON                     40
0381 C   KC                GOTO ENDD                       END OF JOB
0382 C**
0383 C   KL                GOTO SFOUT                      SCREEN SF REQ.
0384 C**
0385 C   KJ 04             GOTO UDLOG                      DELETE RECORD
0386 C**
0387 C**   INVALID KEY OR INVALID COMMAND KEY FOR SCREEN TYPE TESTS.
0388 C   04
0389 COR KJN04             SETON                     4243
0390 C   42                SETOF                     8420
0391 C   42N01             SETON                     80
0392 C   42 01             SETON                     81
0393 C   42N02N03          SETON                     82
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     ANDEQ*OFF                                                          CSD031
     C           *IN03     ANDEQ*ON                                                           CSD031
     C                     MOVE *ON       *IN82                                               CSD031
     C                     ENDIF                                                              CSD031
0394 C***42*****           MOVE ERRMSG,4  ERMSG  47                                           CSD031
     C   42                MOVELERRMSG,4  ERMSG  75 P                                         CSD031
0395 C***42*04**           MOVE ERRMSG,5  ERMSG                                               CSD031
0395 C   42 04             MOVELERRMSG,5  ERMSG     P                                         CSD031
0396 C   42                GOTO SCNOUT
0397 C**
0398 C**   ACTION SCREEN TYPE.
0399 C   01                GOTO INITAL
0400 C   02
0401 COR 03                GOTO INSAMD
0402 C**
0403 C**   FIRST CYCLE BLANK SCREEN, 'SE' SCREEN OR CMD12 INPUT,
0404 C**   OUTPUT INITIAL SCREEN, ID SF.
0405 C           SFOUT     TAG                             ** SFOUT TAG **
0406 C                     SETON                     404181
0407 C                     SETON                     82
0408 C   KL                SETOF                     20
0409 C                     GOTO SCNOUT
0410 C**
0411 C**
0412 C**   HANDLE INITIAL SCREEN, TYPE SF.
0413 C           INITAL    TAG                             ** INITAL TAG *
0414 C**
0415 C**   VALIDATE ACTION CODE.
0416 C           ACTCD     COMP 'I'                      52INSERT
0417 C           ACTCD     COMP 'A'                      53AMEND
0418 C           ACTCD     COMP 'D'                      54DELETE
0419 C  N52N53N54ACTCD     COMP 'E'                  565655ENQUIRY
0420 C**
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     ANDEQ*OFF                                                          CSD031
     C           ACTCD     ANDEQ'I'                                                           CSD031
     C                     SETON                     56                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
0421 C**   SET ERROR CODE, MESSAGE AND WRKSTN CONTROL INDICATORS.
     C  N56N57
     CORN56 57N54          GOTO AKEYV
0423 C                     Z-ADD1         S
0424 C                     MOVE '001'     ERCD,S
     C   54                MOVE '002'     ERCD,S
     C   54                SETON                     56
0425 C**********           MOVE ERRMSG,1  ERMSG                                               CSD031
     C                     MOVELERRMSG,1  ERMSG     P                                         CSD031
0426 C                     SETON                     428182
0427 C                     SETOF                     8384
0428 C                     GOTO SCNOUT
0429 C**
0430 C**   ENSURE ACCOUNT KEY FOR INSERT CONTAINS NO INVALID CHARACTERS.
0431 C           AKEYV     TAG                             ** AKEYV TAG **
0432 C   20                SETON                     21
0433 C   20                GOTO AKEYER
0434 C**
0435 C                     Z-ADD0         C       20
0436 C           CHEK      TAG                             ** CHEK TAG **
0437 C           C         ADD  1         C
0438 C           ACKY,C    LOKUPCHAR                     89
0439 C  N89                SETON                     2060
0440 C   20                SETON                     21
0441 C   20                GOTO AKEYER
0442 C***********C*********COMP 10                     89                                     CDL038
0442 C           C         COMP 14                     89                                     CDL038
0443 C   89                GOTO CHEK
0444 C**
0445 C**   DETERMINE IF INSERT ALREADY ON FILE
0446 C**   OR AMEND/DELETE/ENQUIRY NOT ON FILE.
0447 C           AKEYV2    TAG                             ** AKEYV2 TAG *
0448 C*********************MOVELSAKEY     ACKKEY 12                                           CDL038
0448 C**********           MOVELSAKEY     ACKKEY 14                                    CDL038 CSD031
0448 C**********           MOVELSAKEY     ACKKEY 12                                  CSD031 BUG11700
     C                     MOVELSAKEY     ACKKEY 14                                         BUG11700
0449 C                     EXSR ACKCHN
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C                     MOVE *BLANKS   SZONE                                               CSD031
     C                     MOVE *BLANKS   SEFFDT                                              CSD031
     C           *IN69     IFEQ *OFF                                                          CSD031
     C           *INU1     IFEQ *ON                                                           CSD031
     C                     MOVE AACC      SZONE                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE GPDT      SZONE                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE AACC      SZONEV  1                                           CSD031
     C           EACC      IFNE 0                                                             CSD031
     C                     MOVE EACC      ZDAYNO                                              CSD031
     C                     EXSR SRDAT2                                                        CSD031
     C                     MOVE ZDATE     SEFFDT                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C/COPY WNCPYSRC,SD0050C003
0450 C  N69                SETON                     45    RELEASE FILE IF
     C/COPY WNCPYSRC,SD0050C011
0451 C   45                EXSR EXCPTN                     A RECORD FOUND.
0452 C**
0453 C   52 08                                             INSERT-THERE
0454 COR 53N08                                             AMEND-NOT THERE
0455 COR 54N08                                             DELET-NOT THERE
0456 COR 55N08             SETON                     20    ENQU.-NOT THERE
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     ANDEQ*OFF                                                          CSD031
     C                     EXSR SDACHN                                                        CSD031
     C                     ENDIF                                                              CSD031
0457 C  N20                GOTO SFOK
0458 C**
0459 C**
0460 C**   SET ERROR CODE, MESSAGE AND WRKSTN CONTROL INDICATORS.
0461 C           AKEYER    TAG                             ** AKEYER TAG *
0462 C                     Z-ADD1         S
0463 C                     MOVE '004'     ERCD,S
0464 C**********           MOVE ERRMSG,2  ERMSG                                               CSD031
     C                     MOVELERRMSG,2  ERMSG     P                                         CSD031
0465 C   52                MOVE '003'     ERCD,S
0466 C***52*****           MOVE ERRMSG,3  ERMSG                                               CSD031
     C           *IN52     IFEQ *ON                                                           CSD031
     C                     MOVELERRMSG,3  ERMSG     P                                         CSD031
     C                     ENDIF                                                              CSD031
0467 C   21                MOVE '005'     ERCD,S
0468 C***21*****           MOVE ERRMSG,5  ERMSG                                               CSD031
     C           *IN21     IFEQ *ON                                                           CSD031
     C                     MOVELERRMSG,5  ERMSG     P                                         CSD031
     C                     ENDIF                                                              CSD031
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *IN73     ANDEQ*OFF                                                          CSD031
     C           *INU1     ANDEQ*OFF                                                          CSD031
     C                     MOVEL'CSD0002' MSGNO   7                                           CSD031
     C                     MOVELWMSGQ1    MSGF   10                                           CSD031
     C                     EXSR SRRTTX                                                        CSD031
     C                     MOVELMSGTXT    ERMSG                                               CSD031
     C                     ENDIF                                                              CSD031
0469 C                     SETON                     428182
0470 C                     SETOF                     83
0471 C                     SETOF                     84
0472 C                     GOTO SCNOUT
0473 C**
0474 C**
0475 C**   VALID ACTION CODE AND ACCOUNT KEY FOUND.
0476 C           SFOK      TAG                             ** SFOK TAG **
0477 C**
0478 C**   SAVE LAST UPDATE DATA, USING DATA STRUCTURE.
0479 C   08                MOVE LSTC      LSTCS
0480 C**
0481 C**   SET WRKSTN CONTROL INDICATORS.
0482 C                     SETON                     4280
0483 C  N52                SETON                     44
     C           CSD033    IFEQ 'N'                                                           CSD031
0484 C  N52N53             SETON                     82
     C                     ELSE                                                               CSD031
     C           *IN52     IFEQ *OFF                                                          CSD031
     C           *IN53     ANDEQ*OFF                                                          CSD031
     C                     MOVE *ON       *IN82                                               CSD031
     C                     MOVE *OFF      *IN11                                               CSD031
     C                     ELSE                                                               CSD031
     C           *INU1     IFEQ *OFF                                                          CSD031
     C                     MOVE *ON       *IN82                                               CSD031
     C                     MOVE *ON       *IN11                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
0485 C                     GOTO SCNOUT
0486 C**
0487 C**
0488 C**   HANDLE INSERTIONS AND AMENDMENTS.
0489 C           INSAMD    TAG                             ** INSAMD TAG *
0490 C**
     C**
     C**      DETERMINE IF LETTERS OF CREDIT CREDIT ACCOUNT KEY
     C**
     C           SAKYF2    COMP 'IC'                     68IMPORT
     C  N68      SAKYF2    COMP 'AC'                     68ADVISED EXPORT
     C  N68      SAKYF2    COMP 'CC'                     68CONFIRMED EXP.
     C  N68      SAKYF2    COMP 'SB'                     68STANDBY
     C                     MOVE '0'       *IN58                         135145
     C           SAKYF1    IFEQ 'H'                                     135145
     C           SAKYF1    OREQ 'J'                                     135145
     C           SAKYF1    OREQ 'K'                                     135145
     C           CLE106    OREQ 'Y'                                                           249490
     C                     MOVE '1'       *IN58                         135145
     C                     END                                          135145
     C**
0491 C**   LOOP TO VALIDATE INPUT DATA.
0492 C                     Z-ADD0         C
0493 C**
0494 C           CHECK     TAG                             ** CHECK TAG **
0495 C           C         ADD  1         C
0496 C           C         MULT 3         ER      20
0497 C**
0498 C**   VALIDATE ACCOUNT CODES - OPTIONAL.
0499 C           SACD,C    COMP '    '                   89
0500 C**   IS POSTING REFERENCE 2.
0501 C           SPRF,C    COMP '2'                      64
     C/COPY WNCPYSRC,SD0050C012
0502 C***89*****           GOTO NARR                                                          CER049
     C   89                GOTO SEQ                                                           CER049
     C/COPY WNCPYSRC,SD0050C013
0503 C**
0504 C**   MUST NOT BE ENTERED IF POSTING REFERENCE EQUALS 2.
0505 C   64                GOTO ACER
     C/COPY WNCPYSRC,SD0050C022
0506 C**********           MOVELSACD,C    ACODKY                                              CGL029
0507 C**********           MOVEL'30'      TABKEY                                              CGL029
0508 C**********           MOVE ACODKY    TABKEY 12                                           CGL029
0509 C**********           EXSR TABCHN                                                        CGL029
      *                                                                                       CGL029
     C                     MOVE *ON       *IN13                                               CGL029
     C                     MOVELSACD,C    PACOD                                               CGL029
      *                                                                                       CSD031
      ** Use Global Access Object when it comes from the global layer                         CSD031
      *                                                                                       CSD031
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     ANDEQ*ON                                                           CSD031
     C                     CALL 'AOGACDR0'                                                    CSD031
     C                     PARM *BLANKS   PRTCD                                               CSD031
     C                     PARM '*KEY   ' POPTN                                               CSD031
     C                     PARM           PACOD                                               CSD031
     C           GPACOD    PARM GPACOD    DSSDY                                               CSD031
     C                     ELSE                                                               CSD031
     C                     CALL 'AOACODR0'                                                    CGL029
     C                     PARM *BLANKS   PRTCD   7                                           CGL029
     C                     PARM '*KEY   ' POPTN   7                                           CGL029
     C                     PARM           PACOD  10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           '?'       SCAN SACD,C    WIDX    20                                          CSD031
      *                                                                                       CSD031
     C           WIDX      IFNE *ZERO                                                         CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           PRTCD     WHEQ *BLANKS                                                       CSD031
     C                     MOVE PACOD     SACD,C                                              CSD031
     C                     MOVEASAFLDS    SANP                                                CSD031
     C                     MOVE SANP,C    SFMT                                                CSD031
     C                     MOVE PACOD     SACOD                                               CSD031
     C                     MOVE SFMT      SANP,C                                              CSD031
     C                     MOVEASANP      SAFLDS                                              CSD031
     C                     MOVE SAFLDS    SCFLDS                                              CSD031
     C           PRTCD     WHEQ '*NOSEL '                                                     CSD031
     C                     MOVE *BLANKS   SACD,C                                              CSD031
     C           PRTCD     WHEQ '*NRF   '                                                     CSD031
     C                     GOTO ACER                                                          CSD031
     C                     OTHER                                                              CSD031
     C           *LOCK     IN   LDA                                                           CSD031
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C                     MOVEL'GPACODPD'DBFILE                                              CSD031
     C                     ELSE                                                               CSD031
     C                     MOVEL'SDACODPD'DBFILE                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVELSACD,C    DBKEY                                               CSD031
     C                     Z-ADD101       DBASE                                               CSD031
     C                     OUT  LDA                                                           CSD031
     C                     EXSR *PSSR                                                         CSD031
     C                     ENDSL                                                              CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRTCD     IFEQ '*NRF   '                                                     CSD031
     C                     GOTO ACER                                                          CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CGL029
     C********** PRTCD     IFNE *BLANKS                                                CGL029 CSD031
     C**********           GOTO SCNOUT                                                 CGL029 TDA090
     C**********           GOTO ACER                                                   TDA090 CSD031
     C**********           ENDIF                                                       CGL029 CSD031
      *                                                                                       CGL029
0510 C  N13                GOTO ACER
0511 C**
0513 C**   ACCOUNT MUST NOT BE TITLE-ONLY.
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     ANDEQ*ON                                                           CSD031
0514 C           ACTOIN    COMP 'Y'                  6767                                     CSD031
     C                     ELSE                                                               CSD031
0514 C           TITO      COMP 'Y'                  6767
     C                     ENDIF                                                              CSD031
     C/COPY WNCPYSRC,SD0050C007
0516 C***67*****           GOTO NARR                                                          CER049
     C   67                GOTO SEQ                                                           CER049
     C/COPY WNCPYSRC,SD0050C008
0517 C**
0518 C           ACER      TAG                             ** ACER TAG ***
0519 C**
0520 C                     SETON                     61    ERROR
     C           C         IFEQ 1
     C                     SETON                     65
     C                     END
     C           C         IFEQ 2
     C                     SETON                     70
     C                     END
     C           C         IFEQ 3
     C                     SETON                     74
     C                     END
     C           C         IFEQ 4
     C                     SETON                     75
     C                     END
     C           C         IFEQ 5
     C                     SETON                     77
     C                     END
     C           C         IFEQ 6
     C                     SETON                     78
     C                     END
0521 C           ER        ADD  3         ERR     30
0522 C           S         ADD  1         S
0523 C                     MOVE ERR       ERCD,S
     C/COPY WNCPYSRC,SD0050C014
      *                                                                                       CER049
      ** Validate sequence numbers                                                            CER049
      *                                                                                       CER049
     C           SEQ       TAG                             ** SEQ TAG **                      CER049
      *                                                                                       CER049
      ** If posting reference not '1' then sequence not allowed                               CER049
      *                                                                                       CER049
     C           SPRF,C    COMP '1'                      58                                   CER049
     C           *IN58     IFEQ *OFF                                                          CER049
     C           SASQ,C    ANDNE*BLANK                                                        CER049
      *                                                                                       CER049
      ** If account code not entered then sequence not allowed                                CER049
      *                                                                                       CER049
     C           *IN89     OREQ *ON                                                           CER049
     C           SASQ,C    ANDNE*BLANK                                                        CER049
      *                                                                                       CER049
     C                     GOTO SEQERR                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** Check sequence is numeric (only if account code entered)                             CER049
      *                                                                                       CER049
     C           *IN89     IFEQ *OFF                                                          CER049
     C           SASQ,C    ANDNE*BLANKS                                                       CER049
     C                     TESTN          SASQ,C     58  58* Check numeric                    CER049
     C   58                MOVE SASQ,C    XGX1    1        Check +ve                          CER049
     C   58                TESTB'0123'    XGX1           58*                                  CER049
      *                                                                                       CER049
      ** If not positive numeric then an error                                                CER049
      *                                                                                       CER049
     C           *IN58     IFEQ *OFF                       Non +ve numeric                    CER049
     C                     GOTO SEQERR                                                        CER049
     C                     ELSE                                                               CER049
     C                     GOTO NARR                                                          CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** If account code not entered then skip validation                                     CER049
      *                                                                                       CER049
     C                     ELSE                                                               CER049
     C                     GOTO NARR                                                          CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           SEQERR    TAG                             ** SEQERR TAG *                    CER049
      *                                                                                       CER049
     C                     SETON                     96    ERROR                              CER049
     C           C         IFEQ 1                                                             CER049
     C                     SETON                     65                                       CER049
     C                     END                                                                CER049
     C           C         IFEQ 2                                                             CER049
     C                     SETON                     70                                       CER049
     C                     END                                                                CER049
     C           C         IFEQ 3                                                             CER049
     C                     SETON                     74                                       CER049
     C                     END                                                                CER049
     C           C         IFEQ 4                                                             CER049
     C                     SETON                     75                                       CER049
     C                     END                                                                CER049
     C           C         IFEQ 5                                                             CER049
     C                     SETON                     77                                       CER049
     C                     END                                                                CER049
     C           C         IFEQ 6                                                             CER049
     C                     SETON                     78                                       CER049
     C                     END                                                                CER049
     C           C         ADD  23        ERR                                                 CER049
     C           S         ADD  1         S                                                   CER049
     C                     MOVE ERR       ERCD,S                                              CER049
0524 C**
0525 C**   VALIDATE NARRATIVE CODE - MUST BE ON TABLE FILE IF
0526 C**   RELATED ACCOUNT CODE ENTERED.
0527 C**   IF POSTING REFERENCE 2, MUST BE ENTERED.
0528 C**   ELSE IF ACCOUNT CODE BLANK, MUST BE BLANK.
0529 C           NARR      TAG                             ** NARR TAG ***
0530 C           SNCD,C    COMP '  '                     88
     C/COPY WNCPYSRC,SD0050C026
0531 C   89N88N64
0532 COR 89 88 64          GOTO NARERR
     C/COPY WNCPYSRC,SD0050C027
0533 C   89 88             GOTO POST
0534 C**
     C*MUST*BE*IN*RANGE*01-50*OR*ALPHABETIC-NUMERIC*COMBINATION*0A,A0,ETC                     237300
      ** Allow the range to exceed 50 as in the A/C keys generators,                          237300
      ** or allow alphanumeric comination 0A,A0..etc.                                         237300
     C                     MOVE SNCD,C    SNCDC
     C                     SETOF                     668687
     C           CGL014    IFEQ 'N'                                                           CGL014
     C           NCDCH1    COMP '0'                  86  86
     C           NCDCH2    COMP '0'                  87  87
     C*
     C  N86N87             SETON                     66
     C***86*87***SNCDC***  COMP '00'                   66                                     237300
     C***86*87N66SNCDC***  COMP '50'                 66                                       237300
     C                     ELSE
      *                                                                                       CGL014
      ** Check on SDNARRPD if narrative code is valid                                         CGL014
      *                                                                                       CGL014
     C                     CALL 'AONARRR0'                                                    CGL014
     C                     PARM *BLANKS   PRTCD                                               CGL014
     C                     PARM '*KEY   ' POPTN                                               CGL014
     C                     PARM SNCDC     PNCDC   2                                           CGL014
     C           SDNARR    PARM SDNARR    DSFDY                                               CGL014
      *                                                                                       CSD031
     C           '?'       SCAN SNCDC     WIDX                                                CSD031
      *                                                                                       CSD031
     C           WIDX      IFNE *ZERO                                                         CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           PRTCD     WHEQ *BLANKS                                                       CSD031
     C                     MOVE PNCDC     SNCD,C                                              CSD031
     C                     MOVE PNCDC     SNCDC                                               CSD031
     C                     MOVEASAFLDS    SANP                                                CSD031
     C                     MOVE SANP,C    SFMT                                                CSD031
     C                     MOVE PNCDC     SNARR                                               CSD031
     C                     MOVE SFMT      SANP,C                                              CSD031
     C                     MOVEASANP      SAFLDS                                              CSD031
     C                     MOVE SAFLDS    SCFLDS                                              CSD031
     C           PRTCD     WHEQ '*NOSEL '                                                     CSD031
     C                     MOVE *BLANKS   SNCD,C                                              CSD031
     C                     MOVE *BLANKS   SNCDC                                               CSD031
     C                     OTHER                                                              CSD031
     C           *LOCK     IN   LDA                                                           CSD031
     C                     MOVEL'SDNARRPD'DBFILE                                              CSD031
     C                     MOVELSNCDC     DBKEY                                               CSD031
     C                     Z-ADD102       DBASE                                               CSD031
     C                     OUT  LDA                                                           CSD031
     C                     EXSR *PSSR                                                         CSD031
     C                     ENDSL                                                              CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRTCD     IFEQ '*NRF   '                                                     CSD031
     C                     MOVE *ON       *IN66                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CGL014
     C********** PRTCD     IFNE *BLANKS                                                CGL014 CSD031
     C**********           MOVE *ON       *IN66                                        CGL014 CSD031
     C**********           ENDIF                                                       CGL014 CSD031
     C                     ENDIF                                                              CGL014
     C/COPY WNCPYSRC,SD0050C018
      *                                                                                       CFT156
     C           CFT156    IFEQ 'Y'                                                           CFT156
      *                                                                                       CFT156
     C           *IN86     IFEQ *OFF                                                          CFT156
     C           *IN87     ANDEQ*OFF                                                          CFT156
     C           *IN66     ANDEQ*ON                                                           CFT156
     C           SNCDC     ANDEQFTNCD                                                         CFT156
     C                     MOVE *OFF      *IN66                                               CFT156
     C                     GOTO POST                                                          CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
     C                     ENDIF                                                              CFT156
      *                                                                                       CFT156
      *                                                                                       CGL047
      ** Allow narrative code 99                                                              CGL047
      *                                                                                       CGL047
     C           CGL047    IFEQ 'Y'                                                           CGL047
     C           SNCDC     ANDEQ'99'                                                          CGL047
     C                     MOVEL*OFF      *IN66                                               CGL047
     C                     GOTO POST                                                          CGL047
     C                     ENDIF                                                              CGL047
      *                                                                                       CGL047
0538 C   66                GOTO NARERR
      *                                                                                       CSD031
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     IFEQ *ON                                                           CSD031
     C           ACTCD     IFNE 'I'                                                           CSD031
     C           ACTCD     ANDNE'A'                                                           CSD031
     C                     MOVE AACC      SZONE                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     ELSE                                                               CSD031
     C           GPDT      IFEQ 'Y'                                                           CSD031
     C                     SETON                     10                                       CSD031
     C                     MOVE GPDT      SZONE1                                              CSD031
     C                     ELSE                                                               CSD031
     C                     SETOF                     10                                       CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C*                                                                   S01408
     C/COPY WNCPYSRC,SD0050CCP1                                           S01408
     C*                                                                   S01408
0539 C**********           MOVE BLANKS    TABKEY                                              CGL029
     C**********           MOVE BLANKS    TABKEY 12                                    CGL029 CSD031
0540 C**********           MOVEL'90'      TABKEY                                              CSD031
0541 C**********           MOVE SNCD,C    TABKEY                                              CSD031
0542 C**N88*****           EXSR TABCHN                                                        CSD031
0543 C***14N88**           GOTO POST                                                          CSD031
     C                     GOTO POST                                                          CSD031
0544 C**
0545 C           NARERR    TAG                             ** NARERR TAG *
     C           C         IFEQ 1
     C                     SETON                     46
     C                     END
     C           C         IFEQ 2
     C                     SETON                     47
     C                     END
     C           C         IFEQ 3
     C                     SETON                     48
     C                     END
     C           C         IFEQ 4
     C                     SETON                     49
     C                     END
     C           C         IFEQ 5
     C                     SETON                     50
     C                     END
     C           C         IFEQ 6
     C                     SETON                     51
     C                     END
0546 C                     SETON                     62    ERROR
0547 C           ER        ADD  4         ERR
0548 C           S         ADD  1         S
0549 C                     MOVE ERR       ERCD,S
0550 C**
0551 C**   VALIDATE POSTING REF - MUST BE 1, 2 OR 3 IF RELATED
0552 C**   ACCOUNT CODE ENTERED, MUST BE BLANK OR 2 IF A/C CODE BLANK.
     C**   ENTRY OF 5 ALLOWED IF LETTERS OF CREDIT CREDIT A/C KEY.
      ** Entry of '5' is allowed if Customer Lending A/C Key              146015
     C**
0553 C           POST      TAG                             ** POST TAG ***
0554 C           SPRF,C    COMP ' '                      88
     C/COPY WNCPYSRC,SD0050C004
0555 C   89 64                                             POST.REF.2
     C/COPY WNCPYSRC,SD0050C028
0556 COR 89 88             GOTO PASS                       POST.REF.BLANK
     C/COPY WNCPYSRC,SD0050C005
0557 C**   MUST BE BLANK OR 2 IF A/C CODE BLANK.
0558 C   89N88             GOTO SPRERR
0559 C           SPRF,C    COMP '1'                    89
0560 C  N89      SPRF,C    COMP '3'                  89
     C/COPY WNCPYSRC,SD0050C019
      *                                                                                       CGL047
      ** Allow posting reference 4                                                            CGL047
      *                                                                                       CGL047
     C           CGL047    IFEQ 'Y'                                                           CGL047
     C           SPRF,C    IFLT '1'                                                           CGL047
     C           SPRF,C    ORGT '4'                                                           CGL047
     C                     MOVEL*ON       *IN89                                               CGL047
     C                     ELSE                                                               CGL047
     C                     MOVEL*OFF      *IN89                                               CGL047
     C                     ENDIF                                                              CGL047
     C                     ENDIF                                                              CGL047
      *                                                                                       CGL047
     C**
     C**   POSTING REFERENCE 5 HAS BEEN INTRODUCED FOR LETTERS OF
     C**   CREDIT ONLY. POSTING REFERENCE 4 IS NOT USED IN THE CORE
     C**   SYSTEM AT PRESENT.
     C**
     C   89 68   SPRF,C    COMP '5'                  8989
     C   89 58   SPRF,C    COMP '4'                  8989                 135145
     C   89 58   SPRF,C    COMP '5'                  8989                 146015
     C/COPY WNCPYSRC,SD0050C023
0561 C*                                                                   082749
     F*  FOR ACCRUAL KEYS, IF ACCRUAL KEY SUMMARY INDICATOR IS 'Y',       082749
     F*  POSTING REFERENCE MUST BE '1', ELSE IT MUST BE '1' OR '3'        082749
      *                                                                                       233194
     C           *IN52     IFEQ '1'                                                           233194
     C           AKEY      ANDEQ*BLANKS                                                       233194
     C                     MOVELSEVCD     ACRID                                               233194
     C                     MOVE SEVSB     ACRID                                               233194
     C                     ELSE                                                               233194
     C                     MOVELEVCOD     ACRID   2                       082749
     C                     MOVE EVSUB     ACRID                           082749
     C                     ENDIF                                                              233194
      *                                                                                       233194
     C                     Z-ADD1         X       10                      082749
     C           ACRID     LOKUPACR,X                    85               082749
     C*                                                                   082749
     C           *IN85     IFEQ '1'                                       082749
     C*                                                                   082749
     C           BKAKSI    IFEQ 'Y'                                       082749
     C           SPRF,C    ANDNE'1'                                       082749
     C                     SETON                     89                   082749
     C                     END                                            082749
     C           BKAKSI    IFEQ 'N'                                       082749
     C           SPRF,C    ANDEQ'2'                                       082749
     C/COPY WNCPYSRC,SD0050C024
     C                     SETON                     89                   082749
     C                     END                                            082749
     C*                                                                   082749
     C                     END                                            082749
     **CO*Y*WNC*YS*C*SD0050F001                                           S01408
     C/COPY WNCPYSRC,SD0050CPP6                                           S01408
0561 C  N89                GOTO PASS
     C*CO*Y*WNC*YS*C*SD0050C001                                           S01408
     C/COPY WNCPYSRC,SD0050CPP1                                           S01408
0562 C**
0563 C           SPRERR    TAG                             ** SPRERR TAG *
     C           C         IFEQ 1
     C                     SETON                     90
     C                     END
     C           C         IFEQ 2
     C                     SETON                     91
     C                     END
     C           C         IFEQ 3
     C                     SETON                     92
     C                     END
     C           C         IFEQ 4
     C                     SETON                     93
     C                     END
     C           C         IFEQ 5
     C                     SETON                     94
     C                     END
     C           C         IFEQ 6
     C                     SETON                     95
     C                     END
0564 C                     SETON                     63    ERROR
0565 C           ER        ADD  5         ERR
0566 C           S         ADD  1         S
0567 C                     MOVE ERR       ERCD,S
     C*CO*Y*WNC*YS*C*SD0050C002                                           S01408
     C/COPY WNCPYSRC,SD0050CPP2                                           S01408
0568 C**
0569 C           PASS      TAG                             ** PASS TAG ***
0570 C           C         COMP 6                      89
0571 C   89                GOTO CHECK
0572 C**
      *                                                                                       CSD031
      **  Called from central level                                                           CSD031
      *                                                                                       CSD031
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C                     SETOF                     1819                                     CSD031
     C           *INU1     IFEQ *ON                                                           CSD031
      *                                                                                       CSD031
      ** Acept to Zone should be 'Y' or 'N' only                                              CSD031
      *                                                                                       CSD031
     C                     MOVE *OFF      *IN18                                               CSD031
     C           SZONE     IFNE 'Y'                                                           CSD031
     C           SZONE     ANDNE'N'                                                           CSD031
     C           SZONE     ANDNE*BLANKS                                                       CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '024'     ERCD,S                                              CSD031
     C                     MOVELERRMSG,9  ERMSG     P                                         CSD031
     C                     MOVE *ON       *IN18                                               CSD031
     C                     MOVE *ON       *IN61                                               CSD031
     C                     MOVE *OFF      *IN83                                               CSD031
     C                     MOVE *OFF      *IN84                                               CSD031
     C                     ELSE                                                               CSD031
      *                                                                                       CSD031
      ** Default to 'N' when blank                                                            CSD031
      *                                                                                       CSD031
     C           SZONE     IFEQ *BLANKS                                                       CSD031
     C                     MOVE 'N'       SZONE                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Validate action code 'D'                                                             CSD031
      *                                                                                       CSD031
     C           SZONE     IFEQ 'Y'                                                           CSD031
     C           ACTCD     ANDEQ'D'                                                           CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '026'     ERCD,S                                              CSD031
     C                     MOVEL'CSD0007' MSGNO                                               CSD031
     C                     MOVELWMSGQ1    MSGF                                                CSD031
     C                     EXSR SRRTTX                                                        CSD031
     C                     MOVELMSGTXT    ERMSG                                               CSD031
     C                     MOVE *ON       *IN19                                               CSD031
     C                     MOVE *ON       *IN61                                               CSD031
     C                     MOVE *OFF      *IN83                                               CSD031
     C                     MOVE *OFF      *IN84                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Validate effective date                                                              CSD031
      *                                                                                       CSD031
     C           SEFFDT    IFNE *BLANKS                                                       CSD031
      *                                                                                       CSD031
      ** Validate for numeric input                                                           CSD031
      *                                                                                       CSD031
     C           DIGITS    CHECKSEFFDT    WPOS    10                                          CSD031
     C           WPOS      IFGT 0                                                             CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '027'     ERCD,S                                              CSD031
     C                     MOVEL'CSD0015' MSGNO                                               CSD031
     C                     MOVELWMSGQ1    MSGF                                                CSD031
     C                     EXSR SRRTTX                                                        CSD031
     C                     MOVELMSGTXT    ERMSG                                               CSD031
     C                     MOVE *ON       *IN19                                               CSD031
     C                     MOVE *ON       *IN61                                               CSD031
     C                     MOVE *OFF      *IN83                                               CSD031
     C                     MOVE *OFF      *IN84                                               CSD031
     C                     ELSE                                                               CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           SZONE     WHEQ 'Y'                                                           CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '025'     ERCD,S                                              CSD031
     C                     MOVEL'CSD0001' MSGNO                                               CSD031
     C                     MOVELWMSGQ1    MSGF                                                CSD031
     C                     EXSR SRRTTX                                                        CSD031
     C                     MOVELMSGTXT    ERMSG                                               CSD031
     C                     MOVE *ON       *IN19                                               CSD031
     C                     MOVE *ON       *IN61                                               CSD031
     C                     MOVE *OFF      *IN83                                               CSD031
     C                     MOVE *OFF      *IN84                                               CSD031
     C           ACTCD     WHEQ 'D'                                                           CSD031
     C           SZONE     ANDNE'N'                                                           CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '026'     ERCD,S                                              CSD031
     C                     MOVEL'CSD0007' MSGNO                                               CSD031
     C                     MOVELWMSGQ1    MSGF                                                CSD031
     C                     EXSR SRRTTX                                                        CSD031
     C                     MOVELMSGTXT    ERMSG                                               CSD031
     C                     MOVE *ON       *IN19                                               CSD031
     C                     MOVE *ON       *IN61                                               CSD031
     C                     MOVE *OFF      *IN83                                               CSD031
     C                     MOVE *OFF      *IN84                                               CSD031
      *                                                                                       CSD031
     C                     OTHER                                                              CSD031
     C                     MOVE SEFFDT    ZDATE                                               CSD031
     C                     EXSR SRDATE                                                        CSD031
     C           ZERR      IFNE *BLANKS                                                       CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '027'     ERCD,S                                              CSD031
     C                     MOVEL'CSD0015' MSGNO                                               CSD031
     C                     MOVELWMSGQ1    MSGF                                                CSD031
     C                     EXSR SRRTTX                                                        CSD031
     C                     MOVELMSGTXT    ERMSG                                               CSD031
     C                     MOVE *ON       *IN19                                               CSD031
     C                     MOVE *ON       *IN61                                               CSD031
     C                     MOVE *OFF      *IN83                                               CSD031
     C                     MOVE *OFF      *IN84                                               CSD031
     C                     ELSE                                                               CSD031
     C                     Z-ADDZDAYNO    EACC1   50                                          CSD031
     C                     Z-ADDZDAYNO    EACC                                                CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDSL                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ELSE                                                               CSD031
     C                     Z-ADD0         EACC1                                               CSD031
     C                     Z-ADD0         EACC                                                CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE BJRDNB    RUND                                                CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
0573 C**   IF DATA VALID, GO TO UPDATE & LOG.
     C*CO*Y*WNC*YS*C*SD0050C003                                           S01408
     C/COPY WNCPYSRC,SD0050CPP3                                           S01408
0574 C**N61N62N63***       GOTO UDLOG                                                         CER049
     C  N61N62N63                                                                             CER049
     CANN96                GOTO UDLOG                                                         CER049
     C*CO*Y*WNC*YS*C*SD0050C004                                           S01408
     C/COPY WNCPYSRC,SD0050CPP4                                           S01408
0575 C**
0576 C**   DATA INVALID - SET WRKSTN CONTROL INDICATORS.
0577 C                     SETON                     424380
0578 C                     SETOF                     83
0579 C                     GOTO SCNOUT
0580 C**
0581 C**
0582 C**   CALCULATIONS TO UPDATE TABLE FILE.
0583 C           UDLOG     TAG                             ** UDLOG TAG **
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INKJ     IFEQ *ON                                                           CSD031
     C           *IN04     ANDEQ*ON                                                           CSD031
     C           SZONEV    IFEQ 'Y'                                                           CSD031
     C                     ADD  1         S                                                   CSD031
     C                     MOVE '026'     ERCD,S                                              CSD031
     C                     MOVEL'CSD0007' MSGNO                                               CSD031
     C                     MOVELWMSGQ1    MSGF                                                CSD031
     C                     EXSR SRRTTX                                                        CSD031
     C                     MOVELMSGTXT    ERMSG                                               CSD031
     C                     MOVEA'11'      *IN,42                                              CSD031
     C                     MOVE *OFF      *IN84                                               CSD031
     C                     MOVE *ON       *IN80                                               CSD031
     C                     MOVE *OFF      *IN20                                               CSD031
     C                     MOVE *ON       *IN82                                               CSD031
     C                     MOVE *OFF      *IN83                                               CSD031
     C                     GOTO SCNOUT                                                        CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C/COPY WNCPYSRC,SD0050C015
0584 C**
0585 C**   IF A DATABASE ERROR IS FOUND INDICATORS
0586 C**   ARE SET TO - REFLECT THE ERROR CONDITION, RELEASE
0587 C**   FILES, RELEASE THE SCREEN AND TO END THE PROGRAM.
0588 C**
0592 C**   CHECK STATUS OF RECORD UNCHANGED.
0593 C                     EXSR ACKCHN
0594 C**
0595 C  N08                Z-ADD0         LCD
0596 C  N08                MOVE ' '       CHTP
0597 C  N08                Z-ADD0         TNLU
0598 C**
0599 C           LSTC      COMP LSTCS                7979
     C           INFTAG    TAG                             ** INFTAG TAG**
0600 C**
0601 C**   IF RECORD CHANGED, RELEASE FILES, SET ERROR MESSAGE,
0602 C**   SET SCREEN CONTROL INDICATORS AND BYPASS.
0603 C   79N69             SETON                     45
0605 C   79                EXSR EXCPTN
0606 C***79*****           MOVE ERRMSG,6  ERMSG                                               CSD031
     C   79                MOVELERRMSG,6  ERMSG     P                                         CSD031
0607 C   79                SETON                     428082
0608 C   79 08             SETON                     44
0609 C   79                SETOF                     84
0610 C   79 03 08
0611 COR 79 02 09          SETOF                     82
0612 C**
0613 C**   SAVE LAST UPDATE DATA IF FURTHER ACTION ALLOWED
0614 C   79 08N02          MOVE LSTC      LSTCS
0615 C**
0616 C   79                GOTO SCNOUT
0617 C**
     C**
     C**  OBTAIN LAST TRANSACTION NUMBER  AND SET UP STANDARD OUTPUT
     C**  INFORMATION
     C                     EXSR ZTNLU1
     C                     MOVE 'SD'      MDID    2
     C                     MOVEL'SD0050'  PGMN    8
     C                     MOVE WSID      WSIDX   3
     C                     MOVE USRID     USRIDX 10
0647 C**
     C**
     C**   UPDATE/ADD ACCOUNT KEY RECORD.
     C**
0659 C                     SETON                     71
0660 C                     EXSR TIME
0661 C                     EXSR EXCPTN
     C/COPY WNCPYSRC,SD0050C009
      *                                                                                       CSD031
      ** If CSD033 is ON and Central level                                                    CSD031
      ** set the Central Data Indicator to 'Y' when updating the central file                 CSD031
      *                                                                                       CSD031
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     ANDEQ*ON                                                           CSD031
     C                     MOVE 'Y'       SCDTA                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           SEFFDT    IFNE *BLANKS                                                       CSD031
     C                     MOVE SEFFDT    ZDATE                                               CSD031
     C                     EXSR SRDATE                                                        CSD031
     C                     Z-ADDZDAYNO    EACC                                                CSD031
     C                     Z-ADDZDAYNO    EACC1                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Central Layer                                                                      BUG11762
      *                                                                                     BUG11762
     C           CSD033    IFEQ 'Y'                                                         BUG11762
     C           *INU1     ANDEQ*ON                                                         BUG11762
     C                     EXSR SRSDTQ                                                      BUG11762
     C                     GOTO ENDUPD                                                      BUG11762
     C                     ENDIF                                                            BUG11762
0662 C**
0663 C**   GET ACCOUNT KEYS HEADER RECORD READY FOR UPDATE.
0664 C                     MOVE BLANKS    ACKKEY
0665 C                     EXSR ACKCHN
0666 C**
0667 C**   IF HEADER NOT FOUND, DATABASE ERROR.
0668 C  N06                SETON                     U8
0669 C   U8                EXSR DSERR
0670 C   U8                GOTO ENDD
0671 C**
0682 C**   INCREMENT NO. & TYPE OF UPDATES.
0683 C   02      NINS      ADD  1         NINS
0684 C   03      NAMD      ADD  1         NAMD
0685 C   04      NDEL      ADD  1         NDEL
     C**
     C**   UPDATE A/C KEY HEADER RECORD
     C**
0688 C                     SETON                     72
0689 C                     EXSR TIME
0690 C                     EXSR EXCPTN
0691 C**
     C           ENDUPD    TAG                                                                CSD031
      *                                                                                       CSD031
     C**   END COMMITMENT CONTROL
     C**
     C           CMTTXT    COMIT
     C/COPY WNCPYSRC,SD0050C020
     C**
0715 C**   OUTPUT INITIAL SCREEN
0716 C                     SETON                     404181
0717 C                     SETON                     82
0718 C**
0719 C**
0720 C**   OBTAIN TIME FOR SCREEN DISPLAY.
0721 C           SCNOUT    TAG                             ** SCNOUT TAG *
0722 C                     EXSR TIME
0723 C**
     C*  IN ENQUIRY MODE, IF NARRATIVE CODE IS '00', OUTPUT AS BLANK      047369
     C           NCD1      IFEQ '00'                                      047369
     C                     MOVE '  '      NCD1                            047369
     C                     END                                            047369
     C           NCD2      IFEQ '00'                                      047369
     C                     MOVE '  '      NCD2                            047369
     C                     END                                            047369
     C           NCD3      IFEQ '00'                                      047369
     C                     MOVE '  '      NCD3                            047369
     C                     END                                            047369
     C           NCD4      IFEQ '00'                                      047369
     C                     MOVE '  '      NCD4                            047369
     C                     END                                            047369
     C           NCD5      IFEQ '00'                                      047369
     C                     MOVE '  '      NCD5                            047369
     C                     END                                            047369
     C           NCD6      IFEQ '00'                                      047369
     C                     MOVE '  '      NCD6                            047369
     C                     END                                            047369
     C/COPY WNCPYSRC,SD0050C016
0724 C**
0725 C           ENDD      TAG                             ** ENDD TAG **
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     SETON                     64                                       CER049
     C                     ELSE                                                               CER049
     C                     SETOF                     64                                       CER049
     C                     ENDIF                                                              CER049
     C   KC
     COR U8                SETON                     LR
0726 C**
     C*CO*Y*WNC*YS*C*SD0050C005                                           S01408
     C/COPY WNCPYSRC,SD0050CPP5                                           S01408
0727 C**
0728 C********************************************************************
0729 C**
0730 C**
0731 C**   ACKCHN SR. TO RANDOM ACCESS ACCOUNT KEYS FILE.
0732 C**
0733 C           ACKCHN    BEGSR                           *** ACKCHN ***
0734 C**
0735 C**   RESET INDICATORS.
0736 C                     SETOF                     060809
0737 C**
0738 C**   RANDOM ACCESS ACCOUNT KEYS FILE BY KEY.
0739 C           ACKKEY    CHAINACKEY                69    ON NOT THERE
0740 C**
0741 C                     ENDSR
0742 C**
0743 C**
0744 C********************************************************************
0745 C**
0746 C**
0747 C**   TABCHN SR. TO RANDOM ACCESS TABLE FILE.
0748 C**
0749 C           TABCHN    BEGSR                           *** TABCHN ***
0750 C**
0751 C**   RESET INDICATORS.
0752 C                     SETOF                     1314
0753 C**
0754 C**   RANDOM ACCESS TABLE FILE BY KEY.
0755 C********** TABKEY    CHAINTABLE                76    ON NOT THERE                       CSD031
0756 C**
0757 C                     ENDSR
0758 C**
0759 C**
0760 C********************************************************************
0775 C********************************************************************
0776 C**
0777 C**   EXCPTN SR. TO PERFORM EXCEPTION TIME OUTPUT
0778 C**              AND RESET EXCPTION CONTROL INDICATORS.
0779 C**
0780 C           EXCPTN    BEGSR                           *** EXCPTN ***
      *                                                                   E11609
      ** If account codes blank set to zeros.                             E11609
     C                     DO   6         Z       10                      E11609
     C           SACD,Z    IFEQ *BLANKS                                   E11609
     C                     MOVE *ALL'0'   SACD,Z                          E11609
     C                     END                                            E11609
     C           SPRF,Z    IFEQ *BLANK                                    188106
     C                     MOVE '0'       SPRF,Z                          188106
     C                     ENDIF                                          188106
     C                     END                                            E11609
      *                                                                   E11609
     C/COPY WNCPYSRC,SD0050C006
0781 C**
0782 C**   EXCEPTION OUTPUT.
0783 C                     EXCPT
0784 C**
0785 C**   RESET INDICATORS.
0786 C                     SETOF                     457172
0788 C                     SETOF                     73
0789 C**
0790 C                     ENDSR
0791 C**
0792 C**
0793 C********************************************************************
0794 C**
0795 C**   DSERR SR. TO SET INDICATORS TO RELEASE FILES AND WORKSTN
0796 C**
0797 C           DSERR     BEGSR                           *** DSERR ***
0798 C**
0800 C  N69                SETON                     45
0799 C                     SETON                     40
0802 C                     EXSR EXCPTN
0803 C                     ENDSR
0804 C**
0805 C********************************************************************
0806 C**
0807 C**   TIME SR. TO OBTAIN TIME.
0808 C**
0809 C           TIME      BEGSR                           *** TIME ***
0810 C**
0811 C                     TIME           MTIME   60
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C                     TIME           WTIME                                               CSD031
     C                     ENDIF                                                              CSD031
0813 C                     ENDSR
0814 C**
0815 C**
     C/COPY WNCPYSRC,SD0050C017
0816 C********************************************************************
0817 C**
0818 C**   ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.
0819 C**
0820 C           ZSYSTM    BEGSR                           *** ZSYSTEM ***
0821 C**
      *                                                                                       CSD031
     C           *NAMVAR   DEFN           LDA                                                 CSD031
      *                                                                                       CSD031
      ** Check if switchable feature CSD033 is on                                             CSD031
      *                                                                                       CSD031
     C                     CALL 'AOSARDR0'                                                    CSD031
     C                     PARM *BLANKS   PRTCD   7                                           CSD031
     C                     PARM '*VERIFY' POPTN   7                                           CSD031
     C                     PARM 'CSD033'  PSARD   6                                           CSD031
     C           SCSARD    PARM SCSARD    DSSDY                                               CSD031
      *                                                                                       CSD031
     C           PRTCD     IFNE *BLANKS                                                       CSD031
     C           PRTCD     ANDNE'*NRF   '                                                     CSD031
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD031
     C                     MOVEL'CSD033  'DBKEY                                               CSD031
     C                     Z-ADD1         DBASE                                               CSD031
     C                     EXSR *PSSR                                                         CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE 'N'       CSD033  1                                           CSD031
     C                     MOVE *OFF      *IN76                                               CSD031
     C           PRTCD     IFEQ *BLANKS                                                       CSD031
     C                     MOVE 'Y'       CSD033  1                                           CSD031
     C                     MOVE *ON       *IN76                                               CSD031
     C                     OPEN SDAAKYL0                                                      CSD031
     C                     OPEN SD0050DF                                                      CSD031
     C                     MOVE WSZONE    STZONE 15                                           CSD031
     C                     MOVE WSEFDT    STEFDT 15                                           CSD031
     C                     MOVE WGPDTA    STCDTA 15                                           CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     ANDEQ*ON                                                           CSD031
     C                     MOVE *INU1     *IN96                                               CSD031
     C                     ENDIF                                                              CSD031
     C           CSD033    IFEQ 'Y'                                                           CSD031
     C           *INU1     ANDEQ*OFF                                                          CSD031
     C           CSD033    OREQ 'N'                                                           CSD031
0822 C**   SET UP KEY FOR INSTALLATION CONTROL RECORD.
0823 C                     MOVEL'01      'ZTABKY 12
0824 C                     MOVE '  10'    ZTABKY
0825 C**
     C                     OPEN TABLE                                                         CSD031
0826 C           ZTABKY    CHAINTABLE                99    ON NOT THERE
0827 C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED
     C           *IN99     IFEQ *OFF                                                          CSD031
     C                     MOVE RUND      ZDAYNO                                              CSD031
     C                     EXSR SRDAT2                                                        CSD031
     C                     MOVE ZADATE    WDATE                                               CSD031
     C                     ENDIF                                                              CSD031
0828 C**
     C                     ELSE                                                               CSD031
      *                                                                                       CSD031
      ** Retrieve Bank details                                                                CSD031
      *                                                                                       CSD031
     C                     Z-ADD80        PLEN   155                                          CSD031
     C                     MOVE OVRC,1    PCMD   80                                           CSD031
      *                                                                                       CSD031
     C                     CALL 'QCMDEXC'                                                     CSD031
     C                     PARM           PCMD                                                CSD031
     C                     PARM           PLEN                                                CSD031
      *                                                                                       CSD031
     C                     OPEN GZSDBANK                                                      CSD031
     C                     READ GZSDBANK                 97                                   CSD031
     C           *IN97     IFEQ *ON                                                           CSD031
     C                     MOVEL'GZSDBANK'DBFILE                                              CSD031
     C                     Z-ADD2         DBASE                                               CSD031
     C                     EXSR *PSSR                                                         CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE BJDFIN    DATF                                                CSD031
     C                     ENDIF                                                              CSD031
     C                     SETOF                     97                                       CSD031
     C                     CLOSEGZSDBANK                                                      CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
0829 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
0830 C           DATF      COMP 'M'                      98MMDDYY, 98 ON
      *                                                                                       220371
      ** Call AOGELRR0 with option '*FREE' to get the updated                                 220371
      ** values of SDGELRPD.                                                                  220371
      *                                                                                       220371
     C                     CALL 'AOGELRR1'                                                    220371
     C                     PARM *BLANKS   @RTCD                                               220371
     C                     PARM '*FREE  ' @OPTN                                               220371
     C           SDGELR    PARM SDGELR    DSSDY                                               220371
0831 C**
      ** Set Date                                                                             CSD031
      *                                                                                       CSD031
     C                     MOVE BJDNWD    ZDAYNO                                              CSD031
     C                     EXSR SRDAT2                                                        CSD031
     C                     MOVE ZADATE    WDATE                                               CSD031
      *                                                                                       CSD031
     C** READ GENERAL LEDGER DETAILS VIA ACCESS PROGRAM                   082749
     C** IF NOT FOUND, OUTPUT ERROR MESSAGE TO SCREEN                     082749
     C**********           CALL 'AOGELRR0'                                082749              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       082749
     C                     PARM '*FIRST ' @OPTN   7                       082749
     C********** SDGELR    PARM SDGELR    DSFDY                           082749              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    082749
0425 C**********           MOVE ERRMSG,1  ERMSG                                        082749 CSD031
     C                     MOVELERRMSG,1  ERMSG     P                                         CSD031
0426 C                     SETON                     428182               082749
0427 C                     SETOF                     8384                 082749
0428 C                     GOTO SCNOUT                                    082749
     C                     END                                            082749
      *                                                                                       CGL014
      ** Check if Collaterals Processing (CGL014) is switched on                              CGL014
      *                                                                                       CGL014
     C                     CALL 'AOSARDR0'                                                    CGL014
     C                     PARM *BLANKS   PRTCD   7                                           CGL014
     C                     PARM '*VERIFY' POPTN   7                                           CGL014
     C                     PARM 'CGL014'  PSARD   6                                           CGL014
     C           SCSARD    PARM SCSARD    DSSDY                                               CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ *BLANKS                                                       CGL014
     C                     MOVE 'Y'       CGL014  1                                           CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE 'N'       CGL014                                              CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       249490
      ** Check if CLE106 is installed.                                                        249490
      *                                                                                       249490
     C                     CALL 'AOSARDR0'                                                    249490
     C                     PARM *BLANKS   PRTCD                                               249490
     C                     PARM '*VERIFY' POPTN                                               249490
     C                     PARM 'CLE106'  PSARD                                               249490
      *                                                                                       249490
     C           PRTCD     IFEQ *BLANKS                                                       249490
     C                     MOVE 'Y'       CLE106  1                                           249490
     C                     ELSE                                                               249490
     C                     MOVE 'N'       CLE106                                              249490
     C                     ENDIF                                                              249490
      *                                                                                       CER049
      ** Check if CER049 is installed.                                                        CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   PRTCD                                               CER049
     C                     PARM '*VERIFY' POPTN                                               CER049
     C                     PARM 'CER049'  PSARD                                               CER049
      *                                                                                       CER049
     C           PRTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049  1                                           CER049
     C                     ELSE                                                               CER049
     C                     MOVE 'N'       CER049                                              CER049
     C                     ENDIF                                                              CER049
     C**                                                                  082749
0832 C                     ENDSR
0833 C**
0834 C**
0835 C********************************************************************
     C*
     C*   ZTNLU1 SR. - TO LOCK THE TRANSACTION NUMBER DATA AREA AND
     C*                THEN UPDATE AND RELEASE THE DATA AREA.
     C*
     C           ZTNLU1    BEGSR
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C                     ENDSR
     C*****************************************************************
     C**   FILE EXCEPTION / ERROR HANDLING SUBROUTINE
     C           INFSR     BEGSR
     C**   CHECK ERROR TYPE
     C           STATUS    IFEQ 01021
     C**   CHAIN FILE TO GET CURRENT DETAILS
     C           ACKKEY    CHAINACKEY                69
     C**
     C           *IN69     IFEQ '0'
     C**   ROLLBACK UPDATES ALREADY DONE
     C                     ROLBK
     C**   SET ON 'RECORD UPDATED BY ANOTHER WORKSTATION' INDICATOR
     C                     SETON                     79
     C**   RESET OTHER INDICATORS
     C                     SETOF                     457172
     C                     SETOF                     73
     C**
     C                     MOVE '*DETC '  EXTTAG  6
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C/COPY WNCPYSRC,SD0050C025
     C                     ENDSREXTTAG
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      ** SDACHN - Check if account key exists from the acceptance file*                       CSD031
      *****************************************************************                       CSD031
     C           SDACHN    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     SETON                     73                                       CSD031
     C           ACTCD     IFEQ 'A'                                                           CSD031
     C           ACTCD     OREQ 'D'                                                           CSD031
     C           SAKEY     CHAINSDAAKYL0             73                                       CSD031
     C           *IN73     IFEQ *OFF                                                          CSD031
     C                     SETON                     20                                       CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      ** SRSDTQ - Subroutine to send data to data queue               *                       CSD031
      *****************************************************************                       CSD031
     C           SRSDTQ    BEGSR                                                              CSD031
      *                                                                                       CSD031
      ** Clear fields to data queue file                                                      CSD031
      *                                                                                       CSD031
     C                     MOVE *BLANKS   CHTP                                                CSD031
     C                     Z-ADD0         ACD1QQ                                              CSD031
     C                     Z-ADD0         ACD2QQ                                              CSD031
     C                     Z-ADD0         ACD3QQ                                              CSD031
     C                     Z-ADD0         ACD4QQ                                              CSD031
     C                     Z-ADD0         ACD5QQ                                              CSD031
     C                     Z-ADD0         ACD6QQ                                              CSD031
     C                     MOVE *BLANKS   NCD1                                                CSD031
     C                     MOVE *BLANKS   NCD2                                                CSD031
     C                     MOVE *BLANKS   NCD3                                                CSD031
     C                     MOVE *BLANKS   NCD4                                                CSD031
     C                     MOVE *BLANKS   NCD5                                                CSD031
     C                     MOVE *BLANKS   NCD6                                                CSD031
     C                     Z-ADD0         PRF1                                                CSD031
     C                     Z-ADD0         PRF2                                                CSD031
     C                     Z-ADD0         PRF3                                                CSD031
     C                     Z-ADD0         PRF4                                                CSD031
     C                     Z-ADD0         PRF5                                                CSD031
     C                     Z-ADD0         PRF6                                                CSD031
     C                     Z-ADD0         EACC                                                CSD031
      *                                                                                       CSD031
      ** Move fields to data queue file                                                       CSD031
      *                                                                                       CSD031
     C                     EXSR SRMVDQ                                                        CSD031
      *                                                                                       CSD031
     C           'GP'      CAT  'AKEYPD'  WPFNAM                                              CSD031
     C                     MOVELSAKEY     WKEYS                                               CSD031
     C                     MOVEL@1DBRC    WDATA                                               CSD031
     C                     MOVELWDTQ      PDQMSG                                              CSD031
     C           'SD'      CAT  'ACCPDTQ' PDQNAM                                              CSD031
      *                                                                                       CSD031
     C           *LOVAL    SETLLGPZONEL0                                                      CSD031
     C                     READ GPZONEL0                 90                                   CSD031
     C           *IN90     DOWEQ*OFF                                                          CSD031
     C           ZOMSYS    CAT  'DPLIB'   PDQLIB                                              CSD031
     C********** ZOMSYS    CAT  PGMB      PGMNAM 16                                    CSD031 CSC043
     C           ZOMSYS    CAT  PGMB      PGMNAM 17                                           CSC043
     C                     CALL PGMNAM                                                        CSD031
     C                     PARM           PDQNAM 10                                           CSD031
     C                     PARM           PDQLIB 10                                           CSD031
     C                     PARM           PDQMSG                                              CSD031
     C                     READ GPZONEL0                 90                                   CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      ** SRMVDQ - Move fields to data queue                           *                       CSD031
      *****************************************************************                       CSD031
     C           SRMVDQ    BEGSR                                                              CSD031
      *                                                                                       CSD031
      ** Move fields to data queue file                                                       CSD031
      *                                                                                       CSD031
     C                     MOVE 'D'       RECI2                                               CSD031
     C                     MOVE SAKEY     AKEY2                                               CSD031
     C                     MOVELBJRDNB    LCD2                                                CSD031
     C                     MOVE ACTCD     CHTP2                                               CSD031
     C                     MOVE TNLU      TNLU2                                               CSD031
     C                     MOVE ZONE      ZONE2                                               CSD031
      *                                                                                       CSD031
     C           '0000'    CAT  '000000'  WNULL  10                                           CSD031
     C           SACD,1    IFEQ WNULL                                                         CSD031
     C                     Z-ADD0         ACD1                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE SACD,1    ACD1                                                CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           SACD,2    IFEQ WNULL                                                         CSD031
     C                     Z-ADD0         ACD2                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE SACD,2    ACD2                                                CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           SACD,3    IFEQ WNULL                                                         CSD031
     C                     Z-ADD0         ACD3                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE SACD,3    ACD3                                                CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      *                                                                                       CSD031
     C           SACD,4    IFEQ WNULL                                                         CSD031
     C                     Z-ADD0         ACD4                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE SACD,4    ACD4                                                CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           SACD,5    IFEQ WNULL                                                         CSD031
     C                     Z-ADD0         ACD5                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE SACD,5    ACD5                                                CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           SACD,6    IFEQ WNULL                                                         CSD031
     C                     Z-ADD0         ACD6                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE SACD,6    ACD6                                                CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE SNCD,1    NCD1                                                CSD031
     C                     MOVE SNCD,2    NCD2                                                CSD031
     C                     MOVE SNCD,3    NCD3                                                CSD031
     C                     MOVE SNCD,4    NCD4                                                CSD031
     C                     MOVE SNCD,5    NCD5                                                CSD031
     C                     MOVE SNCD,6    NCD6                                                CSD031
      *                                                                                       CSD031
     C                     MOVE SPRF,1    PRF1                                                CSD031
     C                     MOVE SPRF,2    PRF2                                                CSD031
     C                     MOVE SPRF,3    PRF3                                                CSD031
     C                     MOVE SPRF,4    PRF4                                                CSD031
     C                     MOVE SPRF,5    PRF5                                                CSD031
     C                     MOVE SPRF,6    PRF6                                                CSD031
      *                                                                                       CSD031
     C                     MOVE SZONE     AACC2                                               CSD031
     C           SEFFDT    IFEQ *BLANKS                                                       CSD031
     C                     Z-ADD0         EACC                                                CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE SEFFDT    ZDATE                                               CSD031
     C                     EXSR SRDATE                                                        CSD031
     C                     MOVE ZDAYNO    EACC                                                CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE 'Y'       GPDT                                                CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      ** SRDATE - Validate Effective Date                             *                       CSD031
      *****************************************************************                       CSD031
     C           SRDATE    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     CALL 'ZDATE1'                                                      CSD031
     C                     PARM *BLANKS   ZERR    7                                           CSD031
     C                     PARM           ZDATE   60                                          CSD031
     C                     PARM           BJDFIN                                              CSD031
     C                     PARM           ZDAYNO  50                                          CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRDAT2 - SR TO CONVERT DATE FOR DAY NUMBER TO SCREEN FORMAT  *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRDAT2    BEGSR                                                              CSD031
     C                     CALL 'ZDATE2'                                                      CSD031
     C                     PARM           ZDAYNO                                              CSD031
     C                     PARM           BJDFIN                                              CSD031
     C                     PARM           ZDATE                                               CSD031
     C                     PARM           ZADATE  7                                           CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      ** SRRTTX - Retrieve text for error message                     *                       CSD031
      *****************************************************************                       CSD031
     C           SRRTTX    BEGSR                                                              CSD031
     C                     CALL 'SDRTVTXT'                                                    CSD031
     C           MSGNO     PARM MSGNO     MSGDNB  7                                           CSD031
     C           MSGF      PARM MSGF      MSGFLE 10                                           CSD031
     C           WUMTXT    PARM WUMTXT    MSGTXT 80                                           CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      ** SRBLSF - Initialise and build subfile                        *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
     C           SRBLSF    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVEL'N'       #EXIT   1                                           CSD031
     C                     MOVE 'N'       REFR    1                                           CSD031
     C                     MOVEL'N'       WERR    1                                           CSD031
     C                     MOVE *BLANKS   WPOSN  10                                           CSD031
     C                     MOVE *BLANKS   DPOSTO                                              CSD031
     C                     MOVE *OFF      *IN58                                               CSD031
      *                                                                                       CSD031
      ** Clear subfile                                                                        CSD031
      *                                                                                       CSD031
     C           *IN58     IFEQ *OFF                                                          CSD031
     C           WERR      ANDEQ'N'                                                           CSD031
     C                     EXSR SRCLR                                                         CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Load subfile                                                                         CSD031
      *                                                                                       CSD031
     C           WERR      IFEQ 'N'                                                           CSD031
     C                     EXSR SRLDSF                                                        CSD031
     C                     ENDIF                                                              CSD031
     C           #EXIT     DOWEQ'N'                                                           CSD031
      *                                                                                       CSD031
      ** set up message for no record                                                         CSD031
      *                                                                                       CSD031
     C           #NOREC    IFEQ 'Y'                                                           CSD031
     C                     MOVE *OFF      *IN11                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE *ON       *IN11                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Display subfile screen                                                               CSD031
      *                                                                                       CSD031
     C                     MOVE DPOSTO    WPOSN                                               CSD031
     C                     EXSR SRDISP                                                        CSD031
      *                                                                                       CSD031
      ** Process response                                                                     CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           *INKC     WHEQ *ON                                                           CSD031
     C           *INKK     OREQ *ON                                                           CSD031
     C                     MOVE 'Y'       #EXIT                                               CSD031
      *                                                                                       CSD031
     C           *INKL     WHEQ *ON                                                           CSD031
     C                     SETOF                     17                                       CSD031
     C                     MOVE 'Y'       #EXIT                                               CSD031
      *                                                                                       CSD031
      ** Rollup:Rolldown                                                                      CSD031
      *                                                                                       CSD031
     C           *IN58     WHEQ *ON                                                           CSD031
     C           WERR      IFEQ 'N'                                                           CSD031
     C                     EXSR SRLDSF                                                        CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     OTHER                                                              CSD031
     C           DPOSTO    IFNE WPOSN                                                         CSD031
     C                     MOVE 'Y'       REFR                                                CSD031
     C                     ELSE                                                               CSD031
     C           #NOREC    IFEQ 'N'                                                           CSD031
     C                     MOVE @@RRN     @SRRN                                               CSD031
     C                     EXSR SRSFPR                                                        CSD031
     C                     MOVE @SRRN     @@RRN                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSL                                                              CSD031
      *                                                                                       CSD031
      ** Request for Subfile Refresh                                                          CSD031
      *                                                                                       CSD031
     C           REFR      IFEQ 'Y'                                                           CSD031
     C                     MOVE 'N'       REFR                                                CSD031
     C                     EXSR SRCLR                                                         CSD031
     C                     EXSR SRLDSF                                                        CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      ** SRCLR  - Subroutine to clear subfile                         *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRCLR     BEGSR                                                              CSD031
      *                                                                                       CSD031
      ** Clear subfile                                                                        CSD031
      *                                                                                       CSD031
     C                     SETOF                     5911                                     CSD031
     C                     WRITESD0050C1                                                      CSD031
     C                     SETON                     5911                                     CSD031
      *                                                                                       CSD031
      ** Reset number of records in subfile                                                   CSD031
      *                                                                                       CSD031
     C                     Z-ADD*ZERO     @@RRN                                               CSD031
     C           DPOSTO    IFEQ *BLANKS                                                       CSD031
     C           *LOVAL    SETLLSDAAKYL1                                                      CSD031
     C                     ELSE                                                               CSD031
     C           DPOSTO    SETLLSDAAKYL1                                                      CSD031
     C                     ENDIF                                                              CSD031
     C                     READ SDAAKYL1                 12                                   CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      ** SRLDSF - Subroutine to load subfile                          *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRLDSF    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE 'Y'       #NOREC  1                                           CSD031
     C                     Z-ADD0         WSFRRN  20                                          CSD031
     C           *IN12     DOWEQ*OFF                                                          CSD031
     C           WSFRRN    ANDLT16                                                            CSD031
     C                     MOVE 'N'       #NOREC                                              CSD031
      *                                                                                       CSD031
      ** Move record to screen                                                                CSD031
      *                                                                                       CSD031
     C                     MOVE AKEY      SAKEY                                               CSD031
     C                     Z-ADD*ZEROS    DEFFDH                                              CSD031
     C                     MOVE *BLANKS   DEFFDT                                              CSD031
     C           EACC      IFNE 0                                                             CSD031
     C                     MOVE EACC      ZDAYNO                                              CSD031
     C                     EXSR SRDAT2                                                        CSD031
     C                     MOVE ZADATE    DEFFDT                                              CSD031
     C                     MOVE ZDATE     DEFFDH                                              CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
     C           CHTP      WHEQ 'A'                                                           CSD031
     C                     MOVEL'AMEND '  DACTN                                               CSD031
     C           CHTP      WHEQ 'D'                                                           CSD031
     C                     MOVEL'DELETE'  DACTN                                               CSD031
     C           CHTP      WHEQ 'I'                                                           CSD031
     C                     MOVEL'INSERT'  DACTN                                               CSD031
     C                     OTHER                                                              CSD031
     C                     MOVE *BLANKS   DACTN                                               CSD031
     C                     ENDSL                                                              CSD031
     C                     MOVE *BLANKS   DOPT                                                CSD031
     C                     MOVE *OFF      *IN10                                               CSD031
     C                     MOVE *OFF      *IN17                                               CSD031
      *                                                                                       CSD031
     C                     ADD  1         WSFRRN                                              CSD031
     C                     ADD  1         @@RRN                                               CSD031
     C                     WRITESD0050S1                                                      CSD031
     C                     READ SDAAKYL1                 12                                   CSD031
      *                                                                                       CSD031
     C                     ENDDO                                                              CSD031
     C                     MOVE @@RRN     @@RRN1                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      ** SRDISP - Subroutine to display subfile screen                *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
     C           SRDISP    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     EXSR TIME                                                          CSD031
      *                                                                                       CSD031
     C                     MOVE *BLANKS   DPOSTO                                            BUG11835
      *                                                                                     BUG11835
      ** Clear Review from field,unknown values were displayed on screen                    BUG11835
      *                                                                                     BUG11835
     C                     WRITE#MSGCTL                                                       CSD031
     C                     WRITESD0050F2                                                      CSD031
     C                     EXFMTSD0050C1                                                      CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRSFPR - Subroutine for subfile processing                   *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRSFPR    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE 'N'       ERRF    1                                           CSD031
     C                     EXSR SRSCHK                                                        CSD031
     C           ERRF      IFEQ 'N'                                                           CSD031
     C                     EXSR SRSEXC                                                        CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRSCHK - Validate Action Taken                               *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRSCHK    BEGSR                                                              CSD031
      *                                                                                       CSD031
      ** Clear messages from program message queue                                            CSD031
      *                                                                                       CSD031
     C                     CALL 'Y2CLMSC'                                                     CSD031
     C                     PARM ##PGM     ZAPGMQ 10                                           CSD031
     C                     PARM '*SAME'   ZAPGRL  5                                           CSD031
     C                     Z-ADD@#SFRC    @@RRN1                                              CSD031
      *                                                                                       CSD031
     C                     READCSD0050S1                 85                                   CSD031
     C           *IN85     DOWEQ*OFF                                                          CSD031
     C                     MOVE *OFF      *IN10                                               CSD031
     C                     MOVE *OFF      *IN17                                               CSD031
     C           DOPT      IFNE ' '                                                           CSD031
     C           DOPT      IFNE 'D'                                                           CSD031
     C           DOPT      ANDNE'E'                                                           CSD031
     C           DOPT      ANDNE'X'                                                           CSD031
     C           ERRF      IFEQ 'N'                                                           CSD031
     C                     MOVE 'Y'       ERRF                                                CSD031
     C                     MOVE @@RRN     @@RRN1                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVEL'ASM0002' ZAMSID                                              CSD031
     C                     EXSR ZASNMS                                                        CSD031
     C                     MOVE *ON       *IN17                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE *ON       *IN10                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     UPDATSD0050S1                                                      CSD031
     C                     READCSD0050S1                 85                                   CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRSEXC - Execute Action Taken                                *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRSEXC    BEGSR                                                              CSD031
      *                                                                                       CSD031
      ** Clear messages from program message queue                                            CSD031
      *                                                                                       CSD031
     C                     CALL 'Y2CLMSC'                                                     CSD031
     C                     PARM ##PGM     ZAPGMQ 10                                           CSD031
     C                     PARM '*SAME'   ZAPGRL  5                                           CSD031
      *                                                                                       CSD031
     C******     1         CHAINSD0050S1             85                                       CSD031
     C                     READCSD0050S1                 85                                   CSD031
     C           *IN85     DOWEQ*OFF                                                          CSD031
     C                     MOVE *OFF      *IN10                                               CSD031
     C                     MOVE *OFF      *IN17                                               CSD031
     C                     SELEC                                                              CSD031
     C           DOPT      WHEQ 'D'                                                           CSD031
     C                     EXSR SRPRDL                                                        CSD031
     C           DOPT      WHEQ 'E'                                                           CSD031
     C                     EXSR SRPREN                                                        CSD031
     C                     MOVE @@RRN     @@RRN1                                              CSD031
     C           DOPT      WHEQ 'X'                                                           CSD031
     C                     EXSR SRPRAC                                                        CSD031
     C                     ENDSL                                                              CSD031
     C                     UPDATSD0050S1                                                      CSD031
     C                     READCSD0050S1                 85                                   CSD031
     C                     ENDDO                                                              CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRPRAC - Subroutine to process Accept Central Data           *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRPRAC    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     SETOF                     616263                                 BUG12492
      *                                                                                     BUG12492
     C           DACTN     IFNE 'DELETE'                                                    BUG12492
     C                     EXSR SRPREN                                                      BUG12492
     C                     ENDIF                                                            BUG12492
      *                                                                                     BUG12492
     C           REFR      IFEQ 'N'                                                           CSD031
     C                     MOVE 'Y'       REFR                                                CSD031
     C                     ENDIF                                                              CSD031
     C           *IN61     IFEQ *OFF                                                        BUG12492
     C           *IN62     ANDEQ*OFF                                                        BUG12492
     C           *IN63     ANDEQ*OFF                                                        BUG12492
     C           *INKL     ANDEQ*OFF                                                        BUG12492
     C                     Z-ADDRUND      LCD                                                 CSD031
     C                     EXSR SRUPDT                                                        CSD031
     C           SAKEY     CHAINSDAAKYL0             85                                       CSD031
     C           *IN85     IFEQ *OFF                                                          CSD031
     C                     DELETACKEYAL1                                                      CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                            BUG12492
      *                                                                                     BUG12492
     C                     MOVEA'000000'  *IN,46                                            BUG12492
     C                     MOVEA'000000'  *IN,90                                            BUG12492
     C                     MOVEA'000'     *IN,61                                            BUG12492
     C                     MOVE *OFF      *IN65                                             BUG12492
     C                     MOVE *OFF      *IN70                                             BUG12492
     C                     MOVE *OFF      *IN74                                             BUG12492
     C                     MOVE *OFF      *IN75                                             BUG12492
     C                     MOVE *OFF      *IN77                                             BUG12492
     C                     MOVE *OFF      *IN78                                             BUG12492
     C                     MOVE *ON       *IN83                                             BUG12492
     C                     MOVE *BLANKS   ERCE                                              BUG12492
     C                     MOVE *BLANKS   ERCD2                                             BUG12492
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRMVSC - Move file fields to screen fields                   *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRMVSC    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C           *IN12     IFEQ *OFF                                                          CSD031
     C                     MOVE AKEY      LSTREC 14                                           CSD031
     C                     ENDIF                                                              CSD031
     C           SAKEY     CHAINSDAAKYL1             10                                       CSD031
     C           *IN10     IFEQ *OFF                                                          CSD031
     C                     MOVE CHTP      ACTN                                                CSD031
      *                                                                                       CSD031
     C           ACD1      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD1                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELACD1      SACD1                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD2      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD2                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELACD2      SACD2                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD3      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD3                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELACD3      SACD3                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD4      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD4                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELACD4      SACD4                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD5      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD5                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELACD5      SACD5                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           ACD6      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SACD6                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELACD6      SACD6                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           NCD1      IFEQ *BLANKS                                                       CSD031
     C                     MOVE *BLANKS   SNCD1                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELNCD1      SNCD1                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           NCD2      IFEQ *BLANKS                                                       CSD031
     C                     MOVE *BLANKS   SNCD2                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELNCD2      SNCD2                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           NCD3      IFEQ *BLANKS                                                       CSD031
     C                     MOVE *BLANKS   SNCD3                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELNCD3      SNCD3                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           NCD4      IFEQ *BLANKS                                                       CSD031
     C                     MOVE *BLANKS   SNCD4                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELNCD4      SNCD4                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           NCD5      IFEQ *BLANKS                                                       CSD031
     C                     MOVE *BLANKS   SNCD5                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELNCD5      SNCD5                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           NCD5      IFEQ *BLANKS                                                       CSD031
     C                     MOVE *BLANKS   SNCD6                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELNCD6      SNCD6                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRF1      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF1                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELPRF1      SPRF1                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRF2      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF2                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELPRF2      SPRF2                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRF3      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF3                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELPRF3      SPRF3                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRF4      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF4                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELPRF4      SPRF4                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRF5      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF5                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELPRF5      SPRF5                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C           PRF6      IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SPRF6                                               CSD031
     C                     ELSE                                                               CSD031
     C                     MOVELPRF6      SPRF6                                               CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     MOVE GPDT      SZONE1                                              CSD031
      *                                                                                       CSD031
     C           DEFFDH    IFEQ 0                                                             CSD031
     C                     MOVE *BLANKS   SEFFDT                                              CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE DEFFDH    SEFFDT                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     ENDIF                                                              CSD031
     C           *IN12     IFEQ *OFF                                                          CSD031
     C           LSTREC    CHAINSDAAKYL1             12                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRPRDL - Process deletion                                    *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
     C           SRPRDL    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C                     EXSR SRMVSC                                                        CSD031
      *                                                                                       CSD031
     C                     MOVE *OFF      *INKL                                               CSD031
     C           *INKC     DOWEQ*OFF                                                          CSD031
     C           *INKL     ANDEQ*OFF                                                          CSD031
      *                                                                                       CSD031
     C                     EXSR TIME                                                          CSD031
     C                     EXFMTSD0050F3                                                      CSD031
     C           *INKJ     IFEQ *ON                                                           CSD031
     C           REFR      IFEQ 'N'                                                           CSD031
     C                     MOVE 'Y'       REFR                                                CSD031
     C                     ENDIF                                                              CSD031
     C           SAKEY     CHAINSDAAKYL0             85                                       CSD031
     C           *IN85     IFEQ *OFF                                                          CSD031
     C                     DELETACKEYAL1                                                      CSD031
     C                     ENDIF                                                              CSD031
     C                     LEAVE                                                              CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE *BLANKS   DOPT                                                CSD031
      *                                                                                       CSD031
     C                     ENDDO                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRUPDT - Update Acceptance file                              *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRUPDT    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C**********           MOVELSAKEY     WACKEY 12                                  CSD031 BUG11700
     C                     MOVELSAKEY     WACKEY 14                                         BUG11700
     C           WACKEY    CHAINACKEY                85                                       CSD031
     C           *IN85     IFEQ *ON                                                           CSD031
     C                     MOVE 'I'       WCHTP   1                                           CSD031
     C                     ELSE                                                               CSD031
     C                     MOVE 'A'       WCHTP                                               CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE RECI      WRECI   1                                           CSD031
      *                                                                                       CSD031
     C           SAKEY     CHAINSDAAKYL0             85                                       CSD031
     C           CHTP      IFEQ 'I'                                                           CSD031
     C           CHTP      OREQ 'A'                                                           CSD031
     C           CHTP      OREQ 'D'                                                           CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
      *                                                                                       CSD031
      ** Insert record                                                                        CSD031
      *                                                                                       CSD031
     C           CHTP      WHEQ 'I'                                                           CSD031
     C           WCHTP     ANDEQ'I'                                                           CSD031
     C           CHTP      OREQ 'A'                                                           CSD031
     C           WCHTP     ANDEQ'I'                                                           CSD031
     C                     MOVE 'I'       CHTP                                                CSD031
     C                     MOVE *ON       *IN02                                               CSD031
     C                     MOVE *ON       *IN69                                               CSD031
      *                                                                                       CSD031
      ** Amend record                                                                         CSD031
      *                                                                                       CSD031
     C           CHTP      WHEQ 'A'                                                           CSD031
     C           WCHTP     ANDEQ'A'                                                           CSD031
     C           CHTP      OREQ 'I'                                                           CSD031
     C           WCHTP     ANDEQ'A'                                                           CSD031
     C                     MOVE 'A'       CHTP                                                CSD031
     C                     MOVE *ON       *IN03                                               CSD031
     C                     MOVE *ON       *IN02                                               CSD031
      *                                                                                       CSD031
      ** Amend record                                                                         CSD031
      *                                                                                       CSD031
     C           CHTP      WHEQ 'D'                                                           CSD031
     C           WCHTP     ANDEQ'A'                                                           CSD031
     C                     MOVE *ON       *IN04                                               CSD031
     C                     ENDSL                                                              CSD031
      *                                                                                       CSD031
      ** Move to screen fields                                                                CSD031
      *                                                                                       CSD031
     C                     MOVE ACD1      SACD,1                                              CSD031
     C                     MOVE NCD1      SNCD,1                                              CSD031
     C                     MOVE PRF1      SPRF,1                                              CSD031
     C                     MOVE ACD2      SACD,2                                              CSD031
     C                     MOVE NCD2      SNCD,2                                              CSD031
     C                     MOVE PRF2      SPRF,2                                              CSD031
     C                     MOVE ACD3      SACD,3                                              CSD031
     C                     MOVE NCD3      SNCD,3                                              CSD031
     C                     MOVE PRF3      SPRF,3                                              CSD031
     C                     MOVE ACD4      SACD,4                                              CSD031
     C                     MOVE NCD4      SNCD,4                                              CSD031
     C                     MOVE PRF4      SPRF,4                                              CSD031
     C                     MOVE ACD5      SACD,5                                              CSD031
     C                     MOVE NCD5      SNCD,5                                              CSD031
     C                     MOVE PRF5      SPRF,5                                              CSD031
     C                     MOVE ACD6      SACD,6                                              CSD031
     C                     MOVE NCD6      SNCD,6                                              CSD031
     C                     MOVE PRF6      SPRF,6                                              CSD031
      *                                                                                       CSD031
      ** Check if record exist in header file                                                 CSD031
      *                                                                                       CSD031
     C                     MOVELSAKEY     ACKKEY                                              CSD031
     C                     MOVE CHTP      ACTCD                                               CSD031
     C                     MOVE *OFF      *IN06                                               CSD031
     C                     Z-ADDRUND      EACC1                                               CSD031
     C                     Z-ADDRUND      EACC                                                CSD031
     C                     MOVELAACC      SZONE                                               CSD031
     C                     MOVE 'Y'       SCDTA   1                                           CSD031
      *                                                                                       CSD031
     C           *IN04     IFEQ *OFF                                                          CSD031
      *                                                                                       CSD031
      **  Obtain last transaction number and set up standard output                           CSD031
      **  information                                                                         CSD031
      *                                                                                       CSD031
     C                     EXSR ZTNLU1                                                        CSD031
     C                     MOVE 'SD'      MDID    2                                           CSD031
     C                     MOVEL'SD0050'  PGMN    8                                           CSD031
     C                     MOVE WSID      WSIDX   3                                           CSD031
     C                     MOVE USRID     USRIDX 10                                           CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Update header record                                                                 CSD031
      *                                                                                       CSD031
     C                     MOVE *ON       *IN71                                               CSD031
     C                     EXSR TIME                                                          CSD031
     C                     EXSR EXCPTN                                                        CSD031
      *                                                                                       CSD031
      ** Get account keys header record ready for update.                                     CSD031
      *                                                                                       CSD031
     C                     MOVE *OFF      *IN06                                               CSD031
     C                     MOVE BLANKS    ACKKEY                                              CSD031
     C           ACKKEY    CHAINACKEY                69                                       CSD031
      *                                                                                       CSD031
      ** If header not found, database error.                                                 CSD031
      *                                                                                       CSD031
     C           *IN06     IFEQ *OFF                                                          CSD031
     C                     MOVE *ON       *INU8                                               CSD031
     C                     EXSR DSERR                                                         CSD031
     C                     GOTO ENDUP1                                                        CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
      ** Increment no. & type of updates.                                                     CSD031
      *                                                                                       CSD031
     C                     SELEC                                                              CSD031
      *                                                                                       CSD031
      ** Insert Trailer                                                                       CSD031
      *                                                                                       CSD031
     C           CHTP      WHEQ 'I'                                                           CSD031
     C           WCHTP     ANDEQ'I'                                                           CSD031
     C           CHTP      OREQ 'A'                                                           CSD031
     C           WCHTP     ANDEQ'I'                                                           CSD031
     C           CHTP      OREQ 'A'                                                           CSD031
     C           WRECI     ANDEQ'*'                                                           CSD031
     C                     ADD  1         NINS                                                CSD031
     C                     ADD  1         NREC1                                               CSD031
      *                                                                                       CSD031
      ** Amend Trailer                                                                        CSD031
      *                                                                                       CSD031
     C           CHTP      WHEQ 'A'                                                           CSD031
     C           WCHTP     ANDEQ'A'                                                           CSD031
     C           CHTP      OREQ 'I'                                                           CSD031
     C           WCHTP     ANDEQ'A'                                                           CSD031
     C           NAMD      ADD  1         NAMD                                                CSD031
      *                                                                                       CSD031
      ** Delete Trailer                                                                       CSD031
      *                                                                                       CSD031
     C           CHTP      WHEQ 'D'                                                           CSD031
     C           WCHTP     ANDEQ'A'                                                           CSD031
     C           NDEL      ADD  1         NDEL                                                CSD031
     C                     SUB  1         NREC1                                               CSD031
     C                     ENDSL                                                              CSD031
      *                                                                                       CSD031
      ** Update A/C Key header detail                                                         CSD031
      *                                                                                       CSD031
     C                     MOVE *ON       *IN72                                               CSD031
     C                     EXSR TIME                                                          CSD031
     C                     EXSR EXCPTN                                                        CSD031
      *                                                                                       CSD031
     C                     ENDIF                                                              CSD031
      *                                                                                       CSD031
     C                     MOVEA'00'      *IN,71                                              CSD031
     C                     MOVEA'000'     *IN,02                                              CSD031
      *                                                                                       CSD031
     C           ENDUP1    TAG                                                                CSD031
      *                                                                                       CSD031
      ** End Commitment control                                                               CSD031
      *                                                                                       CSD031
     C           CMTTXT    COMIT                                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *                                                               *                       CSD031
      *  SRPREN - Process Enquiry                                     *                       CSD031
      *                                                               *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           SRPREN    BEGSR                                                              CSD031
     C           *IN12     IFEQ *OFF                                                          CSD031
     C                     MOVE AKEY      LSTREC 14                                           CSD031
     C                     ENDIF                                                              CSD031
     C                     EXSR SRMVSC                                                        CSD031
     C                     MOVE *OFF      *INKL                                               CSD031
     C                     SETON                     16                                     BUG12492
     C           *INKC     DOWEQ*OFF                                                          CSD031
     C           *INKL     ANDEQ*OFF                                                          CSD031
     C                     EXSR TIME                                                          CSD031
     C                     EXFMTSD0050F3                                                      CSD031
      *                                                                                     BUG12492
     C                     MOVEA'000000'  *IN,46                                            BUG12492
     C                     MOVEA'000000'  *IN,90                                            BUG12492
     C                     MOVEA'000'     *IN,61                                            BUG12492
     C                     MOVE *OFF      *IN65                                             BUG12492
     C                     MOVE *OFF      *IN70                                             BUG12492
     C                     MOVE *OFF      *IN74                                             BUG12492
     C                     MOVE *OFF      *IN75                                             BUG12492
     C                     MOVE *OFF      *IN77                                             BUG12492
     C                     MOVE *OFF      *IN78                                             BUG12492
     C                     MOVE *ON       *IN83                                             BUG12492
     C                     MOVE *BLANKS   ERCE                                              BUG12492
     C                     MOVE *BLANKS   ERCD2                                             BUG12492
     C           DOPT      IFEQ 'X'                                                         BUG12492
      *                                                                                     BUG12492
     C                     EXSR CHKACC                                                      BUG12492
      *                                                                                     BUG12492
     C           *IN61     IFEQ *OFF                                                        BUG12492
     C           *IN62     ANDEQ*OFF                                                        BUG12492
     C           *IN63     ANDEQ*OFF                                                        BUG12492
     C                     LEAVE                                                            BUG12492
     C                     ELSE                                                             BUG12492
     C                     MOVEAERCE      ERCD2                                             BUG12492
     C                     MOVE *OFF      *IN83                                             BUG12492
     C                     ENDIF                                                            BUG12492
     C                     ENDIF                                                            BUG12492
     C                     ENDDO                                                              CSD031
     C                     SETOF                     16                                     BUG12492
     C           *IN12     IFEQ *OFF                                                          CSD031
     C           LSTREC    CHAINSDAAKYL1             12                                       CSD031
     C                     ENDIF                                                              CSD031
     C                     MOVE *BLANKS   DOPT                                                CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *****************************************************************                     BUG12492
      /EJECT                                                                                BUG12492
      *****************************************************************                     BUG12492
      *                                                               *                     BUG12492
      *  CHKACC - Check Account                                       *                     BUG12492
      *                                                               *                     BUG12492
      *****************************************************************                     BUG12492
     C           CHKACC    BEGSR                                                            BUG12492
      *                                                                                     BUG12492
     C                     MOVE SACD1     SACD,1                                            BUG12492
     C                     MOVE SNCD1     SNCD,1                                            BUG12492
     C                     MOVE SPRF1     SPRF,1                                            BUG12492
     C                     MOVE SACD2     SACD,2                                            BUG12492
     C                     MOVE SNCD2     SNCD,2                                            BUG12492
     C                     MOVE SPRF2     SPRF,2                                            BUG12492
     C                     MOVE SACD3     SACD,3                                            BUG12492
     C                     MOVE SNCD3     SNCD,3                                            BUG12492
     C                     MOVE SPRF3     SPRF,3                                            BUG12492
     C                     MOVE SACD4     SACD,4                                            BUG12492
     C                     MOVE SNCD4     SNCD,4                                            BUG12492
     C                     MOVE SPRF4     SPRF,4                                            BUG12492
     C                     MOVE SACD5     SACD,5                                            BUG12492
     C                     MOVE SNCD5     SNCD,5                                            BUG12492
     C                     MOVE SPRF5     SPRF,5                                            BUG12492
     C                     MOVE SACD6     SACD,6                                            BUG12492
     C                     MOVE SNCD6     SNCD,6                                            BUG12492
     C                     MOVE SPRF6     SPRF,6                                            BUG12492
      *                                                                                     BUG12492
     C                     Z-ADD0         C                                                 BUG12492
     C                     Z-ADD0         S                                                 BUG12492
     C           CHECK2    TAG                                                              BUG12492
     C           C         ADD  1         C                                                 BUG12492
     C           C         MULT 3         ER                                                BUG12492
      *                                                                                     BUG12492
      ** Validate Account Codes - Optional                                                  BUG12492
      *                                                                                     BUG12492
     C           SACD,C    COMP '    '                   89                                 BUG12492
      *                                                                                     BUG12492
      ** Is Posting Reference 2                                                             BUG12492
      *                                                                                     BUG12492
     C           SPRF,C    COMP '2'                      64                                 BUG12492
     C   89                GOTO NARR2                                                       BUG12492
      *                                                                                     BUG12492
      ** Must not be entered if Posting Reference equals 2                                  BUG12492
      *                                                                                     BUG12492
     C   64                GOTO ACER2                                                       BUG12492
     C                     MOVE *ON       *IN13                                             BUG12492
     C                     MOVELSACD,C    PACOD                                             BUG12492
      *                                                                                     BUG12492
     C           PACOD     IFNE *BLANKS                                                     BUG12492
     C                     CALL 'AOACODR0'                                                  BUG12492
     C                     PARM *BLANKS   PRTCD                                             BUG12492
     C                     PARM '*KEY   ' POPTN                                             BUG12492
     C                     PARM           PACOD                                             BUG12492
     C           SDACOD    PARM SDACOD    DSSDY                                             BUG12492
      *                                                                                     BUG12492
     C           PRTCD     IFEQ '*NRF   '                                                   BUG12492
     C                     GOTO ACER2                                                       BUG12492
     C                     ENDIF                                                            BUG12492
     C  N13                GOTO ACER2                                                       BUG12492
      *                                                                                     BUG12492
      ** Account must not be Title-only                                                     BUG12492
      *                                                                                     BUG12492
     C           TITO      COMP 'Y'                  6767                                   BUG12492
     C                     ENDIF                                                            BUG12492
     C   67                GOTO NARR2                                                       BUG12492
      *                                                                                     BUG12492
     C           ACER2     TAG                                                              BUG12492
     C                     SETON                     61                                     BUG12492
     C           C         IFEQ 1                                                           BUG12492
     C                     SETON                     65                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 2                                                           BUG12492
     C                     SETON                     70                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 3                                                           BUG12492
     C                     SETON                     74                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 4                                                           BUG12492
     C                     SETON                     75                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 5                                                           BUG12492
     C                     SETON                     77                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 6                                                           BUG12492
     C                     SETON                     78                                     BUG12492
     C                     END                                                              BUG12492
     C           ER        ADD  3         ERR     30                                        BUG12492
     C           S         ADD  1         S                                                 BUG12492
     C                     MOVE ERR       ERCE,S                                            BUG12492
      *                                                                                     BUG12492
      ** Validate Narrative Code - Must be on Table file if                                 BUG12492
      ** related account code entered                                                       BUG12492
      ** If Posting Reference 2, must be entered                                            BUG12492
      ** Else if Account Code blank, must be blank                                          BUG12492
      *                                                                                     BUG12492
     C           NARR2     TAG                                                              BUG12492
     C           SNCD,C    COMP '  '                     88                                 BUG12492
     C   89N88N64                                                                           BUG12492
     COR 89 88 64          GOTO NARER2                                                      BUG12492
     C   89 88             GOTO POST2                                                       BUG12492
      *                                                                                     BUG12492
      ** Must be in range 01-50 or alphapetic-numeric combination 0A, A0, etc               BUG12492
      *                                                                                     BUG12492
     C                     MOVE SNCD,C    SNCDC                                             BUG12492
      *                                                                                     BUG12492
     C                     SETOF                     668687                                 BUG12492
     C           CGL014    IFEQ 'N'                                                         BUG12492
     C           NCDCH1    COMP '0'                  86  86                                 BUG12492
     C           NCDCH2    COMP '0'                  87  87                                 BUG12492
      *                                                                                     BUG12492
     C  N86N87             SETON                     66                                     BUG12492
     C   86 87   SNCDC     COMP '00'                   66                                   BUG12492
     C   86 87N66SNCDC     COMP '50'                 66                                     BUG12492
     C                     ELSE                                                             BUG12492
     C                     CALL 'AONARRR0'                                                  BUG12492
     C                     PARM *BLANKS   PRTCD                                             BUG12492
     C                     PARM '*KEY   ' POPTN                                             BUG12492
     C                     PARM SNCDC     PNCDC                                             BUG12492
     C           SDNARR    PARM SDNARR    DSFDY                                             BUG12492
     C           PRTCD     IFEQ '*NRF   '                                                   BUG12492
     C                     MOVE *ON       *IN66                                             BUG12492
     C                     ENDIF                                                            BUG12492
     C                     ENDIF                                                            BUG12492
     C   66                GOTO NARER2                                                      BUG12492
     C                     GOTO POST2                                                       BUG12492
      *                                                                                     BUG12492
     C           NARER2    TAG                                                              BUG12492
     C           C         IFEQ 1                                                           BUG12492
     C                     SETON                     46                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 2                                                           BUG12492
     C                     SETON                     47                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 3                                                           BUG12492
     C                     SETON                     48                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 4                                                           BUG12492
     C                     SETON                     49                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 5                                                           BUG12492
     C                     SETON                     50                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 6                                                           BUG12492
     C                     SETON                     51                                     BUG12492
     C                     END                                                              BUG12492
     C                     SETON                     62                                     BUG12492
     C           ER        ADD  4         ERR                                               BUG12492
     C           S         ADD  1         S                                                 BUG12492
     C                     MOVE ERR       ERCE,S                                            BUG12492
      *                                                                                     BUG12492
      ** Validate Posting Ref - Must be 1, 2 or 3 if related                                BUG12492
      ** Account Code entered, must be blank or 2 if A/C code blank                         BUG12492
      ** Entry of 5 allowed if letters or credit credit A/C key                             BUG12492
      ** Entry of '5' is allowed if Customer Lending A/C Key                                BUG12492
      *                                                                                     BUG12492
     C           POST2     TAG                                                              BUG12492
     C           SPRF,C    COMP ' '                      88                                 BUG12492
     C   89 64                                                                              BUG12492
     COR 89 88             GOTO PASS2                                                       BUG12492
      *                                                                                     BUG12492
      ** must be blank or 2 If A/C Code blank                                               BUG12492
      *                                                                                     BUG12492
     C   89N88             GOTO SPRER2                                                      BUG12492
     C           SPRF,C    COMP '1'                    89                                   BUG12492
     C  N89      SPRF,C    COMP '3'                  89                                     BUG12492
      *                                                                                     BUG12492
      ** Posting Reference 5 has been introduced for letters of                             BUG12492
      ** credit only. Posting Reference 4 is not used in the core                           BUG12492
      ** system at present                                                                  BUG12492
      *                                                                                     BUG12492
     C   89 68   SPRF,C    COMP '5'                  8989                                   BUG12492
     C   89 58   SPRF,C    COMP '4'                  8989                                   BUG12492
     C   89 58   SPRF,C    COMP '5'                  8989                                   BUG12492
      *                                                                                     BUG12492
      ** For accrual keys, if accrual key summary indicator is 'Y',                         BUG12492
      ** Posting Reference must be '1', else it must be '1' or '3'                          BUG12492
      *                                                                                     BUG12492
     C                     MOVELEVCOD     ACRID   2                                         BUG12492
     C                     MOVE EVSUB     ACRID                                             BUG12492
      *                                                                                     BUG12492
     C                     Z-ADD1         X       10                                        BUG12492
     C           ACRID     LOKUPACR,X                    85                                 BUG12492
      *                                                                                     BUG12492
     C           *IN85     IFEQ '1'                                                         BUG12492
      *                                                                                     BUG12492
     C           BKAKSI    IFEQ 'Y'                                                         BUG12492
     C           SPRF,C    ANDNE'1'                                                         BUG12492
     C                     SETON                     89                                     BUG12492
     C                     END                                                              BUG12492
     C           BKAKSI    IFEQ 'N'                                                         BUG12492
     C           SPRF,C    ANDEQ'2'                                                         BUG12492
     C                     SETON                     89                                     BUG12492
     C                     END                                                              BUG12492
      *                                                                                     BUG12492
     C                     END                                                              BUG12492
     C  N89                GOTO PASS2                                                       BUG12492
     C           SPRER2    TAG                                                              BUG12492
      *                                                                                     BUG12492
     C           C         IFEQ 1                                                           BUG12492
     C                     SETON                     90                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 2                                                           BUG12492
     C                     SETON                     91                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 3                                                           BUG12492
     C                     SETON                     92                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 4                                                           BUG12492
     C                     SETON                     93                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 5                                                           BUG12492
     C                     SETON                     94                                     BUG12492
     C                     END                                                              BUG12492
     C           C         IFEQ 6                                                           BUG12492
     C                     SETON                     95                                     BUG12492
     C                     END                                                              BUG12492
     C                     SETON                     63                                     BUG12492
     C           ER        ADD  5         ERR                                               BUG12492
     C           S         ADD  1         S                                                 BUG12492
     C                     MOVE ERR       ERCE,S                                            BUG12492
      *                                                                                     BUG12492
     C           PASS2     TAG                                                              BUG12492
     C           C         COMP 6                      89                                   BUG12492
     C   89                GOTO CHECK2                                                      BUG12492
      *                                                                                     BUG12492
     C                     ENDSR                                                            BUG12492
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      *  ZASNMS - Send Message to program's message queue             *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           ZASNMS    BEGSR                                                              CSD031
      *                                                                                       CSD031
     C           ZAPGMQ    IFEQ *BLANK                                                        CSD031
     C                     MOVEL##PGM     ZAPGMQ                                              CSD031
     C                     END                                                                CSD031
      * If no message file specified, use default                                             CSD031
     C           ZAMSGF    IFEQ *BLANK                                                        CSD031
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CSD031
     C                     END                                                                CSD031
     C                     CALL 'Y2SNMGC'                                                     CSD031
     C                     PARM           ZAPGMQ 10        Program queue                      CSD031
     C                     PARM           ZAPGRL  5        Rel queue                          CSD031
     C                     PARM           ZAMSID  7        Message ID                         CSD031
     C                     PARM           ZAMSGF 10        Message file                       CSD031
     C                     PARM           ZAMSDA132        Message data                       CSD031
     C                     PARM           ZAMSTP  7        Message type                       CSD031
      * Clear all fields for default mechanism next time                                      CSD031
     C                     MOVEL*BLANK    ZAPGMQ                                              CSD031
     C                     MOVEL*BLANK    ZAPGRL                                              CSD031
     C                     MOVEL*BLANK    ZAMSID                                              CSD031
     C                     MOVEL*BLANK    ZAMSGF                                              CSD031
     C                     MOVEL*BLANK    ZAMSDA                                              CSD031
     C                     MOVEL*BLANK    ZAMSTP                                              CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *                                                                                       CSD031
      *****************************************************************                       CSD031
      /EJECT                                                                                  CSD031
      *****************************************************************                       CSD031
      ** *PSSR  - Error control subroutine                            *                       CSD031
      *****************************************************************                       CSD031
      *                                                                                       CSD031
     C           *PSSR     BEGSR                           ** *PSSR **                        CSD031
      *                                                                                       CSD031
     C           @RUN      IFEQ *BLANKS                                                       CSD031
     C                     MOVE 'Y'       @RUN    1                                           CSD031
     C                     DUMP                                                               CSD031
     C                     END                                                                CSD031
      *                                                                                       CSD031
     C                     ENDSR                                                              CSD031
      *                                                                                       CSD031
      *                                                                                       CSD031
 671 C********************************************************************
0836 O**   OUTPUT TO WORK-STATION.
0837 O**
     O/COPY WNCPYSRC,SD0050O001
0838 OSD0050FMD        01N40
0839 O       OR        02N40
0840 O       OR        03N40
0841 O       OR        04N40
0842 O       OR        05N40
0843 O       OR        41
0844 O                                   K8 'SD0050F1'
0845 O**********               *IN56      1                                                   CSD031
0846 O**********               *IN80      2                                                   CSD031
0847 O**********               *IN20      3                                                   CSD031
0849 O**********               *IN81      4                                                   CSD031
0850 O**********               *IN65      5                                                   CSD031
0852 O**********               *IN82      6                                                   CSD031
     O                         *IN76      1                                                   CSD031
     O                         *IN96      2                                                   CSD031
     O                         *IN56      3                                                   CSD031
     O                         *IN80      4                                                   CSD031
     O                         *IN20      5                                                   CSD031
     O                         *IN81      6                                                   CSD031
     O                         *IN64      7                                                   CER049
     O**********               *IN65      7                                            CSD031 CER049
     O**********               *IN82      8                                            CSD031 CER049
     O                         *IN65      8                                                   CER049
     O                         *IN82      9                                                   CER049
     O/COPY WNCPYSRC,SD0050O003
0852 O**********               *IN46      7                                                   CSD031
0852 O**********               *IN90      8                                                   CSD031
0852 O**********               *IN70      9                                                   CSD031
0852 O**********               *IN47     10                                                   CSD031
0852 O**********               *IN91     11                                                   CSD031
0852 O**********               *IN74     12                                                   CSD031
0852 O**********               *IN48     13                                                   CSD031
0852 O**********               *IN92     14                                                   CSD031
0852 O**********               *IN75     15                                                   CSD031
0852 O**********               *IN49     16                                                   CSD031
0852 O**********               *IN93     17                                                   CSD031
0852 O**********               *IN77     18                                                   CSD031
0852 O**********               *IN50     19                                                   CSD031
0852 O**********               *IN94     20                                                   CSD031
0852 O**********               *IN78     21                                                   CSD031
0852 O**********               *IN51     22                                                   CSD031
0852 O**********               *IN95     23                                                   CSD031
0852 O**********               *IN83     24                                                   CSD031
0853 O**********               *IN84     25                                                   CSD031
0855 O**********               STID      27                                                   CSD031
     O**********               *IN46      9                                            CSD031 CER049
     O**********               *IN11     10                                            CSD031 CER049
     O**********               *IN90     11                                            CSD031 CER049
     O**********               *IN70     12                                            CSD031 CER049
     O**********               *IN47     13                                            CSD031 CER049
     O**********               *IN91     14                                            CSD031 CER049
     O**********               *IN74     15                                            CSD031 CER049
     O**********               *IN48     16                                            CSD031 CER049
     O**********               *IN92     17                                            CSD031 CER049
     O**********               *IN75     18                                            CSD031 CER049
     O**********               *IN49     19                                            CSD031 CER049
     O**********               *IN93     20                                            CSD031 CER049
     O**********               *IN77     21                                            CSD031 CER049
     O**********               *IN50     22                                            CSD031 CER049
     O**********               *IN94     23                                            CSD031 CER049
     O**********               *IN78     24                                            CSD031 CER049
     O**********               *IN51     25                                            CSD031 CER049
     O**********               *IN95     26                                            CSD031 CER049
     O**********               *IN18     27                                            CSD031 CER049
     O**********               *IN19     28                                            CSD031 CER049
     O**********               *IN10     29                                            CSD031 CER049
     O**********               *IN60     30                                            CSD031 CER049
     O**********               *IN83     31                                            CSD031 CER049
     O**********               *IN84     32                                            CSD031 CER049
     O**********               *IN54     33                                          BUG11450 CER049
     O                         *IN46     10                                                   CER049
     O                         *IN11     11                                                   CER049
     O                         *IN90     12                                                   CER049
     O                         *IN70     13                                                   CER049
     O                         *IN47     14                                                   CER049
     O                         *IN91     15                                                   CER049
     O                         *IN74     16                                                   CER049
     O                         *IN48     17                                                   CER049
     O                         *IN92     18                                                   CER049
     O                         *IN75     19                                                   CER049
     O                         *IN49     20                                                   CER049
     O                         *IN93     21                                                   CER049
     O                         *IN77     22                                                   CER049
     O                         *IN50     23                                                   CER049
     O                         *IN94     24                                                   CER049
     O                         *IN78     25                                                   CER049
     O                         *IN51     26                                                   CER049
     O                         *IN95     27                                                   CER049
     O                         *IN18     28                                                   CER049
     O                         *IN19     29                                                   CER049
     O                         *IN10     30                                                   CER049
     O                         *IN60     31                                                   CER049
     O                         *IN83     32                                                   CER049
     O                         *IN84     33                                                   CER049
     O                         *IN54     34                                                   CER049
     O**********               STID      34                                          CSD031 BUG11450
     O**********               STID      35                                          BUG11450 CER049
     O                         STID      36                                                   CER049
0856 O**********       01 52 80          27 'SI'                                              CSD031
0857 O**********       01 53 80          27 'SA'                                              CSD031
0858 O**********       01 54 80          27 'SD'                                              CSD031
0859 O**********       01 55 80          27 'SE'                                              CSD031
0860 O**********       41                27 'SF'                                              CSD031
     O**********       01 52 80          34 'SI'                                     CSD031 BUG11450
     O**********       01 53 80          34 'SA'                                     CSD031 BUG11450
     O**********       01 54 80          34 'SD'                                     CSD031 BUG11450
     O**********       01 55 80          34 'SE'                                     CSD031 BUG11450
     O**********       41                34 'SF'                                     CSD031 BUG11450
     O**********       01 52 80          35 'SI'                                     BUG11450 CER049
     O**********       01 53 80          35 'SA'                                     BUG11450 CER049
     O**********       01 54 80          35 'SD'                                     BUG11450 CER049
     O**********       01 55 80          35 'SE'                                     BUG11450 CER049
     O**********       41                35 'SF'                                     BUG11450 CER049
     O                 01 52 80          36 'SI'                                              CER049
     O                 01 53 80          36 'SA'                                              CER049
     O                 01 54 80          36 'SD'                                              CER049
     O                 01 55 80          36 'SE'                                              CER049
     O                 41                36 'SF'                                              CER049
     O**********               MTIME     42 '  .  .  '                               CSD031 BUG11450
     O**********               WSID      45                                          CSD031 BUG11450
     O**********       42      ACTCD     46                                          CSD031 BUG11450
     O**********       42      SAKEY     56                                          CSD031 BUG11450
     O**********               MTIME     43 '  .  .  '                               BUG11450 CER049
     O**********               WSID      46                                          BUG11450 CER049
     O**********       42      ACTCD     47                                          BUG11450 CER049
     O                         MTIME     44 '  .  .  '                                        CER049
     O                         WSID      47                                                   CER049
     O                 42      ACTCD     48                                                   CER049
     O**********       42      SAKEY     57                                        BUG11450 BUG11700
     O**********       42      SAKEY     61                                          BUG11700 CER049
     O                 42      SAKEY     62                                                   CER049
0861 O**********               MTIME     35 '  .  .  '                                        CSD031
0862 O**********               WSID      38                                                   CSD031
0863 O**********       42      ACTCD     39                                                   CSD031
0864 O**********       42      SAKEY     53                                            CDL038 CSD031
     O**********       43      SCFLDS   131                                            CDL038 CSD031
     O**********       44 22   ACD1      63                                            CDL038 CSD031
     O**********       44N28   NCD1      65                                            CDL038 CSD031
     O**********       44 34   PRF1      66                                            CDL038 CSD031
     O**********       44 23   ACD2      76                                            CDL038 CSD031
     O**********       44N29   NCD2      78                                            CDL038 CSD031
     O**********       44 35   PRF2      79                                            CDL038 CSD031
     O**********       44 24   ACD3      89                                            CDL038 CSD031
     O**********       44N30   NCD3      91                                            CDL038 CSD031
     O**********       44 36   PRF3      92                                            CDL038 CSD031
     O**********       44 25   ACD4     102                                            CDL038 CSD031
     O**********       44N31   NCD4     104                                            CDL038 CSD031
     O**********       44 37   PRF4     105                                            CDL038 CSD031
     O**********       44 26   ACD5     115                                            CDL038 CSD031
     O**********       44N32   NCD5     117                                            CDL038 CSD031
     O**********       44 38   PRF5     118                                            CDL038 CSD031
     O**********       44 27   ACD6     128                                            CDL038 CSD031
     O**********       44N33   NCD6     130                                            CDL038 CSD031
     O**********       44 39   PRF6     131                                            CDL038 CSD031
     O**********               ERCD     203                                            CDL038 CSD031
     O**********               ERMSG    255                                            CDL038 CSD031
     O**********       43      SCFLDS   134                                          CSD031 BUG11450
     O**********       44 22   ACD1      66                                          CSD031 BUG11450
     O**********       44N28   NCD1      68                                          CSD031 BUG11450
     O**********       44 34   PRF1      69                                          CSD031 BUG11450
     O**********       44 23   ACD2      79                                          CSD031 BUG11450
     O**********       44N29   NCD2      81                                          CSD031 BUG11450
     O**********       44 35   PRF2      82                                          CSD031 BUG11450
     O**********       44 24   ACD3      92                                          CSD031 BUG11450
     O**********       44N30   NCD3      94                                          CSD031 BUG11450
     O**********       44 36   PRF3      95                                          CSD031 BUG11450
     O**********       44 25   ACD4     105                                          CSD031 BUG11450
     O**********       44N31   NCD4     107                                          CSD031 BUG11450
     O**********       44 37   PRF4     108                                          CSD031 BUG11450
     O**********       44 26   ACD5     118                                          CSD031 BUG11450
     O**********       44N32   NCD5     120                                          CSD031 BUG11450
     O**********       44 38   PRF5     121                                          CSD031 BUG11450
     O**********       44 27   ACD6     131                                          CSD031 BUG11450
     O**********       44N33   NCD6     133                                          CSD031 BUG11450
     O**********       44 39   PRF6     134                                          CSD031 BUG11450
     O**********               STZONE   149                                          CSD031 BUG11450
     O**********               SZONE    150                                          CSD031 BUG11450
     O**********               STEFDT   165                                          CSD031 BUG11450
     O**********               SEFFDT   171                                          CSD031 BUG11450
     O**********               STCDTA   186                                          CSD031 BUG11450
     O**********               SCDTA    187                                          CSD031 BUG11450
     O**********               ERCD     263                                          CSD031 BUG11450
     O**********               ERMSG    338                                          CSD031 BUG11450
     O**********       43      SCFLDS   135                                        BUG11450 BUG11700
     O**********       44 22   ACD1      67                                        BUG11450 BUG11700
     O**********       44N28   NCD1      69                                        BUG11450 BUG11700
     O**********       44 34   PRF1      70                                        BUG11450 BUG11700
     O**********       44 23   ACD2      80                                        BUG11450 BUG11700
     O**********       44N29   NCD2      82                                        BUG11450 BUG11700
     O**********       44 35   PRF2      83                                        BUG11450 BUG11700
     O**********       44 24   ACD3      93                                        BUG11450 BUG11700
     O**********       44N30   NCD3      95                                        BUG11450 BUG11700
     O**********       44 36   PRF3      96                                        BUG11450 BUG11700
     O**********       44 25   ACD4     106                                        BUG11450 BUG11700
     O**********       44N31   NCD4     108                                        BUG11450 BUG11700
     O**********       44 37   PRF4     109                                        BUG11450 BUG11700
     O**********       44 26   ACD5     119                                        BUG11450 BUG11700
     O**********       44N32   NCD5     121                                        BUG11450 BUG11700
     O**********       44 38   PRF5     122                                        BUG11450 BUG11700
     O**********       44 27   ACD6     132                                        BUG11450 BUG11700
     O**********       44N33   NCD6     134                                        BUG11450 BUG11700
     O**********       44 39   PRF6     135                                        BUG11450 BUG11700
     O**********               STZONE   150                                        BUG11450 BUG11700
     O**********               SZONE    151                                        BUG11450 BUG11700
     O**********               STEFDT   166                                        BUG11450 BUG11700
     O**********               SEFFDT   172                                        BUG11450 BUG11700
     O**********               STCDTA   187                                        BUG11450 BUG11700
     O**********               SCDTA    188                                        BUG11450 BUG11700
     O**********               ERCD     264                                        BUG11450 BUG11700
     O**********               ERMSG    339                                        BUG11450 BUG11700
     O**********       43      SCFLDS   139                                          BUG11700 CER049
     O                 43      SCFLDS   152                                                   CER049
     O**********       44 22   ACD1      71                                          BUG11700 CER049
     O                 44 22   ACD1      72                                                   CER049
     O**********       44N28   NCD1      73                                          BUG11700 CER049
     O**********       44 34   PRF1      74                                          BUG11700 CER049
     O**********       44 23   ACD2      84                                          BUG11700 CER049
     O**********       44N29   NCD2      86                                          BUG11700 CER049
     O**********       44 35   PRF2      87                                          BUG11700 CER049
     O**********       44 24   ACD3      97                                          BUG11700 CER049
     O**********       44N30   NCD3      99                                          BUG11700 CER049
     O**********       44 36   PRF3     100                                          BUG11700 CER049
     O**********       44 25   ACD4     110                                          BUG11700 CER049
     O**********       44N31   NCD4     112                                          BUG11700 CER049
     O**********       44 37   PRF4     113                                          BUG11700 CER049
     O**********       44 26   ACD5     123                                          BUG11700 CER049
     O**********       44N32   NCD5     125                                          BUG11700 CER049
     O**********       44 38   PRF5     126                                          BUG11700 CER049
     O**********       44 27   ACD6     136                                          BUG11700 CER049
     O**********       44N33   NCD6     138                                          BUG11700 CER049
     O**********       44 39   PRF6     139                                          BUG11700 CER049
     O                 44 22   ASQ1      74                                                   CER049
     O                 44N28   NCD1      76                                                   CER049
     O                 44 34   PRF1      77                                                   CER049
     O                 44 23   ACD2      87                                                   CER049
     O                 44 23   ASQ2      89                                                   CER049
     O                 44N29   NCD2      91                                                   CER049
     O                 44 35   PRF2      92                                                   CER049
     O                 44 24   ACD3     102                                                   CER049
     O                 44 24   ASQ3     104                                                   CER049
     O                 44N30   NCD3     106                                                   CER049
     O                 44 36   PRF3     107                                                   CER049
     O                 44 25   ACD4     117                                                   CER049
     O                 44 25   ASQ4     119                                                   CER049
     O                 44N31   NCD4     121                                                   CER049
     O                 44 37   PRF4     122                                                   CER049
     O                 44 26   ACD5     132                                                   CER049
     O                 44 26   ASQ5     134                                                   CER049
     O                 44N32   NCD5     136                                                   CER049
     O                 44 38   PRF5     137                                                   CER049
     O                 44 27   ACD6     147                                                   CER049
     O                 44 27   ASQ6     149                                                   CER049
     O                 44N33   NCD6     151                                                   CER049
     O                 44 39   PRF6     152                                                   CER049
     O**********               STZONE   154                                          BUG11700 CER049
     O**********               SZONE    155                                          BUG11700 CER049
     O**********               STEFDT   170                                          BUG11700 CER049
     O**********               SEFFDT   176                                          BUG11700 CER049
     O**********               STCDTA   191                                          BUG11700 CER049
     O**********               SCDTA    192                                          BUG11700 CER049
     O**********               ERCD     268                                          BUG11700 CER049
     O**********               ERMSG    343                                          BUG11700 CER049
     O                         STZONE   167                                                   CER049
     O                         SZONE    168                                                   CER049
     O                         STEFDT   183                                                   CER049
     O                         SEFFDT   189                                                   CER049
     O                         STCDTA   204                                                   CER049
     O                         SCDTA    205                                                   CER049
     O                         ERCD     281                                                   CER049
     O                         ERMSG    356                                                   CER049
      *
0864 O*****************42      SAKEY     49                                                   CDL038
0865 O**********       43      SCFLDS    91                                                   CGL029
     O*****************43      SCFLDS   127                                            CGL029 CDL038
     O*****************44 22   ACD1      59                                            CGL029 CDL038
     O*****************44N28   NCD1      61                                            CGL029 CDL038
     O*****************44 34   PRF1      62                                            CGL029 CDL038
     O*****************44 23   ACD2      72                                            CGL029 CDL038
     O*****************44N29   NCD2      74                                            CGL029 CDL038
     O*****************44 35   PRF2      75                                            CGL029 CDL038
     O*****************44 24   ACD3      85                                            CGL029 CDL038
     O*****************44N30   NCD3      87                                            CGL029 CDL038
     O*****************44 36   PRF3      88                                            CGL029 CDL038
     O*****************44 25   ACD4      98                                            CGL029 CDL038
     O*****************44N31   NCD4     100                                            CGL029 CDL038
     O*****************44 37   PRF4     101                                            CGL029 CDL038
     O*****************44 26   ACD5     111                                            CGL029 CDL038
     O*****************44N32   NCD5     113                                            CGL029 CDL038
     O*****************44 38   PRF5     114                                            CGL029 CDL038
     O*****************44 27   ACD6     124                                            CGL029 CDL038
     O*****************44N33   NCD6     126                                            CGL029 CDL038
     O*****************44 39   PRF6     127                                            CGL029 CDL038
     O*************************ERCD     199                                            CGL029 CDL038
     O*************************ERMSG    251                                            CGL029 CDL038
0866 O**********       44 22   ACD1      53                                                   CGL029
0867 O**********       44N28   NCD1      55                                                   CGL029
0868 O**********       44 34   PRF1      56                                                   CGL029
0869 O**********       44 23   ACD2      60                                                   CGL029
0870 O**********       44N29   NCD2      62                                                   CGL029
0871 O**********       44 35   PRF2      63                                                   CGL029
0872 O**********       44 24   ACD3      67                                                   CGL029
0873 O**********       44N30   NCD3      69                                                   CGL029
0874 O**********       44 36   PRF3      70                                                   CGL029
0875 O**********       44 25   ACD4      74                                                   CGL029
0876 O**********       44N31   NCD4      76                                                   CGL029
0877 O**********       44 37   PRF4      77                                                   CGL029
0878 O**********       44 26   ACD5      81                                                   CGL029
0879 O**********       44N32   NCD5      83                                                   CGL029
0880 O**********       44 38   PRF5      84                                                   CGL029
0881 O**********       44 27   ACD6      88                                                   CGL029
0882 O**********       44N33   NCD6      90                                                   CGL029
0883 O**********       44 39   PRF6      91                                                   CGL029
0884 O**********               ERCD     163                                                   CGL029
0885 O**********               ERMSG    215                                                   CGL029
     O/COPY WNCPYSRC,SD0050O002
0886 O**   NB. ERCD & ERMSG ARE DISPLAYED AS 76 CHARACTERS ON SCREEN.
0887 O**
0894 O**
0979 O**   ACCOUNT KEYS FILE OUTPUT.
0980 O**
0981 O**   UPDATE ACCOUNT KEYS HEADER RECORD.
0982 OACKEY   E        72
0983 O**********               LOT       96                                                   CGL029
     O*************************LOT      156                                            CGL029 CDL038
     O**********               LOT      170                                            CDL038 CSD031
     O**********               LOT      215                                            CSD031 CER049
     O                         LOT      227                                                   CER049
0984 O                         NINS      21
0985 O                         NDEL      25
0986 O                         NAMD      29
     O                         NREC1     32P                                                  CSD031
0987 O**
0988 O**   UPDATE ACCOUNT KEYS DETAIL RECORD.
0989 O**
0990 O**   INSERTION-NEW.
0991 OACKEYAL EADD     71 02 69
0992 O                                    1 'D'
0993 O                         SAKEY    170                                                   CDL038
0993 O*************************SAKEY     11                                                   CDL038
0994 O**********               SACD      37                                                   CGL029
     O                                   37 '000000000000000000000000'                        CDL038
0995 O                         SNCD      49
0996 O                         SPRF      55
0997 O                         RUND      92P
0998 O                         ACTCD     93
0999 O                         NATN      96P
     O                         SACD     156                                                   CGL029
     O**********               SZONE    197                                          CSD031 BUG11700
     O**********               EACC     200P                                         CSD031 BUG11700
     O**********               SCDTA    201                                          CSD031 BUG11700
     O                         SZONE    211                                                 BUG11700
     O                         EACC     214P                                                BUG11700
     O                         SCDTA    215                                                 BUG11700
     O                         SASQ     227                                                   CER049
1000 O**
1001 O**   INSERTION OVER A DELETED RECORD, AMENDMENT OR DELETION.
1002 OACKEY   E        71 02N69
1003 O       OR        71 03
1004 O       OR        71 04
1005 O**********               LOT       96                                                   CGL029
     O*************************LOT      156                                            CGL029 CDL038
     O**********               LOT      170                                            CDL038 CSD031
     O**********               LOT      215                                            CSD031 CER049
     O                         LOT      227                                                   CER049
1006 O                 04                 1 '*'
1007 O                 02                 1 'D'
1008 O**********               SACD      37                                                   CGL029
     O                                   37 '000000000000000000000000'                        CDL038
1009 O                         SNCD      49
1010 O                         SPRF      55
1011 O                         RUND      92P
1012 O                         ACTCD     93
1013 O                         NATN      96P
     O                         SACD     156                                                   CGL029
     O**********               SZONE    197                                          CSD031 BUG11700
     O**********               EACC1    200P                                         CSD031 BUG11700
     O**********               SCDTA    201                                          CSD031 BUG11700
     O                         SZONE    211                                                 BUG11700
     O                         EACC1    214P                                                BUG11700
     O                         SCDTA    215                                                 BUG11700
     O                         SASQ     227                                                   CER049
1014 O**
1015 O**   ACKEY FILE - RELEASE.
1016 OACKEY   E        45
1017 O**
1018 O**
**   ERRMSG - ERROR MESSAGES
INVALID ACTION CODE                              1
NOT FOUND                                        2
ALREADY ON FILE                                  3
INVALID COMMAND KEY                              4
INVALID KEY                                      5
RECORD HAS BEEN UPDATED BY ANOTHER WORK-STATION  6
GENERAL LEDGER ICD HAS NOT BEEN SET UP           7                        082749
ACCT KEY FILE(S) BUSY - TRY AGAIN LATER          8                        085179
ACCEPT TO ZONE MUST BE 'Y' OR 'N'                9                                            CSD031
     X/COPY WNCPYSRC,SDH00571
**   CHAR - PERMITTED CHARACTERS IN ACCOUNT KEY
ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789
** ACR - AKEY Elements that identify dealing accruals                     082749
PH                                                                        082749
LL                                                                        082749
AA                                                                        082749
AI                                                                        082749
AD                                                                        082749
AC                                                                        082749
AP                                                                        082749
AL                                                                        082749
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** OVRC                                                                                       CSD031
OVRDBF FILE(GZSDBANK) TOFILE(GZSDBANKL2)                                                      CSD031
