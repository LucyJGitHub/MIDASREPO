     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas CH Customer details enquiry')
      *****************************************************************
      *                                                               *
      *  Midas - Standing Data Module                                 *
      *                                                               *
      *  SD0241E - CHEQUE CUSTOMER DETAILS ENQUIRY                    *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             Date 26Aug96               *
      *                 082061             Date 24Jan95               *
      *                 S01413 *CREATE     DATE 13APR93               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CPM005 - Private Banking Phase II                            *
      *           Focus Group Changes Upgraded to DBA                 *
      *  082061 - Replace the use of PF/SDCHEQPD with LF/SDCHEQL1.    *
      *  S01413 - Retail 3 Incorporation                              *
      *                                                               *
      *****************************************************************
      /EJECT
     F*SDCHEQPDIF*E***        K        DISK                               082061
     FSDCHEQL1IF  E           K        DISK                               082061
     F** PREFIX : SC
     F                                              KINFSR *PSSR
     FSD0241E#CF  E                    WORKSTN
     F** PREFIX : DD
     F                                              KINFDS INFDS#
     F*
     F/EJECT
     F****************************************************************
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       01         Command key 1
     F*       02         Command key 2
     F*       03         Command key 3
     F*
     F*       12         Command key 12
     F*
     F*       18         Invalid Expiry date 3
     F*       19         Invalid Customer No
     F*       20         Invalid Cheque card 1
     F*       21         Invalid Issued date 1
     F*       22         Invalid Expiry date 1
     F*       23         Invalid Cheque card 2
     F*       24         Invalid Issued date 2
     F*
     F*       25         Used in SD0241E#
     F*
     F*       26         Invalid Expiry date 2
     F*       27         Invalid Cheque card 3
     F*       28         Invalid Issued date 3
     F*
     F*       29         Valid CMD KEY
     F*
     F*       30         Invalid Cheque card 4
     F*       31         Invalid Issued date 4
     F*       32         Invalid Expiry date 4
     F*       33         Invalid Cheque card 5
     F*       34         Invalid Issued date 5
     F*       35         Invalid Expiry date 5
     F*       36         Invalid Cheque F No 1
     F*       37         Invalid Cheque T No 1
     F*       38         Invalid Quantity 1
     F*       39         Invalid Issued Date 1
     F*       40         Invalid Cheque F No 2
     F*       41         Invalid Cheque T No 2
     F*       42         Invalid Quantity 2
     F*       43         Invalid Issued Date 2
     F*       44         Invalid Cheque F No 3
     F*       45         Invalid Cheque T No 3
     F*       46         Invalid Quantity 3
     F*       47         Invalid Issued Date 3
     F*       48         Invalid Cheque F No 4
     F*       49         Invalid Cheque T No 4
     F*       50         Invalid Quantity 4
     F*       51         Invalid Issued Date 4
     F*       52         Invalid Cheque F No 5
     F*       53         Invalid Cheque T No 5
     F*       54         Invalid Quantity 5
     F*       55         Invalid Issued Date 5
     F*       56         Invalid Credit card 1
     F*       57         Invalid Credit card Text 1
     F*       58         Invalid Issued date 1
     F*       59         Invalid Expiry date 1
     F*       60         Invalid Credit card 2
     F*       61         Invalid Credit card Text 2
     F*       62         Invalid Issued date 2
     F*       63         Invalid Expiry date 2
     F*       64         Invalid Credit card 3
     F*       65         Invalid Credit card Text 3
     F*       66         Invalid Issued date 3
     F*       67         Invalid Expiry date 3
     F*       68         Invalid Credit card 4
     F*       69         Invalid Credit card Text 4
     F*       70         Invalid Issued date 4
     F*       71         Invalid Expiry date 4
     F*       72         Invalid Credit card 5
     F*       73         Invalid Credit card Text 5
     F*       74         Invalid Issued date 5
     F*       75         Invalid Expiry date 5
     F*
     F*       78         Global error indicator
     F*       79         Protect key field
     F*
     F*       85         Test of type of last change
     F*       86         Condition putovr
     F*       87         Enable cmd key
     F*       88         Protect key field
     F*
     F*       90-99      Standard subroutine indicators.
     F*
     F*          U7    Set on with U8 if a database error occurs.
     F*          U8    File out of balance if on on its own.
     F*
     F*                Unused indicators
     F*                -----------------
     F*       ..  ..  ..  04  ..  06  07  08  09  10
     F*       11  ..  13  14  15  16  17  ..  ..  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..  80
     F*       81  82  83  84  ..  ..  ..  ..  ..  ..
     F*       ..  ..  ..  ..  ..  ..  ..  ..  ..
     F*
     F/EJECT
     E*
     E** Copyright.
     E*
     E                    CPY@    1   1 80
     E*
     E** Tables for standard subroutines ZDATE1 / ZDATE2
     E*
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E/EJECT
     I*
     I** Data structure for compilation - copyright insertion.
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I** Program data structure.
     I*
     IPGMDS     ESDSY2PGDSP
     I*
     I** Job date/time.
     I*
     IJBDTTM      DS
     I                                        1   60WWJDT
     I                                        1   20WWJYY
     I                                        3   40WWJMM
     I                                        5   60WWJDD
     I                                        7  120WWJTM
     I                                        7   80WWJHH
     I                                        9  100WWJNN
     I                                       11  120WWJSS
     I*
     I** Display file data structure.
     I*
     IINFDS#    E DSY2I#DSP
     I*
     I** Local Data Area for database error details
     I*
     ILDA       E DS
     I*
     IRUNDAT    E DS
     I                                        1   20RDLUP
     I                                        3   5 RMLUP
     I                                        6   70RYLUP
     I*
     ISDBANK    E DSSDBANKPD
     I** Bank Details
     I*
     ISDCUST    E DSSDCUSTPD
     I** Customer Details
     I*                                                                   CPM005
     ISCSARD    E DSSCSARDPD                                              CPM005
     I**   SWITCHABLE FEATURES DETAILS                                    CPM005
     I*                                                                   CPM005
     I*
     IDSFDY     E DSDSFDY
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
     I*
     IDSSDY     E DSDSSDY
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE
     I*
     I/EJECT
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INDEX OF SUBROUTINES                                             *
      * MAIN     -                                                       *
      * KEYPRC   - PROCESS KEY SCREEN                                    *
      * KEYDSP   - DISPLAY KEY SCREEN AND PROCESS HELP REQUESTS          *
      * KEYVAL   - VALIDATE KEY FIELD                                    *
      * KEYDET   - ACCESS DETAILS FOR KEY                                *
      * DETPRC   - PROCESS DETAILS                                       *
      * DETDSP   - DISPLAY DETAIL SCREEN AND PROCESS HELP REQUESTS       *
      * DETINZ   - INITIALIZE SCREEN FIELDS                              *
      * DETFIL   - MOVE RECORD FIELDS TO SCREEN FIELDS                   *
      * DETDEF   - MOVE DEFAULT VALUES TO SCREEN FIELDS                  *
      * PGMCLS   - CLOSE CALLED PROGRAMS                                 *
      * PGMEND   - EXIT PROGRAM                                          *
      * ZDATE2   - CONVERT A DAY NUMBER TO DATE FORMATS.                 *
      * INIT     -                                                       *
      * ZASNMS   -                                                       *
      * *PSSR    -                                                       *
      *                                                                  *
      * EXTERNAL ROUTINES CALLED                                         *
      * Y2CLMSC  -                                                       *
      * SDEMSRR  -                                                       *
      * PM0160   - CUSTOMER DOCUMENTATION MAINTENANCE PGM                *
      * PM0601   - CUSTOMER NOTEPAD MAINTENANCE PGM                      *
      * Y2SNMGC  -                                                       *
      * Y2BGCMC  -                                                       *
      *                                                                  *
      ********************************************************************
     C           *ENTRY    PLIST
     C                     PARM           WWRET7  7
     C                     PARM           DDCUST
     C*
     C** Initialise
     C*
     C                     EXSR INIT
     C*
     C** Perform once if Customer parameter passed, else repeat
     C*
     C           WWRPT     DOUEQ'N'
     C                     EXSR KEYPRC
     C                     END
     C*
     C** Terminate program.
     C*
     C                     EXSR PGMCLS
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * KEYPRC   - PROCESS KEY SCREEN                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * DETINZ   - INITIALIZE SCREEN FIELDS                              *
      * KEYDSP   - DISPLAY KEY SCREEN AND PROCESS HELP REQUESTS          *
      * PGMCLS   - CLOSE CALLED PROGRAMS                                 *
      * KEYVAL   - VALIDATE KEY FIELD                                    *
      * KEYDET   - ACCESS DETAILS FOR KEY                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWBYP    -                                                       *
      *                                                                  *
      ********************************************************************
     CSR         KEYPRC    BEGSR
     C*
     C** Bypass first display of key screen is possible.
     C*
     C                     MOVEL'Y'       WWBYP   1
     C*
     C** Signal start of transaction.
     C*
     C           *IN03     DOWEQ'0'
     C*
     C** Initialise Detail screen.
     C*
     C                     EXSR DETINZ
     C*
     C** Conduct screen conversation:
     C*
     C           *IN03     DOWEQ'0'
     C           *IN12     ANDEQ'0'
     C*
     C** Key field is blank: display key screen.
     C*
     C           WWBYP     IFEQ 'Y'
     C           DDCUST    ANDEQ*BLANK
     C                     MOVEL'N'       WWBYP
     C                     EXSR KEYDSP
     C                     END
     C*
     C** Validate key field.
     C*
     C           *IN03     IFEQ '0'
     C                     EXSR KEYVAL
     C*
     C** Process key screen input.
     C*
     C           *IN78     IFEQ '0'
     C                     EXSR KEYDET
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     CSR                   ENDSR                           * KEYPRC ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * KEYDSP   -                                                       *
      * KEYDSP   - DISPLAY KEY SCREEN AND PROCESS HELP REQUESTS          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * Y2CLMSC  -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYPRC   - PROCESS KEY SCREEN                                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWHLP    -                                                       *
      * WWIN89   -                                                       *
      * WWJTM    -                                                       *
      *                                                                  *
      ********************************************************************
     CSR         KEYDSP    BEGSR
     C*
     C** Update screen time.
     C*
     C                     TIME           DDTIME           Screen time.
     C*
     C** PUTOVR unless conditioned fields change.
     C*
     C           WWHLP     DOUEQ'N'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDKEY
     C                     MOVEL'N'       WWHLP   1        Reset help requ
     C                     END
     C*
     C** Update job time.
     C*
     C                     TIME           WWJTM            Job time.
     C*
     C** Clear messages from program message queue.
     C*
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM
     C                     PARM '*SAME'   ZAPGRL
     C*
     C** Reset first message only flag.
     C*
     C                     MOVEL'Y'       ZAFSMS  1
     C*
     C** Reset global error indicator.
     C*
     C                     MOVE '0'       *IN78
     C*
     CSR                   ENDSR                           * KEYDSP ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * KEYVAL   - VALIDATE KEY FIELD                                    *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * SDEMSRR  -                                                       *
      * ZASNMS   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYPRC   - PROCESS KEY SCREEN                                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWRET7   - RETURN CODE FOR CALLING PGM                           *
      * WWCUSX   -                                                       *
      * WWDFCF   -                                                       *
      *                                                                  *
      ********************************************************************
     CSR         KEYVAL    BEGSR
     C*
     C** Check relations.
     C** Check reference to Client Details.
     C*
     C                     MOVE *BLANKS   WWRET7
     C                     MOVELDDCUST    WWCUSX  1
     C*
     C** Name search required ?
     C*
     C           WWCUSX    IFEQ '?'
     C                     CALL 'SD0010S'              90
     C                     PARM           WWRET7
     C           DDCUST    PARM DDCUST    WQ0009  6
     C*
     C** Call to program ended in error.
     C*
     C           *IN90     IFEQ '1'
     C                     MOVEL'SD99913' WWRET7
     C                     END
     C*
     C                     MOVE 'Y'       WWDFCF  1        Defer confirm
     C*
     C           WWRET7    IFEQ *BLANKS
     C           DDCUST    ANDNE*BLANKS
     C                     CALL 'AOCUSTR0'AOCUST
     C*
     C** Send message 'Client Details not found'
     C*
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'SD60200' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'SD60200' WWRET7
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C           WWRET7    IFNE *BLANK
     C                     MOVE '1'       *IN78
     C                     MOVE '1'       *IN19
     C                     END
     C*
     C** Customer Number required.
     C*
     C           DDCUST    IFEQ *BLANK
     C                     MOVE '1'       *IN78
     C                     MOVE '1'       *IN19
     C                     MOVEL'SD60201' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END
     C*
     CSR                   ENDSR                           * KEYVAL ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * KEYDET   - ACCESS DETAILS FOR KEY                                *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * *PSSR    -                                                       *
      * DETDEF   - MOVE DEFAULT VALUES TO SCREEN FIELDS                  *
      * DETFIL   - MOVE RECORD FIELDS TO SCREEN FIELDS                   *
      * DETPRC   - PROCESS DETAILS                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYPRC   - PROCESS KEY SCREEN                                    *
      *                                                                  *
      ********************************************************************
     CSR         KEYDET    BEGSR
     C*
     C** Access Customer details
     C*
     C                     MOVEL'*DBERR ' @RTCD
     C                     CALL 'AOCUSTR0'AOCUST
     C*
     C                     MOVE BBCSSN    DDCSSN
     C                     MOVE BBCRNM    DDCRNM
     C                     MOVE BBCRTN    DDCRTN
     C*
     C** Check for existing record.
     C*
     C********** DDCUST    CHAINSDCHEQPD             9091  *              082061
     C           DDCUST    CHAINSDCHEQL1             9091  *              082061
     C*
     C** Record locked.
     C*
     C           *IN91     IFEQ '1'
     C                     MOVE '1'       *IN78
     C                     MOVE '1'       *IN19
     C                     ELSE
     C*
     C** If record does not exist, flip to add mode.
     C*
     C           *IN90     IFEQ '1'
     C*
     C** USER: Initialise detail screen (new record)
     C** Retrieve for other screen - Client Details  *
     C*
     C                     EXSR DETDEF
     C*
     C** If record does exist, flip to change mode.
     C*
     C                     ELSE
     C*
     C** Load screen fields from DBF.
     C*
     C                     EXSR DETFIL
     C*
     C** USER: Initialise detail screen (existing record)
     C*
     C                     MOVEL'N'       WWDELA           Deletion Allowe
     C*
     C** CASE:     WRK.Set Up Complete is No
     C*
     C           WWSUC     IFEQ 'N'
     C                     MOVEL'Y'       WWDELA           Deletion Allowed
     C                     END
     C*
     C** Retrieve for other screen - Client Details  *
     C*
     C                     MOVEL*BLANKS   WWRET7
     C                     MOVE *BLANKS   @RTCD
     C                     CALL 'AOCUSTR0'AOCUST
     C*
     C** DBF Record not found.
     C*
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'SD99908' WWRET7
     C                     MOVEL'SD99908' ZAMSID
     C                     EXSR ZASNMS
     C*
     C** USER: Process DBF record
     C*
     C                     ELSE
     C                     MOVEL*BLANKS   WWRET7
     C                     MOVELBBCSSN    DDCSSN
     C                     MOVELBBCRNM    DDCRNM
     C                     MOVELBBCRTN    DDCRTN
     C                     END
     C*
     C*
     C** CASE:     WRK.Set Up Complete is Yes
     C*
     C           WWSUC     IFEQ 'Y'
     C                     MOVEL'Y'       WWBINS           broker indicator
     C                     END
     C*
     C                     END
     C*
     C** No errors: Display and process details
     C*
     C           *IN78     IFEQ '0'
     C                     EXSR DETPRC
     C                     END
     C*
     C                     END
     C*
     CSR                   ENDSR                           * KEYDET ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * DETPRC   - PROCESS DETAILS                                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PGMCLS   - CLOSE CALLED PROGRAMS                                 *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYDET   - ACCESS DETAILS FOR KEY                                *
      *                                                                  *
      *                                                                  *
      ********************************************************************
     CSR         DETPRC    BEGSR
     C*
     C** Conduct detail screen conversation:
     C** - repeat until screen control flag is reset:
     C*
     C           *IN03     DOWEQ'0'
     C           *IN12     ANDEQ'0'
     C                     MOVE '0'       *IN01
     C                     MOVE '0'       *IN02
     C*
     C** Display detail screen.
     C*
     C                     EXSR DETDSP
     C*
     C** Process detail screen input.
     C*
     C           *IN03     IFEQ '0'                        - B2
     C           *IN12     ANDEQ'0'
     C           *IN01     ANDEQ'0'
     C           *IN02     ANDEQ'0'
     C                     MOVE 'N'       WWDFCF
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C** Process response to F3:
     C** Cancel & exit program.
     C*
     C           *IN03     IFEQ '1'                        - B1
     C                     EXSR PGMCLS
     C                     END                             - E1
     C*
     CSR                   ENDSR                           * DETPRC ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * DETDSP   - DISPLAY DETAIL SCREEN AND PROCESS HELP REQUESTS       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * Y2CLMSC  -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * DETPRC   - PROCESS DETAILS                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWRPT    -                                                       *
      * WWHLP    -                                                       *
      * WWJTM    -                                                       *
      *                                                                  *
      ********************************************************************
     CSR         DETDSP    BEGSR
     C*
     C** Protect key field  on detail screen.
     C*
     C                     MOVE '1'       *IN88
     C                     MOVE '0'       *IN79
     C*
     C           WWBINS    IFEQ 'Y'
     C                     MOVE '1'       *IN79
     C                     END
     C*
     C** Disable key screen - not applicable.
     C*
     C           WWRPT     IFEQ 'N'
     C                     MOVE '0'       *IN87
     C*
     C** Enable key screen.
     C*
     C                     ELSE
     C                     MOVE '1'       *IN87
     C                     END
     C*
     C** Update screen time.
     C*
     C                     TIME           DDTIME           Screen time.
     C           SCCHTP    COMP 'D'                      85               R1048
     C*
     C** PUTOVR unless conditioned fields change.
     C*
     C           WWHLP     DOUEQ'N'
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT2
     C                     EXFMTSD0241F0
     C                     MOVEL'N'       WWHLP   1        Reset help requ
     C                     END
     C*
     C** Update job time.
     C*
     C                     TIME           WWJTM            Job time.
     C*
     C** Clear messages from program message queue.
     C*
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM
     C                     PARM '*SAME'   ZAPGRL
     C*
     C** Reset first message only flag.
     C*
     C                     MOVEL'Y'       ZAFSMS
     C*
     C** Reset global error indicator.
     C*
     C                     MOVE '0'       *IN78
     C*
     CSR                   ENDSR                           * DETDSP ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * DETINZ   - INITIALIZE SCREEN FIELDS                              *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYPRC   - PROCESS KEY SCREEN                                    *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     CSR         DETINZ    BEGSR
     C*
     C                     MOVEL*BLANK    DDCSSN
     C                     MOVEL*BLANK    DDCRNM
     C                     MOVEL*BLANK    DDCRTN
     C                     MOVEL*BLANK    DDCAC1
     C                     MOVEL*BLANK    DDDIS1
     C                     MOVEL*BLANK    DDDRE1
     C                     MOVEL*BLANK    DDCAC2
     C                     MOVEL*BLANK    DDDIS2
     C                     MOVEL*BLANK    DDDRE2
     C                     MOVEL*BLANK    DDCAC3
     C                     MOVEL*BLANK    DDDIS3
     C                     MOVEL*BLANK    DDDRE3
     C                     MOVEL*BLANK    DDCAC4
     C                     MOVEL*BLANK    DDDIS4
     C                     MOVEL*BLANK    DDDRE4
     C                     MOVEL*BLANK    DDCAC5
     C                     MOVEL*BLANK    DDDIS5
     C                     MOVEL*BLANK    DDDRE5
     C                     MOVEL*BLANK    DDCTX1
     C                     MOVEL*BLANK    DDCQF1
     C                     MOVEL*BLANK    DDCQT1
     C                     MOVEL*BLANK    DDCQQ1
     C                     MOVEL*BLANK    DDCQI1
     C                     MOVEL*BLANK    DDCQF2
     C                     MOVEL*BLANK    DDCQT2
     C                     MOVEL*BLANK    DDCQQ2
     C                     MOVEL*BLANK    DDCQI2
     C                     MOVEL*BLANK    DDCQF3
     C                     MOVEL*BLANK    DDCQT3
     C                     MOVEL*BLANK    DDCQQ3
     C                     MOVEL*BLANK    DDCQI3
     C                     MOVEL*BLANK    DDCQF4
     C                     MOVEL*BLANK    DDCQT4
     C                     MOVEL*BLANK    DDCQQ4
     C                     MOVEL*BLANK    DDCQI4
     C                     MOVEL*BLANK    DDCQF5
     C                     MOVEL*BLANK    DDCQT5
     C                     MOVEL*BLANK    DDCQQ5
     C                     MOVEL*BLANK    DDCQI5
     C                     MOVEL*BLANK    DDCTX2
     C                     MOVEL*BLANK    DDCAN1
     C                     MOVEL*BLANK    DDCAL1
     C                     MOVEL*BLANK    DDCAI1
     C                     MOVEL*BLANK    DDCAE1
     C                     MOVEL*BLANK    DDCAN2
     C                     MOVEL*BLANK    DDCAL2
     C                     MOVEL*BLANK    DDCAI2
     C                     MOVEL*BLANK    DDCAE2
     C                     MOVEL*BLANK    DDCAN3
     C                     MOVEL*BLANK    DDCAL3
     C                     MOVEL*BLANK    DDCAI3
     C                     MOVEL*BLANK    DDCAE3
     C                     MOVEL*BLANK    DDCAN4
     C                     MOVEL*BLANK    DDCAL4
     C                     MOVEL*BLANK    DDCAI4
     C                     MOVEL*BLANK    DDCAE4
     C                     MOVEL*BLANK    DDCAN5
     C                     MOVEL*BLANK    DDCAL5
     C                     MOVEL*BLANK    DDCAI5
     C                     MOVEL*BLANK    DDCAE5
     C*
     CSR                   ENDSR                           * DETINZ ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * DETFIL   - MOVE RECORD FIELDS TO SCREEN FIELDS                   *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZDATE2   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYDET   - ACCESS DETAILS FOR KEY                                *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     CSR         DETFIL    BEGSR
     C*
     C*
     C                     MOVE SCCSSN    DDCSSN
     C                     MOVE SCCRNM    DDCRNM
     C                     MOVE SCCRTN    DDCRTN
     C*
     C                     MOVE SCCAC1    DDCAC1
     C           SCDIS1    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDIS1    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDIS1
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDIS1                          R0972
     C                     END                                            R0972
     C           SCDRE1    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDRE1    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDRE1
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDRE1                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCAC2    DDCAC2
     C           SCDIS2    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDIS2    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDIS2
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDIS2                          R0972
     C                     END                                            R0972
     C           SCDRE2    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDRE2    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDRE2
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDRE2                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCAC3    DDCAC3
     C           SCDIS3    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDIS3    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDIS3
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDIS3                          R0972
     C                     END                                            R0972
     C           SCDRE3    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDRE3    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDRE3
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDRE3                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCAC4    DDCAC4
     C           SCDIS4    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDIS4    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDIS4
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDIS4                          R0972
     C                     END                                            R0972
     C           SCDRE4    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDRE4    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDRE4
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDRE4                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCAC5    DDCAC5
     C           SCDIS5    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDIS5    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDIS5
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDIS5                          R0972
     C                     END                                            R0972
     C           SCDRE5    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCDRE5    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDRE5
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDDRE5                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCTX1    DDCTX1
     C*
     C                     MOVE SCCQF1    DDCQF1
     C                     MOVE SCCQT1    DDCQT1
     C                     MOVE SCCQQ1    DDCQQ1
     C           SCCQI1    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCCQI1    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCQI1
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCQI1                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCQF2    DDCQF2
     C                     MOVE SCCQT2    DDCQT2
     C                     MOVE SCCQQ2    DDCQQ2
     C           SCCQI2    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCCQI2    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCQI2
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCQI2                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCQF3    DDCQF3
     C                     MOVE SCCQT3    DDCQT3
     C                     MOVE SCCQQ3    DDCQQ3
     C           SCCQI3    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCCQI3    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCQI3
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCQI3                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCQF4    DDCQF4
     C                     MOVE SCCQT4    DDCQT4
     C                     MOVE SCCQQ4    DDCQQ4
     C           SCCQI4    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCCQI4    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCQI4
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCQI4                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCQF5    DDCQF5
     C                     MOVE SCCQT5    DDCQT5
     C                     MOVE SCCQQ5    DDCQQ5
     C           SCCQI5    IFNE *ZEROS                                    R0972
     C                     Z-ADDSCCQI5    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCQI5
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCQI5                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCTX2    DDCTX2
     C*
     C                     MOVE SCCAN1    DDCAN1
     C                     MOVE SCCAL1    DDCAL1
     C           SCCAI1    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAI1    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAI1
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAI1                          R0972
     C                     END                                            R0972
     C           SCCAE1    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAE1    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAE1
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAE1                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCAN2    DDCAN2
     C                     MOVE SCCAL2    DDCAL2
     C           SCCAI2    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAI2    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAI2
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAI2                          R0972
     C                     END                                            R0972
     C           SCCAE2    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAE2    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAE2
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAE2                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCAN3    DDCAN3
     C                     MOVE SCCAL3    DDCAL3
     C           SCCAI3    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAI3    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAI3
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAI3                          R0972
     C                     END                                            R0972
     C           SCCAE3    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAE3    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAE3
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAE3                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCAN4    DDCAN4
     C                     MOVE SCCAL4    DDCAL4
     C           SCCAI4    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAI4    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAI4
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAI4                          R0972
     C                     END                                            R0972
     C           SCCAE4    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAE4    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAE4
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAE4                          R0972
     C                     END                                            R0972
     C*
     C                     MOVE SCCAN5    DDCAN5
     C                     MOVE SCCAL5    DDCAL5
     C           SCCAI5    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAI5    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAI5
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAI5                          R0972
     C                     END                                            R0972
     C           SCCAE5    IFNE *ZEROS                                    R0972
     C                     MOVE SCCAE5    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDCAE5
     C                     ELSE                                           R0972
     C                     MOVE *BLANKS   DDCAE5                          R0972
     C                     END                                            R0972
     C*
     CSR                   ENDSR                           * DETFIL ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * DETDEF   - MOVE DEFAULT VALUES TO SCREEN FIELDS                  *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * ZASNMS   -                                                       *
      * *PSSR    -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYDET   - ACCESS DETAILS FOR KEY                                *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWRET7   - RETURN CODE FOR CALLING PGM                           *
      *                                                                  *
      ********************************************************************
     CSR         DETDEF    BEGSR
     C*
     C                     MOVEL*BLANKS   WWRET7
     C                     MOVE *BLANKS   @RTCD
     C                     CALL 'AOCUSTR0'AOCUST
     C*
     C** DBF Record not found.
     C*
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'SD99908' WWRET7
     C                     MOVEL'SD99908' ZAMSID
     C                     EXSR ZASNMS
     C*
     C** Move default values to screen fields
     C*
     C                     ELSE
     C                     MOVE *BLANKS   WWRET7
     C                     MOVELBBCSSN    DDCSSN
     C                     MOVELBBCRNM    DDCRNM
     C                     MOVELBBCRTN    DDCRTN
     C                     END
     C*
     CSR                   ENDSR                           * DETDEF ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * PGMCLS   - CLOSE CALLED PROGRAMS                                 *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * PGMEND   - EXIT PROGRAM                                          *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      * KEYPRC   - PROCESS KEY SCREEN                                    *
      * DETPRC   - PROCESS DETAILS                                       *
      *                                                                  *
      *                                                                  *
      ********************************************************************
     CSR         PGMCLS    BEGSR
     C*
     C                     MOVEL*BLANKS   WWRET7
     C                     EXSR PGMEND
     C*
     CSR         ZXEXIT    ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * PGMEND   - EXIT PROGRAM                                          *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * PGMCLS   - CLOSE CALLED PROGRAMS                                 *
      * INIT     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     CSR         PGMEND    BEGSR
     C*
     C                     SETON                     LR
     C                     RETRN
     C*
     CSR         ZYEXIT    ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * ZDATE2   - CONVERT A DAY NUMBER TO DATE FORMATS.                 *
      *                                                                  *
      *    THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * DETFIL   - MOVE RECORD FIELDS TO SCREEN FIELDS                   *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO ZDEND2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * INIT     -                                                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * Y2BGCMC  -                                                       *
      * PGMEND   - EXIT PROGRAM                                          *
      * *PSSR    -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * MAIN     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWRET7   - RETURN CODE FOR CALLING PGM                           *
      * WWJDT    -                                                       *
      * WWJTM    -                                                       *
      * WWPTFR   -                                                       *
      * WWRPT    -                                                       *
      *                                                                  *
      ********************************************************************
     CSR         INIT      BEGSR
     C*
     C                     MOVEL*BLANKS   WWRET7
     C*
     C** Open files.
     C** Begin commit control.
     C*
     C                     CALL 'Y2BGCMC'
     C                     PARM           WWRET7
     C*
     C           WWRET7    IFNE *BLANKS
     C           WWRET7    ANDNE'CPF8351'
     C                     EXSR PGMEND
     C                     END
     C*
     C** Access Bank details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C                     MOVE 'E'       DDACTN
     C*                                                                   CPM005
     C** Verify if feature "Related Customer Details" (CSD001) is on      CPM005
     C*                                                                   CPM005
     C                     CALL 'AOSARDR0'                                CPM005
     C                     PARM *BLANKS   @RTCD                           CPM005
     C                     PARM '*VERIFY' @OPTN                           CPM005
     C                     PARM 'CSD001'  @SARD   6                       CPM005
     C           SCSARD    PARM SCSARD    DSFDY                           CPM005
     C*                                                                   CPM005
     C** If feature is on, protect fields concerning Credit Card Details  CPM005
     C*                                                                   CPM005
     C           @RTCD     IFEQ *BLANKS                                   CPM005
     C                     MOVE *ON       *IN08                           CPM005
     C                     ELSE                                           CPM005
     C                     MOVE *OFF      *IN08                           CPM005
     C                     END                                            CPM005
     C*
     C** Setup job date/time.
     C*
     C                     Z-ADDUDATE     WWJDT            Job date.
     C                     TIME           WWJTM            Job time.
     C*
     C** Define work field Deletion Allowed
     C*
     C                     MOVEL*BLANK    WWDELA  1
     C*
     C** Define work field broker indicator set
     C*
     C                     MOVEL*BLANK    WWBINS  1
     C*
      * Define work field No. of Records
     C                     Z-ADD*ZERO     WWNORC  50
      * Define work field No. of Amends
     C                     Z-ADD*ZERO     WWNOAM  50
      * Define work field No. of Deletes
     C                     Z-ADD*ZERO     WWNODL  50
      * Define work field No. of Inserts
     C                     Z-ADD*ZERO     WWNOIN  50
      * Define work field Cheque Reference
     C                     MOVE *BLANKS   WWPTFR  4
      * Define work field Type of Last Change
     C                     MOVE *BLANK    WWTYLC  1
      * Define flag Customer Documentation updated
     C                     MOVE *BLANK    WWDOCF  1
      * Define flag Customer Notepad updated
     C                     MOVE *BLANK    WWNOTF  1
      * Define work field run day number
     C                     Z-ADD*ZERO     WWRDNB  50
      * Define work field Set Up Complete
     C                     MOVEL*BLANK    WWSUC   1
      * Define work field date format flag
     C                     MOVEL*BLANK    WWDFF   1
      * Define work field Multi-branching Indicator
     C                     MOVEL*BLANK    WWMBIN  1
      *
      * USER: Initialise program
      * Get Rundate - Rundate  *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE AGMRDT    DDRUND
     C                     MOVE AGRDNB    WWRDNB
     C                     MOVE AGSUC     WWSUC
     C                     MOVE AGDFF     WWDFF
     C                     MOVE AGMBIN    WWMBIN
     C*
     C** Not every key field passed - loop program.
     C*
     C           DDCUST    IFEQ *BLANK                     Customer Number
     C                     MOVEL'Y'       WWRPT   1
     C*
     C** Full key passed, so single shot program.
     C*
     C                     ELSE
     C                     MOVEL'N'       WWRPT
     C                     END
      *
      * parameter list for aocustr0
     C           AOCUST    PLIST
     C                     PARM           @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM DDCUST    CUSKEY 10
     C                     PARM '*CNUM  ' KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      * define db error work fields
     C           *LIKE     DEFN DBFILE    WWFILE
     C           *LIKE     DEFN DBKEY     WWKEY
     C           *LIKE     DEFN DBASE     WWASE
     C*
     CSR                   ENDSR                           * INIT   ESR *
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * ZASNMS   -                                                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      * Y2SNMGC  -                                                       *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYVAL   - VALIDATE KEY FIELD                                    *
      * DETDEF   - MOVE DEFAULT VALUES TO SCREEN FIELDS                  *
      * KEYDET   - ACCESS DETAILS FOR KEY                                *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      *                                                                  *
      ********************************************************************
     CSR         ZASNMS    BEGSR
     C*
     C                     CALL 'Y2SNMGC'
     C                     PARM ##PGM     ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM 'MIDAS   'ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
     C*
     C** Clear all fields for default mechanism next time.
     C*
     C                     MOVEL*BLANK    ZAPGM            Program queue
     C                     MOVEL*BLANK    ZAPGRL           Rel queue
     C                     MOVEL*BLANK    ZAMSID           Message Id.
     C                     MOVEL*BLANK    ZAMSGF           Message file.
     C                     MOVEL*BLANK    ZAMSDA           Message data.
     C                     MOVEL*BLANK    ZAMSTP           Message type.
     C*
     CSR         ZAEXIT    ENDSR
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                                  *
      * *PSSR    -                                                       *
      *                                                                  *
      * SUBROUTINE CALLS:                                                *
      *                                                                  *
      * SUBROUTINE CALLED FROM:                                          *
      * KEYDET   - ACCESS DETAILS FOR KEY                                *
      * DETDEF   - MOVE DEFAULT VALUES TO SCREEN FIELDS                  *
      * INIT     -                                                       *
      *                                                                  *
      * ROUTINE USES VARIABLES:                                          *
      * WWFILE   -                                                       *
      * WWKEY    -                                                       *
      * WWASE    -                                                       *
      * WWRET7   - RETURN CODE FOR CALLING PGM                           *
      *                                                                  *
      ********************************************************************
     CSR         *PSSR     BEGSR
     C*
     C** UPDATE LDA WITH ERROR INFORMATION
     C*
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVELWWFILE    DBFILE
     C                     MOVELWWKEY     DBKEY
     C                     MOVEL##PGM     DBPGM
     C                     MOVELWWASE     DBASE
     C                     OUT  LDA
     C*
     C** DUMP AND RETURN TO THE CALLING PROGRAM
     C*
     C                     SETON                     LRU7U8
     C                     MOVEL'1'       WWRET7
     C                     DUMP
     C                     RETRN
     C*
     CSR                   ENDSR                           * *PSSR  ESR *
     C*=========================================================================
** CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
