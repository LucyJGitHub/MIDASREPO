     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SD PM Customer Details list')
      *****************************************************************
      *                                                               *
      *  Midas - Standing Data Module                                 *
      *                                                               *
      *  SD0391P - SD Portfolio Management Customer Details Report    *
      *                                                               *
      *  Function:  This program prints the Portfolio Management      *
      *  (I/C)      Customer Details                                  *
      *                                                               *
      *  Called By: SDCnnnn - (program name)                          *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD061008           Date 31Dec21               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 10Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPM005             Date 26Jul96               *
      *                 S01124             Date 09May94               *
      *                 56986              Date 22Jun93               *
      *                 S01313             Date 05May92               *
      *                 SA9108             Date 01Oct91               *
      *                 S01313             Date 05Dec90               *
      *                 PMC165             Date 12Jun90               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD061008 - Deliverable Data Split for SDFCTLPA and GPFCTLPA  *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CPB001 - 'Private Banking' Module                            *
      *  CPM005 - Private Banking Phase II                            *
      *           Focus Group Changes Upgraded to DBA                 *
      *  S01124 - PBFG/5 - Instrument Asset/Liability Split           *
      *           PBFG/7 - Net Commitment By Currency                 *
      *           PBFG/8 - Display Positions Split By Currency        *
      *  56986  - SDPLCSPD Changed S01313                             *
      *  S01313 - New Fields Added for Portfolio Performance          *
      *  SA9108 - Pool Securities Transactions                        *
      *  S01313 - New Fields Added For Portfolio Performance          *
      *  PMC165 - Alterations To Valuation Statements                 *
      *                                                               *
      *****************************************************************
     F***SDBANKL1IF  E           K        DISK         KINFSR *PSSR       CPM005
     F***PREFIX*:*BJ***************************************************   CPM005
     F*
     F*SDFCTLL0IF  E           K        DISK         KINFSR *PSSR                           MD061008
     F** PREFIX : AH
     F*
     F***PMDCOMPPIF  E           K        DISK         KINFSR *PSSR       CPM005
     FPMDCOMPDIF  E           K        DISK         KINFSR *PSSR          CPM005
     F** PREFIX : P4
     F*
     F***SDCUSTL0IF  E           K        DISK         KINFSR *PSSR       CPM005
     F***PREFIX*:*BB***************************************************   CPM005
     F***********                                                         CPM005
     F***SDPLCSLCIF  E           K        DISK         KINFSR *PSSR       CPM005
     F***PREFIX*:*QB***************************************************   CPM005
     F************SDPLCSP0**************************KRENAMESDPLCSP1****   CPM005
     F***********                                                         CPM005
     F***SDPLCSPDIF  E           K        DISK         KINFSR *PSSR       CPM005
     F***PREFIX*:*QB***************************************************   CPM005
     F***********                                                         CPM005
     F***SDPLCSPOIF  E                    DISK         KINFSR *PSSR       CPM005
     F***SD1065P1O   E             70     PRINTER                         CPM005
     F***SD1065AUO   E                    PRINTER                         CPM005
     FPMCUSDQ0IF  E                    DISK         KINFSR *PSSR          CPM005
     FSD0391P1O   E             70     PRINTER      KINFSR *PSSR      UC  CPM005
     F                                              KINFDS SPOOL1         CPM005
     FSD0391AUO   E                    PRINTER      KINFSR *PSSR          CPM005
     F                                              KINFDS SPOOLU         CPM005
     F/EJECT
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       54         PRINT DIFFERENCE MESSAGE FOR NO. OF RECORDS
     F*       68         TO ACCESS FILE SDPLCSPO
     F*       69         TO ACCESS FILES
     F*       70         OVERFLOW INDICATOR
     F*       71         DOCUMENTATION DETAILS HAS BEEN PRINTED
     F*       98         DATF = MMDDYY
     F*       99         FILE OPERATIONS INDICATOR
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   ..   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   ..   ..   .. *
     F**      * 71   72   73   74   75   76   77   78   79   80 *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   ..   ..      *
     F**      ***************************************************
     E                    CPY@    1   1 80
     E*
     E***********         ZYDY    4   4  4 0             ZDATE1/2  PMC165 CPM005
     E***********         ZMDY   13  13  3 0             ZDATE1/2  PMC165 CPM005
     E***********         ZMNM   12  12  3               ZDATE2 SR PMC165 CPM005
      *                                                                   CPM005
     E/COPY ZSRSRC,ZDATE2Z1                                               CPM005
      *                                                                   CPM005
     E/EJECT
     I*
     I***LDA*****   UDS                            256                    CPM005
     I***********                           132 183 DBLOT                 CPM005
     I***********                           132 141 DBFILE                CPM005
     I***********                           142 170 DBKEY                 CPM005
     I***********                           171 180 DBPGM                 CPM005
     I***********                           181 183 DBASE                 CPM005
     ILDA       E DSLDA                         256                       CPM005
      *                                                                   CPM005
      ** Local data area for database error details                       CPM005
      ** *LOCK IN LDA immediately before and OUT LDA immediately          CPM005
      ** after each database error handling.                              CPM005
      **                                                                  CPM005
      **                                    134 141 DBFILE                CPM005
      **       Defines:                     142 170 DBKEY                 CPM005
      **                                    171 180 DBPGM                 CPM005
      **                                    181 1830DBASE                 CPM005
     I*
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I** DATA STRUCTURE FOR LAST ACTIVITY DATE
     I*
     IRRCDAT      DS
     I                                        1   2 RRDLUP
     I                                        3   5 RRMLUP
     I                                        6   7 RRYLUP
     I*
     I** DATA STRUCTURE TO FORMAT DATE OF BIRTH
     I*
     I*RBDAT **** DS                              6                       PMC165
     I***********                             1   2 WWBDAY                PMC165
     I***********                             3   4 WWBMTH                PMC165
     I***WWBDAT***** DS                                             PMC165CBL007
     I***********                             1   20WWB1            PMC165CBL007
     I***********                             3   40WWB2            PMC165CBL007
     I***********                             5   60WWB3            PMC165CBL007
     I***RRBDAT***** DS                                             PMC165CBL007
     I***********                             1   5 WWBRTH          PMC165CBL007
     I***********                             6   7 WWBYER          PMC165CBL007
     I*
     I** DATA STRUCTURE TO FORMAT LAST ACTIVITY TIME
     I*
     IWWTLUP      DS                              6
     I                                        1   2 WWHOR1
     I                                        3   4 WWMIN1
     I                                        5   6 WWSEC1
     I*
     IRRTLUP      DS                              8
     I                                        1   2 WWHOR2
     I                                        4   5 WWMIN2
     I                                        7   8 WWSEC2
      *                                                                   CPM005
     ISPOOL1      DS                                                      CPM005
      *                                                                   CPM005
      ** File Information Data Structure for SD0391P1                     CPM005
      *                                                                   CPM005
     I                                       83  92 SFILE1                CPM005
     I                                    B 123 1240SFNUM1                CPM005
     I                                    B 188 1890OFLLN1                CPM005
     I                                    B 367 3680PRTLN1                CPM005
      *                                                                   CPM005
     ISPOOLU      DS                                                      CPM005
      *                                                                   CPM005
      ** File Information Data Structure for SD0391AU                     CPM005
      *                                                                   CPM005
     I                                       83  92 SFILEU                CPM005
     I                                    B 123 1240SFNUMU                CPM005
      *                                                                   CPM005
      ** Dummy Data Structures used by Access Programs                    CPM005
      *                                                                   CPM005
     ISDBANK    E DSSDBANKPD                                              CPM005
      *                                                                   CPM005
      ** External data structures for Bank Details                        CPM005
      *                                                                   CPM005
     ISDCUST    E DSSDCUSTPD                                              CPM005
      *                                                                   CPM005
      ** External data structures for Customer Details                    CPM005
      *                                                                   CPM005
     ISDPORT    E DSSDPORTPD                                              CPM005
      *                                                                   CPM005
      ** External data structures for Portfolio Management Details        CPM005
      *                                                                   CPM005
     ISDMMOD    E DSSDMMODPD                                              CPB001
      *                                                                   CPB001
      ** External data structures for Modules Details                     CPB001
      *                                                                   CPB001
     ISDPLCS    E DSSDPLCSPD                                              CPM005
      *                                                                   CPM005
      ** External data structures for PM Customer Details                 CPM005
      *                                                                   CPM005
     IDSFDY     E DSDSFDY                                                 CPM005
      *                                                                   CPM005
      ** Short data structure for access objects                          CPM005
      *                                                                   CPM005
     IDSSDY     E DSDSSDY                                                 CPM005
      *                                                                   CPM005
      ** Long data structure for access objects                           CPM005
      *                                                                   CPM005
     I/EJECT
     C******************************************************************
     C**           PROGRAM  START
     C******************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           WWMODE  1
     C                     PARM           PSEQ    5                       CPM005
     C*
     C                     EXSR INIT
     C*
     C           WWMODE    CASEQ'1'       PR01
     C           WWMODE    CASEQ'2'       PR02
     C                     END
     C*
     C                     EXSR AU01
     C                     MOVE '1'       *INLR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
      ** INDEX OF SUBROUTINES
      **
      ** INIT      INITIALISE STANDARD FIELDS, ACCESS STANDING DATA
      **
      ** PR01      PROCESS 1 IF MODE = 1
      **
      ** PR02      PROCESS 2 IF MODE = 2
      **
      ** AU01      PROCESS AUDIT
      **
      ** CHKLCT    CHECK CHANGE TYPE AND COMPUTE
      **
      ** W01       PRINT CUSTOMER DETAILS LIST
      **
      ** W02       PRINT CUSTOMER DOCUMENTATION DETAILS
      **
      ** W03       PRINT AUDIT REPORT
      **
      ** *PSSR     ERROR SUBROUTINE
      **
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C** INIT      INITIALISE STANDARD FIELDS, ACCESS STANDING DATA
     C** CALLED BY - MAIN
     C** CALLS     - *PSSR
     C*
     C*****************************************************************
     C           INIT      BEGSR                           ** INIT  BSR **
     C*
     C*
     C** PREPARE LDA
     C*
     C***********          MOVEL*BLANK    DBLOT                           CPM005
     C***********          MOVEL'SD1065'  DBPGM                           CPM005
     C***********                                                         CPM005
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1************************   CPM005
     C***********                                                         CPM005
     C***********          READ SDBANKL1                 99               CPM005
     C***********                                                         CPM005
     C************IN99     IFEQ '1'                        ***************CPM005
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**CPM005
     C***********          MOVEL'TABSE'   DBFILE           ***************CPM005
     C***********          MOVEL'01'      ZTABKY 12                       CPM005
     C***********          MOVE '10'      ZTABKY                          CPM005
     C***********          MOVELZTABKY    DBKEY                           CPM005
     C***********          EXSR *PSSR                                     CPM005
     C***********          END                                            CPM005
     C*
     C           *NAMVAR   DEFN           LDA                             CPM005
     C                     MOVEL'SD0391P' DBPGM                           CPM005
      *                                                                   CPM005
      ** Access the Bank Details                                          CPM005
      *                                                                   CPM005
     C                     CALL 'AOBANKR0'                                CPM005
     C                     PARM *BLANKS   WRTCD   7                       CPM005
     C                     PARM '*FIRST ' WOPTN   7                       CPM005
     C           SDBANK    PARM SDBANK    DSFDY                           CPM005
      *                                                                   CPM005
     C           WRTCD     IFNE *BLANKS                                   CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD001       DBASE            ***************CPM005
     C                     MOVE 'SDBANKPD'DBFILE           * DB ERROR 01 *CPM005
     C                     MOVEL'*FIRST'  DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C***********                                                         CPM005
     C***KEY*TO*ACCESS*SDPLCSLC****************************************   CPM005
     C***********                                                         CPM005
     C***********WWKEY1    KLIST                                          CPM005
     C***********          KFLD           BJRDNB                          CPM005
     C***********          KFLD           WWCUST  6                       CPM005
     C*
     C** SET VARIABLE FOR PAGE HEADER
     C*
     C                     MOVE '1'       *IN70
     C***********                                                         CPM005
     C***INITIALIZE*KEY*FIELDS*****************************************   CPM005
     C***********                                                         CPM005
     C***********          MOVE *LOVAL    WWCUST                          CPM005
      *                                                                   CPM005
      ** Access the Portfolio Management Details                          CPM005
      *                                                                   CPM005
     C                     CALL 'AOPORTR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*FIRST ' WOPTN                           CPM005
     C           SDPORT    PARM SDPORT    DSFDY                           CPM005
      *                                                                   CPM005
     C           WRTCD     IFNE *BLANKS                                   CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD002       DBASE            ***************CPM005
     C                     MOVE 'SDPORTPD'DBFILE           * DB ERROR 02 *CPM005
     C                     MOVEL'*FIRST'  DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPB001
      ** Access the Module Details                                        CPB001
      *                                                                   CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM *BLANKS   WRTCD                           CPB001
     C                     PARM '*FIRST ' WOPTN                           CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
      *                                                                   CPB001
     C           WRTCD     IFNE *BLANKS                                   CPB001
     C           *LOCK     IN   LDA                                       CPB001
     C                     Z-ADD009       DBASE            ***************CPB001
     C                     MOVE 'SDMMODPD'DBFILE           * DB ERROR 09 *CPB001
     C                     MOVEL'*FIRST'  DBKEY            ***************CPB001
     C                     OUT  LDA                                       CPB001
     C                     EXSR *PSSR                                     CPB001
     C                     ENDIF                                          CPB001
     C*
     C                     ENDSR                           ** INIT   ESR**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C** PR01      PROCESS 1 IF MODE = 1
     C** CALLED BY - MAIN
     C** CALLS     - CHKLCT
     C**           - W01
     C**           - W02
     C*
     C*****************************************************************
     C           PR01      BEGSR                           **PR01  SR**
     C*
     C***********WWKEY1    SETLLSDPLCSLC                                  CPM005
     C***********          READ SDPLCSLC                 69               CPM005
     C***********          READ SDPLCSPO                 68               CPM005
     C***********                                                         CPM005
      *                                                                   CPM005
      ** Access the Portfolio Management Details                          CPM005
      *                                                                   CPM005
     C                     MOVE *BLANKS   WCUST  10                       CPM005
     C                     CALL 'AOPLCSR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*FIRST ' WOPTN                           CPM005
     C                     PARM           WCUST                           CPM005
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM005
      *                                                                   CPM005
     C           WRTCD     IFNE *BLANKS                                   CPM005
     C           WRTCD     ANDNE'*NRF    '                                CPM005
     C           WRTCD     ANDNE'*EOF    '                                CPM005
     C           WRTCD     ANDNE'*EMPTY  '                                CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD003       DBASE            ***************CPM005
     C                     MOVE 'SDPLCSPD'DBFILE           * DB ERROR 03 *CPM005
     C                     MOVEL'*FIRST'  DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C                     MOVE 'Y'       WNODET  1                       CPM005
      *                                                                   CPM005
     C                     READ PMCUSDQ0                 68               CPM005
      *                                                                   CPM005
     C************IN69     DOWEQ'0'                        - B1           CPM005
     C***********          MOVE QBCUST    WWCUST                          CPM005
      *                                                                   CPM005
     C           WRTCD     DOWEQ*BLANKS                    - B1           CPM005
      *                                                                   CPM005
      ** Only Process today's changes                                     CPM005
      *                                                                   CPM005
     C           QBLCD     IFEQ BJRDNB                                    CPM005
      *                                                                   CPM005
      ** Open Printer file and Process RCF                                CPM005
      *                                                                   CPM005
     C           WWOPEN    IFNE 'Y'                                       CPM005
     C                     MOVE 'Y'       WWOPEN  1                       CPM005
     C                     MOVE 'N'       WNODET                          CPM005
      *                                                                   CPM005
     C                     OPEN SD0391P1                                  CPM005
     C                     EXSR RCFP1                                     CPM005
     C                     END                                            CPM005
      *                                                                   CPM005
     C                     MOVE QBCUST    WWCUST  6                       CPM005
     C                     MOVE QBCUST    WWCNUM
     C                     EXSR CHKLCT
     C*
     C** PRINT CUSTOMER DETAILS
     C*
     C                     EXSR W01
     C*
     C** PRINT DOCUMENTATION DETAILS IF ANY
     C*
     C           *IN68     DOWEQ'0'                        - B2
     C           P6CNUM    ANDEQWWCNUM
     C                     EXSR W02
     C                     MOVE '1'       *IN71
     C***********          READ SDPLCSPO                 68               CPM005
     C                     READ PMCUSDQ0                 68               CPM005
     C                     END                             - E2
     C*
     C***********          READ SDPLCSLC                 69               CPM005
      *                                                                   CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
      ** Access the Portfolio Management Details                          CPM005
      *                                                                   CPM005
     C                     CALL 'AOPLCSR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*NEXT  ' WOPTN                           CPM005
     C                     PARM           WCUST                           CPM005
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM005
      *                                                                   CPM005
     C           WRTCD     IFNE *BLANKS                                   CPM005
     C           WRTCD     ANDNE'*NRF    '                                CPM005
     C           WRTCD     ANDNE'*EOF    '                                CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD004       DBASE            ***************CPM005
     C                     MOVE 'SDPLCSPD'DBFILE           * DB ERROR 04 *CPM005
     C                     MOVEL'*NEXT '  DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C                     END                             - E1
     C*
     C           WWOPEN    IFEQ 'Y'                                       CPM005
     C                     WRITETRAILP1
     C                     END                                            CPM005
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C** PR02      PROCESS 2 IF MODE = 2
     C** CALLED BY - MAIN
     C** CALLS     - CHKLCT
     C**           - W01
     C**           - W02
     C*
     C*****************************************************************
     C           PR02      BEGSR                           **PR02   SR**
     C*
     C***********WWCUST    SETLLSDPLCSPD                                  CPM005
     C***********          READ SDPLCSPD                 69               CPM005
     C***********          READ SDPLCSPO                 68               CPM005
     C***********                                                         CPM005
      *                                                                   CPM005
      ** Access the Portfolio Management Details                          CPM005
      *                                                                   CPM005
     C                     MOVE *BLANKS   WCUST                           CPM005
     C                     CALL 'AOPLCSR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*FIRST ' WOPTN                           CPM005
     C                     PARM           WCUST                           CPM005
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM005
      *                                                                   CPM005
     C           WRTCD     IFNE *BLANKS                                   CPM005
     C           WRTCD     ANDNE'*NRF    '                                CPM005
     C           WRTCD     ANDNE'*EOF    '                                CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD005       DBASE            ***************CPM005
     C                     MOVE 'SDPLCSPD'DBFILE           * DB ERROR 05 *CPM005
     C                     MOVEL'*FIRST'  DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C           WRTCD     IFEQ '*NRF    '                                CPM005
     C                     MOVE 'Y'       WNODET                          CPM005
      *                                                                   CPM005
     C                     ELSE                                           CPM005
      *                                                                   CPM005
      ** Open Printer file and Process RCF                                CPM005
      *                                                                   CPM005
     C                     MOVE 'N'       WNODET                          CPM005
      *                                                                   CPM005
     C                     OPEN SD0391P1                                  CPM005
     C                     EXSR RCFP1                                     CPM005
      *                                                                   CPM005
     C                     READ PMCUSDQ0                 68               CPM005
      *                                                                   CPM005
     C************IN69     DOWEQ'0'                        - B1           CPM005
     C           WRTCD     DOWEQ*BLANKS                    - B1           CPM005
     C                     MOVE QBCUST    WWCUST
     C*
     C** GET DOCUMENTATION DETAILS IF CUSTOMER RECORD IS ALIVE
     C*
     C           QBRECI    IFEQ 'D'                        - B2
     C                     ADD  1         RRNORE
     C**********           MOVE QBCUST    WWCNUM  60                                          CSD027
     C                     MOVE QBCUST    WWCNUM  6                                           CSD027
     C                     EXSR CHKLCT
     C*
     C** PRINT CUSTOMER DETAILS
     C*
     C                     EXSR W01
     C*
     C           *IN68     DOWEQ'0'                        - B3
     C           P6CNUM    ANDEQWWCNUM
     C*
     C** WRITE DOCUMENTATION DETAILS
     C*
     C           P6RECI    IFEQ 'D'                        - B4
     C                     EXSR W02
     C                     MOVE '1'       *IN71
     C                     END                             - E4
     C*
     C***********          READ SDPLCSPO                 68               CPM005
     C                     READ PMCUSDQ0                 68               CPM005
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C***********          READ SDPLCSPD                 69               CPM005
      *                                                                   CPM005
      ** Access the Portfolio Management Details                          CPM005
      *                                                                   CPM005
     C                     CALL 'AOPLCSR0'                                CPM005
     C                     PARM *BLANKS   WRTCD                           CPM005
     C                     PARM '*NEXT  ' WOPTN                           CPM005
     C                     PARM           WCUST                           CPM005
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPM005
      *                                                                   CPM005
     C           WRTCD     IFNE *BLANKS                                   CPM005
     C           WRTCD     ANDNE'*NRF    '                                CPM005
     C           WRTCD     ANDNE'*EOF    '                                CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD006       DBASE            ***************CPM005
     C                     MOVE 'SDPLCSPD'DBFILE           * DB ERROR 06 *CPM005
     C                     MOVEL'*NEXT '  DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C                     END                             - E1
     C*
     C                     WRITETRAILP1
      *                                                                   CPM005
     C                     ENDIF                                          CPM005
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C** AU01      PROCESS AUDIT RECORD
     C** CALLED BY - MAIN
     C** CALLS     - *PSSR
     C**           - W03
     C*
     C*****************************************************************
     C           AU01      BEGSR                           ** AU01 SR**
     C*
     C** GET AUDIT RECORD
     C*
     C                     MOVEL'SDPLCSPD'AHFLNM
     C********** AHFLNM    CHAINSDFCTLL0             99                                     MD061008
     C                     CALL 'SD000119'                                                  MD061008
     C                     PARM '*RTV'    ZMODE   4                                         MD061008
     C                     PARM           AHFLNM 10                                         MD061008
     C                     PARM 0         AHNORC  50                                        MD061008
     C                     PARM 0         AHNOIN  50                                        MD061008
     C                     PARM 0         AHNOAM  50                                        MD061008
     C                     PARM 0         AHNODL  50                                        MD061008
     C                     PARM *BLANKS   ZRETRN 10                                         MD061008
      *                                                                                     MD061008
     C                     SETOF                     99                                     MD061008
     C           ZRETRN    IFNE *BLANKS                                                     MD061008
     C                     SETON                     99                                     MD061008
     C                     ENDIF                                                            MD061008
      *                                                                                     MD061008
     C*
     C** AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C           *IN99     IFEQ '1'                        ***************
     C***********          MOVEL'02'      DBASE            **DB ERROR 02**CPM005
     C***********          MOVEL'SDFCT'   DBFILE           ***************CPM005
     C                     Z-ADD007       DBASE            * DB ERROR 07 *CPM005
     C                     MOVE 'SDFCTLL' DBFILE           ***************CPM005
     C                     MOVEL'AUDIT'   DBKEY
     C                     EXSR *PSSR
     C                     END
     C*
     C                     EXSR W03
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C** CHKLCT    DETERMINE CHANGE TYPE
     C** CALLED BY - PR01
     C**           - PR02
     C** CALLS     -
     C*
     C*****************************************************************
     C           CHKLCT    BEGSR                           **CHKLCT SR**
     C*
     C***********QBCHTP    IFEQ 'I'                                       CPM005
     C           QBTYLC    IFEQ 'I'                                       CPM005
     C                     ADD  1         RRINST
     C******               MOVE 'INSERT'  RRCHTP                          S01124
     C***********          MOVE 'INS'     RRCHTP                   S01124 CPM005
     C                     MOVE 'I'       RRCHTP                          CPM005
     C                     END
     C*
     C***********QBCHTP    IFEQ 'A'                                       CPM005
     C           QBTYLC    IFEQ 'A'                                       CPM005
     C                     ADD  1         RRAMND
     C******               MOVE 'AMEND '  RRCHTP                          S01124
     C***********          MOVE 'AMD'     RRCHTP                   S01124 CPM005
     C                     MOVE 'A'       RRCHTP                          CPM005
     C                     END
     C*
     C***********QBCHTP    IFEQ 'D'                                       CPM005
     C           QBTYLC    IFEQ 'D'                                       CPM005
     C                     ADD  1         RRDELT
     C******               MOVE 'DELETE'  RRCHTP                          S01124
     C***********          MOVE 'DEL'     RRCHTP                   S01124 CPM005
     C                     MOVE 'D'       RRCHTP                          CPM005
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C** W01       PRINT CUSTOMER DETAILS LIST
     C** CALLED BY - PR01
     C**           - PR02
     C** CALLS     -
     C*
     C*****************************************************************
     C           W01       BEGSR                           * W01    BSR *
     C*
     C                     MOVE QBCUST    RRCUST
     C***********QBCUST    CHAINSDCUSTL0             69                   CPM005
      *                                                                   CPM005
      ** Access the Customer Details                                      CPM005
      *                                                                   CPM005
     C                     MOVELQBCUST    WCNUM  10                       CPM005
     C                     CALL 'AOCUSTR0'                                CPM005
     C                     PARM *BLANKS   WRTCD2  7                       CPM005
     C                     PARM '*KEY   ' WOPTN                           CPM005
     C                     PARM           WCNUM                           CPM005
     C                     PARM *BLANKS   WKSTS   7                       CPM005
     C           SDCUST    PARM SDCUST    DSSDY                           CPM005
      *                                                                   CPM005
     C           WRTCD2    IFNE *BLANKS                                   CPM005
     C           *LOCK     IN   LDA                                       CPM005
     C                     Z-ADD008       DBASE            ***************CPM005
     C                     MOVE 'SDCUSTPD'DBFILE           * DB ERROR 08 *CPM005
     C                     MOVELWCNUM     DBKEY            ***************CPM005
     C                     OUT  LDA                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C                     MOVE BBCRNM    RRCRNM
     C                     MOVE *BLANK    RRBDAT                          SA9108
     C           QBBDAT    IFGT *ZEROS                                    SA9108
     C***********          MOVE QBBDAT    WWBDAT                    PMC165CBL007
     C***********                                                         CBL007
     C***********          MOVE ZMNM,WWB2 WWBRTH                    PMC165CBL007
     C***********          MOVELWWB1      WWBRTH                    PMC165CBL007
     C***********                                                         CBL007
     C***********          MOVE WWB3      WWBYER                    PMC165CBL007
     C                     Z-ADDQBBDAT    ZDAYNO  50                      CBL007
     C                     EXSR ZDATE2                                    CBL007
     C                     MOVELZADATE    RRBDAT                          CBL007
     C                     END                                            SA9108
     C                     MOVE QBLANG    RRLANG
     C                     MOVE QBCSBY    RRCSBY
     C                     MOVE QBSAFI    RRSAFI
     C***********          MOVE QBDASS    RRDASS                          PMC165
     C***********          Z-ADDQBDASS    ZDAYNO                   PMC165 56986
     C***********          EXSR ZDATE2                             PMC165 56986
     C***********          MOVE ZADATE    RRDASS                   PMC165 56986
     C                     MOVE QBDCMS    RRDCMS
     C****                 MOVE QBFPVC    RRFPVC                          S01313
     C                     MOVE QBVLFQ    RRVLFQ                          PMC165
     C                     MOVE QBVLDM    RRVLDM                          PMC165
     C                     Z-ADDQBVLND    ZDAYNO                          PMC165
     C                     EXSR ZDATE2                                    PMC165
     C                     MOVE ZADATE    RRVLND                          PMC165
     C                     MOVE QBS1VR    RRS1VR                          S01313
     C                     MOVE QBS2VR    RRS2VR                          PMC165
     C                     MOVE QBS3VR    RRS3VR                          PMC165
     C                     MOVE QBS4VR    RRS4VR                          PMC165
     C                     MOVE QBS5VR    RRS5VR                          PMC165
     C                     MOVE QBS6VR    RRS6VR                          PMC165
     C                     MOVE QBS7VR    RRS7VR                          S01313
     C                     MOVE QBS8VR    RRS8VR                          S01313
     C***********          MOVE QBS0VR    RRS0VR                   S01124 CPM005
     C***********          MOVE QBS9VR    RRS9VR                   S01124 CPM005
     C                     MOVE QBCYSU    RRS0VR                          CPM005
     C                     MOVE QBINSU    RRS9VR                          CPM005
     C******************   MOVE QBRPYP    RRRPYP                  S01313  56986
     C**************       MOVE QBTYSM    RRTYSM                S01313    56986
     C**************       MOVE QBADPP    RRADPP                S01313    56986
     C                     MOVE QBDLUP    RRDLUP
     C                     MOVE QBMLUP    RRMLUP
     C                     MOVE QBYLUP    RRYLUP
     C                     MOVEL'  :  :'  RRTLUP
     C                     MOVE QBTLUP    WWTLUP
     C                     MOVE WWHOR1    WWHOR2
     C                     MOVE WWMIN1    WWMIN2
     C                     MOVE WWSEC1    WWSEC2
     C                     MOVE QBPPCS    RRPPCS                          SA9108
      *                                                                   CPM005
      ** Output the Default Portfolio Field, if it's equal to '9997',     CPM005
      ** output the reference attached to it instead                      CPM005
      *                                                                   CPM005
     C           QBDFPO    IFEQ '9997'                                    CPM005
     C           BGN4ST    ANDNE'Y'                                       CPB001
      *                                                                   CPM005
     C                     MOVE FCR997    RDFPO                           CPM005
      *                                                                   CPM005
     C                     ELSE                                           CPM005
     C                     MOVE QBDFPO    RDFPO                           CPM005
     C                     ENDIF                                          CPM005
     C*
     C** NEW PAGE
     C*
     C           *IN70     IFEQ '1'
     C                     WRITEHTITP1
     C***********          WRITECREFP1                                    CPM005
     C                     WRITECTITP1
     C                     WRITECREFP1                                    CPM005
     C                     MOVE '0'       *IN70
     C                     ELSE
     C*
     C** LAST PRINTED LINE WAS DOCUMENTATION DETAILS
     C*
     C           *IN71     IFEQ '1'
     C***********          WRITECREFP1                                    CPM005
     C                     MOVE '0'       *IN71
     C                     WRITECTITP1
     C                     WRITECREFP1                                    CPM005
     C*
     C** LAST PRINTED LINE WAS CUSTOMER DETAILS
     C*
     C                     ELSE
     C                     WRITECREFP1
     C                     END
     C*
     C                     END
     C*
     C** PRINT CUSTOMER DETAILS
     C*
     C                     WRITECDETP1
     C*
     C** DOCUMENTATION DETAILS EXIST FOR THE CUSTOMER
     C*
     C           *IN68     IFEQ '0'
     C           P6CNUM    ANDEQWWCNUM
     C                     MOVE '1'       *IN71
     C*
     C** PRINT DOCUMENTATION TITLE IF NO OVERFLOW
     C*
     C           *IN70     IFEQ '0'
     C                     WRITEDTITP1
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C** W02       PRINT CUSTOMER DOCUMENTATION DETAILS
     C** CALLED BY - PR01
     C**           - PR02
     C** CALLS     -
     C*
     C*****************************************************************
     C           W02       BEGSR                           **W02     SR**
     C*
     C                     MOVE P6DCCO    RRDCCO
     C                     MOVE P3DNAR    RRDNAR
     C                     MOVE P6DCCC    RRDCCC
     C*
     C           P6DCCC    IFNE *BLANKS
     C***********P6DCCC    CHAINPMDCOMPP             69                   CPM005
     C           P6DCCC    CHAINPMDCOMPD             69                   CPM005
     C                     MOVE P4DCMN    RRDCCM
     C                     ELSE
     C                     MOVE *BLANKS   RRDCCM
     C                     END
     C*
     C                     MOVE P6DCMS    RRDCMS
     C                     MOVE P6DLUP    RRDLUP
     C                     MOVE P6MLUP    RRMLUP
     C                     MOVE P6YLUP    RRYLUP
     C                     MOVEL'  :  :'  RRTLUP
     C                     MOVE P6TLUP    WWTLUP
     C                     MOVE WWHOR1    WWHOR2
     C                     MOVE WWMIN1    WWMIN2
     C                     MOVE WWSEC1    WWSEC2
     C*
     C** PRINT DOCUMENTATION TITLE IF NEW PAGE
     C*
     C           *IN70     IFEQ '1'
     C                     WRITEHTITP1
     C                     WRITECREFP1
     C                     WRITEDTITP1
     C                     MOVE '0'       *IN70
     C                     END
     C*
     C** PRINT DOCUMENTATION DETAILS
     C*
     C                     WRITEDDETP1
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
      *                                                                   CPM005
      *****************************************************************   CPM005
      /TITLE SR/RCFP1                                                     CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      *  RCFP1  - Subroutine to register the P1 Printer File via RCF. *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
      *                                                                   CPM005
     C           RCFP1     BEGSR                            *** RCFP1  ***CPM005
      *                                                                   CPM005
      ** Ensure Report Spool File recorded by RCF.                        CPM005
      *                                                                   CPM005
     C                     Z-ADDSFNUM1    ZSNUM   60                      CPM005
      *                                                                   CPM005
     C                     CALL 'ZSFILE'                                  CPM005
     C                     PARM PSEQ      SEQ     5                       CPM005
     C                     PARM *BLANKS   SENTY   3                       CPM005
     C                     PARM           SFILE1                          CPM005
     C                     PARM           ZSNUM                           CPM005
     C                     PARM           ZSERR   1                       CPM005
      *                                                                   CPM005
      ** If Error occurs during ZSFILE processing, then return to the     CPM005
      ** Calling Program.                                                 CPM005
      *                                                                   CPM005
     C           ZSERR     IFEQ 'Y'                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
      *                                                                   CPM005
      *****************************************************************   CPM005
      /TITLE SR/RCFAU                                                     CPM005
      *****************************************************************   CPM005
      *                                                               *   CPM005
      *  RCFAU  - Subroutine to register the AU Printer File via RCF. *   CPM005
      *                                                               *   CPM005
      *****************************************************************   CPM005
      *                                                                   CPM005
     C           RCFAU     BEGSR                            *** RCFAU  ***CPM005
      *                                                                   CPM005
      ** Ensure Audit Spool File recorded by RCF.                         CPM005
      *                                                                   CPM005
     C                     Z-ADDSFNUMU    ZSNUMU  60                      CPM005
      *                                                                   CPM005
     C                     CALL 'ZSFILE'                                  CPM005
     C                     PARM PSEQ      SEQ                             CPM005
     C                     PARM *BLANKS   SENTY                           CPM005
     C                     PARM           SFILEU                          CPM005
     C                     PARM           ZSNUMU                          CPM005
     C                     PARM *BLANK    ZSERR                           CPM005
      *                                                                   CPM005
      ** If Error occurs during ZSFILE processing, then return to the     CPM005
      ** Calling Program.                                                 CPM005
      *                                                                   CPM005
     C           ZSERR     IFEQ 'Y'                                       CPM005
     C                     EXSR *PSSR                                     CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
     C                     ENDSR                                          CPM005
      *                                                                   CPM005
      ********************************************************************
      /EJECT
     C*****************************************************************
     C*
     C** W03       PRINT AUDIT REPORT
     C** CALLED BY - AU01
     C** CALLS     -
     C*
     C*****************************************************************
     C           W03       BEGSR
     C*
      ** RCF Processing for Audit File                                    CPM005
      *                                                                   CPM005
     C                     EXSR RCFAU                                     CPM005
      *                                                                   CPM005
      ** Output Report Header and File Controls.                          CPM005
      *                                                                   CPM005
     C                     WRITEHEADAU
      *                                                                   CPM005
      ** If there is a DB Error, Output the DB Error Information.         CPM005
      *                                                                   CPM005
     C           *INU7     IFEQ *ON                                       CPM005
     C                     WRITEDBERROR                                   CPM005
     C                     ELSE                                           CPM005
      *                                                                   CPM005
      ** Or, if no records read, Output "No Details" message.             CPM005
      *                                                                   CPM005
     C           WNODET    IFEQ 'Y'                                       CPM005
     C                     WRITENODTLS                                    CPM005
     C                     ELSE                                           CPM005
     C*
     C           WWMODE    IFEQ '1'
     C                     WRITECNTRL1
     C                     END
     C*
     C           WWMODE    IFEQ '2'
     C*
     C           AHNORC    IFNE RRNORE
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *IN54
     C                     END
     C*
     C                     WRITECNTRL2
     C                     END
      *                                                                   CPM005
     C                     ENDIF                                          CPM005
     C                     ENDIF                                          CPM005
     C*
     C***********          WRITEENDAU                                     CPM005
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*************************************************************PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****ZDATE2*SR.*TO*CONVERT*A*DAY*NUMBER*TO*DATE*FORMATS.*****PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.**PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*************************************************************PMC165 CPM005
     C***********ZDATE2    BEGSR                        *** ZDATE2 PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****CLEAR*LEAP*YEAR*WORK*FIELD.*****************************PMC165 CPM005
     C***********          MOVE 'N'       ZLEAP   1                PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****CLEAR*DATE*FIELDS.**************************************PMC165 CPM005
     C***********          Z-ADD0         ZDATE   60               PMC165 CPM005
     C***********          MOVEL'       ' ZADATE  7                PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****CALCULATION*TO*DEFINE*INPUT*DAY*NUMBER.*****************PMC165 CPM005
     C***********          Z-ADDZDAYNO    ZDAYNO  50               PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****DETERMINE*YEAR*NUMBER.**********************************PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****ADJUST*DAY*NUMBER*IN*CASE*LAST*DAY*OF*YEAR.*************PMC165 CPM005
     C***********ZDAYNO    SUB  1         ZDAYN1  50               PMC165 CPM005
     C***********ZDAYN1    IFLT 0                                  PMC165 CPM005
     C***********          GOTO ZDEND2                             PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****CALCULATE*NUMBER*OF*4*YEAR*SPANS*SINCE*31/12/1971.******PMC165 CPM005
     C***********ZDAYN1    DIV  1461      ZLYR    20               PMC165 CPM005
     C***********          MVR            ZDAYN1           SAVE RE PMC165 CPM005
     C***********                                          DAYS    PMC165 CPM005
     C*****CALCULATE*NUMBER*OF*REMAINING*YEARS.********************PMC165 CPM005
     C***********          Z-ADD1         ZWRK2   20               PMC165 CPM005
     C***********ZDTAG1    TAG                            ** ZDTAG PMC165 CPM005
     C***********ZDAYN1    IFGE ZYDY,ZWRK2                         PMC165 CPM005
     C***********ZWRK2     ADD  1         ZWRK2                    PMC165 CPM005
     C***********          GOTO ZDTAG1                             PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C***********ZWRK2     SUB  1         ZWRK2                    PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****DECREMENT*DAY*NO.*BY*DAYS*IN*REMAINING*YEARS.***********PMC165 CPM005
     C***********ZWRK2     IFNE 0                                  PMC165 CPM005
     C***********ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                   PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****CALCULATE*ACTUAL*YEAR*NUMBER.***************************PMC165 CPM005
     C***********ZLYR      MULT 4         ZWRK3   30               PMC165 CPM005
     C***********ZWRK3     ADD  72        ZWRK3            BASE IS PMC165 CPM005
     C***********          Z-ADDZWRK3     ZYEAR   20               PMC165 CPM005
     C***********ZYEAR     ADD  ZWRK2     ZYEAR            YEAR    PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****DETERMINE*MONTH*NUMBER.*********************************PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****ADJUST*DAY*NO.*IN*CASE*LAST*DAY*OF*LEAP*YEAR*FEBRUARY.**PMC165 CPM005
     C***********ZWRK2     IFEQ 0                                  PMC165 CPM005
     C***********ZDAYN1    IFEQ 59                                 PMC165 CPM005
     C***********          MOVE 'Y'       ZLEAP                    PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********ZDAYN1    IFGE 59                                 PMC165 CPM005
     C***********ZDAYN1    SUB  1         ZDAYN1                   PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****CALCULATE*MONTH*NUMBER.*********************************PMC165 CPM005
     C***********          Z-ADD2         ZWRK2                    PMC165 CPM005
     C***********ZDTAG2    TAG                       ** ZDTAG2 TAG PMC165 CPM005
     C***********ZDAYN1    IFGE ZMDY,ZWRK2                         PMC165 CPM005
     C***********ZWRK2     ADD  1         ZWRK2                    PMC165 CPM005
     C***********          GOTO ZDTAG2                             PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C***********ZWRK2     SUB  1         ZWRK2                    PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C***********          Z-ADDZWRK2     ZMTH    20       MONTH   PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****DETERMINE*DAY*OF*MONTH.*********************************PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****ADD*BACK*LAST*DAY*OF*YEAR*ADJUSTMENT.*******************PMC165 CPM005
     C***********ZDAYN1    ADD  1         ZDAYN1                   PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****CALCULATE*DAY*OF*MONTH.*********************************PMC165 CPM005
     C***********ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY     PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****ADD*BACK*LEAP*YEAR*29TH*FEBUARY*ADJUSTMENT,*IF*REQUIRED.PMC165 CPM005
     C***********ZLEAP     IFEQ 'Y'                                PMC165 CPM005
     C***********ZDAY      ADD  1         ZDAY                     PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****FORMAT*DATE,*DDMMYY*OR*MMDDYY.**************************PMC165 CPM005
     C**N98******          MOVELZDAY      ZWRK4   40               PMC165 CPM005
     C***98******          MOVE ZDAY      ZWRK4                    PMC165 CPM005
     C**N98******          MOVE ZMTH      ZWRK4                    PMC165 CPM005
     C***98******          MOVELZMTH      ZWRK4                    PMC165 CPM005
     C***********          MOVELZWRK4     ZDATE                    PMC165 CPM005
     C***********          MOVE ZYEAR     ZDATE                    PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*****FORMAT*ALPHA*DATE,*DDMMMYY.*****************************PMC165 CPM005
     C***********          MOVELZDAY      ZWRK5   5                PMC165 CPM005
     C***********ZDAY      IFLT 10                                 PMC165 CPM005
     C***********          MOVEL' '       ZWRK5                    PMC165 CPM005
     C***********          END                                     PMC165 CPM005
     C***********          MOVE ZMNM,ZMTH ZWRK5                    PMC165 CPM005
     C***********          MOVELZWRK5     ZADATE                   PMC165 CPM005
     C***********          MOVE ZYEAR     ZADATE                   PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C***********ZDEND2    ENDSR                          * ZDEND2 PMC165 CPM005
     C***********                                                  PMC165 CPM005
     C*************************************************************PMC165 CPM005
     C/EJECT                                                              PMC165
     C*****************************************************************
     C*
     C** *PSSR     FILE EXCEPTION/ERROR HANDLING SUBROUTINE
     C** CALLED BY - INIT
     C**           - AU01
     C** CALLS     -
     C*
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C***********          SETON                     U7U8LR               CPM005
     C***********          WRITEERRORAU                                   CPM005
      *                                                                   CPM005
      ** Check to see that *PSSR has not already been called              CPM005
      *                                                                   CPM005
     C           WRUN      IFEQ *BLANK                                    CPM005
     C                     MOVE 'Y'       WRUN    1                       CPM005
     C                     MOVE '1'       *INU7                           CPM005
     C                     MOVE '1'       *INU8                           CPM005
     C                     MOVE '1'       *INLR                           CPM005
     C*
     C** PRINT DUMP AND CANCEL PROGRAM
     C*
     C                     DUMP
      *                                                                   CPM005
     C                     EXSR W03                                       CPM005
     C                     ENDIF                                          CPM005
      *                                                                   CPM005
      ** If *PSSR already run, then just end the program here.            CPM005
      *                                                                   CPM005
     C                     MOVE '1'       *INU7                           CPM005
     C                     MOVE '1'       *INU8                           CPM005
     C                     MOVE '1'       *INLR                           CPM005
      *
     C                     RETRN
     C*
     C                     ENDSR
     C*****************************************************************
      /TITLE SR/ZDATE2                                                    CPM005
     C/COPY ZSRSRC,ZDATE2Z2                                               CPM005
     C/EJECT
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                      PMC165
0366073110961461                                                          PMC165
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                        PMC165
000031059090120151181212243273304334365                                   PMC165
**   ZMNM - MONTHS SHORT NAMES                                            PMC165
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                                      PMC165
