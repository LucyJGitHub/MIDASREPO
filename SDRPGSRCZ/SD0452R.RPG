     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SD Client limits maintenance (2nd screen)')
      *****************************************************************
      *                                                               *
      *  Midas - Standing Data Module                                 *
      *                                                               *
      *  SD0452R - Client Limits Maintenance (2nd Screen)             *
      *                                                               *
      *  Function:  This program maintains client limits details      *
      *             (2nd screen).                                     *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. BUG11738           Date 21Jul06               *
      *  Prev Amend No. CSD027A            Date 11May06               *
      *                 CER001             Date 25Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6198            Date 04Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      * Midas Release 4.01 -------------------------------------------*
      *                 192740             Date 28Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL011             Date 20Sep99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 139827             Date 14Aug98               *
      *                 CSD003             Date 02Jan98               *
      *                 122096             DATE 22AUG97               *
      *                 107583             DATE 10SEP96               *
      *                 088472             DATE 27NOV95               *
      *                 077893             DATE 22JUN95               *
      *                 063959             DATE 02MAR94               *
      *                 063211             DATE 12NOV93               *
      *                 S01459             DATE 12NOV93               *
      *                 S01433             DATE 10OCT93               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  BUG11738 - Database error                                    *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  192740 - Error message encountered when trying to amend      *
      *           Client Limits type.  Fix is to remove FX limit type *
      *           validation on first screen.                         *
      *  CGL011 - Collateral Processing for Midas DBA                 *
      *  CDL006 - Dealing Fiduciary.                                  *
      *  139827 - Reverse 107583 for this program                     *
      *  CSD003 - Synon Closedown Project (SD):                       *
      *           - Program removed from SD model.                    *
      *  122096 - Addition of call to SD0520X to save deleted         *
      *           records for audit during COB.                       *
      *  107583 - The Lending fields should not be displayed if       *
      *           switchable feature S01433 is present.               *
      *  088472 - Condition display of Lending fields (2nd screen)    *
      *           on presence of MM dealing or Lending Modules.       *
      *  077893 - Display 'No Details Entered' message.               *
      *           Reset Precious metals Spot & Forward Limit amount   *
      *           attributes, after error validation.                 *
      *  063959 - Q,M,T,X and Y are the only valid values             *
      *           for LN and PR limit Frequency.                      *
      *  063211 - Program used to force the user to enter both        *
      *           Spot and Forward limit amounts for precious metals  *
      *  S01459 - Addition of headerbox and PSSR processing.          *
      *  S01433 - Enhanced Dealing Limits (new program):              *
      *           'Lending' details moved from SD0451R to this program*
      *           Validate 'Precious Metal' details.                  *
      *                                                               *
      *****************************************************************
     F/COPY WNCPYSRC,SD0452RFPG
     FSD0452R#CF  E                    WORKSTN                        UC
     F                                              KINFDS INFDS#
     F                                              KINFSR *PSSR
      * DSP: Midas SD Client limits maintenance (2nd screen)
      *
     FSDCLLML1IF  E           K        DISK                           UC
     F                                              KINFDS INFDS1
     F                                              KINFSR *PSSR
      * RTV : Midas SD Customer limits retrieval
      *
     FSDCUSTL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0001
     F                                              KINFSR *PSSR
      * RTV : Midas SD Customer details retrieval
      *
     FSDLIMTL0IF  E           K        DISK                           UC
     F                                              KINFDS ID0002
     F                                              KINFSR *PSSR
      * RTV : Limit types               Retrieval index
      *
     FSDMMODL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0003
     F                                              KINFSR *PSSR
      * RTV : Midas SD Midas module flags retrieval
      *
     FSDCLLML0UF  E           K        DISK                      A    UC
     F                                              KCOMIT
     F                                              KINFDS ID0004
     F                                              KINFSR *PSSR
      * UPD : Midas SD Customer limits update
      *
     FSDFCTLL0UF  E           K        DISK                           UC
     F                                              KCOMIT
     F                                              KINFDS ID0005
     F                                              KINFSR *PSSR
      * UPD : Midas SD Standing data controls update
      *
     E* Description     : Copyright notice for inclusion in all programs
     E*
     E********************************************************************
     E                    CPY@    1   1 80               Copyright array
     E/COPY WNCPYSRC,SD0452REPG
     I*
     I* Description     : Copyright notice for inclusion in all programs
     I*
     I/COPY QWINDSRC,SD0450GDTA
     I/COPY WNCPYSRC,SD0452RIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     ILDA         DS                            256                       CDL006
      ** Local data area for database error details                       CDL006
      *                                                                   CDL006
     I                                      134 183 DBLOT                 CDL006
     I                                      134 141 DBFILE                CDL006
     I                                      142 170 DBKEY                 CDL006
     I                                      171 180 DBPGM                 CDL006
     I                                      181 1830DBASE                 CDL006
     ISDLIMT    E DSSDLIMTPD                                              CDL006
      ** External DS for Limits Details                                   CDL006
      *                                                                   CDL006
     IDSFDY     E DSDSFDY                                                 CDL006
      ** First DS for access programs, short data structure               CDL006
      *                                                                   CDL006
     IDSSDY     E DSDSSDY                                                 CDL006
      ** Second DS for access programs, Long Date Structure               CDL006
      *                                                                   CDL006
     ISCSARD    E DSSCSARDPD                                              CDL006
      **  External data structures for Switchable Features Details        CDL006
      *                                                                   CDL006
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     I/COPY WNCPYSRC,SD0452RI01
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSSDCLLML0
      * UPD : Midas SD Customer limits update
      * Current/previous master file format fields for change control
      *
     I***#1DBRC**    DS                            140                    CDL006
     I***#1DBRC**    DS                            148             CDL006 CGL011
     I#1DBRC      DS                            149                       CGL011
      * Stored master file format fields
     I                                        1   1 #1DB1
      *
     IQSDFC1    E DSSDFCTLL0
      * UPD : Midas SD Standing data controls update
     IYARDCS      DS                             22
     IWUDELR      DS
     I                                        1 250 WUDR01
     I                                      251 500 WUDR02
     I                                      501 750 WUDR03
     I                                      7511000 WUDR04
     I                                     10011250 WUDR05
     I                                     12511500 WUDR06
     I                                     15011750 WUDR07
     I                                     17512000 WUDR08
     I                                     20012250 WUDR09
     I                                     22512500 WUDR00
     I                                     25012750 WUDR11
     I                                     27513000 WUDR12
      * Outward parameters
     IPARC        DS                           3064
      * RCD : Midas SD Deleted records file retrieval
      * I :  File name
     I                                        1  10 PAFNME
      * I :  Long Key
     I                                       11  60 PALKEY
      * I :  Deleted Data Record Pt1
     I                                       61 310 PADR01
      * I :  Deleted Data Record Pt2
     I                                      311 560 PADR02
      * I :  Deleted Data Record Pt3
     I                                      561 810 PADR03
      * I :  Deleted Data Record Pt4
     I                                      8111060 PADR04
      * I :  Deleted Data Record Pt5
     I                                     10611310 PADR05
      * I :  Deleted Data Record Pt6
     I                                     13111560 PADR06
      * I :  Deleted Data Record Pt7
     I                                     15611810 PADR07
      * I :  Deleted Data Record Pt8
     I                                     18112060 PADR08
      * I :  Deleted Data Record Pt9
     I                                     20612310 PADR09
      * I :  Deleted Data Record Pt10
     I                                     23112560 PADR00
      * I :  Deleted Data Record Pt11
     I                                     25612810 PADR11
      * I :  Deleted Data Record Pt12
     I                                     28113060 PADR12
      * I :  Last Change Date
     I                                    P306130630PALCD
      * I :  Type of Last Change
     I                                     30643064 PATYLC
      *
     IYBRDCS      DS                             22
     I***YCRDCS**    DS                            140                    CDL006
     I***YCRDCS**    DS                            148             CDL006 CGL011
     IYCRDCS      DS                            149                       CGL011
     IYDRDCS      DS                             22
     IA@CPY       DS
     I* Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNB
     I                                       11  11 SUC
     I                                       12  12 DFF
     I                                       13  13 MBIN
     IYRSW0A      DS                           9999
     IYRSW0B      DS                           9999
     IYRSW0C      DS                           9999
     IYRSW0D      DS                           9999
     IID0001      DS                            528
      * File information data structure
      *
     IID0002      DS                            528
      * File information data structure
      *
     IID0003      DS                            528
      * File information data structure
      *
     IID0004      DS                            528
      * File information data structure
      *
     IID0005      DS                            528
      * File information data structure
      *
      /EJECT
      * Parameter declarations
     I***P1PARM**    DS                            140                    CDL006
     I***P1PARM**    DS                            148             CDL006 CGL011
     IP1PARM      DS                            149                       CGL011
      * RCD: Midas SD Customer limits retrieval
      * I : MAP Customer Number
     I                                        1   6 P1CUST
      * I : MAP Level
     I                                        7   7 P1LEVL
      * I : MAP Branch/Company Code
     I                                        8  10 P1BCCD
      * I : MAP Last Change Date
     I                                    P  11  130P1LCD
      * I : MAP Type of Last Change
     I                                       14  14 P1TYLC
      * I : MAP FX Limit Type
     I                                       15  17 P1FXLT
      * I : MAP FX Limit Amount
     I                                    P  18  220P1FLAM
      * I : MAP FX Limit Expiry Date
     I                                    P  23  250P1FLED
      * I : MAP FX Limit Review Date
     I                                    P  26  280P1FLRD
      * I : MAP FX Limit Frequency
     I                                       29  29 P1FLFQ
      * I : MAP FX Frequency Day No.
     I                                       30  310P1FFDN
      * I : MAP MDDR Amount
     I                                    P  32  360P1MDDR
      * I : MAP Lending Limit Type
     I                                       37  39 P1LLTY
      * I : MAP Lending Limit Amount
     I                                    P  40  440P1LLAM
      * I : MAP Lending Limit Expiry Date
     I                                    P  45  470P1LLED
      * I : MAP Lending Limit Review Date
     I                                    P  48  500P1LLRD
      * I : MAP Lending Limit Frequency
     I                                       51  51 P1LLFR
      * I : MAP Lending Frequency Day No.
     I                                       52  530P1LFDN
      * I : MAP Secured
     I                                       54  54 P1SECD
      * I : MAP FRA Limit Amount
     I                                    P  55  590P1FRLA
      * I : MAP FRA Expiry Date
     I                                    P  60  620P1FRED
      * I : MAP FRA Review Date
     I                                    P  63  650P1FRRD
      * I : MAP FRA Review Frequency
     I                                       66  66 P1FRFQ
      * I : MAP FRA Frequency Day No.
     I                                       67  680P1FRAD
      * I : MAP IRS Limit Amount
     I                                    P  69  730P1IRLM
      * I : MAP IRS Expiry Date
     I                                    P  74  760P1IRED
      * I : MAP IRS Review Date
     I                                    P  77  790P1IRDT
      * I : MAP IRS Review Frequency
     I                                       80  80 P1IRFQ
      * I : MAP IRS Frequency Day No.
     I                                       81  820P1IFDN
      * I : MAP Money market limit type
     I                                       83  85 P1MMTY
      * I : MAP Money market limit amount
     I                                    P  86  900P1MMAM
      * I : MAP Money market expiry date
     I                                    P  91  930P1MMED
      * I : MAP Money market review date
     I                                    P  94  960P1MMRD
      * I : MAP Money market limit Freq.
     I                                       97  97 P1MMFR
      * I : MAP Money market Freq. day no
     I                                       98  990P1MFDN
      * I : MAP Money market secured
     I                                      100 100 P1MSEC
      * I : MAP Money market Line amount
     I                                    P 101 1050P1MLAM
      * I : MAP FX line amount
     I                                    P 106 1100P1FXLA
      * I : MAP FX Forward limit amount
     I                                    P 111 1150P1FXFA
      * I : MAP Prec metals limit type
     I                                      116 118 P1PLTY
      * I : MAP Prec metals frwd lim amt
     I                                    P 119 1230P1PFAM
      * I : MAP Prec metal Spot limit amt
     I                                    P 124 1280P1PSAM
      * I : MAP Prec metals expiry date
     I                                    P 129 1310P1PLED
      * I : MAP Prec metals review date
     I                                    P 132 1340P1PLVD
      * I : MAP Prec metals review freq
     I                                      135 135 P1PLRF
      * I : MAP Prec metals line amount
     I                                    P 136 1400P1PLAM
      * Dealing Fiduciary Limit Type                                      CDL006
     I                                      141 143 P1FILT                CDL006
      * Dealing Fiduciary Limit Amount                                    CDL006
     I                                    P 144 1480P1FILA                CDL006
      * I : MAP FX Limit Secured                                          CGL011
     I                                      149 149 P1FLSC                CGL011
      *                                                                   CGL011
     IP2PARM      DS
      * I : MAP Action Code
     I                                        1   1 P2ANCD
     IP3PARM      DS
      * O : MAP Duplicate Return Code
     I                                        1   7 P3DRTC
     IP4PARM      DS
      * I :  Input field
     I                                        1   1 P4INPT
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Lending Limit Type Req'
      * Lending Limit Type
     I                                        1   3 ZA0001
      * Message data for 'Lending Limit Type Req'
      * Lending Limit Type
     I                                        1   3 ZA0002
      * Message data for 'Lending Limit Type Req'
      * Lending Limit Type
     I                                        1   3 ZA0003
      * Message data for 'Lending Limit Type Req'
      * Lending Limit Type
     I                                        1   3 ZA0004
      * Message data for 'Lending Limit Type Req'
      * Lending Limit Type
     I                                        1   3 ZA0005
      * Message data for 'Lending Limit Type Req'
      * Lending Limit Type
     I                                        1   3 ZA0006
      * Message data for 'PR Limit type is req'
      * Prec metals limit type
     I                                        1   3 ZA0007
      * Message data for 'PR Limit type is req'
      * Prec metals limit type
     I                                        1   3 ZA0008
      * Message data for 'PR Limit type is req'
      * Prec metals limit type
     I                                        1   3 ZA0009
      * Message data for 'PR Limit type is req'
      * Prec metals limit type
     I                                        1   3 ZA0010
      * Message data for 'PR Limit type is req'
      * Prec metals limit type
     I                                        1   3 ZA0011
      * Message data for 'PR Limit type is req'
      * Prec metals limit type
     I                                        1   3 ZA0012
      * Message data for 'PR limit type not found'
      * Prec metals limit type
     I                                        1   3 ZA0013
      * Message data for 'Lending Limit Amt Req'
      * LN Limit Amount Screen DS
     I                                        1   9 ZA0014
      * Message data for 'Limit Amount Not Numeric'
      * Fx Limit Amount Screen
     I                                        1   9 ZA0015
      * Message data for 'LN Limit Amount GT Zero'
      * LN Limit Amount Screen DS
     I                                        1   9 ZA0016
      * Message data for 'Expiry Date Numeric'
      * MM expiry date screen DS
     I                                        1   6 ZA0017
      * Message data for 'LN Expiry Date is Invalid'
      * LN Expiry Date Screen
     I                                        1   6 ZA0018
      * Message data for 'LN Exp Date After Rundat'
      * LN Expiry Date Screen
     I                                        1   6 ZA0019
      * Midas Run Date
     I                                        7  13 ZA0020
      * Message data for 'Review Date Numeric'
      * FX Review Date Screen DS
     I                                        1   6 ZA0021
      * Message data for 'LN Review Date is Invalid'
      * LN Review Date Screen
     I                                        1   6 ZA0022
      * Message data for 'LN Rev Date after Rundat'
      * LN Review Date Screen DS
     I                                        1   6 ZA0023
      * Midas Run Date
     I                                        7  13 ZA0024
      * Message data for 'LN Expiry Date Required'
      * LN Expiry Date Screen DS
     I                                        1   6 ZA0025
      * Message data for 'LN Rev Date bef Exp Date'
      * LN Review Date Screen
     I                                        1   6 ZA0026
      * Message data for 'LN Limit Freq Required'
      * Lending Limit Frequency
     I                                        1   1 ZA0027
      * Message data for 'LN Limit Freq Blank'
      * Lending Limit Frequency
     I                                        1   1 ZA0028
      * Message data for 'Freq Day Num Must Numeric'
      * FX Freq Day Number DS
     I                                        1   2 ZA0029
      * Message data for 'LN Limit Freq Invalid'
      * Lending Limit Frequency
     I                                        1   1 ZA0030
      * Message data for 'LN Freq Day No Required'
      * LN Freq Day Number DS
     I                                        1   2 ZA0031
      * Message data for 'LN Freq Day No Invalid'
      * LN Freq Day Number DS
     I                                        1   2 ZA0032
      * Message data for 'LN Freq Day No Invalid'
      * LN Freq Day Number DS
     I                                        1   2 ZA0033
      * Message data for 'LN Freq Day No - Blank'
      * LN Freq Day Number DS
     I                                        1   2 ZA0034
      * Message data for 'LN Secured is Invalid'
      * Secured
     I                                        1   1 ZA0035
      * Message data for 'PR Spot limit numeric'
      * PR spot lmt amt screen DS
     I                                        1   9 ZA0036
      * Message data for 'PR Spot Limit amt GT Zero'
      * PR spot lmt amt screen DS
     I                                        1   9 ZA0037
      * Message data for 'Expiry Date Numeric'
      * MM expiry date screen DS
     I                                        1   6 ZA0038
      * Message data for 'PR expiry date is invalid'
      * PR expiry date screen DS
     I                                        1   6 ZA0039
      * Message data for 'PR Expry date after today'
      * PR expiry date screen DS
     I                                        1   6 ZA0040
      * Midas Run Date
     I                                        7  13 ZA0041
      * Message data for 'Review Date Numeric'
      * FX Review Date Screen DS
     I                                        1   6 ZA0042
      * Message data for 'PR review date is invalid'
      * PR review date screen
     I                                        1   6 ZA0043
      * Message data for 'PR review date after tody'
      * PR review date screen DS
     I                                        1   6 ZA0044
      * Midas Run Date
     I                                        7  13 ZA0045
      * Message data for 'PR expiry date is req'
      * PR expiry date screen DS
     I                                        1   6 ZA0046
      * Message data for 'PR Review date LT Expir'
      * PR expiry date screen
     I                                        1   6 ZA0047
      * Message data for 'PR frequency is req'
      * Prec metals review freq
     I                                        1   1 ZA0048
      * Message data for 'PR freq must be blank'
      * Prec metals review freq
     I                                        1   1 ZA0049
      * Message data for 'PR freq is invalid'
      * Prec metals review freq
     I                                        1   1 ZA0050
      * Message data for 'PR Forwrd lmt amt numeric'
      * PR Frwd lmt amt screen DS
     I                                        1   9 ZA0051
      * Message data for 'PR frwd lmt amt GT zero'
      * PR Frwd lmt amt screen DS
     I                                        1   9 ZA0052
      * Message data for 'PR line amount is req'
      * PR line amount screen DS
     I                                        1   9 ZA0053
      * Message data for 'PR line amount numeric'
      * PR line amount screen DS
     I                                        1   9 ZA0054
      * Message data for 'PR Line amount GT zero'
      * PR line amount screen DS
     I                                        1   9 ZA0055
      * Message data for 'Either Spot / frwd is req'
      * PR spot lmt amt screen DS
     I                                        1   9 ZA0056
      * PR Frwd lmt amt screen DS
     I                                       10  18 ZA0057
      * Message data for 'Database Error (ICD)'
      * Filename
     I                                        1  10 ZA0058
      * Message data for 'DL Fid. Limit Type Req'                         CDL006
      * DL Fidiciary Limit Type                                           CDL006
     I                                        1   3 ZA0059                CDL006
      * Message data for 'DL Fid. Limit Type not found'                   CDL006
      * DL Fiduciary Limit Type                                           CDL006
     I                                        1   3 ZA0060                CDL006
      * Message data for 'DL Fid. Limit Amt Req'                          CDL006
      * DL Fiduciary Limit Amount Screen DS                               CDL006
     I                                        1   9 ZA0061                CDL006
      * Message data for 'Limit Amount Not Numeric'                       CDL006
      * DL Fiduciary Limit Amount Screen                                  CDL006
     I                                        1   9 ZA0062                CDL006
      * Message data for 'DL Fid. Limit Amount GT Zero'                   CDL006
      * DL fiduciary Amount Screen DS                                     CDL006
     I                                        1   9 ZA0063                CDL006
     IDATALX      DS                           1024                                           CER001
     I                                        1   6 #2CUST                                    CER001
     I                                        7   7 #2LEVL                                    CER001
     I                                        8  10 #2BCCD                                    CER001
     I**********                              1   60P1CNUM                            CER001 CSD027A
     I                                        1   6 P1CNUM                                   CSD027A
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           RCD: Client Lim
     C           P2ANCD    PARM           WP0001  1        Action Code
     C           P3DRTC    PARM P3DRTC    WP0002  7        Duplicate Retur
     C           P4INPT    PARM           WP0003  1        Input field
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Check passed parameters
     C                     EXSR FACKPM
      * Perform once if all passed, else repeat
     C           W0RPT     DOUEQ'N'
      * Display and process key screen
     C                     EXSR BADSKY
     C                     END
      * Terminate program
     C                     EXSR ZXEXPG
      *****************************************************************
      /EJECT
     CSR         BADSKY    BEGSR
      *================================================================
      * Display and process key screen
      *================================================================
      * Initialize key screen
     C                     EXSR MDIZ#K
      * Bypass first display of key screen is possible
     C                     MOVEL'Y'       W0BYP   1
      * Signal start of transaction
     C                     MOVEL'Y'       W0TRN   1
     C           W0TRN     DOWEQ'Y'
     C           W0TRN     OREQ 'K'
      * Ensure transaction continues (if reset)
     C                     MOVEL'Y'       W0TRN   1
      * Conduct screen conversation
     C           W0TRN     DOWEQ'Y'
      * Is bypass key screen still viable?
     C           W0BYP     IFEQ 'Y'
     C           #1CUST    IFEQ *BLANK                     Customer Number
     C           #1LEVL    OREQ *BLANK                     Level
     C           #1BCCD    OREQ *BLANK                     Branch/Company
      * One or more key fields is blank
     C           *IN05     OREQ '1'
      * HOME: Reset screen fields
     C                     MOVEL'N'       W0BYP
     C                     END
     C                     END
      * Bypass key screen
     C           W0BYP     IFNE 'Y'
      * Display key screen
     C                     EXSR BBEXFM
     C                     END
      * Cancel key screen bypass
     C                     MOVEL'N'       W0BYP
      * Process response to key screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Switch between *ADD/*CHANGE modes
     C   09                CAS            BCCHMD
      * HOME: Reset screen fields
     C   05                CAS            BDHMKY
      * Process key screen input
     C                     CAS            BEPRKY
     C                     END
     C           W0TRN     DOWEQ'R'
     C                     MOVEL'Y'       W0TRN
     C                     EXSR BEPRKY
     C                     END
      *
     C                     END
     C                     END
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBEXFM    BEGSR
      *================================================================
      * Display key screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GADSAK
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                         86*
     C           *IN89     IFNE BBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     BBIN89  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDKEY
      * Test cursor
     C                     EXSR Y8TST
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         BCCHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'CHG'     W0PMD   3
     C                     ELSE
     C                     MOVEL'ADD'     W0PMD
     C                     END
      *================================================================
     CSR         BCEXIT    ENDSR
      /EJECT
     CSR         BDHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                     MOVEL'N'       W0TRN
      *================================================================
     CSR         BDEXIT    ENDSR
      /EJECT
     CSR         BEPRKY    BEGSR
      *================================================================
      * Process key screen input
      *================================================================
      * Initialise detail screen
     C                     EXSR MAIZ#1
      * Validate key fields
     C                     EXSR BFVLKY
     C           *IN99     CABEQ'1'       BEEXIT
      * Check for existing record
     C           KRTV      KLIST
     C                     KFLD           DZCUST           Customer Number
     C                     KFLD           DZLEVL           Level
     C                     KFLD           DZBCCD           Branch/Company
      * Setup key
     C                     MOVEL#1CUST    DZCUST           Customer Number
     C                     MOVEL#1LEVL    DZLEVL           Level
     C                     MOVEL#1BCCD    DZBCCD           Branch/Company
     C           KRTV      CHAIN@DZREHT              9091  *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     SETON                     993132*
     C                     SETON                     33    *
     C                     GOTO BEEXIT
     C                     END                             FI 91
      *
      * Verify record existence against program mode
     C           W0PMD     IFNE 'ADD'
      * If record does not exist, error
     C           *IN90     IFEQ '1'
     C                     SETON                     993132*
     C                     SETON                     33    *
      * Send message 'Client Limits          NF'
     C                     MOVEL'USR0665' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     EXSR MBFL#1
      * CALC: Detail screen function fields
      * 00/Copy member SD0452RSFF - Client Limits  *
     C/COPY WNCPYSRC,SD0452RSFF
      * USER: Initialize detail screen (existing record)
      * Set-up DTL Screen Footer - Standard Functions  *
     C*
     C*  DETAIL LINE COMMAND KEY TEXT
     C*
     C                     MOVEL'SDUSRMSG'WUMSGF 10
     C                     MOVE *BLANKS   WUMTXT 80
     C*
     C*  If Action Code is Delete :
     C*
     C           #PANCD    IFEQ 'D'                                       S01229
     C* Setup footer text:
     C* F3=Main Menu   F10=Delete   F12=Previous
     C                     MOVEL'USR3350' WUMSID  7        Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     END
     C*
     C*  If Action Code is Insert :
     C*
     C           #PANCD    IFEQ 'I'                                       S01229
     C* Setup footer text:
     C* F3=Exit   F12=Previous
     C                     MOVEL'USR3351' WUMSID           Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     END
     C*
     C*  If Action Code is Amend :
     C*
     C           #PANCD    IFEQ 'A'                                       S01229
     C* Setup footer text:
     C* F3=Main Menu   F12=Previous
     C                     MOVEL'USR3346' WUMSID           Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     END
     C*
      * Display Level and Branch/company Code?
      * CASE: WRK.Multi-branching Indicator is Multi-branched
     C           WUMBIN    IFEQ 'Y'                        *IF
      * Only if Level is Not System
      * CASE: DTL.Branch/Company Code is Is System
     C           #1BCCD    IFEQ 'SYS'                      *IF
     C                     MOVEL'N'       WUDLBC           Display Level &
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUDLBC           Display Level &
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDLBC           Display Level &
     C                     END                             *FI
      * Convert All File Dates To Screen Dates
     C                     EXSR UASUBR                     Convert All Fil
      * Convert File amounts to function fields
     C                     EXSR UBSUBR                     Convert File am
      * RTV Shortname,name + town - Client Details  *
     C                     EXSR SARVGN
     C                     MOVELWUCSSN    #DCUSN           Customer  Scree
     C                     MOVELWUCRNM    #DSRNM           Screen Report N
     C                     MOVELWUCRTN    #DSRTN           Screen Report T
      * 00/Copy member SD0452RISE - Client Limits  *
     C/COPY WNCPYSRC,SD0452RISE
     C                     END
      *
     C                     ELSE
      * If record already exists, error
     C           *IN90     IFEQ '0'
     C                     SETON                     993132*
     C                     SETON                     33    *
      * Send message 'Client Limits          EX'
     C                     MOVEL'USR0666' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      * USER: Initialize detail screen (new record)
      * Set-up DTL Screen Footer - Standard Functions  *
     C*
     C*  DETAIL LINE COMMAND KEY TEXT
     C*
     C                     MOVEL'SDUSRMSG'WUMSGF 10
     C                     MOVE *BLANKS   WUMTXT 80
     C*
     C*  If Action Code is Delete :
     C*
     C           #PANCD    IFEQ 'D'                                       S01229
     C* Setup footer text:
     C* F3=Main Menu   F10=Delete   F12=Previous
     C                     MOVEL'USR3350' WUMSID  7        Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     END
     C*
     C*  If Action Code is Insert :
     C*
     C           #PANCD    IFEQ 'I'                                       S01229
     C* Setup footer text:
     C* F3=Exit   F12=Previous
     C                     MOVEL'USR3351' WUMSID           Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     END
     C*
     C*  If Action Code is Amend :
     C*
     C           #PANCD    IFEQ 'A'                                       S01229
     C* Setup footer text:
     C* F3=Main Menu   F12=Previous
     C                     MOVEL'USR3346' WUMSID           Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     END
     C*
      * Display Level and Branch/company Code?
      * CASE: WRK.Multi-branching Indicator is Multi-branched
     C           WUMBIN    IFEQ 'Y'                        *IF
      * Only if Level is Not System
      * CASE: DTL.Branch/Company Code is Is System
     C           #1BCCD    IFEQ 'SYS'                      *IF
     C                     MOVEL'N'       WUDLBC           Display Level &
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUDLBC           Display Level &
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDLBC           Display Level &
     C                     END                             *FI
      * RTV Shortname,name + town - Client Details  *
     C                     EXSR SBRVGN
     C                     MOVELWUCSSN    #DCUSN           Customer  Scree
     C                     MOVELWUCRNM    #DSRNM           Screen Report N
     C                     MOVELWUCRTN    #DSRTN           Screen Report T
      * 00/Copy member SD0452RISN - Client Limits  *
     C/COPY WNCPYSRC,SD0452RISN
     C                     END
     C                     END
      *..................................................
     C   99                GOTO BEEXIT
      * No error: Display and process details
     C                     EXSR CADSDA
      *
      *================================================================
     CSR         BEEXIT    ENDSR
      /EJECT
     CSR         BFVLKY    BEGSR
      *================================================================
      * Validate key fields
      *================================================================
     C           W0PMD     IFNE 'ADD'
      * Select existing record
     C                     EXSR VACKRL
     C                     END
      * Check relations
      * Check reference to Client Details
     C                     EXSR VBCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
      * USER: Validate key screen
      * 00/Copy member SD0452RVKS - Client Limits  *
     C/COPY WNCPYSRC,SD0452RVKS
      * Customer Number required
     C           #1CUST    IFEQ *BLANK                     IF
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Level required
     C           #1LEVL    IFEQ *BLANK                     IF
     C                     SETON                     9932  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Branch/Company Code required
     C           #1BCCD    IFEQ *BLANK                     IF
     C                     SETON                     9933  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         BFEXIT    ENDSR
      /EJECT
     CSR         CADSDA    BEGSR
      *================================================================
      * Display and process detail screen
      *================================================================
      * Conduct detail screen conversation
      * - repeat until screen control flag is reset:
     C           W0TRN     DOWEQ'Y'
      * Display detail screen
     C                     EXSR CBEXFM
      * Process response to detail screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Redisplay previous screen
     C   12                CAS            CCDSPV
      * HOME: Reset screen fields
     C   05                CAS            CCDSPV
      * Process detail screen input
     C                     CAS            CFPRSC
     C                     END
     C           W0TRN     IFEQ 'R'
     C           W0PMD     IFEQ 'ADD'
     C                     EXSR MAIZ#1
     C                     END
     C                     END
      *
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         CBEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSAD
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                         86*
     C           *IN89     IFNE CBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     CBIN89  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y1SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT2
     C                     EXFMT#RCDDTL1
      * Test cursor
     C                     EXSR Y8TST
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CBEXIT    ENDSR
      /EJECT
     CSR         CCDSPV    BEGSR
      *================================================================
      * Redisplay previous screen
      *================================================================
      * USER: Process key screen request
      * 00/Copy member SD0452RPKR - Client Limits  *
     C/COPY WNCPYSRC,SD0452RPKR
     C                     MOVEL'USR0790' P3DRTC           Duplicate Retur
     C                     MOVEL*BLANK    P0RTN            *Return code
     C                     EXSR ZYEXPG
     C   05                MOVEL'R'       W0TRN
     C   12                MOVEL'K'       W0TRN
      *================================================================
     CSR         CCEXIT    ENDSR
      /EJECT
     CSR         CFPRSC    BEGSR
      *================================================================
      * Validate record
      *================================================================
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * If delete is not pending....
      * Validate details
     C  N10                CAS            DCVLDL
     C                     END
      * QUIT if error:
     C   99                GOTO CFEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       CFEXIT
      * No error: update record
     C                     EXSR EBPR##
      *================================================================
     CSR         CFEXIT    ENDSR
      /EJECT
     CSR         DCVLDL    BEGSR
      *================================================================
      * Validate details
      *================================================================
      * Validate Lending Limit Frequency
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1LLFR    W0NSRQ  1        Lending Limit F
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1177903   Y2LSNO  70
     C           #1LLFR    PARM #1LLFR    W0EXVL 20        Lending Limit F
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Prec metals review freq
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1PLRF    W0NSRQ  1        Prec metals rev
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1174685   Y2LSNO  70
     C           #1PLRF    PARM #1PLRF    W0EXVL 20        Prec metals rev
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Secured
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1SECD    W0NSRQ  1        Secured
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1131599   Y2LSNO  70
     C           #1SECD    PARM #1SECD    W0EXVL 20        Secured
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * USER: Validate detail screen fields
      * Disable ENTER in Delete Mode
      * CASE: PAR.Action Code is Delete
     C           P2ANCD    IFEQ 'D'                        *IF
      * Send message 'F3/F10/F12 only valid opt'
     C                     MOVEL'USR0536' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO DCEXIT                     *QUIT
     C                     END                             *FI
      * Validate Lmt fields 2nd
      *** REVERSE OUT 107583                                              139827
      * Start of 107583
      * Corrected the conditioning of the lending fields.
      * 'Lending details entered' flag
      * CASE: PAR.Display Lending fields is Yes
     C*****      WUW0ST    IFEQ 'Y'                        *IF            139287
      * Validate Lmt fields 2nd                                           139287
      * Customer Lending 'Details entered' flag.                          139287
      * CASE: Condition on both MM Dealing & Lending (E088472)            139287
      *  - c1 OR c2                                                       139287
      *   |- c1    : WRK.Customer Lending is Yes                          139287
      *   |- c2    : WRK.Dealing: MM is Yes                               139287
      *   '-                                                              139287
     C           WUCSLN    IFEQ 'Y'                        *IF            139287
     C           WUDLMM    OREQ 'Y'                        *OR            139287
     C                     MOVEL'1'       WUDELN           Details Entered
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'0'       WUDELN           Details Entered
     C                     END                             *FI
      * End of 107583
      * Precious Metal 'details entered' flag.
      * CASE: WRK.SAR S01433 is Present
     C           WUSARF    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       WUDEPR           Details entered
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'0'       WUDEPR           Details entered
     C                     END                             *FI
      * Start of 107583
      * Corrected the conditioning of the lending fields.
      * Lending
      * CASE: PAR.Display Lending fields is Yes
     C*****      WUW0ST    IFEQ 'Y'                        *IF            139827
      * CASE: Condition on both MM Dealing & Lending  (E088472)           139827
      *  - c1 OR c2                                                       139827
      *   |- c1    : PAR.Customer Lending is Yes                          139827
      *   |- c2    : WRK.Dealing: MM is Yes                               139827
      *   '-                                                              139827
     C           WUCSLN    IFEQ 'Y'                        *IF            139827
     C           WUDLMM    OREQ 'Y'                        *OR            139827
      * Test for Blanks in Status fields
     C                     EXSR UCSUBR                     Test for Blanks
      * If Lending Limit Type is Blank, all other fields must be Blank
      * CASE: PAR.Lending Limit Type is equal blank
     C           #1LLTY    IFEQ *BLANK                     *IF
      * CASE: PAR.LN Limit Amount Screen DS is Not Equal Blank
     C           #DLLAS    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1LLTY    ZA0001           Lending Limit T
      * Send message 'Lending Limit Type Req'
     C                     MOVEL'USR0686' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: PAR.LN Expiry Date Screen DS is Not Equal Blank
     C           #DSLED    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1LLTY    ZA0002           Lending Limit T
      * Send message 'Lending Limit Type Req'
     C                     MOVEL'USR0686' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: PAR.LN Review Date Screen DS is Not Equal Blank
     C           #DSLRD    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1LLTY    ZA0003           Lending Limit T
      * Send message 'Lending Limit Type Req'
     C                     MOVEL'USR0686' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: WRK.Blank in Frequency Field is Blank not in Field
     C           WUBIFF    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#1LLTY    ZA0004           Lending Limit T
      * Send message 'Lending Limit Type Req'
     C                     MOVEL'USR0686' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: PAR.LN Freq Day Number DS is Not Equal Blank
     C           #DLFDS    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1LLTY    ZA0005           Lending Limit T
      * Send message 'Lending Limit Type Req'
     C                     MOVEL'USR0686' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: WRK.Blank in Secured Field is Blank not in Field
     C           WUBISF    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#1LLTY    ZA0006           Lending Limit T
      * Send message 'Lending Limit Type Req'
     C                     MOVEL'USR0686' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'0'       WUDELN           Details Entered
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * LN - Blank out file dates and numerics
     C                     EXSR UDSUBR                     LN - Blank out
     C                     END                             *FI
      * End of 107583
      * Precious Metals
      * CASE: PAR.SAR S01433 is Present
     C           WUSARF    IFEQ 'Y'                        *IF
      * Test for Blanks in Status fields
     C                     EXSR UESUBR                     Test for Blanks
      * If PR Limit Type is Blank, all other fields must be Blank
      * CASE: PAR.Prec metals limit type is equal blank
     C           #1PLTY    IFEQ *BLANK                     *IF
      * CASE: PAR.PR spot lmt amt screen DS is Not equal blank
     C           #DPSLS    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1PLTY    ZA0007           Prec metals lim
      * Send message 'PR Limit type is req'
     C                     MOVEL'USR2171' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: PAR.PR expiry date screen DS is Not equal blank
     C           #DPEDS    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1PLTY    ZA0008           Prec metals lim
      * Send message 'PR Limit type is req'
     C                     MOVEL'USR2171' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: PAR.PR review date screen DS is Not equal blank
     C           #DPRDS    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1PLTY    ZA0009           Prec metals lim
      * Send message 'PR Limit type is req'
     C                     MOVEL'USR2171' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: WRK.Blank in Frequency Field is Blank not in Field
     C           WUBIFF    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#1PLTY    ZA0010           Prec metals lim
      * Send message 'PR Limit type is req'
     C                     MOVEL'USR2171' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: PAR.PR Frwd lmt amt screen DS is not equal blank
     C           #DPFLS    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1PLTY    ZA0011           Prec metals lim
      * Send message 'PR Limit type is req'
     C                     MOVEL'USR2171' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: PAR.PR line amount screen DS is not equal blank
     C           #DPLAS    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1PLTY    ZA0012           Prec metals lim
      * Send message 'PR Limit type is req'
     C                     MOVEL'USR2171' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'0'       WUDEPR           Details entered
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#1PLTY    WUTQKF           Test ? in Key F
      * CASE: WRK.Test ? in Key Field is Question Mark
     C           WUTQKF    IFEQ '?'                        *IF
     C                     MOVEL#1PLTY    WULMTY           Limit Type
      * Select Limits - Limit types  *
     C                     CALL 'SD0141S'              90  Select Limits
     C                     PARM *BLANK    W0RTN   7
     C           WULMTY    PARM WULMTY    WQ0056  3        Limit Type
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0141S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVELWULMTY    #1PLTY           Prec metals lim
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#1PLTY    WULMTY           Limit Type
      * Does Limit Type exist? - Limit types  *
     C                     EXSR SCRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Setup message data for message
     C                     MOVEL#1PLTY    ZA0013           Prec metals lim
      * Send message 'PR limit type not found'
     C                     MOVEL'USR2191' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * PR - Blank out file dates and numerics
     C                     EXSR UFSUBR                     PR - Blank out
     C                     END                             *FI
      * Start of 107583
      * Corrected the conditioning of the lending fields.
      * Lending
      * CASE: PAR.Display Lending fields is Yes
     C*****      WUW0ST    IFEQ 'Y'                        *IF            139827
      * CASE: Condition on both MM Dealing & Lending  (E088472)           139827
      *  - c1 OR c2                                                       139827
      *   |- c1    : PAR.Customer Lending is Yes                          139827
      *   |- c2    : WRK.Dealing: MM is Yes                               139827
      *   '-                                                              139827
     C           WUCSLN    IFEQ 'Y'                        *IF            139827
     C           WUDLMM    OREQ 'Y'                        *OR            139827
      * CASE: WRK.Details Entered - LN is Details Entered
     C           WUDELN    IFEQ '1'                        *IF
      * Validate LN Fields
     C                     EXSR UGSUBR                     Validate LN Fie
     C                     END                             *FI
     C                     END                             *FI
      * End of 107583
      * Precious Metals
      * CASE: PAR.SAR S01433 is Present
     C           WUSARF    IFEQ 'Y'                        *IF
      * CASE: WRK.Details entered - PR is Details Entered
     C           WUDEPR    IFEQ '1'                        *IF
      * Validate PR Fields
     C                     EXSR UJSUBR                     Validate PR Fie
     C                     END                             *FI
     C                     END                             *FI
      * Start of 063211
      * CASE: PAR.SAR S01433 is Present
     C           WUSARF    IFEQ 'Y'                        *IF
      * Start of 077893
      * CASE: WRK.Details entered - PR is Details Entered
     C           WUDEPR    IFEQ '1'                        *IF
      * Either Spot limit amount or Forward Limit amount must be entered.
      * CASE: WRK.Spot Limit Amount Flag is Blank
     C           WUSLAF    IFEQ 'N'                        *IF
      * CASE: WRK.Forward Limit Amount Flag is Blank
     C           WUFLAF    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL#DPSLS    ZA0056           PR spot lmt amt
     C                     MOVEL#DPFLS    ZA0057           PR Frwd lmt amt
      * Send message 'Either Spot / frwd is req'
     C                     MOVEL'USR2201' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993442*
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * End of 077893
     C                     END                             *FI
      * End of 063211
      *                                                                   CDL006
      ** Validate Dealing Fiduciary Limit Details if switchable           CDL006
      ** feature CDL006 is on.                                            CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** Dealing Fiduciary Limit Type Validation.                         CDL006
      ** If Dealing Fiduciary Limit Type is blank, all other field        CDL006
      ** must be blank.                                                   CDL006
      *                                                                   CDL006
     C           SZFILT    IFEQ *BLANKS                                   CDL006
      *                                                                   CDL006
     C           SZFILA    IFNE *BLANKS                                   CDL006
      *                                                                   CDL006
      ** Setup message data for message                                   CDL006
     C                     MOVELSZFILT    ZA0059                          CDL006
      *                                                                   CDL006
      ** Send message 'DL Fid. Limit type is required'                    CDL006
     C                     MOVEL'USR8615' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     SETON                     9946                 CDL006
     C                     ELSE                                           CDL006
     C                     SETOF                     9946                 CDL006
     C                     MOVEL*BLANKS   SZFILA                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Otherwise DL Fid. Limit type is entered                          CDL006
     C                     MOVELSZFILT    WUTQKF                          CDL006
      *                                                                   CDL006
      ** Test Key field if entry is Question Mark (?)                     CDL006
     C           WUTQKF    IFEQ '?'                                       CDL006
     C                     MOVELSZFILT    WULMTY                          CDL006
      *                                                                   CDL006
      ** Select Limits - Limit types                                      CDL006
     C                     CALL 'SD0141S'              90                 CDL006
     C                     PARM *BLANK    W0RTN   7                       CDL006
     C           WULMTY    PARM WULMTY    WQ0056  3                       CDL006
      *                                                                   CDL006
     C           *IN90     IFEQ '1'                                       CDL006
      *                                                                   CDL006
      ** Call to program ended in error                                   CDL006
     C                     MOVEL'Y2U0032' W0RTN                           CDL006
     C                     MOVEL*BLANKS   W0CLPG 10                       CDL006
     C                     MOVEL'SD0141S' W0CLPG                          CDL006
      *                                                                   CDL006
      ** Send message '*Error occured on CALL...'                         CDL006
     C                     MOVEL'Y2U0032' ZAMSID                          CDL006
     C                     MOVEL'Y2USRMSG'ZAMSGF                          CDL006
     C                     MOVELW0CLPG    ZAMSDA                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Error detected?                                                  CDL006
     C           W0RTN     IFNE *BLANK                                    CDL006
     C                     SETON                     9946                 CDL006
     C                     ELSE                                           CDL006
     C                     SETOF                     9946                 CDL006
     C                     END                                            CDL006
     C                     MOVELWULMTY    SZFILT                          CDL006
     C                     MOVEL'Y'       W0DCF                           CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** DL Fid. Limit type entry is not question mark(?)                 CDL006
      *                                                                   CDL006
     C                     MOVELSZFILT    @CRNB                           CDL006
      *                                                                   CDL006
     C                     CALL 'AOLIMTR0'                                CDL006
     C                     PARM '*MSG   ' @RTCD   7                       CDL006
     C                     PARM '*KEY   ' @OPTN   7                       CDL006
     C                     PARM           @CRNB   3                       CDL006
     C           SDLIMT    PARM SDLIMT    DSFDY                           CDL006
      *                                                                   CDL006
      ** Return code is: Record does not exist (*NRF)                     CDL006
     C           @RTCD     IFNE *BLANKS                                   CDL006
      *                                                                   CDL006
      ** Clear message from program message queue sent by the             CDL006
      ** Access object called.                                            CDL006
     C                     CALL 'Y2CLMSC'                                 CDL006
     C                     PARM ##PGM     ZAPGMQ                          CDL006
     C                     PARM '*SAME'   ZAPGRL                          CDL006
      *                                                                   CDL006
      ** Setup message data for message                                   CDL006
     C                     MOVELSZFILT    ZA0060                          CDL006
      *                                                                   CDL006
      ** Send message 'DL Fid. limit type not found'                      CDL006
     C                     MOVEL'USR8616' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     SETON                     9946                 CDL006
     C                     ELSE                                           CDL006
     C                     SETOF                     9946                 CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Dealing Fiduciary Limit Amount Validation                        CDL006
      ** Amount entry is required if Limit type is entered.               CDL006
      *                                                                   CDL006
     C           SZFILA    IFEQ *BLANKS                                   CDL006
     C           SZFILT    IFNE *BLANKS                                   CDL006
      *                                                                   CDL006
      ** Setup message data for message                                   CDL006
     C                     MOVELSZFILA    ZA0061                          CDL006
      *                                                                   CDL006
      ** Send message 'DL Fid Limit Amount Required'                      CDL006
     C                     MOVEL'USR8617' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     SETON                     9947                 CDL006
     C                     ELSE                                           CDL006
     C                     SETOF                     9947                 CDL006
     C                     MOVEL*BLANKS   SZFILT                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Otherwise Amount is entered                                      CDL006
     C                     MOVEL*BLANK    WUZASF                          CDL006
     C                     MOVELSZFILA    WUZASF                          CDL006
      *                                                                   CDL006
      ** Call ZALIGN & ZEDIT                                              CDL006
      ** ZALIGN Screen Field - Standard Functions                         CDL006
     C                     CALL 'ZALIGN'               90                 CDL006
     C           W0RTN     PARM W0RTN     WQ0057                          CDL006
     C           WUZASF    PARM WUZASF    WQ0058                          CDL006
     C                     PARM *ZERO     WQ0059                          CDL006
     C                     PARM 9         WQ0060                          CDL006
     C           WUZAFF    PARM *BLANK    WQ0061                          CDL006
      *                                                                   CDL006
     C           *IN90     IFEQ '1'                                       CDL006
      *                                                                   CDL006
      ** Call to program ended in error                                   CDL006
     C                     MOVEL'Y2U0032' W0RTN                           CDL006
     C                     MOVEL*BLANKS   W0CLPG                          CDL006
     C                     MOVEL'ZALIGN'  W0CLPG                          CDL006
      *                                                                   CDL006
      ** Send message '*Error occured on CALL...'                         CDL006
     C                     MOVEL'Y2U0032' ZAMSID                          CDL006
     C                     MOVEL'Y2USRMSG'ZAMSGF                          CDL006
     C                     MOVELW0CLPG    ZAMSDA                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Error detected?                                                  CDL006
     C           W0RTN     IFNE *BLANK                                    CDL006
     C                     SETON                     99                   CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Return code is: Old Table Error                                  CDL006
     C           W0RTN     IFEQ '*ERROR*'                                 CDL006
     C                     MOVEL'Y'       WUILAM                          CDL006
     C                     ELSE                                           CDL006
     C                     MOVEL'N'       WUILAM                          CDL006
      *                                                                   CDL006
      ** ZEDIT Screen Field - Standard Functions                          CDL006
     C                     CALL 'ZEDIT'                90                 CDL006
     C           WUZASF    PARM WUZASF    WQ0062                          CDL006
     C                     PARM *ZERO     WQ0063                          CDL006
      *                                                                   CDL006
     C           *IN90     IFEQ '1'                                       CDL006
      *                                                                   CDL006
      ** Call to program ended in error                                   CDL006
     C                     MOVEL'Y2U0032' W0RTN                           CDL006
     C                     MOVEL*BLANKS   W0CLPG                          CDL006
     C                     MOVEL'ZEDIT'   W0CLPG                          CDL006
      *                                                                   CDL006
      ** Send message '*Error occured on CALL...'                         CDL006
     C                     MOVEL'Y2U0032' ZAMSID                          CDL006
     C                     MOVEL'Y2USRMSG'ZAMSGF                          CDL006
     C                     MOVELW0CLPG    ZAMSDA                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Invalid Limit Amount is Error Found                              CDL006
     C           WUILAM    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** Setup message data for message                                   CDL006
     C                     MOVELSZFILA    ZA0062                          CDL006
      *                                                                   CDL006
      ** Send message 'Limit Amount Not Numeric'                          CDL006
     C                     MOVEL'USR0788' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     SETON                     9947                 CDL006
      *                                                                   CDL006
     C                     ELSE                                           CDL006
     C*                                                                   CDL006
     C** Move ZALIGN Screen function field into DL Fid Limit Amount       CDL006
     C** screen function field if validation complete                     CDL006
     C                     MOVE WUZASF    SZFILA                          CDL006
     C                     MOVE WUZAFF    S1FILA                          CDL006
      *                                                                   CDL006
      ** Entered Limit Amount is Equal Zero.                              CDL006
     C           S1FILA    IFEQ *ZERO                                     CDL006
      *                                                                   CDL006
      ** Setup message data for message                                   CDL006
     C                     MOVELSZFILA    ZA0063                          CDL006
      *                                                                   CDL006
      ** Send message 'DL Fid Limit Amount GT Zero'                       CDL006
     C                     MOVEL'USR8617' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     SETON                     9947                 CDL006
      *                                                                   CDL006
     C                     END                                            CDL006
     C                     END                                            CDL006
     C                     END                                            CDL006
     C                     ENDIF                                          CDL006
      * Start of 077893
      * CASE:
      *  - c1 AND c2 AND c3
      *   |- c1    : WRK.Input field is No
      *   |- c2    : WRK.Details entered - PR is Details not entered
      *   |- c3    : WRK.Details Entered - LN is Details Not Entered
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WUINPT    IFEQ 'N'                        *IF
     C           WUDEPR    IFEQ '0'                        *IF
     C           WUDELN    IFEQ '0'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
      * Send message 'No Details Entered'
     C                     MOVEL'USR0708' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
      * End of 077893
      * 00/Copy member SD0452RVSF - Client Limits  *
     C/COPY WNCPYSRC,SD0452RVSF
      * Check relations
      **Check*reference to Limit types                                                        192740
     C**********           EXSR VCCKRL                                                        192740
     C********** W0RTN     IFNE *BLANK                                                        192740
     C**********           SETON                     99    *                                  192740
     C**********           END                                                                192740
      * Check reference to Limit types
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
      * CALC: Detail screen function fields
      * 00/Copy member SD0452RSFF - Client Limits  *
     C/COPY WNCPYSRC,SD0452RSFF
      * USER: Validate detail screen relations
      * 00/Copy member SD0452RVSR - Client Limits  *
     C/COPY WNCPYSRC,SD0452RVSR
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         EBPR##    BEGSR
      *================================================================
      * Process record:
      *================================================================
      * Process delete request
     C   10                CAS            EDDLRQ
      * Process add request
     C           W0PMD     CASEQ'ADD'     ECADRQ
      * Process update request
     C           W0PMD     CASNE'ADD'     EECHRQ
     C                     END
     C           W0RTN     IFNE *BLANK
      * Error: ROLLBACK any DBF changes
     C                     ROLBK
     C                     GOTO EBEXIT
     C                     ELSE
      * Otherwise COMMIT any DBF changes
     C                     COMIT
     C/COPY WNCPYSRC,SD0452RC05
     C                     END
     C           W0RTN     IFEQ *BLANK
      * USER: Process command keys
      * 00/Copy member SD0452RPCK - Client Limits  *
     C/COPY WNCPYSRC,SD0452RPCK
     C           W0PMD     IFEQ 'ADD'
      * Exit after successful add
     C                     MOVEL'N'       W0RPT
     C                     END
      * Restart program for next record
     C                     MOVEL'N'       W0TRN
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * Create Client Lmt 2nd scr - Client Limits  *
     C                     EXSR SDCRRC
     C           W0RTN     IFEQ *BLANK
      * Send message '*Record added'
     C                     MOVEL'Y2U0011' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request
      *================================================================
      * USER: Delete DBF record
      * Delete Client Lmt 2nd scr - Client Limits  *
     C                     EXSR SFDLRC
     C           W0RTN     IFEQ *BLANK
      * Send message '*Record deleted'
     C                     MOVEL'Y2U0013' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Change Client Lmt 2nd scr - Client Limits  *
     C                     EXSR SHCHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Reset screen fields if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1
     C                     END
     C                     ELSE
      * Send message '*Record changed'
     C                     MOVEL'Y2U0012' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACKPM    BEGSR
      *================================================================
      * Check passed parameters
      *================================================================
      * Is full key present?
     C           P1CUST    IFEQ *BLANK                     Customer Number
     C           P1LEVL    OREQ *BLANK                     Level
     C           P1BCCD    OREQ *BLANK                     Branch/Company
      * Not every key field passed - loop program
     C                     MOVEL'Y'       W0RPT   1
     C                     ELSE
      * Full key passed, so single shot program
     C                     MOVEL'N'       W0RPT
     C                     END
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         GADSAK    BEGSR
      *================================================================
      * Set key screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
     C                     MOVEL'0'       *IN79
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSAD    BEGSR
      *================================================================
      * Set detail screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect key fields on detail screen
     C                     SETON                     88    *
     C                     MOVEL'0'       *IN79
     C           WUDLBC    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL'0'       *IN76
     C                     MOVEL'0'       *IN78
     C           WUW0ST    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN76
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL'0'       *IN75
     C                     MOVEL'0'       *IN77
     C           WUSARF    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN75
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
      * Enable key screen
     C                     SETON                     87    *
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise record - except for key fields and "neither" paramete
      *================================================================
     C                     MOVEL*BLANK    #PDRTC           Duplicate Retur
     C                     MOVELP2ANCD    #PANCD           Action Code
     C                     Z-ADDP1LCD     #1LCD            Last Change Dat
     C                     MOVELP1TYLC    #1TYLC           Type of Last Ch
     C                     MOVELP1FXLT    #1FXLT           FX Limit Type
     C                     Z-ADDP1FLAM    #1FLAM           FX Limit Amount
     C                     MOVEL*BLANK    #DFLAS           Fx Limit Amount
     C                     Z-ADDP1LLAM    #1LLAM           Lending Limit A
     C                     MOVEL*BLANK    #DSFED           FX Expiry Date
     C                     MOVEL*BLANK    #DSFRD           FX Review Date
     C                     Z-ADDP1FLED    #1FLED           FX Limit Expiry
     C                     Z-ADDP1FLRD    #1FLRD           FX Limit Review
     C                     MOVELP1FLFQ    #1FLFQ           FX Limit Freque
     C                     Z-ADDP1FFDN    #1FFDN           FX Frequency Da
     C                     MOVEL*BLANK    #DFFDS           FX Freq Day No
     C                     Z-ADDP1LFDN    #1LFDN           Lending Frequen
     C                     Z-ADDP1MDDR    #1MDDR           MDDR Amount
     C                     MOVEL*BLANK    #DMDAS           MDDR Amount Scr
     C                     Z-ADDP1LLED    #1LLED           Lending Limit E
     C                     Z-ADDP1LLRD    #1LLRD           Lending Limit R
     C                     Z-ADDP1FRLA    #1FRLA           FRA Limit Amoun
     C                     MOVEL*BLANK    #DRLAS           FRA Limit Amoun
     C                     MOVEL*BLANK    #DILAS           IRS Limit Amoun
     C                     Z-ADDP1IRLM    #1IRLM           IRS Limit Amoun
     C                     MOVEL*BLANK    #DSRED           FRA Expiry Date
     C                     MOVEL*BLANK    #DSIED           IRS Expiry Date
     C                     MOVEL*BLANK    #DSRRD           FRA Review Date
     C                     MOVEL*BLANK    #DSIRD           IRS Review Date
     C                     Z-ADDP1FRED    #1FRED           FRA Expiry Date
     C                     Z-ADDP1FRRD    #1FRRD           FRA Review Date
     C                     MOVELP1FRFQ    #1FRFQ           FRA Review Freq
     C                     MOVELP1IRFQ    #1IRFQ           IRS Review Freq
     C                     Z-ADDP1FRAD    #1FRAD           FRA Frequency D
     C                     MOVEL*BLANK    #DRFDS           FRA Freq Day no
     C                     MOVEL*BLANK    #DIFDS           IRS Freq Day no
     C                     Z-ADDP1IRED    #1IRED           IRS Expiry Date
     C                     Z-ADDP1IRDT    #1IRDT           IRS Review Date
     C                     Z-ADDP1IFDN    #1IFDN           IRS Frequency D
     C                     MOVELP1MMTY    #1MMTY           Money market li
     C                     Z-ADDP1MMAM    #1MMAM           Money market li
     C                     Z-ADDP1MMED    #1MMED           Money market ex
     C                     Z-ADDP1MMRD    #1MMRD           Money market re
     C                     MOVELP1MMFR    #1MMFR           Money market li
     C                     Z-ADDP1MFDN    #1MFDN           Money market Fr
     C                     MOVELP1MSEC    #1MSEC           Money market se
     C                     Z-ADDP1MLAM    #1MLAM           Money market Li
     C                     Z-ADDP1FXLA    #1FXLA           FX line amount
     C                     Z-ADDP1FXFA    #1FXFA           FX Forward limi
     C                     Z-ADDP1PFAM    #1PFAM           Prec metals frw
     C                     Z-ADDP1PSAM    #1PSAM           Prec metal Spot
     C                     Z-ADDP1PLED    #1PLED           Prec metals exp
     C                     Z-ADDP1PLVD    #1PLVD           Prec metals rev
     C                     Z-ADDP1PLAM    #1PLAM           Prec metals lin
     C                     MOVEL*BLANK    #DCUSN           Customer  Scree
     C                     MOVEL*BLANK    #DSRNM           Screen Report N
     C                     MOVEL*BLANK    #DSRTN           Screen Report T
     C                     MOVELP1LLTY    #1LLTY           Lending Limit T
     C                     MOVELP1PLTY    #1PLTY           Prec metals lim
     C                     MOVEL*BLANK    #DLLAS           LN Limit Amount
     C                     MOVEL*BLANK    #DPSLS           PR spot limit a
     C                     MOVEL*BLANK    #DSLED           LN Expiry Date
     C                     MOVEL*BLANK    #DPEDS           PR expiry date
     C                     MOVEL*BLANK    #DSLRD           LN Review Date
     C                     MOVEL*BLANK    #DPRDS           PR review date
     C                     MOVELP1LLFR    #1LLFR           Lending Limit F
     C                     MOVELP1PLRF    #1PLRF           Prec metals rev
     C                     MOVEL*BLANK    #DLFDS           LN Freq Day No
     C                     MOVEL*BLANK    #DPFLS           PR forwrd lmt a
     C                     MOVELP1SECD    #1SECD           Secured
     C                     MOVEL*BLANK    #DPLAS           PR line amount
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     MOVELP1FILT    SZFILT                          CDL006
     C                     MOVELP1FILA    SZFILA                          CDL006
     C                     ENDIF                                          CDL006
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @DZREHT fields to screen
      *================================================================
     C                     Z-ADDDZLCD     #1LCD            Last Change Dat
     C                     MOVELDZTYLC    #1TYLC           Type of Last Ch
     C                     MOVELDZFXLT    #1FXLT           FX Limit Type
     C                     Z-ADDDZFLAM    #1FLAM           FX Limit Amount
     C                     Z-ADDDZLLAM    #1LLAM           Lending Limit A
     C                     Z-ADDDZFLED    #1FLED           FX Limit Expiry
     C                     Z-ADDDZFLRD    #1FLRD           FX Limit Review
     C                     MOVELDZFLFQ    #1FLFQ           FX Limit Freque
     C                     Z-ADDDZFFDN    #1FFDN           FX Frequency Da
     C                     Z-ADDDZLFDN    #1LFDN           Lending Frequen
     C                     Z-ADDDZMDDR    #1MDDR           MDDR Amount
     C                     Z-ADDDZLLED    #1LLED           Lending Limit E
     C                     Z-ADDDZLLRD    #1LLRD           Lending Limit R
     C                     Z-ADDDZFRLA    #1FRLA           FRA Limit Amoun
     C                     Z-ADDDZIRLM    #1IRLM           IRS Limit Amoun
     C                     Z-ADDDZFRED    #1FRED           FRA Expiry Date
     C                     Z-ADDDZFRRD    #1FRRD           FRA Review Date
     C                     MOVELDZFRFQ    #1FRFQ           FRA Review Freq
     C                     MOVELDZIRFQ    #1IRFQ           IRS Review Freq
     C                     Z-ADDDZFRAD    #1FRAD           FRA Frequency D
     C                     Z-ADDDZIRED    #1IRED           IRS Expiry Date
     C                     Z-ADDDZIRDT    #1IRDT           IRS Review Date
     C                     Z-ADDDZIFDN    #1IFDN           IRS Frequency D
     C/COPY WNCPYSRC,SD0452RC10
     C                     MOVELDZMMTY    #1MMTY           Money market li
     C/COPY WNCPYSRC,SD0452RC11
     C                     Z-ADDDZMMAM    #1MMAM           Money market li
     C                     Z-ADDDZMMED    #1MMED           Money market ex
     C                     Z-ADDDZMMRD    #1MMRD           Money market re
     C                     MOVELDZMMFR    #1MMFR           Money market li
     C                     Z-ADDDZMFDN    #1MFDN           Money market Fr
     C                     MOVELDZMSEC    #1MSEC           Money market se
     C                     Z-ADDDZMLAM    #1MLAM           Money market Li
     C                     Z-ADDDZFXLA    #1FXLA           FX line amount
     C                     Z-ADDDZFXFA    #1FXFA           FX Forward limi
     C                     Z-ADDDZPFAM    #1PFAM           Prec metals frw
     C                     Z-ADDDZPSAM    #1PSAM           Prec metal Spot
     C                     Z-ADDDZPLED    #1PLED           Prec metals exp
     C                     Z-ADDDZPLVD    #1PLVD           Prec metals rev
     C                     Z-ADDDZPLAM    #1PLAM           Prec metals lin
     C                     MOVELDZCUST    #1CUST           Customer Number
     C                     MOVELDZLEVL    #1LEVL           Level
     C                     MOVELDZBCCD    #1BCCD           Branch/Company
     C                     MOVELDZLLTY    #1LLTY           Lending Limit T
     C                     MOVELDZPLTY    #1PLTY           Prec metals lim
     C                     MOVELDZLLFR    #1LLFR           Lending Limit F
     C                     MOVELDZPLRF    #1PLRF           Prec metals rev
     C                     MOVELDZSECD    #1SECD           Secured
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     MOVELDZFILT    SZFILT                          CDL006
     C                     MOVELDZFILA    SZFILA                          CDL006
     C                     ENDIF                                          CDL006
      * Hold existing record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#K    BEGSR
      *================================================================
      * Initialize key screen
      *================================================================
     C                     MOVEL*BLANK    #PDRTC           Duplicate Retur
     C                     MOVELP2ANCD    #PANCD           Action Code
     C                     MOVELP1CUST    #1CUST           Customer Number
     C                     MOVELP1LEVL    #1LEVL           Level
     C                     MOVELP1BCCD    #1BCCD           Branch/Company
      * USER: Initialize key screen
      * 00/Copy member SD0452RIKS - Client Limits  *
     C/COPY WNCPYSRC,SD0452RIKS
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * RTV Shortname,name + town - Client Details  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           BBCUST           Customer Number
      * Move fields to key list
     C                     MOVELP1CUST    BBCUST           Customer Number
     C           KRSSA     CHAIN@BBREBF              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0081' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELBBCSSN    WUCSSN           Customer Shortn
     C                     MOVELBBCRTN    WUCRTN           Customer Report
     C                     MOVELBBCRNM    WUCRNM           Customer Report
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * RTV Shortname,name + town - Client Details  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           BBCUST           Customer Number
      * Move fields to key list
     C                     MOVELP1CUST    BBCUST           Customer Number
     C           KRSSB     CHAIN@BBREBF              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0081' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELBBCSSN    WUCSSN           Customer Shortn
     C                     MOVELBBCRTN    WUCRTN           Customer Report
     C                     MOVELBBCRNM    WUCRNM           Customer Report
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Does Limit Type exist? - Limit types  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           A2LMTY           Limit Type
      * Move fields to key list
     C                     MOVELWULMTY    A2LMTY           Limit Type
     C           KRSSC     CHAIN@A2REBU              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0063' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SCEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
     C                     END
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCRRC    BEGSR
      *================================================================
      * Create Client Lmt 2nd scr - Client Limits  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @DZREHS
     C                     MOVEL#1CUST    DZCUST           Customer Number
     C                     MOVEL#1LEVL    DZLEVL           Level
     C                     MOVEL#1BCCD    DZBCCD           Branch/Company
     C                     Z-ADDWURDNB    DZLCD            Last Change Dat
     C                     MOVEL'I'       DZTYLC           Type of Last Ch
     C                     MOVELP1FXLT    DZFXLT           FX Limit Type
     C                     Z-ADDP1FLAM    DZFLAM           FX Limit Amount
     C                     Z-ADDP1FLED    DZFLED           FX Limit Expiry
     C                     Z-ADDP1FLRD    DZFLRD           FX Limit Review
     C                     MOVELP1FLFQ    DZFLFQ           FX Limit Freque
     C                     Z-ADDP1FFDN    DZFFDN           FX Frequency Da
     C                     Z-ADDP1MDDR    DZMDDR           MDDR Amount
     C                     MOVEL#1LLTY    DZLLTY           Lending Limit T
     C                     Z-ADD#1LLAM    DZLLAM           Lending Limit A
     C                     Z-ADD#1LLED    DZLLED           Lending Limit E
     C                     Z-ADD#1LLRD    DZLLRD           Lending Limit R
     C                     MOVEL#1LLFR    DZLLFR           Lending Limit F
     C                     Z-ADD#1LFDN    DZLFDN           Lending Frequen
     C                     MOVEL#1SECD    DZSECD           Secured
     C                     Z-ADDP1FRLA    DZFRLA           FRA Limit Amoun
     C                     Z-ADDP1FRED    DZFRED           FRA Expiry Date
     C                     Z-ADDP1FRRD    DZFRRD           FRA Review Date
     C                     MOVELP1FRFQ    DZFRFQ           FRA Review Freq
     C                     Z-ADDP1FRAD    DZFRAD           FRA Frequency D
     C                     Z-ADDP1IRLM    DZIRLM           IRS Limit Amoun
     C                     Z-ADDP1IRED    DZIRED           IRS Expiry Date
     C                     Z-ADDP1IRDT    DZIRDT           IRS Review Date
     C                     MOVELP1IRFQ    DZIRFQ           IRS Review Freq
     C                     Z-ADDP1IFDN    DZIFDN           IRS Frequency D
     C                     MOVELP1MMTY    DZMMTY           Money market li
     C                     Z-ADDP1MMAM    DZMMAM           Money market li
     C                     Z-ADDP1MMED    DZMMED           Money market ex
     C                     Z-ADDP1MMRD    DZMMRD           Money market re
     C                     MOVELP1MMFR    DZMMFR           Money market li
     C                     Z-ADDP1MFDN    DZMFDN           Money market Fr
     C                     MOVELP1MSEC    DZMSEC           Money market se
     C                     Z-ADDP1MLAM    DZMLAM           Money market Li
     C                     Z-ADDP1FXLA    DZFXLA           FX line amount
     C                     Z-ADDP1FXFA    DZFXFA           FX Forward limi
     C                     MOVEL#1PLTY    DZPLTY           Prec metals lim
     C                     Z-ADD#1PFAM    DZPFAM           Prec metals frw
     C                     Z-ADD#1PSAM    DZPSAM           Prec metal Spot
     C                     Z-ADD#1PLED    DZPLED           Prec metals exp
     C                     Z-ADD#1PLVD    DZPLVD           Prec metals rev
     C                     MOVEL#1PLRF    DZPLRF           Prec metals rev
     C                     Z-ADD#1PLAM    DZPLAM           Prec metals lin
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     Z-ADDS1FILA    DZFILA                          CDL006
     C                     MOVELSZFILT    DZFILT                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CGL011
      ** If CGL011 is installed, move FX Limit Secured parameter          CGL011
      ** field to the file field.                                         CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C                     MOVE P1FLSC    DZFLSC                          CGL011
     C                     ENDIF                                          CGL011
      *
      * USER: Processing before Data update
      * CASE: WRK.Window processing requir. is Yes
     C/COPY WNCPYSRC,SD0452RC08
     C           WUWDPR    IFEQ 'Y'                        *IF
      * WM call Window Manager - Window manager  *
     C/COPY WNCPYSRC,WN0481CCP1                                           S01408
      *                                                                                       CER001
      ** Access SAR details file to determine if ULX004 is on                                 CER001
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                                                           CER001
     C                     MOVE 'I'       UACTCD                                              CER001
     C                     EXSR GET3SC                                                        CER001
      *                                                                                       CER001
      ** CASE: PAR.*Return code is *Previous Screen                                           CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'USR0790'                                                     CER001
     C                     MOVEL'Y'       W0DCF                                               CER001
     C                     GOTO SDEXIT                                                        CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
     C***********          CALL 'WIND01'                                  S01212
     C                     CALL 'WN0010'                                  S01212
     C*********************PARM           ##PGM            Program        S01212
     C                     PARM ##PGM     UPGM   10        Program        S01212
     C*********************PARM *BLANK    FKEY    2        Function Key   S01212
     C                     PARM *BLANK    UFKEY   2        Function Key   S01212
     C*********************PARM           WUMEST           Action  S01212 S01229
     C*********************PARM           WUWMAC           Action  S01212 S01229
     C                     PARM 'I'       UACTCD  1        Action  S01212 S01229
     C                     PARM           DATA             Trans Data     S01212
     C                     PARM *BLANK    W0RTN            Return Code    S01212
     C                     PARM           SPARE 256        Spare Field    LN0355
      * WM Check Return
      * CASE: PAR.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C/COPY WNCPYSRC,SD0452RC03
     C                     EXSR ZYEXPG
     C                     ELSE
      * CASE: PAR.*Return code is WN Window Error
     C           W0RTN     IFEQ 'USR0563'                  *IF
      * Send message 'WN Window Error'
     C                     MOVEL'USR0563' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SDEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *DBF update error
     C           W0RTN     IFEQ 'Y2U0004'                  *IF
      * Send message 'WN Database Error'
     C                     MOVEL'USR0567' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SDEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *Previous Screen
     C           W0RTN     IFEQ 'USR0790'                  *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SDEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * 00/Copy member SD0452RCBW - Client Limits  *
     C/COPY WNCPYSRC,SD0452RCBW
     C                     END                             *FI
      * 00/Copy member SD0452RCBU - Client Limits  *
     C/COPY WNCPYSRC,SD0452RCBU
     C           KLCRSD    KLIST
     C                     KFLD           DZCUST           Customer Number
     C                     KFLD           DZLEVL           Level
     C                     KFLD           DZBCCD           Branch/Company
      * Check for duplicate primary key
     C           KLCRSD    SETLL@DZREHS                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR0666' W0RTN   7
      * Send message 'Client Limits          EX'
     C                     MOVEL'USR0666' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     END
      *
     C                     WRITE@DZREHS                91  *
     C/COPY WNCPYSRC,SD0452RC06
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SECHRC
      * 00/Copy member SD0452RCAU - Client Limits  *
     C/COPY WNCPYSRC,SD0452RCAU
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YARDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDCLLMPD'AHFLNM           Filename
      *
     C           KLCHSE    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSE    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SEEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YARDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YARDCS
     C                     MOVE 'Y'       YARDC
     C                     END
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFDLRC    BEGSR
      *================================================================
      * Delete Client Lmt 2nd scr - Client Limits  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data update
      * CASE: PAR.Action Code is Delete
     C           P2ANCD    IFEQ 'D'                        *IF
      * CASE: WRK.Window processing requir. is Yes
     C           WUWDPR    IFEQ 'Y'                        *IF
      * WM call Window Manager - Window manager  *
     C/COPY WNCPYSRC,WN0481CCP1                                           S01408
      *                                                                                       CER001
      ** Access SAR details file to determine if ULX004 is on                                 CER001
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                                                           CER001
     C                     MOVE 'D'       UACTCD                                              CER001
     C                     EXSR GET3SC                                                        CER001
      *                                                                                       CER001
      ** CASE: PAR.*Return code is *Previous Screen                                           CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'USR0790'                                                     CER001
     C                     MOVEL'Y'       W0DCF                                               CER001
     C                     GOTO SFEXIT                                                        CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
     C***********          CALL 'WIND01'                                  S01212
     C                     CALL 'WN0010'                                  S01212
     C*********************PARM           ##PGM            Program        S01212
     C                     PARM ##PGM     UPGM   10        Program        S01212
     C*********************PARM *BLANK    FKEY    2        Function Key   S01212
     C                     PARM *BLANK    UFKEY   2        Function Key   S01212
     C*********************PARM           WUMEST           Action  S01212 S01229
     C*********************PARM           WUWMAC           Action  S01212 S01229
     C                     PARM 'D'       UACTCD  1        Action  S01212 S01229
     C                     PARM           DATA             Trans Data     S01212
     C                     PARM *BLANK    W0RTN            Return Code    S01212
     C                     PARM           SPARE 256        Spare Field    LN0355
      * 00/Copy member SD0452RDBW - Client Limits  *
     C/COPY WNCPYSRC,SD0452RDBW
     C                     END                             *FI
      * 00/Copy member SD0452RDBU - Client Limits  *
     C/COPY WNCPYSRC,SD0452RDBU
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Function key not allowed'
     C                     MOVEL'USR0533' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y2U0004' W0RTN            *Return code
     C                     GOTO SFEXIT                     *QUIT
     C                     END                             *FI
      * Move key fields to @DZREHS
     C                     MOVEL#1CUST    DZCUST           Customer Number
     C                     MOVEL#1LEVL    DZLEVL           Level
     C                     MOVEL#1BCCD    DZBCCD           Branch/Company
      *
     C           KLDLSF    KLIST
     C                     KFLD           DZCUST           Customer Number
     C                     KFLD           DZLEVL           Level
     C                     KFLD           DZBCCD           Branch/Company
     C           KLDLSF    CHAIN@DZREHS              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C           KLDLSF    SETLL@DZREHS              9091  *
     C                     GOTO SFEXIT
     C                     END                             FI #1DBRC
      *................................................................
     C/COPY WNCPYSRC,SD0452RC12
     C                     DELET@DZREHS                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      * USER: Processing after Data update
      * Start of change 122096
      * WUDELR Data Structure - SD Deleted Records File  *
     C                     MOVEL@1DBRC    WUDELR
      * Concat the three part key into one field
     C           #1CUST    CAT  #1LEVL    WULKEY    P      Long Key
     C           WULKEY    CAT  #1BCCD    WULKEY    P      Long Key
      * Write Deleted Record - SD Deleted Records File  *
     C                     CLEARPARC
     C                     MOVEL'SDCLLMPD'PAFNME           File name
     C                     MOVELWULKEY    PALKEY           Long Key
     C                     MOVELWUDR01    PADR01           Deleted Data Re
     C                     MOVELWUDR02    PADR02           Deleted Data Re
     C                     MOVELWUDR03    PADR03           Deleted Data Re
     C                     MOVELWUDR04    PADR04           Deleted Data Re
     C                     MOVELWUDR05    PADR05           Deleted Data Re
     C                     MOVELWUDR06    PADR06           Deleted Data Re
     C                     MOVELWUDR07    PADR07           Deleted Data Re
     C                     MOVELWUDR08    PADR08           Deleted Data Re
     C                     MOVELWUDR09    PADR09           Deleted Data Re
     C                     MOVELWUDR00    PADR00           Deleted Data Re
     C                     MOVELWUDR11    PADR11           Deleted Data Re
     C                     MOVELWUDR12    PADR12           Deleted Data Re
     C                     Z-ADDWURDNB    PALCD            Last Change Dat
     C                     MOVEL'D'       PATYLC           Type of Last Ch
      *
     C                     CALL 'SD0520X'              90  Write Deleted R
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             RCD: SD Deleted
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0520X' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * End of change 122096
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD1         WUNODL           No. of Deletes
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SGCHRC
      * 00/Copy member SD0452RDAU - Client Limits  *
     C/COPY WNCPYSRC,SD0452RDAU
     C                     END
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YBRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDCLLMPD'AHFLNM           Filename
      *
     C           KLCHSG    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSG    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SGEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SGEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YBRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YBRDCS
     C                     MOVE 'Y'       YBRDC
     C                     END
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCHRC    BEGSR
      *================================================================
      * Change Client Lmt 2nd scr - Client Limits  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YCRDC   1
      *
      * Move key fields to @DZREHS
     C                     MOVEL#1CUST    DZCUST           Customer Number
     C                     MOVEL#1LEVL    DZLEVL           Level
     C                     MOVEL#1BCCD    DZBCCD           Branch/Company
      *
     C           KLCHSH    KLIST
     C                     KFLD           DZCUST           Customer Number
     C                     KFLD           DZLEVL           Level
     C                     KFLD           DZBCCD           Branch/Company
     C           KLCHSH    CHAIN@DZREHS              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SHEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKSDCLLML0               91  *
     C                     GOTO SHEXIT
     C                     END                             FI #1DBRC
      * Store record data for null update check
     C                     MOVE @1DBRC    YCRDCS
      * Move non-key fields to @DZREHS
     C                     Z-ADDWURDNB    DZLCD            Last Change Dat
     C                     MOVEL'A'       DZTYLC           Type of Last Ch
     C                     MOVELP1FXLT    DZFXLT           FX Limit Type
     C                     Z-ADDP1FLAM    DZFLAM           FX Limit Amount
     C                     Z-ADDP1FLED    DZFLED           FX Limit Expiry
     C                     Z-ADDP1FLRD    DZFLRD           FX Limit Review
     C                     MOVELP1FLFQ    DZFLFQ           FX Limit Freque
     C                     Z-ADDP1FFDN    DZFFDN           FX Frequency Da
     C                     Z-ADDP1MDDR    DZMDDR           MDDR Amount
     C                     MOVEL#1LLTY    DZLLTY           Lending Limit T
     C                     Z-ADD#1LLAM    DZLLAM           Lending Limit A
     C                     Z-ADD#1LLED    DZLLED           Lending Limit E
     C                     Z-ADD#1LLRD    DZLLRD           Lending Limit R
     C                     MOVEL#1LLFR    DZLLFR           Lending Limit F
     C                     Z-ADD#1LFDN    DZLFDN           Lending Frequen
     C                     MOVEL#1SECD    DZSECD           Secured
     C                     Z-ADDP1FRLA    DZFRLA           FRA Limit Amoun
     C                     Z-ADDP1FRED    DZFRED           FRA Expiry Date
     C                     Z-ADDP1FRRD    DZFRRD           FRA Review Date
     C                     MOVELP1FRFQ    DZFRFQ           FRA Review Freq
     C                     Z-ADDP1FRAD    DZFRAD           FRA Frequency D
     C                     Z-ADDP1IRLM    DZIRLM           IRS Limit Amoun
     C                     Z-ADDP1IRED    DZIRED           IRS Expiry Date
     C                     Z-ADDP1IRDT    DZIRDT           IRS Review Date
     C                     MOVELP1IRFQ    DZIRFQ           IRS Review Freq
     C                     Z-ADDP1IFDN    DZIFDN           IRS Frequency D
     C                     MOVELP1MMTY    DZMMTY           Money market li
     C                     Z-ADDP1MMAM    DZMMAM           Money market li
     C                     Z-ADDP1MMED    DZMMED           Money market ex
     C                     Z-ADDP1MMRD    DZMMRD           Money market re
     C                     MOVELP1MMFR    DZMMFR           Money market li
     C                     Z-ADDP1MFDN    DZMFDN           Money market Fr
     C                     MOVELP1MSEC    DZMSEC           Money market se
     C                     Z-ADDP1MLAM    DZMLAM           Money market Li
     C                     Z-ADDP1FXLA    DZFXLA           FX line amount
     C                     Z-ADDP1FXFA    DZFXFA           FX Forward limi
     C                     MOVEL#1PLTY    DZPLTY           Prec metals lim
     C                     Z-ADD#1PFAM    DZPFAM           Prec metals frw
     C                     Z-ADD#1PSAM    DZPSAM           Prec metal Spot
     C                     Z-ADD#1PLED    DZPLED           Prec metals exp
     C                     Z-ADD#1PLVD    DZPLVD           Prec metals rev
     C                     MOVEL#1PLRF    DZPLRF           Prec metals rev
     C                     Z-ADD#1PLAM    DZPLAM           Prec metals lin
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     Z-ADDS1FILA    DZFILA                          CDL006
     C                     MOVELSZFILT    DZFILT                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CGL011
      ** If CGL011 is installed, move FX Limit Secured parameter          CGL011
      ** field to the file field.                                         CGL011
      *                                                                   CGL011
     C           CGL011    IFEQ 'Y'                                       CGL011
     C                     MOVELP1FLSC    DZFLSC                          CGL011
     C                     ENDIF                                          CGL011
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YCRDCS
     C                     MOVE 'Y'       YCRDC
     C                     END
      * USER: Processing before Data update
      * CASE: WRK.Window processing requir. is Yes
     C/COPY WNCPYSRC,SD0452RC09
     C           WUWDPR    IFEQ 'Y'                        *IF
      * WM call Window Manager - Window manager  *
     C/COPY WNCPYSRC,WN0481CCP1                                           S01408
      *                                                                                       CER001
      ** Access SAR details file to determine if ULX004 is on                                 CER001
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                                                           CER001
     C                     MOVE 'A'       UACTCD                                              CER001
     C                     EXSR GET3SC                                                        CER001
      *                                                                                       CER001
      ** CASE: PAR.*Return code is *Previous Screen                                           CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'USR0790'                                                     CER001
     C                     MOVEL'Y'       W0DCF                                               CER001
     C                     GOTO SHEXIT                                                        CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
     C***********          CALL 'WIND01'                                  S01212
     C                     CALL 'WN0010'                                  S01212
     C*********************PARM           ##PGM            Program        S01212
     C                     PARM ##PGM     UPGM   10        Program        S01212
     C*********************PARM *BLANK    FKEY    2        Function Key   S01212
     C                     PARM *BLANK    UFKEY   2        Function Key   S01212
     C*********************PARM           WUMEST           Action  S01212 S01229
     C*********************PARM           WUWMAC           Action  S01212 S01229
     C                     PARM 'A'       UACTCD  1        Action  S01212 S01229
     C                     PARM           DATA             Trans Data     S01212
     C                     PARM *BLANK    W0RTN            Return Code    S01212
     C                     PARM           SPARE 256        Spare Field    LN0355
      * WM Check Return
      * CASE: PAR.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C/COPY WNCPYSRC,SD0452RC04
     C                     EXSR ZYEXPG
     C                     ELSE
      * CASE: PAR.*Return code is WN Window Error
     C           W0RTN     IFEQ 'USR0563'                  *IF
      * Send message 'WN Window Error'
     C                     MOVEL'USR0563' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SHEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *DBF update error
     C           W0RTN     IFEQ 'Y2U0004'                  *IF
      * Send message 'WN Database Error'
     C                     MOVEL'USR0567' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SHEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *Previous Screen
     C           W0RTN     IFEQ 'USR0790'                  *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SHEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * 00/Copy member SD0452RBUW - Client Limits  *
     C/COPY WNCPYSRC,SD0452RBUW
     C                     END                             *FI
      * 00/Copy member SD0452RBDU - Client Limits  *
     C/COPY WNCPYSRC,SD0452RBDU
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YCRDCS
     C                     MOVE 'Y'       YCRDC
     C                     END
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C/COPY WNCPYSRC,SD0452RC07
     C                     UPDAT@DZREHS                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDCLLML0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
      * USER: Processing after Data update
     C                     Z-ADD*ZERO     WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SICHRC
      * 00/Copy member SD0452RADU - Client Limits  *
     C/COPY WNCPYSRC,SD0452RADU
     C                     END
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SICHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YDRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDCLLMPD'AHFLNM           Filename
      *
     C           KLCHSI    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSI    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SIEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YDRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YDRDCS
     C                     MOVE 'Y'       YDRDC
     C                     END
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * get practically everythin - MIDAS Modules  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           BGMODS           Modules
      * Move fields to key list
     C                     MOVE *BLANK    BGMODS           Modules
     C                     MOVEL'MMOD'    BGMODS           Modules
     C           KRSSJ     CHAIN@BGREC8              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0096' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
      * Setup message data for message
     C                     MOVEL'SDMMODPD'ZA0058           Filename
      * Send message 'Database Error (ICD)'
     C                     MOVEL'USR0377' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO SJEXIT                     *QUIT
     C                     GOTO SJEXIT
     C                     END
      *
      * USER: Exit processing
      * PAR = DB1 By name
     C                     MOVELBGSDGL    WUSDGL           Standing data/G
     C                     MOVELBGDLFX    WUDLFX           Dealing: FX
     C                     MOVELBGSYLN    WUSYLN           Syndicated Loan
     C                     MOVELBGEXMG    WUEXMG           Exposure Manage
     C                     MOVELBGCSLN    WUCSLN           Customer Lendin
     C                     MOVELBGRTBN    WURTBN           Retail Banking
     C                     MOVELBGMSDL    WUMSDL           Midas/Swift dir
     C                     MOVELBGSECS    WUSECS           Securities
     C                     MOVELBGAURC    WUAURC           Auto-reconcilia
     C                     MOVELBGFDTR    WUFDTR           Funds Transfer
     C                     MOVELBGFUOP    WUFUOP           Futures & Optio
     C                     MOVELBGNWMI    WUNWMI           Message Managem
     C                     MOVELBGFIIN    WUFIIN           FRA/IRS Indicat
     C                     MOVELBGDLMM    WUDLMM           Dealing: MM
     C                     MOVELBGTRMG    WUTRMG           Treasury Manage
     C                     MOVELBGRKMG    WURKMG           Interest Risk M
     C                     MOVELBGMFIC    WUMFIC           Microfiche
     C                     MOVELBGIOAC    WUIOAC           Interest on acc
     C                     MOVELBGCFMT    WUCFMT           Confirmation Ma
     C                     MOVELBGRCFI    WURCFI           Report Control
     C                     MOVELBGOPDK    WUOPDK           Optical Disk
     C                     MOVELBGNUST    WUNUST           History & Audit
     C                     MOVELBGNZST    WUNZST           Midas Export Da
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * Get 'Window required' ind - MIDAS Modules  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSK     KLIST
     C                     KFLD           BGMODS           Modules
      * Move fields to key list
     C                     MOVE *BLANK    BGMODS           Modules
     C                     MOVEL'MMOD'    BGMODS           Modules
     C           KRSSK     CHAIN@BGREC8              90    *
      * Data record not found
     C   90                MOVEL'USR0096' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * CASE: DB1.Window processing requir. is Yes
     C           BGWDPR    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       WUWDPR           Window processi
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Convert All File Dates To Screen Dates
      *================================================================
      * Start of change 107583
      * Changed the conditioning of the Lending fields.
      * Customer Lending
      * CASE: WRK.Display Lending fields is Yes
     C*****      WUW0ST    IFEQ 'Y'                        *IF            139827
      * Customer Lending                                                  139827
      * CASE: Condition on both MM Dealing & Lending  (E088472)           139827
      *  - c1 OR c2                                                       139827
      *   |- c1    : WRK.Customer Lending is Yes                          139827
      *   |- c2    : WRK.Dealing: MM is Yes                               139827
      *   '-                                                              139827
     C           WUCSLN    IFEQ 'Y'                        *IF            139827
     C           WUDLMM    OREQ 'Y'                        *OR            139827
     C                     Z-ADDDZLLED    WUWMDT           Work Midas Date
      * Check File Date - Rundate  *
     C                     CALL 'ZDATE2'               90  Check File Date
     C                     PARM WUWMDT    WQ0001  50       Work Midas Date
     C                     PARM WUDFF     WQ0002  1        Date format fla
     C           WUWCDT    PARM *ZERO     WQ0003  60       Work Converted
     C           WUWADT    PARM *BLANK    WQ0004  7        Work Alpha Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZDATE2'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Set LN Expiry Date
      * CASE: WRK.Work Converted Date is not equal zero
     C           WUWCDT    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    #DSLED           LN Expiry Date
     C                     MOVELWUWCDT    #DSLED           LN Expiry Date
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DSLED           LN Expiry Date
     C                     END                             *FI
     C                     Z-ADDDZLLRD    WUWMDT           Work Midas Date
      * Check File Date - Rundate  *
     C                     CALL 'ZDATE2'               90  Check File Date
     C                     PARM WUWMDT    WQ0005  50       Work Midas Date
     C                     PARM WUDFF     WQ0006  1        Date format fla
     C           WUWCDT    PARM *ZERO     WQ0007  60       Work Converted
     C           WUWADT    PARM *BLANK    WQ0008  7        Work Alpha Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZDATE2'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Set LN Review Date
      * CASE: WRK.Work Converted Date is not equal zero
     C           WUWCDT    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    #DSLRD           LN Review Date
     C                     MOVELWUWCDT    #DSLRD           LN Review Date
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DSLRD           LN Review Date
     C                     END                             *FI
     C                     END                             *FI
      * End of change 107583
      * Precious Metals
      * CASE: WRK.SAR S01433 is Present
     C           WUSARF    IFEQ 'Y'                        *IF
     C                     Z-ADDDZPLED    WUWMDT           Work Midas Date
      * Check File Date - Rundate  *
     C                     CALL 'ZDATE2'               90  Check File Date
     C                     PARM WUWMDT    WQ0009  50       Work Midas Date
     C                     PARM WUDFF     WQ0010  1        Date format fla
     C           WUWCDT    PARM *ZERO     WQ0011  60       Work Converted
     C           WUWADT    PARM *BLANK    WQ0012  7        Work Alpha Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZDATE2'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Set PR Expiry date
      * CASE: WRK.Work Converted Date is not equal zero
     C           WUWCDT    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    #DPEDS           PR expiry date
     C                     MOVELWUWCDT    #DPEDS           PR expiry date
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DPEDS           PR expiry date
     C                     END                             *FI
     C                     Z-ADDDZPLVD    WUWMDT           Work Midas Date
      * Check File Date - Rundate  *
     C                     CALL 'ZDATE2'               90  Check File Date
     C                     PARM WUWMDT    WQ0013  50       Work Midas Date
     C                     PARM WUDFF     WQ0014  1        Date format fla
     C           WUWCDT    PARM *ZERO     WQ0015  60       Work Converted
     C           WUWADT    PARM *BLANK    WQ0016  7        Work Alpha Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZDATE2'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Set PR Review Date
      * CASE: WRK.Work Converted Date is not equal zero
     C           WUWCDT    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    #DPRDS           PR review date
     C                     MOVELWUWCDT    #DPRDS           PR review date
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DPRDS           PR review date
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Convert File amounts to function fields
      *================================================================
      * Start of Change 107583
      * Changed the 'display lending fields' conditioning.
      * LN Limit Amount
      * CASE: WRK.Display Lending fields is Yes
     C*****      WUW0ST    IFEQ 'Y'                        *IF            139827
      * CASE: DB1.Lending Limit Amount is not equal zero
     C           DZLLAM    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVELDZLLAM    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0017  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0018 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0019  10       ZALIGN No Of De
     C                     PARM 9         WQ0020  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0021 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0022 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0023  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * ZALIGN LN Limit Amount - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO LN LIMIT AMOUNT
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DLLAS
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DLLAS           LN Limit Amount
     C                     END                             *FI
     C*****                END                             *FI            139827
      * End of Change 107583
      * Precious Metals Spot Limit Amount
      * CASE: DB1.Prec metal Spot limit amt is not equal zero
     C           DZPSAM    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVELDZPSAM    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0024  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0025 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0026  10       ZALIGN No Of De
     C                     PARM 9         WQ0027  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0028 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0029 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0030  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * Zalign PR spot lmt amount - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO PR SPOT LIMIT AMOUNT
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DPSLS
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DPSLS           PR spot limit a
     C                     END                             *FI
      *                                                                   CDL006
      ** Dealing Fiduciary Limit amount is not equal to zero.             CDL006
      *                                                                   CDL006
     C           DZFILA    IFNE *ZERO                                     CDL006
     C                     MOVEL*BLANK    WUZASF                          CDL006
     C                     MOVELDZFILA    WUZASF                          CDL006
      *                                                                   CDL006
      ** Call ZALIGN & ZEDIT                                              CDL006
      ** ZALIGN Screen Field - Standard Functions                         CDL006
      *                                                                   CDL006
     C                     CALL 'ZALIGN'               90                 CDL006
     C           W0RTN     PARM W0RTN     WQ0024  7                       CDL006
     C           WUZASF    PARM WUZASF    WQ0025 16                       CDL006
     C                     PARM *ZERO     WQ0026  10                      CDL006
     C                     PARM 9         WQ0027  20                      CDL006
     C           WUZAFF    PARM *BLANK    WQ0028 16                       CDL006
      *                                                                   CDL006
     C           *IN90     IFEQ '1'                                       CDL006
      * Call to program ended in error                                    CDL006
     C                     MOVEL'Y2U0032' W0RTN                           CDL006
     C                     MOVEL*BLANKS   W0CLPG 10                       CDL006
     C                     MOVEL'ZALIGN'  W0CLPG                          CDL006
      * Send message '*Error occured on CALL...'                          CDL006
     C                     MOVEL'Y2U0032' ZAMSID                          CDL006
     C                     MOVEL'Y2USRMSG'ZAMSGF                          CDL006
     C                     MOVELW0CLPG    ZAMSDA                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Error detected?                                                  CDL006
     C           W0RTN     IFNE *BLANK                                    CDL006
     C                     SETON                     99                   CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Return code is Old Table Error                                   CDL006
     C           W0RTN     IFEQ '*ERROR*'                                 CDL006
     C                     MOVEL'Y'       WUERCD                          CDL006
     C                     ELSE                                           CDL006
     C                     MOVEL'N'       WUERCD                          CDL006
      *                                                                   CDL006
      ** ZEDIT Screen Field - Standard Functions  *                       CDL006
     C                     CALL 'ZEDIT'                90                 CDL006
     C           WUZASF    PARM WUZASF    WQ0029 16                       CDL006
     C                     PARM *ZERO     WQ0030  10                      CDL006
      *                                                                   CDL006
     C           *IN90     IFEQ '1'                                       CDL006
      *                                                                   CDL006
      ** Call to program ended in error                                   CDL006
     C                     MOVEL'Y2U0032' W0RTN                           CDL006
     C                     MOVEL*BLANKS   W0CLPG 10                       CDL006
     C                     MOVEL'ZEDIT'   W0CLPG                          CDL006
      * Send message '*Error occured on CALL...'                          CDL006
     C                     MOVEL'Y2U0032' ZAMSID                          CDL006
     C                     MOVEL'Y2USRMSG'ZAMSGF                          CDL006
     C                     MOVELW0CLPG    ZAMSDA                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
     C                     END                                            CDL006
      *                                                                   CDL006
      ** Zalign Dealing Fiduciary Limit Amount                            CDL006
      ** Move ZALIGN screen function field into DL Fiduciary Limit        CDL006
      ** Amount screen function field.                                    CDL006
     C                     MOVE WUZASF    SZFILA                          CDL006
     C                     ELSE                                           CDL006
     C                     MOVEL*BLANK    SZFILA                          CDL006
     C                     END                                            CDL006
      * Precious Metals Forward Limit Amount
      * CASE: DB1.Prec metals frwd lim amt is not equal zero
     C           DZPFAM    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVELDZPFAM    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0031  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0032 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0033  10       ZALIGN No Of De
     C                     PARM 9         WQ0034  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0035 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0036 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0037  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * Zalign PR Frwd lmt amount - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO PR FORWARD LIMIT AMOUNT
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DPFLS
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DPFLS           PR forwrd lmt a
     C                     END                             *FI
      * Precious Metals Line Amount
      * CASE: DB1.Prec metals line amount is not equal zero
     C           DZPLAM    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVELDZPLAM    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0038  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0039 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0040  10       ZALIGN No Of De
     C                     PARM 9         WQ0041  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0042 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0043 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0044  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * Zalign PR line amount - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO PR LINE AMOUNT
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DPLAS
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DPLAS           PR line amount
     C                     END                             *FI
      * Start of Change 107583
      * Changed the 'display lending fields' conditioning.
      * LN Frequency Day Number
      * CASE: WRK.Display Lending fields is Yes
     C*****      WUW0ST    IFEQ 'Y'                        *IF            139827
      * CASE: DB1.Lending Frequency Day No. is Not Zero
     C           DZLFDN    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVELDZLFDN    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0045  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0046 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0047  10       ZALIGN No Of De
     C                     PARM 2         WQ0048  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0049 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0050 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0051  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * ZALIGN LN Freq Day No - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO LN FREQUENCY DAY NO
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DLFDS
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DLFDS           LN Freq Day No
     C                     END                             *FI
     C*****                END                             *FI            139827
      * End of Change 107583
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Test for Blanks in Status fields
      *================================================================
      * CASE: PAR.Secured is Blank
     C           #1SECD    IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUBISF           Blank in Secure
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUBISF           Blank in Secure
     C                     END                             *FI
      * CASE: PAR.Lending Limit Frequency is Is Blank
     C           #1LLFR    IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUBIFF           Blank in Freque
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUBIFF           Blank in Freque
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * LN - Blank out file dates and numerics
      *================================================================
     C                     Z-ADD*ZERO     #1LLED           Lending Limit E
     C                     Z-ADD*ZERO     #1LLRD           Lending Limit R
     C                     Z-ADD*ZERO     #1LFDN           Lending Frequen
     C                     Z-ADD*ZERO     #1LLAM           Lending Limit A
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Test for Blanks in Status fields
      *================================================================
      * CASE: PAR.Prec metals review freq is equal blank
     C           #1PLRF    IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUBIFF           Blank in Freque
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUBIFF           Blank in Freque
     C                     END                             *FI
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * PR - Blank out file dates and numerics
      *================================================================
     C                     Z-ADD*ZERO     #1PFAM           Prec metals frw
     C                     Z-ADD*ZERO     #1PLED           Prec metals exp
     C                     Z-ADD*ZERO     #1PLVD           Prec metals rev
     C                     Z-ADD*ZERO     #1PSAM           Prec metal Spot
     C                     Z-ADD*ZERO     #1PLAM           Prec metals lin
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * Validate LN Fields
      *================================================================
      * Reset Error Fields
     C                     EXSR UHSUBR                     Reset Error Fie
      * LN Limit Amount must be greater than zero
      * CASE: PAR.LN Limit Amount Screen DS is Equal Blank
     C           #DLLAS    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DLLAS    ZA0014           LN Limit Amount
      * Send message 'Lending Limit Amt Req'
     C                     MOVEL'USR0687' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DLLAS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0057  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0058 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0059  10       ZALIGN No Of De
     C                     PARM 9         WQ0060  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0061 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUILAM           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUILAM           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0062 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0063  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Invalid Limit Amount is Error Found
     C           WUILAM    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DLLAS    ZA0015           LN Limit Amount
      * Send message 'Limit Amount Not Numeric'
     C                     MOVEL'USR0788' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * ZALIGN LN Limit Amount - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO LN LIMIT AMOUNT
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DLLAS
     C                     MOVE WUZAFF    #1LLAM           Lending Limit A
      * CASE: PAR.Lending Limit Amount is Equal Zero
     C           #1LLAM    IFEQ *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#DLLAS    ZA0016           LN Limit Amount
      * Send message 'LN Limit Amount GT Zero'
     C                     MOVEL'USR0835' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Validate LN Expiry Date
      * CASE: PAR.LN Expiry Date Screen DS is Not Equal Blank
     C           #DSLED    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DSLED    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0064  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0065 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0066  10       ZALIGN No Of De
     C                     PARM 6         WQ0067  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0068 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUIEDT           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUIEDT           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0069 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0070  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Invalid Expiry Date is Error Found
     C           WUIEDT    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DSLED    ZA0017           LN Expiry Date
      * Send message 'Expiry Date Numeric'
     C                     MOVEL'USR0808' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZAFF    WUWSDT           Work Screen Dat
      * Check Screen Date - Rundate  *
     C                     CALL 'ZDATE1'               90  Check Screen Da
     C           W0RTN     PARM W0RTN     WQ0071  7        *Return code
     C           WUWSDT    PARM WUWSDT    WQ0072  60       Work Screen Dat
     C           WUDFF     PARM WUDFF     WQ0073  1        Date format fla
     C           #1LLED    PARM *ZERO     WQ0074  50       Work File Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZDATE1'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Test for an Invalid Date
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#DSLED    ZA0018           LN Expiry Date
      * Send message 'LN Expiry Date is Invalid'
     C                     MOVEL'USR0731' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     MOVEL'Y'       WUIEDT           Invalid Expiry
     C                     ELSE
      * CASE: *OTHERWISE
      * Test for date less than rundat
      * CASE: PAR.Lending Limit Expiry Date LE PAR.Run day number
     C           #1LLED    IFLE WURDNB                     *IF
      * Setup message data for message
     C                     MOVEL#DSLED    ZA0019           LN Expiry Date
     C                     MOVELWUMRDT    ZA0020           Midas Run Date
      * Send message 'LN Exp Date After Rundat'
     C                     MOVEL'USR0689' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     #1LLED           Lending Limit E
     C                     END                             *FI
      * Validate LN Review Date
      * CASE: PAR.LN Review Date Screen DS is Not Equal Blank
     C           #DSLRD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DSLRD    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0075  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0076 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0077  10       ZALIGN No Of De
     C                     PARM 6         WQ0078  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0079 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUINRD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUINRD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0080 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0081  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Invalid Review Date is Error Found
     C           WUINRD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DSLRD    ZA0021           LN Review Date
      * Send message 'Review Date Numeric'
     C                     MOVEL'USR0809' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZAFF    WUWSDT           Work Screen Dat
      * Check Screen Date - Rundate  *
     C                     CALL 'ZDATE1'               90  Check Screen Da
     C           W0RTN     PARM W0RTN     WQ0082  7        *Return code
     C           WUWSDT    PARM WUWSDT    WQ0083  60       Work Screen Dat
     C           WUDFF     PARM WUDFF     WQ0084  1        Date format fla
     C           #1LLRD    PARM *ZERO     WQ0085  50       Work File Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZDATE1'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Test for an Invalid Date
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#DSLRD    ZA0022           LN Review Date
      * Send message 'LN Review Date is Invalid'
     C                     MOVEL'USR0732' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     MOVEL'Y'       WUINRD           Invalid Review
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.Lending Limit Review Date LE PAR.Run day number
     C           #1LLRD    IFLE WURDNB                     *IF
      * Setup message data for message
     C                     MOVEL#DSLRD    ZA0023           LN Review Date
     C                     MOVELWUMRDT    ZA0024           Midas Run Date
      * Send message 'LN Rev Date after Rundat'
     C                     MOVEL'USR0817' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     #1LLRD           Lending Limit R
     C                     END                             *FI
      * Cross Validate Expiry and Review dates
      * CASE: PAR.LN Review Date Screen DS is Not Equal Blank
     C           #DSLRD    IFNE *BLANK                     *IF
      * CASE: PAR.LN Expiry Date Screen DS is Equal Blank
     C           #DSLED    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DSLED    ZA0025           LN Expiry Date
      * Send message 'LN Expiry Date Required'
     C                     MOVEL'USR0797' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Invalid Review Date is Error Not Found
     C           WUINRD    IFEQ 'N'                        *IF
      * CASE: WRK.Invalid Expiry Date is Error Not Found
     C           WUIEDT    IFEQ 'N'                        *IF
      * LN Review date LT Expiry Date
      * CASE: PAR.Lending Limit Review Date GE PAR.Lending Limit Expiry D
     C           #1LLRD    IFGE #1LLED                     *IF
      * Setup message data for message
     C                     MOVEL#DSLRD    ZA0026           LN Review Date
      * Send message 'LN Rev Date bef Exp Date'
     C                     MOVEL'USR0690' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Validate LN Review Frequency
      * CASE: PAR.LN Review Date Screen DS is Not Equal Blank
     C           #DSLRD    IFNE *BLANK                     *IF
      * Frequency Code must be entered
      * CASE: PAR.Lending Limit Frequency is Is Blank
     C           #1LLFR    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1LLFR    ZA0027           Lending Limit F
      * Send message 'LN Limit Freq Required'
     C                     MOVEL'USR0712' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Frequency Code must be left blank
      * CASE: PAR.Lending Limit Frequency is Is Blank
     C           #1LLFR    IFEQ *BLANK                     *IF
      * No action required
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1LLFR    ZA0028           Lending Limit F
      * Send message 'LN Limit Freq Blank'
     C                     MOVEL'USR0714' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Convert Frequency Day Number
     C                     EXSR UISUBR                     Convert Frequen
      * Validate LN Limit Frequency Type
      * CASE: PAR.Lending Limit Frequency is M,T,Q,X,Y,*BLANK
     C           #1LLFR    IFEQ 'T'                        *IF
     C           #1LLFR    OREQ *BLANK
     C           #1LLFR    OREQ 'M'
     C           #1LLFR    OREQ 'Q'
     C           #1LLFR    OREQ 'X'
     C           #1LLFR    OREQ 'Y'
      * Valid Limit Frequency.  No action Required
     C                     ELSE
      * CASE: *OTHERWISE
      * Invalid Frequency Code
      * Setup message data for message
     C                     MOVEL#1LLFR    ZA0030           Lending Limit F
      * Send message 'LN Limit Freq Invalid'
     C                     MOVEL'USR0713' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     END                             *FI
      * If Freq is M,T,Q or X then Freq Day No must be 01-31, otherwise b
      * CASE: PAR.Lending Limit Frequency is M,T,X,Q
     C           #1LLFR    IFEQ 'T'                        *IF
     C           #1LLFR    OREQ 'M'
     C           #1LLFR    OREQ 'Q'
     C           #1LLFR    OREQ 'X'
      * CASE: WRK.Invalid Frequency Day No is Error Not Found
     C           WUIFQD    IFEQ 'N'                        *IF
      * Frequency Day Number must be between 01-31
      * CASE: PAR.LN Freq Day Number DS is Equal Blank
     C           #DLFDS    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DLFDS    ZA0031           LN Freq Day Num
      * Send message 'LN Freq Day No Required'
     C                     MOVEL'USR0715' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     ELSE
      * CASE: PAR.Lending Frequency Day No. is Greater Than 31
     C           #1LFDN    IFGT 31                         *IF
      * Setup message data for message
     C                     MOVEL#DLFDS    ZA0032           LN Freq Day Num
      * Send message 'LN Freq Day No Invalid'
     C                     MOVEL'USR0716' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     ELSE
      * CASE: PAR.Lending Frequency Day No. is Less Than or EQ Zero
     C           #1LFDN    IFLE *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#DLFDS    ZA0033           LN Freq Day Num
      * Send message 'LN Freq Day No Invalid'
     C                     MOVEL'USR0716' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Frequency Day Number must be blank
      * CASE: PAR.LN Freq Day Number DS is Not Equal Blank
     C           #DLFDS    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DLFDS    ZA0034           LN Freq Day Num
      * Send message 'LN Freq Day No - Blank'
     C                     MOVEL'USR0717' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Validate Secured if used
      * CASE: JOB.*PROGRAM is Country or Region Limits
     C           ##PGM     IFEQ 'SD0461R'                  *IF
     C           ##PGM     OREQ 'SD0471R'
      * Secured Not Used in this function
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.Secured is Yes or Blank
     C           #1SECD    IFEQ *BLANK                     *IF
     C           #1SECD    OREQ 'Y'
      * Valid Value. No action reuired
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1SECD    ZA0035           Secured
      * Send message 'LN Secured is Invalid'
     C                     MOVEL'USR0718' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Reset Error Fields
      *================================================================
     C                     MOVEL'N'       WUERCD           Err Code
     C                     MOVEL'N'       WUILAM           Invalid Limit A
     C                     MOVEL'N'       WUIFQD           Invalid Frequen
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Convert Frequency Day Number
      *================================================================
      * CASE: PAR.LN Freq Day Number DS is Not Equal Blank
     C           #DLFDS    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DLFDS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0086  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0087 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0088  10       ZALIGN No Of De
     C                     PARM 9         WQ0089  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0090 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUIFQD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUIFQD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0091 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0092  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Invalid Frequency Day No is Error Found
     C           WUIFQD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DLFDS    ZA0029           LN Freq Day Num
      * Send message 'Freq Day Num Must Numeric'
     C                     MOVEL'USR0793' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * ZALIGN LN Freq Day No - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO LN FREQUENCY DAY NO
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DLFDS
     C                     MOVE WUZAFF    #1LFDN           Lending Frequen
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Validate PR Fields
      *================================================================
      * Reset Error Fields
     C                     EXSR UKSUBR                     Reset Error Fie
      * PR Spot Limit Amount must be greater than zero
     C                     EXSR ULSUBR                     PR Spot Limit A
      * Validate PR Expiry Date
      * CASE: PAR.PR expiry date screen DS is Not equal blank
     C           #DPEDS    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DPEDS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0100  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0101 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0102  10       ZALIGN No Of De
     C                     PARM 6         WQ0103  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0104 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0105 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0106  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Err Code is Error Found
     C           WUERCD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DPEDS    ZA0038           PR expiry date
      * Send message 'Expiry Date Numeric'
     C                     MOVEL'USR0808' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZAFF    WUWSDT           Work Screen Dat
      * Check Screen Date - Rundate  *
     C                     CALL 'ZDATE1'               90  Check Screen Da
     C           W0RTN     PARM W0RTN     WQ0107  7        *Return code
     C           WUWSDT    PARM WUWSDT    WQ0108  60       Work Screen Dat
     C           WUDFF     PARM WUDFF     WQ0109  1        Date format fla
     C           WUWFDT    PARM *ZERO     WQ0110  50       Work File Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZDATE1'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Test for an Invalid Date
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#DPEDS    ZA0039           PR expiry date
      * Send message 'PR expiry date is invalid'
     C                     MOVEL'USR2175' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     MOVEL'Y'       WUIEDT           Invalid Expiry
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWUWFDT    #1PLED           Prec metals exp
      * Test for date less than rundat
      * CASE: PAR.Prec metals expiry date LE PAR.Run day number
     C           #1PLED    IFLE WURDNB                     *IF
      * Setup message data for message
     C                     MOVEL#DPEDS    ZA0040           PR expiry date
     C                     MOVELWUMRDT    ZA0041           Midas Run Date
      * Send message 'PR Expry date after today'
     C                     MOVEL'USR2176' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     #1PLED           Prec metals exp
     C                     END                             *FI
      * Validate PR Review Date
      * CASE: PAR.PR review date screen DS is Not equal blank
     C           #DPRDS    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DPRDS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0111  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0112 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0113  10       ZALIGN No Of De
     C                     PARM 6         WQ0114  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0115 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0116 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0117  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Err Code is Error Found
     C           WUERCD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DPRDS    ZA0042           PR review date
      * Send message 'Review Date Numeric'
     C                     MOVEL'USR0809' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZAFF    WUWSDT           Work Screen Dat
      * Check Screen Date - Rundate  *
     C                     CALL 'ZDATE1'               90  Check Screen Da
     C           W0RTN     PARM W0RTN     WQ0118  7        *Return code
     C           WUWSDT    PARM WUWSDT    WQ0119  60       Work Screen Dat
     C           WUDFF     PARM WUDFF     WQ0120  1        Date format fla
     C           WUWFDT    PARM *ZERO     WQ0121  50       Work File Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZDATE1'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Test for an Invalid Date
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#DPRDS    ZA0043           PR review date
      * Send message 'PR review date is invalid'
     C                     MOVEL'USR2177' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     MOVEL'Y'       WUINRD           Invalid Review
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADDWUWFDT    #1PLVD           Prec metals rev
      * CASE: PAR.Prec metals review date LE PAR.Run day number
     C           #1PLVD    IFLE WURDNB                     *IF
      * Setup message data for message
     C                     MOVEL#DPRDS    ZA0044           PR review date
     C                     MOVELWUMRDT    ZA0045           Midas Run Date
      * Send message 'PR review date after tody'
     C                     MOVEL'USR2178' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     #1PLVD           Prec metals rev
     C                     END                             *FI
      * Cross Validate Expiry and Review Dates
      * CASE: PAR.PR review date screen DS is Not equal blank
     C           #DPRDS    IFNE *BLANK                     *IF
      * CASE: PAR.PR expiry date screen DS is equal blank
     C           #DPEDS    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DPEDS    ZA0046           PR expiry date
      * Send message 'PR expiry date is req'
     C                     MOVEL'USR2179' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Err Code is Error Not Found
     C           WUERCD    IFEQ 'N'                        *IF
      * CASE: WRK.Invalid Expiry Date is Error Not Found
     C           WUIEDT    IFEQ 'N'                        *IF
      * PR Review date LT Expiry Date
      * CASE: PAR.Prec metals review date GE PAR.Prec metals expiry date
     C           #1PLVD    IFGE #1PLED                     *IF
      * Setup message data for message
     C                     MOVEL#DPEDS    ZA0047           PR expiry date
      * Send message 'PR Review date LT Expir'
     C                     MOVEL'USR2180' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Validate PR Review Frequency
      * CASE: PAR.PR review date screen DS is Not equal blank
     C           #DPRDS    IFNE *BLANK                     *IF
      * Frequency Code must be entered
      * CASE: PAR.Prec metals review freq is equal blank
     C           #1PLRF    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1PLRF    ZA0048           Prec metals rev
      * Send message 'PR frequency is req'
     C                     MOVEL'USR2181' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9940  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Frequency Code must be left blank
      * CASE: PAR.Prec metals review freq is equal blank
     C           #1PLRF    IFEQ *BLANK                     *IF
      * No action required
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1PLRF    ZA0049           Prec metals rev
      * Send message 'PR freq must be blank'
     C                     MOVEL'USR2182' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9940  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Validate PR Review Frequency Type
      * CASE: PAR.Prec metals review freq is M,T,Q,X,Y,*BLANK
     C           #1PLRF    IFEQ 'T'                        *IF
     C           #1PLRF    OREQ *BLANK
     C           #1PLRF    OREQ 'M'
     C           #1PLRF    OREQ 'Q'
     C           #1PLRF    OREQ 'X'
     C           #1PLRF    OREQ 'Y'
      * Valid Limit Frequency.  No action Required
     C                     ELSE
      * CASE: *OTHERWISE
      * Invalid Frequency Code
      * Setup message data for message
     C                     MOVEL#1PLRF    ZA0050           Prec metals rev
      * Send message 'PR freq is invalid'
     C                     MOVEL'USR2183' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9940  *
      *
     C                     END                             *FI
      * PR Forward Limit Amount must be greater than zero
     C                     EXSR UMSUBR                     PR Forward Limi
      * PR Line Amount must be greater than zero
     C                     EXSR UNSUBR                     PR Line Amount
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Reset Error Fields
      *================================================================
     C                     MOVEL'N'       WUERCD           Err Code
     C                     MOVEL'N'       WUILAM           Invalid Limit A
     C                     MOVEL'N'       WUIFQD           Invalid Frequen
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * PR Spot Limit Amount must be greater than zero
      *================================================================
      * CASE: PAR.PR spot lmt amt screen DS is equal blank
     C           #DPSLS    IFEQ *BLANK                     *IF
      * Start of 063211
     C                     MOVEL'N'       WUSLAF           Spot Limit Amou
      * End of 063211
     C                     ELSE
      * CASE: *OTHERWISE
      * Start of 063211
     C                     MOVEL'Y'       WUSLAF           Spot Limit Amou
      * End of 063211
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DPSLS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0093  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0094 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0095  10       ZALIGN No Of De
     C                     PARM 9         WQ0096  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0097 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0098 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0099  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Err Code is Error Found
     C           WUERCD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DPSLS    ZA0036           PR spot lmt amt
      * Send message 'PR Spot limit numeric'
     C                     MOVEL'USR2173' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Zalign PR spot lmt amount - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO PR SPOT LIMIT AMOUNT
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DPSLS
     C                     MOVE WUZAFF    #1PSAM           Prec metal Spot
      * CASE: PAR.Prec metal Spot limit amt is equal zero
     C           #1PSAM    IFEQ *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#DPSLS    ZA0037           PR spot lmt amt
      * Send message 'PR Spot Limit amt GT Zero'
     C                     MOVEL'USR2174' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * PR Forward Limit Amount must be greater than zero
      *================================================================
      * CASE: PAR.PR Frwd lmt amt screen DS is equal blank
     C           #DPFLS    IFEQ *BLANK                     *IF
      * Start of 063211
     C                     MOVEL'N'       WUFLAF           Forward Limit A
      * End of 063211
     C                     ELSE
      * CASE: *OTHERWISE
      * Start of 063211
     C                     MOVEL'Y'       WUFLAF           Forward Limit A
      * End of 063211
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DPFLS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0122  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0123 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0124  10       ZALIGN No Of De
     C                     PARM 9         WQ0125  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0126 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0127 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0128  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Err Code is Error Found
     C           WUERCD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DPFLS    ZA0051           PR Frwd lmt amt
      * Send message 'PR Forwrd lmt amt numeric'
     C                     MOVEL'USR2185' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Zalign PR Frwd lmt amount - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO PR FORWARD LIMIT AMOUNT
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DPFLS
     C                     MOVE WUZAFF    #1PFAM           Prec metals frw
      * CASE: PAR.Prec metals frwd lim amt is equal zero
     C           #1PFAM    IFEQ *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#DPFLS    ZA0052           PR Frwd lmt amt
      * Send message 'PR frwd lmt amt GT zero'
     C                     MOVEL'USR2186' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * PR Line Amount must be greater than zero
      *================================================================
      * CASE: PAR.PR line amount screen DS is equal blank
     C           #DPLAS    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DPLAS    ZA0053           PR line amount
      * Send message 'PR line amount is req'
     C                     MOVEL'USR2187' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DPLAS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0129  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0130 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0131  10       ZALIGN No Of De
     C                     PARM 9         WQ0132  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0133 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0134 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0135  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Err Code is Error Found
     C           WUERCD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DPLAS    ZA0054           PR line amount
      * Send message 'PR line amount numeric'
     C                     MOVEL'USR2188' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Zalign PR line amount - Region Limits  *
     C*
     C* MOVE ZALIGN SCREEN FUNCTION FIELD INTO PR LINE AMOUNT
     C* SCREEN FUNCTION FIELD
     C                     MOVE WUZASF    #DPLAS
     C                     MOVE WUZAFF    #1PLAM           Prec metals lin
      * CASE: PAR.Prec metals line amount is equal zero
     C           #1PLAM    IFEQ *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#DPLAS    ZA0055           PR line amount
      * Send message 'PR Line amount GT zero'
     C                     MOVEL'USR2189' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      * Set indicator to display 'Lending' fields ?  (E088472)
      *================================================================
      * Start E088472
      * CASE: Condition on MM Dealing & Not S01433
      *  - c1 AND c2
      *   |- c1    : WRK.SAR S01433 is Not present
      *   |- c2    : WRK.Dealing: MM is Yes
      *   '-
     C****                 MOVEL'0'       Y0CX01  1                       139827
     C****       WUSARF    IFEQ 'N'                        *IF            139827
     C****       WUDLMM    IFEQ 'Y'                        *IF            139827
     C****                 MOVEL'1'       Y0CX01                          139827
     C****                 END                             *FI            139827
     C****                 END                             *FI            139827
     C****       Y0CX01    IFEQ '1'                        *IF            139827
     C           WUCSLN    IFEQ 'Y'                        *IF            139827
     C           WUDLMM    OREQ 'Y'                        *OR            139827
     C                     MOVEL'Y'       WUW0ST           Display Lending
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUW0ST           Display Lending
     C                     END                             *FI
      * End E088472
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Select existing record
      *================================================================
      * Name search required?
     C                     MOVEL#1CUST    WK1X01  1
     C                     MOVEL#1LEVL    WK1X02  1
     C                     MOVEL#1BCCD    WK1X03  1
     C           WK1X01    IFEQ '?'                        Customer Number
     C           WK1X02    OREQ '?'                        Level
     C           WK1X03    OREQ '?'                        Branch/Company
     C                     CALL 'SD0450S'              90  Select Client L
     C                     PARM *BLANK    W0RTN   7
     C           #1CUST    PARM #1CUST    WQ0052  6        Customer Number
     C           #1LEVL    PARM #1LEVL    WQ0053  1        Level
     C           #1BCCD    PARM #1BCCD    WQ0054  3        Branch/Company
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0450S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     993132*
     C                     SETON                     33    *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Client Details
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1CUST    WK1X01  1
     C           WK1X01    IFEQ '?'                        Customer Number
     C                     CALL 'SD0010S'              90  Select Client D
     C                     PARM *BLANK    W0RTN   7
     C           #1CUST    PARM #1CUST    WQ0055  6        Customer Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0010S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9931  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VBEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1CUST    IFEQ *BLANK                     Customer Number
     C                     GOTO VBEXIT
     C                     END
      *
     C           KLVBBB    KLIST
     C                     KFLD           BBCUST           Customer Number
      * Setup key
     C                     MOVEL#1CUST    BBCUST           Customer Number
     C           KLVBBB    CHAIN@BBREBF              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
      * Send message 'Client Details         NF'
     C                     MOVEL'USR0081' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0081' W0RTN
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     C**SR******   VCCKRL    BEGSR                                                            192740
      *================================================================
      **Check*reference to Limit types                                                        192740
      *================================================================
     C**********           MOVEL*BLANK    W0RTN   7                                           192740
      **Name*search required?                                                                 192740
     C**********           MOVEL#1FXLT    WK1X01  1                                           192740
     C********** WK1X01    IFEQ '?'                        Limit Type                         192740
     C**********           CALL 'SD0141S'              90  Select Limits                      192740
     C**********           PARM *BLANK    W0RTN   7                                           192740
     C********** #1FXLT    PARM #1FXLT    WQ0136  3        Limit Type                         192740
      **********                                                                              192740
     C********** *IN90     IFEQ '1'                                                           192740
      **Call*to*program ended in error                                                        192740
     C**********           MOVEL'Y2U0032' W0RTN                                               192740
     C**********           MOVEL*BLANKS   W0CLPG 10                                           192740
     C**********           MOVEL'SD0141S' W0CLPG                                              192740
      **Send*message '*Error occured on CALL...'                                              192740
     C**********           MOVEL'Y2U0032' ZAMSID                                              192740
     C**********           MOVEL'Y2USRMSG'ZAMSGF                                              192740
     C**********           MOVELW0CLPG    ZAMSDA           Message data                       192740
     C**********           EXSR ZASNMS                                                        192740
     C**********           END                                                                192740
      **********                                                                              192740
      **Error*detected?                                                                       192740
     C********** W0RTN     IFNE *BLANK                                                        192740
     C********** W0RTN     ANDNE'Y2U0016'                                                     192740
     C**********           SETON                     99    *                                  192740
     C**********           END                                                                192740
      **Defer*confirm                                                                         192740
     C**********           MOVEL'Y'       W0DCF   1                                           192740
      **No*value selected, exit                                                               192740
     C********** W0RTN     IFNE *BLANK                                                        192740
     C**********           GOTO VCEXIT                                                        192740
     C**********           END                                                                192740
     C**********           END                                                                192740
      *................................................................                       192740
      **If*all*low order keys not entered, exit                                               192740
     C********** #1FXLT    IFEQ *BLANK                     Limit Type                         192740
     C**********           GOTO VCEXIT                                                        192740
     C**********           END                                                                192740
      **********                                                                              192740
     C********** KLVCA2    KLIST                                                              192740
     C**********           KFLD           A2LMTY           Limit Type                         192740
      **Setup*key                                                                             192740
     C**********           MOVEL#1FXLT    A2LMTY           Limit Type                         192740
     C********** KLVCA2    CHAIN@A2REBU              9091  *                                  192740
     C********** *IN90     IFEQ '0'                                                           192740
      **Record*found - move back any virtuals                                                 192740
     C**********           GOTO VCEXIT                                                        192740
     C**********           END                                                                192740
      **Send*message 'Limit types            NF'                                              192740
     C**********           MOVEL'USR0063' ZAMSID                                              192740
     C**********           EXSR ZASNMS                                                        192740
     C**********           MOVEL'USR0063' W0RTN                                               192740
      *================================================================                       192740
     C**SR****** VCEXIT    ENDSR                                                              192740
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to Limit types
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1LLTY    WK1X01  1
     C           WK1X01    IFEQ '?'                        Limit Type
     C                     CALL 'SD0141S'              90  Select Limits
     C                     PARM *BLANK    W0RTN   7
     C           #1LLTY    PARM #1LLTY    WQ0137  3        Limit Type
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0141S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9931  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VDEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1LLTY    IFEQ *BLANK                     Limit Type
     C                     GOTO VDEXIT
     C                     END
      *
     C           KLVDA2    KLIST
     C                     KFLD           A2LMTY           Limit Type
      * Setup key
     C                     MOVEL#1LLTY    A2LMTY           Limit Type
     C           KLVDA2    CHAIN@A2REBU              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VDEXIT
     C                     END
      * Send message 'Limit types            NF'
     C                     MOVEL'USR0063' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0063' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y1SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y1EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C           @#DFMT    IFEQ '#RCDKEY'
      * KEY Screen
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C                     END
     C           @#DFMT    IFEQ '#RCDDTL1'
      * DETAIL Screen
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C                     END
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM 1         YYLGCT  50       # of grps
     C                     PARM W0GRP     YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel and exit from key screen
      *================================================================
      * USER: Exit program processing
      * 00/Copy member SD0452REPP - Client Limits  *
     C/COPY WNCPYSRC,SD0452REPP
      * CASE: KEY.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVEL'Y2U9999' P3DRTC           Duplicate Retur
     C                     MOVEL*BLANK    P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Start of 077893
     C                     MOVEL*BLANK    WUINPT           Input field
      * End of 077893
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * ROLLBACK any uncommitted DBF changes
     C                     ROLBK                       90
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
      * Set century digit (If YY prior to 1940 treat as 20YY)
     C           ##JYY     IFLT 40
     C                     Z-ADD1         ##JCC
     C                     ELSE
     C                     Z-ADD0         ##JCC
     C                     END
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN Y2MGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Multi-branching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Display Level & Brch/Comp
     C                     MOVEL*BLANK    WUDLBC  1
      * Define work field Display Lending fields
     C                     MOVEL*BLANK    WUW0ST  1
      * Define work field Work Midas Date
     C                     Z-ADD*ZERO     WUWMDT  50
      * Define work field Date format flag
     C                     MOVEL*BLANK    WUDFF   1
      * Define work field Work Converted Date
     C                     Z-ADD*ZERO     WUWCDT  60
      * Define work field Work Alpha Date
     C                     MOVEL*BLANK    WUWADT  7
      * Define work field SAR S01433
     C                     MOVEL*BLANK    WUSARF  1
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Err Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field Customer Shortname
     C                     MOVEL*BLANK    WUCSSN 10
      * Define work field Customer Report Town
     C                     MOVEL*BLANK    WUCRTN 10
      * Define work field Customer Report Name
     C                     MOVEL*BLANK    WUCRNM 20
      * Define work field Run day number
     C                     Z-ADD*ZERO     WURDNB  50
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Customer Lending
     C                     MOVEL*BLANK    WUCSLN  1
      * Define work field Details Entered - LN
     C                     MOVEL*BLANK    WUDELN  1
      * Define work field Details entered - PR
     C                     MOVEL*BLANK    WUDEPR  1
      * Define work field Blank in Secured Field
     C                     MOVEL*BLANK    WUBISF  1
      * Define work field Blank in Frequency Field
     C                     MOVEL*BLANK    WUBIFF  1
      * Define work field Test ? in Key Field
     C                     MOVEL*BLANK    WUTQKF  1
      * Define work field Limit Type
     C                     MOVEL*BLANK    WULMTY  3
      * Define work field Invalid Limit Amount
     C                     MOVEL*BLANK    WUILAM  1
      * Define work field Invalid Frequency Day No
     C                     MOVEL*BLANK    WUIFQD  1
      * Define work field Invalid Expiry Date
     C                     MOVEL*BLANK    WUIEDT  1
      * Define work field Work Screen Date
     C                     Z-ADD*ZERO     WUWSDT  60
      * Define work field Invalid Review Date
     C                     MOVEL*BLANK    WUINRD  1
      * Define work field Spot Limit Amount Flag
     C                     MOVEL*BLANK    WUSLAF  1
      * Define work field Work File Date
     C                     Z-ADD*ZERO     WUWFDT  50
      * Define work field Forward Limit Amount Flag
     C                     MOVEL*BLANK    WUFLAF  1
      * Define work field Input field
     C                     MOVEL*BLANK    WUINPT  1
      * Define work field Window processing requir.
     C                     MOVEL*BLANK    WUWDPR  1
      * Define work field No. of Records
     C                     Z-ADD*ZERO     WUNORC  50
      * Define work field No. of Inserts
     C                     Z-ADD*ZERO     WUNOIN  50
      * Define work field No. of Amends
     C                     Z-ADD*ZERO     WUNOAM  50
      * Define work field No. of Deletes
     C                     Z-ADD*ZERO     WUNODL  50
      * Define work field Long Key
     C                     MOVEL*BLANK    WULKEY 50
      * Define work field Deleted Data Record Pt1
     C                     MOVEL*BLANK    WUDR01250
      * Define work field Deleted Data Record Pt2
     C                     MOVEL*BLANK    WUDR02250
      * Define work field Deleted Data Record Pt3
     C                     MOVEL*BLANK    WUDR03250
      * Define work field Deleted Data Record Pt4
     C                     MOVEL*BLANK    WUDR04250
      * Define work field Deleted Data Record Pt5
     C                     MOVEL*BLANK    WUDR05250
      * Define work field Deleted Data Record Pt6
     C                     MOVEL*BLANK    WUDR06250
      * Define work field Deleted Data Record Pt7
     C                     MOVEL*BLANK    WUDR07250
      * Define work field Deleted Data Record Pt8
     C                     MOVEL*BLANK    WUDR08250
      * Define work field Deleted Data Record Pt9
     C                     MOVEL*BLANK    WUDR09250
      * Define work field Deleted Data Record Pt10
     C                     MOVEL*BLANK    WUDR00250
      * Define work field Deleted Data Record Pt11
     C                     MOVEL*BLANK    WUDR11250
      * Define work field Deleted Data Record Pt12
     C                     MOVEL*BLANK    WUDR12250
      * Define work field Set Up Complete
     C                     MOVEL*BLANK    WUSUC   1
      * Define work field Standing data/Gen.Ledger
     C                     MOVEL*BLANK    WUSDGL  1
      * Define work field Dealing: FX
     C                     MOVEL*BLANK    WUDLFX  1
      * Define work field Syndicated Loans (REDUN)
     C                     MOVEL*BLANK    WUSYLN  1
      * Define work field Exposure Management
     C                     MOVEL*BLANK    WUEXMG  1
      * Define work field Retail Banking
     C                     MOVEL*BLANK    WURTBN  1
      * Define work field Midas/Swift direct link
     C                     MOVEL*BLANK    WUMSDL  1
      * Define work field Securities
     C                     MOVEL*BLANK    WUSECS  1
      * Define work field Auto-reconciliations
     C                     MOVEL*BLANK    WUAURC  1
      * Define work field Funds Transfer
     C                     MOVEL*BLANK    WUFDTR  1
      * Define work field Futures & Options
     C                     MOVEL*BLANK    WUFUOP  1
      * Define work field Message Management
     C                     MOVEL*BLANK    WUNWMI  1
      * Define work field FRA/IRS Indicator
     C                     MOVEL*BLANK    WUFIIN  1
      * Define work field Dealing: MM
     C                     MOVEL*BLANK    WUDLMM  1
      * Define work field Treasury Management
     C                     MOVEL*BLANK    WUTRMG  1
      * Define work field Interest Risk Management
     C                     MOVEL*BLANK    WURKMG  1
      * Define work field Microfiche
     C                     MOVEL*BLANK    WUMFIC  1
      * Define work field Interest on accounts
     C                     MOVEL*BLANK    WUIOAC  1
      * Define work field Confirmation Matching
     C                     MOVEL*BLANK    WUCFMT  1
      * Define work field Report Control Facility
     C                     MOVEL*BLANK    WURCFI  1
      * Define work field Optical Disk
     C                     MOVEL*BLANK    WUOPDK  1
      * Define work field History & Audit Facility
     C                     MOVEL*BLANK    WUNUST  1
      * Define work field Midas Export Data Module
     C                     MOVEL*BLANK    WUNZST  1
      * Define work field SAR number field
     C                     MOVEL*BLANK    WUSARN  6
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Open files
      * Begin commit control
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW02  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW03  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW04  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW05  50       *Synon (5,0) wo
     C                     MOVEL*BLANKS   YRSW06  1        *String work fi
     C                     MOVEL*BLANKS   YRSW07  1        *String work fi
     C                     MOVEL*BLANKS   YRSW08  7        *Return code
     C                     MOVEL*BLANKS   YRSW09  1        *String work fi
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0A           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0B           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0C           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0D           *Synon (9999) w
     C                     MOVEL*BLANKS   YRSW0E  1        *String work fi
     C                     MOVEL*BLANKS   YRSW0F  1        *String work fi
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     OPEN SD0452R#
     C                     OPEN SDCLLML1
     C                     OPEN SDCUSTL1
     C                     OPEN SDLIMTL0
     C                     OPEN SDMMODL1
     C                     OPEN SDCLLML0
     C                     OPEN SDFCTLL0
     C                     MOVEL'N'       W0PMT   1
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * Start of S01459
      * Remove creation parameters user source.
      * Remove last amend box user source.
      * SD0452R precompiler - Client Limits  *
      * End of S01459
      * Copyright Statement 1988 - Standard Functions  *
      *                                                                   CDL006
      ** Dataarea LDA                                                     CDL006
      *                                                                   CDL006
     C           *NAMVAR   DEFN           LDA                             CDL006
      * Get Rundate - Rundate  *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT  7        RUN DATE
     C                     MOVE MRDT      WUMRDT
     C                     MOVE RDNB      WURDNB           RUNDAY NO.
     C                     MOVE SUC       WUSUC            SET UP COMPLT
     C                     MOVE DFF       WUDFF            DTE FMT FLAG
     C                     MOVE MBIN      WUMBIN           MULTI BR. IND
      *                                                                   CDL006
      ** Prepare LDA                                                      CDL006
      *                                                                   CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     MOVEL*BLANK    DBLOT                           CDL006
     C                     MOVEL'SD0452R' DBPGM                           CDL006
     C                     OUT  LDA                                       CDL006
      * Check if Customer Lending is ON.
      * get practically everythin - MIDAS Modules  *
     C                     EXSR SJRVGN
      * Set indicator to display 'Lending' fields ?  (E088472)            139827
     C                     EXSR UOSUBR                     Set indicator t139827
      * Check if SAR S01433 is switched ON.
     C                     MOVEL'N'       WUSARF           SAR S01433
     C                     MOVEL'S01433'  WUSARN           SAR number fiel
     C                     MOVEL*BLANK    WUAPRC           Access Pgm Retu
      * SAR switched on check - Standard Functions  *
     C                     CALL 'AOSARDR0'             90  SAR switched on
     C           WUAPRC    PARM WUAPRC    WQ0138  7        Access Pgm Retu
     C                     PARM '*VERIFY' WQ0139  7        Option for ACCO
     C           WUSARN    PARM WUSARN    WQ0140  6        SAR number fiel
     C                     PARM *BLANK    WQ0141 76        Access obj dumm
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'AOSARDR0'W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * CASE: WRK.Access Pgm Return Code is AP No Record Found
     C           WUAPRC    IFEQ '*NRF'                     *IF
     C                     MOVEL'N'       WUSARF           SAR S01433
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUSARF           SAR S01433
     C                     END                             *FI
      *                                                                   CDL006
      ** Access Switchable Feature Details, Check if CDL006 is            CDL006
      ** switch on.                                                       CDL006
      *                                                                   CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   PRTCD   7                       CDL006
     C                     PARM '*VERIFY 'POPTN   7                       CDL006
     C                     PARM 'CDL006'  PSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSSDY                           CDL006
      *                                                                   CDL006
     C           PRTCD     IFNE *BLANK                                    CDL006
     C           PRTCD     ANDNE'*NRF '                                   CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     Z-ADD001       DBASE            ***************CDL006
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 001*CDL006
     C                     MOVELPSARD     DBKEY            ***************CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C           PRTCD     IFEQ *BLANKS                                   CDL006
     C                     MOVE 'Y'       CDL006  1                       CDL006
     C                     MOVE '1'       *IN45                           CDL006
     C                     ELSE                                           CDL006
     C                     MOVE 'N'       CDL006                          CDL006
     C                     MOVE '0'       *IN45                           CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CGL011
      ** Access Switchable Features file and check if CGL011 is           CGL011
      ** switched on or not.                                              CGL011
      *                                                                   CGL011
     C                     CALL 'AOSARDR0'                                CGL011
     C                     PARM *BLANKS   PRTCD   7                       CGL011
     C                     PARM '*VERIFY' POTPN   7                       CGL011
     C                     PARM 'CGL011'  PSARD   6                       CGL011
     C           SCSARD    PARM SCSARD    DSFDY                           CGL011
      *                                                                   CGL011
     C           PRTCD     IFEQ *BLANKS                                   CGL011
     C                     MOVE 'Y'       CGL011  1                       CGL011
     C                     ELSE                                           CGL011
     C                     MOVE 'N'       CGL011                          CGL011
      *                                                                   CGL011
      ** Database Error, if Return Code is not blanks or *NRF             CGL011
      *                                                                   CGL011
     C           PRTCD     IFNE '*NRF   '                                 CGL011
     C           *LOCK     IN   LDA                                       CGL011
     C                     MOVEL'002'     DBASE            ***************CGL011
     C                     MOVEL'SCSARDPD'DBFILE           * DB ERROR 002*CGL011
     C                     MOVEL'CGL011'  DBKEY            ***************CGL011
     C                     OUT  LDA                                       CGL011
     C                     EXSR *PSSR                                     CGL011
     C                     ENDIF                                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
      * Start of change 107583
      * Move the setting of the indicator to display the 'Lending fields'
      * to this part of the program because it depends on the presence of
      * Feature S01433.
      * Set indicator to display 'Lending' fields ?  (E088472)
     C*****                EXSR UOSUBR                     Set indicator t139827
      * End of change 107583
      * Program Mode processing
      * CASE: PAR.Action Code is Insert
     C           P2ANCD    IFEQ 'I'                        *IF
     C                     MOVEL'ADD'     W0PMD            *Program mode
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'CHG'     W0PMD            *Program mode
     C                     END                             *FI
      * Get 'Window required' ind - MIDAS Modules  *
     C                     EXSR SKRVGN
      * SDCLLM Data Structure - Client Limits  *
      * Start of 077893
     C                     MOVELP4INPT    WUINPT           Input field
      * End of 077893
      * 00/Copy member SD0452RIPG - Client Limits  *
     C/COPY WNCPYSRC,SD0452RCPG
      *                                                                                       CER001
      ** Access SAR details file to determine if ULX004 is on                                 CER001
      *                                                                                       CER001
     C                     MOVEL'N'       ULX004                                              CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   @RTCD   7                                           CER001
     C                     PARM '*VERIFY' @OPTN   7                                           CER001
     C                     PARM 'ULX004'  @SARD   6                                           CER001
     C           SCSARD    PARM SCSARD    DSFDY 200                                           CER001
     C           @RTCD     IFEQ *BLANK                                                        CER001
     C                     MOVEL'Y'       ULX004  1                                           CER001
     C                     ELSE                                                               CER001
     C           @RTCD     IFNE '*NRF   '                                                   BUG11738
     C           *LOCK     IN   LDA                                                           CER001
     C                     Z-ADD003       DBASE                                               CER001
     C                     MOVEL'SCSARDPD'DBFILE                                              CER001
     C**********           MOVELPSARD     DBKEY                                      CER001 BUG11738
     C                     MOVEL@SARD     DBKEY                                             BUG11738
     C                     OUT  LDA                                                           CER001
     C                     EXSR *PSSR                                                         CER001
     C                     ENDIF                                                            BUG11738
     C                     ENDIF                                                              CER001
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT
     CSR         *PSSR     BEGSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
      *
      * Core function specific processing.
      *
     C/COPY WNCPYSRC,SD0452RPSC
      *
      * Start of PSSR user point.
      *
     C/COPY WNCPYSRC,SD0452RPS1
      *
      * Standard Midas PSSR processing.
      *
     C/COPY SDCPYSRC,SDPSSRINT
      *
      * End of PSSR user point.
      *
     C/COPY WNCPYSRC,SD0452RPS2
      *
      *================================================================
     CSR                   ENDSR
      /EJECT                                                                                  CER001
     CSR         GET3SC    BEGSR                                                              CER001
      *****************************************************************                       CER001
      *                                                               *                       CER001
      * GET3SC - Get third screen                                     *                       CER001
      *                                                               *                       CER001
      *****************************************************************                       CER001
     C                     MOVEL#1CUST    #2CUST                                              CER001
     C                     MOVEL#1LEVL    #2LEVL                                              CER001
     C                     MOVEL#1BCCD    #2BCCD                                              CER001
     C                     CALL 'SD0453'                                                      CER001
     C                     PARM *BLANK    RTNCDE 10                                           CER001
     C                     PARM           UACTCD                                              CER001
     C                     PARM           DATALX                                              CER001
     C                     PARM *BLANK    W0RTN                                               CER001
      *                                                                                       CER001
      *================================================================                       CER001
     CSR                   ENDSR                                                              CER001
      *================================================================                       CER001
      *================================================================
     O/COPY WNCPYSRC,SD0452ROPG
** CPY@     : Copyright notice for inclusion in all programs
(c) Misys International Banking Systems Ltd. 2001
