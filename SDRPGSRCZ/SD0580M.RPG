     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SD Accounts by BSPL codes maint subfile')
      *****************************************************************
      *                                                               *
      *  Midas - Standing Data Module                                 *
      *                                                               *
      *  SD0580M - Midas SD Accounts by BSPL Codes Maint Subfile      *
      *                                                               *
      *  Function:  This program allows the user to maintain the      *
      *             BSPL codes via a subfile.                         *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
     F*  Last Amend No.: 124924            Date 26May06               *
      *  Last Amend No. CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *  Prev Amend No. 174970             Date 11Feb00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CSD003             Date 15APR99               *
      *                 S01459             Date 15APR99               *
      *                 CTI002             Date 23SEP98               *
      *                 S01117             Date 06FEB91               *
      *                                                               *
      *-------------------------------------------------------------- *
      *                                                               *
     F*  124924 - BS/PL codes with defined account codes can not be   *
     F*           changed. Apllied fix 123215 - allow amendment if    *
     F*           records for BS/PL code exist on PF/SDACRCPD.        *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  174970 - Remove unnecessary validation in DEV1RC introduced  *
      *           by SYNON                                            *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CSD003 - Synon Closedown Project (SD):                       *
      *           - Program removed from SD model.                    *
      *  S01459 - Addition of Midas Headerbox.                        *
      *  CTI002 - Recompiled : File SDACODPD changed.                 *
      *  S01117 - Add RCF Processing (LN1121).                        *
      *                                                               *
      *****************************************************************
     FSD0580M#CF  E                    WORKSTN                        UC
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
     F                                              KINFSR *PSSR
      * DSP: Midas SD Accounts by report codes maint subfile
      *
     FSDACRCL1IF  E           K        DISK                           UC
     F                                              KINFDS INFDS1
     F                                              KINFSR *PSSR
      * RTV : Midas SD Accounts by report codes retrieval
      *
     FSDACODL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0001
     F                                              KINFSR *PSSR
      * RTV : Midas SD Account codes retrieval
      *
     FSDACRCL6IF  E           K        DISK                           UC
     F                                              KINFDS ID0002
     F                                              KINFSR *PSSR
      * RSQ : Midas SD A/c by report codes
      *
     FSDREPCL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0003
     F                                              KINFSR *PSSR
      * RTV : Midas SD Reporting codes retrieval
      *
     FSDACRCL0UF  E           K        DISK                      A    UC
     F                                              KCOMIT
     F                                              KINFDS ID0004
     F                                              KINFSR *PSSR
      * UPD : Midas SD Accounts by report codes update
      *
     FSDFCTLL0UF  E           K        DISK                           UC
     F                                              KCOMIT
     F                                              KINFDS ID0005
     F                                              KINFSR *PSSR
      * UPD : Midas SD Standing data controls update
      *
     E* Description     : Copyright notice for inclusion in all programs
     E*
     E********************************************************************
     E                    CPY@    1   1 80               Copyright array
     I@ACRCK1
      * Midas SD A/c by report codes
      * Renamed input format fields
     I              G6RSNO                          WARSNO
     I              G6RSCD                          WARSCD
     I              G6ACCD                          WAACCD
     I              G6DRCR                          WADRCR
      *
     I*
     I* Description     : Copyright notice for inclusion in all programs
     I*
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSSDACRCL0
      * UPD : Midas SD Accounts by report codes update
      * Current/previous master file format fields for change control
      *
     IWUDELR      DS
     I                                        1 250 WUDR01
     I                                      251 500 WUDR02
     I                                      501 750 WUDR03
     I                                      7511000 WUDR04
     I                                     10011250 WUDR05
     I                                     12511500 WUDR06
     I                                     15011750 WUDR07
     I                                     17512000 WUDR08
     I                                     20012250 WUDR09
     I                                     22512500 WUDR00
     I                                     25012750 WUDR11
     I                                     27513000 WUDR12
      * Outward parameters
     IPARC        DS                           3064
      * RCD : Midas SD Deleted records file retrieval
      * I :  File name
     I                                        1  10 PAFNME
      * I :  Long Key
     I                                       11  60 PALKEY
      * I :  Deleted Data Record Pt1
     I                                       61 310 PADR01
      * I :  Deleted Data Record Pt2
     I                                      311 560 PADR02
      * I :  Deleted Data Record Pt3
     I                                      561 810 PADR03
      * I :  Deleted Data Record Pt4
     I                                      8111060 PADR04
      * I :  Deleted Data Record Pt5
     I                                     10611310 PADR05
      * I :  Deleted Data Record Pt6
     I                                     13111560 PADR06
      * I :  Deleted Data Record Pt7
     I                                     15611810 PADR07
      * I :  Deleted Data Record Pt8
     I                                     18112060 PADR08
      * I :  Deleted Data Record Pt9
     I                                     20612310 PADR09
      * I :  Deleted Data Record Pt10
     I                                     23112560 PADR00
      * I :  Deleted Data Record Pt11
     I                                     25612810 PADR11
      * I :  Deleted Data Record Pt12
     I                                     28113060 PADR12
      * I :  Last Change Date
     I                                    P306130630PALCD
      * I :  Type of Last Change
     I                                     30643064 PATYLC
      *
     IQSDFC1    E DSSDFCTLL0
      * UPD : Midas SD Standing data controls update
     IYARDCS      DS                             22
     IYBRDCS      DS                             22
     IYCRDCS      DS                             22
     IYDRDCS      DS                             22
     IYERDCS      DS                             22
     IYFRDCS      DS                             22
     IYGRDCS      DS                             22
     IYHRDCS      DS                             22
     IYIRDCS      DS                             22
     IYJRDCS      DS                             22
     IYKRDCS      DS                             22
     IYLRDCS      DS                             22
     IYMRDCS      DS                             22
     IYNRDCS      DS                             22
     IYORDCS      DS                             22
     IYPRDCS      DS                             22
     IYQRDCS      DS                             22
     IYRRDCS      DS                             22
     IYSRDCS      DS                             22
     I***YTRDCS*     DS                             14                                        CGL029
     IYTRDCS      DS                           9999                                           CGL029
     IA@CPY       DS
     I* Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNB
     I                                       11  11 SUC
     I                                       12  12 DFF
     I                                       13  13 MBIN
     IYRSW0A      DS                           9999
     IYRSW0B      DS                           9999
     IYRSW0C      DS                           9999
     IYRSW0D      DS                           9999
     IID0001      DS                            528
      * File information data structure
      *
     IID0002      DS                            528
      * File information data structure
      *
     IID0003      DS                            528
      * File information data structure
      *
     IID0004      DS                            528
      * File information data structure
      *
     IID0005      DS                            528
      * File information data structure
      *
      /EJECT
      * Parameter declarations
     I***P1PARM*     DS                              5                                        CGL029
     IP1PARM      DS                             11                                           CGL029
      * KEY: Midas SD Reporting codes retrieval
      * I : RST Reporting Set Number
     I                                        1   1 P1RSNO
      * I : RST Reporting Structure Code
     I**********                              2   5 P1RSCD                                    CGL029
     I                                        2  11 P1RSCD                                    CGL029
     IP2PARM      DS
      * I :  Action Code
     I                                        1   1 P2ANCD
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Debit/Credit Ind invalid'
      * DR/CR Ind - screen
     I                                        1   1 ZA0001
      * Message data for 'Title 'Y' , Accnt invalid'
      * Stored Account Code
     I**********                              1   4 ZA0002                                    CGL029
     I                                        1  10 ZA0002                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0003                                    CGL029
     I                                        1  10 ZA0003                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0004                                    CGL029
     I                                       11  11 ZA0004                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0005                                    CGL029
     I                                        1  10 ZA0005                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0006                                    CGL029
     I                                       11  11 ZA0006                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0007                                    CGL029
     I                                        1  10 ZA0007                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0008                                    CGL029
     I                                       11  11 ZA0008                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0009                                    CGL029
     I                                        1  10 ZA0009                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0010                                    CGL029
     I                                       11  11 ZA0010                                    CGL029
      * Message data for 'Invalid Account Code'
      * Account Code
     I**********                              1   4 ZA0011                                    CGL029
     I                                        1  10 ZA0011                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0012                                    CGL029
     I                                        1  10 ZA0012                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0013                                    CGL029
     I                                       11  11 ZA0013                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0014                                    CGL029
     I                                        1  10 ZA0014                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0015                                    CGL029
     I                                        5   5 ZA0015                                    CGL029
      * Message data for 'Title 'Y' , Accnt invalid'
      * Stored Account Code
     I**********                              1   4 ZA0016                                    CGL029
     I                                        1  10 ZA0016                                    CGL029
      * Message data for 'DR/CR Ind blank - invalid'
      * DR/CR Ind - screen
     I                                        1   1 ZA0017
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0018                                    CGL029
     I                                        1  10 ZA0018                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0019                                    CGL029
     I                                       11  11 ZA0019                                    CGL029
      * Message data for 'Debit/Credit Ind invalid'
      * DR/CR Ind - screen
     I                                        1   1 ZA0020
      * Message data for 'Title 'Y' , Accnt invalid'
      * Stored Account Code
     I**********                              1   4 ZA0021                                    CGL029
     I                                        1  10 ZA0021                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0022                                    CGL029
     I                                        1  10 ZA0022                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0023                                    CGL029
     I                                       11  11 ZA0023                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0024                                    CGL029
     I                                        1  10 ZA0024                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0025                                    CGL029
     I                                       11  11 ZA0025                                    CGL029
      * Message data for 'Invalid Account Code'
      * Account Code
     I**********                              1   4 ZA0026                                    CGL029
     I                                        1  10 ZA0026                                    CGL029
      * Message data for 'Title 'Y' , Accnt invalid'
      * Stored Account Code
     I**********                              1   4 ZA0027                                    CGL029
     I                                        1  10 ZA0027                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0028                                    CGL029
     I                                        1  10 ZA0028                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0029                                    CGL029
     I                                       11  11 ZA0029                                    CGL029
      * Message data for 'Accounts by Report Cod EX'
      * Account Code
     I**********                              1   4 ZA0030                                    CGL029
     I                                        1  10 ZA0030                                    CGL029
      * Debit/Credit Ind.
     I**********                              5   5 ZA0031                                    CGL029
     I                                       11  11 ZA0031                                    CGL029
      * Message data for 'DR/CR Inval- A/c Cd blank'
      * Stored Account Code
     I**********                              1   4 ZA0032                                    CGL029
     I                                        1  10 ZA0032                                    CGL029
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Reporting
     C           P2ANCD    PARM           WP0001  1        Action Code
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      *................................................................
      * If CHANGE mode, then position file:
     C           W0PMD     IFNE 'ADD'
     C           KPOS      KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Setup key
     C                     MOVEL#2RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#2RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#2ACCD    G6ACCD           Account Code
     C                     MOVEL#2DRCR    G6DRCR           Debit/Credit In
      * 82=EOF
     C           KPOS      SETLL@AGREAR              82    *
      * 82=EOF
     C           KRST      KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
      * Setup key
     C                     MOVEL#2RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#2RSCD    G6RSCD           Reporting Struc
     C  N82      KRST      READE@AGREAR                9182*
     C                     ELSE
     C                     SETOF                     82    *
     C                     END
      * Load subfile page
     C                     EXSR BBLDSF
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page (write empty page if add mode)
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27      W0PMD     IFNE 'ADD'
     C  N82                READP@AGREAR                  90*
     C  N82                READ @AGREAR                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  2
     C                     MOVE *ALL'1'   WKIND1  2
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFLN                     DO
     C                     ADD  1         ##RR
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * If CHANGE mode, load subfile fields
     C           W0PMD     IFNE 'ADD'
     C                     EXSR MBFL#1
      * Initialise virtual fields
     C                     EXSR MDIZ#1
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialize subfile record (existing record)
     C                     MOVELG6ACCD    #RSTAC           Stored Account
      * Set up Debit/Credit indicator from file.
     C                     EXSR UASUBR                     Set up Debit/Cr
      * If record dropped...
     C                     SUB  1         ##RR
     C           W0RSL     CABNE'Y'       BB020
     C                     ADD  1         ##RR
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
     C                     END
      * Output to subfile
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C           W0PMD     IFNE 'ADD'
      * 82=EOF
     C           KRST      READE@AGREAR                  82*
     C                     END
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      * Switch between *ADD/*CHANGE modes
     C   09                EXSR FACHMD
      * USER: Process command keys
      * F9 for Change not allowed if there are no records on file (excl.
      * CASE: CTL.*CMD key is CF09
     C           *IN09     IFEQ '1'                        *IF
      * Is account code blank? - Accounts by Report Codes  *
     C                     EXSR SARVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'ADD'     W0PMD            *Program mode
      * Send message 'F9 for change invalid'
     C                     MOVEL'USR1637' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     END                             *FI
      * If user has deleted all records (except dummy), must remain in AD
      * CASE: WRK.Add Mode required is Yes
     C           WUADRQ    IFEQ 'Y'                        *IF
     C                     MOVEL'ADD'     W0PMD            *Program mode
     C                     MOVEL'N'       WUADRQ           Add Mode requir
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
      * Previous screen processing.
      * CASE: CTL.*CMD key is CF12
     C           *IN12     IFEQ '1'                        *IF
     C                     MOVEL'USR0790' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
      * No errors
     C                     SETOF                     98
      * No SFLNXTCHG
     C                     SETOF                     84
      * Initialise virtual fields
     C                     EXSR MDIZ#1
     C           W0PMD     IFEQ 'ADD'
      * Check for null record
     C                     EXSR DDNLRC
     C           W0NLR     IFEQ 'Y'
     C                     GOTO DCEXIT
     C                     END
      * If not null record, continue
     C                     END
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
     C           #RSTAC    CABNE*BLANK    DDEXIT           Stored Account
     C           #RDCIS    CABNE*BLANK    DDEXIT           DR/CR Ind - scr
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * Validate subfile record relations
     C                     EXSR DFV2RC
      **Stored*Account Code required                                      174970
     C********** #RSTAC    IFEQ *BLANK                     IF             174970
     C**********           SETON                     9831  *              174970
      **Send*message '*Value required'                                    174970
     C**********           MOVEL'Y2U0001' ZAMSID                          174970
     C**********           MOVEL'Y2USRMSG'ZAMSGF                          174970
     C**********           EXSR ZASNMS                                    174970
     C**********           END                             FI             174970
      **DR/CR*Ind - screen required                                       174970
     C********** #RDCIS    IFEQ *BLANK                     IF             174970
     C**********           SETON                     9832  *              174970
      * Send message '*Value required'
     C**********           MOVEL'Y2U0001' ZAMSID                          174970
     C**********           MOVEL'Y2USRMSG'ZAMSGF                          174970
     C**********           EXSR ZASNMS                                    174970
     C**********           END                             FI             174970
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Check reference to Account Codes
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * USER: Validate subfile record relations
      * Previous screen processing.
      * CASE: CTL.*CMD key is CF12
     C           *IN12     IFEQ '1'                        *IF
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL'USR0790' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
      * Validate screen.
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * Amend Mode processing.
     C                     EXSR UBSUBR                     Amend Mode proc
     C                     ELSE
      * CASE: *OTHERWISE
      * Insert Mode processing.
     C                     EXSR ULSUBR                     Insert Mode pro
     C                     END                             *FI
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0RSF
     C                     ELSE
     C                     MOVEL'N'       W0RSF
     C                     END
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C           W0RTN     IFNE *BLANK
      * Error: ROLLBACK any DBF changes
     C                     ROLBK
     C                     ELSE
      * Otherwise COMMIT any DBF changes
     C                     COMIT
     C                     END
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     98
      *
     C           W0PMD     IFEQ 'ADD'
      * Process add request
     C                     EXSR DDNLRC
     C           W0NLR     IFNE 'Y'
     C                     EXSR ECADRQ
     C                     END
     C                     ELSE
      * Process change request
     C                     EXSR EECHRQ
     C                     END
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * EDTFILE Create Object - Accounts by Report Codes  *
     C                     EXSR SYCRRC
     C           W0RTN     IFNE *BLANK
      * Write error detected
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
     C                     ELSE
      * DBF write successful
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * EDTFILE CHG calls DLT/CRT - Accounts by Report Codes  *
     C                     EXSR TXCHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'ADD'     W0PMD
     C                     ELSE
     C                     MOVEL'CHG'     W0PMD
     C                     END
     C                     EXSR FBRQRL
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     MOVELP1RSNO    #1RSNO           Reporting Set N
     C                     MOVELP1RSCD    #1RSCD           Reporting Struc
     C                     MOVEL*BLANK    #1RPNA           Reporting Narra
     C                     MOVEL*BLANK    #1ACCD           Account Code
     C                     MOVEL*BLANK    #1DRCR           Debit/Credit In
     C                     Z-ADD*ZERO     #1LCD            Last Change Dat
     C                     MOVEL*BLANK    #1TYLC           Type of Last Ch
     C                     MOVEL*BLANK    #RSTAC           Stored Account
     C                     MOVEL*BLANK    #RDCIS           DR/CR Ind - scr
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @AGREAR fields to subfile
      *================================================================
     C                     MOVELG6RSNO    #1RSNO           Reporting Set N
     C                     MOVELG6RSCD    #1RSCD           Reporting Struc
     C                     MOVELG6RPNA    #1RPNA           Reporting Narra
     C                     MOVELG6ACCD    #1ACCD           Account Code
     C                     MOVELG6DRCR    #1DRCR           Debit/Credit In
     C                     Z-ADDG6LCD     #1LCD            Last Change Dat
     C                     MOVELG6TYLC    #1TYLC           Type of Last Ch
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#1    BEGSR
      *================================================================
      * Initialise virtual fields
      *================================================================
     C                     MOVEL*BLANK    #1RPNA           Reporting Narra
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVEL*BLANK    #2ACCD           Account Code
     C                     MOVEL*BLANK    #2DRCR           Debit/Credit In
     C                     MOVELP1RSNO    #2RSNO           Reporting Set N
     C                     MOVELP1RSCD    #2RSCD           Reporting Struc
     C                     MOVEL*BLANK    #2RPNA           Reporting Narra
      * Check restriction within
     C                     EXSR VBCKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         NARVGN    BEGSR
      *================================================================
      * Record exists ? - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN G6RSNO    WQNA01           Reporting Set N
     C           *LIKE     DEFN G6RSCD    WQNA02           Reporting Struc
      * Define keylist
     C           KRSNA     KLIST
     C                     KFLD           WQNA01           Reporting Set N
     C                     KFLD           WQNA02           Reporting Struc
      * Move fields to key list
     C                     MOVEL#1RSNO    WQNA01           Reporting Set N
     C                     MOVEL#1RSCD    WQNA02           Reporting Struc
     C           KRSNA     SETLL@AGREAR                    *
     C           KRSNA     READE@AGREAR                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO NAEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSNA     READE@AGREAR                  90*
     C                     END
      *================================================================
     CSR         NAEXIT    ENDSR
      /EJECT
     CSR         NBCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YLRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNB    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNB    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NBEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NBEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YLRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YLRDCS
     C                     MOVE 'Y'       YLRDC
     C                     END
      * If changed update record otherwise release record
     C           YLRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NBEXIT    ENDSR
      /EJECT
     CSR         NCCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRNC    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRNC    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO NCEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NDCHRC
     C                     END
      *================================================================
     CSR         NCEXIT    ENDSR
      /EJECT
     CSR         NDCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YMRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHND    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHND    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NDEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NDEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YMRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YMRDCS
     C                     MOVE 'Y'       YMRDC
     C                     END
      * If changed update record otherwise release record
     C           YMRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NDEXIT    ENDSR
      /EJECT
     CSR         NEDLRC    BEGSR
      *================================================================
      * EDTFILE Delete object - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#1ACCD    G6ACCD           Account Code
     C                     MOVEL#1DRCR    G6DRCR           Debit/Credit In
      *
     C           KLDLNE    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLNE    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NEEXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      * USER: Processing after Data update
      * WUDELR Data Structure - SD Deleted Records File  *
     C                     MOVEL@1DBRC    WUDELR
      * Concat the four part key into one field
     C           #1RSNO    CAT  #1RSCD    WUIK1A    P      Interim Key 05
     C           #1ACCD    CAT  #1DRCR    WUIK5B    P      Interim Key 05
     C           WUIK1A    CAT  WUIK5B    WULKEY    P      Long Key
      * Write Deleted Record - SD Deleted Records File  *
     C                     CLEARPARC
     C                     MOVEL'SDACRCPD'PAFNME           File name
     C                     MOVELWULKEY    PALKEY           Long Key
     C                     MOVELWUDR01    PADR01           Deleted Data Re
     C                     MOVELWUDR02    PADR02           Deleted Data Re
     C                     MOVELWUDR03    PADR03           Deleted Data Re
     C                     MOVELWUDR04    PADR04           Deleted Data Re
     C                     MOVELWUDR05    PADR05           Deleted Data Re
     C                     MOVELWUDR06    PADR06           Deleted Data Re
     C                     MOVELWUDR07    PADR07           Deleted Data Re
     C                     MOVELWUDR08    PADR08           Deleted Data Re
     C                     MOVELWUDR09    PADR09           Deleted Data Re
     C                     MOVELWUDR00    PADR00           Deleted Data Re
     C                     MOVELWUDR11    PADR11           Deleted Data Re
     C                     MOVELWUDR12    PADR12           Deleted Data Re
     C                     Z-ADDWURDNB    PALCD            Last Change Dat
     C                     MOVEL'D'       PATYLC           Type of Last Ch
      *
     C                     CALL 'SD0520X'              90  Write Deleted R
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             RCD: SD Deleted
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0520X' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NFCHRC
     C                     END
      *================================================================
     CSR         NEEXIT    ENDSR
      /EJECT
     CSR         NFCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YNRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNF    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNF    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NFEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NFEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YNRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YNRDCS
     C                     MOVE 'Y'       YNRDC
     C                     END
      * If changed update record otherwise release record
     C           YNRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NFEXIT    ENDSR
      /EJECT
     CSR         NGRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQNG01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQNG02           Account Code
     C           *LIKE     DEFN WADRCR    WQNG03           Debit/Credit In
      * Define keylist
     C           KRSNG     KLIST
     C                     KFLD           WQNG01           Reporting Set N
     C                     KFLD           WQNG02           Account Code
     C                     KFLD           WQNG03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQNG01           Reporting Set N
     C                     MOVEL#RSTAC    WQNG02           Account Code
     C                     MOVEL'0'       WQNG03           Debit/Credit In
     C           KRSNG     SETLL@ACRCK1                    *
     C           KRSNG     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO NGEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSNG     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         NGEXIT    ENDSR
      /EJECT
     CSR         NHCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRNH    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRNH    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO NHEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NICHRC
     C                     END
      *================================================================
     CSR         NHEXIT    ENDSR
      /EJECT
     CSR         NICHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YORDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNI    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNI    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NIEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NIEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YORDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YORDCS
     C                     MOVE 'Y'       YORDC
     C                     END
      * If changed update record otherwise release record
     C           YORDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NIEXIT    ENDSR
      /EJECT
     CSR         NJRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQNJ01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQNJ02           Account Code
     C           *LIKE     DEFN WADRCR    WQNJ03           Debit/Credit In
      * Define keylist
     C           KRSNJ     KLIST
     C                     KFLD           WQNJ01           Reporting Set N
     C                     KFLD           WQNJ02           Account Code
     C                     KFLD           WQNJ03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQNJ01           Reporting Set N
     C                     MOVEL#RSTAC    WQNJ02           Account Code
     C                     MOVEL'1'       WQNJ03           Debit/Credit In
     C           KRSNJ     SETLL@ACRCK1                    *
     C           KRSNJ     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO NJEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSNJ     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         NJEXIT    ENDSR
      /EJECT
     CSR         NKCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRNK    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRNK    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO NKEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'I'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NLCHRC
     C                     END
      *================================================================
     CSR         NKEXIT    ENDSR
      /EJECT
     CSR         NLCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YPRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNL    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNL    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NLEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NLEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YPRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YPRDCS
     C                     MOVE 'Y'       YPRDC
     C                     END
      * If changed update record otherwise release record
     C           YPRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NLEXIT    ENDSR
      /EJECT
     CSR         NMCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'0'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRNM    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRNM    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO NMEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NNCHRC
     C                     END
      *================================================================
     CSR         NMEXIT    ENDSR
      /EJECT
     CSR         NNCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YQRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNN    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNN    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NNEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NNEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YQRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YQRDCS
     C                     MOVE 'Y'       YQRDC
     C                     END
      * If changed update record otherwise release record
     C           YQRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NNEXIT    ENDSR
      /EJECT
     CSR         NOCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'0'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRNO    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRNO    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO NOEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NPCHRC
     C                     END
      *================================================================
     CSR         NOEXIT    ENDSR
      /EJECT
     CSR         NPCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YRRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNP    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNP    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NPEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NPEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YRRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YRRDCS
     C                     MOVE 'Y'       YRRDC
     C                     END
      * If changed update record otherwise release record
     C           YRRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NPEXIT    ENDSR
      /EJECT
     CSR         NQCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRNQ    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRNQ    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO NQEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NRCHRC
     C                     END
      *================================================================
     CSR         NQEXIT    ENDSR
      /EJECT
     CSR         NRCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YSRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNR    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNR    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NREXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NREXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YSRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YSRDCS
     C                     MOVE 'Y'       YSRDC
     C                     END
      * If changed update record otherwise release record
     C           YSRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NREXIT    ENDSR
      /EJECT
     CSR         NSRVGN    BEGSR
      *================================================================
      * Is account code blank? - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSNS     KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Move fields to key list
     C                     MOVELP1RSNO    G6RSNO           Reporting Set N
     C                     MOVELP1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C           KRSNS     CHAIN@AGREAR              90    *
      *                                                                   124924
      *  If the first record for this BS/PL has a blank account code,     124924
      *  check if the next record for the same set has account code.      124924
      *                                                                   124924
     C           *IN90     IFEQ '0'                                       124924
     C                     READ @AGREAR                  90               124924
     C           *IN90     IFEQ '0'                                       124924
     C           P1RSNO    ANDEQG6RSNO                                    124924
     C           P1RSCD    ANDEQG6RSCD                                    124924
     C           G6ACCD    ANDNE*BLANKS                                   124924
     C                     READP@AGREAR                  90               124924
     C                     MOVEL'1'       *IN90                           124924
     C                     END                                            124924
     C                     END                                            124924
      *                                                                   124924
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO NSEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     END
      *================================================================
     CSR         NSEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Is account code blank? - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Move fields to key list
     C                     MOVELP1RSNO    G6RSNO           Reporting Set N
     C                     MOVELP1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C           KRSSA     CHAIN@AGREAR              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Retrieve Title only - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVELWUACCD    A5ACCD           Account Code
     C           KRSSB     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSC01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSC02           Account Code
     C           *LIKE     DEFN WADRCR    WQSC03           Debit/Credit In
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           WQSC01           Reporting Set N
     C                     KFLD           WQSC02           Account Code
     C                     KFLD           WQSC03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSC01           Reporting Set N
     C                     MOVELWUACCD    WQSC02           Account Code
     C                     MOVEL'0'       WQSC03           Debit/Credit In
     C           KRSSC     SETLL@ACRCK1                    *
     C           KRSSC     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SCEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSC     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSD01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSD02           Account Code
     C           *LIKE     DEFN WADRCR    WQSD03           Debit/Credit In
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           WQSD01           Reporting Set N
     C                     KFLD           WQSD02           Account Code
     C                     KFLD           WQSD03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSD01           Reporting Set N
     C                     MOVELWUACCD    WQSD02           Account Code
     C                     MOVEL'1'       WQSD03           Debit/Credit In
     C           KRSSD     SETLL@ACRCK1                    *
     C           KRSSD     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SDEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSD     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSE01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSE02           Account Code
     C           *LIKE     DEFN WADRCR    WQSE03           Debit/Credit In
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           WQSE01           Reporting Set N
     C                     KFLD           WQSE02           Account Code
     C                     KFLD           WQSE03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSE01           Reporting Set N
     C                     MOVELWUACCD    WQSE02           Account Code
     C                     MOVELWUDRCR    WQSE03           Debit/Credit In
     C           KRSSE     SETLL@ACRCK1                    *
     C           KRSSE     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSE     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSF01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSF02           Account Code
     C           *LIKE     DEFN WADRCR    WQSF03           Debit/Credit In
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           WQSF01           Reporting Set N
     C                     KFLD           WQSF02           Account Code
     C                     KFLD           WQSF03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSF01           Reporting Set N
     C                     MOVELWUACCD    WQSF02           Account Code
     C                     MOVEL'0'       WQSF03           Debit/Credit In
     C           KRSSF     SETLL@ACRCK1                    *
     C           KRSSF     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SFEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSF     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSG01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSG02           Account Code
     C           *LIKE     DEFN WADRCR    WQSG03           Debit/Credit In
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           WQSG01           Reporting Set N
     C                     KFLD           WQSG02           Account Code
     C                     KFLD           WQSG03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSG01           Reporting Set N
     C                     MOVELWUACCD    WQSG02           Account Code
     C                     MOVEL'1'       WQSG03           Debit/Credit In
     C           KRSSG     SETLL@ACRCK1                    *
     C           KRSSG     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SGEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSG     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSH01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSH02           Account Code
     C           *LIKE     DEFN WADRCR    WQSH03           Debit/Credit In
      * Define keylist
     C           KRSSH     KLIST
     C                     KFLD           WQSH01           Reporting Set N
     C                     KFLD           WQSH02           Account Code
     C                     KFLD           WQSH03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSH01           Reporting Set N
     C                     MOVELWUACCD    WQSH02           Account Code
     C                     MOVELWUDRCR    WQSH03           Debit/Credit In
     C           KRSSH     SETLL@ACRCK1                    *
     C           KRSSH     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SHEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSH     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SIRVGN    BEGSR
      *================================================================
      * Retrieve Title only - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSI     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVELWUACCD    A5ACCD           Account Code
     C           KRSSI     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SIEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
     C                     END
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSJ01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSJ02           Account Code
     C           *LIKE     DEFN WADRCR    WQSJ03           Debit/Credit In
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           WQSJ01           Reporting Set N
     C                     KFLD           WQSJ02           Account Code
     C                     KFLD           WQSJ03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSJ01           Reporting Set N
     C                     MOVELWUACCD    WQSJ02           Account Code
     C                     MOVEL'0'       WQSJ03           Debit/Credit In
     C           KRSSJ     SETLL@ACRCK1                    *
     C           KRSSJ     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SJEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSJ     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSK01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSK02           Account Code
     C           *LIKE     DEFN WADRCR    WQSK03           Debit/Credit In
      * Define keylist
     C           KRSSK     KLIST
     C                     KFLD           WQSK01           Reporting Set N
     C                     KFLD           WQSK02           Account Code
     C                     KFLD           WQSK03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSK01           Reporting Set N
     C                     MOVELWUACCD    WQSK02           Account Code
     C                     MOVEL'1'       WQSK03           Debit/Credit In
     C           KRSSK     SETLL@ACRCK1                    *
     C           KRSSK     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SKEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSK     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSL01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSL02           Account Code
     C           *LIKE     DEFN WADRCR    WQSL03           Debit/Credit In
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           WQSL01           Reporting Set N
     C                     KFLD           WQSL02           Account Code
     C                     KFLD           WQSL03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSL01           Reporting Set N
     C                     MOVELWUACCD    WQSL02           Account Code
     C                     MOVELWUDRCR    WQSL03           Debit/Credit In
     C           KRSSL     SETLL@ACRCK1                    *
     C           KRSSL     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SLEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSL     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSM01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSM02           Account Code
     C           *LIKE     DEFN WADRCR    WQSM03           Debit/Credit In
      * Define keylist
     C           KRSSM     KLIST
     C                     KFLD           WQSM01           Reporting Set N
     C                     KFLD           WQSM02           Account Code
     C                     KFLD           WQSM03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSM01           Reporting Set N
     C                     MOVELWUACCD    WQSM02           Account Code
     C                     MOVEL'0'       WQSM03           Debit/Credit In
     C           KRSSM     SETLL@ACRCK1                    *
     C           KRSSM     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SMEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSM     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSN01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSN02           Account Code
     C           *LIKE     DEFN WADRCR    WQSN03           Debit/Credit In
      * Define keylist
     C           KRSSN     KLIST
     C                     KFLD           WQSN01           Reporting Set N
     C                     KFLD           WQSN02           Account Code
     C                     KFLD           WQSN03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSN01           Reporting Set N
     C                     MOVELWUACCD    WQSN02           Account Code
     C                     MOVEL'1'       WQSN03           Debit/Credit In
     C           KRSSN     SETLL@ACRCK1                    *
     C           KRSSN     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SNEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSN     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SORVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSO01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSO02           Account Code
     C           *LIKE     DEFN WADRCR    WQSO03           Debit/Credit In
      * Define keylist
     C           KRSSO     KLIST
     C                     KFLD           WQSO01           Reporting Set N
     C                     KFLD           WQSO02           Account Code
     C                     KFLD           WQSO03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSO01           Reporting Set N
     C                     MOVELWUACCD    WQSO02           Account Code
     C                     MOVELWUDRCR    WQSO03           Debit/Credit In
     C           KRSSO     SETLL@ACRCK1                    *
     C           KRSSO     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SOEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSO     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPRVGN    BEGSR
      *================================================================
      * Retrieve Title only - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSP     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVELWUACCD    A5ACCD           Account Code
     C           KRSSP     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SPEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
     C                     END
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSQ01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSQ02           Account Code
     C           *LIKE     DEFN WADRCR    WQSQ03           Debit/Credit In
      * Define keylist
     C           KRSSQ     KLIST
     C                     KFLD           WQSQ01           Reporting Set N
     C                     KFLD           WQSQ02           Account Code
     C                     KFLD           WQSQ03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSQ01           Reporting Set N
     C                     MOVELWUACCD    WQSQ02           Account Code
     C                     MOVEL'0'       WQSQ03           Debit/Credit In
     C           KRSSQ     SETLL@ACRCK1                    *
     C           KRSSQ     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SQEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSQ     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSR01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSR02           Account Code
     C           *LIKE     DEFN WADRCR    WQSR03           Debit/Credit In
      * Define keylist
     C           KRSSR     KLIST
     C                     KFLD           WQSR01           Reporting Set N
     C                     KFLD           WQSR02           Account Code
     C                     KFLD           WQSR03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSR01           Reporting Set N
     C                     MOVELWUACCD    WQSR02           Account Code
     C                     MOVEL'1'       WQSR03           Debit/Credit In
     C           KRSSR     SETLL@ACRCK1                    *
     C           KRSSR     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SREXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSR     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT
     CSR         SSRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSS01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSS02           Account Code
     C           *LIKE     DEFN WADRCR    WQSS03           Debit/Credit In
      * Define keylist
     C           KRSSS     KLIST
     C                     KFLD           WQSS01           Reporting Set N
     C                     KFLD           WQSS02           Account Code
     C                     KFLD           WQSS03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSS01           Reporting Set N
     C                     MOVELWUACCD    WQSS02           Account Code
     C                     MOVELWUDRCR    WQSS03           Debit/Credit In
     C           KRSSS     SETLL@ACRCK1                    *
     C           KRSSS     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SSEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSS     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SSEXIT    ENDSR
      /EJECT
     CSR         STRVGN    BEGSR
      *================================================================
      * Retrieve Title only - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSST     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVELWUACCD    A5ACCD           Account Code
     C           KRSST     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO STEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
     C                     END
      *================================================================
     CSR         STEXIT    ENDSR
      /EJECT
     CSR         SURVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSU01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSU02           Account Code
     C           *LIKE     DEFN WADRCR    WQSU03           Debit/Credit In
      * Define keylist
     C           KRSSU     KLIST
     C                     KFLD           WQSU01           Reporting Set N
     C                     KFLD           WQSU02           Account Code
     C                     KFLD           WQSU03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSU01           Reporting Set N
     C                     MOVELWUACCD    WQSU02           Account Code
     C                     MOVEL'0'       WQSU03           Debit/Credit In
     C           KRSSU     SETLL@ACRCK1                    *
     C           KRSSU     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SUEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSU     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SUEXIT    ENDSR
      /EJECT
     CSR         SVRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSV01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSV02           Account Code
     C           *LIKE     DEFN WADRCR    WQSV03           Debit/Credit In
      * Define keylist
     C           KRSSV     KLIST
     C                     KFLD           WQSV01           Reporting Set N
     C                     KFLD           WQSV02           Account Code
     C                     KFLD           WQSV03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSV01           Reporting Set N
     C                     MOVELWUACCD    WQSV02           Account Code
     C                     MOVEL'1'       WQSV03           Debit/Credit In
     C           KRSSV     SETLL@ACRCK1                    *
     C           KRSSV     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SVEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSV     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SVEXIT    ENDSR
      /EJECT
     CSR         SWRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQSW01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQSW02           Account Code
     C           *LIKE     DEFN WADRCR    WQSW03           Debit/Credit In
      * Define keylist
     C           KRSSW     KLIST
     C                     KFLD           WQSW01           Reporting Set N
     C                     KFLD           WQSW02           Account Code
     C                     KFLD           WQSW03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQSW01           Reporting Set N
     C                     MOVELWUACCD    WQSW02           Account Code
     C                     MOVELWUDRCR    WQSW03           Debit/Credit In
     C           KRSSW     SETLL@ACRCK1                    *
     C           KRSSW     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SWEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSW     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         SWEXIT    ENDSR
      /EJECT
     CSR         SXRVGN    BEGSR
      *================================================================
      * Is account code blank? - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSX     KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C           KRSSX     CHAIN@AGREAR              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SXEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     END
      *================================================================
     CSR         SXEXIT    ENDSR
      /EJECT
     CSR         SYCRRC    BEGSR
      *================================================================
      * EDTFILE Create Object - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL#RDCIS    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
      * USER: Processing before Data update
      * Is account code blank? - Accounts by Report Codes  *
     C                     EXSR SZRVGN
      * Dummy record exists on file.
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * EDTFILE Dlt 1st Rcd only - Accounts by Report Codes  *
     C                     EXSR TADLRC
      * CASE: PAR.Debit/Credit Ind. is Blank
     C           #RDCIS    IFEQ *BLANK                     *IF
      * Determine which records need to be written - DR, CR or both.
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR TCRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Write CR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR TDCRRC
     C                     ELSE
      * CASE: *OTHERWISE
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR TFRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Write CR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR TGCRRC
     C                     END                             *FI
      * Write DR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR TICRRC
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Write either DR or CR record to file.
      * CASE: PAR.Debit/Credit Ind. is C - Credit
     C           #RDCIS    IFEQ 'C'                        *IF
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR TKCRRC
     C                     ELSE
      * CASE: PAR.Debit/Credit Ind. is D - Debit
     C           #RDCIS    IFEQ 'D'                        *IF
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR TMCRRC
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     GOTO SYEXIT                     *QUIT
     C                     END                             *FI
      * DB1 = PAR By name
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL#RDCIS    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      * No dummy record exists on file.
      * CASE: PAR.Debit/Credit Ind. is Blank
     C           #RDCIS    IFEQ *BLANK                     *IF
      * Determine which records need to be written - DR, CR or both.
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR TORVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Write CR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR TPCRRC
     C                     ELSE
      * CASE: *OTHERWISE
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR TRRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Write CR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR TSCRRC
     C                     END                             *FI
      * Write DR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR TUCRRC
     C                     END                             *FI
     C                     GOTO SYEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
      * DR/CR on screen: if 'D' write '0' to file, if 'C' write '1' to fi
      * CASE: PAR.Debit/Credit Ind. is C - Credit
     C           #RDCIS    IFEQ 'C'                        *IF
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     ELSE
      * CASE: PAR.Debit/Credit Ind. is D - Debit
     C           #RDCIS    IFEQ 'D'                        *IF
     C                     MOVEL'0'       G6DRCR           Debit/Credit In
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C           KLCRSY    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRSY    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SYEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TWCHRC
     C                     END
      *================================================================
     CSR         SYEXIT    ENDSR
      /EJECT
     CSR         SZRVGN    BEGSR
      *================================================================
      * Is account code blank? - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSZ     KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C           KRSSZ     CHAIN@AGREAR              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SZEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     END
      *================================================================
     CSR         SZEXIT    ENDSR
      /EJECT
     CSR         TADLRC    BEGSR
      *================================================================
      * EDTFILE Dlt 1st Rcd only - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
      *
     C           KLDLTA    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLTA    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TAEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TAEXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      * USER: Processing after Data update
      * WUDELR Data Structure - SD Deleted Records File  *
     C                     MOVEL@1DBRC    WUDELR
      * Concat the four part key into one field
     C           #1RSNO    CAT  #1RSCD    WUIK1A    P      Interim Key 05
     C           ' '       CAT  ' '       WUIK5B    P      Interim Key 05
     C           WUIK1A    CAT  WUIK5B    WULKEY    P      Long Key
      * Write Deleted Record - SD Deleted Records File  *
     C                     CLEARPARC
     C                     MOVEL'SDACRCPD'PAFNME           File name
     C                     MOVELWULKEY    PALKEY           Long Key
     C                     MOVELWUDR01    PADR01           Deleted Data Re
     C                     MOVELWUDR02    PADR02           Deleted Data Re
     C                     MOVELWUDR03    PADR03           Deleted Data Re
     C                     MOVELWUDR04    PADR04           Deleted Data Re
     C                     MOVELWUDR05    PADR05           Deleted Data Re
     C                     MOVELWUDR06    PADR06           Deleted Data Re
     C                     MOVELWUDR07    PADR07           Deleted Data Re
     C                     MOVELWUDR08    PADR08           Deleted Data Re
     C                     MOVELWUDR09    PADR09           Deleted Data Re
     C                     MOVELWUDR00    PADR00           Deleted Data Re
     C                     MOVELWUDR11    PADR11           Deleted Data Re
     C                     MOVELWUDR12    PADR12           Deleted Data Re
     C                     Z-ADDWURDNB    PALCD            Last Change Dat
     C                     MOVEL'D'       PATYLC           Type of Last Ch
      *
     C                     CALL 'SD0520X'              90  Write Deleted R
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             RCD: SD Deleted
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0520X' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TBCHRC
     C                     END
      *================================================================
     CSR         TAEXIT    ENDSR
      /EJECT
     CSR         TBCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YARDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTB    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTB    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TBEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TBEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YARDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YARDCS
     C                     MOVE 'Y'       YARDC
     C                     END
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TBEXIT    ENDSR
      /EJECT
     CSR         TCRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQTC01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQTC02           Account Code
     C           *LIKE     DEFN WADRCR    WQTC03           Debit/Credit In
      * Define keylist
     C           KRSTC     KLIST
     C                     KFLD           WQTC01           Reporting Set N
     C                     KFLD           WQTC02           Account Code
     C                     KFLD           WQTC03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQTC01           Reporting Set N
     C                     MOVEL#RSTAC    WQTC02           Account Code
     C                     MOVEL'0'       WQTC03           Debit/Credit In
     C           KRSTC     SETLL@ACRCK1                    *
     C           KRSTC     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TCEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSTC     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         TCEXIT    ENDSR
      /EJECT
     CSR         TDCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRTD    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTD    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TDEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TECHRC
     C                     END
      *================================================================
     CSR         TDEXIT    ENDSR
      /EJECT
     CSR         TECHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YBRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTE    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTE    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TEEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YBRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YBRDCS
     C                     MOVE 'Y'       YBRDC
     C                     END
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TEEXIT    ENDSR
      /EJECT
     CSR         TFRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQTF01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQTF02           Account Code
     C           *LIKE     DEFN WADRCR    WQTF03           Debit/Credit In
      * Define keylist
     C           KRSTF     KLIST
     C                     KFLD           WQTF01           Reporting Set N
     C                     KFLD           WQTF02           Account Code
     C                     KFLD           WQTF03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQTF01           Reporting Set N
     C                     MOVEL#RSTAC    WQTF02           Account Code
     C                     MOVEL'1'       WQTF03           Debit/Credit In
     C           KRSTF     SETLL@ACRCK1                    *
     C           KRSTF     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TFEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSTF     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         TFEXIT    ENDSR
      /EJECT
     CSR         TGCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRTG    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTG    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TGEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'I'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR THCHRC
     C                     END
      *================================================================
     CSR         TGEXIT    ENDSR
      /EJECT
     CSR         THCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YCRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTH    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTH    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO THEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO THEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YCRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YCRDCS
     C                     MOVE 'Y'       YCRDC
     C                     END
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         THEXIT    ENDSR
      /EJECT
     CSR         TICRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'0'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRTI    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTI    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TIEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TJCHRC
     C                     END
      *================================================================
     CSR         TIEXIT    ENDSR
      /EJECT
     CSR         TJCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YDRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTJ    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTJ    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TJEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TJEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YDRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YDRDCS
     C                     MOVE 'Y'       YDRDC
     C                     END
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TJEXIT    ENDSR
      /EJECT
     CSR         TKCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRTK    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTK    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TKEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TLCHRC
     C                     END
      *================================================================
     CSR         TKEXIT    ENDSR
      /EJECT
     CSR         TLCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YERDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTL    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTL    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TLEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TLEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YERDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YERDCS
     C                     MOVE 'Y'       YERDC
     C                     END
      * If changed update record otherwise release record
     C           YERDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TLEXIT    ENDSR
      /EJECT
     CSR         TMCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'0'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRTM    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTM    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TMEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'A'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TNCHRC
     C                     END
      *================================================================
     CSR         TMEXIT    ENDSR
      /EJECT
     CSR         TNCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YFRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTN    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTN    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TNEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TNEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YFRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YFRDCS
     C                     MOVE 'Y'       YFRDC
     C                     END
      * If changed update record otherwise release record
     C           YFRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TNEXIT    ENDSR
      /EJECT
     CSR         TORVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQTO01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQTO02           Account Code
     C           *LIKE     DEFN WADRCR    WQTO03           Debit/Credit In
      * Define keylist
     C           KRSTO     KLIST
     C                     KFLD           WQTO01           Reporting Set N
     C                     KFLD           WQTO02           Account Code
     C                     KFLD           WQTO03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQTO01           Reporting Set N
     C                     MOVEL#RSTAC    WQTO02           Account Code
     C                     MOVEL'0'       WQTO03           Debit/Credit In
     C           KRSTO     SETLL@ACRCK1                    *
     C           KRSTO     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TOEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSTO     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         TOEXIT    ENDSR
      /EJECT
     CSR         TPCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRTP    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTP    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TPEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'I'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TQCHRC
     C                     END
      *================================================================
     CSR         TPEXIT    ENDSR
      /EJECT
     CSR         TQCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YGRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTQ    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTQ    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TQEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TQEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YGRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YGRDCS
     C                     MOVE 'Y'       YGRDC
     C                     END
      * If changed update record otherwise release record
     C           YGRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TQEXIT    ENDSR
      /EJECT
     CSR         TRRVGN    BEGSR
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WARSNO    WQTR01           Reporting Set N
     C           *LIKE     DEFN WAACCD    WQTR02           Account Code
     C           *LIKE     DEFN WADRCR    WQTR03           Debit/Credit In
      * Define keylist
     C           KRSTR     KLIST
     C                     KFLD           WQTR01           Reporting Set N
     C                     KFLD           WQTR02           Account Code
     C                     KFLD           WQTR03           Debit/Credit In
      * Move fields to key list
     C                     MOVEL#1RSNO    WQTR01           Reporting Set N
     C                     MOVEL#RSTAC    WQTR02           Account Code
     C                     MOVEL'1'       WQTR03           Debit/Credit In
     C           KRSTR     SETLL@ACRCK1                    *
     C           KRSTR     READE@ACRCK1                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TREXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSTR     READE@ACRCK1                  90*
     C                     END
      *================================================================
     CSR         TREXIT    ENDSR
      /EJECT
     CSR         TSCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'1'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRTS    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTS    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TSEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'I'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TTCHRC
     C                     END
      *================================================================
     CSR         TSEXIT    ENDSR
      /EJECT
     CSR         TTCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YHRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTT    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTT    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TTEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TTEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YHRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YHRDCS
     C                     MOVE 'Y'       YHRDC
     C                     END
      * If changed update record otherwise release record
     C           YHRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TTEXIT    ENDSR
      /EJECT
     CSR         TUCRRC    BEGSR
      *================================================================
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL'0'       G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRTU    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTU    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TUEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Amend
     C           'I'       IFEQ 'A'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     ELSE
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
     C                     END                             *FI
     C                     END                             *FI
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TVCHRC
     C                     END
      *================================================================
     CSR         TUEXIT    ENDSR
      /EJECT
     CSR         TVCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YIRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTV    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTV    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TVEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TVEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YIRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YIRDCS
     C                     MOVE 'Y'       YIRDC
     C                     END
      * If changed update record otherwise release record
     C           YIRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TVEXIT    ENDSR
      /EJECT
     CSR         TWCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YJRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTW    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTW    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TWEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TWEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YJRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YJRDCS
     C                     MOVE 'Y'       YJRDC
     C                     END
      * If changed update record otherwise release record
     C           YJRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TWEXIT    ENDSR
      /EJECT
     CSR         TXCHRC    BEGSR
      *================================================================
      * EDTFILE CHG calls DLT/CRT - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data read
      * The record which the user has amended must be deleted and a new
      * record inserted.
      * CASE: PAR.Account Code is blank
     C           #RSTAC    IFEQ *BLANK                     *IF
      * User has 'deleted' record by blanking out Account Code.
      * EDTFILE Delete object - Accounts by Report Codes  *
     C                     EXSR TYDLRC
      * Record exists ? - Accounts by Report Codes  *
     C                     EXSR NARVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     Z-ADD*ZERO     WUNORC           No. of Records
     C                     Z-ADD1         WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NBCHRC
     C                     ELSE
      * CASE: *OTHERWISE
      * Ensure dummy record exists on file.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR NCCRRC
     C                     MOVEL'Y'       WUADRQ           Add Mode requir
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Record has been amended.
      * EDTFILE Delete object - Accounts by Report Codes  *
     C                     EXSR NEDLRC
      * CASE: PAR.Debit/Credit Ind. is Blank
     C           #RDCIS    IFEQ *BLANK                     *IF
      * DR/CR on screen is blank.
      * Determine which records need to be written - DR, CR or both.
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR NGRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Write CR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR NHCRRC
     C                     ELSE
      * CASE: *OTHERWISE
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR NJRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Write CR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR NKCRRC
     C                     END                             *FI
      * Write DR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR NMCRRC
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * DR/CR on screen: 'D' = '0' written to file, 'C' = '1' written to
      * CASE: PAR.Debit/Credit Ind. is D - Debit
     C           #RDCIS    IFEQ 'D'                        *IF
      * Write DR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR NOCRRC
     C                     ELSE
      * CASE: PAR.Debit/Credit Ind. is C - Credit
     C           #RDCIS    IFEQ 'C'                        *IF
      * Write CR record.
      * EDTFILE Chg Existing Rcd - Accounts by Report Codes  *
     C                     EXSR NQCRRC
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Quit this Change Object as update already handled.
     C                     GOTO TXEXIT                     *QUIT
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YTRDC   1
      *
      * Move key fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#RSTAC    G6ACCD           Account Code
     C                     MOVEL#RDCIS    G6DRCR           Debit/Credit In
      *
     C           KLCHTX    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLCHTX    CHAIN@AGREAQ              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TXEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TXEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKSDACRCL0               91  *
     C                     GOTO TXEXIT
     C                     END                             FI #1DBRC
      * Store record data for null update check
     C**********           MOVE @1DBRC    YTRDCS                                              CGL029
     C                     MOVEL@1DBRC    YTRDCS                                              CGL029
      * Move non-key fields to @AGREAQ
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YTRDCS
     C                     MOVE 'Y'       YTRDC
     C                     END
      * If changed update record otherwise release record
     C           YTRDC     IFEQ 'Y'
     C                     UPDAT@AGREAQ                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDACRCL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
     C                     END
      *================================================================
     CSR         TXEXIT    ENDSR
      /EJECT
     CSR         TYDLRC    BEGSR
      *================================================================
      * EDTFILE Delete object - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL#1ACCD    G6ACCD           Account Code
     C                     MOVEL#1DRCR    G6DRCR           Debit/Credit In
      *
     C           KLDLTY    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLTY    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TYEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TYEXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      * USER: Processing after Data update
      * WUDELR Data Structure - SD Deleted Records File  *
     C                     MOVEL@1DBRC    WUDELR
      * Concat the four part key into one field
     C           #1RSNO    CAT  #1RSCD    WUIK1A    P      Interim Key 05
     C           #1ACCD    CAT  #1DRCR    WUIK5B    P      Interim Key 05
     C           WUIK1A    CAT  WUIK5B    WULKEY    P      Long Key
      * Write Deleted Record - SD Deleted Records File  *
     C                     CLEARPARC
     C                     MOVEL'SDACRCPD'PAFNME           File name
     C                     MOVELWULKEY    PALKEY           Long Key
     C                     MOVELWUDR01    PADR01           Deleted Data Re
     C                     MOVELWUDR02    PADR02           Deleted Data Re
     C                     MOVELWUDR03    PADR03           Deleted Data Re
     C                     MOVELWUDR04    PADR04           Deleted Data Re
     C                     MOVELWUDR05    PADR05           Deleted Data Re
     C                     MOVELWUDR06    PADR06           Deleted Data Re
     C                     MOVELWUDR07    PADR07           Deleted Data Re
     C                     MOVELWUDR08    PADR08           Deleted Data Re
     C                     MOVELWUDR09    PADR09           Deleted Data Re
     C                     MOVELWUDR00    PADR00           Deleted Data Re
     C                     MOVELWUDR11    PADR11           Deleted Data Re
     C                     MOVELWUDR12    PADR12           Deleted Data Re
     C                     Z-ADDWURDNB    PALCD            Last Change Dat
     C                     MOVEL'D'       PATYLC           Type of Last Ch
      *
     C                     CALL 'SD0520X'              90  Write Deleted R
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             RCD: SD Deleted
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0520X' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TZCHRC
     C                     END
      *================================================================
     CSR         TYEXIT    ENDSR
      /EJECT
     CSR         TZCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YKRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTZ    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTZ    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TZEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TZEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YKRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YKRDCS
     C                     MOVE 'Y'       YKRDC
     C                     END
      * If changed update record otherwise release record
     C           YKRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TZEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Set up Debit/Credit indicator from file.
      *================================================================
      * CASE: DB1.Debit/Credit Ind. is Zero (Debit)
     C           G6DRCR    IFEQ '0'                        *IF
     C                     MOVEL'D'       #RDCIS           DR/CR Ind - scr
     C                     END                             *FI
      * CASE: DB1.Debit/Credit Ind. is One (Credit)
     C           G6DRCR    IFEQ '1'                        *IF
     C                     MOVEL'C'       #RDCIS           DR/CR Ind - scr
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Amend Mode processing.
      *================================================================
      * Debit/Credit Indicator validation.
     C                     EXSR UCSUBR                     Debit/Credit In
      * If no error validate Account code
      * CASE: *RCDERR
     C           *IN98     IFEQ '1'
     C                     ELSE
      * CASE: *OTHERWISE
      * Account code validation (and its relation to DR/CR Indicator).
      * CASE: RCD.Stored Account Code NE RCD.Account Code
     C           #RSTAC    IFNE #1ACCD                     *IF
      * User has amended Account Code (and optionally DR/CR Indicator).
     C                     EXSR UDSUBR                     User has amende
     C                     ELSE
      * CASE: *OTHERWISE
      * Account code on screen has not changed, check DR/CR Indicator.
     C                     EXSR UJSUBR                     Account code on
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Debit/Credit Indicator validation.
      *================================================================
      * Debit/Credit Ind blank: 2 rcds must exist on file (DR + CR).
      * 'D' for Debit entered in screen field becomes '0' on file field.
      * 'C' for Credit entered in screen field becomes '1' on file field.
      * CASE: RCD.DR/CR Ind - screen is Blank
     C           #RDCIS    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    WUDRCR           Debit/Credit In
     C                     MOVEL'Y'       WUCDRQ           CR + DR records
     C                     ELSE
      * CASE: RCD.DR/CR Ind - screen is D - Debit
     C           #RDCIS    IFEQ 'D'                        *IF
     C                     MOVEL'0'       WUDRCR           Debit/Credit In
     C                     MOVEL'N'       WUCDRQ           CR + DR records
     C                     ELSE
      * CASE: RCD.DR/CR Ind - screen is C - Credit
     C           #RDCIS    IFEQ 'C'                        *IF
     C                     MOVEL'1'       WUDRCR           Debit/Credit In
     C                     MOVEL'N'       WUCDRQ           CR + DR records
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RDCIS    ZA0001           DR/CR Ind - scr
      * Send message 'Debit/Credit Ind invalid'
     C                     MOVEL'USR1629' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * User has amended Account Code (and optionally DR/CR Indicator).
      *================================================================
      * CASE: CTL.*CMD key is CF09
     C           *IN09     IFEQ '1'                        *IF
      * F9 not valid if screen amended but ENTER not pressed.
      * Send message 'F9 not valid'
     C                     MOVEL'USR1636' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Stored Account Code is blank
     C           #RSTAC    IFEQ *BLANK                     *IF
      * User has 'deleted' record.
     C                     ELSE
      * CASE: *OTHERWISE
      * Record has been amended.
     C                     MOVEL#RSTAC    WUTQKF           Test ? in Key F
      * CASE: WRK.Test ? in key field is Question mark
     C           WUTQKF    IFEQ '?'                        *IF
      * Select processing.
     C                     EXSR UESUBR                     Select processi
     C                     ELSE
      * CASE: *OTHERWISE
      * Check Account Code value entered
     C                     EXSR UHSUBR                     Check Account C
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Select processing.
      *================================================================
     C                     MOVEL#RSTAC    WUACCD           Account Code
      * Select Account Codes - Account Codes  *
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C********** WUACCD    PARM WUACCD    WQ0002  4        Account Code                       CGL029
     C           WUACCD    PARM WUACCD    WQ0002 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVELWUACCD    #RSTAC           Stored Account
     C                     MOVEL'Y'       W0DCF            *Defer confirm
      * CASE: RCD.Stored Account Code is not question mark
     C           #RSTAC    IFNE '?'                        *IF
      * Retrieve Title only - Account Codes  *
     C                     EXSR SBRVGN
      * If Title only indicator is 'Y' Account is invalid, otherwise O.K.
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0002           Stored Account
      * Send message 'Title 'Y' , Accnt invalid'
     C                     MOVEL'USR4149' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Stored Account Code NE RCD.Account Code
     C           #RSTAC    IFNE #1ACCD                     *IF
      * Account code amended.
      * CASE: WRK.CR + DR records required is Yes
     C           WUCDRQ    IFEQ 'Y'                        *IF
      * DR/CR Indicator on screen is blank.
     C                     EXSR UFSUBR                     DR/CR Indicator
     C                     ELSE
      * CASE: *OTHERWISE
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SERVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0005           Stored Account
     C                     MOVEL#RDCIS    ZA0006           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Account code not amended, check if DR/CR Ind on screen amended.
      * CASE: WRK.Debit/Credit Ind. NE RCD.Debit/Credit Ind.
     C           WUDRCR    IFNE #1DRCR                     *IF
      * CASE: WRK.CR + DR records required is Yes
     C           WUCDRQ    IFEQ 'Y'                        *IF
      * DR/CR Indicator on screen is blank.
     C                     EXSR UGSUBR                     DR/CR Indicator
     C                     ELSE
      * CASE: *OTHERWISE
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SHRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0009           Stored Account
     C                     MOVEL#RDCIS    ZA0010           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * DR/CR Indicator on screen is blank.
      *================================================================
      * Check if DR record exists (0 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SCRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Check if CR record exists (1 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SDRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0003           Stored Account
     C                     MOVEL#RDCIS    ZA0004           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * DR/CR Indicator on screen is blank.
      *================================================================
      * Check if DR record exists (0 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SFRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Check if CR record exists (1 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SGRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0007           Stored Account
     C                     MOVEL#RDCIS    ZA0008           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Check Account Code value entered
      *================================================================
     C                     MOVEL#RSTAC    WUACCD           Account Code
      * Retrieve Title only - Account Codes  *
     C                     EXSR SIRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0011           Stored Account
      * Send message 'Invalid Account Code'
     C                     MOVEL'USR0183' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Title only is 'N' O.K, otherwise Account is invalid.
      * CASE: WRK.Title Only Indicator is NO
     C           WUTOIN    IFEQ 'N'                        *IF
      * CASE: WRK.CR + DR records required is Yes
     C           WUCDRQ    IFEQ 'Y'                        *IF
      * DR/CR Indicator on screen is blank.
     C                     EXSR UISUBR                     DR/CR Indicator
     C                     ELSE
      * CASE: *OTHERWISE
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SLRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0014           Stored Account
     C                     MOVEL#RDCIS    ZA0015           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0016           Stored Account
      * Send message 'Title 'Y' , Accnt invalid'
     C                     MOVEL'USR4149' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * DR/CR Indicator on screen is blank.
      *================================================================
      * Check if DR record exists (0 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SJRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Check if CR record exists (1 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SKRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0012           Stored Account
     C                     MOVEL#RDCIS    ZA0013           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Account code on screen has not changed, check DR/CR Indicator.
      *================================================================
      * CASE: WRK.Debit/Credit Ind. NE RCD.Debit/Credit Ind.
     C           WUDRCR    IFNE #1DRCR                     *IF
      * CASE: CTL.*CMD key is CF09
     C           *IN09     IFEQ '1'                        *IF
      * F9 not valid if screen amended but ENTER not pressed.
      * Send message 'F9 not valid'
     C                     MOVEL'USR1636' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#RSTAC    WUACCD           Account Code
      * Validate DR/CR Ind in relation to Account Code.
      * CASE: WRK.Debit/Credit Ind. NE RCD.Debit/Credit Ind.
     C           WUDRCR    IFNE #1DRCR                     *IF
      * CASE: WRK.CR + DR records required is Yes
     C           WUCDRQ    IFEQ 'Y'                        *IF
      * DR/CR Ind blank - Check whether DR and/or CR rcd exists on file.
     C                     EXSR UKSUBR                     DR/CR Ind blank
     C                     ELSE
      * CASE: *OTHERWISE
      * DR/CR Indicator entered.
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SORVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0018           Stored Account
     C                     MOVEL#RDCIS    ZA0019           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * DR/CR Ind blank - Check whether DR and/or CR rcd exists on file.
      *================================================================
      * Check if Debit exists (pass in 0 for DR/CR Ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SMRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Check if Credit also exists (pass in 1 for DR/CR Ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SNRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RDCIS    ZA0017           DR/CR Ind - scr
      * Send message 'DR/CR Ind blank - invalid'
     C                     MOVEL'USR1630' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Insert Mode processing.
      *================================================================
      * Validate screen fields.
      * Debit/Credit Indicator validation.
     C                     EXSR UMSUBR                     Debit/Credit In
      * If no error, validate Account code
      * CASE: *RCDERR
     C           *IN98     IFEQ '1'
     C                     ELSE
      * CASE: *OTHERWISE
      * Account Code validation (and its relation to DR/CR Indicator).
      * CASE: RCD.Stored Account Code NE RCD.Account Code
     C           #RSTAC    IFNE #1ACCD                     *IF
      * CASE: CTL.*CMD key is CF09
     C           *IN09     IFEQ '1'                        *IF
     C                     MOVEL'ADD'     W0PMD            *Program mode
      * F9 not valid if screen amended but ENTER not pressed.
      * Send message 'F9 not valid'
     C                     MOVEL'USR1636' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#RSTAC    WUTQKF           Test ? in Key F
      * If '?' is entered, call Select Account Codes, otherwise check
      * if Account Code exists on PF/SDACODPD
      * CASE: WRK.Test ? in key field is Question mark
     C           WUTQKF    IFEQ '?'                        *IF
      * Select processing
     C                     EXSR UNSUBR                     Select processi
     C                     ELSE
      * CASE: *OTHERWISE
      * Check Account code value entered
     C                     EXSR UQSUBR                     Check Account c
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * DR/CR Ind may not be entered without associated Account Code.
      * CASE: WRK.Debit/Credit Ind. EQ RCD.Debit/Credit Ind.
     C           WUDRCR    IFEQ #1DRCR                     *IF
      * F9 for *CHANGE Mode.
      * CASE: CTL.*CMD key is CF09
     C           *IN09     IFEQ '1'                        *IF
      * F9 for Change mode only valid if records exist on file for this
      * Set & Code (dummy record excluded).
      * Is account code blank? - Accounts by Report Codes  *
     C                     EXSR SXRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'ADD'     W0PMD            *Program mode
      * Send message 'F9 for change invalid'
     C                     MOVEL'USR1637' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: CTL.*CMD key is CF09
     C           *IN09     IFEQ '1'                        *IF
     C                     MOVEL'ADD'     W0PMD            *Program mode
      * Send message 'F9 for change invalid'
     C                     MOVEL'USR1637' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0032           Stored Account
      * Send message 'DR/CR Inval- A/c Cd blank'
     C                     MOVEL'USR1635' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Debit/Credit Indicator validation.
      *================================================================
      * Debit/Credit Ind blank: 2 rcds must be written to file (DR + CR).
      * 'D' for Debit entered in screen field becomes '0' on file field.
      * 'C' for Credit entered in screen field becomes '1' on file field.
      * CASE: RCD.DR/CR Ind - screen is Blank
     C           #RDCIS    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    WUDRCR           Debit/Credit In
     C                     MOVEL'Y'       WUCDRQ           CR + DR records
     C                     ELSE
      * CASE: RCD.DR/CR Ind - screen is D - Debit
     C           #RDCIS    IFEQ 'D'                        *IF
     C                     MOVEL'0'       WUDRCR           Debit/Credit In
     C                     MOVEL'N'       WUCDRQ           CR + DR records
     C                     ELSE
      * CASE: RCD.DR/CR Ind - screen is C - Credit
     C           #RDCIS    IFEQ 'C'                        *IF
     C                     MOVEL'1'       WUDRCR           Debit/Credit In
     C                     MOVEL'N'       WUCDRQ           CR + DR records
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RDCIS    ZA0020           DR/CR Ind - scr
      * Send message 'Debit/Credit Ind invalid'
     C                     MOVEL'USR1629' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Select processing
      *================================================================
     C                     MOVEL*BLANK    WUACCD           Account Code
     C                     MOVELWUTQKF    WUACCD           Account Code
      * Select Account Codes - Account Codes  *
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C********** WUACCD    PARM WUACCD    WQ0003  4        Account Code                       CGL029
     C           WUACCD    PARM WUACCD    WQ0003 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVELWUACCD    #RSTAC           Stored Account
     C                     MOVEL'Y'       W0DCF            *Defer confirm
      * CASE: RCD.Stored Account Code is not question mark
     C           #RSTAC    IFNE '?'                        *IF
      * Retrieve Title only - Account Codes  *
     C                     EXSR SPRVGN
      * Title only 'Y'= Account invalid; otherwise check if duplicate rcd
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0021           Stored Account
      * Send message 'Title 'Y' , Accnt invalid'
     C                     MOVEL'USR4149' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Check whether DR, CR records exist on SDACRCPD.
      * CASE: WRK.CR + DR records required is Yes
     C           WUCDRQ    IFEQ 'Y'                        *IF
      * DR/CR Indicator on screen is blank.
     C                     EXSR UOSUBR                     DR/CR Indicator
     C                     ELSE
      * CASE: *OTHERWISE
      * DR/CR Indicator on screen is entered.
     C                     EXSR UPSUBR                     DR/CR Indicator
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      * DR/CR Indicator on screen is blank.
      *================================================================
      * Check if DR record exists (0 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SQRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Check if CR record exists (1 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SRRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0022           Stored Account
     C                     MOVEL#RDCIS    ZA0023           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      * DR/CR Indicator on screen is entered.
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SSRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0024           Stored Account
     C                     MOVEL#RDCIS    ZA0025           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      * Check Account code value entered
      *================================================================
     C                     MOVEL#RSTAC    WUACCD           Account Code
      * Retrieve Title only - Account Codes  *
     C                     EXSR STRVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0026           Stored Account
      * Send message 'Invalid Account Code'
     C                     MOVEL'USR0183' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0027           Stored Account
      * Send message 'Title 'Y' , Accnt invalid'
     C                     MOVEL'USR4149' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Check whether DR, CR records exist on SDACRCPD.
      * CASE: WRK.CR + DR records required is Yes
     C           WUCDRQ    IFEQ 'Y'                        *IF
      * DR/CR Indicator on screen is blank.
     C                     EXSR URSUBR                     DR/CR Indicator
     C                     ELSE
      * CASE: *OTHERWISE
      * DR/CR Indicator on screen is entered.
     C                     EXSR USSUBR                     DR/CR Indicator
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UQEXIT    ENDSR
      /EJECT
     CSR         URSUBR    BEGSR
      *================================================================
      * DR/CR Indicator on screen is blank.
      *================================================================
      * Check if DR record exists (0 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SURVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Check if CR record exists (1 passed in for DR/CR ind).
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SVRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0028           Stored Account
     C                     MOVEL#RDCIS    ZA0029           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UREXIT    ENDSR
      /EJECT
     CSR         USSUBR    BEGSR
      *================================================================
      * DR/CR Indicator on screen is entered.
      *================================================================
      * Check A/c DR/CR for Set - Accounts by Report Codes  *
     C                     EXSR SWRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#RSTAC    ZA0030           Stored Account
     C                     MOVEL#RDCIS    ZA0031           DR/CR Ind - scr
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
      *
     C                     END                             *FI
      *================================================================
     CSR         USEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Account Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1ACCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Account Code
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C********** #1ACCD    PARM #1ACCD    WQ0001  4        Account Code                       CGL029
     C           #1ACCD    PARM #1ACCD    WQ0001 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     98    *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VAEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1ACCD    IFEQ *BLANK                     Account Code
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVAA5    KLIST
     C                     KFLD           A5ACCD           Account Code
      * Setup key
     C                     MOVEL#1ACCD    A5ACCD           Account Code
     C           KLVAA5    CHAIN@A5REA6              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Account Codes          NF'
     C                     MOVEL'USR0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0069' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVEL#2RSNO    WK1X01  1
     C                     MOVEL#2RSCD    WK1X02  1
     C           WK1X01    IFEQ '?'                        Reporting Set N
     C           WK1X02    OREQ '?'                        Reporting Struc
     C                     CALL 'SD1300S'              90  Select Reportin
     C                     PARM *BLANK    W0RTN   7
     C           #2RSNO    PARM #2RSNO    WQ0004  1        Reporting Set N
     C********** #2RSCD    PARM #2RSCD    WQ0005  4        Reporting Struc                    CGL029
     C           #2RSCD    PARM #2RSCD    WQ0005 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD1300S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     99    *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VB999
     C                     END
     C                     END
      *................................................................
      *
     C           KLVBG4    KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Setup key
     C                     MOVEL#2RSNO    G4RSNO           Reporting Set N
     C                     MOVEL#2RSCD    G4RSCD           Reporting Struc
     C           KLVBG4    CHAIN@AEREAM              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     MOVELG4RPNA    #2RPNA           Reporting Narra
     C                     GOTO VBEXIT
     C                     END
     C           VB999     TAG
      * Restrictor relation not satisfied
      * Send message 'Reporting Codes        NF'
     C                     MOVEL'USR1551' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'USR1551' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
      * USER: Exit program processing
      * Fast Exit Processing
      * CASE: CTL.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * ROLLBACK any uncommitted DBF changes
     C                     ROLBK                       90
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
      * Set century digit (If YY prior to 1940 treat as 20YY)
     C           ##JYY     IFLT 40
     C                     Z-ADD1         ##JCC
     C                     ELSE
     C                     Z-ADD0         ##JCC
     C                     END
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN Y2MGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Add Mode required
     C                     MOVEL*BLANK    WUADRQ  1
      * Define work field Debit/Credit Ind.
     C                     MOVEL*BLANK    WUDRCR  1
      * Define work field CR + DR records required
     C                     MOVEL*BLANK    WUCDRQ  1
      * Define work field Test ? in Key Field
     C                     MOVEL*BLANK    WUTQKF  1
      * Define work field Account Code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVEL*BLANK    WUACCD 10                                           CGL029
      * Define work field Title Only Indicator
     C                     MOVEL*BLANK    WUTOIN  1
      * Define work field Run day number
     C                     Z-ADD*ZERO     WURDNB  50
      * Define work field Interim Key 05
     C**********           MOVEL*BLANK    WUIK1A  5                                           CGL029
     C                     MOVEL*BLANK    WUIK1A 11                                           CGL029
      * Define work field Interim Key 05 B
     C**********           MOVEL*BLANK    WUIK5B  5                                           CGL029
     C                     MOVEL*BLANK    WUIK5B 11                                           CGL029
      * Define work field Long Key
     C                     MOVEL*BLANK    WULKEY 50
      * Define work field Deleted Data Record Pt1
     C                     MOVEL*BLANK    WUDR01250
      * Define work field Deleted Data Record Pt2
     C                     MOVEL*BLANK    WUDR02250
      * Define work field Deleted Data Record Pt3
     C                     MOVEL*BLANK    WUDR03250
      * Define work field Deleted Data Record Pt4
     C                     MOVEL*BLANK    WUDR04250
      * Define work field Deleted Data Record Pt5
     C                     MOVEL*BLANK    WUDR05250
      * Define work field Deleted Data Record Pt6
     C                     MOVEL*BLANK    WUDR06250
      * Define work field Deleted Data Record Pt7
     C                     MOVEL*BLANK    WUDR07250
      * Define work field Deleted Data Record Pt8
     C                     MOVEL*BLANK    WUDR08250
      * Define work field Deleted Data Record Pt9
     C                     MOVEL*BLANK    WUDR09250
      * Define work field Deleted Data Record Pt10
     C                     MOVEL*BLANK    WUDR00250
      * Define work field Deleted Data Record Pt11
     C                     MOVEL*BLANK    WUDR11250
      * Define work field Deleted Data Record Pt12
     C                     MOVEL*BLANK    WUDR12250
      * Define work field No. of Records
     C                     Z-ADD*ZERO     WUNORC  50
      * Define work field No. of Deletes
     C                     Z-ADD*ZERO     WUNODL  50
      * Define work field No. of Amends
     C                     Z-ADD*ZERO     WUNOAM  50
      * Define work field No. of Inserts
     C                     Z-ADD*ZERO     WUNOIN  50
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Set Up Complete
     C                     MOVEL*BLANK    WUSUC   1
      * Define work field Date format flag
     C                     MOVEL*BLANK    WUDFF   1
      * Define work field Multi-branching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Open files
      * Begin commit control
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW02  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW03  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW04  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW05  50       *Synon (5,0) wo
     C                     MOVEL*BLANKS   YRSW06  1        *String work fi
     C                     MOVEL*BLANKS   YRSW07  1        *String work fi
     C                     MOVEL*BLANKS   YRSW08  7        *Return code
     C                     MOVEL*BLANKS   YRSW09  1        *String work fi
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0A           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0B           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0C           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0D           *Synon (9999) w
     C                     MOVEL*BLANKS   YRSW0E  1        *String work fi
     C                     MOVEL*BLANKS   YRSW0F  1        *String work fi
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     OPEN SD0580M#
     C                     OPEN SDACRCL1
     C                     OPEN SDACODL1
     C                     OPEN SDACRCL6
     C                     OPEN SDREPCL1
     C                     OPEN SDACRCL0
     C                     OPEN SDFCTLL0
     C                     MOVEL'N'       W0PMT   1
      *
     C                     Z-ADD14        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD500       W0SLM   50
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * SD0580M Precompiler - Accounts by Report Codes  *
      * Copyright Statement 1988 - Standard Functions  *
      * Get Rundate - Rundate  *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT  7        RUN DATE
     C                     MOVE MRDT      WUMRDT
     C                     MOVE RDNB      WURDNB           RUNDAY NO.
     C                     MOVE SUC       WUSUC            SET UP COMPLT
     C                     MOVE DFF       WUDFF            DTE FMT FLAG
     C                     MOVE MBIN      WUMBIN           MULTI BR. IND
     C                     MOVEL'N'       WUCDRQ           CR + DR records
     C                     MOVEL'N'       WUADRQ           Add Mode requir
      * Is account code blank? - Accounts by Report Codes  *
     C                     EXSR NSRVGN
      * If record on file for this Set & Rep Code combination is dummy rc
      * (blank A/c Code & DR/CR Ind), go to *ADD Mode.
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'ADD'     W0PMD            *Program mode
     C                     ELSE
      * CASE: *OTHERWISE
      * Otherwise go to *CHANGE Mode.
     C                     MOVEL'CHG'     W0PMD            *Program mode
     C                     END                             *FI
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT
     CSR         *PSSR     BEGSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
      *
      * Core function specific processing.
      *
     C/COPY WNCPYSRC,SD0580MPSC
      *
      * Start of PSSR user point.
      *
     C/COPY WNCPYSRC,SD0580MPS1
      *
      * Standard Midas PSSR processing.
      *
     C/COPY SDCPYSRC,SDPSSRINT
      *
      * End of PSSR user point.
      *
     C/COPY WNCPYSRC,SD0580MPS2
      *
      *================================================================
     CSR                   ENDSR
      *================================================================
** CPY@     : Copyright notice for inclusion in all programs
(c) Misys International Banking Systems Ltd. 2001
