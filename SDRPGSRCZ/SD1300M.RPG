     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SD Edit reporting codes')
      *****************************************************************
      *                                                               *
      *  Midas - Standing Data Module                                 *
      *                                                               *
      *  SD1300M - Reporting Codes Maintenance Subfile.               *
      *                                                               *
      *  Function:  This program allows the user to maintain the      *
      *             reporting codes defined to the system.            *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. MD036060           Date 05Oct15               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 BUG7265            Date 29Jul05               *
      *                 BUG2589            Date 15May04               *
      *                 CAAA03             Date 19Mar04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 122444             Date 30May01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 181052             Date 26Apr01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 163906             Date 30Mar01               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD003             Date 02JAN98               *
      *                 S01459             Date 02JAN97               *
      *                 S01117             Date 06FEB91               *
      *                                                               *
      *-------------------------------------------------------------- *
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  MD036060 - Unable to see new BSPL Code.                      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG7265 - Cannot exit BSPL Codes Maintenance                 *
      *  BUG2589- 10 digit a/c code fix + remove 181052               *
      *  CAAA03 - Webfacing Changes (Recompile).                      *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  122444 - System cannot allow user to exit BS/PL codes mnt.   *
      *           Ensure that for BSPL set as balance sheet, there    *
      *           should be only 2 level 1 BSPL codes.                *
      *  181052 - BSPL codes do not appear in BSPL Account Codes      *
      *           Maintenence.   Applied fix 167639.                  *
     F*  163906 - SDC0602 FCOOB in SD1300. This fix will check if the *
     F*           return code W0RTN is equal to blanks or not. The    *
     F*           update processing will continue if W0RTN is blank.  *
      *  CSD003 - Synon Closedown Project (SD):                       *
      *           - Program removed from SD model.                    *
      *  S01459 - Addition of Midas Headerbox.                        *
      *  S01117 - Add RCF processing (LN1121).                        *
      *                                                               *
      *****************************************************************
     FSD1300M#CF  E                    WORKSTN                        UC
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
     F                                              KINFSR *PSSR
      * DSP: Midas SD Reporting codes maintenance subfile
      *
     FSDREPCL1IF  E           K        DISK                           UC
     F                                              KINFDS INFDS1
     F                                              KINFSR *PSSR
      * RTV : Midas SD Reporting codes retrieval
      *
     FSDRPSTL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0001
     F                                              KINFSR *PSSR
      * RTV : Midas SD Reporting sets retrieval
      *
     FSDREPCL2IF  E           K        DISK                           UC
     F                                              KINFDS ID0002
     F                                              KINFSR *PSSR
      * RSQ : Midas SD Reporting codes descending retrieval
      *
     FSDACRCL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0003
     F                                              KINFSR *PSSR
      * RTV : Midas SD Accounts by report codes retrieval
      *
     FSDACRCL2IF  E           K        DISK                           UC
     F                                              KINFDS ID0004
     F                                              KINFSR *PSSR
      * RSQ : Midas SD A/c by report codes
      *
     FSDACRCL3IF  E           K        DISK                           UC
     F                                              KINFDS ID0005
     F                                              KINFSR *PSSR
      * RSQ : Midas SD Accounts by report codes
      *
     FSDREPCL0UF  E           K        DISK                      A    UC
     F                                              KCOMIT
     F                                              KINFDS ID0006
     F                                              KINFSR *PSSR
      * UPD : Midas SD Reporting codes update
      *
     FSDFCTLL0UF  E           K        DISK                           UC
     F                                              KCOMIT
     F                                              KINFDS ID0007
     F                                              KINFSR *PSSR
      * UPD : Midas SD Standing data controls update
      *
     FSDACRCL0UF  E           K        DISK                      A    UC
     F                                              KCOMIT
     F                                              KINFDS ID0008
     F                                              KINFSR *PSSR
      * UPD : Midas SD Accounts by report codes update
      *
     F/COPY WNCPYSRC,SD1300MF01
     E* Description     : Copyright notice for inclusion in all programs
     E*
     E********************************************************************
     E                    CPY@    1   1 80               Copyright array
     E                    @CN     1  23 25               Long constants.  122444
      * Renamed input format fields.                                      122444
     I@REPCAU
      * Midas SD Reporting codes descending retrieval
      * Renamed input format fields
     I              G4RSNO                          WARSNO
     I              G4RSCD                          WARSCD
     I              G4LVNB                          WALVNB
     I              G4RPNA                          WARPNA
     I              G4TYLC                          WATYLC
     I              G4LCD                           WALCD
      *
     I@ACRCAT
      * Midas SD A/c by report codes
      * Renamed input format fields
     I              G6RSNO                          WBRSNO
     I              G6RSCD                          WBRSCD
     I              G6RPNA                          WBRPNA
     I              G6ACCD                          WBACCD
     I              G6DRCR                          WBDRCR
     I              G6LCD                           WBLCD
     I              G6TYLC                          WBTYLC
      *
     I@ACRCBV
      * Midas SD Accounts by report codes
      * Renamed input format fields
     I              G6RSNO                          WCRSNO
     I              G6RSCD                          WCRSCD
     I              G6RPNA                          WCRPNA
     I              G6ACCD                          WCACCD
     I              G6DRCR                          WCDRCR
     I              G6LCD                           WCLCD
     I              G6TYLC                          WCTYLC
      *
     I*
     I* Description     : Copyright notice for inclusion in all programs
     I*
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSSDREPCL0
      * UPD : Midas SD Reporting codes update
      * Current/previous master file format fields for change control
      *
     IQSDFC1    E DSSDFCTLL0
      * UPD : Midas SD Standing data controls update
     IYARDCS      DS                             22
     IYBRDCS      DS                             22
     IYCRDCS      DS                             22
     IYDRDCS      DS                             22
     IYERDCS      DS                             22
     IYFRDCS      DS                             22
     IYGRDCS      DS                             22
     IYHRDCS      DS                             22
     IYIRDCS      DS                             22
     IYJRDCS      DS                             22
     IYKRDCS      DS                             22
     IYLRDCS      DS                             22
     IYMRDCS      DS                             22
     IYNRDCS      DS                             22
     IYORDCS      DS                             22
     IYPRDCS      DS                             22
     IYQRDCS      DS                             22
     IYRRDCS      DS                             22
     IYSRDCS      DS                             22
     IYTRDCS      DS                             22
     IYURDCS      DS                             22
     IWUDELR      DS
     I                                        1 250 WUDR01
     I                                      251 500 WUDR02
     I                                      501 750 WUDR03
     I                                      7511000 WUDR04
     I                                     10011250 WUDR05
     I                                     12511500 WUDR06
     I                                     15011750 WUDR07
     I                                     17512000 WUDR08
     I                                     20012250 WUDR09
     I                                     22512500 WUDR00
     I                                     25012750 WUDR11
     I                                     27513000 WUDR12
      * Outward parameters
     IPARC        DS                           3064
      * RCD : Midas SD Deleted records file retrieval
      * I :  File name
     I                                        1  10 PAFNME
      * I :  Long Key
     I                                       11  60 PALKEY
      * I :  Deleted Data Record Pt1
     I                                       61 310 PADR01
      * I :  Deleted Data Record Pt2
     I                                      311 560 PADR02
      * I :  Deleted Data Record Pt3
     I                                      561 810 PADR03
      * I :  Deleted Data Record Pt4
     I                                      8111060 PADR04
      * I :  Deleted Data Record Pt5
     I                                     10611310 PADR05
      * I :  Deleted Data Record Pt6
     I                                     13111560 PADR06
      * I :  Deleted Data Record Pt7
     I                                     15611810 PADR07
      * I :  Deleted Data Record Pt8
     I                                     18112060 PADR08
      * I :  Deleted Data Record Pt9
     I                                     20612310 PADR09
      * I :  Deleted Data Record Pt10
     I                                     23112560 PADR00
      * I :  Deleted Data Record Pt11
     I                                     25612810 PADR11
      * I :  Deleted Data Record Pt12
     I                                     28113060 PADR12
      * I :  Last Change Date
     I                                    P306130630PALCD
      * I :  Type of Last Change
     I                                     30643064 PATYLC
      *
     IYVRDCS      DS                             22
     IYWRDCS      DS                             40
     IYXRDCS      DS                             22
     IA@CPY       DS
     I* Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNB
     I                                       11  11 SUC
     I                                       12  12 DFF
     I                                       13  13 MBIN
     IYRSW0A      DS                           9999
     IYRSW0B      DS                           9999
     IYRSW0C      DS                           9999
     IYRSW0D      DS                           9999
     IID0001      DS                            528
      * File information data structure
      *
     IID0002      DS                            528
      * File information data structure
      *
     IID0003      DS                            528
      * File information data structure
      *
     IID0004      DS                            528
      * File information data structure
      *
     IID0005      DS                            528
      * File information data structure
      *
     IID0006      DS                            528
      * File information data structure
      *
     IID0007      DS                            528
      * File information data structure
      *
     IID0008      DS                            528
      * File information data structure
      *
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Set Number not found'
      * Reporting Set Number
     I                                        1   1 ZA0001
      * Message data for 'Set Number invalid value'
      * Reporting Set Number
     I                                        1   1 ZA0002
      * Message data for 'Level Number invalid'
      * Level Number
     I                                        1   1 ZA0003
      * Message data for 'Reporting cd rec invalid'
      * Reporting Set Number
     I                                        1   1 ZA0004
      * Reporting Structure Code
     I**********                              2   5 ZA0005                                   BUG2589
     I                                        2  11 ZA0005                                   BUG2589
      * Message data for 'Reporting Codes exists'
      * Reporting Set Number
     I                                        1   1 ZA0006
      * Reporting Structure Code
     I**********                              2   5 ZA0007                                   BUG2589
     I                                        2  11 ZA0007                                   BUG2589
      * Message data for 'Report Cd cannot delete'
      * Reporting Structure Code
     I**********                              1   4 ZA0008                                   BUG2589
     I                                        1  10 ZA0008                                   BUG2589
      * Message data for 'Two Rep Codes for Set No?'
      * Reporting Set Number
     I                                        1   1 ZA0009
      * Message data for 'Two Rep Codes for Set No?'
      * Reporting Set Number
     I                                        1   1 ZA0010
      * Message data for 'Only Two Rep Codes for Set No. 1'               122444
      * Previous Set Number                                               122444
     I                                        1   1 ZA0011                122444
      * Message data for 'Only Two Rep Codes for Set No. 1'               122444
      * Previous Set Number                                               122444
     I                                        1   1 ZA0012                122444
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialize subfile header
      * Prevent deletions once Set Up is complete
     C                     MOVEL'N'       WUDELA           Deletion Allowe
      * CASE: WRK.Set Up Complete is No
     C/COPY WNCPYSRC,SD1300MC15
     C           WUSUC     IFEQ 'N'                        *IF
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
     C                     MOVEL'Y'       WUDELA           Deletion Allowe
     C                     END                             *FI
     C                     END                             *FI
     C/COPY WNCPYSRC,SD1300MC16
      * Set up Edit File Footer - Standard Functions  *
     C*****************************************************************
     C*
     C*  Sets up the function key footer text for edit files in which
     C*  records may not be deleted after the system set up flag has
     C*  been set on
     C*
     C*****************************************************************
     C*
     C*  DETAIL LINE COMMAND KEY TEXT
     C*
     C                     MOVEL'SDUSRMSG'WUMSGF 10
     C                     MOVE *BLANKS   WUMTXT 80
     C*
     C*  If program mode is ADD:
     C*
     C           W0PMD     IFEQ 'ADD'
     C* Setup footer text:
     C* F3=Main Menu   F5=Refresh   F9=Go to 'Change' Mode
     C                     MOVEL'USR3349' WUMSID  7        Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     ELSE
     C*
     C*  If set up is not complete:
     C*
     C/COPY WNCPYSRC,SD1300MC17
     C           WUSUC     IFEQ 'N'
     C* Setup footer text:
     C* D=Delete   F3=Main Menu   F5=Refresh   F9=Go to 'Add' Mode
     C                     MOVEL'USR3348' WUMSID           Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     ELSE
     C* Setup footer text:
     C* F3=Main Menu   F5=Refresh   F9=Go to 'Add' Mode
     C                     MOVEL'USR3354' WUMSID           Message Identifier
     C                     CALL 'SDRTVTXT'             90  Retrieve MSGF message
     C           WUMSID    PARM WUMSID    KE0286  7        Message Identifier
     C           WUMSGF    PARM WUMSGF    KE0287 10        Message File Name
     C           WUMTXT    PARM WUMTXT    KE0288 80        Message Text
     C                     MOVELWUMTXT    ##CTX1
     C*
     C           *IN90     IFEQ '1'
     C* Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SDRTVTXT'W0CLPG
     C* Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
     C                     END
     C/COPY WNCPYSRC,SD1300MC18
     C                     END
      * Inform user that A/c Codes (not dummy records) transferred to new
      * CASE: WRK.Send transfer message is Yes
     C           WUSTMG    IFEQ 'Y'                        *IF
     C                     MOVEL'N'       WUSTMG           Send transfer m
      * Send message 'A/c transfer to new BS/PL'
     C                     MOVEL'USR4140' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
      *................................................................
      * If CHANGE mode, then position file:
     C           W0PMD     IFNE 'ADD'
     C           *LIKE     DEFN #2RSNO    WZRSNO
     C                     MOVEL#2RSNO    WZRSNO           Reporting Set N
     C           *LIKE     DEFN #2RSCD    WZRSCD
     C                     MOVEL#2RSCD    WZRSCD           Reporting Struc
     C           KPOS      KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Setup key
     C                     MOVEL#2RSNO    G4RSNO           Reporting Set N
     C                     MOVEL#2RSCD    G4RSCD           Reporting Struc
      * 82=EOF
     C           KPOS      SETLL@AEREAM              82    *
      * 82=EOF
     C  N82                READ @AEREAM                9182*
     C                     ELSE
     C                     SETOF                     82    *
     C                     END
      * Load subfile page
     C                     EXSR BBLDSF
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page (write empty page if add mode)
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27      W0PMD     IFNE 'ADD'
     C  N82                READP@AEREAM                  90*
     C  N82                READ @AEREAM                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  5
     C                     MOVE *ALL'1'   WKIND1  5
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      * Set required pages based on *Set Cursor or *Subfile Pages
     C           W0RR0     IFGT 0
     C           W0RR0     DIV  ##SFPG    ##SPG   30
     C                     MVR            ##SLIN  30
     C           ##SLIN    IFGT 0
     C                     ADD  1         ##SPG
     C                     END
     C           W0SPG     IFGT ##SPG
     C                     Z-ADDW0SPG     ##SPG
     C                     END
     C                     ELSE
     C                     Z-ADDW0SPG     ##SPG
     C                     END
      * Compute lines required based on pages
     C           ##SPG     MULT ##SFPG    ##SFLN  90
     C           ##SFLN    IFGT 999
     C                     Z-ADD999       ##SFLN
     C                     END
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFLN                     DO
     C                     ADD  1         ##RR
     C                     MOVEAWKIND0    *IN,33
     C/COPY WNCPYSRC,SD1300MC01
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * If CHANGE mode, load subfile fields
     C           W0PMD     IFNE 'ADD'
     C                     EXSR MBFL#1
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialize subfile record (existing record)
      * CASE: DB1.Reporting Set Number is last set number
     C           G4RSNO    IFEQ '9'                        *IF
      * CASE: DB1.Reporting Structure Code is last structure Code
     C********** G4RSCD    IFEQ '9999'                     *IF                               BUG2589
     C           G4RSCD    IFEQ *ALL'9'                    *IF                               BUG2589
     C                     MOVEL'N'       W0RSL            *Record selecte
     C                     END                             *FI
     C                     END                             *FI
      * If record dropped...
     C                     SUB  1         ##RR
     C           W0RSL     CABNE'Y'       BB020
     C                     ADD  1         ##RR
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
     C                     END
      * Output to subfile
     C                     ADD  1         ##RROK     81    *
      * If SFLRCD invalid, note that errors present
     C   98N99             SETON                     99    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C           W0PMD     IFNE 'ADD'
      * 82=EOF
     C                     READ @AEREAM                  82*
     C                     END
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
      * Calculate top line
     C           ##RROK    DIV  ##SFPG    ##SPG
     C                     MVR            ##SLIN
     C           ##SLIN    IFGT 0
     C           ##RR      SUB  ##SLIN    ##SFRC
     C                     ELSE
     C           ##RR      SUB  ##SFPG    ##SFRC
     C                     END
     C                     ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * Test cursor
     C                     EXSR Y8TST
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
     C           W0PMD     IFNE 'ADD'
      * Change of position specified
     C           WZRSNO    CASNE#2RSNO    FBRQRL           Reporting Set N
     C           WZRSCD    CASNE#2RSCD    FBRQRL           Reporting Struc
     C                     END
     C                     END
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      * Switch between *ADD/*CHANGE modes
     C   09                EXSR FACHMD
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,33
     C/COPY WNCPYSRC,SD1300MC02
      * No errors
     C                     SETOF                     98
      * No SFLNXTCHG
     C                     SETOF                     84
     C           W0PMD     IFEQ 'ADD'
      * Check for null record
     C                     EXSR DDNLRC
     C           W0NLR     IFEQ 'Y'
     C                     GOTO DCEXIT
     C                     END
      * If not null record, continue
     C                     END
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * If delete request, bypass validation
     C           #1SEL     IFEQ 'D'
     C                     GOTO DCEXIT
     C                     END
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
     C           #1RSNO    CABNE*BLANK    DDEXIT           Reporting Set N
     C           #1RSCD    CABNE*BLANK    DDEXIT           Reporting Struc
     C           #1LVNB    CABNE*BLANK    DDEXIT           Level Number
     C           #1RPNA    CABNE*BLANK    DDEXIT           Reporting Narra
     C/COPY WNCPYSRC,SD1300MC03
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * Validate Level Number
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1LVNB    W0NSRQ  1        Level Number
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1157050   Y2LSNO  70
     C           #1LVNB    PARM #1LVNB    W0EXVL 20        Level Number
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * USER: Validate subfile record fields
      * Validate Set Number
      * CASE: RCD.Reporting Set Number is valid value
     C           #1RSNO    IFGE '1'                        *IF
     C           #1RSNO    ANDLE'9'
      * Retrieve Reporting Sets - Reporting Sets  *
     C                     EXSR SARVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Setup message data for message
     C                     MOVEL#1RSNO    ZA0001           Reporting Set N
      * Send message 'Set Number not found'
     C                     MOVEL'USR4136' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: RCD.Reporting Set Number is question mark
     C           #1RSNO    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1RSNO    ZA0002           Reporting Set N
      * Send message 'Set Number invalid value'
     C                     MOVEL'USR4137' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Validate Level Number
      * CASE: RCD.Level Number is valid value
     C           #1LVNB    IFEQ '1'                        *IF
     C           #1LVNB    OREQ '2'
     C           #1LVNB    OREQ '3'
     C           #1LVNB    OREQ '4'
     C           #1LVNB    OREQ '5'
     C           #1LVNB    OREQ '6'
     C           #1LVNB    OREQ '7'
     C           #1LVNB    OREQ '8'
     C           #1LVNB    OREQ '9'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1LVNB    ZA0003           Level Number
      * Send message 'Level Number invalid'
     C                     MOVEL'USR4138' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
      * Check if record already exists on SDREPCPD
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      * Prevent user entering record with Set No=9, Reporting Code=9999
      * CASE: RCD.Reporting Set Number is last set number
     C           #1RSNO    IFEQ '9'                        *IF
      * CASE: RCD.Reporting Structure Code is last structure Code
     C********** #1RSCD    IFEQ '9999'                     *IF                               BUG2589
     C           #1RSCD    IFEQ *ALL'9'                    *IF                               BUG2589
      * Setup message data for message
     C                     MOVEL#1RSNO    ZA0004           Reporting Set N
     C                     MOVEL#1RSCD    ZA0005           Reporting Struc
      * Send message 'Reporting cd rec invalid'
     C                     MOVEL'USR4148' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983435*
      *
     C                     GOTO DEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Check for existance of record on Reporting Codes file
      * Retrieve Reporting Codes - Reporting Codes  *
     C                     EXSR SBRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Setup message data for message
     C                     MOVEL#1RSNO    ZA0006           Reporting Set N
     C                     MOVEL#1RSCD    ZA0007           Reporting Struc
      * Send message 'Reporting Codes exists'
     C                     MOVEL'USR4133' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983435*
      *
     C                     END                             *FI
     C                     END                             *FI
      * Validate subfile record relations
     C                     EXSR DFV2RC
      * Reporting Set Number required
     C           #1RSNO    IFEQ *BLANK                     IF
     C                     SETON                     9834  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Reporting Structure Code required
     C           #1RSCD    IFEQ *BLANK                     IF
     C                     SETON                     9835  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Reporting Narrative required
     C           #1RPNA    IFEQ *BLANK                     IF
     C                     SETON                     9837  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *                                                                   122444
      ** Make sure that only two level 1 codes exist for BSPL set as      122444
      ** balance sheet.                                                   122444
      *                                                                   122444
     C                     EXSR SRLV1C                                    122444
      *                                                                   122444
     C/COPY WNCPYSRC,SD1300MC04
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Check reference to Reporting Sets
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9834  *
     C                     END
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0RSF
     C                     ELSE
     C                     MOVEL'N'       W0RSF
     C                     END
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C           W0RTN     IFNE *BLANK
      * Error: ROLLBACK any DBF changes
     C                     ROLBK
     C                     ELSE
      * Otherwise COMMIT any DBF changes
     C                     COMIT
     C                     END
     C                     MOVEL*BLANK    #1SEL
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,33
     C/COPY WNCPYSRC,SD1300MC05
     C                     SETOF                     98
      *
     C           W0PMD     IFEQ 'ADD'
      * Process add request
     C           #1SEL     IFNE 'D'
     C                     EXSR DDNLRC
     C           W0NLR     IFNE 'Y'
     C                     EXSR ECADRQ
     C                     END
     C                     END
     C                     ELSE
     C           #1SEL     IFEQ 'D'
      * Process delete request
     C                     EXSR EDDLRQ
     C                     ELSE
      * Process change request
     C                     EXSR EECHRQ
     C                     END
     C                     END
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * Crt Rpting Cdes - EDTFIL - Reporting Codes  *
     C                     EXSR SCCRRC
     C           W0RTN     IFNE *BLANK
      * Write error detected
      * Screen errors
     C                     MOVEAWKIND1    *IN,33
     C/COPY WNCPYSRC,SD1300MC06
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
     C                     ELSE
      * DBF write successful
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request
      *================================================================
      * USER: Delete DBF record
      * Del Rpting Cdes - EDTFIL - Reporting Codes  *
     C                     EXSR TEDLRC
     C           W0RTN     IFNE *BLANK
      * Delete unsuccessful
      * Screen errors
     C                     MOVEAWKIND1    *IN,33
     C/COPY WNCPYSRC,SD1300MC07
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * If record altered, reset subfile record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF delete successful
      * Blank out record and protect from entry
     C                     EXSR MAIZ#1
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
      * Reload subfile
     C                     MOVEL'Y'       W0RSF   1
     C                     END
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Chg Rpting Cdes - EDTFIL - Reporting Codes  *
     C                     EXSR NJCHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,33
     C/COPY WNCPYSRC,SD1300MC08
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'ADD'     W0PMD
     C                     ELSE
     C                     MOVEL'CHG'     W0PMD
     C                     END
     C                     EXSR FBRQRL
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN79
     C           WUDELA    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL*IN87     *IN78
     C           W0PMD     IFEQ 'CHG'                      *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     MOVEL*BLANK    #1TYLC           Type of Last Ch
     C                     Z-ADD*ZERO     #1LCD            Last Change Dat
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #1RSNO           Reporting Set N
     C                     MOVEL*BLANK    #1RSCD           Reporting Struc
     C                     MOVEL*BLANK    #1LVNB           Level Number
     C                     MOVEL*BLANK    #1RPNA           Reporting Narra
     C/COPY WNCPYSRC,SD1300MC09
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @AEREAM fields to subfile
      *================================================================
     C                     MOVELG4TYLC    #1TYLC           Type of Last Ch
     C                     Z-ADDG4LCD     #1LCD            Last Change Dat
     C                     MOVELG4RSNO    #1RSNO           Reporting Set N
     C                     MOVELG4RSCD    #1RSCD           Reporting Struc
     C                     MOVELG4LVNB    #1LVNB           Level Number
     C                     MOVELG4RPNA    #1RPNA           Reporting Narra
     C/COPY WNCPYSRC,SD1300MC10
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVEL*BLANK    #2RSNO           Reporting Set N
     C                     MOVEL*BLANK    #2RSCD           Reporting Struc
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         NACHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YRRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNA    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNA    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NAEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NAEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YRRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YRRDCS
     C                     MOVE 'Y'       YRRDC
     C                     END
      * If changed update record otherwise release record
     C           YRRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NAEXIT    ENDSR
      /EJECT
     CSR         NBRVGN    BEGSR
      *================================================================
      * Transfer A/cs - Dlt Mode - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCRSNO    WQNB01           Reporting Set N
     C           *LIKE     DEFN WCRSCD    WQNB02           Reporting Struc
      * Define keylist
     C           KRSNB     KLIST
     C                     KFLD           WQNB01           Reporting Set N
     C                     KFLD           WQNB02           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTNB    WQNB01           Reporting Set N
     C                     MOVELWUREPC    WQNB02           Reporting Struc
     C           KRSNB     SETLL@ACRCBV                    *
     C           KRSNB     READE@ACRCBV                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO NBEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Store key values of record to be deleted (to allow insetion with
      * new Reporting Code).
     C                     MOVELWCRSNO    WUSTBC           Set Number to b
     C                     MOVELWCACCD    WUATBC           Account to be c
     C                     MOVELWCDRCR    WUDRCR           Debit/Credit In
      * Delete all records with appropriate Reporting Set/Code combinatio
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR NCDLRC
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Re-create records with next Code.
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR NDCRRC
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Update file controls for Accounts by Report Codes file.
     C                     Z-ADD*ZERO     WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOAM           No. of Amends
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NFCHRC
     C                     END                             *FI
     C                     END                             *FI
     C           KRSNB     READE@ACRCBV                  90*
     C                     END
      *================================================================
     CSR         NBEXIT    ENDSR
      /EJECT
     CSR         NCDLRC    BEGSR
      *================================================================
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVELWCRSNO    G6RSNO           Reporting Set N
     C                     MOVELWCRSCD    G6RSCD           Reporting Struc
     C                     MOVELWCACCD    G6ACCD           Account Code
     C                     MOVELWCDRCR    G6DRCR           Debit/Credit In
      *
     C           KLDLNC    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLNC    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NCEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NCEXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     END
      *================================================================
     CSR         NCEXIT    ENDSR
      /EJECT
     CSR         NDCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVELWUSTBC    G6RSNO           Reporting Set N
     C                     MOVELWUCDCR    G6RSCD           Reporting Struc
     C                     MOVELWUATBC    G6ACCD           Account Code
     C                     MOVELWUDRCR    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRND    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRND    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO NDEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NECHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         NDEXIT    ENDSR
      /EJECT
     CSR         NECHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YSRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNE    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNE    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NEEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YSRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YSRDCS
     C                     MOVE 'Y'       YSRDC
     C                     END
      * If changed update record otherwise release record
     C           YSRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NEEXIT    ENDSR
      /EJECT
     CSR         NFCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YTRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNF    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNF    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NFEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NFEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YTRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YTRDCS
     C                     MOVE 'Y'       YTRDC
     C                     END
      * If changed update record otherwise release record
     C           YTRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NFEXIT    ENDSR
      /EJECT
     CSR         NGCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVELWUSTNB    G6RSNO           Reporting Set N
     C                     MOVELWUREPC    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRNG    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRNG    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO NGEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NHCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         NGEXIT    ENDSR
      /EJECT
     CSR         NHCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YURDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHNH    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNH    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NHEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NHEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YURDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YURDCS
     C                     MOVE 'Y'       YURDC
     C                     END
      * If changed update record otherwise release record
     C           YURDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NHEXIT    ENDSR
      /EJECT
     CSR         NICHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YVRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDREPCPD'AHFLNM           Filename
      *
     C           KLCHNI    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNI    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NIEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NIEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YVRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YVRDCS
     C                     MOVE 'Y'       YVRDC
     C                     END
      * If changed update record otherwise release record
     C           YVRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NIEXIT    ENDSR
      /EJECT
     CSR         NJCHRC    BEGSR
      *================================================================
      * Chg Rpting Cdes - EDTFIL - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YWRDC   1
      *
      * Move key fields to @AEREAL
     C                     MOVEL#1RSNO    G4RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G4RSCD           Reporting Struc
      *
     C           KLCHNJ    KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
     C           KLCHNJ    CHAIN@AEREAL              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NJEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NJEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKSDREPCL0               91  *
     C                     GOTO NJEXIT
     C                     END                             FI #1DBRC
      * Store record data for null update check
     C                     MOVE @1DBRC    YWRDCS
      * Move non-key fields to @AEREAL
     C                     MOVEL#1LVNB    G4LVNB           Level Number
     C                     MOVEL#1RPNA    G4RPNA           Reporting Narra
     C                     MOVEL'A'       G4TYLC           Type of Last Ch
     C                     Z-ADDWURDNB    G4LCD            Last Change Dat
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YWRDCS
     C                     MOVE 'Y'       YWRDC
     C                     END
      * If changed update record otherwise release record
     C           YWRDC     IFEQ 'Y'
     C                     UPDAT@AEREAL                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDREPCL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
      * USER: Processing after Data update
     C                     Z-ADD*ZERO     WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOAM           No. of Amends
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NKCHRC
     C/COPY WNCPYSRC,SD1300MC11
     C                     END
      *================================================================
     CSR         NJEXIT    ENDSR
      /EJECT
     CSR         NKCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YXRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDREPCPD'AHFLNM           Filename
      *
     C           KLCHNK    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHNK    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO NKEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO NKEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YXRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YXRDCS
     C                     MOVE 'Y'       YXRDC
     C                     END
      * If changed update record otherwise release record
     C           YXRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         NKEXIT    ENDSR
      /EJECT
     CSR         NLRVGN    BEGSR
      *================================================================
      * Read & Val. Rep Codes - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Initialize routine
     C                     Z-ADD*ZERO     WUCRSN           No. Rep Cds per
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     MOVEL'N'       WULSRC           last record
      * Define keylist
     C           KPSNL     KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Move fields to key list
     C                     MOVELWUPSNB    G4RSNO           Reporting Set N
     C                     MOVELWUPSCD    G4RSCD           Reporting Struc
     C           KPSNL     SETLL@AEREAM                    *
     C**********           READ @AEREAM                  90*                                MD036060
     C           KPSNL     READE@AEREAM                  90*                                MD036060
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO NLEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Check for last record (Set No = 9, Reporting Code = 9999)
      * CASE: DB1.Reporting Set Number is last set number
     C           G4RSNO    IFEQ '9'                        *IF
      * Dummy last record (Set No = 9, Rep Code = 9999) forces actual las
      * record to be processed.
      * CASE: DB1.Reporting Structure Code is last structure Code
     C********** G4RSCD    IFEQ '9999'                     *IF                               BUG2589
     C           G4RSCD    IFEQ *ALL'9'                    *IF                               BUG2589
     C                     MOVEL'Y'       WULSRC           last record
     C                     END                             *FI
     C                     END                             *FI
      * Validate record & send error message if required
      * CASE: WRK.last record is Yes
     C           WULSRC    IFEQ 'Y'                        *IF
      * If last record, check if this is only record in file
      * CASE: WRK.Previous Set Number is not blank
     C           WUPSNB    IFNE *BLANK                     *IF
      * If not only record in file, check Balance Sheet? for previous rec
      * CASE: WRK.Prev Set - Balance Sheet? is Balance Sheet
     C********** WUPSBS    IFEQ 'B'                        *IF                               BUG7265
      * If Prev. Set is Balance Sheet, check count - send error message i
      * CASE: WRK.No. Rep Cds per Set No is Not equal to Two
     C********** WUCRSN    IFNE 02                         *IF                               BUG7265
      * Setup message data for message
     C**********           MOVELWUPSNB    ZA0009           Previous Set Nu                   BUG7265
      * Send message 'Two Rep Codes for Set No?'
     C**********           MOVEL'USR4147' ZAMSID                                             BUG7265
     C**********           EXSR ZASNMS                                                       BUG7265
     C**********           SETON                     99    *                                 BUG7265
      *
     C**********           MOVEL'Y'       W0RSF            *Reload subfile                   BUG7265
     C**********           END                             *FI                               BUG7265
      * Reset count.
     C**********           Z-ADD*ZERO     WUCRSN           No. Rep Cds per                   BUG7265
     C**********           END                             *FI                               BUG7265
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * If not last record, check if new set number has been read
      * CASE: DB1.Reporting Set Number NE WRK.Previous Set Number
     C           G4RSNO    IFNE WUPSNB                     *IF
      * If new Set No :- retrieve Balance Sheet?, check count of previous
      * Set - send error message if appropriate.
      * Retrieve Balance Sheet - Reporting Sets  *
     C                     EXSR NMRVGN
      * CASE: WRK.Prev Set - Balance Sheet? is Balance Sheet
     C********** WUPSBS    IFEQ 'B'                        *IF                               BUG7265
      * If Set is Balance Sheet, then 2 records must exist for Level One.
      * CASE: WRK.No. Rep Cds per Set No is Not equal to Two
     C********** WUCRSN    IFNE 02                         *IF                               BUG7265
      * Setup message data for message
     C**********           MOVELWUPSNB    ZA0010           Previous Set Nu                   BUG7265
      * Send message 'Two Rep Codes for Set No?'
     C**********           MOVEL'USR4147' ZAMSID                                             BUG7265
     C**********           EXSR ZASNMS                                                       BUG7265
     C**********           SETON                     99    *                                 BUG7265
      *
     C**********           MOVEL'Y'       W0RSF            *Reload subfile                   BUG7265
     C**********           END                             *FI                               BUG7265
      * Reset count ready for new Set.
     C**********           Z-ADD*ZERO     WUCRSN           No. Rep Cds per                   BUG7265
     C**********           END                             *FI                               BUG7265
      * Add 1 to 'Count of Level 1 records' if Set being read is Balance
      * CASE: WRK.Balance Sheet? is Balance Sheet
     C           WUBALS    IFEQ 'B'                        *IF
      * CASE: DB1.Level Number is 1
     C           G4LVNB    IFEQ '1'                        *IF
     C                     ADD  1         WUCRSN           No. Rep Cds per
     C                     END                             *FI
     C                     END                             *FI
      * Record whether Set just read is Balance Sheet or not.
     C                     MOVELWUBALS    WUPSBS           Prev Set - Bala
     C                     ELSE
      * CASE: *OTHERWISE
      * If same Set Number has been read and it is a Balance Sheet,
      * increment count if Level = 1.
      * CASE: WRK.Balance Sheet? is Balance Sheet
     C           WUBALS    IFEQ 'B'                        *IF
      * CASE: DB1.Level Number is 1
     C           G4LVNB    IFEQ '1'                        *IF
     C                     ADD  1         WUCRSN           No. Rep Cds per
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVELG4RSNO    WUPSNB           Previous Set Nu
     C                     READ @AEREAM                  90*
     C                     END
      *                                                                   122444
     C           WUBALS    IFEQ @CN,23                                    122444
     C********** WUCRSN    IFNE 02                                        122444             BUG7265
      *                                                                   122444
      ** Setup message data for message.                                  122444
      *                                                                   122444
     C**********           MOVELWUPSNB    ZA0011           Previous Set Nu122444             BUG7265
      *                                                                   122444
      ** Send message 'Two Rep Codes for Set No?'                         122444
      *                                                                   122444
     C**********           MOVEL'USR4147' ZAMSID           Message id.    122444             BUG7265
     C**********           EXSR ZASNMS                     Send message   122444             BUG7265
     C**********           MOVE *ON       *IN99            *              122444             BUG7265
      *                                                                   122444
     C**********           MOVEL@CN,03    W0RSF            *Reload subfile122444             BUG7265
     C**********           END                             *FI            122444             BUG7265
     C                     END                             *FI            122444
      *                                                                   122444
      *================================================================
     CSR         NLEXIT    ENDSR
      /EJECT
     CSR         NMRVGN    BEGSR
      *================================================================
      * Retrieve Balance Sheet - Reporting Sets  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSNM     KLIST
     C                     KFLD           G5RSNO           Reporting Set N
      * Move fields to key list
     C                     MOVELG4RSNO    G5RSNO           Reporting Set N
     C           KRSNM     CHAIN@ADREAJ              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1549' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO NMEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG5BALS    WUBALS           Balance Sheet?
     C                     END
      *================================================================
     CSR         NMEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Retrieve Reporting Sets - Reporting Sets  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           G5RSNO           Reporting Set N
      * Move fields to key list
     C                     MOVEL#1RSNO    G5RSNO           Reporting Set N
     C           KRSSA     CHAIN@ADREAJ              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1549' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Retrieve Reporting Codes - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Move fields to key list
     C                     MOVEL#1RSNO    G4RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G4RSCD           Reporting Struc
     C           KRSSB     CHAIN@AEREAM              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * Crt Rpting Cdes - EDTFIL - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AEREAL
     C                     MOVEL#1RSNO    G4RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G4RSCD           Reporting Struc
     C                     MOVEL#1LVNB    G4LVNB           Level Number
     C                     MOVEL#1RPNA    G4RPNA           Reporting Narra
     C                     MOVEL'I'       G4TYLC           Type of Last Ch
     C                     Z-ADDWURDNB    G4LCD            Last Change Dat
     C/COPY WNCPYSRC,SD1300MC12
      *
      * USER: Processing before Data update
      * Save Reporting Code entered for use in transfer of Account Codes.
     C                     MOVEL#1RSCD    WURCDE           Reporting Code
      * Retrieve Set & Code of previous record on SDREPCPD.
      * Check prev. Set and Code - Reporting Codes  *
     C                     EXSR SDRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'Y'       WUPRVR           Previous Record
     C                     ELSE
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
     C                     MOVEL'N'       WUPRVR           Previous Record
     C                     END                             *FI
     C                     END                             *FI
      * Retrieve Set & Code of next record on SDREPCPD.
      * Check next Set & Code - Reporting Codes  *
     C                     EXSR SERVGN
      * Create record in SDREPCPD with screen values entered.
     C                     MOVEL#1RSNO    G4RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G4RSCD           Reporting Struc
     C                     MOVEL#1LVNB    G4LVNB           Level Number
     C                     MOVEL#1RPNA    G4RPNA           Reporting Narra
     C                     MOVEL'I'       G4TYLC           Type of Last Ch
     C                     Z-ADDWURDNB    G4LCD            Last Change Dat
     C           KLCRSC    KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Check for duplicate primary key
     C           KLCRSC    SETLL@AEREAL                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1552' W0RTN   7
      * Send message 'Reporting Codes        EX'
     C                     MOVEL'USR1552' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     END
      *
     C                     WRITE@AEREAL                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C/COPY WNCPYSRC,SD1300MC13
      * USER: Processing after Data update
      * Update file controls for Reporting Codes file
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SFCHRC
     C*                                                                   163906
     C           W0RTN     IFNE *BLANKS                                   163906
     C                     GOTO SCEXIT                                    163906
     C                     END                                            163906
     C*                                                                   163906
      * Check previous code on SDREPCPD (then next code).
      * CASE: WRK.Previous Record is Not Found
     C           WUPRVR    IFEQ 'N'                        *IF
      * No existing previous code, check next code on SDREPCPD.
      * Compare level entered with next record's level (when Set same).
      * CASE: WRK.Next Set Number EQ PAR.Reporting Set Number
     C           WUNSNB    IFEQ #1RSNO                     *IF
      * CASE: PAR.Level Number GE WRK.Next Level Number
     C           #1LVNB    IFGE WUNXLN                     *IF
      * New code eligible for A/c Codes - create dummy record on SDACRCPD
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR SGCRRC
     C*                                                                   163906
     C           W0RTN     IFNE *BLANKS                                   163906
     C                     GOTO SCEXIT                                    163906
     C                     END                                            163906
     C*                                                                   163906
     C                     ELSE
      * CASE: *OTHERWISE
      * Blank out return code, otherwise screen error indicator set on.
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Next code not of same Set - new code eligible, write dummy rcd (S
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR SICRRC
     C*                                                                   163906
     C           W0RTN     IFNE *BLANKS                                   163906
     C                     GOTO SCEXIT                                    163906
     C                     END                                            163906
     C*                                                                   163906
     C                     END                             *FI
     C                     ELSE
      * CASE: WRK.Previous Record is Found
     C           WUPRVR    IFEQ 'Y'                        *IF
      * CASE: WRK.Set Number - work EQ PAR.Reporting Set Number
     C           WUSTNB    IFEQ #1RSNO                     *IF
      * Check if record exists on SDACRCPD using prev Set & Code from SDR
      * Record exists ? - Accounts by Report Codes  *
     C                     EXSR SKRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * Previous Code ELIGIBLE for Account Codes to be attached to it.
     C                     EXSR UASUBR                     Previous Code E
     C*                                                                   163906
     C           W0RTN     IFNE *BLANKS                                   163906
     C                     GOTO SCEXIT                                    163906
     C                     END                                            163906
     C*                                                                   163906
     C                     ELSE
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Previous Code NOT ELIGIBLE to have Account Codes attached to it.
     C                     EXSR UBSUBR                     Previous Code N
     C*                                                                   163906
     C           W0RTN     IFNE *BLANKS                                   163906
     C                     GOTO SCEXIT                                    163906
     C                     END                                            163906
     C*                                                                   163906
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * No existing previous code of same Set, check next code on SDREPCP
      * Compare level entered with next record's level (when Set same).
      * CASE: WRK.Next Set Number EQ PAR.Reporting Set Number
     C           WUNSNB    IFEQ #1RSNO                     *IF
      * CASE: PAR.Level Number GE WRK.Next Level Number
     C           #1LVNB    IFGE WUNXLN                     *IF
      * New code eligible for A/c Codes - create dummy record on SDACRCPD
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TACRRC
     C*                                                                   163906
     C           W0RTN     IFNE *BLANKS                                   163906
     C                     GOTO SCEXIT                                    163906
     C                     END                                            163906
     C*                                                                   163906
     C                     ELSE
      * CASE: *OTHERWISE
      * Blank out return code, otherwise screen error indicator set on.
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Next code not of same Set - new code eligible, write dummy rcd (S
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TCCRRC
     C*                                                                   163906
     C           W0RTN     IFNE *BLANKS                                   163906
     C                     GOTO SCEXIT                                    163906
     C                     END                                            163906
     C*                                                                   163906
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Check prev. Set and Code - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSD     KLIST
     C                     KFLD           WARSNO           Reporting Set N
     C                     KFLD           WARSCD           Reporting Struc
      * Move fields to key list
     C                     MOVEL#1RSNO    WARSNO           Reporting Set N
     C                     MOVEL#1RSCD    WARSCD           Reporting Struc
     C           KPSSD     SETLL@REPCAU                    *
     C**********           READ @REPCAU                  90*                                MD036060
     C           KPSSD     READE@REPCAU                  90*                                MD036060
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SDEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C***********          MOVELWARSNO    WUSTNB           Reporting Set N181052
     C***********          MOVELWARSCD    WUREPC           Reporting Struc181052
     C**********           MOVEL#1RSNO    WUSTNB           Reporting Set N181052             BUG2589
     C**********           MOVEL#1RSCD    WUREPC           Reporting Struc181052             BUG2589
     C                     MOVELWARSNO    WUSTNB           Reporting Set N                   BUG2589
     C                     MOVELWARSCD    WUREPC           Reporting Struc                   BUG2589
     C                     GOTO SDEXIT                     *QUIT                             BUG2589
     C***********          GOTO SDEXIT                     *QUIT          181052
     C                     READ @REPCAU                  90*
     C                     GOTO SDEXIT                     *QUIT          181052
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * Check next Set & Code - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSSE     KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Move fields to key list
     C                     MOVEL#1RSNO    G4RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G4RSCD           Reporting Struc
     C           KPSSE     SETLL@AEREAM                    *
     C**********           READ @AEREAM                  90*                                MD036060
     C           KPSSE     READE@AEREAM                  90*                                MD036060
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG4LVNB    WUNXLN           Level Number
     C                     MOVELG4RSNO    WUNSNB           Reporting Set N
     C                     GOTO SEEXIT                     *QUIT
     C                     READ @AEREAM                  90*
     C                     END
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YARDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDREPCPD'AHFLNM           Filename
      *
     C           KLCHSF    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSF    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO SFEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YARDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YARDCS
     C                     MOVE 'Y'       YARDC
     C                     END
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRSG    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRSG    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SGEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SHCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YBRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHSH    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSH    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO SHEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YBRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YBRDCS
     C                     MOVE 'Y'       YBRDC
     C                     END
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SICRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRSI    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRSI    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SJCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YCRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHSJ    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSJ    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SJEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO SJEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YCRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YCRDCS
     C                     MOVE 'Y'       YCRDC
     C                     END
      * If changed update record otherwise release record
     C           YCRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * Record exists ? - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN G6RSNO    WQSK01           Reporting Set N
     C           *LIKE     DEFN G6RSCD    WQSK02           Reporting Struc
      * Define keylist
     C           KRSSK     KLIST
     C                     KFLD           WQSK01           Reporting Set N
     C                     KFLD           WQSK02           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTNB    WQSK01           Reporting Set N
     C                     MOVELWUREPC    WQSK02           Reporting Struc
     C           KRSSK     SETLL@AGREAR                    *
     C           KRSSK     READE@AGREAR                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SKEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C           KRSSK     READE@AGREAR                  90*
     C                     END
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         SLRVGN    BEGSR
      *================================================================
      * Retrieve Level Number - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSL     KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTNB    G4RSNO           Reporting Set N
     C                     MOVELWUREPC    G4RSCD           Reporting Struc
     C           KRSSL     CHAIN@AEREAM              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SLEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG4LVNB    WULVLN           Level Number
     C                     END
      *================================================================
     CSR         SLEXIT    ENDSR
      /EJECT
     CSR         SMCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRSM    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRSM    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SMEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SNCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SMEXIT    ENDSR
      /EJECT
     CSR         SNCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YDRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHSN    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSN    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SNEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO SNEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YDRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YDRDCS
     C                     MOVE 'Y'       YDRDC
     C                     END
      * If changed update record otherwise release record
     C           YDRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SNEXIT    ENDSR
      /EJECT
     CSR         SOCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRSO    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRSO    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SOEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SPCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SOEXIT    ENDSR
      /EJECT
     CSR         SPCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YERDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHSP    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSP    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SPEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO SPEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YERDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YERDCS
     C                     MOVE 'Y'       YERDC
     C                     END
      * If changed update record otherwise release record
     C           YERDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SPEXIT    ENDSR
      /EJECT
     CSR         SQRVGN    BEGSR
      *================================================================
      * Rtv Accounts Transfer - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WBRSNO    WQSQ01           Reporting Set N
     C           *LIKE     DEFN WBRSCD    WQSQ02           Reporting Struc
      * Define keylist
     C           KRSSQ     KLIST
     C                     KFLD           WQSQ01           Reporting Set N
     C                     KFLD           WQSQ02           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTNB    WQSQ01           Reporting Set N
     C                     MOVELWUREPC    WQSQ02           Reporting Struc
     C           KRSSQ     SETLL@ACRCAT                    *
     C           KRSSQ     READE@ACRCAT                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SQEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Store key values of record to be deleted (to allow insertion with
      * new Reporting Code)
     C                     MOVELWBRSNO    WUSTBC           Set Number to b
     C                     MOVELWBACCD    WUATBC           Account to be c
     C                     MOVELWBDRCR    WUDRCR           Debit/Credit In
      * Check if record is dummy record.
      * CASE: DB1.Account Code is blank
     C           WBACCD    IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUSTMG           Send transfer m
     C                     END                             *FI
      * Delete all records with appropriate Reporting Code/Set Number
      * combination
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR SRDLRC
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Re-Create records with new Reporting Code
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR SSCRRC
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Update file controls for Accounts by Reporting Codes file
     C                     Z-ADD*ZERO     WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOAM           No. of Amends
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SUCHRC
     C                     END                             *FI
     C                     END                             *FI
     C           KRSSQ     READE@ACRCAT                  90*
     C                     END
      *================================================================
     CSR         SQEXIT    ENDSR
      /EJECT
     CSR         SRDLRC    BEGSR
      *================================================================
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVELWBRSNO    G6RSNO           Reporting Set N
     C                     MOVELWBRSCD    G6RSCD           Reporting Struc
     C                     MOVELWBACCD    G6ACCD           Account Code
     C                     MOVELWBDRCR    G6DRCR           Debit/Credit In
      *
     C           KLDLSR    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLSR    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SREXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SREXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     END
      *================================================================
     CSR         SREXIT    ENDSR
      /EJECT                                                              122444
      *****************************************************************   122444
      *  SRLV1C    - Check that if BSPL is set as balance sheet.      *   122444
      *              If balance sheet then only 2 level 1 BSPL codes  *   122444
      *              should be allowed.                               *   122444
      *  Called by - DEV1RC                                           *   122444
      *  Calls     - None                                             *   122444
      *****************************************************************   122444
      *                                                                   122444
     CSR         SRLV1C    BEGSR                                          122444
      *                                                                   122444
     C                     MOVEL*BLANKS   WUPSNB                          122444
     C                     MOVEL*BLANKS   WUBALS                          122444
     C                     Z-ADD0         WUCRSN                          122444
     C                     MOVE 'N'       WNEXT                           122444
      *                                                                   122444
      ** Define keylist                                                   122444
      *                                                                   122444
     C           KRPTC     KLIST                                          122444
     C                     KFLD           WWRSNO  1                       122444
      *                                                                   122444
      ** Move fields to key list.                                         122444
      *                                                                   122444
     C                     MOVEL#1RSNO    WWRSNO                          122444
      *                                                                   122444
     C           KRPTC     SETLL@AEREAM                                   122444
     C                     READ @AEREAM                  90               122444
      *                                                                   122444
     C                     EXSR NMRVGN                                    122444
      *                                                                   122444
     C           *IN90     DOWEQ*OFF                                      122444
     C           #1LVNB    ANDEQ@CN,06                                    122444
      *                                                                   122444
     C           WUBALS    IFEQ @CN,23                                    122444
      *                                                                   122444
     C           G4RSNO    IFNE WUPSNB                                    122444
     C           WNEXT     ANDEQ'Y'                                       122444
     C                     LEAVE                                          122444
     C                     ENDIF                                          122444
      *                                                                   122444
     C           G4LVNB    IFEQ @CN,06                                    122444
     C           WUCRSN    IFLT 01                                        122444
     C                     ADD  1         WUCRSN                          122444
     C                     ELSE                                           122444
      *                                                                   122444
      ** Setup message data for message.                                  122444
      *                                                                   122444
     C                     MOVELG4RSNO    ZA0012           Previous Set Nu122444
      *                                                                   122444
      ** Send message 'Two Rep Codes for Set No?'                         122444
      *                                                                   122444
     C                     MOVEL'USR4147' ZAMSID           Message id.    122444
     C                     EXSR ZASNMS                     Send message   122444
     C                     MOVE *ON       *IN36                           122444
     C                     MOVE *ON       *IN98                           122444
     C                     LEAVE                                          122444
     C                     ENDIF                           *FI            122444
     C                     ENDIF                                          122444
     C                     ENDIF                                          122444
      *                                                                   122444
     C                     MOVELG4RSNO    WUPSNB           Previous Set Nu122444
     C                     READ @AEREAM                  90*              122444
     C                     MOVE 'Y'       WNEXT   1                       122444
     C           G4RSNO    IFNE #1RSNO                                    122444
     C                     LEAVE                                          122444
     C                     ENDIF                                          122444
     C                     ENDDO                                          122444
      *                                                                   122444
     C                     MOVEL*BLANKS   WUPSNB                          122444
     C                     MOVEL*BLANKS   WUBALS                          122444
     C                     Z-ADD0         WUCRSN                          122444
      *                                                                   122444
     C                     ENDSR                                          122444
      *                                                                   122444
     ******************************************************************   122444
      /EJECT
     CSR         SSCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVELWUSTBC    G6RSNO           Reporting Set N
     C                     MOVELWURCDE    G6RSCD           Reporting Struc
     C                     MOVELWUATBC    G6ACCD           Account Code
     C                     MOVELWUDRCR    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRSS    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRSS    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SSEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR STCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SSEXIT    ENDSR
      /EJECT
     CSR         STCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YFRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHST    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHST    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO STEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO STEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YFRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YFRDCS
     C                     MOVE 'Y'       YFRDC
     C                     END
      * If changed update record otherwise release record
     C           YFRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         STEXIT    ENDSR
      /EJECT
     CSR         SUCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YGRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHSU    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSU    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SUEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO SUEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YGRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YGRDCS
     C                     MOVE 'Y'       YGRDC
     C                     END
      * If changed update record otherwise release record
     C           YGRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SUEXIT    ENDSR
      /EJECT
     CSR         SVRVGN    BEGSR
      *================================================================
      * Retrieve Level Number - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSV     KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTNB    G4RSNO           Reporting Set N
     C                     MOVELWUREPC    G4RSCD           Reporting Struc
     C           KRSSV     CHAIN@AEREAM              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SVEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG4LVNB    WULVLN           Level Number
     C                     END
      *================================================================
     CSR         SVEXIT    ENDSR
      /EJECT
     CSR         SWCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVELWUSTNB    G6RSNO           Reporting Set N
     C                     MOVELWUREPC    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRSW    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRSW    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SWEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SXCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SWEXIT    ENDSR
      /EJECT
     CSR         SXCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YHRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHSX    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSX    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SXEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO SXEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YHRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YHRDCS
     C                     MOVE 'Y'       YHRDC
     C                     END
      * If changed update record otherwise release record
     C           YHRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SXEXIT    ENDSR
      /EJECT
     CSR         SYCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRSY    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRSY    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SYEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SZCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SYEXIT    ENDSR
      /EJECT
     CSR         SZCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YIRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHSZ    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSZ    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SZEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO SZEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YIRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YIRDCS
     C                     MOVE 'Y'       YIRDC
     C                     END
      * If changed update record otherwise release record
     C           YIRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SZEXIT    ENDSR
      /EJECT
     CSR         TACRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRTA    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTA    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TAEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TBCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         TAEXIT    ENDSR
      /EJECT
     CSR         TBCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YJRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTB    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTB    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TBEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO TBEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YJRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YJRDCS
     C                     MOVE 'Y'       YJRDC
     C                     END
      * If changed update record otherwise release record
     C           YJRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TBEXIT    ENDSR
      /EJECT
     CSR         TCCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRTC    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTC    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TCEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TDCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         TCEXIT    ENDSR
      /EJECT
     CSR         TDCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YKRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTD    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTD    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TDEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     MOVEL'Y2U0007' ZAMSID           Message id.    163906
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.  163906
     C                     EXSR ZASNMS                     Send Message   163906
     C                     GOTO TDEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YKRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YKRDCS
     C                     MOVE 'Y'       YKRDC
     C                     END
      * If changed update record otherwise release record
     C           YKRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TDEXIT    ENDSR
      /EJECT
     CSR         TEDLRC    BEGSR
      *================================================================
      * Del Rpting Cdes - EDTFIL - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before Data update
      * Store Set & Code of record deleted.
     C                     MOVEL#1RSNO    WUSTDL           Set deleted
     C                     MOVEL#1RSCD    WUCDDL           Code deleted
      * Rtv accts for report Code - Accounts by Report Codes  *
     C                     EXSR TFRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * If non-dummy Account Codes are attached, Code may NOT be deleted.
      * CASE: WRK.Account Code is not blank
     C           WUACCD    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1RSCD    ZA0008           Reporting Struc
      * Send message 'Report Cd cannot delete'
     C                     MOVEL'USR4139' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     MOVEL*BLANK    WUACCD           Account Code
     C                     MOVEL'Y2U0004' W0RTN            *Return code
     C                     GOTO TEEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
      * Delete dummy record on SDACRCPD.
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TGDLRC
      * Amend File Controls if record successfully deleted.
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD1         WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR THCHRC
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Move key fields to @AEREAL
     C                     MOVEL#1RSNO    G4RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G4RSCD           Reporting Struc
      *
     C           KLDLTE    KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
     C           KLDLTE    CHAIN@AEREAL              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TEEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C           KLDLTE    SETLL@AEREAL              9091  *
     C                     GOTO TEEXIT
     C                     END                             FI #1DBRC
      *................................................................
     C                     DELET@AEREAL                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C/COPY WNCPYSRC,SD1300MC14
      * DBF delete successful
      * USER: Processing after Data update
      * Check the Set & Code of previous record on SDREPCPD.
      * Check prev. Set and Code - Reporting Codes  *
     C                     EXSR TIRVGN
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
      * If Set same as Set for record deleted.
      * CASE: WRK.Set Number - work EQ WRK.Set deleted
     C           WUSTNB    IFEQ WUSTDL                     *IF
      * Retrieve Level Number of the previous code.
      * Retrieve Level Number - Reporting Codes  *
     C                     EXSR TJRVGN
      * Rtv accts for report Code - Accounts by Report Codes  *
     C                     EXSR TKRVGN
      * Check if previous code exists on SDACRCPD - dummy or not.
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'Y'       WUPACR           Previous ACRC r
      * CASE: WRK.Previous Account Code is blank
     C           WUPACC    IFEQ *BLANK                     *IF
     C                     MOVEL'Y'       WUDMPR           Dummy for previ
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDMPR           Dummy for previ
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDMPR           Dummy for previ
     C                     MOVEL'N'       WUPACR           Previous ACRC r
     C                     END                             *FI
      * Retrieve the Set, Code and Level Number of next record on SDREPCP
      * Check next Set,Code,Level - Reporting Codes  *
     C                     EXSR TLRVGN
      * If Set same as Set for record deleted.
      * CASE: WRK.Next Set Number EQ WRK.Set deleted
     C           WUNSNB    IFEQ WUSTDL                     *IF
      * Rtv accts for report Code - Accounts by Report Codes  *
     C                     EXSR TMRVGN
      * Check if next code exists on SDACRCPD - dummy or not.
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     MOVEL'Y'       WUNACR           Next ACRC recor
      * CASE: WRK.Next Account Code is blank
     C           WUNXAC    IFEQ *BLANK                     *IF
     C                     MOVEL'Y'       WUDMNR           Dummy for next
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDMNR           Dummy for next
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDMNR           Dummy for next
     C                     MOVEL'N'       WUNACR           Next ACRC recor
     C                     END                             *FI
      * Compare Levels of Previous and Next Codes.
     C                     EXSR UCSUBR                     Compare Levels
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Previous ACRC record is No
     C           WUPACR    IFEQ 'N'                        *IF
      * Insert dummy record as previous code now eligible.
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR NGCRRC
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * WUDELR Data Structure - SD Deleted Records File  *
     C                     MOVEL@1DBRC    WUDELR
      * Concat the two part key into one field
     C           #1RSNO    CAT  #1RSCD    WULKEY    P      Long Key
      * Write Deleted Record - SD Deleted Records File  *
     C                     CLEARPARC
     C                     MOVEL'SDRELCPD'PAFNME           File name
     C                     MOVELWULKEY    PALKEY           Long Key
     C                     MOVELWUDR01    PADR01           Deleted Data Re
     C                     MOVELWUDR02    PADR02           Deleted Data Re
     C                     MOVELWUDR03    PADR03           Deleted Data Re
     C                     MOVELWUDR04    PADR04           Deleted Data Re
     C                     MOVELWUDR05    PADR05           Deleted Data Re
     C                     MOVELWUDR06    PADR06           Deleted Data Re
     C                     MOVELWUDR07    PADR07           Deleted Data Re
     C                     MOVELWUDR08    PADR08           Deleted Data Re
     C                     MOVELWUDR09    PADR09           Deleted Data Re
     C                     MOVELWUDR00    PADR00           Deleted Data Re
     C                     MOVELWUDR11    PADR11           Deleted Data Re
     C                     MOVELWUDR12    PADR12           Deleted Data Re
     C                     Z-ADDWURDNB    PALCD            Last Change Dat
     C                     MOVEL'D'       PATYLC           Type of Last Ch
      *
     C                     CALL 'SD0520X'              90  Write Deleted R
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             RCD: SD Deleted
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0520X' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD1         WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NICHRC
     C                     END
      *================================================================
     CSR         TEEXIT    ENDSR
      /EJECT
     CSR         TFRVGN    BEGSR
      *================================================================
      * Rtv accts for report Code - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN G6RSNO    WQTF01           Reporting Set N
     C           *LIKE     DEFN G6RSCD    WQTF02           Reporting Struc
      * Define keylist
     C           KRSTF     KLIST
     C                     KFLD           WQTF01           Reporting Set N
     C                     KFLD           WQTF02           Reporting Struc
      * Move fields to key list
     C                     MOVEL#1RSNO    WQTF01           Reporting Set N
     C                     MOVEL#1RSCD    WQTF02           Reporting Struc
     C           KRSTF     SETLL@AGREAR                    *
     C           KRSTF     READE@AGREAR                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TFEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG6ACCD    WUACCD           Account Code
     C           KRSTF     READE@AGREAR                  90*
     C                     END
      *================================================================
     CSR         TFEXIT    ENDSR
      /EJECT
     CSR         TGDLRC    BEGSR
      *================================================================
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVEL#1RSNO    G6RSNO           Reporting Set N
     C                     MOVEL#1RSCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
      *
     C           KLDLTG    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLTG    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TGEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TGEXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     END
      *================================================================
     CSR         TGEXIT    ENDSR
      /EJECT
     CSR         THCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YLRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTH    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTH    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO THEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO THEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YLRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YLRDCS
     C                     MOVE 'Y'       YLRDC
     C                     END
      * If changed update record otherwise release record
     C           YLRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         THEXIT    ENDSR
      /EJECT
     CSR         TIRVGN    BEGSR
      *================================================================
      * Check prev. Set and Code - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSTI     KLIST
     C                     KFLD           WARSNO           Reporting Set N
     C                     KFLD           WARSCD           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTDL    WARSNO           Reporting Set N
     C                     MOVELWUCDDL    WARSCD           Reporting Struc
     C           KPSTI     SETLL@REPCAU                    *
     C**********           READ @REPCAU                  90*                                MD036060
     C           KPSTI     READE@REPCAU                  90*                                MD036060
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TIEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELWARSNO    WUSTNB           Reporting Set N
     C                     MOVELWARSCD    WUREPC           Reporting Struc
     C                     GOTO TIEXIT                     *QUIT
     C                     READ @REPCAU                  90*
     C                     END
      *================================================================
     CSR         TIEXIT    ENDSR
      /EJECT
     CSR         TJRVGN    BEGSR
      *================================================================
      * Retrieve Level Number - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSTJ     KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTNB    G4RSNO           Reporting Set N
     C                     MOVELWUREPC    G4RSCD           Reporting Struc
     C           KRSTJ     CHAIN@AEREAM              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TJEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG4LVNB    WULVLN           Level Number
     C                     END
      *================================================================
     CSR         TJEXIT    ENDSR
      /EJECT
     CSR         TKRVGN    BEGSR
      *================================================================
      * Rtv accts for report Code - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN G6RSNO    WQTK01           Reporting Set N
     C           *LIKE     DEFN G6RSCD    WQTK02           Reporting Struc
      * Define keylist
     C           KRSTK     KLIST
     C                     KFLD           WQTK01           Reporting Set N
     C                     KFLD           WQTK02           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTNB    WQTK01           Reporting Set N
     C                     MOVELWUREPC    WQTK02           Reporting Struc
     C           KRSTK     SETLL@AGREAR                    *
     C           KRSTK     READE@AGREAR                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TKEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG6ACCD    WUPACC           Account Code
     C           KRSTK     READE@AGREAR                  90*
     C                     END
      *================================================================
     CSR         TKEXIT    ENDSR
      /EJECT
     CSR         TLRVGN    BEGSR
      *================================================================
      * Check next Set,Code,Level - Reporting Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSTL     KLIST
     C                     KFLD           G4RSNO           Reporting Set N
     C                     KFLD           G4RSCD           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTDL    G4RSNO           Reporting Set N
     C                     MOVELWUCDDL    G4RSCD           Reporting Struc
     C           KPSTL     SETLL@AEREAM                    *
     C**********           READ @AEREAM                  90*                                MD036060
     C           KPSTL     READE@AEREAM                  90*                                MD036060
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1551' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TLEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG4RSNO    WUNSNB           Reporting Set N
     C                     MOVELG4RSCD    WUNXCD           Reporting Struc
     C                     MOVELG4LVNB    WUNXLN           Level Number
     C                     GOTO TLEXIT                     *QUIT
     C                     READ @AEREAM                  90*
     C                     END
      *================================================================
     CSR         TLEXIT    ENDSR
      /EJECT
     CSR         TMRVGN    BEGSR
      *================================================================
      * Rtv accts for report Code - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN G6RSNO    WQTM01           Reporting Set N
     C           *LIKE     DEFN G6RSCD    WQTM02           Reporting Struc
      * Define keylist
     C           KRSTM     KLIST
     C                     KFLD           WQTM01           Reporting Set N
     C                     KFLD           WQTM02           Reporting Struc
      * Move fields to key list
     C                     MOVELWUNSNB    WQTM01           Reporting Set N
     C                     MOVELWUNXCD    WQTM02           Reporting Struc
     C           KRSTM     SETLL@AGREAR                    *
     C           KRSTM     READE@AGREAR                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TMEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELG6ACCD    WUNXAC           Account Code
     C           KRSTM     READE@AGREAR                  90*
     C                     END
      *================================================================
     CSR         TMEXIT    ENDSR
      /EJECT
     CSR         TNCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVELWUSTNB    G6RSNO           Reporting Set N
     C                     MOVELWUREPC    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'I'       G6TYLC           Type of Last Ch
      *
     C           KLCRTN    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTN    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TNEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'I'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TOCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         TNEXIT    ENDSR
      /EJECT
     CSR         TOCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YMRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTO    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTO    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TOEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TOEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YMRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YMRDCS
     C                     MOVE 'Y'       YMRDC
     C                     END
      * If changed update record otherwise release record
     C           YMRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TOEXIT    ENDSR
      /EJECT
     CSR         TPDLRC    BEGSR
      *================================================================
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVELWUSTNB    G6RSNO           Reporting Set N
     C                     MOVELWUREPC    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
      *
     C           KLDLTP    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLTP    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TPEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TPEXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     END
      *================================================================
     CSR         TPEXIT    ENDSR
      /EJECT
     CSR         TQCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YNRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTQ    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTQ    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TQEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TQEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YNRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YNRDCS
     C                     MOVE 'Y'       YNRDC
     C                     END
      * If changed update record otherwise release record
     C           YNRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TQEXIT    ENDSR
      /EJECT
     CSR         TRDLRC    BEGSR
      *================================================================
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVELWUNSNB    G6RSNO           Reporting Set N
     C                     MOVELWUNXCD    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
      *
     C           KLDLTR    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLTR    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TREXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TREXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     END
      *================================================================
     CSR         TREXIT    ENDSR
      /EJECT
     CSR         TSCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YORDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTS    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTS    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TSEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TSEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YORDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YORDCS
     C                     MOVE 'Y'       YORDC
     C                     END
      * If changed update record otherwise release record
     C           YORDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TSEXIT    ENDSR
      /EJECT
     CSR         TTRVGN    BEGSR
      *================================================================
      * Transfer A/cs - Dlt Mode - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Declare restrictor key work fields
     C           *LIKE     DEFN WCRSNO    WQTT01           Reporting Set N
     C           *LIKE     DEFN WCRSCD    WQTT02           Reporting Struc
      * Define keylist
     C           KRSTT     KLIST
     C                     KFLD           WQTT01           Reporting Set N
     C                     KFLD           WQTT02           Reporting Struc
      * Move fields to key list
     C                     MOVELWUSTNB    WQTT01           Reporting Set N
     C                     MOVELWUREPC    WQTT02           Reporting Struc
     C           KRSTT     SETLL@ACRCBV                    *
     C           KRSTT     READE@ACRCBV                  90*
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TTEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
      * Store key values of record to be deleted (to allow insetion with
      * new Reporting Code).
     C                     MOVELWCRSNO    WUSTBC           Set Number to b
     C                     MOVELWCACCD    WUATBC           Account to be c
     C                     MOVELWCDRCR    WUDRCR           Debit/Credit In
      * Delete all records with appropriate Reporting Set/Code combinatio
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TUDLRC
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Re-create records with next Code.
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TVCRRC
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * Update file controls for Accounts by Report Codes file.
     C                     Z-ADD*ZERO     WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOAM           No. of Amends
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TXCHRC
     C                     END                             *FI
     C                     END                             *FI
     C           KRSTT     READE@ACRCBV                  90*
     C                     END
      *================================================================
     CSR         TTEXIT    ENDSR
      /EJECT
     CSR         TUDLRC    BEGSR
      *================================================================
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVELWCRSNO    G6RSNO           Reporting Set N
     C                     MOVELWCRSCD    G6RSCD           Reporting Struc
     C                     MOVELWCACCD    G6ACCD           Account Code
     C                     MOVELWCDRCR    G6DRCR           Debit/Credit In
      *
     C           KLDLTU    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLTU    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TUEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TUEXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     END
      *================================================================
     CSR         TUEXIT    ENDSR
      /EJECT
     CSR         TVCRRC    BEGSR
      *================================================================
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @AGREAQ
     C                     MOVELWUSTBC    G6RSNO           Reporting Set N
     C                     MOVELWUCDCR    G6RSCD           Reporting Struc
     C                     MOVELWUATBC    G6ACCD           Account Code
     C                     MOVELWUDRCR    G6DRCR           Debit/Credit In
     C                     Z-ADDWURDNB    G6LCD            Last Change Dat
     C                     MOVEL'A'       G6TYLC           Type of Last Ch
      *
     C           KLCRTV    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
      * Check for duplicate primary key
     C           KLCRTV    SETLL@AGREAQ                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'USR1554' W0RTN   7
      * Send message 'Accounts by Report Cod EX'
     C                     MOVEL'USR1554' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO TVEXIT
     C                     END
      *
     C                     WRITE@AGREAQ                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * USER: Processing after Data update
      * CASE: PAR.Type of Last Change is Insert
     C           'A'       IFEQ 'I'                        *IF
     C                     Z-ADD1         WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TWCHRC
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         TVEXIT    ENDSR
      /EJECT
     CSR         TWCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YPRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTW    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTW    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TWEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TWEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YPRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YPRDCS
     C                     MOVE 'Y'       YPRDC
     C                     END
      * If changed update record otherwise release record
     C           YPRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TWEXIT    ENDSR
      /EJECT
     CSR         TXCHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YQRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDACRCPD'AHFLNM           Filename
      *
     C           KLCHTX    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHTX    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TXEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO TXEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YQRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YQRDCS
     C                     MOVE 'Y'       YQRDC
     C                     END
      * If changed update record otherwise release record
     C           YQRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         TXEXIT    ENDSR
      /EJECT
     CSR         TYRVGN    BEGSR
      *================================================================
      * Rtv next eligible Code - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KPSTY     KLIST
     C                     KFLD           WCRSNO           Reporting Set N
     C                     KFLD           WCRSCD           Reporting Struc
      * Move fields to key list
     C                     MOVELWUNSNB    WCRSNO           Reporting Set N
     C                     MOVELWUNXCD    WCRSCD           Reporting Struc
     C           KPSTY     SETLL@ACRCBV                    *
     C**********           READ @ACRCBV                  90*                                MD036060
     C           KPSTY     READE@ACRCBV                  90*                                MD036060
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR1553' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO TYEXIT
     C                     END
      *
     C           *IN90     DOWEQ'0'
      * USER: Process Data record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELWCRSCD    WUCDCR           Reporting Struc
     C                     MOVELWCACCD    WUTACC           Account Code
     C                     GOTO TYEXIT                     *QUIT
     C                     READ @ACRCBV                  90*
     C                     END
      *================================================================
     CSR         TYEXIT    ENDSR
      /EJECT
     CSR         TZDLRC    BEGSR
      *================================================================
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @AGREAQ
     C                     MOVELWUNSNB    G6RSNO           Reporting Set N
     C                     MOVELWUCDCR    G6RSCD           Reporting Struc
     C                     MOVEL*BLANK    G6ACCD           Account Code
     C                     MOVEL*BLANK    G6DRCR           Debit/Credit In
      *
     C           KLDLTZ    KLIST
     C                     KFLD           G6RSNO           Reporting Set N
     C                     KFLD           G6RSCD           Reporting Struc
     C                     KFLD           G6ACCD           Account Code
     C                     KFLD           G6DRCR           Debit/Credit In
     C           KLDLTZ    CHAIN@AGREAQ              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TZEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
      * Send message '*Database operation error'
     C                     MOVEL'Y2U0004' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO TZEXIT
     C                     END
      *
      *................................................................
     C                     DELET@AGREAQ                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     END
      *================================================================
     CSR         TZEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Previous Code ELIGIBLE for Account Codes to be attached to it.
      *================================================================
      * Retrieve Level Number - Reporting Codes  *
     C                     EXSR SLRVGN
      * Compare level entered with previous record's level.
      * CASE: PAR.Level Number LT WRK.Level Number - work
     C           #1LVNB    IFLT WULVLN                     *IF
      * Compare level entered with next record's level (when Set same).
      * CASE: WRK.Next Set Number EQ PAR.Reporting Set Number
     C           WUNSNB    IFEQ #1RSNO                     *IF
      * CASE: PAR.Level Number LT WRK.Next Level Number
     C           #1LVNB    IFLT WUNXLN                     *IF
      * New code ineligible to have Account Codes attached because
      * the level is LT both previous code's level AND next code's level.
      * Blank out return code, otherwise screen error indictor set on.
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     GOTO UAEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * New record eligible to have Account Codes attached.
      * Create dummy record on SDACRCPD.
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR SMCRRC
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.Level Number EQ WRK.Level Number - work
     C           #1LVNB    IFEQ WULVLN                     *IF
      * Since previous code eligible, and new code's level is same,
      * new code also eligible. Create dummy record on SDACRCPD.
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR SOCRRC
     C                     ELSE
      * CASE: *OTHERWISE
      * Level entered is GT previous code level so transfer A/c Codes
      * from previous code.
      * Rtv Accounts Transfer - Accounts by Report Codes  *
     C                     EXSR SQRVGN
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Previous Code NOT ELIGIBLE to have Account Codes attached to it.
      *================================================================
      * Check level of previous code.
      * Retrieve Level Number - Reporting Codes  *
     C                     EXSR SVRVGN
      * CASE: PAR.Level Number LE WRK.Level Number - work
     C           #1LVNB    IFLE WULVLN                     *IF
      * Previous code now eligible for A/c Codes to be attached -
      * create dummy record using previous record's set & code on SDACRCP
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR SWCRRC
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.Level Number GE WRK.Next Level Number
     C           #1LVNB    IFGE WUNXLN                     *IF
      * New code eligible for A/c Codes - create dummy record on SDACRCPD
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR SYCRRC
     C                     ELSE
      * CASE: *OTHERWISE
      * Blank out return code, otherwise screen error indicator set on.
     C                     MOVEL*BLANK    W0RTN            *Return code
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Compare Levels of Previous and Next Codes.
      *================================================================
      * CASE: WRK.Next Level Number LE WRK.Level Number - work
     C           WUNXLN    IFLE WULVLN                     *IF
      * Previous Code is ELIGIBLE for Account Codes to be attached.
      * CASE: WRK.Previous ACRC record is No
     C           WUPACR    IFEQ 'N'                        *IF
      * Insert dummy record as previous code now eligible.
      * Crt Eligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TNCRRC
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Previous Code is INELIGIBLE for Account Codes to be attached.
      * CASE: WRK.Previous ACRC record is Yes
     C           WUPACR    IFEQ 'Y'                        *IF
      * CASE: WRK.Dummy for previous rec ? is Yes
     C           WUDMPR    IFEQ 'Y'                        *IF
      * Delete dummy record for previous code.
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TPDLRC
      * Amend File Controls if record successfully deleted.
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD1         WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TQCHRC
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Account Codes attached to previous code (now ineligible) must be
      * transferred to next eligible Code.
      * CASE: WRK.Next ACRC record is Yes
     C           WUNACR    IFEQ 'Y'                        *IF
      * CASE: WRK.Dummy for next record ? is Yes
     C           WUDMNR    IFEQ 'Y'                        *IF
      * Delete dummy for next Code, ready for Account Codes to be transfe
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TRDLRC
      * Amend File Controls if record successfully deleted.
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD1         WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR TSCHRC
     C                     END                             *FI
     C                     END                             *FI
      * Transfer Accounts to next Code.
     C                     MOVELWUNXCD    WUCDCR           Code to be crea
      * Transfer A/cs - Dlt Mode - Accounts by Report Codes  *
     C                     EXSR TTRVGN
     C                     ELSE
      * CASE: *OTHERWISE
      * Determine the next Reporting Code which is eligible for Account
      * Codes to be attached, and transfer.
      * Rtv next eligible Code - Accounts by Report Codes  *
     C                     EXSR TYRVGN
      * CASE: WRK.Test Account Code is blank
     C           WUTACC    IFEQ *BLANK                     *IF
      * Delete dummy record for next eligible code.
      * Dlt Ineligible Code/Accts - Accounts by Report Codes  *
     C                     EXSR TZDLRC
      * Amend File Controls if record successfully deleted.
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     Z-ADD-1        WUNORC           No. of Records
     C                     Z-ADD1         WUNODL           No. of Deletes
     C                     Z-ADD*ZERO     WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR NACHRC
     C                     END                             *FI
     C                     END                             *FI
      * Transfer A/cs - Dlt Mode - Accounts by Report Codes  *
     C                     EXSR NBRVGN
     C                     END                             *FI
      * Inform user that Accounts have been transferred (when subfile rel
     C                     MOVEL'Y'       WUSTMG           Send transfer m
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Reporting Sets
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1RSNO    WK1X01  1
     C           WK1X01    IFEQ '?'                        Reporting Set N
     C                     CALL 'SD1310S'              90  Select Reportin
     C                     PARM *BLANK    W0RTN   7
     C           #1RSNO    PARM #1RSNO    WQ0001  1        Reporting Set N
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD1310S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9834  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VAEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1RSNO    IFEQ *BLANK                     Reporting Set N
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVAG5    KLIST
     C                     KFLD           G5RSNO           Reporting Set N
      * Setup key
     C                     MOVEL#1RSNO    G5RSNO           Reporting Set N
     C           KLVAG5    CHAIN@ADREAJ              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Reporting Sets         NF'
     C                     MOVEL'USR1549' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR1549' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
      * USER: Exit program processing
      * Initialise work fields to blanks (ready to SETLL on SDREPCPD).
     C                     MOVEL*BLANK    WUPSNB           Previous Set Nu
     C                     MOVEL*BLANK    WUPSCD           Previous Struct
     C                     MOVEL*BLANK    WUPSBS           Prev Set - Bala
      * Do not allow user to exit program unless records on SDREPCPD vali
      * CASE: CTL.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
      * Read & Val. Rep Codes - Reporting Codes  *
     C                     EXSR NLRVGN
      * CASE: PGM.*Reload subfile is *YES
     C           W0RSF     IFEQ 'Y'                        *IF
     C                     GOTO ZXEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * ROLLBACK any uncommitted DBF changes
     C                     ROLBK                       90
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
      * Set century digit (If YY prior to 1940 treat as 20YY)
     C           ##JYY     IFLT 40
     C                     Z-ADD1         ##JCC
     C                     ELSE
     C                     Z-ADD0         ##JCC
     C                     END
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Deletion Allowed
     C                     MOVEL*BLANK    WUDELA  1
      * Define work field Set Up Complete
     C                     MOVEL*BLANK    WUSUC   1
      * Define work field Send transfer message
     C                     MOVEL*BLANK    WUSTMG  1
      * Obtain default message file
     C           *NAMVAR   DEFN Y2MGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Run day number
     C                     Z-ADD*ZERO     WURDNB  50
      * Define work field Reporting Code entered
     C**********           MOVEL*BLANK    WURCDE  4                                          BUG2589
     C                     MOVEL*BLANK    WURCDE 10                                          BUG2589
      * Define work field Set Number - work
     C                     MOVEL*BLANK    WUSTNB  1
      * Define work field Reporting Code - work
     C**********           MOVEL*BLANK    WUREPC  4                                          BUG2589
     C                     MOVEL*BLANK    WUREPC 10                                          BUG2589
      * Define work field Previous Record
     C                     MOVEL*BLANK    WUPRVR  1
      * Define work field Next Level Number
     C                     MOVEL*BLANK    WUNXLN  1
      * Define work field Next Set Number
     C                     MOVEL*BLANK    WUNSNB  1
      * Define work field No. of Records
     C                     Z-ADD*ZERO     WUNORC  50
      * Define work field No. of Amends
     C                     Z-ADD*ZERO     WUNOAM  50
      * Define work field No. of Deletes
     C                     Z-ADD*ZERO     WUNODL  50
      * Define work field No. of Inserts
     C                     Z-ADD*ZERO     WUNOIN  50
      * Define work field Level Number - work
     C                     MOVEL*BLANK    WULVLN  1
      * Define work field Set Number to be created
     C                     MOVEL*BLANK    WUSTBC  1
      * Define work field Account to be created
     C**********           MOVEL*BLANK    WUATBC  4                                           CGL029
     C                     MOVEL*BLANK    WUATBC 10                                           CGL029
      * Define work field Debit/Credit Ind.
     C                     MOVEL*BLANK    WUDRCR  1
      * Define work field Action Code
     C                     MOVEL*BLANK    WUANCD  1
      * Define work field Set deleted
     C                     MOVEL*BLANK    WUSTDL  1
      * Define work field Code deleted
     C**********           MOVEL*BLANK    WUCDDL  4                                          BUG2589
     C                     MOVEL*BLANK    WUCDDL 10                                          BUG2589
      * Define work field Account Code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVEL*BLANK    WUACCD 10                                           CGL029
      * Define work field Previous Account Code
     C**********           MOVEL*BLANK    WUPACC  4                                           CGL029
     C                     MOVEL*BLANK    WUPACC 10                                           CGL029
      * Define work field Previous ACRC record
     C                     MOVEL*BLANK    WUPACR  1
      * Define work field Dummy for previous rec ?
     C                     MOVEL*BLANK    WUDMPR  1
      * Define work field Next Code
     C**********           MOVEL*BLANK    WUNXCD  4                                          BUG2589
     C                     MOVEL*BLANK    WUNXCD 10                                          BUG2589
      * Define work field Next Account Code
     C**********           MOVEL*BLANK    WUNXAC  4                                           CGL029
     C                     MOVEL*BLANK    WUNXAC 10                                           CGL029
      * Define work field Next ACRC record
     C                     MOVEL*BLANK    WUNACR  1
      * Define work field Dummy for next record ?
     C                     MOVEL*BLANK    WUDMNR  1
      * Define work field Code to be created
     C**********           MOVEL*BLANK    WUCDCR  4                                          BUG2589
     C                     MOVEL*BLANK    WUCDCR 10                                          BUG2589
      * Define work field Test Account Code
     C**********           MOVEL*BLANK    WUTACC  4                                           CGL029
     C                     MOVEL*BLANK    WUTACC 10                                           CGL029
      * Define work field Long Key
     C                     MOVEL*BLANK    WULKEY 50
      * Define work field Deleted Data Record Pt1
     C                     MOVEL*BLANK    WUDR01250
      * Define work field Deleted Data Record Pt2
     C                     MOVEL*BLANK    WUDR02250
      * Define work field Deleted Data Record Pt3
     C                     MOVEL*BLANK    WUDR03250
      * Define work field Deleted Data Record Pt4
     C                     MOVEL*BLANK    WUDR04250
      * Define work field Deleted Data Record Pt5
     C                     MOVEL*BLANK    WUDR05250
      * Define work field Deleted Data Record Pt6
     C                     MOVEL*BLANK    WUDR06250
      * Define work field Deleted Data Record Pt7
     C                     MOVEL*BLANK    WUDR07250
      * Define work field Deleted Data Record Pt8
     C                     MOVEL*BLANK    WUDR08250
      * Define work field Deleted Data Record Pt9
     C                     MOVEL*BLANK    WUDR09250
      * Define work field Deleted Data Record Pt10
     C                     MOVEL*BLANK    WUDR00250
      * Define work field Deleted Data Record Pt11
     C                     MOVEL*BLANK    WUDR11250
      * Define work field Deleted Data Record Pt12
     C                     MOVEL*BLANK    WUDR12250
      * Define work field Previous Set Number
     C                     MOVEL*BLANK    WUPSNB  1
      * Define work field Previous Structure Code
     C**********           MOVEL*BLANK    WUPSCD  4                                          BUG2589
     C                     MOVEL*BLANK    WUPSCD 10                                          BUG2589
      * Define work field Prev Set - Balance Sheet?
     C                     MOVEL*BLANK    WUPSBS  1
      * Define work field No. Rep Cds per Set No
     C                     Z-ADD*ZERO     WUCRSN  20
      * Define work field last record
     C                     MOVEL*BLANK    WULSRC  1
      * Define work field Balance Sheet?
     C                     MOVEL*BLANK    WUBALS  1
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Date format flag
     C                     MOVEL*BLANK    WUDFF   1
      * Define work field Multi-branching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Open files
      * Begin commit control
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
      * Define *Synon program work fields
     C                     Z-ADD*ZEROS    YRSW00  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW01  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW02  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW03  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW04  50       *Synon (5,0) wo
     C                     Z-ADD*ZEROS    YRSW05  50       *Synon (5,0) wo
     C                     MOVEL*BLANKS   YRSW06  1        *String work fi
     C                     MOVEL*BLANKS   YRSW07  1        *String work fi
     C                     MOVEL*BLANKS   YRSW08  7        *Return code
     C                     MOVEL*BLANKS   YRSW09  1        *String work fi
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0A           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0B           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0C           *Synon (9999) w
      * *Synon (9999) work field
     C                     MOVEL*BLANKS   YRSW0D           *Synon (9999) w
     C                     MOVEL*BLANKS   YRSW0E  1        *String work fi
     C                     MOVEL*BLANKS   YRSW0F  1        *String work fi
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     OPEN SD1300M#
     C                     OPEN SDREPCL1
     C                     OPEN SDRPSTL1
     C                     OPEN SDREPCL2
     C                     OPEN SDACRCL1
     C                     OPEN SDACRCL2
     C                     OPEN SDACRCL3
     C                     OPEN SDREPCL0
     C                     OPEN SDFCTLL0
     C                     OPEN SDACRCL0
     C                     MOVEL'N'       W0PMT   1
      *
     C                     Z-ADD14        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD500       W0SLM   50
      * Subfile pages
     C                     Z-ADD1         W0SPG   30
      * Processed Subfile record
     C                     Z-ADD0         W0RR0   40
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialize program
      * SD1300M Precompiler - Reporting Codes  *
      * Copyright Statement 1988 - Standard Functions  *
      * Get Rundate - Rundate  *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT  7        RUN DATE
     C                     MOVE MRDT      WUMRDT
     C                     MOVE RDNB      WURDNB           RUNDAY NO.
     C                     MOVE SUC       WUSUC            SET UP COMPLT
     C                     MOVE DFF       WUDFF            DTE FMT FLAG
     C                     MOVE MBIN      WUMBIN           MULTI BR. IND
     C                     MOVEL'N'       WUSTMG           Send transfer m
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT
     CSR         *PSSR     BEGSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
      *
      * Core function specific processing.
      *
     C/COPY WNCPYSRC,SD1300MPSC
      *
      * Start of PSSR user point.
      *
     C/COPY WNCPYSRC,SD1300MPS1
      *
      * Standard Midas PSSR processing.
      *
     C/COPY SDCPYSRC,SDPSSRINT
      *
      * End of PSSR user point.
      *
     C/COPY WNCPYSRC,SD1300MPS2
      *
      *================================================================
     CSR                   ENDSR
      *================================================================
** CPY@     : Copyright notice for inclusion in all programs
(c) Finastra International Limited 2001
** @CN Long constants used in program.                                    122444
N                                                                         122444
CHG                                                                       122444
Y                                                                         122444
9                                                                         122444
9999                                                                      122444
1                                                                         122444
Y2U0005                                                                   122444
Y2U0003                                                                   122444
?                                                                         122444
2                                                                         122444
3                                                                         122444
4                                                                         122444
5                                                                         122444
6                                                                         122444
7                                                                         122444
8                                                                         122444
ADD                                                                       122444
I                                                                         122444
SDREPCPD                                                                  122444
SDACRCPD                                                                  122444
A                                                                         122444
Y2U0004                                                                   122444
B                                                                         122444
