     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SD Edit Midas modules')
      *****************************************************************
      *                                                               *
      *  Midas - Standing Data Module                                 *
      *                                                               *
      *  SD9004X - Midas SD Edit Midas modules                        *
      *                                                               *
      *  Function:  This program allows the user to enquire from a    *
      *             list of Midas modules                             *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD061008           Date 31Dec21               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD003             Date 01Jul99               *
      *                 S01459             Date 01Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01117             Date 20FEB90               *
      *                                                               *
      *-------------------------------------------------------------- *
      *                                                               *
      *  MD061008 - Deliverable Data Split for SDFCTLPA and GPFCTLPA  *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSD003 - Synon Closedown Project (SD):                       *
      *           - Program removed from SD model.                    *
      *  S01459 - Addition of Midas Headerbox.                        *
      *  S01117 - Release 10 Changes                                  *
      *                                                               *
      *****************************************************************
     F*SDFCTLL0UF  E           K        DISK                           UC                   MD061008
     F**********                                    KCOMIT                                  MD061008
     F**********                                    KINFDS ID0001                           MD061008
     F**********                                    KINFSR *PSSR                            MD061008
      * UPD : Midas SD Standing data controls update
      *
     E* Description     : Copyright notice for inclusion in all programs
     E*
     E********************************************************************
     E                    CPY@    1   1 80               Copyright array
     I*
     I* Description     : Copyright notice for inclusion in all programs
     I*
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
     IA@CPY       DS
     I* Copyright array
     I                                        1  80 CPY@
      * Outward parameters
     IPARC        DS                             10
      * KEY : Midas SD Midas module flags retrieval
      * I : RST Modules
     I                                        1  10 PAMODS
      *
      * Outward parameters
     IPBRC        DS                             10
      * KEY : Midas SD Midas module flags retrieval
      * I : RST Modules
     I                                        1  10 PBMODS
      *
      * Outward parameters
     IPCRC        DS                             10
      * KEY : Midas SD Midas module flags retrieval
      * I : RST Modules
     I                                        1  10 PCMODS
      *
      * Outward parameters
     IPDRC        DS                             10
      * KEY : Midas SD Midas module flags retrieval
      * I : RST Modules
     I                                        1  10 PDMODS
      *
      * Outward parameters
     IPERC        DS                             10
      * KEY : Midas SD Midas module flags retrieval
      * I : RST Modules
     I                                        1  10 PEMODS
      *
     I*QSDFC1***E DSSDFCTLL0                                                                MD061008
     IQSDFC1      DS                                                                        MD061008
     I                                        1  10 AHFLNM                                  MD061008
     I                                    P  11  130AHNORC                                  MD061008
     I                                    P  14  160AHNOIN                                  MD061008
     I                                    P  17  190AHNOAM                                  MD061008
     I                                    P  20  220AHNODL                                  MD061008
      *                                                                                     MD061008
      * UPD : Midas SD Standing data controls update
     IYARDCS      DS                             22
     IID0001      DS                            528
      * File information data structure
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * O :  *Return code
     I                                        1   7 P1RTN
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1RTN     PARM P1RTN     WP0001  7        *Return code
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Edit Midas Modules
      * SD9004X PRECOMPILER - MIDAS Modules  *
      * Copyright Statement 1988 - Standard Functions  * Copyright
     C                     MOVEL'PGM01'   WUWRTC           Work Return cod
      * DO WHILE: WRK.Work Return code is Normal
     C           WUWRTC    DOWEQ'PGM01'                    *DO
     C           WUWRTC    OREQ 'PGM04'
     C           WUWRTC    OREQ 'PGM02'
     C           WUWRTC    OREQ 'PGM03'
      * CASE: WRK.Work Return code is First Program
     C           WUWRTC    IFEQ 'PGM01'                    *IF
      * Edit Treasury/Cap Mkt/Inv - MIDAS Modules  *
     C                     CLEARPARC
     C                     MOVEL'MMOD'    PAMODS           Modules
      *
     C                     CALL 'SD9004R'              90  Edit Treasury/C
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: MIDAS Modu
     C           WUWRTC    PARM WUWRTC    WQ0001  5        Work Return cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD9004R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * CASE: WRK.Work Return code is Second Program
     C           WUWRTC    IFEQ 'PGM02'                    *IF
      * Edit Banking/lending - MIDAS Modules  *
     C                     CLEARPBRC
     C                     MOVEL'MMOD'    PBMODS           Modules
      *
     C                     CALL 'SD9001R'              90  Edit Banking/le
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PBRC             KEY: MIDAS Modu
     C           WUWRTC    PARM WUWRTC    WQ0002  5        Work Return cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD9001R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * CASE: WRK.Work Return code is Third Program
     C           WUWRTC    IFEQ 'PGM03'                    *IF
      * Edit payments/networking - MIDAS Modules  *
     C                     CLEARPCRC
     C                     MOVEL'MMOD'    PCMODS           Modules
      *
     C                     CALL 'SD9003R'              90  Edit payments/n
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PCRC             KEY: MIDAS Modu
     C           WUWRTC    PARM WUWRTC    WQ0003  5        Work Return cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD9003R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * CASE: WRK.Work Return code is Fourth Program
     C           WUWRTC    IFEQ 'PGM04'                    *IF
      * Edit management/opctl - MIDAS Modules  *
     C                     CLEARPDRC
     C                     MOVEL'MMOD'    PDMODS           Modules
      *
     C                     CALL 'SD9002R'              90  Edit management
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PDRC             KEY: MIDAS Modu
     C           WUWRTC    PARM WUWRTC    WQ0004  5        Work Return cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD9002R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * Start of SAR S01117
      * CASE: WRK.Work Return code is Fifth Program
     C           WUWRTC    IFEQ 'PGM05'                    *IF
      * Maintain MB indicator - MIDAS Modules  *
     C                     CLEARPERC
     C                     MOVEL'MMOD'    PEMODS           Modules
      *
     C                     CALL 'SD9009R'              90  Maintain MB ind
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PERC             KEY: MIDAS Modu
     C           WUWRTC    PARM WUWRTC    WQ0005  5        Work Return cod
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD9009R' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *FI
      * End of SAR S01117
      * CASE: WRK.Work Return code is normal termination
     C           WUWRTC    IFEQ 'FIN'                      *IF
     C                     Z-ADD*ZERO     WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD1         WUNOAM           No. of Amends
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SACHRC
     C                     COMIT
     C                     ELSE
      * CASE: *OTHERWISE
     C                     ROLBK
     C                     MOVEL'**CMD**' P1RTN            *Return code
     C                     END                             *FI
     C                     END                             *ITR
      *----------------------------------------------------------------
      * Exit program
     C           AAEXIT    TAG
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YARDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDMMODPD'AHFLNM           Filename
      *
     C           KLCHSA    KLIST
     C                     KFLD           AHFLNM           Filename
     C********** KLCHSA    CHAIN@AHREAU              9091  *                                MD061008
     C                     CALL 'SD000119'                                                  MD061008
     C                     PARM '*RTV'    ZMODE   4                                         MD061008
     C                     PARM           AHFLNM 10                                         MD061008
     C                     PARM 0         AHNORC  50                                        MD061008
     C                     PARM 0         AHNOIN  50                                        MD061008
     C                     PARM 0         AHNOAM  50                                        MD061008
     C                     PARM 0         AHNODL  50                                        MD061008
     C                     PARM *BLANKS   ZRETRN 10                                         MD061008
      *                                                                                     MD061008
     C                     SETOF                     9091                                   MD061008
     C           ZRETRN    IFEQ '*NRF'                                                      MD061008
     C                     SETON                     90                                     MD061008
     C                     ENDIF                                                            MD061008
     C           ZRETRN    IFEQ '*ERROR'                                                    MD061008
     C                     SETON                     91                                     MD061008
     C                     ENDIF                                                            MD061008
      *                                                                                     MD061008
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SAEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YARDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YARDCS
     C                     MOVE 'Y'       YARDC
     C                     END
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C**********           UPDAT@AHREAU                91  *                                MD061008
     C                     CALL 'SD000119'                                                  MD061008
     C                     PARM '*UPD'    ZMODE                                             MD061008
     C                     PARM           AHFLNM                                            MD061008
     C                     PARM           AHNORC                                            MD061008
     C                     PARM           AHNOIN                                            MD061008
     C                     PARM           AHNOAM                                            MD061008
     C                     PARM           AHNODL                                            MD061008
     C                     PARM *BLANKS   ZRETRN                                            MD061008
      *                                                                                     MD061008
     C                     SETOF                     91                                     MD061008
     C           ZRETRN    IFNE *BLANKS                                                     MD061008
     C                     SETON                     91                                     MD061008
     C                     ENDIF                                                            MD061008
      *                                                                                     MD061008
     C                     ELSE
      * Release record lock
     C**********           UNLCKSDFCTLL0               91  *                                MD061008
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * ROLLBACK any uncommitted DBF changes
     C                     ROLBK                       90
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
      * Set century digit (If YY prior to 1940 treat as 20YY)
     C           ##JYY     IFLT 40
     C                     Z-ADD1         ##JCC
     C                     ELSE
     C                     Z-ADD0         ##JCC
     C                     END
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Work Return code
     C                     MOVEL*BLANK    WUWRTC  5
      * Define work field No. of Records
     C                     Z-ADD*ZERO     WUNORC  50
      * Define work field No. of Inserts
     C                     Z-ADD*ZERO     WUNOIN  50
      * Define work field No. of Amends
     C                     Z-ADD*ZERO     WUNOAM  50
      * Define work field No. of Deletes
     C                     Z-ADD*ZERO     WUNODL  50
      * Open files
      * Begin commit control
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C**********           OPEN SDFCTLL0                                                    MD061008
     C                     MOVEL'N'       W0PMT   1
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT
     CSR         *PSSR     BEGSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
      *
      * Core function specific processing.
      *
     C/COPY WNCPYSRC,SD9004XPSC
      *
      * Start of PSSR user point.
      *
     C/COPY WNCPYSRC,SD9004XPS1
      *
      * Standard Midas PSSR processing.
      *
     C/COPY SDCPYSRC,SDPSSRBCH
      *
      * End of PSSR user point.
      *
     C/COPY WNCPYSRC,SD9004XPS2
      *
      *================================================================
     CSR                   ENDSR
      *================================================================
** CPY@     : Copyright notice for inclusion in all programs
(c) Finastra International Limited 2001
