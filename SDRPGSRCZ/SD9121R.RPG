     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SD Dealing ICD maintenance')                     *
      *****************************************************************
      *                                                               *
      *  Midas - Standing Data Module                                 *
      *                                                               *
      *  SD9121R - Dealing ICD Maintenance                            *
      *                                                               *
      *  Function:  This program maintains the dealing ICD record     *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. AR996162           Date 20Nov12               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG14249           Date 07Jul07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL048             Date 26Jun06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL013             Date 09Jun06               *
      *                 CER001             Date 25Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6198            Date 04Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 BUG5590            Date 25Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS005             Date 16Dec02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAS001             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CTI002             Date 23Sep98               *
      *                 CSD003             Date 27OCT97               *
      *                 CDL004             Date 08JUL97               *
      *                 CDL002             Date 17JAN97               *
      *                 CPM004             Date 27FEB96               *
      *                 S01408             DATE 22JAN96               *
      *                 CCM002             DATE 10AUG95               *
      *                 S01460             DATE 23NOV93               *
      *                 S01459             DATE 23NOV93               *
      *                 S01434             DATE 07OCT93               *
      *                 S01443             DATE 07OCT93               *
      *                 S01440             DATE 07OCT93               *
      *                 054653             DATE 04MAY93               *
      *                 S01403             DATE 10NOV92               *
      *                 S01339             DATE 20JUL92               *
      *                 E24517             DATE 18SEP91               *
      *                 S01319             DATE 02AUG91               *
      *                 LN1104             DATE 24JAN91               *
      *                 LN0947             DATE 24JAN91               *
      *                 LN0662             DATE 24JAN91               *
      *                 LN0255             DATE 15Jun90               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  AR996162 - Floating input field (#1HKTR) is displayed even   *
      *             CDL013 is switched on. Change DSPATR for #1HKTR   *
      *             field. Recompiled due to changes in SD9121R#.     *
      *             (Child: AR996164)                                 *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  BUG14249 - Internal Contract Customer Number Error           *
      *  CDL048 - IAS - Forward Revaluation Processing                *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL013 - Tiered Withholding Tax                              *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
      *  CSD025 - Customer De-Activation                              *
      *  BUG5590- Overlapping fields and text in lines 14 & 15        *
      *           (Recompile)                                         *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
      *  CDL006 - Dealing Fiduciary.                                  *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
      *  CSD003 - Synon Closedown Project (SD):                       *
      *           - Program removed from SD model.                    *
      *  CDL004 - FX Netting:                                         *
      *           - 'Netting by Single Branch' field should only      *
      *             appear if CDL004 is present.                      *
      *  CDL002 - FX Netting:                                         *
      *            Addition of 'Net FX Customer Limits',              *
      *            'Manual Matching Required' & 'Netting by Single    *
      *            Branch' indicators & Netting Account Code field.   *
      *  CPM004 - PM Bank Portfolios.                                 *
      *           SDBOOKL1 amended - regenerate & recompile.          *
      *  S01408 - Addition of hook SD9121RCP1.                        *
      *  CCM002 - City Dealer Phases 5/6:                             *
      *           - Addition of 'Citydealer Trans. Delay' field.      *
      *  S01460 - 'Hong Kong Tax Rate' text is switchable.            *
      *  S01459 - Addition of headerbox and PSSR processing.          *
      *  S01434 - Added new field "Number of Working Days Before      *
      *           Maturity Date".                                     *
      *  S01443 - Added new field "Loans/Deposits Interest Rate       *
      *           Tolerance Percentage".                              *
      *  S01440 - Added new field "Accruals on Interest Outrights".   *
      *  054653 - "Neg. Assets Interest Accrual" has been changed     *
      *           to "Neg. Assets Interest Split".                    *
      *  S01403 - Addition of two new fields, 'Book Code optional'    *
      *           and 'Default Book Code' to SDDEALPD                 *
      *  S01339 - Program runs from MITEM, Remove F12 from screen     *
      *  E24517 - UPDATE STANDING DATA FILE CONTROLS                  *
      *  S01319 - RATIONALISE DRS/MIDAS INTERFACE -                   *
      *           7 FIELDS ADDED TO SDDEALPD                          *
      *  LN1104 - RECOMPILE DUE TO CHANGE IN SDCUSTPD                 *
      *  LN0947 - REGENERATE DUE TO CHANGE IN SDACODPD                *
      *  LN0662 - REGENERATE DUE TO CHANGE IN SDCURRPD                *
      *  LN0255 - Standardise ICD Headers and Footers                 *
      *                                                               *
      *****************************************************************
     F*
     F*  S01212  - 14SEP89 - LOCAL RETURNS /COPY INCORPORATION            S01212
     F*
     F/COPY WNCPYSRC,SD9121RFPG
     FSD9121R#CF  E                    WORKSTN                        UC
     F                                              KINFDS INFDS#
     F                                              KINFSR *PSSR
      * DSP: Midas SD Dealing ICD maintenance
      *
     FSDDEALL1IF  E           K        DISK                           UC
     F                                              KINFDS INFDS1
     F                                              KINFSR *PSSR
      * RTV : Midas SD Dealing ICD data retrieval
      *
     FSDACODL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0001
     F                                              KINFSR *PSSR
      * RTV : Midas SD Account codes retrieval
      *
     FSDCURRL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0002
     F                                              KINFSR *PSSR
      * RTV : Midas SD Currency codes retrieval
      *
     FSDCUSTL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0003
     F                                              KINFSR *PSSR
      * RTV : Midas SD Customer details retrieval
      *
     FSDBOOKL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0004
     F                                              KINFSR *PSSR
      * RTV : Midas¦SD Book details retrieval
      *
     FSDMMODL1IF  E           K        DISK                           UC
     F                                              KINFDS ID0005
     F                                              KINFSR *PSSR
      * RTV : Midas SD Midas module flags retrieval
      *
     FSDDEALL0UF  E           K        DISK                           UC
     F                                              KCOMIT
     F                                              KINFDS ID0006
     F                                              KINFSR *PSSR
     F/COPY WNCPYSRC,SD9121RF01
      * UPD : Midas SD Dealing ICD data update
      *
     FSDFCTLL0UF  E           K        DISK                           UC
     F                                              KCOMIT
     F                                              KINFDS ID0007
     F                                              KINFSR *PSSR
      * UPD : Midas SD Standing data controls update
      *
     E* Description     : Copyright notice for inclusion in all programs
     E*
     E********************************************************************
     E                    CPY@    1   1 80               Copyright array
     E/COPY WNCPYSRC,SD9121REPG
     I*
     I* Description     : Copyright notice for inclusion in all programs
     I*
     I****/COPY QWINDSRC,GWE1DTA                                          S01229
     I/COPY QWINDSRC,SD9120GDTA                                           S01229
     I/COPY WNCPYSRC,SD9121RIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     ILDA         DS                            256                       CDL006
      ** Local data area for database error details                       CDL006
      *                                                                   CDL006
     I                                      134 183 DBLOT                 CDL006
     I                                      134 141 DBFILE                CDL006
     I                                      142 170 DBKEY                 CDL006
     I                                      171 180 DBPGM                 CDL006
     I                                      181 1830DBASE                 CDL006
     IDSSDY     E DSDSSDY                                                 CDL006
      ** Second DS for access programs, Long Date Structure               CDL006
      *                                                                   CDL006
     ISCSARD    E DSSCSARDPD                                              CDL006
      **  External data structures for Switchable Features Details        CDL006
      *                                                                   CDL006
     IJBDTTM      DS
      * Job date/time
     I                                        1   70##JDT
     I                                        1   10##JCC
     I                                        2   30##JYY
     I                                        4   50##JMM
     I                                        6   70##JDD
     I                                        8  130##JTM
     I                                        8   90##JHH
     I                                       10  110##JNN
     I                                       12  130##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSSDDEALL0
      * UPD : Midas SD Dealing ICD data update
      * Current/previous master file format fields for change control
      *
     I***#1DBRC**    DS                            100                    CDL006
     I**********#1DBRC      DS                            111                          CDL006 CAS001
     I***#1DBRC*      DS                            121                                CAS001 CAS005
     I***#1DBRC*     DS                            129                                 CAS005 CGL029
     I#1DBRC      DS                           9999                                           CGL029
      * Stored master file format fields
     I                                        1   1 #1DB1
      *
     I***YARDCS**    DS                            100                    CDL006
     I**********YARDCS      DS                            111                          CDL006 CAS001
     I***YARDCS*     DS                            121                                 CAS001 CAS005
     I***YARDCS      DS                            129                                 CAS005 CGL029
     IYARDCS      DS                           9999                                           CGL029
     IQSDFC1    E DSSDFCTLL0
      * UPD : Midas SD Standing data controls update
     IYBRDCS      DS                             22
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNB
     I                                       11  11 SUC
     I                                       12  12 DFF
     I                                       13  13 MBIN
     IA@CPY       DS
     I* Copyright array
     I                                        1  80 CPY@
     IID0001      DS                            528
      * File information data structure
      *
     IID0002      DS                            528
      * File information data structure
      *
     IID0003      DS                            528
      * File information data structure
      *
     IID0004      DS                            528
      * File information data structure
      *
     IID0005      DS                            528
      * File information data structure
      *
     IID0006      DS                            528
      * File information data structure
      *
     IID0007      DS                            528
      * File information data structure
      *
      /EJECT
      * Parameter declarations
     IP1PARM      DS                             10
      * KEY: Midas SD Dealing ICD data retrieval
      * I : RST Dealing Data
     I                                        1  10 P1DLDA
     IP2PARM      DS
      * O :  *Return code
     I                                        1   7 P2RTN
     IP3PARM      DS
      * B :  Work Return code
     I                                        1   5 P3WRTC
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Hong Kong Tax Rate'
      * Message data for 'Withholding Tax Rate'
      * Message data for 'Curr Code mustnt be blank'
      * Currency Code
     I                                        1   3 ZA0001
      * Message data for 'Thousand Separator invali'
      * Thousand Separator
     I                                        1   1 ZA0002
      * Message data for 'decimal separator invalid'
      * Decimal Separator
     I                                        1   1 ZA0003
      * Message data for 'Thou. = Decimal separator'
      * Thousand Separator
     I                                        1   1 ZA0004
      * Decimal Separator
     I                                        2   2 ZA0005
      * Message data for 'Internal Contracts CNUM'
      * Customer Number
     I                                        1   6 ZA0006
      * Message data for 'Accr on int outright reqd'
      * Accruals on int outrights
     I                                        1   1 ZA0007
      * Message data for 'Accr on int outright inv'
      * Accruals on int outrights
     I                                        1   1 ZA0008
      * Message data for 'No. days before mat reqd'
      * No of work day B/mat scrn
     I                                        1   2 ZA0009
      * Message data for 'No. days before mat numer'
      * No of work day B/mat scrn
     I                                        1   2 ZA0010
      * Message data for 'No. days before mat inv'
      * No of work day B/mat scrn
     I                                        1   2 ZA0011
      * Message data for 'Loan/dep int. rate reqd'
      * Loan/depsts int rate scrn
     I                                        1   4 ZA0012
      * Message data for 'Loan/dep int. rate numeri'
      * Loan/depsts int rate scrn
     I                                        1   4 ZA0013
      * Message data for 'Trans Delay blank'
      * Delay Period for Tran SCR
     I                                        1   3 ZA0014
      * Message data for 'Trans Delay value invalid'
      * Delay Period for Tran SCR
     I                                        1   3 ZA0015
      * Message data for 'Trans Delay value invalid'
      * Delay Period for Tran SCR
     I                                        1   3 ZA0016
      * Message data for 'Net FX Customr Limits INV'
      * Net FX Customer Limits
     I                                        1   1 ZA0017
      * Message data for 'Net Man. Matching Req INV'
      * Net Manual Matching Reqd
     I                                        1   1 ZA0018
      * Message data for 'Netting A/c cd-non Title'
      * Netting Account Code
     I**********                              1   4 ZA0019                                    CGL029
     I                                        1  10 ZA0019                                    CGL029
      * Message data for 'Netting A/c Code      INV'
      * Netting Account Code
     I**********                              1   4 ZA0020                                    CGL029
     I                                        1  10 ZA0020                                    CGL029
      * Message data for 'Netting by Single BrchINV'
      * Netting by Single Branch
     I                                        1   1 ZA0021
      * Message data for 'Account code mustn't be t'
      * Interbranch Branch A/c
     I**********                              1   4 ZA0022                                    CGL029
     I                                        1  10 ZA0022                                    CGL029
      * Message data for 'Account code mustn't be t'
      * Interbranch Branch A/c
     I**********                              1   4 ZA0023                                    CGL029
     I                                        1  10 ZA0023                                    CGL029
      * Message data for 'dealing data a/c codes'
      * Account Code
     I**********                              1   4 ZA0024                                    CGL029
     I                                        1  10 ZA0024                                    CGL029
      * Forward Reval. P&L A/c Cd
     I**********                              5   8 ZA0025                                    CGL029
     I                                        1  10 ZA0025                                    CGL029
      * Message data for 'Account code mustn't be t'
      * Interbranch Branch A/c
     I**********                              1   4 ZA0026                                    CGL029
     I                                        1  10 ZA0026                                    CGL029
      * Message data for 'Account code mustn't be t'
      * Interbranch Branch A/c
     I**********                              1   4 ZA0027                                    CGL029
     I                                        1  10 ZA0027                                    CGL029
      * Message data for 'Account code mustn't be t'
      * Interbranch Branch A/c
     I**********                              1   4 ZA0028                                    CGL029
     I                                        1  10 ZA0028                                    CGL029
      * Message data for 'Account code mustn't be t'
      * Interbranch Branch A/c
     I**********                              1   4 ZA0029                                    CGL029
     I                                        1  10 ZA0029                                    CGL029
      * Message data for 'maturity confs elapsed'
      * Maturity Confs. Elapsed
     I                                    P   1   20ZA0030
      * Message data for 'maturity confs to go'
      * Maturity Confs to Go
     I                                    P   1   20ZA0031
      * Message data for 'FX Auth reqd not Y or N'
      * FX Authorisation Required
     I                                        1   1 ZA0032
      * Message data for 'MM auth regd not Y or N'
      * MM Authorisation Required
     I                                        1   1 ZA0033
      * Message data for 'FX Reauth amended invalid'
      * FX Reauth Amended deals
     I                                        1   1 ZA0034
      * Message data for 'MM reauth amended invalid'
      * MM Reauth Amended deals
     I                                        1   1 ZA0035
      * Message data for 'Book Cde must be entered'
      * Book Code
     I                                        1   2 ZA0036
      * Message data for 'Book Code must be blank'
      * Book Code
     I                                        1   2 ZA0037
      * Message data for 'Book Cde Optional invalid'
      * Book Code Optional
     I                                        1   1 ZA0038
      * Message data for 'Database Error (ICD)'
      * Filename
     I                                        1  10 ZA0039
      * Message data for 'Commission Taken'                               CDL006
     I                                        1   1 ZA0040                CDL006
      * Message data for 'Charge Taken'                                   CDL006
     I                                        1   1 ZA0041                CDL006
      * Message data for 'Charge on Principal Charges'                    CDL006
     I                                        1   1 ZA0042                CDL006
      * Message data for 'Commission Table in base ccy'                   CDL006
     I                                        1   1 ZA0043                CDL006
      * Message data for 'Accrue Commission'                              CDL006
     I                                        1   1 ZA0044                CDL006
      * Message data for 'Maturity days to go for AO'                     CDL006
     I                                        1   1 ZA0045                CDL006
      * Message data for 'Deal number range placing'                      CDL006
     I                                        1   1 ZA0046                CDL006
      * Message data for 'Deal number range taking'                       CDL006
     I                                        1   1 ZA0047                CDL006
      * Message data for 'No. of Days to Call Maturity'                                       CAS001
     I                                        1   1 ZA0048                                    CAS001
      * Message data for 'Book Code on P/L Account Keys'                                      CAS001
     I                                        1   1 ZA0049                                    CAS001
      *                                                                                       CAS005
      ** Message data for 'Account code not found' and                                        CAS005
      ** must be non-title' for #1FRLA                                                        CAS005
      *                                                                                       CAS005
     I                                        1   4 ZA0050                                    CAS005
      *                                                                                       CAS005
      ** Message data for 'Account code not found' and                                        CAS005
      ** must be non-title' for #1LCAC                                                        CAS005
      *                                                                                       CAS005
     I                                        1   4 ZA0051                                    CAS005
     IDATALX      DS                           1024                                           CER001
      *                                                                                       CER001
     I                                        1  10 #1B1CD                                    CER001
     I                                        1  10 #1DLD2                                    CER001
     I                                       11  20 #0TRAD                                    CER001
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Dealing Da
     C           P2RTN     PARM P2RTN     WP0001  7        *Return code
     C           P3WRTC    PARM P3WRTC    WP0002  5        Work Return cod
     C                     MOVE 'N'       F12FLG                                              CER001
      *****************************************************************
      * Initialize
     C                     EXSR ZZINIT
      *
      * Display and process key screen
     C                     EXSR BADSKY
      * Terminate program
     C                     EXSR ZXEXPG
      *****************************************************************
      /EJECT
     CSR         BADSKY    BEGSR
      *================================================================
      * Display and process key screen
      *================================================================
      * Initialize key screen
     C                     EXSR MDIZ#K
      * Bypass first display of key screen is possible
     C                     MOVEL'Y'       W0BYP   1
      * Signal start of transaction
     C                     MOVEL'Y'       W0TRN   1
     C           W0TRN     DOWEQ'Y'
     C           W0TRN     OREQ 'K'
      * Ensure transaction continues (if reset)
     C                     MOVEL'Y'       W0TRN   1
      * Conduct screen conversation
     C           W0TRN     DOWEQ'Y'
      * Is bypass key screen still viable?
     C           W0BYP     IFEQ 'Y'
     C           #1DLDA    IFEQ *BLANK                     Dealing Data
      * One or more key fields is blank
     C           *IN05     OREQ '1'
      * HOME: Reset screen fields
     C                     MOVEL'N'       W0BYP
     C                     END
     C                     END
      * Bypass key screen
     C           W0BYP     IFNE 'Y'
      * Display key screen
     C                     EXSR BBEXFM
     C                     END
      * Cancel key screen bypass
     C                     MOVEL'N'       W0BYP
      * Process response to key screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Reset screen fields
     C   05                CAS            BDHMKY
      * Process key screen input
     C                     CAS            BEPRKY
     C                     END
     C           W0TRN     DOWEQ'R'
     C                     MOVEL'Y'       W0TRN
     C                     EXSR BEPRKY
     C                     END
      *
     C                     END
     C                     END
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBEXFM    BEGSR
      *================================================================
      * Display key screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GADSAK
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                         86*
     C           *IN89     IFNE BBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     BBIN89  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y0SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDKEY
      * Test cursor
     C                     EXSR Y8TST
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         BDHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                     MOVEL'N'       W0TRN
      *================================================================
     CSR         BDEXIT    ENDSR
      /EJECT
     CSR         BEPRKY    BEGSR
      *================================================================
      * Process key screen input
      *================================================================
      * Initialise detail screen
     C                     EXSR MAIZ#1
      * Validate key fields
     C                     EXSR BFVLKY
     C           *IN99     CABEQ'1'       BEEXIT
      * Check for existing record
     C           KRTV      KLIST
     C                     KFLD           BNDLDA           Dealing Data
      * Setup key
     C                     MOVEL#1DLDA    BNDLDA           Dealing Data
     C           KRTV      CHAIN@BNREEI              9091  *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     SETON                     99    *
     C                     GOTO BEEXIT
     C                     END                             FI 91
      *
      * If record does not exist, error
     C           *IN90     IFEQ '1'
     C                     SETON                     99    *
      * Send message 'Dealing Data           NF'
     C                     MOVEL'USR0205' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C/COPY WNCPYSRC,SD9121RC01
     C                     EXSR MBFL#1
      * CALC: Detail screen function fields
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RSFF - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RSFF
     C                     END                             *FI
      * USER: Initialize detail screen (existing record)
      * Start of S01434
      * If switchable feature S01434 is present.
      * CASE: WRK.SAR S01434 is Present
     C           WUEROP    IFEQ 'Y'                        *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVELBNNWDM    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0001  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0002 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0003  10       ZALIGN No Of De
     C                     PARM 2         WQ0004  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0005 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0006 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0007  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * ZALIGN No. day before mat - Dealing Data  *
     C                     MOVE WUZASF    #DNWDS
     C                     END                             *FI
      * End of S01434
      * Start of S01460
      * 'Hong Kong Tax Rate' text is switchable.
      * CASE: WRK.SAR S01460 is Not present
     C           WUSAFD    IFEQ 'N'                        *IF
      * Setup message data for message
      * Retrieve message Hong Kong Tax Rate
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'USR2205' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           #DTXRT    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
      * Retrieve message Withholding Tax Rate
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'USR2204' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           #DTXRT    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     END                             *FI
      * End of S01460
      * Start of S01443
      * Move Loans Tol to ZALIGN - Dealing Data  *
     C                     MOVE BNLDIT    WUZASF
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0008 16        ZALIGN Screen F
     C                     PARM 1         WQ0009  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * ZALIGN Loan/Dep Int Rate - Dealing Data  *
     C                     MOVE WUZASF    #DLDIS
      * End of S01443
      * Start of CCM002
      * Move Trans Delay to Scrn - Dealing Data  *
     C                     MOVE BNDLYP    WUZASF
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0010 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0011  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * ZALIGN Transmission Delay - Dealing Data  *
     C                     MOVE WUZASF    #DDPTS
      * End of CCM002
      * Start CDL002
      * Net FX Customer Limits
      * CASE: DTL.Net FX Customer Limits is blank
     C           #1NTCE    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1NTCE           Net FX Customer
     C                     END                             *FI
      * Net Manual Matching Required
      * CASE: DTL.Net Manual Matching Reqd is blank
     C           #1NMAM    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1NMAM           Net Manual Matc
     C                     END                             *FI
      * Netting by Single Branch
      * CASE: DTL.Netting by Single Branch is Blank
     C           #1NESB    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1NESB           Netting by Sing
     C                     END                             *FI
      * End CDL002
     C                     MOVEL'Y'       WUMFTS           S01212
      * /COPY.
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RISE - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RISE
     C                     END                             *FI
     C                     END
      *
      *..................................................
     C   99                GOTO BEEXIT
      * No error: Display and process details
     C                     EXSR CADSDA
      *
      *================================================================
     CSR         BEEXIT    ENDSR
      /EJECT
     CSR         BFVLKY    BEGSR
      *================================================================
      * Validate key fields
      *================================================================
      * USER: Validate key screen
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RVKS - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RVKS
     C                     END                             *FI
      *================================================================
     CSR         BFEXIT    ENDSR
      /EJECT
     CSR         CADSDA    BEGSR
      *================================================================
      * Display and process detail screen
      *================================================================
      * Conduct detail screen conversation
      * - repeat until screen control flag is reset:
     C           W0TRN     DOWEQ'Y'
      * Display detail screen
     C                     EXSR CBEXFM
      * Process response to detail screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Redisplay previous screen
     C   12                CAS            CCDSPV
      * HOME: Reset screen fields
     C   05                CAS            CCDSPV
      * Process detail screen input
     C                     CAS            CFPRSC
     C                     END
     C           W0TRN     IFEQ 'R'
     C           W0PMD     IFEQ 'ADD'
     C                     EXSR MAIZ#1
     C                     END
     C                     END
      *
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         CBEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSAD
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
      *                                                                                       CAS005
      ** Save values of indicator 27 and 28 to work variables                                 CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVE *IN27     WIN27   1                                           CAS005
     C                     MOVE *IN28     WIN28   1                                           CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                         86*
     C           *IN89     IFNE CBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     CBIN89  1
      * Set cursor by *SET CURSOR data
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y1SET
     C                     END
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT2
      *                                                                                       CAS005
      ** If CAS005 is installed, use display fields #1FRP1 and #1ACC1                         CAS005
      ** instead of #1FRPL and #1ACCD respectively. Also, turn on                             CAS005
      ** indicator 26 to indicate that enhancement CAS005 is available.                       CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVEL#1FRPL    #1FRP1                                              CAS005
     C                     MOVEL#1ACCD    #1ACC1                                              CAS005
     C                     MOVE *ON       *IN26                                               CAS005
     C                     MOVE WIN27     *IN27                                               CAS005
     C                     MOVE WIN28     *IN28                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           F12FLG    IFEQ 'N'                                                           CER001
     C                     EXFMT#RCDDTL1
     C                     ENDIF                                                              CER001
      *                                                                                       CAS005
      ** If CAS005 is installed, move #1FRP1 and #1ACC1 to their                              CAS005
      ** original fields for processing                                                       CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVEL#1FRP1    #1FRPL                                              CAS005
     C                     MOVEL#1ACC1    #1ACCD                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      * Test cursor
     C                     EXSR Y8TST
      * Clear set cursor DDS indicator
     C           WCSRLC    IFEQ 'OFF'
     C                     SETOF                     94    *
     C                     END
     C                     MOVE *BLANK    WCSRLC
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
     C           YSETCS    IFEQ 'Y'
     C                     EXSR Y9CLR
     C                     END
      *================================================================
     CSR         CBEXIT    ENDSR
      /EJECT
     CSR         CCDSPV    BEGSR
      *================================================================
      * Redisplay previous screen
      *================================================================
      * USER: Process key screen request
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RPKR - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RPKR
     C                     END                             *FI
      * Bypass KEY screen , if F12 is pressed on detail screen
     C                     MOVEL*BLANK    P3WRTC           Work Return cod
     C                     MOVEL'PREV'    P3WRTC           Work Return cod
     C                     MOVEL'PREV'    P0RTN            *Return code
     C                     EXSR ZYEXPG
     C   05                MOVEL'R'       W0TRN
     C   12                MOVEL'K'       W0TRN
      *================================================================
     CSR         CCEXIT    ENDSR
      /EJECT
     CSR         CFPRSC    BEGSR
      *================================================================
      * Validate record
      *================================================================
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate details
     C                     EXSR DCVLDL
      * QUIT if error:
     C   99                GOTO CFEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       CFEXIT
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     EXSR CGFSDA                                    CDL006
      *                                                                   CDL006
      ** Defer confirm/update requested                                   CDL006
     C           W0DCF     IFEQ 'Y'                                       CDL006
     C                     GOTO CFEXIT                                    CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      * No error: update record
     C                     EXSR EBPR##
      *================================================================
     CSR         CFEXIT    ENDSR
      /EJECT                                                              CDL006
      *================================================================   CDL006
      * Display and process Fiduciary Screen                              CDL006
      *================================================================   CDL006
      *                                                                   CDL006
     C           CGFSDA    BEGSR                                          CDL006
      *                                                                   CDL006
     C                     MOVE 'Y'       W1TRN   1                       CDL006
      *                                                                   CDL006
      ** Rewrite Header                                                   CDL006
      *                                                                   CDL006
     C           W0BYP     IFEQ 'Y'                                       CDL006
     C                     EXSR BBEXFM                                    CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C           W1TRN     DOWEQ'Y'                                       CDL006
     C                     EXSR CHEXFM                                    CDL006
      *                                                                   CDL006
      ** Process response to fiduciary screen.                            CDL006
      *                                                                   CDL006
      ** Exit if CMD/F3 was pressed.                                      CDL006
      *                                                                   CDL006
     C           *IN03     IFEQ '1'                                       CDL006
     C                     EXSR ZXEXPG                                    CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Restore Fiduciary fields if CMD12/F12 was pressed.               CDL006
      *                                                                   CDL006
     C           *IN12     IFEQ '1'                                       CDL006
     C                     MOVE 'Y'       W0DCF                           CDL006
     C                     MOVE BNCOTK    S1COTK                          CDL006
     C                     MOVE BNCHTK    S1CHTK                          CDL006
     C                     MOVE BNCHPC    S1CHPC                          CDL006
     C                     MOVE BNCTBC    S1CTBC                          CDL006
     C                     MOVE BNACCO    S1ACCO                          CDL006
     C                     Z-ADDBNMDAO    S1MDAO                          CDL006
     C                     MOVELBNDNRP    S1DNRP                          CDL006
     C                     MOVELBNDNRT    S1DNRT                          CDL006
     C                     GOTO CGEXIT                                    CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Enter key was pressed, validate input to fiduciary               CDL006
      ** fields.                                                          CDL006
      *                                                                   CDL006
     C                     EXSR DGFVLD                                    CDL006
      *                                                                   CDL006
      ** If error found on validation; do not leave the screen            CDL006
      ** appropriate error messages will be sent. Otherwise flag          CDL006
      ** for successful validation.                                       CDL006
      *                                                                   CDL006
     C           W0ERR     IFEQ 'Y'                                       CDL006
     C                     MOVE 'Y'       W1TRN                           CDL006
     C                     ELSE                                           CDL006
     C                     MOVE 'N'       W1TRN                           CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
     C                     ENDDO                                          CDL006
      *                                                                   CDL006
     C           CGEXIT    ENDSR                                          CDL006
      /EJECT                                                              CDL006
      *================================================================   CDL006
      * Display and accept input for Fiduciary                            CDL006
      *================================================================   CDL006
      *                                                                   CDL006
     C           CHEXFM    BEGSR                                          CDL006
      *                                                                   CDL006
      ** Reset all error field indicators if first pass coming            CDL006
      ** from the first screen.                                           CDL006
      *                                                                   CDL006
     C                     MOVE *IN25     HELP25  1                       CDL006
     C                     MOVE *ALL'0'   ##OFF  30                       CDL006
     C                     MOVEA##OFF     *IN,1                           CDL006
     C                     MOVE HELP25    *IN25                           CDL006
      *                                                                   CDL006
      ** Allow putover                                                    CDL006
      *                                                                   CDL006
     C                     MOVE '1'       *IN86                           CDL006
      *                                                                   CDL006
      ** Write fiduciary detail screen and accept                         CDL006
      ** for user input.                                                  CDL006
      *                                                                   CDL006
     C                     WRITE#MSGCTL                                   CDL006
     C                     WRITE#CMDTXT3                                  CDL006
     C                     EXFMT#RCDDTL2                                  CDL006
     C                     MOVE 'N'       F12FLG                                              CER001
      *                                                                   CDL006
      ** Update screen time                                               CDL006
      *                                                                   CDL006
     C                     TIME           ##TME                           CDL006
      *                                                                   CDL006
      ** Clear messages from program message queue.                       CDL006
      *                                                                   CDL006
     C                     CALL 'Y2CLMSC'                                 CDL006
     C                     PARM ##PGM     ZAPGMQ                          CDL006
     C                     PARM '*SAME'   ZAPGRL                          CDL006
      *                                                                   CDL006
     C                     ENDSR                                          CDL006
      /EJECT                                                              CDL006
      *================================================================   CDL006
      * Validation of Fiduciary Fields                                    CDL006
      *================================================================   CDL006
      *                                                                   CDL006
     C           DGFVLD    BEGSR                                          CDL006
      *                                                                   CDL006
     C                     MOVE 'N'       W0ERR   1                       CDL006
      *                                                                   CDL006
      ** Entry for Commission taken field is blank.                       CDL006
      *                                                                   CDL006
     C           S1COTK    IFEQ *BLANK                                    CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1COTK    ZA0040                          CDL006
      *                                                                   CDL006
      ** Send message 'Comm. Taken field should be Y/N'.                  CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8650' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9965                 CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Otherwise entry is non blank, either 'Y' or 'N'.                 CDL006
      *                                                                   CDL006
     C           S1COTK    IFEQ 'Y'                                       CDL006
     C           S1COTK    OREQ 'N'                                       CDL006
     C                     MOVE '0'       *IN65                           CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1COTK    ZA0040                          CDL006
      *                                                                   CDL006
      ** Send message 'Comm. Taken field should be Y/N'.                  CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8650' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9965                 CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Entry for Charge taken field is blank.                           CDL006
      *                                                                   CDL006
     C           S1CHTK    IFEQ *BLANK                                    CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1CHTK    ZA0041                          CDL006
      *                                                                   CDL006
      ** Send message 'Charge taken field should be Y/N'.                 CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8651' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9966                 CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Otherwise entry is non blank, either 'Y' or 'N'.                 CDL006
      *                                                                   CDL006
     C           S1CHTK    IFEQ 'Y'                                       CDL006
     C           S1CHTK    OREQ 'N'                                       CDL006
     C                     MOVE '0'       *IN66                           CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1CHTK    ZA0041                          CDL006
      *                                                                   CDL006
      ** Send message 'Charge Taken field should be Y/N'.                 CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8651' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9966                 CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Entry for Charge on Principal Changes field is blank.            CDL006
      *                                                                   CDL006
     C           S1CHPC    IFEQ *BLANK                                    CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1CHPC    ZA0042                          CDL006
      *                                                                   CDL006
      ** Send message 'Charge on Princ. Changes should be Y/N'.           CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8652' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9967                 CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Otherwise entry is non blank, either 'Y' or 'N'.                 CDL006
      *                                                                   CDL006
     C           S1CHPC    IFEQ 'Y'                                       CDL006
     C           S1CHPC    OREQ 'N'                                       CDL006
     C                     MOVE '0'       *IN67                           CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1CHPC    ZA0042                          CDL006
      *                                                                   CDL006
      ** Send message 'Charge Taken field should be Y/N'.                 CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8652' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9967                 CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Entry for Commission Tables for base currency field is           CDL006
      ** blank.                                                           CDL006
      *                                                                   CDL006
     C           S1CTBC    IFEQ *BLANK                                    CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1CTBC    ZA0043                          CDL006
      *                                                                   CDL006
      ** Send message 'Comm. Table in base ccy should be Y/N'.            CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8653' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9968                 CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Otherwise entry is non blank, either 'Y' or 'N'.                 CDL006
      *                                                                   CDL006
     C           S1CTBC    IFEQ 'Y'                                       CDL006
     C           S1CTBC    OREQ 'N'                                       CDL006
     C                     MOVE '0'       *IN68                           CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1CTBC    ZA0043                          CDL006
      *                                                                   CDL006
      ** Send message 'Comm. Table in base ccy should be Y/N'.            CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8653' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9968                 CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Entry for Accrue Commission field is blank.                      CDL006
      *                                                                   CDL006
     C           S1ACCO    IFEQ *BLANK                                    CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1ACCO    ZA0044                          CDL006
      *                                                                   CDL006
      ** Send message 'Accrue Commission should be Y/N'.                  CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8654' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9969                 CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Otherwise entry is non blank, either 'Y' or 'N'.                 CDL006
      *                                                                   CDL006
     C           S1ACCO    IFEQ 'Y'                                       CDL006
     C           S1ACCO    OREQ 'N'                                       CDL006
     C                     MOVE '0'       *IN69                           CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1ACCO    ZA0044                          CDL006
      *                                                                   CDL006
      ** Send message 'Accrue commission should be Y/N'.                  CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8654' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9969                 CDL006
     C                     ENDIF                                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Entry for Maturity Days to go for Account Officer is             CDL006
      ** blank of zero.                                                   CDL006
      *                                                                   CDL006
     C           S1MDAO    IFEQ *ZEROS                                    CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1MDAO    ZA0045                          CDL006
      *                                                                   CDL006
      ** Send message 'Maturity Days to go for AO should be               CDL006
      ** from 01 to 99'.                                                  CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8655' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9970                 CDL006
     C                     ELSE                                           CDL006
     C                     MOVE '0'       *IN70                           CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Entry for Deal Number Range Placing field                        CDL006
      ** is not blank. It must be a valid numeric.                        CDL006
      *                                                                   CDL006
     C           S1DNRP    IFNE *BLANK                                    CDL006
     C                     TESTN          S1DNRP     74                   CDL006
     C           *IN74     IFEQ '0'                                       CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1DNRP    ZA0046                          CDL006
      *                                                                   CDL006
      ** Send message 'Deal number range placing must be a valid          CDL006
      ** two digit number'.                                               CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8656' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9971                 CDL006
     C                     ELSE                                           CDL006
     C                     MOVE '0'       *IN71                           CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Entry for Deal Number Range taking field                         CDL006
      ** is not blank. It must be a valid numeric.                        CDL006
      *                                                                   CDL006
     C           S1DNRT    IFNE *BLANK                                    CDL006
     C                     TESTN          S1DNRT     74                   CDL006
     C           *IN74     IFEQ '0'                                       CDL006
      *                                                                   CDL006
      ** Setup message data for message.                                  CDL006
      *                                                                   CDL006
     C                     MOVELS1DNRT    ZA0047                          CDL006
      *                                                                   CDL006
      ** Send message 'Deal number range taking must be a valid           CDL006
      ** two digit number'.                                               CDL006
      *                                                                   CDL006
     C                     MOVEL'USR8657' ZAMSID                          CDL006
     C                     EXSR ZASNMS                                    CDL006
     C                     MOVE 'Y'       W0ERR                           CDL006
     C                     SETON                     9972                 CDL006
     C                     ELSE                                           CDL006
     C                     MOVE '0'       *IN72                           CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDSR                                          CDL006
      /EJECT
     CSR         DCVLDL    BEGSR
      *================================================================
      * Validate details
      *================================================================
      * Validate Thousand Separator
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1THSP    W0NSRQ  1        Thousand Separa
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1163297   Y2LSNO  70
     C           #1THSP    PARM #1THSP    W0EXVL 20        Thousand Separa
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Decimal Separator
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1DCSP    W0NSRQ  1        Decimal Separat
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1163299   Y2LSNO  70
     C           #1DCSP    PARM #1DCSP    W0EXVL 20        Decimal Separat
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Check Customer Number is numeric
     C                     MOVEL*IN90     XG90    1
     C**********           TESTN          #1CUST     90  90*                                  CSD027
     C***90*****           MOVE #1CUST    XGX1    1                                           CSD027
     C***90*****           TESTB'0123'    XGX1           90*                                  CSD027
      * All blank is OK
     C**N90***** #1CUST    COMP *BLANKS                  90*                                  CSD027
     C********** #1CUST    COMP *BLANKS                  90*                         CSD027 BUG14249
      * '?' is OK                                                                           BUG14249
     C**N90*****           MOVEL#1CUST    XGX1                                              BUG14249
     C**N90***** XGX1      COMP '?'                      90*                                BUG14249
     C********** *IN90     IFEQ '0'                                                         BUG14249
      * Send message '*Field must be numeric'                                               BUG14249
     C*********            MOVEL'Y2U0010' ZAMSID                                            BUG14249
     C*********            MOVEL'Y2USRMSG'ZAMSGF                                            BUG14249
     C*********            EXSR ZASNMS                                                      BUG14249
     C*********            SETON                     9939  *                                BUG14249
     C*********            END                                                              BUG14249
     C                     MOVELXG90      *IN90
      * Validate Book Code Optional
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1BCOP    W0NSRQ  1        Book Code Optio
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1167758   Y2LSNO  70
     C           #1BCOP    PARM #1BCOP    W0EXVL 20        Book Code Optio
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Accruals on int outrights
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1AOIO    W0NSRQ  1        Accruals on int
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1173719   Y2LSNO  70
     C           #1AOIO    PARM #1AOIO    W0EXVL 20        Accruals on int
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Net FX Customer Limits
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1NTCE    W0NSRQ  1        Net FX Customer
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1206670   Y2LSNO  70
     C           #1NTCE    PARM #1NTCE    W0EXVL 20        Net FX Customer
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Net Manual Matching Reqd
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1NMAM    W0NSRQ  1        Net Manual Matc
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1206674   Y2LSNO  70
     C           #1NMAM    PARM #1NMAM    W0EXVL 20        Net Manual Matc
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Netting by Single Branch
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1NESB    W0NSRQ  1        Netting by Sing
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1209186   Y2LSNO  70
     C           #1NESB    PARM #1NESB    W0EXVL 20        Netting by Sing
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Check Account Code is numeric
     C                     MOVEL*IN90     XG90    1
     C/COPY WNCPYSRC,SD9121RC02
     C                     TESTN          #1ACCD     90  90*
     C   90                MOVE #1ACCD    XGX1    1
     C/COPY WNCPYSRC,SD9121RC03
     C   90                TESTB'0123'    XGX1           90*
      * All blank is OK
     C/COPY WNCPYSRC,SD9121RC04
     C  N90      #1ACCD    COMP *BLANKS                  90*
      * '?' is OK
     C  N90                MOVEL#1ACCD    XGX1
     C/COPY WNCPYSRC,SD9121RC56
     C  N90      XGX1      COMP '?'                      90*
     C/COPY WNCPYSRC,SD9121RC05
     C           *IN90     IFEQ '0'
      * Send message '*Field must be numeric'
     C                     MOVEL'Y2U0010' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     SETON                     9951  *
     C                     END
     C                     MOVELXG90      *IN90
      *                                                                                       CAS005
      ** Test if #1LCAC is numeric is CAS005 is installed                                     CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     EXSR SRCHNO                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C/COPY WNCPYSRC,SD9121RC06
      * Validate Maturity Confs. Rqd Ind.
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1MCRI    W0NSRQ  1        Maturity Confs.
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1105834   Y2LSNO  70
     C           #1MCRI    PARM #1MCRI    W0EXVL 20        Maturity Confs.
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Neg. Assets Int. Acc. Ind
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1NAIA    W0NSRQ  1        Neg. Assets Int
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1105837   Y2LSNO  70
     C           #1NAIA    PARM #1NAIA    W0EXVL 20        Neg. Assets Int
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate Fwd Reval of Dep Int. Ind
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1FRDI    W0NSRQ  1        Fwd Reval of De
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1105841   Y2LSNO  70
     C           #1FRDI    PARM #1FRDI    W0EXVL 20        Fwd Reval of De
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate FX Authorisation Required
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1FXAU    W0NSRQ  1        FX Authorisatio
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1163301   Y2LSNO  70
     C           #1FXAU    PARM #1FXAU    W0EXVL 20        FX Authorisatio
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate MM Authorisation Required
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1MMAU    W0NSRQ  1        MM Authorisatio
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1163303   Y2LSNO  70
     C           #1MMAU    PARM #1MMAU    W0EXVL 20        MM Authorisatio
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate FX Reauth Amended deals
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1FXRA    W0NSRQ  1        FX Reauth Amend
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1163304   Y2LSNO  70
     C           #1FXRA    PARM #1FXRA    W0EXVL 20        FX Reauth Amend
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * Validate MM Reauth Amended deals
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1MMRA    W0NSRQ  1        MM Reauth Amend
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'Y2VLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1163306   Y2LSNO  70
     C           #1MMRA    PARM #1MMRA    W0EXVL 20        MM Reauth Amend
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *
      * USER: Validate detail screen fields
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RVSF - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RVSF
     C                     END                             *FI
      * Check relations
      * Check reference to Account Codes
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9951  *
     C                     END
      * Check reference to Account Codes
     C                     EXSR VBCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9950  *
     C                     END
      *                                                                                       CAS005
      ** If enhancement CAS005 is installed                                                   CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
      *                                                                                       CAS005
      ** Check reference to Account Codes for #1FRPA                                          CAS005
      *                                                                                       CAS005
     C                     EXSR SRFRLA                                                        CAS005
     C           W0RTN     IFNE *BLANK                                                        CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     MOVE *ON       *IN27                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Check reference to Account Codes for #1LCAC                                          CAS005
      *                                                                                       CAS005
     C                     EXSR SRLCAC                                                        CAS005
     C           W0RTN     IFNE *BLANK                                                        CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     MOVE *ON       *IN28                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      * Check reference to Account Codes
     C                     EXSR VCCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9953  *
     C                     END
      * Check reference to Account Codes
     C                     EXSR VDCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9952  *
     C                     END
      * Check reference to Account Codes
     C                     EXSR VECKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9954  *
     C                     END
      * Check reference to Account Codes
     C                     EXSR VFCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9955  *
     C                     END
      * Check reference to Currency Codes
     C                     EXSR VGCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
      * Check reference to Client Details
     C                     EXSR VHCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9939  *
     C                     END
      * Check reference to Currency Codes
     C                     EXSR VICKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9932  *
     C                     END
      * Check reference to Book Details
     C                     EXSR VJCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9941  *
     C                     END
      * Check reference to Account Codes
     C                     EXSR VKCKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9948  *
     C                     END
      * CALC: Detail screen function fields
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RSFF - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RSFF
     C                     END                             *FI
      * USER: Validate detail screen relations
      * begin S01319
      * Validate additional fields on SDDEALPD
      * Base Currency for Dealing
      * CASE: DTL.Base Currency for Dealing is blank
     C           #1CYDL    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1CYDL    ZA0001           Base Currency f
      * Send message 'Curr Code mustnt be blank'
     C                     MOVEL'USR4207' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     END                             *FI
      * Thousand Separator and Decimal Separator
      * CASE: DTL.Thousand Separator is valid values
     C           #1THSP    IFEQ ','                        *IF
     C           #1THSP    OREQ '.'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1THSP    ZA0002           Thousand Separa
      * Send message 'Thousand Separator invali'
     C                     MOVEL'USR1764' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     END                             *FI
      * CASE: DTL.Decimal Separator is valid values
     C           #1DCSP    IFEQ ','                        *IF
     C           #1DCSP    OREQ '.'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1DCSP    ZA0003           Decimal Separat
      * Send message 'decimal separator invalid'
     C                     MOVEL'USR1773' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     END                             *FI
      * Thousand Separator and Decimal Separator
      * CASE: DTL.Thousand Separator is valid values
     C           #1THSP    IFEQ ','                        *IF
     C           #1THSP    OREQ '.'
      * CASE: DTL.Decimal Separator is valid values
     C           #1DCSP    IFEQ ','                        *IF
     C           #1DCSP    OREQ '.'
      * CASE: DTL.Thousand Separator EQ DTL.Decimal Separator
     C           #1THSP    IFEQ #1DCSP                     *IF
      * Setup message data for message
     C                     MOVEL#1THSP    ZA0004           Thousand Separa
     C                     MOVEL#1DCSP    ZA0005           Decimal Separat
      * Send message 'Thou. = Decimal separator'
     C                     MOVEL'USR1765' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993436*
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     END                             *FI
      * end S01319
      * Internal Contracts Customer Number
      * CASE: WRK.Internal Contracts is Yes
     C           WUINCN    IFEQ 'Y'                        *IF
      * CASE: DTL.Customer Number is Blank
     C           #1CUST    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1CUST    ZA0006           Customer Number
      * Send message 'Internal Contracts CNUM'
     C                     MOVEL'USR0324' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Start of S01440
      * Accruals on Interest Outrights
      * CASE: DTL.Accruals on int outrights is Blank
     C           #1AOIO    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1AOIO    ZA0007           Accruals on int
      * Send message 'Accr on int outright reqd'
     C                     MOVEL'USR2122' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: DTL.Accruals on int outrights is Valid values
     C           #1AOIO    IFEQ 'N'                        *IF
     C           #1AOIO    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1AOIO    ZA0008           Accruals on int
      * Send message 'Accr on int outright inv'
     C                     MOVEL'USR2123' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * End of S01440
      * Start of S01434
      * Number of Working Days Before Maturity Date
      * CASE: WRK.SAR S01434 is Present
     C           WUEROP    IFEQ 'Y'                        *IF
      * CASE: DTL.No of work day B/mat scrn is Blank
     C           #DNWDS    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DNWDS    ZA0009           No of work day
      * Send message 'No. days before mat reqd'
     C                     MOVEL'USR2124' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DNWDS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0023  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0024 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0025  10       ZALIGN No Of De
     C                     PARM 2         WQ0026  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0027 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0028 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0029  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * Check return code.
      * CASE: WRK.Err Code is Error Found
     C           WUERCD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DNWDS    ZA0010           No of work day
      * Send message 'No. days before mat numer'
     C                     MOVEL'USR2126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * ZALIGN No. day before mat - Dealing Data  *
     C                     MOVE WUZASF    #DNWDS
     C                     MOVE WUZAFF    #1NWDM           No of working d
      * Check for valid range.
      * CASE: DTL.No of working days B/ mat is Valid range
     C           #1NWDM    IFGE 01                         *IF
     C           #1NWDM    ANDLE99
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#DNWDS    ZA0011           No of work day
      * Send message 'No. days before mat inv'
     C                     MOVEL'USR2125' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * End of S01434
      * Start of S01443
      * Loan/Deposit Interest Rate Tolerance
      * CASE: DTL.Loan/depsts int rate scrn is Blank
     C           #DLDIS    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DLDIS    ZA0012           Loan/depsts int
      * Send message 'Loan/dep int. rate reqd'
     C                     MOVEL'USR2127' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DLDIS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0030  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0031 16        ZALIGN Screen F
     C                     PARM 1         WQ0032  10       ZALIGN No Of De
     C                     PARM 2         WQ0033  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0034 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0035 16        ZALIGN Screen F
     C                     PARM 1         WQ0036  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * CASE: WRK.Err Code is Error Found
     C           WUERCD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DLDIS    ZA0013           Loan/depsts int
      * Send message 'Loan/dep int. rate numeri'
     C                     MOVEL'USR2128' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * ZALIGN Loan/Dep Int Rate - Dealing Data  *
     C                     MOVE WUZASF    #DLDIS
     C                     MOVE WUZAFF    #1LDIT           Loans/depsts in
     C                     END                             *FI
     C                     END                             *FI
      * End of S01443
      * Start of CCM002
      * Transmission Delay
      * CASE: WRK.CCM002 Feature Present is CCM002 Present
     C           WUCYD5    IFEQ 'Y'                        *IF
      * Validate Transmission Delay field.
      * CASE: DTL.Delay Period for Tran SCR is Blank
     C           #DDPTS    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DDPTS    ZA0014           Delay Period fo
      * Send message 'Trans Delay blank'
     C                     MOVEL'USR2848' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9945  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DDPTS    WUZASF           ZALIGN Screen F
      * Call ZALIGN & ZEDIT
      * ZALIGN Screen Field - Standard Functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0037  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0038 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0039  10       ZALIGN No Of De
     C                     PARM 3         WQ0040  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0041 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZALIGN'  W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Old Table Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
     C                     MOVEL'Y'       WUERCD           Err Code
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUERCD           Err Code
      * ZEDIT Screen Field - Standard Functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0042 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0043  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'ZEDIT'   W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
     C                     END                             *FI
      * Check return code
      * CASE: WRK.Err Code is Error Found
     C           WUERCD    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#DDPTS    ZA0015           Delay Period fo
      * Send message 'Trans Delay value invalid'
     C                     MOVEL'USR2849' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9945  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * ZALIGN Transmission Delay - Dealing Data  *
     C                     MOVE WUZASF    #DDPTS
     C                     MOVE WUZAFF    #1DLYP           Delay Period fo
      * Check that Transmission Delay is a valid value.
      * CASE: DTL.Delay Period for Trans is Valid Range
     C           #1DLYP    IFGE 1                          *IF
     C           #1DLYP    ANDLE999
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#DDPTS    ZA0016           Delay Period fo
      * Send message 'Trans Delay value invalid'
     C                     MOVEL'USR2849' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9945  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * End of CCM002
      * Start CDL002
      * Net FX Customer Limits
      * CASE: WRK.FX Netting switched on is Yes
     C           WUY9ST    IFEQ 'Y'                        *IF
      * CASE: DTL.Net FX Customer Exposure is Valid Values
     C           #1NTCE    IFEQ 'N'                        *IF
     C           #1NTCE    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1NTCE    ZA0017           Net FX Customer
      * Send message 'Net FX Customr Limits INV'
     C                     MOVEL'USR3148' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9946  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Net Manual Matching Required
      * CASE: WRK.FX Netting switched on is Yes
     C           WUY9ST    IFEQ 'Y'                        *IF
      * CASE: DTL.Net Manual Matching Reqd is Valid Values
     C           #1NMAM    IFEQ 'N'                        *IF
     C           #1NMAM    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1NMAM    ZA0018           Net Manual Matc
      * Send message 'Net Man. Matching Req INV'
     C                     MOVEL'USR3149' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9947  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Netting Account Code
      * CASE: WRK.FX Netting switched on is Yes
     C           WUY9ST    IFEQ 'Y'                        *IF
      * CASE: DTL.Netting account code Acco is Non-blank
     C           #1NEAC    IFNE *BLANK                     *IF
      * retrieve type as well - Account Codes  *
     C                     EXSR SARVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#1NEAC    ZA0019           Netting Account
      * Send message 'Netting A/c cd-non Title'
     C                     MOVEL'USR3243' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9948  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1NEAC    ZA0020           Netting Account
      * Send message 'Netting A/c Code      INV'
     C                     MOVEL'USR3242' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9948  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Netting by Single Branch.
      * CASE: WRK.Disp Netting by Sing Brch is Display
     C           WUDNSB    IFEQ 'Y'                        *IF
      * CASE: DTL.Netting by Single Branch is Valid Values
     C           #1NESB    IFEQ 'N'                        *IF
     C           #1NESB    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1NESB    ZA0021           Netting by Sing
      * Send message 'Netting by Single BrchINV'
     C                     MOVEL'USR3241' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9949  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * End CDL002
     C/COPY WNCPYSRC,SD9121RC07
      * Fwd Reval A/c Code
      * CASE: DTL.Forward Reval. P&L A/c Cd is Non-blank
     C           #1FRPL    IFNE *BLANK                     *IF
     C/COPY WNCPYSRC,SD9121RC08
      * retrieve type as well - Account Codes  *
     C                     EXSR SBRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C/COPY WNCPYSRC,SD9121RC09
     C                     MOVEL#1FRPL    ZA0022           Forward Reval.
     C/COPY WNCPYSRC,SD9121RC10
      * Send message 'Account code mustn't be t'
     C                     MOVEL'USR0221' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9950  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C/COPY WNCPYSRC,SD9121RC11
      * Fwd Reval contra A/c Code
      * CASE: DTL.Account Code is Non-blank
     C           #1ACCD    IFNE *BLANK                     *IF
     C/COPY WNCPYSRC,SD9121RC12
      * retrieve type as well - Account Codes  *
     C                     EXSR SCRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C/COPY WNCPYSRC,SD9121RC13
     C                     MOVEL#1ACCD    ZA0023           Account Code
     C/COPY WNCPYSRC,SD9121RC14
      * Send message 'Account code mustn't be t'
     C                     MOVEL'USR0221' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9951  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *                                                                                       CAS005
      ** If CAS005 is installed and Loss A/C code is not                                      CAS005
      ** blank, retrieve Account Code as well                                                 CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVEL#1FRLA    WQSTN1  1                                           CAS005
     C                     MOVEL#1LCAC    WQSTN2  1                                           CAS005
      *                                                                                       CAS005
      ** If Loss Account Code is entered                                                      CAS005
      *                                                                                       CAS005
     C           #1FRLA    IFNE *BLANK                                                        CAS005
     C           WQSTN1    ANDNE'?'                                                           CAS005
     C           #1FRLA    CHAIN@A5REA6              90                                       CAS005
      *                                                                                       CAS005
      ** If account code is not found in the account codes file                               CAS005
      *                                                                                       CAS005
     C                     MOVE *OFF      *IN27                                               CAS005
     C           *IN90     IFEQ *ON                                                           CAS005
     C                     MOVEL#1FRLA    ZA0050                                              CAS005
     C                     MOVEL'USR0069' ZAMSID                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     MOVE *ON       *IN27                                               CAS005
     C                     MOVE *ON       *IN99                                               CAS005
      *                                                                                       CAS005
      ** Else if found but Wrk Title Only Ind. is 'Y'                                         CAS005
      *                                                                                       CAS005
     C                     ELSE                                                               CAS005
     C           A5TOIN    IFEQ 'Y'                                                           CAS005
     C           WQSTN1    ANDNE'?'                                                           CAS005
     C                     MOVELA5ACTY    WUACTY                                              CAS005
     C                     MOVEL#1FRLA    ZA0050                                              CAS005
     C                     MOVEL'USR0221' ZAMSID                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     MOVE *ON       *IN27                                               CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** If Loss Contra Account Code is entered                                               CAS005
      *                                                                                       CAS005
     C           #1LCAC    IFNE *BLANK                                                        CAS005
     C           WQSTN2    ANDNE'?'                                                           CAS005
     C           #1LCAC    CHAIN@A5REA6              90                                       CAS005
      *                                                                                       CAS005
      ** If account code is not found in the account codes file                               CAS005
      *                                                                                       CAS005
     C                     MOVE *OFF      *IN28                                               CAS005
     C           *IN90     IFEQ *ON                                                           CAS005
     C                     MOVEL#1LCAC    ZA0051                                              CAS005
     C                     MOVEL'USR0069' ZAMSID                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     MOVE *ON       *IN28                                               CAS005
     C                     MOVE *ON       *IN99                                               CAS005
      *                                                                                       CAS005
      ** Else if found but Wrk Title Only Ind. is 'Y'                                         CAS005
      *                                                                                       CAS005
     C                     ELSE                                                               CAS005
     C           A5TOIN    IFEQ 'Y'                                                           CAS005
     C           WQSTN2    ANDNE'?'                                                           CAS005
     C                     MOVELA5ACTY    WUACTY                                              CAS005
     C                     MOVEL#1LCAC    ZA0051                                              CAS005
     C                     MOVEL'USR0221' ZAMSID                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     MOVE *ON       *IN28                                               CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      * Fwd Reval A/c Code & Contra must differ
      * CASE: DTL.Account Code EQ DTL.Forward Reval. P&L A/c Cd
     C/COPY WNCPYSRC,SD9121RC15
     C           #1ACCD    IFEQ #1FRPL                     *IF
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0024           Account Code
     C                     MOVEL#1FRPL    ZA0025           Forward Reval.
     C/COPY WNCPYSRC,SD9121RC16
      * Send message 'dealing data a/c codes'
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVEL'USR0357' ZAMSID                                              CAS005
     C                     ELSE                                                               CAS005
     C                     MOVEL'USR0329' ZAMSID
     C                     ENDIF                                                              CAS005
     C                     EXSR ZASNMS
     C                     SETON                     995150*
      *
     C                     END                             *FI
      *                                                                                       CAS005
      ** Forward reval loss A/C code and loss contra A/C code must differ                     CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           #1FRLA    ANDEQ#1LCAC                                                        CAS005
     C                     MOVEL'USR0347' ZAMSID                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     MOVE *ON       *IN27                                               CAS005
     C                     MOVE *ON       *IN28                                               CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C/COPY WNCPYSRC,SD9121RC17
      * Swap Trade A/c code
      * CASE: DTL.Swap Trade Account Code A is Non-blank
     C           #1SWTA    IFNE *BLANK                     *IF
      * retrieve type as well - Account Codes  *
     C                     EXSR SDRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#1SWTA    ZA0026           Swap Trade Acco
      * Send message 'Account code mustn't be t'
     C                     MOVEL'USR0221' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9952  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Fwd Trade A/c Code
      * CASE: DTL.Forward Trade Accnt Code is Non-blank
     C           #1FTAC    IFNE *BLANK                     *IF
      * retrieve type as well - Account Codes  *
     C                     EXSR SERVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#1FTAC    ZA0027           Forward Trade A
      * Send message 'Account code mustn't be t'
     C                     MOVEL'USR0221' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9953  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Trade A/c 4
      * CASE: DTL.Trade Account Code No. 4 is Non-blank
     C           #1BTCD    IFNE *BLANK                     *IF
      * retrieve type as well - Account Codes  *
     C                     EXSR SFRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#1BTCD    ZA0028           Trade Account C
      * Send message 'Account code mustn't be t'
     C                     MOVEL'USR0221' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9954  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Trade A/c code 5
      * CASE: DTL.Trade Account Code No. 5 is Non-blank
     C           #1BUCD    IFNE *BLANK                     *IF
      * retrieve type as well - Account Codes  *
     C                     EXSR SGRVGN
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
      * CASE: WRK.Title Only Indicator is YES
     C           WUTOIN    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#1BUCD    ZA0029           Trade Account C
      * Send message 'Account code mustn't be t'
     C                     MOVEL'USR0221' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9955  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Maturity Confirmations Elapsed/to go
      * CASE: DTL.Maturity Confs. Rqd Ind. is Yes
     C           #1MCRI    IFEQ 'Y'                        *IF
      * CASE: DTL.Maturity Confs. Elapsed is zero
     C           #1MCEL    IFEQ *ZERO                      *IF
      * Setup message data for message
     C                     Z-ADD#1MCEL    ZA0030           Maturity Confs.
      * Send message 'maturity confs elapsed'
     C                     MOVEL'USR0244' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9957  *
      *
     C                     END                             *FI
      * CASE: DTL.Maturity Confs to Go is zero
     C           #1MCTG    IFEQ *ZERO                      *IF
      * Setup message data for message
     C                     Z-ADD#1MCTG    ZA0031           Maturity Confs
      * Send message 'maturity confs to go'
     C                     MOVEL'USR0245' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9958  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * start S01319
      * validate new fields
      * FX Authorisation required
      * CASE: DTL.FX Authorisation Required is valid values
     C           #1FXAU    IFEQ 'N'                        *IF
     C           #1FXAU    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1FXAU    ZA0032           FX Authorisatio
      * Send message 'FX Auth reqd not Y or N'
     C                     MOVEL'USR1766' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9961  *
      *
     C                     END                             *FI
      * MM Authorisation Required
      * CASE: DTL.MM Authorisation Required is valid values
     C           #1MMAU    IFEQ 'N'                        *IF
     C           #1MMAU    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1MMAU    ZA0033           MM Authorisatio
      * Send message 'MM auth regd not Y or N'
     C                     MOVEL'USR1774' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9962  *
      *
     C                     END                             *FI
      * FX Reauthorise Amended Deals
      * CASE: DTL.FX Reauth Amended deals is valid values
     C           #1FXRA    IFEQ 'N'                        *IF
     C           #1FXRA    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1FXRA    ZA0034           FX Reauth Amend
      * Send message 'FX Reauth amended invalid'
     C                     MOVEL'USR1767' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9963  *
      *
     C                     END                             *FI
      * MM Reauthorise Amended deals
      * CASE: DTL.MM Reauth Amended deals is valid values
     C           #1MMRA    IFEQ 'N'                        *IF
     C           #1MMRA    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1MMRA    ZA0035           MM Reauth Amend
      * Send message 'MM reauth amended invalid'
     C                     MOVEL'USR1775' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9964  *
      *
     C                     END                             *FI
      * end S01319
      *                                                                                       CAS001
      ** When CAS001 enhancement is installed                                                 CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C/COPY WNCPYSRC,SDH00585
      *                                                                                       CAS001
      ** Validate No. of Days to Call Maturity Date for Revals.                               CAS001
      *                                                                                       CAS001
     C           #1DCMT    IFNE *BLANKS                                                       CAS001
     C           #1DCMT    IFLT '0'                                                           CAS001
     C           #1DCMT    ORGT '999'                                                         CAS001
     C                     MOVEL#1DCMT    ZA0048                                              CAS001
     C                     MOVEL'USR9175' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN99                                               CAS001
     C                     MOVE *ON       *IN81                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE *OFF      *IN81                                               CAS001
     C                     ENDIF                                                              CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE *OFF      *IN81                                               CAS001
     C                     MOVEL'000'     #1DCMT                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Validate Book Code on Profit/Loss Account Keys                                       CAS001
      *                                                                                       CAS001
     C           #1BCPL    IFNE 'Y'                                                           CAS001
     C           #1BCPL    ANDNE'N'                                                           CAS001
     C           #1BCPL    ANDNE*BLANKS                                                       CAS001
     C                     MOVEL#1BCPL    ZA0049                                              CAS001
     C                     MOVEL'USR9176' ZAMSID                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     MOVE *ON       *IN99                                               CAS001
     C                     MOVE *ON       *IN82                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE *OFF      *IN82                                               CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C                     ENDIF                                                              CAS001
      * Start of SAR S01403
      * Validation for Default Book Code & Book Code Optional
      * CASE: DTL.Book Code Optional is Book Code to be used
     C           #1BCOP    IFEQ 'Y'                        *IF
      * Book code must be entered
      * CASE: DTL.Book Code is equal to blank
     C           #1BKCD    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1BKCD    ZA0036           Book Code
      * Send message 'Book Cde must be entered'
     C                     MOVEL'USR1859' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Book Code Ooptional is *Blanks, default to 'N'.
      * CASE: DTL.Book Code Optional is blank
     C           #1BCOP    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1BCOP           Book Code Optio
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: DTL.Book Code Optional is Book Code not to be used
     C           #1BCOP    IFEQ 'N'                        *IF
      * Book Code must not be entered
      * CASE: DTL.Book Code is Not Blank
     C           #1BKCD    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1BKCD    ZA0037           Book Code
      * Send message 'Book Code must be blank'
     C                     MOVEL'USR1860' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1BCOP    ZA0038           Book Code Optio
      * Send message 'Book Cde Optional invalid'
     C                     MOVEL'USR1858' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9940  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * End of SAR S01403
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RVSR - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RVSR
     C                     END                             *FI
      * Currency Code required
     C           #1CYCD    IFEQ *BLANK                     IF
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Base Currency for Dealing required
     C           #1CYDL    IFEQ *BLANK                     IF
     C                     SETON                     9932  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Deals Historic Retention required
     C           #1DHRT    IFEQ *ZERO                      IF
     C                     SETON                     9933  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Thousand Separator required
     C           #1THSP    IFEQ *BLANK                     IF
     C                     SETON                     9934  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Decimal Separator required
     C           #1DCSP    IFEQ *BLANK                     IF
     C                     SETON                     9936  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Exchange Rate Tolerance required
     C           #1EXRT    IFEQ *ZERO                      IF
     C                     SETON                     9937  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Forward Reval. P&L A/c Cd required
     C/COPY WNCPYSRC,SD9121RC18
     C           #1FRPL    IFEQ *BLANK                     IF
     C/COPY WNCPYSRC,SD9121RC19
     C                     SETON                     9950  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Account Code required
     C/COPY WNCPYSRC,SD9121RC20
     C           #1ACCD    IFEQ *BLANK                     IF
     C/COPY WNCPYSRC,SD9121RC21
     C                     SETON                     9951  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *                                                                                       CAS005
      ** If CAS005 is installed                                                               CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
      *                                                                                       CAS005
      ** Loss contra account code required                                                    CAS005
      *                                                                                       CAS005
     C           #1FRLA    IFEQ *BLANK                                                        CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     MOVE *ON       *IN27                                               CAS005
     C                     MOVEL'Y2U0001' ZAMSID                                              CAS005
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Forward reval loss A/C code required                                                 CAS005
      *                                                                                       CAS005
     C           #1LCAC    IFEQ *BLANK                                                        CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     MOVE *ON       *IN28                                               CAS005
     C                     MOVEL'Y2U0001' ZAMSID                                              CAS005
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C/COPY WNCPYSRC,SD9121RC22
      * Maturity Confs. Rqd Ind. required
     C           #1MCRI    IFEQ *BLANK                     IF
     C                     SETON                     9956  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Neg. Assets Int. Acc. Ind required
     C           #1NAIA    IFEQ *BLANK                     IF
     C                     SETON                     9959  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Fwd Reval of Dep Int. Ind required
     C           #1FRDI    IFEQ *BLANK                     IF
     C                     SETON                     9960  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * FX Authorisation Required required
     C           #1FXAU    IFEQ *BLANK                     IF
     C                     SETON                     9961  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * MM Authorisation Required required
     C           #1MMAU    IFEQ *BLANK                     IF
     C                     SETON                     9962  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * FX Reauth Amended deals required
     C           #1FXRA    IFEQ *BLANK                     IF
     C                     SETON                     9963  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * MM Reauth Amended deals required
     C           #1MMRA    IFEQ *BLANK                     IF
     C                     SETON                     9964  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         EBPR##    BEGSR
      *================================================================
      * Process record:
      *================================================================
      * Process update request
     C           W0PMD     CASNE'ADD'     EECHRQ
     C                     END
     C           W0RTN     IFNE *BLANK
      * Error: ROLLBACK any DBF changes
     C                     ROLBK
     C                     GOTO EBEXIT
     C                     ELSE
      * Otherwise COMMIT any DBF changes
     C                     COMIT
     C                     END
     C           W0RTN     IFEQ *BLANK
      * USER: Process command keys
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RPCK - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RPCK
     C                     END                             *FI
      * Restart program for next record
     C                     MOVEL'N'       W0TRN
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Change Dealing Data - Dealing Data  *
     C                     EXSR SHCHRC
     C           W0RTN     IFNE *BLANK
      * Data update error
      * Reset screen fields if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1
     C                     END
     C                     ELSE
      * Send message '*Record changed'
     C                     MOVEL'Y2U0012' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         GADSAK    BEGSR
      *================================================================
      * Set key screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSAD    BEGSR
      *================================================================
      * Set detail screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect key fields on detail screen
     C                     SETON                     88    *
     C                     MOVEL'0'       *IN79
     C           WUDNWM    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL'0'       *IN78
     C           WUCYD5    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL'0'       *IN77
     C           WUY9ST    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
     C                     MOVEL'0'       *IN76
     C           WUDNSB    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN76
     C                     END                             *FI
      * Enable key screen
     C                     SETON                     87    *
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise record - except for key fields and "neither" paramete
      *================================================================
     C                     Z-ADD*ZERO     #1LDIT           Loans/depsts in
     C                     Z-ADD*ZERO     #1NWDM           No of working d
     C                     Z-ADD*ZERO     #1DLYP           Delay Period fo
     C                     Z-ADD*ZERO     #1LTMD           Last Transmissi
     C                     Z-ADD*ZERO     #1LTMT           Last Transmissi
     C                     Z-ADD*ZERO     #1LCD            Last Change Dat
     C                     MOVEL*BLANK    #1TYLC           Type of Last Ch
     C                     MOVEL*BLANK    #1CYCD           Currency Code
     C                     MOVEL*BLANK    #1CYDL           Base Currency f
     C                     Z-ADD*ZERO     #1DHRT           Deals Historic
     C                     MOVEL*BLANK    #1THSP           Thousand Separa
     C                     Z-ADD*ZERO     #1MBAM           Minimum Brokera
     C                     MOVEL*BLANK    #1DCSP           Decimal Separat
     C                     Z-ADD*ZERO     #1EXRT           Exchange Rate T
     C                     MOVEL*BLANK    #DTXRT           Tax Rate : scre
     C                     Z-ADD*ZERO     #1HKTR           Hong Kong Tax R
     C                     MOVEL*BLANK    #1CUST           Customer Number
     C                     MOVEL*BLANK    #1BCOP           Book Code Optio
     C                     MOVEL*BLANK    #1BKCD           Book Code
     C                     MOVEL*BLANK    #1AOIO           Accruals on int
     C                     MOVEL*BLANK    #DNWDS           No of work day
     C                     MOVEL*BLANK    #DLDIS           Loan/depsts int
     C                     MOVEL*BLANK    #DDPTS           Delay Period fo
     C                     MOVEL*BLANK    #1NTCE           Net FX Customer
     C                     MOVEL*BLANK    #1NMAM           Net Manual Matc
     C                     MOVEL*BLANK    #1NEAC           Netting Account
     C                     MOVEL*BLANK    #1NESB           Netting by Sing
     C/COPY WNCPYSRC,SD9121RC23
     C                     MOVEL*BLANK    #1FRPL           Forward Reval.
     C                     MOVEL*BLANK    #1ACCD           Account Code
     C/COPY WNCPYSRC,SD9121RC24
     C                     MOVEL*BLANK    #1SWTA           Swap Trade Acco
     C                     MOVEL*BLANK    #1FTAC           Forward Trade A
     C                     MOVEL*BLANK    #1BTCD           Trade Account C
     C                     MOVEL*BLANK    #1BUCD           Trade Account C
     C                     MOVEL*BLANK    #1MCRI           Maturity Confs.
     C                     Z-ADD*ZERO     #1MCEL           Maturity Confs.
     C                     Z-ADD*ZERO     #1MCTG           Maturity Confs
     C                     MOVEL*BLANK    #1NAIA           Neg. Assets Int
     C                     MOVEL*BLANK    #1FRDI           Fwd Reval of De
     C                     MOVEL*BLANK    #1FXAU           FX Authorisatio
     C                     MOVEL*BLANK    #1MMAU           MM Authorisatio
     C                     MOVEL*BLANK    #1FXRA           FX Reauth Amend
     C                     MOVEL*BLANK    #1MMRA           MM Reauth Amend
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     MOVE *BLANKS   S1COTK  1                       CDL006
     C                     MOVE *BLANKS   S1CHTK  1                       CDL006
     C                     MOVE *BLANKS   S1CHPC  1                       CDL006
     C                     MOVE *BLANKS   S1CTBC  1                       CDL006
     C                     MOVE *BLANKS   S1ACCO  1                       CDL006
     C                     Z-ADD*ZEROS    S1MDAO  20                      CDL006
     C                     MOVEL*BLANKS   S1DNRP  2                       CDL006
     C                     MOVEL*BLANKS   S1DNRT  2                       CDL006
     C                     ENDIF                                          CDL006
      *                                                                                       CAS001
      ** If CAS001 enhancement is installed                                                   CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C/COPY WNCPYSRC,SDH00586
     C                     MOVEL*BLANKS   #1DCMT                                              CAS001
     C                     MOVEL*BLANKS   #1BCPL                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS005
      ** If CAS005 enhancement is installed                                                   CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVEL*BLANKS   #1FRLA                                              CAS005
     C                     MOVEL*BLANKS   #1LCAC                                              CAS005
     C                     ENDIF                                                              CAS005
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BNREEI fields to screen
      *================================================================
     C                     MOVELBNDLDA    #1DLDA           Dealing Data
     C                     Z-ADDBNLDIT    #1LDIT           Loans/depsts in
     C                     Z-ADDBNNWDM    #1NWDM           No of working d
     C                     Z-ADDBNDLYP    #1DLYP           Delay Period fo
     C                     Z-ADDBNLTMD    #1LTMD           Last Transmissi
     C                     Z-ADDBNLTMT    #1LTMT           Last Transmissi
     C                     Z-ADDBNLCD     #1LCD            Last Change Dat
     C                     MOVELBNTYLC    #1TYLC           Type of Last Ch
     C                     MOVELBNCYCD    #1CYCD           Currency Code
     C                     MOVELBNCYDL    #1CYDL           Base Currency f
     C                     Z-ADDBNDHRT    #1DHRT           Deals Historic
     C                     MOVELBNTHSP    #1THSP           Thousand Separa
     C                     Z-ADDBNMBAM    #1MBAM           Minimum Brokera
     C                     MOVELBNDCSP    #1DCSP           Decimal Separat
     C                     Z-ADDBNEXRT    #1EXRT           Exchange Rate T
     C                     Z-ADDBNHKTR    #1HKTR           Hong Kong Tax R
     C                     MOVELBNCUST    #1CUST           Customer Number
     C                     MOVELBNBCOP    #1BCOP           Book Code Optio
     C                     MOVELBNBKCD    #1BKCD           Book Code
     C                     MOVELBNAOIO    #1AOIO           Accruals on int
     C                     MOVELBNNTCE    #1NTCE           Net FX Customer
     C                     MOVELBNNMAM    #1NMAM           Net Manual Matc
     C                     MOVELBNNEAC    #1NEAC           Netting Account
     C                     MOVELBNNESB    #1NESB           Netting by Sing
     C/COPY WNCPYSRC,SD9121RC25
     C                     MOVELBNFRPL    #1FRPL           Forward Reval.
     C                     MOVELBNACCD    #1ACCD           Account Code
      *                                                                                       CAS005
      ** Additional loss account codes added for enhancement CAS005                           CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVELBNFRLA    #1FRLA                                              CAS005
     C                     MOVELBNLCAC    #1LCAC                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C/COPY WNCPYSRC,SD9121RC26
     C                     MOVELBNSWTA    #1SWTA           Swap Trade Acco
     C                     MOVELBNFTAC    #1FTAC           Forward Trade A
     C                     MOVELBNBTCD    #1BTCD           Trade Account C
     C                     MOVELBNBUCD    #1BUCD           Trade Account C
     C                     MOVELBNMCRI    #1MCRI           Maturity Confs.
     C                     Z-ADDBNMCEL    #1MCEL           Maturity Confs.
     C                     Z-ADDBNMCTG    #1MCTG           Maturity Confs
     C                     MOVELBNNAIA    #1NAIA           Neg. Assets Int
     C                     MOVELBNFRDI    #1FRDI           Fwd Reval of De
     C                     MOVELBNFXAU    #1FXAU           FX Authorisatio
     C                     MOVELBNMMAU    #1MMAU           MM Authorisatio
     C                     MOVELBNFXRA    #1FXRA           FX Reauth Amend
     C                     MOVELBNMMRA    #1MMRA           MM Reauth Amend
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     MOVE BNCOTK    S1COTK                          CDL006
     C                     MOVE BNCHTK    S1CHTK                          CDL006
     C                     MOVE BNCHPC    S1CHPC                          CDL006
     C                     MOVE BNCTBC    S1CTBC                          CDL006
     C                     MOVE BNACCO    S1ACCO                          CDL006
     C                     Z-ADDBNMDAO    S1MDAO                          CDL006
     C                     MOVELBNDNRP    S1DNRP                          CDL006
     C                     MOVELBNDNRT    S1DNRT                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                                       CAS001
      ** If CAS001 enhancement is installed                                                   CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C/COPY WNCPYSRC,SDH00587
     C                     MOVELBNDCMT    #1DCMT                                              CAS001
     C                     MOVELBNBCPL    #1BCPL                                              CAS001
     C                     ENDIF                                                              CAS001
      * Hold existing record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#K    BEGSR
      *================================================================
      * Initialize key screen
      *================================================================
     C                     MOVELP1DLDA    #1DLDA           Dealing Data
      * USER: Initialize key screen
      * 00/COPY Member SD9121RCP1 - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RCP1                                           S01408
     C                     MOVEL'TRAD'    #0TRAD    P      Trading Data                       CER001
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RIKS - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RIKS
     C                     END                             *FI
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * retrieve type as well - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVEL#1NEAC    A5ACCD           Account Code
     C           KRSSA     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     END
      *
      * USER: Exit processing
      * PAR = DB1 By name
     C                     MOVELA5ACTY    WUACTY           Account type
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * retrieve type as well - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C/COPY WNCPYSRC,SD9121RC27
     C                     MOVEL#1FRPL    A5ACCD           Account Code
     C/COPY WNCPYSRC,SD9121RC28
     C           KRSSB     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SBEXIT
     C                     END
      *
      * USER: Exit processing
      * PAR = DB1 By name
     C                     MOVELA5ACTY    WUACTY           Account type
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * retrieve type as well - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C/COPY WNCPYSRC,SD9121RC29
     C                     MOVEL#1ACCD    A5ACCD           Account Code
     C/COPY WNCPYSRC,SD9121RC30
     C           KRSSC     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SCEXIT
     C                     END
      *
      * USER: Exit processing
      * PAR = DB1 By name
     C                     MOVELA5ACTY    WUACTY           Account type
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * retrieve type as well - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVEL#1SWTA    A5ACCD           Account Code
     C           KRSSD     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SDEXIT
     C                     END
      *
      * USER: Exit processing
      * PAR = DB1 By name
     C                     MOVELA5ACTY    WUACTY           Account type
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SERVGN    BEGSR
      *================================================================
      * retrieve type as well - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSE     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVEL#1FTAC    A5ACCD           Account Code
     C           KRSSE     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SEEXIT
     C                     END
      *
      * USER: Exit processing
      * PAR = DB1 By name
     C                     MOVELA5ACTY    WUACTY           Account type
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * retrieve type as well - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVEL#1BTCD    A5ACCD           Account Code
     C           KRSSF     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SFEXIT
     C                     END
      *
      * USER: Exit processing
      * PAR = DB1 By name
     C                     MOVELA5ACTY    WUACTY           Account type
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * retrieve type as well - Account Codes  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           A5ACCD           Account Code
      * Move fields to key list
     C                     MOVEL#1BUCD    A5ACCD           Account Code
     C           KRSSG     CHAIN@A5REA6              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0069' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SGEXIT
     C                     END
      *
      * USER: Exit processing
      * PAR = DB1 By name
     C                     MOVELA5ACTY    WUACTY           Account type
     C                     MOVELA5TOIN    WUTOIN           Title Only Indi
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT
     CSR         SHCHRC    BEGSR
      *================================================================
      * Change Dealing Data - Dealing Data  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YARDC   1
     C/COPY WNCPYSRC,SD9121RC31
      *
      * Move key fields to @BNREEH
     C                     MOVEL#1DLDA    BNDLDA           Dealing Data
      *
     C           KLCHSH    KLIST
     C                     KFLD           BNDLDA           Dealing Data
     C           KLCHSH    CHAIN@BNREEH              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SHEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SHEXIT
     C                     END
     C/COPY WNCPYSRC,SD9121RC32
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Release record lock
     C                     UNLCKSDDEALL0               91  *
     C                     GOTO SHEXIT
     C                     END                             FI #1DBRC
      * Store record data for null update check
     C**********           MOVE @1DBRC    YARDCS                                              CGL029
     C                     MOVEL@1DBRC    YARDCS                                              CGL029
     C/COPY WNCPYSRC,SD9121RC33
      * USER: Processing after Data read
      * start E24517
      * save Last Change Date from record
     C                     Z-ADDBNLCD     WULCD            Last Change Dat
      * end E24517
      * Move non-key fields to @BNREEH
     C/COPY WNCPYSRC,SD9121RC34
     C                     MOVEL#1ACCD    BNACCD           Account Code
     C                     MOVEL#1FRPL    BNFRPL           Forward Reval.
      *                                                                                       CAS005
      ** Additional loss account codes added for enhancement CAS005                           CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C                     MOVEL#1FRLA    BNFRLA                                              CAS005
     C                     MOVEL#1LCAC    BNLCAC                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C/COPY WNCPYSRC,SD9121RC35
     C                     MOVEL#1FTAC    BNFTAC           Forward Trade A
     C                     MOVEL#1SWTA    BNSWTA           Swap Trade Acco
     C                     MOVEL#1BTCD    BNBTCD           Trade Account C
     C                     MOVEL#1BUCD    BNBUCD           Trade Account C
     C                     MOVEL#1CYCD    BNCYCD           Currency Code
     C                     MOVEL#1CUST    BNCUST           Customer Number
     C                     Z-ADDWURDNB    BNLCD            Last Change Dat
     C                     MOVEL'A'       BNTYLC           Type of Last Ch
     C                     MOVEL#1MCRI    BNMCRI           Maturity Confs.
     C                     MOVEL#1NAIA    BNNAIA           Neg. Assets Int
     C                     Z-ADD#1MCEL    BNMCEL           Maturity Confs.
     C                     Z-ADD#1MCTG    BNMCTG           Maturity Confs
     C                     MOVEL#1FRDI    BNFRDI           Fwd Reval of De
     C                     Z-ADD#1MBAM    BNMBAM           Minimum Brokera
     C                     Z-ADD#1DHRT    BNDHRT           Deals Historic
     C                     Z-ADD#1EXRT    BNEXRT           Exchange Rate T
     C                     Z-ADD#1HKTR    BNHKTR           Hong Kong Tax R
     C                     MOVEL#1THSP    BNTHSP           Thousand Separa
     C                     MOVEL#1DCSP    BNDCSP           Decimal Separat
     C                     MOVEL#1CYDL    BNCYDL           Base Currency f
     C                     MOVEL#1FXAU    BNFXAU           FX Authorisatio
     C                     MOVEL#1FXRA    BNFXRA           FX Reauth Amend
     C                     MOVEL#1MMAU    BNMMAU           MM Authorisatio
     C                     MOVEL#1MMRA    BNMMRA           MM Reauth Amend
     C                     MOVEL#1BKCD    BNBKCD           Book Code
     C                     MOVEL#1BCOP    BNBCOP           Book Code Optio
     C                     MOVEL#1AOIO    BNAOIO           Accruals on int
     C                     Z-ADD#1LDIT    BNLDIT           Loans/depsts in
     C                     Z-ADD#1NWDM    BNNWDM           No of working d
     C                     Z-ADD#1DLYP    BNDLYP           Delay Period fo
     C                     Z-ADD#1LTMD    BNLTMD           Last Transmissi
     C                     Z-ADD#1LTMT    BNLTMT           Last Transmissi
     C                     MOVEL#1NTCE    BNNTCE           Net FX Customer
     C                     MOVEL#1NMAM    BNNMAM           Net Manual Matc
     C                     MOVEL#1NEAC    BNNEAC           Netting Account
     C                     MOVEL#1NESB    BNNESB           Netting by Sing
     C           CDL006    IFEQ 'Y'                                       CDL006
     C                     MOVE S1COTK    BNCOTK                          CDL006
     C                     MOVE S1CHTK    BNCHTK                          CDL006
     C                     MOVE S1CHPC    BNCHPC                          CDL006
     C                     MOVE S1CTBC    BNCTBC                          CDL006
     C                     MOVE S1ACCO    BNACCO                          CDL006
     C                     Z-ADDS1MDAO    BNMDAO                          CDL006
     C                     MOVELS1DNRP    BNDNRP                          CDL006
     C                     MOVELS1DNRT    BNDNRT                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                                       CAS001
      ** If CAS001 enhancement is installed                                                   CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C/COPY WNCPYSRC,SDH00588
     C                     MOVEL#1DCMT    BNDCMT                                              CAS001
     C                     MOVEL#1BCPL    BNBCPL                                              CAS001
     C                     ENDIF                                                              CAS001
      *
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YARDCS
     C                     MOVE 'Y'       YARDC
     C                     END
     C/COPY WNCPYSRC,SD9121RC36
      *                                                                                       CER001
      ** Check if ULX004 is on                                                                CER001
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                                                           CER001
     C                     MOVEL#1DLDA    #1DLD2                                              CER001
     C                     CALL 'SD9122'                                                      CER001
     C                     PARM *BLANK    RTNCDE 10                                           CER001
     C                     PARM 'A'       UACTCD                                              CER001
     C                     PARM           DATALX                                              CER001
     C                     PARM *BLANK    W0RTN                                               CER001
      *                                                                                       CER001
      ** Exit                                                                                 CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'Y2U9999'                                                     CER001
     C                     MOVELW0RTN     P0RTN                                               CER001
     C                     EXSR ZYEXPG                                                        CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** CASE: Program Error                                                                  CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'USR0563'                                                     CER001
     C                     MOVEL'USR0563' ZAMSID                                              CER001
     C                     EXSR ZASNMS                                                        CER001
     C                     SETON                     99                                       CER001
     C                     MOVEL'Y'       W0DCF                                               CER001
     C                     GOTO SHEXIT                                                        CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** CASE: PAR. *DBF update error                                                         CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'Y2U0004'                                                     CER001
     C                     MOVEL'USR0567' ZAMSID                                              CER001
     C                     EXSR ZASNMS                                                        CER001
     C                     SETON                     99                                       CER001
     C                     MOVEL'Y'       W0DCF                                               CER001
     C                     GOTO SHEXIT                                                        CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** CASE: PAR.*Return code is *Previous Screen                                           CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'USR0790'                                                     CER001
     C                     MOVEL'Y'       F12FLG  1                                           CER001
     C                     MOVEL'Y'       W0DCF                                               CER001
     C                     GOTO SHEXIT                                                        CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      * USER: Processing before Data update
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * CASE: WRK.Window processing requir. is Yes
     C           WUWDPR    IFEQ 'Y'                        *IF
      * Start of SAR S01117
      * WM call Window Manager - Window manager  *
     C/COPY WNCPYSRC,WN0481CCP1                                           S01408
     C***********          CALL 'WIND01'                                  S01212
     C                     CALL 'WN0010'                                  S01212
     C*********************PARM           ##PGM            Program        S01212
     C                     PARM ##PGM     UPGM   10        Program        S01212
     C*********************PARM *BLANK    FKEY    2        Function Key   S01212
     C                     PARM *BLANK    UFKEY   2        Function Key   S01212
     C*********************PARM           WUMEST           Action  S01212 S01229
     C*********************PARM           WUWMAC           Action  S01212 S01229
     C                     PARM 'A'       UACTCD  1        Action  S01212 S01229
     C                     PARM           DATA             Trans Data     S01212
     C                     PARM *BLANK    W0RTN            Return Code    S01212
     C                     PARM           SPARE 256        Spare Field    LN0355
      * End of SAR S01117
      * WM Check Return
      * CASE: PAR.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     ELSE
      * CASE: PAR.*Return code is WN Window Error
     C           W0RTN     IFEQ 'USR0563'                  *IF
      * Send message 'WN Window Error'
     C                     MOVEL'USR0563' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SHEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *DBF update error
     C           W0RTN     IFEQ 'Y2U0004'                  *IF
      * Send message 'WN Database Error'
     C                     MOVEL'USR0567' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SHEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *Previous Screen
     C           W0RTN     IFEQ 'USR0790'                  *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SHEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * 00/COPY Member SD9121RBUW - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RBUW
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RBDU - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RBDU
     C                     END                             *FI
     C                     END                             *FI
      * Set PGM.*Record Data Changed flag
     C           @1DBRC    IFNE YARDCS
     C                     MOVE 'Y'       YARDC
     C                     END
     C/COPY WNCPYSRC,SD9121RC37
      * If changed update record otherwise release record
     C           YARDC     IFEQ 'Y'
     C                     UPDAT@BNREEH                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDDEALL0               91  *
     C                     END
     C/COPY WNCPYSRC,SD9121RC38
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * DBF change successful
      * USER: Processing after Data update
      * start E24517 - Update Standing Data file controls
      * CASE: WRK.Last Change Date NE WRK.Run day number
     C           WULCD     IFNE WURDNB                     *IF
      * only update file controls if not already changed today
     C                     Z-ADD*ZERO     WUNORC           No. of Records
     C                     Z-ADD*ZERO     WUNOIN           No. of Inserts
     C                     Z-ADD*ZERO     WUNODL           No. of Deletes
     C                     Z-ADD1         WUNOAM           No. of Amends
      * Change Standing Data Cont - Standing Data Controls  *
     C                     EXSR SICHRC
     C                     END                             *FI
      * end E24517
      * TABTB40 - Dealing Data  *
     C                     CALL 'TABTB40'              90  TABTB40
     C**********           PARM BNACCD    WQ0044  4        Account Code                       CGL029
     C**********           PARM BNFRPL    WQ0045  4        Forward Reval.                     CGL029
     C**********           PARM BNFTAC    WQ0046  4        Forward Trade A                    CGL029
     C**********           PARM BNSWTA    WQ0047  4        Swap Trade Acco                    CGL029
     C**********           PARM BNBTCD    WQ0048  4        Trade Account C                    CGL029
     C**********           PARM BNBUCD    WQ0049  4        Trade Account C                    CGL029
     C                     PARM BNACCD    WQ0044 10                                           CGL029
     C                     PARM BNFRPL    WQ0045 10                                           CGL029
     C                     PARM BNFTAC    WQ0046 10                                           CGL029
     C                     PARM BNSWTA    WQ0047 10                                           CGL029
     C                     PARM BNBTCD    WQ0048 10                                           CGL029
     C                     PARM BNBUCD    WQ0049 10                                           CGL029
     C                     PARM BNCYCD    WQ0050  3        Currency Code
     C                     PARM BNCUST    WQ0051  6        Customer Number
     C                     PARM BNLCD     WQ0052  50       Last Change Dat
     C                     PARM 'A'       WQ0053  1        Type of Last Ch
     C                     PARM BNMCRI    WQ0054  1        Maturity Confs.
     C                     PARM BNNAIA    WQ0055  1        Neg. Assets Int
     C                     PARM BNMCEL    WQ0056  30       Maturity Confs.
     C                     PARM BNMCTG    WQ0057  20       Maturity Confs
     C                     PARM BNFRDI    WQ0058  1        Fwd Reval of De
     C                     PARM BNMBAM    WQ0059  53       Minimum Brokera
     C                     PARM BNDHRT    WQ0060  20       Deals Historic
     C                     PARM BNEXRT    WQ0061  31       Exchange Rate T
     C                     PARM BNHKTR    WQ0062  52       Hong Kong Tax R
     C           W0RTN     PARM *BLANK    WQ0063  7        *Return code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'TABTB40' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RADU - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RADU
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SHEXIT    ENDSR
      /EJECT
     CSR         SICHRC    BEGSR
      *================================================================
      * Change Standing Data Cont - Standing Data Controls  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Set PGM.*Record Data Changed flag
     C                     MOVE 'N'       YBRDC   1
      *
      * Move key fields to @AHREAU
     C                     MOVE *BLANK    AHFLNM           Filename
     C                     MOVEL'SDICDRPD'AHFLNM           Filename
      *
     C           KLCHSI    KLIST
     C                     KFLD           AHFLNM           Filename
     C           KLCHSI    CHAIN@AHREAU              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SIEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SIEXIT
     C                     END
      *
      * Store record data for null update check
     C                     MOVE QSDFC1    YBRDCS
      * USER: Processing after Data read
     C                     ADD  AHNORC    WUNORC           No. of Records
     C                     ADD  AHNOIN    WUNOIN           No. of Inserts
     C                     ADD  AHNOAM    WUNOAM           No. of Amends
     C                     ADD  AHNODL    WUNODL           No. of Deletes
      * Move non-key fields to @AHREAU
     C                     Z-ADDWUNORC    AHNORC           No. of Records
     C                     Z-ADDWUNOIN    AHNOIN           No. of Inserts
     C                     Z-ADDWUNOAM    AHNOAM           No. of Amends
     C                     Z-ADDWUNODL    AHNODL           No. of Deletes
      *
      * Set PGM.*Record Data Changed flag
     C           QSDFC1    IFNE YBRDCS
     C                     MOVE 'Y'       YBRDC
     C                     END
      * If changed update record otherwise release record
     C           YBRDC     IFEQ 'Y'
     C                     UPDAT@AHREAU                91  *
     C                     ELSE
      * Release record lock
     C                     UNLCKSDFCTLL0               91  *
     C                     END
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *
      * DBF change successful
     C                     END
      *================================================================
     CSR         SIEXIT    ENDSR
      /EJECT
     CSR         SJRVGN    BEGSR
      *================================================================
      * Get Internal Contracts - MIDAS Modules  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSJ     KLIST
     C                     KFLD           BGMODS           Modules
      * Move fields to key list
     C                     MOVE *BLANK    BGMODS           Modules
     C                     MOVEL'MMOD'    BGMODS           Modules
     C           KRSSJ     CHAIN@BGREC8              90    *
     C           *IN90     IFEQ '1'
      * Data record not found
     C                     MOVEL'USR0096' W0RTN   7
      * USER: Processing if Data record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
      * Setup message data for message
     C                     MOVEL'SDMMODPD'ZA0039           Filename
      * Send message 'Database Error (ICD)'
     C                     MOVEL'USR0377' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     GOTO SJEXIT                     *QUIT
     C                     GOTO SJEXIT
     C                     END
      *
      *================================================================
     CSR         SJEXIT    ENDSR
      /EJECT
     CSR         SKRVGN    BEGSR
      *================================================================
      * Get 'Window required' ind - MIDAS Modules  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSK     KLIST
     C                     KFLD           BGMODS           Modules
      * Move fields to key list
     C                     MOVE *BLANK    BGMODS           Modules
     C                     MOVEL'MMOD'    BGMODS           Modules
     C           KRSSK     CHAIN@BGREC8              90    *
      * Data record not found
     C   90                MOVEL'USR0096' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process Data record
      * CASE: DB1.Window processing requir. is Yes
     C           BGWDPR    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       WUWDPR           Window processi
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SKEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Account Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C/COPY WNCPYSRC,SD9121RC39
     C                     MOVEL#1ACCD    WK1X01  1
     C/COPY WNCPYSRC,SD9121RC40
     C           WK1X01    IFEQ '?'                        Account Code
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C/COPY WNCPYSRC,SD9121RC41
     C********** #1ACCD    PARM #1ACCD    WQ0012  4        Account Code                       CGL029
     C           #1ACCD    PARM #1ACCD    WQ0012 10                                           CGL029
     C/COPY WNCPYSRC,SD9121RC42
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9951  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VAEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C/COPY WNCPYSRC,SD9121RC43
     C           #1ACCD    IFEQ *BLANK                     Account Code
     C/COPY WNCPYSRC,SD9121RC44
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVAA5    KLIST
     C                     KFLD           A5ACCD           Account Code
      * Setup key
     C/COPY WNCPYSRC,SD9121RC45
     C                     MOVEL#1ACCD    A5ACCD           Account Code
     C/COPY WNCPYSRC,SD9121RC46
     C           KLVAA5    CHAIN@A5REA6              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Account Codes          NF'
     C                     MOVEL'USR0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0069' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         VBCKRL    BEGSR
      *================================================================
      * Check reference to Account Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C/COPY WNCPYSRC,SD9121RC47
     C                     MOVEL#1FRPL    WK1X01  1
     C/COPY WNCPYSRC,SD9121RC48
     C           WK1X01    IFEQ '?'                        Account Code
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C/COPY WNCPYSRC,SD9121RC49
     C********** #1FRPL    PARM #1FRPL    WQ0013  4        Account Code                       CGL029
     C           #1FRPL    PARM #1FRPL    WQ0013 10                                           CGL029
     C/COPY WNCPYSRC,SD9121RC50
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9950  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VBEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C/COPY WNCPYSRC,SD9121RC51
     C           #1FRPL    IFEQ *BLANK                     Account Code
     C/COPY WNCPYSRC,SD9121RC52
     C                     GOTO VBEXIT
     C                     END
      *
     C           KLVBA5    KLIST
     C                     KFLD           A5ACCD           Account Code
      * Setup key
     C/COPY WNCPYSRC,SD9121RC53
     C                     MOVEL#1FRPL    A5ACCD           Account Code
     C/COPY WNCPYSRC,SD9121RC54
     C           KLVBA5    CHAIN@A5REA6              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VBEXIT
     C                     END
      * Send message 'Account Codes          NF'
     C                     MOVEL'USR0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0069' W0RTN
      *================================================================
     CSR         VBEXIT    ENDSR
      /EJECT
     CSR         VCCKRL    BEGSR
      *================================================================
      * Check reference to Account Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1FTAC    WK1X01  1
     C           WK1X01    IFEQ '?'                        Account Code
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C********** #1FTAC    PARM #1FTAC    WQ0014  4        Account Code                       CGL029
     C           #1FTAC    PARM #1FTAC    WQ0014 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9953  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VCEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1FTAC    IFEQ *BLANK                     Account Code
     C                     GOTO VCEXIT
     C                     END
      *
     C           KLVCA5    KLIST
     C                     KFLD           A5ACCD           Account Code
      * Setup key
     C                     MOVEL#1FTAC    A5ACCD           Account Code
     C           KLVCA5    CHAIN@A5REA6              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VCEXIT
     C                     END
      * Send message 'Account Codes          NF'
     C                     MOVEL'USR0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0069' W0RTN
      *================================================================
     CSR         VCEXIT    ENDSR
      /EJECT
     CSR         VDCKRL    BEGSR
      *================================================================
      * Check reference to Account Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1SWTA    WK1X01  1
     C           WK1X01    IFEQ '?'                        Account Code
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C********** #1SWTA    PARM #1SWTA    WQ0015  4        Account Code                       CGL029
     C           #1SWTA    PARM #1SWTA    WQ0015 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9952  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VDEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1SWTA    IFEQ *BLANK                     Account Code
     C                     GOTO VDEXIT
     C                     END
      *
     C           KLVDA5    KLIST
     C                     KFLD           A5ACCD           Account Code
      * Setup key
     C                     MOVEL#1SWTA    A5ACCD           Account Code
     C           KLVDA5    CHAIN@A5REA6              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VDEXIT
     C                     END
      * Send message 'Account Codes          NF'
     C                     MOVEL'USR0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0069' W0RTN
      *================================================================
     CSR         VDEXIT    ENDSR
      /EJECT
     CSR         VECKRL    BEGSR
      *================================================================
      * Check reference to Account Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1BTCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Account Code
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C********** #1BTCD    PARM #1BTCD    WQ0016  4        Account Code                       CGL029
     C           #1BTCD    PARM #1BTCD    WQ0016 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9954  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VEEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1BTCD    IFEQ *BLANK                     Account Code
     C                     GOTO VEEXIT
     C                     END
      *
     C           KLVEA5    KLIST
     C                     KFLD           A5ACCD           Account Code
      * Setup key
     C                     MOVEL#1BTCD    A5ACCD           Account Code
     C           KLVEA5    CHAIN@A5REA6              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VEEXIT
     C                     END
      * Send message 'Account Codes          NF'
     C                     MOVEL'USR0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0069' W0RTN
      *================================================================
     CSR         VEEXIT    ENDSR
      /EJECT
     CSR         VFCKRL    BEGSR
      *================================================================
      * Check reference to Account Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1BUCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Account Code
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C********** #1BUCD    PARM #1BUCD    WQ0017  4        Account Code                       CGL029
     C           #1BUCD    PARM #1BUCD    WQ0017 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9955  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VFEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1BUCD    IFEQ *BLANK                     Account Code
     C                     GOTO VFEXIT
     C                     END
      *
     C           KLVFA5    KLIST
     C                     KFLD           A5ACCD           Account Code
      * Setup key
     C                     MOVEL#1BUCD    A5ACCD           Account Code
     C           KLVFA5    CHAIN@A5REA6              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VFEXIT
     C                     END
      * Send message 'Account Codes          NF'
     C                     MOVEL'USR0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0069' W0RTN
      *================================================================
     CSR         VFEXIT    ENDSR
      /EJECT
     CSR         VGCKRL    BEGSR
      *================================================================
      * Check reference to Currency Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1CYCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Currency Code
     C                     CALL 'SD0020S'              90  Select Currency
     C                     PARM *BLANK    W0RTN   7
     C           #1CYCD    PARM #1CYCD    WQ0018  3        Currency Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0020S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9931  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VGEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1CYCD    IFEQ *BLANK                     Currency Code
     C                     GOTO VGEXIT
     C                     END
      *
     C           KLVGA6    KLIST
     C                     KFLD           A6CYCD           Currency Code
      * Setup key
     C                     MOVEL#1CYCD    A6CYCD           Currency Code
     C           KLVGA6    CHAIN@A6REA3              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VGEXIT
     C                     END
      * Send message 'Currency Codes         NF'
     C                     MOVEL'USR0071' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0071' W0RTN
      *================================================================
     CSR         VGEXIT    ENDSR
      /EJECT
     CSR         VHCKRL    BEGSR
      *================================================================
      * Check reference to Client Details
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1CUST    WK1X01  1
     C           WK1X01    IFEQ '?'                        Customer Number
     C                     CALL 'SD0010S'              90  Select Client D
     C                     PARM *BLANK    W0RTN   7
     C           #1CUST    PARM #1CUST    WQ0019  6        Customer Number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0010S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9939  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VHEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1CUST    IFEQ *BLANK                     Customer Number
     C                     GOTO VHEXIT
     C                     END
      *
     C           KLVHBB    KLIST
     C                     KFLD           BBCUST           Customer Number
      * Setup key
     C                     MOVEL#1CUST    BBCUST           Customer Number
     C           KLVHBB    CHAIN@BBREBF              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VHEXIT
     C                     END
      * Send message 'Client Details         NF'
     C                     MOVEL'USR0081' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0081' W0RTN
      *================================================================
     CSR         VHEXIT    ENDSR
      /EJECT
     CSR         VICKRL    BEGSR
      *================================================================
      * Check reference to Currency Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1CYDL    WK1X01  1
     C           WK1X01    IFEQ '?'                        Currency Code
     C                     CALL 'SD0020S'              90  Select Currency
     C                     PARM *BLANK    W0RTN   7
     C           #1CYDL    PARM #1CYDL    WQ0020  3        Currency Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0020S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9932  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VIEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1CYDL    IFEQ *BLANK                     Currency Code
     C                     GOTO VIEXIT
     C                     END
      *
     C           KLVIA6    KLIST
     C                     KFLD           A6CYCD           Currency Code
      * Setup key
     C                     MOVEL#1CYDL    A6CYCD           Currency Code
     C           KLVIA6    CHAIN@A6REA3              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VIEXIT
     C                     END
      * Send message 'Currency Codes         NF'
     C                     MOVEL'USR0071' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0071' W0RTN
      *================================================================
     CSR         VIEXIT    ENDSR
      /EJECT
     CSR         VJCKRL    BEGSR
      *================================================================
      * Check reference to Book Details
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1BKCD    WK1X01  1
     C           WK1X01    IFEQ '?'                        Book Code
     C                     CALL 'SD0310S'              90  Select Book Det
     C                     PARM *BLANK    W0RTN   7
     C           #1BKCD    PARM #1BKCD    WQ0021  2        Book Code
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0310S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9941  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VJEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1BKCD    IFEQ *BLANK                     Book Code
     C                     GOTO VJEXIT
     C                     END
      *
     C           KLVJBD    KLIST
     C                     KFLD           BDBKCD           Book Code
      * Setup key
     C                     MOVEL#1BKCD    BDBKCD           Book Code
     C           KLVJBD    CHAIN@BDREDK              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VJEXIT
     C                     END
      * Send message 'Book Details           NF'
     C                     MOVEL'USR0085' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0085' W0RTN
      *================================================================
     CSR         VJEXIT    ENDSR
      /EJECT
     CSR         VKCKRL    BEGSR
      *================================================================
      * Check reference to Account Codes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1NEAC    WK1X01  1
     C           WK1X01    IFEQ '?'                        Account Code
     C                     CALL 'SD0031S'              90  Select Account
     C                     PARM *BLANK    W0RTN   7
     C********** #1NEAC    PARM #1NEAC    WQ0022  4        Account Code                       CGL029
     C           #1NEAC    PARM #1NEAC    WQ0022 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'SD0031S' W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'Y2U0016'
     C                     SETON                     9948  *
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     IFNE *BLANK
     C                     GOTO VKEXIT
     C                     END
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1NEAC    IFEQ *BLANK                     Account Code
     C                     GOTO VKEXIT
     C                     END
      *
     C           KLVKA5    KLIST
     C                     KFLD           A5ACCD           Account Code
      * Setup key
     C                     MOVEL#1NEAC    A5ACCD           Account Code
     C           KLVKA5    CHAIN@A5REA6              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VKEXIT
     C                     END
      * Send message 'Account Codes          NF'
     C                     MOVEL'USR0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'USR0069' W0RTN
      *================================================================
     CSR         VKEXIT    ENDSR
      *****************************************************************                       CAS005
      /EJECT                                                                                  CAS005
      *****************************************************************                       CAS005
      *                                                               *                       CAS005
      * SRFRLA - Subroutine that checks the reference for #1FRPL      *                       CAS005
      *          to the account codes file                            *                       CAS005
      *                                                               *                       CAS005
      *****************************************************************                       CAS005
     C           SRFRLA    BEGSR                                                              CAS005
      *                                                                                       CAS005
      ** If first character entered for #1FRLA is '?'                                         CAS005
      *                                                                                       CAS005
     C                     MOVE *BLANKS   W0RTN                                               CAS005
     C                     MOVEL#1FRLA    WK1X01                                              CAS005
     C           WK1X01    IFEQ '?'                                                           CAS005
     C                     CALL 'SD0031S'              90                                     CAS005
     C                     PARM *BLANK    W0RTN                                               CAS005
     C           #1FRLA    PARM #1FRLA    WQ0089  4                                           CAS005
      *                                                                                       CAS005
      ** If error on calling the program for account code selection                           CAS005
      *                                                                                       CAS005
     C           *IN90     IFEQ *ON                                                           CAS005
     C                     MOVEL'Y2U0032' W0RTN                                               CAS005
     C                     MOVEL*BLANKS   W0CLPG                                              CAS005
     C                     MOVEL'SD0031S' W0CLPG                                              CAS005
     C                     MOVEL'Y2U0032' ZAMSID                                              CAS005
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              CAS005
     C                     MOVELW0CLPG    ZAMSDA                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** If return code is not blank and not "No Value Selected"                              CAS005
      *                                                                                       CAS005
     C           W0RTN     IFNE *BLANK                                                        CAS005
     C           W0RTN     ANDNE'Y2U0016'                                                     CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     MOVE *ON       *IN27                                               CAS005
     C                     ENDIF                                                              CAS005
      * Defer confirm                                                                         CAS005
     C                     MOVEL'Y'       W0DCF                                               CAS005
      *                                                                                       CAS005
      ** If no value is selected, exit subroutine                                             CAS005
      *                                                                                       CAS005
     C           W0RTN     IFNE *BLANK                                                        CAS005
     C                     GOTO FRLAXT                                                        CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** If all low order keys not entered, exit subroutine                                   CAS005
      *                                                                                       CAS005
     C           #1FRLA    IFEQ *BLANK                                                        CAS005
     C                     GOTO FRLAXT                                                        CAS005
     C                     END                                                                CAS005
      * Setup key                                                                             CAS005
     C                     MOVEL#1FRLA    A5ACCD                                              CAS005
      *                                                                                       CAS005
     C           FRLAXT    ENDSR                                                              CAS005
      *****************************************************************                       CAS005
      /EJECT                                                                                  CAS005
      *****************************************************************                       CAS005
      *                                                               *                       CAS005
      * SRLCAC - Subroutine that checks the referrence for #1LCAC     *                       CAS005
      *          to the account codes file                            *                       CAS005
      *                                                               *                       CAS005
      *****************************************************************                       CAS005
     C           SRLCAC    BEGSR                                                              CAS005
      *                                                                                       CAS005
      ** If first character entered for #1LCAC is '?'                                         CAS005
      *                                                                                       CAS005
     C                     MOVE *BLANKS   W0RTN                                               CAS005
     C                     MOVEL#1LCAC    WK1X01                                              CAS005
     C           WK1X01    IFEQ '?'                                                           CAS005
     C                     CALL 'SD0031S'              90                                     CAS005
     C                     PARM *BLANK    W0RTN                                               CAS005
     C           #1LCAC    PARM #1LCAC    WQ0090  4                                           CAS005
      *                                                                                       CAS005
      ** If error on calling the program for account code selection                           CAS005
      *                                                                                       CAS005
     C           *IN90     IFEQ *ON                                                           CAS005
     C                     MOVEL'Y2U0032' W0RTN                                               CAS005
     C                     MOVEL*BLANKS   W0CLPG                                              CAS005
     C                     MOVEL'SD0031S' W0CLPG                                              CAS005
     C                     MOVEL'Y2U0032' ZAMSID                                              CAS005
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              CAS005
     C                     MOVELW0CLPG    ZAMSDA                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** If return code is not blank and not "No Value Selected"                              CAS005
      *                                                                                       CAS005
     C           W0RTN     IFNE *BLANK                                                        CAS005
     C           W0RTN     ANDNE'Y2U0016'                                                     CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     MOVE *ON       *IN28                                               CAS005
     C                     ENDIF                                                              CAS005
      * Defer confirm                                                                         CAS005
     C                     MOVEL'Y'       W0DCF                                               CAS005
      *                                                                                       CAS005
      ** If no value is selected, exit subroutine                                             CAS005
      *                                                                                       CAS005
     C           W0RTN     IFNE *BLANK                                                        CAS005
     C                     GOTO LCACXT                                                        CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** If all low order keys not entered, exit subroutine                                   CAS005
      *                                                                                       CAS005
     C           #1LCAC    IFEQ *BLANK                                                        CAS005
     C                     GOTO LCACXT                                                        CAS005
     C                     END                                                                CAS005
      * Setup key                                                                             CAS005
     C                     MOVEL#1LCAC    A5ACCD                                              CAS005
      *                                                                                       CAS005
     C           LCACXT    ENDSR                                                              CAS005
      *****************************************************************                       CAS005
      /EJECT                                                                                  CAS005
      *****************************************************************                       CAS005
      *                                                               *                       CAS005
      * SRCHNO - Subroutine that checks if #1LCAC is numeric.         *                       CAS005
      *                                                               *                       CAS005
      *****************************************************************                       CAS005
     C           SRCHNO    BEGSR                                                              CAS005
      *                                                                                       CAS005
      ** Re-use indicator 90                                                                  CAS005
      *                                                                                       CAS005
     C                     MOVEL*IN90     XG90                                                CAS005
      *                                                                                       CAS005
     C                     TESTN          #1LCAC     90  90                                   CAS005
     C           *IN90     IFEQ *ON                                                           CAS005
     C                     MOVE #1LCAC    XGX1    1                                           CAS005
     C                     TESTB'0123'    XGX1           90                                   CAS005
     C                     ELSE                                                               CAS005
     C                     MOVEL#1LCAC    XGX1                                                CAS005
     C           #1LCAC    IFEQ *BLANKS                                                       CAS005
     C           XGX1      OREQ '?'                                                           CAS005
     C                     MOVE *ON       *IN90                                               CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Send error message 'Field must be numeric'                                           CAS005
      *                                                                                       CAS005
     C           *IN90     IFEQ *OFF                                                          CAS005
     C                     MOVEL'Y2U0010' ZAMSID                                              CAS005
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     MOVE *ON       *IN99                                               CAS005
     C                     MOVE *ON       *IN28                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Return the original value of indicator 90                                            CAS005
      *                                                                                       CAS005
     C                     MOVELXG90      *IN90                                               CAS005
     C                     ENDSR                                                              CAS005
      *****************************************************************                       CAS005
      /EJECT
     CSR         Y0SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y0EXIT    ENDSR
      /EJECT
     CSR         Y1SET     BEGSR
      *================================================================
      * Set cursor by *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y1EXIT    ENDSR
      /EJECT
     CSR         Y8TST     BEGSR
      *================================================================
      * Test cursor
      *================================================================
     C           @#DFMT    IFEQ '#RCDKEY'
      * KEY Screen
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C                     END
     C           @#DFMT    IFEQ '#RCDDTL1'
      * DETAIL Screen
     C                     Z-ADD@#RWCL    ZINPOS  50
     C           ZINPOS    DIV  256       W0CRW
     C                     MVR            W0CCL
     C                     END
      *================================================================
     CSR         Y8EXIT    ENDSR
      /EJECT
     CSR         Y9CLR     BEGSR
      *================================================================
      * Clear *SET CURSOR data
      *================================================================
      *================================================================
     CSR         Y9EXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM 1         YYLGCT  50       # of grps
     C                     PARM W0GRP     YYLGVN 10        Label grps
      *
      * Clear set cursor DDS indicator
     C  N94                MOVEL'OFF'     WCSRLC
     C  N94                SETON                     94    *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel and exit from key screen
      *================================================================
      * USER: Exit program processing
      * CASE: KEY.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVEL'**CMD**' P2RTN            *Return code
     C                     MOVEL'CMD01'   P3WRTC           Work Return cod
     C                     END                             *FI
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121REPP - Dealing Data  *
     C/COPY WNCPYSRC,SD9121REPP
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * ROLLBACK any uncommitted DBF changes
     C                     ROLBK                       90
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C           W0ICL     IFEQ *BLANK
     C                     MOVEL'Y'       W0ICL   1        *Initial call
     C                     ELSE
     C                     MOVEL'N'       W0ICL
     C                     END
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*ZEROS    W0RTW   90
     C                     MOVEL'400'     W0ENV   3
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
      * Set century digit (If YY prior to 1940 treat as 20YY)
     C           ##JYY     IFLT 40
     C                     Z-ADD1         ##JCC
     C                     ELSE
     C                     Z-ADD0         ##JCC
     C                     END
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN Y2MGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field S01212
     C                     MOVEL*BLANK    WUMFTS  1
      * Define work field SAR S01434
     C                     MOVEL*BLANK    WUEROP  1
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Err Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field SAR S01460
     C                     MOVEL*BLANK    WUSAFD  1
      * Define work field Internal Contracts
     C                     MOVEL*BLANK    WUINCN  1
      * Define work field CCM002 Feature Present
     C                     MOVEL*BLANK    WUCYD5  1
      * Define work field FX Netting switched on
     C                     MOVEL*BLANK    WUY9ST  1
      * Define work field Account type
     C                     MOVEL*BLANK    WUACTY  1
      * Define work field Title Only Indicator
     C                     MOVEL*BLANK    WUTOIN  1
      * Define work field Disp Netting by Sing Brch
     C                     MOVEL*BLANK    WUDNSB  1
      * Define work field Run day number
     C                     Z-ADD*ZERO     WURDNB  50
      * Define work field Last Change Date
     C                     Z-ADD*ZERO     WULCD   50
      * Define work field Window processing requir.
     C                     MOVEL*BLANK    WUWDPR  1
      * Define work field No. of Records
     C                     Z-ADD*ZERO     WUNORC  50
      * Define work field No. of Inserts
     C                     Z-ADD*ZERO     WUNOIN  50
      * Define work field No. of Deletes
     C                     Z-ADD*ZERO     WUNODL  50
      * Define work field No. of Amends
     C                     Z-ADD*ZERO     WUNOAM  50
      * Define work field Display No. days b/f mat
     C                     MOVEL*BLANK    WUDNWM  1
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Set Up Complete
     C                     MOVEL*BLANK    WUSUC   1
      * Define work field Date format flag
     C                     MOVEL*BLANK    WUDFF   1
      * Define work field Multi-branching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field SAR number field
     C                     MOVEL*BLANK    WUSARN  6
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field CDL004 present
     C                     MOVEL*BLANK    WUCDL4  1
      * Flag no *SET CURSOR in the program
     C                     MOVE 'N'       YSETCS  1
     C                     MOVE *BLANK    WCSRLC  3
      * Open files
      * Begin commit control
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
      * Define *Synon program work fields
     C                     MOVEL*BLANKS   W0CFL  10        *Cursor field
     C                     Z-ADD*ZEROS    W0CRW   50       *Cursor row
     C                     Z-ADD*ZEROS    W0CCL   50       *Cursor column
      * Move main file information to JOB context
     C                     MOVE @1FFL     ZZFFL  10        Main file name
     C                     MOVE @1FLB     ZZFLB  10        Main file lib
     C                     MOVE @1FMB     ZZFMB  10        Main file mbr
     C                     MOVE ZZFFL     @1FFL  10
     C                     MOVE ZZFLB     @1FLB  10
     C                     MOVE ZZFMB     @1FMB  10
     C                     CALL 'Y2QLVNR'
     C                     PARM           ZZFFL  10
     C                     PARM           ZZFLB  10
     C                     PARM           ZZFQL  21        LIBRARY/FILE
     C                     OPEN SD9121R#
     C                     OPEN SDDEALL1
     C/COPY WNCPYSRC,SD9121RC55
     C                     OPEN SDACODL1
     C                     OPEN SDCURRL1
     C                     OPEN SDCUSTL1
     C                     OPEN SDBOOKL1
     C                     OPEN SDMMODL1
     C                     OPEN SDDEALL0
     C                     OPEN SDFCTLL0
     C                     MOVEL'N'       W0PMT   1
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL*BLANK    W0GRP   1
      *                                                                   CDL006
      ** Dataarea LDA                                                     CDL006
      *                                                                   CDL006
     C           *NAMVAR   DEFN           LDA                             CDL006
      * USER: Initialize program
      * Start of change S01459
      * Remove last amend box user source
      * Remove creation parameters user source
      * SD9121R precompiler - Dealing Data  *
      * End of change S01459
      * S01212 - Standard Functions  *
      * Get Rundate - Rundate  *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT  7        RUN DATE
     C                     MOVE MRDT      WUMRDT
     C                     MOVE RDNB      WURDNB           RUNDAY NO.
     C                     MOVE SUC       WUSUC            SET UP COMPLT
     C                     MOVE DFF       WUDFF            DTE FMT FLAG
     C                     MOVE MBIN      WUMBIN           MULTI BR. IND
      *                                                                   CDL006
      ** Prepare LDA                                                      CDL006
      *                                                                   CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     MOVEL*BLANK    DBLOT                           CDL006
     C                     MOVEL'SD9121R' DBPGM                           CDL006
     C                     OUT  LDA                                       CDL006
      * Copyright Statement 1988 - Standard Functions  * copyright
      * Get Internal Contracts - MIDAS Modules  *
     C                     EXSR SJRVGN
      * Start of S01434
     C                     MOVEL'N'       WUEROP           SAR S01434
     C                     MOVEL'S01434'  WUSARN           SAR number fiel
     C                     MOVEL*BLANK    WUAPRC           Access Pgm Retu
      * SAR switched on check - Standard Functions  *
     C                     CALL 'AOSARDR0'             90  SAR switched on
     C           WUAPRC    PARM WUAPRC    WQ0064  7        Access Pgm Retu
     C                     PARM '*VERIFY' WQ0065  7        Option for ACCO
     C           WUSARN    PARM WUSARN    WQ0066  6        SAR number fiel
     C                     PARM *BLANK    WQ0067 76        Access obj dumm
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'AOSARDR0'W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Display No. of Working Days before Maturity if S01434 on
      * CASE: WRK.Access Pgm Return Code is AP No Record Found
     C           WUAPRC    IFEQ '*NRF'                     *IF
     C                     MOVEL'N'       WUEROP           SAR S01434
     C                     MOVEL'N'       WUDNWM           Display No. day
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUEROP           SAR S01434
     C                     MOVEL'Y'       WUDNWM           Display No. day
     C                     END                             *FI
      * Free SCSARDPD
      * SAR switched on check - Standard Functions  *
     C                     CALL 'AOSARDR0'             90  SAR switched on
     C           WUAPRC    PARM WUAPRC    WQ0068  7        Access Pgm Retu
     C                     PARM '*FREE'   WQ0069  7        Option for ACCO
     C           WUSARN    PARM WUSARN    WQ0070  6        SAR number fiel
     C                     PARM *BLANK    WQ0071 76        Access obj dumm
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'AOSARDR0'W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * End of S01434
      * Start of S01460
      * Check if SAR S01460 is switched ON.
     C                     MOVEL'N'       WUSAFD           SAR S01460
     C                     MOVEL'S01460'  WUSARN           SAR number fiel
     C                     MOVEL*BLANK    WUAPRC           Access Pgm Retu
      * SAR switched on check - Standard Functions  *
     C                     CALL 'AOSARDR0'             90  SAR switched on
     C           WUAPRC    PARM WUAPRC    WQ0072  7        Access Pgm Retu
     C                     PARM '*VERIFY' WQ0073  7        Option for ACCO
     C           WUSARN    PARM WUSARN    WQ0074  6        SAR number fiel
     C                     PARM *BLANK    WQ0075 76        Access obj dumm
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'AOSARDR0'W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Check return code
      * CASE: WRK.Access Pgm Return Code is AP No Record Found
     C           WUAPRC    IFEQ '*NRF'                     *IF
     C                     MOVEL'N'       WUSAFD           SAR S01460
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUSAFD           SAR S01460
     C                     END                             *FI
      * End of S01460
      * Start of change CCM002
      * Determine if switchable feature CCM002 is present.
     C                     MOVEL'N'       WUCYD5           CCM002 Feature
     C                     MOVEL'CCM002'  WUSARN           SAR number fiel
     C                     MOVEL*BLANK    WUAPRC           Access Pgm Retu
      * SAR switched on check - Standard Functions  *
     C                     CALL 'AOSARDR0'             90  SAR switched on
     C           WUAPRC    PARM WUAPRC    WQ0076  7        Access Pgm Retu
     C                     PARM '*VERIFY' WQ0077  7        Option for ACCO
     C           WUSARN    PARM WUSARN    WQ0078  6        SAR number fiel
     C                     PARM *BLANK    WQ0079 76        Access obj dumm
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'AOSARDR0'W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Check return code and set CCM002 flag.
      * CASE: WRK.Access Pgm Return Code is AP No Record Found
     C           WUAPRC    IFEQ '*NRF'                     *IF
     C                     MOVEL'N'       WUCYD5           CCM002 Feature
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUCYD5           CCM002 Feature
     C                     END                             *FI
      * End of change CCM002
      * Start of change CDL002.
     C                     MOVEL'N'       WUY9ST           FX Netting swit
     C                     MOVEL'CDL002'  WUSARN           SAR number fiel
     C                     MOVEL*BLANK    WUAPRC           Access Pgm Retu
      * SAR switched on check - Standard Functions  *
     C                     CALL 'AOSARDR0'             90  SAR switched on
     C           WUAPRC    PARM WUAPRC    WQ0080  7        Access Pgm Retu
     C                     PARM '*VERIFY' WQ0081  7        Option for ACCO
     C           WUSARN    PARM WUSARN    WQ0082  6        SAR number fiel
     C                     PARM *BLANK    WQ0083 76        Access obj dumm
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'AOSARDR0'W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *
      * Check return code.
      * CASE: WRK.Access Pgm Return Code is AP No Record Found
     C           WUAPRC    IFEQ '*NRF'                     *IF
     C                     MOVEL'N'       WUY9ST           FX Netting swit
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUY9ST           FX Netting swit
     C                     END                             *FI
      * End of change CDL002.
      * Start of change CDL004.
     C                     MOVEL'N'       WUCDL4           CDL004 present
     C                     MOVEL'CDL004'  WUSARN           SAR number fiel
     C                     MOVEL*BLANK    WUAPRC           Access Pgm Retu
      * SAR switched on check - Standard Functions  *
     C                     CALL 'AOSARDR0'             90  SAR switched on
     C           WUAPRC    PARM WUAPRC    WQ0084  7        Access Pgm Retu
     C                     PARM '*VERIFY' WQ0085  7        Option for ACCO
     C           WUSARN    PARM WUSARN    WQ0086  6        SAR number fiel
     C                     PARM *BLANK    WQ0087 76        Access obj dumm
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0032' W0RTN
     C                     MOVEL*BLANKS   W0CLPG 10
     C                     MOVEL'AOSARDR0'W0CLPG
      * Send message '*Error occured on CALL...'
     C                     MOVEL'Y2U0032' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     MOVELW0CLPG    ZAMSDA           Message data
     C                     EXSR ZASNMS
     C                     END
      *                                                                   CDL006
      ** Access Switchable Feature Details, Check if CDL006 is            CDL006
      ** switch on.                                                       CDL006
      *                                                                   CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   PRTCD   7                       CDL006
     C                     PARM '*VERIFY 'POPTN   7                       CDL006
     C                     PARM 'CDL006'  PSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSSDY                           CDL006
      *                                                                   CDL006
     C           PRTCD     IFNE *BLANK                                    CDL006
     C           PRTCD     ANDNE'*NRF '                                   CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     Z-ADD001       DBASE            ***************CDL006
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 001*CDL006
     C                     MOVELPSARD     DBKEY            ***************CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** If feature is switched on allow the display of fiduciary         CDL006
      ** screen fields for input, otherwise non-display.                  CDL006
      *                                                                   CDL006
     C           PRTCD     IFEQ *BLANKS                                   CDL006
     C                     MOVE 'Y'       CDL006  1                       CDL006
     C                     MOVE '1'       *IN73                           CDL006
     C                     ELSE                                           CDL006
     C                     MOVE 'N'       CDL006                          CDL006
     C                     MOVE '0'       *IN73                           CDL006
     C                     ENDIF                                          CDL006
      *                                                                                       CDL013
      ***   Check if CAR CDL013 is installed                                                  CDL013
      *                                                                                       CDL013
     C                     MOVEL'CDL013'  WUSARN                                              CDL013
      *                                                                                       CDL013
     C                     CALL 'AOSARDR0'             85                                     CDL013
     C                     PARM *BLANK    WQ0063  7                                           CDL013
     C                     PARM '*VERIFY' WQ0064  7                                           CDL013
     C                     PARM WUSARN    WQ0098  6                                           CDL013
     C                     PARM *BLANK    WQ0099 76                                           CDL013
      *                                                                                       CDL013
      ** If program fails send error message                                                  CDL013
      *                                                                                       CDL013
     C           *IN85     IFEQ *ON                                                           CDL013
     C                     MOVEL'Y2U0032' ZAMSID                                              CDL013
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              CDL013
     C                     MOVEL*BLANKS   ZAMSDA                                              CDL013
     C                     EXSR ZASNMS                                                        CDL013
      *                                                                                       CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      ** CAR CDL013 is not installed                                                          CDL013
      *                                                                                       CDL013
     C           WQ0063    IFEQ '*NRF'                                                        CDL013
     C                     MOVE *OFF      *IN75                                               CDL013
      *                                                                                       CDL013
      ** CAR CDL013 is installed set on non-display indicator re dspf.                        CDL013
      *                                                                                       CDL013
     C                     ELSE                                                               CDL013
     C                     MOVE *ON       *IN75                                               CDL013
     C                     END                                                                CDL013
     C                     END                                                                CDL013
      *                                                                                       CAS001
      ** Determine if CAS001 is installed                                                     CAS001
      *                                                                                       CAS001
     C                     CALL 'AOSARDR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD                                               CAS001
     C                     PARM '*VERIFY 'POPTN                                               CAS001
     C                     PARM 'CAS001'  PSARD                                               CAS001
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANKS                                                       CAS001
     C           PRTCD     ANDNE'*NRF   '                                                     CAS001
     C           *LOCK     IN   LDA                                                           CAS001
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS001
     C                     Z-ADD1         DBASE                                               CAS001
     C                     MOVEL'CAS001'  DBKEY                                               CAS001
     C                     OUT  LDA                                                           CAS001
     C                     MOVE *ON       *INU7                                               CAS001
     C                     MOVE *ON       *INU8                                               CAS001
     C                     EXSR *PSSR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       CAS001  1                                           CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE 'N'       CAS001                                              CAS001
     C                     MOVE *ON       *IN80                                               CAS001
     C                     ENDIF                                                              CAS001
     C/COPY WNCPYSRC,SDH00589
      *                                                                                       CAS005
      ** Determine if CAS005 is installed                                                     CAS005
      *                                                                                       CAS005
     C                     CALL 'AOSARDR0'                                                    CAS005
     C                     PARM *BLANKS   PRTCD                                               CAS005
     C                     PARM '*VERIFY 'POPTN                                               CAS005
     C                     PARM 'CAS005'  PSARD                                               CAS005
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS005
      *                                                                                       CAS005
     C           PRTCD     IFNE *BLANKS                                                       CAS005
     C           PRTCD     ANDNE'*NRF   '                                                     CAS005
     C           *LOCK     IN   LDA                                                           CAS005
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS005
     C                     Z-ADD2         DBASE                                               CAS005
     C                     MOVEL'CAS005'  DBKEY                                               CAS005
     C                     OUT  LDA                                                           CAS005
     C                     MOVE *ON       *INU7                                               CAS005
     C                     MOVE *ON       *INU8                                               CAS005
     C                     EXSR *PSSR                                                         CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           PRTCD     IFEQ *BLANKS                                                       CAS005
     C                     MOVE 'Y'       CAS005  1                                           CAS005
     C                     ELSE                                                               CAS005
     C                     MOVE 'N'       CAS005                                              CAS005
     C                     ENDIF                                                              CAS005
      *
      * Check return code.
      * CASE: WRK.Access Pgm Return Code is AP No Record Found
     C           WUAPRC    IFEQ '*NRF'                     *IF
     C                     MOVEL'N'       WUCDL4           CDL004 present
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUCDL4           CDL004 present
     C                     END                             *FI
      * Set Display flag for Netting by Single Branch.
      * CASE:
      *  - c1 AND c2
      *   |- c1    : WRK.CDL004 present is CDL004 Present
      *   |- c2    : WRK.Multi-branching Indicator is Multi-branched
      *   '-
     C                     MOVEL'0'       Y0CX01  1
     C           WUCDL4    IFEQ 'Y'                        *IF
     C           WUMBIN    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       Y0CX01
     C                     END                             *FI
     C                     END                             *FI
     C           Y0CX01    IFEQ '1'                        *IF
     C                     MOVEL'Y'       WUDNSB           Disp Netting by
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDNSB           Disp Netting by
     C                     END                             *FI
      * End of change CDL004.
     C                     MOVEL'Y'       WUMFTS           S01212
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * Get 'Window required' ind - MIDAS Modules  *
     C                     EXSR SKRVGN
      * Data Struct.for Deal/Data - Dealing Data  *
     C                     END                             *FI
      * /COPYs.
      * CASE: WRK.S01212 is Fix installed
     C           WUMFTS    IFEQ 'Y'                        *IF
      * 00/COPY Member SD9121RFPG - Dealing Data  *
      * 00/COPY Member SD9121REPG - Dealing Data  *
      * 00/COPY Member SD9121RIPG - Dealing Data  *
      * 00/COPY Member SD9121RCPG - Dealing Data  *
     C/COPY WNCPYSRC,SD9121RCPG
      * 00/COPY Member SD9121ROPG - Dealing Data  *
      *                                                                                       CER001
      ** Access SAR details file to determine if ULX004 is on                                 CER001
      *                                                                                       CER001
     C                     MOVEL'N'       ULX004                                              CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   @RTCD   7                                           CER001
     C                     PARM '*VERIFY' @OPTN   7                                           CER001
     C                     PARM 'ULX004'  @SARD   6                                           CER001
     C           SCSARD    PARM SCSARD    DSFDY 200                                           CER001
     C           @RTCD     IFEQ *BLANK                                                        CER001
     C                     MOVEL'Y'       ULX004  1                                           CER001
     C                     ELSE                                                               CER001
     C           @RTCD     IFNE '*NRF   '                                                     CER001
     C           *LOCK     IN   LDA                                                           CER001
     C                     Z-ADD003       DBASE                                               CER001
     C                     MOVEL'SCSARDPD'DBFILE                                              CER001
     C                     MOVEL@SARD     DBKEY                                               CER001
     C                     OUT  LDA                                                           CER001
     C                     EXSR *PSSR                                                         CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CDL048
      ** Access switchable feature details, check if CDL048 is                                CDL048
      ** switched on.                                                                         CDL048
      *                                                                                       CDL048
     C                     MOVE 'N'       CDL048  1                                           CDL048
     C                     MOVE *OFF      *IN92                                               CDL048
      *                                                                                       CDL048
     C                     CALL 'AOSARDR0'                                                    CDL048
     C                     PARM *BLANKS   PRTCD   7                                           CDL048
     C                     PARM '*VERIFY 'POPTN   7                                           CDL048
     C                     PARM 'CDL048'  PSARD   6                                           CDL048
     C           SCSARD    PARM SCSARD    DSSDY                                               CDL048
      *                                                                                       CDL048
     C           PRTCD     IFNE *BLANK                                                        CDL048
     C           PRTCD     ANDNE'*NRF '                                                       CDL048
     C           *LOCK     IN   LDA                                                           CDL048
     C                     Z-ADD004       DBASE            ***************                    CDL048
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 004*                    CDL048
     C                     MOVEL'CDL048'  DBKEY            ***************                    CDL048
     C                     OUT  LDA                                                           CDL048
     C                     EXSR *PSSR                                                         CDL048
      *                                                                                       CDL048
     C                     ELSE                                                               CDL048
      *                                                                                       CDL048
     C           PRTCD     IFEQ *BLANK                                                        CDL048
     C                     MOVE 'Y'       CDL048                                              CDL048
     C                     MOVE *ON       *IN92                                               CDL048
     C                     ENDIF                                                              CDL048
      *                                                                                       CDL048
     C                     ENDIF                                                              CDL048
     C                     END                             *FI
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT
     CSR         *PSSR     BEGSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
      *
      * Core function specific processing.
      *
     C/COPY WNCPYSRC,SD9121RPSC
      *
      * Start of PSSR user point.
      *
     C/COPY WNCPYSRC,SD9121RPS1
      *
      * Standard Midas PSSR processing.
      *
     C/COPY SDCPYSRC,SDPSSRICD
      *
      * End of PSSR user point.
      *
     C/COPY WNCPYSRC,SD9121RPS2
      *
      *================================================================
     CSR                   ENDSR
      *================================================================
     O/COPY WNCPYSRC,SD9121ROPG
** CPY@     : Copyright notice for inclusion in all programs
(c) Misys International Banking Systems Ltd. 2001
