     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Standard settlements maintenance')            *
/*XBIA*  OVRDBF FILE(STDSEX) TOFILE(STDSED) SHARE(*NO)                *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE0030 - STANDARD SETTLEMENTS INPUT                          *
      *                                                               *
      *  Function: This program allows the maintenance of Standard    *
      *   (I/C)    Settlement Instructions for Securities Trading     *
      *            transactions.                                      *
      *                                                               *
      *  Called By: SEC02 - Input Cycle Processing                    *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. AR970395           Date 01Jun20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD037885           Date 25May16               *
      *                 255419             Date 13Nov12               *
      *                 255417             Date 12Nov12               *
      *                 CAP208             Date 06Dec10               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG13200           Date 05Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 BUG8415            Date 12Dec05               *
      *                 BUG7267            Date 01Aug05               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10905           Date 17Mar06               *
      *                 215879             Date 25Mar03               *
      *                 215878             Date 20Mar03               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 BUG5565            Date 31Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2198            Date 07May04               *
      *                 BUG2197            Date 04May04               *
      *                 CAAA03             Date 19Mar04               *
      *                 CGL029             Date 01Sep03               *
      *                 CSE041             Date 26Mar03               *
      *                 CSE039             Date 30Jan03               *
      *                 215782             Date 03Apr03               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 211791             Date 17Jan03               *
      *                 211735             Date 17Jan03               *
      *                 210160             Date 17Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 203380             Date 10Apr02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 207944             Date 31Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE034             Date 22Apr02               *
      *                 204749             Date 12Apr02               *
      *                 204583             Date 05Apr02               *
      *                 204590             Date 04Apr02               *
      *                 203368             Date 26Feb02               *
      *                 193959             Date 18Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 CSW201             Date 02May01               *
      *                 CSE022             Date 29Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 180544             Date 23Mar01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 185733             Date 01Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 157548             Date 26May99               *
      *                 CEU005             DATE 04FEB98               *
      *                 123222             DATE 04FEB98               *
      *                 121477             DATE 13AUG97               *
      *                 104633             DATE 08JUL96               *
      *                 CSW096             DATE 03JUN96               *
      *                 103401             DATE 20MAY96               *
      *                 103357             DATE 29APR96               *
      *                 S01408             DATE 29APR96               *
      *                 070814             DATE 26MAR96               *
      *                 S01408             DATE 11APR95               *
      *                 060645             DATE 08APR94               *
      *                 058355             DATE 24FEB94               *
      *                 052254             DATE 05JAN94               *
      *                 054933             DATE 05OCT93               *
      *                 046065             DATE 06JUL93               *
      *                 S01412             DATE 27MAY93               *
      *                 E50469             DATE 20APR93               *
      *                 S01397             DATE 10SEP92               *
      *                 E37014             DATE 10MAR92               *
      *                 E33967             DATE 06JAN92               *
      *                 E24568             DATE 28FEB91               *
      *                 S01117             DATE 29OCT90               *
      *                 S01269             DATE 17OCT90               *
      *                 E23408             DATE 06SEP90               *
      *                 E21541             DATE 29MAR90               *
      *                 E19985             DATE 27OCT89               *
      *                 E19758             DATE 11OCT89               *
      *                 E19756             DATE 09OCT89               *
      *                 E19740             DATE 05OCT89               *
      *                 S01199             DATE 14SEP89               *
      *                 E17200             DATE 06APR88               *
      *                 E17198             DATE 06APR88               *
      *                 E17195             DATE 06APR88               *
      *                 E17192             DATE 06APR88               *
      *                 E17188             DATE 05APR88               *
      *                 E17186             DATE 05APR88               *
      *                 E17185             DATE 05APR88               *
      *                 E14541             DATE 06DEC88               *
      *                 S01176             DATE 02NOV88               *
      *                 S01179             DATE 21OCT88               *
      *                 E15219             DATE 11OCT88               *
      *                 S01158             DATE 10JUL88               *
      *                 S01175             DATE 01JUL88               *
      *                 E13940             DATE 26JUL88               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  AR970395 - Standard Settlement Instruction Screen crashes    *
      *             due to record locking. Removes the lock during    *
      *             amend and return a message to other users that it *
      *             was being amended already by some user.           *
      *             (Child:AR970396)                                  *
      *  MD046248 - Finastra Rebranding                               *
      *  MD037885 - Error with enquiry and delete action for          *
      *             non-existent investment type                      *
      *  255419 - SD Correct action is shown as an error (reverse) in *
      *           Standard Settlements Maintenance.                   *
      *  255417 - Unexpected symbol in error line in Securities       *
      *         - standard settlement maintenance screen.             *
      *  CAP208 - F&O Market Instrument API (Recompile)               *
      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
      *  BUG13200 - Correct F12 processing. Set to first record when  *
      *             F12 is pressed.                                   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG8415 - Error occurs in "For account of" field under       *
      *            "Deliver from theirs" even if valid account is     *
      *             entered since variable WINCNO was erroneously     *
      *            updated; used MOVE instead of MOVEL. Fixed errors  *
      *            in Receive account & Pay account fields when only  *
      *            customer number is entered for settlement type 05  *
      *  BUG7267 - SSI - Cannot define with clearance type 2          *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10905 - Auto-Settle Indicator is not available on the     *
      *             screen even if CSE039 is switch on.               *
      *  215879 - If settlement through nostro, access SD0151S.       *
      *  215878 - Missing details in subfile.                         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  BUG5565- As the information on SSI are only being used as    *
      *           default for transaction input, there is no need to  *
      *           link 'Deliver to/from our' with                     *
      *           'Deliver to/from their'. As the bank may not able   *
      *            to know their information during the set up of SSI.*
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2198- Reverse Image for Error Message and Info Message.   *
      *  BUG2197- SSASI field should not be displayed on the Webface  *
      *           when *IN52 is off.  (recompile)                     *
      *  CAAA03 - Webfacing changes.  Recompiled due to changes to    *
      *           SE0030DF.                                           *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSE041 - DVP/RVP Processing                                  *
      *  CSE039 - Auto-Settlement of Trades                           *
      *  215782 - Not able to use '?' in Market Centre and Investment *
      *           Type field. Fix is to call new programs SE0015 and  *
      *           SE0025 when '?' is entered in these fields.         *
      *  211791 - Display subfile records correctly when pressing     *
      *           ROLLUP/ROLLDOWN keys.                               *
      *  211735 - Cursor positions to SSCCY & SERII fields even if    *
      *           CEU005 is off. Added conditions to its attributes   *
      *           in SE0030DF to prevent problem. Recompile only.     *
      *  210160 - Cursor positions to Market Centre field even if     *
      *           CSE028 is off. Fix is to correct indicator being    *
      *           used. Display file SE0030DF was also amended.       *
      *  203380 - MOVE of SCSTM to WINCNO should be MOVEL since       *
      *           CSE028 changed length of SCSTM from 12 - 6.         *
      *  207944 - SE0030 problem with SSI if CSE028/29 off            *
      *  CSE034 - Standard Settlement Instructions improvements       *
      *  204749 - At least one field should be ebtered when inserting *
      *           an SSI.                                             *
      *  204583 - Recompiled due to changes in SE0030DF.              *
      *  204590 - Should allow without investment code                *
      *  203368 - Field 'To be used for Depot Movement' erroneously   *
      *           defaulted to 'N' even if value exist on file.       *
      *  193959 - Complete CEU005 : When the settlement currency is   *
      *           used, check with this one if nostro exists.         *
      *  CSE028  -  Standing Settlement Instructions Enhancement      *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  CSE022 - Depository Definition Enhancement                   *
      *  180544 - Allow deletion of standard settlement Instruction   *
      *           for deleted customer client.                        *
      *  185733 - Addition of Depot A/C number for MG0565             *
      *           (CSE023 - Treaty Withholding Tax)                   *
      *  157548 - Kasseveren settlement method also allows EURO.     *
      *  CEU005 - EMU SE Settlement Ccy Conversion, insertion of      *
      *           Settlement Ccy and 'In' Currency in field 72.       *
      *  123222 - Receive and Pay account/branch field for Settlement *
      *           Methods '01', '02', '07', '08' and '12' is not      *
      *           properly validated. Add validation for the said     *
      *           methods.                                            *
      *  121477 - Should only validate the 'For account of' field     *
      *           when it is not BLANK.                               *
      *  104633 - GUI Amendments to DSPF with non-standard footers    *
      *  CSW096 - Swift Changes 1996:                                 *
      *           Add validation for field 72.                        *
      *  103401 - Remove error code '252' being sent if the           *
      *           Settle't method 04, pay code 1 or 5, clearance type *
      *           1-4, and pay to/from not equal                      *
      *           to the same customer as deliver from/to.            *
      *  103357 - Allow entry of Standard settlement instructions     *
      *           for customer types 'E', 'C', 'K' or 'X' without     *
      *           investment type.                                    *
      *  S01408 - Hook SE0030CCP3 added.                              *
      *           Hook SE0030CCP4 added.                              *
      *           Hook SE0030CCP5 added.                              *
      *           Hook SE0030CCP6 added.                              *
      *           Hook SE0030CCP7 added.                              *
      *           Hook SE0030CCP8 added.                              *
      *  070814 - If after ? mark result is blanks Display            *
      *          counter-party-nostros.                               *
      *  S01408 - Hook SE0030CVS1 added.                              *
      *           Hook SE0030CVS2 added.                              *
      *           Hook SE0030CVS3 added.                              *
      *           Hook SE0030CVS4 added.                              *
      *           Hook SE0030CVS5 added.                              *
      *           Hook SE0030CVSF added.                              *
      *           Hook SE0030CCPG added.                              *
      *           Hook SE0030IIPG added.                              *
      *           Hook SE0030CCP1 added.                              *
      *           Hook SE0030CCP2 added.                              *
      *  060645 - Incorrect validation of PAY ACCOUNT, if settlement  *
      *           is through a nostro then the nostro customer        *
      *           should be checked for the same institution.         *
      *  058355 - Receive and pay accounts accept 9 and 11 digit      *
      *           A/C nos. for tpye 14. Should only be 10 long        *
      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9                                             *
      *  054933 - Cannot enter Counterparty Nostro                    *
      *  046065 - Incorrect validation if Nostro code entered uses    *
      *           Customer for Settle details for check of error code *
      *           251 not the Nostro Customer of the receive a/c.     *
      *  S01412 - SWIFT September 1993 changes - validation           *
      *           of the format of the special instructions           *
      *           field.                                              *
      *  E50469 - Incorrect validation for counterparty.  Security    *
      *           client file is not being accessed.                  *
      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
      *          - Recompiled due to changes to files.                *
      *  E37014 - In single branch environment set up branch from     *
      *           the user for the key to ACCNT and STDSED            *
      *  E33967 - Error E17192 incorrectly deletes error code '101'   *
      *           and replaces it with '102' which is used for a      *
      *           different check.                                    *
      *  E24568 - The Receive Counterparty Bank is not mandatory      *
      *           for settlement methods 01, 07 & 08.                 *
      *  S01117 - Multibranching                                      *
      *  S01269 - Trade authorisation: recompiled for change to file  *
      *           TABSE                                               *
      *  E23408 - Settlement types 4 and 14 allowed if RETAIL II or   *
      *           INTEREST ON ACCOUNTS on in system.                  *
      *  E21541 - Settlement Instructions should be allowed to be set *
      *           up for Customers of Types 'E', 'C', 'K' or 'X'.     *
      *  E19985 - If Paycode 1 or 5, Depots for Delivery and Payment  *
      *           should be at the same institution.                  *
      *  E19758 - Safe Custody or Discretionary Clients should not    *
      *           need to be Participants af Euroclear or Cedel if    *
      *           the Depot already is.                               *
      *  E19756 - Pay Counterparty field should not be mandatory for  *
      *           Settlement Type 01.                                 *
      *  E19740 - Euroclear or Cedel should be valid in 'DELIVER TO   *
      *           THEIRS' field if Clearance Type is 5.               *
      *  S01199 - HELP SYSTEM.                                        *
      *  E17200 - IF NO PAY/RECEIVE SETTLEMENT METHOD ENTERED,        *
      *           DISPLAY BLANK IN SETTLEMENT INSTRUCTIONS.           *
      *  E17198 - FIELDS INCORRECTLY UPDATED IN STDSED                *
      *  E17195 - CHECK FOR DEALING CURRENCY, 103 ERROR CODE          *
      *  E17192 - WRONG ERROR CODE DISPLAYED, 104 ERROR CODE SHOULD   *
      *           NOT BE DISPLAYED.                                   *
      *  E17188 - TO BLANK OUT SOME SCREEN FIELDS                     *
      *  E17186 - 'FOR ACCOUNT OF', 'COUNTERPARTY BANK REC & PAY'     *
      *           FIELDS SHOULD ALSO BE LIVE CUSTOMERS ON CLINTCB.    *
      *         - FIELD NOT MANDATORY FOR SETTLEMENT METHOD 01.       *
      *  E17185 - IF ERROR '237', MESSAGES '238' AND '250' SHOULD     *
      *           NOT BE DISPLAYED.                                   *
      *  E14541 - VERIFY ALL PARTS OF THE KEY FOR ALL ACTION CODES    *
      *  S01176 - SECURITIES TRADING 3.1                              *
      *  S01179 - ****** AS400 CONVERSION ******                      *
      *    The keyword RTGAID is no longer supported on the AS400     *
      *    and command keys and indicators have been used to replace  *
      *    this in the display file. To disrupt the structure of the  *
      *    program as little as possible a new subroutine - ASCHGS -  *
      *    has been coded. This moves the values which would have     *
      *    been passed to the program (via RTGAID) into the AID       *
      *    field depending on which function key has been pressed.    *
      *  E15219 - POSITION POINTER CORRECTLY ON SUBFILE               *
      *  S01158 - POST INCORPORATION DEVELOPMENT FIX                  *
      *  S01175 - EUCLID INCORPORATION                                *
      *  E13940 - ALLOW ONLY PAY OR ONLY RECEIVE DETAILS.             *
      *                                                               *
      *****************************************************************
      *
     FSE0030DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        RRN   KSFILE SUBFLREC
     F*STDSED**UF  E           K        DISK         KCOMIT       A                           207944
     F**********                                    KINFDS INFDS                              207944
     F**********                                    KINFSR INFSR                              207944
     FSTDSEX  IF  E           K        DISK
     F            STDSEDF                           KRENAMESTDSEDFX
     FSTDSEL1 UF  E           K        DISK         KCOMIT       A                            CSE034
     F                                              KINFDS INFDS                              207944
     F                                              KINFSR INFSR                              207944
     F            STDSEDF                           KRENAMESTDSEDFL                           CSE034
     FSTDSEA  UF  E                    DISK         KCOMIT
     F*TABSE***IF  E           K        DISK                              S01117
     F* ICD 1     TABTB10F                          KIGNORE
     F**********  TABTB11F                          KIGNORE               S01117
     F**********  TABTG20F                          KIGNORE               S01117
     F******      TABTB36F                          KIGNORE               S01158
     F* CCY 2     TABTB40F                          KIGNORE
     F**********  TABTE20F                          KIGNORE               S01117
     F**********  TABTE10F                          KIGNORE               S01117
     F* CCY 1     TABTG10F                          KIGNORE
     F**********  TABTG10F                          KIGNORE               S01117
     F**********  TABLETHF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01117
     F* NOSTROS   TABLETLF                          KIGNORE
     F**********  TABLETLF                          KIGNORE               S01117
     F* BRANCHES  TABLETRF                          KIGNORE
     F**********  TABLETRF                          KIGNORE               S01117
     F* CPARTY    TABLET2F                          KIGNORE
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACCNTABX
     FINVTP   IF  E           K        DISK
     F*CLINT***IF  E           K        DISK                              S01117
     F**********  CLINTCAF                          KIGNORE               S01117
     F**********  CLINTCCF                          KIGNORE               S01117
     F**********  CLINTC1F                          KIGNORE               S01117
     F*SNAME***IF  E           K        DISK                              S01117
     F**********  CLINTCBF                          KRENAMECLINTCBX       S01117
      *                                                                                       CSE028
      ** Portfolio Definition Details                                                         CSE028
     FPMPORTPDIF  E           K        DISK                                                   CSE028
      *                                                                                       CSE028
      ** Standard Additional Settlements Details                                              CSE028
     FSTDADSL1UF  E           K        DISK                                                   CSE028
      *                                                                                       CSE028
      ** SE Market Centres file                                                               CSE034
     FSEMKC   IF  E           K        DISK                                                   CSE034
      *                                                                                       CSE034
     FINVTO   IF  E           K        DISK                                                   CSE041
     F            INVTPDF                           KRENAMEINVTOX                             CSE041
     F/COPY WNCPYSRC,SE0030F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - S/SUBFLCTL  SFLDSP                                    *
     F*   02  - S/SUBFLCTL  SFLDSPCTL                                 *
     F*   03  - S/SUBFLCTL  SFLEND                                    *
     F*   04  - S/SUBFLCTL  ROLLDOWN not allowed                      *
     F*   05  - S/KEYINPUT  Protect/Non-Display on location           *
     F*   06  - S/RECDETLS  Protect fields                            *
      *   07  - Enable F10 key                                        *                       CSE028
     F*                                                               *
     F*   10  - Start  Screen                                         *
     F*   11  - Review Screen                                         *
     F*   12  - Update Screen                                         *
     F*                                                               *
     F*   15  - Used on Write/Update to condition call of INFSR       *
     F*   20  - VLDCMDKY Indicator for Display File                   *   S01179
     F*                                                               *   S01179
     F*   21  - S/KEYINPUT  ERROR-ACTN                                *
     F*   22  - S/KEYINPUT  ERROR-SSBRH                               *
     F*   23  - S/KEYINPUT  ERROR-SCSTM                               *
     F*   24  - S/KEYINPUT  ERROR-SCYSI                               *
     F*   25  - S/KEYINPUT  ERROR-SITSI                               *
      *   26  - S/KEYINPUT  ERROR-SSIBK                               *                       CSE028
      *   27  - S/KEYINPUT  ERROR-SSPTFR                              *                       CSE028
      *   28  - S/KEYINPUT  ERROR-SSMKT                               *                       CSE034
      *   29  - S/KEYINPUT  Reverse Image Indicator for Action Field  *                       255419
     F*                                                               *
     F*   30  - S/RECDETLS  POSITION CURSOR                           *
     F*   31  - S/RECDETLS  INVALID RECEIVE SETTLEMENT METHOD         *
     F*   32  - S/RECDETLS  INVALID RECEIVE ACCOUNT                   *
     F*   33  - S/RECDETLS  INVALID RECEIVE BRANCH                    *
     F*   34  - S/RECDETLS  INVALID RECEIVE COUNTERPARTY BANK         *
     F*   35  - S/RECDETLS  INVALID PAY SETTLEMENT METHOD             *
     F*   36  - S/RECDETLS  INVALID PAY ACCOUNT                       *
     F*   37  - S/RECDETLS  INVALID PAY BRANCH                        *
     F*   38  - S/RECDETLS  INVALID PAY COUNTERPARTY BANK             *
     F*   39  - S/RECDETLS  INVALID PAY FOR ACCOUNT OF                *
     F*   40  - S/RECDETLS  INVALID SPECIAL INSTRUCTIONS              *
     F*   41  - S/RECDETLS  INVALID PAY CODE - PURCHASE               *
     F*   42  - S/RECDETLS  INVALID PAY CODE - SALE                   *
     F*   43  - S/RECDETLS  INVALID CLEARANCE TYPE - PURCHASE         *
     F*   44  - S/RECDETLS  INVALID CLEARANCE TYPE - SALE             *
     F*   45  - S/RECDETLS  INVALID CLEARANCE HOUSE INDICATOR         *
     F*   46  - S/RECDETLS  INVALID DELIVER TO OURS                   *
     F*   47  - S/RECDETLS  INVALID DELIVER FROM OURS                 *
     F*   48  - S/RECDETLS  INVALID DELIVER TO THEIRS                 *
     F*   49  - S/RECDETLS  INVALID FOR A/C OF - PURCHASE             *
     F*   50  - S/RECDETLS  INVALID DELIVER FROM THEIRS               *
      *   51  - S/RECDETLS  Invalid for A/C of - Sale                 *                       CSE028
      *   52  - CSE039 is on, so display Auto-Settle Ind              *                       CSE039
      *   54  - S/RECDETLS  Invalid Auto-Settle Indicator             *                       CSE039
     F*   55  - S/RECDETLS  SETTLEMENT METHOD TABLE LOOK-UP           *
     F*   56  - S/RECDETLS  INVALID SETTLEMENT CURRENCY               *   CEU005
     F*   57  - S/RECDETLS  INVALID 'INCLUDE ERI IN FIELD 72'         *   CEU005
     F*   58  - S/RECDETLS  POSITION CURSOR                           *   CEU005
     F*   59  - S/RECDETLS  FEATURE CEU005 IS ON => DISPLAY NEW FIELDS*   CEU005
     F*         SETTLEMENT CURRENCY AND 'INCLUDE ERI IN FIELD 72'     *   CEU005
     F*                                                               *
     F*   60  - ADD RECORD                                            *
     F*                                                               *
      *   63  - Enable F8=Securities Settlement Instruction for SWIFT *                       CSE028
      *   64  - Private Banking or Portfolio Management is on         *                       CSE028
     F*   65  - ROLLUP                                                *   S01179
     F*   66  - ROLLDOWN                                              *   S01179
     F****67**-*HELP***************************************************   S01179              CSE028
     F*                                                               *   S01179
      *   67  - CSE028 is  on                                         *                       CSE028
      *   68  - S/RECDETLS  Invalid Safekeeping Account               *                       CSE028
      *   69  - CSE023 is on                                          *                       CSE028
      *                                                               *                       CSE028
     F*   70  - RETAIL MODULE PRESENT IN SYSTEM                       *
     F*   78  - S/RECDETLS  Invalid Default Contingent Liability Ind. *   S01176
     F*   88  - MBIN = Y                                              *   S01117
     F*   88  - Special instruction field validation                  *   S01412
     F*                                                               *
     F*   97  - Work                                                  *
     F*   98  - DATF = MMDDYY                                         *
     F*   99  - Work                                                  *
     F*                                                               *
     F*   U7  - Database Error                                        *
     F*   U8  - Program Error                                         *
     F*                                                               *
     F*   'AID' Values used                                           *
     F*                                                               *
     F*   01  - CA1                                                   *
     F*   04  - CA4                                                   *
     F*   05  - CA5                                                   *
     F*   RA  - ENTER Pressed                                         *
     F*   UP  - ROLLUP                                                *
     F*   DN  - ROLLDOWN                                              *
     F****HP**-*HELP*Pressed*******************************************   S01199
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - INITIALISATION OF STANDARD FIELDS,                  *
     F*           ACCESS OF STANDING DATA                             *
     F*  START  - OUTPUT AND PROCESS KEY FIELDS SCREEN                *
     F*  REVIEW - PROCESS SUBFILE SELECTION SCREEN                    *
     F*  UPDATE - PROCESS DETAIL SCREEN AND UPDATE FILE               *
     F*  VALIDK - VALIDATE KEY FIELDS                                 *
     F*  VALIDD - VALIDATE DETAIL SCREEN                              *
     F*  SEPTVS - SPECIAL INSTRUCTION FIELD VALIDATION                *
     F*  VALCST - VALIDATE CUSTOMER NO/SHORTNAME                      *
     F*  INITRC - INITIALISE ALL FILE FIELDS TO ZERO/BLANK            *
     F*  TRSFS  - FORMAT RECORD FIELDS FOR SCREEN                     *
     F*  UPDFLS - UPDATE FILE RECORDS                                 *
     F*  UPDOWS - PROCESS UPDATE BY ANOTHER WORKSTATION               *
     F*  INFSR  - FILE ERROR HANDLING S/R                             *
     F*  *PSSR  - ERROR HANDLING                                      *   S01117
     F*                                                               *
     F*  ZTNLU1 - ACCESS DATAAREA FOR NEXT TRANSACTION NO.            *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    DET       256  1
     E                    ERR        19  4
     E/COPY WNCPYSRC,SE0030E001
     E                    METH   12  12  2
     E/COPY WNCPYSRC,SE0030E002
     E******************  INF     1  11 76                                                    CSE034
     E                    INF     1  12 76                                                    CSE034
     E*                                                                   S01412
     E                    UPA    27  27  1                                S01412
     E** Valid codeword characters                                        S01412
      *                                                                                       CSW201
     E                    APN    37  37  1                                                    CSW201
      ** Valid uppercase alphabetic characters and numeric digits                             CSW201
     E*                                                                   S01412
     E                    SWCH   47  47  1                                S01412
     E** Valid SWIFT ISO characters                                       S01412
     E*                                                                   S01412
     E                    NUM    10  10  1                                CSE041
     E** Valid Numeric Digits for Pay A/c & Receive A/c                   CSE041
     E*                                                                   CSE041
     E                    NUMD        2  1                                CSE041
     E** PAY A/C & RECEIVE A/C                                            CSE041
     E*                                                                   CSE041
     E                    SIL        35  1                                S01412
     E** Special instruction line                                         S01412
     E*                                                                   S01412
      /EJECT
     ICPYR@#      DS
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     ISCRCTL      DS
     I*
     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I*
     I/COPY WNCPYSRC,SE0030I002
     I                                        1   1 REVW
     I                                        2   2 ACTN
     I***********                             3 017 INPK                                      CSE028
     I***********                             3 0050SBRH                  S01117
     I**********                              3  23 INPK                               CSE028 211791
     I                                        3  25 INPK                                      211791
     I                                        3 005 SBRA                  S01117
     I**********                            006 0110CSTM                                      CSD027
     I                                      006 011 CSTM                                      CSD027
     I**********                            012 014 CYSI                                      CSE028
     I**********                             15 017 ITSI                                      CSE028
     I                                       12  13 SIBK                                      CSE028
     I                                       14  16 CYSI                                      CSE028
     I**********                             17  19 ITSI                               CSE028 CSE034
     I**********                             20  23 SPTFR                              CSE028 CSE034
     I                                       17  18 SMKT                                      CSE034
     I                                       19  21 ITSI                                      CSE034
     I                                       22  25 SPTFR                                     CSE034
     I**********                            018 032 PAGK                                      CSE028
     I**********                            018 020 PSBRH                                     CSE028
     I**********                            021 026 PCSTM                                     CSE028
     I**********                            027 029 PCYSI                                     CSE028
     I**********                             30  32 PITSI                                     CSE028
     I**********                             24  44 PAGK                               CSE028 CSE034
     I**********                             24  26 PSBRH                              CSE028 CSE034
     I**********                             27  32 PCSTM                              CSE028 CSE034
     I**********                             33  34 PSIBK                              CSE028 CSE034
     I**********                             35  37 PCYSI                              CSE028 CSE034
     I**********                             38  40 PITSI                              CSE028 CSE034
     I**********                             41  44 PSPTFR                             CSE028 CSE034
     I                                       26  48 PAGK                                      CSE034
     I                                       26  28 PSBRH                                     CSE034
     I                                       29  34 PCSTM                                     CSE034
     I                                       35  36 PSIBK                                     CSE034
     I                                       37  39 PCYSI                                     CSE034
     I                                       40  41 PSMKT                                     CSE034
     I                                       42  44 PITSI                                     CSE034
     I                                       45  48 PSPTFR                                    CSE034
     I/COPY WNCPYSRC,SE0030I003
     I*
     IDETREC    E DSSTDSED
     I*
     I** DATA STRUCTURE FOR INITIALISING A RECORD
     I*
     I***********   SBRH                            SBRHX                 S01117
     I              SBRA                            SBRHX                 S01117
     I              CSTM                            CSTMX
     I              SIBK                            SIBKX                                     CSE028
     I              CYSI                            CYSIX
     I              SMKT                            SMKTX                                     CSE034
     I              ITSI                            ITSIX
     I              SPTFR                           SPTFRX                                    CSE028
     I/COPY WNCPYSRC,SE0030I004
     I*
     I***DETS***E DSSE0030DF                                              S01179
     IDETS        DS                                                      S01179
     I*                                                                   S01179
     I** DATA STRUCTURE FOR SCREEN DETAIL OUTPUT TO CMTTXT                S01179
     I*                                                                   S01179
     I***********                             1   2 SSRSM           S01179CEU005
     I***********                             3  14 SSRAC           S01179CEU005
     I***********                            15  17 SSRBR           S01179CEU005
     I***********                            18  29 SSRCB           S01179CEU005
     I***********                            30  31 SSPSM           S01179CEU005
     I***********                            32  43 SSPAT           S01179CEU005
     I***********                            44  46 SSPBR           S01179CEU005
     I***********                            47  58 SSPCB           S01179CEU005
     I***********                            59  70 SSPFA           S01179CEU005
     I***********                            71 105 SSPSI           S01179CEU005
     I***********                           106 106 SSPCP           S01179CEU005
     I***********                           107 107 SSPCS           S01179CEU005
     I***********                           108 108 SSCLP           S01179CEU005
     I***********                           109 109 SSCLS           S01179CEU005
     I***********                           110 121 SSDTO           S01179CEU005
     I***********                           122 133 SSDFO           S01179CEU005
     I***********                           134 145 SSDTT           S01179CEU005
     I***********                           146 157 SSFAT           S01179CEU005
     I***********                           158 169 SSDFT           S01179CEU005
     I***********                           170 181 SSFAF           S01179CEU005
     I                                        1   3 SSCCY                 CEU005
     I                                        4   4 SERII                 CEU005
     I                                        5   6 SSRSM                 CEU005
     I**********                              7  18 SSRAC                              CEU005 CGL029
     I**********                             19  21 SSRBR                              CEU005 CGL029
     I**********                             22  33 SSRCB                              CEU005 CGL029
     I**********                             34  35 SSPSM                              CEU005 CGL029
     I**********                             36  47 SSPAT                              CEU005 CGL029
     I**********                             48  50 SSPBR                              CEU005 CGL029
     I**********                             51  62 SSPCB                              CEU005 CGL029
     I**********                             63  74 SSPFA                              CEU005 CGL029
     I**********                             75 109 SSPSI                              CEU005 CGL029
     I**********                            110 110 SSPCP                              CEU005 CGL029
     I**********                            111 111 SSPCS                              CEU005 CGL029
     I**********                            112 112 SSCLP                              CEU005 CGL029
     I**********                            113 113 SSCLS                              CEU005 CGL029
     I**********                            114 125 SSDTO                              CEU005 CGL029
     I**********                            126 137 SSDFO                              CEU005 CGL029
     I**********                            138 149 SSDTT                              CEU005 CGL029
     I**********                            150 161 SSFAT                              CEU005 CGL029
     I**********                            162 173 SSDFT                              CEU005 CGL029
     I**********                            174 185 SSFAF                              CEU005 CGL029
     I**********                              5  18 WKVAL1                             204749 CGL029
     I**********                             22  47 WKVAL2                             204749 CGL029
     I**********                             51 185 WKVAL3                             204749 CGL029
     I                                        7  24 SSRAC                                     CGL029
     I                                       25  27 SSRBR                                     CGL029
     I                                       28  39 SSRCB                                     CGL029
     I                                       40  41 SSPSM                                     CGL029
     I                                       42  59 SSPAT                                     CGL029
     I                                       60  62 SSPBR                                     CGL029
     I                                       63  74 SSPCB                                     CGL029
     I                                       75  86 SSPFA                                     CGL029
     I                                       87 121 SSPSI                                     CGL029
     I                                      122 122 SSPCP                                     CGL029
     I                                      123 123 SSPCS                                     CGL029
     I                                      124 124 SSCLP                                     CGL029
     I                                      125 125 SSCLS                                     CGL029
     I                                      126 137 SSDTO                                     CGL029
     I                                      138 149 SSDFO                                     CGL029
     I                                      150 161 SSDTT                                     CGL029
     I                                      162 173 SSFAT                                     CGL029
     I                                      174 185 SSDFT                                     CGL029
     I                                      186 197 SSFAF                                     CGL029
     I                                        5  24 WKVAL1                                    CGL029
     I                                       28  59 WKVAL2                                    CGL029
     I                                       63 197 WKVAL3                                    CGL029
     I/COPY WNCPYSRC,SEH00114
     IWCDSQ       DS
     I*
     I** DATA STRUCTURE TO SPLIT SSPAT/SSRAC INTO KEY FIELDS FOR ACCNT
     I*
     I**********                              1   40WACOD                                     CGL029
     I**********                              5   60WACSQ                                     CGL029
     I                                        1  100WACOD                                     CGL029
     I                                       11  120WACSQ                                     CGL029
      *
      ** Data structure to check account code & sequence specifically for set type 05        BUG8415
      *                                                                                      BUG8415
     IWCDSQC      DS                                                                         BUG8415
     I                                        1  10 WACODC                                   BUG8415
     I                                       11  12 WACSQC                                   BUG8415
     I**********                                                          S01117
     I*TABKEY******DS                          1  12                      S01117
     I**********                                                          S01117
     I***DATA*STRUCTURE FOR CHAINING TO TABSE                             S01117
     I**********                                                          S01117
     I**********                              1   20RECT                  S01117
     I**********                              3   7 ZZ005                 S01117
     I**********                              3  10 ZZ008                 S01117
     I**********                              8  10 TLCCY                 S01117
     I**********                              9  11 TCCY                  S01117
     I**********                             11  120TLNOS                 S01117
     I**********                              5  12 NOSTR                 S01117
     I**********                                                          S01117
     I*ONEBR***** DS                                                      S01117
     I***********                                                         S01117
     I***DATA*STRUCTURE*TO*FORCE*ZONED*BRCD*******************************S01117
     I***********                                                         S01117
     I***********                             1   30BRCD                  S01117
     I*
     ISCRMSG      DS                          1 152
     I*
     I** DATA STRUCTURE FOR ERROR MESSAGES TO SCREEN
     I*
     I                                        1  76 ERR
     I                                        1  76 ERRMSG
     I                                       77 152 INFMSG
     I*
     ISCRDS       DS
     I*
     I** DISPLAY FORMAT STATUS DATA STRUCTURE
     I*
     I**********                            287 288 AID                                       211791
     IINFDS       DS
     I*
     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     I                                     *STATUS  STATUS
     I*
     I*DA********UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     ICMTTXT      DS
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 306 DET
     I*
     IPSDS       SDS
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     I                                      244 246 WSID
     I                                      254 263 USID
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
      ** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
     I**                                                                  S01117
     ISDCNST    E DSSDCNSTPD                                              S01117
     I** Counterparty Nostro Details                                      S01117
     I**                                                                  S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I** Currency Details                                                 S01117
     I**                                                                  S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I** Customer Details                                                 S01117
     I**                                                                  S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              QQDFAC                          DFACQQ                                    CGL029
     I** Branch Details                                                   S01117
     I**                                                                  S01117
     ISDGELR    E DSSDGELRPD                                              CEU005
     I** General Ledger ICD                                               CEU005
     I**                                                                  CEU005
     ISDMMOD    E DSSDMMODPD                                              S01117
     I** MIDAS Module Details                                             S01117
     I**                                                                  S01117
     ISDNOST    E DSSDNOSTPD                                              S01117
     I**  EXTERNAL DS FOR NOSTRO DETAILS                                  S01117
     I              QQACCD                          ACCDQQ                                    CGL029
     I**                                                                  S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I** Securities Client Details                                        S01117
     I              QQACCD                          ACD2QQ                                    CGL029
     I**                                                                  S01117
     ISDTRAD    E DSSDTRADPD                                              S01117
     I** Trading Data                                                     S01117
     I              QQACCD                          ACD3QQ                                    CGL029
     I*                                                                   S01408
      ** MIDAS SD Book Details                                                                CSE028
     ISDBOOK    E DSSDBOOKPD                                                                  CSE028
      *                                                                                       CSE028
     I/COPY WNCPYSRC,SE0030IIPG                                           S01408
     I*                                                                   S01408
     I**                                                                  S01117
     I***DSPAYA      DS                             12                                 S01117 CGL029
     IDSPAYA      DS                             18                                           CGL029
     I** DATA AREA FOR THE NOSTRO LOCATION CODE IN PAY FROM ACCOUNT       S01117
     I                                        1   2 NOSP                  S01117
     I                                        3  18 WDSPAY                                    CGL029
     I**                                                                  S01117
     I***DSRCVA*     DS                             12                                 S01117 CGL029
     IDSRCVA      DS                             18                                           CGL029
     I** DATA AREA FOR THE NOSTRO LOCATION CODE IN RECEIVE ACCOUNT        S01117
     I                                        1   2 NOSR                  S01117
     I                                        3  18 WDSRCV                                    CGL029
     I**                                                                  S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     I**                                                                  S01117
     IDSSDY     E DSDSSDY                                                 S01117
     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01117
     I**                                                                                      CSE034
     IMARK      E DSMARKTD                                                                    CSE034
      ** FF Market Center Details                                                             CSE034
      *                                                                                       CSE034
     I              RECI                            RECIM                                     CSE034
     I              LCD                             LCDM                                      CSE034
     I              CHTP                            CHTPM                                     CSE034
     I              TNLU                            TNLUM                                     CSE034
     I**                                                                  S01117
     I/COPY WNCPYSRC,SE0030I001
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO STDSE FILE
     C*
     C           STDSEK    KLIST
     C***********          KFLD           SBRH                            S01117
     C                     KFLD           SBRA                            S01117
     C                     KFLD           CSTM
     C                     KFLD           SIBK                                                CSE028
     C                     KFLD           CYSI
     C                     KFLD           ITSI
     C                     KFLD           SPTFR                                               CSE028
      *                                                                                       CSE034
     C           STDADK    KLIST                                                              CSE034
     C                     KFLD           SBRA                                                CSE034
     C                     KFLD           CSTM                                                CSE034
     C                     KFLD           SIBK                                                CSE034
     C                     KFLD           CYSI                                                CSE034
     C                     KFLD           SMKT                                                CSE034
     C                     KFLD           ITSI                                                CSE034
     C                     KFLD           SPTFR                                               CSE034
     C/COPY WNCPYSRC,SE0030C008
     C*                                                                   CEU005
     C**  DEFINE KEY LIST FOR CHAINING TO STDSE FILE USING SETTLEMENT CCY CEU005
     C*                                                                   CEU005
     C           STDSE2    KLIST                                          CEU005
     C                     KFLD           WSBRA   3                       CEU005
     C**********           KFLD           WCSTM   60                                   CEU005 CSD027
     C                     KFLD           WCSTM   6                                           CSD027
     C                     KFLD           WSIBK   2                                           CSE028
     C                     KFLD           WSCCY   3                       CEU005
     C                     KFLD           WITSI   3                       CEU005
     C                     KFLD           WSPTFR  4                                           CSE028
     C/COPY WNCPYSRC,SE0030C009
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO INVTPO
     C*
     C           KINVTP    KLIST
     C                     KFLD           SCYSI
     C                     KFLD           SITSI
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO ACCNT
     C*
     C           KACCNT    KLIST
     C                     KFLD           CNUM
     C                     KFLD           CYSI
     C                     KFLD           WACOD
     C                     KFLD           WACSQ
     C                     KFLD           WBRCA   3                       S01117
     C*
      **  Define key list for chaining to PMPORTPD                                            CSE028
      *                                                                                       CSE028
     C           KPREF     KLIST                                                              CSE028
     C**********           KFLD           WCNUM   60                                   CSE028 CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WPREF   4                                           CSE028
      *                                                                                       CSE028
     C*================================================================
      /EJECT
     C*================================================================
     C*
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR INIT
      *
      ***  Do Until Command 3 or Database Error
      *
     C           AID       DOUEQ'01'
     C           *INU7     OREQ '1'
     C*
     C           *IN10     CASEQ'1'       START
     C           *IN11     CASEQ'1'       REVIEW
     C           *IN12     CASEQ'1'       UPDATE
     C*
     C                     END
     C                     END
     C*
     C** TERMINATE PROGRAM
     C*
     C           *INU7     IFEQ '1'
     C                     SETON                         U8
     C                     END
      *
      *================================================================
      *  P R O G R A M     E N D                                      *
      *                                                               *
     C                     SETON                         LR
      *                                                               *
      *================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  INIT   - Subroutine to initialise Static fields and access   *
     C*           Standing Data.                                      *
     C*                                                               *
     C*  Called from: Main Processing.                                *
     C*  Calls: None                                                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           INIT      BEGSR                           * INIT BEGSR *
     C*
     C** PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0030'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C** PREPARE COMIT TEXT
     C*
     C                     MOVEL'SE'      MDID
     C                     MOVEL'SE0030'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*
     C***HELP*PROGRAM*PARAMETER****************************************   S01199
     C***********                                                         S01199
     C***********          MOVEL'SE0030'  HBPGM   8                       S01199
     C                     MOVEL*BLANK    WBLNK   1
     C*
     C** FOR HIGH INTENSITY SCREEN ATTRIBUTE
     C*
     C**********           BITOF'01234567'HI      1                                           255417
     C**********           BITON'267'     HI                                                  255417
     C**********           MOVELHI        INF,7                                               255417
     C**********           MOVELHI        INF,8                                               255417
     C**********           MOVELHI        INF,9                                               255417
     C**********           MOVELHI        INF,10                                              255417
     C**********           MOVELHI        INF,11                                              255417
     C**********           MOVELHI        INF,12                                       204749 255417
     C**                                                                  S01117
     C** IN THE DATAAREA ZMUSER                                           S01117
     C**                                                                  S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C**********                                                          S01117
     C***GET*INSTALLATION CONTROL DATA RECORD 1                           S01117
     C**********                                                          S01117
     C**********           READ TABTB10F                 99               S01117
     C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01117
     C********** *IN99     IFEQ '0'                                       S01117
     C                     CALL 'AOMMODR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01117
     C*
     C***IF*FOUND*CHECK*SYSTEM*DATE*FORMAT,*DDMMYY*OR*MMDDYY.*************S01117
     C***********                                                         S01117
     C***********DATF      COMP 'M'                      98MMDDYY, 98 ON  S01117
     C*
     C***SET*ON*IN,70*IF*RETAIL*MODULE*PRESENT*************************** E23408
     C*
     C*********************TESTB'7'       MODI2          70               E23408
     C*                                                                   E23408
     C** SET ON *IN70 IF RETAIL II OR INTEREST ON ACCOUNTS PRESENT        E23408
     C*                                                                   E23408
     C**********           TESTB'7'       MODI2          70RETAIL IIE23408S01117
     C**N70*****           TESTB'2'       MODI5         70I/ACCOUNTSE23408S01117
     C           BGRTBN    IFEQ 'Y'                         RETAIL II     S01117
     C           BGIOAC    OREQ 'Y'                         I/ACCOUNTS    S01117
     C                     SETON                     70                   S01117
     C                     END                                            S01117
     C*
     C**********           ELSE                                           S01117
     C**********                                                          S01117
     C***OTHERWISE DB ERROR                                               S01117
     C**********                                                          S01117
     C**********           SETON                     U7U8  ***************S01117
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
     C**********           MOVEL'TABLE'   DBFILE           ***************S01117
     C**********           MOVEL'01'      ZTABKY 12                       S01117
     C**********           MOVE '10'      ZTABKY                          S01117
     C**********           MOVELZTABKY    DBKEY                           S01117
     C**********           END                                            S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                         88               S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C** IF FOUND CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.             S01117
     C*                                                                   S01117
     C           DATF      COMP 'M'                      98MMDDYY, 98 ON  S01117
     C**********                                                          S01117
     C***GET*INSTALLATION CONTROL DATA RECORD SE                    S01158S01117
     C**********                                                    S01158S01117
     C**********           READ TABTB36F                 99         S01158S01117
     C**N99***** RECI      COMP 'D'                9999ON,IS DELETEDS01158S01117
     C********** *IN99     IFEQ '1'                                 S01158S01117
     C**********           SETON                     U7U8  *********S01158S01117
     C***********          MOVEL'04'      DBASE            **DB ERR S01158S01117
     C**********           MOVEL'TABLE'   DBFILE     ***************S01158S01117
     C**********           MOVEL'01'      ZTABKY 12                 S01158S01117
     C**********           MOVE '36'      ZTABKY                    S01158S01117
     C**********           MOVELZTABKY    DBKEY                     S01158S01117
     C**********           END                                      S01158S01117
     C**********                                                          S01117
     C***GET*CURRENCY RECORD 2 - TABTB40                                  S01117
     C**********                                                          S01117
     C**********           READ TABTB40F                 99               S01117
     C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01117
     C********** *IN99     IFNE '0'                                       S01117
     C**********                                                          S01117
     C***DB*ERROR                                                         S01117
     C**********                                                          S01117
     C**********           SETON                     U7U8  ***************S01117
     C***********          MOVEL'03'      DBASE            **DB ERROR 03**S01117
     C**********           MOVEL'TABSE'   DBFILE           ***************S01117
     C**********           MOVEL'01'      ZTABKY 12                       S01117
     C**********           MOVE '40'      ZTABKY                          S01117
     C**********           MOVELZTABKY    DBKEY                           S01117
     C**********           END                                            S01117
     C                     CALL 'AOTRADR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01117
     C*                                                                   CEU005
      **  Access SAR details file to see if EMU SE Settlement currency    CEU005
      **  conversion is installed.                                        CEU005
      *                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM '       ' @RTCD                           CEU005
     C                     PARM '*VERIFY' @OPTN                           CEU005
     C                     PARM 'CEU005'  @SARD   6                       CEU005
      *                                                                   CEU005
     C           @RTCD     IFEQ *BLANK                                    CEU005
     C                     MOVE 'Y'       CEU005  1                       CEU005
     C                     MOVE *ON       *IN59                           CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'N'       CEU005                          CEU005
     C                     MOVE *OFF      *IN59                           CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C**   Access General Ledger details                                  CEU005
     C*                                                                   CEU005
     C**********           CALL 'AOGELRR0'                                             CEU005 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       CEU005
     C                     PARM '*FIRST ' @OPTN   7                       CEU005
     C********** SDGELR    PARM SDGELR    DSFDY                                        CEU005 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C                     ENDIF                                          CEU005
      *                                                                   185733
      **  Access SAR details file to see if CSE023 is installed           185733
      *                                                                   185733
     C                     CALL 'AOSARDR0'                                185733
     C                     PARM '       ' @RTCD                           185733
     C                     PARM '*VERIFY' @OPTN                           185733
     C                     PARM 'CSE023'  @SARD   6                       185733
      *                                                                   185733
     C           @RTCD     IFEQ *BLANK                                    185733
     C                     MOVE 'Y'       CSE023  1                       185733
     C                     MOVE *ON       *IN69                           185733
     C                     ELSE                                           185733
     C                     MOVE 'N'       CSE023                          185733
     C                     MOVE *OFF      *IN69                           185733
     C                     ENDIF                                          185733
      *                                                                                       CSW201
      ** Call SWIF2001 to check if CSW201 is switched on                                      CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'             1313                                   CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           *IN13     IFEQ *ON                                                           CSW201
     C                     Z-ADD05        DBASE                                               CSW201
     C                     MOVEL'SWIF2001'DBFILE                                              CSW201
     C                     MOVEL'*CALL'   DBKEY                                               CSW201
     C                     MOVE *ON       *INU7                                               CSW201
     C                     MOVE *ON       *INU8                                               CSW201
     C                     MOVE *ON       *IN01                                               CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSE028
      **  Access SAR details file to see if CSE028 is installed                               CSE028
      *                                                                                       CSE028
     C                     CALL 'AOSARDR0'                                                    CSE028
     C                     PARM '       ' @RTCD                                               CSE028
     C                     PARM '*VERIFY' @OPTN                                               CSE028
     C                     PARM 'CSE028'  @SARD                                               CSE028
      *                                                                                       CSE028
     C           @RTCD     IFEQ *BLANK                                                        CSE028
     C                     MOVE 'Y'       CSE028  1                                           CSE028
     C                     MOVE *ON       *IN67                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'N'       CSE028                                              CSE028
     C                     MOVE *OFF      *IN67                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C           BGPFMG    IFEQ 'Y'                                                           CSE028
     C           BGN4ST    OREQ 'Y'                                                           CSE028
     C                     MOVE *ON       *IN64                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE *OFF      *IN64                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE039
      ** Check if Auto-Settlement of Trade Feature is switched ON.                            CSE039
     C                     CALL 'AOSARDR0'                                                    CSE039
     C                     PARM '       ' @RTCD                                               CSE039
     C                     PARM '*VERIFY' @OPTN                                               CSE039
     C                     PARM 'CSE039'  @SARD                                               CSE039
      *                                                                                       CSE039
     C           @RTCD     IFEQ *BLANK                                                        CSE039
     C                     MOVE 'Y'       CSE039  1                                           CSE039
     C                     MOVE *ON       *IN52                                               CSE039
     C                     ELSE                                                               CSE039
     C                     MOVE 'N'       CSE039                                              CSE039
     C                     MOVE *OFF      *IN52                                               CSE039
     C                     ENDIF                                                              CSE039
      *                                                                                       CSE039
      ** Initialise FEATUR to OFF                                         CSE041
     C                     MOVE 'N'       FEATUR                          CSE041
      *                                                                   CSE041
      ** Check if DVP/RVP Processing is switched ON.                      CSE041
     C                     CALL 'AOSARDR0'                                CSE041
     C                     PARM '       ' @RTCD                           CSE041
     C                     PARM '*VERIFY' @OPTN                           CSE041
     C                     PARM 'CSE041'  @SARD                           CSE041
      *                                                                   CSE041
     C           @RTCD     IFEQ *BLANK                                    CSE041
     C                     MOVE 'Y'       CSE041  1                       CSE041
     C                     ELSE                                           CSE041
     C                     MOVE 'N'       CSE041                          CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C           CSE041    IFEQ 'Y'                                       CSE041
     C           CSE039    OREQ 'Y'                                       CSE041
     C                     MOVE 'Y'       FEATUR  1                       CSE041
     C                     ENDIF                                          CSE041
      *                                                                                       CSE039
      *                                                                                       CSE028
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCPG                                           S01408
     C*                                                                   S01408
     C*
     C** PROCEED TO START SCREEN UNLESS DATABASE ERRPR
     C*
     C           *INU7     IFNE '1'
     C                     MOVEA'1'       *IN,10
     C                     END
      *                                                                                       215879
      * Obtain default message file                                                           215879
     C           *NAMVAR   DEFN Y2MGFLA   ZADFMF 10                                           215879
     C                     MOVE *BLANK    WRETK  23                                           211791
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  START  - Subroutine to Output and process Key fields Screen. *
     C*                                                               *
     C*  Called from: Main processing.                                *
     C*  Calls: VALIDK                                                *
     C*                                                               *
     C*****************************************************************
     C*
     C           START     BEGSR                           ** START BSR **
     C*
     C** INITIALISE SCREEN DATA
     C*
     C                     MOVEA'0'       *IN,10
     C                     MOVEA'00000'   *IN,21
     C                     MOVEA'00'      *IN,26                                              CSE028
      *                                                                                      BUG2198
      ** Initialize *IN84                                                                    BUG2198
      *                                                                                      BUG2198
     C                     MOVE *OFF      *IN84                                              BUG2198
      *                                                                                      BUG2198
     C/COPY WNCPYSRC,SE0030C010
     C                     MOVEL*BLANK    SCRCTL
     C*
     C***********          MOVEL*BLANK    SSBRH                           S01158
     C***********          MOVE DSTB      SSBRH                     S01158S01117
     C                     MOVE *BLANK    SSBRH                           S01117
     C                     MOVEL*BLANK    SCSTM
     C                     MOVEL*BLANK    SSIBK                                               CSE028
     C                     MOVEL*BLANK    SCYSI
     C                     MOVEL*BLANK    SSMKT                                               CSE034
     C                     MOVEL*BLANK    SITSI
     C                     MOVEL*BLANK    SSPTFR                                              CSE028
     C/COPY WNCPYSRC,SE0030C011
     C                     MOVE 'N'       WERR1   1                       CEU005
     C                     MOVE *BLANKS   WSSCCY  3                       CEU005
     C                     MOVEL*BLANKS   WTOPK                                             MD037885
     C*
     C** CLEAR WHOLE SCREEN
     C*
     C                     WRITECLSCREEN
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Start Screen Output
      *
     C                     MOVELINF,1     INFMSG
     C                     WRITEKEYINPUT
     C                     WRITEMESSAGES
     C                     READ KEYINPUT                 99
     C                     MOVELERRMSG    HERCD 160
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C*
     C***C*K*1*,*H*E*L*P*,*O*R**E*N*T*E*R***P*R*E*S*S*E*D**-**S*T*A*R*T   S01199
     C** C K 3 , O R  E N T E R   P R E S S E D  -  S T A R T             S01199
     C*
     C** F/3 - TERMINATE
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                                            S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** ENTER TAKEN VALIDATE KEY INPUT
     C*
     C                     ELSE
     C*                                                                   S01117
     C** CHECK FOR SELECTION                                              S01117
     C*                                                                   S01117
     C                     EXSR CKKSEL                                    S01117
     C           @SEL      IFEQ 'N'                                       S01117
     C*                                                                   S01117
     C** IF NO SELECTION THEN VALIDATE KEY FIELDS ELSE REDISPLAY SCREEN   S01117
     C*                                                                   S01117
     C                     EXSR VALIDK
      *
      ***  Determine Screen Change
      *
     C** IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           SCRMSG    IFEQ *BLANK
     C           WREDSP    ANDNE'Y'                                                           215782
     C*
     C**  - IF KEY FIELD IS BLANK, NEXT SCREEN IS REVIEW SCREEN
     C*
     C***********SBRH      IFEQ *ZERO                                     S01158
     C           SCSTM     IFEQ *BLANKS                                   S01158
     C           SSIBK     ANDEQ*BLANKS                                                       CSE028
     C                     MOVEA'1'       *IN,11
     C*
     C**  - OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C                     END
     C*
     C***********          END                                            S01199
     C*
     C                     END                                            S01117
     C*                                                                   S01117
     C***C*K*1*,*H*E*L*P*,*O*R**E*N*T*E*R***P*R*E*S*S*E*D**-**E*N*D       S01199
     C** C K 3 , O R  E N T E R   P R E S S E D  -  E N D                 S01199
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  REVIEW - Subroutine to process Subfile Selection Screen.     *
      *                                                               *
      *  Called from: Main Processing.                                *
      *  Calls: VALIDK                                                *
      *                                                               *
      *****************************************************************
      *
     C           REVIEW    BEGSR                           ** REVIEW BSR**
     C*
     C                     MOVEA'0'       *IN,11
     C*
     C** SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C**********           MOVEL'RA'      AID                                                 211791
     C                     MOVEL'RA'      AID     2                                           211791
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
     C** I F  R O L L   U P / D O W N   O R   E N T E R   P R E S S E D
     C*
     C** R E B U I L D   S U B F I L E                     -  S T A R T
     C*
     C           AID       IFEQ 'DN'
     C           AID       OREQ 'UP'
     C           AID       OREQ 'RA'
     C*
     C** WRITE CONTROL RECORD
     C*
     C                     MOVEA'000'     *IN,1
     C                     Z-ADD*ZERO     RRN
     C                     WRITESUBFLCTL
     C                     MOVEA'1'       *IN,4
     C                     MOVE '0'       *IN53                                               211791
     C*
     C** SET FILE POINTER - PAGE BACK
     C*
     C           AID       IFEQ 'DN'
     C***********          MOVEL*BLANK    SBRH                            S01117
     C**********           MOVEL*BLANK    SBRA                                         S01117 211791
     C**********           MOVEL*BLANK    CSTM                                                211791
     C**********           MOVEL*BLANK    SIBK                                         CSE028 211791
     C**********           MOVEL*BLANK    CYSI                                                211791
     C**********           MOVEL*BLANK    SMKT                                         CSE034 211791
     C**********           MOVEL*BLANK    SPTFR                                        CSE028 211791
     C**********           MOVEL*BLANK    PPAGK 012                       E15219
     C/COPY WNCPYSRC,SE0030C012
     C**********           MOVEL*BLANK    PPAGK 015                                    E15219 211791
     C/COPY WNCPYSRC,SE0030C013
     C                     MOVE WTOPK     INPK                                                211791
     C***********STDSEK    SETLLSTDSEX                                                        215878
     C           STDADK    SETLLSTDSEDFL                                                      215878
     C*
      ** Read previous subfile page if no selection is made.                                  211791
      *                                                                                       211791
     C********** PAGK      IFEQ *BLANK                                               211791 AR970395
     C**********           Z-ADD0         I       20                                 211791 MD037885
     C                     Z-ADD1         I       20                                        MD037885
     C           I         DOWLT19                                                            211791
     C           *IN53     ANDEQ'0'                                                           211791
     C**********           READPSTDSEX                   53                          211791 MD037885
     C                     READPSTDSEDFL                 53                                 MD037885
     C                     ADD  1         I                                                   211791
     C                     ENDDO                                                              211791
     C           *IN53     IFEQ '1'                                                           211791
      *                                                                                     MD037885
      ** Read previous record                                                               MD037885
      *                                                                                     MD037885
     C                     MOVEL'0'       *IN53                                             MD037885
     C                     Z-ADD1         I                                                 MD037885
     C           I         DOWLT19                                                          MD037885
     C           *IN53     ANDEQ'0'                                                         MD037885
     C                     READPSTDSEDFL                 53                                 MD037885
     C                     ADD  1         I                                                 MD037885
     C                     ENDDO                                                            MD037885
     C           STDSEK    SETLLSTDSEX                                                      MD037885
     C           STDADK    SETLLSTDSEDFL                                                    MD037885
     C********** *LOVAL    SETLLSTDSEX                                               211791 MD037885
     C                     ELSE                                                             MD037885
     C           STDSEK    SETLLSTDSEX                                                      MD037885
     C           STDADK    SETLLSTDSEDFL                                                    MD037885
     C                     ENDIF                                                              211791
     C**********           ENDIF                                                     211791 AR970395
     C*                                                                                       211791
     C** OTHERWISE        - PAGE FORWARD
     C*
     C                     ELSE
     C***********          MOVELPSBRH     SBRH                            S01117
     C           PAGK      IFNE *BLANK                                                        211791
     C           AID       ANDEQ'RA'                                                        AR970395
     C                     MOVELPSBRH     SBRA                            S01117
     C                     MOVELPCSTM     CSTM
     C                     MOVELPSIBK     SIBK                                                CSE028
     C                     MOVELPCYSI     CYSI
     C                     MOVELPSMKT     SMKT                                                CSE034
     C                     MOVELPITSI     ITSI                            E15219
     C                     MOVELPSPTFR    SPTFR                                               CSE028
     C                     ENDIF                                                              211791
     C/COPY WNCPYSRC,SE0030C014
     C**********           MOVELPAGK      PPAGK                                               211791
     C           PAGK      IFEQ *BLANK                                                        211791
     C           AID       ANDEQ'RA'                                                          211791
     C           WRETK     IFEQ *BLANK                                                        211791
     C           WTOPK     IFNE *BLANKS                                                     MD037885
     C                     MOVE WTOPK     INPK                                              MD037885
     C           STDSEK    SETLLSTDSEX                                                      MD037885
     C           STDADK    SETLLSTDSEDFL                                                    MD037885
     C                     ELSE                                                             MD037885
     C********** *LOVAL    SETLLSTDSEX                                               211791 AR970395
     C           *LOVAL    SETLLSTDSEDFL                                                    BUG13200
     C                     ENDIF                                                            MD037885
     C                     ELSE                                                               211791
     C                     MOVE WRETK     INPK                                                211791
     C                     MOVE *BLANK    WRETK                                               211791
     C           STDSEK    SETLLSTDSEX                                                        211791
     C           STDADK    SETLLSTDSEDFL                                                    MD037885
     C                     ENDIF                                                              211791
     C                     ELSE                                                               211791
     C***********STDSEK    SETLLSTDSEX                                                        215878
     C           STDADK    SETLLSTDSEDFL                                                      215878
     C                     ENDIF                                                              211791
     C                     END
     C*
     C** READ IN DETAILS-FILL UP SUBFILE
     C*
     C           RRN       DOUEQ18
     C           *IN,03    OREQ '1'
     C*
     C** READ DETAILS UNTIL SUBFILE PAGE IS FULL
     C*
     C***********          READ STDSEX                   03                                   215878
     C**********           READ STDSEDFL                 03                          215878 AR970395
     C                     READ STDSEDFL            N    03                                 AR970395
     C           *IN,03    IFEQ '0'
     C*                                                                   S01117
     C** CHECK USER HAS AUTHORITY TO BRANCH IF MULTIBRANCHING             S01117
     C*                                                                   S01117
     C           *IN88     IFEQ '1'                                       S01117
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM SBRA      ZBRCDX  3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     GOTO BYPASS                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C** IF RECORD IS DELETED, FLAG IT AS SO ON SCREEN
     C*
     C           RECI      IFEQ '*'
     C                     MOVEL'D'       STAT    1
     C                     ELSE
     C                     MOVEL*BLANK    STAT
     C                     END
     C*
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           CSE028    OREQ 'N'                                                           CSE028
     C********** CSTM      ANDNE*ZERO                                                  CSE028 CSD027
     C           CSTM      ANDNE*BLANKS                                                       CSD027
      *                                                                                       CSE028
     C                     ADD  1         RRN     40     04
     C           RRN       IFEQ 1                                                             211791
     C                     MOVE *BLANKS   WTOPK  23                                           211791
     C                     MOVE INPK      WTOPK                                               211791
     C                     ENDIF                                                              211791
     C*
     C                     WRITESUBFLREC
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
     C*                                                                   S01117
     C           BYPASS    TAG                                            S01117
     C*
     C** RECORD NOW WRITTEN TO SUBFILE
     C*
     C                     END
     C*
     C** PAGE NOW FULL (OR EOF)
     C*
     C                     END
     C*
     C** READ ONE MORE RECORD FOR NEXT SCREEN
     C*
     C********** *IN,03    IFEQ '0'                                                         AR970395
     C***********          READ STDSEX                   03                                   215878
     C**********           READ STDSEDFL                 03                          215878 AR970395
     C**********           READ STDSEDFL            N    03                                 AR970395
     C**********           END                                                              AR970395
     C*
     C** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C********** *IN,03    IFEQ '0'                                                           211791
     C**********           MOVELINPK      PAGK                                                211791
     C**********           ELSE                                                               211791
     C**********           MOVEL*BLANK    PAGK                                                211791
     C**********           END                                                                211791
     C*
     C** FOR SUBFILE CONTROL
     C*
     C           *IN,4     IFEQ '1'
     C                     MOVEA'010'     *IN,1
     C                     ELSE
     C                     MOVEA'11'      *IN,1
     C                     END
     C                     END
     C*
     C** R E B U I L D   S U B F I L E     -     E N D
      *
      ***  Review Screen Output
      *
     C                     MOVELINF,2     INFMSG
     C                     WRITESUBFLCTL
     C           *IN,4     IFEQ '1'
     C                     WRITENORECS
     C                     END
     C                     WRITEMESSAGES
     C                     READ SUBFLCTL                 99
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C                     MOVEL*BLANK    REVW
     C                     MOVEL'0'       *IN83                                             MD037885
     C*
     C***C*K*1*,*C*K*5*,*H*E*L*P*,*R*E*C*O*R*D**S*E*L*E*C*T-**S*T*A*R*T   S01199
     C** C K 3 , C K 5 , R E C O R D  S E L E C T-  S T A R T             S01199
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C** F/3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,11
     C*
     C** F/12- INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                                            S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,99
     C           *IN,04    IFEQ '0'
     C                     READCSUBFLREC                 99
     C                     END
      *
      ***  Record Select Validation
      *
     C           *IN99     IFEQ '0'
     C*
     C** MOVE KEY FIELDS TO SCREEN KEY FIELDS FOR VALIDATION
     C*
     C***********          MOVELSBRH      SSBRH                           S01117
     C                     MOVELSBRA      SSBRH                           S01117
     C********** CSTM      IFNE *ZERO                                                  CSE028 CSD027
      *                                                                                     MD037885
      ** Initialiase if Action code = Blanks                                                MD037885
      *                                                                                     MD037885
     C           ACTN      IFEQ *BLANKS                                                     MD037885
     C                     MOVEL*BLANKS   CSTM                                              MD037885
     C                     MOVEL*BLANKS   SIBK                                              MD037885
     C                     MOVEL*BLANKS   CYSI                                              MD037885
     C                     MOVEL*BLANKS   SMKT                                              MD037885
     C                     MOVEL*BLANKS   ITSI                                              MD037885
     C                     MOVEL*BLANKS   SPTFR                                             MD037885
     C                     ENDIF                                                            MD037885
     C           CSTM      IFNE *BLANKS                                                       CSD027
     C                     MOVELCSTM      SCSTM
     C                     ELSE                                                               CSE028
     C                     MOVEL*BLANKS   SCSTM                                               CSE028
     C                     ENDIF                                                              CSE028
     C                     MOVELSIBK      SSIBK                                               CSE028
     C                     MOVELCYSI      SCYSI
     C                     MOVELSMKT      SSMKT                                               CSE034
     C                     MOVELITSI      SITSI
     C                     MOVELSPTFR     SSPTFR                                              CSE028
     C/COPY WNCPYSRC,SE0030C015
     C*                                                                   S01117
     C** CHECK FOR SELECTION                                              S01117
     C*                                                                   S01117
     C                     EXSR CKKSEL                                    S01117
     C           @SEL      IFEQ 'N'                                       S01117
     C*                                                                   S01117
     C** IF NO SELECTION THEN VALIDATE KEY FIELDS ELSE REDISPLAY SCREEN   S01117
     C*
     C                     EXSR VALIDK
     C*
     C** NO ERRORS, UPDATE SCREEN CAN BE PROCESSED NEXT
     C*
     C           SCRMSG    IFEQ *BLANK
     C           ACTN      ANDNE*BLANKS                                                     MD037885
     C                     MOVEA'1'       *IN,12
     C                     MOVEL'Y'       REVW
     C                     END
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END
     C*
     C***********          END                                            S01199
     C                     END
     C*
     C***C*K*1*,*C*K*5*,*H*E*L*P*,*R*E*C*O*R*D**S*E*L*E*C*T*-*E*N*D       S01199
     C** C K 3 , C K 5 , R E C O R D  S E L E C T - E N D                 S01199
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N   - S T A R T
     C                     END
     C*
     C                     ENDSR
      *
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  UPDATE - Subroutine to process Detail Screen and Update File.*
     C*                                                               *
     C*  Called from: Main Processing.                                *
     C*  Calls: VALIDD, UPDFLS, INITRC, TRSFS                         *
     C*                                                               *
     C*****************************************************************
     C*
     C           UPDATE    BEGSR                           ** UPDATE BSR**
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     MOVEA'1'       *IN,5
     C                     MOVEA'0'       *IN,12
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     MOVEA'00000000'*IN,30                          CEU005
     C                     MOVEA'0011'    *IN,56                          CEU005
     C                     ELSE                                           CEU005
     C                     MOVEA'10000000'*IN,30
     C                     ENDIF                                          CEU005
     C                     MOVEA'00000000'*IN,38
      *                                                                                     BUG10905
      ** Indicator 52 must not be reset here. It is used to condition                       BUG10905
      ** display of 'Auto-Settle Indicator' field when feature CSE039                       BUG10905
      ** is switched on.                                                                    BUG10905
     C*********************MOVEA'0000000' *IN,46                                            BUG10905
     C                     MOVEA'000000'  *IN,46                                            BUG10905
     C*
     C** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
     C** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
     C*
     C                     Z-ADD*ZERO     STNLU   50
     C********** STDSEK    CHAINSTDSEX               99                                       CSE034
     C********** STDADK    CHAINSTDSEDFL             99                             CSE034  AR970395
     C           STDADK    CHAINSTDSEDFL            N99                                     AR970395
     C           *IN,99    IFEQ '0'
     C                     Z-ADDTNLU      STNLU
     C                     END
     C*
     C** IF INSERT (NEW OR OVER DELETED RECORD)
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C           ACTN      IFEQ 'I'
     C                     EXSR INITRC
      *                                                                                       CSE039
      ** Default the Auto-Settle Indicator with the value held on the                         CSE039
      *  Securities Customer Details                                                          CSE039
     C           CSE039    IFEQ 'Y'                                                           CSE039
     C                     MOVE BFASIN    SSASI                                               CSE039
     C                     ENDIF                                                              CSE039
      *                                                                                       CSE039
     C                     END
     C*
     C** IF DELETED RECORD-ENQUIRY ONLY (RECI IS SET TO BLANK FOR INSERTS)
     C*
     C           RECI      IFEQ '*'
     C                     MOVEL'E'       ACTN
     C                     MOVEL'DELETED' DELT    7
     C                     ELSE
     C                     MOVEL*BLANK    DELT
     C                     END
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C                     EXSR TRSFS
     C*
     C** IF DELETE/ENQUIRY PROTECT FIELD INPUT ON S/RECDETLS
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'E'
     C                     MOVEA'1'       *IN,6
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Load Up Info Messages
      *
     C           INFMSG    IFEQ *BLANK
     C           ACTN      IFEQ 'I'
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           SSIBK     ANDNE*BLANKS                                                       CSE028
     C           CSE028    OREQ 'Y'                                                           CSE028
     C           WCSTFL    ANDEQ'Y'                                                           CSE028
     C                     MOVEL'SE10006' PMSGID                                              CSE028
     C                     EXSR SRRTXT                                                        CSE028
     C                     MOVELPMSGTX    INFMSG                                              CSE028
     C                     MOVE '1'       *IN63                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVELINF,3     INFMSG
     C                     ENDIF                                                              CSE028
     C                     MOVE '0'       *IN07                                               CSE028
     C                     END
     C           ACTN      IFEQ 'A'
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           SSIBK     ANDNE*BLANKS                                                       CSE028
     C           CSE028    OREQ 'Y'                                                           CSE028
     C           WCSTFL    ANDEQ'Y'                                                           CSE028
     C                     MOVEL'SE10007' PMSGID                                              CSE028
     C                     EXSR SRRTXT                                                        CSE028
     C                     MOVELPMSGTX    INFMSG                                              CSE028
     C                     MOVE '1'       *IN63                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVELINF,4     INFMSG
     C                     ENDIF                                                              CSE028
     C                     MOVE '0'       *IN07                                               CSE028
     C                     END
     C           ACTN      IFEQ 'E'
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           SSIBK     ANDNE*BLANKS                                                       CSE028
     C           CSE028    OREQ 'Y'                                                           CSE028
     C           WCSTFL    ANDEQ'Y'                                                           CSE028
     C                     MOVEL'SE10008' PMSGID                                              CSE028
     C                     EXSR SRRTXT                                                        CSE028
     C                     MOVELPMSGTX    INFMSG                                              CSE028
     C                     MOVE '1'       *IN63                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVELINF,5     INFMSG
     C                     ENDIF                                                              CSE028
     C                     MOVE '0'       *IN07                                               CSE028
     C                     END
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,6     INFMSG
     C                     MOVE '1'       *IN07                                               CSE028
     C                     END
     C                     END
      *
      ***  Detail Screen Output
      *
     C                     WRITEKEYINPUT
     C                     WRITERECDETLS
     C                     WRITEMESSAGES
     C                     READ RECDETLS                 99
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           WEC       ANDEQEC                                        CEU005
     C                     MOVEL*BLANKS   ERRMSG                          CEU005
     C                     ENDIF                                          CEU005
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C*
     C***C*K*1*,*C*K*5*,*H*E*L*P*,*R*O*L*L*U*P*/*D*O*W*N***-**S*T*A*R*T   S01199
     C** C K 1 , C K 5 , R O L L U P / D O W N   -  S T A R T             S01199
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C** F/3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,12
     C*
     C** F/12- INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
      *                                                                                       CSE028
      ** F8 Taken                                                                             CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
     C           AID       IFEQ 'F8'                                                          CSE028
     C                     EXSR SRSSIS                                                        CSE028
      *                                                                                       CSE028
     C*
     C***HELP***CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                                            S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** PAGE FORWARD TAKEN, READ NEXT RECORD
     C*
     C                     ELSE
     C           AID       IFEQ 'UP'
     C           ACTN      ANDNE'I'
     C                     READ STDSEX                   12
     C*
     C** CHANGE MESSAGE IF END OF FILE REACHED - NO ROLL FWD
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,7     INFMSG
     C                     MOVE *ON       *IN84                                              BUG2198
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C** PAGE BACK TAKEN, READ PREVIOUS RECORD
     C*
     C                     ELSE
     C           AID       IFEQ 'DN'
     C           ACTN      ANDNE'I'
     C                     READPSTDSEX                   12
     C*
     C** CHANGE MESSAGE IF BEGINNING OF FILE REACHED - NO ROLL BACK
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,8     INFMSG
     C                     MOVE *ON       *IN84                                              BUG2198
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C***NOT*F/3*F/12*HELP*ROLLUP*ROLLDOWN*****************************   S01199
     C** NOT F/3,F/12,ROLLUP,ROLLDOWN                                     S01199
     C*
     C                     ELSE
     C*                                                                   S01117
     C** CHECK FOR SELECTION                                              S01117
     C*                                                                   S01117
     C                     EXSR CKDSEL                                    S01117
     C           @SEL      IFEQ 'N'                                       S01117
      *
      ***  Validate Detail Screen Input
      *
     C                     EXSR VALIDD
      *
     C/COPY WNCPYSRC,SE0030C003
      ***  If no Detail Screen Errors
      *
     C           SCRMSG    IFEQ *BLANK
     C/COPY WNCPYSRC,SE0030C005
     C           AID       ANDEQ'RA'
     C/COPY WNCPYSRC,SE0030C007
      *
      ** FOR REC.ADVANCE DETERMINE WHAT SCREEN TO RETURN TO
      *
     C           REVW      IFEQ 'Y'
     C**********           MOVELPPAGK     PAGK                                                211791
     C           PAGK      IFEQ *BLANK                                                        211791
     C           AID       ANDNE'RA'                                                        MD037885
     C                     MOVE WTOPK     WRETK                                               211791
     C                     ENDIF                                                              211791
     C                     MOVEA'1'       *IN,11
     C                     ELSE
     C                     MOVEA'1'       *IN,10
     C                     END
     C*
     C**     U  P  D  A  T  E      F  I  L  E  S
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C           ACTN      OREQ 'D'
     C                     EXSR UPDFLS
     C                     END
     C/COPY WNCPYSRC,SE0030C006
     C*
      ***  End of If no Detail Screen Errors
     C                     END
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C***C*K*1*,*C*K*5*,*H*E*L*P*,*R*O*L*L*U*P*/*D*O*W*N***-**E*N*D
      ***  End of If/Else AID = 'DN', not Insert                          S01199
     C                     END
      ***  End of If/Else AID = 'UP', not Insert
     C                     END
     C***********          END                                            S01199
      ***  End of If/Else AID = '05'
     C                     END
      *                                                                                       CSE028
      ** End of If/Else AID = 'F8'                                                            CSE028
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      ***  End of If/Else AID = '01'
     C                     END
     C*
     C** MOVE KEY FIELDS TO SCREEN KEY FIELDS
     C*
     C***********          MOVELSBRH      SSBRH                           S01117
     C                     MOVELSBRA      SSBRH                           S01117
     C                     MOVELCSTM      SCSTM
     C                     MOVELSIBK      SSIBK                                               CSE028
     C                     MOVELCYSI      SCYSI
     C                     MOVELSMKT      SSMKT                                               CSE034
     C                     MOVELITSI      SITSI
     C                     MOVELSPTFR     SSPTFR                                              CSE028
     C/COPY WNCPYSRC,SE0030C016
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
     C                     END
     C*
     C** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVEA'00'      *IN,5
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              S01179
      *****************************************************************   S01179
      *                                                               *   S01179
      **           ****** AS400 CONVERSION ******                     *   S01179
      **                                                              *   S01179
      ** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,    *   S01179
      ** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.            *   S01179
      ** CALLED FROM UPDATE                                           *   S01179
      **                                                              *   S01179
     C*****************************************************************   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN20     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
      *                                                                                       CSE028
      ** If F8                                                                                CSE028
      *                                                                                       CSE028
     C           *INKH     IFEQ '1'                                                           CSE028
     C           CSE028    ANDEQ'Y'                                                           CSE028
     C           *IN63     ANDEQ'1'                                                           CSE028
     C                     MOVE 'F8'      AID                                                 CSE028
     C                     MOVE '0'       *INKH                                               CSE028
     C                     MOVE '0'       *IN63                                               CSE028
     C                     ENDIF                                                              CSE028
     C*                                                                   S01179
     C* If F10                                                            S01179
     C*                                                                   S01179
     C           *INKJ     IFEQ '1'                                       S01179
     C                     MOVE '04'      AID                             S01179
     C                     MOVE '0'       *INKJ                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN65     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN65                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLDOWN pressed                                               S01179
     C*                                                                   S01179
     C           *IN66     IFEQ '1'                                       S01179
     C                     MOVE 'DN'      AID                             S01179
     C                     MOVE '0'       *IN66                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key*pressed*************************************** S01179 S01199
     C************                                                 S01179 S01199
     C************IN67     IFEQ '1'                                S01179 S01199
     C************         MOVE 'HP'      AID                      S01179 S01199
     C************         MOVE '0'       *IN67                    S01179 S01199
     C************         END                                     S01179 S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  VALIDK - Subroutine to Validate Key fields.                  *
     C*                                                               *
     C*  Called from: START, REVIEW                                   *
     C*  Calls: VALCST                                                *
     C*                                                               *
     C*****************************************************************
      *
     C           VALIDK    BEGSR                           ** VALIDK BSR**
     C*
     C** RESET ERROR INDICATORS
     C** SET ERROR ARRAY COUNTER TO ZERO
     C*
     C                     SETOF                     29                                       255419
     C                     MOVEA'00000'   *IN,21
     C                     MOVEA'00'      *IN,26                                              CSE028
     C/COPY WNCPYSRC,SE0030C017
     C                     Z-ADD*ZERO     EC      40
     C                     Z-ADD*ZERO     WEC     40                      CEU005
     C                     MOVE 'N'       WREDSP  1                                           215782
      *                                                                                      BUG2198
      ** Reset Indicator for INFMSG                                                          BUG2198
      *                                                                                      BUG2198
     C                     MOVE *OFF      *IN84                                              BUG2198
      *                                                                                      BUG2198
     C*
     C** A C T I O N    C O D E    I N P U T - MUST BE BLANK,I,A,E,D
     C*
     C           ACTN      IFNE *BLANK
     C           ACTN      ANDNE'I'
     C           ACTN      ANDNE'A'
     C           ACTN      ANDNE'E'
     C           ACTN      ANDNE'D'
     C                     MOVEA'1'       *IN,21
     C                     SETON                     29                                       255419
     C                     END
     C*
     C** CHECK FOR ACTION CODE BLANK BUT KEY INPUT
     C*
     C           ACTN      IFEQ *BLANK
     C*
     C           SCSTM     IFNE *BLANK
     C***********SSBRH     ORNE *BLANK                                    S01158
     C           SCYSI     ORNE *BLANK
     C           SSMKT     ORNE *BLANK                                                        CSE034
     C           SITSI     ORNE *BLANK
     C           SSIBK     ORNE *BLANK                                                        CSE028
     C/COPY WNCPYSRC,SE0030C018
     C                     MOVEA'11111'   *IN,21
     C                     MOVEA'11'      *IN,26                                              CSE028
     C                     SETON                     29                                       255419
     C/COPY WNCPYSRC,SE0030C019
     C                     END
     C*
     C                     ELSE
     C*
     C** CHECK FOR ACTION CODE INPUT BUT KEY BLANK
     C*
     C           SCSTM     IFEQ *BLANK
     C           CSE028    ANDEQ'N'                                                           CSE028
     C           CSE028    OREQ 'Y'                                                           CSE028
     C           SCSTM     ANDEQ*BLANK                                                        CSE028
     C           SSIBK     ANDEQ*BLANK                                                        CSE028
     C***********SSBRH     OREQ *BLANK                                    S01117
     C           FEATUR    OREQ 'Y'                                       E14541              CSE041
     C           SITSI     ANDEQ*BLANK                                                        CSE041
     C           SCYSI     ANDEQ*BLANK                                                        CSE041
     C           SCYSI     OREQ *BLANK                                    E14541
     C           SCYSI     IFEQ *BLANK                                                        215782
     C           SITSI     ANDNE'?'                                                           215782
     C                     MOVEA'11111'   *IN,21
     C                     MOVEA'11'      *IN,26                                              CSE028
     C/COPY WNCPYSRC,SE0030C020
     C                     ENDIF                                                              215782
     C                     END
     C*
     C                     END
     C*
     C           *IN,21    IFEQ '1'
     C                     ADD  1         EC         21
     C                     MOVEL' 100'    ERR,EC
     C                     END
     C*
     C** A C T I O N    C O D E    I   I N P U T - CHECK KEY FIELDS
     C*
     C           *IN,21    IFNE '1'
     C*
     C** CONVERT CUSTOMER NO/SHORTNAME TO NUMBER
     C*
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           SCSTM     ANDNE*BLANKS                                                       CSE028
     C           CSE028    OREQ 'N'                                                           CSE028
      *                                                                                       CSE028
     C**********           MOVELSCSTM     WINCNO 12                                           CGL029
     C                     MOVELSCSTM     WINCNO 18                                           CGL029
     C                     MOVEL'N'       WNOSTR  1
     C                     Z-ADD99        WI      20
     C                     EXSR VALCST
     C*
     C** MOVE CUSTOMER NO TO SCREEN
     C*
     C           *IN,99    IFNE '1'
     C                     MOVEL*BLANK    SCSTM
     C**********           MOVELCNUM      SCSTM                           S01117
     C                     MOVELBFCUST    SCSTM                           S01117
     C                     END
     C*
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C***********ACTN      IFEQ 'I'                                       E14541
     C           ACTN      IFNE *BLANK                                    E14541
     C*
     C                     MOVEL*HIVAL    WC1DI   1
     C*
     C** VALIDATE CUSTOMER NO/SHORTNAME (IN99 SET IF NOT VALID)
     C*
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           SCSTM     ANDNE*BLANKS                                                       CSE028
     C           CSE028    OREQ 'N'                                                           CSE028
      *                                                                                       CSE028
     C           *IN,99    IFEQ '1'
     C           ACTN      ANDNE'D'                                       180544
     C           ACTN      ANDNE'E'                                                         MD037885
     C                     ADD  1         EC         22
     C                     MOVEL' 102'    ERR,EC
     C                     ELSE
     C*
     C** STORE DISCRETIONARY INDICATOR IF FOUND
     C*
     C**********           MOVELC1DI      WC1DI                           S01117
     C                     MOVELBFCLAS    WC1DI                           S01117
     C                     END
      *                                                                                       CSE028
      ** Check customer classification and move 'Y' to WCSTFL if 'I', 'S',                    CSE028
      ** 'D' or 'M' and CSE028 is on.                                                         CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           BFCLAS    IFEQ 'I'                                                           CSE028
     C           BFCLAS    OREQ 'S'                                                           CSE028
     C           BFCLAS    OREQ 'D'                                                           CSE028
     C           BFCLAS    OREQ 'M'                                                           CSE028
     C                     MOVE 'Y'       WCSTFL  1                                           CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'N'       WCSTFL                                              CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE0030C028
      *                                                                                       CSE028
      ** Validate Book Code                                                                   CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           SSIBK     IFNE *BLANKS                                                       CSE028
     C           SCSTM     ANDNE*BLANKS                                                       CSE028
     C                     ADD  1         EC                                                  CSE028
     C                     MOVEL' 309'    ERR,EC                                              CSE028
     C                     MOVE '1'       *IN22                                               CSE028
     C                     MOVE '1'       *IN26                                               CSE028
     C                     ELSE                                                               CSE028
     C           SSIBK     IFEQ *BLANKS                                                       CSE028
     C           SCSTM     ANDEQ*BLANKS                                                       CSE028
     C                     ADD  1         EC                                                  CSE028
     C                     MOVEL' 310'    ERR,EC                                              CSE028
     C                     MOVE '1'       *IN22                                               CSE028
     C                     MOVE '1'       *IN26                                               CSE028
     C                     ELSE                                                               CSE028
     C           SSIBK     IFNE *BLANKS                                                       CSE028
      *                                                                                       CSE028
     C                     CALL 'AOBOOKR0'                                                    CSE028
     C                     PARM *BLANKS   @RTCD                                               CSE028
     C                     PARM '*KEY   ' @OPTN                                               CSE028
     C                     PARM           SSIBK                                               CSE028
     C           SDBOOK    PARM SDBOOK    DSFDY                                               CSE028
      *                                                                                       CSE028
     C           @RTCD     IFNE *BLANKS                                                       CSE028
     C                     ADD  1         EC                                                  CSE028
     C                     MOVEL' 311'    ERR,EC                                              CSE028
     C                     MOVE '1'       *IN26                                               CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
     C*
     C**CURRENCY*MUST*BE*ON*TABTG10***************************************S01117
     C* CURRENCY MUST BE ON SDCURRPD                                      S01117
     C***********          Z-ADD20        RECT                            S01117
     C***********          MOVEL*BLANK    ZZ008                           S01117
     C***********          MOVELSCYSI     TCCY                            S01117
     C***********          MOVE '1'       TABKEY                          S01117
     C***********TABKEY    CHAINTABTG10F             23                   S01117
     C***********                                                         S01117
     C************IN,23    IFEQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********DCCY      OREQ 'N'                                 E17195S01117
     C***********          MOVEA'1'       *IN,23                          S01117
     C***********          END                             *IN,23 = 0     S01117
     C***********                                                         S01117
     C************IN,23    IFEQ '1'                                       S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEL' 103'    ERR,EC                          S01117
     C***********          END                             *IN,23 = 1     S01117
     C*                                                                   S01117
     C* VALIDATE MARKET CENTRE                                            S01117
     C*                                                                   CSE041
     C           FEATUR    IFEQ 'Y'                                       CSE041
     C           BFCLAS    ANDEQ'M'                                       CSE041
     C           SCYSI     IFEQ *BLANKS                                   CSE041
     C           SITSI     ANDNE*BLANKS                                   CSE041
     C           SITSI     CHAININVTO                99                   CSE041
     C           *IN99     IFEQ *ON                                       CSE041
     C                     ADD  1         EC         24                   CSE041
     C                     MOVEL' 104'    ERR,EC                          CSE041
     C                     ENDIF                                          CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C                     ELSE                                           CSE041
      *                                                                   CSE041
     C           SCYSI     IFNE *BLANKS                                                       215782
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SCYSI     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,23                          S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEL' 103'    ERR,EC                          S01117
     C                     ELSE                                           S01117
     C                     MOVE A6CYCD    SCYSI                           S01117
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           *LIKE     DEFN A6CYCD    W#CYCD                          CEU005
     C                     MOVE A6CYCD    W#CYCD                          CEU005
     C           *LIKE     DEFN A6INCY    W#INCY                          CEU005
     C                     MOVE A6INCY    W#INCY                          CEU005
     C                     ENDIF                                          CEU005
     C                     END                                            S01117
     C                     ENDIF                                                              215782
     C*                                                                   S01117
     C                     ENDIF                                          CSE041
      *                                                                                       CSE034
     C           SSMKT     IFNE *BLANKS                                                       CSE034
     C                     MOVELSSMKT     WQMK    1                                           215782
     C           WQMK      IFEQ '?'                                                           215782
     C                     MOVELSSMKT     @MKT                                                215782
     C                     CALL 'SE0015'                                                      215782
     C                     PARM           @MKT    2                                           215782
     C           @MKT      IFNE *BLANKS                                                       215782
     C                     MOVE @MKT      SSMKT                                               215782
     C                     ELSE                                                               215782
     C                     MOVE *BLANKS   SSMKT                                               215782
     C                     ENDIF                                                              215782
     C                     MOVE 'Y'       WREDSP                                              215782
     C                     ENDIF                                                              215782
      *                                                                                       215782
     C           SSMKT     CHAINSEMKCDF              99                                       CSE034
      *                                                                                       CSE034
     C           *IN99     IFEQ *ON                                                           CSE034
     C**********           MOVE '1'       *IN24                                        CSE034 210160
     C                     MOVE '1'       *IN28                                               210160
     C                     ADD  1         EC                                                  CSE034
     C                     MOVEL' 107'    ERR,EC                                              CSE034
     C                     ELSE                                                               CSE034
     C                     MOVELMRKT      SSMKT                                               CSE034
     C                     ENDIF                                                              CSE034
     C                     ENDIF                                                              CSE034
     C*
     C** INVESTMENT TYPE MUST ONLY BE ENTERED IF DISCRET. IND(CLINTSE)
     C***=*'M'*or*'E',*'C',*'K'*or*'X'.********************************** E21541              CSE022
      ** = 'M' or 'E', 'C', or 'X'.                                                           CSE022
     C*
     C           FEATUR    IFEQ 'Y'                                       CSE041
     C           WC1DI     ANDEQ'M'                                       CSE041
     C           SITSI     ANDNE*BLANKS                                   CSE041
     C           SCYSI     ANDEQ*BLANKS                                   CSE041
     C                     MOVEA'0'       *IN,24                          CSE041
     C                     ELSE                                           CSE041
     C*                                                                   CSE041
     C***********WC1DI     IFNE 'M'                                       E17192
     C**N22******WC1DI     IFNE 'M'                                E17192 E21541
      *                                                                   E21541
     C           *IN22     IFEQ '0'                                       E21541
     C           WC1DI     IFNE 'M'                                       E21541
     C/COPY WNCPYSRC,SE0030C001
     C           WC1DI     ANDNE'E'                                       E21541
     C           WC1DI     ANDNE'C'                                       E21541
     C********** WC1DI     ANDNE'K'                                       E21541              CSE022
     C           WC1DI     ANDNE'X'                                       E21541
     C           CSE028    ANDNE'Y'                                                           CSE028
     C/COPY WNCPYSRC,SE0030C002
     C*
     C           SITSI     IFNE *BLANK
     C                     ADD  1         EC         24
     C                     MOVEL' 104'    ERR,EC
     C                     END
     C*
     C                     ELSE
     C*
     C           SITSI     IFEQ *BLANK
     C           WC1DI     IFEQ 'M'                                       103357
     C           CSE028    ANDNE'Y'                                                           204590
     C                     MOVEA'1'       *IN,24
     C                     END                                            103357
     C                     ELSE
     C*
     C                     MOVELSITSI     WQMK                                                215782
     C           WQMK      IFEQ '?'                                                           215782
     C                     MOVELSITSI     @INV                                                215782
     C                     MOVELSCYSI     @CCY                                                215782
     C                     CALL 'SE0025'                                                      215782
     C                     PARM           @INV    3                                           215782
     C                     PARM           @CCY    3                                           215782
      *                                                                                       215782
     C           @INV      IFNE *BLANKS                                                       215782
     C                     MOVE @INV      SITSI                                               215782
     C           SCYSI     IFEQ *BLANKS                                                       215782
     C                     MOVE @CCY      SCYSI                                               215782
     C                     CALL 'AOCURRR0'                                                    215782
     C                     PARM *BLANKS   @RTCD   7                                           215782
     C                     PARM '*KEY   ' @OPTN   7                                           215782
     C                     PARM SCYSI     @AJCD   3                                           215782
     C           SDCURR    PARM SDCURR    DSSDY                                               215782
      *                                                                                       215782
     C           @RTCD     IFNE *BLANKS                                                       215782
     C                     MOVEA'1'       *IN,23                                              215782
     C                     ADD  1         EC                                                  215782
     C                     MOVEL' 103'    ERR,EC                                              215782
     C                     ELSE                                                               215782
     C                     MOVE A6CYCD    SCYSI                                               215782
     C           CEU005    IFEQ 'Y'                                                           215782
     C                     MOVE A6CYCD    W#CYCD                                              215782
     C                     MOVE A6INCY    W#INCY                                              215782
     C                     ENDIF                                                              215782
     C                     ENDIF                                                              215782
      *                                                                                       215782
     C                     ENDIF                                                              215782
     C                     ELSE                                                               215782
     C                     MOVE *BLANKS   SITSI                                               215782
     C                     ENDIF                                                              215782
     C                     MOVE 'Y'       WREDSP                                              215782
     C                     ENDIF                                                              215782
      *                                                                                       215782
     C           KINVTP    CHAININVTP                24
     C*
     C           *IN,24    IFEQ *ZERO
     C           RECI      ANDEQ'*'
     C           ACTN      ANDNE'E'                                                         MD037885
     C           ACTN      ANDNE'D'                                                         MD037885
     C                     MOVEA'1'       *IN,24
     C                     END
     C*
     C                     END
     C*
     C                     ENDIF                                          CSE041
     C*                                                                   CSE041
     C           *IN,24    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 105'    ERR,EC
     C                     END
     C*
     C                     END
     C                     END                                            E21541
     C*
     C**BRANCH*MUST*BE*ON*TABLETRF****************************************S01117
     C* BRANCH MUST BE ON SDBRCHPD                                        S01117
     C*
     C** If blank, use default branch                                     S01158
     C*                                                                   S01158
     C           MBIN      IFEQ 'Y'                                       S01117
     C           SSBRH     IFEQ *BLANKS                                   S01158
     C***********          MOVE DSTB      SSBRH                     S01158S01117
     C                     MOVE USRBCH    SSBRH                           S01117
     C***********          END                                      S01158S01117
     C***********          Z-ADD10        RECT                            S01117
     C***********          MOVEL*BLANK    ZZ008                           S01117
     C***********          MOVE SSBRH     TABKEY                          S01117
     C***********                                                         S01117
     C***********TABKEY    CHAINTABLETRF             25                   S01117
     C***********                                                         S01117
     C************IN,25    IFEQ *ZERO                                     S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********          MOVEA'1'       *IN,25                          S01117
     C***********          END                             *IN,25 = 0     S01117
     C***********                                                         S01117
     C************IN,25    IFEQ '1'                                       S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEL' 106'    ERR,EC                          S01117
     C***********          END                             *IN,25 = 1     S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SSBRH     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,25                          S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEL' 106'    ERR,EC                          S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    SSBRH                           S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** VALIDATE SPF - USER'S AUTHORITY TO BRANCH                        S01117
     C*                                                                   S01117
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM SSBRH     ZBRCDX  3                       S01117
     C                     PARM           @ERR    10                      S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 308'    ERR,EC                          S01117
     C                     SETON                     25                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 307'    ERR,EC                          S01117
     C                     SETON                     25                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C           MBIN      IFNE 'Y'                                       E37014
     C                     MOVE USRBCH    SSBRH                           E37014
     C                     END                                            E37014
     C*
      *                                                                                       CSE028
      ** Validate Portfolio Reference                                                         CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           SSPTFR    IFNE *BLANK                                                        CSE028
     C           *IN64     IFNE '1'                                                           CSE028
     C           SSIBK     ORNE *BLANKS                                                       CSE028
     C           BFCLAS    ORNE 'D'                                                           CSE028
     C           BFCLAS    ANDNE'S'                                                           CSE028
     C                     ADD  1         EC                                                  CSE028
     C                     MOVEA' 312'    ERR,EC                                              CSE028
     C                     MOVE '1'       *IN27                                               CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
      ** Check if customer and portfolio reference combination exist in                       CSE028
      ** Portfolio definitions file                                                           CSE028
      *                                                                                       CSE028
     C                     MOVELSCSTM     WCNUM                                               CSE028
     C                     MOVELSSPTFR    WPREF                                               CSE028
     C           KPREF     CHAINPMPORTPD             99                                       CSE028
      *                                                                                       CSE028
     C           *IN99     IFEQ '1'                                                           CSE028
     C                     ADD  1         EC                                                  CSE028
     C                     MOVEA' 313'    ERR,EC                                              CSE028
     C                     MOVE '1'       *IN27                                               CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE0030C023
     C***********          END                                            E14541
     C                     END                                            E14541
     C*
     C                     END
     C*
     C** N O   E R R O R  O N  K E Y  F I E L D S
     C*
     C           *IN,22    IFNE '1'
     C           *IN,23    ANDNE'1'
     C           *IN,24    ANDNE'1'
     C           *IN,25    ANDNE'1'
     C           *IN,21    ANDNE'1'                                       S01117
     C           *IN,26    ANDNE'1'                                                           CSE028
     C           *IN,27    ANDNE'1'                                                           CSE028
     C           *IN28     ANDNE'1'                                                           210160
     C/COPY WNCPYSRC,SE0030C024
     C*
     C           ACTN      IFEQ 'I'                                       S01117
     C           ACTN      OREQ 'A'                                       S01117
     C           ACTN      OREQ 'E'                                       S01117
     C           ACTN      OREQ 'D'                                       S01117
     C*                                                                   S01117
     C* VALIDATE SPF-ACTION OF USER                                       S01117
     C*                                                                   S01117
     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 302'    ERR,EC                          S01117
     C**********           SETON                     21                                S01117 255419
     C                     SETON                     2129                                     255419
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF MULTIBRANCHING ENVIRONMENT                                  S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM SSBRH     @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 303'    ERR,EC                          S01117
     C**********           SETON                     21                                S01117 255419
     C                     SETON                     2129                                     255419
     C                     ELSE                                           S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 304'    ERR,EC                          S01117
     C**********           SETON                     21                                S01117 255419
     C                     SETON                     2129                                     255419
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C** SPF-ACTION VALIDATED FOR USER                                    S01117
     C**                                                                  S01117
     C           @ERR      IFEQ *ZERO                                     S01117
     C*                                                                   S01117
     C** SET UP KEY FIELDS FROM SCREEN FIELDS
     C*
     C***********          MOVELSSBRH     SBRH                            S01117
     C                     MOVELSSBRH     SBRA                            S01117
     C                     MOVELSCSTM     CSTM
     C                     MOVELSCYSI     CYSI
     C                     MOVELSSMKT     SMKT                                                CSE034
     C                     MOVELSITSI     ITSI
     C                     MOVELSSIBK     SIBK                                                CSE028
     C                     MOVELSSPTFR    SPTFR                                               CSE028
     C/COPY WNCPYSRC,SE0030C025
     C*
     C** A C T I O N    C O D E    I
     C*
     C           MBIN      IFNE 'Y'                                       E37014
     C                     MOVE USRBCH    SBRA                            E37014
     C                     END                                            E37014
     C/COPY WNCPYSRC,SEH00041
     C           ACTN      IFEQ 'I'
     C********** STDSEK    CHAINSTDSEX               99                                       CSE034
     C           STDADK    CHAINSTDSEDFL             99                                       CSE034
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '0'
     C***********SBRH      OREQ *ZERO                                     S01117
     C           SBRA      OREQ *BLANKS                                   S01117
     C                     MOVEA'1111'    *IN,22
     C/COPY WNCPYSRC,SE0030C026
     C                     ADD  1         EC
     C                     MOVEL' 101'    ERR,EC
     C                     END
     C*
     C** A C T I O N    C O D E    A , D
     C*
     C                     ELSE
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'D'
     C********** STDSEK    CHAINSTDSEX               99                                       CSE034
     C********** STDADK    CHAINSTDSEDFL             99                              CSE034 AR970395
     C           STDADK    CHAINSTDSEDFL            N99                                     AR970395
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     MOVEA'1111'    *IN,22
     C/COPY WNCPYSRC,SE0030C027
     C                     ADD  1         EC
     C***********          MOVEL' 101'    ERR,EC                          E17192
     C***********          MOVEL' 102'    ERR,EC                   E17192 E33967
     C                     MOVEL' 101'    ERR,EC                          E33967
     C                     END
     C*
     C** A C T I O N    C O D E    E
     C*
     C                     ELSE
     C           ACTN      IFEQ 'E'
     C********** STDSEK    CHAINSTDSEX               99                                       CSE034
     C********** STDADK    CHAINSTDSEDFL             99                              CSE034 AR970395
     C           STDADK    CHAINSTDSEDFL            N99                                     AR970395
     C           *IN99     IFEQ '1'
     C                     MOVEA'1111'    *IN,22
     C/COPY WNCPYSRC,SE0030C021
     C                     ADD  1         EC
     C***********          MOVEL' 101'    ERR,EC                          E17192
     C***********          MOVEL' 102'    ERR,EC                  E17192  E33967
     C                     MOVEL' 101'    ERR,EC                          E33967
     C                     END
     C*
     C                     END
     C                     END
     C/COPY WNCPYSRC,SEH00042
     C                     END
     C*
     C                     END                             *@ERR=0        S01117
     C*                                                                   S01117
     C                     END
     C/COPY WNCPYSRC,SEH00156
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C**********           MOVELHI        ERRMSG                                              255417
     C                     MOVEL*BLANK    AID
     C                     MOVE *ON       *IN83                                              BUG2198
     C                     MOVE *IN29     *IN21                                               255419
     C                     ELSE                                                              BUG2198
     C                     MOVE *OFF      *IN83                                              BUG2198
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  VALIDD - Subroutine to Validate Detail Screen.               *
     C*                                                               *
     C*  Called from: UPDATE                                          *
     C*  Calls: None.                                                 *
     C*                                                               *
     C*****************************************************************
     C*
     C           VALIDD    BEGSR
     C*
     C** RESET SCREEN ERROR INDICATORS
     C*
     C                     MOVEA'00000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C***********          MOVEA'00000'   *IN,46                          S01175
     C                     MOVEA'000000'  *IN,46                          S01175
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     MOVEA'000'     *IN,56                          CEU005
     C                     ENDIF                                          CEU005
     C                     MOVE '0'       *IN58                           185733
     C           CSE039    IFEQ 'Y'                                                           CSE039
      ** Reset error indicator for 'Auto-Settle Indicator'                                    CSE039
     C                     MOVE '0'       *IN54                                               CSE039
     C                     ENDIF                                                              CSE039
      *                                                                                       CSE039
      ** Reset error indicator for INFMSG.                                                   BUG2198
      *                                                                                      BUG2198
     C                     MOVE *OFF      *IN84                                              BUG2198
      *                                                                                      BUG2198
     C*                                                                   S01175
     C** RESET STORED DISCRET IND FOR DELIVER FROM THEIRS AND             S01175
     C** DELIVER TO THEIRS FIELDS                                         S01175
     C*                                                                   S01175
     C                     MOVE *BLANK    DTC1DI                          S01175
     C                     MOVE *BLANK    DFC1DI                          S01175
     C*
     C** SET ERROR COUNT TO ZERO
     C*
     C                     Z-ADD*ZERO     EC
     C                     Z-ADD*ZERO     WEC                             CEU005
     C*
     C** ENTER KEY PRESSSED
     C*
     C           AID       IFEQ 'RA'
     C*
     C** ACTION = I OR A
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                        B01            CEU005
     C* Validate Settlement Currency                                      CEU005
     C*                                                                   CEU005
     C           SSCCY     IFNE WSSCCY                                    CEU005
     C                     MOVE 'N'       WERR1                           CEU005
     C                     MOVE SSCCY     WSSCCY                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C           SSCCY     IFNE *BLANKS                     B02           CEU005
     C*                                                                   CEU005
     C** Check Settlement Currency Input Field                            CEU005
     C*                                                                   CEU005
     C                     MOVELSSCCY     @STP    1                       CEU005
     C           @STP      IFEQ '?'                          B03          CEU005
     C                     MOVE 'Y'       @SEL                            CEU005
     C                     MOVELSSCCY     @AJCD                           CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM           @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C*                                                                   CEU005
     C                     MOVE *BLANKS   SSCCY                           CEU005
     C                     SETOF                     5658                 CEU005
     C           @RTCD     IFEQ *BLANKS                       B04         CEU005
     C                     MOVELA6CYCD    SSCCY                           CEU005
     C                     END                                E04         CEU005
     C                     END                               E03          CEU005
      *                                                                   CEU005
     C           W#INCY    IFEQ 'Y'                          B03          CEU005
     C           SSCCY     ANDEQBKEURO                                    CEU005
     C                     MOVE SSCCY     SCCY                            CEU005
     C                     ELSE                              X03          CEU005
     C                     MOVELSSCCY     @AJCD                           CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*KEY   ' @OPTN                           CEU005
     C                     PARM           @AJCD                           CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C*                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                           B04         CEU005
     C           W#CYCD    ANDEQBKEURO                                    CEU005
     C                     MOVE SSCCY     SCCY                            CEU005
     C                     ELSE                               X04         CEU005
     C* Entry of Settlement Currency is not allowed                       CEU005
     C           SSCCY     IFNE *BLANKS                        B05        CEU005
     C                     SETON                     5658                 CEU005
     C                     ADD  1         EC                              CEU005
     C                     MOVEL' 212'    ERR,EC                          CEU005
     C                     ENDIF                               E05        CEU005
     C*                                                                   CEU005
     C                     ENDIF                              E04         CEU005
     C*                                                                   CEU005
     C                     ENDIF                             E03          CEU005
     C                     ELSE                             X02           CEU005
     C* Move out blank Settlement Currency                                CEU005
     C                     MOVE SSCCY     SCCY                            CEU005
     C                     ENDIF                            E02           CEU005
     C* If Settlement Ccy is defined check if standard settle             CEU005
     C* instructions exist                                                CEU005
     C           SSCCY     IFNE *BLANKS                     B02           CEU005
     C                     MOVE SBRA      WSBRA                           CEU005
     C**********           Z-ADDCSTM      WCSTM                                        CEU005 CSD027
     C                     MOVE CSTM      WCSTM                                               CSD027
     C                     MOVE SCCY      WSCCY                           CEU005
     C                     MOVE ITSI      WITSI                           CEU005
     C                     MOVE CYSI      WCYSI   3                       CEU005
     C/COPY WNCPYSRC,SE0030C022
     C           STDSE2    CHAINSTDSEX               99                   CEU005
     C           *IN99     IFEQ *ON                          B03          CEU005
     C           WERR1     ANDEQ'N'                                       CEU005
     C                     SETON                     5658                 CEU005
     C                     ADD  1         WEC                             CEU005
     C                     ADD  1         EC                              CEU005
     C                     MOVEL' W01'    ERR,EC                          CEU005
     C                     MOVE 'Y'       WERR1                           CEU005
     C                     ELSE                                           CEU005
     C                     MOVE WCYSI     CYSI                            CEU005
     C                     MOVE WSCCY     SCCY                            CEU005
     C                     ENDIF                             E03          CEU005
     C                     ENDIF                            E02           CEU005
     C* Validate 'Include ERI in field 72'                                CEU005
     C           W#CYCD    IFEQ BKEURO                      B02           CEU005
     C* Entry is mandatory if the payment settlement method is 01 or 08   CEU005
     C           SSPSM     IFEQ '01'                         B03          CEU005
     C           SSPSM     OREQ '08'                                      CEU005
     C           SERII     IFNE 'Y'                           B04         CEU005
     C           SERII     ANDNE'N'                                       CEU005
     C                     MOVEA'1'       *IN,57                          CEU005
     C                     ADD  1         EC                              CEU005
     C                     MOVEL' 213'    ERR,EC                          CEU005
     C                     ENDIF                              E04         CEU005
     C                     ELSE                              X03          CEU005
     C* Must be left blank                                                CEU005
     C           SERII     IFNE *BLANKS                       B04         CEU005
     C                     MOVEA'1'       *IN,57                          CEU005
     C                     ADD  1         EC                              CEU005
     C                     MOVEL' 214'    ERR,EC                          CEU005
     C                     ENDIF                              E04         CEU005
     C                     ENDIF                             E03          CEU005
     C                     ELSE                             X02           CEU005
     C* Must be left blank - input not allowed                            CEU005
     C           SERII     IFNE *BLANK                       B03          CEU005
     C                     MOVEA'1'       *IN,57                          CEU005
     C                     ADD  1         EC                              CEU005
     C                     MOVEL' 215'    ERR,EC                          CEU005
     C                     ENDIF                             E03          CEU005
     C                     ENDIF                            E02           CEU005
     C           *IN57     IFEQ '0'                         B02           CEU005
     C                     MOVE SERII     ERII                            CEU005
     C                     ENDIF                            E02           CEU005
     C                     ENDIF                           E01            CEU005
     C*
     C** VALIDATION OF FIELDS FOR INSERT/AMEND
     C*
     C* TRANSLATE AND VALIDATE SSRSM(#NUMV) - RECEIVE SETTLEMENT METHOD
     C*
     C** MUST BE IN TABLE OF VALID SETTLEMENT METHODS (METH)
     C*
     C                     MOVELSSRSM     SRSM
     C*                                                                   CSE041
     C           FEATUR    IFEQ 'Y'                                       CSE041
     C           BFCLAS    ANDEQ'M'                                       CSE041
     C           SCYSI     ANDEQ*BLANKS                                   CSE041
     C           SSRSM     IFNE *BLANKS                                   CSE041
     C           SSRSM     ANDNE'00'                                      CSE041
     C           SSRSM     ANDNE'01'                                      CSE041
     C           SSRSM     ANDNE'02'                                      CSE041
     C           SSRSM     ANDNE'08'                                      CSE041
     C                     MOVEA'11'      *IN,30                          CSE041
     C                     ADD  1         EC                              CSE041
     C                     MOVEL' 200'    ERR,EC                          CSE041
     C                     ENDIF                                          CSE041
     C                     ELSE                                           CSE041
     C*                                                                   CSE041
     C/COPY WNCPYSRC,SE0030C029
     C*
     C           SSRSM     IFNE *BLANKS                                   E13940
     C           SSRSM     LOKUPMETH                     55
     C           *IN,55    IFEQ '0'
     C                     MOVEA'11'      *IN,30
     C                     ADD  1         EC
     C                     MOVEL' 200'    ERR,EC
     C                     END
     C                     END                                            E13940
     C*
     C** METHODS 4 & 14 ONLY ALLOWED IF RETAIL MODULE PRESENT (*IN70 ON)
     C*
     C           SSRSM     IFEQ '04'
     C           SSRSM     OREQ '14'
     C           *IN,70    IFNE '1'
     C                     MOVEA'11'      *IN,30
     C                     ADD  1         EC
     C                     MOVEL' 201'    ERR,EC
     C                     END
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CVSF                                           S01408
     C*                                                                   S01408
     C*
     C** METHOD 07 - CURRENCY MUST BE US$ ON TABTB40
     C*
     C           SSRSM     IFEQ '07'
     C********** CYSI      IFNE USCY                                      S01117
     C           CYSI      IFNE BLUSCY                                    S01117
     C                     MOVEA'11'      *IN,30
     C                     ADD  1         EC
     C                     MOVEL' 202'    ERR,EC
     C                     END
     C                     END
     C                     ENDIF                                          CSE041
     C*
     C*
     C* TRANSLATE AND VALIDATE SSRAC (#ALPV) - RECEIVE ACCOUNT
     C*
     C** MAY ONLY BE ENTERED FOR SETT. METHODS 01,02,05,07,08,12,14 OR 15
     C*
     C                     MOVELSSRAC     SRAC
     C*                                                                   CSE041
     C           FEATUR    IFEQ 'Y'                                       CSE041
     C           BFCLAS    ANDEQ'M'                                       CSE041
     C           SCYSI     ANDEQ*BLANKS                                   CSE041
     C           SITSI     ANDNE*BLANKS                                   CSE041
     C           SSRSM     IFEQ '01'                                      CSE041
     C           SSRSM     OREQ '02'                                      CSE041
     C           SSRSM     OREQ '08'                                      CSE041
     C                     MOVELSSRAC     USRAC3  2                       CSE041
     C                     MOVEA'  '      NUMD                            CSE041
     C                     MOVEAUSRAC3    NUMD                            CSE041
     C**********           MOVE SSRAC     USRAC2 10                                    CSE041 CGL029
     C                     MOVE SSRAC     USRAC2 16                                           CGL029
      *                                                                   CSE041
     C           SSRAC     IFEQ *BLANKS                                   CSE041
     C                     ADD  1         EC         32                   CSE041
     C                     MOVEL' 235'    ERR,EC                          CSE041
      *                                                                   CSE041
     C                     ELSE                                           CSE041
     C           USRAC2    IFEQ *BLANKS                                   CSE041
     C           USRAC3    ANDNE*BLANKS                                   CSE041
      *                                                                   CSE041
     C                     Z-ADD1         L                               CSE041
     C           L         DOUEQ3                                         CSE041
      *                                                                   CSE041
     C           NUMD,L    LOKUPNUM                      82               CSE041
     C           *IN82     IFEQ '0'                                       CSE041
     C                     ADD  1         EC         32                   CSE041
     C                     MOVEL' 235'    ERR,EC                          CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C                     ADD  1         L                               CSE041
      *                                                                   CSE041
     C                     ENDDO                                          CSE041
      *                                                                   CSE041
     C                     ELSE                                           CSE041
     C                     ADD  1         EC         32                   CSE041
     C                     MOVEL' 235'    ERR,EC                          CSE041
     C                     ENDIF                                          CSE041
     C                     ENDIF                                          CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C                     ELSE                                           CSE041
      *                                                                   CSE041
     C** MAY ONLY BE ENTERED FOR SETT. METHODS 01,02,05,07,08,12,14 OR 15 CSE041
     C*
     C           SSRAC     IFNE *BLANK
     C           SSRSM     IFNE '01'
     C           SSRSM     ANDNE'02'
     C           SSRSM     ANDNE'05'
     C           SSRSM     ANDNE'07'
     C           SSRSM     ANDNE'08'
     C           SSRSM     ANDNE'12'
     C           SSRSM     ANDNE'14'
     C           SSRSM     ANDNE'15'
     C/COPY WNCPYSRC,SE0030C030
     C                     ADD  1         EC         32
     C                     MOVEL' 235'    ERR,EC
     C/COPY WNCPYSRC,SE0030C055
     C                     END
     C                     END
     C*
     C***SETT.*METHOD*01,02,07,08*OR*12,*CHECK*VALID*NOSTRO*ON*TABLETL****S01117
     C** SETT. METHOD 01,02,07,08 OR 12, CHECK VALID NOSTRO ON SDNOSTPD   S01117
     C*
     C           SSRSM     IFEQ '01'
     C           SSRSM     OREQ '02'
     C           SSRSM     OREQ '07'
     C           SSRSM     OREQ '08'
     C           SSRSM     OREQ '12'
     C/COPY WNCPYSRC,SE0030C031
     C***********          Z-ADD70        RECT                            S01117
     C***********          MOVEL*BLANK    ZZ005                           S01117
     C***********          MOVELCYSI      TLCCY                           S01117
     C***********          MOVELSSRAC     TLNOS                           S01117
     C***********                                                         S01117
     C***********TABKEY    CHAINTABLETLF             32                   S01117
     C***********                                                         S01117
     C*                                                                   S01117
     C                     MOVE SSRAC     DSRCVA                          S01117
     C**********           MOVE SSRAC     WDSRCV 10                                    123222 CGL029
     C*                                                                   S01117
     C*  CALL ACCESS OBJECT TO VALIDATE NOSTRO                            S01117
     C** Check with settlement currency if filled                         193959
     C*                                                                   S01117
     C           WDSRCV    IFEQ *BLANKS                                   123222
     C           CEU005    IFEQ 'Y'                                       193959
     C           SCCY      ANDNE'   '                                     193959
     C                     CALL 'AONOSTR0'                                193959
     C                     PARM *BLANKS   @RTCD   7                       193959
     C                     PARM '*KEY   ' @OPTN   7                       193959
     C                     PARM *BLANKS   @KEYA   6                       193959
     C                     PARM SCCY      @KEYB   3                       193959
     C**********           PARM *BLANKS   @KEYC   4                                    193959 CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2                       193959
     C                     PARM NOSR      @KEYE   2                       193959
     C                     PARM *BLANKS   @BRCD   3                       193959
     C                     PARM *BLANKS   @CSSN  10                       193959
     C                     PARM *BLANKS   @PNOI   1                       193959
     C           SDNOST    PARM SDNOST    DSFDY                           193959
     C                     ELSE                                           193959
     C                     CALL 'AONOSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM *BLANKS   @KEYA   6                       S01117
     C                     PARM CYSI      @KEYB   3                       S01117
     C**********           PARM *BLANKS   @KEYC   4                                    S01117 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2                       S01117
     C                     PARM NOSR      @KEYE   2                       S01117
     C                     PARM *BLANKS   @BRCD   3                       S01117
     C                     PARM *BLANKS   @CSSN  10                       S01117
     C                     PARM *BLANKS   @PNOI   1                       S01117
     C           SDNOST    PARM SDNOST    DSFDY                           S01117
     C                     ENDIF                                          193959
     C************IN,32    IFEQ *ZERO                                     S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C                     ELSE                                           123222
     C                     MOVE 'ERROR'   @RTCD                           123222
     C                     ENDIF                                          123222
     C*                                                                   123222
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,32
     C                     END
     C*
     C           *IN,32    IFEQ '1'
     C/COPY WNCPYSRC,SE0030C032
     C                     ADD  1         EC
     C                     MOVEL' 203'    ERR,EC
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CVS1                                           S01408
     C*                                                                   S01408
     C*
     C                     END
     C*
     C                     ENDIF                                          CSE041
     C*                                                                   CSE041
     C*                                                                   S01117
     C* VALIDATE RECEIVE BRANCH                                           S01117
     C*                                                                   S01117
     C* VALIDATE BRANCH IF ENTERED                                        S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C           SSRBR     ANDNE*BLANKS                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SSRBR     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A8BRCD    SSRBR                           S01117
     C                     ELSE                                           S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA'1'       *IN,33                          S01117
     C                     MOVEL' 207'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           FEATUR    IFEQ 'Y'                                       CSE041
     C           WC1DI     ANDEQ'M'                                       CSE041
     C           SCYSI     ANDEQ*BLANK                                    CSE041
     C           SITSI     ANDNE*BLANK                                    CSE041
     C                     MOVELSSRBR     SRAB                            CSE041
     C                     ELSE                                           CSE041
     C*                                                                   S01117
     C           *IN33     IFEQ '0'                                       S01117
     C           SSRSM     IFEQ '01'                                      S01117
     C           SSRSM     OREQ '02'                                      S01117
     C           SSRSM     OREQ '07'                                      S01117
     C           SSRSM     OREQ '08'                                      S01117
     C           SSRSM     OREQ '12'                                      S01117
     C/COPY WNCPYSRC,SE0030C033
     C*                                                                   S01117
     C* IF RECEIVE BRANCH NOT ENTERED, SET TO BRANCH ON NOSTRO FILE       S01117
     C*                                                                   S01117
     C           SSRBR     IFEQ *BLANKS                                   S01117
     C                     MOVE A7BRCD    SSRBR                           S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* BRANCH ENTERED MUST BE SAME AS THAT ON NOSTRO FILE                S01117
     C*                                                                   S01117
     C           SSRBR     IFNE A7BRCD                                    S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA'1'       *IN,33                          S01117
     C                     MOVEL' 207'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* IF SETLLEMENT METHOD NOT THROUGH NOSTRO                           S01117
     C* SET RECEIVE BRANCH TO TRADE BOOKING BRANCH IF NOT ENTERED         S01117
     C*                                                                   S01117
     C           SSRBR     IFEQ *BLANKS                                   S01117
     C                     MOVE SSBRH     SSRBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* IF SETLLEMENT METHOD NOT THROUGH NOSTRO AND NOT 05                S01117
     C* RECEIVE BRANCH MUST BE SAME AS TRADE BOOKING BRANCH IF ENTERED    S01117
     C*                                                                   S01117
     C           SSRSM     IFNE '05'                                      S01117
     C           SSRBR     ANDNESSBRH                                     S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA'1'       *IN,33                          S01117
     C                     MOVEL' 207'    ERR,EC                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSSRBR     SRAB                            S01117
     C*                                                                   S01117
     C** SETT. METHOD 05, CHECK ACTIVE ACCOUNT ON ACCNT
     C*
     C           SSRSM     IFEQ '05'
     C/COPY WNCPYSRC,SE0030C034
     C                     MOVELSSRAC     CNUM
     C**********           MOVE SSRAC     WCDSQ                                              BUG8415
     C                     MOVE SSRAC     WCDSQC                                             BUG8415
     C           *BLANKS   IFEQ WACODC                                                       BUG8415
     C                     Z-ADD0         WACOD                                              BUG8415
     C                     ELSE                                                              BUG8415
     C                     MOVE WACODC    WACOD                                              BUG8415
     C                     ENDIF                                                             BUG8415
     C           *BLANKS   IFEQ WACSQC                                                       BUG8415
     C                     Z-ADD0         WACSQ                                              BUG8415
     C                     ELSE                                                              BUG8415
     C                     MOVE WACSQC    WACSQ                                              BUG8415
     C                     ENDIF                                                             BUG8415
     C**                                                                                     BUG8415
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE SSRBR     WBRCA                           S01117
     C                     ELSE                                           S01117
     C                     MOVE USRBCH    WBRCA                           S01117
     C                     END                                            S01117
     C*
     C           KACCNT    CHAINACCNT                32
     C*
     C           *IN,32    IFEQ *ZERO
     C           RECI      ANDEQ'*'
     C                     MOVEA'1'       *IN,32
     C                     END
     C*
     C***BRANCH*MUST*AGREE************************************************S01117
     C***********                                                         S01117
     C***********          MOVELSSRBR     SRBR                            S01117
     C***********                                                         S01117
     C************IN,32    IFEQ '0'                                       S01117
     C***********SRBR      ANDNEBRCD                                      S01117
     C***********          MOVEA'1'       *IN,32                          S01117
     C***********          END                             *IN,32 = 0     S01117
     C*
     C           *IN,32    IFEQ '1'
     C/COPY WNCPYSRC,SE0030C035
     C                     ADD  1         EC
     C                     MOVEL' 204'    ERR,EC
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CVS2                                           S01408
     C*                                                                   S01408
     C*
     C                     END
     C*
     C                     ENDIF                                          CSE041
     C*                                                                   CSE041
     C                     END                             **IN33=0       S01117
     C*                                                                   S01117
     C** SETT. METHOD 14, CHECK ACTIVE ACCOUNT ON ACNUM(RETAIL A/C NOS)
     C*
     C           SSRSM     IFEQ '14'
     C/COPY WNCPYSRC,SE0030C036
     C                     MOVELSSRAC     KACNUM 100
     C*                                                                   058355
     C** Check A/C code entered is 10 long and contains only digits       058355
     C** 0 thru 9                                                         058355
     C*                                                                   058355
     C                     MOVELSSRAC     CHKAC  10                       058355
     C                     MOVE SSRAC     CHK2    2                       058355
     C                     MOVEL'01234567'CHK10  10                       058355
     C                     MOVE '89'      CHK10                           058355
     C           CHK10     CHECKCHKAC                    89               058355
     C           *IN89     IFEQ '1'                                       058355
     C           CHK2      ORNE *BLANKS                                   058355
     C                     MOVE '1'       *IN32                           058355
     C                     SETOF                         89               058355
     C                     ELSE                                           058355
     C*
     C           KACNUM    CHAINACNUM                32
     C                     END                                            058355
     C*
     C           *IN,32    IFEQ *ZERO
     C           RECI      ANDEQ'*'
     C                     MOVEA'1'       *IN,32
     C                     END
     C*
     C** CHAIN TO ACCNT(GL A/C MASTER) TO CHECK BRANCH
     C*
     C           *IN,32    IFEQ '0'
     C*
     C                     Z-ADDACOD      WACOD
     C                     Z-ADDACSQ      WACSQ
     C           MBIN      IFEQ 'Y'                                       E37014
     C                     MOVE A8BRCD    WBRCA                           S01117
     C                     ELSE                                           E37014
     C                     MOVE USRBCH    WBRCA                           E37014
     C                     END                                            E37014
     C*
     C           KACCNT    CHAINACCNT                32
     C*
     C           *IN,32    IFEQ *ZERO
     C           RECI      ANDEQ'*'
     C                     MOVEA'1'       *IN,32
     C                     END
     C*
     C************IN,32    IFEQ '0'                                       S01117
     C***********                                                         S01117
     C***********          MOVELSSRBR     SRBR                            S01117
     C***********                                                         S01117
     C***********SRBR      IFNE BRCD                                      S01117
     C***********          MOVEA'1'       *IN,32                          S01117
     C***********          END                             *SRBR NE BRCD  S01117
     C***********                                                         S01117
     C***********          END                             *IN,32 = 0     S01117
     C*
     C**********           MOVELCNUM      @CNUM1  60                                   E19985 CSD027
     C                     MOVELCNUM      @CNUM1  6                                           CSD027
     C*
     C                     END
     C*
     C           *IN,32    IFEQ '1'
     C/COPY WNCPYSRC,SE0030C037
     C                     ADD  1         EC
     C                     MOVEL' 205'    ERR,EC
     C/COPY WNCPYSRC,SE0030C038
     C                     END
     C*
     C                     END
     C*
     C** SETT. METHOD 15, CHECK CUSTOMER ON CLINTSE
     C*
     C           SSRSM     IFEQ '15'
     C                     MOVELSSRAC     WINCNO
     C                     MOVEL'N'       WNOSTR
     C                     Z-ADD32        WI
     C                     EXSR VALCST
     C*
     C** SETTLEMENT A/C MUST BE COMPLETED
     C*
     C********** C1AC      IFEQ *ZERO                                     S01117
     C           BFACCD    IFEQ *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,32
     C                     END
     C*
     C           *IN,32    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 206'    ERR,EC
     C                     ELSE
     C*
     C** VALID SO ENSURE CUSTOMER NO IN STDSED RECORD
     C*
     C                     MOVEL*BLANK    SRAC
     C**********           MOVELCNUM      SRAC                            S01117
     C                     MOVELBFCUST    SRAC                            S01117
     C*
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0030C039
     C*
     C** IF PAYCODE IS 1 OR 5 ENSURE THAT BOTH PAY TO AND DELIVER FROM    E19985
     C** ARE AT THE SAME INSTITUTION                                      E19985
     C*
     C           SSPCS     IFEQ '1'                                       E19985
     C           SSPCS     OREQ '5'                                       E19985
     C*                                                                   E19985
     C** AND CLEARANCE TYPE 1-4                                           E19985
     C*                                                                   E19985
     C           SSCLS     IFGE '1'                                       E19985
     C           SSCLS     ANDLE'4'                                       E19985
     C           SSPSM     ANDNE'04'                                      103401
     C           SSRSM     IFNE '14'                                      E19985
     C*                                                                   E19985
     C** FIND INSTITUTION REF. FOR THAT RECEIVE BRANCH                    E19985
     C*                                                                   E19985
     C                     MOVELSSRAC     WINCNO                          E19985
     C                     MOVEL'N'       WNOSTR                          E19985
     C                     Z-ADD32        WI                              E19985
     C                     EXSR VALCST                                    E19985
     C*                                                                   E19985
     C**********           MOVEL*BLANK    SRACN   60                                   E19985 CSD027
     C                     MOVEL*BLANK    SRACN   6                                           CSD027
     C**********           MOVELCNUM      SRACN                     E19985S01117
     C                     MOVELBFCUST    SRACN                           S01117
     C*                                                                   046065
     C** IF NOSTRO SETTLEMENT USE NOSTRO CUSTOMER NO.                     046065
     C*                                                                   046065
     C           SSRSM     IFEQ '01'                                      046065
     C           SSRSM     OREQ '02'                                      046065
     C           SSRSM     OREQ '07'                                      046065
     C           SSRSM     OREQ '08'                                      046065
     C           SSRSM     OREQ '12'                                      046065
     C/COPY WNCPYSRC,SE0030C040
     C                     MOVELA7CUST    SRACN                           046065
     C                     END                                            046065
     C*                                                                   E19985
     C** SETTLEMENT TYPE 14: ACCEPT RETAIL A/C NO.                        E19985
     C*                                                                   E19985
     C                     ELSE                            SSRSM=14       E19985
     C********** @CNUM2    CHAINCLINTSEF             32             E19985S01117
     C                     MOVEL@CNUM1    @KEYS                           S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYS                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           SSCLS     IFEQ '1'                                       E19985
     C           SSCLS     OREQ '2'                                       E19985
     C**********           MOVELC101      SRACN                     E19985S01117
     C                     MOVELBFNDR1    BFDRF1                                              CSE022
     C                     MOVELBFDRF1    SRACN                           S01117
     C                     END                                            E19985
     C           SSCLS     IFEQ '3'                                       E19985
     C           SSCLS     OREQ '4'                                       E19985
     C**********           MOVELC102      SRACN                     E19985S01117
     C                     MOVELBFNDR2    BFDRF2                                              CSE022
     C                     MOVELBFDRF2    SRACN                           S01117
     C                     END                                            E19985
     C                     END                                            E19985
     C*                                                                   E19985
     C** SETTLEMENT TYPE 05 OR 15  FIND RELEVANT INSTITUTION              E19985
     C*                                                                   E19985
     C           SSRSM     IFEQ '05'                        SSRSM=05      E19985
     C           SSRSM     OREQ '15'                             =15      E19985
     C********** SRACN     CHAINCLINTSEF             32                   E19985
     C                     MOVELSRACN     @KEYS                           S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYS                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           SSCLS     IFEQ '1'                                       E19985
     C           SSCLS     OREQ '2'                                       E19985
     C**********           MOVELC101      SRACN                     E19985S01117
     C                     MOVELBFNDR1    BFDRF1                                              CSE022
     C                     MOVELBFDRF1    SRACN                           S01117
     C                     END                                            E19985
     C           SSCLS     IFEQ '3'                                       E19985
     C           SSCLS     OREQ '4'                                       E19985
     C**********           MOVELC102      SRACN                     E19985S01117
     C                     MOVELBFNDR2    BFDRF2                                              CSE022
     C                     MOVELBFDRF2    SRACN                           S01117
     C                     END                                            E19985
     C                     END                                            E19985
     C*                                                                   E19985
     C** FIND INSTITUTION REF. FOR 'DELIVER FROM' FIELD                   E19985
     C*                                                                   E19985
     C                     MOVELSSDFO     WINCNO                          E19985
     C                     MOVEL'N'       WNOSTR                          E19985
     C                     Z-ADD32        WI                              E19985
     C                     EXSR VALCST                                    E19985
     C**********           MOVELCNUM      SDFO                      E19985S01117
     C                     MOVELBFCUST    SDFO                            S01117
     C*                                                                   E19985
     C********** SDFO      CHAINCLINTSEF             32             E19985S01117
     C*                                                                   E19985
     C** COMPARE 'PAY TO' AND 'DELIVER FROM' FIELDS                       E19985
     C*                                                                   E19985
     C********** CNUM      IFNE SRACN                               E19985S01117
     C**********           MOVELBFCUST    @SRACN  60                                   S01117 CSD027
     C                     MOVELBFCUST    @SRACN  6                                           CSD027
     C           @SRACN    IFNE SRACN                                     S01117
     C                     SETON                         32               E19985
     C                     END                                            E19985
     C           *IN32     IFEQ '1'                                       E19985
     C                     ADD  1         EC                              E19985
     C                     MOVEL' 251'    ERR,EC                          E19985
     C                     END                                            E19985
     C                     END                                            E19985
     C                     END                                            E19985
     C*
     C**TRANSLATE*AND*VALIDATE*SSRBR*(#NUMV)*-*RECEIVE*BRANCH*************S01117
     C***********                                                         S01117
     C**If*blank, use default branch                                S01158S01117
     C***********                                                   S01158S01117
     C***********SSRBR     IFEQ *BLANKS                             S01158S01117
     C***********          MOVE DSTB      SSRBR                     S01158S01117
     C***********          END                                      S01158S01117
     C***********          MOVELSSRBR     SRBR                            S01117
     C***********                                                         S01117
     C**RECEIVE*BRANCH MUST BE ON TABLETRF                                S01117
     C***********                                                         S01117
     C***********          Z-ADD10        RECT                            S01117
     C***********          MOVEL*BLANK    ZZ008                           S01117
     C***********          MOVE SSRBR     TABKEY                          S01117
     C***********                                                         S01117
     C***********TABKEY    CHAINTABLETRF             33                   S01117
     C***********                                                         S01117
     C************IN,33    IFEQ *ZERO                                     S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********          MOVEA'1'       *IN,33                          S01117
     C***********          END                             *IN,33 = 0     S01117
     C***********                                                         S01117
     C************IN,33    IFEQ '1'                                       S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEL' 207'    ERR,EC                          S01117
     C***********          END                             *IN,33 = 1     S01117
     C*
     C* TRANSLATE AND VALIDATE SSRCB (#ALPV) - RECEIVE C'PARTY BANK
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCP1                                           S01408
     C*                                                                   S01408
     C                     MOVELSSRCB     SRCB
     C*
     C** ENTRY ONLY ALLOWED FOR SETT. METHODS 01,07 OR 08
     C*
     C           SSRCB     IFNE *BLANK
     C           SSRSM     IFNE '01'
     C           SSRSM     ANDNE'07'
     C           SSRSM     ANDNE'08'
     C                     ADD  1         EC         34
     C                     MOVEL' 208'    ERR,EC
     C                     END
     C                     END
     C*
     C***SETT.*METHOD*01,07,08*-*MUST*BE*CUSTOMER*OR*NOSTRO************   E24568
     C** SETT. METHOD 01,07,08 - IF ENTERED, MUST BE CUSTOMER OR NOSTRO   E24568
     C*
     C           SSRSM     IFEQ '01'
     C           SSRSM     OREQ '07'
     C           SSRSM     OREQ '08'
     C           SSRCB     IFNE *BLANK                                    E24568
     C                     MOVELSSRCB     WINCNO
     C                     MOVEL'Y'       WNOSTR
     C                     Z-ADD34        WI
     C***********          EXSR VALCST                                    E17186
     C                     EXSR VALCCB                                    E17186
     C*
     C           *IN,34    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 209'    ERR,EC
     C                     ELSE
     C*
     C** VALID SO ENSURE CUSTOMER NO PUT IN STDSED RECORD
     C*
     C           WNOSTR    IFEQ 'N'
     C                     MOVEL*BLANK    SRCB
     C**********           MOVELCNUM      SRCB                            S01117
     C                     MOVELBBCUST    SRCB                            S01117
     C                     END
     C*
     C                     END
     C                     END                                            E24568
     C*
     C                     END
     C*
     C* TRANSLATE AND VALIDATE SSPSM (#NUMV) - PAY SETTLEMENT METHOD
     C*
     C                     MOVELSSPSM     SPSM
     C*                                                                   CSE041
     C           FEATUR    IFEQ 'Y'                                       CSE041
     C           BFCLAS    ANDEQ'M'                                       CSE041
     C           SCYSI     ANDEQ*BLANKS                                   CSE041
     C           SSPSM     IFNE *BLANKS                                   CSE041
     C           SSPSM     ANDNE'00'                                      CSE041
     C           SSPSM     ANDNE'01'                                      CSE041
     C           SSPSM     ANDNE'02'                                      CSE041
     C           SSPSM     ANDNE'08'                                      CSE041
     C                     MOVEA'1'       *IN,35                          CSE041
     C                     ADD  1         EC                              CSE041
     C                     MOVEL' 200'    ERR,EC                          CSE041
     C                     ENDIF                                          CSE041
     C                     ELSE                                           CSE041
     C*                                                                   CSE041
     C/COPY WNCPYSRC,SE0030C041
     C*
     C** MUST BE IN TABLE OF VALID SETTLEMENT METHODS (METH)
     C*
     C           SSPSM     IFNE *BLANKS                                   E13940
     C           SSPSM     LOKUPMETH                     55
     C           *IN,55    IFEQ '0'
     C                     MOVEA'1'       *IN,35
     C                     ADD  1         EC
     C                     MOVEL' 200'    ERR,EC
     C                     END
     C                     END                                            E13940
     C*
     C** METHODS 4 & 14 ONLY ALLOWED IF RETAIL MODULE PRESENT(*IN,70 ON)
     C*
     C           SSPSM     IFEQ '04'
     C           SSPSM     OREQ '14'
     C           *IN,70    IFNE '1'
     C                     MOVEA'1'       *IN,35
     C                     ADD  1         EC
     C                     MOVEL' 201'    ERR,EC
     C                     END
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CVS3                                           S01408
     C*                                                                   S01408
     C*
     C** METHOD 07 - CURRENCY MUST BE US$ ON TABTB40
     C*
     C           SSPSM     IFEQ '07'
     C********** CYSI      IFNE USCY                                      S01117
     C           CYSI      IFNE BLUSCY                                    S01117
     C                     MOVEA'1'       *IN,35
     C                     ADD  1         EC
     C                     MOVEL' 202'    ERR,EC
     C                     END
     C                     END
      *                                                                   CSE041
     C                     ENDIF                                          CSE041
     C*
     C** TRANSLATE AND VALIDATE SSPAT (#ALPV) - PAY ACCOUNT
     C*
     C                     MOVELSSPAT     SPAT
     C*
     C           FEATUR    IFEQ 'Y'                                       CSE041
     C           BFCLAS    ANDEQ'M'                                       CSE041
     C           SCYSI     ANDEQ*BLANKS                                   CSE041
     C           SITSI     ANDNE*BLANKS                                   CSE041
     C                     MOVELSSPAT     SPAT                            CSE041
     C           SSPSM     IFEQ '01'                                      CSE041
     C           SSPSM     OREQ '02'                                      CSE041
     C           SSPSM     OREQ '08'                                      CSE041
     C                     MOVELSSPAT     USPAT3  2                       CSE041
     C                     MOVEA'  '      NUMD                            CSE041
     C                     MOVEAUSPAT3    NUMD                            CSE041
     C**********           MOVE SSPAT     USPAT2 10                                    CSE041 CGL029
     C                     MOVE SSPAT     USPAT2 16                                           CGL029
      *                                                                   CSE041
     C           SSPAT     IFEQ *BLANKS                                   CSE041
     C                     ADD  1         EC                              CSE041
     C                     MOVEL' 235'    ERR,EC                          CSE041
      *                                                                   CSE041
     C                     ELSE                                           CSE041
     C           USPAT2    IFEQ *BLANKS                                   CSE041
     C           USPAT3    ANDNE*BLANKS                                   CSE041
      *                                                                   CSE041
     C                     Z-ADD1         L                               CSE041
     C           L         DOUEQ2                                         CSE041
      *                                                                   CSE041
     C           NUMD,L    LOKUPNUM                      82               CSE041
     C           *IN82     IFEQ '0'                                       CSE041
     C                     ADD  1         EC         36                   CSE041
     C                     MOVEL' 235'    ERR,EC                          CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C                     ADD  1         L                               CSE041
      *                                                                   CSE041
     C                     ENDDO                                          CSE041
      *                                                                   CSE041
     C                     ELSE                                           CSE041
     C                     ADD  1         EC         36                   CSE041
     C                     MOVEL' 235'    ERR,EC                          CSE041
     C                     ENDIF                                          CSE041
     C                     ENDIF                                          CSE041
     C                     ENDIF                                          CSE041
      *                                                                   CSE041
     C                     ELSE                                           CSE041
      *                                                                   CSE041
     C** MAY ONLY BE ENTERED FOR SETT. METHODS 01,02,05,07,08,12,14 OR 15
     C*
     C*
     C           SSPAT     IFNE *BLANK
     C           SSPSM     IFNE '01'
     C           SSPSM     ANDNE'02'
     C           SSPSM     ANDNE'05'
     C           SSPSM     ANDNE'07'
     C           SSPSM     ANDNE'08'
     C           SSPSM     ANDNE'12'
     C           SSPSM     ANDNE'14'
     C           SSPSM     ANDNE'15'
     C/COPY WNCPYSRC,SE0030C042
     C                     ADD  1         EC         36
     C                     MOVEL' 235'    ERR,EC
     C/COPY WNCPYSRC,SE0030C056
     C                     END
     C                     END
     C*
     C***SETT.*METHOD*01,02,07,08*OR*12,*CHECK*VALID*NOSTRO*ON*TABLETL****S01117
     C** SETT. METHOD 01,02,07,08 OR 12, CHECK VALID NOSTRO ON SDNOSTPD   S01117
     C*
     C           SSPSM     IFEQ '01'
     C           SSPSM     OREQ '02'
     C           SSPSM     OREQ '07'
     C           SSPSM     OREQ '08'
     C           SSPSM     OREQ '12'
     C/COPY WNCPYSRC,SE0030C043
     C***********          Z-ADD70        RECT                            S01117
     C***********          MOVEL*BLANK    ZZ005                           S01117
     C***********          MOVELCYSI      TLCCY                           S01117
     C***********          MOVELSSPAT     TLNOS                           S01117
     C***********                                                         S01117
     C***********TABKEY    CHAINTABLETLF             36                   S01117
     C***********                                                         S01117
     C*                                                                   S01117
     C                     MOVE SSPAT     DSPAYA                          S01117
     C**********           MOVE SSPAT     WDSPAY 10                                    123222 CGL029
     C*                                                                   S01117
     C*  CALL ACCESS OBJECT TO VALIDATE NOSTRO                            S01117
     C** Check with settlement currency if filled                         193959
     C*                                                                   S01117
     C           WDSPAY    IFEQ *BLANKS                                   123222
     C           CEU005    IFEQ 'Y'                                       193959
     C           SCCY      ANDNE'   '                                     193959
     C                     CALL 'AONOSTR0'                                193959
     C                     PARM *BLANKS   @RTCD   7                       193959
     C                     PARM '*KEY   ' @OPTN   7                       193959
     C                     PARM *BLANKS   @KEYA   6                       193959
     C                     PARM SCCY      @KEYB   3                       193959
     C**********           PARM *BLANKS   @KEYC   4                                    193959 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2                       193959
     C                     PARM NOSP      @KEYE   2                       193959
     C                     PARM *BLANKS   @BRCD   3                       193959
     C                     PARM *BLANKS   @CSSN  10                       193959
     C                     PARM *BLANKS   @PNOI   1                       193959
     C           SDNOST    PARM SDNOST    DSFDY                           193959
     C                     ELSE                                           193959
     C                     CALL 'AONOSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM *BLANKS   @KEYA   6                       S01117
     C                     PARM CYSI      @KEYB   3                       S01117
     C**********           PARM *BLANKS   @KEYC   4                                    S01117 CGL029
     C                     PARM *BLANKS   @KEYC                                               CGL029
     C                     PARM *BLANKS   @KEYD   2                       S01117
     C                     PARM NOSP      @KEYE   2                       S01117
     C                     PARM *BLANKS   @BRCD   3                       S01117
     C                     PARM *BLANKS   @CSSN  10                       S01117
     C                     PARM *BLANKS   @PNOI   1                       S01117
     C           SDNOST    PARM SDNOST    DSFDY                           S01117
     C                     ENDIF                                          193959
     C************IN,36    IFEQ *ZERO                                     S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C                     ELSE                                           123222
     C                     MOVE 'ERROR'   @RTCD                           123222
     C                     ENDIF                                          123222
     C*                                                                   123222
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,36
     C                     END
     C*
     C           *IN,36    IFEQ '1'
     C/COPY WNCPYSRC,SE0030C044
     C                     ADD  1         EC
     C                     MOVEL' 203'    ERR,EC
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CVS4                                           S01408
     C*                                                                   S01408
     C*
     C                     END
     C*                                                                   CSE041
     C                     ENDIF                                          CSE041
     C* VALIDATE PAY BRANCH                                               S01117
     C*                                                                   S01117
     C* VALIDATE BRANCH IF ENTERED                                        S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C           SSPBR     ANDNE*BLANKS                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SSPBR     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A8BRCD    SSPBR                           S01117
     C                     ELSE                                           S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA'1'       *IN,37                          S01117
     C                     MOVEL' 216'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN37     IFEQ '0'                                       S01117
     C           FEATUR    IFEQ 'Y'                                       CSE041
     C           WC1DI     ANDEQ'M'                                       CSE041
     C           SCYSI     ANDEQ*BLANK                                    CSE041
     C           SITSI     ANDNE*BLANK                                    CSE041
     C                     MOVELSSPBR     SPBA                            CSE041
     C                     ELSE                                           CSE041
      *                                                                   CSE041
     C           SSPSM     IFEQ '01'                                      S01117
     C           SSPSM     OREQ '02'                                      S01117
     C           SSPSM     OREQ '07'                                      S01117
     C           SSPSM     OREQ '08'                                      S01117
     C           SSPSM     OREQ '12'                                      S01117
     C/COPY WNCPYSRC,SE0030C045
     C*                                                                   S01117
     C* IF PAY BRANCH NOT ENTERED, SET TO BRANCH ON NOSTRO FILE           S01117
     C*                                                                   S01117
     C           SSPBR     IFEQ *BLANKS                                   S01117
     C                     MOVE A7BRCD    SSPBR                           S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* BRANCH ENTERED MUST BE SAME AS THAT ON NOSTRO FILE                S01117
     C*                                                                   S01117
     C           SSPBR     IFNE A7BRCD                                    S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA'1'       *IN,37                          S01117
     C                     MOVEL' 216'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* IF SETLLEMENT METHOD NOT THROUGH NOSTRO                           S01117
     C* SET PAY BRANCH TO TRADE BOOKING BRANCH IF NOT ENTERED             S01117
     C*                                                                   S01117
     C           SSPBR     IFEQ *BLANKS                                   S01117
     C                     MOVE SSBRH     SSPBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C* IF SETLLEMENT METHOD NOT THROUGH NOSTRO AND NOT 05                S01117
     C* PAY BRANCH MUST BE SAME AS TRADE BOOKING BRANCH                   S01117
     C*                                                                   S01117
     C           SSPSM     IFNE '05'                                      S01117
     C           SSPBR     ANDNESSBRH                                     S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA'1'       *IN,37                          S01117
     C                     MOVEL' 216'    ERR,EC                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                             *SSRSM=01      S01117
     C*                                                                   S01117
     C                     MOVELSSPBR     SPBA                            S01117
     C*                                                                   S01117
     C*
     C** SETT. METHOD 05, CHECK ACTIVE ACCOUNT ON ACCNT
     C*
     C           SSPSM     IFEQ '05'
     C/COPY WNCPYSRC,SE0030C046
     C                     MOVELSSPAT     CNUM
     C**********           MOVE SSPAT     WCDSQ                                              BUG8415
     C                     MOVE SSPAT     WCDSQC                                             BUG8415
     C           *BLANKS   IFEQ WACODC                                                       BUG8415
     C                     Z-ADD0         WACOD                                              BUG8415
     C                     ELSE                                                              BUG8415
     C                     MOVE WACODC    WACOD                                              BUG8415
     C                     ENDIF                                                             BUG8415
     C           *BLANKS   IFEQ WACSQC                                                       BUG8415
     C                     Z-ADD0         WACSQ                                              BUG8415
     C                     ELSE                                                              BUG8415
     C                     MOVE WACSQC    WACSQ                                              BUG8415
     C                     ENDIF                                                             BUG8415
      **                                                                                     BUG8415
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE SSPBR     WBRCA                           S01117
     C                     ELSE                                           S01117
     C                     MOVE USRBCH    WBRCA                           S01117
     C                     END                                            S01117
     C*
     C           KACCNT    CHAINACCNT                36
     C*
     C           *IN,36    IFEQ *ZERO
     C           RECI      ANDEQ'*'
     C                     MOVEA'1'       *IN,36
     C                     END
     C*
     C***BRANCH*MUST*AGREE************************************************S01117
     C***********                                                         S01117
     C***********          MOVELSSPBR     SPBR                            S01117
     C***********                                                         S01117
     C************IN,36    IFEQ '0'                                       S01117
     C***********SPBR      ANDNEBRCD                                      S01117
     C***********          MOVEA'1'       *IN,36                          S01117
     C***********          END                             *IN,36 = 0     S01117
     C           *IN,36    IFEQ '1'
     C/COPY WNCPYSRC,SE0030C047
     C                     ADD  1         EC
     C                     MOVEL' 204'    ERR,EC
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CVS5                                           S01408
     C*                                                                   S01408
     C*
     C                     END
     C*
     C                     ENDIF                                          CSE041
     C*                                                                   CSE041
     C                     END                             **IN37=0       S01117
     C*                                                                   S01117
     C** SETT. METHOD 14, CHECK ACTIVE ACCOUNT ON ACNUM
     C*
     C           SSPSM     IFEQ '14'
     C/COPY WNCPYSRC,SE0030C048
     C                     MOVELSSPAT     KACNUM
     C*                                                                   058355
     C** Check A/C code entered is 10 long and contains only digits       058355
     C** 0 thru 9                                                         058355
     C*                                                                   058355
     C                     MOVE SSPAT     CHK2                            058355
     C                     MOVELSSPAT     CHKAC                           058355
     C           CHK10     CHECKCHKAC                    89               058355
     C           *IN89     IFEQ '1'                                       058355
     C           CHK2      ORNE *BLANKS                                   058355
     C                     MOVE '1'       *IN36                           058355
     C                     SETOF                         89               058355
     C                     ELSE                                           058355
     C*
     C           KACNUM    CHAINACNUM                36
     C                     END                                            058355
     C*
     C           *IN,36    IFEQ *ZERO
     C           RECI      ANDEQ'*'
     C                     MOVEA'1'       *IN,36
     C                     END
     C*
     C** NOW CHAIN TO ACCNT TO CHECK BRANCH
     C*
     C           *IN,36    IFEQ '0'
     C*
     C                     Z-ADDACOD      WACOD
     C                     Z-ADDACSQ      WACSQ
     C           MBIN      IFEQ 'Y'                                       E37014
     C                     MOVE A8BRCD    WBRCA                           S01117
     C                     ELSE                                           E37014
     C                     MOVE USRBCH    WBRCA                           E37014
     C                     END                                            E37014
     C*
     C           KACCNT    CHAINACCNT                36
     C*
     C           *IN,36    IFEQ *ZERO
     C           RECI      ANDEQ'*'
     C                     MOVEA'1'       *IN,36
     C                     END
     C*
     C************IN,36    IFEQ '0'                                       S01117
     C***********                                                         S01117
     C***********          MOVELSSPBR     SPBR                            S01117
     C***********                                                         S01117
     C***********SPBR      IFNE BRCD                                      S01117
     C***********          MOVEA'1'       *IN,36                          S01117
     C***********          END                             *SRBR NE BRCD  S01117
     C***********                                                         S01117
     C***********          END                             *IN,36 = 0     S01117
     C*
     C**********           MOVELCNUM      @CNUM2  60                                   E19985 CSD027
     C                     MOVELCNUM      @CNUM2  6                                           CSD027
     C*
     C                     END
     C*
     C           *IN,36    IFEQ '1'
     C/COPY WNCPYSRC,SE0030C049
     C                     ADD  1         EC
     C                     MOVEL' 205'    ERR,EC
     C/COPY WNCPYSRC,SE0030C050
     C                     END
     C*
     C                     END
     C*
     C** SETT. METHOD 15, CHECK CUSTOMER ON CLINTSE
     C*
     C           SSPSM     IFEQ '15'
     C                     MOVELSSPAT     WINCNO
     C                     MOVEL'N'       WNOSTR
     C                     Z-ADD36        WI
     C                     EXSR VALCST
     C*
     C** SETTLEMENT A/C MUST BE COMPLETED
     C*
     C********** C1AC      IFEQ *ZERO                                     S01117
     C           BFACCD    IFEQ *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,36
     C                     END
     C*
     C           *IN,36    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 206'    ERR,EC
     C                     ELSE
     C*
     C** VALID SO ENSURE CUSTOMER NO IN STDSED RECORD
     C*
     C                     MOVEL*BLANK    SPAT
     C**********           MOVELCNUM      SPAT                            S01117
     C                     MOVELBFCUST    SPAT                            S01117
     C*
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0030C051
     C*
     C** IF PAYCODE IS 1 OR 5 ENSURE THAT BOTH PAY FROM AND DELIVER TO    E19985
     C** ARE AT THE SAME INSTITUTION                                      E19985
     C           SSPCP     IFEQ '1'                                       E19985
     C           SSPCP     OREQ '5'                                       E19985
     C*                                                                   E19985
     C** AND CLEARANCE TYPE 1-4                                           E19985
     C*                                                                   E19985
     C           SSCLP     IFGE '1'                                       E19985
     C           SSCLP     ANDLE'4'                                       E19985
     C           SSPSM     ANDNE'04'                                      103401
     C           SSPSM     IFNE '14'                                      E19985
     C*                                                                   E19985
     C** FIND INSTITUTION REF. FOR THAT PAY A/C BRANCH                    E19985
     C*                                                                   E19985
     C*                                                                   060645
     C** If settlement through nostro check nostro customer number,       060645
     C*                                                                   060645
     C           SSPSM     IFEQ '01'                                      060645
     C           SSPSM     OREQ '02'                                      060645
     C           SSPSM     OREQ '07'                                      060645
     C           SSPSM     OREQ '08'                                      060645
     C           SSPSM     OREQ '12'                                      060645
     C/COPY WNCPYSRC,SE0030C052
     C                     MOVELA7CUST    WINCNO                          060645
     C                     MOVEL'N'       WNOSTR                          060645
     C                     Z-ADD36        WI                              060645
     C                     ELSE                                           060645
     C*                                                                   060645
     C** not settled through nostro                                       060645
     C*                                                                   060645
     C                     MOVELSSPAT     WINCNO                          E19985
     C                     MOVEL'N'       WNOSTR                          E19985
     C                     Z-ADD36        WI                              E19985
     C                     END                                            060645
     C                     EXSR VALCST                                    E19985
     C*                                                                   E19985
     C**********           MOVEL*BLANK    SPATN   60                                   E19985 CSD027
     C                     MOVEL*BLANK    SPATN   6                                           CSD027
     C**********           MOVELCNUM      SPATN                     E19985S01117
     C                     MOVELBFCUST    SPATN                           S01117
     C*                                                                   E19985
     C** SETTLEMENT TYPE 14: ACCEPT RETAIL A/C NO.                        E19985
     C*                                                                   E19985
     C                     ELSE                            SSRSM=14       E19985
     C********** @CNUM2    CHAINCLINTSEF             36             E19985S01117
     C                     MOVEL@CNUM2    @KEYS                           S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYS                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     36                   S01117
     C                     END                                            S01117
     C           SSCLP     IFEQ '1'                                       E19985
     C           SSCLP     OREQ '2'                                       E19985
     C**********           MOVELC101      SPATN                     E19985S01117
     C                     MOVELBFNDR1    BFDRF1                                              CSE022
     C                     MOVELBFDRF1    SPATN                           S01117
     C                     END                                            E19985
     C           SSCLP     IFEQ '3'                                       E19985
     C           SSCLP     OREQ '4'                                       E19985
     C**********           MOVELC102      SPATN                     E19985S01117
     C                     MOVELBFNDR2    BFDRF2                                              CSE022
     C                     MOVELBFDRF2    SPATN                           S01117
     C                     END                                            E19985
     C                     END                                            E19985
     C*                                                                   E19985
     C** SETTLEMENT TYPE 05 OR 15  FIND RELEVANT INSTITUTION              E19985
     C*                                                                   E19985
     C           SSPSM     IFEQ '05'                        SSRSM=05      E19985
     C           SSPSM     OREQ '15'                             =15      E19985
     C********** SPATN     CHAINCLINTSEF             36                   E19985
     C                     MOVELSPATN     @KEYS                           S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYS                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C           SSCLP     IFEQ '1'                                       E19985
     C           SSCLP     OREQ '2'                                       E19985
     C**********           MOVELC101      SPATN                     E19985S01117
     C                     MOVELBFNDR1    BFDRF1                                              CSE022
     C                     MOVELBFDRF1    SPATN                           S01117
     C                     END                                            E19985
     C           SSCLP     IFEQ '3'                                       E19985
     C           SSCLP     OREQ '4'                                       E19985
     C**********           MOVELC102      SPATN                     E19985S01117
     C                     MOVELBFNDR2    BFDRF2                                              CSE022
     C                     MOVELBFDRF2    SPATN                           S01117
     C                     END                                            E19985
     C                     END                                            E19985
     C*                                                                   E19985
     C** FIND INSTITUTION REF. FOR 'DELIVER TO' FIELD                     E19985
     C*                                                                   E19985
     C                     MOVELSSDTO     WINCNO                          E19985
     C                     MOVEL'N'       WNOSTR                          E19985
     C                     Z-ADD36        WI                              E19985
     C                     EXSR VALCST                                    E19985
     C**********           MOVELCNUM      SDTO                      E19985S01117
     C                     MOVELBFCUST    SDTO                            S01117
     C*                                                                   E19985
     C********** SDTO      CHAINCLINTSEF             36             E19985S01117
     C*                                                                   E19985
     C** COMPARE 'PAY FROM' AND 'DELIVER TO' FIELDS                       E19985
     C*                                                                   E19985
     C********** CNUM      IFNE SPATN                               E19985S01117
     C**********           MOVELBFCUST    @SPATN  60                                   S01117 CSD027
     C                     MOVELBFCUST    @SPATN  6                                           CSD027
     C           @SPATN    IFNE SPATN                                     S01117
     C                     SETON                         36               E19985
     C                     END                                            E19985
     C           *IN36     IFEQ '1'                                       E19985
     C                     ADD  1         EC                              E19985
     C                     MOVEL' 252'    ERR,EC                          E19985
     C                     END                                            E19985
     C                     END                                            E19985
     C                     END                                            E19985
     C*
     C**TRANSLATE*AND*VALIDATE*SSPBR*(#NUMV)*-*PAY*BRANCH*****************S01117
     C***********                                                         S01117
     C**If*blank,*use*default*branch********************************S01158S01117
     C***********                                                   S01158S01117
     C***********SSPBR     IFEQ *BLANKS                             S01158S01117
     C***********          MOVE DSTB      SSPBR                     S01158S01117
     C***********          END                                      S01158S01117
     C***********          MOVELSSPBR     SPBR                            S01117
     C***********                                                         S01117
     C**PAY*BRANCH*MUST*BE*ON*TABLETRF************************************S01117
     C***********                                                         S01117
     C***********          Z-ADD10        RECT                            S01117
     C***********          MOVEL*BLANK    ZZ008                           S01117
     C***********          MOVE SSPBR     TABKEY                          S01117
     C***********                                                         S01117
     C***********TABKEY    CHAINTABLETRF             37                   S01117
     C***********                                                         S01117
     C************IN,37    IFEQ *ZERO                                     S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********          MOVEA'1'       *IN,37                          S01117
     C***********          END                             *IN,37 = 0     S01117
     C***********                                                         S01117
     C************IN,37    IFEQ '1'                                       S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEL' 216'    ERR,EC                          S01117
     C***********          END                             *IN,37 = 1     S01117
     C*
     C* TRANSLATE AND VALIDATE SSPCB (#ALPV) - PAY C'PARTY BANK
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCP2                                           S01408
     C*                                                                   S01408
     C                     MOVELSSPCB     SPCB
     C*
     C** ENTRY ONLY ALLOWED FOR SETT. METHODS 01,07 OR 08
     C*
     C           SSPCB     IFNE *BLANK
     C           SSPSM     IFNE '01'
     C           SSPSM     ANDNE'07'
     C           SSPSM     ANDNE'08'
     C                     ADD  1         EC         38
     C                     MOVEL' 217'    ERR,EC
     C                     END
     C                     END
     C*
     C** SETT. METHOD 01,07,08 - MUST BE CUSTOMER OR NOSTRO
     C*
     C           SSPSM     IFEQ '01'
     C           SSPCB     ANDNE*BLANK                                    E19756
     C           SSPSM     OREQ '07'
     C           SSPCB     ANDNE*BLANK                                    121477
     C           SSPSM     OREQ '08'
     C           SSPCB     ANDNE*BLANK                                    121477
     C                     MOVELSSPCB     WINCNO
     C                     MOVEL'Y'       WNOSTR
     C                     Z-ADD38        WI
     C***********          EXSR VALCST                                    E17186
     C                     EXSR VALCCB                                    E17186
     C*
     C           *IN,38    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 218'    ERR,EC
     C                     ELSE
     C*
     C** VALID SO ENSURE CUSTOMER NO PUT IN STDSED RECORD
     C*
     C           WNOSTR    IFEQ 'N'
     C                     MOVEL*BLANK    SPCB
     C**********           MOVELCNUM      SPCB                            S01117
     C                     MOVELBBCUST    SPCB                            S01117
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C* TRANSLATE AND VALIDATE SSPFA (#ALPV) - PAY FOR ACCOUNT OF
     C*
     C                     MOVELSSPFA     SPFA
     C*
     C** ENTRY ONLY ALLOWED FOR SETT. METHODS 01,07 OR 08
     C*
     C           SSPFA     IFNE *BLANK
     C           SSPSM     IFNE '01'
     C           SSPSM     ANDNE'07'
     C           SSPSM     ANDNE'08'
     C                     ADD  1         EC         39
     C                     MOVEL' 219'    ERR,EC
     C                     END
     C                     END
     C*
     C** SETT. METHOD 01,07,08 - MUST BE CUSTOMER OR NOSTRO
     C*
     C***********SSPSM     IFEQ '01'                                      E17186
     C***********SSPSM     OREQ '07'                                      E17186
     C           SSPSM     IFEQ '01'                                      E17186
     C           SSPFA     ANDNE*BLANK                                    E17186
     C           SSPSM     OREQ '07'                                      E17186
     C           SSPFA     ANDNE*BLANK                                    121477
     C           SSPSM     OREQ '08'
     C           SSPFA     ANDNE*BLANK                                    121477
     C                     MOVELSSPFA     WINCNO
     C                     MOVEL'Y'       WNOSTR
     C                     Z-ADD39        WI
     C***********          EXSR VALCST                                    E17186
     C                     EXSR VALCCB                                    E17186
     C*
     C           *IN,39    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 220'    ERR,EC
     C                     ELSE
     C*
     C** VALID SO ENSURE CUSTOMER NO PUT IN STDSED RECORD
     C*
     C           WNOSTR    IFEQ 'N'
     C                     MOVEL*BLANK    SPFA
     C**********           MOVELCNUM      SPFA                            S01117
     C                     MOVELBBCUST    SPFA                            S01117
     C                     END
     C*
     C                     END
     C*
     C                     END
      ** Validate the 'Auto-Settle Indicator'                                                 CSE039
     C                     MOVE SSASI     SASI                                                CSE039
     C           CSE039    IFEQ 'Y'                                                          BUG2198
     C           SSASI     IFNE 'N'                                                           CSE039
     C           SSASI     ANDNE'Y'                                                           CSE039
     C           SSASI     ANDNE'A'                                                           CSE039
     C           SSASI     OREQ *BLANKS                                                       CSE039
     C                     MOVE '1'       *IN54                                               CSE039
     C                     ADD  1         EC                                                  CSE039
     C                     MOVEL' 999'    ERR,EC                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ENDIF                                                             BUG2198
      *                                                                                       CSE039
     C*
     C* TRANSLATE AND VALIDATE SSPSI (#ALPV) - PAY SPECIAL INSTRUCTIONS
     C*
     C                     MOVELSSPSI     SPSI
     C*                                                                   S01412
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCP3                                           S01408
     C*                                                                   S01408
     C** Validate the format of the special instruction field             S01412
     C** for an electronic pay settlement method                          S01412
     C*                                                                   S01412
     C           SSPSI     IFNE *BLANKS                                   S01412
     C           SSRSM     IFEQ '01'                                      S01412
     C           SSRSM     OREQ '08'                                      S01412
     C                     MOVEA*BLANKS   SIL                             S01412
     C                     MOVEASSPSI     SIL                             S01412
     C                     EXSR SEPTVS                                    S01412
     C           CUL       IFEQ 'E'                                       S01412
     C                     MOVEA'1'       *IN,40                          S01412
     C                     ADD  1         EC                              S01412
     C                     MOVE ' 253'    ERR,EC                          S01412
     C                     END                                            S01412
     C           CUL       IFEQ 'X'                                       CSW096
     C                     MOVEA'1'       *IN,40                          CSW096
     C                     ADD  1         EC                              CSW096
     C                     MOVE ' 254'    ERR,EC                          CSW096
     C                     ENDIF                                          CSW096
     C                     END                                            S01412
     C                     END                                            S01412
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCP4                                           S01408
     C*                                                                   S01408
     C*
     C* TRANSLATE AND VALIDATE SSPCP (#ALPV) - PAY CODE - PURCHASE
     C*
     C                     MOVELSSPCP     SPCP
     C*
     C           SSPCP     IFNE *BLANK
     C*
     C** IF ENTERED, MUST BE 0 - 5
     C*
     C           SSPCP     IFLT '0'
     C           SSPCP     ORGT '5'
     C                     ADD  1         EC         41
     C                     MOVEL' 221'    ERR,EC
     C                     END
     C                     END
     C*
     C* TRANSLATE AND VALIDATE SSPCS (#ALPV) - PAY CODE - SALE
     C*
     C                     MOVELSSPCS     SPCS
     C*
     C           SSPCS     IFNE *BLANK
     C*
     C** IF ENTERED, MUST BE 0 - 5
     C*
     C           SSPCS     IFLT '0'
     C           SSPCS     ORGT '5'
     C                     ADD  1         EC         42
     C                     MOVEL' 222'    ERR,EC
     C                     END
     C                     END
     C*
     C* TRANSLATE AND VALIDATE SSCLP (#ALPV) - CLEARANCE TYPE - PURCHASE
     C*
     C                     MOVELSSCLP     SCLP
     C*
     C           SSCLP     IFNE *BLANK
     C*
     C** IF ENTERED, MUST BE 0 - 5
     C*
     C           SSCLP     IFLT '0'
     C           SSCLP     ORGT '5'
     C                     ADD  1         EC         43
     C                     MOVEL' 223'    ERR,EC
     C                     END
     C                     END
     C*
     C* TRANSLATE AND VALIDATE SSCLS (#ALPV) - CLEARANCE TYPE - SALE
     C*
     C                     MOVELSSCLS     SCLS
     C*
     C           SSCLS     IFNE *BLANK
     C*
     C** IF ENTERED, MUST BE 0 - 5
     C*
     C           SSCLS     IFLT '0'
     C           SSCLS     ORGT '5'
     C                     ADD  1         EC         44
     C                     MOVEL' 224'    ERR,EC
     C                     END
     C                     END
     C***********                                                         S01175
     C**TRANSLATE*AND*VALIDATE*SSCLH*(#ALPV)*-*CLEARANCE*HOUSE*IND*****   S01175
     C***********                                                         S01175
     C***********          MOVELSSCLH     SCLH                            S01175
     C***********                                                         S01175
     C***********SSCLH     IFNE *BLANK                                    S01175
     C***********                                                         S01175
     C***IF*ENTERED,*MUST*BE*C*OR*K************************************   S01175
     C***********                                                         S01175
     C***********SSCLH     IFNE 'C'                                       S01175
     C***********SSCLH     ANDNE'K'                                       S01175
     C***********          ADD  1         EC         45                   S01175
     C***********          MOVEL' 234'    ERR,EC                          S01175
     C***********          END                                            S01175
     C***********          END                                            S01175
     C*
     C* TRANSLATE AND VALIDATE SSDTO (#NUMV) - DELIVER TO - OURS
     C*
     C                     MOVELSSDTO     SDTO
     C                     MOVEL*HIVAL    WDIT    1
     C*
     C           SSDTO     IFNE *BLANK
     C                     MOVELSSDTO     WINCNO
     C                     MOVEL'N'       WNOSTR
     C                     Z-ADD46        WI
     C                     EXSR VALCST
     C*
     C           *IN,46    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 225'    ERR,EC
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********SSDFT     IFNE *BLANK                                    S01175             BUG5565
     C***********          ADD  1         EC                              S01175             BUG5565
     C***********          MOVEL' 241'    ERR,EC                          S01175             BUG5565
     C***********          MOVE '1'       *IN46                           S01175             BUG5565
     C***********          END                                            S01175             BUG5565
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           *IN46     IFEQ '0'                                       S01175
     C           SSDTO     ANDNE*BLANK                                    S01175
     C*
     C** CLINTSE FOUND SO CHECK DISCRET. IND WITH TABLE
     C*
     C** CLEARANCE TYPE - PURCHASE =BLANK OR ZERO - CANNOT BE ENTERED
     C*
     C           SCLP      IFEQ *BLANK
     C           SCLP      OREQ *ZERO
     C           SSDTO     IFNE *BLANK
     C                     MOVEA'1'       *IN,46
     C                     END
     C                     END
     C*
     C** CL/TYPE PURCH = 1 OR 2 - MUST BE EUROCLEAR
     C*
     C           SCLP      IFEQ '1'
     C           SCLP      OREQ '2'
     C********** C1DI      IFNE 'E'                                       S01117
     C           BFCLAS    IFNE 'E'                                       S01117
     C                     MOVEA'1'       *IN,46
     C                     END
     C                     END
     C*
     C** CL/TYPE PURCH = 3 OR 4 - MUST BE CEDEL
     C*
     C           SCLP      IFEQ '3'
     C           SCLP      OREQ '4'
     C********** C1DI      IFNE 'C'                                       S01117
     C           BFCLAS    IFNE 'C'                                       S01117
     C                     MOVEA'1'       *IN,46
     C                     END
     C                     END
     C*
     C** CL/TYPE PURCH = 5 - MUST NOT BE CEDEL OR EUROCLEAR
     C*
     C           SCLP      IFEQ '5'
     C********** C1DI      IFEQ 'C'                                       S01117
     C********** C1DI      OREQ 'E'                                       S01117
     C           BFCLAS    IFEQ 'C'                                       S01117
     C           BFCLAS    OREQ 'E'                                       S01117
     C                     MOVEA'1'       *IN,46
     C                     END
     C                     END
     C*
     C** *IN,46 SET IF INVALID
     C*
     C           *IN,46    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 226'    ERR,EC
     C                     END                                            S01175
     C*                                                                   S01175
     C********EUCLID*CHANGE********************************************** S01175              CSE022
     C********-------------********************************************** S01175              CSE022
     C**DEPOT*IS*KASSENVEREIN*(K)*BUT*THE*SWIFT*CURRENCY*CODE*IS*NOT***** S01175              CSE022
     C**'DEM'*(OBTAINED*FROM*TABTG10*WITH*KEY*-SCREEN*CURRENCYDCODE)***** S01175              CSE022
     C*                                                                   S01175
     C********** C1DI      IFEQ 'K'                                 S01175S01117
     C********** BFCLAS    IFEQ 'K'                                       S01117              CSE022
     C***********CCYS      ANDNE'DEM'                              S01175 S01117
     C********** A6SWCY    ANDNE'DEM'                              S01175 S01117              CSE022
     C**********           ADD  1         EC                              S01175              CSE022
     C**********           MOVEL' 239'    ERR,EC                          S01175              CSE022
     C**********           MOVE '1'       *IN46                           S01175              CSE022
     C**********           END                                            S01175              CSE022
     C*
     C***********          ELSE                                           S01175
     C*
     C** IF VALID STORE DISCRET.IND & PUT CUSTOMER NO IN STDSED RECORD    S01175
     C*
     C           *IN46     IFEQ '0'                                       S01175
     C**********           MOVELC1DI      WDIT                            S01117
     C                     MOVELBFCLAS    WDIT                            S01117
     C                     MOVE *BLANKS   SDTO
     C**********           MOVELCNUM      SDTO                            S01117
     C                     MOVELBFCUST    SDTO                            S01117
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*
     C* TRANSLATE AND VALIDATE SSDFO (#NUMV) - DELIVER FROM - OURS
     C*
     C                     MOVELSSDFO     SDFO
     C                     MOVEL*HIVAL    WDIF    1
     C*
     C           SSDFO     IFNE *BLANK
     C                     MOVELSSDFO     WINCNO
     C                     MOVEL'N'       WNOSTR
     C                     Z-ADD47        WI
     C                     EXSR VALCST
     C*
     C           *IN,47    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 227'    ERR,EC
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE
     C*                                                                   S01175
     C***********SSDTT     IFNE *BLANKS                                   S01175             BUG5565
     C***********          ADD  1         EC                              S01175             BUG5565
     C***********          MOVEL' 242'    ERR,EC                          S01175             BUG5565
     C***********          MOVE '1'       *IN47                           S01175             BUG5565
     C***********          END                                            S01175             BUG5565
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           *IN47     IFEQ '0'                                       S01175
     C           SSDFO     ANDNE*BLANKS                                   S01175
     C*
     C** CLINTSE FOUND SO CHECK DISCRET. IND WITH TABLE
     C*
     C** CLEARANCE TYPE - SALE = BLANK OR ZERO - CANNOT BE ENTERED
     C*
     C           SCLS      IFEQ *BLANK
     C           SCLS      OREQ *ZERO
     C           SSDFO     IFNE *BLANK
     C                     MOVEA'1'       *IN,47
     C                     END
     C                     END
     C*
     C** CL/TYPE SALE = 1 OR 2 - MUST BE EUROCLEAR
     C*
     C           SCLS      IFEQ '1'
     C           SCLS      OREQ '2'
     C********** C1DI      IFNE 'E'                                       S01117
     C           BFCLAS    IFNE 'E'                                       S01117
     C                     MOVEA'1'       *IN,47
     C                     END
     C                     END
     C*
     C** CL/TYPE SALE = 3 OR 4 - MUST BE CEDEL
     C*
     C           SCLS      IFEQ '3'
     C           SCLS      OREQ '4'
     C********** C1DI      IFNE 'C'                                       S01117
     C           BFCLAS    IFNE 'C'                                       S01117
     C                     MOVEA'1'       *IN,47
     C                     END
     C                     END
     C*
     C** CL/TYPE SALE = 5 - MUST NOT BE CEDEL OR EUROCLEAR
     C*
     C           SCLS      IFEQ '5'
     C********** C1DI      IFEQ 'C'                                       S01117
     C********** C1DI      OREQ 'E'                                       S01117
     C           BFCLAS    IFEQ 'C'                                       S01117
     C           BFCLAS    OREQ 'E'                                       S01117
     C                     MOVEA'1'       *IN,47
     C                     END
     C                     END
     C*
     C** *IN,47 SET IF INVALID
     C*
     C           *IN,47    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 228'    ERR,EC
     C                     END                                            S01175
     C*                                                                   S01175
     C********EUCLID*CHANGE****************************************S01175 S01175              CSE022
     C********-------------****************************************S01175 S01175              CSE022
     C**DEPOT*IS*KASSENVEREIN(K)*BUT*THE*SWIFT*CURRENCY*CODE*IS*NOT****** S01175              CSE022
     C**'DEM'*(OBTAINED*FROM*TABTG10*WITH*KEY*-SCREEN*CURRENCY*CODE)***** S01175              CSE022
     C*                                                                   S01175
     C********** C1DI      IFEQ 'K'                                 S01175S01117
     C********** BFCLAS    IFEQ 'K'                                       S01117              CSE022
     C***********CCYS      ANDNE'DEM'                              S01175 S01117
     C********** A6SWCY    ANDNE                                   S01175 S01117              CSE022
     C**********           ADD  1         EC                              S01175              CSE022
     C**********           MOVEL' 240'    ERR,EC                          S01175              CSE022
     C**********           MOVE '1'       *IN47                           S01175              CSE022
     C**********           END                                            S01175              CSE022
     C*                                                                   S01175
     C***********          ELSE                                           S01175
     C*                                                                   S01175
     C** VALID SO STORE DISCRET.IND & PUT CUSTOMER NO IN STDSED RECORD
     C*                                                                   S01175
     C************IN47     IFEQ '1'                                S01175 S01176
     C           *IN47     IFEQ '0'                                       S01176
     C**********           MOVELC1DI      WDIF                            S01117
     C                     MOVELBFCLAS    WDIF                            S01117
     C                     MOVE *BLANKS   SDFO
     C**********           MOVELCNUM      SDFO                            S01117
     C                     MOVELBFCUST    SDFO                            S01117
     C*
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*
     C* TRANSLATE AND VALIDATE SSDTT (#NUMV) -  DELIVER TO - THEIRS
     C*
     C                     MOVELSSDTT     SDTT
     C*
     C           SSDTT     IFNE *BLANK
     C                     MOVELSSDTT     WINCNO
     C                     MOVEL'N'       WNOSTR
     C                     Z-ADD48        WI
     C                     EXSR VALCST
     C*
     C           *IN,48    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 229'    ERR,EC
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCP5                                           S01408
     C*                                                                   S01408
     C*                                                                   S01175
     C***********SSDFO     IFNE *BLANKS                                   S01175             BUG5565
     C***********          ADD  1         EC                              S01175             BUG5565
     C***********          MOVEL' 243'    ERR,EC                          S01175             BUG5565
     C***********          MOVE '1'       *IN48                           S01175             BUG5565
     C***********          END                                            S01175             BUG5565
     C*                                                                   S01175
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCP6                                           S01408
     C*                                                                   S01408
     C                     END                                            S01175
     C*                                                                   S01175
     C           *IN48     IFEQ '0'                                       S01175
     C           SSDTT     ANDNE*BLANKS                                   S01175
     C*                                                                   S01175
     C***********          ELSE                                           S01175
     C*                                                                   S01175
     C** CLINTSE FOUND SO CHECK DISCRET. IND WITH TABLE
     C*
     C*
     C** STORE DISCRET IND FOR USE LATER                                  S01175
     C*                                                                   S01175
     C**********           MOVE C1DI      DTC1DI  1                 S01175S01117
     C                     MOVE BFCLAS    DTC1DI  1                       S01117
     C*                                                                   S01175
     C** CLEARANCE TYPE - SALE = BLANK OR ZERO - CANNOT BE ENTERED
     C*
     C           SCLS      IFEQ *BLANK
     C           SCLS      OREQ *ZERO
     C           SSDTT     IFNE *BLANK
     C                     MOVEA'1'       *IN,48
     C                     END
     C                     END
     C*
     C** CL/TYPE SALE = 1 - MUST BE EUROCLEAR
     C*
     C           SCLS      IFEQ '1'
     C********** C1DI      IFNE 'E'                                       S01117
     C           BFCLAS    IFNE 'E'                                       S01117
     C                     MOVEA'1'       *IN,48
     C                     END
     C                     END
     C*
     C***CL/TYPE*SALE*=*2*OR*4*-*MUST*NOT*BE*SAME*AS*OURS**************   S01175
     C***********                                                         S01175
     C***********SCLS      IFEQ '2'                                       S01175
     C***********SCLS      OREQ '4'                                       S01175
     C***********C1DI      IFEQ WDIT                                      S01175
     C***********          MOVEA'1'       *IN,48                          S01175
     C***********          END                                            S01175
     C***********          END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE SALE = 4 - MUST NOT BE DISCRET IND OF C                  S01175
     C*                                                                   S01175
     C           SCLS      IFEQ '4'                                       S01175
     C********** C1DI      IFEQ 'C'                                 S01175S01117
     C           BFCLAS    IFEQ 'C'                                       S01117
     C                     MOVEA'1'       *IN,48                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE SALE = 2 - MUST NOT BE DISCRET IND OF E                  S01175
     C*                                                                   S01175
     C           SCLS      IFEQ '2'                                       S01175
     C********** C1DI      IFEQ 'E'                                 S01175S01117
     C           BFCLAS    IFEQ 'E'                                       S01117
     C                     MOVEA'1'       *IN,48                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*
     C** CL/TYPE SALE = 3  - MUST BE CEDEL
     C*
     C           SCLS      IFEQ '3'
     C********** C1DI      IFNE 'C'                                       S01117
     C           BFCLAS    IFNE 'C'                                       S01117
     C                     MOVEA'1'       *IN,48
     C                     END
     C                     END
     C*
     C***CL/TYPE*SALE*=*5*-*MUST*NOT*BE*CEDEL*OR*EUROCLEAR*************   E19740
     C*
     C***********SCLS      IFEQ '5'                                       E19740
     C***********C1DI      IFEQ 'C'                                       E19740
     C***********C1DI      OREQ 'E'                                       E19740
     C***********          MOVEA'1'       *IN,48                          E19740
     C***********          END                                            E19740
     C***********          END                                            E19740
     C*
     C*
     C** *IN,48 SET IF INVALID
     C*
     C           *IN,48    IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEL' 230'    ERR,EC
     C***********          ELSE                                           S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C********EUCLID*CHANGE********************************************** S01175              CSE022
     C********-------------********************************************** S01175              CSE022
     C***DEPOT*IS*KASSENVEREIN*(K)*BUT*THE*SWIFT*CURRENCY*CODE*IS*NOT**** S01175              CSE022
     C***'DEM'*(OBTAINED*FROM*TABTG10*WITH*KEY*-*SCREEN*CURRENCY*CODE)*** S01175              CSE022
     C*                                                                   S01175
     C* WITH INTRODUCTION OF EURO NEED TO INCLUDE 'EUR'                   157548
     C*                                                                   157548
     C********** C1DI      IFEQ 'K'                                 S01175S01117
     C********** BFCLAS    IFEQ 'K'                                       S01117              CSE022
     C***********CCYS      ANDNE'DEM'                              S01175 S01117
     C********** A6SWCY    ANDNE'DEM'                              S01175 S01117              CSE022
     C********** A6SWCY    ANDNE'EUR'                                     157548              CSE022
     C**********           ADD  1         EC                              S01175              CSE022
     C**********           MOVEL' 241'    ERR,EC                          S01175              CSE022
     C**********           MOVE '1'       *IN48                           S01175              CSE022
     C**********           END                                            S01175              CSE022
     C********** C1DI      IFNE 'E'                                 S01175S01117
     C********** C1DI      ANDNE'C'                                 S01175S01117
     C********** C1DI      ANDNE'K'                                 S01175S01117
     C********** C1DI      ANDNE'X'                                 S01175S01117
     C********** C1DI      ANDNE'M'                                 S01175S01117
     C           BFCLAS    IFNE 'E'                                       S01117
     C           BFCLAS    ANDNE'C'                                       S01117
     C********** BFCLAS    ANDNE'K'                                       S01117              CSE022
     C           BFCLAS    ANDNE'X'                                       S01117
     C           BFCLAS    ANDNE'M'                                       S01117
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 244'    ERR,EC                          S01175
     C                     MOVE '1'       *IN48
     C                     END
     C*
     C** VALID SO ENSURE CUSTOMER NO PUT IN STDSED RECORD
     C*
     C           *IN48     IFEQ '0'
     C                     MOVE *BLANKS   SDTT
     C**********           MOVELCNUM      SDTT                            S01117
     C                     MOVELBFCUST    SDTT                            S01117
     C                     END
     C*
     C                     END
     C*                                                                   S01175
     C* TRANSLATE AND VALIDATE SSFAT (#NUMV)                              S01175
     C*   FOR ACCT OF DEL TO THEIRS                                       S01175
     C*                                                                   S01175
     C                     MOVE '0'       *IN80                           S01175
     C                     MOVELSSFAT     SFAT                            S01175
     C*                                                                   S01175
     C           SSFAT     IFNE *BLANK                                    S01175
     C*                                                                   S01175
     C           SSDFO     IFEQ *BLANKS                                   S01175
     C           SSDTT     OREQ *BLANKS                                   S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 247'    ERR,EC                          S01175
     C                     MOVE '1'       *IN49                           S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C                     MOVELSSFAT     WINCNO                          S01175
     C                     MOVEL'N'       WNOSTR                          S01175
     C                     Z-ADD49        WI                              S01175
     C***********          EXSR VALCST                                    E19758
     C                     EXSR VALCCB                                    E19758
     C           *IN,49    IFEQ '1'                                       S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 231'    ERR,EC                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C           SSDFO     IFNE *BLANKS                                   S01175
     C           SSDTT     ANDNE*BLANKS                                   S01175
     C*                                                                   S01175
     C**********           MOVE SCSTM     WINCNO                                       S01175 203380
     C                     MOVELSCSTM     WINCNO                                              203380
     C                     MOVEL'N'       WNOSTR                          S01175
     C                     Z-ADD49        WI                              S01175
     C                     EXSR VALCST                                    S01175
     C********** C1DI      IFEQ 'S'                                 E19758S01117
     C********** C1DI      OREQ 'D'                                 E19758S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C**********           MOVE SSDTT     WINCNO                                       E19758 CGL029
     C**********           MOVE SSDTT     WINCNO                                      CGL029 BUG8415
     C                     MOVELSSDFT     WINCNO                                             BUG8415
     C                     MOVEL'N'       WNOSTR                          E19758
     C                     Z-ADD49        WI                              E19758
     C                     EXSR VALCST                                    E19758
     C                     END                                            E19758
     C*                                                                   S01175
     C           *IN49     IFEQ '1'                                       S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 231'    ERR,EC                          S01175
     C                     END                             E3             S01175
     C*                                                                   S01175
     C                     END                             E2             S01175
     C                     END                             E1             S01175
     C*                                                                   S01175
     C           *IN49     IFEQ '0'                        B1             S01175
     C*                                                                   S01175
     C** CLEARANCE TYPE - SALE = BLANK OR ZERO - CANNOT BE ENTERED        S01175
     C*                                                                   S01175
     C           SCLS      IFEQ *BLANK                                    S01175
     C           SCLS      OREQ *ZERO                                     S01175
     C           SSFAT     IFNE *BLANK                                    S01175
     C                     MOVEA'1'       *IN,49                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE SALE = 1  - FAO MUST BE PARTICIPANT AT EUROCL            S01175
     C*                                                                   S01175
     C           SCLS      IFEQ '1'                                       S01175
     C********** PN01      ANDNE'P '                                S01175S01117
     C           BFPNP1    ANDNE'P '                                      S01117
     C           SSFAT     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFO     IFNE *BLANKS                                                      BUG7267
     C           SSDTT     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN47                           S01175
     C                     MOVE '1'       *IN48                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,49                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE SALE =  2 - FAO MUST BE PARTICIPANT OR NON               S01175
     C*                                                                   S01175
     C           SCLS      IFEQ '2'                                       S01175
     C********** PN01      IFNE 'P '                                S01175S01117
     C********** PN01      ANDNE'NP'                                S01175S01117
     C           BFPNP1    IFNE 'P '                                      S01117
     C           BFPNP1    ANDNE'NP'                                      S01117
     C*                                                                   S01175
     C           DTC1DI    IFNE 'C'                                       E19758
     C********** PN02      ANDNE'P '                                E19758S01117
     C           BFPNP2    ANDNE'P '                                      S01117
     C*                                                                   S01175
     C           SSFAT     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFO     IFNE *BLANKS                                                      BUG7267
     C           SSDTT     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN47                           S01175
     C                     MOVE '1'       *IN48                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,49                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            E19758
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE SALE = 3 - MUST BE CEDEL PARTICIPANT                     S01175
     C*                                                                   S01175
     C           SCLS      IFEQ '3'                                       S01175
     C********** PN02      IFNE 'P '                                S01175S01117
     C           BFPNP2    IFNE 'P '                                      S01117
     C           SSFAT     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFO     IFNE *BLANKS                                                      BUG7267
     C           SSDTT     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN47                           S01175
     C                     MOVE '1'       *IN48                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,49                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE SALE = 4 - AND DELIVER TO THEIRS (SSDTT) IS              S01175
     C** EUROCLEAR BUT FOR ACCNT OF DEL TO THEIRS IS NOT A                S01175
     C** PARTICIPANT OF EUROCLEAR                                         S01175
     C*                                                                   S01175
     C           SCLS      IFEQ '4'                                       S01175
     C           DTC1DI    ANDEQ'E'                                       S01175
     C********** PN01      ANDNE'P '                                S01175S01117
     C           BFPNP1    ANDNE'P '                                      S01117
     C           SSFAT     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFO     IFNE *BLANKS                                                      BUG7267
     C           SSDTT     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN47                           S01175
     C                     MOVE '1'       *IN48                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,49                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C***IF*FAO*DEL*TO*THEIRS*IS*A*SAFE*CUST*OR*DISCRETIONARY**********   S01175
     C** CL/TYPE SALE = 5 - IF DEL TO THEIRS DISCRET IND IS               S01175
     C** CEDEL/E.CLEAR THEN FAO DEL TO THEIRS MUST BE A PARTICIPANT AT    S01175
     C** CEDEL/E.CLEAR                                                    S01175
     C*                                                                   S01175
     C           SCLS      IFEQ '5'                                       S01175
     C*                                                                   S01175
     C***********C1DI      IFEQ 'S'                                       S01175
     C***********C1DI      OREQ 'D'                                       S01175
     C*                                                                   S01175
     C           DTC1DI    IFEQ 'E'                                       S01175
     C********** PN01      ANDNE'P '                                S01175S01117
     C           BFPNP1    ANDNE'P '                                      S01117
     C           SSFAT     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFO     IFNE *BLANKS                                                      BUG7267
     C           SSDTT     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN47                           S01175
     C                     MOVE '1'       *IN48                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,49                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C           DTC1DI    IFEQ 'C'                                       S01175
     C********** PN02      ANDNE'P '                                S01175S01117
     C           BFPNP2    ANDNE'P '                                      S01117
     C           SSFAT     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFO     IFNE *BLANKS                                                      BUG7267
     C           SSDTT     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN47                           S01175
     C                     MOVE '1'       *IN48                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,49                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C***********          END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** *IN,49 SET IF INVALID                                            S01175
     C*                                                                   S01175
     C           *IN,49    IFEQ '1'                                       S01175
     C           *IN80     OREQ '1'                                       S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 236'    ERR,EC                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C*** CUSTOMER DIS IND MUST NOT = E,C,K OR X                          S01175
     C*                                                                   S01175
     C           SSFAT     IFNE *BLANKS                                   S01175
     C********** C1DI      IFEQ 'E'                                 S01175S01117
     C********** C1DI      OREQ 'C'                                 S01175S01117
     C********** C1DI      OREQ 'K'                                 S01175S01117
     C********** C1DI      OREQ 'X'                                 S01175S01117
     C           BFCLAS    IFEQ 'E'                                       S01117
     C           BFCLAS    OREQ 'C'                                       S01117
     C********** BFCLAS    OREQ 'K'                                       S01117              CSE022
     C           BFCLAS    OREQ 'X'                                       S01117
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 248'    ERR,EC                          S01175
     C                     MOVE '1'       *IN49                           S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           *IN,49    IFEQ '0'                                       E17198
     C           SSFAT     ANDNE*BLANKS                                   E17198
     C                     MOVEL*BLANK    SFAT                            E17198
     C**********           MOVELCNUM      SFAT                      E17198S01117
     C                     MOVELBFCUST    SFAT                            S01117
     C                     END                                            E17198
     C*                                                                   E17198
     C                     END                                            S01175
     C*                                                                   S01175
     C* TRANSLATE AND VALIDATE SSDFT (#NUMV) -  DELIVER FROM              S01175
     C*                                                                   S01175
     C                     MOVELSSDFT     SDFT                            S01175
     C*                                                                   S01175
     C           SSDFT     IFNE *BLANK                                    S01175
     C                     MOVELSSDFT     WINCNO                          S01175
     C                     MOVEL'N'       WNOSTR                          S01175
     C                     Z-ADD50        WI                              S01175
     C                     EXSR VALCST                                    S01175
     C*                                                                   S01175
     C           *IN,50    IFEQ '1'                                       S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 232'    ERR,EC                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCP7                                           S01408
     C*                                                                   S01408
     C*                                                                   S01175
     C***********SSDTO     IFNE *BLANKS                                   S01175             BUG5565
     C***********          ADD  1         EC                              S01175             BUG5565
     C***********          MOVEL' 245'    ERR,EC                          S01175             BUG5565
     C***********          MOVE '1'       *IN50                           S01175             BUG5565
     C***********          END                                            S01175             BUG5565
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0030CCP8                                           S01408
     C*                                                                   S01408
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           SSDFT     IFNE *BLANKS                                   S01175
     C           *IN50     ANDEQ'0'                                       S01175
     C*                                                                   S01175
     C** STORE DISCRET IND FOR USE LATER                                  S01175
     C*                                                                   S01175
     C**********           MOVE C1DI      DFC1DI  1                 S01175S01117
     C                     MOVE BFCLAS    DFC1DI  1                       S01117
     C*                                                                   S01175
     C*                                                                   S01175
     C** CLINTSE FOUND SO CHECK DISCRET. IND WITH TABLE                   S01175
     C*                                                                   S01175
     C** CLEARANCE TYPE - PURCHASE = BLANK OR ZERO - CANNOT               S01175
     C*                                                                   S01175
     C           SCLP      IFEQ *BLANK                                    S01175
     C           SCLP      OREQ *ZERO                                     S01175
     C           SSDFT     IFNE *BLANK                                    S01175
     C                     MOVEA'1'       *IN,50                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE PURCH = 1 - MUST BE EUROCLEAR                            S01175
     C*                                                                   S01175
     C           SCLP      IFEQ '1'                                       S01175
     C********** C1DI      IFNE 'E'                                 S01175S01117
     C           BFCLAS    IFNE 'E'                                       S01117
     C                     MOVEA'1'       *IN,50                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE PURC = 4 - MUST NOT BE DISCRET IND OF C                  S01175
     C*                                                                   S01175
     C           SCLP      IFEQ '4'                                       S01175
     C********** C1DI      IFEQ 'C'                                 S01175S01117
     C           BFCLAS    IFEQ 'C'                                       S01117
     C                     MOVEA'1'       *IN,50                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE PURC = 2 - MUST NOT BE DISCRET IND OF E                  S01175
     C*                                                                   S01175
     C           SCLP      IFEQ '2'                                       S01175
     C********** C1DI      IFEQ 'E'                                 S01175S01117
     C           BFCLAS    IFEQ 'E'                                       S01117
     C                     MOVEA'1'       *IN,50                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE PURCH = 3  - MUST BE CEDEL                               S01175
     C*                                                                   S01175
     C           SCLP      IFEQ '3'                                       S01175
     C********** C1DI      IFNE 'C'                                 S01175S01117
     C           BFCLAS    IFNE 'C'                                       S01117
     C                     MOVEA'1'       *IN,50                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** *IN,50 SET IF INVALID                                            S01175
     C*                                                                   S01175
     C           *IN,50    IFEQ '1'                                       S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 233'    ERR,EC                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C********EUCLID*CHANGE********************************************** S01175              CSE022
     C********-------------********************************************** S01175              CSE022
     C***DEPOT*IS*KASSENVEREIN*(K)*BUT*THE*SWIFT*CURRENCY*C************** S01175              CSE022
     C***'DEM'*(OBTAINED*FROM*TABTG10*WITH*KEY*-*SCREEN*CUR************** S01175              CSE022
     C**WITH*INTRODUCTION*OF*EURO*NEED*TO*INCLUDE*'EUR'****************** 157548              CSE022
     C*                                                                   S01175
     C********** C1DI      IFEQ 'K'                                 S01175S01117
     C********** BFCLAS    IFEQ 'K'                                       S01117              CSE022
     C***********CCYS      ANDNE'DEM'                              S01175 S01117
     C********** A6SWCY    ANDNE'DEM'                              S01175 S01117              CSE022
     C********** A6SWCY    ANDNE'EUR'                                     157548              CSE022
     C**********           ADD  1         EC                              S01175              CSE022
     C**********           MOVEL' 242'    ERR,EC                          S01175              CSE022
     C**********           MOVE '1'       *IN50                           S01175              CSE022
     C**********           END                                            S01175              CSE022
     C*                                                                   S01175
     C********** C1DI      IFNE 'E'                                 S01175S01117
     C********** C1DI      ANDNE'C'                                 S01175S01117
     C********** C1DI      ANDNE'K'                                 S01175S01117
     C********** C1DI      ANDNE'X'                                 S01175S01117
     C********** C1DI      ANDNE'M'                                 S01175S01117
     C           BFCLAS    IFNE 'E'                                       S01117
     C           BFCLAS    ANDNE'C'                                       S01117
     C********** BFCLAS    ANDNE'K'                                       S01117              CSE022
     C           BFCLAS    ANDNE'X'                                       S01117
     C           BFCLAS    ANDNE'M'                                       S01117
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 246'    ERR,EC                          S01175
     C                     MOVE '1'       *IN50                           S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           *IN50     IFEQ '0'                                       S01176
     C                     MOVE *BLANKS   SDFT                            S01176
     C**********           MOVELCNUM      SDFT                      S01176S01117
     C                     MOVELBFCUST    SDFT                            S01117
     C                     END                                            S01176
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C* TRANSLATE AND VALIDATE SSFAF (#NUMV)                              S01175
     C*   FOR ACCT OF DEL FROM THEIRS                                     S01175
     C*                                                                   S01175
     C                     MOVE '0'       *IN80                           S01175
     C                     MOVELSSFAF     SFAF                            S01175
     C*                                                                   S01175
     C           SSFAF     IFNE *BLANK                                    S01175
     C*                                                                   S01175
     C           SSDFT     IFEQ *BLANKS                                   S01175
     C           SSDTO     OREQ *BLANKS                                   S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 249'    ERR,EC                          S01175
     C                     MOVE '1'       *IN51                           S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C                     MOVELSSFAF     WINCNO                          S01175
     C                     MOVEL'N'       WNOSTR                          S01175
     C                     Z-ADD51        WI                              S01175
     C***********          EXSR VALCST                                    E17186
     C                     EXSR VALCCB                                    E17186
     C           *IN,51    IFEQ '1'                                       S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 237'    ERR,EC                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C           SSDFT     IFNE *BLANKS                                   S01175
     C           SSDTO     ANDNE*BLANKS                                   S01175
     C*                                                                   S01175
     C**********           MOVE SCSTM     WINCNO                                       S01175 203380
     C                     MOVELSCSTM     WINCNO                                              203380
     C                     MOVEL'N'       WNOSTR                          S01175
     C                     Z-ADD51        WI                              S01175
     C                     EXSR VALCST                                    S01175
     C********** C1DI      IFEQ 'S'                                 E19758S01117
     C********** C1DI      OREQ 'D'                                 E19758S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C**********           MOVE SSDFT     WINCNO                                       E19758 CGL029
     C                     MOVE SSDFT     WINCNO                                              CGL029
     C                     MOVEL'N'       WNOSTR                          E19758
     C                     Z-ADD51        WI                              E19758
     C                     EXSR VALCST                                    E19758
     C                     END                                            E19758
     C*                                                                   S01175
     C           *IN51     IFEQ '1'                                       S01175
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 237'    ERR,EC                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           *IN51     IFEQ '0'                                       S01175
     C*                                                                   S01175
     C** CLEARANCE TYPE - PUR = BLANK OR ZERO - CANNOT BE E               S01175
     C*                                                                   S01175
     C           SCLP      IFEQ *BLANK                                    S01175
     C           SCLP      OREQ *ZERO                                     S01175
     C           SSFAF     IFNE *BLANK                                    S01175
     C                     MOVEA'1'       *IN,51                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE PUR = 1  - FAO MUST BE PARTICIPANT AT EURO               S01175
     C*                                                                   S01175
     C           SCLP      IFEQ '1'                                       S01175
     C********** PN01      IFNE 'P '                                S01175S01117
     C           BFPNP1    IFNE 'P '                                      S01117
     C           SSFAF     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFT     IFNE *BLANKS                                                      BUG7267
     C           SSDTO     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN46                           S01175
     C                     MOVE '1'       *IN50                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,51                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE PUR =  2 - FAO MUST BE PARTICIPANT OR NON-               S01175
     C*                                                                   S01175
     C           SCLP      IFEQ '2'                                       S01175
     C********** PN01      IFNE 'P '                                S01175S01117
     C********** PN01      ANDNE'NP'                                S01175S01117
     C           BFPNP1    IFNE 'P '                                      S01117
     C           BFPNP1    ANDNE'NP'                                      S01117
     C*                                                                   S01175
     C********** C1DI      IFNE 'C'                                 E19758S01117
     C********** PN02      ANDNE'P '                                E19758S01117
     C           BFCLAS    IFNE 'C'                                       S01117
     C           BFPNP2    ANDNE'P '                                      S01117
     C*                                                                   S01175
     C           SSFAF     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFT     IFNE *BLANKS                                                      BUG7267
     C           SSDTO     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN46                           S01175
     C                     MOVE '1'       *IN50                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,51                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            E19758
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE PUR = 3 - MUST BE CEDEL PARTICIPANT                      S01175
     C*                                                                   S01175
     C           SCLP      IFEQ '3'                                       S01175
     C********** PN02      IFNE 'P '                                S01175S01117
     C           BFPNP2    IFNE 'P '                                      S01117
     C           SSFAF     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFT     IFNE *BLANKS                                                      BUG7267
     C           SSDTO     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN46                           S01175
     C                     MOVE '1'       *IN50                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,51                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** CL/TYPE PUR = 4 - AND DELIVER FROM THEIRS (SSDFTT)               S01175
     C** BUT FOR ACCNT OF DEL FROM THEIRS NOT A PARTICIPANT               S01175
     C*                                                                   S01175
     C           SCLP      IFEQ '4'                                       S01175
     C           DFC1DI    ANDEQ'E'                                       S01175
     C********** PN01      ANDNE'P '                                S01175S01117
     C           BFPNP1    ANDNE'P '                                      S01117
     C           SSFAF     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFT     IFNE *BLANKS                                                      BUG7267
     C           SSDTO     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN46                           S01175
     C                     MOVE '1'       *IN50                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,51                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C***IF*FAO*DEL*FROM*THEIRS*IS*A*SAFE*CUST*OR*DISCRETIONARY********   S01175
     C** CL/TYPE SALE = 5 - IF DEL FROM THEIRS DISCRET IND                S01175
     C** THEN FAO DEL FROM THEIRS MUST BE A PARTICIPANT AT                S01175
     C** EUROCLEAR RESPECTIVELY                                           S01175
     C*                                                                   S01175
     C           SCLS      IFEQ '5'                                       S01175
     C*                                                                   S01175
     C***********C1DI      IFEQ 'S'                                       S01175
     C***********C1DI      OREQ 'D'                                       S01175
     C*                                                                   S01175
     C           DFC1DI    IFEQ 'E'                                       S01175
     C********** PN01      ANDNE'P '                                S01175S01117
     C           BFPNP1    ANDNE'P '                                      S01117
     C           SSFAF     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFT     IFNE *BLANKS                                                      BUG7267
     C           SSDTO     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN46                           S01175
     C                     MOVE '1'       *IN50                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,51                          S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C           DFC1DI    IFEQ 'C'                                       S01175
     C********** PN02      ANDNE'P '                                S01175S01117
     C           BFPNP2    ANDNE'P '                                      S01117
     C           SSFAF     IFEQ *BLANKS                                   S01175
      *                                                                                      BUG7267
     C           SSDFT     IFNE *BLANKS                                                      BUG7267
     C           SSDTO     ANDNE*BLANKS                                                      BUG7267
     C                     MOVE '1'       *IN46                           S01175
     C                     MOVE '1'       *IN50                           S01175
     C                     MOVE '1'       *IN80                           S01175
     C                     ENDIF                                                             BUG7267
      *                                                                                      BUG7267
     C                     ELSE                                           S01175
     C                     MOVEA'1'       *IN,51                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C***********          END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** *IN,51 SET IF INVALID                                            S01175
     C*                                                                   S01175
     C           *IN,51    IFEQ '1'                                       S01175
     C           *IN80     OREQ '1'                                       S01175
     C           EC        IFNE 0                                         E17185
     C           ERR,EC    ANDNE' 237'                                    E17185
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 238'    ERR,EC                          S01175
     C                     END                                            E17185
     C*                                                                   S01175
     C           EC        IFEQ 0                                         E19758
     C                     ADD  1         EC                              E19758
     C                     MOVEL' 238'    ERR,EC                          E19758
     C                     END                                            E19758
     C                     END                                            S01175
     C*                                                                   S01175
     C*** CUSTOMER DIS IND MUST NOT = E,C,K OR X                          S01175
     C*                                                                   S01175
     C           EC        IFNE 0                                         E17185
     C           ERR,EC    ANDNE' 237'                                    E17185
     C           SSFAF     IFNE *BLANKS                                   S01175
     C********** C1DI      IFEQ 'E'                                 S01175S01117
     C********** C1DI      OREQ 'C'                                 S01175S01117
     C********** C1DI      OREQ 'K'                                 S01175S01117
     C********** C1DI      OREQ 'X'                                 S01175S01117
     C           BFCLAS    IFEQ 'E'                                       S01117
     C           BFCLAS    OREQ 'C'                                       S01117
     C********** BFCLAS    OREQ 'K'                                       S01117              CSE022
     C           BFCLAS    OREQ 'X'                                       S01117
     C                     ADD  1         EC                              S01175
     C                     MOVEL' 250'    ERR,EC                          S01175
     C                     MOVE '1'       *IN51                           S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            E17185
     C*                                                                   S01175
     C           *IN50     IFEQ '0'                                       E17198
     C           SSFAF     ANDNE*BLANKS                                   E17198
     C                     MOVEL*BLANK    SFAF                            E17198
     C**********           MOVELCNUM      SFAF                      E17198S01117
     C                     MOVELBFCUST    SFAF                            S01117
     C                     END                                            E17198
     C*                                                                   E17198
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C           WSNEW     ANDNE*BLANK                                                        CSE028
     C           WSTFDM    ANDNE*BLANK                                                        CSE028
     C                     MOVELWSNEW     SNEW                                                CSE028
     C                     MOVELWSTFDM    STFDM                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C** IF ACTION=D WITH ENTER PRESSED THEN ERROR                        S01175
     C*                                                                   S01175
     C           ACTN      IFEQ 'D'                                       S01175
     C                     MOVELINF,9     INFMSG                          S01175
     C                     MOVE *ON       *IN84                                              BUG2198
     C                     END                                            S01175
     C                     END                                            S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C** IF COMMAND 4 TAKEN
     C*
     C           AID       IFEQ '04'
     C*
     C** COMMAND 4 TAKEN CORRECTLY WHEN ACTION IS D - FORCE 'ADVANCE'
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVEL'RA'      AID
     C*
     C** COMMAND 4 TAKEN INCORRECTLY WHEN ACTION IS NOT D
     C*
     C                     ELSE
     C                     MOVELINF,10    INFMSG
     C                     MOVE *ON       *IN84                                              BUG2198
     C                     END
     C                     END
     C*
     C                     END
      *                                                                   185733
     C                     MOVE SSKAC     SKAC                            185733
      *                                                                                       204749
     C           WKVAL1    IFEQ *BLANKS                                                       204749
     C           WKVAL2    ANDEQ*BLANKS                                                       204749
     C           WKVAL3    ANDEQ*BLANKS                                                       204749
     C           SSCCY     ANDEQ*BLANKS                                                       204749
     C           SSKAC     ANDEQ*BLANKS                                                       204749
     C           ACTN      IFEQ 'I'                                                           204749
     C           ACTN      OREQ 'A'                                                           204749
     C                     MOVELINF,10    INFMSG                                              204749
     C                     MOVELINF,12    INFMSG                                              204749
     C                     MOVE *ON       *IN84                                              BUG2198
     C                     ENDIF                                                              204749
     C                     ENDIF                                                              204749
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C**********           MOVELHI        ERRMSG                                              255417
     C                     MOVE *ON       *IN83                                              BUG2198
     C                     ELSE                                                              BUG2198
     C                     MOVE *OFF      *IN83                                              BUG2198
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  VALCST - Subroutine to Validate Customer Number/Shortname or *
     C*           Counterparty Nostro.                                *
     C*                                                               *
     C*  Called from: VALIDK, VALIDD                                  *
     C*  Calls: None.                                                 *
     C*                                                               *
     C*  Input : WINCNO - Field to be validated.                      *
     C*          WNOSTR - 'Y' if C'Party Nostro allowed, Else 'N'.    *
     C*          WI     - Indicator to be set on if invalid.          *
     C*                                                               *
     C***Output:*CLINTSE*Or*TABLET2*Record*if*valid,Else*Indicator*set*   S01117
     C* Output:SDSECSPD or SDCNSTPD Record if valid,Else Indicator set*   S01117
     C*                                                               *
     C*****************************************************************
     C*
     C           VALCST    BEGSR
     C*
     C** CHECK FOR NUMERIC ENTRY
     C*
     C**********           MOVELWINCNO    WORK6N  60                                          CSD027
     C                     MOVELWINCNO    WORK6N  6                                           CSD027
     C                     MOVELWORK6N    WORK6A  6
     C                     SETOF                     99                   S01117
     C                     MOVELWINCNO    @KEYS   6                       S01117
     C*
     C           WINCNO    IFNE WORK6A
     C**********           MOVEA'1'       *IN,WI                          S01117
     C**********           ELSE                                           S01117
     C**********                                                          S01117
     C***NUMBER, SO CHECK FOR VALID CLINTSE CUSTOMER                      S01117
     C**********                                                          S01117
     C********** WORK6N    CHAINCLINTSEF             99                   S01117
     C********** *IN,99    IFEQ '0'                                       S01117
     C********** RECI      ANDEQ'*'                                       S01117
     C**********           MOVEA'1'       *IN,99                          S01117
     C**********           END                                            S01117
     C**********                                                          S01117
     C********** *IN,99    IFEQ '1'                                       S01117
     C**********           MOVEA'1'       *IN,WI                          S01117
     C**********           END                                            S01117
     C**********                                                          S01117
     C**********           END                                            S01117
     C**********                                                          S01117
     C***IF*INDICATOR ON, NOT CUSTOMER NUMBER - CHECK FOR SHORTNAME       S01117
     C**********                                                          S01117
     C********** *IN,WI    IFEQ '1'                                       S01117
     C**********                                                          S01117
     C**********           MOVELWINCNO    WINCNM 10                       S01117
     C********** WINCNM    CHAINSNAME                99                   S01117
     C*                                                                   S01117
     C** IF SHORTNAME,LOOK UP ON SDCUSTPD FIRST                           S01117
     C*                                                                   S01117
     C                     MOVELWINCNO    @CKEY  10                       S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*
     C********** *IN,99    IFEQ '0'                                       S01117
     C********** RECI      ANDEQ'*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,99
     C                     ELSE                                           S01117
     C                     MOVELBBCUST    @KEYS                           S01117
     C                     END                                            S01117
     C                     END
     C*
     C           *IN,99    IFEQ '0'
     C*
     C***SHORTNAME*FOUND*-*LOOK FOR CLINTSE                               S01117
     C** LOOK UP CUSTOMER NUMBER ON SDSECSPD                              S01117
     C*
     C********** CNUM      CHAINCLINTSEF             99                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYS                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*
     C********** *IN,99    IFEQ '0'                                       S01117
     C********** RECI      ANDEQ'*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,99
     C                     END
     C*
     C                     END
     C*
     C** CLINTSE FOUND IF *IN,99 NOT SET
     C*
     C           *IN,99    IFEQ '0'
     C                     MOVEA'0'       *IN,WI
     C                     ELSE                                           S01117
     C                     MOVEA'1'       *IN,WI                          S01117
     C                     END
     C*
     C**********           END                                            S01117
     C*
     C           *IN,WI    IFEQ '1'
     C           WNOSTR    IFEQ 'Y'
     C           WINCNO    ANDNE*BLANK
     C*
     C** NOT CUSTOMER - CHECK FOR C'PARTY NOSTRO IF ALLOWED
     C*
     C**********           MOVEL'71'      RECT                            S01117
     C**********           MOVEL*BLANK    ZZ008                           S01117
     C**********           MOVELWINCNO    NOSTR                           S01117
     C*
     C********** TABKEY    CHAINTABSE                99                   S01117
     C                     MOVELWINCNO    @KEYCN  8                       S01117
     C                     CALL 'AOCNSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYCN                          S01117
     C           SDCNST    PARM SDCNST    DSFDY                           S01117
     C*
     C********** *IN,99    IFEQ '0'                                       S01117
     C********** RECI      ANDEQ'*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,99
     C                     END
     C*
     C           *IN,99    IFEQ '0'
     C                     MOVEA'0'       *IN,WI
     C                     END
     C*
     C                     END
     C*
     C                     ELSE
     C                     MOVEL'N'       WNOSTR
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VALCCB - Subroutine to Validate Customer Number/Shortname or *
      *           Counterparty Nostro.                                *
      *                                                               *
      *  Called from: VALIDK, VALIDD                                  *
      *  Calls: None.                                                 *
      *                                                               *   E17186
      *  Input : WINCNO - Field to be validated.                      *   E17186
      *          WNOSTR - 'Y' if Counterparty Nostro allowed, Else 'N'*   E17186
      *          WI     - Indicator to be set on if invalid.          *   E17186
      *                                                               *   E17186
      ***Output:*CLINTCB*Or*TABLET2*Record*if*valid,Else*Indicator*SE17186S01117
      * Output:SDCUSTPD or SDCNSTPD Record if valid,Else Indicator Set*   S01117
      *                                                               *
      *****************************************************************
      *
     C           VALCCB    BEGSR                                          E17186
     C*                                                                   E17186
     C** CHECK FOR NUMERIC ENTRY                                          E17186
     C*                                                                   E17186
     C**********           Z-ADD0         WCLNT   60                E17186S01117
     C**********           MOVELWINCNO    WORK6N  60                E17186S01117
     C**********           MOVELWORK6N    WORK6A  6                 E17186S01117
     C**********                                                    E17186S01117
     C********** WINCNO    IFNE WORK6A                              E17186S01117
     C**********           MOVEA'1'       *IN,WI                    E17186S01117
     C**********           ELSE                                     E17186S01117
     C**********                                                    E17186S01117
     C***NUMBER, SO CHECK FOR VALID CLINTSE CUSTOMER                E17186S01117
     C**********                                                    E17186S01117
     C********** WORK6N    CHAINCLINTCBF             99             E17186S01117
     C********** *IN,99    IFEQ '0'                                 E17186S01117
     C********** RECI      ANDEQ'*'                                 E17186S01117
     C**********           MOVEA'1'       *IN,99                    E17186S01117
     C**********           END                                      E17186S01117
     C**********                                                    E17186S01117
     C********** *IN,99    IFEQ '1'                                 E17186S01117
     C**********           MOVEA'1'       *IN,WI                    E17186S01117
     C**********           ELSE                                     E17186S01117
     C**********           Z-ADDCNUM      WCLNT                     E17186S01117
     C**********           END                                      E17186S01117
     C**********                                                    E17186S01117
     C**********           END                                      E17186S01117
     C**********                                                    E17186S01117
     C***IF*INDICATOR ON, NOT CUSTOMER NUMBER - CHECK FOR SHORTNAME E17186S01117
     C**********                                                    E17186S01117
     C********** *IN,WI    IFEQ '1'                                 E17186S01117
     C*                                                                   E17186
     C**********           MOVELWINCNO    WINCNM 10                 E17186S01117
     C********** WINCNM    CHAINSNAME                99             E17186S01117
     C*                                                                   S01117
     C** LOOK UP ON SDCUSTPD                                              S01117
     C*                                                                   S01117
     C                     SETOF                     99                   S01117
     C                     MOVELWINCNO    @CKEY  10                       S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   E17186
     C********** *IN,99    IFEQ '0'                                 E17186S01117
     C********** RECI      ANDEQ'*'                                 E17186S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,99                          E17186
     C                     END                                            E17186
     C*                                                                   E17186
     C********** *IN,99    IFEQ '0'                                 E17186S01117
     C**********                                                    E17186S01117
     C***SHORTNAME FOUND - LOOK FOR CLINTCB                         E17186S01117
     C**********                                                    E17186S01117
     C********** CNUM      CHAINCLINTCBF             99             E17186S01117
     C**********                                                    E17186S01117
     C********** *IN,99    IFEQ '0'                                 E17186S01117
     C********** RECI      ANDEQ'*'                                 E17186S01117
     C**********           MOVEA'1'       *IN,99                    E17186S01117
     C**********           END                                      E17186S01117
     C**********                                                    E17186S01117
     C**********           END                                      E17186S01117
     C*                                                                   E17186
     C** CLINTCB FOUND IF *IN,99 NOT SET                                  E17186
     C*                                                                   E17186
     C           *IN,99    IFEQ '0'                                       E17186
     C                     MOVEA'0'       *IN,WI                          E17186
     C**********           Z-ADDCNUM      WCLNT                     E17186S01117
     C                     ELSE                                           S01117
     C                     MOVEA'1'       *IN,WI                          S01117
     C                     END                                            E17186
     C*                                                                   E17186
     C**********           END                                      E17186S01117
     C*                                                                   E17186
     C           *IN,WI    IFEQ '1'                                       E17186
     C           WNOSTR    IFEQ 'Y'                                       E17186
     C           WINCNO    ANDNE*BLANK                                    E17186
     C*                                                                   E17186
     C** NOT CUSTOMER - CHECK FOR C'PARTY NOSTRO IF ALLOWED               E17186
     C*                                                                   E17186
     C**********           MOVEL'71'      RECT                      E17186S01117
     C**********           MOVEL*BLANK    ZZ008                     E17186S01117
     C**********           MOVELWINCNO    NOSTR                     E17186S01117
     C*                                                                   E17186
     C********** TABKEY    CHAINTABSE                99             E17186S01117
     C                     SETOF                     99                   054933
     C                     MOVELWINCNO    @KEYCN  8                       S01117
     C                     CALL 'AOCNSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYCN                          S01117
     C           SDCNST    PARM SDCNST    DSFDY                           S01117
     C*                                                                   E17186
     C********** *IN,99    IFEQ '0'                                 E17186S01117
     C********** RECI      ANDEQ'*'                                 E17186S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEA'1'       *IN,99                          E17186
     C                     END                                            E17186
     C*                                                                   E17186
     C           *IN,99    IFEQ '0'                                       E17186
     C                     MOVEA'0'       *IN,WI                          E17186
     C                     END                                            E17186
     C*                                                                   E17186
     C                     END                                            E17186
     C*                                                                   E17186
     C                     ELSE                                           E17186
     C                     MOVEL'N'       WNOSTR                          E17186
     C                     END                                            E17186
     C*                                                                   E17186
     C********** WCLNT     CHAINCLINTSEF             99             E17186S01117
     C*                                                                   E50469
     C** ACCESS SECURITY CLIENT FILE                                      E50469
     C                     CALL 'AOSECSR0'                                E50469
     C                     PARM           @RTCD   7                       E50469
     C                     PARM           @OPTN   7                       E50469
     C                     PARM BBCUST    @SCKY   6                       E50469
     C           SDSECS    PARM SDSECS    DSSDY                           E50469
     C*                                                                   E50469
     C           @RTCD     IFNE *BLANKS                                   E50469
     C                     MOVEA'1'       *IN,99                          E50469
     C                     END                                            E50469
      *                                                                   E17186
     C                     ENDSR                                          E17186
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INITRC - Subroutine to Initialise all File fields to zero/   *
      *           blank.                                              *
      *                                                               *
      *  Called from: UPDATE, UPDFLS                                  *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           INITRC    BEGSR
     C*
     C** INITIALIZE ALL DATA ON RECORD DEFINED IN DETREC (KEY EXCLUDED)
     C*
     C                     MOVEL*BLANK    DETREC
     C                     MOVE *BLANKS   SCCY                            CEU005
     C                     MOVE *BLANKS   ERII                            CEU005
     C                     Z-ADD*ZERO     SRSM
     C***********          Z-ADD*ZERO     SRBR                            S01117
     C                     MOVE *BLANKS   SRAB                            S01117
     C                     Z-ADD*ZERO     SPSM
     C***********          Z-ADD*ZERO     SPBR                            S01117
     C                     MOVE *BLANKS   SPBA                            S01117
     C**********           Z-ADD*ZERO     SDTO                                                CSD027
     C**********           Z-ADD*ZERO     SDFO                                                CSD027
     C**********           Z-ADD*ZERO     SDTT                                                CSD027
     C**********           Z-ADD*ZERO     SDFT                                                CSD027
     C                     MOVE *BLANKS   SDTO                                                CSD027
     C                     MOVE *BLANKS   SDFO                                                CSD027
     C                     MOVE *BLANKS   SDTT                                                CSD027
     C                     MOVE *BLANKS   SDFT                                                CSD027
     C                     Z-ADD*ZERO     LCD
     C                     Z-ADD*ZERO     TNLU
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  TRSFS  - Subroutine to Format record fields for Screen.      *
      *                                                               *
      *  Called from: UPDATE                                          *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           TRSFS     BEGSR
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C           CEU005    IFEQ 'Y'                                       CEU005
     C*                                                                   CEU005
     C* TRANSLATE SETTLEMENT CURRENCY                                     CEU005
     C*                                                                   CEU005
     C                     MOVE *BLANKS   WSSCCY                          CEU005
     C                     MOVE SCCY      SSCCY                           CEU005
     C*                                                                   CEU005
     C* TRANSLATE 'INCLUDE ERI IN FIELD 72'                               CEU005
     C*                                                                   CEU005
     C                     MOVE ERII      SERII                           CEU005
     C                     ENDIF                                          CEU005
     C*
     C* TRANSLATE SRSM (#NUMV) - RECEIVE SETT METHOD
     C*
     C                     MOVEL*BLANK    SSRSM
     C           ACTN      IFNE 'I'
     C                     MOVELSRSM      SSRSM
     C/COPY WNCPYSRC,SE0030C053
     C                     END
     C           SSRSM     IFEQ '00'                                      E17200
     C                     MOVE '  '      SSRSM                           E17200
     C                     END                                            E17200
     C*
     C* TRANSLATE SRAC (#ALPV)  - RECEIVE ACCOUNT
     C*
     C                     MOVEL*BLANK    SSRAC                           E17188
     C                     MOVELSRAC      SSRAC
     C*
     C**TRANSLATE*SRBR*(#NUMV)*-**RECEIVE*BRANCH**************************S01117
     C* TRANSLATE SRAB (#ALPV) -  RECEIVE BRANCH                          S01117
     C*
     C                     MOVEL*BLANK    SSRBR
     C***********SRBR      IFNE *ZERO                                     S01117
     C***********          MOVELSRBR      SSRBR                           S01117
     C                     MOVELSRAB      SSRBR                           S01117
     C*
     C* TRANSLATE SRCB (#ALPV)  - RECEIVE C'PARTY BANK
     C*
     C                     MOVEL*BLANK    SSRCB                           E17188
     C                     MOVELSRCB      SSRCB
     C*
     C* TRANSLATE SPSM (#NUMV)  - PAY SETT METHOD
     C*
     C                     MOVEL*BLANK    SSPSM
     C           ACTN      IFNE 'I'
     C                     MOVELSPSM      SSPSM
     C/COPY WNCPYSRC,SE0030C054
     C                     END
     C           SSPSM     IFEQ '00'                                      E17200
     C                     MOVE '  '      SSPSM                           E17200
     C                     END                                            E17200
     C*
     C* TRANSLATE SPAT (#ALPV) - PAY ACCOUNT
     C*
     C                     MOVEL*BLANK    SSPAT                           E17188
     C                     MOVELSPAT      SSPAT
     C*
     C**TRANSLATE*SPBR*(#NUMV)*-*PAY*BRANCH*******************************S01117
     C* TRANSLATE SPBA (#ALPV) - PAY BRANCH                               S01117
     C*
     C                     MOVEL*BLANK    SSPBR
     C***********SPBR      IFNE *ZERO                                     S01117
     C***********          MOVELSPBR      SSPBR                           S01117
     C                     MOVELSPBA      SSPBR                           S01117
     C*
     C* TRANSLATE SPCB (#ALPV)  - PAY C'PARTY BANK
     C*
     C                     MOVEL*BLANK    SSPCB                           E17188
     C                     MOVELSPCB      SSPCB
     C*
     C* TRANSLATE SPFA (#ALPV) - PAY FOR A/C OF
     C*
     C                     MOVEL*BLANK    SSPFA                           E17188
     C                     MOVELSPFA      SSPFA
     C*
     C* TRANSLATE SPSI (#ALPV)  - PAY SPECIAL INSTRUCTIONS
     C*
     C                     MOVEL*BLANK    SSPSI                           E17188
     C                     MOVELSPSI      SSPSI
     C*
     C* TRANSLATE SPCP (#ALPV)  - PAY CODE - PURCHASE
     C*
     C                     MOVELSPCP      SSPCP
     C*
     C* TRANSLATE SPCS (#ALPV)  - PAY CODE - SALE
     C*
     C                     MOVELSPCS      SSPCS
     C*
     C* TRANSLATE SCLP (#ALPV)  - CLEARANCE TYPE - PURCHASE
     C*
     C                     MOVELSCLP      SSCLP
     C*
     C* TRANSLATE SCLS (#ALPV)  - CLEARANCE TYPE - SALE
     C*
     C                     MOVELSCLS      SSCLS
     C*
     C* TRANSLATE SCLH (#ALPV)  - CLEARANCE HOUSE IND
     C*
     C***********          MOVELSCLH      SSCLH                           S01175
     C*
     C* TRANSLATE SDTO (#NUMV)  - DELIVER TO - OURS
     C*
     C                     MOVEL*BLANK    SSDTO
     C********** SDTO      IFNE *ZERO                                                         CSD027
     C           SDTO      IFNE *BLANKS                                                       CSD027
     C                     MOVELSDTO      SSDTO
     C                     END
     C*
     C* TRANSLATE SDFO (#NUMV)  - DELIVER FROM - OURS
     C*
     C                     MOVEL*BLANK    SSDFO
     C********** SDFO      IFNE *ZERO                                                         CSD027
     C           SDFO      IFNE *BLANKS                                                       CSD027
     C                     MOVELSDFO      SSDFO
     C                     END
     C*
     C* TRANSLATE SDTT (#NUMV)  - DELIVER TO - THEIRS
     C*
     C                     MOVEL*BLANK    SSDTT
     C********** SDTT      IFNE *ZERO                                                         CSD027
     C           SDTT      IFNE *BLANKS                                                       CSD027
     C                     MOVELSDTT      SSDTT
     C                     END
     C*
     C**TRANSLATE*SFAT*(#NUMV)**-*FOR*A/C*OF*-*THEIRS******************   E17198
     C* TRANSLATE SFAT (#NUMV)  - FOR A/C OF - DELIVER TO THEIRS          E17198
     C*
     C                     MOVEL*BLANK    SSFAT
     C           SFAT      IFNE *ZERO
     C                     MOVELSFAT      SSFAT
     C                     END
     C*
     C* TRANSLATE SDFT (#NUMV)  - DELIVER FROM - THEIRS
     C*
     C                     MOVEL*BLANK    SSDFT
     C********** SDFT      IFNE *ZERO                                                         CSD027
     C           SDFT      IFNE *BLANKS                                                       CSD027
     C                     MOVELSDFT      SSDFT
     C                     END
     C*
     C* TRANSLATE SFAF (#NUMV)  - FOR A/C OF - DELIVER FROM THEIRS        E17198
     C*                                                                   E17198
     C                     MOVEL*BLANK    SSFAF                           E17198
     C           SFAF      IFNE *ZERO                                     E17198
     C                     MOVELSFAF      SSFAF                           E17198
     C                     END                                            E17198
     C*                                                                   E17198
     C                     MOVE SKAC      SSKAC                           185733
     C*                                                                   185733
     C           CSE039    IFEQ 'Y'                                                           CSE039
     C           ACTN      ANDNE'I'                                                           CSE039
      ** Auto-Settlement Indicator                                                            CSE039
     C                     MOVE SASI      SSASI                                               CSE039
     C                     ENDIF                                                              CSE039
      *                                                                                       CSE039
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************   S01412
      *   SEPTVS    - Validate field 72                               *   S01412
      *   Called by - VALIDD                                          *   S01412
      *                                                               *   S01412
      *   Input     - SIL   - the field to be validated               *   S01412
      *                                                               *   S01412
      *   Output    - CUL   - the field was invalid                   *   S01412
      *****************************************************************   S01412
      *                                                                   S01412
     C           SEPTVS    BEGSR                                          S01412
      *                                                                   S01412
      ** Store the current value of indicator 88                          S01412
      *                                                                   S01412
     C                     MOVEA*IN,88    STOAR   1                       S01412
      *                                                                   S01412
     C                     Z-ADD1         L       30                      S01412
     C                     MOVE *BLANK    CUL     1                       S01412
     C                     MOVE 'F'       SSF     1                       S01412
     C                     SETOF                     88                   S01412
      *                                                                   S01412
      ** First position must be a '/'                                     S01412
      *                                                                   S01412
     C           SIL,L     IFNE '/'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     Z-ADD2         L                               S01412
      *                                                                   S01412
      ** The first special instruction line cannot have '/'               S01412
      ** in position 2                                                    S01412
      *                                                                   S01412
     C           SIL,L     IFEQ '/'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Check the line for '8a/', where 8a represents                    S01412
      ** up to eight upper case alphabetic charaters                      S01412
      *                                                                   S01412
     C           SSF       DOUEQ'T'                                       S01412
     C           L         ORGT 10                                        S01412
     C           CUL       OREQ 'E'                                       S01412
      *                                                                   S01412
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           SIL,L     LOKUPAPN                      88                                   CSW201
     C                     ELSE                                                               CSW201
     C           SIL,L     LOKUPUPA                      88               S01412
     C                     ENDIF                                                              CSW201
      *                                                                   S01412
     C           *IN88     IFNE '1'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C           SIL,L     IFEQ '/'                                       S01412
     C                     MOVE 'T'       SSF                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     ADD  1         L                               S01412
      *                                                                   S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Invalid if a second slash is not found                           S01412
      ** within the first ten characters of the                           S01412
      ** field being checked                                              S01412
      *                                                                   S01412
     C           SSF       IFEQ 'F'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
      ** Test the rest of the line for ISO format characters              S01412
      *                                                                   S01412
     C           L         DOUGT35                                        S01412
     C           CUL       OREQ 'E'                                       S01412
      *                                                                   S01412
     C           SIL,L     LOKUPSWCH                     88               S01412
      *                                                                   S01412
     C           *IN88     IFEQ '0'                                       S01412
     C                     MOVE 'E'       CUL                             S01412
     C                     END                                            S01412
      *                                                                   S01412
     C                     ADD  1         L                               S01412
      *                                                                   S01412
     C                     END                                            S01412
      *                                                                   CSW096
      ** Check for "/RCB/"                                                CSW096
      *                                                                   CSW096
     C                     MOVEL*BLANKS   USRCB   5                       CSW096
     C                     MOVEASIL,1     USRCB                           CSW096
     C           USRCB     IFEQ '/RCB/'                                   CSW096
     C                     MOVE 'X'       CUL                             CSW096
     C                     ENDIF                                          CSW096
      *                                                                   S01412
      ** Restore the current value of indicator 88                        S01412
      *                                                                   S01412
     C                     MOVEASTOAR     *IN,88                          S01412
      *                                                                   S01412
     C                     ENDSR                                          S01412
      *****************************************************************   S01412
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDFLS - Subroutine to Update File records.                  *
      *                                                               *
      *  Called from: UPDATE                                          *
      *  Calls: INITRC, ZTNLU1, INFSR                                 *
      *                                                               *
      *****************************************************************
      *
     C           UPDFLS    BEGSR
     C*
     C** U P D A T E   F I L E S
     C*
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C                     EXSR INITRC
     C*
     C** RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C                     EXSR ZTNLU1
     C*
     C** INITIALISE ERROR BAND
     C*
     C                     MOVEL*BLANK    INFMSG
     C*
     C**               I  N  S  E  R  T  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'I'
     C********** CSE028    IFEQ 'Y'                                                    CSE034 207944
     C           STDADK    CHAINSTDSEDFL             60                                       CSE034
     C**********           ELSE                                                        CSE034 207944
     C********** STDSEK    CHAINSTDSEDF              60                                       207944
     C**********           ENDIF                                                       CSE034 207944
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C                     MOVEL'D'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'I'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C/COPY WNCPYSRC,SEH00043
     C********** CSE028    IFEQ 'Y'                                                    CSE034 207944
     C   60                WRITESTDSEDFL               15                                     CSE034
     C**********           ELSE                                                        CSE034 207944
     C***60*****           WRITESTDSEDF                15                                     207944
     C**********           ENDIF                                                       CSE034 207944
     C/COPY WNCPYSRC,SEH00044
     C*
     C** TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN15     IFEQ '1'
     C           STATUS    ANDEQ01021
     C           STDSEK    CHAINSTDSEX               15
     C           *IN15     IFEQ '0'
     C                     EXSR UPDOWS
     C                     GOTO XTUPDF
     C                     END
     C                     END
     C           *IN15     IFEQ '1'
     C                     EXSR INFSR
     C                     END
     C*
     C/COPY WNCPYSRC,SEH00045
     C********** CSE028    IFEQ 'Y'                                                    CSE034 207944
     C  N60                UPDATSTDSEDFL                                                      CSE034
     C**********           ELSE                                                        CSE034 207944
     C**N60*****           UPDATSTDSEDF                                                       207944
     C**********           ENDIF                                                       CSE034 207944
     C/COPY WNCPYSRC,SEH00046
     C                     ELSE
     C*
     C**               I  N  S  E  R  T  S                 -  E N D
     C*
     C**               A  M  E  N  D  S                    -  S T A R T
     C*
     C           ACTN      IFEQ 'A'
     C********** CSE028    IFEQ 'Y'                                                    CSE034 207944
     C           STDADK    CHAINSTDSEDFL             60                                       CSE034
     C/COPY WNCPYSRC,SEH00115
     C**********           ELSE                                                        CSE034 207944
     C********** STDSEK    CHAINSTDSEDF              60                                       207944
     C**********           ENDIF                                                       CSE034 207944
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C                     MOVEL'D'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'A'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C/COPY WNCPYSRC,SEH00047
     C********** CSE028    IFEQ 'Y'                                                    CSE034 207944
     C  N60                UPDATSTDSEDFL                                                      CSE034
     C**********           ELSE                                                        CSE034 207944
     C**N60*****           UPDATSTDSEDF                                                       207944
     C**********           ENDIF                                                       CSE034 207944
     C/COPY WNCPYSRC,SEH00048
     C                     ELSE
     C*
     C**               A  M  E  N  D  S                    -  E N D
     C*
     C**               D  E  L  E  T  E  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'D'
     C********** CSE028    IFEQ 'Y'                                                    CSE034 207944
     C           STDADK    CHAINSTDSEDFL             60                                       CSE034
     C**********           ELSE                                                        CSE034 207944
     C********** STDSEK    CHAINSTDSEDF              60                                       207944
     C**********           ENDIF                                                       CSE034 207944
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C                     MOVEL'*'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'D'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C/COPY WNCPYSRC,SEH00049
     C********** CSE028    IFEQ 'Y'                                                    CSE034 207944
     C  N60                UPDATSTDSEDFL                                                      CSE034
     C**********           ELSE                                                        CSE034 207944
     C**N60*****           UPDATSTDSEDF                                                       207944
     C**********           ENDIF                                                       CSE034 207944
     C/COPY WNCPYSRC,SEH00050
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C********** STDSEK    SETLLSTDADSD0                                                      CSE028
     C           STDADK    SETLLSTDADSD0                                                      CSE034
     C                     MOVE '0'       *IN60                                               CSE028
     C           *IN60     DOWEQ'0'                                                           CSE028
     C********** STDSEK    READESTDADSD0                 60                                   CSE028
     C           STDADK    READESTDADSD0                 60                                   CSE034
     C           *IN60     IFEQ '0'                                                           CSE028
     C                     MOVEL'*'       SARECI                                              CSE028
     C                     UPDATSTDADSD0                                                      CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDDO                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     END
     C*
     C**               D  E  L  E  T  E  S                 -  E N D
     C*
     C                     END
     C                     END
     C*
     C** GET AUDIT RECORD
     C*
     C           1         CHAINSTDSEAF              99
     C*
     C** UPDATE AUDIT RECORD IF FOUND
     C*
     C           *IN99     IFEQ '0'
     C*
     C** FOR INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF LIVE
     C** RECORDS
     C*
     C           ACTN      IFEQ 'I'
     C                     ADD  1         SINS
     C                     ADD  1         NORE
     C                     END
     C*
     C** FOR AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY
     C*
     C           ACTN      IFEQ 'A'
     C                     ADD  1         SAMD
     C                     END
     C*
     C** FOR DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS
     C*
     C           ACTN      IFEQ 'D'
     C                     ADD  1         SDEL
     C                     SUB  1         NORE
     C                     END
     C*
     C** FORMAT COMIT TEXT
     C*
     C                     TIME           MTIME
     C                     MOVELACTN      ACTNX
     C                     MOVEASCRCTL    DET,01
     C                     MOVEADETS      DET,15
     C*
     C** UPDATE AUDIT RECORD
     C*
     C/COPY WNCPYSRC,SEH00051
     C                     UPDATSTDSEAF
     C/COPY WNCPYSRC,SEH00052
     C*
     C** C  O  M  I  T
     C*
     C           CMTTXT    COMIT
     C*
     C** AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C                     ELSE
     C*
     C                     SETON                     U7U8  ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'02'      DBASE            * DB ERROR 02 *S01117
     C                     Z-ADD2         DBASE            * DB ERROR 02 *S01117
     C                     MOVEL'STDSE'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C           XTUPDF    ENDSR
      *
     C/COPY WNCPYSRC,SEH00053
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDOWS - Subroutine to Process update by another workstation.*
      *                                                               *
      *  Called from: UPDFLS                                          *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           UPDOWS    BEGSR
     C**
     C                     ROLBK
     C**
     C**   SET UP NEXT SCREEN TO BE DISPLAYED:
     C**   IF RECORD IS LIVE, ALLOW AMEND PROCESSING;
     C**
     C           RECI      IFEQ 'D'                        ***
     C                     MOVEL'A'       ACTN
     C                     ELSE
     C**
     C**   IF RECORD HAS BEEN DELETED, ALLOW ENQUIRY
     C**
     C                     MOVEL'E'       ACTN
     C                     END                             **
     C**
     C**   SET SCREEN PROCESSOR TO UPDATE AND MOVE UPDATE MESSAGE TO ERROR
     C**
     C                     MOVEA'001'     *IN,10
     C                     MOVELINF,11    INFMSG
     C                     MOVE *ON       *IN84                                              BUG2198
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *
      *  INFSR  - File exception/Error handling Subroutine.
      *
      *****************************************************************
      *                                                               *
     C           INFSR     BEGSR                                      *
     C**                                                              *
     C** ROLL BACK CHANGES AND CANCEL PROGRAM                         *
     C**                                                              *
     C                     ROLBK                                      *
     C                     MOVE '*CANCL'  EXTTAG  6                   *
     C**                                                              *
     C                     ENDSREXTTAG                                *
      *                                                               *
      *****************************************************************
      /EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS            S01117
     C*                                                                   S01117
     C* CALLED FROM : AFTER ABNORMAL OPERATION OCCURS                     S01117
     C*                                                                   S01117
     C* CALLS : NOTHING                                                   S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                                          S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVEL'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      **                                                              *   S01117
      ** CKKSEL - SUBROUTINE TO CHECK KEY FIELDS FOR SELECTION        *   S01117
      ** CALLED FROM: START,REVIEW                                    *   S01117
      ** CALLS: NOTHING                                               *   S01117
      **                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           CKKSEL    BEGSR                           ** CKKSEL **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C** CHECK CUSTOMER INPUT FIELD                                       S01117
     C*                                                                   S01117
     C                     MOVELSCSTM     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSCSTM     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST   1                       S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     22                   S01117
     C                     MOVELWINCNO    SCSTM                           S01117
     C                     END                                            S01117
      *                                                                                       CSE028
      ** Check Book Code input field                                                          CSE028
      *                                                                                       CSE028
     C                     MOVELSSIBK     @STP                                                CSE028
     C           @STP      IFEQ '?'                                                           CSE028
     C                     MOVE 'Y'       @SEL                                                CSE028
     C                     MOVELSSIBK     WSIBK   2                                           CSE028
     C                     CALL 'AOBOOKR0'                                                    CSE028
     C                     PARM *BLANKS   @RTCD                                               CSE028
     C                     PARM '*KEY   ' @OPTN                                               CSE028
     C                     PARM           WSIBK                                               CSE028
     C           SDBOOK    PARM SDBOOK    DSFDY                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   SSIBK                                               CSE028
     C                     MOVE '0'       *IN26                                               CSE028
     C           @RTCD     IFEQ *BLANKS                                                       CSE028
     C                     MOVELBDBKCD    SSIBK                                               CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C*                                                                   S01117
     C** CHECK BRANCH INPUT FIELD                                         S01117
     C*                                                                   S01117
     C                     MOVELSSBRH     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSBRH     @DSNB                           S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     MOVE *BLANKS   SSBRH                           S01117
     C                     SETOF                     25                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA8BRCD    SSBRH                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK CURRENCY INPUT FIELD                                       S01117
     C*                                                                   S01117
     C                     MOVELSCYSI     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSCYSI     @AJCD                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @AJCD                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SCYSI                           S01117
     C                     SETOF                     23                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA6CYCD    SCYSI                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     ENDSR                           ** CKKSEL **   S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      **                                                              *   S01117
      ** CKDSEL - SUBROUTINE TO CHECK DETAIL FIELDS FOR SELECTION     *   S01117
      ** CALLED FROM: UPDATE                                          *   S01117
      ** CALLS: NOTHING                                               *   S01117
      **                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           CKDSEL    BEGSR                           ** CKDSEL **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C** CHECK RECEIVE BRANCH INPUT FIELD                                 S01117
     C*                                                                   S01117
     C                     MOVELSSRBR     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSRBR     @DSNB                           S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     MOVE *BLANKS   SSRBR                           S01117
     C                     SETOF                     33                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA8BRCD    SSRBR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK PAY BRANCH INPUT FIELD                                     S01117
     C*                                                                   S01117
     C                     MOVELSSPBR     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSPBR     @DSNB                           S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     MOVE *BLANKS   SSPBR                           S01117
     C                     SETOF                     37                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA8BRCD    SSPBR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK RECEIVE ACCOUNT INPUT FIELD                                S01117
     C*                                                                   S01117
     C                     MOVELSSRAC     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C           SSRSM     IFEQ '01'                                                          215879
     C           SSRSM     OREQ '02'                                                          215879
     C           SSRSM     OREQ '08'                                                          215879
     C                     MOVEL*BLANK    W0RTN   7                                           215879
      * Name search required?                                                                 215879
     C                     CALL 'SD0151S'              90  Select Nostro Details              215879
     C                     PARM *BLANK    W0RTN   7                                           215879
     C                     PARM SCYSI     WQ0018  3        Currency Code                      215879
     C           SSRAC     PARM SSRAC     WQ0019  2        Nostro Number                      215879
      *                                                                                       215879
     C           *IN90     IFEQ '1'                                                           215879
      * Call to program ended in error                                                        215879
     C                     MOVEL'Y2U0032' W0RTN                                               215879
     C                     MOVEL*BLANKS   W0CLPG 10                                           215879
     C                     MOVEL'SD0151S' W0CLPG                                              215879
      * Send message '*Error occured on CALL...'                                              215879
     C                     MOVEL'Y2U0032' ZAMSID                                              215879
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              215879
     C                     MOVELW0CLPG    ZAMSDA           Message data                       215879
     C                     EXSR ZASNMS                                                        215879
     C                     END                                                                215879
      *                                                                                       215879
      * Error detected?                                                                       215879
     C           W0RTN     IFNE *BLANK                                                        215879
     C           W0RTN     ANDNE'Y2U0016'                                                     215879
     C                     SETON                     98    *                                  215879
     C                     END                                                                215879
     C                     ELSE                                                               215879
     C                     MOVELSSRAC     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST   1                       S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     32                   S01117
     C                     MOVELWINCNO    SSRAC                           S01117
     C                     END                                                                215879
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK PAY ACCOUNT INPUT FIELD                                    S01117
     C*                                                                   S01117
     C                     MOVELSSPAT     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C           SSPSM     IFEQ '01'                                                          215879
     C           SSPSM     OREQ '02'                                                          215879
     C           SSPSM     OREQ '08'                                                          215879
     C                     MOVEL*BLANK    W0RTN   7                                           215879
      * Name search required?                                                                 215879
     C                     CALL 'SD0151S'              90  Select Nostro Details              215879
     C                     PARM *BLANK    W0RTN   7                                           215879
     C                     PARM SCYSI     WQ0018  3        Currency Code                      215879
     C           SSPAT     PARM SSPAT     WQ0019  2        Nostro Number                      215879
      *                                                                                       215879
     C           *IN90     IFEQ '1'                                                           215879
      * Call to program ended in error                                                        215879
     C                     MOVEL'Y2U0032' W0RTN                                               215879
     C                     MOVEL*BLANKS   W0CLPG 10                                           215879
     C                     MOVEL'SD0151S' W0CLPG                                              215879
      * Send message '*Error occured on CALL...'                                              215879
     C                     MOVEL'Y2U0032' ZAMSID                                              215879
     C                     MOVEL'Y2USRMSG'ZAMSGF                                              215879
     C                     MOVELW0CLPG    ZAMSDA           Message data                       215879
     C                     EXSR ZASNMS                                                        215879
     C                     END                                                                215879
      *                                                                                       215879
      * Error detected?                                                                       215879
     C           W0RTN     IFNE *BLANK                                                        215879
     C           W0RTN     ANDNE'Y2U0016'                                                     215879
     C                     SETON                     98    *                                  215879
     C                     END                                                                215879
     C                     ELSE                                                               215879
     C                     MOVELSSPAT     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST   1                       S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     36                   S01117
     C                     MOVELWINCNO    SSPAT                           S01117
     C                     END                                                                215879
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK DELIVER TO OURS INPUT FIELD                                S01117
     C*                                                                   S01117
     C                     MOVELSSDTO     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSDTO     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST   1                       S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     46                   S01117
     C                     MOVELWINCNO    SSDTO                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK DELIVER FROM OURS INPUT FIELD                              S01117
     C*                                                                   S01117
     C                     MOVELSSDFO     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSDFO     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST   1                       S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     47                   S01117
     C                     MOVELWINCNO    SSDFO                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK DELIVER TO THEIRS INPUT FIELD                              S01117
     C*                                                                   S01117
     C                     MOVELSSDTT     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSDTT     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST   1                       S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     48                   S01117
     C                     MOVELWINCNO    SSDTT                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK DELIVER FROM THEIRS INPUT FIELD                            S01117
     C*                                                                   S01117
     C                     MOVELSSDFT     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSDFT     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST   1                       S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     50                   S01117
     C                     MOVELWINCNO    SSDFT                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK RECEIVING COUNTERPARTY BANK INPUT FIELD                    S01117
     C*                                                                   S01117
     C                     MOVELSSRCB     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSRCB     WINCNO                          S01117
     C                     MOVEL'N'       WCUST                           S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     34                   S01117
     C                     MOVELWINCNO    SSRCB                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK PAYING COUNTERPARTY BANK INPUT FIELD                       S01117
     C*                                                                   S01117
     C                     MOVELSSPCB     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSPCB     WINCNO                          S01117
     C                     MOVEL'N'       WCUST                           S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     38                   S01117
     C                     MOVELWINCNO    SSPCB                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK PAYING FOR ACCOUNT OF INPUT FIELD                          S01117
     C*                                                                   S01117
     C                     MOVELSSPFA     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSPFA     WINCNO                          S01117
     C                     MOVEL'N'       WCUST                           S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     39                   S01117
     C                     MOVELWINCNO    SSPFA                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK FOR ACCOUNT OF DELIVER TO THEIRS INPUT FIELD               S01117
     C*                                                                   S01117
     C                     MOVELSSFAT     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSFAT     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST                           S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     49                   S01117
     C                     MOVELWINCNO    SSFAT                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** CHECK FOR ACCOUNT OF DELIVER FROM THEIRS INPUT FIELD             S01117
     C*                                                                   S01117
     C                     MOVELSSFAF     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSFAF     WINCNO                          S01117
     C                     MOVEL'Y'       WCUST                           S01117
     C                     EXSR SELCST                                    S01117
     C*                                                                   S01117
     C                     SETOF                     51                   S01117
     C                     MOVELWINCNO    SSFAF                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** CKDSEL **   S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                  *S01117
     C*  SELCST - Subroutine to SELECT Customer Number                   *S01117
     C*                                                                  *S01117
     C*  Called from: CKKSEL, CKDSEL                                     *S01117
     C*  Calls: None.                                                    *S01117
     C*                                                                  *S01117
     C*  Input : WINCNO - Field to be validated.                         *S01117
     C*          WCUST  - 'Y' if SECURITIES CUSTOMER, Else 'N'.          *S01117
     C*                                                                  *S01117
     C* Output:SDSECSPD or SDCUSTPD Record if valid,Else Indicator set   *S01117
     C*                                                                  *S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           SELCST    BEGSR                                          S01117
     C           *LIKE     DEFN WINCNO    XINCNO                          070814
     C                     MOVELWINCNO    XINCNO                          070814
     C*                                                                   S01117
     C** CHECK FOR NUMERIC ENTRY                                          S01117
     C*                                                                   S01117
     C           WCUST     IFEQ 'N'                                       S01117
     C                     MOVELWINCNO    @CKEY  10                       S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVEL*BLANKS   WINCNO                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCUST    WINCNO                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
      ** IF CUSTOMER NOT SELECTED THEN DISPLAY CONTR-PARTY-NOSTROS        070814
     C           @RTCD     IFEQ '*NOSEL'                                  070814
     C                     MOVE *BLANKS   @RTCD                           070814
     C                     MOVELXINCNO    @KEYCN  8                       070814
     C                     CALL 'AOCNSTR0'                                070814
     C                     PARM *BLANKS   @RTCD                           070814
     C                     PARM '*KEY   ' @OPTN                           070814
     C                     PARM           @KEYCN                          070814
     C           SDCNST    PARM SDCNST    DSFDY                           070814
     C                     MOVEL*BLANKS   WINCNO                          070814
     C           @RTCD     IFEQ *BLANKS                                   070814
     C                     MOVEL@KEYCN    WINCNO                          070814
     C                     END                                            070814
     C                     ENDIF                                          070814
     C*
     C                     ELSE                                           S01117
     C                     MOVELWINCNO    @KEYS   6                       S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYS                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVEL*BLANKS   WINCNO                          S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBFCUST    WINCNO                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      *****************************************************************   S01117
      /EJECT                                                                                  CSE028
      *****************************************************************                       CSE028
      *                                                               *                       CSE028
      * SRRTXT - Retrieve Text                                        *                       CSE028
      *                                                               *                       CSE028
      * Called by: UPDATE, SRSSIS                                     *                       CSE028
      *                                                               *                       CSE028
      * Calls: None                                                   *                       CSE028
      *                                                               *                       CSE028
      *****************************************************************                       CSE028
     C           SRRTXT    BEGSR                                                              CSE028
     C                     MOVEL'GBSEUSR' PMSGNM                                              CSE028
     C                     MOVE 'MSG'     PMSGNM                                              CSE028
     C                     CALL 'SDRTVTXT'                                                    CSE028
     C                     PARM           PMSGID  7                                           CSE028
     C                     PARM           PMSGNM 10                                           CSE028
     C                     PARM *BLANK    PMSGTX 80                                           CSE028
     C                     ENDSR                                                              CSE028
      *****************************************************************                       CSE028
      /EJECT                                                                                  CSE028
      *****************************************************************                       CSE028
      *                                                               *                       CSE028
      * SRSSIS - Call SESSISIN for maintenance of additional info.    *                       CSE028
      *                                                               *                       CSE028
      * Called by: UPDATE                                             *                       CSE028
      *                                                               *                       CSE028
      * Calls: SESSIIN                                                *                       CSE028
      *                                                               *                       CSE028
      *****************************************************************                       CSE028
     C           SRSSIS    BEGSR                                                              CSE028
      *                                                                                       CSE028
     C                     MOVEL*BLANK    WSNEW   1                                           CSE028
     C           STFDM     IFEQ *BLANK                                                        203368
     C                     MOVEL*BLANK    WSTFDM  1                                           CSE028
     C                     ELSE                                                               203368
     C                     MOVELSTFDM     WSTFDM                                              203368
     C                     ENDIF                                                              203368
     C                     MOVEL'SESS'    WSESSP  8                                           CSE028
     C                     MOVE 'ISIN'    WSESSP                                              CSE028
     C                     CALL WSESSP                                                        CSE028
      *                                                                                       CSE028
      ** Input Parameters                                                                     CSE028
      ** ----------------                                                                     CSE028
      *                                                                                       CSE028
     C                     PARM           ACTN                                                CSE028
     C                     PARM           SSBRH                                               CSE028
     C                     PARM           SCSTM                                               CSE028
     C                     PARM           SSIBK                                               CSE028
     C                     PARM           SCYSI                                               CSE028
     C                     PARM           SSMKT                                               CSE034
     C                     PARM           SITSI                                               CSE028
     C                     PARM           SSPTFR                                              CSE028
      *                                                                                       CSE028
      ** Output Parameters                                                                    CSE028
      ** ----------------                                                                     CSE028
      *                                                                                       CSE028
     C                     PARM           WSNEW                                               CSE028
     C                     PARM           WSTFDM                                              CSE028
     C                     PARM *BLANKS   WRTCDE 10                                           CSE028
      *                                                                                       CSE028
     C           WRTCDE    IFNE *BLANKS                                                       CSE028
     C           WRTCDE    ANDNE'SE10001'                                                     CSE028
     C                     SELEC                                                              CSE028
     C           WRTCDE    WHEQ 'SE10000'                                                     CSE028
     C                     MOVE '01'      AID                                                 CSE028
     C                     MOVEA'11'      *IN,10                                              CSE028
     C                     OTHER                                                              CSE028
     C                     MOVEL'SE10033' PMSGID                                              CSE028
     C                     EXSR SRRTXT                                                        CSE028
     C                     MOVELPMSGTX    ERRMSG                                              CSE028
     C                     ENDSL                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ENDSR                                                              CSE028
      *****************************************************************                       CSE028
     CSR         ZASNMS    BEGSR                                                              215879
      *================================================================                       215879
      * Send message to program's message queue                                               215879
      *================================================================                       215879
     C           ZAPGMQ    IFEQ *BLANK                                                        215879
     C                     MOVEL'SE0030'  ZAPGMQ                                              215879
     C                     END                                                                215879
      * If no message file specified, use default                                             215879
     C           ZAMSGF    IFEQ *BLANK                                                        215879
     C                     MOVELZADFMF    ZAMSGF                                              215879
     C                     END                                                                215879
     C                     CALL 'Y2SNMGC'                                                     215879
     C                     PARM           ZAPGMQ 10        Program queue                      215879
     C                     PARM           ZAPGRL  5        Rel queue                          215879
     C                     PARM           ZAMSID  7        Message ID                         215879
     C                     PARM           ZAMSGF 10        Message file                       215879
     C                     PARM           ZAMSDA132        Message data                       215879
     C                     PARM           ZAMSTP  7        Message type                       215879
      * Clear all fields for default mechanism next time                                      215879
     C                     MOVEL*BLANK    ZAPGMQ                                              215879
     C                     MOVEL*BLANK    ZAPGRL                                              215879
     C                     MOVEL*BLANK    ZAMSID                                              215879
     C                     MOVEL*BLANK    ZAMSGF                                              215879
     C                     MOVEL*BLANK    ZAMSDA                                              215879
     C                     MOVEL*BLANK    ZAMSTP                                              215879
      *================================================================                       215879
     CSR         ZAEXIT    ENDSR                                                              215879
     C/COPY WNCPYSRC,SE0030C004
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
      ***
      * /104633/
      *INF,7  DELETION F3:F10 to delete this record:F12:Rollup:Rolldown:Help
      *INF,10 F10 is required
      *INF,11 F10 is not required
**  CPY@
(c) Finastra International Limited 2001
** METH
000102030405060708121415
** INF
 Enter:Action Code I,A,D,E and selection:Review from point:F3:Help
 Enter:Review from point:Action Code A,D,E:F3:F12:Rollup:Rolldown:Help
 INSERTION Enter:F3:F12:Help
 AMENDMENT Enter:F3:F12:Rollup:Rolldown:Help
 ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help
 DELETION F3:F10=Delete record:F12:Rollup:Rolldown:Help
 Rollup is not possible
 Rolldown is not possible
 F10=Confirm

 Record has been updated by another workstation
 At least one field should be entered
**   UPA   -  Valid codeword characters                                   S01412
ABCDEFGHIJKLMNOPQRSTUVWXYZ/
**   APN   -  Valid uppercase alphabetic characters and numeric digits                        CSW201
ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789/                                                         CSW201
**   SWCH  -  Valid SWIFT ISO fromat characters                           S01412
ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890/-?:().,'+
**   NUM   -  Valid Numeric digits (Pay A/C & Receive A/c)                CSE041
1234567890
