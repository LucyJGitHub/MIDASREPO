     H        1
      *****************************************************************
/*XBIA*  OVRDBF FILE(SECTYX) TOFILE(SECTY) SHARE(*NO)                 *
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Security detail maintenance')                 *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE0040 - SECURITY DETAIL MAINTENANCE                         *
      *                                                               *
      *  Function: This program allows the maintenance and validation *
      *   (I/C)    of Security details.                               *
      *                                                               *
      *  Called By: SEC02 - Input Cycle Processing                    *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD057247           Date 01Feb21               *
      *                 MD046248           Date 27Oct17               *
      *                 CRE073             Date 06Dec10               *
      *                 261063             Date 23Sep10               *
      *                 CER059             Date 19Jul10               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 225160             Date 16Oct06               *
      *                 234300             Date 29Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE075             Date 17Nov05               *
      *                 CSE071             Date 19Jul05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGP001             Date 08Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CSE035             Date 22Apr02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 202333             Date 15Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 01Jul02               *
      *                 183891             Date 22Sep00               *
      *                 180707             Date 25Jul00               *
      *                 CSE032             Date 13Dec01               *
      *                 138828             Date 17Aug01               *
      *                 196020             Date 09Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 202329             Date 28Jan02               *
      *                 192054             Date 29Jun01               *
      *                 166121             Date 08May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 02Oct00               *
      *                 CAP060             Date 02Oct00               *
      *                 186556             Date 07Mar01               *
      *                 186003             Date 28Feb01               *
      *                 CAP140             Date 17Oct00               *
      *                 183604             Date 08Mar00               *
      *                 171045             Date 02Feb00               *
      *                 159474             Date 23Apr99               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CAP137             Date 07Feb00               *
      *                 180413             Date 16Jun00               *
      *                 102342             DATE 09Jul00               *
      *                 137805             Date 29Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      *                 CSE011             Date 26Aug99               *
      *                 CPB001             DATE 27Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPL002             DATE 08Mar99               *
      *                 155622             Date 23Feb99               *
      *                 138957             Date 16Jul98               *
      *                 130862             Date 16Oct98               *
      *                 150303             DATE 15DEC98               *
      *                 140759             DATE 20AUG98               *
      *                 137883             Date 09Jul98               *
      *                 138605             Date 09JUL98               *
      *                 136425             Date 10JUN98               *
      *                 CEU017             Date 03Mar98               *
      *                 CSE007             Date 19Jan98               *
      *                 CEU018             DATE 27APR98               *
      *                 107537             DATE 23FEB98               *
      *                 106056             DATE 28JAN98               *
      *                 S01408             DATE 07OCT97               *
      *                 110945             DATE 06FEB97               *
      *                 CSE005             DATE 12DEC96               *
      *                 S01408             DATE 30SEP96               *
      *                 S01408             DATE 26SEP96               *
      *                 S01408             DATE 15AUG96               *
      *                 081405             DATE 26JUL96               *
      *                 100228             DATE 29MAY96               *
      *                 053092             DATE 08MAY96               *
      *                 102871             DATE 07MAY96               *
      *                 068079             DATE 03MAY96               *
      *                 054084             DATE 02MAY96               *
      *                 042312             DATE 01MAY96               *
      *                 066779             DATE 25APR96               *
      *                 S01408             DATE 01MAR96               *
      *                 092001             DATE 24OCT95               *
      *                 091865             DATE 24OCT95               *
      *                 091254             DATE 20OCT95               *
      *                 075592             DATE 19OCT95               *
      *                 093522             DATE 28SEP95               *
      *                 S01408             DATE 07SEP95               *
      *                 S01511             DATE 29NOV94               *
      *                 075524             DATE 13OCT94               *
      *                 S01408             DATE 22AUG94               *
      *                 S01408             DATE 19MAY94               *
      *                 065527             DATE 06APR94               *
      *                 052254             DATE 05JAN94               *
      *                 054941             DATE 04NOV93               *
      *                 058133             DATE 03NOV93               *
      *                 054025             DATE 12OCT93               *
      *                 S01401             DATE 16JUN93               *
      *                 044310             DATE 01FEB93               *
      *                 S01397             DATE 16SEP92               *
      *                 E36754             DATE 17MAR92               *
      *                 E32674             DATE 03DEC91               *
      *                 E31315             DATE 29NOV91               *
      *                 E31319             DATE 05NOV91               *
      *                 E28362             DATE 28OCT91               *
      *                 E27093             DATE 23OCT91               *
      *                 E28788             DATE 23SEP91               *
      *                 E28570             DATE 16SEP91               *
      *                 E28494             DATE 12SEP91               *
      *                 E27092             DATE 04SEP91               *
      *                 E25070             DATE 30AUG91               *
      *                 E24327             DATE 30AUG91               *
      *                 E25521             DATE 30AUG91               *
      *                 S01220             DATE 22JAN91               *
      *                 E28717             DATE 29OCT90               *
      *                 S01117             DATE 29OCT90               *
      *                 S01195             DATE 29OCT90               *
      *                 S01269             DATE 31JUL90               *
      *                 S01271             DATE 19JUN90               *
      *                 E23362             DATE 16AUG90               *
      *                 E23361             DATE 15AUG90               *
      *                 E23282             DATE 15AUG90               *
      *                 E22794             DATE 13JUL90               *
      *                 E22108             DATE 04JUN90               *
      *                 E22048             DATE 16MAY90               *
      *                 E21717             DATE 25APR90               *
      *                 E21616             DATE 03APR90               *
      *                 E21570             DATE 28MAR90               *
      *                 E20517             DATE 17JAN90               *
      *                 E20651             DATE 10JAN90               *
      *                 E20687             DATE 28DEC89               *
      *                 E20179             DATE 18DEC89               *
      *                 E20486             DATE 18DEC89               *
      *                 S01232             DATE 05DEC89               *
      *                 E20459             DATE 05DEC89               *
      *                 E20292             DATE 28NOV89               *
      *                 E20290             DATE 15NOV89               *
      *                 E20085             DATE 07NOV89               *
      *                 E19868             DATE 23OCT89               *
      *                 E19869             DATE 17OCT89               *
      *                 E19740             DATE 16OCT89               *
      *                 E19836             DATE 16OCT89               *
      *                 E15930             DATE 09OCT89               *
      *                 E19751             DATE 06OCT89               *
      *                 E19750             DATE 06OCT89               *
      *                 S01199             DATE 15SEP89               *
      *                 E19031             DATE 01AUG89               *
      *                 E16770             DATE 26JUL89               *
      *                 E16772             DATE 19/06/89              *
      *                 E17196             DATE 18/05/89              *
      *                 E17197             DATE 24/04/89              *
      *                 E16305             DATE 01/03/89              *
      *                 E16302             DATE 27/02/89              *
      *                 E16801             DATE 27/02/89              *
      *                 E90095             DATE 19/01/89              *
      *                 S01186             DATE 11/11/88              *
      *                 S01176             DATE 11/11/88              *
      *                 S01169             DATE 11/11/88              *
      *                 E14792             DATE 16/09/88              *
      *                 E14483             DATE 12/09/88              *
      *                 E14482             DATE 09/09/88              *
      *                 E13953             DATE 08/09/88              *
      *                 E14711             DATE 16/08/88              *
      *                 E13941             DATE 01/08/88              *
      *                 E13664             DATE 29/07/88              *
      *                 E14204             DATE 21/07/88              *
      *                 E13662             DATE 23/06/88              *
      *                 E13527             DATE 16/06/88              *
      *                 E13622             DATE 07/06/88              *
      *                 S01158             DATE 13/05/88              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD046248 - Finastra Rebranding                               *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  261063 - Remove validation regarding securities customer.    *
      *           Program should accept any valid customer for risk   *
      *           customer. Also, call 'AOCUSTR0' instead of          *
      *           'AOSECSR0' when placing '?' in risk customer field. *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus                                          *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  225160 - Change error code 504 to 512 when validating        *
      *           maturity date as 504 is already used for other      *
      *           validation error.  Fix patterned after 199665.      *
      *  234300 - Recompiled over changed in PF/HSTTRD.               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
      *           (Recompile)                                         *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines                                        *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *  CGP001 - Global Processing.                                  *
      *           - SDWEIG* files renamed to GPWEIG*.                 *
      *           - AOWEIGR0 renamed to GPAOWEIGR0.                   *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *  202333 - Condition call to window on CSE023.                 *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  183891 - Recompiled over changed ZLCDZ1.                     *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *           based securities.                                   *
      *  CSE032 - Constant Yield Amortisation of Discount Premium.    *
      *  138828 - New Issue field always blank.  Complete fix 102871, *
      *           field should be equal to 'Y' or 'N' depending if    *
      *           new issue details are present.                      *
      *  196020 - Logic flaw in CSE005 - it should be perfectly ok for*
      *           FRNs to use the old methodology rather than be      *
      *           forced to use one of the new methods if CSE005 is on*
      *  202329 - Initialise timestamp field TMST when writing a new  *
      *           record to SECTYD.                                   *
      *  192054 - ISIN code must be displayed/amendable when private  *
      *           banking module is on.                               *
      *  166121 - Do not allow a security to be added if same         *
      *           security still exists as deleted.                   *
      *  CSD006 - Market Data Feeds                                   *
      *  CAP060 - Securities Prices Full API                          *
      *  186556 - Remove check 142 FOR PROCESSING TYPE 7 AND 8.       *
      *  186003 - Recalculate Last Coupon Date in Amend Mode if       *
      *           Rundate less than First Coupon Date. Applied fix    *
      *           175022.                                             *
      *  CAP140 - Conversion of SE Security Diary Event inputs into   *
      *           modular structure to use as APIs.                   *
      *  183604 - Industry Code and Market Center must be mandatory   *
      *           when new PB Module is switched ON. Rating Code      *
      *           must be validated against new table PBRATIPD when   *
      *           new PB Module is switched ON.                       *
      *         - Integrate 'Instrument/Investment Type'              *
      *             Field amendable when                              *
      *              + system setup flag is off                       *
      *              + system setup flag is on but no position exists *
      *  171045 - Protect Coupon rate when 'F12' pressed on third     *
      *           screen.                                             *
      *  159474 - EMU/Corporate Actions: Market Centre not defaulted  *
      *           from the event security when F15 pressed            *
      *  CSE023 - Treaty Withholding Tax                              *
      *  CAP137 - Conversion of SE Security inputs into modular       *
      *           structure to use as APIs.                           *
      *           Recompiled due to change in PF/SECTYD.              *
      *  180413 - Disallow issue of OPEN to already opened files      *
      *  102342 - Securities maintenance - Depot references           *
      *           On screen one it is possible to enter a Telekurs    *
      *           reference for a security, and on the investment     *
      *           type details a depot reference can be made to pick  *
      *           up the Telekurs reference automatically. This works *
      *           fine for a new security, however, if you            *
      *           subsequently amend the Telekurs number, the system  *
      *           does not update the depot reference.                *
      *           In order to protect the defaulted Depot references  *
      *           indicators had to be freed up. Indicator 01 02 05   *
      *           were used because they were assosiated with the     *
      *           function keys 03 05 & 12                            *
      *  137805 - Error message appearing when trying to input        *
      *           security with monthly frequency.                    *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movement.                 *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
      *  CSE011 - Securities Trading Duplicate Security Codes         *
      *           Check.                                              *
      *  CPB001 - 'Private Banking' Module                            *
      *  CPL002   Midas-Plato Interface.                              *
      *  155622 - Do not display F5 and F12 narratives when program   *
      *           called from one of the Corporate Action programs.   *
      *  138957 - Corporate Actions: Review information passed to     *
      *           RPG/SE0040 (Security Details Maintenance) for a     *
      *           Name Change event where the Security Shortname is   *
      *           being changed (when F15 is pressed).                *
      *  130862 - Recompiled over changed ZLCDZ1.                     *
      *  150303 - DO NOT TRY TO FIND CORRESPONDING DIARY EVENT VIA PGM*
      *           SE0042 IF SECURITY HAS BEEN INPUT TODAY AS THIS ONE *
      *           WILL BE CREATED DURING EOD                          *
      *  140759 - If switch. feature not on, default flag to 'N'.     *
      *  137883 - Lost of information when RPG/SE0040 is called in    *
      *           Enquiry Mode from 'Sec. Redenomination Bulk Input'. *
      *           (ROLLBACK in some Corporate Actions File(s)).       *
      *  138605 - Trade denomination should be validated against      *
      *           zero decimal places, even with CEU018.              *
      *  136425 - Need to initialise all new fields added to SECTYD,  *
      *           because of corruption of the fields when insert is  *
      *           done after corruption.                              *
      *  CEU017 - Securities Redenomination Euro Changes              *
      *  CSE007 - Corporate Actions                                   *
      *  CEU018 - SE Decimals on Nominal amounts (display and valida- *
      *           tion of field SNMDP)                                *
      *  107537 - COMPLETE FIX 075592 : The Issue Date must be setted *
      *           by the Initial Date only if it has not be filled    *
      *           before                                              *
      *  106056 - Amendment of security detail caused partly paid     *
      *           price reset back to initial value.                  *
      *  S01408 - Four hooks in DBAR2 moved to match original         *
      *           position in R10.6 source. Two new hooks added.      *
      *           Move core hook SE0040C012.                          *
      *           Move core hook SE0040C013.                          *
      *           Move core hook SE0040C014.                          *
      *           Move core hook SE0040C015.                          *
      *           Addition core hook SE0040CP29.                      *
      *           Addition core hook SE0040CP28.                      *
      *  110945 - Zero coupon bonds were only allowed if the yield    *
      *           basis was 'D' or 'DA'. Program amended to except    *
      *           'AU', an Australian specific yield basis. Also      *
      *           applied fix 043773 from 2.3 system (Entering a zero *
      *           coupon rate and coupon dates fail validation. Fix : *
      *           Give warning errors when a security has a trade     *
      *           basis of 'Y'.                                       *
      *  CSE005 - Effect of holidays on FRN Coupon Dates,             *
      *           incl. validate user input coupon date indicators    *
      *  S01408 - Addition core hook SE0040CP27.                      *
      *           Addition core hook SE0040CP26.                      *
      *           Addition core hook SE0040CP25.                      *
      *           Addition core hook SE0040GDTA.                      *
      *  S01408 - Addition core hook SE0040CP24.                      *
      *           Addition core hook SE0040CP23.                      *
      *  S01408 - Addition core hook SE0040CP22.                      *
      *           Addition core hook SE0040CP21.                      *
      *  081405 - ROLBK required after CK3 as updates may have taken  *
      *           place in window program (or CK5 restart) .          *
      *  100228 - AMEND NO OF DAYS FOR FEBRUARY IN ARRAY.             *
      *           RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
      *  053092 - Allow deletion of security as long as last live     *
      *           position in user and customer depot positions have  *
      *           trade, value, settle or ex-coupon nominal not equal *
      *           to zero                                             *
      *  102871 - Should show new issue details in amend/enquire modes*
      *  068079 - Use file SEDEL instead of SEDEVX to check if        *
      *           RECI='C' in securities events to prevent            *
      *           DB error in SE2100.                                 *
      *  054084 - Divisor basis may not be ' ' of day basis is not.   *
      *           Otherwise loop in Close of business.                *
      *  042312 - Field Issuer mandatory only if status 'C'.          *
      *  066779 - Don't update Last Coupon Date in amend mode since   *
      *           if the Rate Change Dates array has been amended it  *
      *           gets updated with the wrong date, causing erroneous *
      *           interest amounts to get posted.                     *
      *  S01408 - Addition core hook SE0040CCP9.                      *
      *           Addition core hook SE0040CP10.                      *
      *           Addition core hook SE0040CP11.                      *
      *           Addition core hook SE0040CP12.                      *
      *           Addition core hook SE0040CP13.                      *
      *           Addition core hook SE0040CP14.                      *
      *           Addition core hook SE0040CP15.                      *
      *           Addition core hook SE0040CP16.                      *
      *           Addition core hook SE0040CP17.                      *
      *           Addition core hook SE0040CP18.                      *
      *           Addition core hook SE0040CP19.                      *
      *           Addition core hook SE0040CP20.                      *
      *  092001 - When deleting a security, check if transaction      *
      *           exists in the Historic Trades file (HSTTRD).        *
      *  091865 - SCR,X MUST BEEN BLANK IF SCD,X IS EQUAL 0           *
      *  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
      *  075592 - Do not update issue date with value of initial date *
      *           if this field has just been amended. Also , make    *
      *           issued amount field input capable on amend.         *
      *  093522 - Remove validation and database error check for      *
      *           Lead Manager being on Securities customer file -    *
      *           causes database errors on enquiry into previously   *
      *           entered Securities and is unnecessary for           *
      *           processing                                          *
      *  S01408 - Addition core hook SE0040IIP1.                      *
      *           Addition core hook SE0040CCP1.                      *
      *           Addition core hook SE0040CCP2.                      *
      *           Addition core hook SE0040CCP3.                      *
      *           Addition core hook SE0040CCP4.                      *
      *           Addition core hook SE0040CCP5.                      *
      *           Addition core hook SE0040CCP6.                      *
      *           Addition core hook SE0040CCP7.                      *
      *           Addition core hook SE0040CCP8.                      *
      *           Addition core hook SE0040EEP1.                      *
      *           Addition core hook SE0040EEP2.                      *
      *  S01511 - Market Migration                                    *
      *  075524 - WHEN UPDATING EXVALZ FOR A DELETED SECURITY, DO NOT *
      *           REDUCE NORE BY 1 AS THIS CAUSES FILES OUT OF BALANCE*
      *           IN THE EXTEL INTERFACE.                             *
      *  S01408 - Core hook SE0040CISE added                          *
      *           Core hook SE0040CVSR added                          *
      *           Core hook SE0040CVSF added                          *
      *  S01408 - Core hook SE0040CCPG added                          *
      *  065527 - Issue Amount being displayed on second page even    *
      *           Risk Management is not installed.                   *
      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9                                             *
      *  054941 - Allow amendment of maturity date indicator if the   *
      *           maturity date is less than or equal to rundate      *
      *  058133 - Only set default value for current factor if action *
      *           is INPUT.                                           *
      *  054025 - Second screen is redisplayed to show Austrailian    *
      *           yield defaults. This is not needed as fields default*
      *           on entering screen.                                 *
      *  S01401 - MT5xx SWIFT Messages Feature:                       *
      *          - New fields ISIN and SWTP added to PF/SECTYD, so    *
      *            added to Screen for data capture.                  *
      *  044310 - Critical Value Details for Securities can be        *
      *           Changed while Live Value Positions are held.        *
      *           Program should display a Warning Message.           *
      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
      *          - New Zealand Bond Formula.                          *
      *          - New Fields for Amortisation by Security Report.    *
      *  E36754 - Do not highlight security or show error code 118    *
      *           twice when invalid market change occurs             *
      *  E32674 - Recompiled due to error in DPTMVD                   *
      *  E31315 - Market indicator should not default to 'P'          *
      *  E31319 - Changing the market on the security should be       *
      *           allowed if all positions are flat.                  *
      *  E28362 - Deleting 2 securities in a row causes DB error in   *
      *           SEDEVA                                              *
      *  E28357 - First Coupon Date does not need to correspond to a  *
      *           Date on the Coupon Array: Replaced Error 233 with   *
      *           Warning W03.                                        *
      *  E27093 - Country Of Risk should default from Country of      *
      *           Citizenship, not Country of Domicile.               *
      *  E28788 - @KEYC should be cleared before moving the access    *
      *           object key into it to avoid incorrect key usage.    *
      *  E28570 - Program should accept any valid customer for risk   *
      *           customer and not check it is a securities customer. *
      *  E28494 - Should default industry code to BBLICD (issuers     *
      *           industry code)and not BBLINC (issuers instution cde)*
      *  E27092 - Recompiled over changed SR/ZLCD.                    *
      *  E25070 - The Issuer should be mandatory.                     *
      *  E24327 - If Ex Date Default is invalid, error '128' appears  *
      *           twice.                                              *
      *  E25521 - Cannot enter a yield based security with day        *
      *           basis '4'.                                          *
      *           Zero coupon yield based are not allowed unless of   *
      *           type 'DA' or 'A' and the divisor basis is specified.*
      *  S01220 - Amended for Strategic Risk Management Release 2     *
      *           to prompt for original issue amount on screen 2     *
      *           if early redemption is allowed and RM is on.        *
      *           Also prompt for Roll Forward indicator if security  *
      *           is a share.                                         *
      *  E28717 - Fix applied to prevent warning message 'W01' from   *
      *           second screen being displayed on third screen.      *
      *  S01117 - MULTIBRANCHING.                                     *
      *  S01195 - HOLIDAY AMENDMENT.                                  *
      *  S01269 - TRADE AUTHORISATION: Recompiled for change to file  *
      *           TABSE.                                              *
      *  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
      *           to TRADSD and/or DPTMVD.                            *
      *  E23362 - *IN46 should be set on unconditionally if action is *
      *           delete, else cannot delete security at all.         *
      *  E23361 - Risk customer should default to issuer if Risk      *
      *           Customer is blank.                                  *
      *  E23282 - Recompiled over changed display file SE0040DF.      *
      *  E22794 - Amend checks before allowing deletion of security:  *   E22794
      *           Use amended logical TRADSR so that changed trades   *   E22794
      *           are checked for as well as live ones, and use       *   E22794
      *           amended CDEPZ and UDEPZ to check all nominals = 0.  *   E22794
      *           Also add check to BKPOS nominal fields if record    *   E22794
      *           found on BKPHD, and check no limits records exist,  *   E22794
      *           using new logical SLIMIS.                           *   E22794
      *           Use separate error codes for each check.            *   E22794
      *           Remove conditioning for Schuldschein.               *   E22794
      *  E22108 - Early repayment not applicable to shares,commodities*   E22108
      *           or unit trusts.                                     *   E22108
      *  E22048 - Recompiled over changed display file.               *   E22048
      *  E21717 - Matured Diary Events must be deleted on deletion of *   E21717
      *           Security in case one is subsequently inserted with  *   E21717
      *           the same name.                                      *   E21717
      *  E21616 - Recompiled over changed SR/ZLCD.                    *   E21616
      *  E21570 - Wrong Coupon/Rate Days fields are highlighted in    *   E21570
      *           error when Coupon Rate = 0. (Err. 265).             *   E21570
      *  E20517 - Change error 211 to W02, to allow DYBS '4' for a    *   E20517
      *           zero Coupon Rate (for amortisation in SE2220).      *   E20517
      *  E20651 - DB Error Numbers used in more than one place.       *   E20651
      *           New Error Numbers as follows:                       *   E20651
      *           DB ERROR 03 -> 11.                                  *   E20651
      *           DB ERROR 03 -> 12.                                  *   E20651
      *           DB ERROR 10 -> 13.                                  *   E20651
      *           DB ERROR 10 -> 14.                                  *   E20651
      *  E20687 - ENTER needs to be pressed twice before validation   *   E20687
      *           of the Initial Screen occurs.                       *   E20687
      *           Error messages appear, then disappear without field *   E20687
      *           changes being made.                                 *   E20687
      *  E20179 - Issue Date should default to Initial Date.          *   E20179
      *  E20486 - Discounts must not be Day Basis 4.                  *   E20486
      *  S01232 - Australian Yield Modifications.                     *   S01232
      *  E20459 - The First Coupon Date defaults to Maturity Date.    *   E20459
      *           However, this default produces Error Messages if    *   E20459
      *           the Coupon Rate is zero.                            *   E20459
      *  E20292 - After trying to insert an already existing security *   E20292
      *           and then making an enquiry, indicators are not      *   E20292
      *           reset so the default Yield Basis is displayed       *   E20292
      *           instead of the actual one on Securities file.       *   E20292
      *  E20290 - When amending a Schuldshein Security, Error 121     *   E20290
      *           appears incorrectly even though Part Paid Ind. = 'N'*   E20290
      *  E20085 - Interest and Coupon Calculations Rewrite:           *   E20085
      *          - The FCPN if left blank was having a value of zero. *   E20085
      *            ZNCD was added to calculate it.                    *   E20085
      *          - CD and CR 'E' and 'I' specifications are defined   *   E20085
      *            in /COPY members and so these should be used.      *   E20085
      *          - SR/ZLCD introduced to replace Last Coupon Date     *   E20085
      *            subroutine, etc. (Also supercedes E16305, E14483   *   E20085
      *            and E14711).                                       *   E20085
      *            This makes Initial LCPN more correct and reliable. *   E20085
      *          - Security Diary file specs redefined for the above. *   E20085
      *          - First and Last Coupon Date processing moved after  *   E20085
      *            Initial and Maturity Date processing, so that the  *   E20085
      *            Standard Subroutines pick up the correct fields.   *   E20085
      *          - Add Day BASIS 5 - 30 Day Months US Domestic Method *   E20085
      *  E19868 - Prevent market indicator being incorrectly set to   *   E19868
      *           'P' for complete securities when investment type or *   E19868
      *           nominal currency is not entered on initial screen.  *   E19868
      *  E19869 - Issue Date default not reset on attempted amend of  *   E19869
      *           Initial Date, preventing amendment. Issue Date      *   E19869
      *           field is not displayed if security not New Issue.   *   E19869
      *  E19740 - Error array is not set to blank after update.       *   E19740
      *           Warning error still displayed .                     *   E19740
      *  E19836 - Warning error 'W02' should be 'W01'.The error is    *   E19836
      *           displayed if the Maturity Date is a holiday in the  *   E19836
      *           Value or Nominal Currency for Disc/Int securities.  *   E19836
      *  E15930 - On Insert of a Complete Security, or Amend of an    *   E15930
      *           Incomplete to Complete, Current Partly Paid Price   *   E15930
      *           (CPDP) and Total Price Held on Diary (TPHD) should  *   E15930
      *           be initialized with the Initial Price.              *   E15930
      *           Other programs affected: SE0050/0130/2100.          *   E15930
      *  E19751 - Should be able to enter Coupon Rate Indicators of   *   E19751
      *           'R' or 'C' for Yen Bonds and Mortgage-Backs.        *   E19751
      *  E19750 - Partly Paid Commodities should not be allowed.      *   E19750
      *  S01199 -  Help System.                                    *   S01199
      *  E19031 - Recompiled over amended version of Display File to  *   E19031
      *           pick up Command Key changes.                        *   E19031
      *  E16770 - Recompiled for 'RATING' field changes.              *   E16770
      *  E16772 - Recompiled for the Dividend Payment Amount field    *   E16772
      *           changes.                                            *   E16772
      *  E17196 - When Trade Basis = 'Y' and Day Basis NOT = '4', the *   E17196
      *           Coupon Rate is allowed to be zero.                  *   E17196
      *  E17197 - Check for Valid Dealing Currency on Value Currency. *   E17197
      *  E16305 - Last Coupon Date (LCPN) should not be updated if    *   E16305
      *           a Non-Diary Events Record (TYPE CP) exists for the  *   E16305
      *           Security being amended.                             *   E16305
      *  E16302 - The Security Report Name is not shown correctly on  *   E16302
      *           Enquiries.                                          *   E16302
      *  E16801 - Do not zero Market Price in 'AMEND' MODE.           *   E16801
      *  E90095 - CONDITION ENTRY INTO IVAL ON U3. PROGRAM WAS GETTING*   E90095
      *           MESSAGE 'RECORD UPDATED BY ANOTHER WORKSTATION'.    *   E90095
      *  S01186 - FURTHER INCORPORATION AMENDMENTS.                   *   S01186
      *          - ENABLE DISPLAY OF F12 OPTION IMMEDIATELY FROM      *   S01186
      *            SCREEN 1 TO PREVENT DEFAULTS OVERWRITING PREVIOUS  *   S01186
      *            FIELDS WHEN F12 USED.                              *   S01186
      *          - MATURITY DATE AND INDICATOR SHOULD BE UNDERLINED   *   S01186
      *            ON AMEND SCREEN 2 IF THE MATURITY INDICATOR IS 'A' *   S01186
      *            (APPROXIMATE).                                     *   S01186
      *          - INVTP DEFAULTS ARE NOT BEING DISPLAYED ON THE 2ND  *   S01186
      *            SCREEN WHEN PROT = 9 AND TRADE BASIS = 'Y'.        *   S01186
      *            ALSO SECTOR AND RATING NOT BEING DISPLAYED ON THE  *   S01186
      *            INITIAL SCREEN WHEN DEFAULTED.                     *   S01186
      *          - MATURITY DATE NOT BEING VALIDATED ON AMEND SCREEN  *   S01186
      *            AFTER INSERT TRIED BUT RECORD ON FILE.             *   S01186
      *  S01176 - SECURITIES TRADING 3.1                              *   S01176
      *           (AUSTRALIAN ENHANCEMENT)                            *   S01176
      *  S01169 - SECURITIES TRADING 3.1                              *   S01169
      *           (BAER INCORPORATION)                                *   S01169
      *  E14792 - Issue date to initial date.                         *   E14792
      *  E14483 - Date format M not accounted for in SR/LSTCPN,       *   E14483
      *           resulting in incorrect last coupon date on SECTY.   *   E14483
      *  E14482 - THE YIELD BASIS ON THE INVESTMENT TYPE IS           *   E14482
      *           NOT BEING PICKED UP.                                *   E14482
      *  E13953 - INCORRECT TREATMENT OF DATE FORMAT M                *   E13953
      *  E14711 - LAST COUPON DATE MUST NOT BE LESS THAN INITIAL DATE.*   E14711
      *  E13941 - ALLOW ZERO COUPON RATE IF SECURITY IS INCOMPLETE.   *   E13941
      *  E13664 - ERROR IN READING TABTG10 FOR FEE CCY DECIMAL        *   E13664
      *           PLACES AND NOMINAL CCY DECIMAL PLACES FOR           *   E13664
      *           PROCESS TYPE 8.                                     *   E13664
      *  E14204 - TO ALLOW BLANK DIVISOR BASIS IF ZERO COUPON.        *   E14204
      *  E13662 - TO REMOVE DISPLAY OF 'CANCELLED' AND 'MATURED'      *   E13662
      *           FROM PRIMARY SCREEN WHEN ENTER INPUT FROM           *   E13662
      *           SECONDARY SCREEN OF PREVIOUS DISPLAY.               *   E13662
      *  E13527 - FIELDS COUPON RATE, MATURITY DATE, DAY BASIS &      *   E13527
      *           DIVISOR BASIS WERE BEING PROTECTED WHEN THE         *   E13527
      *           SECURITY WAS BEING AMENDED FROM INCOMPLETED TO      *   E13527
      *           COMPLETE.                                           *   E13527
      *  E13622 - SUBTRACT 1 FROM NORE ON FILE SECTYA IF A SECURITY   *   E13622
      *           IS CANCELLED.                                       *   E13622
      *  S01158 - POST INCORPORATION DEVELOPMENT FIXES INCLUDING      *
      *              - SUPPRESS DEFAULT ON BLANK LEAD MANAGER         *
      *              - RE-DISPLAY STATUS ON CMD 2/ROLLBACK IN ENQUIRY *
      *              - MARKET IND. SHOULD NOT BE AMENDABLE FROM 'S'.  *
      *              - RECORD CONSTANTLY 'UPDATED BY ANOTHER WORKSTN' *
      *                IN AMEND AND DELETE MODES                      *
      *                                                               *
      *****************************************************************
      *
     FSE0040DFCF  E                    WORKSTN
     F/COPY WNCPYSRC,SE0040F003
     F****MARKT   IF  E           K        DISK                           S01129
     FSEMKC   IF  E           K        DISK                               S01129
     F*CLINT***IF  E           K        DISK                              S01117
     F**********  CLINTCAF                          KIGNORE               S01117
     F**********  CLINTCCF                          KIGNORE               S01117
     F**********  CLINTC1F                          KIGNORE               S01117
     F**********  CLINTSEF                          KIGNORE               S01117
     F*SNAME***IF  E           K        DISK                              S01117
     F**********  CLINTCBF                          KRENAMESNAMEF         S01117
     FINVTP   IF  E           K        DISK
     FSECTY   UF  E           K        DISK         KCOMIT       A
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FSECTYX  IF  E           K        DISK
     F            SECTYDF                           KRENAMESECTYDFX
     F*RADSE  IF  E           K        DISK                               E22794
     FTRADSR  IF  E           K        DISK                               E22794
     FHSTTRR  IF  E           K        DISK                               092001
     F*TABSE***IF  E           K        DISK                              S01117
     F**********  TABLETAF                          KIGNORE               S01117
     F**********  TABTE10F                          KIGNORE               S01117
     F**********  TABTE20F                          KIGNORE               S01117
     F**********  TABTG20F                          KIGNORE               S01117
     F**********  TABLETLF                          KIGNORE               S01117
     F**********  TABLETPF                          KIGNORE               S01117
     F**********  TABLETRF                          KIGNORE               S01117
     F**********  TABLETXF                          KIGNORE               S01117
     F**********  TABLET2F                          KIGNORE               S01117
     F**********  TABLET3F                          KIGNORE               S01117
     F**********  TABLET5F                          KIGNORE               S01117
     F**********  TABTB40F                          KIGNORE               S01117
     F**********  TABTB10F                          KIGNORE               S01117
     F**********  TABTB11F                          KIGNORE               S01117
     FUDEPZ   IF  E           K        DISK
     FCDEPZ   IF  E           K        DISK
     FBKPHD   IF  E           K        DISK
     F*SEDEV***IF**E           K        DISK                              E21717
     F*SEDEVX  IF  E           K        DISK                      E21717  068079
     FSEDEL   IF  E           K        DISK                               068079
     F            SEDEVDF                           KRENAMESEDEVDFX       E21717
     FSEDEV   UF  E           K        DISK         KCOMIT                E21717
     F*SEDEVA**UF**E           K        DISK         KCOMIT        E21717 E28362
     FSEDEVA  UF  E                    DISK         KCOMIT                E28362
     FDPTMV   IF  E           K        DISK
     F***SECEO***IF**E           K        DISK                     E16305 E20085
     F***************SEDEVDF                           KIGNORE     E16305 E20085
     FSECTYA  UF  E                    DISK         KCOMIT
     F                                              KINFSR INFSR
     F****EXVALD  UF  E           K        DISK         KCOMIT       A    S01169
     FEXVALD  UF  E           K        DISK         KCOMIT       A    U3  S01176
     F                                              KINFSR INFSR          S01169
     F****EXVALZ  UF  E                    DISK         KCOMIT            S01169
     FEXVALZ  UF  E                    DISK         KCOMIT            U3  S01176
     F                                              KINFSR INFSR          S01169
     FBKPOS   IF  E           K        DISK                               E22794
     FSLIMIS  IF  E           K        DISK                               E22794
     FSDBSRTL1IF  E           K        DISK                               S01117
     FSECEO   IF  E           K        DISK                               CSE005
     F            SEDEVDF                           KIGNORE               CSE005
     FSECTYL2 IF  E           K        DISK                           UC  CSE011
     F                                              KINFDS SECTY2         180413
      ** Securities by Telekurs                                           CSE011
      *                                                                   CSE011
     FSECTYL1 IF  E           K        DISK                           UC  CSE011
     F                                              KINFDS SECTY1         180413
      ** Securities by ISIN Number                                        CSE011
      *                                                                   CSE011
     FSECTYL0 IF  E           K        DISK                           UC  CSE011
     F                                              KINFDS SECTY0         180413
      ** Securities by CUSIP Number                                       CSE011
      *                                                                   CSE011
     FSECTYL3 IF  E           K        DISK                           UC  CSE011
     F                                              KINFDS SECTY3         180413
      ** Securities by Sedol Number                                       CSE011
      *                                                                   CSE011
     FSECTE   IF  E           K        DISK                           UC  CSE011
     F                                              KINFDS SECE           180413
      ** Securities by EUCLID Code                                        CSE011
      *                                                                   CSE011
     F            SECTYDF                           KRENAMESECTYDL5       CSE011
     FSECT2   IF  E           K        DISK                           UC  CSE011
     F                                              KINFDS SEC2           180413
      ** Securities by Depot Reference 2                                  CSE011
      *                                                                   CSE011
     F            SECTYDF                           KRENAMESECTYDL6       CSE011
     FSECT3   IF  E           K        DISK                           UC  CSE011
     F                                              KINFDS SEC3           180413
      ** Securities by Depot Reference 3                                  CSE011
      *                                                                   CSE011
     F            SECTYDF                           KRENAMESECTYDL7       CSE011
      *                                                                   CSD006
     FSECTYL5 IF  E           K        DISK                               CSD006
     F            SECTYDF                           KRENAMESECTYDL8       CSD006
      ** Securities by Security Price Identifier                          CSD006
      *                                                                   CSD006
      *                                                                   183604
     FPBRATIL0IF  E           K        DISK                               183604
      ** PB Rating Code                                                   183604
      *                                                                   183604
     FCPOSS   IF  E           K        DISK                               183604
     F            DPOSNDF                           KIGNORE               183604
      ** SE Customer Position                                             183604
      *                                                                   183604
     F/COPY WNCPYSRC,SE0040F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*** 01  - F/3 - End job *************************************** *   102342
     F*** 02  - F/12 - Previous Screen ****************************** *   102342
     F*   01  - Protect Depot Reference on screen two                 *   102342
     F*   02  - Protect Depot Reference on screen two                 *   102342
     F*   03  - Protect input capable fields in Delete/Enquiry Modes  *
     F*   04  - F/10 - Delete record                                  *
     F*** 05  - F/5 - Display Initial screen ************************ *   102342
     F*   05  - Protect Depot Reference on screen two                 *   102342
     F*   06  - HELP Key                                              *
     F****06  - HELP Key                                              *   S01220
     F****06**-*Processing*Type*=*4********************************S01220 S01397
     F*   06  - Australian yield basis                                    S01397
     F*   07  - ROLLUP Key                                            *
     F*   08  - ROLLDOWN Key                                          *
     F*                                                               *
     F*   09  - Display Error Code List                               *
     F*   10  - Interest Security                                     *
     F*   11  - Share Security                                        *
     F****12**-*Share*Security*****************************************   S01397
     F*   12  - Share Security (Processing type 4 & 7)                *   S01397
     F*   13  - Partly-Paid Security                                  *
     F*   14  - Error on Next Expected Dividend field                 *
      *         Display ISIN code if Private banking on (1st screen)  *                       192054
     F*   15  - Trade Basis is 'D'                                    *
     F*   16  - Display fields on second Screen                       *
     F*   17  - Display fields after Defaults applied                 *   S01176
     F*   18  - Maturity Date Indicator is 'F'                        *   S01176
     F*   19  - Processing Type 2,4 or 7                              *   S01176
     F*   20  - Trade basis is 'D' and Security is Complete           *
     F*   21  - PROT field is '3' '5' '8'                             *   S01158
     F*   22  - Error on Depot 1 Security Reference field             *
     F*   23  - Error on Depot 2 Security Reference field             *
     F*   24  - Error on Depot 3 Security Reference field             *
     F*   25  - Error on Market Centre field                          *
     F*   26  - Error on Convertible Indicator                        *
     F*   27  - Error on Price Basis field                            *
     F*   28  - Error on Yield Basis field                            *
     F*   29  - Error on Initial Price field                          *
     F*   30  - Error on Fully Paid Price field                       *
     F*   31  - Error on Maturity Date field for Discount Security    *
     F*   32  - Error on Day Basis field for Discount Security        *
     F*   33  - General purpose work indicator 1                      *
     F*   34  - General purpose work indicator 2                      *
     F*   35  - Error on Divisor Basis field for Discount Security    *
     F*   35  - Error on ISIN/COMMON code for the Security (Screen 1) *   S01401
     F*   36  - Error on Contingency Liability Ind on second screen   *   S01176
     F*   37  - Error on Maturity Date Indicator on second screen     *   S01176
     F*   38  - Processing Type is 9                                  *   S01176
     F*   39  - Protect fields for Completed Security                 *   S01158
     F****40****Protect Maturity Date as Security is Complete             CSE007
     F**********and Maturity Date NE 999999                               CSE007
     F*   40    Protect maturity date as UPDATE and security              CSE007
     F*         not traded on 'P' basis                                   CSE007
     F*   40  - Control display of SISIN/SSWTP. (ON if S01401 present)*   S01401
     F*   41  - Protect unchangeable fields on initial screen         *
     F*         during 'Amend' mode                                   *
     F*    AND  Error on Compounding Frequency field                  *   S01397
     F*   42  - Display 'CANCELLED' on initial screen for a           *
     F*         Cancelled Security if not in Input mode               *
     F*         Error on Roll Forward Dividend indicator              *   S01220
     F*    AND  Error on Discount Basis                               *   S01397
     F*   43  - Display 'MATURED' on initial screen for a Matured     *
     F*         Security if not in Input mode                         *
     F*         Error on Issue Amount on second screen                *   S01220
     F*    AND  Error on Discount Last Coupon                         *   S01397
     F*   44  - Protect unchangeable fields on initial screen         *
     F*         during 'Amend' mode where Security is Complete        *
     F*    AND  Either Error on any coupon date on second screen      *   CSE005
     F*   45  - Protect Partly Paid Indicator on initial screen       *
     F*         during 'Amend' mode where its value is 'N'            *
     F*    AND  *OFF = Protect Coupon Dates on second screen          *   CSE005
     F*   46  - Seton if 'Delete' mode                                *
     F*   47  - Seton if 'Enquiry' mode                               *
     F*   48  - Seton if 'Insert' mode                                *
     F*   50  - Errors on - Action Code on first screen               *   S01176
     F*                   - Risk Customer on second screen            *   S01176
     F*   51  - Errors on - Security Shortname on initial screen      *
     F*                   - Initial Dividend Date on second screen    *
     F*                   - Issue Date on third screen                *
     F*   52  - Errors on - Incomplete Indicator on initial screen    *
     F*                   - Issue Price on third screen               *
     F*   53  - Errors on - Security Report Name field                *
     F*                   - Lead Manager field on third screen        *
     F*   54  - Errors on - Nominal Currency field                    *
     F*                   - Issue Amount on third screen              *
     F*   55  - Errors on - Investment Type field                     *
     F*                   - Total Underwritten on third screen        *
     F*               AND - Business Day Convention on second screen  *   CSE005
     F*   56  - Errors on - Industry Code field                       *
     F*                   - Allocation Requested on third screen      *
     F*   57  - Errors on - Value Currency field                      *
     F*                   - Allocation Received on third screen       *
     F*   58  - Errors on - Multi-Currency Indicator                  *
     F*                   - Management Fees Due on third screen       *
     F*   59  - Errors on - Market Indicator                          *
     F*                   - Management Fees Received on third screen  *
     F*   60  - Errors on - Country of Risk field                     *
     F*                   - Underwriting Fees due on third screen     *
     F*   61  - Errors on - Partly Paid Indicator                     *
     F*                   - Underwriting Fees Received on third screen*
     F*   62  - Errors on - Issuer field                              *
     F*                   - Fee Currecny field on third screen        *
     F*   63  - Error on New Issue field                              *
     F* 52-63 - Errors on Dividend Payment Dates (x 12) and Coupon    *
     F*         Rate/Days fields (x 12) on second screen              *
     F*   64  - Errors on - Stock Denomination field on initial screen*
     F*                   - Day Basis field for Interest Security on  *
     F*                     second screen                             *
     F*   65  - Errors on - Early Repayments Indicator on initial     *
     F*                     screen                                    *
     F*                   - Divisor Basis field for Interest Security *
     F*                     on second screen                          *
     F*   66  - Errors on - Value Date Default field on initial screen*
     F*                   - Interest Adjustments field on second      *
     F*                     screen                                    *
     F*   67  - Errors on - Ex-Date Default field on initial screen   *
     F*                   - Initial Date field on second screen       *
     F*   68  - Errors on - Trade Basis Override field on initial     *
     F*                     screen                                    *
     F*                   - First Coupon Dates field on second screen *
     F*   70  - Midas-Plato Interface is installed, initial screen    *   CPL002
     F* 69-80 - Errors on Coupon Rate Indicators (x 12)               *
     F*   81  - Error on Rate Change Frequency field                  *
     F*   82  - Error on Next Change Date field                       *
     F*   83  - Error on Coupon Rate field                            *
     F*   84  - Error on Base Rate Code field                         *
     F*   85  - Error on Base Rate Spread field                       *
     F*   86  - Error on Base Rate Spread Indicator                   *
     F*   86  - Error on SWIFT Security Type Code                     *   S01401
     F*   87  - Error on Minimum Coupon field                         *
     F*   88  - Error on Maturity Date field for Interest Security    *
     F*   89  - Error on Long-Term Maturity Indicator                 *
     F*                                                               *
     F* 90-99 - Used in Standard Subroutines                          *
     F*    90 - ALSO to display field BCNV (Business Day Convention)  *   CSE005
     F*    90 - ALSO to display Next/Last Coupon Dates                *   CSE005
     F*    91 - ALSO to display CSD006 fields on 1st and 2nd screens  *   CSD006
     F*    92 - ALSO ERROR on Security Price FO  Id on 1st Screen     *   CSD006
     F*       - AND ERROR on Data Source field on 2nd screen          *   CSD006
     F*                                                               *
     F*   KC  - PF 03 key (END JOB)                                   *   102342
     F*   KE  - PF 05 key (Initial Screen)                            *   102342
     F*   KL  - PF 12 key (Previous screen)                           *   102342
     F*                                                               *   102342
     F*   U3  - EXTEL Option installed                                *   S01176
     F*   U7  - Database Error                                        *
     F*   U8  - Database / Control Error                              *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INITL  - Process initial screen                              *
     F*  INFSR  - File exception/error handling                       *
     F*  ITLDTA - Fetch initial detail for existing records           *
     F***LSTCPN*-*Calculate*last*coupon*date***************************   E20085
     F*  RSTSEC - Restore Last Security details                       *   S01176
     F*  SAVSEC - Save Current Security details                       *   S01176
     F*  SECOND - Process second screen                               *
     F*  THIRD  - Process third screen                                *
     F*  TRSECT - Translate screen fields to file format              *
     F*                                                               *   S01401
     F*  VLDDCM - Validate Deletion/Change of market                  *
     F*  VLDDFT - Validate default entries on second screen           *
     F*  VLDDSC - Validate discount entries on second screen          *
     F*  VLDINT - Validate interest entries on second screen          *
     F*  VLDITL - Validate entries on initial screen                  *
     F*  VLDPPD - Validate Partly paid entries on second screen       *
     F*  VLDSHR - Validate Share entries on second screen             *
     F*  VLDTHD - Validate entries on third screen                    *
     F*  VLISIN - Validate Security Code for ISIN/COMMON              *   S01401
     F*  VLSWTP - Validate SWIFT Security Type Code                   *   S01401
     F*                                                               *   S01401
     F*  UPDFLS - Update files                                        *
     F*  DFTDSC - Output Discount Defaults for second screen          *   S01176
     F*  DFTINT - Output Interest Defaults for second screen          *   S01176
     F*  DFTITL - Output Defaults for Initial Screen                  *   S01176
     F*  DVAL   - Delete validated details for deletion of security   *   S01169
     F*  IVAL   - Insert validated details for insertion of security  *   S01169
     F*  AVAL   - Amend validated details for amendment of security   *   S01169
     F*                                                               *
     F*  ZALIGN - Validate and right-align numeric fields             *
     F*  ZASIGN - Validate and right-align signed numeric fields      *
     F*  ZDATE1 - DATE - DAYNO conversion                             *
     F*  ZDATE2 - DAYNO - DATE conversion                             *
     F***ZDATE5*-*Determine*if*holiday*in*given*currency***********   *   S01195
     F*  ZEDIT  - Insert a decimal point into a numeric field and blan*
     F*           out leading zeros                                   *
     F***ZICD2**-*Access*ICD*record*2**********************************   S01117
     F***ZICDSE*-*Access*ICD*record*for*Securities*Trading*************   S01117
     F*  ZLCD   - Determine Last Coupon Date                          *   E20085
     F*  ZNCD   - Determine Next Coupon Date                          *   E20085
     F*  ZSEDIT - Insert a decimal point and sign into a numeric field*
     F*           and blank out leading zeros                         *
     F***ZSYSTM*-*Access*ICD*record************************************   S01117
     F*  ZTNLU1 - Fetch next available transaction number             *
     F*  ZXRATE - Calculate cross-exchange rate                       *
     F*  *PSSR  - Error Handling Subroutine                           *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     F/COPY WNCPYSRC,SE0040F002
     E                    CPY@    1   1 80
     E                    WAMSG   1  10 76                                CSE011
     E                    WE         76  1                                CSE011
     E                    ERR        57  4
     E********************INF     1   1 76                                S01511
     E*                                                                   S01408
     E/COPY WNCPYSRC,SE0040EEP1                                           S01408
     E*                                                                   S01408
     E                    INF     1   2 76                                S01511
     E*                                                                   S01408
     E/COPY WNCPYSRC,SE0040EEP2                                           S01408
     E                    ERS         9  3                                CSE007
     E*                                                                   S01408
     E/COPY ZSRSRC,ZDATE2Z1
     E*COPY*ZSRSRC,ZDATE6Z1                                               S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E** SR.ARRAY FOR BOTH ZACCH AND ZCHKH                                S01195
     E/COPY ZSRSRC,ZALIGNZ1
     E****/COPY*ZSRSRC,ZSDESCZ1***                                  S01158E16302
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZASIGNZ1
     E/COPY ZSRSRC,ZNCDZ1                                                 E20085
     E***********         CD         12  4 0                              E20085
     E***********         CR         12  1                                E20085
     E                    SCD        12  4
     E                    SCR        12  1
     E                    DNM         7  1
     E                    TABMTH 12  12  2   TABDAY  2 0
     E***********         TABYBS 11  11  2                                S01232
     E                    TABYBS 12  12  2                                S01232
     E                    IS1        12  1               ISIN VALIDATIONS S01401
     E                    IS2        12  1               ISIN VALIDATIONS S01401
     E                    ALPHA1 37  37  1               ALPHABETIC ARRAY S01401
     E                    ALPHA2 36  36  1               ALPHABETIC ARRAY S01401
     E*                                                                   183604
     E** Array for instrument type field                                  183604
     E                    INP         3  1                                183604
     E                    STAMP   1   1 26                                                    202329
      ** Array containing dummy timestamp                                                     202329
      *                                                                                       CSC022
      ** Array to hold commitment jobs name                                                   CSC022
     E                    CMTJOB     10 10                                                    CSC022
      *                                                                                       CSC022
     E/COPY WNCPYSRC,SE0040E001
      /EJECT
     ISECTYDFX                                                            S01158
     I              RECI                            SRECI                 S01158
     I*                                                                   S01408
     IDPTMVDF                                                             CSE017
     I              DPAP                            DDPAP                 CSE017
      *                                                                   CSE017
     I*   Rename SECTYL5 field for FO  Security Price validation          CSD006
     ISECTYDL8                                                            CSD006
     I              SESN                            W5SESN                CSD006
     I*                                                                   CSD006
      ** Rename API fields to avoid copying other file's API              CAP140
      ** fields.                                                          CAP140
      *                                                                   CAP140
     ISEDEVDF                                                             CAP140
     I              FRNT                            WFRNT                 CAP140
     I              REPA                            WREPA                 CAP140
      *                                                                   CAP140
     I/COPY WNCPYSRC,SE0040IIP1                                           S01408
     I*                                                                   S01408
      *                                                                   138957
     IOTHINF      DS                            156                       138957
     I                                        1  20 WSRPN                 138957
     I                                       21  50 WSFN1                 138957
     I                                       51  80 WSFN2                 138957
     I                                       81  92 WT2RF                 138957
     I                                       93 104 WISNO                 138957
     I                                      105 113 WCSPN                 138957
     I                                      114 120 WSREF                 138957
     I                                      121 132 WSRE1                 138957
     I                                      133 144 WSRE2                 138957
     I                                      145 156 WSRE3                 138957
     I*SCRFM1******DS                            212                S01176CSD006
     ISCRFM1      DS                            232                       CSD006
      ***  Define Data Structure to hold Screen Details
     I                                        1   1 SACTN
     I                                        2  11 SSESN
     I                                       12  31 SSRPN
     I                                       32  61 SSFN1
     I                                       62  91 SSFN2
     I                                       92 101 SISSR
     I                                      102 102 SINCS
     I                                      103 103 SPPDI
     I                                      104 106 SSITP
     I                                      107 109 SQLTY
     I                                      110 110 SMKTI
     I                                      111 117 SSDNM
     I                                      118 118 SERPY
     I                                      119 121 SVDFT
     I                                      122 124 SEDFT
     I                                      125 127 SNMCY
     I                                      128 130 SVLCY
     I                                      131 132 SSSEC
     I                                      133 133 SMLTI
     I                                      134 136 SSIDY
     I                                      137 138 SSCOR
     I                                      139 143 SSRET
     I/COPY WNCPYSRC,SE0040I002
     I                                      144 150 SSREF
     I                                      151 162 ST2RF                 S01176
     I                                      163 171 SCSPN                 S01176
     I                                      172 212 SRNME                 S01176
     I                                      213 232 SSSPID                CAP060
     I/COPY WNCPYSRC,SE0040I003
     ISECTY2      DS                                                      180413
     I                                        9   9 SECT2#                180413
     ISECTY1      DS                                                      180413
     I                                        9   9 SECT1#                180413
     ISECTY0      DS                                                      180413
     I                                        9   9 SECT0#                180413
     ISECTY3      DS                                                      180413
     I                                        9   9 SECT3#                180413
     ISECE        DS                                                      180413
     I                                        9   9 SEC#                  180413
     ISEC2        DS                                                      180413
     I                                        9   9 SEC2#                 180413
     ISEC3        DS                                                      180413
     I                                        9   9 SEC3#                 180413
     I*
     I* DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     IINFDS       DS
     I                                     *STATUS  STATUS
     I                                      244 253 ##JOB                                     CSC022
     I*
     I*LDA*******UDS****************************256                       S01117
     I**************************************134 177 DBLOT                 S01117
     I**************************************134 138 DBFILE                S01117
     I**************************************139 167 DBKEY                 S01117
     I**************************************168 175 DBPGM                 S01117
     I**************************************176 177 DBASE                 S01117
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I*
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I/COPY ZSRSRC,ZTNLU1Z1
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
     I***********************************                           S01195S01117
     I*/COPY*ZSRSRC,ZHOLDS***************                           S01195S01117
      ****EXTERNAL*DS*FOR*HOLIDAY*DETAILS*AND*ACCESS*OBJECTS        S01195S01117
     ICMTTXT      DS
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 306 DET
     I           SDS
     I                                      244 246 WSID
     I                                      254 263 USID
     I            DS
     I                                        1 228 ERR
     I                                        1  76 ERRMSG
     I            DS
     I                                        1  75 HCCY
     I                                        1  75 XCCY
     I****/COPY ZSRSRC,ZSDESCZ2                                     S01158E16302
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZNCDZ2                                                 E20085
      *
      ***  Data Structure to hold Coupon/Rate Days array
     I            DS
     I                                        1  48 SCD
     I                                        1   4 SCD01
     I                                        5   8 SCD02
     I                                        9  12 SCD03
     I                                       13  16 SCD04
     I                                       17  20 SCD05
     I                                       21  24 SCD06
     I                                       25  28 SCD07
     I                                       29  32 SCD08
     I                                       33  36 SCD09
     I                                       37  40 SCD10
     I                                       41  44 SCD11
     I                                       45  48 SCD12
      *
      ***  Data Structure to hold Coupon/Rate Indicators array
     I            DS
     I                                        1  12 SCR
     I                                        1   1 SCR01
     I                                        2   2 SCR02
     I                                        3   3 SCR03
     I                                        4   4 SCR04
     I                                        5   5 SCR05
     I                                        6   6 SCR06
     I                                        7   7 SCR07
     I                                        8   8 SCR08
     I                                        9   9 SCR09
     I                                       10  10 SCR10
     I                                       11  11 SCR11
     I                                       12  12 SCR12
     I            DS
     I                                        1   40DDMM
     I                                        1   20DD
     I                                        3   40MM
     I            DS
     I                                        1   40SCDDMM
     I                                        1   20SCDD
     I                                        3   40SCMM
     I            DS                                                      CPL002
     I                                        1  16 PLCODE                CPL002
     I                                        1   3 PLCCY                 CPL002
     I                                        5  16 PLNME                 CPL002
     I*                                                                   S01408
     I/COPY QWINDSRC,SE0040GDTA                                           S01408
     I*                                                                   S01408
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
     I** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
     ISDBANK    E DSSDBANKPD                                              CSE007
     I* External DS for Bank Details                                      CSE007
     I*                                                                   S01117
     ISDBSRT    E DSSDBSRTPD                                              S01117
     I** Base Rate Details                                                S01117
     I*                                                                   S01117
     ISDCTRY    E DSSDCTRYPD                                              S01117
     I** Country Details                                                  S01117
     I*                                                                   S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I** Currency Details                                                 S01117
     I*                                                                   S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I** Customer Details                                                 S01117
     I*                                                                   S01117
     ISDINDS    E DSSDINDSPD                                              S01117
     I** Industry Details                                                 S01117
     I*                                                                   S01120
     ISDMMOD    E DSSDMMODPD                                              S01120
     I** MIDAS MODULE DETAILS                                             S01120
     I*                                                                   S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I** Securities Clients Details                                       S01117
     I*                                                                   S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I** Securities Trading Details                                       S01117
     I**                                                                  S01117
     ISDNATU    E DSSDNATUPD                                              CPB001
     I** Nature Code Details                                              CPB001
     I*                                                                   CPB001
     I*SDWEIG***E*DSSDWEIGPD***                                                        CPB001 CGP001
     IGPWEIG    E DSGPWEIGPD                                                                  CGP001
     I** Weighting Code Details                                           CPB001
     I*                                                                   CPB001
     ISDPLIN    E DSSDPLINPD                                              183604
     I** Instrument Types Details                                         183604
     I              PDLCD                           PDLCD2                183604
     I              PDWEIG                          PDWEI2                                    CLE025
     I*                                                                   183604
     ISCSARD    E DSSCSARDPD                                              CSE011
      **  External data structures for Switchable Features Details        CSE011
      *                                                                   CSE011
     ISDMDFC    E DSSDMDFCPD                                              CSD006
      **  External data structures for Market Data Feed ICD               CSD006
      *                                                                   CSD006
     ISDMDFS    E DSSDMDFSPD                                              CSD006
      **  External data structures for Maket Data Source Codes Details    CSD006
      *                                                                   CSD006
     IDSFDY     E DSDSFDY                                                 S01117
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     I**                                                                  S01117
     IDSSDY     E DSDSSDY                                                 S01117
     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01117
     I**                                                                  S01117
     I/COPY WNCPYSRC,SE0040I001
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I              '1234567890.- '       C         DIGITS                                    CAS006
      *                                                                                       CSC022
     ISCCMT       DS                            256                                           CSC022
     I                                        1   30CMTNUM                                    CSC022
     I                                        4 103 CMTARR                                    CSC022
      ** Commitment Control dataarea                                                          CSC022
      *                                                                                       CSC022
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C************IN02     IFEQ '0'                                       102342
     C           *INKL     IFEQ '0'                                       102342
     C**********                                                    S01176S01117
     C**Key*to*access Client Record                                 S01176S01117
     C**********                                                    S01176S01117
     C********** CLTKEY    KLIST                                    S01176S01117
     C**********           KFLD           KCNB                      S01176S01117
     C**********           KFLD           RCDT                      S01176S01117
      *                                                                   CEU018
     C* Key to access Processing Type                                     CEU018
      *                                                                   CEU018
     C           K#PROT    KLIST                                          CEU018
     C                     KFLD           K#CCYI  3                       CEU018
     C                     KFLD           K#INVT  3                       CEU018
     C*                                                                   S01117
     C* Key to access Base Rate Code Record                               S01117
     C*                                                                   S01117
     C           BSRT      KLIST                                          S01117
     C                     KFLD           CYCD    3                       S01117
     C                     KFLD           BSRC    2                       S01117
     C*                                                                   092001
     C* Key to access HISTORIC TRADES RECORD                              092001
     C*                                                                   092001
     C           KHST      KLIST                                          092001
     C                     KFLD           KTDSS  10                       092001
     C                     KFLD           KTDDT   50                      092001
     C                     KFLD           KTDRF   6                       092001
     C*
     C* Assemble key to access Investment Type record
     C*
     C           ITPKA     KLIST
     C                     KFLD           SNMCY
     C                     KFLD           SSITP
     C**********                                                          S01117
     C**Key*to*access Table records                                       S01117
     C**********                                                          S01117
     C********** TABKA     KLIST                                          S01117
     C**********           KFLD           KEY12A 12                       S01117
     C*                                                                   E22794
     C* Key to access Book Position records                               E22794
     C*                                                                   E22794
     C           BPKY      KLIST                                          E22794
     C                     KFLD           BHSC                            E22794
     C************         KFLD           BHBR                      E22794S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK                            E22794
     C                     KFLD           BHMK                            E22794
     C                     KFLD           BHTV                            E22794
     C                     KFLD           LPSD                            E22794
     C*                                                                   E22794
     C* Key to access Security Limits records                             E22794
     C*                                                                   E22794
     C           SLKY      KLIST                                          E22794
     C                     KFLD           SESN                            E22794
     C***********                                                  E16305 E20085
     C**Key*to*access*SECEO*records******************************* E16305 E20085
     C***********                                                  E16305 E20085
     C***********SECKEY    KLIST                                   E16305 E20085
     C***********          KFLD           SESN                     E16305 E20085
     C***********          KFLD           KSDET                    E16305 E20085
     C*
     C* Key to access SECEO records                                       CSE005
     C*                                                                   CSE005
     C           *LIKE     DEFN SNET      KSDET                           CSE005
     C           SECKEY    KLIST                                          CSE005
     C                     KFLD           SESN                            CSE005
     C                     KFLD           KSDET                           CSE005
     C                     MOVE 'CP'      KSDET                           CSE005
     C*                                                                   CSE005
     C* Prepare LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBLOT
     C                     MOVEL'SE0040'  DBPGM
     C                     OUT  LDA                                       S01117
     C***********                                                  E16305 E20085
     C**Set*up*key*fields*for*SECEO******************************* E16305 E20085
     C***********                                                  E16305 E20085
     C************LIKE     DEFN SDET      KSDET                    E16305 E20085
     C***********          MOVE 'CP'      KSDET                    E16305 E20085
     C*
     C* Prepare COMIT text
     C*
     C                     MOVEL'SE'      MDID
     C                     MOVEL'SE0040'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
      *
      ***  Initialise Work fields
      *
     C           *LIKE     DEFN ZDAYNO    MATDNO
     C           *LIKE     DEFN ZDAYNO    ITLDNO
     C************LIKE     DEFN ZDAYNO    FCPND                           E20085
     C           *LIKE     DEFN ZDAYNO    HDAYNO
     C           *LIKE     DEFN ZDAYNO    LDAYNO
     C           *LIKE     DEFN SINP      INITPR
     C           *LIKE     DEFN SFPP      FYPDPR
     C           *LIKE     DEFN SISSR     XISSR                           S01176
     C           *LIKE     DEFN SINCS     XINCS                           S01176
     C           *LIKE     DEFN SSITP     XSITP                           S01176
     C           *LIKE     DEFN SQLTY     XQLTY                           S01176
     C           *LIKE     DEFN SMKTI     XMKTI                           S01176
     C           *LIKE     DEFN SSDNM     XSDNM                           S01176
     C           *LIKE     DEFN SERPY     XERPY                           S01176
     C           *LIKE     DEFN SVDFT     XVDFT                           S01176
     C           *LIKE     DEFN SEDFT     XEDFT                           S01176
     C           *LIKE     DEFN SNMCY     XNMCY                           S01176
     C           *LIKE     DEFN SVLCY     XVLCY                           S01176
     C           *LIKE     DEFN SSSEC     XSSEC                           S01176
     C           *LIKE     DEFN SMLTI     XMLTI                           S01176
     C           *LIKE     DEFN SSIDY     XSIDY                           S01176
     C           *LIKE     DEFN SSCOR     XSCOR                           S01176
     C           *LIKE     DEFN SSRET     XSRET                           S01176
     C           *LIKE     DEFN SISIN     XISIN                           S01401
     C           *LIKE     DEFN SSWTP     XSWTP                           S01401
     C           *LIKE     DEFN INCS      OINCS                           106056
     C                     MOVE *BLANKS   OINCS                           106056
     C           *LIKE     DEFN SNMDP     XNMDP                           CEU018
     C           *LIKE     DEFN SSSPID    XSPID                           CAP060
     C           *LIKE     DEFN SCSPDS    XSPDS                           CSD006
     C           *LIKE     DEFN SVLCY     LVLCY                           CSE007
     C           *LIKE     DEFN SICCD     XICCD                           CPL002
     C           *LIKE     DEFN SDINM     XDINM                           CPL002
     C           *LIKE     DEFN SRGCD     XRGCD                           CPL002
     C           *LIKE     DEFN SPGCD     XPGCD                           CPL002
     C           *LIKE     DEFN SSETX     XSETX                                               CGL031
     C/COPY WNCPYSRC,SE0040C030
     C                     MOVE *BLANKS   XISSR                           S01176
     C                     MOVE *BLANKS   XINCS                           S01176
     C                     MOVE *BLANKS   XSITP                           S01176
     C                     MOVE *BLANKS   XQLTY                           S01176
     C                     MOVE *BLANKS   XMKTI                           S01176
     C                     MOVE *BLANKS   XSDNM                           S01176
     C                     MOVE *BLANKS   XERPY                           S01176
     C                     MOVE *BLANKS   XVDFT                           S01176
     C                     MOVE *BLANKS   XEDFT                           S01176
     C                     MOVE *BLANKS   XNMCY                           S01176
     C                     MOVE *BLANKS   XVLCY                           S01176
     C                     MOVE *BLANKS   XSSEC                           S01176
     C                     MOVE *BLANKS   XMLTI                           S01176
     C                     MOVE *BLANKS   XSIDY                           S01176
     C                     MOVE *BLANKS   XSCOR                           S01176
     C                     MOVE *BLANKS   XSRET                           S01176
     C                     MOVE *BLANKS   XISIN                           S01401
     C                     MOVE *BLANKS   XSWTP                           S01401
     C                     MOVE *BLANKS   XNMDP                           CEU018
     C                     MOVE *BLANKS   XSPID                           CSD006
     C                     MOVE *BLANKS   XSPDS                           CSD006
     C                     CLEARXICCD                                     CPL002
     C                     CLEARXDINM                                     CPL002
     C                     CLEARXRGCD                                     CPL002
     C                     CLEARXPGCD                                     CPL002
     C*
     C*  Fields used to store screen contents before defaults are set     S01186
     C*  up in DFTITL (if any changes in fields at end of DFTITL screen   S01186
     C*  1 will be redisplayed)                                           S01186
     C*                                                                   S01186
     C           *LIKE     DEFN SQLTY     YQLTY                           S01186
     C           *LIKE     DEFN SMKTI     YMKTI                           S01186
     C           *LIKE     DEFN SSDNM     YSDNM                           S01186
     C           *LIKE     DEFN SVDFT     YVDFT                           S01186
     C           *LIKE     DEFN SEDFT     YEDFT                           S01186
     C           *LIKE     DEFN SVLCY     YVLCY                           S01186
     C           *LIKE     DEFN SSSEC     YSSEC                           S01186
     C           *LIKE     DEFN SMLTI     YMLTI                           S01186
     C           *LIKE     DEFN SSIDY     YSIDY                           S01186
     C           *LIKE     DEFN SSCOR     YSCOR                           S01186
     C           *LIKE     DEFN SSSPID    WKSPID                          CAP060
     C           *LIKE     DEFN SCSPDS    WKSPDS                          CSD006
     C/COPY WNCPYSRC,SE0040C056
      *                                                                   CSE007
      *  Input parameters: Action Code & Security Shortname               CSE007
      *  Output parameters: Return Code                                   CSE007
      *                                                                   CSE007
     C           *ENTRY    PLIST                                          CSE007
     C                     PARM           WWRTRN  7                       CSE007
     C                     PARM           ACTCDE  1                       CSE007
     C                     PARM           SESNRF 10                       CSE007
     C                     PARM           OLDSEC 10                       CSE007
     C                     PARM           OTHINF156                       138957
      ** If program called with parameters WWPARA = 'Y'                   CSE007
     C                     MOVE 'N'       WWPARA  1                       CSE007
     C                     MOVE *BLANKS   WWRTRN                          CSE007
     C*                                                                   S01117
     C**Get*Installation*Control*Data*record*1****************************S01117
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C**If*error*in*ZSYSTM,*terminate*program.****************************S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '01'      DBASE            ***************S01117
     C***********          MOVEL'TABLE'   DBFILE           * DB ERROR 01 *S01117
     C***********          MOVELZTABKY    DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C** IN THE DATAAREA ZMUSER                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C*                                                                   S01117
     C**Get*Installation*Control*Data*record*2*************************   S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C***********                                                         S01117
     C**If*error*in*ZICD2,*terminate*program.*******************          S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '02'      DBASE            ***************S01117
     C***********          MOVEL'TABLE'   DBFILE           * DB ERROR 02 *S01117
     C***********          MOVELZTABKY    DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01117
     C**                                                                  S01117
     C           DATF      COMP 'M'                      98               S01117
     C**********                                                          S01117
     C**Get*Installation Control Data record for Securities Trading.      S01117
     C**********                                                          S01117
     C**********           EXSR ZICDSE                                    S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C**********                                                          S01117
     C**If*error*in*ZICDSE,*terminate*program.*************************   S01117
     C**********                                                          S01117
     C********** *IN99     IFEQ '1'                                       S01117
     C***********          MOVE '03'      DBASE                           E2 651
     C***********          MOVE '11'      DBASE            *********E20651S01117
     C***********          MOVEL'TABLE'   DBFILE           * DB ERROR 11 *S01117
     C***********          MOVELZTABKY    DBKEY            ***************S01117
     C***********          SETON                     U7U801               S01117
     C***********          END
     C*
     C** Access SDMMODPD to determine if Strategic Risk Man. Ind is on    S01220
     C*                                                                   S01220
     C                     CALL 'AOMMODR0'                                S01120
     C                     PARM '*DBERR ' @RTCD   7                       S01120
     C                     PARM '*FIRST ' @OPTN   7                       S01120
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01120
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP26                                           S01408
     C*                                                                   S01408
     C*                                                                   S01220
     C                     END
     C/COPY WNCPYSRC,SE0040C079
      *                                                                   S01401
      **  Access SAR details file to see if MT5xx Feature is installed.   S01401
      *                                                                   S01401
     C                     CALL 'AOSARDR0'                                S01401
     C                     PARM '       ' @RTCD                           S01401
     C                     PARM '*VERIFY' @OPTN                           S01401
     C                     PARM 'S01401'  WSARD   6                       S01401
      *                                                                   S01401
     C           @RTCD     IFEQ *BLANK                                    S01401
     C                     MOVE 'Y'       S01401  1                       S01401
     C                     END                                            S01401
     C/COPY WNCPYSRC,SE0040C038
      *                                                                   CSE007
      **  Access SAR details file to see if CSE007 Feature is installed.  CSE007
      *                                                                   CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM '       ' @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  WSARD   6                       CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANK                                    CSE007
     C                     MOVE 'Y'       CSE007  1                       CSE007
     C*                                                                   140759
     C*** Default Flag for Corporate Actions correctly.                   140759
     C*                                                                   140759
     C************         END                                     CSE007 140759
     C                     ELSE                                           140759
     C                     MOVE 'N'       CSE007                          140759
     C                     ENDIF                                          140759
      *                                                                   CEU017
      **  Access SAR details file to see if CEU017 Feature is installed.  CEU017
      *                                                                   CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM '       ' @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  WSARD   6                       CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANK                                    CEU017
     C                     MOVE 'Y'       CEU017  1                       CEU017
     C*                                                                   140759
     C*** Default flag for Securities Redenomination correctly.           140759
     C*                                                                   140759
     C*************        END                                     CEU017 140759
     C                     ELSE                                           140759
     C                     MOVE 'N'       CEU017                          140759
     C                     ENDIF                                          140759
     C*                                                                   S01511
     C**  Access SAR details file to see if S01511 is installed           S01511
     C*                                                                   S01511
     C                     CALL 'AOSARDR0'                                S01511
     C                     PARM '       ' @RTCD                           S01511
     C                     PARM '*VERIFY' @OPTN                           S01511
     C                     PARM 'S01511'  WSARD   6                       S01511
      *                                                                   S01511
     C           @RTCD     IFEQ *BLANK                                    S01511
     C                     MOVE 'Y'       S01511  1                       S01511
     C                     ELSE                                           S01511
     C                     MOVE 'N'       S01511                          S01511
     C                     END                                            S01511
     C*                                                                   CSE005
     C**  Access SAR details file to see if CSE005 is installed           CSE005
     C*                                                                   CSE005
     C                     CALL 'AOSARDR0'                                CSE005
     C                     PARM '       ' @RTCD                           CSE005
     C                     PARM '*VERIFY' @OPTN                           CSE005
     C                     PARM 'CSE005'  WSARD   6                       CSE005
     C*                                                                   CSE005
     C           @RTCD     IFEQ *BLANK                                    CSE005
     C                     MOVE 'Y'       CSE005  1                       CSE005
     C                     ELSE                                           CSE005
     C                     MOVE 'N'       CSE005                          CSE005
     C                     ENDIF                                          CSE005
     C/COPY WNCPYSRC,SE0040C140
     C*                                                                   CSE005
     C**  Access SAR details file to see if CEU018 is installed           CEU018
     C*                                                                   CEU018
     C                     CALL 'AOSARDR0'                                CEU018
     C                     PARM '       ' @RTCD                           CEU018
     C                     PARM '*VERIFY' @OPTN                           CEU018
     C                     PARM 'CEU018'  WSARD   6                       CEU018
     C*                                                                   CEU018
     C           @RTCD     IFEQ *BLANK                                    CEU018
     C                     MOVE 'Y'       CEU018  1                       CEU018
     C                     MOVE *ON       *IN84                           CEU018
     C                     ELSE                                           CEU018
     C                     MOVE 'N'       CEU018                          CEU018
     C                     ENDIF                                          CEU018
     C*                                                                   CEU018
      *                                                                   CSE011
      ** Access Switchable Feature Details, Check if CSE011 is            CSE011
      ** switch on and open necessary files.                              CSE011
      *                                                                   CSE011
     C                     CALL 'AOSARDR0'                                CSE011
     C                     PARM *BLANKS   PRTCD   7                       CSE011
     C                     PARM '*VERIFY 'POPTN   7                       CSE011
     C                     PARM 'CSE011'  PSARD   6                       CSE011
     C           SCSARD    PARM SCSARD    DSSDY                           CSE011
      *                                                                   CSE011
     C           PRTCD     IFNE *BLANKS                                   CSE011
     C           PRTCD     ANDNE'*NRF '                                   CSE011
     C                     MOVEL'008'     DBASE            ***************CSE011
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 008*CSE011
     C                     MOVELPSARD     DBKEY            ***************CSE011
     C                     SETON                     U7U8LR               CSE011
     C                     EXSR *PSSR                                     CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           PRTCD     IFEQ *BLANKS                                   CSE011
     C                     MOVE 'Y'       CSE011  1                       CSE011
     C                     ELSE                                           CSE011
     C                     MOVE 'N'       CSE011                          CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           CSE011    IFEQ 'Y'                                       CSE011
     C           SECT2#    IFNE '1'                                       180413
     C                     OPEN SECTYL2                                   CSE011
     C                     ENDIF                                          180413
     C           SECT1#    IFNE '1'                                       180413
     C                     OPEN SECTYL1                                   CSE011
     C                     ENDIF                                          180413
     C           SECT0#    IFNE '1'                                       180413
     C                     OPEN SECTYL0                                   CSE011
     C                     ENDIF                                          180413
     C           SECT3#    IFNE '1'                                       180413
     C                     OPEN SECTYL3                                   CSE011
     C                     ENDIF                                          180413
     C           SEC#      IFNE '1'                                       180413
     C                     OPEN SECTE                                     CSE011
     C                     ENDIF                                          180413
     C           SEC2#     IFNE '1'                                       180413
     C                     OPEN SECT2                                     CSE011
     C                     ENDIF                                          180413
     C           SEC3#     IFNE '1'                                       180413
     C                     OPEN SECT3                                     CSE011
     C                     ENDIF                                          180413
     C                     ENDIF                                          CSE011
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE0040C008
      *                                                                   S01401
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C/COPY WNCPYSRC,SE0040C152
      *                                                                   CSE007
      ** Access Bank details to retrieve Next working day                 CSE007
     C                     CALL 'AOBANKR0'                                CSE007
     C                     PARM '*DBERR ' @RTCD                           CSE007
     C                     PARM '*FIRST ' @OPTN                           CSE007
     C           SDBANK    PARM SDBANK    DSSDY                           CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE032
      **  Determine if feature CSE032 is installed.                       CSE032
      *                                                                   CSE032
     C                     MOVE 'N'       CSE032  1                       CSE032
     C                     CALL 'AOSARDR0'                                CSE032
     C                     PARM '       ' @RTCD                           CSE032
     C                     PARM '*VERIFY' @OPTN                           CSE032
     C                     PARM 'CSE032'  WSARD                           CSE032
      *                                                                   CSE032
     C           @RTCD     IFEQ *BLANK                                    CSE032
     C                     MOVE 'Y'       CSE032                          CSE032
     C                     END                                            CSE032
     C*
      *                                                                   CSD006
      ** Access Switchable Feature Details, Check if CSD006 is ON         CSD006
      *                                                                   CSD006
     C                     CALL 'AOSARDR0'                                CSD006
     C                     PARM *BLANKS   PRTCD   7                       CSD006
     C                     PARM '*VERIFY 'POPTN   7                       CSD006
     C                     PARM 'CSD006'  PSARD   6                       CSD006
     C           SCSARD    PARM SCSARD    DSSDY                           CSD006
      *                                                                   CSD006
     C           PRTCD     IFNE *BLANKS                                   CSD006
     C           PRTCD     ANDNE'*NRF '                                   CSD006
     C                     MOVEL'009'     DBASE            ***************CSD006
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 009*CSD006
     C                     MOVELPSARD     DBKEY            ***************CSD006
     C                     SETON                     U7U8LR               CSD006
     C                     EXSR *PSSR                                     CSD006
     C                     ENDIF                                          CSD006
      *                                                                   CSD006
     C           PRTCD     IFEQ *BLANKS                                   CSD006
     C                     MOVE 'Y'       CSD006  1                       CSD006
     C                     MOVE *ON       WKIN91  1                       CSD006
     C                     ELSE                                           CSD006
     C                     MOVE 'N'       CSD006                          CSD006
     C                     MOVE *OFF      WKIN91                          CSD006
     C                     ENDIF                                          CSD006
      *                                                                   CSD006
      *                                                                   CSD006
      ** Access Switchable Feature Details, Check if CAP060 is ON         CSD006
      *                                                                   CSD006
     C                     CALL 'AOSARDR0'                                CSD006
     C                     PARM *BLANKS   PRTCD   7                       CSD006
     C                     PARM '*VERIFY 'POPTN   7                       CSD006
     C                     PARM 'CAP060'  PSARD   6                       CSD006
     C           SCSARD    PARM SCSARD    DSSDY                           CSD006
      *                                                                   CSD006
     C           PRTCD     IFNE *BLANKS                                   CSD006
     C           PRTCD     ANDNE'*NRF '                                   CSD006
     C                     MOVEL'010'     DBASE            ***************CSD006
     C                     MOVEL'SCSARDPD'DBFILE           **DB ERROR 010*CSD006
     C                     MOVELPSARD     DBKEY            ***************CSD006
     C                     SETON                     U7U8LR               CSD006
     C                     EXSR *PSSR                                     CSD006
     C                     ENDIF                                          CSD006
      *                                                                   CSD006
     C           PRTCD     IFEQ *BLANKS                                   CSD006
     C                     MOVE 'Y'       CAP060  1                       CSD006
     C                     MOVE *ON       WKIN75  1                       CSD006
     C                     ELSE                                           CSD006
     C                     MOVE 'N'       CAP060                          CSD006
     C                     MOVE *OFF      WKIN75                          CSD006
     C                     ENDIF                                          CSD006
      *                                                                   CSD006
      ** Access SAR details file to see if CSE023 feature is installed.                       202333
      *                                                                                       202333
     C                     CALL 'AOSARDR0'                                                    202333
     C                     PARM '       ' @RTCD                                               202333
     C                     PARM '*VERIFY' @OPTN                                               202333
     C                     PARM 'CSE023'  WSARD   6                                           202333
      *                                                                                       202333
     C           @RTCD     IFEQ *BLANK                                                        202333
     C                     MOVE 'Y'       CSE023  1                                           202333
     C                     ELSE                                                               202333
     C                     MOVE 'N'       CSE023                                              202333
     C                     END                                                                202333
      *                                                                                       202333
      ** Access Switchable Feature Details, Check if CAS006 is ON                             CAS006
      *                                                                                       CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   PRTCD                                               CAS006
     C                     PARM '*VERIFY 'POPTN                                               CAS006
     C                     PARM 'CAS006'  PSARD                                               CAS006
     C           SCSARD    PARM SCSARD    DSSDY                                               CAS006
      *                                                                                       CAS006
     C           PRTCD     IFNE *BLANKS                                                       CAS006
     C           PRTCD     ANDNE'*NRF '                                                       CAS006
     C                     IN   LDA                                                           CAS006
     C                     MOVEL'021'     DBASE                                               CAS006
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS006
     C                     MOVELPSARD     DBKEY                                               CAS006
     C                     OUT  LDA                                                           CAS006
     C                     MOVE '1'       *INU7                                               CAS006
     C                     MOVE '1'       *INU8                                               CAS006
     C                     MOVE '1'       *INLR                                               CAS006
     C                     EXSR *PSSR                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           PRTCD     IFEQ *BLANKS                                                       CAS006
     C                     MOVE 'Y'       CAS006  1                                           CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'N'       CAS006                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Access SAR details file to see if CGL031 feature is installed.                       CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM '       ' PRTCD                                               CGL031
     C                     PARM '*VERIFY' POPTN                                               CGL031
     C                     PARM 'CGL031'  PSARD                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANK                                                        CGL031
     C                     MOVE 'Y'       CGL031  1                                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'N'       CGL031                                              CGL031
     C                     END                                                                CGL031
      *                                                                                       CGL031
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
     C* Display and process screens until F3 pressed
     C*
     C************IN01     DOWEQ'0'                                       102342
     C           *INKC     DOWEQ'0'                                       102342
     C           *INU8     ANDEQ'0'
     C*
     C/COPY WNCPYSRC,SE0040C011
     C************IN05     ANDEQ'0'                                 CSE007102342
     C           *INKE     ANDEQ'0'                                       102342
     C           WWPARA    ANDEQ'N'                                       CSE007
     C************IN01     OREQ '0'                                 CSE007102342
     C           *INKC     OREQ '0'                                       102342
     C           *INU8     ANDEQ'0'                                       CSE007
     C************IN05     ANDEQ'1'                                 CSE007102342
     C           *INKE     ANDEQ'1'                                       102342
     C*
     C* F5 - Initial screen (blank) requested
     C*
     C************IN05     IFEQ '1'                                       102342
     C           *INKE     IFEQ '1'                                       102342
     C*
     C* Setof error indicators and clear error codes
      ** SET OFF INDICATORS 36,37,41,42,43,44,45,46,47,50,51,52,53,54,    S01401
      ** 55,56,57,58,59,60,61,62,63,64,65,66,67,68                        S01401
     C*
     C                     SETOF                     09
     C                     MOVEA'00'      *IN,36                          S01176
     C                     MOVEA'0000000' *IN,41
     C                     MOVEA'00'      *IN,42                          S01220
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'00000000'*IN,58
     C                     MOVEA'000'     *IN,66
     C                     MOVEA'0'       *IN,74                          183604
     C/COPY WNCPYSRC,SE0040C040
     C                     MOVE *BLANKS   ERRMSG
     C                     END
     C*
     C**N02******          SETOF                     030508               102342
     C  NKL                SETOF                     0308                 102342
     C*
     C* Initialise day number fields
     C*
     C                     Z-ADD*ZEROS    MATDNO
     C                     Z-ADD*ZEROS    ITLDNO
     C***********          Z-ADD*ZEROS    FCPND                           E20085
     C                     Z-ADD*ZEROS    HDAYNO
     C                     Z-ADD*ZEROS    LDAYNO
     C                     Z-ADD*ZEROS    STNLU   50
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CCP2                                           S01408
     C*                                                                   S01408
     C*
     C* Display initial screen
     C*
     C                     EXSR INITL
      *
     C**  Save screen 1 details when F5 pressed after AMEND or ENQUIRY    S01186
     C*                                                                   S01186
     C************IN05     IFEQ '1'                                S01186 102342
     C           *INKE     IFEQ '1'                                       102342
     C           SACTN     IFEQ 'A'                                       S01186
     C           SACTN     OREQ 'E'                                       S01186
     C*                                                                   S01186
     C                     EXSR SAVSEC                                    S01186
     C                     END                                            S01186
     C                     END                                            S01186
     C*
     C* Display second screen (Not if F3 or F5 pressed, or in
     C* 'DELETE' mode)
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CCP3                                           S01408
     C*                                                                   S01408
     C************IN01     IFEQ '0'                                       102342
     C************IN05     ANDEQ'0'                                       102342
     C           *INKC     IFEQ '0'                                       102342
     C           *INKE     ANDEQ'0'                                       102342
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'I'
     C           SACTN     OREQ 'E'
     C/COPY WNCPYSRC,SE0040C130
     C*                                                                   S01176
     C                     EXSR SECOND
     C/COPY WNCPYSRC,SE0040C131
     C**                                                                  S01176
     C* Save selected Security Details for carry over request             S01176
     C**                                                                  S01176
     C                     EXSR SAVSEC                                    S01176
     C                     END
     C*
     C* Display third screen (If new issue, but not if F3 or F5 pressed)
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CCP4                                           S01408
     C*                                                                   S01408
     C************IN01     IFEQ '0'                                       102342
     C************IN05     ANDEQ'0'                                       102342
     C           *INKC     IFEQ '0'                                       102342
     C           *INKE     ANDEQ'0'                                       102342
     C           SACTN     IFEQ 'A'
     C           SACTN     OREQ 'I'
     C           SACTN     OREQ 'E'
      *
     C           NEWISS    IFEQ 'Y'
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0040C005
      *                                                                   075592
      ** Move old value back into *IN34                                   075592
     C                     MOVE IN34      *IN34                           075592
     C/COPY WNCPYSRC,SE0040C132
      *                                                                   075592
     C                     EXSR THIRD
     C/COPY WNCPYSRC,SE0040C133
      *                                                                   075592
      ** Re-initialise *IN34 to make Issued amount field input capable    075592
     C                     MOVE *IN34     IN34    1                       075592
     C                     SETOF                     34                   075592
      *                                                                   075592
     C                     ELSE
     C           SACTN     IFEQ 'E'
     C           *IN07     ANDEQ'1'
     C                     EXSR THIRD
     C                     END
     C                     END
      *
     C                     END
     C                     END
      *                                                                   CSE023
      ** Call Window Processing                                           CSE023
      *                                                                   CSE023
      *                                                                                       202333
     C           CSE023    IFEQ 'Y'                                                           202333
      *                                                                                       202333
     C           *IN01     IFEQ *OFF                                      CSE023
     C           *IN05     ANDEQ*OFF                                      CSE023
      *                                                                   CSE023
     C           SACTN     IFEQ 'A'                                       CSE023
     C           SACTN     OREQ 'E'                                       CSE023
     C           SACTN     OREQ 'I'                                       CSE023
     C                     EXSR SRWND                                     CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
     C*                                                                   S01408
     C                     ENDIF                                                              202333
      *                                                                                       202333
     C/COPY WNCPYSRC,SE0040CCP5                                           S01408
     C*                                                                   S01408
     C*
     C* Update files (Not if F3 or F5 pressed)
     C*
     C************IN01     IFEQ '0'                                       102342
     C************IN05     ANDEQ'0'                                       102342
     C           *INKC     IFEQ '0'                                       102342
     C           *INKE     ANDEQ'0'                                       102342
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           SACTN     OREQ 'D'
     C/COPY WNCPYSRC,SE0040C012                                           S01408
     C                     EXSR UPDFLS
     C*COPY*WNCPYSRC*SE0040C012****************************************   S01408
     C/COPY WNCPYSRC,SE0040C013                                           S01408
     C                     MOVE *BLANKS   ERR                             E19740
     C*COPY*WNCPYSRC*SE0040C013****************************************   S01408
     C/COPY WNCPYSRC,SE0040CP28                                           S01408
     C                     SETOF                     09                   E19740
     C                     END
      *                                                                   081405
     C                     ELSE                                           081405
      * If CK3 (end) or CK5 (restart) rollback updates from window program081405
     C           SACTN     IFNE 'E'                                       137883
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                          081405
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                          137883
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CCP6                                           S01408
     C*                                                                   S01408
     C*
     C                     END
     C/COPY WNCPYSRC,SE0040C057
      * If F3 key is pressed return 'Y2U9999'                             CSE007
     C************IN01     IFEQ '1'                                 CSE007102342
     C           *INKC     IFEQ '1'                                       102342
     C                     MOVEL'Y2U9999' WWRTRN                          CSE007
     C                     END                                            CSE007
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CCP9                                           S01408
     C*                                                                   S01408
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C           OLDSEC    IFEQ *BLANKS                                   CSE007
     C                     SETON                     LR
     C                     ELSE                                           CSE007
     C                     MOVE '0'       *IN                             CSE007
     C                     ENDIF                                          CSE007
     C                     RETRN
      *                                                               *
      *================================================================
      /EJECT
     C/COPY WNCPYSRC,SE0040C134
      *****************************************************************
      *                                                               *
      *  INITL  - Subroutine to process the Initial Screen.           *
      *                                                               *
      *****************************************************************
      *
     C           INITL     BEGSR                           *** INITL  ***
      *
      ***  Initialise Indicators
      *
     C                     MOVE '0'       *IN,14                                              192054
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'00000000'*IN,58
     C                     MOVEA'000'     *IN,66
     C                     MOVEA'0'       *IN,74                          183604
     C                     MOVE *OFF      *IN70                           CPL002
      *                                                                   CEU018
     C                     MOVE *OFF      *IN83                           CEU018
     C                     MOVE *OFF      *IN85                           CEU018
     C                     MOVE *OFF      *IN86                           CEU018
     C                     MOVE *OFF      WKIN92  1                       CSD006
      *                                                                                       CSC022
      ** Check if CSC022 is switched ON.                                                      CSC022
      *                                                                                       CSC022
     C                     CALL 'AOSARDR0'                                                    CSC022
     C                     PARM *BLANKS   @RTCD                                               CSC022
     C                     PARM '*VERIFY' @OPTN                                               CSC022
     C                     PARM 'CSC022'  @SARD   6                                           CSC022
     C           SCSARD    PARM SCSARD    DSFDY                                               CSC022
      *                                                                                       CSC022
     C           @RTCD     IFEQ *BLANKS                                                       CSC022
     C                     MOVE 'Y'       CSC022  1                                           CSC022
     C           *NAMVAR   DEFN SCCMTJOB  SCCMT                                               CSC022
     C                     IN   SCCMT                                                         CSC022
     C                     Z-ADD1         C       30                                          CSC022
     C                     MOVEL'N'       CMTSKP  1                                           CSC022
     C                     MOVEACMTARR    CMTJOB                                              CSC022
     C           CMTNUM    IFGT 0                                                             CSC022
     C           C         DOWLECMTNUM                                                        CSC022
     C           ##JOB     IFEQ CMTJOB,C                                                      CSC022
     C                     MOVEL'Y'       CMTSKP                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ADD  1         C                                                   CSC022
     C                     ENDDO                                                              CSC022
     C                     ENDIF                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     MOVE 'N'       CSC022                                              CSC022
     C           @RTCD     IFNE '*NRF '                                                       CSC022
     C           *LOCK     IN   LDA                                                           CSC022
     C                     SETON                       U7U8                                   CSC022
     C                     Z-ADD5         DBASE                                               CSC022
     C                     MOVEL'SCSARDPD'DBFILE                                              CSC022
     C                     MOVEL'CSC022'  DBKEY                                               CSC022
     C                     OUT  LDA                                                           CSC022
     C                     EXSR *PSSR                                                         CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *                                                                   CSE011
      ** Feature CSE011 is installed.                                     CSE011
      *                                                                   CSE011
     C           CSE011    IFEQ 'Y'                                       CSE011
     C                     MOVE *BLANK    WST2RF 12                       CSE011
     C                     MOVE *BLANK    WSCSPN  9                       CSE011
     C                     MOVE *BLANK    WSISIN 12                       CSE011
     C                     MOVE *BLANK    WSSREF  7                       CSE011
     C                     ENDIF                                          CSE011
     C/COPY WNCPYSRC,SE0040C041
      *                                                                   S01401
      **  If MT5xx Feature is installed then SISIN and SSWTP are to be    S01401
      **  displayed.                                                      S01401
      *                                                                   S01401
     C                     SETOF                     40                   S01401
     C/COPY WNCPYSRC,SE0040C101
     C           S01401    IFEQ 'Y'                                       S01401
     C                     SETON                     40                   S01401
     C                     END                                            S01401
      *                                                                                       192054
      **  If Private Banking module is on, SISIN is to be displayed                           192054
      *                                                                                       192054
     C           BGN4ST    IFEQ 'Y'                                                           192054
     C                     SETON                     14                                       192054
     C                     ENDIF                                                              192054
      *                                                                   CEU018
     C/COPY WNCPYSRC,SE0040C102
      **  If CEU018 Feature is installed then SNMDP is to be displayed.   CEU018
     C           CEU018    IFEQ 'Y'                                       CEU018
     C                     MOVE *ON       *IN84                           CEU018
     C                     ELSE                                           CEU018
     C                     MOVE *OFF      *IN84                           CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CPL002
      ** Is Midas-Plato Interface installed?                              CPL002
      *                                                                   CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C                     MOVE *ON       *IN70                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                                       CGL031
      ** If CGL031 is present show European Tax Indicator                                     CGL031
      ** save values of *IN87 and *IN88 to reuse these indicators                             CGL031
      *                                                                                       CGL031
     C                     MOVE *IN87     WIN87   1                                           CGL031
     C                     MOVE *IN88     WIN88   1                                           CGL031
     C                     MOVE *OFF      *IN88                                               CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     MOVE *ON       *IN87                                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE *OFF      *IN87                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C*
     C* Display initial screen (blank)
     C*
     C************IN02     IFEQ '0'                                       102342
     C           *INKL     IFEQ '0'                                       102342
     C           *IN08     ANDEQ'0'
     C                     MOVE *BLANKS   SCRFM1
      *                                                                   S01401
      **  Blank out SISIN and SSWTP if MT5xx Feature is present.          S01401
      *                                                                   S01401
     C/COPY WNCPYSRC,SE0040C103
     C           S01401    IFEQ 'Y'                                       S01401
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     CLEARSISIN                                     S01401
     C                     CLEARSSWTP                                     S01401
     C                     END                                            S01401
      *                                                                   CPL002
      ** Is Midas-Plato Interface installed?                              CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
      ** Yes, clear out fields                                            CPL002
     C                     CLEARSICCD                                     CPL002
     C                     CLEARSDINM                                     CPL002
     C                     CLEARSRGCD                                     CPL002
     C                     CLEARSPGCD                                     CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CEU018
     C/COPY WNCPYSRC,SE0040C104
      **  Blank out SNMDP if CEU018 Feature is present.                   CEU018
     C           CEU018    IFEQ 'Y'                                       CEU018
     C                     MOVE *BLANK    SNMDP                           CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     MOVE *BLANKS   SSETX                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE ' '       NEWISS
     C/COPY WNCPYSRC,SE0040C117
     C                     MOVE ' '       TBSOVR
     C***********          SETOF                     6948                 S01186
     C***********          SETOF                     4243           E13662S01169
     C                     SETOF                     694847               S01186
     C                     SETOF                     010205               102342
     C                     MOVEA'00000'   *IN,41                          S01169
     C*
     C                     ELSE
     C*
     C* F12 pressed - Re-display existing data
     C*
     C           SACTN     COMP 'I'                  6969
     C   69                EXSR ITLDTA
     C  N69                SETOF                     414445               S01158
     C/COPY WNCPYSRC,SE0040C080
     C*
     C           SACTN     COMP 'E'                      47
     C*
     C                     END
     C/COPY WNCPYSRC,SE0040C058
      *                                                                   CSE007
     C           ACTCDE    IFNE *BLANKS                                   CSE007
     C                     MOVE 'Y'       WWPARA  1                       CSE007
     C                     MOVE ACTCDE    SACTN                           CSE007
     C           ACTCDE    IFEQ 'I'                                       CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           OLDSEC    ANDNE*BLANKS                                   CSE007
     C                     MOVELSESNRF    SSESN                           CSE007
     C                     ELSE                                           CSE007
     C                     MOVE *BLANKS   SSESN                           CSE007
     C                     ENDIF                                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVELSESNRF    SSESN                           CSE007
     C                     END                                            CSE007
     C                     END                                            CSE007
      *                                                                   CSE007
      ** Not display the initial screen if program called with parameters CSE007
      ** or Insert Mode                                                   CSE007
      *                                                                   CSE007
     C           WWPARA    IFEQ 'Y'                                       CSE007
     C************IN02     ANDEQ'0'                                 CSE007102342
     C           *INKL     ANDEQ'0'                                       102342
     C           *IN08     ANDEQ'0'                                       CSE007
     C           *IN17     ANDEQ'0'                                       CSE007
     C                     GOTO ZITAG2                                    CSE007
     C                     END                                            CSE007
     C*
     C* Display initial screen
     C*
     C           ZITAG1    TAG                             ** ZITAG1 TAG *
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP10                                           S01408
     C*                                                                   S01408
     C                     MOVE *IN93     IN93    1                       155622
     C                     MOVE *IN99     IN99    1                       CSE007
     C                     MOVE WKIN75    *IN75                           CSD006
     C                     MOVE WKIN91    *IN91                           CSD006
     C                     MOVE WKIN92    *IN92                           CSD006
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     MOVE *ON       *IN99                           CSE007
     C           ACTCDE    IFNE *BLANKS                                   155622
     C           SESNRF    ORNE *BLANKS                                   155622
     C           OLDSEC    ORNE *BLANKS                                   155622
     C                     MOVE *ON       *IN93                           155622
     C                     ELSE                                           155622
     C                     MOVE *OFF      *IN93                           155622
     C                     ENDIF                                          155622
     C                     ELSE                                           CSE007
     C                     MOVE *OFF      *IN93                           155622
     C                     MOVE *OFF      *IN99                           CSE007
     C                     ENDIF                                          CSE007
     C                     EXFMTSE0040F1
     C*
     C**HELP*key*pressed***call*standard*HELP*program******************   S01199
     C***********                                                         S01199
     C************IN06     DOWEQ'1'                                       S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           DBPGM                           S01199
     C***********          PARM           ERRMSG                          S01199
     C***********                                                         S01199
     C***********          READ SE0040F1                 33               S01199
     C***********          END                                            S01199
     C*
     C* Setof error indicators
     C*
      *                                                                   CSE011
      ** Feature CSE011 is installed.                                     CSE011
      *                                                                   CSE011
     C           CSE011    IFEQ 'Y'                                       CSE011
     C                     MOVE '0'       *IN71                           CSE011
     C                     MOVE '0'       *IN72                           CSE011
     C                     MOVE '0'       *IN73                           CSE011
     C                     ENDIF                                          CSE011
     C/COPY WNCPYSRC,SE0040C014                                           S01408
     C           ZITAG2    TAG                             ** ZITAG2 TAG *CSE007
     C                     MOVE IN93      *IN93                           155622
     C                     MOVE IN99      *IN99                           CSE007
     C***********          SETOF                     0902                 102342
     C                     SETOF                     09                   102342
     C*COPY*WNCPYSRC*SE0040C014****************************************   S01408
     C/COPY WNCPYSRC,SE0040C015                                           S01408
     C                     Z-ADD*ZEROS    EC
     C*COPY*WNCPYSRC*SE0040C015****************************************   S01408
     C/COPY WNCPYSRC,SE0040CP29                                           S01408
     C                     Z-ADD*ZEROS    WEC
     C                     MOVE *BLANKS   ERRMSG
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'00000000'*IN,58
     C                     MOVEA'000'     *IN,66
     C                     MOVEA'0'       *IN,74                          183604
     C                     MOVE *OFF      WKIN92                          CSD006
     C/COPY WNCPYSRC,SE0040C042
     C*                                                                   E20292
     C* Set off Action Code indicators                                    E20292
     C*                                                                   E20292
     C                     MOVEA'000'     *IN,46                          E20292
     C*
     C* F3 or F5 - Return to main processing
     C*
     C***01******                                                         102342
     C*R*05******          GOTO ZINEND                                    102342
     C   KC                                                               102342
     COR KE                GOTO ZINEND                                    102342
      *                                                                   S01176
      ***  Restore Previously saved security details if F12 pressed.      S01176
      *                                                                   S01176
     C           *IN17     IFEQ '1'                                       S01176
     C           SACTN     ANDEQ'I'                                       S01176
     C                     SETOF                     17                   S01176
     C                     EXSR RSTSEC                                    S01176
     C                     GOTO ZITAG1                                    S01176
     C                     END                                            S01176
      *
      ***  Validate Action Code.
      *
     C           SACTN     IFNE 'I'
     C           SACTN     ANDNE'A'
     C           SACTN     ANDNE'D'
     C           SACTN     ANDNE'E'
     C                     ADD  1         EC
     C                     MOVEA' 100'    ERR,EC
     C                     SETON                     50
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM SACTN     @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 323'    ERR,EC                          S01117
     C                     SETON                     50                   S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF MULTIBRANCHING ENVIRONMENT                                  S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM SACTN     @ZACTN  1                       S01117
     C                     PARM USRBCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 324'    ERR,EC                          S01117
     C                     SETON                     50                   S01117
     C                     ELSE                                           S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 325'    ERR,EC                          S01117
     C                     SETON                     50                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END
      *
      ***  Input mode - entry of Security Short Name is compulsory.
      *
     C           SACTN     IFEQ 'I'
     C           SSESN     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 101'    ERR,EC
     C                     SETON                     51
     C*
     C                     ELSE
     C*
     C* Input mode - record must not exist as an active or matured
     C* record
     C* or a cancelled record.                                            166121
     C*
     C           SSESN     CHAINSECTYDFX             33
     C           *IN33     IFEQ '0'
     C           SRECI     IFEQ 'D'                                       S01158
     C           SRECI     OREQ 'M'                                       S01158
     C           SRECI     OREQ 'C'                                       166121
     C           SRECI     OREQ '*'                                       166121
     C                     ADD  1         EC
     C                     MOVEA' 101'    ERR,EC
     C                     SETON                     51
     C                     END
     C                     END
     C*
     C* or be a reserved word
     C*
     C           SSESN     IFEQ 'ALL'
     C                     ADD  1         EC
     C                     MOVEA' 101'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C                     END
     C                     SETON                     48
     C                     END
     C/COPY WNCPYSRC,SE0040C116
      *
      ***  Amend mode - entry of Security Short Name is compulsory.
      *
     C           SACTN     IFEQ 'A'
     C           SSESN     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 102'    ERR,EC
     C                     SETON                     51
     C                     ELSE
     C*
     C* Record must exist
     C*
     C           SSESN     CHAINSECTYDFX             33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 102'    ERR,EC
     C                     SETON                     51
     C                     ELSE
     C*
     C* and be an active security
     C*
     C           SRECI     IFNE 'D'                                       S01158
     C                     ADD  1         EC
     C                     MOVEA' 102'    ERR,EC
     C                     SETON                     51
     C*                                                                   S01158
     C* Save for comparison last update number from file                  S01158
     C*                                                                   S01158
     C                     ELSE                                           S01158
     C                     Z-ADDTNLU      STNLU                           S01158
     C*                                                                   S01511
     C* Also save Market Indicator so that a change in market will be     S01511
     C* recognised.                                                       S01511
     C*                                                                   S01511
     C                     MOVE MKTI      SVMKTI  1                       S01511
     C                     END
     C                     END
     C                     END
     C                     END
      *
      ***  Delete mode - entry of Security Short Name is compulsory.
      *
     C           SACTN     IFEQ 'D'
     C           SSESN     IFEQ *BLANKS
     C                     ADD  1         EC
     C******************   MOVEA' 103'    ERR,EC                          E22794
     C                     MOVEA' 102'    ERR,EC                          E22794
     C                     SETON                     51
     C                     ELSE
     C*
     C* Record must exist
     C*
     C           SSESN     CHAINSECTYDFX             33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C******************   MOVEA' 103'    ERR,EC                          E22794
     C                     MOVEA' 102'    ERR,EC                          E22794
     C                     SETON                     51
     C                     ELSE
     C*
     C* and be an active security
     C*
     C           SRECI     IFNE 'D'                                       S01158
     C                     ADD  1         EC
     C******************   MOVEA' 103'    ERR,EC                          E22794
     C                     MOVEA' 102'    ERR,EC                          E22794
     C                     SETON                     51
     C*                                                                   S01158
     C* Save for comparison last update number from file                  S01158
     C*                                                                   S01158
     C                     ELSE                                           S01158
     C                     Z-ADDTNLU      STNLU                           S01158
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C* Validate deletion
     C*
     C           SACTN     IFEQ 'D'
     C                     EXSR VLDDCM
     C************IN34     IFEQ '1'                                       E22794
     C***********          ADD  1         EC                              E22794
     C***********          MOVEA' 104'    ERR,EC                          E22794
     C***********          SETON                     51                   E22794
     C***********          END                                            E22794
     C************IN51     IFEQ '1'                                E22794 E23362
     C                     SETON                     46
     C************         END                                     E22794 E23362
     C                     END
      *
      ***  Enquiry mode - entry of Security Short Name is compulsory.
      *
     C           SACTN     IFEQ 'E'
     C           SSESN     IFEQ *BLANKS
     C                     ADD  1         EC
     C******************   MOVEA' 105'    ERR,EC                          E22794
     C                     MOVEA' 102'    ERR,EC                          E22794
     C                     SETON                     51
     C                     ELSE
     C*
     C* Record must exist
     C*
     C           SSESN     CHAINSECTYDFX             33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C******************   MOVEA' 105'    ERR,EC                          E22794
     C                     MOVEA' 102'    ERR,EC                          E22794
     C                     SETON                     51
     C                     END
     C                     END
     C                     SETON                     47
     C                     END
     C*
     C* If any errors, re-display screen
     C*
     C           EC        CABGT*ZEROS    ZITAG1     09
     C*
     C* If not in input mode, display existing details
     C*
     C           *IN69     IFEQ '0'
     C           SACTN     ANDNE'I'
     C           *IN69     OREQ '0'                                       CSE007
     C           SACTN     ANDEQ'I'                                       CSE007
     C           OLDSEC    ANDNE*BLANKS                                   CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           *IN69     OREQ '0'                                       CEU017
     C           SACTN     ANDEQ'I'                                       CEU017
     C           OLDSEC    ANDNE*BLANKS                                   CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C                     EXSR ITLDTA
     C/COPY WNCPYSRC,SE0040C083
     C*
     C* Protect fields if Delete or Enquiry mode
     C*
     C           SACTN     IFEQ 'D'
     C           SACTN     OREQ 'E'
     C                     SETON                     03
     C                     END
     C*
     C                     SETON                     69
     C                     GOTO ZITAG1
     C                     END
     C**                                                                  S01176
     C* Output Defaults for Initial Screen                                S01176
     C**                                                                  S01176
     C           *IN03     IFEQ '0'                                       S01176
     C*                                                                   S01117
     C** CHECK FOR SELECTION                                              S01117
     C*                                                                   S01117
     C                     EXSR CKISEL                                    S01117
     C*                                                                   S01117
     C** IF THERE IS A SELECTION REDISPLAY SCREEN                         S01117
     C*                                                                   S01117
     C           @SEL      IFEQ 'Y'                                       S01117
     C                     GOTO ZITAG1                                    S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C                     EXSR DFTITL                                    S01176
     C*                                                                   E20687
     C* DO NOT DISPLAY DEFAULTS PRIOR TO VALIDATION                       E20687
     C*                                                                   E20687
     C********** *IN17     IFEQ '1'                                S01176 E20687
     C**********           SETOF                     17            S01176 E20687
     C**********           GOTO ZITAG1                             S01176 E20687
     C**********           END                                     S01176 E20687
     C**********           END                                      S01176S01117
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0040CCPG                                           S01408
     C*                                                                   S01408
     C*
     C* Validate initial screen
     C*
     C  N03                EXSR VLDITL
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C* Fetch Processing type for enquiry mode
     C*
     C           SACTN     IFEQ 'E'
     C           ITPKA     CHAININVTPDF              33
     C                     END
     C*
     C* If errors, re-display initial screen showing error codes
     C*
     C           EC        CABGT*ZEROS    ZITAG1     09
     C*
     C* If 'ENTER' pressed in Delete mode, re-display screen
     C*
     C           SACTN     IFEQ 'D'
     C           *IN04     ANDEQ'0'
     C                     GOTO ZITAG1
     C                     END
     C/COPY WNCPYSRC,SE0040C059
     C*
     C* Set off indicators used on second screen
     C*
     C                     SETOF                     41                   S01158
     C                     MOVEA'0000'    *IN,44                          S01158
     C                     SETOF                     69
      *                                                                                       CGL031
      ** Restore values of *IN87 and *IN88 as these were reused.                              CGL031
      *                                                                                       CGL031
     C                     MOVE WIN87     *IN87                                               CGL031
     C                     MOVE WIN88     *IN88                                               CGL031
      *                                                                                       CGL031
     C/COPY WNCPYSRC,SE0040C081
     C*
     C           ZINEND    ENDSR                           *** ZINEND ***
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INFSR  - FILE EXCEPTION/ERROR HANDLING SUBROUTINE            *
      *                                                               *
      *****************************************************************
      *
     C           INFSR     BEGSR                           *** INFSR   ***
     C**
     C**   CHECK ERROR TYPE
     C**
     C           STATUS    IFEQ 01021
     C**
     C**   CHAIN TO FILE TO GET CURRENT DETAILS
     C**
     C           SSESN     CHAINSECTYDF              99
     C**
     C           *IN99     IFEQ '0'
      *
      ***  If Security record exists, Roll Back Updates already done.
      *
     C           CSC022    IFEQ 'N'                                                           CSC022
     C                     ROLBK
     C                     ELSE                                                               CSC022
     C           CMTSKP    IFEQ 'N'                                                           CSC022
     C                     ROLBK                                                              CSC022
     C                     ELSE                                                               CSC022
     C                     SETON                     U7U8                                     CSC022
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                                              CSC022
      *
      ***  If record is Live, change Action Code to "Amend", else change
      ***  it to "Enquire".
      *
     C           RECI      IFEQ 'D'
     C                     MOVEL'A'       SACTN
     C                     ELSE
     C                     MOVEL'E'       SACTN
     C                     SETON                     4703
     C                     END
     C**
     C                     MOVEL'*DETC'   EXTTAG  6
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ELSE
     C**
     C                     MOVE '*CANCL'  EXTTAG
     C                     END
     C**
     C                     ENDSREXTTAG
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  ITLDTA - Subroutine to Display Initial data.                 *
      *                                                               *
      *****************************************************************
      *
     C           ITLDTA    BEGSR                           *** ITLDTA  ***
      *
      ***  Set off Protect Indicators.
      *
     C                     MOVEA'00000'   *IN,41
     C*
     C* Protect unenterable fields
     C*
     C                     SETON                     41
     C*
     C* Protect other fields if complete
     C*
     C                     MOVE INCS      OINCS                           106056
     C           INCS      IFEQ 'C'
     C                     SETON                     44
     C                     END
     C*
     C* Display literal
     C*
     C           SACTN     IFEQ 'E'
     C           SRECI     IFEQ 'C'                                       S01158
     C                     SETON                     42
     C                     ELSE
     C***********RECI      IFEQ 'M'                                       S01158
     C           SRECI     IFEQ 'M'                                       S01158
     C                     SETON                     43
     C                     END
     C                     END
     C                     END
     C*                                                                   102871
     C* New Issue Indicator - If new issue data found on file, show it.   102871
     C**                                                                  102871
     C           SACTN     IFEQ 'A'                                       102871
     C           SACTN     OREQ 'E'                                       102871
     C           ISSD      IFNE ITLD                                      102871
     C           ISSP      ORNE *ZEROS                                    102871
     C********** LMGR      ORNE *ZEROS                                                 102871 CSD027
     C           LMGR      ORNE *BLANKS                                                       CSD027
     C           ISSA      ORNE *ZEROS                                    102871
     C           TOTU      ORNE *ZEROS                                    102871
     C           ALRQ      ORNE *ZEROS                                    102871
     C           ALRC      ORNE *ZEROS                                    102871
     C           MGFD      ORNE *ZEROS                                    102871
     C           MGRC      ORNE *ZEROS                                    102871
     C           UNFD      ORNE *ZEROS                                    102871
     C           UNFR      ORNE *ZEROS                                    102871
     C           FECY      ORNE NMCY                                      102871
     C                     MOVEL'Y'       NEWISS                          102871
     C                     ELSE                                                               138828
     C                     MOVEL'N'       NEWISS                                              138828
     C                     END                                            102871
     C                     END                                            102871
     C*
     C* Protect Partly Paid Indicator
     C*
     C           PPDI      IFEQ 'N'
     C                     SETON                     45
     C                     END
      *                                                                   CSE007
     C           SACTN     IFEQ 'I'                                       CSE007
     C           OLDSEC    ANDNE*BLANKS                                   CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           SACTN     OREQ 'I'                                       CEU017
     C           OLDSEC    ANDNE*BLANKS                                   CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
      *                                                                   CSE007
      ***  Set off Protect Indicators.                                    CSE007
      *                                                                   CSE007
     C                     MOVEA'00000'   *IN,41                          CSE007
      *                                                                   CSE007
     C           OLDSEC    CHAINSECTYDFX             33                   CSE007
     C           OTHINF    IFNE *BLANKS                                   138957
      *                                                                   138957
     C           WSRPN     IFNE *BLANKS                                   138957
     C                     MOVE WSRPN     SRPN      P      Report Name    138957
     C                     ENDIF                                          138957
     C           WSFN1     IFNE *BLANKS                                   138957
     C                     MOVE WSFN1     SFN1      P      Full Name 1    138957
     C                     ENDIF                                          138957
     C           WSFN2     IFNE *BLANKS                                   138957
     C                     MOVE WSFN2     SFN2      P      Full Name 2    138957
     C                     ENDIF                                          138957
     C           WT2RF     IFNE *BLANKS                                   138957
     C                     MOVE WT2RF     T2RF      P      Telekurs       138957
     C                     ENDIF                                          138957
     C           WISNO     IFNE *BLANKS                                   138957
     C                     MOVE WISNO     ISIN      P      ISIN Number    138957
     C                     ENDIF                                          138957
     C           WCSPN     IFNE *BLANKS                                   138957
     C                     MOVE WCSPN     CSPN      P      Cusip Number   138957
     C                     ENDIF                                          138957
     C           WSREF     IFNE *BLANKS                                   138957
     C                     MOVE WSREF     SREF      P      Extel          138957
     C                     ENDIF                                          138957
     C           WSRE1     IFNE *BLANKS                                   138957
     C                     MOVE WSRE1     DASR      P      Security ref.1 138957
     C                     ENDIF                                          138957
     C           WSRE2     IFNE *BLANKS                                   138957
     C                     MOVE WSRE2     DCSR      P      Security ref.2 138957
     C                     ENDIF                                          138957
     C           WSRE3     IFNE *BLANKS                                   138957
     C                     MOVE WSRE3     DDSR      P      Security ref.3 138957
     C                     ENDIF                                          138957
      *                                                                   138957
     C                     ENDIF                                          138957
     C                     ENDIF                                          CSE007
     C*
     C* If resetting protect indicators from F12 - do not reload
     C*
     C************IN02     IFEQ '0'                                       102342
     C           *INKL     IFEQ '0'                                       102342
     C*
     C* Setup display fields
     C*
     C**REPORT*NAME*-*FROM*SECTY*FILE*IF*ACTION*A*OR*I************ S01158 E16302
     C**************-*VIA*ZSDESC*IF*ACTION*E*OR*D***************** S01158 E16302
      ***  Report Name - from Security File.                              E16302
     C*
     C************IN46     IFEQ '0'                                S01158 E16302
     C************IN47     ANDEQ'0'                                S01158 E16302
     C                     MOVE SRPN      SSRPN
     C***********          ELSE                                    S01158 E16302
     C***********          MOVE SRPN      ZSRPN                    S01158 E16302
     C***********          EXSR ZSDESC                             S01158 E16302
     C***********          MOVE ZRNME     SRNME                    S01158 E16302
     C***********          END                                     S01158 E16302
     C*                                                                   S01158
      * Set up Market Data Feeds screen fields                            CSD006
     C                     MOVE SPID      SSSPID                          CAP060
     C                     MOVE SPDS      SCSPDS                          CSD006
      *                                                                   CSD006
     C                     MOVE SFN1      SSFN1
     C                     MOVE SFN2      SSFN2
     C*
     C                     MOVE *BLANKS   SISSR
     C********** ISSR      IFNE *ZEROS                                                        CSD027
     C           ISSR      IFNE *BLANKS                                                       CSD027
     C********** ISSR      CHAINCLINTCBF             33                   S01117
     C**N33*****           MOVELCSNM      SISSR                           S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELISSR      @KEYC  10                       S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C/COPY WNCPYSRC,SE0040C046
     C                     MOVELBBCSSN    SISSR                           S01117
     C/COPY WNCPYSRC,SE0040C047
     C                     END
     C*
     C                     MOVE INCS      SINCS
     C                     MOVE PPDI      SPPDI
     C                     MOVE SITP      SSITP
     C                     MOVE ' '       TBSOVR
     C                     MOVE QLTY      SQLTY
     C                     MOVE MKTI      SMKTI
     C*
     C           SDNM      IFNE *ZEROS
     C                     MOVE SDNM      SSDNM
     C                     MOVEASSDNM     DNM
     C*
     C* Exclude leading zeros
     C*
     C                     Z-ADD1         X
     C           DNM,X     DOWEQ' '
     C           DNM,X     OREQ '0'
     C                     MOVEA' '       DNM,X
     C                     ADD  1         X
     C                     END
     C                     MOVEADNM       SSDNM
     C*
     C                     ELSE
     C                     MOVE *BLANKS   SSDNM
     C                     END
     C*
     C                     MOVE ERPY      SERPY
     C                     MOVE VDFT      SVDFT
     C                     MOVE EDFT      SEDFT
     C                     MOVE NMCY      SNMCY
     C*
     C**Only show Value currency if different to Nominal                  S01169
     C*
     C                     MOVE VLCY      SVLCY
     C*
     C                     MOVE SSEC      SSSEC
     C                     MOVE MLTI      SMLTI
     C*
     C********** SIDY      IFNE *ZEROS                                                        CER020
     C**********           MOVE SIDY      SSIDY                                               CER020
     C           LOIC      IFNE *BLANKS                                                       CER020
     C                     MOVE LOIC      SSIDY                                               CER020
     C                     ELSE
     C                     MOVE ' '       SSIDY
     C                     END
     C*
     C                     MOVE SCOR      SSCOR
     C                     MOVE SRET      SSRET
     C                     MOVE SREF      SSREF
     C                     MOVE T2RF      ST2RF                           S01176
     C                     MOVE CSPN      SCSPN
     C                     MOVE *BLANKS   ERRMSG
     C*
      *                                                                   CPL002
      ** Is Midas-Plato Interface installed?                              CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
      **  Yes, display file values                                        CPL002
      *                                                                   CPL002
      **  Midas-Plato Instrument Class Code                               CPL002
     C                     MOVELPLICCD    SICCD                           CPL002
      **  Midas-Plato Debt Instrument Name                                CPL002
     C                     MOVELPLDINM    SDINM                           CPL002
      **  Midas-Plato Reporting Group                                     CPL002
     C                     MOVELPLRGCD    SRGCD                           CPL002
      **  Midas-Plato Pricing Group                                       CPL002
     C                     MOVELPLPGCD    SPGCD                           CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
     C***********          END                                            CEU018
      *                                                                   S01401
      **  Display File values of ISIN and SWTP if action is E, A or D.    S01401
      *                                                                   S01401
     C/COPY WNCPYSRC,SE0040C105
     C           S01401    IFEQ 'Y'                                       S01401
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE ISIN      SISIN                           S01401
     C                     MOVE SWTP      SSWTP                           S01401
     C                     END                                            S01401
     C/COPY WNCPYSRC,SE0040C106
     C*
      *   If CEU018 is available,                                         CEU018
      **  display file value of NMDP if action is E, A or D.              CEU018
     C           CEU018    IFEQ 'Y'                                       CEU018
     C                     MOVE NMDP      SNMDP                           CEU018
      *                                                                   CEU018
      **  Protect NMDP if action is A and PROT = 7 or 8                   CEU018
     C                     MOVE *OFF      *IN83                           CEU018
      *                                                                   CEU018
      **  Set up key, obtain processing type                              CEU018
     C                     MOVE NMCY      K#CCYI                          CEU018
     C                     MOVE SITP      K#INVT                          CEU018
      *                                                                   CEU018
     C           K#PROT    CHAININVTP                33                   CEU018
      *                                                                   CEU018
     C           *IN33     IFEQ *ON                                       CEU018
     C                     Z-ADD20        DBASE            ***************CEU018
     C                     MOVE 'INVTP '  DBFILE           * DB ERROR 20 *CEU018
     C                     MOVELCCYI      DBKEY            ***************CEU018
     C                     SETON                     U7U8LR               CEU018
     C                     DUMP                                           CEU018
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C                     ROLBK                                          CEU018
     C                     ENDIF                                                              CSC022
     C                     RETRN                                          CEU018
      *                                                                   CEU018
     C                     ELSE                                           CEU018
      *                                                                   CEU018
     C           SACTN     IFEQ 'A'                                       CEU018
     C           SACTN     OREQ 'I'                                       CEU018
      *                                                                   CEU018
     C           PROT      IFEQ '7'                                       CEU018
     C           PROT      OREQ '8'                                       CEU018
     C                     MOVE *ON       *IN83                           CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C                     ENDIF                                          CEU018
      *                                                                                       CGL031
      ** If CGL031 is available display European Tax Indicator                                CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     MOVE SETX      SSETX                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                   CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
      *                                                                   CEU018
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************   E20085
      *                                                               *   E20085
      *  THIS SUBROUTINE HAS BEEN REPLACED BY SR/ZLCD.                *   E20085
      *                                                               *   E20085
     C*****LSTCPN*SR.*to*calculate*Last*Coupon*date.*******************   E20085
     C***********                                                         E20085
     C***********LSTCPN    BEGSR                           *** LSTCPN  ***E20085
     C***********          ENDSR                                          E20085
     C***********                                                         E20085
      *****************************************************************
      /EJECT                                                              S01176
      *****************************************************************   S01176
      *                                                               *   S01176
      *  RSTSEC - Subroutine to restore Saved Security details to the *   S01176
      *           Screen fields.                                      *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           RSTSEC    BEGSR                           *** RSTSEC  ***S01176
     C*                                                                   S01176
     C           SISSR     IFEQ *BLANKS                                   S01176
     C                     MOVELXISSR     SISSR                           S01176
     C                     END                                            S01176
     C           SINCS     IFEQ *BLANKS                                   S01176
     C                     MOVE XINCS     SINCS                           S01176
     C                     END                                            S01176
     C           SSITP     IFEQ *BLANKS                                   S01176
     C                     MOVE XSITP     SSITP                           S01176
     C                     END                                            S01176
     C           SQLTY     IFEQ *BLANKS                                   S01176
     C                     MOVE XQLTY     SQLTY                           S01176
     C                     END                                            S01176
     C           SMKTI     IFEQ *BLANKS                                   S01176
     C                     MOVE XMKTI     SMKTI                           S01176
     C                     END                                            S01176
     C           SSDNM     IFEQ *BLANKS                                   S01176
     C                     MOVE XSDNM     SSDNM                           S01176
     C                     END                                            S01176
     C           SERPY     IFEQ *BLANKS                                   S01176
     C                     MOVE XERPY     SERPY                           S01176
     C                     END                                            S01176
     C           SVDFT     IFEQ *BLANKS                                   S01176
     C                     MOVE XVDFT     SVDFT                           S01176
     C                     END                                            S01176
     C           SEDFT     IFEQ *BLANKS                                   S01176
     C                     MOVE XEDFT     SEDFT                           S01176
     C                     END                                            S01176
     C           SNMCY     IFEQ *BLANKS                                   S01176
     C                     MOVE XNMCY     SNMCY                           S01176
     C                     END                                            S01176
     C           SVLCY     IFEQ *BLANKS                                   S01176
     C                     MOVE XVLCY     SVLCY                           S01176
     C                     END                                            S01176
     C           SSSEC     IFEQ *BLANKS                                   S01176
     C                     MOVE XSSEC     SSSEC                           S01176
     C                     END                                            S01176
     C           SMLTI     IFEQ *BLANKS                                   S01176
     C                     MOVE XMLTI     SMLTI                           S01176
     C                     END                                            S01176
     C           SSIDY     IFEQ *BLANKS                                   S01176
     C                     MOVE XSIDY     SSIDY                           S01176
     C                     END                                            S01176
     C           SSCOR     IFEQ *BLANKS                                   S01176
     C                     MOVE XSCOR     SSCOR                           S01176
     C                     END                                            S01176
     C           SSRET     IFEQ *BLANKS                                   S01176
     C                     MOVE XSRET     SSRET                           S01176
     C                     END                                            S01176
     C           NEWISS    IFEQ *BLANKS                                   S01176
     C                     MOVE XNISS     NEWISS                          S01176
     C                     END                                            S01176
     C           TBSOVR    IFEQ *BLANKS                                   S01176
     C                     MOVE XTOVR     TBSOVR                          S01176
     C                     END                                            S01176
     C           SNMDP     IFEQ *BLANKS                                   CEU018
     C                     MOVE XNMDP     SNMDP                           CEU018
     C                     END                                            CEU018
     C           SSSPID    IFEQ *BLANKS                                   CAP060
     C                     MOVE XSPID     SSSPID                          CAP060
     C                     END                                            CAP060
     C           SCSPDS    IFEQ *BLANKS                                   CSD006
     C                     MOVE XSPDS     SCSPDS                          CSD006
     C                     END                                            CSD006
     C           SSETX     IFEQ *BLANKS                                                       CGL031
     C                     MOVE XSETX     SSETX                                               CGL031
     C                     END                                                                CGL031
     C*                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      *                                                               *   S01176
      *  SAVSEC - Subroutine to save Security details for carry-over  *   S01176
      *           facility.                                           *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           SAVSEC    BEGSR                           *** SAVSEC  ***S01176
     C*                                                                   S01176
     C                     MOVELSISSR     XISSR                           S01176
     C                     MOVE SINCS     XINCS                           S01176
     C                     MOVE SSITP     XSITP                           S01176
     C                     MOVE SQLTY     XQLTY                           S01176
     C                     MOVE SMKTI     XMKTI                           S01176
     C                     MOVE SSDNM     XSDNM                           S01176
     C                     MOVE SERPY     XERPY                           S01176
     C                     MOVE SVDFT     XVDFT                           S01176
     C                     MOVE SEDFT     XEDFT                           S01176
     C                     MOVE SNMCY     XNMCY                           S01176
     C                     MOVE SVLCY     XVLCY                           S01176
     C                     MOVE SSSEC     XSSEC                           S01176
     C                     MOVE SMLTI     XMLTI                           S01176
     C                     MOVE SSIDY     XSIDY                           S01176
     C                     MOVE SSCOR     XSCOR                           S01176
     C                     MOVE SSRET     XSRET                           S01176
     C                     MOVE NEWISS    XNISS   1                       S01176
     C                     MOVE TBSOVR    XTOVR   1                       S01176
     C                     MOVE SISIN     XISIN                           S01401
     C                     MOVE SSWTP     XSWTP                           S01401
     C                     MOVE SNMDP     XNMDP                           CEU018
     C                     MOVE SICCD     XICCD                           CPL002
     C                     MOVE SDINM     XDINM                           CPL002
     C                     MOVE SRGCD     XRGCD                           CPL002
     C                     MOVE SPGCD     XPGCD                           CPL002
     C                     MOVE SSETX     XSETX                                               CGL031
     C*                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *                                                               *
      *  SECOND - SUBROUTINE to process second entry screen.          *
      *                                                               *
      *****************************************************************
      *
     C           SECOND    BEGSR                           *** SECOND  ***
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CCP7                                           S01408
     C*                                                                   S01408
     C           SECT1     TAG                             ** SECT1 TAG **
     C*
     C* F12 pressed or ROLLBACK - display previous screen requested
     C*
     C************IN02     IFEQ '0'                                       102342
     C           *INKL     IFEQ '0'                                       102342
     C           *IN08     ANDEQ'0'
     C/COPY WNCPYSRC,SE0040C016
     C*
     C* Setof error indicators
     C*
     C                     MOVEA'0'       *IN,14
     C                     MOVEA'0000000' *IN,22
     C                     MOVEA'0000'    *IN,29
     C                     MOVEA'000'     *IN,35                          S01176
     C                     MOVEA'0'       *IN,39                          S01176
     C                     MOVEA'00'      *IN,42                          S01220
     C                     MOVEA'0'       *IN,50                          S01176
     C                     MOVEA'0'       *IN,51
     C                     MOVEA'00000000'*IN,52
     C                     MOVEA'00000000'*IN,60
     C                     MOVEA'00000000'*IN,68
     C                     MOVEA'00000000'*IN,76
     C                     MOVEA'000000'  *IN,84
     C                     MOVEA'000'     *IN,41                          S01397
     C                     MOVEA'0'       *IN,06                          S01397
     C*
     C* Setup indicators for Security type
     C*
     C                     MOVEA'0000000' *IN,10                          S01176
     C                     MOVEA'00'      *IN,18                          S01176
     C                     MOVEA'00'      *IN,20                          S01176
     C                     MOVEA'0'       *IN,38                          S01176
     C*
     C           *IN48     IFEQ '1'
     C           TBSOVR    IFNE ' '
     C                     MOVE TBSOVR    SSTBS
     C                     ELSE
     C                     MOVE TRBS      SSTBS
     C                     END
     C                     END
     C*
     C                     SETOF                     20
     C*                                                                   S01176
     C*   If Trade Basis equal to 'D'                                     S01176
     C*   or Trade Basis equal to 'Y' and Processing Type equal to 9,     S01176
     C*   set on indicator 15.                                            S01176
     C*                                                                   S01176
     C           SSTBS     COMP 'D'                      15
     C*                                                                   S01176
     C           SSTBS     IFEQ 'Y'                                       S01176
     C           PROT      ANDEQ'9'                                       S01176
     C                     MOVE '1'       *IN15                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C   15N48   INCS      COMP 'C'                      20               S01176
     C*****N48***SINCS     COMP 'C'                      39        S01158 E13527
     C     N48   INCS      COMP 'C'                      39               E13527
     C*
     C           SPPDI     COMP 'Y'                      13
     C*
     C*   If security complete and maturity date not equal 999999
     C*      then protect maturity date field.
     C/COPY WNCPYSRC,SE0040C017
     C                     SETOF                         40
     C/COPY WNCPYSRC,SE0040C128
     C           CSE007    IFEQ 'N'                                       CSE007
     C           CEU017    ANDEQ'N'                                       CEU017
     C/COPY WNCPYSRC,SE0040C075
     C           SACTN     IFEQ 'A'
     C***********SINCS     ANDEQ'C'                                       E13527
     C           INCS      ANDEQ'C'                                       E13527
     C           MATY      ANDNE99999
     C           PROT      ANDNE'9'                                       S01176
     C                     SETON                         40
     C                     END
     C*                                                                   S01408
      /COPY WNCPYSRC,SE0040CP24                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           CSE007
     C*   If security complete and trade type not = 'P'                   CSE007
     C*      then protect maturity date field.                            CSE007
     C           SACTN     IFEQ 'A'                                       CSE007
     C           STBS      ANDNE'P'                                       CSE007
     C                     SETON                         40               CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C/COPY WNCPYSRC,SE0040C143
     C*                                                                   S01176
     C*   If security complete and maturity date ind is 'F'               S01176
     C*      then protect maturity date field and indicator               S01176
     C*                                                                   S01176
     C                     SETOF                         18               S01176
     C           SACTN     IFEQ 'A'                                       S01176
     C           SINCS     ANDEQ'C'                                       S01176
     C           MDTI      ANDEQ'F'                                       S01176
     C                     SETON                         18               S01176
     C                     END                                            S01176
     C*
     C* If processing shares
     C*
     C***********          SETOF                       06          S01220 S01397
     C                     SETOF                       12          S01220 S01397
     C           PROT      IFEQ '4'                                       S01220
     C***********          SETON                       06          S01397 S01397
     C                     SETON                       12          S01397 S01397
     C                     END                                            S01220
     C*                                                                   S01220
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     SETON                     1112
     C                     END
     C*
     C           PROT      COMP '3'                      21
     C  N21      PROT      COMP '5'                      21               S01158
     C  N21      PROT      COMP '8'                      21               S01158
     C**                                                                  S01176
     C* Set Indicators according to Processing Type                       S01176
     C**                                                                  S01176
     C           PROT      IFEQ '9'                                       S01176
     C                     SETON                         38               S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           PROT      IFEQ '2'                                       S01176
     C           PROT      OREQ '7'                                       S01176
     C           PROT      OREQ '4'                                       S01176
     C                     SETON                         19               S01176
     C                     END                                            S01176
     C*
     C* Action code 'I' - Input mode
     C*
     C           SACTN     IFEQ 'I'
     C*
      ***  Price Basis
     C           SSTBS     IFEQ 'P'
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C*
     C* Interest bearing
     C*
     C                     SETON                     1011
     C                     END
     C                     END
     C*                                                                   S01176
      ***  Yield Basis
     C           SSTBS     IFEQ 'Y'                                       S01176
     C           PROT      IFNE '2'                                       S01176
     C           PROT      ANDNE'4'                                       S01176
     C           PROT      ANDNE'7'                                       S01176
     C           PROT      ANDNE'9'                                       S01176
     C*                                                                   S01176
     C* Interest bearing                                                  S01176
     C*                                                                   S01176
     C                     SETON                     1011                 S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C* Clear input fields
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP11                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANKS   SCPNR
     C                     MOVE *BLANKS   SBASC
     C                     MOVE *BLANKS   SIDIV
     C                     MOVE *BLANKS   SISSA                           S01220
     C*                                                                   S01220
     C           BGRKMG    IFEQ 'Y'                                       S01220
     C                     MOVE 'N'       SRFDI                           S01220
     C                     END                                            S01220
     C*                                                                   S01220
     C                     MOVE *BLANKS   SBASS
     C                     MOVE *BLANK    SSPRI
     C                     MOVE *BLANKS   SNEXD
     C                     MOVE *BLANKS   SMCPN
     C                     MOVE *BLANKS   SMATY1
     C                     MOVE *BLANK    SLTMI
     C                     MOVE *BLANK    SDYBS1
     C                     MOVE *BLANKS   SMATY2
     C                     MOVE *BLANK    SDVBS1
     C                     MOVE *BLANK    SDYBS2
     C                     MOVE *BLANKS   SIADJ
     C                     MOVE *BLANK    SDVBS2
     C                     MOVE *BLANKS   SITLD
     C                     MOVE *BLANKS   SFCPN
     C                     MOVE *BLANKS   SSINP
     C                     MOVE *BLANKS   SSFPP
     C                     MOVEA*BLANKS   SCD
     C                     MOVEA*BLANK    SCR
     C                     MOVE *BLANK    SRCFQ
     C                     MOVE *BLANKS   SNCHD
     C                     MOVE *BLANKS   SCSNM1
     C                     MOVE *BLANKS   SDASR                           S01176
     C                     MOVE *BLANKS   SCSNM2
     C                     MOVE *BLANKS   SDCSR                           S01176
     C                     MOVE *BLANKS   SCSNM3
     C                     MOVE *BLANKS   SDDSR                           S01176
     C                     MOVE *BLANKS   SSMCC
     C                     MOVE *BLANKS   SMKTN
     C                     MOVE *BLANK    SSCVI
     C                     MOVE *BLANK    SSPBS
     C                     MOVE *BLANK    SSTBS
     C                     MOVE *BLANKS   SSYBS
     C                     MOVE *BLANKS   SCMFQ                           S01397
     C                     MOVE *BLANKS   SDSCB                           S01397
     C                     MOVE *BLANKS   SDSLC                           S01397
     C                     MOVE *BLANKS   SMDTI1                          S01176
     C                     MOVE *BLANKS   SMDTI2                          S01176
     C                     MOVE *BLANKS   SCNLI1                          S01176
     C                     MOVE *BLANKS   SCNLI2                          S01176
     C                     MOVE *BLANKS   SRSKC                           S01176
     C                     MOVE *BLANKS   SDRWR                           S01176
     C                     MOVE *BLANKS   #2CCRK                                              CAS006
     C                     MOVE *BLANKS   #2CLQP                                              CAS006
     C                     MOVE *BLANKS   ERRMSG
      *                                                                   CSE005
      * If CSE005 is on then clear Business Day Convention                CSE005
      *                                                                   CSE005
     C           CSE005    IFEQ 'Y'                                       CSE005
     C                     MOVE *BLANKS   SBCNV                           CSE005
     C                     ENDIF                                          CSE005
      *                                                                   CSD006
      * If CSD006 is on then clear Market Data Source                     CSD006
      *                                                                   CSD006
     C           CSD006    IFEQ 'Y'                                       CSD006
     C                     MOVE *BLANKS   SCSPDS                          CSD006
     C                     ENDIF                                          CSD006
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP12                                           S01408
     C*                                                                   S01408
     C*
     C* Action code not equal to 'I' - Amend or Enquiry mode
     C*
     C                     ELSE
     C*
     C                     SETOF                     20
     C*                                                                   S01176
     C*   If Trade Basis equal to 'D'                                     S01176
     C*   or Trade Basis equal to 'Y' and Processing Type equal to 9,     S01176
     C*     set on indicator                                              S01176
     C*                                                                   S01176
     C           STBS      COMP 'D'                      15
     C*                                                                   S01176
     C           STBS      IFEQ 'Y'                                       S01176
     C           PROT      ANDEQ'9'                                       S01176
     C                     MOVE '1'       *IN15                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C   15      INCS      COMP 'C'                      20               S01176
     C**N48******SINCS     COMP 'C'                      39        E13527 S01158
     C  N48      INCS      COMP 'C'                      39               E13527
     C*                                                                   S01408
      /COPY WNCPYSRC,SE0040CP23                                           S01408
     C*                                                                   S01408
     C*
     C           SPPDI     COMP 'Y'                      13
     C*
      ***  Price Basis
     C           STBS      IFEQ 'P'
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C*
     C* Interest bearing
     C*
     C                     SETON                     1110                 S01158
     C                     END
     C                     END
     C*                                                                   S01176
      ***  Yield Basis
     C           STBS      IFEQ 'Y'                                       S01176
     C           PROT      IFNE '2'                                       S01176
     C           PROT      ANDNE'4'                                       S01176
     C           PROT      ANDNE'7'                                       S01176
     C           PROT      ANDNE'9'                                       S01176
     C*                                                                   S01176
     C* Interest bearing                                                  S01176
     C*                                                                   S01176
     C                     SETON                     1110                 S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C* Translate file fields to screen format (all alpha)
     C*
      ***  Coupon Rate
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP13                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE CPNR      ZFLD15
     C                     Z-ADD7         ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCPNR
     C*
      ***  Base Rate Code
     C********** BASC      IFNE *ZEROS                                                        CSD103
     C           BASC      IFNE *BLANKS                                                       CSD103
     C                     MOVE BASC      SBASC
     C                     ELSE
     C                     MOVE *BLANKS   SBASC
     C                     END
     C*
      ***  Initial Dividend Date
     C           IDIV      IFNE *ZEROS
     C                     MOVE IDIV      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SIDIV
     C                     ELSE
     C                     MOVE *BLANKS   SIDIV
     C                     END
     C*                                                                   S01220
     C           BGRKMG    IFEQ 'Y'                                       S01220
     C           RFDI      IFNE *BLANKS                                   S01220
     C                     MOVE RFDI      SRFDI                           S01220
     C                     ELSE                                           S01220
     C                     MOVE 'N'       SRFDI                           S01220
     C                     END                                            S01220
     C                     END                                            S01220
     C*
      ***  Base Rate Spread
     C           BASS      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE BASS      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SBASS
     C                     ELSE
     C                     MOVE *BLANKS   SBASS
     C                     END
     C*
      ***  Spread Indicator
     C                     MOVE SPRI      SSPRI
     C*
     C* Next expected dividend is based on decimal places from Value
     C* currency (Nominal if blank)
     C*
     C           NEXD      IFNE *ZEROS
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C           VLCY      IFNE '   '
     C**********           MOVELVLCY      WORK4   4                       S01117
     C                     MOVELVLCY      @CKEY   3                       S01117
     C                     ELSE
     C**********           MOVELNMCY      WORK4                           S01117
     C                     MOVELNMCY      @CKEY                           S01117
     C                     END
     C*
     C* Fetch decimal places
     C*
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE NEXD      ZFIELD
     C**********           Z-ADDCDP       ZADEC                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNEXD
     C                     ELSE
     C                     MOVE *BLANKS   SNEXD
     C                     END
     C*
      ***  Minimum Coupon
     C           MCPN      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MCPN      ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SMCPN
     C                     ELSE
     C                     MOVE *BLANKS   SMCPN
     C                     END
     C*
     C                     MOVE *BLANKS   SMATY2
      *
      ***  Interest Bearing Security
     C           *IN10     IFEQ '1'
      *
      ***  Maturity Date
     C           MATY      IFNE *ZEROS
     C           MATY      IFNE 99999
     C                     MOVE MATY      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SMATY2
     C                     ELSE
     C                     MOVE '999999'  SMATY2
     C                     END
     C                     END
     C*
      ***  Contingent Liability Indicator
     C                     MOVE CNLI      SCNLI2                          S01176
      *
      ***  Day Basis
     C                     MOVE DYBS      SDYBS2
      *
      ***  Divisor Basis
     C                     MOVE DVBS      SDVBS2
     C*                                                                   S01176
      ***  Maturity Date Indicator
     C           *IN38     IFEQ '1'                                       S01176
     C                     MOVE MDTI      SMDTI2                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END
     C*
      ***  Long Term Maturity Date Indicator
     C                     MOVE LTMI      SLTMI
     C*
      ***  Interest Adjustment
     C           IADJ      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE IADJ      ZFLD15
     C                     Z-ADD*ZEROS    ZDECS
     C                     MOVE 'L'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SIADJ
     C                     ELSE
     C                     MOVE *BLANKS   SIADJ
     C                     END
     C*
     C                     MOVE *BLANKS   SMATY1
      *
      ***  Discount Security
     C           *IN15     IFEQ '1'
      *
      ***  Maturity Date
     C           MATY      IFNE *ZEROS
     C                     MOVE MATY      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SMATY1
     C                     END
     C*
      ***  Contingent Liability Indicator
     C                     MOVE CNLI      SCNLI1                          S01176
      *
      ***  Day Basis
     C                     MOVE DYBS      SDYBS1
      *
      ***  Divisor Basis
     C                     MOVE DVBS      SDVBS1
     C*                                                                   S01176
      ***  Maturity Date Indicator
     C           *IN38     IFEQ '1'                                       S01176
     C                     MOVE MDTI      SMDTI1                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END
     C*
      ***  PROT = '9' - Risk Customer and Drawer
     C           *IN38     IFEQ '1'                                       S01176
     C                     MOVE *BLANKS   SRSKC                           S01176
     C********** RSKC      IFNE *ZERO                                                  S01176 CSD027
     C           RSKC      IFNE *BLANKS                                                       CSD027
     C                     MOVELRSKC      SRSKC                           S01176
     C                     END                                            S01176
     C                     MOVE *BLANKS   SDRWR                           S01176
     C                     MOVELDRWR      SDRWR                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
      ***  Initial Date
     C           ITLD      IFNE *ZEROS
     C                     MOVE ITLD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SITLD
     C                     ELSE
     C                     MOVE *BLANKS   SITLD
     C                     END
     C*
      * Set up Market Data Feed screen field                              CSD006
     C                     MOVE SPDS      SCSPDS                          CSD006
      *                                                                   CSD006
      ***  First Coupon Date
     C           FCPN      IFNE *ZEROS
     C                     MOVE FCPN      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SFCPN
     C                     ELSE
     C                     MOVE *BLANKS   SFCPN
     C                     END
     C*
     C* Initial and Fuly paid prices are based on 3 decimal places if
     C* Processing type '4', else Nominal currency decimal places
     C*
     C           SINP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SINP      ZFIELD
     C           PROT      IFNE '4'
     C                     Z-ADD3         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSINP
     C                     ELSE
     C*
     C* Fetch nominal decimal places
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELSNMCY     WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNMCY     @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSINP
     C                     END
     C                     ELSE
     C                     MOVE *BLANKS   SSINP
     C                     END
     C*
     C* Fully paid price
     C*
     C           SFPP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SFPP      ZFIELD
     C           PROT      IFNE '4'
     C                     Z-ADD3         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSFPP
     C                     ELSE
     C*
     C* Fetch nominal decimal places
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELSNMCY     WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNMCY     @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SSFPP
     C                     END
     C                     ELSE
     C                     MOVE *BLANKS   SSFPP
     C                     END
     C*
      ***  Coupon/Rate Days array
     C                     Z-ADD1         X
     C                     DO   12        X
     C           CD,X      IFNE *ZEROS
     C                     MOVE CD,X      SCD,X
     C                     ELSE
     C                     MOVE *BLANKS   SCD,X
     C                     END
     C                     END
     C*
      ***  Coupon/Rate Indicators array
     C                     MOVEACR        SCR
     C*
      ***  Rate Change Frequency
     C                     MOVE RCFQ      SRCFQ
     C*
      ***  Business Day Convention                                        CSE005
     C           CSE005    IFEQ 'Y'                                       CSE005
     C                     MOVE BCNV      SBCNV                           CSE005
     C                     ENDIF                                          CSE005
     C*
      ***  Next Change Date
     C           NCHD      IFNE *ZEROS
     C                     MOVE NCHD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SNCHD
     C                     ELSE
     C                     MOVE *BLANKS   SNCHD
     C                     END
     C*                                                                   S01220
     C           SERPY     IFEQ 'Y'                                       S01220
     C           BGRKMG    ANDEQ'Y'                                       S01220
     C/COPY WNCPYSRC,SE0040C084
     C           ISSA      IFNE *ZEROS                                    S01220
     C/COPY WNCPYSRC,SE0040C113
     C                     MOVE *BLANKS   ZFIELD                          S01220
     C                     MOVE ISSA      ZFIELD                          S01220
     C                     Z-ADD*ZEROS    ZADEC                           S01220
     C                     EXSR ZEDIT                                     S01220
     C                     MOVE ZFIELD    SISSA                           S01220
     C                     ELSE                                           S01220
     C                     MOVE *BLANKS   SISSA                           S01220
     C                     END                                            S01220
     C                     END                                            S01220
     C*                                                                   S01220
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP14                                           S01408
     C*                                                                   S01408
     C*
     C* Set up defaults
     C*
      ***  Depot Security Reference 1
     C           DASR      IFNE *BLANKS                                   S01176
     C           *IN48     ANDEQ'0'                                       S01176
     C           DASR      ORNE *BLANKS                                   138957
     C           *IN48     ANDEQ'1'                                       138957
     C           WSRE1     ANDNE*BLANKS                                   138957
     C                     MOVE DASR      SDASR                           S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C           STC1      IFEQ 'S'                                       S01176
     C                     MOVELSSREF     SDASR                           S01176
     C                     ELSE                                           S01176
     C           STC1      IFEQ 'T'                                       S01176
     C                     MOVELST2RF     SDASR                           S01176
     C                     ELSE                                           S01176
     C           STC1      IFEQ 'C'                                       S01176
     C                     MOVELSCSPN     SDASR                           S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   SDASR                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
      ***  Depot Security Reference 2
     C           DCSR      IFNE *BLANKS                                   S01176
     C           *IN48     ANDEQ'0'                                       S01176
     C           DCSR      ORNE *BLANKS                                   138957
     C           *IN48     ANDEQ'1'                                       138957
     C           WSRE2     ANDNE*BLANKS                                   138957
     C                     MOVE DCSR      SDCSR                           S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C           STC2      IFEQ 'S'                                       S01176
     C                     MOVELSSREF     SDCSR                           S01176
     C                     ELSE                                           S01176
     C           STC2      IFEQ 'T'                                       S01176
     C                     MOVELST2RF     SDCSR                           S01176
     C                     ELSE                                           S01176
     C           STC2      IFEQ 'C'                                       S01176
     C                     MOVELSCSPN     SDCSR                           S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   SDCSR                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
      ***  Depot Security Reference 3
     C           DDSR      IFNE *BLANKS                                   S01176
     C           *IN48     ANDEQ'0'                                       S01176
     C           DDSR      ORNE *BLANKS                                   138957
     C           *IN48     ANDEQ'1'                                       138957
     C           WSRE3     ANDNE*BLANKS                                   138957
     C                     MOVE DDSR      SDDSR                           S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C           STC3      IFEQ 'S'                                       S01176
     C                     MOVELSSREF     SDDSR                           S01176
     C                     ELSE                                           S01176
     C           STC3      IFEQ 'T'                                       S01176
     C                     MOVELST2RF     SDDSR                           S01176
     C                     ELSE                                           S01176
     C           STC3      IFEQ 'C'                                       S01176
     C                     MOVELSCSPN     SDDSR                           S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   SDDSR                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C* If in AMEND mode check to see if references on                    102342
     C* screen one have changed-if so change screen two.                  102342
     C*                                                                   102342
     C           SACTN     IFEQ 'A'                                       102342
     C*                                                                   102342
     C* Depot security reference 1                                        102342
     C*                                                                   102342
     C           STC1      IFEQ 'S'                                       102342
     C           SSREF     ANDNESREF                                      102342
     C                     MOVELSSREF     SDASR                           102342
     C                     SETON                     01                   102342
     C                     ELSE                                           102342
     C           STC1      IFEQ 'T'                                       102342
     C           ST2RF     ANDNET2RF                                      102342
     C                     MOVELST2RF     SDASR                           102342
     C                     SETON                     01                   102342
     C                     ELSE                                           102342
     C           STC1      IFEQ 'C'                                       102342
     C           SCSPN     ANDNECSPN                                      102342
     C                     MOVELSCSPN     SDASR                           102342
     C                     SETON                     01                   102342
     C                     END                                            102342
     C                     END                                            102342
     C                     END                                            102342
     C*                                                                   102342
     C* Depot security reference 2                                        102342
     C*                                                                   102342
     C           STC2      IFEQ 'S'                                       102342
     C           SSREF     ANDNESREF                                      102342
     C                     MOVELSSREF     SDCSR                           102342
     C                     SETON                     02                   102342
     C                     ELSE                                           102342
     C           STC2      IFEQ 'T'                                       102342
     C           ST2RF     ANDNET2RF                                      102342
     C                     MOVELST2RF     SDCSR                           102342
     C                     SETON                     02                   102342
     C                     ELSE                                           102342
     C           STC2      IFEQ 'C'                                       102342
     C           SCSPN     ANDNECSPN                                      102342
     C                     MOVELSCSPN     SDCSR                           102342
     C                     SETON                     02                   102342
     C                     END                                            102342
     C                     END                                            102342
     C                     END                                            102342
     C*                                                                   102342
     C* Depot security reference 3                                        102342
     C*                                                                   102342
     C           STC3      IFEQ 'S'                                       102342
     C           SSREF     ANDNESREF                                      102342
     C                     MOVELSSREF     SDDSR                           102342
     C                     SETON                     05                   102342
     C                     ELSE                                           102342
     C           STC3      IFEQ 'T'                                       102342
     C           ST2RF     ANDNET2RF                                      102342
     C                     MOVELST2RF     SDDSR                           102342
     C                     SETON                     05                   102342
     C                     ELSE                                           102342
     C           STC3      IFEQ 'C'                                       102342
     C           SCSPN     ANDNECSPN                                      102342
     C                     MOVELSCSPN     SDDSR                           102342
     C                     SETON                     05                   102342
     C                     END                                            102342
     C                     END                                            102342
     C                     END                                            102342
     C*                                                                   102342
     C* Protect fields if they are defaulted from the Investment type     102342
     C* Depot security reference 1                                        102342
     C*                                                                   102342
     C           STC1      IFEQ 'S'                                       102342
     C           SSREF     ANDEQSDASR                                     102342
     C                     SETON                     01                   102342
     C                     ELSE                                           102342
     C           STC1      IFEQ 'T'                                       102342
     C           ST2RF     ANDEQSDASR                                     102342
     C                     SETON                     01                   102342
     C                     ELSE                                           102342
     C           STC1      IFEQ 'C'                                       102342
     C           SCSPN     ANDEQSDASR                                     102342
     C                     SETON                     01                   102342
     C                     END                                            102342
     C                     END                                            102342
     C                     END                                            102342
     C*                                                                   102342
     C* Depot security reference 2                                        102342
     C*                                                                   102342
     C           STC2      IFEQ 'S'                                       102342
     C           SSREF     ANDEQSDCSR                                     102342
     C                     SETON                     02                   102342
     C                     ELSE                                           102342
     C           STC2      IFEQ 'T'                                       102342
     C           ST2RF     ANDEQSDCSR                                     102342
     C                     SETON                     02                   102342
     C                     ELSE                                           102342
     C           STC2      IFEQ 'C'                                       102342
     C           SCSPN     ANDEQSDCSR                                     102342
     C                     SETON                     02                   102342
     C                     END                                            102342
     C                     END                                            102342
     C                     END                                            102342
     C*                                                                   102342
     C* Depot security reference 3                                        102342
     C*                                                                   102342
     C           STC3      IFEQ 'S'                                       102342
     C           SSREF     ANDEQSDDSR                                     102342
     C                     SETON                     05                   102342
     C                     ELSE                                           102342
     C           STC3      IFEQ 'T'                                       102342
     C           ST2RF     ANDEQSDDSR                                     102342
     C                     SETON                     05                   102342
     C                     ELSE                                           102342
     C           STC3      IFEQ 'C'                                       102342
     C           SCSPN     ANDEQSDDSR                                     102342
     C                     SETON                     05                   102342
     C                     END                                            102342
     C                     END                                            102342
     C                     END                                            102342
     C*                                                                   102342
     C                     END                                            102342
     C*                                                                   102342
     C* Market Centre, defaults from Investment type
     C*
     C           SMCC      IFNE '  '
     C           *IN48     ANDEQ'0'
     C           SMCC      ORNE '  '                                      159474
     C           ACTCDE    ANDEQ'I'                                       159474
     C           CSE007    ANDEQ'Y'                                       159474
     C           OLDSEC    ANDNE*BLANKS                                   159474
     C                     MOVE SMCC      SSMCC
     C                     ELSE
     C                     MOVELDMKT      SSMCC
     C                     END
     C*
     C* Convertible Indicator, defaults from Investment type
     C*
     C           SCVI      IFNE ' '
     C           *IN48     ANDEQ'0'
     C                     MOVE SCVI      SSCVI
     C                     ELSE
     C                     MOVELCNVI      SSCVI
     C                     END
     C*
     C* Price Basis, defaults from Investment type
     C*
     C           SPBS      IFNE ' '
     C           *IN48     ANDEQ'0'
     C                     MOVE SPBS      SSPBS
     C                     ELSE
     C                     MOVELPRBS      SSPBS
     C                     END
     C*
     C* Trade Basis, defaults from Investment type if not overridden
     C*
     C           TBSOVR    IFNE ' '
     C                     MOVE TBSOVR    SSTBS
     C                     ELSE
     C           STBS      IFNE ' '
     C           *IN48     ANDEQ'0'
     C                     MOVE STBS      SSTBS
     C                     ELSE
     C                     MOVELTRBS      SSTBS
     C                     END
     C                     END
     C*
     C* Yield Basis, defaults from Investment type
     C*
     C           CSE032    IFNE 'Y'                                       CSE032
     C***********STBS      IFEQ 'Y'                                       E14482
     C           SSTBS     IFEQ 'Y'                                       E14482
     C/COPY WNCPYSRC,SE0040C063
     C           SYBS      IFNE ' '
     C           *IN48     ANDEQ'0'
     C                     MOVE SYBS      SSYBS
     C                     ELSE
     C                     MOVELYDBS      SSYBS
     C                     END
     C                     ELSE
     C                     MOVE '  '      SSYBS
     C                     END
     C                     ELSE                                           CSE032
     C** CSE032 is 'Y'.                                                   CSE032
     C           SSTBS     IFEQ 'Y'                                       CSE032
     C           SSTBS     OREQ 'P'                                       CSE032
     C           SSPBS     ANDEQ'P'                                       CSE032
     C           SYBS      IFNE ' '                                       CSE032
     C           *IN48     ANDEQ'0'                                       CSE032
     C                     MOVE SYBS      SSYBS                           CSE032
     C                     ELSE                                           CSE032
     C                     MOVELYDBS      SSYBS                           CSE032
     C                     END                                            CSE032
     C                     ELSE                                           CSE032
     C                     MOVE '  '      SSYBS                           CSE032
     C                     END                                            CSE032
     C                     END                                            CSE032
     C*
     C                     SETON                     16
     C*                                                                   S01397
     C** Australian yield defaults                                        S01397
     C*                                                                   S01397
     C                     MOVE *BLANKS   AUDSPY  1                       S01397
     C           SSYBS     IFEQ 'AU'                                      S01397
     C                     SETON                     06                   S01397
     C*
     C           SACTN     IFNE 'I'                                       S01397
     C                     MOVE 'N'       AUDSPY                          S01397
     C                     END                                            S01397
     C*                                                                   S01397
     C** Compounding frequency                                            S01397
     C*                                                                   S01397
     C           CMFQ      IFNE *ZEROS                                    S01397
     C           *IN48     ANDEQ'0'                                       S01397
     C                     MOVE CMFQ      SCMFQ                           S01397
     C                     ELSE                                           S01397
     C                     MOVELDCMF      SCMFQ                           S01397
     C                     END                                            S01397
     C*                                                                   S01397
     C** Discount Basis                                                   S01397
     C*                                                                   S01397
     C           DSCB      IFNE *BLANKS                                   S01397
     C           *IN48     ANDEQ'0'                                       S01397
     C                     MOVE DSCB      SDSCB                           S01397
     C                     ELSE                                           S01397
     C                     MOVELDDSB      SDSCB                           S01397
     C                     END                                            S01397
     C*                                                                   S01397
     C** Discount Last Coupon                                             S01397
     C*                                                                   S01397
     C           DSLC      IFNE *BLANKS                                   S01397
     C           *IN48     ANDEQ'0'                                       S01397
     C                     MOVE DSLC      SDSLC                           S01397
     C                     ELSE                                           S01397
     C                     MOVELDDLS      SDSLC                           S01397
     C                     END                                            S01397
     C*
     C           MATY      IFNE *ZEROS                                    S01397
     C           MATY      IFNE 99999                                     S01397
     C                     MOVE MATY      ZDAYNO                          S01397
     C                     EXSR ZDATE2                                    S01397
     C                     MOVE ZDATE     SMATY2                          S01397
     C                     ELSE                                           S01397
     C                     MOVE '999999'  SMATY2                          S01397
     C                     END                                            S01397
     C                     END                                            S01397
     C*
     C                     END                                            S01397
     C*
     C* Fetch Depot names
     C*
     C********** SDC1      IFEQ *ZEROS                                                        CSD027
     C           SDC1      IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   SCSNM1
     C                     ELSE
     C********** SDC1      CHAINCLINTCBF             33                   S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSDC1      @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                       S01117
     C**********           MOVELCSNM      SCSNM1                          S01117
     C                     MOVELBBCSSN    SCSNM1                          S01117
     C***********          ELSE                                           S01117
     C***********          MOVE *BLANKS   SCSNM1                          S01117
     C***********          END                                            S01117
     C                     END
     C*
     C********** SDC2      IFEQ *ZEROS                                                        CSD027
     C           SDC2      IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   SCSNM2
     C                     ELSE
     C********** SDC2      CHAINCLINTCBF             33                   S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSDC2      @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                       S01117
     C***********          MOVELCSNM      SCSNM2                          S01117
     C                     MOVELBBCSSN    SCSNM2                          S01117
     C***********          ELSE                                           S01117
     C***********          MOVE *BLANKS   SCSNM2                          S01117
     C***********          END                                            S01117
     C                     END
     C*
     C********** SDC3      IFEQ *ZEROS                                                        CSD027
     C           SDC3      IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   SCSNM3
     C                     ELSE
     C********** SDC3      CHAINCLINTCBF             33                   S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSDC3      @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                       S01117
     C**********           MOVELCSNM      SCSNM3                          S01117
     C                     MOVELBBCSSN    SCSNM3                          S01117
     C***********          ELSE                                           S01117
     C***********          MOVE *BLANKS   SCSNM3                          S01117
     C***********          END                                            S01117
     C                     END
     C*
     C* Fetch market name
     C*
     C           SSMCC     CHAINSEMKCDF              33                   S01129
     C           *IN33     IFEQ '0'
     C                     MOVELMKTN      SMKTN
     C                     ELSE
     C                     MOVE *BLANKS   SMKTN
     C                     END
     C*                                                                   S01176
     C* Set up defaults for Discount entries                              S01176
     C*                                                                   S01176
     C           SSTBS     IFEQ 'D'                                       S01176
     C  N03                EXSR DFTDSC                                    S01176
     C                     END                                            S01176
     C           SSTBS     IFEQ 'Y'                                       S01186
     C           PROT      ANDEQ'9'                                       S01186
     C  N03                EXSR DFTDSC                                    S01186
     C                     END                                            S01186
     C*                                                                   S01176
     C* Set up defaults for Interest Security entries                     S01176
     C*                                                                   S01176
     C           SSTBS     IFEQ 'P'                                       S01176
     C           SSTBS     OREQ 'Y'                                       S01176
     C           PROT      IFNE '2'                                       S01176
     C           PROT      ANDNE'4'                                       S01176
     C           PROT      ANDNE'7'                                       S01176
     C  N03 10             EXSR DFTINT                                    S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C                     ELSE
     C*
     C* F12 pressed - Clear error message indicators
     C*
     C                     SETOF                     14
     C                     MOVEA'00000000'*IN,22
     C                     MOVEA'00000000'*IN,30
     C***********          MOVEA'00000000'*IN,38                          S01158
     C***********          MOVEA'0000'    *IN,38                   S01158 S01176
     C                     MOVEA'000'     *IN,39                          S01176
     C                     MOVEA'00'      *IN,42                          S01220
     C                     SETOF                     4445                 S01158
     C                     MOVEA'00000000'*IN,46
     C                     MOVEA'00000000'*IN,54
     C                     MOVEA'00000000'*IN,62
     C                     MOVEA'00000000'*IN,70
     C                     MOVEA'00000000'*IN,78
     C                     MOVEA'0000'    *IN,86
     C                     MOVEA'000'     *IN,41                          S01397
     C                     MOVE *OFF      WKIN92                          CSD006
     C                     END
     C*
     C* Display second screen
     C*
     C                     MOVE 'Y'       FIRST   1
     C           *LIKE     DEFN SITLD     TITLD                           044310
     C           *LIKE     DEFN SFCPN     TFCPN                           044310
     C                     MOVE SITLD     TITLD                           044310
     C                     MOVE SFCPN     TFCPN                           044310
     C                     MOVEASCD       TCD    48                       044310
     C                     MOVEASCR       TCR    12                       044310
     C*
     C           SETAG1    TAG                             ** SETAG1 TAG *
     C*
     C* Enquiry mode
     C*
     C**N50******SACTN     COMP 'E'                      50               S01176
     C  N50      SACTN     COMP 'E'                      47               S01176
     C*
     C*                                                                   S01220
     C** Test to see if Early Redemption is allowed & if Risk             S01220
     C** Management Indicator is on  (Use 33 as work indicator)           S01220
     C** (Need to ensure *IN33 and *IN34 are reseted before the test)     065527
     C*                                                                   S01220
     C                     MOVE '0'       *IN33                           065527
     C                     MOVE '0'       *IN34                           065527
     C           BGRKMG    IFEQ 'Y'                                       S01220
     C                     SETON                     34                   S01220
     C           SERPY     IFEQ 'Y'                                       S01220
     C                     SETON                     33                   S01220
     C                     END                                            S01220
     C                     END                                            S01220
     C*                                                                   CSE005
     C* Save value of *IN90, *IN45 and *IN44                              CSE005
     C*                                                                   CSE005
     C                     MOVE *IN90     IN90    1                       CSE005
     C                     MOVE *IN45     IN45    1                       CSE005
     C                     MOVE *IN44     IN44    1                       CSE005
     C*                                                                   CSE005
     C* set default values for *IN45, *IN44 and *IN90                     CSE005
     C* *IN44=ON for case where user is inserting a security              CSE005
     C*                                                                   CSE005
     C                     MOVE *ON       *IN45                           CSE005
     C                     MOVE *ON       *IN44                           CSE005
     C                     MOVE *OFF      *IN90                           CSE005
     C*                                                                   171045
     C     N48   INCS      COMP 'C'                      39               171045
     C*                                                                   CSE005
     C* Processing for securities with PROT = 3 and CSE005 = Y            CSE005
     C*                                                                   CSE005
     C           PROT      IFEQ '3'                                       CSE005
     C           CSE005    ANDEQ'Y'                                       CSE005
     C*                                                                   CSE005
     C* use *IN90 to display new field BCNV                               CSE005
     C*                                                                   CSE005
     C                     MOVE *ON       *IN90                           CSE005
      *                                                                   CSE005
      * if user is not inserting then format Last Coupon Date             CSE005
      *                                                                   CSE005
     C           SACTN     IFNE 'I'                                       CSE005
      *                                                                   CSE005
     C           SBCNV     IFNE ' '                                       196020
      *                                                                   196020
     C           LCPN      IFNE *ZEROS                                    CSE005
     C                     MOVE LCPN      ZDAYNO                          CSE005
     C                     EXSR ZDATE2                                    CSE005
     C                     MOVE ZDATE     SLCPN                           CSE005
     C                     ELSE                                           CSE005
     C                     MOVE *BLANKS   SLCPN                           CSE005
     C                     ENDIF                                          CSE005
     C*                                                                   CSE005
     C* if user is not inserting then                                     CSE005
     C* Calculate Next Coupon Date to be displayed (SNCD)                 CSE005
     C* using ZNCD with ECD=RUND (Save and restore ECD)                   CSE005
     C*                                                                   CSE005
     C           *LIKE     DEFN ECD       ECDXX                           CSE005
     C                     Z-ADDECD       ECDXX                           CSE005
     C                     Z-ADDRUND      ECD                             CSE005
     C                     EXSR ZNCD                                      CSE005
     C                     Z-ADDECDXX     ECD                             CSE005
     C           NCD       IFNE *ZEROS                                    CSE005
     C                     MOVE NCD       ZDAYNO                          CSE005
     C                     EXSR ZDATE2                                    CSE005
     C                     MOVE ZDATE     SNCD                            CSE005
     C                     ELSE                                           CSE005
     C                     MOVE *BLANKS   SNCD                            CSE005
     C                     ENDIF                                          CSE005
     C*                                                                   CSE005
     C* If user is Amending a security with a 'CP'event                   CSE005
     C* on SNDEVD then Protect Coupon Dates (*IN45=*OFF)                  CSE005
     C*                                                                   CSE005
     C           SACTN     IFEQ 'A'                                       CSE005
     C           SECKEY    CHAINSNDEVDF              45                   CSE005
     C                     ENDIF                                          CSE005
     C*                                                                   CSE005
     C* if any errors on any coupon date then *IN44 = *ON                 CSE005
     C*                                                                   CSE005
     C           *IN52     IFEQ *OFF                                      CSE005
     C           *IN53     ANDEQ*OFF                                      CSE005
     C           *IN54     ANDEQ*OFF                                      CSE005
     C           *IN55     ANDEQ*OFF                                      CSE005
     C           *IN56     ANDEQ*OFF                                      CSE005
     C           *IN57     ANDEQ*OFF                                      CSE005
     C           *IN58     ANDEQ*OFF                                      CSE005
     C           *IN59     ANDEQ*OFF                                      CSE005
     C           *IN60     ANDEQ*OFF                                      CSE005
     C           *IN61     ANDEQ*OFF                                      CSE005
     C           *IN62     ANDEQ*OFF                                      CSE005
     C           *IN63     ANDEQ*OFF                                      CSE005
     C                     MOVE *OFF      *IN44                           CSE005
     C                     ELSE                                           CSE005
     C                     MOVE *ON       *IN44                           CSE005
     C                     ENDIF                                          CSE005
     C*                                                                   CSE005
     C                     ENDIF                                          CSE005
      *                                                                   196020
     C                     ENDIF                                          196020
     C*                                                                   CSE005
     C                     ENDIF                                          CSE005
     C*                                                                   S01220
     C/COPY WNCPYSRC,SE0040C018
     C                     MOVE *IN93     IN93                            155622
     C                     MOVE *IN99     IN99                            CSE007
     C                     MOVE WKIN91    *IN91                           CSD006
     C                     MOVE WKIN92    *IN92                           CSD006
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     MOVE *ON       *IN99                           CSE007
     C           ACTCDE    IFNE *BLANKS                                   155622
     C           SESNRF    ORNE *BLANKS                                   155622
     C           OLDSEC    ORNE *BLANKS                                   155622
     C                     MOVE *ON       *IN93                           155622
     C                     ELSE                                           155622
     C                     MOVE *OFF      *IN93                           155622
     C                     ENDIF                                          155622
     C                     ELSE                                           CSE007
     C                     MOVE *OFF      *IN93                           155622
     C                     MOVE *OFF      *IN99                           CSE007
     C                     ENDIF                                          CSE007
     C/COPY WNCPYSRC,SE0040C135
      *                                                                                       CAS006
      ** If CAS006 is on and Security is interest bearing                                     CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           *IN10     ANDEQ'1'                                                           CAS006
     C                     MOVE '1'       WCAS6F  1                                           CAS006
      *                                                                                       CAS006
      ** Save value of indicator 2 before using it for the                                    CAS006
      ** second screen                                                                        CAS006
      *                                                                                       CAS006
     C                     MOVE *IN02     WIN02   1                                           CAS006
     C                     MOVE '1'       *IN02                                               CAS006
      *                                                                                       CAS006
      ** If action code is not Insert, move fields from file                                  CAS006
      ** format to screen format                                                              CAS006
      *                                                                                       CAS006
     C           SACTN     IFNE 'I'                                                           CAS006
      *                                                                                       CAS006
     C                     Z-ADD7         ZDECS                                               CAS006
     C                     MOVE CCRK      WZCCRK 117                                          CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE WZCCRK    ZFLD15                                              CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    #2CCRK                                              CAS006
      *                                                                                       CAS006
     C                     MOVE CLQP      WZCLQP 117                                          CAS006
     C                     MOVE *BLANKS   ZFLD15                                              CAS006
     C                     MOVE WZCLQP    ZFLD15                                              CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    #2CLQP                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     MOVE *IN95     WIN95   1                                           CAS006
     C                     MOVE *IN96     WIN96   1                                           CAS006
     C                     MOVE *IN97     WIN97   1                                           CAS006
      *                                                                                       CAS006
     C           WECRKF    IFEQ '1'                                                           CAS006
     C                     MOVE '1'       *IN95                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WECLPF    IFEQ '1'                                                           CAS006
     C                     MOVE '1'       *IN96                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WECPNF    IFEQ '1'                                                           CAS006
     C                     MOVE '1'       *IN97                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ELSE                                                               CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   WCAS6F                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     EXFMTSE0040F2
      *                                                                                       CAS006
      ** Restore previous values of indicators reused and reset error                         CAS006
      ** indicators                                                                           CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           WCAS6F    ANDEQ'1'                                                           CAS006
     C                     MOVE WIN02     *IN02                                               CAS006
     C                     MOVE WIN95     *IN95                                               CAS006
     C                     MOVE WIN96     *IN96                                               CAS006
     C                     MOVE WIN97     *IN97                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                   CSE011
      ** Feature CSE011 is installed, initialize work fields              CSE011
      *                                                                   CSE011
     C           CSE011    IFEQ 'Y'                                       CSE011
     C                     MOVE *BLANK    WSDASR 12                       CSE011
     C                     MOVE *BLANK    WSDCSR 12                       CSE011
     C                     MOVE *BLANK    WSDDSR 12                       CSE011
     C                     END                                            CSE011
     C/COPY WNCPYSRC,SE0040C019
     C                     MOVE IN93      *IN93                           155622
     C                     MOVE IN99      *IN99                           CSE007
     C*                                                                   CSE005
     C* Return value of *IN90, *IN45 and *IN44                            CSE005
     C*                                                                   CSE005
     C                     MOVE IN90      *IN90                           CSE005
     C                     MOVE IN45      *IN45                           CSE005
     C                     MOVE IN44      *IN44                           CSE005
     C*
     C** SETOF Work Indicator                                             S01220
     C*                                                                   S01220
     C           BGRKMG    IFEQ 'Y'                                       S01220
     C                     SETOF                     34                   S01220
     C           SERPY     IFEQ 'Y'                                       S01220
     C                     SETOF                     33                   S01220
     C                     END                                            S01220
     C                     END                                            S01220
     C/COPY WNCPYSRC,SE0040C085
     C*                                                                   S01220
     C**HELP*key*pressed***call*standard*HELP*program******************   S01199
     C***********                                                         S01199
     C************IN06     DOWEQ'1'                                       S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           DBPGM                           S01199
     C***********          PARM           ERRMSG                          S01199
     C***********                                                         S01199
     C***********          READ SE0040F2                 33               S01199
     C***********          END                                            S01199
     C*
     C* F12 - Display previous screen
     C*
     C************IN02     IFEQ '1'                                       102342
     C           *INKL     IFEQ '1'                                       102342
     C           *IN08     OREQ '1'
     C                     SETOF                     09
     C/COPY WNCPYSRC,SE0040C118
     C                     EXSR INITL
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP20                                           S01408
     C*                                                                   S01408
     C**N01N05***          GOTO SECT1                                     102342
     C  NKCNKE             GOTO SECT1                                     102342
     C                     END
     C*
     C* F3 or F5 - Return to main processing
     C*
     C***01******                                                         102342
     C*R*05******          GOTO ENDSEC                                    102342
     C   KC                                                               102342
     COR KE                GOTO ENDSEC                                    102342
      *
      **  IF BEEN THROUGH AT LEAST ONCE, ALL ERRORS ARE WARNING ERRORS,
      **  AND NO SCREEN CHANGES, DO THE UPDATE, NO NEED TO VALIDATE.
      *
     C           FIRST     IFEQ 'N'
     C           WEC       ANDEQEC
     C           *IN49     ANDEQ'0'
     C*********************SETOF                     093188               S01186
     C/COPY WNCPYSRC,SE0040C001
     C                     GOTO ENDSEC
     C/COPY WNCPYSRC,SE0040C002
     C                     END
     C*
     C* Clear any previous errors
     C*
     C                     SETOF                     09
     C                     Z-ADD*ZEROS    EC      20
     C                     Z-ADD*ZEROS    WEC     20
     C                     MOVE *BLANKS   ERRMSG
     C*                                                                   044310
     C** Check if the Security has Live Value Positions for Amend.        044310
     C*                                                                   044310
     C           SACTN     IFEQ 'A'                                       044310
     C           *IN03     ANDEQ'0'                                       044310
     C                     MOVEASCD       TCD2   48                       044310
     C                     MOVEASCR       TCR2   12                       044310
     C           SITLD     IFNE TITLD                                     044310
     C           SFCPN     ORNE TFCPN                                     044310
     C           TCD2      ORNE TCD                                       044310
     C           TCR2      ORNE TCR                                       044310
     C                     EXSR VLDPOS                                    044310
     C                     END                                            044310
     C                     END                                            044310
     C*                                                                   S01117
     C** CHECK FOR SELECTION                                              S01117
     C*                                                                   S01117
     C  N03                EXSR CKSSEL                                    S01117
     C*****************************************************************                S01117 261063
     C***IF*THERE*IS*A*SELECTION*REDISPLAY*SCREEN**********************                S01117 261063
     C*****************************************************************                S01117 261063
     C**N03***** @SEL      IFEQ 'Y'                                                    S01117 261063
     C**N03*****           GOTO SETAG1                                                 S01117 261063
     C**********           ELSE                                                        S01117 261063
     C*
     C* Validate Share entries
     C*
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C  N03 11 12          EXSR VLDSHR
     C                     END
     C                     END
     C*
     C* Validate Discount entries
     C*
     C           SSTBS     IFEQ 'D'
     C  N03                EXSR VLDDSC
     C                     END
     C*                                                                   S01186
     C           SSTBS     IFEQ 'Y'                                       S01186
     C           PROT      ANDEQ'9'                                       S01186
     C  N03                EXSR VLDDSC                                    S01186
     C                     END                                            S01186
     C*
     C* Validate Interest Security entries
     C*
     C           SSTBS     IFEQ 'P'
     C           SSTBS     OREQ 'Y'
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C  N03 10             EXSR VLDINT
     C                     END
     C                     END
     C*
     C* Validate Second screen defaults
     C*
     C  N03                EXSR VLDDFT
     C*
     C* Validate Second screen Partly Paid entries
     C*
     C  N03 13             EXSR VLDPPD
     C*
     C*                                                                   S01220
     C** Validate Issue Amount                                            S01220
     C*                                                                   S01220
     C           SERPY     IFEQ 'Y'                                       S01220
     C           BGRKMG    ANDEQ'Y'                                       S01220
     C/COPY WNCPYSRC,SE0040C086
     C           SISSA     IFNE *BLANKS                                   S01220
     C*                                                                   S01220
     C** Check valid number                                               S01220
     C*                                                                   S01220
     C                     MOVE *BLANKS   ZFIELD                          S01220
     C                     MOVELSISSA     ZFIELD                          S01220
     C                     Z-ADD11        ZADIG                           S01220
     C/COPY WNCPYSRC,SE0040C048
     C                     Z-ADD0         ZADEC                           S01220
     C                     EXSR ZALIGN                                    S01220
     C           *IN99     IFEQ '1'                                       S01220
     C                     ADD  1         EC                              S01220
     C                     MOVEA' 305'    ERR,EC                          S01220
     C                     SETON                     43                   S01220
     C                     END                                            S01220
     C                     END                                            S01220
     C/COPY WNCPYSRC,SE0040C087
     C                     END                                            S01220
      *                                                                   CSD006
      ** Market Data Source                                               CSD006
      *                                                                   CSD006
     C           CSD006    IFEQ 'Y'                                       CSD006
     C                     MOVE *OFF      WKIN92                          CSD006
      *                                                                   CSD006
      ** Access object checks SDMDFCL0 for Market Data Feed Default       CSD006
      *                                                                   CSD006
     C           SCSPDS    IFEQ *BLANK                                    CSD006
     C                     CALL 'AOMDFCR0'               99               CSD006
     C                     PARM '       ' @RTCD                           CSD006
     C                     PARM '*KEY   ' @OPTN                           CSD006
     C           SDMDFC    PARM SDMDFC    DSFDY                           CSD006
     C                     MOVE MDDSPS    SCSPDS                          CSD006
     C                     MOVE MDDSPS    WKSPDS                          CSD006
      *                                                                   CSD006
     C           @RTCD     IFNE *BLANK                                    CSD006
     C           @RTCD     ANDNE'*NRF   '                                 CSD006
     C           *LOCK     IN   LDA                                       CSD006
     C                     SETON                       U7U8               CSD006
     C                     Z-ADD15        DBASE            ***************CSD006
     C                     MOVEL'SDMDFSPD'DBFILE           *DB ERROR 015 *CSD006
     C                     MOVELSSSPID    DBKEY            ***************CSD006
     C                     OUT  LDA                                       CSD006
     C                     EXSR *PSSR                                     CSD006
     C                     ENDIF                                          CSD006
      *                                                                   CSD006
     C                     ELSE                                           CSD006
      *                                                                   CSD006
      ** Access object checks SDMDFSL0 for Market Data Source Validation  CSD006
      *                                                                   CSD006
     C                     MOVE SCSPDS    @SPDS                           CSD006
     C                     CALL 'AOMDFSR0'               99               CSD006
     C                     PARM '       ' @RTCD                           CSD006
     C                     PARM '*KEY   ' @OPTN                           CSD006
     C                     PARM           @SPDS  32                       CSD006
     C           SDMDFS    PARM SDMDFS    DSFDY                           CSD006
      *                                                                   CSD006
     C           @RTCD     IFEQ *BLANK                                    CSD006
     C                     MOVE @SPDS     SCSPDS                          CSD006
     C                     MOVE @SPDS     WKSPDS                          CSD006
     C                     ELSE                                           CSD006
     C           @RTCD     IFEQ '*NRF   '                                 CSD006
     C                     ADD  1         EC                              CSD006
     C                     MOVEA' 145'    ERR,EC                          CSD006
     C                     MOVE *ON       WKIN92                          CSD006
     C                     ELSE                                           CSD006
     C           *LOCK     IN   LDA                                       CSD006
     C                     SETON                       U7U8               CSD006
     C                     Z-ADD16        DBASE            ***************CSD006
     C                     MOVEL'SDMDFSPD'DBFILE           *DB ERROR 016 *CSD006
     C                     MOVELSSSPID    DBKEY            ***************CSD006
     C                     OUT  LDA                                       CSD006
     C                     EXSR *PSSR                                     CSD006
     C                     ENDIF                                          CSD006
     C                     ENDIF                                          CSD006
     C                     ENDIF                                          CSD006
     C                     ENDIF                                          CSD006
      *                                                                   CSD006
     C*                                                                   S01220
     C                     MOVE 'N'       FIRST
     C*                                                                   S01397
     C** If Australian Yield fields have not been displayed before,       S01397
     C** then treat like the first time through                           S01397
     C*                                                                   S01397
     C***********AUDSPY    IFEQ 'Y'                                S01397 054025
     C***********          MOVE 'Y'       FIRST                    S01397 054025
     C***********          MOVE 'N'       AUDSPY                   S01397 054025
     C***********          GOTO SETAG1                             S01397 054025
     C***********          END                                     S01397 054025
     C*                                                                   S01117
     C**********           END                                                         S01117 261063
     C*
     C* If any errors, re-display second screen
     C*
     C           EC        CABGT*ZEROS    SETAG1     09
     C/COPY WNCPYSRC,SE0040C003
     C*
     C* 'ROLLDOWN' key pressed in enquiry mode
     C*
     C           SACTN     IFEQ 'E'
     C           *IN08     ANDEQ'1'
     C***********          SETON                     05                   102342
     C                     MOVE '1'       *INKE                           102342
     C                     GOTO ENDSEC
     C                     END
     C*
     C/COPY WNCPYSRC,SE0040C073
     C           ENDSEC    ENDSR                           *** ENDSEC ***
     C/COPY WNCPYSRC,SE0040C082
      *
     C*****************************************************************
      /EJECT                                                              044310
      *****************************************************************   044310
      *                                                               *   044310
      *  VLDPOS - Subroutine to check if there are Live Value Date    *   044310
      *           Positions for the Security.                         *   044310
      *                                                               *   044310
      *****************************************************************   044310
      *                                                                   044310
     C           VLDPOS    BEGSR                           *** VLDPOS *** 044310
      *                                                                   044310
     C           SESN      SETLLBKPHDDF                                   044310
     C                     SETOF                     33                   044310
      *                                                                   044310
     C           *IN33     DOWEQ'0'                                       044310
     C           SESN      READEBKPHDDF                  33               044310
      *                                                                   044310
     C           *IN33     IFEQ '0'                                       044310
     C           RECI      ANDEQ'D'                                       044310
     C           BPKY      CHAINBKPOS                33                   044310
      *                                                                   044310
     C           *IN33     IFEQ '0'                                       044310
     C           RECI      ANDEQ'D'                                       044310
      *                                                                   044310
     C           ECNP      IFNE *ZEROS                                    044310
     C           NPSN      ORNE *ZEROS                                    044310
     C                     ADD  1         EC                              044310
     C                     ADD  1         WEC                             044310
     C                     MOVEA' W03'    ERR,EC                          044310
     C                     SETON                     33                   044310
     C                     END                                            044310
      *                                                                   044310
     C                     END                                            044310
     C                     END                                            044310
     C                     END                                            044310
      *                                                                   044310
     C                     ENDSR                                          044310
      *                                                                   044310
      *****************************************************************   044310
      /EJECT
      *****************************************************************
      *                                                               *
      *  THIRD  - Subroutine to process third entry screen.           *
      *                                                               *
      *****************************************************************
      *
     C           THIRD     BEGSR                           *** THIRD  ***
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CCP8                                           S01408
     C*                                                                   S01408
     C*
     C* Action code 'I' - Input mode, clear input fields
     C*
     C           SACTN     IFEQ 'I'
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP15                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANKS   SISSD
     C                     MOVE *BLANKS   SISSP
     C                     MOVE *BLANKS   SLMGR
     C***********          MOVE *BLANKS   SISSA                           S01220
     C                     MOVE *BLANKS   STOTU
     C                     MOVE *BLANKS   SALRQ
     C                     MOVE *BLANKS   SALRC
     C                     MOVE *BLANKS   SMGFD
     C                     MOVE *BLANKS   SMGRC
     C                     MOVE *BLANKS   SUNFD
     C                     MOVE *BLANKS   SUNFR
     C                     MOVE *BLANKS   SFECY
     C                     MOVEL*BLANK    SPPAG                           CPB001
     C                     MOVEL*BLANK    SGUAR                           CPB001
     C                     MOVEL*BLANK    SWEIC                           CPB001
     C                     MOVEL*BLANK    SNATU                           CPB001
     C                     MOVEL*BLANK    SPBIT                           183604
     C           SERPY     IFNE 'Y'                                       S01220
     C           BGRKMG    ORNE 'Y'                                       S01220
     C/COPY WNCPYSRC,SE0040C088
     C                     MOVE *BLANKS   SISSA                           S01220
     C/COPY WNCPYSRC,SE0040C089
     C                     END                                            S01220
     C*                                                                   S01220
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP16                                           S01408
     C*                                                                   S01408
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP17                                           S01408
     C*                                                                   S01408
     C*
     C           SERPY     IFNE 'Y'                                       S01220
     C           BGRKMG    ORNE 'Y'                                       S01220
     C/COPY WNCPYSRC,SE0040C090
     C                     MOVE *BLANKS   SISSA                           S01220
     C/COPY WNCPYSRC,SE0040C091
     C                     END                                            S01220
     C*                                                                   S01220
     C* Else Amend or Enquiry mode - Translate file fields to screen
     C* format (all alpha)
     C*
      ***  Issue Date
     C           ISSD      IFNE *ZEROS
     C                     MOVE ISSD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SISSD
     C                     ELSE
     C                     MOVE *BLANKS   SISSD
     C                     END
     C*
      ***  Issue Price
     C           ISSP      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE ISSP      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SISSP
     C                     ELSE
     C                     MOVE *BLANKS   SISSP
     C                     END
     C*
      ***  Lead Manager
     C                     MOVE *BLANKS   SLMGR
     C********** LMGR      IFNE *ZEROS                                                 S01117 CSD027
     C           LMGR      IFNE *BLANKS                                                       CSD027
     C********** LMGR      CHAINCLINTCBF             33                   S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELLMGR      @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR'  @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C***********@RTCD     IFEQ *BLANKS                             S01117093522
     C***********          MOVELBBCUST    @KEYS   6                 S01117093522
     C***********          CALL 'AOSECSR0'                          S01117093522
     C***********          PARM '*DBERR ' @RTCD                     S01117093522
     C***********          PARM '*KEY   ' @OPTN                     S01117093522
     C***********          PARM           @KEYS                     S01117093522
     C***********SDSECS    PARM SDSECS    DSSDY                     S01117093522
     C***********          END                                      S01117093522
     C**N33*****           MOVELCSNM      SLMGR                           S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCSSN    SLMGR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
      ***  Issue Amount
     C           SISSA     IFEQ *BLANKS                                   S01220
     C           ISSA      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE ISSA      ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SISSA
     C                     ELSE
     C                     MOVE *BLANKS   SISSA
     C                     END
     C                     END                                            S01220
     C*
      ***  Total Underwritten
     C           TOTU      IFNE *ZEROS
     C/COPY WNCPYSRC,SE0040C138
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE TOTU      ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    STOTU
     C/COPY WNCPYSRC,SE0040C139
     C                     ELSE
     C                     MOVE *BLANKS   STOTU
     C                     END
     C*
      ***  Allocation Requested
     C           ALRQ      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE ALRQ      ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SALRQ
     C                     ELSE
     C                     MOVE *BLANKS   SALRQ
     C                     END
     C*
      ***  Allocation Received
     C           ALRC      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE ALRC      ZFIELD
     C                     Z-ADD*ZEROS    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SALRC
     C                     ELSE
     C                     MOVE *BLANKS   SALRC
     C                     END
     C*
     C* Fetch Fee currency decimal places for subsequent translations
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVE '1'       WORK4                           S01117
     C***********          MOVELFECY      WORK4A                          E13664
     C**********           MOVELFECY      WORK4                     E13664S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM FECY      @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C*
      ***  Management Fees Due
     C           MGFD      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MGFD      ZFIELD
     C**********           Z-ADDCDP       ZADEC                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SMGFD
     C                     ELSE
     C                     MOVE *BLANKS   SMGFD
     C                     END
     C*
      ***  Management Fees Received
     C           MGRC      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MGRC      ZFIELD
     C**********           Z-ADDCDP       ZADEC                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SMGRC
     C                     ELSE
     C                     MOVE *BLANKS   SMGRC
     C                     END
     C*
      ***  Underwriting Fees Due
     C           UNFD      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE UNFD      ZFIELD
     C**********           Z-ADDCDP       ZADEC                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SUNFD
     C                     ELSE
     C                     MOVE *BLANKS   SUNFD
     C                     END
     C*
      ***  Underwriting Fees Received
     C           UNFR      IFNE *ZEROS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE UNFR      ZFIELD
     C**********           Z-ADDCDP       ZADEC                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SUNFR
     C                     ELSE
     C                     MOVE *BLANKS   SUNFR
     C                     END
     C*
      ***  Fee Currency
     C                     MOVE FECY      SFECY
     C                     END
      *                                                                   CPB001
      ***  Display file value if PB is ON                                 CPB001
     C           SACTN     IFEQ 'I'                                       CPB001
     C**********           Z-ADD*ZEROS    PPAG                                         CPB001 CSD027
     C**********           Z-ADD*ZEROS    GUAR                                         CPB001 CSD027
     C                     MOVE *BLANKS   PPAG                                                CSD027
     C                     MOVE *BLANKS   GUAR                                                CSD027
     C                     Z-ADD*ZEROS    WEIC                            CPB001
     C                     MOVE *BLANKS   NATU                            CPB001
     C                     MOVE *BLANKS   PBIT                            183604
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C********** PPAG      IFNE *ZEROS                                                 CPB001 CSD027
     C           PPAG      IFNE *BLANKS                                                       CSD027
     C                     MOVELPPAG      SPPAG                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *BLANKS   SPPAG                           CPB001
     C                     ENDIF                                          CPB001
     C********** GUAR      IFNE *ZEROS                                                 CPB001 CSD027
     C           GUAR      IFNE *BLANKS                                                       CSD027
     C                     MOVELGUAR      SGUAR                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *BLANKS   SGUAR                           CPB001
     C                     ENDIF                                          CPB001
     C           WEIC      IFNE *ZEROS                                    CPB001
     C                     MOVELWEIC      SWEIC                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *BLANKS   SWEIC                           CPB001
     C                     ENDIF                                          CPB001
     C                     MOVELNATU      SNATU                           CPB001
     C                     MOVELPBIT      SPBIT                           183604
     C                     ENDIF                                          CPB001
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP18                                           S01408
     C*                                                                   S01408
     C*
     C* Setof display of warning code 'W01' from second screen, when      E28717
     C* third screen displayed.                                           E28717
     C*                                                                   E28717
     C                     SETOF                     09                   E28717
     C*                                                                   E28717
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE *IN25     IN25    1                       CPB001
     C                     MOVE *ON       *IN25                           CPB001
     C                     MOVE *IN26     IN26    1                       CPB001
     C                     MOVE *IN27     IN27    1                       CPB001
     C                     MOVE *IN28     IN28    1                       CPB001
     C                     MOVE *IN29     IN29    1                       CPB001
     C                     MOVE *IN30     IN30    1                       183604
     C                     MOVE *OFF      *IN26                           CPB001
     C                     MOVE *OFF      *IN27                           CPB001
     C                     MOVE *OFF      *IN28                           CPB001
     C                     MOVE *OFF      *IN29                           CPB001
     C                     MOVE *OFF      *IN30                           183604
     C                     ENDIF                                          CPB001
     C* Display third screen
     C*
     C           THTAG1    TAG                             ** THTAG1 TAG *
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE *ON       *IN25                           CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   S01220
     C** Allow entry in Issue amount field on screen 3                    S01220
     C*                                                                   S01220
     C           BGRKMG    IFEQ 'Y'                                       S01220
     C           SERPY     ANDEQ'Y'                                       S01220
     C/COPY WNCPYSRC,SE0040C092
     C           SISSA     IFNE *BLANKS                                   S01220
     C                     SETON                     34                   S01220
     C                     END                                            S01220
     C                     END                                            S01220
      *                                                                   CPB001
      **  If PB is ON                                                     CPB001
     C                     MOVE *IN04     IN04    1                       CPB001
     C           SACTN     IFEQ 'E'                                       CPB001
     C           BGN4ST    ORNE 'Y'                                       CPB001
     C                     MOVE *ON       *IN04                           CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
     C                     MOVE *IN03     IN03    1                       CPB001
     C           NEWISS    IFEQ ' '                                       CPB001
     C                     MOVE *ON       *IN03                           CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   183604
     C           BGN4ST    IFEQ 'Y'                                       183604
     C                     MOVE *OFF      *IN31                           183604
     C           SSF       IFEQ 'Y'                                       183604
     C           SACTN     ANDEQ'A'                                       183604
     C                     MOVE *ON       *IN31                           183604
     C           SSESN     CHAINCPOSS                33                   183604
     C           *IN33     IFEQ *ON                                       183604
     C                     MOVE *OFF      *IN31                           183604
     C                     ENDIF                                          183604
     C                     ENDIF                                          183604
     C                     ENDIF                                          183604
     C/COPY WNCPYSRC,SE0040C119
     C*                                                                   S01220
     C                     EXFMTSE0040F3
     C*                                                                   S01220
      **  If PB is ON                                                     CPB001
     C                     MOVE IN04      *IN04                           CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE IN25      *IN25                           CPB001
     C                     MOVE IN26      *IN26                           CPB001
     C                     MOVE IN27      *IN27                           CPB001
     C                     MOVE IN28      *IN28                           CPB001
     C                     MOVE IN29      *IN29                           CPB001
     C                     MOVE IN30      *IN30                           183604
     C                     ENDIF                                          CPB001
     C                     MOVE IN03      *IN03                           CPB001
     C/COPY WNCPYSRC,SE0040C120
     C           BGRKMG    IFEQ 'Y'                                       S01220
     C           SERPY     ANDEQ'Y'                                       S01220
     C/COPY WNCPYSRC,SE0040C093
     C                     SETOF                     34                   S01220
     C                     END                                            S01220
     C*                                                                   S01220
     C*
     C**HELP*key*pressed***call*standard*HELP*program******************   S01199
     C***********                                                         S01199
     C************IN06     DOWEQ'1'                                       S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           DBPGM                           S01199
     C***********          PARM           ERRMSG                          S01199
     C***********                                                         S01199
     C***********          READ SE0040F3                 33               S01199
     C***********          END                                            S01199
     C*
     C* F12 - Display previous screen
     C*
     C************IN02     IFEQ '1'                                       102342
     C           *INKL     IFEQ '1'                                       102342
     C           *IN08     OREQ '1'
     C                     SETOF                     09
     C                     EXSR SECOND
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP19                                           S01408
     C*                                                                   S01408
     C                     SETOF                     09                   E28717
     C**N01N05***          GOTO THTAG1                                    102342
     C  NKCNKE             GOTO THTAG1                                    102342
     C                     END
     C*
     C* F3 or F5 - Return to main processing
     C*
     C***01******                                                         102342
     C*R*05******          GOTO ENDTHD                                    102342
     C   KC                                                               102342
     COR KE                GOTO ENDTHD                                    102342
     C*                                                                   S01117
     C** CHECK FOR SELECTION                                              S01117
     C*                                                                   S01117
     C                     EXSR CKTSEL                                    S01117
     C*                                                                   S01117
     C** IF THERE IS A SELECTION REDISPLAY SCREEN                         S01117
     C*                                                                   S01117
     C           @SEL      IFEQ 'Y'                                       S01117
     C                     GOTO THTAG1                                    S01117
     C                     ELSE                                           S01117
     C*
     C* Input or amend mode, validate entries
     C*
     C           SACTN     IFEQ 'I'
     C           SACTN     OREQ 'A'
     C                     EXSR VLDTHD
     C                     END
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C* If any errors, re-display with relevent codes
     C*
     C           EC        CABGT*ZEROS    THTAG1     09
     C/COPY WNCPYSRC,SE0040C004
     C*
     C           SACTN     IFEQ 'E'
     C           *IN08     ANDEQ'1'
     C***********          SETON                     05                   102342
     C                     MOVE '1'       *INKE                           102342
     C                     END
     C*
     C           ENDTHD    ENDSR                           *** ENDTHD ***
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  TRSECT - Subroutine to translate SECTYD fields from Screen   *
      *           format to File format.                              *
      *                                                               *
      *****************************************************************
      *
     C           TRSECT    BEGSR                           *** TRSECT  ***
     C*
      ***  Security Short Name and Report Name
     C                     MOVE SSESN     SESN
     C                     MOVE SSRPN     SRPN
     C                     MOVE SSSPID    SPID                                                CAP060
     C*
     C* Full name defaults to Report name
     C*
     C           SSFN1     IFNE *BLANKS
     C                     MOVELSSFN1     SFN1
     C                     ELSE
     C                     MOVE *BLANKS   SFN1
     C                     MOVELSSRPN     SFN1
     C                     END
     C                     MOVE SSFN2     SFN2
     C*
     C* Incomplete indicator defaults to 'C'
     C*
     C* Check for incomplete security being made complete
     C*
     C                     SETOF                     34
     C           INCS      IFEQ 'I'
     C           SINCS     IFEQ ' '
     C           SINCS     OREQ 'C'
     C                     SETON                     34
     C                     END
     C                     END
     C*
     C           SINCS     IFNE ' '
     C                     MOVE SINCS     INCS
     C                     ELSE
     C                     MOVE 'C'       INCS
     C                     END
     C*
     C* Partly paid indicator defaults to 'N'
     C*
     C           SPPDI     IFNE ' '
     C                     MOVE SPPDI     PPDI
     C                     ELSE
     C                     MOVE 'N'       PPDI
     C                     END
     C*
     C                     MOVE SNMCY     NMCY
     C*
     C* Nominal decimal places - 4 if processing type = 7
     C*      - Obtain from TABTG10 if processing type = 8
     C*      - Else 0
     C*
     C           PROT      IFEQ '7'
     C                     Z-ADD4         NMDP
     C                     ELSE
     C           PROT      IFEQ '8'
     C/COPY WNCPYSRC,SE0040C066
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVE '1'       WORK4                           S01117
     C***********          MOVELNMCY      WORK4A                          E13664
     C**********           MOVELNMCY      WORK4                     E13664S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM NMCY      @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C**********           Z-ADDCDP       NMDP                            S01117
     C                     Z-ADDA6NBDP    NMDP                            S01117
     C                     ELSE
     C**********           Z-ADD*ZEROS    NMDP                            CEU018
     C**********           END                                            CEU018
      *                                                                   CEU018
      *  If PROT not 7 or 8, check for feature CEU018                     CEU018
     C           CEU018    IFEQ 'Y'                                       CEU018
     C                     MOVE SNMDP     NMDP                            CEU018
      *                                                                   CEU018
     C                     ELSE                                           CEU018
      *                                                                   CEU018
     C                     Z-ADD*ZEROS    NMDP                            CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C                     END
     C*
     C* Value currency defaults to Nominal currency
     C*
     C           SVLCY     IFNE '   '
     C                     MOVE SVLCY     VLCY
     C                     ELSE
     C                     MOVE SNMCY     VLCY
     C                     END
     C*
     C* Multi-currency indicator defaults to 'N'
     C*
     C           SMLTI     IFNE ' '
     C                     MOVE SMLTI     MLTI
     C                     ELSE
     C                     MOVE 'N'       MLTI
     C                     END
      *                                                                                       CGL031
      ** If CGL031 is available                                                               CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     MOVE SSETX     SETX                                                CGL031
     C                     ENDIF                                                              CGL031
     C*
      ***  Investment Type
     C                     MOVE SSITP     SITP
     C*
     C* Industry code defaults to that of issuer
     C*
     C           SSIDY     IFNE '   '
     C**********           MOVE SSIDY     SIDY                                                CER020
     C                     MOVE SSIDY     LOIC                                                CER020
     C                     ELSE
     C**********           Z-ADD*ZEROS    SIDY                                                CER020
     C                     MOVE *BLANKS   LOIC                                                CER020
     C           SISSR     IFNE *BLANKS
     C********** SISSR     CHAINSNAMEF               33                   S01117
     C***33*****           MOVELSISSR     WK6N    60                      S01117
     C***33***** WK6N      CHAINCLINTCBF             33                   S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSISSR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                       S01117
     C**********           Z-ADDLIND      SIDY                            S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          MOVELBBLINC    SIDY                      S01117E24894
     C**********           MOVELBBLICD    SIDY                                         E24894 CER020
     C                     MOVELBBLICD    LOIC                                                CER020
     C                     END
     C                     END
     C                     END
     C*
     C* Country of Risk defaults to that of issuer
     C*
     C           SSCOR     IFNE '   '
     C                     MOVE SSCOR     SCOR
     C                     ELSE
     C           SISSR     IFNE *BLANKS
     C********** SISSR     CHAINSNAMEF               33                   S01117
     C***33*****           MOVELSISSR     WK6N    60                      S01117
     C***33***** WK6N      CHAINCLINTCBF             33                   S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSISSR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C                     MOVELBBCNCZ    SCOR                            S01117
     C**********           MOVE CCTZ      SCOR                            S01117
     C                     ELSE
     C                     MOVE '   '     SCOR
     C                     END
     C                     END
     C*
      ***  Sector Code and Rating
     C                     MOVE SSSEC     SSEC
     C                     MOVE SQLTY     QLTY
     C*
     C* Market indicator defaults to 'P'
     C*
     C           SMKTI     IFNE ' '                                       E31315
     C                     MOVE SMKTI     MKTI
     C***********          ELSE                                           E31315
     C***********          MOVE 'P'       MKTI                            E31315
     C                     END                                            E31315
     C*
      ***  Statutory Returns Code and Sedol, Telekurs, CUSIP Numbers
     C                     MOVE SSRET     SRET
     C                     MOVE SSREF     SREF
     C***********          MOVE STVRF     TVRF                            S01176
     C                     MOVE ST2RF     T2RF                            S01176
     C                     MOVE SCSPN     CSPN
     C*
      ***  Issuer
     C           SISSR     IFNE *BLANKS
     C********** SISSR     CHAINSNAMEF               33                   S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSISSR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                       S01117
     C**********           Z-ADDCNUM      ISSR                            S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCUST    ISSR                            S01117
     C                     ELSE
     C                     MOVELSISSR     ISSR
     C                     END
     C                     ELSE
     C**********           Z-ADD*ZEROS    ISSR                                                CSD027
     C                     MOVE *BLANKS   ISSR                                                CSD027
     C                     END
     C*
      ***  Trade Denomination
     C           SSDNM     IFNE *BLANKS
     C/COPY WNCPYSRC,SE0040C121
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSSDNM     ZFIELD
     C                     Z-ADD7         ZADIG
     C/COPY WNCPYSRC,SE0040C049
      ***********                                                  CEU018 138605
      ***If*feature*CEU018*is*on*use*specified*no*of*decimal*placesCEU018 138605
      ***in*ZALIGN.**Else*use*zero.********************************CEU018 138605
     C***********CEU018    IFEQ 'N'                                CEU018 138605
     C                     Z-ADD*ZERO     ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SDNM
     C***********          ELSE                                    CEU018 138605
     C***********          Z-ADDNMDP      ZADEC                    CEU018 138605
     C***********          ENDIF                                   CEU018 138605
      ***********                                                  CEU018 138605
     C                     ELSE
     C                     Z-ADD*ZEROS    SDNM
     C                     END
     C*
     C* Early Repayments defaults to 'N'
     C*
     C           SERPY     IFNE ' '
     C                     MOVE SERPY     ERPY
     C                     ELSE
     C                     MOVE 'N'       ERPY
     C                     END
     C*
      ***  Value and Ex Date Defaults
     C                     MOVE SVDFT     VDFT
     C                     MOVE SEDFT     EDFT
     C*
      ***  Initial Dividend Date
     C                     MOVE SIDIV     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    IDIV
     C*
     C** Roll Fwd Dividend                                                S01220
     C*                                                                   S01220
     C           BGRKMG    IFEQ 'Y'                                       S01220
     C           *IN06     ANDEQ'1'                                       S01220
     C                     MOVE SRFDI     RFDI                            S01220
     C                     ELSE                                           S01220
     C                     MOVE 'N'       RFDI                            S01220
     C                     END                                            S01220
     C*                                                                   S01220
      ***  First Coupon Date processing moved to after Initial and        E20085
      ***  Maturity Date processing.                                      E20085
      *                                                                   E20085
     C***********          MOVE SFCPN     ZDATE                           E20085
     C***********          EXSR ZDATE1                                    E20085
     C***********          Z-ADDZDAYNO    FCPN                            E20085
     C*
      ***  Coupon/Rate Days array
     C                     Z-ADD1         X
     C                     DO   12        X
     C           SCD,X     IFNE '    '
     C                     MOVE SCD,X     CD,X
     C                     ELSE
     C                     Z-ADD*ZEROS    CD,X
     C                     END
     C                     END
     C*
      ***  Coupon/Rate Indicators array
     C                     MOVEASCR       CR
     C*
     C* Next expected dividend is expressed in Value currency decimal
     C* places (Nominal if blank)
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C           VLCY      IFNE '   '
     C**********           MOVELVLCY      WORK4   4                       S01117
     C                     MOVELVLCY      @CKEY   3                       S01117
     C                     ELSE
     C**********           MOVELNMCY      WORK4                           S01117
     C                     MOVELNMCY      @CKEY                           S01117
     C                     END
     C*
     C* Fetch currency decimal places
     C*
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSNEXD     ZFIELD
     C********** 13        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           13        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    NEXD
     C*
      *                                                                   E20085
      ***  Last Coupon Date processing moved after Initial and Maturity   E20085
      ***  Date processing.                                               E20085
      *                                                                   E20085
     C**Calculate*last*coupon*date*************************************   E20085
     C*****(if*there*is*no*coupon*record*on*the*non-diary*events*file) 05 E20085
     C***********                                                         E20085
     C***********          EXSR LSTCPN                                    E16305
     C***********SECKEY    SETLLSECEO                    33        E16305 E20085
     C**N33******          EXSR LSTCPN                             E16305 E20085
     C*
      *                                                                                       CAS006
      ** Coupon Rate Processing moved to Second Screen Validation for                         CAS006
      ** Net Treasury Rate Processing                                                         CAS006
      *                                                                                       CAS006
      *****Coupon*Rate***********************************************************             CAS006
     C**********           MOVE *BLANKS   ZFLD17                                              CAS006
     C**********           MOVELSCPNR     ZFLD17                                              CAS006
     C**********           Z-ADD4         ZSDIG                                               CAS006
     C**********           Z-ADD7         ZSDEC                                               CAS006
     C**********           EXSR ZASIGN                                                        CAS006
     C**********           MOVE ZOUT15    CPNR                                                CAS006
     C********** ZFSIGN    IFEQ '-'                                                           CAS006
     C**********           Z-SUBCPNR      CPNR                                                CAS006
     C**********           END                                                                CAS006
     C*                                                                   CSE005
      ***  Business Day Convention                                        CSE005
     C           CSE005    IFEQ 'Y'                                       CSE005
     C                     MOVE SBCNV     BCNV                            CSE005
     C                     ENDIF                                          CSE005
     C*
      ***  Base Rate Code
     C                     MOVE SBASC     BASC
     C*
      ***  Base Rate Spread
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSBASS     ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD7         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    BASS
     C*
      ***  Spread Indicator
     C                     MOVE SSPRI     SPRI
     C*
      ***  Minimum Coupon
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSMCPN     ZFLD17
     C                     Z-ADD4         ZSDIG
     C                     Z-ADD7         ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    MCPN
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBMCPN      MCPN
     C                     END
     C*
      ***  Maturity Date
     C                     Z-ADD*ZEROS    MATY
     C*
     C* Maturity date, Day Basis and Divisor Basis come from either
     C* Discount (*IN15 '1') or Interest bearing security (*IN10 '1')
     C* also Contingency Liability Ind, Maturity Date Ind, Drawer         S01176
     C* and Risk Customer                                                 S01176
     C*
     C                     MOVE *BLANKS   DYBS
     C                     MOVE *BLANKS   DVBS
     C                     MOVE *BLANKS   CNLI                            S01176
     C                     MOVE *BLANKS   MDTI                            S01176
     C                     MOVE *BLANKS   RSKC                            S01176
     C                     MOVE *BLANKS   DRWR                            S01176
     C*
     C           *IN15     IFEQ '1'
     C                     MOVE SMATY1    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    MATY
     C                     MOVE SDYBS1    DYBS
     C                     MOVE SDVBS1    DVBS
      *                                                                   S01176
      ***  Update Maturity Date Indicator and Contingent Liability        S01176
      ***  Indicator depending on Processing Types.                       S01176
      *                                                                   S01176
     C           *IN38     IFEQ '1'                                       S01176
     C                     MOVE SMDTI1    MDTI                            S01176
     C                     END                                            S01176
     C           *IN19     IFEQ '0'                                       S01176
     C                     MOVE SCNLI1    CNLI                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END
     C*
     C           *IN10     IFEQ '1'
     C                     Z-ADDMATDNO    MATY                            S01158
     C*
     C                     MOVE SDYBS2    DYBS
     C                     MOVE SDVBS2    DVBS
      *                                                                   S01176
      ***  Update Maturity Date Indicator for PROT = '9'.                 S01176
     C           *IN38     IFEQ '1'                                       S01176
     C                     MOVE SMDTI2    MDTI                            S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Contingent Liability Indicator                                 S01176
     C                     MOVE SCNLI2    CNLI                            S01176
     C*                                                                   S01176
     C                     END
     C*
     C* Long-term maturity indicator defaults to 'N'
     C*
     C           SLTMI     IFNE ' '
     C                     MOVE SLTMI     LTMI
     C                     ELSE
     C                     MOVE 'N'       LTMI
     C                     END
     C**                                                                  S01176
     C* Risk Customer                                                     S01176
     C**                                                                  S01176
     C           *IN38     IFEQ '1'                                       S01176
     C***********CSTNUM    IFNE *ZEROS                              S01176E23361
     C********** CSTNUM    ANDNE*ZEROS                                                 E23361 CSD027
     C           CSTNUM    ANDNE*BLANKS                                                       CSD027
     C                     MOVELCSTNUM    RSKC                            S01176
     C                     ELSE                                           S01176
     C                     MOVELISSR      RSKC                            S01176
     C***********          END                                      S01176E23361
     C                     END                                            S01176
     C**                                                                  S01176
     C* Drawer                                                            S01176
     C**                                                                  S01176
     C           *IN38     IFEQ '1'                                       S01176
     C                     MOVELSDRWR     DRWR                            S01176
     C                     END                                            S01176
     C*
     C* Interest adjustment
     C*
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSIADJ     ZFLD17
     C                     Z-ADD3         ZSDIG
     C                     Z-ADD*ZERO     ZSDEC
     C                     EXSR ZASIGN
     C                     MOVE ZOUT15    IADJ
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUBIADJ      IADJ
     C                     END
     C*
     C* Initial date
     C*
     C                     MOVE SITLD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    ITLD
     C*
      ***  First Coupon Date.                                             E20085
      *                                                                   E20085
     C           SFCPN     IFNE *BLANKS                                   E20085
     C                     MOVE SFCPN     ZDATE                           E20085
     C                     EXSR ZDATE1                                    E20085
     C                     Z-ADDZDAYNO    FCPN                            E20085
      *                                                                   E20085
      ***  If not input, then get the Next Coupon Date after the          E20085
      ***  Initial Date.                                                  E20085
      *                                                                   E20085
     C                     ELSE                                    E20085 E20459
     C                     Z-ADD*ZEROS    FCPN                            E20085
     C           CPNRAT    IFNE *ZERO                                     E20459
     C           ITLD      ADD  1         ECD     50                      E20085
     C                     EXSR ZNCD                                      E20085
     C                     Z-ADDNCD       FCPN                            E20085
     C                     END                                            E20459
     C                     END                                            E20085
      *                                                                   E20085
      ***  Last Coupon Date.                                              E20085
      *                                                                   E20085
      * Don't update if in amend mode                                     066779
     C           SACTN     IFNE 'A'                                       066779
     C           SACTN     OREQ 'A'                                       186003
     C           RUND      ANDLTFCPN                                      186003
     C                     Z-ADDRUND      ZECD                            E20085
     C                     EXSR ZLCD                                      E20085
     C                     Z-ADDZZLCD     LCPN                            E20085
     C                     END                                            066779
      *
      ***  Rate Change Frequency
     C                     MOVE SRCFQ     RCFQ
     C*
      ***  Next Change Date
     C                     MOVE SNCHD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    NCHD
     C*
      ***  Depot Security References (1-3), Market Centre, Convertible
      ***  Indicator and Price/Trade/Yield Bases.
     C                     MOVE SDASR     DASR                            S01176
     C                     MOVE SDCSR     DCSR                            S01176
     C                     MOVE SDDSR     DDSR                            S01176
     C                     MOVE SSMCC     SMCC
     C                     MOVE SSCVI     SCVI
     C                     MOVE SSPBS     SPBS
     C                     MOVE SSTBS     STBS
     C                     MOVE SSYBS     SYBS
     C                     MOVE SCMFQ     CMFQ                            S01397
     C                     MOVE SDSCB     DSCB                            S01397
     C                     MOVE SDSLC     DSLC                            S01397
     C*
     C* Initial and Fuly paid prices are based on 3 decimal places if
     C* Processing type  NE '4', else Nominal currency decimal places
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSSINP     ZFIELD
     C           PROT      IFNE '4'
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SINP
     C                     ELSE
     C*
     C* Fetch nominal decimal places
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELSNMCY     WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNMCY     @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C********** 15        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           15        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SINP
     C                     END
     C*                                                                   E15930
     C* Update initial prices - on Insert .                               E15930
     C*                                                                   E15930
     C           SACTN     IFEQ 'I'                                       E15930
     C                     Z-ADDSINP      CPDP                            E15930
     C                     Z-ADDSINP      TPHD                            E15930
     C                     ELSE                                           E15930
     C*
     C**Up***********************While*Security*is*incomplete****** S01176E15930
     C* Update initial prices -  only if Security is made Complete        E15930
     C*                                                                   S01176
     C***********INCS      IFNE 'C'                                 S01176E15930
     C           INCS      IFEQ 'C'                                       E15930
     C           OINCS     ANDEQ'I'                                       106056
     C                     Z-ADDSINP      CPDP
     C                     Z-ADDSINP      TPHD
     C                     END                                            S01176
     C                     END                                            E15930
     C*
     C* Fully paid price
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSSFPP     ZFIELD
     C           PROT      IFNE '4'
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SFPP
     C                     ELSE
     C*
     C* Fetch nominal decimal places
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELSNMCY     WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNMCY     @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C********** 15        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           15        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    SFPP
     C                     END
     C*
     C* Only update fields from third screen if New Issue flag is 'Y'
     C*
     C           NEWISS    IFEQ 'Y'
     C/COPY WNCPYSRC,SE0040C006
     C*
      ***  Issue Date
     C                     MOVE SISSD     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    ISSD
     C*
      ***  Issue Price
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSISSP     ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    ISSP
     C*
      ***  Lead Manager
     C**********           Z-ADD*ZEROS    LMGR                                         S01158 CSD027
     C                     MOVE *BLANKS   LMGR                                                CSD027
     C********** SLMGR     CHAINSNAMEF               33                   S01117
     C***********          MOVELSLMGR     WRK6    6                 S01117093522
     C***********          TESTN          WRK6       33             S01117093522
     C***********          MOVELSLMGR     @KEYS                     S01117093522
     C************IN33     IFEQ '0'                  ALPHANUMERIC   S01117093522
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSLMGR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C***********@RTCD     IFEQ *BLANKS                             S01117093522
     C***********          MOVELBBCUST    @KEYS   6                 S01117093522
     C***********          END                                      S01117093522
     C***********          END                                      S01117093522
     C***********@RTCD     IFEQ *BLANKS                             S01117093522
     C************IN33     OREQ '1'                        NUMERIC  S01117093522
     C***********          CALL 'AOSECSR0'                          S01117093522
     C***********          PARM *BLANKS   @RTCD                     S01117093522
     C***********          PARM '*KEY   ' @OPTN                     S01117093522
     C***********          PARM           @KEYS                     S01117093522
     C***********SDSECS    PARM SDSECS    DSSDY                     S01117093522
     C***********          END                                      S01117093522
     C**N33*****           Z-ADDCNUM      LMGR                      S01158S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCUST    LMGR                            S01117
     C                     END                                            S01117
     C*
      ***  Issue Amount
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSISSA     ZFIELD
     C                     Z-ADD11        ZADIG
     C/COPY WNCPYSRC,SE0040C050
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    ISSA
     C/COPY WNCPYSRC,SE0040C114
     C*
      ***  Total Underwritten
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSTOTU     ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    TOTU
     C*
      ***  Allocation Requested
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSALRQ     ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    ALRQ
     C*
      ***  Allocation Received
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSALRC     ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    ALRC
     C*
     C* Fee currency defaults to Nominal currency
     C*
     C           SFECY     IFNE '   '
     C                     MOVE SFECY     FECY
     C                     ELSE
     C                     MOVE SNMCY     FECY
     C                     END
     C*
     C* Fetch Fee currency decimal places for subsequent translations
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELFECY      WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM FECY      @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C*
      ***  Management Fees Due
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSMGFD     ZFIELD
     C********** 11        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           11        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    MGFD
     C*
      ***  Management Fees Received
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSMGRC     ZFIELD
     C********** 11        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           11        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    MGRC
     C*
      ***  Underwriting Fees Due
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSUNFD     ZFIELD
     C********** 11        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           11        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    UNFD
     C*
      ***  Underwriting Fees Received
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSUNFR     ZFIELD
     C********** 11        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           11        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    UNFR
     C*
     C* If New issue flag not 'Y' and Action code is 'I', output blank
     C* fields
     C*
     C                     ELSE
     C           SACTN     IFEQ 'I'
     C                     Z-ADD*ZEROS    ISSD
     C                     Z-ADD*ZEROS    ISSP
     C                     MOVE *BLANKS   LMGR
     C                     Z-ADD*ZEROS    ISSA
     C                     Z-ADD*ZEROS    TOTU
     C                     Z-ADD*ZEROS    ALRQ
     C                     Z-ADD*ZEROS    ALRC
     C                     Z-ADD*ZEROS    UNFD
     C                     Z-ADD*ZEROS    UNFR
     C                     Z-ADD*ZEROS    MGFD
     C                     Z-ADD*ZEROS    MGRC
     C**********           Z-ADD*ZEROS    PPAG                                         CPB001 CSD027
     C**********           Z-ADD*ZEROS    GUAR                                         CPB001 CSD027
     C                     MOVE *BLANK    PPAG                                                CSD027
     C                     MOVE *BLANK    GUAR                                                CSD027
     C                     Z-ADD*ZEROS    WEIC                            CPB001
     C                     MOVE *BLANK    NATU                            CPB001
     C                     MOVE *BLANK    PBIT                            183604
     C                     MOVE NMCY      FECY
     C/COPY WNCPYSRC,SE0040C111
     C                     END
     C*
     C                     END
     C*                                                                   S01220
     C** Move Screen Issue Amount to file                                 S01220
     C*                                                                   S01220
     C           SERPY     IFEQ 'Y'                                       S01220
     C           BGRKMG    ANDEQ'Y'                                       S01220
     C/COPY WNCPYSRC,SE0040C094
     C                     MOVE *BLANKS   ZFIELD                          S01220
     C                     MOVELSISSA     ZFIELD                          S01220
     C                     Z-ADD11        ZADIG                           S01220
     C/COPY WNCPYSRC,SE0040C051
     C                     Z-ADD0         ZADEC                           S01220
     C                     EXSR ZALIGN                                    S01220
     C                     MOVE ZFIELD    ISSA                            S01220
     C/COPY WNCPYSRC,SE0040C115
     C                     END                                            S01220
     C*                                                                   S01220
     C*
     C* Date made complete if incomplete indicator changed from 'I' to
     C* 'C'
     C*
     C           *IN34     IFEQ '1'
     C                     Z-ADDRUND      DCOM
     C                     END
     C*
     C* Original entry date - use run date
     C*
     C           SACTN     IFEQ 'I'
     C                     Z-ADDRUND      ORED
     C                     END
     C*
      ***  First Redemption Date, Next Dividend Date, Last Price Update
     C                     Z-ADD*ZEROS    SCPD
     C                     Z-ADD*ZEROS    NDVD
     C                     Z-ADD*ZEROS    LPRU
     C*
     C* Payment currency defaults to value currency
     C*
     C                     MOVE VLCY      SPYC
     C*
     C* Fetch cross-exchange rate (Nominal to currency)
     C*
     C                     Z-ADD*ZEROS    SEXR
     C                     MOVE *BLANKS   SMDI
     C*
     C* Fetch nominal currency
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELNMCY      WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM NMCY      @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C**********           Z-ADDSPOT      ZRATE1 138                      S01117
     C                     Z-ADDA6SPRT    ZRATE1 138                      S01117
     C********** MDIN      IFEQ 0                                         S01117
     C           A6MDIN    IFEQ 'D'                                       S01117
     C                     MOVE 'D'       ZMDI1   1
     C                     ELSE
     C                     MOVE 'M'       ZMDI1
     C                     END
     C*
     C* Fetch value currency
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELVLCY      WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM VLCY      @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C**********           Z-ADDSPOT      ZRATE2 138                      S01117
     C                     Z-ADDA6SPRT    ZRATE2 138                      S01117
     C********** MDIN      IFEQ 0                                         S01117
     C           A6MDIN    IFEQ 'D'                                       S01117
     C                     MOVE 'D'       ZMDI2   1
     C                     ELSE
     C                     MOVE 'M'       ZMDI2
     C                     END
     C*
     C* Calculate cross-exchange rate
     C*
     C                     EXSR ZXRATE
     C                     Z-ADDZRATEX    SEXR
     C                     MOVE ZMDIX     SMDI
     C*
     C* Current factor
     C*
     C*                                                                   058133
     C** Only set current factor in insert mode.                          058133
     C*                                                                   058133
     C           SACTN     IFEQ 'I'                                       058133
     C           PROT      IFEQ '8'
     C                     Z-ADD1         CFCT
     C                     ELSE
     C                     Z-ADD*ZEROS    CFCT
     C/COPY WNCPYSRC,SE0040C112
     C                     END
     C                     END                                            058133
     C*
     C* Only clear fields in insert mode                                  E16801
     C*                                                                   E16801
     C           SACTN     IFEQ 'I'                                       E16801
      *
      ***  First Redemption  - Call/Put and Price and Market Price
     C                     MOVE ' '       SCPI
     C                     Z-ADD*ZEROS    SCPP
     C                     Z-ADD*ZEROS    MKPR
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD*ZEROS    MKPN                                                CAS006
     C                     Z-ADD*ZEROS    MCRK                                                CAS006
     C                     Z-ADD*ZEROS    MLQP                                                CAS006
     C                     ENDIF                                                              CAS006
     C                     END                                            E16801
     C*                                                                   E16801
      ***  Last Change Date and Type
     C                     Z-ADDRUND      LCD
     C                     MOVE SACTN     CHTP
     C*                                                                   E14792
     C* Default value of issue date to initial date                       E14792
     C******if*issue*date*no*setup.******************************** E14792E20179
     C***********ISSD      IFEQ *ZEROS                              E14792E20179
      * Only default issue date if in insert mode                         075592
      *                            and not previously filled              107537
     C           SACTN     IFEQ 'I'                                       075592
     C           ISSD      ANDEQ*ZEROS                                    107537
     C                     Z-ADDITLD      ISSD                            E14792
     C                     END                                            075592
     C***********          END                                      E14792E20179
      *                                                                   S01401
      **  Update of new fields dependent on presence of MT5xx Feature.    S01401
      **  Or if PB module is present                                      CPB001
      *                                                                   S01401
     C/COPY WNCPYSRC,SE0040C107
     C           S01401    IFEQ 'Y'                                       S01401
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE SISIN     ISIN                            S01401
     C                     MOVE SSWTP     SWTP                            S01401
     C                     END                                            S01401
      *                                                                   CPL002
      **  Is Midas-Plato Interface installed?                             CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C                     MOVE SICCD     PLICCD                          CPL002
     C                     MOVE SDINM     PLDINM                          CPL002
     C                     MOVE SRGCD     PLRGCD                          CPL002
     C                     MOVE SPGCD     PLPGCD                          CPL002
     C                     END                                            CPL002
      *                                                                   CPB001
      ***  Display file value if PB is ON                                 CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           SPPAG     IFNE *BLANKS                                   CPB001
     C                     MOVE SPPAG     PPAG                            CPB001
     C                     ELSE                                           CPB001
     C**********           MOVE *ZEROS    PPAG                                         CPB001 CSD027
     C                     MOVE *BLANKS   PPAG                                                CSD027
     C                     ENDIF                                          CPB001
     C           SGUAR     IFNE *BLANKS                                   CPB001
     C                     MOVE SGUAR     GUAR                            CPB001
     C                     ELSE                                           CPB001
     C**********           MOVE *ZEROS    GUAR                                         CPB001 CSD027
     C                     MOVE *BLANKS   GUAR                                                CSD027
     C                     ENDIF                                          CPB001
     C           SWEIC     IFNE *BLANKS                                   CPB001
     C                     MOVE SWEIC     WEIC                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *ZEROS    WEIC                            CPB001
     C                     ENDIF                                          CPB001
     C                     MOVE SNATU     NATU                            CPB001
     C                     MOVE SPBIT     PBIT                            183604
     C                     END                                            CPB001
      *                                                                   CSE023
     C                     MOVE #1CRTT    CRTT                            CSE023
     C                     MOVE #1INCT    INCT                            CSE023
     C                     MOVE #1EXCD    EXCD                            CSE023
     C                     MOVE #1OIDI    OIDI                            CSE023
     C                     MOVE #1APIE    APIE                            CSE023
      *                                                                   CSD006
      * Set up Market Data Source fields                                  CSD006
      *                                                                   CSD006
     C           CSD006    IFEQ 'Y'                                       CSD006
     C                     MOVE WKSPID    SPID                            CSD006
     C                     MOVE WKSPDS    SPDS                            CSD006
     C                     ENDIF                                          CSD006
      *                                                                   CSD006
      *                                                                   CPB001
     C/COPY WNCPYSRC,SE0040C108
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDDCM - Subroutine to validate Deletion/Change of Market    *
      *           processing.                                         *
      *                                                               *
      *****************************************************************
      *
     C           VLDDCM    BEGSR                           *** VLDDCM ***
     C*
     C* Check LF/TRADSE - Trades by Security
     C*
     C           SESN      SETLLTRADSDF
     C***********          SETOF                     3334                 E22794
     C                     SETOF                     333489               E22794
     C           *IN33     DOWEQ'0'
     C           *IN89     ANDEQ'0'                                       E22794
     C           SESN      READETRADSDF                  33
     C           *IN33     IFEQ '0'
     C***********SACTN     CABEQ'D'       ENDDCM         34               E22794
     C           SACTN     IFEQ 'D'                        B3             E22794
     C                     ADD  1         EC                              E22794
     C                     MOVEA' 103'    ERR,EC                          E22794
     C                     SETON                       5189               E22794
     C                     ELSE                            E3             E22794
     C*                                                                   E22794
     C***********TDMI      CABEQMKTI      ENDDCM         34               E22794
     C           TDMI      CABEQMKTI      MKTIND         34               E22794
     C*
     C                     END                             E3             E22794
     C                     END
     C                     END
     C*                                                                   092001
     C* Check LF/HSTTRR - HISTORIC Trades by Security                     092001
     C*                                                                   092001
     C                     MOVE SESN      KTDSS                           092001
     C                     Z-ADD99999     KTDDT                           092001
     C                     MOVE *BLANKS   KTDRF                           092001
     C           KHST      SETLLHSTTRDF                                   092001
     C                     READ HSTTRDF                  33               092001
     C           KTDSS     IFEQ TDSS                       B1             092001
     C           SACTN     ANDEQ'D'                                       092001
     C                     ADD  1         EC                              092001
     C                     MOVEA' 103'    ERR,EC                          092001
     C                     SETON                       5189               092001
     C                     END                             E1             092001
     C*                                                                   092001
     C*
     C* Check LF/UDEPZ - User Depot Positions (non-zero Nominal)
     C*
     C           SESN      SETLLUDEPPDF
     C***********          SETOF                     3334                 E22794
     C                     SETOF                     333489               E22794
     C           *IN33     DOWEQ'0'
     C           *IN89     ANDEQ'0'                                       E22794
     C           SESN      READEUDEPPDF                  33
     C           *IN33     IFEQ '0'
     C***********SACTN     CABEQ'D'       ENDDCM         34               E22794
     C           SACTN     IFEQ 'D'                                       E22794
     C           RECI      IFEQ 'D'                                       E22794
     C           UECN      IFNE 0                                         053092
     C           UDNT      ORNE 0                                         053092
     C           UDNV      ORNE 0                                         053092
     C           UDNS      ORNE 0                                         053092
     C                     ADD  1         EC                              E22794
     C                     MOVEA' 104'    ERR,EC                          E22794
     C                     SETON                       5189               E22794
     C                     END                                            053092
     C                     END                                            E22794
     C                     ELSE                                           E22794
     C*
     C***********UDMK      CABEQMKTI      ENDDCM         34               E22794
     C           UDMK      CABEQMKTI      MKTIND         34               E22794
     C*
     C                     END                                            E22794
     C                     END
     C                     END
     C*
     C* Check LF/UDEPZ - Customer Depot Positions (non-zero Nominal)
     C*
     C           SESN      SETLLCDEPPDF
     C***********          SETOF                     3334                 E22794
     C                     SETOF                     333489               E22794
     C           *IN33     DOWEQ'0'
     C           *IN89     ANDEQ'0'                                       E22794
     C           SESN      READECDEPPDF                  33
     C           *IN33     IFEQ '0'
     C********** SACTN     CABEQ'D'       ENDDCM         34               E22794
     C           SACTN     IFEQ 'D'                                       E22794
     C           RECI      IFEQ 'D'                                       E22794
     C           CECN      IFNE 0                                         053092
     C           CDNT      ORNE 0                                         053092
     C           CDNV      ORNE 0                                         053092
     C           CDNS      ORNE 0                                         053092
     C                     ADD  1         EC                              E22794
     C                     MOVEA' 105'    ERR,EC                          E22794
     C                     SETON                       5189               E22794
     C                     END                                            053092
     C                     END                                            E22794
     C                     ELSE                                           E22794
     C*
     C***********CDMK      CABEQMKTI      ENDDCM         34               E22794
     C           CDMK      CABEQMKTI      MKTIND         34               E22794
     C*
     C                     END                                            E22794
     C                     END
     C                     END
     C*
     C**Processing*Type*=*6*******************                            E22794
     C*                                                                   E22794
     C********** PROT      IFEQ '6'                                       E22794
     C*
     C* Check LF/BKPHD - Book Positions Header
     C*
     C           SESN      SETLLBKPHDDF
     C*************        SETOF                     3334                 E22794
     C                     SETOF                     333489               E22794
     C           *IN33     DOWEQ'0'
     C           *IN89     ANDEQ'0'                                       E22794
     C           SESN      READEBKPHDDF                  33
     C           *IN33     IFEQ '0'
     C           RECI      ANDEQ'D'                                       E22794
     C***********SACTN     CABEQ'D'       ENDDCM         34
     C           SACTN     IFNE 'D'                                       E22794
     C*
     C***********BHMK      CABEQMKTI      ENDDCM         34
     C***********BHMK      CABEQMKTI      MKTIND         34               E31319
     C                     END                                            E22794
     C*                                                                   E22794
     C* Check BKPOSD if record found on header                            E22794
     C*                                                                   E22794
     C           BPKY      CHAINBKPOS                33                   E22794
     C           *IN33     IFEQ '0'                        B3             E22794
     C           ECNP      IFNE *ZEROS                     B4             E22794
     C           NPSN      ORNE *ZEROS                                    E22794
     C********** SACTN     CABEQ'D'       ENDDCM         34               E22794
     C           SACTN     IFEQ 'D'                        B5             E22794
     C           RECI      IFEQ 'D'                                       E22794
     C                     ADD  1         EC                              E22794
     C                     MOVEA' 132'    ERR,EC                          E22794
     C                     SETON                       5189               E22794
     C                     END                                            E22794
     C                     ELSE                            E5             E22794
     C*                                                                   E22794
     C           BPMK      CABEQMKTI      MKTIND         34               E22794
     C*                                                                   E22794
     C*********  ICLD      COMP *ZEROS               3434                 E22794
     C*                                                                   E22794
     C                     END                             E5             E22794
     C                     END                             E4             E22794
     C                     END
     C                     END
     C*
     C                     END
     C*
     C* Delete-mode only validations
     C*
     C           SACTN     IFEQ 'D'
     C*
     C* Check LF/SEDEV - Security Diary Events
     C*
     C***********SESN      SETLLSEDEVDF                                   E21717
     C           SESN      SETLLSEDEVDFX                                  E21717
     C***********          SETOF                     3334                 E22794
     C                     SETOF                     333489               E22794
     C                     MOVE ' '       RECI
     C           *IN33     DOWEQ'0'
     C           *IN89     ANDEQ'0'                        B2             E22794
     C***********SESN      READESEDEVDF                  33               E21717
     C           SESN      READESEDEVDFX                 33               E21717
     C           *IN33     IFEQ '0'
     C***********RECI      CABEQ'D'       ENDDCM         34               E22794
     C           RECI      IFEQ 'D'                        B4             E22794
     C           RECI      OREQ 'C'                        B***4          068079
     C                     ADD  1         EC                              E22794
     C                     MOVEA' 135'    ERR,EC                          E22794
     C                     SETON                       5189               E22794
     C                     END                             E4             E22794
     C                     END
     C                     END
     C*
     C* Check LF/DPTMV - Depot Movements
     C*
     C           SESN      SETLLDPTMVDF
     C**********           SETOF                     3334                 E22794
     C                     SETOF                     333489               E22794
     C                     MOVE ' '       RECI
     C           *IN33     DOWEQ'0'
     C           *IN89     ANDEQ'0'                        B2             E22794
     C           SESN      READEDPTMVDF                  33
     C           *IN33     IFEQ '0'
     C********** RECI      CABEQ'D'       ENDDCM         34               E22794
     C           RECI      IFEQ 'D'                        B4             E22794
     C                     ADD  1         EC                              E22794
     C                     MOVEA' 133'    ERR,EC                          E22794
     C                     SETON                       5189               E22794
     C                     END                             E4             E22794
     C                     END
     C                     END
     C*
     C* Check SLIMIL                                                      E22794
     C*                                                                   E22794
     C           SLKY      SETLLSLIMIF                   57               E22794
     C**********           SETOF                     3334                 E22794
     C                     SETOF                     333489               E22794
     C           *IN33     DOWEQ'0'                        B2             E22794
     C           *IN89     ANDEQ'0'                        B2             E22794
     C           SLKY      READESLIMIF                   33               E22794
     C           *IN33     IFEQ '0'                        B3             E22794
     C********** RECI      CABEQ'D'       ENDDCM         34               E22794
     C           RECI      IFEQ 'D'                        B4             E22794
     C                     ADD  1         EC                              E22794
     C                     MOVEA' 134'    ERR,EC                          E22794
     C                     SETON                       5189               E22794
     C                     END                             E4             E22794
     C                     END                             E3             E22794
     C                     END                             E2             E22794
     C*                                                                   E22794
     C                     END                             E1             E22794
     C           MKTIND    TAG                                            E22794
     C           *IN34     IFEQ '1'                                       E22794
     C                     ADD  1         EC                              E22794
     C                     MOVEA' 118'    ERR,EC                          E22794
     C                     SETON                         51               E22794
     C                     END
     C*
     C           ENDDCM    ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDDFT - Subroutine to validate Default entries on the       *
      *           Second Screen.                                      *
      *                                                               *
      *****************************************************************
      *
     C           VLDDFT    BEGSR                           *** VLDDFT  ***
     C*
     C* Setof error indicators
     C*
     C                     MOVEA'0000000' *IN,22
     C*
     C* Depot 1 Security Reference
     C*
     C           SDASR     IFNE *BLANKS                                   S01176
     C********** SDC1      ANDEQ*ZEROS                                                        CSD027
     C           SDC1      ANDEQ*BLANKS                                                       CSD027
     C                     ADD  1         EC
     C                     MOVEA' 246'    ERR,EC
     C                     SETON                     22
     C                     END
     C*
     C* Depot 2 Security Reference
     C*
     C           SDCSR     IFNE *BLANKS                                   S01176
     C********** SDC2      ANDEQ*ZEROS                                                        CSD027
     C           SDC2      ANDEQ*BLANKS                                                       CSD027
     C                     ADD  1         EC
     C                     MOVEA' 247'    ERR,EC
     C                     SETON                     23
     C                     END
     C*
     C* Depot 3 Security Reference
     C*
     C           SDDSR     IFNE *BLANKS                                   S01176
     C********** SDC3      ANDEQ*ZEROS                                                        CSD027
     C           SDC3      ANDEQ*BLANKS                                                       CSD027
     C                     ADD  1         EC
     C                     MOVEA' 248'    ERR,EC
     C                     SETON                     24
     C                     END
     C*
     C* Market Centre
     C*
     C           SSMCC     IFNE *BLANKS
     C           SSMCC     OREQ *BLANKS                                   183604
     C           BGN4ST    ANDEQ'Y'                                       183604
     C           SSMCC     CHAINSEMKCDF              33                   S01129
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C           SSMCC     IFEQ *BLANKS                                   183604
     C                     MOVEA' 600'    ERR,EC                          183604
     C                     ELSE                                           183604
     C                     MOVEA' 249'    ERR,EC
     C                     ENDIF                                          183604
     C                     SETON                     25
     C                     ELSE
     C           RECI      IFEQ '*'
     C                     ADD  1         EC
     C                     MOVEA' 249'    ERR,EC
     C                     SETON                     25
     C                     ELSE
     C                     MOVE MKTN      SMKTN
     C                     END
     C                     END
     C                     ELSE
     C/COPY WNCPYSRC,SE0040C043
     C                     MOVE *BLANKS   SMKTN
     C/COPY WNCPYSRC,SE0040C044
     C                     END
     C*
     C* Convertible Indicator
     C*
     C           SSCVI     IFNE ' '
     C           SSCVI     ANDNE'Y'
     C           SSCVI     ANDNE'N'
     C                     ADD  1         EC
     C                     MOVEA' 250'    ERR,EC
     C                     SETON                     26
     C                     ELSE
     C*
     C           SSCVI     IFEQ 'Y'
     C           PROT      IFEQ '2'
     C           PROT      OREQ '4'
     C                     ADD  1         EC
     C                     MOVEA' 251'    ERR,EC
     C                     SETON                     26
     C                     END
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0040C031
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ** Check, if convertible indicator changed and used in account key  CSE007
     C           SSCVI     IFNE SCVI                                      CSE007
     C           SSCVI     ANDNELSCVI                                     CSE007
     C           BVCIAK    ANDEQ'Y'                                       CSE007
     C                     MOVE SSCVI     LSCVI   1                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     ADD  1         WEC                             CSE007
     C                     MOVEA' W09'    ERR,EC                          CSE007
     C                     SETON                     26                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*
     C* Price Basis - check entry valid
     C*
     C           SSPBS     IFNE 'P'
     C           SSPBS     ANDNE'U'
     C                     ADD  1         EC
     C                     MOVEA' 252'    ERR,EC
     C                     SETON                     27
     C                     ELSE
     C*
     C* Cannot be 'U' if Trade basis is 'D'
     C*
     C           SSPBS     IFEQ 'U'
     C           SSTBS     ANDEQ'D'
     C                     ADD  1         EC
     C                     MOVEA' 253'    ERR,EC
     C                     SETON                     27
     C                     END
     C                     END
     C*
     C* Yield Basis
     C*
     C* If blank, Trade basis must not be 'Y'
     C*
     C           SSYBS     IFEQ '  '
     C           CSE032    IFNE 'Y'                                       CSE032
     C           SSTBS     IFEQ 'Y'
     C                     ADD  1         EC
     C                     MOVEA' 254'    ERR,EC
     C                     SETON                     28
     C                     END
     C                     ELSE                                           CSE032
     C           SSTBS     IFEQ 'Y'                                       CSE032
     C           SSTBS     OREQ 'P'                                       CSE032
     C           SSPBS     ANDEQ'P'                                       CSE032
     C                     ADD  1         EC                              CSE032
     C                     MOVEA' 254'    ERR,EC                          CSE032
     C                     SETON                     28                   CSE032
     C                     END                                            CSE032
     C                     END                                            CSE032
     C                     ELSE
     C*
     C* else Trade basis must be 'Y'
     C*
     C           CSE032    IFNE 'Y'                                       CSE032
     C/COPY WNCPYSRC,SE0040C064
     C           SSTBS     IFNE 'Y'
     C/COPY WNCPYSRC,SE0040C065
     C                     ADD  1         EC
     C                     MOVEA' 254'    ERR,EC
     C                     SETON                     28
     C                     ELSE
     C*
     C/COPY WNCPYSRC,SE0040C095
     C           SSYBS     LOKUPTABYBS                   33
     C           *IN33     IFEQ '0'
     C                     ADD  1         EC
     C                     MOVEA' 255'    ERR,EC
     C                     SETON                     28
     C                     END
     C/COPY WNCPYSRC,SE0040C096
     C                     END
     C                     ELSE                                           CSE032
      ** CSE032 is 'Y'.                                                   CSE032
      * Trade basis must be 'Y' or, 'P' with a price basis of 'P'.        CSE032
     C           SSTBS     IFEQ 'D'                                       CSE032
     C           SSTBS     OREQ 'P'                                       CSE032
     C           SSPBS     ANDEQ'U'                                       CSE032
     C                     ADD  1         EC                              CSE032
     C                     MOVEA' 254'    ERR,EC                          CSE032
     C                     SETON                     28                   CSE032
     C                     ELSE                                           CSE032
     C*                                                                   CSE032
     C           SSYBS     LOKUPTABYBS                   33               CSE032
     C           *IN33     IFEQ '0'                                       CSE032
     C                     ADD  1         EC                              CSE032
     C                     MOVEA' 255'    ERR,EC                          CSE032
     C                     SETON                     28                   CSE032
     C                     END                                            CSE032
     C                     END                                            CSE032
     C                     END                                            CSE032
     C*
     C                     END
     C*                                                                   S01397
     C** Australian Yield fields                                          S01397
     C*                                                                   S01397
     C           SSYBS     IFEQ 'AU'                                      S01397
     C                     SETON                     06                   S01397
     C           AUDSPY    IFNE 'N'                                       S01397
     C                     MOVE 'Y'       AUDSPY                          S01397
     C                     END                                            S01397
     C*                                                                   S01397
     C** Compounding Frequency                                            S01397
     C*                                                                   S01397
     C           SCMFQ     IFEQ *BLANKS                                   S01397
     C                     Z-ADD0         X                               S01397
     C***********X         DOWLT13                                  S01397137805
     C           X         DOWLT12                                        137805
     C                     ADD  1         X                               S01397
     C           SCD,X     IFEQ *BLANKS                                   S01397
     C           X         SUB  1         TEMP    20                      S01397
     C                     MOVE TEMP      SCMFQ                           S01397
     C                     Z-ADD13        X                               S01397
     C                     END                                            S01397
     C                     END                                            S01397
     C                     ELSE                                           S01397
     C                     MOVE SCMFQ     TESTCF  20                      S01397
     C           TESTCF    IFLT 1                                         S01397
     C           TESTCF    ORGT 12                                        S01397
     C                     ADD  1         EC                              S01397
     C                     MOVEA' 262'    ERR,EC                          S01397
     C                     SETON                     41                   S01397
     C                     END                                            S01397
     C                     END                                            S01397
     C*                                                                   S01397
     C** Discount Basis                                                   S01397
     C*                                                                   S01397
     C           SDSCB     IFEQ *BLANKS                                   S01397
     C                     MOVE '2'       SDSCB                           S01397
     C                     ELSE                                           S01397
     C           SDSCB     IFNE '2'                                       S01397
     C           SDSCB     ANDNE'5'                                       S01397
     C                     ADD  1         EC                              S01397
     C                     MOVEA' 263'    ERR,EC                          S01397
     C                     SETON                     42                   S01397
     C                     END                                            S01397
     C                     END                                            S01397
     C*                                                                   S01397
     C** Discount Last Coupon                                             S01397
     C*                                                                   S01397
     C           SDSLC     IFEQ *BLANKS                                   S01397
     C                     MOVE 'Y'       SDSLC                           S01397
     C                     ELSE                                           S01397
     C           SDSLC     IFNE 'Y'                                       S01397
     C           SDSLC     ANDNE'N'                                       S01397
     C                     ADD  1         EC                              S01397
     C                     MOVEA' 264'    ERR,EC                          S01397
     C                     SETON                     43                   S01397
     C                     END                                            S01397
     C                     END                                            S01397
     C                     END                                            S01397
      *                                                                   CSE011
      ** Feature CSE011 is installed.                                     CSE011
      *                                                                   CSE011
     C           CSE011    IFEQ 'Y'                                       CSE011
      *                                                                   CSE011
      ** Check if Code Depot 1 already exists in Securities file          CSE011
      *                                                                   CSE011
     C           SDASR     IFNE *BLANK                                    CSE011
     C           SDASR     ANDNEWSDASR                                    CSE011
     C           EC        ANDEQ0                                         CSE011
     C                     MOVE SDASR     WSDASR                          CSE011
     C                     MOVE *IN89     WIND89  1                       CSE011
     C                     MOVE 'N'       WFOUND  1                       CSE011
     C           WSDASR    SETLLSECTE                                     CSE011
     C           WSDASR    READESECTE                    89               CSE011
      *                                                                   CSE011
     C           *IN89     DOWEQ'0'                                       CSE011
     C           WFOUND    ANDEQ'N'                                       CSE011
      *                                                                   CSE011
      ** Check if Security Shortname is different                         CSE011
      *                                                                   CSE011
     C           SSESN     IFNE SESN                                      CSE011
     C                     MOVE 'Y'       WFOUND                          CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           WSDASR    READESECTE                    89               CSE011
     C                     ENDDO                                          CSE011
      *                                                                   CSE011
      ** Depot 1 code already exist in Security file, send warning        CSE011
      *                                                                   CSE011
     C           WFOUND    IFEQ 'Y'                                       CSE011
     C                     MOVEAWAMSG,5   WE        P                     CSE011
     C                     MOVEADASR      WE,17     P                     CSE011
     C                     MOVEAWAMSG,8   WE,30     P                     CSE011
     C                     MOVEASESN      WE,47     P                     CSE011
     C                     MOVEAWE        ERRMSG    P                     CSE011
     C                     MOVE *ON       *IN22                           CSE011
     C                     ADD  1         EC                              CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     MOVE WIND89    *IN89                           CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
      ** Check if Code Depot 2 already exists in Securities file          CSE011
      *                                                                   CSE011
     C           SDCSR     IFNE *BLANK                                    CSE011
     C           SDCSR     ANDNEWSDCSR                                    CSE011
     C           EC        ANDEQ0                                         CSE011
     C                     MOVE SDCSR     WSDCSR                          CSE011
     C                     MOVE *IN89     WIND89  1                       CSE011
     C                     MOVE 'N'       WFOUND  1                       CSE011
     C           WSDCSR    SETLLSECT2                                     CSE011
     C           WSDCSR    READESECT2                    89               CSE011
      *                                                                   CSE011
     C           *IN89     DOWEQ*OFF                                      CSE011
     C           WFOUND    ANDEQ'N'                                       CSE011
      *                                                                   CSE011
      ** Check if Security Shortname is different                         CSE011
      *                                                                   CSE011
     C           SSESN     IFNE SESN                                      CSE011
     C                     MOVE 'Y'       WFOUND                          CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           WSDCSR    READESECT2                    89               CSE011
     C                     ENDDO                                          CSE011
      *                                                                   CSE011
      ** Depot 2 code already exist in Security file, send warning        CSE011
      *                                                                   CSE011
     C           WFOUND    IFEQ 'Y'                                       CSE011
     C                     MOVEAWAMSG,6   WE        P                     CSE011
     C                     MOVEADCSR      WE,17     P                     CSE011
     C                     MOVEAWAMSG,8   WE,30     P                     CSE011
     C                     MOVEASESN      WE,47     P                     CSE011
     C                     MOVEAWE        ERRMSG    P                     CSE011
     C                     MOVE *ON       *IN23                           CSE011
     C                     ADD  1         EC                              CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     MOVE WIND89    *IN89                           CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
      ** Check if Code Depot 3 already exists in Securities file          CSE011
      *                                                                   CSE011
     C           SDDSR     IFNE *BLANK                                    CSE011
     C           SDDSR     ANDNEWSDDSR                                    CSE011
     C           EC        ANDEQ0                                         CSE011
     C                     MOVE SDDSR     WSDDSR                          CSE011
     C                     MOVE *IN89     WIND89  1                       CSE011
     C                     MOVE 'N'       WFOUND  1                       CSE011
     C           WSDDSR    SETLLSECT3                                     CSE011
     C           WSDDSR    READESECT3                    89               CSE011
      *                                                                   CSE011
     C           *IN89     DOWEQ*OFF                                      CSE011
     C           WFOUND    ANDEQ'N'                                       CSE011
      *                                                                   CSE011
      ** Check if Security Shortname is different                         CSE011
      *                                                                   CSE011
     C           SSESN     IFNE SESN                                      CSE011
     C                     MOVE 'Y'       WFOUND                          CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           WSDDSR    READESECT3                    89               CSE011
     C                     ENDDO                                          CSE011
      *                                                                   CSE011
      ** Depot 3 code already exist in Security file, send warning        CSE011
      *                                                                   CSE011
     C           WFOUND    IFEQ 'Y'                                       CSE011
     C                     MOVEAWAMSG,7   WE        P                     CSE011
     C                     MOVEADDSR      WE,17     P                     CSE011
     C                     MOVEAWAMSG,8   WE,30     P                     CSE011
     C                     MOVEASESN      WE,47     P                     CSE011
     C                     MOVEAWE        ERRMSG    P                     CSE011
     C                     MOVE *ON       *IN24                           CSE011
     C                     ADD  1         EC                              CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     MOVE WIND89    *IN89                           CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     ENDIF                                          CSE011
      *                                                                                       CAS006
     C           WCAS6F    IFEQ '1'                                                           CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   WECRKF                                              CAS006
     C                     MOVE *BLANKS   WECLPF                                              CAS006
     C                     MOVE *BLANKS   WECPNF                                              CAS006
      *                                                                                       CAS006
     C           #2CCRK    IFNE *BLANKS                                                       CAS006
      *                                                                                       CAS006
      ** Check valid signed number                                                            CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD17                                              CAS006
     C                     MOVE #2CCRK    ZFLD17                                              CAS006
     C                     Z-ADD4         ZSDIG                                               CAS006
     C                     Z-ADD7         ZSDEC                                               CAS006
     C                     EXSR ZASIGN                                                        CAS006
      *                                                                                       CAS006
     C           *IN99     IFEQ '1'                                                           CAS006
     C                     MOVE '1'       WECRKF                                              CAS006
     C                     ADD  1         EC                                                  CAS006
     C                     Z-ADDWHIT      WHIT    10                                          CAS006
      *                                                                                       CAS006
      ** Check if Input is valid but has a wrong format or if                                 CAS006
      ** it is invalid totally                                                                CAS006
      *                                                                                       CAS006
     C           DIGITS    CHECK#2CCRK    WHIT                                                CAS006
     C           WHIT      IFEQ 0                                                             CAS006
      *                                                                                       CAS006
      ** Input is valid but has a wrong format                                                CAS006
      *                                                                                       CAS006
     C                     MOVEA' 507'    ERR,EC                                              CAS006
     C                     ELSE                                                               CAS006
      *                                                                                       CAS006
      ** Input is invalid                                                                     CAS006
      *                                                                                       CAS006
     C                     MOVEA' 508'    ERR,EC                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     MOVE '1'       WECRKF  1                                           CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           #2CLQP    IFNE *BLANKS                                                       CAS006
      *                                                                                       CAS006
      ** Check valid signed number                                                            CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD17                                              CAS006
     C                     MOVE #2CLQP    ZFLD17                                              CAS006
     C                     Z-ADD4         ZSDIG                                               CAS006
     C                     Z-ADD7         ZSDEC                                               CAS006
     C                     EXSR ZASIGN                                                        CAS006
      *                                                                                       CAS006
     C           *IN99     IFEQ '1'                                                           CAS006
     C                     MOVE '1'       WECLPF                                              CAS006
     C                     ADD  1         EC                                                  CAS006
      *                                                                                       CAS006
      ** Check if Input is valid but has a wrong format or if                                 CAS006
      ** it is invalid totally                                                                CAS006
      *                                                                                       CAS006
     C           DIGITS    CHECK#2CLQP    WHIT                                                CAS006
     C           WHIT      IFEQ 0                                                             CAS006
      *                                                                                       CAS006
      ** Input is valid but has a wrong format                                                CAS006
      *                                                                                       CAS006
     C                     MOVEA' 507'    ERR,EC                                              CAS006
     C                     ELSE                                                               CAS006
      *                                                                                       CAS006
      ** Input is invalid                                                                     CAS006
      *                                                                                       CAS006
     C                     MOVEA' 508'    ERR,EC                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     MOVE '1'       WECLPF  1                                           CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Coupon Rate Credit Risk Spread                                                       CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD17                                              CAS006
     C                     MOVEL#2CCRK    ZFLD17                                              CAS006
     C                     Z-ADD4         ZSDIG                                               CAS006
     C                     Z-ADD7         ZSDEC                                               CAS006
     C                     EXSR ZASIGN                                                        CAS006
     C                     MOVE ZOUT15    CCRK                                                CAS006
     C           ZFSIGN    IFEQ '-'                                                           CAS006
     C                     Z-SUBCCRK      CCRK                                                CAS006
     C                     END                                                                CAS006
      *                                                                                       CAS006
      ** Coupon Rate Liquidity Premium                                                        CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD17                                              CAS006
     C                     MOVEL#2CLQP    ZFLD17                                              CAS006
     C                     Z-ADD4         ZSDIG                                               CAS006
     C                     Z-ADD7         ZSDEC                                               CAS006
     C                     EXSR ZASIGN                                                        CAS006
     C                     MOVE ZOUT15    CLQP                                                CAS006
     C           ZFSIGN    IFEQ '-'                                                           CAS006
     C                     Z-SUBCLQP      CLQP                                                CAS006
     C                     END                                                                CAS006
      *                                                                                       CAS006
      ** Coupon Rate                                                                          CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD17                                              CAS006
     C                     MOVELSCPNR     ZFLD17                                              CAS006
     C                     Z-ADD4         ZSDIG                                               CAS006
     C                     Z-ADD7         ZSDEC                                               CAS006
     C                     EXSR ZASIGN                                                        CAS006
     C                     MOVE ZOUT15    CPNR                                                CAS006
     C           ZFSIGN    IFEQ '-'                                                           CAS006
     C                     Z-SUBCPNR      CPNR                                                CAS006
     C                     END                                                                CAS006
      *                                                                                       CAS006
      ** Compute Net Treasury Rate                                                            CAS006
      *                                                                                       CAS006
     C           WECRKF    IFNE '1'                                                           CAS006
     C           WECLPF    ANDNE'1'                                                           CAS006
     C                     Z-ADDCPNR      WCPNN  117                                          CAS006
     C           WCPNN     ADD  CCRK      WCPNN                                               CAS006
     C           WCPNN     ADD  CLQP      WCPNN                                               CAS006
      *                                                                                       CAS006
      ** Check Net Treasury Rate and send message if less than zero                           CAS006
      *                                                                                       CAS006
     C           WCPNN     IFLE 0                                                             CAS006
     C                     ADD  1         EC                                                  CAS006
     C                     MOVEA' 509'    ERR,EC                                              CAS006
     C                     MOVE '1'       WECPNF  1                                           CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADDWCPNN     CPNN                                                CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE0040C060
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDDSC - Subroutine to validate Discount entries made on the *
      *           second screen.                                      *
      *                                                               *
      *****************************************************************
      *
     C           VLDDSC    BEGSR                           *** VLDDSC ***
     C*
     C* Setof error indicators
     C*
     C                     SETOF                     313235
     C                     SETOF                     363750               S01176
     C*
     C* Maturity date
     C*
     C           SMATY1    IFEQ *ZEROS
     C                     ADD  1         EC
     C                     MOVEA' 206'    ERR,EC
     C                     SETON                     31
     C                     ELSE
     C*
     C* Check valid date
     C*
     C                     MOVE SMATY1    DATEN   60
     C                     MOVE DATEN     DATEA   6
     C           SMATY1    IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 206'    ERR,EC
     C                     SETON                     31
     C                     ELSE
     C                     MOVE SMATY1    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 206'    ERR,EC
     C                     SETON                     31
     C                     ELSE
     C*                                                                   S01158
     C* Save the maturity date for later validation                       S01158
     C*                                                                   S01158
     C                     Z-ADDZDAYNO    MATDNO                          S01158
     C*
     C* Check not before run date
     C*
     C           SACTN     IFNE 'A'                                       054941
     C           ZDAYNO    ORNE MATY                                      054941
     C*                                                                   054941
     C           ZDAYNO    IFLE RUND
     C                     ADD  1         EC
     C                     MOVEA' 207'    ERR,EC
     C                     SETON                     31
     C                     END
     C*                                                                   054941
     C                     END                                            054941
     C*
     C* Check not before issue date (only in amend mode)
     C*
     C           SACTN     IFEQ 'A'
     C           ZDAYNO    ANDLEISSD
     C                     ADD  1         EC
     C                     MOVEA' 207'    ERR,EC
     C                     SETON                     31
     C                     END
     C/COPY WNCPYSRC,SE0040C020
     C*
     C* Check not holiday in value currency (nominal if blank)
     C*    WARNING ERROR ONLY - check only if changed
     C*
     C           SVLCY     IFNE '   '
     C                     MOVE SVLCY     ZCCY
     C                     ELSE
     C                     MOVE SNMCY     ZCCY
     C                     END
     C***********          EXSR ZDATE5                                    S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC
     C                     ADD  1         WEC
     C                     MOVEA' W01'    ERR,EC
     C                     SETON                     31
     C                     END
     C                     Z-ADDZDAYNO    HDAYNO
     C                     END
     C*
     C                     END
     C                     END
     C**                                                                  S01176
     C* Maturity Date Indicator                                           S01176
     C**                                                                  S01176
     C           *IN38     IFEQ '1'                                       S01176
     C           SMDTI1    IFNE 'A'                                       S01176
     C           SMDTI1    ANDNE'F'                                       S01176
     C                     ADD  1         EC                              S01176
     C                     MOVEA' 401'    ERR,EC                          S01176
     C                     SETON                     37                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C           SMDTI1    IFEQ 'F'                                       S01176
     C                     SETON                     18                   S01176
     C                     END                                            S01176
     C*
     C* Day basis
     C*
     C           SDYBS1    IFEQ ' '
     C                     ADD  1         EC
     C                     MOVEA' 208'    ERR,EC
     C                     SETON                     32
     C                     ELSE
     C*
     C           SDYBS1    IFNE '1'
     C           SDYBS1    ANDNE'2'
     C           SDYBS1    ANDNE'3'
     C           SDYBS1    ANDNE'4'
     C           SDYBS1    ANDNE'5'                                       E20085
     C           SDYBS1    ANDNE'6'
     C                     ADD  1         EC
     C                     MOVEA' 208'    ERR,EC
     C                     SETON                     32
     C                     END
     C           SDYBS1    IFEQ '4'                                       E20486
     C                     ADD  1         EC                              E20486
     C                     MOVEA' 266'    ERR,EC                          E20486
     C                     SETON                     32                   E20486
     C                     END                                            E20486
     C                     END
     C*
     C* Divisor basis
     C*
     C           SDVBS1    IFEQ ' '
     C                     ADD  1         EC
     C                     MOVEA' 209'    ERR,EC
     C                     SETON                     35
     C                     ELSE
     C*
     C/COPY WNCPYSRC,SE0040C067
     C           SDVBS1    IFNE '1'
     C           SDVBS1    ANDNE'2'
     C           SDVBS1    ANDNE'3'
     C                     ADD  1         EC
     C                     MOVEA' 209'    ERR,EC
     C                     SETON                     35
     C                     END
     C/COPY WNCPYSRC,SE0040C068
     C                     END
     C/COPY WNCPYSRC,SE0040C032
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      * If day basis or divisor basis amended, additional check           CSE007
      *                                                                   CSE007
     C           SDYBS1    IFNE DYBS                                      CSE007
     C           SDYBS1    ANDNELDYBS                                     CSE007
     C           SDVBS1    ORNE DVBS                                      CSE007
     C           SDVBS1    ANDNELDVBS                                     CSE007
      *                                                                   CSE007
     C                     MOVE SDYBS1    LDYBS   1                       CSE007
     C                     MOVE SDVBS1    LDVBS   1                       CSE007
     C                     MOVE 'B'       WPVREQ  1                       CSE007
     C                     MOVE *BLANKS   WPCCY   3                       CSE007
     C                     MOVE LCPN      WPDAT1  50                      CSE007
     C                     MOVEA*BLANKS   ERS                             CSE007
     C                     CALL 'SE0041'                                  CSE007
     C                     PARM           WPVREQ                          CSE007
     C                     PARM           SSESN                           CSE007
     C                     PARM           WPCCY                           CSE007
     C                     PARM           WPDAT1                          CSE007
     C                     PARM           ERS                             CSE007
      *                                                                   CSE007
     C           'W06'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     ADD  1         WEC                             CSE007
     C                     MOVEA' W06'    ERR,EC                          CSE007
     C                     SETON                     64  65               CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           'W07'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     ADD  1         WEC                             CSE007
     C                     MOVEA' W07'    ERR,EC                          CSE007
     C                     SETON                     64  65               CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           'W08'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     ADD  1         WEC                             CSE007
     C                     MOVEA' W08'    ERR,EC                          CSE007
     C                     SETON                     64  65               CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C**                                                                  S01176
     C* Contingency Liablility Indicator                                  S01176
     C**                                                                  S01176
     C           *IN19     IFEQ '0'                                       S01176
     C           SCNLI1    IFNE 'Y'                                       S01176
     C           SCNLI1    ANDNE'N'                                       S01176
     C                     ADD  1         EC                              S01176
     C                     MOVE ' 403'    ERR,EC                          S01176
     C                     SETON                     36                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Risk Customer                                                     S01176
     C*                                                                   S01176
     C           *IN38     IFEQ '1'                                       S01176
     C           SRSKC     ANDNE*BLANKS                                   S01176
     C*                                                                   S01176
     C**********           MOVE 'A'       RCDT                      S01176S01117
     C**********                                                    S01176S01117
     C***Chain*to Client using Short Name                           S01176S01117
     C**********                                                    S01176S01117
     C**********           MOVE *ZEROS    CSTNUM                                       S01176 CSD027
     C                     MOVE *BLANKS   CSTNUM                                              CSD027
     C********** SRSKC     CHAINSNAMEF               34             S01176S01117
     C********** *IN34     IFEQ '0'                                 S01176S01117
     C**********           TESTB'2'       CMIN           34         S01176S01117
     C**********                                                    S01176S01117
     C**********           ELSE                                     S01176S01117
     C**********                                                    S01176S01117
     C***Chain*to Client using Customer Number if Chain Failed      S01176S01117
     C**********                                                    S01176S01117
     C**********           MOVELSRSKC     KCNB    60                S01176S01117
     C********** CLTKEY    CHAINCLINTCBF             34             S01176S01117
     C********** *IN34     IFEQ '0'                                 S01176S01117
     C**********           TESTB'2'       CMIN           34         S01176S01117
     C**********           END                                      S01176S01117
     C**********           END                                      S01176S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSRSKC     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C***********@RTCD     IFEQ *BLANKS                             S01117E28570
     C***********          MOVELBBCUST    @KEYS   6                 S01117E28570
     C***********          CALL 'AOSECSR0'                          S01117E28570
     C***********          PARM *BLANKS   @RTCD                     S01117E28570
     C***********          PARM '*KEY   ' @OPTN                     S01117E28570
     C***********          PARM           @KEYS                     S01117E28570
     C***********SDSECS    PARM SDSECS    DSSDY                     S01117E28570
     C***********          END                                      S01117E28570
     C**                                                                  S01176
     C*  Invalid Client Reference, Deleted or a Parent                    S01176
     C**                                                                  S01176
     C********** *IN34     IFEQ '1'                                 S01176S01117
     C********** *IN34     OREQ '0'                                 S01176S01117
     C********** RECI      ANDEQ'*'                                 S01176S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBPAIN    OREQ 'P'                                       S01117
     C                     ADD  1         EC                              S01176
     C                     MOVEL' 404'    ERR,EC                          S01176
     C                     SETON                     50                   S01176
     C                     ELSE                                           S01176
     C**********           MOVE CNUM      CSTNUM                    S01176S01117
     C                     MOVELBBCUST    CSTNUM                    S01176S01117
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDINT - Subroutine to validate entries made on Interest     *
      *           Securities screen.                                  *
      *                                                               *
      *****************************************************************
      *
     C           VLDINT    BEGSR                           *** VLDINT ***
     C*
     C* Setof error indicators
     C*
     C                     MOVEA'00'      *IN,36                          S01176
     C                     MOVEA'0'       *IN,50                          S01176
     C                     MOVEA'00000000'*IN,52
     C                     MOVEA'00000000'*IN,60
     C                     MOVEA'00000000'*IN,68
     C                     MOVEA'00000000'*IN,76
     C                     MOVEA'000000'  *IN,84
     C*
     C* Coupon rate
     C*
     C           SCPNR     IFEQ *BLANKS
     C           SINCS     IFEQ 'C'                                       S01158
     C                     ADD  1         EC
     C                     MOVEA' 210'    ERR,EC
     C                     SETON                     83
     C                     END                                            S01158
     C                     Z-ADD0         CPNRAT                          S01158
     C                     ELSE
     C*
     C* Check valid signed number
     C*
     C                     MOVE SCPNR     ZFLD17
     C                     Z-ADD4         ZSDIG
     C                     Z-ADD7         ZSDEC
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 210'    ERR,EC
     C                     SETON                     83
     C                     ELSE
     C*
     C**If*Coupon*rate*0,*Day*basis*must*be*'4'*(unless*trade*basis*=*Y)**E20517
     C* If Coupon rate 0, Day basis SHOULD be '4' (unless trade basis = Y)E20517
     C*  (If the security is to be traded on an amortising book the DYBS  E20517
     C*   MAY NOT be '4' as SE2220 needs a DYBS to calculate amortisation)E20517
     C*
     C                     MOVE ZOUT15    CPNRAT 150
     C           CPNRAT    IFEQ *ZEROS
     C           SDYBS2    ANDNE'4'
     C           SINCS     ANDEQ'C'                                       E13941
     C           SSTBS     ANDNE'Y'                                       E17196
     C                     ADD  1         EC
     C                     ADD  1         WEC                             E20517
     C                     MOVEA' W02'    ERR,EC                          E20517
     C***********          MOVEA' 211'    ERR,EC                          E20517
     C                     SETON                     83
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0040C129
     C*
     C* Base rate code
     C*
     C           SBASC     IFNE '  '
     C                     SETOF                     3334                 S01176
     C*
     C* Assemble key
     C*
     C           SVLCY     IFNE *BLANKS
     C**********           MOVELSVLCY     WORK5   5                       S01117
     C                     MOVELSVLCY     CYCD                            S01117
     C                     ELSE
     C**********           MOVELSNMCY     WORK5                           S01117
     C                     MOVELSNMCY     CYCD                            S01117
     C                     END
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVE SBASC     WORK5                           S01117
     C                     MOVELSBASC     BSRC                            S01117
     C**********           MOVEL'21'      KEY12A                          S01117
     C**********           MOVE WORK5     KEY12A                          S01117
     C*
     C* Must exist on table
     C*
     C********** TABKA     SETLLTABLETKF                                  S01117
     C           BSRT      SETLL@BAREDH                                   S01117
     C           *IN33     DOWEQ'0'
     C********** TABKA     READETABLETKF                 33               S01117
     C           BSRT      READE@BAREDH                  33               S01117
     C           *IN33     IFEQ '0'
     C*
     C* Record found
     C*
     C                     MOVE '1'       *IN99                           S01176
     C*
     C* and not be deleted
     C*
     C********** RECI      IFNE '*'                                       S01117
     C**********           SETON                     34                   S01117
     C**********           END                                            S01117
     C                     END
     C                     END
     C*
     C           *IN99     IFEQ '0'                                       S01176
     C********** *IN99     OREQ '1'                                 S01176S01117
     C********** *IN34     ANDEQ'0'                                       S01117
     C                     ADD  1         EC
     C                     MOVEA' 212'    ERR,EC
     C                     SETON                     84
     C                     END
     C*
     C                     SETOF                     99                   S01176
     C*                                                                   S01176
     C                     END
     C*
     C* Base rate spread
     C*
     C           SBASS     IFNE *BLANKS
     C           SBASC     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 213'    ERR,EC
     C                     SETON                     85
     C                     END
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSBASS     ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD7         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 214'    ERR,EC
     C                     SETON                     85
     C                     END
     C*
     C                     END
     C*
     C* Spread indicator
     C*
     C           SSPRI     IFNE ' '
     C           SBASS     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 215'    ERR,EC
     C                     SETON                     86
     C                     ELSE
     C*
     C* Base rate spread must not be zero
     C*
     C                     MOVELZFIELD    WK08A   8
     C                     MOVE ZFIELD    WK08B   8
     C           WK08A     IFEQ '00000000'
     C           WK08B     ANDEQ'00000000'
     C                     ADD  1         EC
     C                     MOVEA' 215'    ERR,EC
     C                     SETON                     86
     C                     END
     C                     END
     C*
     C           SSPRI     IFNE 'A'
     C           SSPRI     ANDNE'S'
     C           SSPRI     ANDNE'P'
     C/COPY WNCPYSRC,SE0040C074
     C                     ADD  1         EC
     C                     MOVEA' 216'    ERR,EC
     C                     SETON                     86
     C                     END
     C*
     C                     ELSE
     C           SBASS     IFNE *BLANKS
     C                     MOVE 'A'       SSPRI
     C                     END
     C*
     C                     END
     C*
     C* Minimum coupon
     C*
     C           SMCPN     IFNE *BLANKS
     C*
     C* Check valid signed number
     C*
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVE SMCPN     ZFLD17
     C                     Z-ADD4         ZSDIG
     C                     Z-ADD7         ZSDEC
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 217'    ERR,EC
     C                     SETON                     87
     C                     ELSE
     C*
     C* Must not be greater than Coupon rate
     C*
     C                     MOVE ZOUT15    MINCPN 150
     C           MINCPN    IFGT CPNRAT
     C                     ADD  1         EC
     C                     MOVEA' 218'    ERR,EC
     C                     SETON                     87
     C                     END
     C                     END
     C                     END
     C*
     C* Maturity date
     C*
     C           SMATY2    IFEQ *BLANKS
     C           SINCS     IFEQ 'C'                                       S01158
     C                     ADD  1         EC
     C                     MOVEA' 219'    ERR,EC
     C                     SETON                     88
     C                     END                                            S01158
     C                     ELSE
     C*
     C* Trade basis must be 'P' if Maturity date '999999'
     C*
     C           SMATY2    IFEQ '999999'
     C           SSTBS     IFNE 'P'
     C           SSYBS     ANDNE'AU'                                      S01397
     C                     ADD  1         EC
     C                     MOVEA' 220'    ERR,EC
     C                     SETON                     88
     C                     END
     C                     Z-ADD99999     MATDNO
     C                     ELSE
     C*
     C* Check valid date
     C*
     C                     MOVE SMATY2    DATEN
     C                     MOVE DATEN     DATEA
     C           SMATY2    IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 219'    ERR,EC
     C                     SETON                     88
     C                     ELSE
     C                     MOVE SMATY2    ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 219'    ERR,EC
     C                     SETON                     88
     C                     END
     C                     END
     C*
     C* If Long-Term Maturity Indicator is on, add 100 years worth of
     C* days to get same date next century
     C*
     C           SLTMI     IFEQ 'Y'
     C                     ADD  36525     ZDAYNO
     C                     END
     C*
     C* Must not be less than run date
     C*
     C           SMATY2    IFNE '999999'
     C           ZDAYNO    ANDLERUND
     C           SLTMI     ANDNE'Y'
     C                     ADD  1         EC
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP21                                           S01408
     C*                                                                   S01408
     C                     MOVEA' 221'    ERR,EC
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP22                                           S01408
     C*                                                                   S01408
     C                     SETON                     88
     C                     END
     C/COPY WNCPYSRC,SE0040C021
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C/COPY WNCPYSRC,SE0040C144
      *                                                                   CSE007
      * if amended, perform extra validation                              CSE007
      * (and long term indicator if = N, because it's no reason           CSE007
      * to check, if exist some trade or event with value date *GT        CSE007
      * then so big datum. Datum like this will be also *GT then          CSE007
      * next working day.                                                 CSE007
     C           ZDAYNO    ADD  36525     WWDAY   50                      CSE007
      *                                                                   CSE007
     C           SACTN     IFEQ 'A'                                       CSE007
     C           ZDAYNO    ANDNEMATY                                      CSE007
     C           WWDAY     ANDNEMATY                                      CSE007
     C           SLTMI     ANDNE'Y'                                       CSE007
     C                     MOVE 'M'       WPVREQ                          CSE007
     C                     MOVE *BLANKS   WPCCY                           CSE007
     C                     MOVE ZDAYNO    WPDAT1                          CSE007
     C                     MOVEA*BLANKS   ERS                             CSE007
     C                     CALL 'SE0041'                                  CSE007
     C                     PARM           WPVREQ                          CSE007
     C                     PARM           SSESN                           CSE007
     C                     PARM           WPCCY                           CSE007
     C                     PARM           WPDAT1                          CSE007
     C                     PARM           ERS                             CSE007
      *                                                                   CSE007
     C           '500'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     MOVEA' 500'    ERR,EC                          CSE007
     C                     SETON                     88                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           '501'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     MOVEA' 501'    ERR,EC                          CSE007
     C                     SETON                     88                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           '502'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     MOVEA' 502'    ERR,EC                          CSE007
     C                     SETON                     88                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           '503'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     MOVEA' 503'    ERR,EC                          CSE007
     C                     SETON                     88                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           WPDAT1    IFLE BJDNWD                                    CSE007
     C                     ADD  1         EC                              CSE007
     C**********           MOVEA' 504'    ERR,EC                                       CSE007 225160
     C                     MOVEA' 512'    ERR,EC                                              225160
     C                     SETON                     88                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           '506'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     MOVEA' 506'    ERR,EC                          CSE007
     C                     SETON                     88                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*
     C* Check not holiday in value currency (nominal if blank)
     C*    WARNING ERROR ONLY - check only if changed
     C*
     C           SVLCY     IFNE '   '
     C                     MOVE SVLCY     ZCCY
     C                     ELSE
     C                     MOVE SNMCY     ZCCY
     C                     END
     C***********          EXSR ZDATE5                                    S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC
     C                     ADD  1         WEC
     C***********          MOVEA' W02'    ERR,EC                          E19836
     C                     MOVEA' W01'    ERR,EC                          E19836
     C                     SETON                     88
     C                     END
     C                     Z-ADDZDAYNO    LDAYNO
     C                     Z-ADDZDAYNO    MATDNO
     C*
     C                     END
     C                     END
     C**                                                                  S01176
     C* Maturity Date Indicator                                           S01176
     C**                                                                  S01176
     C           *IN38     IFEQ '1'                                       S01176
     C           SMDTI2    IFNE 'A'                                       S01176
     C           SMDTI2    ANDNE'F'                                       S01176
     C                     ADD  1         EC                              S01176
     C                     MOVEA' 401'    ERR,EC                          S01176
     C                     SETON                     37                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           SMATY2    IFEQ '999999'                                  S01176
     C           SMDTI2    ANDEQ'F'                                       S01176
     C                     ADD  1         EC                              S01176
     C                     MOVEA' 402'    ERR,EC                          S01176
     C                     SETON                     37                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           SMDTI2    IFEQ 'F'                                       S01176
     C                     SETON                     18                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C* Long Term Maturity Indicator
     C*
     C           SLTMI     IFEQ 'Y'
     C           SMATY2    ANDEQ'999999'
     C                     ADD  1         EC
     C                     MOVE ' 222'    ERR,EC
     C                     SETON                     89
     C                     END
     C*
     C           SLTMI     IFNE 'Y'
     C           SLTMI     ANDNE'N'
     C           SLTMI     ANDNE' '
     C                     ADD  1         EC
     C                     MOVE ' 223'    ERR,EC
     C                     SETON                     89
     C                     END
     C*
     C* Day Basis
     C*
     C           SDYBS2    IFEQ ' '
     C           SINCS     IFEQ 'C'                                       S01158
     C                     ADD  1         EC
     C                     MOVEA' 224'    ERR,EC
     C                     SETON                     64
     C                     END                                            S01158
     C                     ELSE
     C*
     C           SDYBS2    IFNE '1'
     C           SDYBS2    ANDNE'2'
     C           SDYBS2    ANDNE'3'
     C           SDYBS2    ANDNE'4'
     C           SDYBS2    ANDNE'5'                                       E20085
     C           SDYBS2    ANDNE'6'
     C                     ADD  1         EC
     C                     MOVEA' 225'    ERR,EC
     C                     SETON                     64
     C                     END
     C*
     C*      Yield based securities, with day basis of '4'                E25521
     C*        are not allowed.                                           E25521
     C*                                                                   E25521
     C           SINCS     IFEQ 'C'                                       E25521
     C           SSTBS     ANDEQ'Y'                                       E25521
     C           SDYBS2    ANDEQ'4'                                       E25521
     C                     ADD  1         EC                              E25521
     C                     MOVEA' 211'    ERR,EC                          E25521
     C                     SETON                     64                   E25521
     C                     END                                            E25521
     C*                                                                   E25521
     C                     END
     C*
     C* Divisor Basis
     C*
     C           SDVBS2    IFEQ ' '
     C           SINCS     IFEQ 'C'                                       S01158
     C***********CPNRAT    ANDNE*ZEROS                            E14204  054084
     C           SDYBS2    ANDNE*ZEROS                                    054084
     C                     ADD  1         EC
     C                     MOVEA' 226'    ERR,EC
     C                     SETON                     65
     C                     END                                            S01158
     C*                                                                   E25521
     C*      Zero coupon bonds with yield basis of 'DA' or 'A' are        E25521
     C*  possible if the day basis is NOT '4' and the divisor basis       E25521
     C*  'IS' specified.                                                  E25521
     C           CPNRAT    IFEQ *ZEROS                                    E25521
     C           SSYBS     IFEQ 'DA'                                      E25521
     C           SSYBS     OREQ 'A '                                      E25521
     C                     ADD  1         EC                              E25521
     C                     MOVEA' 280'    ERR,EC                          E25521
     C                     SETON                     65                   E25521
     C                     END                                            E25521
     C                     END                                            E25521
     C*                                                                   E25521
     C                     ELSE
     C*
     C           SDVBS2    IFNE '1'
     C           SDVBS2    ANDNE'2'
     C           SDVBS2    ANDNE'3'
     C           SDVBS2    ANDNE'5'
     C                     ADD  1         EC
     C                     MOVEA' 227'    ERR,EC
     C                     SETON                     65
     C                     END
     C*
     C                     END
     C*
     C*      Zero coupon yield based securities are only possible if      E25521
     C*  the yield basis is 'DA' or 'A'.                                  E25521
     C           CPNRAT    IFEQ *ZEROS                                    E25521
     C           SSTBS     ANDEQ'Y'                                       E25521
     C           SSYBS     ANDNE'DA'                                      E25521
     C           SSYBS     ANDNE'A '                                      E25521
     C           SSYBS     ANDNE'AU'                                      110945
     C                     ADD  1         EC                              E25521
     C                     MOVEA' 281'    ERR,EC                          E25521
     C                     SETON                     65                   E25521
     C                     END                                            E25521
     C/COPY WNCPYSRC,SE0040C033
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      * If day basis or divisor basis amended, additional check           CSE007
      *                                                                   CSE007
     C           SDYBS2    IFNE DYBS                                      CSE007
     C           SDYBS2    ANDNELDYBS                                     CSE007
     C           SDVBS2    ORNE DVBS                                      CSE007
     C           SDVBS2    ANDNELDVBS                                     CSE007
      *                                                                   CSE007
     C                     MOVE SDYBS2    LDYBS   1                       CSE007
     C                     MOVE SDVBS2    LDVBS   1                       CSE007
     C                     MOVE 'B'       WPVREQ                          CSE007
     C                     MOVE *BLANKS   WPCCY                           CSE007
     C                     MOVE LCPN      WPDAT1                          CSE007
     C                     MOVEA*BLANKS   ERS                             CSE007
     C                     CALL 'SE0041'                                  CSE007
     C                     PARM           WPVREQ                          CSE007
     C                     PARM           SSESN                           CSE007
     C                     PARM           WPCCY                           CSE007
     C                     PARM           WPDAT1                          CSE007
     C                     PARM           ERS                             CSE007
      *                                                                   CSE007
     C           'W06'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     ADD  1         WEC                             CSE007
     C                     MOVEA' W06'    ERR,EC                          CSE007
     C                     SETON                     64  65               CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           'W07'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     ADD  1         WEC                             CSE007
     C                     MOVEA' W07'    ERR,EC                          CSE007
     C                     SETON                     64  65               CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C           'W08'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     ADD  1         WEC                             CSE007
     C                     MOVEA' W08'    ERR,EC                          CSE007
     C                     SETON                     64  65               CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*
     C* Interest Adjustments
     C*
     C           SIADJ     IFNE *BLANKS
     C*
     C* Check valid signed number
     C*
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVELSIADJ     ZFLD17
     C                     Z-ADD3         ZSDIG
     C                     Z-ADD*ZERO     ZSDEC
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 228'    ERR,EC
     C                     SETON                     66
     C/COPY WNCPYSRC,SE0040C077
     C                     END
     C                     END
     C*
     C* Initial date
     C*
     C           SITLD     IFEQ *BLANKS
     C           SINCS     IFEQ 'C'                                       S01158
     C           CPNRAT    ANDNE*ZEROS                                    E14204
     C                     ADD  1         EC
     C                     MOVE ' 229'    ERR,EC
     C                     SETON                     67
     C                     END                                            S01158
     C                     ELSE
     C*
     C* Check valid date
     C*
     C                     MOVE SITLD     DATEN
     C                     MOVE DATEN     DATEA
     C           SITLD     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 229'    ERR,EC
     C                     SETON                     67
     C                     ELSE
     C                     MOVE SITLD     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVE ' 229'    ERR,EC
     C                     SETON                     67
     C                     ELSE
     C*
     C* Must not be greater than maturity date
     C*
     C                     Z-ADDZDAYNO    ITLDNO
     C           ZDAYNO    IFGE MATDNO
     C                     ADD  1         EC
     C                     MOVEA' 230'    ERR,EC
     C                     SETON                     67
     C                     END
     C*
     C* Must be greater than issue date  (Amend mode only)
     C*
     C           SACTN     IFEQ 'A'
     C           NEWISS    ANDEQ'Y'                                       E19869
     C           ZDAYNO    ANDLTISSD
     C                     ADD  1         EC
     C                     MOVEA' 230'    ERR,EC
     C                     SETON                     67
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     END
     C**                                                                  S01176
     C* Contingent Liablility Indicator                                   S01176
     C**                                                                  S01176
     C           SCNLI2    IFNE 'Y'                                       S01176
     C           SCNLI2    ANDNE'N'                                       S01176
     C                     ADD  1         EC                              S01176
     C                     MOVE ' 403'    ERR,EC                          S01176
     C                     SETON                     36                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Risk Customer                                                     S01176
     C*                                                                   S01176
     C           *IN38     IFEQ '1'                                       S01176
     C           SRSKC     ANDNE*BLANKS                                   S01176
     C*                                                                   S01176
     C**********           MOVE *ZEROS    CSTNUM  60                                   S01176 CSD027
     C                     MOVE *BLANKS   CSTNUM  6                                           CSD027
     C**********                                                    S01176S01117
     C***Chain*to Client using Short Name                           S01176S01117
     C**********                                                    S01176S01117
     C********** SRSKC     CHAINSNAMEF               34             S01176S01117
     C********** *IN34     IFEQ '0'                                 S01176S01117
     C**********           TESTB'2'       CMIN           34         S01176S01117
     C**********                                                    S01176S01117
     C**********           ELSE                                     S01176S01117
     C**********                                                    S01176S01117
     C***Chain*to Client using Customer Number if Chain Failed      S01176S01117
     C**********                                                    S01176S01117
     C**********           MOVE 'A'       RCDT                      S01176S01117
     C**********           MOVELSRSKC     KCNB                      S01176S01117
     C********** CLTKEY    CHAINCLINTCBF             34             S01176S01117
     C********** *IN34     IFEQ '0'                                 S01176S01117
     C**********           TESTB'2'       CMIN           34         S01176S01117
     C**********           END                                      S01176S01117
     C**********           END                                      S01176S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSRSKC     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** @RTCD     IFEQ *BLANKS                                                S01117 261063
     C**********           MOVELBBCUST    @KEYS   6                                    S01117 261063
     C**********           CALL 'AOSECSR0'                                             S01117 261063
     C**********           PARM *BLANKS   @RTCD                                        S01117 261063
     C**********           PARM '*KEY   ' @OPTN                                        S01117 261063
     C**********           PARM           @KEYS                                        S01117 261063
     C********** SDSECS    PARM SDSECS    DSSDY                                        S01117 261063
     C**********           END                                                         S01117 261063
     C**                                                                  S01176
     C*  Invalid Client Reference, Deleted or a Parent                    S01176
     C**                                                                  S01176
     C********** *IN34     IFEQ '1'                                 S01176S01117
     C********** *IN34     OREQ '0'                                 S01176S01117
     C********** RECI      ANDEQ'*'                                 S01176S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBPAIN    OREQ 'P'                                       S01117
     C                     ADD  1         EC                              S01176
     C                     MOVEL' 404'    ERR,EC                          S01176
     C                     SETON                     50                   S01176
     C                     ELSE                                           S01176
     C**********           MOVE CNUM      CSTNUM                    S01176S01117
     C                     MOVELBBCUST    CSTNUM                    S01176S01117
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C* First Coupon Date
     C*
     C           SFCPN     IFNE *BLANKS
     C*
     C* If Coupon rate is zero, entry not allowed
     C*
     C           CPNRAT    IFEQ *ZEROS
     C                     ADD  1         EC         68
      **********         * MOVEA' 264'    ERR,EC                          110945
     C                     ADD  1         WEC                             110945
     C                     MOVEA' W03'    ERR,EC                          110945
     C                     END
     C*
     C* Check valid date
     C*
     C                     MOVE SFCPN     DATEN
     C                     MOVE DATEN     DATEA
     C           SFCPN     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 231'    ERR,EC
     C                     SETON                     68
     C                     ELSE
     C                     MOVE SFCPN     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 231'    ERR,EC
     C                     SETON                     68
     C                     ELSE
     C*                                                                   CSE005
     C* if processing type is 3 and switch CSE005 is on                   CSE005
     C* then ensure that first coupon is not holiday                      CSE005
     C*                                                                   CSE005
     C           PROT      IFEQ '3'                                       CSE005
     C           CSE005    ANDEQ'Y'                                       CSE005
     C           SBCNV     ANDNE' '                                       196020
     C*                                                                   CSE005
     C* If the first coupon date is a holiday in nominal currency         CSE005
     C* then update it to be the next working day                         CSE005
     C* saving and restoring ZCCY and ZLOC                                CSE005
     C*                                                                   CSE005
     C           *LIKE     DEFN ZCCY      ZCCYXX                          CSE005
     C           *LIKE     DEFN ZLOC      ZLOCXX                          CSE005
     C                     MOVE ZCCY      ZCCYXX    P                     CSE005
     C                     MOVE ZLOC      ZLOCXX    P                     CSE005
     C                     MOVE SNMCY     ZCCY                            CSE005
     C                     MOVE '   '     ZLOC                            CSE005
     C*                                                                   CSE005
     C                     EXSR ZCHKH                                     CSE005
     C           ZIND      IFEQ 'H'                                       CSE005
     C                     Z-ADD1         ZNRDYS  20                      CSE005
     C                     EXSR ZFWDT                                     CSE005
     C                     Z-ADDZDYNBR    ZDAYNO                          CSE005
     C                     EXSR ZDATE2                                    CSE005
     C                     MOVE ZDATE     SFCPN                           CSE005
     C                     ENDIF                                          CSE005
     C*                                                                   CSE005
     C                     MOVE ZCCYXX    ZCCY      P                     CSE005
     C                     MOVE ZLOCXX    ZLOC      P                     CSE005
     C*                                                                   CSE005
     C                     ENDIF                                          CSE005
     C*
     C* Must be after initial date and before maturity date
     C*
     C           ZDAYNO    IFLE ITLDNO
     C           ZDAYNO    ORGT MATDNO
     C                     ADD  1         EC
     C                     MOVEA' 232'    ERR,EC
     C                     SETON                     68
     C                     END
     C*
     C* Day/month must correspond to 1 Coupon rate/day entered
      ***  The First Coupon Date doesn't need to correspond to a Coupon   E28357
      ***  Date from the array, therefore changed to Warning Message.     E28357
     C*
     C                     Z-ADD1         X
     C           VITAG1    TAG                             ** VITAG1 TAG *
     C                     MOVELSFCPN     WORK4A  4
     C**                                                                  E13953
     C**  INCORRECT TREATMENT OF DATE FORMAT M CAUSES                     E13953
     C**  REJECTION OF VALID FIRST COUPON DATE                            E13953
     C************IN98     IFEQ '1'                                       E13953
     C***********          MOVE WORK4A    WORK2A  2                       E13953
     C***********          MOVELWORK2A    WORK4A                          E13953
     C***********          MOVELSFCPN     WORK2A                          E13953
     C***********          MOVE WORK2A    WORK4A                          E13953
     C***********          END                                            E13953
     C**                                                                  E13953
     C           WORK4A    LOKUPSCD,X                    33
     C           *IN33     IFEQ '1'
     C           SCR,X     IFEQ 'R'
     C                     ADD  1         X
     C                     GOTO VITAG1
     C                     END
     C                     END
     C*
     C           *IN33     IFEQ '0'
     C                     ADD  1         EC
     C                     ADD  1         WEC                             E28357
     C***********          MOVEA' 233'    ERR,EC                          E28357
     C                     MOVEA' W03'    ERR,EC                          E28357
     C                     SETON                     68
     C                     END
     C                     END
     C*
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0040C109
     C*
     C* Coupon Rate/Days
     C*
     C* Must be entered if security complete and not flat
     C*
     C                     SETOF                     3334                 S01176
     C                     MOVEASCD       WORK48 48
     C           WORK48    IFEQ *BLANKS
     C*
     C           SINCS     IFEQ 'C'
     C*
     C           CPNRAT    IFNE *ZEROS
     C                     ADD  1         EC
     C                     MOVEA' 234'    ERR,EC
     C                     SETON                     52
     C                     END
     C*
     C* or has a divisor basis of '5'
     C*
     C           SDVBS2    IFEQ '5'
     C                     ADD  1         EC
     C                     MOVEA' 234'    ERR,EC
     C                     SETON                     52
     C                     END
     C*
     C                     END
     C*
     C                     ELSE
     C*
     C                     Z-ADD*ZEROS    LDAT
     C                     Z-ADD*ZEROS    NDAT
     C                     Z-ADD1         X
     C                     DO   12        X
     C           SCD,X     IFNE *BLANKS
     C           X         IFGT 1
     C                     SUB  1         X
     C           SCD,X     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 235'    ERR,EC
     C           52        ADD  X         Y       20
     C                     MOVEA'1'       *IN,Y
     C                     END
     C                     ADD  1         X
     C                     END
     C*
     C* Entry made (for Coupon Rate/Days) with a zero Coupon rate.        S01158
     C*
     C           SCD,X     IFNE *BLANKS
     C           CPNRAT    ANDEQ*ZEROS
     C                     ADD  1         EC
      **********         * MOVEA' 265'    ERR,EC                          110945
     C                     ADD  1         WEC                             110945
     C                     MOVEA' W03'    ERR,EC                          110945
     C***********52        ADD  X         Y       20                      E21570
     C           51        ADD  X         Y       20                      E21570
     C                     MOVEA'1'       *IN,Y
     C                     END
     C*
     C* *IN98 DDMM or MMDD format from P/ZSYSTM
     C*
     C           *IN98     IFEQ '1'
     C                     MOVELSCD,X     MONTH
     C                     MOVE SCD,X     DAY
     C                     ELSE
     C                     MOVE SCD,X     MONTH
     C                     MOVELSCD,X     DAY
     C                     END
     C*
     C* Check entry is valid
     C*
     C           MONTH     LOKUPTABMTH    TABDAY         33
     C   33      DAY       COMP TABDAY                 3333
     C   33      DAY       COMP *ZEROS               33
     C           *IN33     IFEQ '0'
     C                     ADD  1         EC
     C                     MOVEA' 236'    ERR,EC
     C           51        ADD  X         Y
     C                     MOVEA'1'       *IN,Y
     C                     END
     C                     SETOF                     33                   S01176
     C*
     C* Cannot be earlier than preceding rate/day
     C*
     C                     MOVELMONTH     NDAT
     C                     MOVE DAY       NDAT
     C           NDAT      IFLE LDAT
     C                     ADD  1         EC
     C                     MOVEA' 237'    ERR,EC
     C           51        ADD  X         Y
     C                     MOVEA'1'       *IN,Y
     C                     END
     C                     Z-ADDNDAT      LDAT
     C*
     C* Coupon Rate Indicator
     C*
     C* Must be entered if corresponding rate/day entered
     C*
     C           SCR,X     IFEQ ' '
     C                     ADD  1         EC
     C                     MOVEA' 238'    ERR,EC
     C           68        ADD  X         Y
     C                     MOVEA'1'       *IN,Y
     C                     ELSE
     C*
     C**If*processing*type*not*'3',*entry*must*be*'P'******************   E19751
     C* If processing type not 3,5 or 8 (FRNs,Yen Bonds,Mortgage Backed)  E19751
     C*        entry must be 'P'.                                         E19751
     C*
     C           PROT      IFNE '3'
     C           PROT      ANDNE'5'                                       E19751
     C           PROT      ANDNE'8'                                       E19751
     C           SCR,X     IFNE 'P'
     C                     ADD  1         EC
     C                     MOVEA' 239'    ERR,EC
     C           68        ADD  X         Y
     C                     MOVEA'1'       *IN,Y
     C                     END
     C                     ELSE
     C*
     C******Processing*type*'3'****************************************   E19751
     C* Processing type '3','5' and '8'                                   E19751
     C*
     C           SCR,X     IFNE 'P'
     C           SCR,X     ANDNE'R'
     C           SCR,X     ANDNE'C'
     C                     ADD  1         EC
     C                     MOVEA' 239'    ERR,EC
     C           68        ADD  X         Y
     C                     MOVEA'1'       *IN,Y
     C                     END
     C*
     C* all entries cannot be 'R'
     C*
     C           SCR,X     IFEQ 'R'
     C                     SETON                     33                   S01176
     C                     ELSE
     C                     SETON                     34                   S01176
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
      *
      * IF SCR,X NOT BLANK AND SCD,X EQUAL 0 IT IS AN ERROR              091865
     C           SCR,X     IFNE ' '                                      091865
     C           SCD,X     ANDEQ*BLANKS                                  091865
     C                     ADD  1         EC                             091865
     C                     MOVEA' 238'    ERR,EC                         091865
     C           68        ADD  X         Y                              091865
     C                     MOVEA'1'       *IN,Y                          091865
     C                     END                                           091865
      *
     C                     END
     C*
     C   33N34             DO                                             S01176
     C                     ADD  1         EC
     C                     MOVEA' 241'    ERR,EC
     C                     SETON                     69
     C                     END
     C*                                                                   CSE005
     C* If CSE005 is switched on and processing type is '3'               CSE005
     C* then count the number of entries in CR array                      CSE005
     C*                                                                   CSE005
     C           PROT      IFEQ '3'                                       CSE005
     C           CSE005    ANDEQ'Y'                                       CSE005
     C                     Z-ADD0         COUNT   20                      CSE005
     C*                                                                   CSE005
     C           1         DO   12        POS     20                      CSE005
     C           SCR,POS   IFEQ 'P'                                       CSE005
     C           SCR,POS   OREQ 'C'                                       CSE005
     C                     ADD  1         COUNT                           CSE005
     C                     ENDIF                                          CSE005
     C                     ENDDO                                          CSE005
     C*                                                                   CSE005
     C* if no.'P' or 'C' entries is not 1,2,4,6 or 12 then:               CSE005
     C*      turn on *IN52 to display field input error,                  CSE005
     C*      add 1 to EC and set error code to be 268                     CSE005
     C*                                                                   CSE005
     C           COUNT     IFNE 1                                         CSE005
     C           COUNT     ANDNE2                                         CSE005
     C           COUNT     ANDNE4                                         CSE005
     C           COUNT     ANDNE6                                         CSE005
     C           COUNT     ANDNE12                                        CSE005
     C                     MOVE *ON       *IN52                           CSE005
     C                     ADD  1         EC                              CSE005
     C                     MOVEA' 268'    ERR,EC                          CSE005
     C                     ENDIF                                          CSE005
     C*                                                                   CSE005
     C                     ENDIF                                          CSE005
     C*
     C                     END
     C*
     C* Rate Change Frequency
     C*
     C           SRCFQ     IFNE ' '
     C           *IN33     IFEQ '1'                                       S01176
     C                     ADD  1         EC
     C                     MOVEA' 242'    ERR,EC
     C                     SETON                     81
     C                     END
     C*
     C           SRCFQ     IFNE 'D'
     C           SRCFQ     ANDNE'F'
     C           SRCFQ     ANDNE'M'
     C           SRCFQ     ANDNE'W'
     C                     ADD  1         EC
     C                     MOVEA' 243'    ERR,EC
     C                     SETON                     81
     C                     END
     C*
     C                     END
     C*
     C* Next Change Date
     C*
     C           SNCHD     IFNE *BLANKS
     C           SRCFQ     IFEQ ' '
     C                     ADD  1         EC
     C                     MOVEA' 244'    ERR,EC
     C                     SETON                     82
     C                     END
     C*
     C* Check valid date
     C*
     C                     MOVE SNCHD     DATEN
     C                     MOVE DATEN     DATEA
     C           SNCHD     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 245'    ERR,EC
     C                     SETON                     82
     C                     ELSE
     C                     MOVE SNCHD     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 245'    ERR,EC
     C                     SETON                     82
     C                     ELSE
     C*
     C* Must be greater than run date
     C*
     C           ZDAYNO    IFLE RUND
     C                     ADD  1         EC
     C                     MOVEA' 245'    ERR,EC
     C                     SETON                     82
     C                     END
     C                     END
     C                     END
     C*
     C                     ELSE
     C*
     C* If date blank, frequency must also be blank
     C*
     C           SRCFQ     IFNE ' '
     C                     ADD  1         EC
     C                     MOVEA' 245'    ERR,EC
     C                     SETON                     82
     C                     END
     C*
     C                     END
     C*                                                                   CSE005
     C* If CSE005 is on, the field 'Business Day Convention' is           CSE005
     C* mandatory entry with values F, C or M                             CSE005
     C*                                                                   CSE005
     C           SBCNV     IFNE 'F'                                       CSE005
     C           SBCNV     ANDNE'C'                                       CSE005
     C           SBCNV     ANDNE'M'                                       CSE005
     C           SBCNV     ANDNE' '                                       196020
     C           CSE005    ANDEQ'Y'                                       CSE005
     C           PROT      ANDEQ'3'                                       CSE005
     C                     ADD  1         EC                              CSE005
     C                     MOVEA' 267'    ERR,EC                          CSE005
     C                     SETON                     55                   CSE005
     C                     ENDIF                                          CSE005
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDITL - Subroutine to validate entries made on the initial  *
      *           screen.                                             *
      *                                                               *
      *****************************************************************
      *
     C           VLDITL    BEGSR                           *** VLDITL  ***
     C*
     C* Setof error indicators
     C*
     C                     SETOF                     09
     C                     Z-ADD*ZEROS    EC
     C                     Z-ADD*ZEROS    WEC
     C                     MOVE *BLANKS   ERRMSG
     C                     MOVEA'00000000'*IN,50
     C                     MOVEA'00000000'*IN,58
     C                     MOVEA'000'     *IN,66
     C                     MOVEA'0'       *IN,74                          183604
     C/COPY WNCPYSRC,SE0040C045
     C*
     C* Incomplete indicator - check 'I' or 'C', if ' ' default to 'C'
     C*
     C           SINCS     IFEQ ' '
     C                     MOVE 'C'       SINCS
     C                     END
     C*
     C           SINCS     IFNE 'I'
     C           SINCS     ANDNE'C'
     C                     ADD  1         EC
     C                     MOVEA' 106'    ERR,EC
     C                     SETON                     52
     C                     END
     C*
     C* Security report name
     C*
     C           SSRPN     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 107'    ERR,EC
     C                     SETON                     53
     C                     END
     C*
     C* Nominal currency
     C*
     C           SNMCY     IFEQ '   '
     C                     ADD  1         EC
     C                     MOVEA' 109'    ERR,EC
     C                     SETON                     54
     C                     END
     C*
     C* Investment type
     C*
     C           SSITP     IFEQ '   '
     C                     ADD  1         EC
     C                     MOVEA' 110'    ERR,EC
     C                     SETON                     55
     C                     END
     C*
     C* Must exist on file (with nominal currency)
     C*
     C           ITPKA     CHAININVTPDF              33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 111'    ERR,EC
     C                     SETON                     5455
     C                     ELSE
     C*
     C* and not be deleted record
     C*
     C           RECI      IFEQ '*'
     C                     ADD  1         EC
     C                     MOVEA' 111'    ERR,EC
     C                     SETON                     5455
     C                     END
     C                     END
     C*
     C* Industry code
     C*
     C           SSIDY     IFNE '   '
     C           SSIDY     OREQ '   '                                     183604
     C           BGN4ST    ANDEQ'Y'                                       183604
     C*
     C* Must exist on table
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVEL'61'      KEY12A                          S01117
     C**********           MOVE SSIDY     KEY12A                          S01117
     C********** TABKA     CHAINTABLETNF             33                   S01117
     C                     CALL 'AOINDSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SSIDY     @KEYI   3                       S01117
     C           SDINDS    PARM SDINDS    DSFDY                           S01117
     C********** *IN33     IFEQ '1'                                       S01117
     C**********           ADD  1         EC                              S01117
     C**********           MOVEA' 112'    ERR,EC                          S01117
     C**********           SETON                     56                   S01117
     C**********           ELSE                                           S01117
     C*
     C* and not be deleted record
     C*
     C********** RECI      IFEQ '*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC
     C           SSIDY     IFEQ '   '                                     183604
     C                     MOVEA' 601'    ERR,EC                          183604
     C                     ELSE                                           183604
     C                     MOVEA' 112'    ERR,EC
     C                     ENDIF                                          183604
     C                     SETON                     56
     C**********           END                                            S01117
     C                     END
     C                     END
     C*
     C* Value currency
     C*
     C           SVLCY     IFNE *BLANKS
     C*
     C**Must*exist*on*table***********************************************S01117
     C* Must exist on PF/SDCURRPD                                         S01117
     C*
     C*
     C***********          MOVE *BLANKS   KEY12A                          S01117
     C***********          MOVELSVLCY     WORK4                           S01117
     C***********          MOVE '1'       WORK4                           S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4     KEY12A                          S01117
     C***********TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SVLCY     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C************IN33     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC
     C                     MOVEA' 114'    ERR,EC
     C                     SETON                     57
     C                     ELSE
     C*
     C**and*not*be*deleted*record*****************************************S01117
     C***********                                                         S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********DCCY      OREQ 'N'                                 E17197S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEA' 114'    ERR,EC                          S01117
     C***********          SETON                     57                   S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C           SVLCY     IFNE A6CYCD                                    S01117
     C                     MOVE A6CYCD    SVLCY                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C* and be a dealing currency                                         S01117
     C*                                                                   S01117
     C           A6DLCI    IFNE 'Y'                                       S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 314'    ERR,EC                          S01117
     C                     SETON                     57                   S01117
     C                     END                                            S01117
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0040C034
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      * and if amended, perform extra validation                          CSE007
     C           SVLCY     IFNE VLCY                                      CSE007
     C           SVLCY     ANDNELVLCY                                     CSE007
      *                                                                   CSE007
     C                     MOVE SVLCY     LVLCY                           CSE007
     C                     MOVE 'V'       WPVREQ                          CSE007
     C                     MOVE SVLCY     WPCCY                           CSE007
     C                     MOVE *ZEROS    WPDAT1                          CSE007
     C                     MOVEA*BLANKS   ERS                             CSE007
     C                     CALL 'SE0041'                                  CSE007
     C                     PARM           WPVREQ  1                       CSE007
     C                     PARM           SSESN                           CSE007
     C                     PARM           WPCCY                           CSE007
     C                     PARM           WPDAT1                          CSE007
     C                     PARM           ERS                             CSE007
      *                                                                   CSE007
     C           'W05'     LOKUPERS                      33               CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C                     ADD  1         EC                              CSE007
     C                     MOVEA' W05'    ERR,EC                          CSE007
     C                     SETON                     57                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*
     C* Multi-currency indicator
     C*
     C           SMLTI     IFNE ' '
     C           SMLTI     ANDNE'Y'
     C           SMLTI     ANDNE'N'
     C                     ADD  1         EC
     C                     MOVEA' 115'    ERR,EC
     C                     SETON                     58
     C                     END
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0040CVSF                                           S01408
     C*                                                                   S01408
     C*
     C* Must not be entered with Value currency different to nominal      S01169
     C* if entered                                                        S01169
     C*
     C           SMLTI     IFEQ 'Y'
     C           SVLCY     IFNE '   '                                     S01158
     C           SVLCY     ANDNESNMCY                                     S01158
     C                     ADD  1         EC
     C                     MOVEA' 115'    ERR,EC
     C                     SETON                     58
     C                     END
     C                     END                                            S01158
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0040CVSR                                           S01408
     C*                                                                   S01408
     C           BGN4ST    IFEQ 'Y'                                       183604
     C                     SETOF                     74                   183604
      *                                                                   183604
      *** Rating is mandatory and must exist in toratipd file             183604
      *                                                                   183604
     C           SQLTY     IFEQ *BLANKS                                   183604
     C                     ADD  1         EC                              183604
     C                     MOVEA' 602'    ERR,EC           Mandatory      183604
     C                     SETON                     74                   183604
      *                                                                   183604
     C                     ELSE                                           183604
     C           SQLTY     CHAINPBRATIL0             74                   183604
     C           *IN74     IFEQ *ON                        Not found      183604
     C                     ADD  1         EC                              183604
     C                     MOVEA' 603'    ERR,EC           Mandatory      183604
     C                     ENDIF                                          183604
     C                     ENDIF                                          183604
      *                                                                   183604
     C                     ENDIF                                          183604
     C*
     C* Market indicator
     C*
     C***********SMKTI     IFNE ' '                                       E31315
     C***********SMKTI     ANDNE'G'                                       E31315
     C           SMKTI     IFNE 'G'                                       E31315
     C           SMKTI     ANDNE'P'
     C           SMKTI     ANDNE'S'
     C                     ADD  1         EC
     C                     MOVEA' 116'    ERR,EC
     C                     SETON                     59
     C                     END
     C*
     C* Check for allowable changes to market indicator
     C*
     C           SACTN     IFEQ 'A'
     C*
     C* If 'G' only 'G', 'P' or 'S' allowed
     C*
     C           MKTI      IFEQ 'G'
     C           SMKTI     IFNE 'G'
     C           SMKTI     ANDNE'P'
     C           SMKTI     ANDNE'S'
     C                     ADD  1         EC
     C                     MOVEA' 117'    ERR,EC
     C                     SETON                     59
     C                     END
     C                     END
     C*
     C* If 'P' only 'P' or 'S' allowed
     C*
     C           MKTI      IFEQ 'P'
     C           SMKTI     IFNE 'P'
     C           SMKTI     ANDNE'S'
     C                     ADD  1         EC
     C                     MOVEA' 117'    ERR,EC
     C                     SETON                     59
     C                     END
     C                     END
     C*                                                                   S01158
     C* If 'S' no amendment allowed                                       S01158
     C*                                                                   S01158
     C           MKTI      IFEQ 'S'                                       S01158
     C           SMKTI     ANDNE'S'                                       S01158
     C                     ADD  1         EC                              S01158
     C                     MOVEA' 117'    ERR,EC                          S01158
     C                     SETON                     59                   S01158
     C                     END                                            S01158
     C*
     C* Validate change of market
     C*
     C           SACTN     IFEQ 'A'
     C           SMKTI     ANDNEMKTI
     C*                                                                   S01511
     C** If S01511 is active, only validate a change of market, if the    S01511
     C** change is from G to another                                      S01511
     C*                                                                   S01511
     C           S01511    IFEQ 'Y'                                       S01511
     C           MKTI      ANDEQ'G'                                       S01511
     C           S01511    OREQ 'N'                                       S01511
     C                     MOVE *IN51     IND51   1                       E36754
     C                     EXSR VLDDCM
     C           *IN34     IFEQ '1'
     C***********          ADD  1         EC                              E36754
     C***********          MOVEA' 118'    ERR,EC                          E36754
     C                     SETON                     59
     C                     MOVE IND51     *IN51                           E36754
     C                     END
     C                     END                                            S01511
     C                     END
     C*
     C                     END
     C*
     C* Country of Risk
     C*
     C           SSCOR     IFNE *BLANKS
     C*
     C* Must exist on table
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVE SSCOR     KEY12A                          S01117
     C**********           MOVEL'50'      KEY12A                          S01117
     C********** TABKA     CHAINTABLETNF             33                   S01117
     C                     CALL 'AOCTRYR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SSCOR     @KEYCY  2                       S01117
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01117
     C********** *IN33     IFEQ '1'                                       S01117
     C**********           ADD  1         EC                              S01117
     C**********           MOVEA' 119'    ERR,EC                          S01117
     C**********           SETON                     60                   S01117
     C**********           ELSE                                           S01117
     C*
     C* and not be deleted record
     C*
     C********** RECI      IFEQ '*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC
     C                     MOVEA' 119'    ERR,EC
     C                     SETON                     60
     C**********           END                                            S01117
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0040C076
     C*
     C* Partly paid indicator
     C*
     C           SPPDI     IFNE ' '
     C           SPPDI     IFNE 'Y'
     C           SPPDI     ANDNE'N'
     C                     ADD  1         EC
     C                     MOVEA' 120'    ERR,EC
     C                     SETON                     61
     C                     END
     C*
     C* If processing type '6', entry must not be 'Y'
     C* or processing type '2', Commodities , entry must not be 'Y'       E19750
     C*
     C           PROT      IFEQ '6'
     C           PROT      OREQ '2'                                       E19750
     C********** SPPDI     ANDEQ'Y'                                       E20290
     C           SPPDI     IFEQ 'Y'                                       E20290
     C                     ADD  1         EC
     C                     MOVEA' 121'    ERR,EC
     C                     SETON                     61
     C                     END                                            E20290
     C                     END
     C*
     C                     END
     C*
      ** Security Price front office ID                                   CAP060
      *                                                                   CAP060
     C           CAP060    IFEQ 'Y'                                       CAP060
     C           SSSPID    ANDNE*BLANKS                                   CAP060
      *                                                                   CAP060
      * Try to find a security on file with the screen Security Price     CAP060
     C           SSSPID    CHAINSECTYL5              33                   CAP060
     C           *IN33     IFEQ *OFF                                      CAP060
      *                                                                   CAP060
      * For Insert, record must not already exist on file                 CAP060
     C           SACTN     IFEQ 'I'                                       CAP060
     C                     ADD  1         EC                              CAP060
     C                     MOVEA' 144'    ERR,EC                          CAP060
     C                     MOVE *ON       WKIN92                          CAP060
     C                     ENDIF                                          CAP060
      *                                                                   CAP060
      * For Amend , screen security shortname must be same as on file     CAP060
     C           SACTN     IFEQ 'A'                                       CAP060
     C           W5SESN    ANDNESSESN                                     CAP060
     C                     ADD  1         EC                              CAP060
     C                     MOVEA' 144'    ERR,EC                          CAP060
     C                     MOVE *ON       WKIN92                          CAP060
     C                     ELSE                                           CAP060
     C                     MOVE SSSPID    WKSPID                          CAP060
     C                     ENDIF                                          CAP060
      *                                                                   CAP060
     C                     ELSE                                           CAP060
     C                     MOVE SSSPID    WKSPID                          CAP060
     C                     ENDIF                                          CAP060
      *                                                                   CAP060
     C                     ENDIF                                          CAP060
      *                                                                   CAP060
     C* Issuer
     C*
     C           SISSR     IFNE *BLANKS
     C*
     C* Must exist on file
     C*
     C********** SISSR     CHAINSNAMEF               33                   S01117
     C***33*****           MOVELSISSR     WK6N                            S01117
     C***33***** WK6N      CHAINCLINTCBF             33                   S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSISSR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '1'                                       S01117
     C**********           ADD  1         EC                              S01117
     C**********           MOVEA' 122'    ERR,EC                          S01117
     C**********           SETON                     62                   S01117
     C**********           ELSE                                           S01117
     C*
     C* and not be deleted record or be a Parent                          S01176
     C*                                                                   S01176
     C**********           TESTB'2'       CMIN           34         S01176S01117
     C*
     C********** RECI      IFEQ '*'                                       S01117
     C********** *IN34     OREQ '1'                                 S01176S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBPAIN    OREQ 'P'                                       S01117
     C                     ADD  1         EC
     C                     MOVEA' 122'    ERR,EC
     C                     SETON                     62
     C                     END
     C**********           END                                            S01117
     C*
     C**Mandatory*for*processing*type*6********************************   E25070
     C**Issuer*is*mandatory*****                                    E25070042312
     C* Issuer is mandatory only if Status is 'C'.                        042312
     C*
     C                     ELSE
     C***********PROT      IFEQ '6'                                       E25070
     C/COPY WNCPYSRC,SE0040C009
     C           SINCS     IFEQ 'C'                                       042312
     C                     ADD  1         EC         62
     C                     MOVEA' 130'    ERR,EC
     C                     END                                            042312
     C/COPY WNCPYSRC,SE0040C010
     C***********          END                                            E25070
     C*
     C                     END
     C/COPY WNCPYSRC,SE0040C039
     C*
     C* New issue
     C*
     C           NEWISS    IFNE ' '
     C           NEWISS    ANDNE'Y'
     C           NEWISS    ANDNE'N'
     C                     ADD  1         EC
     C                     MOVEA' 123'    ERR,EC
     C                     SETON                     63
     C                     END
     C*
     C* Stock denomination
     C*
     C           SSDNM     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSSDNM     ZFIELD
     C                     Z-ADD7         ZADIG
     C/COPY WNCPYSRC,SE0040C052
     C                     Z-ADD*ZERO     ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 124'    ERR,EC
     C                     SETON                     64
     C                     END
     C/COPY WNCPYSRC,SE0040C071
     C*
     C* Cannot be entered if processing type '7' or '8'
     C*
     C           PROT      IFEQ '7'
     C           PROT      OREQ '8'
     C/COPY WNCPYSRC,SE0040C069
     C                     ADD  1         EC
     C                     MOVEA' 125'    ERR,EC
     C                     SETON                     64
     C                     END
     C/COPY WNCPYSRC,SE0040C072
     C*
     C                     END
     C/COPY WNCPYSRC,SE0040C142
     C*
     C* Early repayments
     C*
     C           SERPY     IFNE ' '
     C           SERPY     ANDNE'Y'
     C           SERPY     ANDNE'N'
     C                     ADD  1         EC
     C                     MOVEA' 126'    ERR,EC
     C                     SETON                     65
     C                     END
     C*                                                                   E22108
     C* Early repayment not applicable to shares, commodities, or unit    E22108
     C* trusts.                                                           E22108
     C*                                                                   E22108
     C           SERPY     IFEQ 'Y'                                       E22108
     C           PROT      IFEQ '7'                                       E22108
     C           PROT      OREQ '4'                                       E22108
     C           PROT      OREQ '2'                                       E22108
     C                     ADD  1         EC                              E22108
     C                     MOVEA' 132'    ERR,EC                          E22108
     C                     SETON                     65                   E22108
     C                     END                                            E22108
     C                     END                                            E22108
     C*
     C* Value date default
     C*
     C           SVDFT     IFNE *BLANKS
     C*
     C* 1st character must be numeric
     C*
     C                     MOVELSVDFT     WORK1A
     C           WORK1A    IFLT '0'
     C           WORK1A    ORGT '9'
     C                     ADD  1         EC
     C                     MOVEA' 127'    ERR,EC
     C                     SETON                     66
     C                     END
     C*
     C* 2nd character must be numeric - only check if 1st character ok
     C*
     C           *IN66     IFEQ '0'
     C                     MOVELSVDFT     WORK2A  2
     C                     MOVE WORK2A    WORK1A
     C           WORK1A    IFLT '0'
     C           WORK1A    ORGT '9'
     C                     ADD  1         EC
     C                     MOVEA' 127'    ERR,EC
     C                     SETON                     66
     C                     END
     C                     END
     C*
     C* 3rd character must be 'A' or 'W'
     C*
     C                     MOVELSVDFT     WORK2A  2
     C                     MOVE SVDFT     WORK1A
     C           WORK1A    IFNE 'A'
     C           WORK1A    ANDNE'W'
     C                     ADD  1         EC
     C                     MOVEA' 127'    ERR,EC
     C                     SETON                     66
     C                     END
     C*
     C                     END
     C*
     C* Ex date default
     C*
     C           SEDFT     IFNE *BLANKS
     C*
     C* 1st character must be numeric
     C*
     C                     MOVELSEDFT     WORK1A
     C           WORK1A    IFLT '0'
     C           WORK1A    ORGT '9'
     C                     ADD  1         EC
     C                     MOVEA' 128'    ERR,EC
     C                     SETON                     67
     C                     END
     C*
     C* 2nd character must be numeric - only check if 1st character ok
     C*
     C           *IN67     IFEQ '0'
     C                     MOVELSEDFT     WORK2A
     C                     MOVE WORK2A    WORK1A
     C           WORK1A    IFLT '0'
     C           WORK1A    ORGT '9'
     C                     ADD  1         EC
     C                     MOVEA' 128'    ERR,EC
     C                     SETON                     67
     C                     END
     C                     END
     C*
     C* 3rd character must be 'A' or 'W'
     C*
     C           *IN67     IFEQ '0'                                       E24327
     C                     MOVE SEDFT     WORK1A  1
     C           WORK1A    IFNE 'A'
     C           WORK1A    ANDNE'W'
     C                     ADD  1         EC
     C                     MOVEA' 128'    ERR,EC
     C                     SETON                     67
     C                     END
     C                     END                                            E24327
     C*
     C                     END
     C*
     C* Trade basis override
     C*
     C           TBSOVR    IFNE ' '
     C           TBSOVR    ANDNE'P'
     C           TBSOVR    ANDNE'D'
     C           TBSOVR    ANDNE'Y'
     C                     ADD  1         EC
     C                     MOVEA' 129'    ERR,EC
     C                     SETON                     68
     C                     ELSE                                           S01158
     C*                                                                   S01158
     C*     - Further check if investment type valid & security is        S01158
     C*       a share,unit trust or commodity                             S01158
     C           *IN54     IFEQ '0'                                       S01158
     C           *IN55     ANDEQ'0'                                       S01158
     C           PROT      IFEQ '2'                                       S01158
     C           PROT      OREQ '4'                                       S01158
     C           PROT      OREQ '7'                                       S01158
     C           TBSOVR    IFNE 'P'                                       S01158
     C           TBSOVR    ANDNE' '                                       S01158
     C                     ADD  1         EC                              S01158
     C                     MOVEA' 131'    ERR,EC                          S01158
     C                     SETON                     68                   S01158
     C                     END                                            S01158
     C                     END                                            S01158
     C                     END                                            S01158
     C*                                                                   S01158
     C                     END
      *                                                                   CSE011
      ** Feature CSE011 is installed.                                     CSE011
      *                                                                   CSE011
     C           CSE011    IFEQ 'Y'                                       CSE011
      *                                                                   CSE011
      ** Check if SEDOL/EXTEL already exists in Securities file           CSE011
      *                                                                   CSE011
     C           SSREF     IFNE *BLANK                                    CSE011
     C           SSREF     ANDNEWSSREF                                    CSE011
     C           EC        ANDEQ0                                         CSE011
     C                     MOVE SSREF     WSSREF                          CSE011
     C                     MOVE *IN89     WIND89  1                       CSE011
     C                     MOVE 'N'       WFOUND  1                       CSE011
     C           WSSREF    SETLLSECTYL3                                   CSE011
     C           WSSREF    READESECTYL3                  89               CSE011
      *                                                                   CSE011
     C           *IN89     DOWEQ*OFF                                      CSE011
     C           WFOUND    ANDEQ'N'                                       CSE011
      *                                                                   CSE011
      ** Check if Security Shortname is different                         CSE011
      *                                                                   CSE011
     C           SSESN     IFNE SESN                                      CSE011
     C                     MOVE 'Y'       WFOUND                          CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           WSSREF    READESECTYL3                  89               CSE011
     C                     ENDDO                                          CSE011
      *                                                                   CSE011
      ** SEDOL already exist in Security file, send warning message       CSE011
      *                                                                   CSE011
     C           WFOUND    IFEQ 'Y'                                       CSE011
     C                     MOVEAWAMSG,4   WE        P                     CSE011
     C                     MOVEASREF      WE,18     P                     CSE011
     C                     MOVEAWAMSG,8   WE,26     P                     CSE011
     C                     MOVEASESN      WE,43     P                     CSE011
     C                     MOVEAWAMSG,9   WE,54     P                     CSE011
     C                     MOVEASRPN      WE,55     P                     CSE011
     C                     MOVEAWAMSG,10  WE,75     P                     CSE011
     C                     MOVEAWE        ERRMSG    P                     CSE011
     C                     MOVE *ON       *IN71                           CSE011
     C                     ADD  1         EC                              CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     MOVE WIND89    *IN89                           CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
      ** Check if Telekurs already exist in Securities file               CSE011
      *                                                                   CSE011
     C           ST2RF     IFNE *BLANK                                    CSE011
     C           ST2RF     ANDNEWST2RF                                    CSE011
     C           EC        ANDEQ0                                         CSE011
     C                     MOVE ST2RF     WST2RF                          CSE011
     C                     MOVE *IN89     WIND89  1                       CSE011
     C                     MOVE 'N'       WFOUND  1                       CSE011
     C           WST2RF    SETLLSECTYL2                                   CSE011
     C           WST2RF    READESECTYL2                  89               CSE011
      *                                                                   CSE011
     C           *IN89     DOWEQ*OFF                                      CSE011
     C           WFOUND    ANDEQ'N'                                       CSE011
      *                                                                   CSE011
      ** Check if Security Shortname is different                         CSE011
      *                                                                   CSE011
     C           SSESN     IFNE SESN                                      CSE011
     C                     MOVE 'Y'       WFOUND                          CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           WST2RF    READESECTYL2                  89               CSE011
     C                     ENDDO                                          CSE011
      *                                                                   CSE011
      ** Telekurs already exist in Security file, send warning message    CSE011
      *                                                                   CSE011
     C           WFOUND    IFEQ 'Y'                                       CSE011
     C                     MOVEAWAMSG,1   WE        P                     CSE011
     C                     MOVEAT2RF      WE,9      P                     CSE011
     C                     MOVEAWAMSG,8   WE,22     P                     CSE011
     C                     MOVEASESN      WE,39     P                     CSE011
     C                     MOVEAWAMSG,9   WE,51     P                     CSE011
     C                     MOVEASRPN      WE,52     P                     CSE011
     C                     MOVEAWAMSG,10  WE,72     P                     CSE011
     C                     MOVEAWE        ERRMSG    P                     CSE011
     C                     MOVE *ON       *IN72                           CSE011
     C                     ADD  1         EC                              CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     MOVE WIND89    *IN89                           CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
      ** Check if Cusip Number already exist in Securities file           CSE011
      *                                                                   CSE011
     C           SCSPN     IFNE *BLANK                                    CSE011
     C           SCSPN     ANDNEWSCSPN                                    CSE011
     C           EC        ANDEQ0                                         CSE011
     C                     MOVE SCSPN     WSCSPN                          CSE011
     C                     MOVE *IN89     WIND89  1                       CSE011
     C                     MOVE 'N'       WFOUND  1                       CSE011
     C           WSCSPN    SETLLSECTYL0                                   CSE011
     C           WSCSPN    READESECTYL0                  89               CSE011
      *                                                                   CSE011
     C           *IN89     DOWEQ*OFF                                      CSE011
     C           WFOUND    ANDEQ'N'                                       CSE011
      *                                                                   CSE011
      ** Check if Security Shortname is different                         CSE011
      *                                                                   CSE011
     C           SSESN     IFNE SESN                                      CSE011
     C                     MOVE 'Y'       WFOUND                          CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           WSCSPN    READESECTYL0                  89               CSE011
     C                     ENDDO                                          CSE011
      *                                                                   CSE011
      ** Cusip already exist in Security file, send warning message       CSE011
      *                                                                   CSE011
     C           WFOUND    IFEQ 'Y'                                       CSE011
     C                     MOVEAWAMSG,3   WE        P                     CSE011
     C                     MOVEACSPN      WE,12                           CSE011
     C                     MOVEAWAMSG,8   WE,22                           CSE011
     C                     MOVEASESN      WE,39                           CSE011
     C                     MOVEAWAMSG,9   WE,50                           CSE011
     C                     MOVEASRPN      WE,51                           CSE011
     C                     MOVEAWAMSG,10  WE,71                           CSE011
     C                     MOVEAWE        ERRMSG    P                     CSE011
     C                     MOVE *ON       *IN73                           CSE011
     C                     ADD  1         EC                              CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     MOVE WIND89    *IN89                           CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     ENDIF                                          CSE011
     C/COPY WNCPYSRC,SE0040C061
      *                                                                   S01401
      **  Validate SISIN and SSWTP only if MT5xx Feature is present.      S01401
      **  or if PB Module is present.                                     CPB001
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C           BGN4ST    OREQ 'Y'                                       CPB001
      *                                                                   S01401
      **  Validate Security Code for ISIN/COMMON.                         S01401
     C                     EXSR VLISIN                                    S01401
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
      **  Validate SSWTP only if MT5xx Feature is present.                CPB001
      *                                                                   CPB001
     C           S01401    IFEQ 'Y'                                       CPB001
      *                                                                   S01401
      **  Validate SWIFT Security Type Code.                              S01401
     C                     EXSR VLSWTP                                    S01401
     C                     END                                            S01401
     C/COPY WNCPYSRC,SE0040C097
     C*
      *                                                                   CEU018
      **  Validate screen field 'Nominal Decimal Places' if CEU018        CEU018
      **  feature is present.                                             CEU018
      *                                                                   CEU018
     C           CEU018    IFEQ 'Y'                                       CEU018
     C                     EXSR VLNMDP                                    CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
      ** Validate European Tax indicator if CGL031 feature is present.                        CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     EXSR SRVETX                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDPPD - Subroutine to validate Partly Paid entries made on  *
      *           the second screen.                                  *
      *                                                               *
      *****************************************************************
      *
     C           VLDPPD    BEGSR                           *** VLDPPD ***
     C*
     C* Setof error indicators
     C*
     C                     MOVEA'00'      *IN,29
     C                     Z-ADD*ZEROS    INITPR
     C                     Z-ADD*ZEROS    FYPDPR
     C*
     C* Initial and Fuly paid prices are based on 3 decimal places if
     C* Processing type not '4', else Nominal currency decimal places
     C*
     C           SSINP     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSSINP     ZFIELD
     C           PROT      IFNE '4'
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 256'    ERR,EC
     C                     SETON                     29
     C                     ELSE
     C                     MOVE ZFIELD    INITPR
     C                     MOVE ZFIELD    WORK6N  63
     C           WORK6N    IFGE 100
     C                     ADD  1         EC
     C                     MOVEA' 256'    ERR,EC
     C                     SETON                     29
     C                     END
     C                     END
     C                     ELSE
     C*
     C* Fetch nominal decimal places
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELSNMCY     WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNMCY     @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C********** *IN33     IFEQ '1'                                       S01117
     C**********           ADD  1         EC                              S01117
     C**********           MOVEA' 257'    ERR,EC                          S01117
     C**********           SETON                     29                   S01117
     C**********           ELSE                                           S01117
     C*
     C* Deleted record
     C*
     C********** RECI      IFEQ '*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC
     C                     MOVEA' 257'    ERR,EC
     C                     SETON                     29
     C                     ELSE
     C*
     C* Check valid number
     C*
     C********** 15        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           15        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    INITPR
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 257'    ERR,EC
     C                     SETON                     29
     C**********           END                                            S01117
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* Else if blank and security is complete, error
     C*
     C                     ELSE
     C           SINCS     IFEQ 'C'
     C                     ADD  1         EC         29
     C           PROT      IFNE '4'
     C                     MOVEA' 256'    ERR,EC
     C                     ELSE
     C                     MOVEA' 257'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
     C* Fully Paid Price
     C*
     C           SSFPP     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSSFPP     ZFIELD
     C           PROT      IFNE '4'
     C                     Z-ADD3         ZADIG
     C                     Z-ADD3         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 258'    ERR,EC
     C                     SETON                     30
     C                     ELSE
     C                     MOVE ZFIELD    FYPDPR
     C*
     C* Full price must be greater than initial price
     C*
     C           INITPR    IFGE FYPDPR
     C                     ADD  1         EC
     C                     MOVEA' 259'    ERR,EC
     C                     SETON                     30
     C                     END
     C*
     C                     END
     C                     ELSE
     C*
     C* Fetch nominal decimal places
     C*
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C**********           MOVELSNMCY     WORK4                           S01117
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SNMCY     @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C********** *IN33     IFEQ '1'                                       S01117
     C**********           ADD  1         EC                              S01117
     C**********           MOVEA' 260'    ERR,EC                          S01117
     C**********           SETON                     30                   S01117
     C**********           ELSE                                           S01117
     C*
     C* deleted record
     C*
     C********** RECI      IFEQ '*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC
     C                     MOVEA' 260'    ERR,EC
     C                     SETON                     30
     C                     ELSE
     C*
     C* Check valid number
     C*
     C********** 15        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           15        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    FYPDPR
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 260'    ERR,EC
     C                     SETON                     30
     C**********           END                                            S01117
     C                     END
     C                     END
     C*
     C* Must be greater than initial price
     C*
     C           FYPDPR    IFLE INITPR
     C                     ADD  1         EC
     C                     MOVEA' 261'    ERR,EC
     C                     SETON                     30
     C                     END
     C*
     C                     END
     C                     ELSE
     C*
     C* If blank, but initial price entered
     C*
     C           INITPR    IFNE *ZEROS
     C*
     C* Error
     C*
     C                     ADD  1         EC         30
     C           PROT      IFNE '4'
     C                     MOVEA' 259'    ERR,EC
     C                     ELSE
     C                     MOVEA' 261'    ERR,EC
     C                     END
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDSHR - Subroutine to validate Share entries made on the    *
      *           second screen.                                      *
      *                                                               *
      *****************************************************************
      *
     C           VLDSHR    BEGSR                           *** VLDSHR ***
     C*
     C* Setof error indicators
     C*
     C                     MOVEA'00000000'*IN,51
     C                     MOVEA'00000'   *IN,59
     C                     SETOF                     143132
     C                     MOVEA'0000000' *IN,83
     C                     SETOF                     35
     C*
     C* Initial Dividend date
     C*
     C           SIDIV     IFNE *BLANKS
     C*
     C* Check valid date
     C*
     C                     MOVE SIDIV     DATEN
     C                     MOVE DATEN     DATEA
     C           SIDIV     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 200'    ERR,EC
     C                     SETON                     51
     C                     ELSE
     C                     MOVE SIDIV     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 200'    ERR,EC
     C                     SETON                     51
     C                     END
     C                     END
     C                     END
     C*
     C* Dividend payment dates
     C*
     C* Cannot be blank if initial date is not blank
     C*
     C                     MOVEASCD       WORK48
     C           WORK48    IFEQ *BLANKS
     C           SIDIV     IFNE *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 201'    ERR,EC
     C                     SETON                     52
     C                     END
     C                     ELSE
     C*
     C                     Z-ADD*ZEROS    LDAT    40
     C                     Z-ADD*ZEROS    NDAT    40
     C                     Z-ADD1         X       20
     C                     DO   12        X
     C           SCD,X     IFNE *BLANKS
     C           X         IFGT 1
     C                     SUB  1         X
     C           SCD,X     IFEQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 202'    ERR,EC
     C           52        ADD  X         Y       20
     C                     MOVEA'1'       *IN,Y
     C                     END
     C                     ADD  1         X
     C                     END
     C*
     C* *IN98 DDMM or MMDD format from P/ZSYSTM
     C*
     C           *IN98     IFEQ '0'
     C                     MOVE SCD,X     MONTH   2
     C                     MOVELSCD,X     DAY     20
     C                     ELSE
     C                     MOVELSCD,X     MONTH
     C                     MOVE SCD,X     DAY
     C                     END
     C*
     C*  Validate Month and Day                                           S01158
     C*                                                                   S01158
     C           MONTH     LOKUPTABMTH    TABDAY         33
     C           *IN33     IFEQ '0'                                       S01158
     C           DAY       ORGT TABDAY                                    S01158
     C           DAY       ORLE *ZEROS
     C                     ADD  1         EC
     C                     MOVEA' 203'    ERR,EC
     C           51        ADD  X         Y
     C                     MOVEA'1'       *IN,Y
     C                     END
     C*
     C* Cannot be earlier than preceding date
     C*
     C                     MOVELMONTH     NDAT
     C                     MOVE DAY       NDAT
     C           NDAT      IFLE LDAT
     C                     ADD  1         EC
     C                     MOVEA' 204'    ERR,EC
     C           51        ADD  X         Y
     C                     MOVEA'1'       *IN,Y
     C                     END
     C                     Z-ADDNDAT      LDAT
     C*
     C                     END
     C                     END
     C                     END
     C*
     C* Next expected dividend is expressed in Value currency decimal
     C* places (Nominal if blank)
     C*
     C           SNEXD     IFNE *BLANKS
     C**********           MOVE *BLANKS   KEY12A                          S01117
     C           SVLCY     IFNE '   '
     C**********           MOVELSVLCY     WORK4                           S01117
     C                     MOVELSVLCY     @CKEY                           S01117
     C                     ELSE
     C**********           MOVELSNMCY     WORK4                           S01117
     C                     MOVELSNMCY     @CKEY                           S01117
     C                     END
     C**********           MOVE '1'       WORK4                           S01117
     C**********           MOVEL'20'      KEY12A                          S01117
     C**********           MOVE WORK4     KEY12A                          S01117
     C*
     C* Fetch decimal places
     C*
     C********** TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C***********SDCURR    PARM SDCURR    DSFDY                           S01117              CSD006
     C           SDCURR    PARM SDCURR    DSSDY                           S01117              CSD006
     C********** *IN33     IFEQ '1'                                       S01117
     C**********           ADD  1         EC                              S01117
     C**********           MOVEA' 205'    ERR,EC                          S01117
     C**********           SETON                     14                   S01117
     C**********           ELSE                                           S01117
     C*
     C* not deleted record
     C*
     C********** RECI      IFEQ '*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC
     C                     MOVEA' 205'    ERR,EC
     C                     SETON                     14
     C                     ELSE
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSNEXD     ZFIELD
     C********** 13        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           13        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 205'    ERR,EC
     C                     SETON                     14
     C**********           END                                            S01117
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VLDTHD - Subroutine to validate entries made on the third    *
      *           screen.                                             *
      *                                                               *
      *****************************************************************
      *
     C           VLDTHD    BEGSR                           *** VLDTHD ***
     C*
     C* Setof error indicators
     C*
     C                     SETOF                     09
     C                     Z-ADD*ZEROS    WEC
     C                     Z-ADD*ZEROS    EC
     C                     MOVE *BLANKS   ERRMSG
     C                     MOVEA'00000000'*IN,51
     C                     MOVEA'0000'    *IN,59
     C*
     C* Issue date
     C*
     C           SISSD     IFNE *BLANKS
     C*
     C* Check valid date
     C*
     C                     MOVE SISSD     DATEN
     C                     MOVE DATEN     DATEA
     C           SISSD     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 300'    ERR,EC
     C                     SETON                     51
     C                     ELSE
     C                     MOVE SISSD     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 300'    ERR,EC
     C                     SETON                     51
     C                     ELSE
     C*
     C* Must not be after initial date, unless trade basis = D,           S01158
     C* (i.e. there is no initial date).                                  S01158
     C*
     C           SSTBS     IFNE 'D'                                       S01158
     C           SITLD     ANDNE*BLANKS                                   S01158
     C           ZDAYNO    ANDGTITLDNO
     C                     ADD  1         EC
     C                     MOVEA' 301'    ERR,EC
     C                     SETON                     51
     C                     END
     C*
     C* Must not be after maturity date
     C*
     C           SMATY1    IFNE *BLANKS
     C           SMATY2    ORNE *BLANKS
     C           ZDAYNO    IFGT MATDNO                                    S01158
     C                     ADD  1         EC
     C                     MOVEA' 301'    ERR,EC
     C                     SETON                     51
     C                     END
     C                     END                                            S01158
     C*
     C                     END
     C                     END
     C                     END
     C*
     C* Issue Price - check valid number
     C*
     C/COPY WNCPYSRC,SE0040C007
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSISSP     ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 303'    ERR,EC
     C                     SETON                     52
     C/COPY WNCPYSRC,SE0040C078
     C                     END
     C*
     C* Lead Manager
     C*
     C           SLMGR     IFNE *BLANKS
     C*
     C* Must exist on file
     C*
     C********** SLMGR     CHAINSNAMEF               33                   S01117
     C***********          MOVELSLMGR     WRK6    6                 S01117093522
     C***********          TESTN          WRK6       33             S01117093522
     C***********          MOVELSLMGR     @KEYS                     S01117093522
     C************IN33     IFEQ '0'                  ALPHANUMERIC   S01117093522
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSLMGR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C***********@RTCD     IFEQ *BLANKS                             S01117093522
     C***********          MOVELBBCUST    @KEYS   6                 S01117093522
     C***********          END                                      S01117093522
     C***********          END                                      S01117093522
     C***********@RTCD     IFEQ *BLANKS                             S01117093522
     C************IN33     OREQ '1'                        NUMERIC  S01117093522
     C***********          CALL 'AOSECSR0'                          S01117093522
     C***********          PARM *BLANKS   @RTCD                     S01117093522
     C***********          PARM '*KEY   ' @OPTN                     S01117093522
     C***********          PARM           @KEYS                     S01117093522
     C***********SDSECS    PARM SDSECS    DSSDY                     S01117093522
     C***********          END                                      S01117093522
     C********** *IN33     IFEQ '1'                                       S01117
     C**********           ADD  1         EC                              S01117
     C**********           MOVEA' 304'    ERR,EC                          S01117
     C**********           SETON                     53                   S01117
     C**********           ELSE                                           S01117
     C*
     C* and not be deleted record
     C*
     C********** RECI      IFEQ '*'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC
     C                     MOVEA' 304'    ERR,EC
     C                     SETON                     53
     C**********           END                                            S01117
     C                     END
     C                     END
     C*
     C* Issue Amount
     C*
     C           SISSA     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSISSA     ZFIELD
     C                     Z-ADD11        ZADIG
     C/COPY WNCPYSRC,SE0040C053
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 305'    ERR,EC
     C                     SETON                     54
     C/COPY WNCPYSRC,SE0040C098
     C                     END
     C                     END
     C*
     C* Total Underwritten
     C*
     C           STOTU     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSTOTU     ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 306'    ERR,EC
     C                     SETON                     55
     C                     END
     C                     END
     C*
     C* Allocation Requested
     C*
     C           SALRQ     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSALRQ     ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 307'    ERR,EC
     C                     SETON                     56
     C                     END
     C                     END
     C*
     C* Allocation Received
     C*
     C           SALRC     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSALRC     ZFIELD
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 308'    ERR,EC
     C                     SETON                     57
     C                     END
     C                     END
     C*
     C* Fee Currency
     C*
     C           SFECY     IFEQ '   '
     C                     MOVE SNMCY     SFECY
     C                     END
     C*
     C***********                                                         S01117
     C**Must*exist*on*table***********************************************S01117
     C* Must exist on PF/SDCURRPD                                         S01117
     C*
     C***********          MOVE *BLANKS   KEY12A                          S01117
     C***********          MOVELSFECY     WORK4                           S01117
     C***********          MOVE '1'       WORK4                           S01117
     C***********          MOVEL'20'      KEY12A                          S01117
     C***********          MOVE WORK4     KEY12A                          S01117
     C***********TABKA     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SFECY     @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C************IN33     IFEQ '1'                                       S01117
     C                     ADD  1         EC
     C                     MOVEA' 313'    ERR,EC
     C                     SETON                     62
     C                     ELSE
     C*
     C**and*not*be*deleted*record*****************************************S01117
     C***********                                                         S01117
     C***********RECI      IFEQ '*'                                       S01117
     C***********          ADD  1         EC                              S01117
     C***********          MOVEA' 313'    ERR,EC                          S01117
     C***********          SETON                     62                   S01117
     C***********          END                                            S01117
     C*
     C           SFECY     IFNE A6CYCD                                    S01117
     C                     MOVE A6CYCD    SFECY                           S01117
     C                     END                                            S01117
     C*
     C* and be a dealing currency
     C*
     C           A6DLCI    IFNE 'Y'
     C                     ADD  1         EC
     C                     MOVEA' 313'    ERR,EC
     C                     SETON                     62
     C                     END
     C                     END
      /SPACE 3
     C* All the following amounts are based on the Fee currency decimal
     C* places
      /SPACE 3
     C*
     C* Management Fees Due
     C*
     C           SMGFD     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSMGFD     ZFIELD
     C********** 11        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           11        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 309'    ERR,EC
     C                     SETON                     58
     C                     END
     C                     END
     C*
     C* Management Fees Received
     C*
     C           SMGRC     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSMGRC     ZFIELD
     C********** 11        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           11        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 310'    ERR,EC
     C                     SETON                     59
     C                     END
     C                     END
     C*
     C* Underwriting Fees Due
     C*
     C           SUNFD     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSUNFD     ZFIELD
     C********** 11        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           11        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 311'    ERR,EC
     C                     SETON                     60
     C                     END
     C                     END
     C*
     C* Underwriting Fees Received
     C*
     C           SUNFR     IFNE *BLANKS
     C*
     C* Check valid number
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVELSUNFR     ZFIELD
     C********** 11        SUB  CDP       ZADIG                           S01117
     C**********           Z-ADDCDP       ZADEC                           S01117
     C           11        SUB  A6NBDP    ZADIG                           S01117
     C                     Z-ADDA6NBDP    ZADEC                           S01117
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 312'    ERR,EC
     C                     SETON                     61
     C                     END
     C                     END
      *                                                                   CEU018
      **  Validate input if PB module is ON                               CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     EXSR VLPPAG                                    CPB001
     C                     EXSR VLGUAR                                    CPB001
     C                     EXSR VLWEIC                                    CPB001
     C                     EXSR VLNATU                                    CPB001
     C                     EXSR VLPBIT                                    183604
     C                     ENDIF                                          CPB001
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              CPB001
      *****************************************************************   CPB001
      *                                                               *   CPB001
      *  VLPPAG - Subroutine to Validate Principal Paying agent.      *   CPB001
      *                                                               *   CPB001
      *  Called by:  VLDITL                                           *   CPB001
      *                                                               *   CPB001
      *****************************************************************   CPB001
      *                                                                   CPB001
     C           VLPPAG    BEGSR                           *** VLPPAG *** CPB001
     C*                                                                   CPB001
     C* Setof error indicators                                            CPB001
     C*                                                                   CPB001
     C                     MOVE *OFF      *IN26                           CPB001
     C*                                                                   CPB001
     C* Principal Paying agent is mandatory                               CPB001
     C*                                                                   CPB001
     C           SPPAG     IFEQ *BLANKS                                   CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVEL' 316'    ERR,EC                          CPB001
     C                     MOVE *ON       *IN26                           CPB001
     C                     ELSE                                           CPB001
     C* Principal Paying agent must be a valid customer                   CPB001
     C*                                                                   CPB001
     C                     MOVE *BLANKS   @KEYC                           CPB001
     C                     MOVELSPPAG     @KEYC                           CPB001
     C                     CALL 'AOCUSTR0'                                CPB001
     C                     PARM *BLANKS   @RTCD                           CPB001
     C                     PARM '*KEY   ' @OPTN                           CPB001
     C                     PARM           @KEYC                           CPB001
     C                     PARM *BLANKS   @KYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSSDY                           CPB001
     C*                                                                   CPB001
     C           @RTCD     IFNE *BLANKS                                   CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVEL' 317'    ERR,EC                          CPB001
     C                     MOVE *ON       *IN26                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVELBBCUST    SPPAG                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDSR                                          CPB001
      /EJECT                                                              CPB001
      *****************************************************************   CPB001
      *                                                               *   CPB001
      *  VLGUAR - Subroutine to Validate Principal Paying agent.      *   CPB001
      *                                                               *   CPB001
      *  Called by:  VLDITL                                           *   CPB001
      *                                                               *   CPB001
      *****************************************************************   CPB001
      *                                                                   CPB001
     C           VLGUAR    BEGSR                           *** VLGUAR *** CPB001
     C*                                                                   CPB001
     C* Setof error indicators                                            CPB001
     C*                                                                   CPB001
     C                     MOVE *OFF      *IN27                           CPB001
     C*                                                                   CPB001
     C* Guarantor is mandatory                                            CPB001
     C*                                                                   CPB001
     C           SGUAR     IFEQ *BLANKS                                   CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVE *ON       *IN27                           CPB001
     C                     MOVEL' 318'    ERR,EC                          CPB001
     C                     ELSE                                           CPB001
     C* Guarantor must be a valid customer                                CPB001
     C*                                                                   CPB001
     C                     MOVE *BLANKS   @KEYC                           CPB001
     C                     MOVELSGUAR     @KEYC                           CPB001
     C                     CALL 'AOCUSTR0'                                CPB001
     C                     PARM *BLANKS   @RTCD                           CPB001
     C                     PARM '*KEY   ' @OPTN                           CPB001
     C                     PARM           @KEYC                           CPB001
     C                     PARM *BLANKS   @KYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSSDY                           CPB001
     C*                                                                   CPB001
     C           @RTCD     IFNE *BLANKS                                   CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVE *ON       *IN27                           CPB001
     C                     MOVEL' 319'    ERR,EC                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVELBBCUST    SGUAR                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDSR                                          CPB001
      *****************************************************************   CPB001
      *                                                               *   CPB001
      *  VLWEIC - Subroutine to Validate Weighting Code               *   CPB001
      *                                                               *   CPB001
      *  Called by:  VLDITL                                           *   CPB001
      *                                                               *   CPB001
      *****************************************************************   CPB001
      *                                                                   CPB001
     C           VLWEIC    BEGSR                           *** VLWEIC *** CPB001
     C*                                                                   CPB001
     C* Setof error indicators                                            CPB001
     C*                                                                   CPB001
     C                     MOVE *OFF      *IN28                           CPB001
     C*                                                                   CPB001
     C* Weighting Code is mandatory                                       CPB001
     C*                                                                   CPB001
     C           SWEIC     IFNE *BLANKS                                   CPB001
     C* Weighting Code must be a valid customer                           CPB001
     C*                                                                   CPB001
     C                     MOVEL'GP'      AOPGM  10                                           CGP001
     C                     MOVE 'AOWEIGR0'AOPGM                                               CGP001
     C**********           CALL 'AOWEIGR0'                                             CPB001 CGP001
     C                     CALL AOPGM                                                         CGP001
     C                     PARM *BLANKS   @RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM           SWEIC                           CPB001
     C********** SDWEIG    PARM SDWEIG    DSFDY                                        CPB001 CGP001
     C           GPWEIG    PARM GPWEIG    DSFDY                                               CGP001
     C           @RTCD     IFNE *BLANKS                                   CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVEL' 321'    ERR,EC                          CPB001
     C                     MOVE *ON       *IN28                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVELPDWEIG    SWEIC                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDSR                                          CPB001
      /EJECT                                                              CPB001
      *****************************************************************   CPB001
      *                                                               *   CPB001
      *  VLNATU - Subroutine to Validate Nature of Account            *   CPB001
      *                                                               *   CPB001
      *  Called by:  VLDITL                                           *   CPB001
      *                                                               *   CPB001
      *****************************************************************   CPB001
      *                                                                   CPB001
     C           VLNATU    BEGSR                           *** VLNATU *** CPB001
     C*                                                                   CPB001
     C* Setof error indicators                                            CPB001
     C*                                                                   CPB001
     C                     MOVE *OFF      *IN29                           CPB001
     C*                                                                   CPB001
     C* Nature of Account is mandatory                                    CPB001
     C*                                                                   CPB001
     C           SNATU     IFEQ *BLANKS                                   CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVE *ON       *IN29                           CPB001
     C                     MOVEL' 322'    ERR,EC                          CPB001
     C                     ELSE                                           CPB001
     C* Nature of Account must be a valid customer                        CPB001
     C*                                                                   CPB001
     C                     CALL 'AONATUR0'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM           SNATU                           CPB001
     C           SDNATU    PARM SDNATU    DSFDY                           CPB001
      *                                                                   CPB001
     C           @RTCD     IFNE *BLANKS                                   CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVE *ON       *IN29                           CPB001
     C                     MOVEL' 323'    ERR,EC                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVELTNNATU    SNATU                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDSR                                          CPB001
      *****************************************************************   CPB001
      /EJECT                                                              S01401
      *****************************************************************   183604
      *                                                               *   183604
      *  VLPBIT - Subroutine to Validate PB Instrument Type           *   183604
      *                                                               *   183604
      *  Called by:  VLDITL                                           *   183604
      *                                                               *   183604
      *****************************************************************   183604
      *                                                                   183604
     C           VLPBIT    BEGSR                           *** VLPBIT *** 183604
     C*                                                                   183604
     C* Setof error indicators                                            183604
     C*                                                                   183604
     C                     MOVE *OFF      *IN30                           183604
     C*                                                                   183604
     C           *IN31     IFEQ *OFF                                      183604
     C*                                                                   183604
     C** Resolve '?' before validation                                    183604
     C*                                                                   183604
     C                     MOVEASPBIT     INP                             183604
     C           '?'       LOKUPINP                      30               183604
     C*                                                                   183604
     C           *IN30     IFEQ '1'                                       183604
     C                     CALL 'AOPLINR0'                                183604
     C                     PARM *BLANKS   P@RTCD  7                       183604
     C                     PARM '*KEY'    P@OPTN  7                       183604
     C                     PARM '?'       P@KEY3  3                       183604
     C           SDPLIN    PARM SDPLIN    DSFDY                           183604
     C*                                                                   183604
     C** If selection made, move value to screen field                    183604
     C*                                                                   183604
     C           P@RTCD    IFEQ *BLANKS                                   183604
     C                     MOVELPDINNR    SPBIT                           183604
     C                     ELSE                                           183604
     C                     MOVE *BLANKS   SPBIT                           183604
     C                     MOVE *BLANKS   P@RTCD                          183604
     C                     ENDIF                                          183604
     C                     ENDIF                                          183604
     C*                                                                   183604
     C                     MOVE *OFF      *IN30                           183604
     C*                                                                   183604
     C                     CALL 'AOPLINR0'                                183604
     C                     PARM *BLANKS   P@RTCD                          183604
     C                     PARM '*KEY'    P@OPTN                          183604
     C                     PARM SPBIT     P@KEY3                          183604
     C           SDPLIN    PARM SDPLIN    DSFDY                           183604
     C*                                                                   183604
     C           P@RTCD    IFNE *BLANKS                                   183604
     C                     ADD  1         EC                              183604
     C                     MOVE *ON       *IN30                           183604
     C                     MOVEL' 324'    ERR,EC                          183604
     C                     ELSE                                           183604
     C                     MOVELPDINNR    SPBIT                           183604
     C                     ENDIF                                          183604
     C                     ENDIF                                          183604
     C*                                                                   183604
     C                     ENDSR                                          183604
      *****************************************************************   183604
      /EJECT                                                              183604
      *****************************************************************   S01401
      *                                                               *   S01401
      * VLISIN - Subroutine to Validate Security Code for ISIN/COMMON.*   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           VLISIN    BEGSR                           *** VLISIN *** S01401
      *                                                                   S01401
      ***  Set Off Validation Indicator.                                  S01401
      *                                                                   S01401
     C                     SETOF                     35                   S01401
      *                                                                   S01401
      ***  If the Security for ISIN/COMMON is not blank.                  S01401
      *                                                                   S01401
     C           SISIN     IFNE *BLANKS                                   S01401
      *                                                                   S01401
      ***  Initialise values used in validation processing.               S01401
      *                                                                   S01401
     C                     SETOF                     33                   S01401
     C                     MOVE 'N'       WWEOSF  1                       S01401
     C                     Z-ADD0         I       20                      S01401
     C                     Z-ADD0         J       20                      S01401
     C                     MOVEASISIN     IS1                             S01401
     C                     MOVEA*BLANKS   IS2                             S01401
      *                                                                   S01401
     C           I         DOWLE11                                        S01401
     C           *IN35     ANDEQ'0'                                       S01401
     C                     ADD  1         I                               S01401
      *                                                                   S01401
      ***  Check if Characters are in Array ALPHA1 (0..9,A..Z,BLANK).     S01401
      *                                                                   S01401
     C           IS1,I     LOKUPALPHA1                   33               S01401
      *                                                                   S01401
      ***  If Character is not found.                                     S01401
      *                                                                   S01401
     C           *IN33     IFEQ '0'                                       S01401
     C                     SETON                     35                   S01401
     C                     ELSE                                           S01401
      *                                                                   S01401
      ***  Check if Characters are in Array ALPHA2 (0..9,A..Z).           S01401
      *                                                                   S01401
     C           IS1,I     LOKUPALPHA2                   33               S01401
      *                                                                   S01401
      ***  If Character is found.                                         S01401
      *                                                                   S01401
     C           *IN33     IFEQ '1'                                       S01401
      *                                                                   S01401
     C           WWEOSF    IFEQ 'N'                                       S01401
     C                     ADD  1         J                               S01401
     C                     MOVEAIS1,I     IS2,J                           S01401
     C                     ELSE                                           S01401
     C                     SETON                     35                   S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     ELSE                                           S01401
      *                                                                   S01401
     C           J         IFGT 0                                         S01401
     C                     MOVE 'Y'       WWEOSF                          S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     END                                            S01401
     C                     END                                            S01401
      *                                                                   S01401
      ***  If Security Code for ISIN/COMMON is invalid.                   S01401
      *                                                                   S01401
     C           *IN35     IFEQ '1'                                       S01401
     C                     ADD  1         EC                              S01401
     C                     MOVEA' 138'    ERR,EC                          S01401
      *                                                                   S01401
     C                     ELSE                                           S01401
      *                                                                   S01401
      ***  Else store Screen Field with leading blanks removed.           S01401
      *                                                                   S01401
     C                     MOVEAIS2       SISIN                           S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     END                                            S01401
      *                                                                   CSE011
      ** Feature CSE011 is installed                                      CSE011
      *                                                                   CSE011
     C           CSE011    IFEQ 'Y'                                       CSE011
      *                                                                   CSE011
      ** Check if ISIN number already exists in Securities file           CSE011
      *                                                                   CSE011
     C           SISIN     IFNE *BLANK                                    CSE011
     C           SISIN     ANDNEWSISIN                                    CSE011
     C           EC        ANDEQ0                                         CSE011
     C                     MOVE SISIN     WSISIN                          CSE011
     C                     MOVE *IN89     WIND89  1                       CSE011
     C                     MOVE 'N'       WFOUND  1                       CSE011
     C           WSISIN    SETLLSECTYL1                                   CSE011
     C           WSISIN    READESECTYL1                  89               CSE011
      *                                                                   CSE011
     C           *IN89     DOWEQ*OFF                                      CSE011
     C           WFOUND    ANDEQ'N'                                       CSE011
      *                                                                   CSE011
      ** Check if Security Shortname is different                         CSE011
      *                                                                   CSE011
     C           SSESN     IFNE SESN                                      CSE011
     C                     MOVE 'Y'       WFOUND                          CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C           WSISIN    READESECTYL1                  89               CSE011
     C                     ENDDO                                          CSE011
      *                                                                   CSE011
      ** Isin No. already exist in Security file, send warning message    CSE011
      *                                                                   CSE011
     C           WFOUND    IFEQ 'Y'                                       CSE011
     C                     MOVEAWAMSG,2   WE        P                     CSE011
     C                     MOVEAISIN      WE,11     P                     CSE011
     C                     MOVEAWAMSG,8   WE,24     P                     CSE011
     C                     MOVEASESN      WE,41     P                     CSE011
     C                     MOVEAWAMSG,9   WE,52     P                     CSE011
     C                     MOVEASRPN      WE,53     P                     CSE011
     C                     MOVEAWAMSG,10  WE,73     P                     CSE011
     C                     MOVEAWE        ERRMSG    P                     CSE011
     C                     MOVE *ON       *IN35                           CSE011
     C                     ADD  1         EC                              CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     MOVE WIND89    *IN89                           CSE011
     C                     ENDIF                                          CSE011
      *                                                                   CSE011
     C                     ENDIF                                          CSE011
     C/COPY WNCPYSRC,SE0040C062
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *                                                                   S01401
      *****************************************************************   S01401
      /EJECT                                                              S01401
      *****************************************************************   S01401
      *                                                               *   S01401
      *  VLSWTP - Subroutine to Validate SWIFT Security Type Code.    *   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           VLSWTP    BEGSR                           *** VLSWTP *** S01401
      *                                                                   S01401
      ***  Set Off Validation Indicator.                                  S01401
      *                                                                   S01401
     C                     SETOF                     86                   S01401
     C/COPY WNCPYSRC,SE0040C054
      *                                                                   S01401
      ***  SWIFT Security Type Code is Mandatory so Error if blank.       S01401
      *                                                                   S01401
     C           SSWTP     IFEQ *BLANKS                                   S01401
     C                     ADD  1         EC                              S01401
     C                     MOVEA' 136'    ERR,EC                          S01401
     C                     SETON                     86                   S01401
      *                                                                   S01401
     C                     ELSE                                           S01401
      *                                                                   S01401
      ***  Validate SWIFT Security Type Code.                             S01401
      *                                                                   S01401
     C           SSWTP     IFNE 'BON'                                     S01401
     C           SSWTP     ANDNE'FMT'                                     S01401
     C           SSWTP     ANDNE'MSC'                                     S01401
     C           SSWTP     ANDNE'OPC'                                     S01401
     C           SSWTP     ANDNE'OPS'                                     S01401
     C           SSWTP     ANDNE'PRC'                                     S01401
     C           SSWTP     ANDNE'PRS'                                     S01401
     C           SSWTP     ANDNE'RTE'                                     S01401
     C           SSWTP     ANDNE'RTS'                                     S01401
     C           SSWTP     ANDNE'SHS'                                     S01401
     C           SSWTP     ANDNE'UNT'                                     S01401
     C           SSWTP     ANDNE'WTS'                                     S01401
     C                     ADD  1         EC                              S01401
     C                     MOVEA' 137'    ERR,EC                          S01401
     C                     SETON                     86                   S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     END                                            S01401
     C/COPY WNCPYSRC,SE0040C055
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *                                                                   S01401
      *****************************************************************   CEU018
      /EJECT                                                              CEU018
      *****************************************************************   CEU018
      *                                                               *   CEU018
      *  VLNMDP - Subroutine to Validate Nominal Decimal Places.      *   CEU018
      *                                                               *   CEU018
      *  Called by:  VLDITL                                           *   CEU018
      *                                                               *   CEU018
      *****************************************************************   CEU018
      *                                                                   CEU018
     C           VLNMDP    BEGSR                           *** VLNMDP *** CEU018
      *                                                                   CEU018
      ***  Set Off Validation Indicator.                                  CEU018
     C                     MOVE *OFF      *IN85                           CEU018
      *                                                                   CEU018
      ***  SNMDP must be blank for Processing Types 7 or 8...             CEU018
      ***  (field already protected if in Amend mode (IN83))              CEU018
      *                                                                   CEU018
     C           PROT      IFEQ '7'                                       CEU018
     C           PROT      OREQ '8'                                       CEU018
      *                                                                   CEU018
     C***********SNMDP     IFNE *BLANK                              CEU018186556
     C***********SACTN     ANDNE'A'                                 CEU018186556
     C***********          ADD  1         EC                        CEU018186556
     C***********          MOVEA' 142'    ERR,EC                    CEU018186556
     C***********          MOVE *ON       *IN85                     CEU018186556
     C***********          ENDIF                                    CEU018186556
      *                                                                   CEU018
      ***  ...else entry is optional and must be between 0 and 4.         CEU018
     C                     ELSE                                           CEU018
      *                                                                   CEU018
     C           SNMDP     IFNE *BLANK                                    CEU018
      *                                                                   CEU018
     C           SNMDP     IFLT '0'                                       CEU018
     C           SNMDP     ORGT '4'                                       CEU018
     C                     ADD  1         EC                              CEU018
     C                     MOVEA' 140'    ERR,EC                          CEU018
     C                     MOVE *ON       *IN85                           CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C                     ENDIF                                          CEU018
      *                                                                   CEU018
     C                     ENDSR                                          CEU018
      *****************************************************************   S01401
      /EJECT                                                              S01176
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  SRVETX - Subroutine to Validate European Tax Indicator.      *                       CGL031
      *                                                               *                       CGL031
      *  Called by:  VLDITL                                           *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRVETX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Default the value to 'N' for commodities and equities.                               CGL031
      *                                                                                       CGL031
     C           SSETX     IFEQ *BLANKS                                                       CGL031
     C           PROT      IFEQ '4'                                                           CGL031
     C           PROT      OREQ '2'                                                           CGL031
     C                     MOVE 'N'       SSETX                                               CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Mandatory field must be either 'Y' or 'N'                                            CGL031
      *                                                                                       CGL031
     C           SSETX     IFNE 'Y'                                                           CGL031
     C           SSETX     ANDNE'N'                                                           CGL031
     C                     ADD  1         EC                                                  CGL031
     C                     MOVEA' 283'    ERR,EC                                              CGL031
     C                     MOVE *ON       *IN88                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************   S01176
      *                                                               *   S01176
      *  DFTITL - Subroutine to Output default values on the Initial  *   S01176
      *           Screen for those fields not entered.                *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           DFTITL    BEGSR                           *** DFTITL *** S01176
     C**                                                                  E19868
     C* If incomplete indicator is 'C' must enter investment type and     E19868
     C* nominal currency before chaining to INVTPD to obtain defaults.    E19868
     C**                                                                  E19868
     C*                                                                   E20687
     C* LEAVE ALL VALIDATION FOR INITIAL SCREEN TO SUBROUTINE VLDITL      E20687
     C*                                                                   E20687
     C********** SINCS     IFEQ 'C'                                E19868 E20687
     C**********                                                   E19868 E20687
     C********** SNMCY     IFEQ '   '                              E19868 E20687
     C**********           ADD  1         EC                       E19868 E20687
     C**********           MOVEA' 109'    ERR,EC                   E19868 E20687
     C**********           SETON                     1754          E19868 E20687
     C**********           END                                     E19868 E20687
     C********** SSITP     IFEQ '   '                              E19868 E20687
     C**********           ADD  1         EC                       E19868 E20687
     C**********           MOVEA' 110'    ERR,EC                   E19868 E20687
     C**********           SETON                     1755          E19868 E20687
     C**********           END                                     E19868 E20687
     C**********                                                   E19868 E20687
     C********** *IN17     IFEQ '1'                                E19868 E20687
     C**********           GOTO DFTEND                             E19868 E20687
     C**********           END                                     E19868 E20687
     C**********                                                   E19868 E20687
     C**********           END                                     E19868 E20687
     C**                                                                  S01176
     C* Obtain Investment Type Details for default                        S01176
     C**                                                                  S01176
     C           ITPKA     CHAININVTPDF              33                   S01176
     C*                                                                   E19868
     C********** SINCS     IFEQ 'C'                                E19868 E20687
     C********** *IN33     IFEQ '1'                                E19868 E20687
     C**********           ADD  1         EC                       E19868 E20687
     C**********           MOVEA' 111'    ERR,EC                   E19868 E20687
     C**********           SETON                     175455        E19868 E20687
     C**********           ELSE                                    E19868 E20687
     C***********                                                  E19868 E20687
     C**and*not*be*deleted*record********************************* E19868 E20687
     C***********                                                  E19868 E20687
     C********** RECI      IFEQ '*'                                E19868 E20687
     C**********           ADD  1         EC                       E19868 E20687
     C**********           MOVEA' 111'    ERR,EC                   E19868 E20687
     C**********           SETON                     175455        E19868 E20687
     C**********           END                                     E19868 E20687
     C**********           END                                     E19868 E20687
     C**********                                                   E19868 E20687
     C********** *IN17     IFEQ '1'                                E19868 E20687
     C**********           GOTO DFTEND                             E19868 E20687
     C**********           END                                     E19868 E20687
     C**********                                                   E19868 E20687
     C**********           END                                     E19868 E20687
     C*                                                                   S01176
     C* If Record not found, blank out all default values                 S01176
     C**                                                                  S01176
     C           *IN33     IFEQ '1'                                       S01176
     C                     MOVE *BLANKS   DIND                            S01176
     C                     MOVE *BLANKS   DMCY                            S01176
     C                     MOVE *BLANKS   DVCY                            S01176
     C                     MOVE *BLANKS   DSEC                            S01176
     C                     MOVE *BLANKS   DRAT                            S01176
     C                     MOVE *BLANKS   DMAR                            S01176
     C                     MOVE *BLANKS   DCYR                            S01176
     C                     MOVE *ZEROS    DTRD                            S01176
     C                     MOVE *BLANKS   DVDT                            S01176
     C                     MOVE *BLANKS   DEXD                            S01176
     C                     MOVE *BLANKS   DDYB                            S01176
     C                     MOVE *BLANKS   DDVB                            S01176
     C                     MOVE *BLANKS   DCNL                            S01176
     C                     MOVE *BLANKS   DCMF                            S01397
     C                     MOVE *BLANKS   DDLS                            S01397
     C                     MOVE *BLANKS   DDSB                            S01397
     C                     MOVE *BLANKS   PLDPCD                          CPL002
     C                     MOVE *BLANKS   PLDRCD                          CPL002
     C                     END                                            S01176
     C*                                                                   S01176
     C* Save Existing contents to redisplay Changes                       S01176
     C*                                                                   S01176
     C*********************MOVE SQLTY     XQLTY                   S01176  S01186
     C*********************MOVE SMKTI     XMKTI                   S01176  S01186
     C*********************MOVE SSDNM     XSDNM                   S01176  S01186
     C*********************MOVE SVDFT     XVDFT                   S01176  S01186
     C*********************MOVE SEDFT     XEDFT                   S01176  S01186
     C*********************MOVE SVLCY     XVLCY                   S01176  S01186
     C*********************MOVE SSSEC     XSSEC                   S01176  S01186
     C*********************MOVE SMLTI     XMLTI                   S01176  S01186
     C*********************MOVE SSIDY     XSIDY                   S01176  S01186
     C*********************MOVE SSCOR     XSCOR                   S01176  S01186
     C*                                                                   S01186
     C                     MOVE SQLTY     YQLTY                           S01186
     C                     MOVE SMKTI     YMKTI                           S01186
     C                     MOVE SSDNM     YSDNM                           S01186
     C                     MOVE SVDFT     YVDFT                           S01186
     C                     MOVE SEDFT     YEDFT                           S01186
     C                     MOVE SVLCY     YVLCY                           S01186
     C                     MOVE SSSEC     YSSEC                           S01186
     C                     MOVE SMLTI     YMLTI                           S01186
     C                     MOVE SSIDY     YSIDY                           S01186
     C                     MOVE SSCOR     YSCOR                           S01186
     C*                                                                   S01186
     C* Industry Code                                                     S01176
     C**                                                                  S01176
     C           SSIDY     IFEQ *BLANKS                                   S01176
     C           SSIDY     OREQ *ZEROS                                    S01176
     C           DIND      IFEQ *BLANKS                                   S01176
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE0040CISE                                           S01408
     C*                                                                   S01408
     C**********           MOVELSISSR     KISSR   60                                   S01176 CSD027
     C                     MOVELSISSR     KISSR   6                                           CSD027
     C********** KISSR     CHAINCLINTCBF             33             S01176S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELKISSR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                 S01176S01117
     C**********           MOVE LIND      SSIDY                     S01176S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          MOVELBBLINC    SSIDY                     S01117E24894
     C                     MOVELBBLICD    SSIDY                           E24894
     C                     END                                            S01176
     C                     ELSE                                           S01176
     C                     MOVE DIND      SSIDY                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Value Currency                                                    S01176
     C**                                                                  S01176
     C           SVLCY     IFEQ '   '                                     S01176
     C           DVCY      IFEQ '   '                                     S01176
     C                     MOVE SNMCY     SVLCY                           S01176
     C                     ELSE                                           S01176
     C                     MOVE DVCY      SVLCY                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C*  Multi-Currency Indicator                                         S01176
     C**                                                                  S01176
     C           SMLTI     IFEQ ' '                                       S01176
     C           DMCY      IFEQ ' '                                       S01176
     C                     MOVE 'N'       SMLTI                           S01176
     C                     ELSE                                           S01176
     C                     MOVE DMCY      SMLTI                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Sector Code                                                       S01176
     C**                                                                  S01176
     C           SSSEC     IFEQ *BLANKS                                   S01176
     C           SINCS     IFEQ 'C'                                       S01176
     C           INCS      ANDEQ'I'                                       S01176
     C           SINCS     OREQ 'C'                                       S01176
     C           SACTN     ANDEQ'I'                                       S01176
     C                     MOVE DSEC      SSSEC                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Rating                                                            S01176
     C**                                                                  S01176
     C***********SQLTY     IFEQ ' '                                       S01186
     C           SQLTY     IFEQ *BLANKS                                   S01186
     C           SINCS     IFEQ 'C'                                       S01176
     C           INCS      ANDEQ'I'                                       S01176
     C           SINCS     OREQ 'C'                                       S01176
     C           SACTN     ANDEQ'I'                                       S01176
     C                     MOVE DRAT      SQLTY                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Market Indicator                                                  S01176
     C**                                                                  S01176
     C           SMKTI     IFEQ *BLANKS                                   S01176
     C***********DMAR      IFEQ *BLANKS                            S01176 E31315
     C***********          MOVE 'P'       SMKTI                    S01176 E31315
     C***********          ELSE                                    S01176 E31315
     C                     MOVE DMAR      SMKTI                           S01176
     C***********          END                                     S01176 E31315
     C                     END                                            S01176
     C**                                                                  S01176
     C* Country of Risk                                                   S01176
     C**                                                                  S01176
     C           SSCOR     IFEQ *BLANKS                                   S01176
     C           DCYR      IFEQ *BLANKS                                   S01176
     C                     MOVELSISSR     KISSR                           S01176
     C********** KISSR     CHAINCLINTCBF             33             S01176S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELKISSR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                 S01176S01117
     C**********           MOVE CLOC      SSCOR                     S01176S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          MOVELBBCOLC    SSCOR                    S01117 E27093
     C                     MOVE BBCNCZ    SSCOR                           E27093
     C                     END                                            S01176
     C                     ELSE                                           S01176
     C                     MOVE DCYR      SSCOR                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Trade Denomination                                                S01176
     C**                                                                  S01176
     C           SSDNM     IFEQ *BLANKS                                   S01176
     C           SINCS     IFEQ 'C'                                       S01176
     C           INCS      ANDEQ'I'                                       S01176
     C           SINCS     OREQ 'C'                                       S01176
     C           SACTN     ANDEQ'I'                                       S01176
     C           DTRD      IFNE *ZEROS                                    S01176
     C                     MOVE DTRD      SSDNM                           S01176
     C                     MOVEASSDNM     DNM                             S01176
     C*                                                                   S01176
     C* Exclude leading zeros                                             S01176
     C*                                                                   S01176
     C                     Z-ADD1         X                               S01176
     C           DNM,X     DOWEQ' '                                       S01176
     C           DNM,X     OREQ '0'                                       S01176
     C                     MOVEA' '       DNM,X                           S01176
     C                     ADD  1         X                               S01176
     C                     END                                            S01176
     C                     MOVEADNM       SSDNM                           S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   SSDNM                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Value Date                                                        S01176
     C**                                                                  S01176
     C           SVDFT     IFEQ *BLANKS                                   S01176
     C           SINCS     IFEQ 'C'                                       S01176
     C           INCS      ANDEQ'I'                                       S01176
     C           SINCS     OREQ 'C'                                       S01176
     C           SACTN     ANDEQ'I'                                       S01176
     C                     MOVE DVDT      SVDFT                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Ex Date                                                           S01176
     C**                                                                  S01176
     C           SEDFT     IFEQ *BLANKS                                   S01176
     C           SINCS     IFEQ 'C'                                       S01176
     C           INCS      ANDEQ'I'                                       S01176
     C           SINCS     OREQ 'C'                                       S01176
     C           SACTN     ANDEQ'I'                                       S01176
     C                     MOVE DEXD      SEDFT                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Test contents to redisplay Changes                                S01176
     C*                                                                   S01176
     C***********SQLTY     IFNE XQLTY                             S01176  S01186
     C***********SMKTI     ORNE XMKTI                             S01176  S01186
     C***********SSDNM     ORNE XSDNM                             S01176  S01186
     C***********SVDFT     ORNE XVDFT                             S01176  S01186
     C***********SEDFT     ORNE XEDFT                             S01176  S01186
     C***********SVLCY     ORNE XVLCY                             S01176  S01186
     C***********SSSEC     ORNE XSSEC                             S01176  S01186
     C***********SMLTI     ORNE XMLTI                             S01176  S01186
     C***********SSIDY     ORNE XSIDY                             S01176  S01186
     C***********SSCOR     ORNE XSCOR                             S01176  S01186
     C*                                                                   S01186
     C** if any defaults have been set up redisplay screen 1              S01186
     C*                                                                   S01186
     C           SQLTY     IFNE YQLTY                                     S01186
     C           SMKTI     ORNE YMKTI                                     S01186
     C           SSDNM     ORNE YSDNM                                     S01186
     C           SVDFT     ORNE YVDFT                                     S01186
     C           SEDFT     ORNE YEDFT                                     S01186
     C           SVLCY     ORNE YVLCY                                     S01186
     C           SSSEC     ORNE YSSEC                                     S01186
     C           SMLTI     ORNE YMLTI                                     S01186
     C           SSIDY     ORNE YSIDY                                     S01186
     C           SSCOR     ORNE YSCOR                                     S01186
     C*                                                                   S01186
     C                     MOVE '1'       *IN17                           S01176
     C                     END                                            S01176
      *                                                                   CEU018
     C*  Default zero to Nominal Decimal Places if no entry is made       CEU018
     C*  unless PROT = 7 or 8.                                            CEU018
      *                                                                   CEU018
     C           SNMDP     IFEQ ' '                                       CEU018
     C           PROT      ANDNE'7'                                       CEU018
     C           PROT      ANDNE'8'                                       CEU018
     C                     MOVE '0'       SNMDP                           CEU018
     C                     ENDIF                                          CEU018
     C*                                                                   CPL002
     C*** Set Default for Plato Report Group and Pricing Group.           CPL002
     C*                                                                   CPL002
     C           PLDPCD    IFNE *BLANKS                                   CPL002
     C           SPGCD     ANDEQ*BLANKS                                   CPL002
     C           SACTN     ANDEQ'I'                                       CPL002
     C                     MOVE PLDPCD    SPGCD                           CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C           PLDRCD    IFNE *BLANKS                                   CPL002
     C           SRGCD     ANDEQ*BLANKS                                   CPL002
     C           SACTN     ANDEQ'I'                                       CPL002
     C                     MOVE PLDRCD    SRGCD                           CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C*** Set Default for Plato Debt/Equity Instrument Code               CPL002
     C*                                                                   CPL002
     C           SICCD     IFEQ *BLANKS                                   CPL002
     C           SACTN     ANDEQ'I'                                       CPL002
     C                     MOVE *BLANKS   PLCODE                          CPL002
     C                     MOVE SNMCY     PLCCY                           CPL002
     C                     MOVELSSESN     PLNME                           CPL002
     C                     MOVE PLCODE    SICCD                           CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C*** Set Default for Plato Debt (security)/Equity Name               CPL002
     C*                                                                   CPL002
     C           SDINM     IFEQ *BLANKS                                   CPL002
     C           SACTN     ANDEQ'I'                                       CPL002
     C                     MOVE SSESN     SDINM                           CPL002
     C                     END                                            CPL002
     C/COPY WNCPYSRC,SE0040C153
      *                                                                   CEU018
     C*                                                                   S01176
     C***********          ENDSR                                   S01176 E19868
     C***********DFTEND    ENDSR                                   E19868 E20687
     C                     ENDSR                                          E20687
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      *                                                               *   S01176
      *  DFTDSC - Subroutine to Output default values on the Second   *   S01176
      *           Screen for fields not entered on Discounts.         *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           DFTDSC    BEGSR                           *** DFTDSC *** S01176
     C**                                                                  S01176
     C* Maturity Date Indicator                                           S01176
     C**                                                                  S01176
     C           *IN38     IFEQ '1'                                       S01176
     C           SMDTI1    IFEQ *BLANKS                                   S01176
     C                     MOVE 'A'       SMDTI1                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Day Basis                                                         S01176
     C**                                                                  S01176
     C           SDYBS1    IFEQ *BLANKS                                   S01176
     C                     MOVE DDYB      SDYBS1                          S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C*  Divisor Basis                                                    S01176
     C**                                                                  S01176
     C           SDVBS1    IFEQ *BLANKS                                   S01176
     C                     MOVE DDVB      SDVBS1                          S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Contingency Liability Indicator                                   S01176
     C**                                                                  S01176
     C           SCNLI1    IFEQ *BLANKS                                   S01176
     C                     MOVE DCNL      SCNLI1                          S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Risk Customer                                                     S01176
     C**                                                                  S01176
     C           *IN38     IFEQ '1'                                       S01176
     C           SRSKC     IFEQ *BLANKS                                   S01176
     C                     MOVELSISSR     SRSKC                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      *                                                               *   S01176
      *  DFTINT - Subroutine to Output default values on the Second   *   S01176
      *           Screen for fields not entered on Interest Securities*   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           DFTINT    BEGSR                           *** DFTINT *** S01176
     C**                                                                  S01176
     C* Maturity Date Indicator                                           S01176
     C**                                                                  S01176
     C           *IN38     IFEQ '1'                                       S01176
     C           SMDTI2    IFEQ *BLANKS                                   S01176
     C                     MOVE 'A'       SMDTI2                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Day Basis                                                         S01176
     C**                                                                  S01176
     C           SDYBS2    IFEQ *BLANKS                                   S01176
     C                     MOVE DDYB      SDYBS2                          S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C*  Divisor Basis                                                    S01176
     C**                                                                  S01176
     C           SDVBS2    IFEQ *BLANKS                                   S01176
     C                     MOVE DDVB      SDVBS2                          S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Contingency Liability Indicator                                   S01176
     C**                                                                  S01176
     C           SCNLI2    IFEQ *BLANKS                                   S01176
     C                     MOVE DCNL      SCNLI2                          S01176
     C                     END                                            S01176
     C**                                                                  S01176
     C* Risk Customer                                                     S01176
     C**                                                                  S01176
     C           *IN38     IFEQ '1'                                       S01176
     C           SRSKC     IFEQ *BLANKS                                   S01176
     C                     MOVELSISSR     SRSKC                           S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDFLS - Subroutine to Update Files with requested Action.   *
      *                                                               *
      *****************************************************************
      *
     C           UPDFLS    BEGSR                           *** UPDFLS ***
     C*
     C* Fetch last used transaction number
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP27                                           S01408
     C*                                                                   S01408
     C*
     C                     EXSR ZTNLU1
     C*
     C* Inputs
     C*
     C           SACTN     IFEQ 'I'
     C           SSESN     CHAINSECTYDF              31
     C           *IN31     IFEQ '0'
     C           RECI      ANDEQ'D'
     C***********          SETON                     0209                 102342
     C                     SETON                       09                 102342
     C                     MOVE '1'       *INKL                           102342
     C                     MOVEAINF,1     ERRMSG
     C                     Z-ADD01021     STATUS
     C                     EXSR INFSR
     C*
     C                     ELSE
     C*
     C* Translate records from screen layout to file layout
     C*
     C                     EXSR TRSECT
     C                     MOVE 'D'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVE 'I'       CHTP
     C                     MOVELNATN      TNLU
     C*                                                                   136425
     C*** Initialise new fields added to File                             136425
     C*                                                                   136425
     C                     MOVE *BLANKS   SRRB                            136425
     C                     Z-ADD0         SRBK                            136425
     C*                                                                   136425
     C/COPY WNCPYSRC,SE0040C099
     C                     END
      *                                                                                       232329
      ** Initialise time stamp if new record is to be written to file.                        202329
      *                                                                                       232329
     C           *IN31     IFEQ '1'                                                           202329
     C                     MOVEASTAMP,1   TMST             Default Timestamp                  202329
     C                     ENDIF                                                              202329
      *                                                                                       202329
     C   31                WRITESECTYDF
     C  N31                UPDATSECTYDF
     C*                                                                   S01169
     C**    IF THE EXTEL OPTION INDICATOR IS 'Y'                          S01169
     C*                                                                   S01169
     C********** EXMO      IFEQ 'Y'                                 S01169S01117
     C           BVEXOP    IFEQ 'Y'                                       S01117
     C           *INU3     ANDEQ'1'                                       E90095
     C*                                                                   S01169
     C*   Output to PF/EXVALD                                             S01169
     C                     EXSR IVAL                                      S01169
     C                     END                                            S01169
     C*                                                                   S01169
     C                     ELSE
     C/COPY WNCPYSRC,SE0040C022
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C/COPY WNCPYSRC,SE0040C145
     C                     MOVE 'N'       WERRUP  1                       CSE007
     C                     ENDIF                                          CSE007
      /SPACE 3
     C*
     C* Amendments
     C/COPY WNCPYSRC,SE0040C136
     C*
     C           SACTN     IFEQ 'A'
     C/COPY WNCPYSRC,SE0040C023
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C/COPY WNCPYSRC,SE0040C146
      *                                                                   CSE007
      ** Check, if value currency or maturity date has changed            CSE007
     C           SVLCY     IFNE VLCY                                      CSE007
     C                     MOVE 'Y'       WPVCCH                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE 'N'       WPVCCH                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C   15                MOVE SMATY1    ZDATE                           CSE007
     C   10                MOVE SMATY2    ZDATE                           CSE007
     C                     EXSR ZDATE1                                    CSE007
     C           ZDAYNO    IFNE MATY                                      CSE007
     C                     MOVE 'Y'       WPMDCH                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE 'N'       WPMDCH                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C           SSESN     CHAINSECTYDF              33
     C/COPY WNCPYSRC,SE0040C024
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C/COPY WNCPYSRC,SE0040C147
     C   33                MOVE 'Y'       WERRUP                          CSE007
     C                     ENDIF                                          CSE007
     C           TNLU      IFNE STNLU
     C***********          SETON                     0209                 102342
     C                     SETON                       09                 102342
     C                     MOVE '1'       *INKL                           102342
     C                     MOVEAINF,1     ERRMSG
     C                     Z-ADD01021     STATUS
     C                     EXSR INFSR
     C*
     C                     ELSE
     C*
     C** S01511 is active
     C*
     C           S01511    IFEQ 'Y'                                       S01511
     C*                                                                   S01511
     C** If market indicator has been changed, check if market migration  S01511
     C** not active then set market migration indicator on security else  S01511
     C** do not continue with the market migration update                 S01511
     C*                                                                   S01511
     C           SMKTI     IFNE SVMKTI                                    S01511
     C           SMAI      IFEQ 'Y'                                       S01511
     C***********          SETON                     0209           S01511102342
     C                     SETON                       09                 102342
     C                     MOVE '1'       *INKL                           102342
     C                     MOVEAINF,2     ERRMSG                          S01511
     C                     Z-ADD01021     STATUS                          S01511
     C                     EXSR INFSR                                     S01511
     C                     ELSE                                           S01511
     C                     MOVE 'Y'       SMAI                            S01511
     C                     EXCPTMARKUP                                    S01511
     C*                                                                   S01511
     C** Call SEC7000 to update markets on position, settlement and       S01511
     C** trades files.  This happens before the security is updated.      S01511
     C*                                                                   S01511
     C                     MOVE 'N'       WRTN    1                       S01511
     C                     CALL 'SEC7000'                                 S01511
     C                     PARM           SSESN                           S01511
     C                     PARM           SMKTI                           S01511
     C                     PARM           WRTN                            S01511
     C*                                                                   S01511
     C** If it is not successful then the security does not get update d. S01511
     C*                                                                   S01511
     C           WRTN      IFEQ '1'                                       S01511
     C***********          SETON                     0209           S01511102342
     C                     SETON                       09                 102342
     C                     MOVE '1'       *INKL                           102342
     C                     MOVEAINF,2     ERRMSG                          S01511
     C                     Z-ADD01021     STATUS                          S01511
     C                     EXSR INFSR                                     S01511
     C           SSESN     CHAINSECTYDF              33                   S01511
     C/COPY WNCPYSRC,SE0040C035
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C/COPY WNCPYSRC,SE0040C148
     C   33                MOVE 'Y'       WERRUP                          CSE007
     C                     ENDIF                                          CSE007
     C                     MOVE 'N'       SMAI                            S01511
     C                     EXCPTMARKUP                                    S01511
     C                     END                                            S01511
     C*                                                                   S01511
     C** CHAIN again to the security as the file pointer needs to rese t. S01511
     C*                                                                   S01511
     C           SSESN     CHAINSECTYDF              33                   S01511
     C/COPY WNCPYSRC,SE0040C025
     C*                                                                   S01511
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C/COPY WNCPYSRC,SE0040C149
     C   33                MOVE 'Y'       WERRUP                          CSE007
     C                     ENDIF                                          CSE007
     C/COPY WNCPYSRC,SE0040C137
     C                     END                                            S01511
     C                     END                                            S01511
     C*                                                                   S01511
     C* Translate records from screen layout to file layout               S01511
     C*                                                                   S01511
     C/COPY WNCPYSRC,SE0040C026
     C           *INU7     IFEQ '0'                                       S01511
     C                     EXSR TRSECT                                    S01511
     C                     Z-ADDRUND      LCD                             S01511
     C                     MOVE 'A'       CHTP                            S01511
     C                     MOVE 'N'       SMAI                            S01511
     C                     MOVELNATN      TNLU                            S01511
     C                     ELSE                                           S01511
     C/COPY WNCPYSRC,SE0040C036
     C           CSE007    IFEQ 'N'                                       CSE007
     C           CEU017    ANDEQ'N'                                       CEU017
     C/COPY WNCPYSRC,SE0040C150
     C                     SETON                     33                   S01511
     C/COPY WNCPYSRC,SE0040C037
     C                     ELSE                                           CSE007
     C                     MOVE 'Y'       WERRUP                          CSE007
     C                     ENDIF                                          CSE007
     C                     END                                            S01511
     C/COPY WNCPYSRC,SE0040C027
     C                     END                                            S01511
     C*                                                                   S01511
     C** S01511 is not active                                             S01511
     C*                                                                   S01511
     C           S01511    IFNE 'Y'                                       S01511
     C*
     C* Translate records from screen layout to file layout
     C*
     C                     EXSR TRSECT
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     MOVELNATN      TNLU
     C                     END                                            S01511
     C/COPY WNCPYSRC,SE0040C100
     C                     END
     C*                                                                   S01511
     C**  Now update the security record if no error already              S01511
     C*                                                                   S01511
     C/COPY WNCPYSRC,SE0040C028
     C           CSE007    IFEQ 'N'                                       CSE007
     C           CEU017    ANDEQ'N'                                       CEU017
     C/COPY WNCPYSRC,SE0040C151
     C  N33                UPDATSECTYDF
     C/COPY WNCPYSRC,SE0040C029
     C                     ELSE                                           CSE007
      *                                                                   CSE007
     C           WERRUP    IFEQ 'N'                                       CSE007
      **                                                                  CSE007
      **  If val. currency or maturity date has changed, update           CSE007
      **  diary events before updating security record                    CSE007
     C           WPVCCH    IFEQ 'Y'                                       CSE007
     C           ORED      ANDNELCD                                       150303
     C           WPMDCH    OREQ 'Y'                                       CSE007
     C           ORED      ANDNELCD                                       150303
      *                                                                   CSE007
     C                     MOVEL*BLANK    WPERR   1                       CSE007
     C                     CALL 'SE0042'                                  CSE007
     C                     PARM           WPVCCH  1                       CSE007
     C                     PARM           WPMDCH  1                       CSE007
     C                     PARM           SSESN                           CSE007
     C                     PARM           VLCY                            CSE007
     C                     PARM           SEXR                            CSE007
     C                     PARM           SMDI                            CSE007
     C                     PARM           MATY                            CSE007
     C                     PARM           WPERR                           CSE007
      *                                                                   CSE007
     C           WPERR     IFNE *BLANK                                    CSE007
     C* IMEDIATELY END OF PROGRAM DATABASE ERROR                          CSE007
     C           WPERR     IFEQ '1'                                       CSE007
     C                     MOVEL'17'      DBASE                           CSE007
     C                     MOVEL'SECET'   DBFILE                          CSE007
     C                     MOVELSSESN     KK12   12                       CSE007
     C                     MOVE 'XR'      KK12                            CSE007
     C                     MOVE *ZEROS    DBKEY                           CSE007
     C                     MOVELKK12      DBKEY                           CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C           WPERR     IFEQ '2'                                       CSE007
     C                     MOVEL'18'      DBASE                           CSE007
     C                     MOVEL'SEDEVA'  DBFILE                          CSE007
     C                     MOVEL'1'       DBKEY                           CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     SETON                     U7U8LR               CSE007
     C                     DUMP                                           CSE007
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C                     ROLBK                                          CSE007
     C                     ENDIF                                                              CSC022
     C                     RETRN                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     UPDATSECTYDF                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   S01169
     C**    IF THE EXTEL OPTION INDICATOR IS 'Y'                          S01169
     C*                                                                   S01169
     C********** EXMO      IFEQ 'Y'                                 S01169S01117
     C           BVEXOP    IFEQ 'Y'                                       S01117
     C*   Output to PF/EXVALD                                             S01169
     C                     EXSR AVAL                                      S01169
     C                     END                                            S01169
     C*                                                                   S01169
     C                     ELSE
     C*
     C* Deletions
     C*
     C           SACTN     IFEQ 'D'
     C           SSESN     CHAINSECTYDF              33
     C           TNLU      IFNE STNLU
     C                     Z-ADD01021     STATUS
     C***********          SETON                     0209                 102342
     C                     SETON                       09                 102342
     C                     MOVE '1'       *INKL                           102342
     C                     SETOF                     4603
     C                     MOVEAINF,1     ERRMSG
     C                     EXSR INFSR
     C*
     C                     ELSE
     C*
     C* Amend last update details
     C*
     C                     MOVE 'C'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVE 'D'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C  N33                EXCPTDLTREC
     C*                                                                   E21717
     C*  Check LF/SEDEV - Security Diary Events                           E21717
     C*                                                                   E21717
     C                     Z-ADD0         NODEL   50                      E21717
     C           SESN      SETLLSEDEVDF                                   E21717
     C           *IN33     DOWEQ'0'                                       E21717
     C           SESN      READESEDEVDF                  33               E21717
     C           *IN33     IFEQ '0'                                       E21717
     C           RECI      ANDEQ'M'                                       E21717
     C                     MOVE '*'       RECI                            E21717
     C/COPY WNCPYSRC,SE0040C122
     C                     UPDATSEDEVDF                                   E21717
     C/COPY WNCPYSRC,SE0040C123
     C                     ADD  1         NODEL                           E21717
     C                     END                                            E21717
     C                     END                                            E21717
     C           NODEL     IFGT 0                                         E21717
     C***********          READ SEDEVA                   33        E21717 E28362
     C           1         CHAINSEDEVAF              33                   E28362
     C           *IN33     IFEQ '1'                                       E21717
     C***********          MOVEL'15'      DBASE            ********E21717*S01117
     C                     Z-ADD15        DBASE            ********E21717*S01117
     C                     MOVE 'SEDEVA'  DBFILE           * DB ERROR 15 *E21717
     C                     MOVEL'MISSING' KK     15        ***************E21717
     C                     MOVE ' TRAILER'KK                              E21717
     C                     MOVELKK        DBKEY                           E21717
     C                     SETON                     U7U8LR               E21717
     C                     DUMP                                           E21717
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C                     ROLBK                                          E21717
     C                     ENDIF                                                              CSC022
     C                     RETRN                                          E21717
     C                     ELSE                                           E21717
     C                     SUB  NODEL     NORE                            E21717
     C                     ADD  NODEL     NODE                            E21717
     C/COPY WNCPYSRC,SE0040C124
     C                     UPDATSEDEVAF                                   E21717
     C/COPY WNCPYSRC,SE0040C125
     C                     END                                            E21717
     C                     END                                            E21717
     C*                                                                   S01169
     C**    IF THE EXTEL OPTION INDICATOR IS 'Y'                          S01169
     C*                                                                   S01169
     C********** EXMO      IFEQ 'Y'                                 S01169S01117
     C           BVEXOP    IFEQ 'Y'                                       S01117
     C*   Output to PF/EXVALD                                             S01169
     C                     EXSR DVAL                                      S01169
     C                     END                                            S01169
     C*                                                                   S01169
     C                     END
     C                     END
     C                     END
     C*
     C* Fetch Audit record
     C*
     C           1         CHAINSECTYAF              U8
     C*
     C* Update if found
     C*
     C           *INU8     IFEQ '0'
     C*
     C           SACTN     IFEQ 'I'
     C                     ADD  1         SINS
     C***31******          ADD  1         NORE                            E13622
     C                     ADD  1         NORE                            E13622
     C                     ELSE
     C           SACTN     IFEQ 'A'
     C                     ADD  1         SAMD
     C                     ELSE
     C           SACTN     IFEQ 'D'
     C                     ADD  1         SDEL
     C                     SUB  1         NORE                            E13622
     C                     END
     C                     END
     C                     END
     C*
     C                     Z-ADDRUND      LCD
     C                     MOVE 'A'       CHTP
     C                     MOVELNATN      TNLU
     C*
     C/COPY WNCPYSRC,SE0040C126
     C                     UPDATSECTYAF
     C/COPY WNCPYSRC,SE0040C110
     C*
     C* COMIT Updates
     C*
     C           OLDSEC    IFEQ *BLANKS                                   CSE007
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C           CMTTXT    COMIT
     C                     ENDIF                                                              CSC022
     C                     ENDIF                                          CSE007
     C*
     C                     ELSE
     C                     SETON                     U7
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'03'      DBASE                           E20651
     C***********          MOVE '12'      DBASE                     E20651S01117
     C                     Z-ADD12        DBASE            ***************S01117
     C                     MOVEL'SECTYA'  DBFILE           * DB ERROR 12 *
     C                     MOVEL'AUDIT'   DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CP25                                           S01408
     C*                                                                   S01408
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              S01169
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0040CCP1                                           S01408
     C*                                                                   S01408
      *****************************************************************   S01169
      *                                                               *   S01169
      *  IVAL   - Subroutine to Insert Validation records with default*   S01169
      *           values, for each new Security.                      *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           IVAL      BEGSR                                          S01169
     C**                                                                  S01169
     C** Access validation details                                        S01169
     C** If record already exists - error                                 S01169
     C**                                                                  S01169
     C           SSESN     CHAINEXVALD               39                   S01169
     C           *IN39     IFEQ '0'                                       S01169
     C           RECI      ANDEQ'D'                                       S01169
     C                     Z-ADD01021     STATUS                          S01169
     C***********          SETON                     0209           S01169102342
     C                     SETON                       09                 102342
     C                     MOVE '1'       *INKL                           102342
     C                     SETOF                     4603                 S01169
     C                     MOVEAINF,1     ERRMSG                          S01169
     C                     EXSR INFSR                                     S01169
     C                     ELSE                                           S01169
     C*                                                                   S01169
     C* Write validation details                                          S01169
     C                     MOVE 'D'       RECI                            S01169
     C                     MOVE SSREF     A1P                             S01169
     C                     MOVE 'Y'       EXAP                            S01169
     C                     Z-ADD0         UPBD                            S01169
     C                     Z-ADD0         LPBD                            S01169
     C                     Z-ADD0         PMOV                            S01169
     C                     Z-ADDRUND      LCD                             S01169
     C                     MOVE 'I'       CHTP                            S01169
     C                     MOVELNATN      TNLU                            S01169
     C                     MOVEASTAMP,1   PRTMST           Default Timestamp                  CPK015
     C   39                WRITEEXVALDF                                   S01169
     C  N39                UPDATEXVALDF                                   S01169
     C**                                                                  S01169
     C** Check trailer exists                                             S01169
     C           1         CHAINEXVALZ               39                   S01169
     C           *IN39     IFEQ '1'                                       S01169
     C           RECI      ORNE 'Z'                                       S01169
     C**                                                                  S01169
      **     DB Error if no record found.                                 S01169
      **                                                                  S01169
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'10'      DBASE                    S01169 E20651
     C***********          MOVE '13'      DBASE                     E20651S01117
     C                     Z-ADD13        DBASE            ***************S01117
     C                     MOVEL'EXVALZ'  DBFILE           * DB ERROR 13 *S01169
     C                     MOVEL'MISSING' KK     15        ***************S01169
     C                     MOVE ' TRAILER'KK                              S01169
     C                     MOVELKK        DBKEY                           S01169
     C                     OUT  LDA                                       S01117
     C                     SETON                     U7U8LR               S01169
     C***********          DUMP                                     S01169S01117
     C                     EXSR *PSSR                                     S01117
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C                     ROLBK                                          S01169
     C                     ENDIF                                                              CSC022
     C                     RETRN                                          S01169
     C**                                                                  S01169
     C                     ELSE                                           S01169
     C**                                                                  S01169
     C** Update trailer                                                   S01169
     C           NINS      ADD  1         NINS                            S01169
     C           NORE      ADD  1         NORE                            S01169
     C**                                                                  S01169
     C                     UPDATEXVALZF                                   S01169
     C**                                                                  S01169
     C                     END                                            S01169
     C                     END                                            S01169
     C**                                                                  S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      /EJECT                                                              S01169
      *****************************************************************   S01169
      *                                                               *   S01169
      *  AVAL   - Subroutine to Amend Validation records, if present, *   S01169
      *           for an Amended Security.                            *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           AVAL      BEGSR                                          S01169
     C**                                                                  S01169
     C** Access validation details                                        S01169
     C** If record does not exist - end process                           S01169
     C           SSESN     CHAINEXVALD               99                   S01169
     C           *IN99     IFEQ '0'                         B1            S01169
     C           RECI      ANDEQ'D'                                       S01169
     C* Amend validation details                                          S01169
     C                     MOVE SSREF     SSREFN  70                      S01169
     C           SSREFN    IFNE A1P                         B2            S01169
     C                     MOVE SSREF     A1P                             S01169
     C*                                                                   S01169
     C                     Z-ADDRUND      LCD                             S01169
     C                     MOVE 'A'       CHTP                            S01169
     C                     MOVELNATN      TNLU                            S01169
     C*                                                                   S01169
     C                     UPDATEXVALDF                                   S01169
     C                     END                               E2           S01169
     C                     END                               E1           S01169
     C**                                                                  S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      /EJECT                                                              S01169
      *****************************************************************   S01169
      *                                                               *   S01169
      *  DVAL   - Subroutine to Delete Validation records, if present,*   S01169
      *           for a Deleted Security.                             *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           DVAL      BEGSR                                          S01169
     C**                                                                  S01169
     C** Access validation details                                        S01169
     C** If record does not exist - end process                           S01169
     C           SSESN     CHAINEXVALD               99                   S01169
     C           *IN99     IFEQ '0'                         B1            S01169
     C           RECI      ANDEQ'D'                                       S01169
     C* Delete validation details                                         S01169
     C                     MOVE '*'       RECI                            S01169
     C                     Z-ADDRUND      LCD                             S01169
     C                     MOVE 'D'       CHTP                            S01169
     C                     MOVELNATN      TNLU                            S01169
     C                     UPDATEXVALDF                                   S01169
     C**                                                                  S01169
     C** Check trailer exists                                             S01169
     C           1         CHAINEXVALZ               99                   S01169
     C           *IN99     IFEQ '1'                         B2            S01169
     C           RECI      ORNE 'Z'                                       S01169
     C**                                                                  S01169
      **     DB Error if no record found.                                 S01169
      **                                                                  S01169
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'10'      DBASE                    S01169 E20651
     C***********          MOVEL'14'      DBASE                     E20651S01117
     C                     Z-ADD14        DBASE            ***************S01117
     C                     MOVEL'EXVALZ'  DBFILE           * DB ERROR 14 *S01169
     C                     MOVEL'MISSING' KK     15        ***************S01169
     C                     MOVE ' TRAILER'KK                              S01169
     C                     MOVELKK        DBKEY                           S01169
     C                     OUT  LDA                                       S01117
     C                     SETON                     U7U8LR               S01169
     C***********          DUMP                                     S01169S01117
     C                     EXSR *PSSR                                     S01117
     C           CSC022    IFEQ 'N'                                                           CSC022
     C           CSC022    OREQ 'Y'                                                           CSC022
     C           CMTSKP    ANDEQ'N'                                                           CSC022
     C                     ROLBK                                          S01169
     C                     ENDIF                                                              CSC022
     C                     RETRN                                          S01169
     C**                                                                  S01169
     C                     ELSE                              X2           S01169
     C**                                                                  S01169
     C** Update trailer                                                   S01169
     C           NDEL      ADD  1         NDEL                            S01169
     C***********NORE      SUB  1         NORE                     S01169 075524
     C**                                                                  S01169
     C                     UPDATEXVALZF                                   S01169
     C**                                                                  S01169
     C                     END                               E2           S01169
     C                     END                               E1           S01169
     C**                                                                  S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      /EJECT
      *****************************************************************   S01169
      **                                                              *   S01117
      ** *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS       *   S01117
      ** CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                 *   S01117
      ** CALLS: NOTHING                                               *   S01117
      **                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      **                                                              *   S01117
      ** CKISEL - SUBROUTINE TO CHECK FOR SELECTION ON INITIAL SCREEN *   S01117
      ** CALLED FROM: INITL                                           *   S01117
      ** CALLS: NOTHING                                               *   S01117
      **                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           CKISEL    BEGSR                           ** CKISEL **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C                     MOVELSISSR     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSISSR     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SISSR                           S01117
     C                     SETOF                     62                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCUST    SISSR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSSIDY     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSSIDY     @KEYI                           S01117
     C                     CALL 'AOINDSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYI                           S01117
     C           SDINDS    PARM SDINDS    DSFDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SSIDY                           S01117
     C                     SETOF                     56                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELAOLICD    SSIDY                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSSCOR     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVE *BLANKS   @KEYC                           E28788
     C                     MOVELSSCOR     @KEYCY                          S01117
     C                     CALL 'AOCTRYR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYCY                          S01117
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SSCOR                           S01117
     C                     SETOF                     60                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA4CNCD    SSCOR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSVLCY     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSVLCY     @CKEY                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SVLCY                           S01117
     C                     SETOF                     57                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA6CYCD    SVLCY                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSNMCY     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSNMCY     @CKEY                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SNMCY                           S01117
     C                     SETOF                     54                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA6CYCD    SNMCY                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     ENDSR                           ** CKISEL **   S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      **                                                              *   S01117
      ** CKSSEL - SUBROUTINE TO CHECK FOR SELECTION ON SECOND SCREEN  *   S01117
      ** CALLED FROM: SECOND                                          *   S01117
      ** CALLS: NOTHING                                               *   S01117
      **                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           CKSSEL    BEGSR                           ** CKSSEL **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C           *IN38     IFEQ '1'                                       S01117
     C                     MOVELSRSKC     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C**********           MOVELSRSKC     @KEYS                                        S01117 261063
     C**********           CALL 'AOSECSR0'                                             S01117 261063
     C                     MOVE *BLANKS   @KEYC                                               261063
     C                     MOVELSRSKC     @KEYC                                               261063
     C                     CALL 'AOCUSTR0'                                                    261063
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C**********           PARM           @KEYS                                        S01117 261063
     C********** SDSECS    PARM SDSECS    DSSDY                                        S01117 261063
     C                     PARM           @KEYC                                               261063
     C                     PARM *BLANKS   @KYST                                               261063
     C           SDCUST    PARM SDCUST    DSSDY                                               261063
     C*                                                                   S01117
     C                     MOVE *BLANKS   SRSKC                           S01117
     C                     SETOF                     50                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C**********           MOVELBFCUST    SRSKC                                        S01117 261063
     C                     MOVELBBCUST    SRSKC                                               261063
     C                     MOVELBBCUST    CSTNUM                                              261063
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSBASC     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSBASC     @BKEY   2                       S01117
     C           SVLCY     IFNE *BLANKS                                   S01117
     C                     MOVELSVLCY     @CKEY                           S01117
     C                     ELSE                                           S01117
     C                     MOVELSNMCY     @CKEY                           S01117
     C                     END                                            S01117
     C                     CALL 'AOBSRTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C                     PARM           @BKEY                           S01117
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01117CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01117
     C                     MOVE *BLANKS   SBASC                           S01117
     C                     SETOF                     84                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBABSRC    SBASC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     ENDSR                           ** CKSSEL **   S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      **                                                              *   S01117
      ** CKTSEL - SUBROUTINE TO CHECK FOR SELECTION ON THIRD SCREEN   *   S01117
      ** CALLED FROM: THIRD                                           *   S01117
      ** CALLS: NOTHING                                               *   S01117
      **                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           CKTSEL    BEGSR                           ** CKTSEL **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C                     MOVELSLMGR     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C**********           MOVELSLMGR     @KEYS                                        S01117 261063
     C                     MOVELSLMGR     @KEYS   6                                           261063
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYS                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SLMGR                           S01117
     C                     SETOF                     53                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBFCUST    SLMGR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSFECY     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSFECY     @CKEY                           S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @CKEY                           S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SFECY                           S01117
     C                     SETOF                     62                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA6CYCD    SFECY                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     ENDSR                           ** CKTSEL * *  S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              CSE023
      *****************************************************************   CSE023
      *                                                               *   CSE023
      *  SRWND  - Window Processing                                   *   CSE023
      *                                                               *   CSE023
      *****************************************************************   CSE023
     C           SRWND     BEGSR                                          CSE023
      *                                                                   CSE023
     C           WNTAG     TAG                                            CSE023
      *                                                                   CSE023
     C           SACTN     IFEQ 'I'                                       CSE023
     C                     MOVE *BLANKS   CRTT                            CSE023
     C                     MOVE *BLANKS   INCT                            CSE023
     C                     MOVE *BLANKS   EXCD                            CSE023
     C                     MOVE *BLANKS   OIDI                            CSE023
     C                     MOVE *BLANKS   APIE                            CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     MOVE CRTT      #1CRTT                          CSE023
     C                     MOVE INCT      #1INCT                          CSE023
     C                     MOVE EXCD      #1EXCD                          CSE023
     C                     MOVE OIDI      #1OIDI                          CSE023
     C                     MOVE APIE      #1APIE                          CSE023
     C                     MOVE PROT      #1PROT                          CSE023
      *                                                                   CSE023
     C/COPY WNCPYSRC,SE0040C154
     C                     CALL 'WN0010'                                  CSE023
     C                     PARM 'SE0040  'PPGM   10                       CSE023
     C                     PARM *BLANKS   PFKEY   2                       CSE023
     C                     PARM SACTN     PACTN   1                       CSE023
     C                     PARM           DATA                            CSE023
     C                     PARM *BLANKS   PRTCD1  7                       CSE023
     C                     PARM *BLANKS   SPARE 256                       CSE023
      *                                                                   CSE023
     C           PRTCD1    IFEQ 'Y2U9999'                                 CSE023
     C                     MOVE *ON       *IN01                           CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C           PRTCD1    IFEQ 'USR0790'                                 CSE023
      *                                                                   CSE023
     C           NEWISS    IFEQ 'Y'                                       CSE023
     C           BGN4ST    OREQ 'Y'                                       CSE023
     C                     MOVE IN34      *IN34                           CSE023
     C                     EXSR THIRD                                     CSE023
     C                     MOVE *IN34     IN34                            CSE023
     C                     MOVE *OFF      *IN34                           CSE023
     C                     ELSE                                           CSE023
     C                     EXSR SECOND                                    CSE023
     C                     EXSR SAVSEC                                    CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C           *IN01     IFEQ *OFF                                      CSE023
     C           *IN05     ANDEQ*OFF                                      CSE023
     C                     GOTO WNTAG                                     CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDSR                                          CSE023
      *****************************************************************   CSE023
     C/COPY WNCPYSRC,SE0040C127
      /EJECT                                                              CSE005
     C/COPY ZSRSRC,ZFWDT                                                  CSE005
     C/COPY WNCPYSRC,SE0040C070
      /EJECT
     C/COPY WNCPYSRC,SE0040C141
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZASIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C***/COPY*ZSRSRC,ZDATE2Z4***                                         S01169
     C/COPY ZSRSRC,ZDATE2Z2                                               S01169
      /EJECT
     C*COPY*ZSRSRC,ZDATE6Z2****************                               S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/EJECT                                                              S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C*COPY*ZSRSRC,ZICD2Z1************                                    S01117
      *EJECT                                                              S01117
     C*COPY*ZSRSRC,ZICDSEZ1***********                                    S01117
      /EJECT                                                              E20085
SP   C/COPY ZSRSRC,ZLCDZ1                                                            E20085 MD057247
      /EJECT                                                              E20085
SP   C/COPY ZSRSRC,ZNCDZ3                                                 E20085
      ***/EJECT******************                                  S01158 E16302
     C***/COPY*ZSRSRC,ZSDESCZ3***                                  S01158 E16302
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C*COPY*ZSRSRC,ZSYSTMZ1**********                                     S01117
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT
     OSECTYDF E                DLTREC
     O                         RECI
     O                         LCD
     O                         CHTP
     O                         TNLU
     OSECTYDF E                MARKUP                                     S01511
     O                         SMAI                                       S01511
      /EJECT
      ***
      *                                                                   S01401
      ***  Arrays ALPHA1 and ALPHA2 introduced for MT5xx Feature.         S01401
      *                                                                   S01401
     O/COPY WNCPYSRC,SE0040O001
     X/COPY WNCPYSRC,SE0040X001
**  CPY@
(c) Finastra International Limited 2001
**  WAMSG (CSE011)                                                        CSE011
Code TK                                                                   CSE011
Code ISIN                                                                 CSE011
Code CUSIP                                                                CSE011
SEDOL/EXTEL code                                                          CSE011
Security Ref. 1                                                           CSE011
Security Ref. 2                                                           CSE011
Security Ref. 3                                                           CSE011
already used for                                                          CSE011
(                                                                         CSE011
)                                                                         CSE011
**   INF  - File updated error message
RECORD UPDATED BY ANOTHER WORKSTATION
FILE NOT UPDATED - ERROR IN MARKET UPDATE
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TABMTH/TABDAY     Month No/No of days in month
013102290331043005310630073108310930103111301231                          100228
**   TABYBS            Valid Yield Basis entries - AU added for S01232
A C J R S U W Y DADMDYAU
**   ALPHA1 - All Alhanumerics and Blank
0123456789 ABCDEFGHIJKLMNOPQRSTUVWXYZ
**   ALPHA2 - All Alphanumerics excluding Blank
0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ
** STAMP - Dummy timestamp                                                                    202329
0001-01-01-00.00.00.000000                                                                    202329
