     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Depot movements maintenance')                 *
/*XBIA*  OVRDBF FILE(DPTMVX) TOFILE(DPTMV) SHARE(*NO)                 *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *     This program will be made redundant at DBA R5.00          *
      *     In the interim please check the new ILE RPG versions      *
      *     and apply any new fixes if they are appropriate.          *
      *                                                               *
      *  SE0070 - DEPOT MOVEMENTS MAINTENANCE                         *
      *                                                               *
      *  Function: This program allows the input of Movements between *
      *   (I/C)    Depots where not associated with a Trade.          *
      *                                                               *
      *  CALLED BY: SEC02 - Input Cycle Processing                    *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD050604           Date 21Feb20               *
      *                 MD046248           Date 05Feb18               *
      *                 CDL099             Date 06Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 08Jul15               *
      *                 CGL165             Date 15Feb17               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183          Date 20Nov12               *
      *                 CRE075             Date 06Dec10               *
      *                 CSW210             Date 04May10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 CSD079             Date 05Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 11May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 227267             Date 10Jun04               *
      *                 226570             Date 27Jun04               *
      *                 208241             Date 16Jan03               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 BUG2576            Date 14May04               *
      *                 CLE025             Date 20Oct03               *
      *                 CRE020             Date 20Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CGP001             Date 14Oct03               *
      *                 222727             Date 05Nov03               *
      *                 211407             Date 09Nov02               *
      *                 208241             Date 21Aug02               *
      *                 194370             Date 12Jul01               *
      *                 207543             Date 17JUL02               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 CSD015             Date 14Oct02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 207006             Date 18Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 06Dec01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 CSE022             Date 29Mar01               *
      *                 CSE016             Date 10Jan01               *
      *                 173318             Date 08May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 186484             Date 23Feb01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186103             Date 06Nov00               *
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 140272             Date 20Apr00               *
      *                 CSE018             Date 26Apr00               *
      *                 125630             DATE 18Apr00               *
      *                 176510             Date 20Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
      *                 CSE012             Date 16Aug99               *
      *                 163088             Date 13Sep99               *
      *                 CSE006             Date 13epP99               *
      *                 CPB001             DATE 02Jul99               *
      *                 CGL011             Date 20Sep99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CSE010             Date 21Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAP010             Date 02Jul99               *
      *                 139054             Date 27Apr99               *
      *                 CAC005             Date 23Nov98               *
      *                 149621             Date 16Mar99               *
      *                 130862             Date 18Oct98               *
      *                 151945             DATE 06Jan99               *
      *                 151501             Date 28Dec98               *
      *                 CAP003             Date 30Jul98               *
      *                 136798             Date 09Jun98               *
      *                 CEU017             Date 03Mar98               *
      *                 CSE007             Date 06Jan98               *
      *                 110044             DATE 07NOV97               *
      *                 115651             DATE 05NOV97               *
      *                 CSE005             Date 04FEB97               *
      *                 112563             DATE 11APR97               *
      *                 102060             DATE 13FEB97               *
      *                 CSE003             DATE 11OCT96               *
      *                 CAC002             Date 15Sep96               *
      *                 CPM005             Date 29Jul96               *
      *                 084704             Date 01Aug96               *
      *                 083039             DATE 01AUG96               *
      *                 059110             DATE 25JUL96               *
      *                 088047             Date 26Jun96               *
      *                 103926             Date 31May96               *
      *                 103853             DATE 30MAY96               *
      *                 CSW003             DATE 09NOV95               *
      *                 095743             DATE 09NOV95               *
      *                 100228             DATE 29MAY96               *
      *                 066690             DATE 13MAY96               *
      *                 046800             DATE 09MAY96               *
      *                 102855             DATE 07MAY96               *
      *                 095034             DATE 24APR96               *
      *                 099886             DATE 19APR96               *
      *                 100017             DATE 19APR96               *
      *                 S01408             DATE 11MAR96               *
      *                 S01408             DATE 14DEC95               *
      *                 095235             DATE 27OCT95               *
      *                 092961             DATE 04OCT95               *
      *                 091254             DATE 20OCT95               *
      *                 S01408             DATE 07SEP95               *
      *                 087180             DATE 15JUN95               *
      *                 086491             DATE 15JUN95               *
      *                 085547             DATE 06JUN95               *
      *                 087371             DATE 29APR95               *
      *                 S01408             DATE 11APR95               *
      *                 081239             DATE 17JAN94               *
      *                 080673             DATE 22DEC94               *
      *                 046294             DATE 09NOV94               *
      *                 063760             DATE 09NOV94               *
      *                 056990             DATE 19JUN93               *
      *                 S01496             DATE 06OCT94               *
      *                 S01486             DATE 06OCT94               *
      *                 S01515             DATE 10AUG94               *
      *                 S01511             DATE 10AUG94               *
      *                 064575             DATE 29SEP94               *
      *                 S01496             DATE 23AUG94               *
      *                 065301             DATE 05MAY94               *
      *                 061701             DATE 02FEB94               *
      *                 066487             DATE 02FEB94               *
      *                 052254             DATE 06JAN94               *
      *                 062720             DATE 04NOV93               *
      *                 S01445             DATE 04NOV93               *
      *                 055962             DATE 20OCT93               *
      *                 S01401             DATE 20JAN93               *
      *                 039495             DATE 17FEB93               *
      *                 047922             DATE 01FEB93               *
      *                 047428             DATE 01FEB93               *
      *                 S01397             DATE 10SEP92               *
      *                 E37203             DATE 17MAR92               *
      *                 E32482             DATE 10JAN92               *
      *                 E32674             DATE 03DEC91               *
      *                 E27934             DATE 22OCT91               *
      *                 E27092             DATE 04SEP91               *
      *                 E28048             DATE 04SEP91               *
      *                 E25477             DATE 03SEP91               *
      *                 S01195             DATE 22FEB91               *
      *                 S01220             DATE 07DEC90               *
      *                 S01117             DATE 04DEC90               *
      *                 S01269             DATE 31JUL90               *
      *                 S01271             DATE 18JUN90               *
      *                 E23561             DATE 17SEP90               *
      *                 E23534             DATE 04SEP90               *
      *                 E21668             DATE 01MAY90               *
      *                 E21616             DATE 03APR90               *
      *                 E21480             DATE 21MAR90               *
      *                 E21474             DATE 20MAR90               *
      *                 E21216             DATE 26FEB90               *
      *                 E21271             DATE 26FEB90               *
      *                 E21066             DATE 06FEB90               *
      *                 E20651             DATE 10JAN90               *
      *                 E20646             DATE 19DEC89               *
      *                 S01232             DATE 30NOV89               *
      *                 E20380             DATE 30NOV89               *
      *                 E20116             DATE 28NOV89               *
      *                 E20032             DATE 04NOV89               *
      *                 S01199             DATE 01AUG89               *
      *                 E18617             DATE 14JUL89               *
      *                 E18718             DATE 11JUL89               *
      *                 E16772             DATE 19/06/89              *
      *                 E16929             DATE 10/05/89              *
      *                 E16338             DATE 28/02/89              *
      *                 E16336             DATE 28/02/89              *
      *                 E16334             DATE 28/02/89              *
      *                 S01179             DATE 21/10/88              *
      *                 E15253             DATE 13/10/88              *
      *                 S01176             DATE 06/10/88              *
      *                 E15252             DATE 29/09/88              *
      *                 E15326             DATE 20/09/88              *
      *                 E13788             DATE 09/08/88              *
      *                 E14277             DATE 27/07/88              *
      *                 E13933             DATE 20/07/88              *
      *                 E13648             DATE 15/07/88              *
      *                 E13934             DATE 14/07/88              *
      *                 E13797             DATE 08/07/88              *
      *                 E13821             DATE 20/06/88              *
      *                 E13654             DATE 15/06/88              *
      *                 E13658             DATE 15/06/88              *
      *                 E13476             DATE 31/05/88              *
      *                 S01158             DATE 13/05/88              *
      *                 S01158             DATE 05/05/88              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in copy source ZCNSDZ1. *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CSD079 - Enhanced Customer Maintenance API (Recompile)       *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  227267 - POSITION BLOCKED ALTHOUGH NO BLOCK FOR ALLOCATION   *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  BUG2576- Webfacing changes.  Rearranged the read/write seq-  *
      *           uence of the display file formats.                  *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGP001 - Global Processing.                                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  208241 - Recompiled due to changed /CPY ZSDESCZ3.            *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled due to changed ZYLDZ2.                   *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  207006 - Add Counterparty & Market Centre to SSI             *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           - Recompile over changed ZYLDZ2.                    *
      *           - A default timestamp string is required for        *
      *             file DPTMV write.                                 *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  CSE028 - Standing Settlement Instructions Enhancement        *
      *  CSE022 - Depository Definition Enhancement                   *
      *  CSE016 - Extended Security Descriptions                      *
      *  173318 - Complete fix 139054 that changed the way to obtain  *
      *           and convert the market price.                       *
      *  186484 - WI from TOF not accepted by Midas due to blank      *
      *           profit centre.  Default to unallocated profit       *
      *           centre from PCA ICD if blank.                       *
      *  186103 - Depot Movement Walk-in. No warning for undocumented *
      *           customer                                            *
      *  CSE023 - Treaty Withholding Tax                              *
      *  140272 - Recompile over changed ZYLDZ2                       *
      *  CSE018 - Deletion of Walk-In and walk-Out depot movement     *
      *           after movement date.                                *
      *  125630 - Rolldown still doesn't work due to RECI = 'S' recs. *
      *  176510 - Based on fix 173428 - Move of PC validation to after*
      *           Cust validation.  Use unalocated Profit Centre Code *
      *           only if no match found in the Prof Centre Default.  *
      *           Matrix. Also replaces a *Blank for Acof with value. *
      *  CSE015 - Forward Valued Depot Movements (Recompile)          *
      *  CSE017 - Cum/Ex Indicator on Depot Movements (Recompile)     *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
      *  163088 - Walk In/Outs available for maintenance even though  *
      *           CAP003 is on.                                       *
      *  CSE006 - Repos enhancement - Adds new parameters when        *
      *           calling SE1807                                      *
      *  CPB001 - 'Private Banking' Module                            *
      *  CGL011 - Collateral Processing for Midas                     *
      *  CSE010 - SE Transactions Enhancements                        *
      *  CAP010 - Enhanced switchability for APIs                     *
      *           CAP003 replaced by CAP126                           *
      *  139054 - Market Price entered today were not being used.     *
      *           Fix is to retrieve Market Price from LF/PRICM.      *
      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
      *  149621 - Recompile over changed DDS                          *
      *  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
      *  151945 - Recompiled Over changed ZDYYRZ3 .                   *
      *  151501 - Review Blocking of redenominated securities         *
      *  CAP003 - Conversion of Midas inputs to modular API structure *
      *           Phase 2.                                            *
      *           Walk In and Walk Out transactions are not           *
      *           maintained by this program with APIs installed      *
      *  136798 - Content of Portfolio Reference lost when accessing  *
      *           PF/SEPCCD                                           *
      *  CEU017 - Securities Redenomination Euro Changes              *
      *  CSE007 - Corporate Actions                                   *
      *  110044 - Amendment of Price field should not be allowed      *
      *           after first date has passed. Recompile over amended *
      *           display file.                                       *
      *  115651 - Settled position is not being reset on the In and   *
      *           Out depots when a depot movement is deleted, or is  *
      *           inserted and amended today. Amend the program to    *
      *           correctly calculate the settled amount.             *
      *  CSE005 - Effect of holidays on FRN Coupon Dates              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  112563 - Header and footer changes required for GUI          *
      *           Multilanguage support.                              *
      *  102060 - Decimal data error in Portfolio fields if PM off    *
      *           (problem with UDC CG4300)                           *
      *  CSE003 - '?' processing for security shortname.              *
      *  CAC002 - Profit Centre Accounting Development - Phase 2      *
      *  CPM005 - Private Banking Phase II                            *
      *           Focus Group Changes Upgraded to DBA                 *
      *           PBFG/2 - CALCULATE & REPORT PERF. FOR CUST.PORT.    *
      *           PBFG/5 - INSTRUMENT ASSET / LIABILITY SPLIT         *
      *           PBFG/6 - ADDITIONAL CUSTOMER DETAILS                *
      *           PBFG/7 - NET COMMITMENT BY CURRENCY                 *
      *           PBFG/8 - DISPLAY POSITIONS SPLIT BY CURRENCY        *
      *  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
      *  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
      *  059110 - Recompile over changed ZYLDZ2 sub.                  *
      *  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
      *  103926 - Cancellations not producing confirmations           *
      *  103853 - Repo/Pledge Indicator not cleared between inputs.   *
      *  CSW003 - MT5xx Message Generation - Phase 2                  *
      *  095743 - When amending Depot Movements after original entry  *
      *           Protect In Depot, Start Date, Nominal, Branch & Book*
      *  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
      *  066690 - Portfolio reference prompted as default if the      *
      *           details of portfolio has been defined in PMPORTLL   *
      *  046800 - Ensure reversal of position updating when deleting  *
      *           RR, RP, BB, BL, PD and PL.                          *
      *  102855 - For WI or WO backvalued, record was added by program*
      *           into file CDEPD if action date = RUND.              *
      *           Should use DEPOT IN or DEPOT OUT date.              *
      *  095034 - ROLL DOWN DOES NOT WORK                             *
      *  099886 - Rounding problem for partly paid securities.        *
      *           Recompile over amended standard subroutine ZACCZ.   *
      *  100017 - Position settlement unable to pick up day adj. on   *
      *           SECTYD. Change subroutine to use DADJN to stop      *
      *           interest day adjustment being used for amortisation.*
      *           Recompile over amended subroutine ZDAYS.            *
      *  S01408 - Addition core hook SE0070CCP6.                      *
      *           Addition core hook SE0070CCP7.                      *
      *           Addition core hook SE0070CCP8.                      *
      *           Addition core hook SE0070CCP9.                      *
      *           Addition core hook SE0070CP10.                      *
      *           Addition core hook SE0070FFP1.                      *
      *  S01408 - Addition core hook SE0070CCP4.                      *
      *           Addition core hook SE0070CCP5.                      *
      *  095235 - Default Customer Delivery/Withdrawal to Yes         *
      *  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
      *           (Wrong number of days calculated for day basis 1    *
      *           when start or end day is last day of February)      *
      *  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
      *  S01408 - Addition core hook SE0070IIP1.                      *
      *           Addition core hook SE0070CCP1.                      *
      *           Addition core hook SE0070CCP2.                      *
      *           Addition core hook SE0070CCP3.                      *
      *  087180 - Allow enquiry of a DPTMVD based on a matured sec.   *
      *           (not through review screen)                         *
      *  086491 - Wrong nbr of days calculated for day basis 1        *
      *           when start or end day is last day of February       *
      *           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
      *  085547 - When enquiring with a security that does not exist, *
      *           send a message instead of DBE                       *
      *  087371 - Pgm should write a SEPCCD record whether profit     *
      *           centre field is blank or not, to prevent database   *
      *           error in SE2400 during COB.                         *
      *  S01408 - Hook SE0070CVS1 added.                              *
      *           Hook SE0070CVSF added.                              *
      *           Hook SE0070CCPG added.                              *
      *           Hook SE0070IIPG added.                              *
      *  081239  -  Not all S01486 and S01496 changes switchable      *
      *  080673  -  Customer should be Portfolio Customer.            *
      *  046294  -  Use SPTFR to avoid problems if Portfolio          *
      *             Management is not installed.                      *
      *  063760  -  Fix 56990 gives an error code 242.                *
      *  056990  -  INCORPORATION AMNEDS NO. 056990 FORM REL.3        *
      *             INDICATE CUSTOMER WITHDRAWAL/DELIVERY OF SECURITIS*
      *  064575  -  Recompiled over amended ZYLDZ2 subroutine.        *
      *  S01496  -  INCORP. OF PRIVATE BANK. SE ENHMNTS S10978, S10981*
      *             WHERE S10978, S10981 ARE THE ORIGINAL AMENDMENT   *
      *             REFERENCE NUMBER                                  *
      *             S10978 : EARLY REDEMPTIONS                        *
      *             S10981 : PLAUSIBILITY CHECKS ON TRANSACTIONS      *
      *             CHECK PRICE ENTERED WITHIN TOLERANCE SPECIFIED &  *
      *             DOES NOT RESULT IN SHORT POSITION                 *
      *  S01486  -  PORTFOLIO MANAGEMENT UPGRADE TO R10.              *
      *  S01515 - Trade/Customer Trades by Security Enquiries         *
      *  S01511 - Market Migration                                    *
      *  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
      *  S01496 - Jyske Enhancements - Change format parameter        *
      *           from DSFDY to DSSDY for AOSTRDR0                    *
      *  065301 - Recompiled over changed copy source ZACCR subr.     *
      *           with ZAMT increased to 15,0.                        *
      *  061701 - Check that value shown on page up/down is           *
      *           not for a Matured Depot Movement.                   *
      *  066487 - Check that value put in 'Review From' field is      *
      *           not for a Matured Depot Movement.                   *
      *  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
      *           to 10,9                                             *
      *  062720 - Error code already used, new one allocated.         *
      *  S01445 - DEPOT MOVEMENT CHARGES ENHANCEMENT.                 *
      *         - Depot Movement Charges fields added.                *
      *  055962 - 'Date In' and 'Date Out' validation does not account*
      *           for maturity date being equal to zero.              *
      *  S01401 - Produce SWIFT Messages MT5xxs, if option available. *
      *  039495 - New /COPY subroutine ZCALCD added (called from      *
      *           sr. ZYLD)                                           *
      *         - Recompiled over changed ZYLDZ2                      *
      *  047922 - Recompiled over changed SR/ZYLDZ2                   *
      *  047428 - Should not check originating branch authority if    *
      *           originating branch/user validation is not switched  *
      *           on                                                  *
      *  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
      *           - Recompiled due to changes to files and SR/ZYLD.   *
      *  E37203 - Beneficial customer not defaulting to the branch    *
      *           internal customer no. for single branch             *
      *  E32482 - Reversal of BB, BL, RP or RR wrongly updates UDEPPD *
      *  E32674 - Recompiled due to error in DPTMVD                   *
      *  E27934 - Recompiled over the changed version of ZACCRZ1      *
      *  E27092 - Recompiled over changed SR/ZLCD                     *
      *  E28048 - Review screen is incorrect                          *
      *  E25477 - For depot transfer, the 'Nominal settled I/C'       *
      *           field is not being updated.                         *
      *  S01195 - HOLIDAY PROCESSING                                  *
      *  S01220 - STRATEGIC RISK MANAGEMENT                           *
      *           Recompiled over changed PF/SECTYD, PF/SEDEVD        *
      *  S01117 - Multi-branching                                     *
      *  S01269 - Trade authorisation: Recompiled for change to file  *
      *           TABSE                                               *
      *  S01271 - Pay/Receive in input cycle - set DPR1 and DPR2      *
      *           fields to 'N' when depot movement is changed.       *
      *  E23561 - Depot being updated wrongly. Processing incorrect   *
      *           for BL and BB.                                      *
      *  E23534 - W09 introduced to suppliment W07.                   *
      *  E21668 - Recompiled over changed SR/ZYLDZ2                   *
      *  E21616 - Recompiled over changed SR/ZLCD.                    *
      *  E21480 - Price entered should be in P/D/Y format.            *
      *  E21474 - Allow Internal Customer as Depot for Walkouts.      *
      *  E21216 - A P Numerator is 100 times too small.               *
      *  E21271 - Allow Internal Customer as Depot for Walk Ins/Outs. *
      *  E21066 - Updating of UDEPPD for DT, RP, RR is not correct.   *
      *  E20651 - DB Error Numbers used in more than one place.       *
      *           New Error Numbers as follows:                       *
      *           DB ERROR 04 -> 10.                                  *
      *           DB ERROR 04 -> 11.                                  *
      *           DB ERROR 07 -> 12.                                  *
      *           DB ERROR 07 -> 13.                                  *
      *  E20646 - Error Fix E18718 removed.                           *
      *  S01232 - Australian Yields modifications.                    *
      *  E20380 - New version of ZYLD for Div Basis 5.                *
      *  E20116 - Use of Rollup Key on insert allows bypassing of     *
      *           validation.                                         *
      *  E20032 - File CPOSND is incorrectly updated. This causes a   *
      *           Database Error in SE2410.                           *
      *  S01199 - Help System.                                        *
      *  E18617 - Deletion should not occur if 'ENTER' is pressed     *
      *           upon receiving Deletion Message.                    *
      *         - For a Walk-In, Price should not default to zero if  *
      *           no Market Security Price exists.                    *
      *  E18718 - A Market Customer is not allowed for In-Depot or    *
      *           Out-Depot fields.                                   *
      *  E16772 - Recompiled for the Dividend Payment Amount field    *
      *           changes.                                            *
      *  E16929 - 12 FIXES RELATED TO REPO/PLEDGE CHANGES             *
      *  E16338 - No AMEND/DELETE of matured records allowed.         *
      *  E16336 - Do not show matured records on review screen.       *
      *  E16334 - Entry of book code is mandatory for Depot transfers *
      *  S01179 - AS400 CONVERSION                                    *
      *     The keyword RTGAID is no longer supported on the AS400    *
      *     and command keys and indicators have been used to replace *
      *     this in the display file. To disrupt the structure of the *
      *     program as little as possible a new subroutine - ASCHGS - *
      *     has been coded. This moves the values which would have    *
      *     been passed to the program (via RTGAID) into the AID      *
      *     field depending on which function key has been pressed.   *
      *  E15253 - Generate CPOSND record if movement date LE DDTE.    *
      *  S01176 - SECURITIES TRADING 3.1 (AUSTRALIA)                  *
      *  E15252 - Validate Date In & Date Out to be within            *
      *           backvalue period on SE ICD.                         *
      *  E15326 - AVERAGE PRICE NUMERATOR (CDEPPD) WRONG - ADD CODE   *
      *           TO DIVIDE WORK FIELD BY 100 IF PRICE BASIS (P)      *
      *  E13788 - UPDATE Nominal settled i/p cycle date at same time  *
      *           as sum nom sales value date for walk in's.          *
      *  E14277 - ERROR IN USE OF HELP KEY AND THE DISPLAY OF         *
      *           INSTRUCTIONS AT THE BOTTOM OF THE SCREEN.           *
      *  E13933 - ERROR CODE ' 227' DOES NOT DISPLAY ANY FIELDS IN    *
      *           REVERSE IMAGE.                                      *
      *  E13648 - DEFAULT PRICE TO SECURITY MKT PRC FOR WALK IN/OUTs. *
      *  E13934 - UPDATE USER DEPOT REPO BALANCES CORRECTLY.          *
      *  E13797 - IF BOOK CODE LEFT BLANK DO NOT DEFAULT FOR          *
      *           DEPOT POSITION TRANSFERS.                           *
      *  E13821 - POST INCORP FIXES; ALLOW ZERO MATURITY DATE FOR     *
      *           CHECKING IN AND OUT DATES.                          *
      *  E13654 - ALLOW FOR ZERO MATURITY DATE FOR 'BL' IN DATE.      *
      *  E13658 - IN DATE HIGHLIGHTED FOR WALK OUT WITH NO OUT DATE.  *
      *  E13476 - VALIDATION OF BENEFICIARY CUSTOMER AGAINST DEAL CUST*
      *           FOR REPOS CHANGED TO A WARNING INSTEAD OF AN ERROR. *
      *  S01158 - SE POST INCORPORATION DEVELOPMENT ERROR FIX         *
      *                                                               *
      *****************************************************************
      *                                                               1
     F/COPY WNCPYSRC,SE0070F002
     FSE0070DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        RRN   KSFILE SUBFLREC
     F/COPY WNCPYSRC,SE0070F001
     FDPTMV   UF  E           K        DISK         KCOMIT       A
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FDPTMVX  IF  E           K        DISK
     F            DPTMVDF                           KRENAMEDPTMVDFX
     FDPTMVA  UF  E                    DISK         KCOMIT
     FDPTMVDL1IF  E           K        DISK                           UC  S01401
     F            DPTMVDF                           KRENAMEDPTMVDFY       S01401
     FDPTMVDY1UF  E           K        DISK         KCOMIT       A    UC  S01401
     FSEDPMVL1IF  E           K        DISK                               CAP003
     F            DPTMVDF                           KRENAMEDPTMVDFZ       CAP003
     F*TABLETJ*I **E**         K        DISK                       S01176 S01117
     F*TABSE***IF**E**         K        DISK                              S01117
     F************TABLETAF                          KIGNORE               S01117
     F**ICD*1*****TABTB10F                          KIGNORE               S01117
     F**ICD*2*****TABTB11F                          KIGNORE               S01117
     F**ICD*SE****TABTB36F                          KIGNORE               S01117
     F************TABTB40F                          KIGNORE               S01117
     F************TABTE10F                          KIGNORE               S01117
     F************TABTE20F                          KIGNORE               S01117
     F**CCY*1*****TABTG10F                          KIGNORE               S01117
     F************TABTG20F                          KIGNORE               S01117
     F************TABLETHF                          KIGNORE               S01117
     F************TABLETKF                          KIGNORE               S01117
     F**HOL*1*****TABLETJF                          KIGNORE               S01117
     F************TABLETJF                          KIGNORE        S01176 S01117
     F************TABLETLF                          KIGNORE               S01117
     F************TABLETNF                          KIGNORE               S01117
     F************TABLETPF                          KIGNORE               S01117
     F**BRC*1*****TABLETRF                          KIGNORE               S01117
     F************TABLETXF                          KIGNORE               S01117
     F************TABLET2F                          KIGNORE               S01117
     F************TABLET3F                          KIGNORE               S01117
     F************TABLET5F                          KIGNORE               S01117
     F*BOOKD***IF  E           K        DISK                              S01117
     FSEDEV   IF  E           K        DISK
     FSECEO   IF  E           K        DISK                               S01232
     F            SEDEVDF                           KRENAMESEDEVDO        S01232
     F            SNDEVDF                           KRENAMESNDEVDO        S01232
     FDEALS   IF  E           K        DISK                           U2
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     F            DEALSDGF                          KIGNORE               S01117
     F*CLINT***IF**E**         K        DISK                              S01117
     F************CLINTCAF                          KIGNORE               S01117
     F************CLINTCCF                          KIGNORE               S01117
     F************CLINTC1F                          KIGNORE               S01117
     F*SNAME***IF**E**         K        DISK                              S01117
     F************CLINTCBF                          KRENAMESNAMEF         S01117
     FSECTY   IF  E           K        DISK
     FINVTP   IF  E           K        DISK
     F*KPOS   UF  E           K        DISK         KCOMIT       A
     F*KPOSA  UF  E                    DISK         KCOMIT
     F*KPHD   UF  E           K        DISK         KCOMIT       A
     F*KPHDA  UF  E                    DISK         KCOMIT
     FCDEPP   UF  E           K        DISK         KCOMIT       A
     FCDEPPA  UF  E                    DISK         KCOMIT
     FUDEPP   UF  E           K        DISK         KCOMIT       A
     FUDEPPA  UF  E                    DISK         KCOMIT
     FCPOSN   UF  E           K        DISK         KCOMIT       A
     FCPOSNA  UF  E                    DISK         KCOMIT
     FSEPCCD  UF  E           K        DISK         KCOMIT       A        S01117
     FSEPCA   UF  E                    DISK         KCOMIT                S01117
     FPMPORTPDIF  E           K        DISK                           U4  S01486
     FPMPORTLLIF  E           K        DISK                           U4  066690
     F            PMPORTP0                          KRENAMEPMPORTYY       066690
     F******SDPLCSL1IF  E           K        DISK                     U4  S01486
     FPMAPOSLLIF  E           K        DISK                           U4  S01486
     FPMHSEXPDIF  E           K        DISK                           U4  S01486
     FPRICM   IF  E           K        DISK                           U4  E27843
     F* Customer Positions                                            *   S01496
     FCPOSC   IF  E           K        DISK                           UC  S01496
     F            CPOSNDF                           KRENAMECPOSNDF1       S01496
      *                                                                   CSE023
      ** Withholding Tax customers details retrieve                       CSE023
      *                                                                   CSE023
     FSDWTCSL1IF  E           K        DISK                           UC  CSE023
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE0070FFP1                                           S01408
     F*                                                                   S01408
      *                                                                                       CSD015
      ** Compliance Watch Hit List Logical File by function                                   CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      *                                                                                       CSD015
      ** Logical file based on extended settlements details file                              CSD015
     FDPTMVDY3IF  E           K        DISK                                                   CSD015
     F            DPTMVDD2                          KRENAMEDPMVEX2                            CSD015
      *                                                                                       CRE020
     FREADVCL1UF  E           K        DISK         KCOMIT       A    UC                      CRE020
      **  Midas RE Settled Transaction Index File by Ref No/Pgm Ref                           CRE020
      *                                                                                       CRE020
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - S/SUBFLCTL  SFLDSP                                    *
     F*   02  - S/SUBFLCTL  SFLDSPCTL                                 *
     F*   03  - S/SUBFLCTL  SFLEND                                    *
     F*   04  - S/SUBFLCTL  ROLLDOWN not allowed                      *
     F*   05  - S/KEYINPUT  Protect/Non-Display on location           *
     F*   06  - S/RECDETLS  Protect fields                            *
     F*   07  - S/RECDETLS  Protect Dealing Module only fields        *   S01176
     F*   08  - S/RECDETLS  Non-display when Dealing Mod. not present *   S01176
     F*   09  - Protect and non-display charge fields                 *   S01445
     F*                                                               *
     F*   10  - Start  Screen                                         *
     F*   11  - Review Screen                                         *
     F*   12  - Update Screen                                         *
     F*                                                               *
     F*   13  - S/RECDETLS  Non-display when Portfolio mod not present*   S01486
     F*   14  - S/RECDETLS  PROTECT PORTF. MOD. ONLY FIELDS           *   S01486
     F*   15  - Used on Write/Update to condition call of INFSR       *
     F*   16  - Protect Depot In, In Date, Nominal, Branch, Book      *   095743
     F*   17  - Protect Depot In, Out Date, Nominal, Branch, Book     *   095743
     F*   18  - Record not found in SDCWHTPD                          *                       CSD015
     F*   19  - Change Indicator on Detail Screen                     *   S01158
     F*   20  - VLDCMDKY Indicator for Display File                   *   S01179
     F*                                                               *
     F*   21  - S/KEYINPUT  ERROR-ACTN                                *
     F*   22  - S/KEYINPUT  ERROR-DPSS                                *
     F*   23  - S/KEYINPUT  ERROR-DPRN                                *
     F*                                                               *
     F*   25  - NOMINAL CURRENCY DECIMAL PLACES IS 0                  *
     F*   26  - NOMINAL CURRENCY DECIMAL PLACES IS 1                  *
     F*   27  - NOMINAL CURRENCY DECIMAL PLACES IS 2                  *
     F*   28  - NOMINAL CURRENCY DECIMAL PLACES IS 3                  *
     F*                                                               *
     F*   29  - PROCESSING TYPE EQ TO 1,3,5,8 OR 9                    *   CPB001
     F*                                                               *   CPB001
     F*   30  - S/RECDETLS  POSITION CURSOR                           *
     F*   33  - GENERAL WORK INDICATOR                                *
     F*   34  - SETON IF DELETED RECORD FOUND ON POSITION FILES       *
     F*   35  - PREVIOUS RECORD NOT FOUND FOR BOOK POSITION           *
     F*                                                               *
     F*   41  - S/RECDETLS  ERROR-DPID                                *
     F*   42  - S/RECDETLS  ERROR-DPMD                                *
     F*   43  - S/RECDETLS  ERROR-DPOD                                *
     F*   44  - S/RECDETLS  ERROR-DPDO                                *
     F****45**-*S/RECDETLS**ERROR-DPBC*********************************   S01117
     F*   45  - S/RECDETLS  ERROR-DPBA                                *   S01117
     F*   46  - S/RECDETLS  ERROR-DPBK                                *
     F*   47  - S/RECDETLS  ERROR-DPBN                                *
     F*   48  - S/RECDETLS  ERROR-DPNA                                *
     F*   49  - S/RECDETLS  ERROR-MKTP                                *
     F*   50  - S/RECDETLS  ERROR-DPAD                                *
     F*   51  - S/RECDETLS  ERROR-RPIN                                *   S01176
     F*   52  - S/RECDETLS  ERROR-SWRF                                *   S01176
     F*   53  - S/RECDETLS  ERROR-SIOI                                *   S01176
     F*   54  - S/RECDETLS  ERROR-ORBR                                *   S01117
     F*   55  - S/RECDETLS  ERROR-DPPC                                *   S01117
     F*   56  - S/RECDETLS  ERROR-PTFR                                *   S01486
     F*   57  - S/RECDETLS  ERROR-SCYLD                               *   S01486
     F*   58  - S/RECDETLS  ERROR-SCWDI                               *   S01486
     F*                                                               *
     F*   60  - ADD RECORD                                            *   S01117
     F*                                                               *
     F*   65  - ROLLUP                                                *   S01179
     F*   66  - ROLLDOWN                                              *   S01179
     F*   67  - HELP                                                  *   S01179
     F*                                                               *
     F*   68  - BACK-UP ACCESS ON DPTMVX                              *   061701
      *   69  - READVCL1 Search (CHAIN) Indicator                     *                       CRE020
     F*                                                               *
     F*   70  - CHARGE CODE ERROR                                     *   S01445
     F*   71  - CHARGE CURRENCY ERROR                                 *   S01445
     F*   72  - CHARGE AMOUNT ERROR                                   *   S01445
     F*   73  - CHARGE SETTLEMENT METHOD ERROR                        *   S01445
     F*   74  - CHARGE SETTLEMENT ACCOUNT ERROR                       *   S01445
     F*   75  - CHARGE SETTLEMENT BRANCH ERROR                        *   S01445
     F*                                                               *   S01445
     F*   87  - PROFIT CENTRES USED = 'Y'                             *   S01117
     F*   88  - MBIN = 'Y'                                            *   S01117
     F*   89  - ORIGINATING BRANCH USED = 'Y'                         *   S01117
     F*                                                               *   S01179
     F*   82  - CHAIN TO FILE PMPORTLL FOR PORTFOLIO REFERENCE        *   066690
     F* 90-99 - USED IN STANDARD SUB-ROUTINES                         *
     F*                                                               *
     F*   U2  - Dealing Module present                                *
     F*   U4  - PORTFOLIO MANAGEMENT MODULE PRESENT                   *   S01486
     F*   U7  - Database Error                                        *
     F*   U8  - Program Error                                         *
      *   LR  - Last Record indicator                                 *   CSE010
     F*                                                               *
     F*   'AID' Values used                                           *
     F*                                                               *
     F*   01  - CA3                                                   *
     F*   04  - CA10                                                  *
     F*   05  - CA12                                                  *
     F*   RA  - ENTER Pressed                                         *
     F*   UP  - ROLLUP                                                *
     F*   DN  - ROLLDOWN                                              *
     F*   HP  - HELP Pressed                                          *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - INITIALISATION OF STANDARD FIELDS,                  *
     F*           ACCESS OF STANDING DATA                             *
     F*  START  - OUTPUT AND PROCESS KEY FIELDS SCREEN                *
     F*  REVIEW - PROCESS SUBFILE SELECTION SCREEN                    *
     F*  UPDATE - PROCESS DETAIL SCREEN AND UPDATE FILE               *
      *  MT500  - Produce SWIFT Messages, MT5xxs                      *   S01401
     F*  VALIDK - VALIDATE KEY FIELDS                                 *
     F*  VALIDD - VALIDATE DETAIL SCREEN                              *
     F*  VALCHG - VALIDATE CHARGE FIELDS                              *   S01445
     F*  VALCAT - VALIDATE SETTLEMENT ACCOUNT                         *   S01445
     F*  INITRC - INITIALISE ALL FILE FIELDS TO ZERO/BLANK            *
     F*  TRSFS  - FORMAT RECORD FIELDS FOR SCREEN                     *
     F*  UPDFLS - UPDATE FILE RECORDS                                 *
     F*  UPDOWS - PROCESS UPDATE BY ANOTHER WORKSTATION               *
     F*  UPDPOS - UPDATE BOOK POSITIONS                               *
     F*  BOKPOS - UPDATE BOOK POSITIONS (INSERT MODE)                 *
     F*  BOKREV - UPDATE BOOK POSITIONS (DELETE MODE)                 *
     F*  DEPPOS - UPDATE DEPOT POSITIONS (INSERT MODE)                *
     F*  DEPREV - UPDATE DEPOT POSITIONS (DELETE MODE)                *
     F*  INFSR  - FILE ERROR HANDLING S/R                             *
     F*  CHKSEL - CHECK FOR SELECTION ON DETAIL SCREEN                *   S01117
     F*  SRWTCH - Calls Watch List Checking Engine                    *                       CSD015
     F*  SRFMT  - Converts Settlements Details                        *                       CSD015
     F*                                                               *
     F***XDATE3*-*CALCULATE*WORKING*DAYS*BACKWARD*******************S01232S01195
     F*  ZBKDT  - CALCULATE NUMBER OF WORKING DAYS BACKWARD           *   S01195
     F*  ZACCH  - ACCESS HOLIDAY STANDARD SUBROUTINE                  *   S01195
     F*  ZACCR  - CALCULATE ACCRUED INTEREST                          *   S01232
     F*  ZACCZ  - CALCULATE ACCRUED INTEREST                          *   S01232
     F*  ZALIGN - VALIDATE AMOUNT FIELDS                              *
     F*  ZCALCD - CALCULATE LONG TERM CD PRICE FROM YIELD             *   039495
     F*  ZCOLLV - CALCULATE COLLATERAL VALUE                          *
     F*  ZCONV  - CONVERT AMOUNT FROM ONE CURRENCY TO ANOTHER         *
     F*  ZDATE1 - CONVERT DATE TO DAYNO. AND REPORT IF ERROR          *
     F*  ZDATE2 - CONVERT DAYNO. TO DATE FOR DISPLAY                  *
     F***ZDATE5*-*CHECK*FOR*HOLIDAY*IN*CURRENCY************************   S01195
     F*  ZCHKH  - CHECK FOR HOLIDAY IN CURRENCY                       *   S01195
     F*  ZDAYS  - CALCULATE NO. OF DAYS BETWEEN TWO DATES             *
     F*  ZDYYR  - CALCULATE NO. OF DAYS IN INTEREST YEAR              *
     F*  ZEDIT  - FORMAT AMOUNT FIELDS FOR DISPLAY                    *
     F*  ZEVCD  - DETERMINE EVENT CONTROL DATE                        *
     F***ZICD2**-*GET*ICD*RECORD*2*************************************   S01117
     F*  ZLCD   - DETERMINE PREVIOUS COUPON DATE                      *   S01232
     F*  ZNCD   - DETERMINE NEXT COUPON DATE                          *
     F*  ZPCINT - Calculate the Purchased Interest on a Trade (this   *   CPB001
     F*           includes any Interest Adjustments).                 *   CPB001
     F*  ZPRCI  - OUTPUT PRICE AS %PRICE                              *
     F*  ZRATE  - GET EFFECTIVE RATE                                  *   S01232
     F*  ZTNLU1 - ACCESS DATAAREA FOR NEXT TRANSACTION NO.            *
     F*  ZXRATE - GET CROSS-EXCHANGE RATE & MULTIPLY/DIVIDE IND.      *
     F*  ZYCE   - SET UP AUSTRALIAN SECTY CUM/EX PARAMETER            *   S01232
     F*  ZYLDI  - OUTPUT YIELD AS PERCENTAGE                          *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZALIGNZ1
     E***/COPY*ZSRSRC,ZDATE6Z1***                                         S01176
     E*/COPY*ZSRSRC,ZDATE5Z1****************************************S01176S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E*/COPY ZSRSRC,ZDATE6Z1****************************************S01232S01195
     E/COPY ZSRSRC,ZSEDITZ1                                               S01486
     E                    DET       256  1
     E                    ERR        19  4
     E********************INF     1  13 76                                S01511
     E/COPY WNCPYSRC,SE0070E001
     E                    INF     1  14 76                                S01511
     E/COPY WNCPYSRC,SE0070E002
     E***********         TABTYP  1   7  2   TABDSC 14                    S01176
     E                    TABTYP  1   9  2   TABDSC 15                    S01176
     E/COPY ZSRSRC,ZSDESCZ1                                               CSE016
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZASIGNZ1                                               CPB001
     E                    CPY@    1   1 80
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
      *                                                                                       CSD015
      ** Arrays containing the tags for the XML format parameter                              CSD015
     E                    OPNTAG  1   2 35                                                    CSD015
     E                    CLSTAG  1   2 35                                                    CSD015
     E                    EXTG1   1  13 35                                                    CSD015
     E                    EXTG2   1  13 35                                                    CSD015
     E/COPY WNCPYSRC,SE0070E003
      /EJECT
     IDEALSDCF
     I              ORED                            OREDX
     ISECTYDF
     I              ORED                            OREDX
     ISEPCCDF                                                             136798
     I              PTFR                            YYPTFR                136798
     I/COPY WNCPYSRC,SE0070I001
     ISCRCTL      DS
     I*
     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I*
     I                                        1   1 REVW
     I                                        2   2 ACTN
     I                                        3 018 INPK
     I                                        3 012 DPSS
     I                                      013 018 DPRN
     I                                      019 034 PAGK
     I                                      019 028 PDPSS
     I                                      029 034 PDPRN
     I*
     IDETREC    E DSDPTMVD
     I*
     I** DATA STRUCTURE FOR INITIALISING A RECORD
     I*
     I              DPSS                            DPSSX
     I              DPRN                            DPRNX
     I*
     I*ETS******E*DSSE0070DF                                              S01158
     I            DS                                                                          227267
     I                                        1   6 WORK1                                     227267
     I**********                              1   60P@CNUM                             227267 CSD027
     I                                        1   6 P@CNUM                                    CSD027
     IDETS        DS                                                      S01158
     I                                        1  10 SDPID                 S01158
     I                                       11  16 SDPMD                 S01158
     I                                       17  26 SDPOD                 S01158
     I                                       27  32 SDPDO                 S01158
     I***************************************33  35 SDPBC          S01158 S01117
     I                                       33  35 SDPBA                 S01117
     I                                       36  37 SDPBK                 S01158
     I                                       38  47 SDPBN                 S01158
     I                                       48  59 SDPNA                 S01158
     I                                       60  94 SDPNR                 S01158
     I                                       95 110 SDPMP                 S01158
     I**************************************111 116 SDPAP          S01158 E14277
     I                                      111 116 SDPAD                 E14277
     I                                      117 119 SORBR                 S01117
     I                                      120 123 SDPPC                 S01117
     I/COPY WNCPYSRC,SE0070I002
     I*
     I** DATA STRUCTURE FOR SCREEN DETAIL OUTPUT TO CMTTXT
     I*
     ISCRMSG      DS                          1 152
     I*
     I** DATA STRUCTURE FOR ERROR MESSAGES TO SCREEN
     I*
     I                                        1  76 ERR
     I                                        1  76 ERRMSG
     I                                       77 152 INFMSG
     I*
     ISCRDS       DS
     I*
     I** DISPLAY FORMAT STATUS DATA STRUCTURE
     I*
     I************                          287 288 AID                   095034
     IINFDS       DS
     I*
     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     I                                     *STATUS  STATUS
     I*
     I*LDA*******UDS****************************256                       S01117
     I**************************************134 177 DBLOT                 S01117
     I**************************************134 138 DBFILE                S01117
     I**************************************139 167 DBKEY                 S01117
     I**************************************168 175 DBPGM                 S01117
     I**************************************176 177 DBASE                 S01117
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I*
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     ICMTTXT      DS
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 306 DET
     I*
     IPSDS       SDS
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     I                                      244 246 WSID
     I                                      254 263 USID
     I**********  DS                                                      S01195
     I**********                              1  75 HCCY                  S01195
     I**********                              1  75 XCCY                  S01195
     I*                                                                   S01408
     I/COPY WNCPYSRC,SE0070IIP1                                           S01408
     I*                                                                   S01408
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZYLDZ1
     I/COPY ZSRSRC,ZSEDITZ2                                               S01486
     I*
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     I/COPY WNCPYSRC,SE0070I003
     IZMUSER      DS                             17                       S01117
     I** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
      *                                                                   S01401
     I              '0123456789'          C         DIGITS                S01445
      *** String to Validate fields as numeric                            S01445
      *                                                                   S01445
     I              'DepotMovements      'C         WPSET1                                    CRE020
      *                                                                                       CRE020
     I** DATA AREA OF MENU USER                                           S01445
      *                                                                   S01445
     IPDATA     E DSSE70DT                                                S01401
      ** Data structure to pass parameters to SE1807 for MT5xxs           S01401
     I              PDPSS                           PPDPSS                S01401
     I              PDPRN                           PPDPRN                S01401
     I              PTFR                            PPTFR                                     CSE028
     I*                                                                   S01486
     I* Portfolio Definition Via Access Program                           S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I* Portfolio Customer Details Via Access Program                     S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I*                                                                   S01117
     I** Currency Details                                                 S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I**                                                                  S01117
     I** Client Details                                                   s01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I*                                                                   S01117
     I** Client Details                                                   S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I*                                                                   S01117
     I*                                                                   S01117
     I** Branch Details                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              QQDFAC                          DFACQQ                                    CGL029
     I*                                                                   S01117
     I** Securities Trading Data                                          S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I*                                                                   S01117
     I**  EXTERNAL DS FOR GENERAL LEDGER DETAILS                          S01117
     ISDGELR    E DSSDGELRPD                                              S01117
     I              QQACCD                          ACCDQQ                                    CGL029
     I*                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
     I*                                                                   S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
     I**  EXTERNAL DS FOR BOOK DETAILS                                    S01117
     I*                                                                   S01117
     ISDPRFC    E DSSDPRFCPD                                              S01117
     I**  EXTERNAL DS FOR PROFIT CENTRES DETAILS                          S01117
     I*                                                                   S01117
     ISECGT     E DSSECGTD                                                S01445
     I**  EXTERNAL DS FOR CHARGE TYPE DETAILS                             S01445
     I              RECI                            RECI1                 S01445
     I              LCD                             LCD1                  S01445
     I              CHTP                            CHTP1                 S01445
     I              TNLU                            TNLU1                 S01445
      *** Rename fields which exist already on deal record                S01445
     I*                                                                   S01445
     ISDRETL    E DSSDRETLPD                                              S01445
     I              QQACCD                          ACD2QQ                                    CGL029
     I**  EXTERNAL DS FOR DEFAULT RETAIL ACCOUNT DETAILS                  S01445
     I*                                                                   S01445
     ISDMOD     E DSSDMMODPD                                              S01445
     I**  EXTERNAL DS FOR WHICH MODULES INSTALLED                         S01445
     I*                                                                   S01445
     IACCNT     E DSACCNTAB                                               S01445
     I**  EXTERNAL DS FOR ACCOUNT DETAILS                                 S01445
     I              RECI                            RECI2                 S01445
     I              CCY                             CCY2                  S01445
     I              ORED                            ORED2                 S01445
     I              LCD                             LCD2                  S01445
     I              CHTP                            CHTP2                 S01445
     I              TNLU                            TNLU2                 S01445
     I              PTFR                            XXPTFR                S01486
     I              PRFC                            PRFC2                 CAC002
     I              REPI                            REPI2                 CPB001
      *** Rename fields which exist already on deal record                S01445
     I*                                                                   S01445
     ISDDLST    E DSSDDLSTPD                                              CPB001
     I**  External DS for Deal Subtype details                            CPB001
     I*                                                                   S01408
     ISDPCAC    E DSSDPCACPD                                              186484
      **  Profit Centre Accounting ICD                                    186484
      *                                                                   186484
     I/COPY WNCPYSRC,SE0070IIPG                                           S01408
     I/COPY ZSRSRC,ZSDESCZ2                                               CSE016
     I*                                                                   S01408
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01117
     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01117
     I*                                                                   CPB001
     IDSLDY     E DSDSLDY                                                 CPB001
     I*  THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE           CPB001
     I**                                                                  S01117
      *                                                                   CSE003
     ISESDS     E DS                                                      CSE003
      ** SE Linked Enquiry Data Area                                      CSE003
      *                                                                                       CSD015
      ** Data Structure for Watch List Configuration Data file                                CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      *                                                                                       CSD015
      ** Additional entry parameter for Midas Compliance Watch                                CSD015
     IPMCWL       DS                           9999                                           CSD015
     IPMCWL1      DS                           9999                                           CSD015
      *                                                                                       CSD015
      ** Data Structure used as parameter for the Compliance Engine                           CSD015
     IPDSWLT    E DSSDWLTOPD                                                                  CSD015
     IPDSXML      DS                           9999                                           CSD015
      *                                                                                       CSD015
      ** Data Structure for Watch List Checking Details                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      *                                                                                       CSD015
      ** DS for accessing enhancement file                                                    CSD015
     ISCSARD    E DSSCSARDPD                                                                  CSD015
     I              LCD                             LCD3                                      CSD015
     I              ZONE                            ZONE3                                     CGP001
      *                                                                                       CSD015
      ** DS for getting the system prefix if CSC011 is not installed                          CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      *                                                                                       CSD015
      ** DS for getting the system prefix if CSC011 is installed                              CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C/COPY WNCPYSRC,SE0070C091
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO DPTMV FILE
     C*
     C           DPTMVK    KLIST
     C                     KFLD           DPSS
     C                     KFLD           DPRN
     C*
     C           DPTMK1    KLIST                                          CSW003
     C                     KFLD           DPSS                            CSW003
     C                     KFLD           DPRN                            CSW003
     C                     KFLD           DPWHEN                          CSW003
     C**  DEFINE KEY LIST FOR CHAINING TO INVTP FILE
     C*
     C           INVKA     KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   S01486
     C**  DEFINE KEY LIST FOR CHAINING TO PMPORTPD                        S01486
     C           PORKEY    KLIST                                          S01486
     C                     KFLD           DPBN                            S01486
     C                     KFLD           SPTFR                           S01486
     C*                                                                   S01486
     C*   DEFINE KEY LIST FOR CHAINING TO PMAPOSLL                        S01486
     C           POSKEY    KLIST                                          S01486
     C                     KFLD           DPBN                            S01486
     C                     KFLD           WPTFR                           S01486
     C                     KFLD           DPSS                            S01486
     C                     KFLD           WTVDA   1                       S01486
     C                     KFLD           DPDO                            S01486
     C**                                                                  S01486
     C           HSEXKY    KLIST                                          S01486
     C                     KFLD           HSEXCY  3                       S01486
     C                     KFLD           WWVD    50                      S01486
     C*
     C* Key 1 to access Client depots for add/amend mode
     C*
     C           CDEPKA    KLIST
     C***********          KFLD           DPBC                            S01117
     C                     KFLD           DPBA                            S01117
     C                     KFLD           DPBN
     C                     KFLD           DPSS
     C**********           KFLD           DEPOT   60                                          CSD027
     C                     KFLD           DEPOT   6                                           CSD027
     C                     KFLD           MARKET  1
     C*
     C* Key 2 to access Client depots for delete/amend mode
     C*
     C           CDEPKB    KLIST
     C***********          KFLD           XDPBC                           S01117
     C                     KFLD           XDPBA                           S01117
     C                     KFLD           XDPBN
     C                     KFLD           DPSS
     C**********           KFLD           DEPOT   60                                          CSD027
     C                     KFLD           DEPOT   6                                           CSD027
     C                     KFLD           MARKET
     C*
     C* Key 1 to access User depots for add/amend mode
     C*
     C           UDEPKA    KLIST
     C***********          KFLD           DPBC                            S01117
     C                     KFLD           DPBA                            S01117
     C                     KFLD           DPSS
     C                     KFLD           DEPOT
     C                     KFLD           DPBK
     C                     KFLD           MARKET
     C*
     C* Key 2 to access User depots for delete/amend mode
     C*
     C           UDEPKB    KLIST
     C***********          KFLD           XDPBC                           S01117
     C                     KFLD           XDPBA                           S01117
     C                     KFLD           DPSS
     C                     KFLD           DEPOT
     C                     KFLD           XDPBK
     C                     KFLD           MARKET
     C*
     C* Key 1 to access Customer positions for add/amend mode
     C*
     C           CPOSKA    KLIST
     C***********          KFLD           DPBC                            S01117
     C                     KFLD           DPBA                            S01117
     C                     KFLD           DPSS
     C                     KFLD           DPBN
     C*
     C* Key 2 to access Customer positions for delete/amend mode
     C*
     C           CPOSKB    KLIST
     C***********          KFLD           XDPBC                           S01117
     C                     KFLD           XDPBA                           S01117
     C                     KFLD           DPSS
     C                     KFLD           XDPBN
     C*                                                                   S01117
     C* Key to access Customer position profit centre for add mode        S01117
     C*                                                                   S01117
     C           SEPCCK    KLIST                                          S01117
     C                     KFLD           DPBN                            S01117
     C                     KFLD           DPBA                            S01117
     C                     KFLD           DPSS                            S01117
      *                                                                   CSE023
      ** Key for chaining to SDWTCSL1.                                    CSE023
      *                                                                   CSE023
     C           TAXDET    KLIST                                          CSE023
     C                     KFLD           SCUST                           CSE023
     C                     KFLD           CRTT                            CSE023
     C*
     C* Define work fields
     C*
     C           *LIKE     DEFN MKTP      HMKTP
     C           *LIKE     DEFN MKPR      MKPRP
     C           *LIKE     DEFN MKPR      MKPRL
     C           *LIKE     DEFN DPMD      HDPMD
     C           *LIKE     DEFN DPDO      HDPDO
     C           *LIKE     DEFN DPAD      HDPAD
     C           *LIKE     DEFN DPMD      LDPMD
     C           *LIKE     DEFN DPDO      LDPDO
     C           *LIKE     DEFN DPAD      LDPAD
     C           *LIKE     DEFN DPNA      LDPNA
     C           *LIKE     DEFN DPID      XDPID
     C           *LIKE     DEFN DPMD      XDPMD
     C           *LIKE     DEFN DPOD      XDPOD
     C           *LIKE     DEFN DPDO      XDPDO
     C************LIKE     DEFN DPBC      XDPBC                           S01117
     C           *LIKE     DEFN DPBA      XDPBA                           S01117
     C           *LIKE     DEFN ORBR      XORBR                           S01117
     C           *LIKE     DEFN DPBK      XDPBK
     C           *LIKE     DEFN DPBN      XDPBN
     C           *LIKE     DEFN DPNA      XDPNA
     C           *LIKE     DEFN MKTP      XMKTP
     C           *LIKE     DEFN DPPC      XDPPC                           S01117
     C           *LIKE     DEFN SPINT     SAPINT                          CPB001
     C*
      ** Dummy write to DPTMVDY1 for compilation purposes only.           S01401
     C   01N01             WRITEDPTMVDD1                                  S01401
      *                                                                   S01401
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR INIT
      *
     C/COPY WNCPYSRC,SE0070C003
      ***  Do Until CF/3 or Error.
      *
     C           AID       DOUEQ'01'
     C           *INU7     OREQ '1'
     C*
     C           *IN10     CASEQ'1'       START
     C           *IN11     CASEQ'1'       REVIEW
     C           *IN12     CASEQ'1'       UPDATE
     C*
     C                     END
     C/COPY WNCPYSRC,SE0070C004
     C                     END
     C*
     C*================================================================
     C*  P R O G R A M   E N D                                        *
      *                                                                   S01401
      ***  Close File opened under User Control if MT5xx present.         S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C                     CLOSEDPTMVDL1                                  S01401
     C                     CLOSEDPTMVDY1                                  S01401
     C                     ENDIF                                          S01401
     C/COPY WNCPYSRC,SE0070C092
     C*                                                               *
     C                     SETON                         LR
     C*                                                               *
     C*================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  INIT   - Subroutine to initialise static fields and access   *
      *           Standing Data.                                      *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR                           ***  INIT  ***
     C*
     C/COPY WNCPYSRC,SE0070C005
     C** PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0070'  DBPGM
     C                     OUT  LDA                                       S01117
      *                                                                   CSE003
     C           *NAMVAR   DEFN           SESDS                           CSE003
     C*
     C** PREPARE COMIT TEXT
     C*
     C                     MOVEL'SE'      MDID
     C                     MOVEL'SE0070'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*
     C***HELP*PROGRAM*PARAMETER****************************************   S01199
     C***********                                                         S01199
     C***********          MOVEL'SE0070'  HBPGM   8        *FOR CALL MHELPS01199
     C                     MOVEL*BLANK    WBLNK   1                       S01199
     C*
     C** FOR HIGH INTENSITY SCREEN ATTRIBUTE
     C*
     C                     BITOF'01234567'HI      1        *FOR HI INTNSTY
     C                     BITON'267'     HI
     C                     MOVELHI        INF,7
     C                     MOVELHI        INF,8
     C                     MOVELHI        INF,9
     C                     MOVELHI        INF,10
     C                     MOVELHI        INF,11
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP1                                           S01408
     C*                                                                   S01408
     C                     MOVELHI        INF,14                          S01511
     C*
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1**                         S01117
     C***********                                                         S01117
     C***********          READ TABTB10F                 99               S01117
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01117
     C************IN99     IFEQ '0'                                       S01117
     C*                                                                   S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**  CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                     S01117
     C*
     C           DATF      COMP 'M'                      98
     C*                                                                   S01117
     C**  Check Multi-Branching Indicator                                 S01117
     C*                                                                   S01117
     C           MBIN      COMP 'Y'                      88               S01117
     C*                                                                   S01117
     C***********          ELSE                                           S01117
     C***********                                                         S01117
     C***OTHERWISE*DB*ERROR**                                             S01117
     C***********                                                         S01117
     C***********          SETON                     U7U8  ***************S01117
     C***********          MOVEL'01'      DBASE            * DB ERROR 01 *S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVEL'01'      ZTABKY 12                       S01117
     C***********          MOVE '10'      ZTABKY                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C**Get*Installation*Control*Data*record*2**                          S01117
     C***********                                                         S01117
     C***********          EXSR ZICD2                                     S01117
     C***********                                                         S01117
     C**If*error*in*ZICD2,*abend*program*                                 S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                        ***************S01117
     C***********          MOVE '02'      DBASE            * DB ERROR 02 *S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          SETON                     U7U8                 S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C**Get*Installation*Control*Data*record*for*Securities*trading*****  S01117
     C***********                                                         S01117
     C***********          EXSR ZICDSE                                    S01117
     C***********                                                         S01117
     C**If*error*in*ZICDSE,*abend*program*****                            S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                        ***************S01117
     C***********          MOVE '03'      DBASE            * DB ERROR 03 *S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          SETON                     U7U8                 S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C** IN THE DATAAREA ZMUSER                                           S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,SE0070C093
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C/COPY WNCPYSRC,SE0070C094
     C*                                                                   S01117
     C** Get Bank Details by access object                                S01117
     C*                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C*                                                                   CPB001
     C* Date format indicator to setup indicator 98                       CPB001
     C*                                                                   CPB001
     C           BJDFIN    IFEQ 'M'                                       CPB001
     C                     MOVE *ON       *IN98                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *OFF      *IN98                           CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   S01117
     C* Get Securities Trading Data by access object                      S01117
     C*                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C***********SDSTRD    PARM SDSTRD    DSFDY                    S01117 S01496
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01496
     C*                                                                   S01117
     C**   ACCESS GENERAL LEDGER DETAILS FOR ORIGINATING BRANCH IND.      S01117
     C*                                                                   S01117
     C**********           CALL 'AOGELRR0'                                S01117              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                           S01117              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C**                                                                  S01117
     C** CHECK IF ORIGINATING BRANCH USED                                 S01117
     C           BKOBRU    COMP 'Y'                      89               S01117
     C**                                                                  S01117
     C** CHECK IF PROFIT CENTRES USED                                     S01117
     C           BKPRCU    COMP 'Y'                      87               S01117
      *                                                                   S01401
      ***  Access Retail details if retail module is ON                   S01445
      *                                                                   S01445
     C                     CALL 'AOMMODR0'                                S01445
     C                     PARM '*DBERR ' @RTCD                           S01445
     C                     PARM '*FIRST ' @OPTN                           S01445
     C           SDMOD     PARM SDMOD     DSFDY                           S01445
      *                                                                   S01445
     C           BGRTBN    IFEQ 'Y'                        *B1            S01445
     C                     CALL 'AORETLR0'                                S01445
     C                     PARM '*DBERR ' @RTCD                           S01445
     C                     PARM '*FIRST ' @OPTN                           S01445
     C           SDRETL    PARM SDRETL    DSFDY                           S01445
     C                     END                             *E1            S01445
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE *ON       *IN25                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *OFF      *IN25                           CPB001
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,SE0070C080
      *                                                                   S01445
      **  Access Switchable features file for MT5xx processing - S01401   S01401
      *                                                                   S01401
     C                     CALL 'AOSARDR0'                                S01401
     C                     PARM *BLANKS   @RTCD                           S01401
     C                     PARM '*VERIFY' @OPTN                           S01401
     C                     PARM 'S01401'  WSARD   6                       S01401
      *                                                                   S01401
     C           @RTCD     IFEQ *BLANK                                    S01401
     C                     MOVE 'Y'       S01401  1                       S01401
     C                     OPEN DPTMVDL1                                  S01401
     C                     OPEN DPTMVDY1                                  S01401
     C                     END                                            S01401
      *                                                                   CSE003
      **  Access SAR details file to see if ? allowed for security        CSE003
     C                     CALL 'AOSARDR0'                                CSE003
     C                     PARM *BLANKS   @RTCD                           CSE003
     C                     PARM '*VERIFY' @OPTN                           CSE003
     C                     PARM 'CSE003'  WSARD                           CSE003
      *                                                                   CSE003
     C           @RTCD     IFEQ *BLANK                                    CSE003
     C                     MOVE 'Y'       CSE003  1                       CSE003
     C                     ELSE                                           CSE003
     C                     MOVE 'N'       CSE003                          CSE003
     C                     ENDIF                                          CSE003
      *                                                                   S01445
      *** Protect Charge fields                                           S01445
     C                     MOVE '1'       *IN09            Non Dsply flds S01445
      *                                                                   S01445
      *** Check S01445 has been installed                                 S01445
      *                                                                   S01445
     C                     CALL 'AOSARDR0'                                S01445
     C                     PARM *BLANKS   @RTCD                           S01445
     C                     PARM '*VERIFY' @OPTN                           S01445
     C                     PARM 'S01445'  WSARD                           S01445
      *                                                                   S01445
     C           @RTCD     IFEQ *BLANK                                    S01445
     C                     MOVE 'Y'       S01445  1                       S01445
     C*                                                                   S01117
      *** Unprotect Charge fields if both autocharge and S01445 flags     S01445
      *** are ON                                                          S01445
      *                                                                   S01445
     C           BVACOP    IFEQ 'Y'                                       S01445
     C                     MOVE '0'       *IN09            Non Dsply flds S01445
     C                     END                                            S01445
     C                     ELSE                                           S01445
      *                                                                   S01445
     C                     MOVE 'N'       S01445                          S01445
     C                     END                                            S01445
     C*                                                                   S01511
     C** Check if S01511 has been installed                               S01511
     C*                                                                   S01511
     C                     CALL 'AOSARDR0'                                S01511
     C                     PARM *BLANKS   @RTCD                           S01511
     C                     PARM '*VERIFY' @OPTN                           S01511
     C                     PARM 'S01511'  WSARD                           S01511
     C*                                                                   S01511
     C           @RTCD     IFEQ *BLANK                                    S01511
     C                     MOVE 'Y'       S01511  1                       S01511
     C                     ELSE                                           S01511
     C                     MOVE 'N'       S01511                          S01511
     C                     END                                            S01511
      *                                                                                       207006
      ** Check if CSE029 is on                                                                207006
      *                                                                                       207006
     C                     CALL 'AOSARDR0'                                                    207006
     C                     PARM *BLANKS   @RTCD                                               207006
     C                     PARM '*VERIFY' @OPTN                                               207006
     C                     PARM 'CSE029'  @SARD                                               207006
      *                                                                                       207006
      ** Database error                                                                       207006
      *                                                                                       207006
     C           @RTCD     IFNE '*NRF   '                                                     207006
     C           @RTCD     ANDNE*BLANKS                                                       207006
     C           *LOCK     IN   LDA                                                           207006
     C                     MOVEL'SCSARDPD'DBFILE                                              207006
     C                     MOVEL'CSE029'  DBKEY                                               207006
     C                     Z-ADD29        DBASE                                               207006
     C                     OUT  LDA                                                           207006
     C                     MOVE *ON       *INU7                                               207006
     C                     MOVE *ON       *INU8                                               207006
     C                     MOVE *ON       *INLR                                               207006
     C                     EXSR *PSSR                                                         207006
     C                     ENDIF                                                              207006
      *                                                                                       207006
     C           @RTCD     IFEQ *BLANKS                                                       207006
     C                     MOVE 'Y'       CSE029  1                                           207006
     C                     ELSE                                                               207006
     C                     MOVE 'N'       CSE029                                              207006
     C                     ENDIF                                                              207006
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCPG                                           S01408
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                   CSE010
      ** Check if CSE010 (Transaction Enhancements) is active             CSE010
      *                                                                   CSE010
     C                     CALL 'AOSARDR0'                                CSE010
     C                     PARM '       ' @RTCD                           CSE010
     C                     PARM '*VERIFY' @OPTN                           CSE010
     C                     PARM 'CSE010'  @SARD   6                       CSE010
      *                                                                   CSE010
     C           @RTCD     IFEQ *BLANK                                    CSE010
     C                     MOVE 'Y'       CSE010  1                       CSE010
     C                     ELSE                                           CSE010
     C                     MOVE 'N'       CSE010                          CSE010
      *                                                                   CSE010
      ** Database Error (return code other than *NRF)                     CSE010
      *                                                                   CSE010
     C           @RTCD     IFNE '*NRF   '                                 CSE010
     C           *LOCK     IN   LDA                                       CSE010
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE010
     C                     MOVEL'CSE010'  DBKEY            * DB ERROR 16 *CSE010
     C                     Z-ADD16        DBASE            ***************CSE010
     C                     OUT  LDA                                       CSE010
     C                     MOVE *ON       *INU7                           CSE010
     C                     MOVE *ON       *INU8                           CSE010
     C                     MOVE *ON       *INLR                           CSE010
     C                     EXSR *PSSR                                     CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C*                                                                   S01408
      *                                                                   CSE007
      ***  Access Switchable features file for Corporate Actions.         CSE007
      *                                                                   CSE007
     C                     MOVE 'N'       CSE007  1                       CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM '       ' @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  @SARD   6                       CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANKS                                   CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       CSE007                          CSE007
     C                     ELSE                                           CSE007
      *                                                                   CSE007
      ***  Setup work field to call SE6710, SE6712 and SE6714.            CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6710  1                       CSE007
     C                     MOVE 'Y'       SE6712  1                       CSE007
     C                     MOVE 'Y'       SE6714  1                       CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CEU017
      ***  Access Switchable features file for Securities Redenomination  CEU017
      *                                                                   CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM '       ' @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  @SARD                           CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANKS                                   CEU017
      *                                                                   CEU017
      ***  If Securities Redenomination feature is installed.             CEU017
      *                                                                   CEU017
     C                     MOVE 'Y'       CEU017                          CEU017
     C                     ELSE                                           CEU017
      *                                                                   CEU017
      ***  Setup work field to call SE6710, SE6712 and SE6714.            CEU017
      *                                                                   CEU017
     C                     MOVE 'Y'       SE6710  1                       CEU017
     C                     MOVE 'Y'       SE6712  1                       CEU017
     C                     MOVE 'Y'       SE6714  1                       CEU017
     C                     ENDIF                                          CEU017
      *                                                                   CAP003
      *****Access*Switchable*features*file*for*API*feature          CAP003CAP010
      ***  Access Switchable features file for SE Depot Movements         CAP010
      ***  API menu items switch                                          CAP010
      *                                                                   CAP003
     C                     MOVE 'N'       CAP003  1                       CAP003
     C                     CALL 'AOSARDR0'                                CAP003
     C                     PARM '       ' @RTCD                           CAP003
     C                     PARM '*VERIFY' @OPTN                           CAP003
     C******               PARM 'CAP003'  @SARD                     CAP003CAP010
     C                     PARM 'CAP126'  @SARD                           CAP010
      *                                                                   CAP003
     C           @RTCD     IFEQ *BLANKS                                   CAP003
      *                                                                   CAP003
      ***  If API feature is installed.                                   CAP003
      *                                                                   CAP003
     C                     MOVE 'Y'       CAP003                          CAP003
     C                     ENDIF                                          CAP003
      *                                                                   S01445
      *** Check CSE006 has been installed                                 CSE006
      *                                                                   CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD                           CSE006
     C                     PARM '*VERIFY' @OPTN                           CSE006
     C                     PARM 'CSE006'  WSARD                           CSE006
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVE 'Y'       CSE006  1                       CSE006
     C*                                                                   CSE006
      *** Unprotect Charge fields if CSE006 is on                         CSE006
      *                                                                   CSE006
     C                     MOVE '0'       *IN09                           CSE006
     C                     END                                            CSE006
     C*                                                                   S01486
     C** CHECK IF MODULE PORTFOLIO IS ON OR OFF                           S01486
     C           *INU4     IFNE '1'                                       S01486
     C                     MOVE '1'       *IN13                           S01486
     C                     MOVE '1'       *IN14                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C**  Access PM I.C.D.                                                S01486
     C*                                                                   S01486
     C           *INU4     IFEQ '1'                                       S01486
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C           @RTCD     IFNE *BLANKS                    ************** S01486
     C                     Z-ADD1         DBASE            **DB ERROR 1 **S01486
     C                     MOVEL'SDPORTPD'DBFILE           ***************S01486
     C                     MOVEL@OPTN     DBKEY                           S01486
     C                     SETON                     U7U8                 S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C**                                                                  S01486
      *                                                                   S01496
      **  Access Switchable features file for S01496 processing           S01496
      *                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   @RTCD                           S01496
     C                     PARM '*VERIFY' @OPTN                           S01496
     C                     PARM 'S01496'  WSARD   6                       S01496
      *                                                                   S01496
     C           @RTCD     IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     OPEN CPOSC                                     S01496
     C                     END                                            S01496
      *                                                                   CAC005
      ***  Check if CAC005 is on                                          CAC005
      *                                                                   CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*VERIFY' POPTN   7                       CAC005
     C                     PARM 'CAC005'  PSARD   6                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE 'Y'       CAC005  1                       CAC005
     C                     ELSE                                           CAC005
     C                     MOVE 'N'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CSE018
      ***  Check if CSE018 is on                                          CSE018
      *                                                                   CSE018
     C                     CALL 'AOSARDR0'                                CSE018
     C                     PARM *BLANKS   PRTCD   7                       CSE018
     C                     PARM '*VERIFY' POPTN   7                       CSE018
     C                     PARM 'CSE018'  PSARD   6                       CSE018
      *                                                                   CSE018
     C           PRTCD     IFEQ *BLANKS                                   CSE018
     C                     MOVE 'Y'       CSE018  1                       CSE018
     C                     ELSE                                           CSE018
     C                     MOVE 'N'       CSE018                          CSE018
     C                     ENDIF                                          CSE018
      *                                                                   CSE023
      ** Check if CSE023 is on.                                           CSE023
      *                                                                   CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM *BLANKS   @RTCD                           CSE023
     C                     PARM '*VERIFY' @OPTN                           CSE023
     C                     PARM 'CSE023'  @SARD                           CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANKS                                   CSE023
     C                     OPEN SDWTCSL1                                  CSE023
     C                     MOVE 'Y'       CSE023  1                       CSE023
     C                     ELSE                                           CSE023
      *                                                                   CSE023
      ** Database error.                                                  CSE023
      *                                                                   CSE023
     C           @RTCD     IFNE '*NRF   '                                 CSE023
     C           *LOCK     IN   LDA                                       CSE023
     C                     MOVEL'SCSARDPD'DBFILE                          CSE023
     C                     MOVEL'CSE023'  DBKEY                           CSE023
     C                     Z-ADD27        DBASE                           CSE023
     C                     OUT  LDA                                       CSE023
     C                     MOVE *ON       *INU7                           CSE023
     C                     MOVE *ON       *INU8                           CSE023
     C                     MOVE *ON       *INLR                           CSE023
     C                     EXSR *PSSR                                     CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCPG                                           S01408
     C*                                                                   S01408
      *                                                                   S01496
     C** PROCEED TO START SCREEN UNLESS DATABASE ERROR                    S01117
     C*                                                                   S01117
     C           *INU7     IFNE '1'                                       S01117
     C                     MOVEA'1'       *IN,10                          S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE0070C006
      *                                                                                       CSD015
      ** Access SAR Details to see if Compliance Watch is installed                           CSD015
      *                                                                                       CSD015
     C                     MOVEL'N'       CSD015  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM '*VERIFY 'POPTN   7                                           CSD015
     C                     PARM 'CSD015'  PSARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD29        DBASE                                               CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If enhancement CSD015 is installed, access SDWLCCPD to                               CSD015
      ** see if 'SDCUSD' function code is available.                                          CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY    'POPTN                                               CSD015
     C                     PARM 'SECTTRAD'PFNCCD  8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF'                                                        CSD015
     C                     MOVEL'SECTTRAD'DBKEY                                               CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     Z-ADD30        DBASE                                               CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SDCWCDPD to get the 5 'Private Customer Industry Code'                        CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*FIRST ' POPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     MOVEL'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD31        DBASE                                               CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Determine if enhancement CSC011 is installed                                         CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSC011  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CSC011'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'CSC011'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD32        DBASE                                               CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011  1                                           CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      ** Access SAR Details to see if Concord Interface Development is installed              CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CCF001  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CCF001'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'CCF001'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD33        DBASE                                               CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Define key list to access SDCWHTPD                                                   CSD015
      *                                                                                       CSD015
     C           KCWHTL    KLIST                                                              CSD015
     C                     KFLD           KFUNT   8                                           CSD015
     C                     KFLD           KIDEN  40                                           CSD015
     C                     KFLD           KBRCH   3                                           CSD015
      *                                                                                       CRE020
      ** Check if CRE020 is enabled.                                                          CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM '*VERIFY' POPTN                                               CRE020
     C                     PARM 'CRE020'  PSARD   6                                           CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     MOVEL'SE0070'  KPRGMN                                              CRE020
     C                     ELSE                                                               CRE020
     C           PRTCD     IFNE '*NRF   '                                                     CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SCSARDPD'DBFILE                                              CRE020
     C                     MOVEL'CRE020'  DBKEY                                               CRE020
     C                     Z-ADD46        DBASE                                               CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Check if a System Value exists for this maintenance.                                 CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSVALR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM WPSET1    PSV01  20                                           CRE020
     C                     PARM           PCS01 200                                           CRE020
     C                     PARM           PSV02  20                                           CRE020
     C                     PARM           PCS02 200                                           CRE020
     C                     PARM           PSV03  20                                           CRE020
     C                     PARM           PCS03 200                                           CRE020
     C                     PARM           PSV04  20                                           CRE020
     C                     PARM           PCS04 200                                           CRE020
     C                     PARM           PSV05  20                                           CRE020
     C                     PARM           PCS05 200                                           CRE020
     C                     PARM           PSV06  20                                           CRE020
     C                     PARM           PCS06 200                                           CRE020
     C                     PARM           PSV07  20                                           CRE020
     C                     PARM           PCS07 200                                           CRE020
     C                     PARM           PSV08  20                                           CRE020
     C                     PARM           PCS08 200                                           CRE020
     C                     PARM           PSV09  20                                           CRE020
     C                     PARM           PCS09 200                                           CRE020
     C                     PARM           PSV10  20                                           CRE020
     C                     PARM           PCS10 200                                           CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       WSV01   1                                           CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVELPCS01     WSV01                                               CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE '*NRF'                                                        CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SDSVALPD'DBFILE                                              CRE020
     C                     MOVE PSV01     DBKEY                                               CRE020
     C                     Z-ADD102       DBASE                                               CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Midas RE Settled Transaction Index File Key List                                     CRE020
      *                                                                                       CRE020
     C           KADVC     KLIST                                                              CRE020
     C                     KFLD           KREFNO 30                                           CRE020
     C                     KFLD           KPRGMN 10                                           CRE020
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  START  - Subroutine to Output and process Key Fields Screen. *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls:     VALIDK - Validate Key fields, if entered.         *
      *                                                               *
      *****************************************************************
      *
     C           START     BEGSR                           *** START  ***
     C*
     C** INITIALISE SCREEN DATA
     C*
     C                     MOVEA'0'       *IN,10
     C                     MOVEA'0000'    *IN,21
     C/COPY WNCPYSRC,SE0070C095
     C                     MOVEL*BLANK    SCRCTL
     C/COPY WNCPYSRC,SE0070C007
     C                     MOVELINF,1     INFMSG
     C/COPY WNCPYSRC,SE0070C008
     C*
     C** CLEAR WHOLE SCREEN
     C*
     C                     WRITECLSCREEN
      *
     C/COPY WNCPYSRC,SE0070C009
      ***  DO UNTIL Change of Screen
      *
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Start Screen Output
      *
     C/COPY WNCPYSRC,SE0070C010
     C                     MOVELINF,1     INFMSG                          E14277
     C/COPY WNCPYSRC,SE0070C011
     C*                                                                   E14277
     C                     MOVEL*BLANKS   MATU                            087180
     C**********           WRITEKEYINPUT                                                     BUG2576
     C                     WRITEMESSAGES
     C                     WRITEKEYINPUT                                                     BUG2576
     C                     READ KEYINPUT                 99
     C/COPY WNCPYSRC,SE0070C096
     C                     MOVELERRMSG    HERCD 160
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C/COPY WNCPYSRC,SE0070C012
     C*
     C** Check for CF/3 or ENTER pressed
     C*                                                                   E14277
     C** CK3 - TERMINATE                                                  E14277
     C*                                                                   E14277
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C           AID       IFEQ '01'                                      E14277
     C                     MOVEA'1'       *IN,10                          E14277
     C*
     C***HELP*-*CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                   E14277  S01199
     C***********AID       DOWEQ'HP'                                      E14277
     C***********AID       IFEQ 'HP'                              E14277  S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                             *ERR,1         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C***********                                                         S01199
     C***********          READ KEYINPUT                 33               E14277
     C***********                                                         E14277
     C***********          END                                            E14277
     C***********                                                         E14277
     C***CK1*-*TERMINATE***********************************************   E14277
     C***********                                                         E14277
     C***********AID       IFEQ '01'                                      E14277
      ***********          MOVEA'1'       *IN,10                          E14277
     C*
     C** ENTER TAKEN VALIDATE KEY INPUT
     C*
     C                     ELSE
     C           *INKE     IFEQ '0'                                       E14277
     C/COPY WNCPYSRC,SE0070C196
     C                     EXSR VALIDK
     C*
     C** IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           SCRMSG    IFEQ *BLANK
     C*
     C**  - IF KEY FIELD IS BLANK, NEXT SCREEN IS REVIEW SCREEN
     C*
     C           DPSS      IFEQ *BLANK
     C                     MOVEA'1'       *IN,11
     C*
     C**  - OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C***********          ELSE                                           E14277
     C***********          MOVELINF,1     INFMSG                          E14277
     C/COPY WNCPYSRC,SE0070C097
     C                     END
     C*                                                                   E14277
     C                     ELSE                                           E14277
     C*                                                                   E14277
     C                     MOVEL*BLANK    SCRCTL                          E14277
     C                     MOVEA'0000'    *IN,21                          E14277
     C*                                                                   E14277
     C                     END                                            E14277
     C*
     C***********          END                                     E14277 S01199
      ***  End of If/Else AID=01.
     C                     END
     C*
      ***  End of Do Until Change of Screen.
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  REVIEW - Subroutine to process Subfile Selection Screen.     *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls:     VALIDK - Validate Key fields, if Subfile Record   *
      *                      selected.                                *
      *                                                               *
      *****************************************************************
      *
     C           REVIEW    BEGSR                           *** REVIEW ***
     C*
     C                     MOVEA'0'       *IN,11
     C*
     C** SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C***********          MOVEL'RA'      AID                             095034
     C                     MOVEL'RA'      AID     2                       095034
      *
      ***  DO UNTIL Change of Screen
      *
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C/COPY WNCPYSRC,SE0070C149
      *
      ***  If ROLLUP, ROLLDOWN or ENTER pressed, rebuild the Subfile.
      ***  But not if error found
      *
     C           SCRMSG    IFEQ *BLANKS
     C*
     C           AID       IFEQ 'DN'
     C           AID       OREQ 'UP'
     C           AID       OREQ 'RA'
     C*
     C                     MOVEA'000'     *IN,21
     C*
     C** WRITE CONTROL RECORD
     C*
     C                     MOVEA'000'     *IN,1
     C                     Z-ADD*ZERO     RRN
     C                     WRITESUBFLCTL
     C                     MOVEA'1'       *IN,4
     C*
     C** SET FILE POINTER - PAGE BACK
     C*
      ***  ROLLDOWN
     C           AID       IFEQ 'DN'
     C***********          MOVEL*BLANK    DPSS                            095034
     C***********          MOVEL*BLANK    DPRN                            095034
      *****Save**                                                         095034
     C***********          MOVEL*BLANK    PPAGK 016                       095034
     C                     MOVELPDPSS     DPSS                            095034
     C                     MOVELPDPRN     DPRN                            095034
      ***  Save                                                           095034
     C                     MOVELPAGK      PPAGK 016                       095034
     C           CAP003    IFEQ 'Y'                                       CAP003
     C           DPTMVK    SETLLSEDPMVL1                                  CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C197
     C           DPTMVK    SETLLDPTMVX
     C/COPY WNCPYSRC,SE0070C198
     C                     ENDIF                                          CAP003
     C* READ THE 35 PREVIOUS RECORDS FOR ROLL DOWN (17 + 18)              095034
     C                     Z-ADD0         I       20                      095034
     C/COPY WNCPYSRC,SE0070C137
     C********** I         DOWLT35                                 095034 CSE016
     C           I         DOWLT17                                        CSE016
     C/COPY WNCPYSRC,SE0070C138
     C           *IN03     ANDEQ'0'                                       095034
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     READPSEDPMVL1                 03               CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C199
     C                     READPDPTMVX                   03               095034
     C           RECI      DOWEQ'S'                                       125630
     C           *IN03     ANDEQ'0'                                       125630
     C           CSE018    ANDNE'Y'                                       CSE018
     C                     READPDPTMVX                   03               125630
     C                     END                                            125630
     C/COPY WNCPYSRC,SE0070C200
     C                     ENDIF                                          CAP003
     C                     ADD  1         I                               095034
     C                     END                                            095034
     C           *IN03     IFEQ '1'                                       095034
     C           CAP003    IFEQ 'Y'                                       CAP003
     C           *LOVAL    SETLLSEDPMVL1                                  CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C201
     C           *LOVAL    SETLLDPTMVX                                    095034
     C/COPY WNCPYSRC,SE0070C202
     C                     ENDIF                                          CAP003
     C                     MOVE '0'       *IN03                           095034
     C                     END                                            095034
     C*
     C** Otherwise NOT ROLLDOWN
     C*
     C                     ELSE
     C                     MOVELPDPSS     DPSS
     C                     MOVELPDPRN     DPRN
      ***  Save
     C                     MOVELPAGK      PPAGK
      ***  ROLLUP
     C           CAP003    IFEQ 'Y'                                       CAP003
     C           DPTMVK    SETLLSEDPMVL1                                  CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C203
     C           DPTMVK    SETLLDPTMVX
     C/COPY WNCPYSRC,SE0070C204
     C                     ENDIF                                          CAP003
     C                     END
     C*
     C** READ IN DETAILS-FILL UP SUBFILE
     C*
     C/COPY WNCPYSRC,SE0070C139
     C********** RRN       DOUEQ18                                        CSE016
     C           RRN       DOUEQ09                                        CSE016
     C/COPY WNCPYSRC,SE0070C140
     C           *IN,03    OREQ '1'
     C*
     C** READ DETAILS UNTIL SUBFILE PAGE IS FULL
     C*
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     READ SEDPMVL1                 03               CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C205
     C                     READ DPTMVX                   03
     C/COPY WNCPYSRC,SE0070C206
     C                     ENDIF                                          CAP003
     C           *IN,03    IFEQ '0'
     C*                                                                   S01117
     C** CHECK USER IS AUTHORISED TO BOOKING BRANCH IF MULTIBRANCHING     S01117
     C*                                                                   S01117
     C           *IN88     IFEQ '1'                                       S01117
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM DPBA      ZBRCHX  3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     GOTO BYPASS                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C***CHECK*USER*IS*AUTHORISED*TO*ORIGINATING*BRANCH*IF*MULTIBRAS01117 E28048
     C*                                                            S01117 E28048
     C***********          CALL 'ZVOBU'                            S01117 E28048
     C***********          PARM ORBR      ZOBRX   3                S01117 E28048
     C***********          PARM           @ERR    10               S01117 E28048
     C***********@ERR      IFNE *ZERO                              S01117 E28048
     C***********          GOTO BYPASS                             S01117 E28048
     C***********          END                                     S01117 E28048
     C                     END                                            S01117
     C*
     C** IF RECORD IS DELETED, FLAG IT AS SO ON SCREEN
     C*
     C           RECI      IFEQ 'S'                                       E16336
     C           CSE018    ANDNE'Y'                                       CSE018
     C/COPY WNCPYSRC,SE0070C177
      ***  STATUS = MATURED                                               E16336
     C                     GOTO BYPASS                                    E16336
     C                     END                                            E16336
     C           RECI      IFEQ '*'
     C           RECI      OREQ 'R'                                       046800
      ***  STATUS = DELETED
     C                     MOVEL'D'       STAT    1
     C                     ELSE
      ***  or Live
     C                     MOVEL*BLANK    STAT
     C                     END
     C/COPY WNCPYSRC,SE0070C178
     C*
     C* Fetch movement type
     C*
     C                     MOVE *BLANKS   MVTYPE
     C           DPMV      LOKUPTABTYP    TABDSC         33
     C   33                MOVE TABDSC    MVTYPE
     C/COPY WNCPYSRC,SE0070C141
      *                                                                   CSE016
      ** Save indicator                                                   CSE016
      *                                                                   CSE016
     C                     MOVE *IN99     WWIN99  1                       CSE016
     C                     MOVE *BLANKS   DRNME                           CSE016
      *                                                                   CSE016
      ** Retrieve security description                                    CSE016
      *                                                                   CSE016
     C           DPSS      CHAINSECTY                99                   CSE016
     C           *IN99     IFEQ *OFF                                      CSE016
      *                                                                   CSE016
     C                     MOVE BVRIDF    ZRSFD                           CSE016
     C                     MOVELSRPN      ZSRPN                           CSE016
     C                     EXSR ZSDESC                                    CSE016
     C                     MOVELZRNME     DRNME                           CSE016
      *                                                                   CSE016
     C                     ENDIF                                          CSE016
      *                                                                   CSE016
      ** Restore indicator                                                CSE016
      *                                                                   CSE016
     C                     MOVE WWIN99    *IN99                           CSE016
     C*
     C                     ADD  1         RRN     40     04
     C*
     C                     WRITESUBFLREC
     C*
     C** RECORD NOW WRITTEN TO SUBFILE
     C*
     C           BYPASS    TAG                                            E16336
     C*                                                                   E16336
      ***  End of *IN03 = 0
     C                     END
     C*
     C** PAGE NOW FULL (OR EOF)
     C*
     C                     END
     C*
     C** READ ONE MORE RECORD FOR NEXT SCREEN
     C**    THE RECORD SHOULD NOT BE MATURED                              066487
     C*
     C********** *IN,03    IFEQ '0'                                       066487
     C           *IN03     DOWEQ'0'                                       066487
     C           RECI      ANDEQ'S'                                       066487
     C           CSE018    ANDNE'Y'                                       CSE018
     C/COPY WNCPYSRC,SE0070C179
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     READ SEDPMVL1                 03               CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C207
     C                     READ DPTMVX                   03
     C/COPY WNCPYSRC,SE0070C208
     C                     ENDIF                                          CAP003
     C                     END
     C*
     C** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C           *IN,03    IFEQ '0'
     C                     MOVELINPK      PAGK
     C                     ELSE
     C                     MOVEL*BLANK    PAGK
     C                     END
     C*
     C** FOR SUBFILE CONTROL
     C*
     C           *IN,4     IFEQ '1'
     C                     MOVEA'010'     *IN,1
     C                     ELSE
     C                     MOVEA'11'      *IN,1
     C                     END
     C*
      ***  End of IF AID = DN, UP, RA
     C                     END
      ***  End of IF SCRMSG = *BLANKS
     C                     END
      *
      ***  Review Screen Output
     C/COPY WNCPYSRC,SE0070C209
      *
     C                     MOVELINF,2     INFMSG
     C/COPY WNCPYSRC,SE0070C210
     C**********           WRITESUBFLCTL                                                     BUG2576
     C                     WRITEMESSAGES
     C                     WRITESUBFLCTL                                                     BUG2576
     C                     READ SUBFLCTL                 99
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C                     MOVEL*BLANK    REVW
      *
      ***  Process CF/3, CF/12 and record select
      *
     C***HELP*-*CALL*HELP*PROGRAM**************************************   E14277
     C***********                                                         E14277
     C***********AID       DOWEQ'HP'                                      E14277
     C***********          MOVELHERCD     ERRMSG                          E14277
     C***********ERR,1     IFNE *BLANK                                    E14277
     C***********          MOVELHI        ERRMSG                          E14277
     C***********          END                             *ERR,1         E14277
     C***********          CALL 'MHELP'                                   E14277
     C***********          PARM           HBPGM                           E14277
     C***********          PARM           HERCD                           E14277
     C***********                                                         E14277
     C***********          READ SUBFLCTL                 99               E14277
     C***********          END                                            E14277
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,11
     C*
     C** CK12- INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C***********          ELSE                                           S01199
     C***********                                                 E14277  S01199
     C***HELP*-*CALL*HELP*PROGRAM******************************** E14277  S01199
     C***********                                                 E14277  S01199
     C***********AID       IFEQ 'HP'                              E14277  S01199
     C***********          MOVELHERCD     ERRMSG                  E14277  S01199
     C***********ERR,1     IFNE *BLANK                            E14277  S01199
     C***********          MOVELHI        ERRMSG                  E14277  S01199
     C***********          END                             *ERR,1 E14277  S01199
     C***********          CALL 'MHELP'                           E14277  S01199
     C***********          PARM           HBPGM                   E14277  S01199
     C***********          PARM           HERCD                   E14277  S01199
     C*
     C** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C                     ELSE                                           E14277
     C                     MOVEA'1'       *IN,99
      *
      ***  Check for record change
     C           *IN,04    IFEQ '0'
     C                     READCSUBFLREC                 99
     C                     END
      *
      ***  Validate Record Select
      *
     C           *IN99     IFEQ '0'
     C                     EXSR VALIDK
     C*
     C** NO ERRORS, UPDATE SCREEN CAN BE PROCESSED NEXT
     C*
     C           SCRMSG    IFEQ *BLANK
     C                     MOVEA'1'       *IN,12
     C                     MOVEL'Y'       REVW
     C                     END
     C                     UPDATSUBFLREC
     C                     END
     C*
     C***********          END                                     E14277 S01199
      ***  End of IF/ELSE AID=05
     C                     END
      ***  End of IF/ELSE AID=01
     C                     END
     C*
      ***  End of DO UNTIL Change of Screen
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDATE - Subroutine to process Detail Screen and Update File.*
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls:     VALIDD                                            *
      *             UPDFLS                                            *
      *             INITRC                                            *
      *             TRSFS                                             *
      *                                                               *
      *****************************************************************
      *
     C           UPDATE    BEGSR                           *** UPDATE ***
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     MOVEA'1'       *IN,5
     C                     MOVEA'0'       *IN,12
     C                     MOVEA'1'       *IN,30
     C/COPY WNCPYSRC,SE0070C257
     C                     MOVEA'00000000'*IN,41
     C                     MOVEA'00'      *IN,49
     C                     MOVEA'00000'   *IN,51                          S01117
     C                     MOVEA'000000'  *IN,70                          S01445
     C                     MOVE '0'       *IN56                           S01486
     C                     MOVE '0'       *IN57                           S01486
     C                     MOVE '0'       *IN58                           056990
     C                     MOVEA'00'      *IN,16                          095743
     C                     MOVE '0'       *IN26                           CPB001
     C                     MOVE '0'       *IN27                           CPB001
     C                     MOVE '0'       *IN28                           CPB001
     C/COPY WNCPYSRC,SE0070C145
     C*
     C** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
     C** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
     C*
     C                     Z-ADD*ZERO     STNLU   50
     C/COPY WNCPYSRC,SE0070C211
     C           DPTMVK    CHAINDPTMVX               99
     C/COPY WNCPYSRC,SE0070C212
     C           *IN,99    IFEQ '0'
     C                     Z-ADDTNLU      STNLU
     C                     END
     C*
     C** IF INSERT (NEW OR OVER DELETED RECORD)
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C           ACTN      IFEQ 'I'
      *                                                                   CSE010
      ** Process only if switchable  feature, CSE010, is off              CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'N'                                       CSE010
      *                                                                   CSE003
      * If ? processing available and ? entered                           CSE003
     C           CSE003    IFEQ 'Y'                                       CSE003
     C           DPSS      ANDEQ'?'                                       CSE003
     C           *LOCK     IN   SESDS                                     CSE003
     C                     MOVE '6'       RTNC                            CSE003
     C                     MOVE *BLANKS   RQSESN                          CSE003
     C                     OUT  SESDS                                     CSE003
     C                     CALL 'SE0240'                                  CSE003
     C                     IN   SESDS                                     CSE003
     C           RTNC      IFNE '0'                                       CSE003
     C           RTNC      ANDNE'1'                                       CSE003
     C                     MOVE RQSESN    DPSS                            CSE003
     C                     ENDIF                                          CSE003
     C                     ENDIF                                          CSE003
     C                     ENDIF                                          CSE010
      *                                                                   CSE003
     C                     EXSR INITRC
     C                     MOVE *BLANKS   SDPID
     C                     MOVE *BLANKS   SDPMD
     C                     MOVE *BLANKS   SDPOD
     C                     MOVE *BLANKS   SDPDO
     C***********          MOVE *BLANKS   SDPBC                           S01117
     C                     MOVE *BLANKS   SDPBA                           S01117
     C                     MOVE *BLANKS   SDPBK
     C/COPY WNCPYSRC,SE0070C150
     C                     MOVE *BLANKS   SDPBN
     C/COPY WNCPYSRC,SE0070C151
     C                     MOVE *BLANKS   SDPNA
     C                     MOVE *BLANKS   SDPNR
     C                     MOVE *BLANKS   SDPMP
     C                     MOVE *BLANKS   SDPAD
     C                     MOVE *BLANKS   SORBR                           S01117
     C                     MOVE *BLANKS   SRPIN                           E16929
     C                     MOVE *BLANKS   SSWRF                           E16929
     C                     MOVE *BLANKS   SSIOI                           E16929
     C                     MOVE *BLANKS   SDPPC                           S01117
     C                     MOVE *BLANKS   SCHC                            S01445
     C                     MOVE *BLANKS   SCCE                            S01445
     C                     MOVE *BLANKS   SCHA                            S01445
     C                     MOVE *BLANKS   SCSE                            S01445
     C                     MOVE *BLANKS   SCAB                            S01445
     C                     MOVE *BLANKS   SCAT                            S01445
     C/COPY WNCPYSRC,SE0070C175
     C                     MOVE *BLANKS   SPTFR                           S01486
     C/COPY WNCPYSRC,SE0070C176
     C                     MOVE *BLANKS   SCYLD                           S01486
     C                     MOVE *BLANKS   SSPXR                           S01486
     C                     MOVE *BLANKS   SSPMD                           S01486
     C                     MOVE *BLANKS   SMSTP                           CPB001
     C                     MOVE *BLANKS   SACIN                           CPB001
     C                     MOVE *BLANKS   SPINT                           CPB001
     C                     MOVE *BLANKS   SAPINT                          CPB001
     C***********          MOVE 'N'       SCWDI                     056990095235
     C                     MOVE 'Y'       SCWDI                           095235
     C/COPY WNCPYSRC,SE0070C013
     C                     END
     C*
     C** IF DELETED RECORD-ENQUIRY ONLY (RECI IS SET TO BLANK FOR INSERTS)
     C*
     C           RECI      IFEQ '*'
     C           RECI      OREQ 'R'                                       046800
     C                     MOVEL'E'       ACTN
     C                     MOVEL'DELETED' DELT    7
     C                     ELSE
     C                     MOVEL*BLANK    DELT
     C                     END
     C/COPY WNCPYSRC,SE0070C213
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C           ACTN      IFNE 'I'
     C                     EXSR TRSFS
     C                     END
     C*
     C** IF DELETE/ENQUIRY PROTECT FIELD INPUT ON S/RECDETLS
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'E'
     C/COPY WNCPYSRC,SE0070C180
     C                     MOVEA'1'       *IN,6
     C                     MOVEA'1'       *IN,7                           S01176
     C                     MOVEA'0'       *IN,30
     C                     MOVE '1'       *IN14            *PROTECT       S01486
     C                     END
     C                     MOVE 'Y'       FIRST   1                       S01158
     C*                                                                   095743
     C** On Amendment Protect Depot In, Start Date, Branch and Book       095743
     C** if after the original entry date                                 095743
     C*                                                                   095743
     C           ACTN      IFEQ 'A'                                       095743
     C           ORED      ANDLTRUND                                      095743
     C*                                                                   095743
     C           DPMV      IFEQ 'BB'                                      095743
     C           DPMV      OREQ 'RR'                                      095743
     C           DPMV      OREQ 'PL'                                      095743
     C                     SETON                     16                   095743
     C                     END                                            095743
     C*                                                                   095743
     C           DPMV      IFEQ 'BL'                                      095743
     C           DPMV      OREQ 'RP'                                      095743
     C           DPMV      OREQ 'PD'                                      095743
     C                     SETON                     17                   095743
     C                     END                                            095743
     C*                                                                   095743
     C                     END                                            095743
      *
      ***  Do Until Change of Screen
      *
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Load up Information Messages
      *
     C           INFMSG    IFEQ *BLANK
     C           ACTN      IFEQ 'I'
     C                     MOVELINF,3     INFMSG
     C                     END
     C           ACTN      IFEQ 'A'
     C                     MOVELINF,4     INFMSG
     C                     END
     C           ACTN      IFEQ 'E'
     C/COPY WNCPYSRC,SE0070C254
     C                     MOVELINF,5     INFMSG
     C                     END
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,6     INFMSG
     C/COPY WNCPYSRC,SE0070C174
     C                     END
     C/COPY WNCPYSRC,SE0070C214
     C                     END
      *
      ***  Detail Screen Output
     C*                                                                   CPB001
     C** OBTAIN SECURITY PROCESSING TYPE                                  CPB001
     C                     MOVE *OFF      *IN29                           CPB001
     C           DPSS      IFNE *BLANKS                                   CPB001
     C           INVKA     CHAININVTPDF              33                   CPB001
     C           *IN33     IFEQ *OFF                                      CPB001
     C           PROT      IFEQ '1'                                       CPB001
     C           PROT      OREQ '3'                                       CPB001
     C           PROT      OREQ '5'                                       CPB001
     C           PROT      OREQ '6'                                       CPB001
     C           PROT      OREQ '8'                                       CPB001
     C           PROT      OREQ '9'                                       CPB001
     C           STBS      IFEQ 'Y'                                       CPB001
     C           STBS      OREQ 'P'                                       CPB001
     C                     MOVE *ON       *IN29                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *
     C/COPY WNCPYSRC,SE0070C098
     C**********           WRITEKEYINPUT                                                     BUG2576
     C/COPY WNCPYSRC,SE0070C152
     C                     WRITEMESSAGES
     C                     WRITEKEYINPUT                                                     BUG2576
     C                     EXFMTRECDETLS
     C/COPY WNCPYSRC,SE0070C099
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVELSCRMSG    RTNMSG 76                       S01401
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP4                                           S01408
     C*                                                                   S01408
     C                     MOVEL*BLANK    SCRMSG
      *
      ***  Check for CF/3, CF/12, ENTER, ROLLUP, ROLLDOWN
      *
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C***HELP*-*CALL*HELP*PROGRAM**************************************   S01179
     C***********                                                         S01179
     C***********AID       DOWEQ'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                             *ERR,1         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C***********                                                         S01199
     C***********          READ RECDETLS                 33               S01199
     C***********          END                                            S01199
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,12
     C/COPY WNCPYSRC,SE0070C081
     C*
     C** CK12- INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C/COPY WNCPYSRC,SE0070C082
     C                     ELSE
     C*                                                                   E20116
     C** ROLLUP OR ROLLDOWN ON INSERT IS NOT ALLOWED                      E20116
     C*                                                                   E20116
     C           ACTN      IFEQ 'I'                                       E20116
     C           AID       ANDEQ'UP'                                      E20116
     C/COPY WNCPYSRC,SE0070C083
     C                     MOVELINF,7     INFMSG                          E20116
     C*                                                                   E20116
     C                     ELSE                                           E20116
     C           ACTN      IFEQ 'I'                                       E20116
     C           AID       ANDEQ'DN'                                      E20116
     C/COPY WNCPYSRC,SE0070C084
     C                     MOVELINF,8     INFMSG                          E20116
     C                     ELSE                                           E20116
     C*
     C** PAGE FORWARD TAKEN, READ NEXT RECORD
     C**   IGNORE MATURED MOVEMENTS
     C*
     C           AID       IFEQ 'UP'
     C           ACTN      ANDNE'I'
     C                     MOVEL*BLANK    RECI                            061701
     C           RECI      DOUNE'S'                                       061701
     C/COPY WNCPYSRC,SE0070C181
     C           *IN12     OREQ '1'                                       061701
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     READ SEDPMVL1                 12               CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C215
     C                     READ DPTMVX                   12
     C/COPY WNCPYSRC,SE0070C216
     C                     ENDIF                                          CAP003
     C                     ENDDO                                          061701
     C*                                                                   061701
     C** IF LAST RECORD ON FILE IS MATURED THEN READ BACK TO LAST         061701
     C** UNMATURED ONE                                                    061701
     C*                                                                   061701
     C           RECI      IFEQ 'S'                                       061701
     C           CSE018    ANDNE'Y'                                       CSE018
     C           *IN12     ANDEQ'1'                                       061701
     C/COPY WNCPYSRC,SE0070C182
     C           CAP003    IFEQ 'Y'                                       CAP003
     C           *HIVAL    SETGTSEDPMVL1                                  CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C217
     C           *HIVAL    SETGTDPTMVX                                    061701
     C/COPY WNCPYSRC,SE0070C218
     C                     ENDIF                                          CAP003
     C           RECI      DOUNE'S'                                       061701
     C           CSE018    OREQ 'Y'                                       CSE018
     C/COPY WNCPYSRC,SE0070C183
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     READPSEDPMVL1                 68               CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C219
     C                     READPDPTMVX                   68               061701
     C/COPY WNCPYSRC,SE0070C220
     C                     ENDIF                                          CAP003
     C                     ENDDO                                          061701
     C                     ENDIF                                          061701
     C*
     C** CHANGE MESSAGE IF END OF FILE REACHED - NO ROLL FWD
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,7     INFMSG
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     EXSR VALIDK
     C                     END
     C*
     C** PAGE BACK TAKEN, READ PREVIOUS RECORD
     C**   IGNORE MATURED MOVEMENTS
     C*
     C                     ELSE
     C           AID       IFEQ 'DN'
     C           ACTN      ANDNE'I'
     C                     MOVEL*BLANK    RECI                            061701
     C           RECI      DOUNE'S'                                       061701
     C           CSE018    OREQ 'Y'                                       CSE018
     C/COPY WNCPYSRC,SE0070C184
     C           *IN12     OREQ '1'                                       061701
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     READPSEDPMVL1                 12               CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C221
     C                     READPDPTMVX                   12
     C/COPY WNCPYSRC,SE0070C222
     C                     ENDIF                                          CAP003
     C                     END                                            061701
     C*                                                                   061701
     C** IF FIRST RECORD ON FILE IS MATURED THEN READ FORWARD TO FIRST    061701
     C** UNMATURED ONE                                                    061701
     C*                                                                   061701
     C           RECI      IFEQ 'S'                                       061701
     C           CSE018    ANDNE'Y'                                       CSE018
     C           *IN12     ANDEQ'1'                                       061701
     C/COPY WNCPYSRC,SE0070C185
     C           CAP003    IFEQ 'Y'                                       CAP003
     C           *LOVAL    SETLLSEDPMVL1                                  CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C223
     C           *LOVAL    SETLLDPTMVX                                    061701
     C/COPY WNCPYSRC,SE0070C224
     C                     ENDIF                                          CAP003
     C           RECI      DOUNE'S'                                       061701
     C           CSE018    OREQ 'Y'                                       CSE018
     C/COPY WNCPYSRC,SE0070C186
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     READ SEDPMVL1                 68               CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C225
     C                     READ DPTMVX                   68               061701
     C/COPY WNCPYSRC,SE0070C226
     C                     ENDIF                                          CAP003
     C                     ENDDO                                          061701
     C                     ENDIF                                          061701
     C*
     C** CHANGE MESSAGE IF BEGINNING OF FILE REACHED - NO ROLL BACK
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,8     INFMSG
     C           *INU4     IFEQ '1'                                       S01486
     C*                                                                   S01486
     C** GET BACK LAST RECORD DISPLAYED                                   S01486
     C           CAP003    IFEQ 'Y'                                       CAP003
     C           DPTMVK    CHAINSEDPMVL1             12                   CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C227
     C           DPTMVK    CHAINDPTMVX               12                   S01486
     C/COPY WNCPYSRC,SE0070C228
     C                     ENDIF                                          CAP003
     C           RECI      DOWNE'D'                                       S01486
     C           CSE018    ANDNE'Y'                                       CSE018
     C/COPY WNCPYSRC,SE0070C187
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     READ SEDPMVL1                 12*              CAP003
     C                     ELSE                                           CAP003
     C/COPY WNCPYSRC,SE0070C229
     C                     READ DPTMVX                   12*              S01486
     C/COPY WNCPYSRC,SE0070C230
     C                     ENDIF                                          CAP003
     C                     END                                            S01486
     C                     END                                            S01486
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     EXSR VALIDK
     C                     END
      *
      ***  Else NOT CF/3, CF/12, ROLLUP, ROLLDOWN
      *
     C                     ELSE
      *                                                                   S01158
      **  IF BEEN THROUGH AT LEAST ONCE, ALL ERRORS ARE WARNING ERRORS,   S01158
      **  AND NO SCREEN CHANGES, DO THE UPDATE, NO NEED TO VALIDATE.      S01158
      *                                                                   S01158
     C           FIRST     IFEQ 'N'                                       S01158
     C           WEC       ANDEQEC                                        S01158
     C           *IN19     ANDEQ'0'                                       S01158
     C           AID       ANDEQ'RA'                                      S01158
     C           ACTN      ANDNE'D'                                       E18617
     C                     GOTO UPD                                       S01158
     C                     END                                            S01158
     C*                                                                   S01117
     C** CHECK FOR SELECTION IN INPUT FIELDS                              S01117
     C*                                                                   S01117
     C                     EXSR CHKSEL                                    S01117
     C           @SEL      IFEQ 'N'                                       S01117
      *
      ***  Validate Detail Screen Input
      *
     C                     EXSR VALIDD
     C/COPY WNCPYSRC,SE0070C014
      *                                                                   S01158
     C                     MOVE 'N'       FIRST                           S01158
      *
     C           UPD       TAG                             ***  UPD   *** S01158
     C/COPY WNCPYSRC,SE0070C100
      *
      ***  No Detail Screen errors
      *                                                                   S01158
     C           SCRMSG    IFEQ *BLANK
     C           AID       ANDEQ'RA'
     C                     MOVE '0'       *IN48                           S01496
     C                     MOVE '0'       *IN49                           S01496
     C/COPY WNCPYSRC,SE0070C047
      *                                                                   S01401
      ** If the MT5xx feature is available, process for MT5xxs;           S01401
      *                                                                   S01401
     C                     MOVE 'N'       PERR                            S01401
     C/COPY WNCPYSRC,SE0070C001
     C           S01401    IFEQ 'Y'                                       S01401
     C                     EXSR MT500                                     S01401
     C                     END                                            S01401
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP2                                           S01408
     C*                                                                   S01408
     C*
     C** FOR REC.ADVANCE DETERMINE WHAT SCREEN TO RETURN TO
      *** (but only if no error from SE1807 and not F3, F5 or F12)        S01401
     C*
     C           PERR      IFEQ 'N'                                       S01401
     C           PCMD      ANDNE'03'                                      S01401
     C           PCMD      ANDNE'05'                                      S01401
     C           PCMD      ANDNE'12'                                      S01401
     C           REVW      IFEQ 'Y'
     C                     MOVELPPAGK     PAGK
     C                     MOVEA'1'       *IN,11
     C                     ELSE
     C                     MOVEA'1'       *IN,10
     C/COPY WNCPYSRC,SE0070C015
     C                     END
      *
      ***  Update Files
      *
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C           ACTN      OREQ 'D'
     C/COPY WNCPYSRC,SE0070C231
     C                     EXSR UPDFLS
     C                     END
     C                     END                                            S01401
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP3                                           S01408
     C*                                                                   S01408
      *
      ***  Else there are Screen Errors or AID NOT= 'RA'
      *
     C                     ELSE
     C                     SETOF                     30
     C                     MOVE ERR,1     WORK3A  3
     C           WORK3A    IFEQ '227'
     C                     SETON                     30
     C                     END
      *
     C                     END
     C                     END                                            S01117
      *
      ***  End of CF/3, CF/12, ROLLUP/ ROLLDOWN
      *
     C                     END
     C                     END
     C                     END                                            E20116
     C                     END                                            E20116
     C                     END
     C                     END
      *
      ***  End of DO UNTIL Change of Screen
      *
     C                     END
     C*
     C** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVEA'00'      *IN,5
     C*                                                                   E16929
     C           *INU2     IFEQ '1'                                       E16929
     C                     MOVE '0'       *IN07                           E16929
     C                     END                                            E16929
     C*                                                                   S01486
     C           *INU4     IFEQ '1'                                       S01486
     C                     MOVE '0'       *IN14                           S01486
     C                     MOVE '0'       *IN13                           S01486
     C                     ELSE                                           S01486
     C                     MOVE '1'       *IN13                           S01486
     C                     MOVE '1'       *IN14                           S01486
     C                     END                                            S01486
     C*
     C/COPY WNCPYSRC,SE0070C043
     C                     ENDSR
      *
      *****************************************************************   S01401
      /EJECT                                                              S01401
      *****************************************************************   S01401
      *                                                               *   S01401
      *  MT500  Produce SWIFT Messages, MT5xxs                        *   S01401
      *                                                               *   S01401
      *  OUTPUT : PERR - Error code: 'N' = No error                   *   S01401
      *                              'U' = extension file not Updated *   S01401
      *           PCMD - Retrn code :'03'= Exit to Menu               *   S01401
      *                              '05'= Refresh Screen (Enq. only) *   S01401
      *                              '12'= Previous Screen (no update)*   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           MT500     BEGSR                                          S01401
      *                                                                   S01401
     C                     MOVE ACTN      PACTN                           S01401
     C                     MOVE DPSS      PPDPSS                          S01401
     C                     MOVE DPRN      PPDPRN                          S01401
     C                     MOVE DPBA      PDPBA                           S01401
     C                     MOVE DPBN      PDPBN                           S01401
     C                     MOVE DPMV      PDPMV                           S01401
     C                     MOVE ACTNTP    PTNTP                           S01401
     C                     MOVE SDPDO     PDPDO                           S01401
     C                     MOVE SDPMD     PDPMD                           S01401
     C**********           Z-ADDDPID      PDPID                                        S01401 CSD027
     C                     MOVE DPID      PDPID                                               CSD027
     C                     MOVE BVDR1     PDC01                           S01401
     C                     MOVE BVDR2     PDC02                           S01401
     C**********           Z-ADDDPOD      PDPOD                                        S01401 CSD027
     C                     MOVE DPOD      PDPOD                                               CSD027
     C                     Z-ADDRUND      PLCD                            S01401
     C                     MOVE NMCY      PNMCY                           S01401
     C                     MOVE MKTI      PDPMK                           S01401
     C                     MOVE DPNA      PDPNA                           CSW003
     C                     Z-ADDORED      PORED                           CSW003
     C                     Z-ADDMKTP      PMKTP                           CSW003
     C                     MOVE DPMS      PDPMS                                               CSE028
      *                                                                   CSE006
      *** Initialise new parameters in call of SE1807                     CSE006
      *                                                                   CSE006
     C                     MOVEL*BLANKS   DFT     1                       CSE006
     C                     MOVEL*BLANKS   MSGS   10                       CSE006
     C                     MOVEL*BLANKS   PARM3   1                       CSE006
      *                                                                                       CSE028
      *** New paramaters for call to SE1807                                                   CSE028
      *** Book code and portfolio reference                                                   CSE028
      *                                                                                       CSE028
     C                     MOVE SDPBK     PBKC                                                CSE028
     C           *IN13     IFEQ *OFF                                                          CSE028
     C                     MOVE SPTFR     PPTFR                                               CSE028
     C                     ELSE                                                               CSE028
     C                     CLEARPPTFR                                                         CSE028
     C                     ENDIF                                                              CSE028
      *                                                                   S01401
     C/COPY WNCPYSRC,SE0070C016
     C                     CALL 'SE1807'                                  S01401
     C                     PARM '00'      PCMD    2                       S01401
     C                     PARM 'N'       PERR    1                       S01401
     C                     PARM           PDATA                           S01401
      *                                                                   CSE006
      *** New parameters for calling SE1807                               CSE006
     C                     PARM           DFT                             CSE006
     C                     PARM           MSGS                            CSE006
      *                                                                                       CSD015
      ** New parameter for calling SE1807. Returns the other extended                         CSD015
      ** settlement fields done SE1808 in XML format already.                                 CSD015
      *                                                                                       CSD015
     C                     PARM *BLANKS   PMCWL                                               CSD015
     C/COPY WNCPYSRC,SE0070C017
      *                                                                   S01401
      ** If Extension File not updated in SE1807 then prepare message     S01401
      *                                                                   S01401
     C           PERR      IFEQ 'U'                                       S01401
     C                     MOVEAINF,13    INFMSG                          S01401
     C                     END                                            S01401
      *                                                                   S01401
      ** If F3 (for Exit) from SE1807 return to menu                      S01401
      *                                                                   S01401
     C           PCMD      IFEQ '03'                                      S01401
     C                     MOVE '01'      AID                             S01401
     C                     SETON                     12                   S01401
     C                     ROLBK                                          S01401
     C                     END                                            S01401
      *                                                                   S01401
      ** If F5 (for Refresh) from SE1807 redisplay initial screen         S01401
      *                                                                   S01401
     C           PCMD      IFEQ '05'                                      S01401
     C                     MOVE '05'      AID                             S01401
     C                     SETON                     10                   S01401
     C                     ROLBK                                          S01401
     C                     END                                            S01401
      *                                                                   S01401
      ** If F12 (for Previous) from SE1807 redisplay previous screen      S01401
      ** (restore screen messages from before SE1807 called)              S01401
      *                                                                   S01401
     C           PCMD      IFEQ '12'                                      S01401
     C                     MOVELRTNMSG    SCRMSG                          S01401
     C                     MOVE '12'      AID                             S01401
     C                     ROLBK                                          S01401
     C                     END                                            S01401
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *                                                                   S01401
      *****************************************************************
      /EJECT                                                              S01179
      *****************************************************************   S01179
      *                                                               *   S01179
      *  ASCHGS - Subroutine to move appropriate value into field AID,*   S01179
      *           depending on which Function Key has been pressed.   *   S01179
      *                                                               *   S01179
      *  Called By: UPDATE                                            *   S01179
      *  Calls:     None.                                             *   S01179
      *                                                               *   S01179
      *****************************************************************   S01179
      *                                                                   S01179
     C           ASCHGS    BEGSR                           *** ASCHGS *** S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN20     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C/COPY WNCPYSRC,SE0070C018
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F10                                                            S01179
     C*                                                                   S01179
     C           *INKJ     IFEQ '1'                                       S01179
     C                     MOVE '04'      AID                             S01179
     C                     MOVE '0'       *INKJ                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN65     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN65                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLDOWN pressed                                               S01179
     C*                                                                   S01179
     C           *IN66     IFEQ '1'                                       S01179
     C                     MOVE 'DN'      AID                             S01179
     C                     MOVE '0'       *IN66                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key*pressed************************************** S01179  S01199
     C***********                                                 S01179  S01199
     C************IN67     IFEQ '1'                               S01179  S01199
     C***********          MOVE 'HP'      AID                     S01179  S01199
     C***********          MOVE '0'       *IN67                   S01179  S01199
     C***********          END                                    S01179  S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VALIDK - Subroutine to Validate Key fields.                  *
      *                                                               *
      *  Called By: START                                             *
      *             REVIEW                                            *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           VALIDK    BEGSR                           *** VALIDK ***
     C*
     C** RESET ERROR INDICATORS
     C** SET ERROR ARRAY COUNTER TO ZERO
     C*
     C                     MOVEA'000'     *IN,21
     C                     Z-ADD*ZERO     EC      40
     C/COPY WNCPYSRC,SE0070C071
      *                                                                   CSE010
      ** Check Security Shortname and call Securities Selection           CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'Y'                                       CSE010
     C                     MOVELDPSS      @QMK    1                       CSE010
     C           @QMK      IFEQ '?'                                       CSE010
     C                     MOVELDPSS      @SESN                           CSE010
     C                     CALL 'SE0043'                                  CSE010
     C                     PARM           @ACDE   1                       CSE010
     C                     PARM           @SESN  10                       CSE010
     C           @SESN     IFNE *BLANKS                                   CSE010
     C                     MOVE @SESN     DPSS                            CSE010
     C                     ELSE                                           CSE010
     C                     MOVE *BLANKS   DPSS                            CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *                                                                   CSE010
      ** Check Review From Security Shortname                             CSE010
      ** and call Securities Selection                                    CSE010
      *                                                                   CSE010
     C                     MOVELPDPSS     @QMK    1                       CSE010
     C           @QMK      IFEQ '?'                                       CSE010
     C                     MOVELPDPSS     @SESN                           CSE010
     C                     CALL 'SE0043'                                  CSE010
     C                     PARM           @ACDE   1                       CSE010
     C                     PARM           @SESN  10                       CSE010
     C           @SESN     IFNE *BLANKS                                   CSE010
     C                     MOVE @SESN     PDPSS                           CSE010
     C                     ELSE                                           CSE010
     C                     MOVE *BLANKS   PDPSS                           CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
     C                     ENDIF                                          CSE010
      *
      ***  Action Code must be I, A, E, D if Security Shortname entered
      *
     C           ACTN      IFEQ 'I'                                       CSE003
      *                                                                   CSE010
      ** Process only if switchable  feature, CSE010, is off              CSE010
      *                                                                   CSE010
     C           CSE010    IFEQ 'N'                                       CSE010
      * If ? processing available and ? entered                           CSE003
     C           CSE003    ANDEQ'Y'                                       CSE003
     C           DPSS      ANDEQ'?'                                       CSE003
     C           *LOCK     IN   SESDS                                     CSE003
     C                     MOVE '6'       RTNC                            CSE003
     C                     MOVE *BLANKS   RQSESN                          CSE003
     C                     OUT  SESDS                                     CSE003
     C                     CALL 'SE0240'                                  CSE003
     C                     IN   SESDS                                     CSE003
     C           RTNC      IFNE '0'                                       CSE003
     C           RTNC      ANDNE'1'                                       CSE003
     C                     MOVE RQSESN    DPSS                            CSE003
     C                     ENDIF                                          CSE003
     C                     ENDIF                                          CSE003
     C                     ENDIF                                          CSE010
      *                                                                   CSE003
     C           DPSS      IFNE *BLANKS
     C           ACTN      ANDNE'I'
     C           ACTN      ANDNE'A'
     C           ACTN      ANDNE'E'
     C           ACTN      ANDNE'D'
     C/COPY WNCPYSRC,SE0070C232
     C                     ADD  1         EC         21
     C                     MOVEL' 100'    ERR,EC
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   VALIDATE SPF-ACTION FOR THIS USER                              S01117
     C*                                                                   S01117
     C           ACTN      IFEQ *BLANK                                    S01117
     C                     MOVEL'E'       @ZACTN                          S01117
     C                     ELSE                                           S01117
     C                     MOVELACTN      @ZACTN                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** - IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM           @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 302'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     SETON                     21                   S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** - IF MULTIBRANCHING ENVIRONMENT                                  S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM           @ZACTN  1                       S01117
     C                     PARM USRBCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 304'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     SETON                     21                   S01117
     C                     END                                            S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 303'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     SETON                     21                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END
      *
      ***  Record must exist if Action Code is A, D or E and must be
      ***  active for A or D.
      *
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'D'
     C           ACTN      OREQ 'E'
     C/COPY WNCPYSRC,SE0070C233
      *                                                                   163088
     C           CAP003    IFEQ 'Y'                                       163088
     C           DPTMVK    CHAINSEDPMVL1             33                   163088
     C                     ELSE                                           163088
     C           DPTMVK    CHAINDPTMVDFX             33
     C                     ENDIF                                          163088
      *                                                                   163088
     C/COPY WNCPYSRC,SE0070C234
     C           ACTN      IFNE 'E'
     C  N33      RECI      COMP '*'                      33
     C/COPY WNCPYSRC,SE0070C188
     C  N33      RECI      COMP 'S'                      33               E16338
     C*                                                                   CSE018
     C** If CSE018 is present then allow for the deletion of settled      CSE018
     C** WI and WO only if the movement date is within the backvalue      CSE018
     C** period.                                                          CSE018
     C*                                                                   CSE018
     C           RUND      SUB  BVBVP     WBKVP                           CSE018
     C           DPMV      IFEQ 'WI'                                      CSE018
     C                     Z-ADDDPMD      WMDATE  50                      CSE018
     C                     ELSE                                           CSE018
     C                     Z-ADDDPDO      WMDATE                          CSE018
     C                     END                                            CSE018
     C*                                                                   CSE018
     C           CSE018    IFEQ 'Y'                                       CSE018
     C           RECI      ANDEQ'S'                                       CSE018
     C           WMDATE    ANDGTWBKVP                                     CSE018
     C           DPMV      IFEQ 'WI'                                      CSE018
     C           DPMV      OREQ 'WO'                                      CSE018
     C                     MOVE '0'       *IN33                           CSE018
     C                     END                                            CSE018
     C                     END                                            CSE018
     C*                                                                   CSE018
     C/COPY WNCPYSRC,SE0070C189
     C  N33      RECI      COMP 'R'                      33               046800
     C                     END
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC         21
     C                     MOVEL' 101'    ERR,EC
     C                     ELSE
     C*
     C* Save existing details for later file updates
     C*
     C**********           Z-ADDDPID      XDPID                                               CSD027
     C                     MOVE DPID      XDPID                                               CSD027
     C                     Z-ADDDPMD      XDPMD
     C**********           Z-ADDDPOD      XDPOD                                               CSD027
     C                     MOVE DPOD      XDPOD                                               CSD027
     C                     Z-ADDDPDO      XDPDO
     C***********          Z-ADDDPBC      XDPBC                           S01117
     C                     MOVE DPBA      XDPBA                           S01117
     C                     MOVE ORBR      XORBR                           S01117
     C                     MOVE DPBK      XDPBK
     C**********           Z-ADDDPBN      XDPBN                                               CSD027
     C                     MOVE DPBN      XDPBN                                               CSD027
     C                     Z-ADDDPNA      XDPNA
     C                     Z-ADDMKTP      XMKTP
     C                     MOVE DPPC      XDPPC                           S01117
     C                     END
     C*
     C                     END
     C*
     C* If no security entered, check no action entered
     C*
     C           DPSS      IFEQ *BLANKS
     C           ACTN      ANDNE' '
     C                     ADD  1         EC         21
     C                     MOVEA' 100'    ERR,EC
     C                     END
      *
      ***  Active record must not exist if Action Code is I.
      *
     C           ACTN      IFEQ 'I'
     C/COPY WNCPYSRC,SE0070C235
     C           DPTMVK    CHAINDPTMVDFX             33
     C/COPY WNCPYSRC,SE0070C236
     C**N33******RECI      COMP '*'                      33               S01158
     C           *IN33     IFEQ '0'
     C                     ADD  1         EC         21
     C                     MOVEL' 102'    ERR,EC
     C                     END
     C*                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C/COPY WNCPYSRC,SE0070C237
     C           DPRN      CHAINDPTMVDFY             33                   S01401
     C/COPY WNCPYSRC,SE0070C238
     C           *IN33     IFEQ '0'                                       S01401
     C                     ADD  1         EC         21                   S01401
     C                     MOVEL' 102'    ERR,EC                          S01401
     C                     END                                            S01401
     C                     END                                            S01401
     C*                                                                   S01401
     C                     END
     C*
     C* Action code entered
     C*
     C           ACTN      IFNE ' '
     C*
     C* Security shortname - mandatory entry
     C*
     C           DPSS      IFEQ *BLANKS
     C                     ADD  1         EC         22
     C                     MOVEL' 104'    ERR,EC
     C                     ELSE
     C*
     C* else must reference a complete security if action code is I
     C*
     C           ACTN      IFEQ 'I'
     C           DPSS      CHAINSECTYDF              33
     C**N33******RECI      COMP '*'                      33               S01158
     C  N33      RECI      COMP 'D'                  3333                 S01158
     C  N33      INCS      COMP 'C'                  3333
     C/COPY WNCPYSRC,SE0070C002
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC         22
     C                     MOVEL' 104'    ERR,EC
     C/COPY WNCPYSRC,SE0070C087
     C                     END
     C                     END
     C*                                                                   S01511
     C** If S01511 is installed and market migration is ongoing, error,   S01511
     C** otherwise, save market indicator for later validation            S01511
     C*                                                                   S01511
     C           S01511    IFEQ 'Y'                                       S01511
     C           *IN22     ANDEQ'0'                                       S01511
     C           DPSS      CHAINSECTYDF              33                   S01511
     C           *IN33     IFEQ '0'                                       S01511
     C           RECI      ANDEQ'D'                                       S01511
     C           *IN33     OREQ '0'                                       087180
     C           RECI      ANDEQ'M'                                       087180
     C           ACTN      ANDEQ'E'                                       087180
     C           RECI      IFEQ 'M'                                       087180
     C                     MOVEL'MATURED' MATU                            087180
     C                     ELSE                                           087180
     C                     MOVEL*BLANKS   MATU                            087180
     C                     END                                            087180
     C           SMAI      IFEQ 'Y'                                       S01511
     C                     ADD  1         EC         22                   S01511
     C                     MOVEL' 234'    ERR,EC                          S01511
     C                     ELSE                                           S01511
     C                     MOVE MKTI      SMKTI   1                       S01511
     C                     END                                            S01511
     C*                                                                   S01511
     C** Security not in file                                             S01511
     C*                                                                   S01511
     C                     ELSE                                           S01511
     C*                                                                   085547
     C** Replace data base error with a msg error                         085547
     C*                                                                   085547
     C                     ADD  1         EC         22                   085547
     C                     MOVEL' 104'    ERR,EC                          085547
     C************LOCK     IN   LDA                                S01511 085547
     C***********          MOVEL'SECTYD'  DBFILE           ********S01511 085547
     C***********          Z-ADD15        DBASE            * DB ERRS01511 085547
     C***********          MOVELDPSS      DBKEY            ********S01511 085547
     C***********          OUT  LDA                                S01511 085547
     C***********          SETON                     U7U8LR        S01511 085547
     C***********          RETRN                                   S01511 085547
     C                     END                                            S01511
     C                     END                                            S01511
     C*
     C                     END
     C/COPY WNCPYSRC,SE0070C019
     C*
     C* Reference - Mandatory entry
     C*
     C           DPRN      IFEQ *BLANKS
     C/COPY WNCPYSRC,SE0070C255
     C                     ADD  1         EC         23
     C                     MOVEL' 103'    ERR,EC
     C                     ELSE
     C/COPY WNCPYSRC,SE0070C256
     C*
     C* else must be a six digit number
     C*
     C                     MOVE DPRN      DATEN
     C                     MOVE DATEN     DATEA
     C           DPRN      IFNE DATEA
     C                     ADD  1         EC         23
     C                     MOVEA' 103'    ERR,EC
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0070C020
     C*
     C                     END
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C/COPY WNCPYSRC,SE0070C088
     C                     MOVELHI        ERRMSG
     C                     MOVEL*BLANK    AID
     C/COPY WNCPYSRC,SE0070C153
     C                     END
     C*
     C** Clear warning error memory fields used in SR VALIDD
     C*
     C                     Z-ADD*ZEROS    HMKTP
     C                     Z-ADD*ZEROS    HDPMD
     C                     Z-ADD*ZEROS    HDPDO
     C                     Z-ADD*ZEROS    HDPAD
     C                     Z-ADD*ZEROS    LDPMD
     C                     Z-ADD*ZEROS    LDPDO
     C                     Z-ADD*ZEROS    LDPAD
     C                     Z-ADD*ZEROS    LDPNA
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VALIDD - Subroutine to Validate Detail Screen.               *
      *                                                               *
      *  Called By: UPDATE                                            *
      *  Calls:     ZEDIT                                             *
      *             ZALIGN                                            *
      *                                                               *
      *****************************************************************
      *
     C           VALIDD    BEGSR                           *** VALIDD ***
     C*
     C** RESET SCREEN ERROR INDICATORS
     C/COPY WNCPYSRC,SE0070C258
     C*
     C                     MOVEA'00000000'*IN,41
     C                     MOVEA'00'      *IN,49
     C                     MOVEA'00000'   *IN,51                          S01117
     C                     MOVEA'000000'  *IN,70                          S01445
     C                     MOVE '0'       *IN56                           S01486
     C                     MOVE '0'       *IN57                           S01486
     C                     MOVE '0'       *IN58                           056990
     C                     MOVE '0'       *IN26                           CPB001
     C                     MOVE '0'       *IN27                           CPB001
     C                     MOVE '0'       *IN28                           CPB001
     C/COPY WNCPYSRC,SE0070C146
     C*
     C** SET ERROR COUNT TO ZERO
     C*
     C                     Z-ADD*ZERO     EC
     C                     Z-ADD*ZEROS    WEC     20                      S01158
     C                     MOVE *BLANKS   ERRMSG                          S01158
     C*
     C** ENTER KEY PRESSED
     C*
     C           AID       IFEQ 'RA'
     C*
     C** ACTION = I OR A
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C*
     C** VALIDATION OF FIELDS FOR INSERT/AMEND
     C*
     C*
     C* 'In' depot - mandatory only if associated deal number entered
     C*
     C/COPY WNCPYSRC,SE0070C021
     C           SDPID     IFEQ *BLANKS
     C           SDPAD     IFNE *BLANKS
     C                     ADD  1         EC         41
     C                     MOVEA' 200'    ERR,EC
     C                     END
     C**********           Z-ADD*ZEROS    DPID                                                CSD027
     C                     MOVE *BLANKS   DPID                                                CSD027
     C                     ELSE
     C/COPY WNCPYSRC,SE0070C154
     C*
     C* else must reference an active securities customer
     C*
     C***********SDPID     CHAINSNAMEF               33                   S01117
     C                     MOVELSDPID     @AENB   6                       S01117
     C**********           MOVELSDPID     WRK6N   60                      S01117              CSD027
     C**********           MOVELWRK6N     WRK6A   6                       S01117              CSD027
     C********** SDPID     IFNE WRK6A                                     S01117              CSD027
     C                     MOVELSDPID     @KEY1                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @KEY1  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C************IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          Z-ADDCNUM      WORK6N  60                      S01117
     C                     MOVELBBCUST    @AENB                           S01117
     C**********           ELSE                                           S01117
     C***********          MOVELSDPID     WORK6N                          S01117
     C                     END
     C***********          END                                            S01117              CSD027
     C***********          Z-ADDWORK6N    DPID                            S01117
     C                     MOVEL@AENB     DPID                            S01117
     C/COPY WNCPYSRC,SE0070C155
     C*
     C***********WORK6N    CHAINCLINTSEF             33                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @AENB                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         41
     C                     MOVEA' 201'    ERR,EC
     C                     ELSE
     C*
     C**with*a*discretionary*indicator*NE*to*'S'*or*'D'***************    S01176
     C* with Classification NE to 'S' or 'D'                              S01176
     C*
     C***********C1DI      IFEQ 'S'                                       S01117
     C***********C1DI      OREQ 'D'                                       S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C********** C1DI      OREQ 'M'                                E18718 E20646
     C                     ADD  1         EC         41
     C                     MOVEA' 201'    ERR,EC
     C                     ELSE
     C*
     C**if*associated*deal*not*entered,*discretionary*indicator*can*not***S01176
     C**equal*'I'*********************************************************S01176
     C* if associated deal not entered, classification can not equal 'I'  S01176
     C*
     C***********SDPAD     IFEQ *BLANKS                                   E21271
     C***********C1DI      ANDEQ'I'                                       E21271
     C***********          ADD  1         EC         41                   E21271
     C***********          MOVEA' 201'    ERR,EC                          E21271
     C***********          END                                            E21271
     C/COPY WNCPYSRC,SE0070C022
     C                     END
     C                     END
     C                     END
     C*
     C* Date In
     C*
     C           SDPMD     IFNE *BLANKS
     C*
     C* Prohibited if depot not entered
     C*
     C           SDPID     IFEQ *BLANKS
     C                     ADD  1         EC         42
     C                     MOVEA' 202'    ERR,EC
     C                     ELSE
     C*
     C* must be a valid date (999999 allowed)
     C*
     C                     MOVE SDPMD     DATEN   60
     C                     MOVE DATEN     DATEA   6
     C           SDPMD     IFNE DATEA
     C                     ADD  1         EC         42
     C                     MOVEA' 203'    ERR,EC
     C                     ELSE
     C           SDPMD     IFEQ '999999'
     C                     MOVE SDPMD     DPMD
     C                     ELSE
     C                     MOVE SDPMD     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         42
     C                     MOVEA' 203'    ERR,EC
     C                     ELSE
     C                     Z-ADDZDAYNO    DPMD
     C*
     C* If Out depot not entered, must not be after run date
     C*
     C           SDPOD     IFEQ *BLANKS
     C           DPMD      ANDGTRUND
     C                     ADD  1         EC         42
     C                     MOVEA' 204'    ERR,EC
     C                     END
     C*                                                                   S01158
     C* If Date in GT run date AND NE 99999 -                             S01158
     C*    then date in must be LE maturity date                          S01158
     C*                                                                   S01158
     C           DPMD      IFGT RUND                                      S01158
     C           DPMD      ANDNE99999                                     S01158
     C           DPMD      IFGT MATY                                      S01158
     C           MATY      ANDNE*ZEROS                                    E13821
     C                     ADD  1         EC         42                   S01158
     C***********          MOVEA' 230'    ERR,EC                          E16929
     C                     MOVEA' 229'    ERR,EC                          E16929
     C                     END                                            S01158
     C                     END                                            S01158
     C*
     C*     must fall within back value period on TABTB36                 E15252
     C*                                                                   E15252
     C********** RUND      SUB  BKVP      WBKVP   50                E15252S01117
     C           RUND      SUB  BVBVP     WBKVP   50                      S01117
     C           DPMD      IFLT RUND                                      E15252
     C           DPMD      ANDLTWBKVP                                     E15252
     C                     ADD  1         EC         42                   E15252
     C                     MOVEA' 232'    ERR,EC                          E15252
     C                     END                                            E15252
     C*
     C* If In depot is Euroclear or Cedel, should not be a holiday in the
     C* clearing house currency
     C********WARNING*ERROR*ONLY*-*ACCEPT*IF*UNCHANGED*****************   S01158
     C*
     C***********DPMD      IFNE LDPMD                                     S01158
     C*
     C* Euroclear
     C*
     C********** C1DI      IFEQ 'E'                                       S01117
     C**********           MOVE ECYC      ZCCY                            S01117
     C           BFCLAS    IFEQ 'E'                                       S01117
     C                     MOVELBVEUCY    ZCCY                            S01117
     C                     MOVELDPMD      ZDAYNO                          S01117
     C                     MOVEL*BLANKS   ZLOC                            S01195
     C**********           EXSR ZDATE5                                    S01195
     C********** *IN99     IFEQ '1'                                       S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C/COPY WNCPYSRC,SE0070C101
     C                     ADD  1         EC         42
     C                     ADD  1         WEC                             S01158
     C                     MOVEA' W01'    ERR,EC
     C/COPY WNCPYSRC,SE0070C102
     C                     END
     C                     ELSE
     C*
     C* Cedel
     C*
     C********** C1DI      IFEQ 'C'                                       S01117
     C**********           MOVE CCYC      ZCCY                            S01117
     C           BFCLAS    IFEQ 'C'                                       S01117
     C                     MOVELBVCCCY    ZCCY                            S01117
     C                     MOVELDPMD      ZDAYNO                          S01117
     C                     MOVEL*BLANKS   ZLOC                            S01195
     C**********           EXSR ZDATE5                                    S01195
     C********** *IN99     IFEQ '1'                                       S01195
     C                     EXSR ZCHKH                                     S01195
     C/COPY WNCPYSRC,SE0070C023
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC         42
     C                     ADD  1         WEC                             S01158
     C                     MOVEA' W01'    ERR,EC
     C                     END
     C/COPY WNCPYSRC,SE0070C024
     C                     ELSE
     C*
     C* If In depot is not Euroclear or Cedel, should not be a holiday in
     C* nominal currency
     C*
     C                     MOVE NMCY      ZCCY
     C                     MOVELDPMD      ZDAYNO                          S01117
     C                     MOVEL*BLANKS   ZLOC                            S01195
     C**********           EXSR ZDATE5                                    S01195
     C********** *IN99     IFEQ '1'                                       S01195
     C                     EXSR ZCHKH                                     S01195
     C/COPY WNCPYSRC,SE0070C025
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC         42
     C                     ADD  1         WEC                             S01158
     C                     MOVEA' W02'    ERR,EC
     C                     END
     C/COPY WNCPYSRC,SE0070C026
     C                     END
     C                     END
     C*
     C                     Z-ADDDPMD      LDPMD
     C***********          END                                            S01158
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     ELSE
     C*
     C* No date entered - error if In depot present
     C*
     C           SDPID     IFNE *BLANKS
     C                     ADD  1         EC         42
     C                     MOVEA' 202'    ERR,EC
     C                     END
     C                     Z-ADD*ZEROS    DPMD
     C                     END
     C*
     C* Out depot
     C*
     C/COPY WNCPYSRC,SE0070C027
     C           SDPOD     IFNE *BLANKS
     C/COPY WNCPYSRC,SE0070C156
     C*
     C* If associated deal number entered, must reference a customer
     C*
     C           SDPAD     IFNE *BLANKS
     C***********SDPOD     CHAINSNAMEF               33                   S01117
     C                     MOVELSDPOD     @KEY1                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @KEY1  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C************IN33     IFEQ '1'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          MOVELSDPOD     WORK6N                          S01117
     C                     MOVELBBCUST    DPOD                            S01117
     C/COPY WNCPYSRC,SE0070C157
     C                     END                                            S01117
     C***********WORK6N    CHAINCLINTCBF             33                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C***********          ELSE                                           S01117
     C************IN33     IFEQ '1'                                       S01117
     C***********          MOVELSDPOD     WORK6N                          S01117
     C**********           ELSE                                           S01117
     C***********          Z-ADDCNUM      WORK6N                          S01117
     C**********           END                                            S01117
     C**********           END                                            S01117
     C***********          Z-ADDWORK6N    DPOD                            S01117
     C*
     C************IN33     IFEQ '1'                                       S01117
     C/COPY WNCPYSRC,SE0070C028
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         43
     C                     MOVEA' 205'    ERR,EC
     C                     END
     C*
     C                     ELSE
     C*
     C* else must reference a customer
     C*
     C***********SDPOD     CHAINSNAMEF               33                   S01117
     C                     MOVELSDPOD     @AENB   6                       S01117
     C**********           MOVELSDPOD     WRK6N   60                      S01117              CSD027
     C**********           MOVELWRK6N     WRK6A   6                       S01117              CSD027
     C********** SDPOD     IFNE WRK6A                                     S01117              CSD027
     C                     MOVELSDPOD     @KEY1                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @KEY1  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C************IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          Z-ADDCNUM      WORK6N  60                      S01117
     C                     MOVELBBCUST    @AENB                           S01117
     C**********           ELSE                                           S01117
     C***********          MOVELSDPOD     WORK6N                          S01117
     C                     END
     C***********          END                                            S01117              CSD027
     C***********          Z-ADDWORK6N    DPOD                            S01117
     C                     MOVEL@AENB     DPOD                            S01117
     C/COPY WNCPYSRC,SE0070C158
     C*
     C***********WORK6N    CHAINCLINTSEF             33                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @AENB                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         43
     C                     MOVEA' 206'    ERR,EC
     C                     ELSE
     C*
     C**with*a*discretionary*indicator*NE*to*'S',*'D'*or*'I'**********    S01176
     C* with Classification NE to 'S', 'D' or 'I'                         S01176
     C*
     C***********C1DI      IFEQ 'S'                                       S01117
     C***********C1DI      OREQ 'D'                                       S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C***********C1DI      OREQ 'I'                                       E21474
     C                     ADD  1         EC         43
     C                     MOVEA' 206'    ERR,EC
     C                     END
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,SE0070C159
     C                     ELSE
     C*
     C* No depot entered
     C*
     C**********           Z-ADD*ZEROS    DPOD                                                CSD027
     C                     MOVE *BLANKS   DPOD                                                CSD027
     C/COPY WNCPYSRC,SE0070C160
     C                     END
     C*
     C* Date Out
     C*
     C           SDPDO     IFNE *BLANKS
     C/COPY WNCPYSRC,SE0070C161
     C*
     C* allowed only if depot entered
     C*
     C           SDPOD     IFEQ *BLANKS
     C                     ADD  1         EC         44
     C                     MOVEA' 207'    ERR,EC
     C                     END
     C*
     C* must be a valid date (999999 allowed)
     C*
     C                     MOVE SDPDO     DATEN
     C                     MOVE DATEN     DATEA
     C           SDPDO     IFNE DATEA
     C                     ADD  1         EC         44
     C                     MOVEA' 208'    ERR,EC
     C                     ELSE
     C           SDPDO     IFEQ '999999'
     C                     MOVE SDPDO     DPDO
     C                     ELSE
     C                     MOVE SDPDO     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         44
     C                     MOVEA' 208'    ERR,EC
     C                     ELSE
     C                     Z-ADDZDAYNO    DPDO
     C*
     C* If In date not entered, must not be after run date
     C*    - and out date must be entered                                 E13658
     C*
     C           SDPMD     IFEQ *BLANKS
     C           DPDO      ANDGTRUND
     C                     ADD  1         EC         44
     C                     MOVEA' 209'    ERR,EC
     C                     END
     C*                                                                   S01158
     C* If Date out GT run date AND NE 99999 -                            S01158
     C*    then date out must be LE maturity date                         S01158
     C*                                                                   S01158
     C           DPDO      IFGT RUND                                      S01158
     C           DPDO      ANDNE99999                                     S01158
     C           DPDO      IFGT MATY                                      S01158
     C           MATY      ANDNE*ZEROS                                    E13821
     C                     ADD  1         EC         44                   S01158
     C***********          MOVEA' 231'    ERR,EC                          E16929
     C                     MOVEA' 229'    ERR,EC                          E16929
     C                     END                                            S01158
     C                     END                                            S01158
     C*                                                                   E15252
     C*     must fall within back value period on TABTB36                 E15252
     C*                                                                   E15252
     C********** RUND      SUB  BKVP      WBKVP                     E15252S01117
     C           RUND      SUB  BVBVP     WBKVP                           S01117
     C           DPDO      IFLT RUND                                      E15252
     C           DPDO      ANDLTWBKVP                                     E15252
     C                     ADD  1         EC         44                   E15252
     C                     MOVEA' 232'    ERR,EC                          E15252
     C                     END                                            E15252
     C*
     C* If In depot is Euroclear or Cedel, should not be a holiday in the
     C* clearing house currency
     C********WARNING*ERROR*ONLY*-*ACCEPT*IF*UNCHANGED*****************   S01158
     C***********                                                         S01158
     C***********DPDO      IFNE LDPDO                                     S01158
     C*
     C* Euroclear
     C*
     C********** C1DI      IFEQ 'E'                                       S01117
     C**********           MOVE ECYC      ZCCY                            S01117
     C           BFCLAS    IFEQ 'E'                                       S01117
     C                     MOVELBVEUCY    ZCCY                            S01117
     C                     MOVELDPDO      ZDAYNO                          S01117
     C                     MOVEL*BLANKS   ZLOC                            S01195
     C**********           EXSR ZDATE5                                    S01195
     C********** *IN99     IFEQ '1'                                       S01195
     C                     EXSR ZCHKH                                     S01195
     C/COPY WNCPYSRC,SE0070C029
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC         44
     C                     ADD  1         WEC                             S01158
     C                     MOVEA' W03'    ERR,EC
     C                     END
     C/COPY WNCPYSRC,SE0070C030
     C                     ELSE
     C*
     C* Cedel
     C*
     C********** C1DI      IFEQ 'C'                                       S01117
     C**********           MOVE CCYC      ZCCY                            S01117
     C           BFCLAS    IFEQ 'C'                                       S01117
     C                     MOVELBVCCCY    ZCCY                            S01117
     C                     MOVELDPDO      ZDAYNO                          S01117
     C                     MOVEL*BLANKS   ZLOC                            S01195
     C**********           EXSR ZDATE5                                    S01195
     C********** *IN99     IFEQ '1'                                       S01195
     C                     EXSR ZCHKH                                     S01195
     C/COPY WNCPYSRC,SE0070C031
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC         44
     C                     ADD  1         WEC                             S01158
     C                     MOVEA' W03'    ERR,EC
     C                     END
     C/COPY WNCPYSRC,SE0070C032
     C                     ELSE
     C*
     C* If In depot is not Euroclear or Cedel, should not be a holiday in
     C* nominal currency
     C*
     C                     MOVE NMCY      ZCCY
     C                     MOVELDPDO      ZDAYNO                          S01117
     C                     MOVEL*BLANKS   ZLOC                            S01195
     C**********           EXSR ZDATE5                                    S01195
     C********** *IN99     IFEQ '1'                                       S01195
     C                     EXSR ZCHKH                                     S01195
     C/COPY WNCPYSRC,SE0070C033
     C           ZIND      IFEQ 'H'                                       S01195
     C                     ADD  1         EC         44
     C                     ADD  1         WEC                             S01158
     C                     MOVEA' W04'    ERR,EC
     C                     END
     C/COPY WNCPYSRC,SE0070C034
     C                     END
     C                     END
     C*
     C                     Z-ADDDPDO      LDPDO
     C***********          END                                            S01158
     C*
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE0070C162
     C                     ELSE
     C*                                                                   E13658
     C* If no In depot, Out date can not be zero                          E13658
     C*                                                                   E13658
     C           SDPID     IFEQ *BLANKS                                   E13658
     C           SDPDO     ANDEQ*BLANKS                                   E13658
     C                     ADD  1         EC         44                   E13658
     C                     MOVEA' 209'    ERR,EC                          E13658
     C                     END                                            E13658
     C*
     C* No date entered
     C*
     C                     Z-ADD*ZEROS    DPDO
     C/COPY WNCPYSRC,SE0070C163
     C                     END
     C*
     C* Date In can not equal date Out
     C*
     C           SDPMD     IFEQ SDPDO
     C           SDPDO     ANDNE*BLANKS                                   E13658
     C                     ADD  1         EC
     C                     MOVEA' 210'    ERR,EC
     C                     SETON                     4244
     C                     END
     C*
     C* Depots can not both be same unless both dates have been entered
     C*
     C           SDPID     IFNE *BLANKS
     C           SDPOD     ANDNE*BLANKS
     C           SDPID     IFEQ SDPOD
     C           SDPMD     IFEQ *BLANKS
     C           SDPDO     OREQ *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 211'    ERR,EC
     C                     MOVEA'1111'    *IN,41
     C                     END
     C                     END
     C                     END
     C*
     C* Both In and Out dates cannot be blank if both depots have been
     C* entered
     C*
     C           SDPID     IFNE *BLANKS
     C           SDPOD     ANDNE*BLANKS
     C           SDPMD     ANDEQ*BLANKS
     C           SDPDO     ANDEQ*BLANKS
     C                     ADD  1         EC
     C***********          MOVE ' 229'    ERR,EC                          E16929
     C                     MOVE ' 210'    ERR,EC                          E16929
     C                     SETON                     4244
     C                     END
     C/COPY WNCPYSRC,SE0070C164
     C*
     C**  VALIDATE BOOKING BRANCH AND ORIGINATING BRANCH IF               S01117
     C**  MULTI-BRANCHING ON                                              S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C* Booking Branch code                                               S01117
     C*
     C***********SDPBC     IFNE '   '                                     S01117
     C           SDPBA     IFNE '   '                                     S01117
     C*
     C* must reference an active Branch code
     C*
     C***********          MOVE *BLANKS   KEY12A 12                       S01117
     C***********          MOVEL'10'      KEY12A                          S01117
     C***********          MOVE SDPBC     KEY12A                          S01117
     C***********KEY12A    CHAINTABLETRF             33                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SDPBA     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         45
     C*                                                                   S01117
     C**  INVALID BRANCH                                                  S01117
     C*                                                                   S01117
     C                     MOVEA' 212'    ERR,EC
     C                     END
     C*
     C*                                                                   S01117
     C***********          MOVE SDPBC     DPBC                            S01117
     C                     MOVE SDPBA     DPBA                            S01117
     C*
     C                     ELSE
     C*
     C* No branch entered
     C*  - Use default branch                                             S01117
     C*
     C***********          Z-ADDDSTB      DPBC                            S01117
     C                     MOVE USRBCH    DPBA                            S01117
     C*
     C* Fetch default Branch Internal Customer Number for default branch
     C*
     C***********          MOVE *BLANKS   KEY12A 12                       S01117
     C***********          MOVEL'10'      KEY12A                          S01117
     C***********          MOVE DPBC      KEY12A                          S01117
     C***********KEY12A    CHAINTABLETRF             33                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM DPBA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C                     END                                            S01117
     C*
     C**  Validate SPF - User's authority to booking branch               S01117
     C*
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM DPBA      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 308'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     SETON                     45                   S01117
     C                     END                                            S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 307'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     SETON                     45                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** Originating Branch Code, if used = 'Y'                           S01117
     C*                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C           SORBR     IFNE '   '                                     S01117
     C*                                                                   S01117
     C* must reference an active Branch code                              S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SORBR     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         54                   S01117
     C*                                                                   S01117
     C**  INVALID BRANCH                                                  S01117
     C*                                                                   S01117
     C                     MOVEA' 212'    ERR,EC                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE SORBR     ORBR                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* No Originating branch entered - Use booking branch                S01117
     C*                                                                   S01117
     C                     MOVE DPBA      ORBR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  Validate SPF - User's authority to originating branch           S01117
     C**  if originating branch/user validation is switched on            047428
     C*
     C           BKOBUV    IFEQ 'Y'                                       047428
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM ORBR      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 306'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     SETON                     54                   S01117
     C                     END                                            S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC                              S01117
     C                     MOVEA' 305'    ERR,EC                          S01117
     C                     MOVELHI        ERRMSG                          S01117
     C                     MOVEL*BLANK    AID                             S01117
     C                     SETON                     54                   S01117
     C                     END                                            S01117
     C                     END                                            047428
     C                     END                                            S01117
     C                     END                                            S01117
     C* Fetch default Branch Internal Customer Number for single branchh  E37203
     C*         environment                                               E37203
     C*                                                                   E37203
     C           MBIN      IFNE 'Y'                                       E37203
     C                     MOVE USRBCH    DPBA                            E37203
     C*                                                                   E37203
     C*                                                                   E37203
     C**********           CALL 'AOBRCHR0'                                             E37203 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       E37203
     C                     PARM '*KEY   ' @OPTN   7                       E37203
     C                     PARM DPBA      @DSNB   3                       E37203
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        E37203 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C                     END                                            E37203
     C*
     C* Book code
     C*
     C           SDPBK     IFNE '  '
     C*
     C* must reference an active Book code
     C*
     C********** SDPBK     CHAINBOOKDDF              33                   S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SDPBK     @BKEY   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C*                                                                   S01117
     C**N33***** RECI      COMP '*'                      33               S01117
     C********** *IN33     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         46
     C                     MOVEA' 213'    ERR,EC
     C                     END
     C*
     C                     MOVE SDPBK     DPBK
     C                     ELSE
     C*                                                                   E16334
     C* Must be entered for a depot transfer                              E16334
     C*                                                                   E16334
     C           SDPID     IFNE *BLANKS                                   E16334
     C           SDPOD     ANDNE*BLANKS                                   E16334
     C           SDPMD     ANDNE*BLANKS                                   E16334
     C           SDPDO     ANDEQ*BLANKS                                   E16334
     C                     ADD  1         EC         46                   E16334
     C                     MOVEA' 233'    ERR,EC                          E16334
     C                     ELSE                                           E16334
     C*                                                                   E16334
     C* No book code entered - default to Portfolio or Market book
     C*
     C***********SDPBN     CHAINSNAMEF               33                   S01117
     C                     MOVELSDPBN     @KEY1                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @KEY1  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C************IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          Z-ADDCNUM      WORK6N                          S01117
     C                     MOVELBBCUST    @AENB                           S01117
     C                     MOVELBBACOC    @ACOF                           176510
     C                     ELSE
     C***********          MOVELSDPBN     WORK6N                          S01117
     C                     MOVELSDPBN     @AENB                           S01117
     C                     END
     C*                                                                   E13797
     C* If amending or inserting DT entry, do not default Book Code       E13797
     C*                                                                   E13797
     C           ACTN      IFEQ 'A'                                       E13797
     C           DPMV      ANDEQ'DT'                                      E13797
     C           ACTN      OREQ 'I'                                       E13797
     C********** DPID      ANDNE*ZEROS                                                 E13797 CSD027
     C           DPID      ANDNE*BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    E13797
     C********** DPOD      ANDNE*ZEROS                                                 E13797 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDEQ*ZEROS                                    E13797
     C                     MOVE '  '      DPBK                            E13797
     C                     ELSE                                           E13797
     C*                                                                   E13797
     C* Fetch default Book Code for other movement types                  E13797
     C*                                                                   E13797
     C***********WORK6N    CHAINCLINTSEF             33                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********C1DI      IFEQ 'S'                                       S01117
     C***********C1DI      OREQ 'D'                                       S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C**********           MOVE DPFB      DPBK                            S01117
     C                     MOVELBVDPBC    DPBK                            S01117
     C                     ELSE
     C**********           MOVE DMKB      DPBK                            S01117
     C                     MOVELBVDMBC    DPBK                            S01117
     C                     END
     C                     ELSE
     C**********           MOVE DMKB      DPBK                            S01117
     C                     MOVELBVDMBC    DPBK                            S01117
     C                     END
     C*                                                                   E16334
     C                     END                                            E16334
     C*                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
      *                                                                                       CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.                        CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.                        CSE022
      *                                                                                       CSE022
     C                     MOVELBFNDR1    BFDRF1                                              CSE022
     C                     MOVELBFNDR2    BFDRF2                                              CSE022
     C                     MOVE BFDRF1    PC101                           S01401
     C                     MOVE BFDRF2    PC102                           S01401
     C                     END                                            S01401
     C*                                                                   S01401
     C                     END                                            E13797
     C                     END
     C*
     C* If amendment of DT entry, ignore default Beneficial Customer
     C*
     C           ACTN      IFEQ 'A'
     C           DPMV      ANDEQ'DT'
     C***********          MOVELSDPBN     WORK6N                          S01117
     C***********WORK6N    IFEQ BICN                                      S01117
     C***********          MOVELSDPBN     WRK6A                           S01117              CSD027
     C***********WRK6A     IFEQ A8BICN                                    S01117              CSD027
     C           SDPBN     IFEQ A8BICN                                    S01117              CSD027
     C                     MOVE *BLANKS   SDPBN
     C                     END
     C                     END
     C*
     C* Beneficial customer
     C*
     C           SDPBN     IFEQ *BLANKS
     C*
     C* mandatory entry unless both depots and date In (and not date Out)
     C* have been entered, then prohibited
     C*
     C           SDPID     IFEQ *BLANKS
     C           SDPOD     OREQ *BLANKS
     C           SDPMD     OREQ *BLANKS
     C                     ADD  1         EC         47
     C                     MOVEA' 214'    ERR,EC
     C                     ELSE
     C           SDPDO     IFNE *BLANKS
     C                     ADD  1         EC         47
     C                     MOVEA' 214'    ERR,EC
     C                     END
     C                     END
     C*
     C**********           Z-ADD*ZEROS    DPBN                                                CSD027
     C                     MOVE *BLANKS   DPBN                                                CSD027
     C*
     C* else if entered
     C*
     C                     ELSE
     C*
     C* check not prohibited
     C*
     C           SDPID     IFNE *BLANKS
     C           SDPOD     ANDNE*BLANKS
     C           SDPMD     ANDNE*BLANKS
     C           SDPDO     ANDEQ*BLANKS
     C                     ADD  1         EC         47
     C                     MOVEA' 214'    ERR,EC
     C                     END
     C*
     C**if*associated*deal*entered,*must*equal*customer*number********    S01176
     C***********                                                         S01176
     C***********SDPAD     IFNE *BLANKS                                   S01176
     C***********                                                         S01176
     C**Entry*only*allowed*if*dealing*module*present*******************   S01176
     C***********                                                         S01176
     C************INU2     IFEQ '1'                                       S01176
     C***********                                                         S01176
     C***********SDPBN     CHAINSNAMEF               33                   S01176
     C************IN33     IFEQ '0'                                       S01176
     C***********          Z-ADDCNUM      WORK6N                          S01176
     C***********          ELSE                                           S01176
     C***********          MOVELSDPBN     WORK6N                          S01176
     C***********          END                                            S01176
     C***********          Z-ADDWORK6N    DPBN                            S01176
     C***********          MOVE SDPAD     WK6N2   60                      S01176
     C***********WK6N2     CHAINDEALSDCF             33                   S01176
     C**N33******RECI      COMP '*'                      33               S01176
     C**N33******WORK6N    COMP CNUM                 3333                 S01176
     C************IN33     IFEQ '1'                                       S01176
     C***********          ADD  1         EC         47                   S01176
     C***********          MOVEA' 215'    ERR,EC                          S01176
     C***********          ADD  1         WEC                       S01176E13476
     C***********          MOVEA' W08'    ERR,EC                    S01176E13476
     C***********          END                                            S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**else*if*associated*deal*not*entered***************************    S01176
     C***********                                                         S01176
     C***********          ELSE                                           S01176
     C*
     C*      If associated deal not entered                               S01176
     C*
     C           SDPAD     IFEQ *BLANKS                                   S01176
     C*                                                                   S01176
     C* and if only one depot has been entered
     C*
     C                     SETOF                     33
     C           SDPID     IFNE *BLANKS
     C           SDPOD     ANDEQ*BLANKS
     C                     SETON                     33
     C                     ELSE
     C           SDPID     IFEQ *BLANKS
     C           SDPOD     ANDNE*BLANKS
     C                     SETON                     33
     C                     END
     C                     END
     C*
     C           *IN33     IFEQ '1'
     C*
     C* must reference a customer
     C*
     C***********SDPBN     CHAINSNAMEF               33                   S01117
     C                     MOVELSDPBN     @AENB   6                       S01117
     C**********           MOVELSDPBN     WRK6N   60                      S01117              CSD027
     C**********           MOVELWRK6N     WRK6A   6                       S01117              CSD027
     C********** SDPBN     IFNE WRK6A                                     S01117              CSD027
     C                     MOVELSDPBN     @KEY1                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @KEY1  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C************IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          Z-ADDCNUM      WORK6N  60                      S01117
     C                     MOVELBBCUST    @AENB                           S01117
     C**********           ELSE                                           S01117
     C***********          MOVELSDPBN     WORK6N                          S01117
     C                     END
     C**********           END                                            S01117              CSD027
     C*
     C***********WORK6N    CHAINCLINTSEF             33
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         47
     C                     MOVEA' 216'    ERR,EC
     C                     ELSE
     C***********          Z-ADDWORK6N    DPBN                            S01117
     C                     MOVELBFCUST    DPBN                            S01117
     C*
     C**with*a*discretionary*indicator*EQ*to*'S'*or*'D'***************    S01176
     C* with Classification EQ to 'S' or 'D'                              S01176
     C*
     C***********C1DI      IFNE 'S'                                       S01117
     C***********C1DI      ANDNE'D'                                       S01117
     C           BFCLAS    IFNE 'S'                                       S01117
     C           BFCLAS    ANDNE'D'                                       S01117
     C                     ADD  1         EC         47
     C                     MOVEA' 216'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
     C* if both depots entered
     C*
     C           SDPID     IFNE *BLANKS
     C           SDPOD     ANDNE*BLANKS
     C*
     C* must reference an active customer
     C*
     C***********SDPBN     CHAINSNAMEF               33                   S01117
     C                     MOVELSDPBN     @AENB                           S01117
     C***********          MOVELSDPBN     WRK6N                           S01117             CSD027
     C***********          MOVELWRK6N     WRK6A                           S01117             CSD027
     C***********SDPBN     IFNE WRK6A                                     S01117             CSD027
     C                     MOVELSDPBN     @KEY1                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @KEY1  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C************IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          Z-ADDCNUM      WORK6N                          S01117
     C                     MOVELBBCUST    @AENB                           S01117
     C**********           ELSE                                           S01117
     C***********          MOVELSDPBN     WORK6N                          S01117
     C                     END
     C***********          END                                            S01117              CSD027
     C***********WORK6N    CHAINCLINTSEF             33                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C**N33******RECI      COMP '*'                      33               S01117
     C************IN33     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         47
     C                     MOVEA' 217'    ERR,EC
     C                     END
     C***********          Z-ADDWORK6N    DPBN                            S01117
     C                     MOVELBFCUST    DPBN                            S01117
     C                     END
     C*                                                                   S01176
     C* Else Associated Deal has been entered                             S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C* must reference an active customer                                 S01176
     C*                                                                   S01176
     C***********SDPBN     CHAINSNAMEF               33            S01176 S01117
     C                     MOVELSDPBN     @AENB                           S01117
     C***********          MOVELSDPBN     WRK6N                           S01117              CSD027
     C***********          MOVELWRK6N     WRK6A                           S01117              CSD027
     C***********SDPBN     IFNE WRK6A                                     S01117              CSD027
     C                     MOVELSDPBN     @KEY1                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @KEY1  10                       S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C************IN33     IFEQ '0'                                S01176 S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C***********          Z-ADDCNUM      WORK6N                   S01176 S01117
     C                     MOVELBBCUST    @AENB                           S01117
     C**********           ELSE                                     S01176S01117
     C***********          MOVELSDPBN     WORK6N                   S01176 S01117
     C                     END                                            S01176
     C***********          END                                            S01117              CSD027
     C*                                                                   S01176
     C***********WORK6N    CHAINCLINTSEF             33            S01176 S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AENB   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C**N33******RECI      COMP '*'                      33        S01176 S01117
     C************IN33     IFEQ '1'                                S01176 S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         47                   S01176
     C                     MOVEA' 217'    ERR,EC                          S01176
     C                     END                                            S01176
     C***********          Z-ADDWORK6N    DPBN                     S01176 S01117
     C                     MOVELBFCUST    DPBN                            S01117
     C*
     C                     END
      *                                                                   CSE023
      ** If Walk-In and CSE023 is on.                                     CSE023
      *                                                                   CSE023
     C           SDPID     IFNE *BLANKS                                   CSE023
     C           SDPMD     ANDNE*BLANKS                                   CSE023
     C           SDPOD     ANDEQ*BLANKS                                   CSE023
     C           SDPDO     ANDEQ*BLANKS                                   CSE023
     C           CSE023    ANDEQ'Y'                                       CSE023
      *                                                                   CSE023
      ** If beneficiary customer has a classification type 'S' or 'D'.    CSE023
      *                                                                   CSE023
     C           BFCLAS    IFEQ 'S'                                       CSE023
     C           BFCLAS    OREQ 'D'                                       CSE023
      *                                                                   CSE023
      ** Chain to SECTYD using security shortname of the depot movement.  CSE023
      *                                                                   CSE023
     C           DPSS      CHAINSECTYDF              99                   CSE023
      *                                                                   CSE023
      ** If country of tax treaty is not blank.                           CSE023
      *                                                                   CSE023
     C           CRTT      IFNE *BLANKS                                   CSE023
      *                                                                   CSE023
      ** Get customer no. in case customer shortname was used in          CSE023
      ** beneficiary customer.                                            CSE023
      *                                                                   CSE023
     C                     CALL 'AOCUSTR0'                                CSE023
     C                     PARM *BLANKS   @RTCD                           CSE023
     C                     PARM '*KEY   ' @OPTN                           CSE023
     C                     PARM SDPBN     @KEY1                           CSE023
     C                     PARM *BLANKS   @KYST                           CSE023
     C           SDCUST    PARM SDCUST    DSSDY                           CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANKS                                   CSE023
     C                     MOVE BBCUST    SCUST   6                       CSE023
     C                     ELSE                                           CSE023
      *                                                                   CSE023
      ** Database error                                                   CSE023
      *                                                                   CSE023
     C           *LOCK     IN   LDA                                       CSE023
     C                     MOVEL'SDCUSTPD'DBFILE                          CSE023
     C                     MOVELSDPBN     DBKEY                           CSE023
     C                     Z-ADD28        DBASE                           CSE023
     C                     OUT  LDA                                       CSE023
     C                     MOVE *ON       *INU7                           CSE023
     C                     MOVE *ON       *INU8                           CSE023
     C                     MOVE *ON       *INLR                           CSE023
     C                     EXSR *PSSR                                     CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** Chain to SDWTCSL1 using beneficiary customer and country of      CSE023
      ** tax treaty.                                                      CSE023
      *                                                                   CSE023
     C           TAXDET    CHAINSDWTCSL1             99                   CSE023
      *                                                                   CSE023
     C********** *IN99     IFEQ *OFF                               CSE023 186103
      **********                                                   CSE023 186103
      ***If*'backup*withholding*applicable'*is*'Y',*issue*a*warnin CSE023 186103
      **********                                                   CSE023 186103
     C********** WHBCWA    IFEQ 'Y'                                CSE023 186103
      *                                                                   186103
      ** If backup withholding is 'Y' or record not found, issue          186103
      ** warning message                                                  186103
      *                                                                   186103
     C           *IN99     IFEQ *ON                                       186103
     C           WHBCWA    OREQ 'Y'                                       186103
     C                     MOVE *ON       *IN47                           CSE023
     C                     ADD  1         EC                              CSE023
     C                     ADD  1         WEC                             CSE023
     C                     MOVEA' W13'    ERR,EC                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   186103
      ** If documentation received is 'N' or record not found, issue      186103
      ** warning message                                                  186103
      *                                                                   186103
     C           *IN99     IFEQ *ON                                       186103
     C           WHDCRC    OREQ 'N'                                       186103
     C                     MOVE *ON       *IN47                           186103
     C                     ADD  1         EC                              186103
     C                     ADD  1         WEC                             186103
     C                     MOVEA' W14'    ERR,EC                          186103
     C                     ENDIF                                          186103
      **********                                                   CSE023 186103
     C**********           ENDIF                                   CSE023 186103
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     END
     C*
     C           S01401    IFEQ 'Y'                                       046800
      *                                                                                       CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.                        CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.                        CSE022
      *                                                                                       CSE022
     C                     MOVELBFNDR1    BFDRF1                                              CSE022
     C                     MOVELBFNDR2    BFDRF2                                              CSE022
     C                     MOVE BFDRF1    PC101                           046800
     C                     MOVE BFDRF2    PC102                           046800
     C                     END                                            046800
     C*                                                                   046800
     C* Nominal amount - mandatory entry
     C*
     C           SDPNA     IFEQ *BLANKS
     C                     ADD  1         EC         48
     C                     MOVEA' 218'    ERR,EC
     C                     ELSE
     C*
     C* check valid number entered
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDPNA     ZFIELD
     C           DPSS      CHAINSECTYDF              33
     C                     Z-ADDNMDP      ZADEC
     C           11        SUB  NMDP      ZADIG
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         48
     C                     MOVEA' 218'    ERR,EC
     C                     Z-ADD*ZEROS    DPNA
     C                     ELSE
     C                     MOVE ZFIELD    DPNA
      *
     C           DPNA      IFEQ *ZEROS
     C                     ADD  1         EC         48
     C                     MOVEA' 218'    ERR,EC
     C                     END
     C*
     C* must be multiple of stock denomination (if entered)
     C*
     C           SDNM      IFNE *ZEROS
     C                     MOVE ZFIELD    WK11N  110
     C                     Z-ADD1         FACTOR 100
      *
     C                     DO   NMDP
     C           FACTOR    MULT 10        FACTOR
     C                     END
      *
     C           WK11N     DIV  FACTOR    WK158N 158
     C           WK158N    DIV  SDNM      WK11N2 110
     C                     MVR            WK147N 147
      *
     C           WK147N    IFNE *ZEROS
     C                     ADD  1         EC         48
     C/COPY WNCPYSRC,SE0070C044
     C           CSE007    IFEQ 'N'                                       CSE007
     C           CEU017    ANDEQ'N'                                       CEU017
     C                     MOVEA' 219'    ERR,EC
     C/COPY WNCPYSRC,SE0070C045
     C                     ELSE                                           CSE007
     C                     ADD  1         WEC                             CSE007
     C                     MOVEA' W18'    ERR,EC                          CSE007
     C                     ENDIF                                          CSE007
     C                     END
     C                     END
     C                     END
     C*
     C                     END
     C*
     C* Narrative - No validation
     C/COPY WNCPYSRC,SE0070C147
     C*
     C                     MOVE SDPNR     DPNR
     C/COPY WNCPYSRC,SE0070C259
     C** Get Depot Value date into WWDPWD                                 139054
     C*                                                                   139054
     C           DPMD      IFEQ 0                                         139054
     C                     MOVE DPDO      WWDPVD  50                      139054
     C                     ELSE                                           139054
     C           DPDO      IFEQ 0                                         139054
     C                     MOVE DPMD      WWDPVD                          139054
     C                     ELSE                                           139054
     C           DPMD      IFGT DPDO                                      139054
     C                     MOVE DPDO      WWDPVD                          139054
     C                     ELSE                                           139054
     C                     MOVE DPMD      WWDPVD                          139054
     C                     END                                            139054
     C                     END                                            139054
     C                     END                                            139054
     C*                                                                   139054
     C** Obtain Market Price                                              139054
     C*                                                                   139054
     C                     MOVE SESN      WWPSSN                          139054
     C                     Z-ADDWWDPVD    WWTDDT                          139054
     C                     EXSR SR70XA                                    139054
     C*                                                                   139054
     C           RES70X    IFEQ 'Y'                                       139054
     C                     Z-ADDWWPPRC    MKPR                            139054
     C                     ENDIF                                          139054
     C*                                                                   139054
     C/COPY WNCPYSRC,SE0070C148
     C*
     C* Market price
     C*
     C           SDPMP     IFNE *BLANKS
     C*
     C* Check valid number entered
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SDPMP     ZFIELD
     C                     ELSE                                           E16929
     C                     MOVE *BLANKS   ZFIELD                          E16929
     C                     MOVE MKPR      ZFIELD                          E16929
     C                     Z-ADD8         ZADEC                           E16929
     C                     EXSR ZEDIT                                     E16929
     C                     MOVE ZFIELD    SDPMP                           E16929
     C                     MOVE 'Y'       FIRST                           E16929
     C                     END                                            E16929
      *
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         49
     C                     MOVEA' 220'    ERR,EC
     C                     Z-ADD*ZEROS    MKTP
     C                     ELSE
     C                     MOVE ZFIELD    MKTP
     C*
     C           S01496    IFNE 'Y'                                       S01496
     C* Check entry is within 10% of current market price
     C********WARNING*ERROR*ONLY*-*ACCEPT*IF*UNCHANGED*****************   S01158
     C***********                                                         S01158
     C***********MKTP      IFNE HMKTP                                     S01158
     C           MKPR      DIV  10        WK158  158H
     C           MKPR      ADD  WK158     MKPRP
     C           MKPR      SUB  WK158     MKPRL
      *
     C           MKTP      IFGT MKPRP
     C/COPY WNCPYSRC,SE0070C103
     C                     ADD  1         EC         49
     C                     ADD  1         WEC                             S01158
     C                     MOVEA' W05'    ERR,EC
     C/COPY WNCPYSRC,SE0070C104
     C                     ELSE
      *
     C           MKTP      IFLT MKPRL
     C/COPY WNCPYSRC,SE0070C105
     C                     ADD  1         EC         49
     C                     ADD  1         WEC                             S01158
     C                     MOVEA' W05'    ERR,EC
     C/COPY WNCPYSRC,SE0070C106
     C                     END
      *
     C                     END
     C                     Z-ADDMKTP      HMKTP
     C***********          END                                            S01158
     C                     ELSE                                           S01496
     C**Check entry is within price tolerance of market price             S01496
     C*                                                                   S01496
     C****....*get*depot*value*date*into*WWDPWD                    S01496 139054
     C***********DPMD      IFEQ 0                                  S01496 139054
     C***********          MOVE DPDO      WWDPVD  50               S01496 139054
     C***********          ELSE                                    S01496 139054
     C***********DPDO      IFEQ 0                                  S01496 139054
     C***********          MOVE DPMD      WWDPVD                   S01496 139054
     C***********          ELSE                                    S01496 139054
     C***********DPMD      IFGT DPDO                               S01496 139054
     C***********          MOVE DPDO      WWDPVD                   S01496 139054
     C***********          ELSE                                    S01496 139054
     C***********          MOVE DPMD      WWDPVD                   S01496 139054
     C***********          END                                     S01496 139054
     C***********          END                                     S01496 139054
     C***********          END                                     S01496 139054
     C***********                                                  S01496 139054
     C***OBTAIN*AND*CONVERT*MARKET*PRICE*(RESULT*KEPT*IN*CKPRIC)   S01496 139054
     C***********          MOVE SESN      WWPSSN                   S01496 139054
     C***********          Z-ADDWWDPVD    WWTDDT                   S01496 139054
     C***********          EXSR SR70XA                             S01496 139054
     C***********                                                  S01496 173318
     C***OBTAIN*AND*CONVERT*MARKET*PRICE*(RESULT*KEPT*IN*CKPRIC)   S01496 173318
     C***********          MOVE SESN      WWPSSN                   S01496 173318
     C***********          Z-ADDWWDPVD    WWTDDT                   S01496 173318
     C***********          EXSR SR70XA                             S01496 173318
     C*                                                                   S01496
     C** IF PRICE FOUND IN SR70XA   USE THIS PRICE                        S01496
     C           RES70X    IFEQ 'Y'                                       S01496
     C                     Z-ADDWWPPRC    WXPRIC 158                      S01496
     C                     ELSE                                           S01496
     C                     Z-ADDMKPR      WXPRIC                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C** IF TRADE BASIS DISOCUNT OR YIELD CONVERT TO PERCENTAGE PRICE     S01496
     C** FOR CHECKING                                                     S01496
     C           STBS      IFEQ 'D'                                       S01496
     C           STBS      OREQ 'Y'                                       S01496
     C                     MOVE WXPRIC    ZPRCIN                          S01496
     C                     MOVE WWDPVD    ZFDATE                          S01496
     C                     EXSR ZPRCI                                     S01496
     C                     MOVE ZPRCOT    CKPRIC 158                      S01496
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C                     Z-ADDWXPRIC    CKPRIC                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C** OBTAIN PRICE TOLERANCE LIMIT FROM INVTP                          S01496
     C           INVKA     CHAININVTPDF              33                   S01496
     C           *IN33     IFEQ '1'                                       S01496
     C           RECI      OREQ '*'                                       S01496
     C           PRTO      OREQ 0                                         S01496
     C                     Z-ADD10        PRTO                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C** IF TOLERANCE WAS NOT ENTERED, USE 10%                            S01496
     C           PRTO      IFEQ 0                                         S01496
     C                     Z-ADD10        PRTO                            S01496
     C                     END                                            S01496
      **   ....  check for % tolerance interval (PRTO)                    S01496
     C           PRTO      DIV  100       APWRK1 158                      S01496
     C           CKPRIC    MULT APWRK1    APWRK1                          S01496
     C           CKPRIC    ADD  APWRK1    APWRK2 158                      S01496
     C           MKTP      IFGT APWRK2                                    S01496
     C/COPY WNCPYSRC,SE0070C107
     C                     ADD  1         EC         49                   S01496
     C                     ADD  1         WEC                             S01496
     C                     MOVEA' W05'    ERR,EC                          S01496
     C/COPY WNCPYSRC,SE0070C108
     C                     ELSE                                           S01496
      *                                                                   S01496
     C           CKPRIC    SUB  APWRK1    APWRK2                          S01496
     C           MKTP      IFLT APWRK2                                    S01496
     C/COPY WNCPYSRC,SE0070C109
     C                     ADD  1         EC         49                   S01496
     C                     ADD  1         WEC                             S01496
     C                     MOVEA' W05'    ERR,EC                          S01496
     C/COPY WNCPYSRC,SE0070C110
     C                     END                                            S01496
     C                     END                                            S01496
     C**                                                                  S01496
     C                     END                                            S01496
     C*
     C                     END
     C***********          ELSE                                           E16929
     C***********                                                         E16929
     C**No*price*entered***********************************************   E16929
     C***********                                                         E16929
     C***********          Z-ADD*ZEROS    MKTP                            E16929
     C***********          END                                            E16929
     C***********                                                         E16929
     C**Associated*deal************************************************   S01176
     C***********                                                         S01176
     C***********SDPAD     IFNE *BLANKS                                   S01176
     C***********          MOVE SDPAD     DPAD                            S01176
     C***********                                                         S01176
     C**Entry*not*allowed*if*Deals*module*not*present******************   S01176
     C***********                                                         S01176
     C************INU2     IFEQ '0'                                       S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          MOVEA' 228'    ERR,EC                          S01176
     C***********          ELSE                                           S01176
     C***********                                                         S01176
     C**Must*reference*an*active*deal*with*Repo*indicator*'Y'*and*same*   S01176
     C**depot*reference************************************************   S01176
     C***********                                                         S01176
     C***********          MOVE DPAD      WORK6N                          S01176
     C***********WORK6N    CHAINDEALSDCF             33                   S01176
     C***********DPAD      CHAINDEALSDCF             33                   S01176
     C**N33******RECI      COMP '*'                      33               S01176
     C**N33******DRID      COMP 'Y'                  3333                 S01176
     C**N33******          MOVE DDMR      WORK6A  6                       S01176
     C**N33******DPRN      COMP WORK6A               3333                 S01176
     C************IN33     IFEQ '1'                                       S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          MOVEA' 221'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**both*depots*and*both*dates*must*be*entered*********************   S01176
     C***********                                                         S01176
     C***********SDPID     IFEQ *BLANKS                                   S01176
     C***********SDPMD     OREQ *BLANKS                                   S01176
     C***********SDPOD     OREQ *BLANKS                                   S01176
     C***********SDPDO     OREQ *BLANKS                                   S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          MOVEA' 222'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**if*date*In*is*before*date*Out,*deal*type*must*be*'IP'**********   S01176
     C***********                                                         S01176
     C***********DPMD      IFLT DPDO                                      S01176
     C***********DTYP      ANDNE'IP'                                      S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          MOVEA' 223'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**If*date*In*after*date*Out,*deal*type*must*be*'IT'**************   S01176
     C***********                                                         S01176
     C***********DPMD      IFGT DPDO                                      S01176
     C***********DTYP      ANDNE'IT'                                      S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          MOVEA' 224'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**Branch*code*must*be*same*as*deal*******************************   S01176
     C***********                                                         S01176
     C***********DPBC      IFNE BRCD                                      S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          MOVEA' 225'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**The*later*of*date*In/Out*must*not*be*after*maturity*date*******   S01176
     C***********                                                         S01176
     C***********          Z-ADDDPMD      LATERD  50                      S01176
     C***********DPDO      IFGT LATERD                                    S01176
     C***********          Z-ADDDPDO      LATERD                          S01176
     C***********          END                                            S01176
     C***********LATERD    IFGT MATY                                      S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          MOVEA' 226'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**Dates*In*and*Out*must*match*value*and*maturity*(if*present)*dates S01176
     C***i.e.*Earlier*=*Value*date,*Later*=*Maturity*date**************   S01176
     C***********                                                         S01176
     C***********DPMD      IFNE HDPMD                                     S01176
     C***********DPDO      ORNE HDPDO                                     S01176
     C***********DPAD      ORNE HDPAD                                     S01176
     C***********                                                         S01176
     C**Fetch*earliest*************************************************   S01176
     C***********                                                         S01176
     C***********          Z-ADDDPMD      EDAYNO  50                      S01176
     C***********DPDO      IFLT EDAYNO                                    S01176
     C***********          Z-ADDDPDO      EDAYNO                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**and*latest*****************************************************   S01176
     C***********                                                         S01176
     C***********          Z-ADDDPMD      LDAYNO  50                      S01176
     C***********DPDO      IFGT LDAYNO                                    S01176
     C***********          Z-ADDDPDO      LDAYNO                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C***********EDAYNO    IFNE VDAT                                      S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          ADD  1         WEC                             S01176
     C***********          MOVEA' W06'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C***********MDAT      IFNE *ZEROS                                    S01176
     C***********LDAYNO    ANDNEMDAT                                      S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          ADD  1         WEC                             S01176
     C***********          MOVEA' W06'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C***********          Z-ADDDPMD      HDPMD                           S01176
     C***********          Z-ADDDPDO      HDPDO                           S01176
     C***********          Z-ADDDPAD      HDPAD                           S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**Check*the*collateral*value*is*not*less*than*the*deal's*principal  S01176
     C***********                                                         S01176
     C***********LDPAD     IFNE DPAD                                      S01176
     C***********LDPNA     ORNE DPNA                                      S01176
     C***********                                                         S01176
     C**Access*investment*type*file*for*collateral*margin**************   S01176
     C***********                                                         S01176
     C***********INVKA     CHAININVTPDF              33                   S01176
     C***********                                                         S01176
     C**Setup*input*fields*********************************************   S01176
     C***********                                                         S01176
     C***********          MOVE DPNA      ZNOML                           S01176
     C***********          Z-ADDNMDP      ZNMDP                           S01176
     C***********          Z-ADDMKTP      ZPRCE                           S01176
     C***********          MOVE SPBS      ZPRCB                           S01176
     C***********          MOVE STBS      ZTRDB                           S01176
     C***********          Z-ADDCMGN      ZCLMG                           S01176
     C***********          Z-ADDCCCV      ZCLCC                           S01176
     C***********          MOVE NMCY      ZNMCY                           S01176
     C***********          MOVE *BLANKS   ZCLCY                           S01176
     C***********CCY       IFNE NMCY                                      S01176
     C***********          MOVE CCY       ZCLCY                           S01176
     C***********          END                                            S01176
     C***********          Z-ADDCFCT      ZCFCT                           S01176
     C***********                                                         S01176
     C***********          EXSR ZCOLLV                                    S01176
     C***********                                                         S01176
     C**Check*for*database*error***************************************   S01176
     C***********                                                         S01176
     C***U7*U8***          DO                              ***************S01176
     C***********          MOVEL'04'      DBASE            **DB ERROR 04**S01176
     C***********          MOVEL'TABLE'   DBFILE           ***************S01176
     C***********          MOVEL'ZCOLLV'  ZTABKY                          S01176
     C***********          MOVELZTABKY    DBKEY                           S01176
     C***********          SETON                     LR                   S01176
     C***********          RETRN                                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**Compare*values*************************************************   S01176
     C***********                                                         S01176
     C***********ZCLVL     IFGE PCPL                                      S01176
     C***********          ADD  1         EC         50                   S01176
     C***********          ADD  1         WEC                             S01176
     C***********          MOVEA' W07'    ERR,EC                          S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C***********          Z-ADDDPAD      LDPAD                           S01176
     C***********          Z-ADDDPNA      LDPNA                           S01176
     C***********          END                                            S01176
     C***********          END                                            S01176
     C***********          ELSE                                           S01176
     C***********                                                         S01176
     C**No*associated*deal*entered*************************************   S01176
     C***********                                                         S01176
     C***********          Z-ADD*ZEROS    DPAD                            S01176
     C***********          END                                            S01176
     C*                                                                   S01176
     C*  Validation for Repo/Pledge Indicator, Associated Deal Number,    S01176
     C*  Switch Reference and Switch In/Out Indicator is required only    S01176
     C*  when Dealing module is present.                                  S01176
     C*                                                                   S01176
      ***  START U2 ON (Dealing)                                          S01176
      *                                                                   S01176
     C           *INU2     IFEQ '1'                                       S01176
     C*                                                                   S01176
     C*  Repo/Pledge Indicator                                            S01176
     C*                                                                   S01176
     C*  If entered must be 'R' or 'P'.                                   S01176
     C*                                                                   S01176
     C           SRPIN     IFNE *BLANKS                                   S01176
     C           SRPIN     COMP 'P'                      33               S01176
     C/COPY WNCPYSRC,SE0070C165
     C  N33      SRPIN     COMP 'R'                      33               S01176
     C/COPY WNCPYSRC,SE0070C166
     C  N33                ADD  1         EC         50                   S01176
     C  N33                MOVEA' 221'    ERR,EC                          S01176
     C*                                                                   E16929
     C                     MOVELSRPIN     RPIN                            E16929
     C*                                                                   S01176
     C*  If entered, both dates and both depots must be entered.          S01176
     C*                                                                   S01176
     C           SDPID     IFEQ *BLANKS                                   S01176
     C           SDPMD     OREQ *BLANKS                                   S01176
     C           SDPOD     OREQ *BLANKS                                   S01176
     C           SDPDO     OREQ *BLANKS                                   S01176
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 222'    ERR,EC                          S01176
     C                     END                                            S01176
     C/COPY WNCPYSRC,SE0070C167
     C                     END                                            S01176
     C*                                                                   S01176
     C*  Associated Deal Number                                           S01176
     C*                                                                   S01176
     C*  must be entered if Repo/Pledge Indicator = 'P' or 'R'            S01176
     C*                                                                   S01176
     C           SRPIN     IFEQ 'P'                                       S01176
     C           SRPIN     OREQ 'R'                                       S01176
     C           SDPAD     IFEQ *BLANKS                                   S01176
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 223'    ERR,EC                          S01176
     C                     END                                            S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C*  the Deal number must be blank if the Repo/Pledge Indicator       S01176
     C*    is blank.                                                      S01176
     C*                                                                   S01176
     C           SDPAD     IFNE *BLANKS                                   S01176
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 224'    ERR,EC                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           SDPAD     IFNE *BLANKS                                   S01176
     C                     MOVE SDPAD     DPAD                            S01176
     C*                                                                   S01176
     C*  If entered, it must reference an active deal on PF/DEALSDC       S01176
     C*  with R/P Indicator = R/P Indicator on this depot movement &      S01176
     C*  if R/P number on deal is non-zero it must equal Depot            S01176
     C*  Movement Reference on this depot movement                        S01176
     C*  WHEN THE SWITCH REFERENCE IS BLANK                               E16929
     C*                                                                   S01176
     C/COPY WNCPYSRC,SE0070C035
     C           DPAD      CHAINDEALSDCF             33                   S01176
     C  N33      RECI      COMP '*'                      33               S01176
     C  N33      DRID      COMP SRPIN                3333                 S01176
     C  N33      DDMR      IFNE *BLANKS                                   S01176
     C           SSWRF     ANDEQ*BLANKS                                   E16929
     C  N33                MOVE DDMR      WORK6A  6                       S01176
     C  N33      DPRN      COMP WORK6A               3333                 S01176
     C                     END                                            S01176
     C           *IN33     IFEQ '1'                                       S01176
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 225'    ERR,EC                          S01176
     C                     END                                            S01176
     C/COPY WNCPYSRC,SE0070C036
     C*                                                                   S01176
     C*  If the Date In is less than the Date Out, the Deal type must     S01176
     C*  equal IP, TI, or CL.                                             E23534
     C***equal*IP***************************************************S01176E23534
     C*                                                                   S01176
     C           DPMD      IFLT DPDO                                      S01176
     C           DTYP      ANDNE'IP'                                      S01176
     C           DTYP      ANDNE'TI'                                      E16929
     C           DTYP      ANDNE'CL'                                      E16929
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 226'    ERR,EC                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C*  If the Date In is greater than the Date Out, the Deal type       S01176
     C*  must equal IT.                                                   S01176
     C*                                                                   S01176
     C           DPMD      IFGT DPDO                                      S01176
     C           DTYP      ANDNE'IT'                                      S01176
     C           DTYP      ANDNE'TD'                                      E16929
     C           DTYP      ANDNE'CD'                                      E16929
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 227'    ERR,EC                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Branch code must be same as deal                                  S01176
     C*                                                                   S01176
     C***********DPBC      IFNE BRCD                                      S01176
     C           DPBA      IFNE BRCA                               S01176 S01117
     C                     ADD  1         EC         50                   S01117
     C                     MOVEA' 228'    ERR,EC                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* The later of date In/Out must not be after maturity date of       S01176
     C*  the Security                                                     S01176
     C*                                                                   S01176
     C                     Z-ADDDPMD      LATERD  50                      S01176
     C           DPDO      IFGT LATERD                                    S01176
     C                     Z-ADDDPDO      LATERD                          S01176
     C                     END                                            S01176
     C           LATERD    IFGT MATY                                      S01176
     C           LATERD    ANDNE99999                                     E16929
     C           MATY      ANDNE0                                         055962
     C***********          ADD  1         EC         50         S01176    E16929
     C                     ADD  1         EC                              E16929
     C                     SETON                     4244                 E16929
     C                     MOVEA' 229'    ERR,EC                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Beneficiary customer does not match the deal customer.            S01176
     C*                                                                   S01176
     C           DPBN      IFNE CNUM                                      S01176
     C/COPY WNCPYSRC,SE0070C111
     C                     ADD  1         EC         50                   S01176
     C                     ADD  1         WEC        50                   S01176
     C                     MOVEA' W06'    ERR,EC                          S01176
     C/COPY WNCPYSRC,SE0070C112
     C                     END                                            S01176
     C*                                                                   S01176
     C* Dates In and Out must match value and maturity (if present) dates S01176
     C*  i.e. Earlier = Value date, Later = Maturity date                 S01176
     C*                                                                   S01176
     C* Fetch earliest                                                    S01176
     C*                                                                   S01176
     C                     Z-ADDDPMD      EDAYNO  50                      S01176
     C           DPDO      IFLT EDAYNO                                    S01176
     C                     Z-ADDDPDO      EDAYNO                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* and latest                                                        S01176
     C*                                                                   S01176
     C                     Z-ADDDPMD      LDAYNO  50                      S01176
     C           DPDO      IFGT LDAYNO                                    S01176
     C                     Z-ADDDPDO      LDAYNO                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C/COPY WNCPYSRC,SE0070C037
     C           EDAYNO    IFNE VDAT                                      S01176
     C/COPY WNCPYSRC,SE0070C113
     C                     ADD  1         EC         50                   S01176
     C                     ADD  1         WEC                             S01176
     C***********          MOVEA' W06'    ERR,EC                S01176    E16929
     C                     MOVEA' W07'    ERR,EC                          E16929
     C/COPY WNCPYSRC,SE0070C114
     C                     END                                            S01176
     C*                                                                   S01176
     C           MDAT      IFNE *ZEROS                                    S01176
     C           LDAYNO    ANDNEMDAT                                      S01176
     C           LDAYNO    ANDNE99999                                     E16929
     C/COPY WNCPYSRC,SE0070C115
     C                     ADD  1         EC         50                   S01176
     C                     ADD  1         WEC                             S01176
     C*********************MOVEA' W07'    ERR,EC                    S01176E23534
     C                     MOVEA' W09'    ERR,EC                          E23534
     C/COPY WNCPYSRC,SE0070C116
     C                     END                                            S01176
     C*                                                                   S01176
     C                     Z-ADDDPMD      HDPMD                           S01176
     C                     Z-ADDDPDO      HDPDO                           S01176
     C                     Z-ADDDPAD      HDPAD                           S01176
     C*                                                                   S01176
     C* Check the collateral value is not less than the deal's principal  S01176
     C*                                                                   S01176
     C* Access investment type file for collateral margin                 S01176
     C*                                                                   S01176
     C           INVKA     CHAININVTPDF              33                   S01176
     C*                                                                   S01176
     C* Setup input fields                                                S01176
     C*                                                                   S01176
     C                     MOVE DPNA      ZNOML                           S01176
     C                     Z-ADDNMDP      ZNMDP                           S01176
     C                     Z-ADDMKTP      ZPRCE                           S01176
     C                     MOVE SPBS      ZPRCB                           S01176
     C                     MOVE STBS      ZTRDB                           S01176
     C                     Z-ADDCMGN      ZCLMG                           S01176
     C**********           Z-ADDCCCV      ZCLCC                     S01176S01117
     C                     Z-ADDBVCCYC    ZCLCC                           S01117
     C                     MOVE NMCY      ZNMCY                           S01176
     C                     MOVE *BLANKS   ZCLCY                           S01176
     C           CCY       IFNE NMCY                                      S01176
     C                     MOVE CCY       ZCLCY                           S01176
     C                     END                                            S01176
     C                     Z-ADDCFCT      ZCFCT                           S01176
     C                     Z-ADDBJDNWD    ZZDNWD                          S01117
     C                     Z-ADDBKAPDT    ZZAPDT                          S01117
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C*                                                                   S01176
     C                     EXSR ZCOLLV                                    S01176
     C*                                                                   S01176
     C* Check for database error                                          S01176
     C*                                                                   S01176
     C   U7 U8             DO                              ROR*04**S01176 E20651
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'04'      DBASE            ********S01176 E20651
     C**********           MOVEL'10'      DBASE      * DB ERROR 10 *E20651S01117
     C                     Z-ADD10        DBASE            * DB ERROR 10 *S01117
     C**********           MOVEL'TABLE'   DBFILE           *********S01176S01117
     C**********           MOVEL'ZCOLLV'  ZTABKY                    S01176S01117
     C**********           MOVELZTABKY    DBKEY                     S01176S01117
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01117
     C                     MOVELZNMCY     DBKEY                           S01117
     C                     MOVE ZCLCY     DBKEY                           S01117
     C                     OUT  LDA                                       S01117
     C                     SETON                     LR                   S01176
     C                     RETRN                                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Compare values                                                    S01176
     C*                                                                   S01176
     C***********ZCLVL     IFGE PCPL                            S01176    E16929
     C           ZCLVL     IFLT PCPL                            S01176    E16929
     C/COPY WNCPYSRC,SE0070C117
     C                     ADD  1         EC         50                   S01176
     C                     ADD  1         WEC                             S01176
     C                     MOVEA' W08'    ERR,EC                          S01176
     C/COPY WNCPYSRC,SE0070C118
     C                     END                                            S01176
     C*                                                                   S01176
     C/COPY WNCPYSRC,SE0070C262
     C                     Z-ADDDPAD      LDPAD                           S01176
     C                     Z-ADDDPNA      LDPNA                           S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C* No associated deal entered                                        S01176
     C*                                                                   S01176
     C                     Z-ADD*ZEROS    DPAD                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Switch Reference                                                  S01176
     C*                                                                   S01176
     C*  A Switch Reference can only be entered if                        S01176
     C*  the Repo/Pledge Indicator = 'P' or 'R'                           S01176
     C*                                                                   S01176
     C           SRPIN     IFNE 'P'                                       S01176
     C           SRPIN     ANDNE'R'                                       S01176
     C           SSWRF     ANDNE*BLANKS                                   S01176
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 230'    ERR,EC                          S01176
     C                     ELSE                                           S01176
     C                     MOVE SSWRF     SWRF                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Switch In/Out Indicator                                           S01176
     C*                                                                   S01176
     C*  Can only be input if the Switch Reference is input, when it      S01176
     C*  must = I or O, else it must be blank.                            S01176
     C*                                                                   S01176
     C                     MOVE SSIOI     SIOI                            S01176
     C           SSWRF     IFNE *BLANKS                                   S01176
     C           SSIOI     ANDNE'I'                                       S01176
     C           SSIOI     ANDNE'O'                                       S01176
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 231'    ERR,EC                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           SSWRF     IFEQ *BLANKS                                   S01176
     C           SSIOI     ANDNE' '                                       S01176
     C                     ADD  1         EC         50                   S01176
     C                     MOVEA' 231'    ERR,EC                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
      ***  End of U2 ON (Dealing)                                         S01176
     C                     END                                            S01176
     C**                                                                  S01486
     C                     MOVEL'N'       WWPLCS                          CPB001
     C                     MOVEL'N'       WWPBCS                          CPB001
     C           *INU4     IFEQ '1'                                       S01486
     C*                                                                   S01486
     C** V A L I D A T E   P O R T F O L I O   R E F E R E N C E          S01486
     C*                                                                   S01486
     C** Movement type is neither 'WI' nor 'WO': SPTFR must be blank      S01486
     C*                                                                   S01486
     C/COPY WNCPYSRC,SE0070C038
     C           SDPID     IFNE *BLANKS                                   S01486
     C           SDPOD     ANDNE*BLANKS                                   S01486
     C*                                                                   S01486
     C           SPTFR     IFNE *BLANKS                                   S01486
     C                     MOVE '1'       *IN56                           S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 235'    ERR,EC                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C                     MOVE DPBN      CNUMA   6                       S01486
     C********** CNUMA     CHAINSDPLCSPD             86                   S01486
     C                     MOVELDPBN      WWCLIN 10                       S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM '*MSG    'WWRTCD  7                       S01486
     C                     PARM '*KEY    'WWOPTN  7                       S01486
     C                     PARM WWCLIN    WWKY10 10                       S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C*                                                                   S01486
     C** Customer is a Portfolio Customer: get default value if blank     S01486
     C*                                                                   S01486
     C********** *IN86     IFEQ '0'                                       S01486
     C           WWRTCD    IFEQ *BLANKS                                   S01486
     C********** QBPCUS    ANDEQ'Y'                                       S01486
     C                     MOVEL'Y'       WWPLCS                          S01486
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM WWCLIN    @KEY1  10                       CPB001
     C                     PARM *BLANKS   @KYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPB001
     C           @RTCD     IFEQ *BLANKS                                   CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVEL'Y'       WWPBCS                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C           SPTFR     IFEQ *BLANKS                                   S01486
     C           WWPBCS    ANDEQ'Y'                                       CPB001
     C           SPTFR     OREQ *BLANKS                                   CPB001
     C           WWPLCS    OREQ 'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0070C074
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVE FCR997    SPTFR                           S01486
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,SE0070C075
     C*                                                                   066690
     C** or check if customer has a defined portfolio reference           066690
     C*                                                                   066690
     C           DPBN      SETLLPMPORTLL                                  066690
     C           DPBN      READEPMPORTLL                 82               066690
     C           *IN82     IFEQ '0'                                       066690
     C                     MOVE PNPTFR    SPTFR                           066690
     C                     END                                            066690
     C*                                                                   066690
     C                     END                                            S01486
     C*                                                                   S01486
     C** Customer is not a Portfolio Customer: SPTFR must be blank        S01486
     C*                                                                   S01486
     C**********           ELSE                                    S01486 CPB001
     C           WWPLCS    IFNE 'Y'                                       CPB001
     C           WWPBCS    ANDNE'Y'                                       CPB001
     C                     MOVEL'N'       WWPLCS                          080673
     C                     MOVEL'N'       WWPBCS                          CPB001
     C*                                                                   S01486
     C           SPTFR     IFNE *BLANKS                                   S01486
     C                     MOVE '1'       *IN56                           S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 236'    ERR,EC                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** Must be a valid Portfolio Reference for Customer                 S01486
     C*                                                                   S01486
     C           *IN56     IFEQ '0'                                       S01486
     C           SPTFR     ANDNEFCR997                                    S01486
     C           SPTFR     ANDNE*BLANKS                                   S01486
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           *IN56     OREQ '0'                                       CPB001
     C           SPTFR     ANDNE*BLANKS                                   CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C           PORKEY    CHAINPMPORTPD             33                   S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                                       S01486
     C           PNRECI    OREQ '*'                                       S01486
     C                     MOVE '1'       *IN56                           S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 237'    ERR,EC                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** If type 'WO', check if nominal amount is acceptable              S01486
     C*                                                                   S01486
     C           *IN56     IFEQ '0'                                       S01486
     C           SDPID     ANDEQ*BLANKS                                   S01486
     C           SDPOD     ANDNE*BLANKS                                   S01486
     C           S01496    IFEQ 'Y'                                       S01496
     C           BFCLAS    IFEQ 'S'                                       S01496
     C           BFCLAS    OREQ 'D'                                       S01496
     C                     MOVE DPBA      WWBRCH  3                       S01496
     C**********           MOVE DPBN      WWCNUM  60                                   S01496 CSD027
     C                     MOVE DPBN      WWCNUM  6                                           CSD027
     C                     MOVE DPSS      WWSESN 10                       S01496
     C                     Z-ADDDPNA      WWNOML 150                      S01496
     C                     EXSR SR70YA                                    S01496
     C           RES70Y    IFEQ '1'                                       S01496
     C/COPY WNCPYSRC,SE0070C119
     C                     MOVE '1'       *IN48                           S01496
     C                     ADD  1         EC                              S01496
     C                     ADD  1         WEC                             S01496
     C                     MOVEA' W10'    ERR,EC                          S01496
     C/COPY WNCPYSRC,SE0070C120
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C                     ELSE                                           S01496
     C                     MOVE 'V'       WTVDA                           S01486
     C*                                                                   S01486
     C*  DETERMINE PORTFOLIO REFERENCE TO BE USED FOR ACCESS OF           S01486
     C*  PMAPOSLL                                                         S01486
     C           SPTFR     IFEQ FCR997                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0070C076
     C                     MOVE '9997'    WPTFR   4                       S01486
     C                     ELSE                                           S01486
     C                     MOVE SPTFR     WPTFR                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           POSKEY    SETGTPMAPOSLL                                  S01486
     C                     READPPMAPOSLL                 33               S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                                       S01486
     C           DPBN      ORNE QACNUM                                    S01486
     C           WPTFR     ORNE QAPTFR                                    S01486
     C           DPSS      ORNE QATDSS                                    S01486
     C           QATVDA    ORNE 'V'                                       S01486
     C           QANOML    ORLT DPNA                                      S01486
     C/COPY WNCPYSRC,SE0070C121
     C                     MOVE '1'       *IN48                           S01486
     C                     ADD  1         EC         42                   S01486
     C                     ADD  1         WEC                             S01486
     C                     MOVEA' W10'    ERR,EC                          S01486
     C/COPY WNCPYSRC,SE0070C122
     C                     END                                            S01486
     C                     END                                            S01496
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** Warning if selected Portfolio has been flagged for closure       S01486
     C*                                                                   S01486
     C           *IN56     IFEQ '0'                                       S01486
     C           SPTFR     ANDNE*BLANKS                                   S01486
     C           SPTFR     ANDNEFCR997                                    S01486
     C           SPTFR     ANDNEPTFR                                      S01486
     C           PNDPCL    ANDNE0                                         S01486
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           *IN56     OREQ '0'                                       CPB001
     C           SPTFR     ANDNE*BLANKS                                   CPB001
     C           SPTFR     ANDNEPTFR                                      CPB001
     C           PNDPCL    ANDNE0                                         CPB001
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0070C123
     C                     ADD  1         EC                              S01486
     C                     ADD  1         WEC                             S01486
     C                     MOVE '1'       *IN56                           S01486
     C                     MOVEA' W09'    ERR,EC                          S01486
     C/COPY WNCPYSRC,SE0070C124
     C                     END                                            S01486
     C*                                                                   S01486
     C           SPTFR     IFEQ FCR997                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0070C077
     C                     MOVE '9997'    PTFR                            S01486
     C                     ELSE                                           S01486
     C                     MOVE SPTFR     PTFR                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C/COPY WNCPYSRC,SE0070C078
     C***********                                                   S01486081239
     C***********          END                                      S01486081239
     C*                                                                   056990
     C** VALIDATE 'CUSTOMER WITHDRAWAL / DELIVERY INDICATOR'              056990
     C** DEFAULT TO YES                                                   095235
     C*                                                                   095235
     C           SCWDI     IFEQ *BLANKS                                   095235
     C                     MOVEL'Y'       SCWDI                           095235
     C                     END                                            095235
     C***MANDATORY*ENTRY*Y*OR*N************************************056990 CPM005
     C** Mandatory Entry Y, N, C, or P                                    CPM005
     C           SCWDI     IFNE 'Y'                        B1             056990
     C           SCWDI     ANDNE'N'                                       056990
     C           SCWDI     ANDNE'C'                                       CPM005
     C           SCWDI     ANDNE'P'                                       CPM005
     C                     ADD  1         EC                              056990
     C                     MOVE '1'       *IN58                           056990
     C                     MOVEA' 242'    ERR,EC                          056990
     C                     END                             E1             056990
     C*                                                                   056990
     C** MAY ONLY ENTER 'Y' IF CUSTOMER SAFE CUSTODY OR DISCRETIONARY     056990
     C           SCWDI     IFEQ 'Y'                        B1             056990
     C           BFCLAS    IFNE 'D'                        B2             056990
     C           BFCLAS    ANDNE'S'                                       056990
     C                     ADD  1         EC                              056990
     C                     MOVE '1'       *IN58                           056990
     C                     MOVEA' 242'    ERR,EC                          056990
     C                     END                             E2             056990
     C                     END                             E1             056990
     C*                                                                   056990
     C                     MOVE SCWDI     CWDI                            056990
     C                     END                                            081239
     C*                                                                   081239
     C/COPY WNCPYSRC,SE0070C072
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01496
     C*   Customer Classification S or D                                  S01496
     C           BFCLAS    IFEQ 'S'                        B1             S01496
     C           BFCLAS    OREQ 'D'                                       S01496
     C           CEU017    OREQ 'Y'                                       151501
     C*   Walk-in or walk-out only                                        S01496
     C           SDPID     IFNE *BLANKS                    B2             S01496
     C           SDPOD     ANDEQ*BLANKS                                   S01496
     C           SDPID     OREQ *BLANKS                                   S01496
     C           SDPOD     ANDNE*BLANKS                                   S01496
     C*                                                                   S01496
     C********             MOVE KEY12A    @PBRCD  3                       S01496
     C                     MOVE DPBA      @PBRCD  3                       S01496
     C                     MOVE DPSS      @PSESN 10                       S01496
     C                     MOVE DPBN      @PCNUM  6                       S01496
     C           SPTFR     IFEQ FCR997                     B3             S01496
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0070C079
     C                     MOVE '9997'    @PPTFR  4                       S01496
     C                     ELSE                            X3             S01496
     C                     MOVE SPTFR     @PPTFR  4                       S01496
     C                     ENDIF                           E3             S01496
     C                     MOVE 'Y'       @POBPO  1                       S01496
     C           SDPOD     IFNE *BLANKS                    B3             S01496
     C           SDPID     ANDEQ*BLANKS                                   S01496
     C                     MOVE 'P'       @PBLTY  1                       S01496
     C                     ELSE                            X3             S01496
     C                     MOVE 'S'       @PBLTY  1                       S01496
     C                     ENDIF                           E3             S01496
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or if Securities Redenomination feature is installed.          CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is Corporate Actions General Block for         CSE007
      ***  Security.                                                      CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6712                          CSE007
     C                     MOVELDPBN      WORK1                                               227267
     C                     CALL 'SE7572'                                  CSE007
     C                     PARM           @PBRCD                          CSE007
     C                     PARM           @PSESN                          CSE007
     C**********           PARM           P@CNUM  60                                   227267 CSD027
     C                     PARM           P@CNUM  6                                           CSD027
     C                     PARM           @PPGB   1                       CSE007
     C                     PARM           @PSGB   1                       CSE007
      *                                                                   CSE007
      ***  If block found, send error message and setup work field to     CSE007
      ***  not call SE6712.                                               CSE007
      *                                                                   CSE007
     C           @PPGB     IFEQ 'Y'                                       CSE007
     C           SDPOD     ANDNE*BLANKS                                   CSE007
     C           SDPID     ANDEQ*BLANKS                                   CSE007
     C           @PSGB     OREQ 'Y'                                       CSE007
     C           SDPOD     ANDEQ*BLANKS                                   CSE007
     C           SDPID     ANDNE*BLANKS                                   CSE007
     C                     ADD  1         EC                              CSE007
     C                     MOVE ' CO1'    ERR,EC                          CSE007
     C                     SETON                     48                   CSE007
     C                     MOVE 'N'       SE6712                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is switched OFF or Corporate      CSE007
      ***  Actions General Block for Security not found.                  CSE007
      *                                                                   CSE007
     C           SE6712    IFEQ 'Y'                                       CSE007
     C*                                                                   S01496
     C*    .. search if there is General Block for Security               S01496
     C                     CALL 'SE6712'                                  S01496
     C                     PARM           @PBRCD                          S01496
     C                     PARM           @PSESN                          S01496
     C                     PARM           @PPGB   1                       S01496
     C                     PARM           @PSGB   1                       S01496
     C*                                                                   S01496
     C           @PPGB     IFEQ 'Y'                        B3             S01496
     C           SDPOD     ANDNE*BLANKS                                   S01496
     C           SDPID     ANDEQ*BLANKS                                   S01496
     C           @PSGB     OREQ 'Y'                                       S01496
     C           SDPOD     ANDEQ*BLANKS                                   S01496
     C           SDPID     ANDNE*BLANKS                                   S01496
     C/COPY WNCPYSRC,SE0070C125
     C                     ADD  1         EC                              S01496
     C                     ADD  1         WEC                             S01496
     C                     MOVE ' WR1'    ERR,EC                          S01496
     C                     SETON                     48                   S01496
     C/COPY WNCPYSRC,SE0070C126
     C                     ENDIF                                          S01496
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or if Securities Redenomination feature is installed.          CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is Corporate Actions General Block for         CSE007
      ***  Customer.                                                      CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6714                          CSE007
     C                     CALL 'SE7574'                                  CSE007
     C                     PARM           @PBRCD  3                       CSE007
     C                     PARM           @PCNUM  6                       CSE007
     C                     PARM           @PPTFR  4                       CSE007
     C                     PARM           @PPGB   1                       CSE007
     C                     PARM           @PSGB   1                       CSE007
      *                                                                   CSE007
      ***  If block found, send error message and setup work field to     CSE007
      ***  not call SE6714.                                               CSE007
      *                                                                   CSE007
     C           @PPGB     IFEQ 'Y'                                       CSE007
     C           SDPOD     ANDNE*BLANKS                                   CSE007
     C           SDPID     ANDEQ*BLANKS                                   CSE007
     C           @PSGB     OREQ 'Y'                                       CSE007
     C           SDPOD     ANDEQ*BLANKS                                   CSE007
     C           SDPID     ANDNE*BLANKS                                   CSE007
      *                                                                   CSE007
     C                     ADD  1         EC                              CSE007
     C                     SETON                     48                   CSE007
     C                     MOVE 'N'       SE6714                          CSE007
     C           @PPTFR    IFEQ *BLANKS                                   CSE007
     C                     MOVE ' CO2'    ERR,EC                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE ' CO6'    ERR,EC                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is switched OFF or Corporate      CSE007
      ***  Actions General Block for Customer not found.                  CSE007
      *                                                                   CSE007
     C           SE6714    IFEQ 'Y'                                       CSE007
      *                                                                   CSE007
     C*                                                    E3             S01496
     C*    .... search if there is General Block for Customer             S01496
     C*                                                                   S01496
     C                     CALL 'SE6714'                                  S01496
     C                     PARM           @PBRCD  3                       S01496
     C                     PARM           @PCNUM  6                       S01496
     C                     PARM           @PPTFR  4                       S01496
     C                     PARM           @PPGB   1                       S01496
     C                     PARM           @PSGB   1                       S01496
     C*                                                                   S01496
     C           @PPGB     IFEQ 'Y'                        B3             S01496
     C           SDPOD     ANDNE*BLANKS                                   S01496
     C           SDPID     ANDEQ*BLANKS                                   S01496
     C           @PSGB     OREQ 'Y'                                       S01496
     C           SDPOD     ANDEQ*BLANKS                                   S01496
     C           SDPID     ANDNE*BLANKS                                   S01496
     C*                                                                   S01496
     C/COPY WNCPYSRC,SE0070C127
     C                     ADD  1         EC                              S01496
     C                     ADD  1         WEC                             S01496
     C                     SETON                     48                   S01496
     C           @PPTFR    IFEQ *BLANKS                    B4             S01496
     C                     MOVE ' WR2'    ERR,EC                          S01496
     C                     ELSE                            X4             S01496
     C                     MOVE ' WR6'    ERR,EC                          S01496
     C                     ENDIF                           E4             S01496
     C/COPY WNCPYSRC,SE0070C128
     C*                                                                   S01496
     C                     ENDIF                           E3             S01496
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or if Securities Redenomination feature is installed.          CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is Corporate Actions Specific Block for        CSE007
      ***  Customer and Security.                                         CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6710                          CSE007
     C                     MOVE RUND      @PRDNB  5                       CSE007
     C                     CALL 'SE7570'                                  CSE007
     C                     PARM           @PRDNB                          CSE007
     C                     PARM           @POBPO                          CSE007
     C                     PARM           @PBRCD                          CSE007
     C                     PARM           @PSESN                          CSE007
     C                     PARM           @PCNUM                          CSE007
     C                     PARM           @PPTFR                          CSE007
     C                     PARM           @PBLTY                          CSE007
     C                     PARM           @PNOBL 13                       CSE007
     C                     PARM           @PNOPO 13                       CSE007
      *                                                                   CSE007
     C                     MOVE @PNOBL    WWNOBL 130                      CSE007
     C                     MOVE @PNOPO    WWNOPO 130                      CSE007
      *                                                                   CSE007
      ***  If block found, send error message and setup work field to     CSE007
      ***  not call SE6710.                                               CSE007
      *                                                                   CSE007
     C           WWNOBL    IFEQ *HIVAL                                    CSE007
     C                     ADD  1         EC                              CSE007
     C                     SETON                     48                   CSE007
     C                     MOVE 'N'       SE6710                          CSE007
     C           @PPTFR    IFEQ *BLANKS                                   CSE007
     C                     MOVE ' CO3'    ERR,EC                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE ' CO7'    ERR,EC                          CSE007
     C                     ENDIF                                          CSE007
     C                     ELSE                                           CSE007
     C           WWNOBL    IFNE *ZEROS                                    CSE007
     C           SDPID     IFNE *BLANKS                                   CSE007
     C           SDPOD     ANDEQ*BLANKS                                   CSE007
     C           WWNOPO    ADD  DPNA      WWFONO 130                      CSE007
     C           WWFONO    IFGT WWNOBL                                    CSE007
     C                     ADD  1         EC                              CSE007
     C                     SETON                     48                   CSE007
     C                     MOVE 'N'       SE6710                          CSE007
     C           @PPTFR    IFEQ *BLANKS                                   CSE007
     C                     MOVE ' CO4'    ERR,EC                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE ' CO8'    ERR,EC                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C                     ELSE                                           CSE007
     C           WWNOPO    SUB  DPNA      WWFONO                          CSE007
     C           WWFONO    IFLT WWNOBL                                    CSE007
     C                     ADD  1         EC                              CSE007
     C                     SETON                     48                   CSE007
     C                     MOVE 'N'       SE6710                          CSE007
     C           @PPTFR    IFEQ *BLANKS                                   CSE007
     C                     MOVE ' CO4'    ERR,EC                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE ' CO8'    ERR,EC                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is switched OFF or Corporate      CSE007
      ***  Actions Specific Block for Customer and Security not found.    CSE007
      *                                                                   CSE007
     C           SE6710    IFEQ 'Y'                                       CSE007
     C*                                                                   S01496
     C*    ... search if there is Specific Block for Customer and Secty   S01496
     C*                                                                   S01496
     C                     MOVE RUND      @PRDNB  5                       S01496
     C                     CALL 'SE6710'                                  S01496
     C                     PARM           @PRDNB                          S01496
     C                     PARM           @POBPO                          S01496
     C                     PARM           @PBRCD                          S01496
     C                     PARM           @PSESN                          S01496
     C                     PARM           @PCNUM                          S01496
     C                     PARM           @PPTFR                          S01496
     C                     PARM           @PBLTY                          S01496
     C                     PARM           @PNOBL 13                       S01496
     C                     PARM           @PNOPO 13                       S01496
     C                     PARM 'N'       @PCOLF  1                       CGL011
     C                     PARM *ZEROS    @PCOLA 15                       CGL011
     C*                                                                   S01496
     C                     MOVE @PNOBL    WWNOBL 130                      S01496
     C                     MOVE @PNOPO    WWNOPO 130                      S01496
     C                     MOVE @PCOLA    WWCOLL 150                      CGL011
     C*                                                                   S01496
     C           WWNOBL    IFEQ *HIVAL                     B3             S01496
     C/COPY WNCPYSRC,SE0070C129
     C                     ADD  1         EC                              S01496
     C                     ADD  1         WEC                             S01496
     C                     SETON                     48                   S01496
     C           @PPTFR    IFEQ *BLANKS                    B4             S01496
     C                     MOVE ' WR3'    ERR,EC                          S01496
     C                     ELSE                            X4             S01496
     C                     MOVE ' WR7'    ERR,EC                          S01496
     C                     ENDIF                           E4             S01496
     C/COPY WNCPYSRC,SE0070C130
     C                     ELSE                            X3             S01496
     C           WWNOBL    IFNE *ZEROS                     B4             S01496
     C           SDPID     IFNE *BLANKS                    B5             S01496
     C           SDPOD     ANDEQ*BLANKS                                   S01496
     C           WWNOPO    ADD  DPNA      WWFONO 130                      S01496
     C           WWFONO    IFGT WWNOBL                     B6             S01496
     C/COPY WNCPYSRC,SE0070C131
     C                     ADD  1         EC                              S01496
     C                     ADD  1         WEC                             S01496
     C                     SETON                     48                   S01496
     C           @PPTFR    IFEQ *BLANKS                    B7             S01496
     C                     MOVE ' WR4'    ERR,EC                          S01496
     C                     ELSE                            X7             S01496
     C                     MOVE ' WR8'    ERR,EC                          S01496
     C                     ENDIF                           E7             S01496
     C/COPY WNCPYSRC,SE0070C132
     C                     ENDIF                           E6             S01496
     C                     ELSE                            X5             S01496
     C           WWNOPO    SUB  DPNA      WWFONO                          S01496
     C           WWFONO    IFLT WWNOBL                     B6             S01496
     C/COPY WNCPYSRC,SE0070C133
     C                     ADD  1         EC                              S01496
     C                     ADD  1         WEC                             S01496
     C                     SETON                     48                   S01496
     C           @PPTFR    IFEQ *BLANKS                    B7             S01496
     C                     MOVE ' WR4'    ERR,EC                          S01496
     C                     ELSE                            X7             S01496
     C                     MOVE ' WR8'    ERR,EC                          S01496
     C                     ENDIF                           E7             S01496
     C/COPY WNCPYSRC,SE0070C134
     C                     ENDIF                           E6             S01496
     C                     ENDIF                           E5             S01496
     C                     ENDIF                           E4             S01496
     C                     ENDIF                           E3             S01496
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   S01496
     C                     ENDIF                           E2             S01496
     C                     ENDIF                           E1             S01496
     C                     ENDIF                           E1             S01496
     C*                                                                   S01486
     C** V A L I D A T E   AVERAGE YIELD                                  S01486
     C** When Portfolio Management is on                                  081239
     C*                                                                   S01486
     C           *INU4     IFEQ '1'                                       081239
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C** MAY ONLY ENTER YIELD RATE FOR 'WI' OR 'WO'                       S01486
     C           ACTNTP    IFNE 'WI'                       B1             S01486
     C           ACTNTP    ANDNE'WO'                                      S01486
     C           SCYLD     ANDNE*BLANKS                                   S01486
     C                     MOVE '1'       *IN57                           S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 238'    ERR,EC                          S01486
     C                     END                             E1             S01486
     C*                                                                   S01486
     C** MAY ONLY ENTER YIELD RATE IF A VALID PORTFOLIO HAS BEEN INPUT    S01486
     C           SPTFR     IFEQ *BLANKS                    B1             S01486
     C           *IN56     ANDEQ'0'                                       S01486
     C           SCYLD     ANDNE*BLANKS                                   S01486
     C           *IN57     ANDEQ'0'                                       S01486
     C                     MOVE '1'       *IN57                           S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 239'    ERR,EC                          S01486
     C                     END                             E1             S01486
     C*                                                                   S01486
     C** YIELD MAY NOT BE ENTERED FOR PROCESSING TYPES 2, 4 AND 7         S01486
     C           SCYLD     IFNE *BLANKS                    B1             S01486
     C*                                                                   S01486
     C** OBTAIN SECURITY PROCESSING TYPE                                  S01486
     C           INVKA     CHAININVTPDF              33                   S01486
     C*                                                                   S01486
     C           PROT      IFEQ '2'                        B2             S01486
     C           PROT      OREQ '4'                                       S01486
     C           PROT      OREQ '7'                                       S01486
     C                     ADD  1         EC         57                   S01486
     C                     MOVEA' 240'    ERR,EC                          S01486
     C                     END                             E2             S01486
     C                     END                             E1             S01486
     C*                                                                   S01486
     C** CHECK THAT A VALID AMOUNT HAS BEEN INPUT VIA SR/ZALIGN           S01486
     C           *IN57     IFEQ '0'                        B1             S01486
     C                     MOVE *BLANKS   ZFIELD                          S01486
     C                     MOVE SCYLD     ZFIELD                          S01486
     C                     Z-ADD7         ZADEC                           S01486
     C                     Z-ADD4         ZADIG                           S01486
     C                     EXSR ZALIGN                                    S01486
     C           *IN99     IFEQ '1'                        B2             S01486
     C                     ADD  1         EC         57                   S01486
     C                     MOVEA' 241'    ERR,EC                          S01486
     C                     ELSE                            X2             S01486
     C                     MOVE ZFIELD    CYLD                            S01486
     C                     END                             E2             S01486
     C                     END                             E1             S01486
     C                     END                                            081239
     C*                                                                   S01486
     C*                                                                   S01486
     C** V A L I D A T E   FX RATE AND MULTIPLY/DIVIDE INDICATOR          S01486
     C*                                                                   S01486
     C** If Nominal Currency and Portfolio Currency are the same          S01486
     C** set Cross Rate to 1 and M/D Indicator to 'M'                     S01486
     C** and skip to Amount validation                                    S01486
     C*                                                                   S01486
     C                     MOVE *BLANKS   SSPXR                           S01486
     C                     MOVE *BLANKS   SSPMD                           S01486
     C                     Z-ADD0         SPXR                            S01486
     C                     MOVE *BLANKS   SPMD                            S01486
     C*                                                                   S01486
     C           *INU4     IFEQ '1'                        B1             S01486
     C           *IN56     ANDEQ'0'                                       S01486
     C********** QBPCUS    ANDEQ'Y'                                       S01486
     C********** *IN86     ANDEQ'0'                                       S01486
     C********** WWRTCD    ANDEQ*BLANKS                                   080673
     C           WWPLCS    ANDEQ'Y'                                       080673
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C*                                                                   080673
     C** - Depot is either a Walk In nor a Walk Out                       S01486
     C           SDPID     IFNE *BLANK                     B2             S01486
     C           SDPOD     ORNE *BLANK                                    S01486
     C*                                                                   S01486
     C** SET PORTFOLIO CURRENCY TO CUSTOMER BASE CURRENCY FOR 9997        S01486
     C** PORTFOLIO                                                        S01486
     C           SPTFR     IFEQ FCR997                     B3             S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE QBCSBY    PNPTCY                          S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C           NMCY      IFEQ PNPTCY                     B3             S01486
     C                     MOVE 'M'       ZCRSMD                          S01486
     C                     Z-ADD1         ZCRSRT                          S01486
     C                     GOTO AMCHK                                     S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C**  Format key HSEXKY using Nominal Ccy and Movement Date           S01486
     C                     MOVE NMCY      HSEXCY                          S01486
     C*                                                                   S01486
     C           SDPDO     IFEQ *BLANK                     B3             S01486
     C                     MOVE DPMD      WWVD                            S01486
     C                     ELSE                            X3             S01486
     C                     MOVE DPDO      WWVD                            S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C**  Obtain FX Rate for Trade Date between Nominal Currency          S01486
     C**  and Base Currency for Accounting                                S01486
     C**  execpt if trade date is equal to the run date.                  S01486
     C           WWVD      IFLT RUND                       B3             S01486
     C           DPMD      IFNE RUND                       B4             S01486
     C           DPDO      ANDNERUND                                      S01486
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 44               S01486
     C*                                                                   S01486
     C           *IN44     IFEQ '1'                        B5             S01486
     C           NMCY      ORNE Q8CCY                                     S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 44               S01486
     C                     END                             E5             S01486
     C                     END                             E4             S01486
     C                     ELSE                            X3             S01486
     C                     SETON                         44               S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C           *IN44     IFEQ '1'                        B3             S01486
     C           NMCY      ORNE Q8CCY                                     S01486
     C           WWVD      OREQ RUND                                      S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM NMCY      @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                     *B4            S01486
     C                     SETON                     U7U8  ***************S01486
     C                     Z-ADD02        DBASE            **DB ERROR 02**S01486
     C                     MOVEL'SDCURRPD'DBFILE           ***************S01486
     C                     MOVEL@OPTN     DBKEY                           S01486
     C                     SETON                     LR                   S01486
     C                     RETRN                                          S01486
     C                     END                             E4             S01486
     C*                                                                   S01486
     C                     Z-ADDA6SPRT    Q8SPOT                          S01486
     C                     MOVE A6MDIN    Q8MDV1                          S01486
     C                     Z-ADDA6NBDP    Q8CDP                           S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C**  Set up SR/ZCCYCN with 'FROM' details for Nominal Currency       S01486
     C                     Z-ADDQ8SPOT    ZRATEF                          S01486
     C                     MOVE Q8MDV1    ZMDINF                          S01486
     C                     Z-ADDQ8CDP     ZCDPF                           S01486
     C                     MOVE NMCY      ZCCYF                           S01486
     C*                                                                   S01486
     C**  Obtain FX Rate for Trade date between Portfolio Currency        S01486
     C**  and Base Currency for Accounting                                S01486
     C**  execpt if trade date is equal to the run date.                  S01486
     C*                                                                   S01486
     C           SPTFR     IFEQ FCR997                     B3             S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE QBCSBY    HSEXCY                          S01486
     C                     ELSE                            X3             S01486
     C                     MOVE PNPTCY    HSEXCY                          S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C           DPMD      IFNE RUND                       B3             S01486
     C           DPDO      ANDNERUND                                      S01486
     C*                                                                   S01486
     C           WWVD      IFNE RUND                       B4             S01486
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 44               S01486
     C*                                                                   S01486
     C           *IN44     IFEQ '1'                        B5             S01486
     C           HSEXCY    ORNE Q8CCY                                     S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 44               S01486
     C                     END                             E5             S01486
     C                     END                             E4             S01486
     C                     ELSE                            X3             S01486
     C                     SETON                         44               S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C           *IN44     IFEQ '1'                        B3             S01486
     C           HSEXCY    ORNE Q8CCY                                     S01486
     C           WWVD      ORGE RUND                                      S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM HSEXCY    @AJCD   3                       S01486
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                     *B4            S01486
     C                     SETON                     U7U8  ***************S01486
     C                     Z-ADD04        DBASE            **DB ERROR 04**S01486
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01486
     C                     MOVEL@OPTN     DBKEY                           S01486
     C                     SETON                     LR                   S01486
     C                     RETRN                                          S01486
     C                     END                             E4             S01486
     C*                                                                   S01486
     C                     Z-ADDA6SPRT    Q8SPOT                          S01486
     C*                    MOVE A6MDIN    Q8MDV1                          S01486
     C                     Z-ADDA6NBDP    Q8CDP                           S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C**  Set up SR/ZCCYCN with 'TO' details for Portfolio Currency       S01486
     C                     Z-ADDQ8SPOT    ZRATET                          S01486
     C                     MOVE Q8MDV1    ZMDINT                          S01486
     C                     Z-ADDQ8CDP     ZCDPT                           S01486
     C                     MOVE PNPTCY    ZCCYT                           S01486
     C*                                                                   S01486
     C**  Calculate Cross Rate between Nominal Currency and Portfolio     S01486
     C**  Currency using standard SR/ZCCYCN.                              S01486
     C                     Z-ADD0         ZAMTF                           S01486
     C                     EXSR ZCCYCN                                    S01486
     C*                                                                   S01486
     C**  If FX Rate details blank output default rate calculated in      S01486
     C**  SR/ZCCYCN to screen with warning.                               S01486
     C           AMCHK     TAG                                            S01486
     C*                                                                   S01486
     C                     MOVE *BLANKS   ZFIELD                          S01486
     C                     MOVE ZCRSRT    ZFIELD                          S01486
     C                     Z-ADD8         ZADEC                           S01486
     C                     EXSR ZEDIT                                     S01486
     C                     MOVE ZFIELD    SSPXR                           S01486
     C                     MOVE ZCRSMD    SSPMD                           S01486
     C                     Z-ADDZCRSRT    SPXR                            S01486
     C                     MOVE ZCRSMD    SPMD                            S01486
     C*                                                                   S01486
     C                     END                             E2             S01486
     C                     END                             E1             S01486
     C*                                                                   CPB001
     C** V A L I D A T E  PURCHASED INTEREST, MVNT SUBTYPE, ACCRUED IND.  CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C*                                                                   CPB001
     C                     CALL 'AOCURRR0'                                CPB001
     C                     PARM '*DBERR  '@RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM NMCY      @AJCD   3                       CPB001
     C           SDCURR    PARM SDCURR    DSSDY                           CPB001
     C*                                                                   CPB001
     C                     Z-ADDA6NBDP    NOMDP   10                      CPB001
     C*                                                                   CPB001
     C***  Validate Purchase interest                                     CPB001
     C*                                                                   CPB001
     C           SPINT     IFNE *BLANKS                                   CPB001
     C           SPINT     ANDNESAPINT                                    CPB001
     C                     MOVE *BLANKS   ZFLD17                          CPB001
     C                     MOVELSPINT     ZFLD17                          CPB001
     C           13        SUB  NOMDP     ZSDIG                           CPB001
     C                     Z-ADDNOMDP     ZSDEC                           CPB001
     C                     EXSR ZASIGN                                    CPB001
     C*                                                                   CPB001
     C           *IN99     IFEQ '1'                                       CPB001
     C                     MOVE '1'       *IN26                           CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVEA' 260'    ERR,EC                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE ZOUT15    ZITRA                           CPB001
     C                     Z-ADDZITRA     PINT                            CPB001
     C           ZFSIGN    IFEQ '-'                                       CPB001
     C                     Z-SUBZITRA     ZITRA                           CPB001
     C                     Z-SUBZITRA     PINT                            CPB001
     C                     ENDIF                                          CPB001
     C                     MOVE *BLANKS   ZFLD15                          CPB001
     C                     MOVE ZITRA     ZFLD15                          CPB001
     C                     Z-ADDNOMDP     ZDECS                           CPB001
     C                     MOVE *BLANK    ZECODE                          CPB001
     C                     EXSR ZSEDIT                                    CPB001
     C                     MOVE ZOUT21    SPINT                           CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C***  Purchase interest must be calculated if blank                  CPB001
     C*                                                                   CPB001
     C                     ELSE                                           CPB001
     C*                                                                   CPB001
     C** OBTAIN SECURITY PROCESSING TYPE                                  CPB001
     C           INVKA     CHAININVTPDF              33                   CPB001
     C*                                                                   CPB001
     C           PROT      IFEQ '1'                                       CPB001
     C           PROT      OREQ '3'                                       CPB001
     C           PROT      OREQ '5'                                       CPB001
     C           PROT      OREQ '6'                                       CPB001
     C           PROT      OREQ '8'                                       CPB001
     C           PROT      OREQ '9'                                       CPB001
     C           STBS      IFEQ 'Y'                                       CPB001
     C           STBS      OREQ 'P'                                       CPB001
     C*                                                                   CPB001
     C** Setup Depot movement                                             CPB001
     C*                                                                   CPB001
     C                     MOVE *BLANKS   WWDPMV  2                       CPB001
     C********** DPID      IFNE *ZEROS                                                 CPB001 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    CPB001
     C********** DPOD      ANDEQ*ZEROS                                                 CPB001 CSD027
     C           DPOD      ANDEQ*BLANKS                                                       CSD027
     C           DPDO      ANDEQ*ZEROS                                    CPB001
     C                     MOVE 'WI'      WWDPMV  2                       CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C********** DPID      IFEQ *ZEROS                                                 CPB001 CSD027
     C           DPID      IFEQ *BLANKS                                                       CSD027
     C           DPMD      ANDEQ*ZEROS                                    CPB001
     C********** DPOD      ANDNE*ZEROS                                                 CPB001 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS                                    CPB001
     C                     MOVE 'WO'      WWDPMV  2                       CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C********** DPID      IFNE *ZEROS                                                 CPB001 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    CPB001
     C********** DPOD      ANDNE*ZEROS                                                 CPB001 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDEQ*ZEROS                                    CPB001
     C           SPTFR     ANDEQ*BLANKS                                   CPB001
     C                     MOVE 'DT'      WWDPMV  2                       CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C********** DPID      IFNE *ZEROS                                                 CPB001 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    CPB001
     C********** DPOD      ANDNE*ZEROS                                                 CPB001 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS                                    CPB001
     C           DPAD      ANDEQ*ZEROS                                    CPB001
     C           SPTFR     ANDEQ*BLANKS                                   CPB001
     C           DPMD      ANDGTDPDO                                      CPB001
     C                     MOVE 'BL'      WWDPMV  2                       CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C********** DPID      IFNE *ZEROS                                                 CPB001 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    CPB001
     C********** DPOD      ANDNE*ZEROS                                                 CPB001 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS                                    CPB001
     C           DPAD      ANDEQ*ZEROS                                    CPB001
     C           SPTFR     ANDEQ*BLANKS                                   CPB001
     C           DPDO      ANDGTDPMD                                      CPB001
     C                     MOVE 'BB'      WWDPMV  2                       CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C********** DPID      IFNE *ZEROS                                                 CPB001 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    CPB001
     C********** DPOD      ANDNE*ZEROS                                                 CPB001 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS                                    CPB001
     C           DPAD      ANDNE*ZEROS                                    CPB001
     C           SPTFR     ANDEQ*BLANKS                                   CPB001
     C           DPMD      ANDGTDPDO                                      CPB001
     C           SRPIN     ANDEQ'R'                                       CPB001
     C                     MOVE 'RP'      WWDPMV  2                       CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C********** DPID      IFNE *ZEROS                                                 CPB001 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    CPB001
     C********** DPOD      ANDNE*ZEROS                                                 CPB001 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS                                    CPB001
     C           DPAD      ANDNE*ZEROS                                    CPB001
     C           SPTFR     ANDEQ*BLANKS                                   CPB001
     C           DPDO      ANDGTDPMD                                      CPB001
     C           SRPIN     ANDEQ'R'                                       CPB001
     C                     MOVE 'RR'      WWDPMV  2                       CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C** Updating correctly the value date in DPTMVD file                 CPB001
     C*                                                                   CPB001
     C                     Z-ADD0         DPVD                            CPB001
     C           WWDPMV    IFEQ 'DT'                                      CPB001
     C           WWDPMV    OREQ 'WI'                                      CPB001
     C           WWDPMV    OREQ 'BB'                                      CPB001
     C           WWDPMV    OREQ 'RR'                                      CPB001
     C                     Z-ADDDPMD      DPVD                            CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C           WWDPMV    IFEQ 'WO'                                      CPB001
     C           WWDPMV    OREQ 'BL'                                      CPB001
     C           WWDPMV    OREQ 'RP'                                      CPB001
     C                     Z-ADDDPDO      DPVD                            CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C***  Not update Purchased interest if Value date not setuped        CPB001
     C*                                                                   CPB001
     C           DPVD      IFNE *ZEROS                                    CPB001
     C*                                                                   CPB001
     C***  Setup Accrued Indicator if this one is blank                   CPB001
     C*                                                                   CPB001
     C           SACIN     IFEQ *BLANKS                                   CPB001
     C                     EXSR ZNCD                                      CPB001
     C                     MOVE 'C'       SACIN                           CPB001
     C           DPVD      IFEQ NCD                                       CPB001
     C                     MOVE 'F'       SACIN                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVELEDFT      ZNRDYS                          CPB001
     C           ZNRDYS    IFNE *ZEROS                                    CPB001
     C                     MOVE EDFT      WEDFT   1                       CPB001
     C           WEDFT     IFEQ 'W'                                       CPB001
     C*    .. if working days                                             CPB001
     C                     Z-ADDNCD       ZDAYNO                          CPB001
     C                     MOVE NMCY      ZCCY                            CPB001
     C                     MOVE *BLANKS   ZLOC                            CPB001
     C                     EXSR ZBKDT                                     CPB001
     C                     ELSE                                           CPB001
     C*    .. if actual days                                              CPB001
     C           NCD       SUB  ZNRDYS    ZDYNBR                          CPB001
     C                     ENDIF                                          CPB001
     C           DPVD      IFLT NCD                                       CPB001
     C           DPVD      ANDGEZDYNBR                                    CPB001
     C                     MOVE 'X'       SACIN                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*  Set up accrued indicator for schuldschein.                       CPB001
     C           PROT      IFEQ '6'                                       CPB001
     C                     MOVE 'F'       SACIN                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C           DYBS      IFNE ' '                                       CPB001
     C           DVBS      ANDNE' '                                       CPB001
     C                     Z-ADDDPVD      ECD                             CPB001
     C                     Z-ADDDPNA      NOML   110                      CPB001
     C                     MOVE SACIN     ZACIN                           CPB001
     C                     Z-ADDIADJ      ZDADJ                           CPB001
     C                     MOVE ' '       ZADIN                           CPB001
     C                     MOVE 'N'       ZCPOVR                          CPB001
     C*                                                                   CPB001
     C*  Coupon rate                                                      CPB001
     C*                                                                   CPB001
     C* Define key list for SECEO (SEDEVDO) Security Diary Events.        CPB001
     C*                                                                   CPB001
     C           KLEVD     KLIST                                          CPB001
     C                     KFLD           SDSN                            CPB001
     C                     KFLD           SDET                            CPB001
     C                     KFLD           SDED                            CPB001
     C*                                                                   CPB001
     C                     MOVE DPSS      SDSN                            CPB001
     C                     MOVE 'IR'      SDET                            CPB001
     C                     Z-ADDDPVD      SDED                            CPB001
     C           KLEVD     SETLLSEDEVDO                                   CPB001
     C                     READ SEDEVDO                  82               CPB001
     C*                                                                   CPB001
     C           *IN82     IFEQ *OFF                                      CPB001
     C           SDSN      ANDEQDPSS                                      CPB001
     C           SDET      ANDEQ'IR'                                      CPB001
     C                     Z-ADDSDNC      TDCR                            CPB001
     C                     ELSE                                           CPB001
     C                     Z-ADDCPNR      TDCR   117                      CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C                     Z-ADDNOMDP     ZCDP                            CPB001
     C*                                                                   CPB001
     C                     EXSR ZPCINT                                    CPB001
     C*                                                                   CPB001
     C                     Z-ADDIADJ      ZDADJ                           CPB001
     C           IADJ      IFNE *ZEROS                                    CPB001
     C                     MOVE 'D'       ZADIN                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE ' '       ZADIN                           CPB001
     C                     ENDIF                                          CPB001
     C                     EXSR ZPCINT                                    CPB001
     C*                                                                   CPB001
     C                     MOVE *BLANKS   ZFLD15                          CPB001
     C           PROT      IFNE '6'                                       CPB001
     C                     MOVE ZITRA     ZFLD15                          CPB001
     C                     Z-ADDZITRA     PINT                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *ZERO     ZFLD15                          CPB001
     C                     Z-ADD*ZERO     PINT                            CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C                     Z-ADDNOMDP     ZDECS                           CPB001
     C                     MOVE *BLANK    ZECODE                          CPB001
     C                     EXSR ZSEDIT                                    CPB001
     C                     MOVE ZOUT21    SPINT                           CPB001
     C                     MOVELSPINT     SAPINT                          CPB001
     C                     ELSE                                           CPB001
     C                     Z-ADD0         PINT                            CPB001
     C                     MOVE ZOUT21    SPINT                           CPB001
     C                     MOVELSPINT     SAPINT                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C*                                                                   CPB001
     C***  Accured Indicator must be 'C', 'F' or 'X'                      CPB001
     C*                                                                   CPB001
     C*                                                                   CPB001
     C           SACIN     IFNE 'C'                                       CPB001
     C           SACIN     ANDNE'F'                                       CPB001
     C           SACIN     ANDNE'X'                                       CPB001
     C           SACIN     ANDNE*BLANKS                                   CPB001
     C                     MOVE '1'       *IN28                           CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVEA' 261'    ERR,EC                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE SACIN     ACIN                            CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C***  Movement Indicator must be a live Deal Subtype                 CPB001
     C*                                                                   CPB001
     C           SMSTP     IFNE *BLANKS                                   CPB001
     C                     CALL 'AODLSTR0'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM SMSTP     @KEY2   2                       CPB001
     C           SDDLST    PARM SDDLST    DSFDY                           CPB001
     C*                                                                   CPB001
     C           @RTCD     IFNE *BLANKS                                   CPB001
     C                     MOVE '1'       *IN27                           CPB001
     C                     ADD  1         EC                              CPB001
     C                     MOVEA' 262'    ERR,EC                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE ASDSTC    SMSTP                           CPB001
     C                     MOVE ASDSTC    MSTP                            CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,SE0070C168
     C*
     C* Fetch movement type from input
     C*
     C* Walk-in
     C*
     C********** DPID      IFNE *ZEROS                                                        CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS
     C********** DPOD      ANDEQ*ZEROS                                                        CSD027
     C           DPOD      ANDEQ*BLANKS                                                       CSD027
     C           DPDO      ANDEQ*ZEROS
     C                     MOVE 'WI'      ACTNTP  2
     C*                                                                   CAP003
     C* If API feature is installed, then Walk In transactions            CAP003
     C* are not maintained by this program                                CAP003
     C*                                                                   CAP003
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     ADD  1         EC         43                   CAP003
     C                     MOVEA' 300'    ERR,EC                          CAP003
     C                     END                                            CAP003
      *                                                                   CAP003
     C                     END
     C*
     C* Walk-out
     C*
     C********** DPID      IFEQ *ZEROS                                                        CSD027
     C           DPID      IFEQ *BLANKS                                                       CSD027
     C           DPMD      ANDEQ*ZEROS
     C********** DPOD      ANDNE*ZEROS                                                        CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS
     C                     MOVE 'WO'      ACTNTP
     C*                                                                   CAP003
     C* If API feature is installed, then Walk Out transactions           CAP003
     C* are not maintained by this program                                CAP003
     C*                                                                   CAP003
     C           CAP003    IFEQ 'Y'                                       CAP003
     C                     ADD  1         EC         41                   CAP003
     C                     MOVEA' 301'    ERR,EC                          CAP003
     C                     END                                            CAP003
      *                                                                   CAP003
     C                     END
     C*
     C* Depot transfer
     C*
     C********** DPID      IFNE *ZEROS                                                        CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS
     C********** DPOD      ANDNE*ZEROS                                                        CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDEQ*ZEROS
     C***********PTFR      ANDEQ*BLANKS                            S01486 046294
     C           SPTFR     ANDEQ*BLANKS                                   046294
     C                     MOVE 'DT'      ACTNTP
     C                     END
     C*
     C* Bond lending
     C*
     C********** DPID      IFNE *ZEROS                                                        CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS
     C********** DPOD      ANDNE*ZEROS                                                        CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS
     C           DPAD      ANDEQ*ZEROS
     C           SPTFR     ANDEQ*BLANKS                                   S01486
     C           DPMD      ANDGTDPDO
     C                     MOVE 'BL'      ACTNTP
     C                     END
     C*
     C* Bond borrowing
     C*
     C********** DPID      IFNE *ZEROS                                                        CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS
     C********** DPOD      ANDNE*ZEROS                                                        CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS
     C           DPAD      ANDEQ*ZEROS
     C           SPTFR     ANDEQ*BLANKS                                   S01486
     C           DPDO      ANDGTDPMD
     C                     MOVE 'BB'      ACTNTP
     C                     END
     C*
     C* Repos
     C*
     C********** DPID      IFNE *ZEROS                                                        CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS
     C********** DPOD      ANDNE*ZEROS                                                        CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS
     C           DPAD      ANDNE*ZEROS
     C           SPTFR     ANDEQ*BLANKS                                   S01486
     C           DPMD      ANDGTDPDO
     C           SRPIN     ANDEQ'R'                                       S01176
     C                     MOVE 'RP'      ACTNTP
     C                     END
     C*
     C* Reverse repos
     C*
     C********** DPID      IFNE *ZEROS                                                        CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS
     C********** DPOD      ANDNE*ZEROS                                                        CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS
     C           DPAD      ANDNE*ZEROS
     C           SPTFR     ANDEQ*BLANKS                                   S01486
     C           DPDO      ANDGTDPMD
     C           SRPIN     ANDEQ'R'                                       S01176
     C                     MOVE 'RR'      ACTNTP
     C                     END
     C*
     C* Pledged Deposit                                                   S01176
     C*                                                                   S01176
     C********** DPID      IFNE *ZEROS                                                 S01176 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    S01176
     C********** DPOD      ANDNE*ZEROS                                                 S01176 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS                                    S01176
     C           DPAD      ANDNE*ZEROS                                    S01176
     C           SPTFR     ANDEQ*BLANKS                                   S01486
     C           DPMD      ANDGTDPDO                                      S01176
     C           SRPIN     ANDEQ'P'                                       S01176
     C                     MOVE 'PD'      ACTNTP                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Pledged Loan                                                      S01176
     C*                                                                   S01176
     C********** DPID      IFNE *ZEROS                                                 S01176 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPMD      ANDNE*ZEROS                                    S01176
     C********** DPOD      ANDNE*ZEROS                                                 S01176 CSD027
     C           DPOD      ANDNE*BLANKS                                                       CSD027
     C           DPDO      ANDNE*ZEROS                                    S01176
     C           DPAD      ANDNE*ZEROS                                    S01176
     C           DPDO      ANDGTDPMD                                      S01176
     C           SPTFR     ANDEQ*BLANKS                                   S01486
     C           SRPIN     ANDEQ'P'                                       S01176
     C                     MOVE 'PL'      ACTNTP                          S01176
     C                     END                                            S01176
     C/COPY WNCPYSRC,SE0070C169
     C*                                                                   E13648
     C* If Walk In/Out, default price to market price from security       E13648
     C* provided that price is not zero.                                  E18617
     C*                                                                   E13648
     C           ACTNTP    IFEQ 'WI'                                      E13648
     C           ACTNTP    OREQ 'WO'                                      E13648
     C           MKTP      IFEQ *ZEROS                                    E13648
     C           MKPR      ANDNE*ZEROS                                    E18617
     C/COPY WNCPYSRC,SE0070C190
     C                     Z-ADDMKPR      MKTP                            E13648
     C                     END                                            E13648
     C                     MOVE MKTP      BLNKTT 15                       E18617
     C           MKTP      IFEQ *ZEROS                                    E18617
     C           MKPR      ANDEQ*ZEROS                                    E18617
     C           BLNKTT    OREQ *BLANKS                                   E18617
     C           MKPR      ANDEQ*ZEROS                                    E18617
     C/COPY WNCPYSRC,SE0070C191
     C                     ADD  1         EC         49                   E18617
     C                     MOVEA' 220'    ERR,EC                          E18617
     C/COPY WNCPYSRC,SE0070C192
     C                     END                                            E18617
     C                     END                                            E13648
     C**                                                                  176510
     C*** PROFIT CENTRE DEFAULT MATRIX PROCESSING MOVED                   176510
     C**                                                                  176510
     C***************                                               S01117176510
     C***PROFIT*CENTRE IF USED                                      S01117176510
     C***************                                               S01117176510
     C************IN87     IFEQ '1'                                 S01117176510
     C***************                                               S01117176510
     C***IF*BLANK*FETCH DEFAULT                                     S01117176510
     C***************                                               S01117176510
     C***********SDPPC     IFEQ *BLANKS                             S01117176510
     C***************      MOVEL*BLANKS   DPPC                      S01117176510
     C***************      SETOF                     33             S01117176510
     C***************                                               S01117176510
     C***IF*AMENDMENT TYPE IS A WALK IN OR A WALK OUT LOOK UP ON    S01117176510
     C***CUSTOMER*POSITIONS PROFIT CENTRES FILE FOR DEFAULT         S01117176510
     C***************                                               S01117176510
     C***********ACTNTP    IFEQ 'WI'                                S01117176510
     C***********ACTNTP    OREQ 'WO'                                S01117176510
     C***********SEPCCK    CHAINSEPCCDF              33             S01117176510
     C************IN33     IFEQ '0'                                 S01117176510
     C***************      MOVELPCCU      DPPC                      S01117176510
     C***************      MOVELPCCU      SDPPC                     S01117176510
     C***************      END                                      S01117176510
     C***************      END                                      S01117176510
     C***************                                               S01117176510
     C***IF*NOT*ONE*OF THESE AMENDMENT TYPES OR RECORD NOT FOUND    S01117176510
     C***LOOK*UP*DEFAULT USING DEFAULT MATRIX IF PROFIT CENTRES     S01117176510
     C***DEFAULT*USED IS YES ON SDGELRPD                            S01117176510
     C***************                                               S01117176510
     C***********BKPCDU    IFEQ 'Y'                                 S01117176510
     C***********ACTNTP    IFNE 'WI'                                S01117176510
     C***********ACTNTP    ANDNE'WO'                                S01117176510
     C************IN33     OREQ '1'                                 S01117176510
     C***************      MOVELDPBN      @CNUM                     S01117176510
     C***************      CALL 'AOPRFMR0'                          S01117176510
     C***************      PARM *BLANKS   @RTC1   1                 S01117176510
     C***************      PARM DPBK      @BOOK   2                 S01117176510
     C***************      PARM *BLANKS   @TRTP   5                 S01117176510
     C***************      PARM *BLANKS   @SUTP   2                 S01117176510
     C***************      PARM DPBA      @BRAN   3                 S01117176510
     C***************      PARM *BLANKS   @DEPT   3                 S01117176510
     C***************      PARM USID      @USER  10                 S01117176510
     C***************      PARM *BLANKS   @ACOF   2                 S01117176510
     C***************      PARM           @CNUM   6                 S01117176510
     C***************      PARM *BLANKS   @PRFC   4                 S01117176510
     C***************                                               S01117176510
     C***********@RTC1     IFEQ '0'                                 S01117176510
     C***************      MOVEL@PRFC     DPPC                      S01117176510
     C***************      MOVEL@PRFC     SDPPC                     S01117176510
     C***************      END                                      S01117176510
     C***************                                               S01117176510
     C***************      END                                      S01117176510
     C***************      END                                      S01117176510
     C***************                                               CAC002176510
     C****If*Analytical Accounting is installed, profit centre is   CAC002176510
     C****mandatory*for Walk-In/Walk-out.                           CAC002176510
     C***************                                               CAC002176510
     C***********BGN0ST    IFEQ 'Y'                                 CAC002176510
     C***********SDPPC     ANDEQ*BLANKS                             CAC002176510
     c***************                                               CAC002176510
     C***********ACTNTP    IFEQ 'WI'                                CAC002176510
     C***********ACTNTP    OREQ 'WO'                                CAC002176510
     C***************      ADD  1         EC         55             CAC002176510
     C***************      MOVEA' 311'    ERR,EC                    CAC002176510
     C***************      ELSE                                     CAC002176510
     C***************      MOVELBVSEPC    DPPC                      CAC002176510
     C***************      MOVELBVSEPC    SDPPC                     CAC002176510
     C***************      ENDIF                                    CAC002176510
     C***************                                               CAC002176510
     C***************      ENDIF                                    CAC002176510
     C***************                                               S01117176510
     C***************      ELSE                                     S01117176510
     C***************                                               S01117176510
     C***ELSE*VERIFY*PROFIT CENTRE THAT WAS INPUT                   S01117176510
     C***************                                               S01117176510
     C***************                                               CAC002176510
     C****If*Analytical Accounting is installed, profit centre shouldAC002176510
     C****be*same*as*the customer profit centre for Walk-In/Walk-out.AC002176510
     C***************                                               CAC002176510
     C***********BGN0ST    IFEQ 'Y'                                 CAC002176510
     C***********ACTNTP    IFEQ 'WI'                                CAC002176510
     C***********ACTNTP    OREQ 'WO'                                CAC002176510
     C***********SEPCCK    CHAINSEPCCDF              37             CAC002176510
     C************IN37     IFEQ '0'                                 CAC002176510
     C***********SDPPC     ANDNEPCCU                                CAC002176510
     C***************      ADD  1         EC         55             CAC002176510
     C***************      MOVEA' 312'    ERR,EC                    CAC002176510
     C***************      ENDIF                                    CAC002176510
     C***************      ENDIF                                    CAC002176510
     C***************      ENDIF                                    CAC002176510
     C***************                                               CAC002176510
     C***************      CALL 'AOPRFCR0'                          S01117176510
     C***************      PARM *BLANKS   @RTCD                     S01117176510
     C***************      PARM '*KEY   ' @OPTN                     S01117176510
     C***************      PARM SDPPC     @PKEY   4                 S01117176510
     C***********SDPRFC    PARM SDPRFC    DSFDY                     S01117176510
     C***************                                               S01117176510
     C***********@RTCD     IFEQ *BLANKS                             S01117176510
     C***************      MOVELSDPPC     DPPC                      S01117176510
     C***************      ELSE                                     S01117176510
     C***************      ADD  1         EC         55             S01117176510
     C***************      MOVEA' 234'    ERR,EC                    S01117176510
     C***************      END                                      S01117176510
     C***************                                               S01117176510
     C***************      END                                      S01117176510
     C***************      END                                      S01117176510
     C***************                                               CAC005176510
     C***If*SAR*CAC005 is installed, check if user book-profit centreAC005176510
     C***combination*is valid                                       CAC005176510
     C***************                                               CAC005176510
     C***********CAC005    IFEQ 'Y'                                 CAC005176510
     C************IN46     ANDEQ*OFF                                CAC005176510
     C************IN55     ANDEQ*OFF                                CAC005176510
     C***************                                               CAC005176510
     C***************      CALL 'AOBKPCR0'                          CAC005176510
     C***************      PARM *BLANKS   PRTCD   7                 CAC005176510
     C***************      PARM '*PSEUDO' POPTN   7                 CAC005176510
     C***************      PARM DPBK      PBOOK   2                 CAC005176510
     C***************      PARM DPPC      PPRFC   4                 CAC005176510
     C***************      PARM           PPSCD   2                 CAC005176510
     C***************                                               CAC005176510
     C***********PRTCD     IFEQ *BLANKS                             CAC005176510
     C***************      MOVE PPSCD     DPBK                      CAC005176510
     C***************      ELSE                                     CAC005176510
     C***************      MOVE *ON       *IN55                     CAC005176510
     C***************      ADD  1         EC                        CAC005176510
     C***************      MOVEA' 463'    ERR,EC                    CAC005176510
     C***************      ENDIF                                    CAC005176510
     C***************      ENDIF                                    CAC005176510
      *                                                                   S01445
      *** Initialize all charge fields before validation updates their    S01445
      *** values.                                                         S01445
      *                                                                   S01445
     C                     MOVE *BLANKS   DCHC             Charge Code    S01445
     C                     MOVE *BLANKS   DCCE             Charge Ccy     S01445
     C                     Z-ADD*ZERO     DCHA             Charge Amt     S01445
     C                     Z-ADD*ZERO     DCSE             Settle. Mth    S01445
     C                     MOVE *BLANKS   DCAT             Settle. Acc    S01445
     C                     MOVE *BLANKS   DCAB             Settle. Brch   S01445
      *                                                                   S01445
      *** If Autocharge is switched on, and SAR 01445 is ON, validate     S01445
      *                                                                   S01445
     C           BVACOP    IFEQ 'Y'                        *B1            S01445
     C           S01445    ANDEQ'Y'                                       S01445
     C           CSE006    OREQ 'Y'                                       CSE006
      *                                                                   S01445
      *** If any charge values entered, go on to validate them            S01445
      *                                                                   S01445
     C           SCHC      IFNE *BLANK                     *B2            S01445
     C           SCCE      ORNE *BLANK                                    S01445
     C           SCHA      ORNE *BLANK                                    S01445
     C           SCSE      ORNE *BLANK                                    S01445
     C           SCAT      ORNE *BLANK                                    S01445
     C           SCAB      ORNE *BLANK                                    S01445
      *                                                                   S01445
      *** If depot movement is type=walk in/walk out, validate            S01445
      *** Otherwise, Error.                                               S01445
      *** Note that the depot movement type cannot be changed whilst      S01445
      *** in AMEND mode, hence DPMV is tested.                            S01445
      *                                                                   S01445
     C           ACTN      IFEQ 'I'                        *B3            S01445
     C           ACTNTP    ANDEQ'WI'                                      S01445
     C           ACTN      OREQ 'I'                                       S01445
     C           ACTNTP    ANDEQ'WO'                                      S01445
      *                                                                   S01445
     C           ACTN      OREQ 'A'                                       S01445
     C           DPMV      ANDEQ'WI'                                      S01445
     C           ACTN      OREQ 'A'                                       S01445
     C           DPMV      ANDEQ'WO'                                      S01445
      *                                                                   S01445
     C           CSE006    OREQ 'Y'                                       CSE006
     C           ACTNTP    ANDEQ'BB'                                      CSE006
     C           CSE006    OREQ 'Y'                                       CSE006
     C           ACTNTP    ANDEQ'BL'                                      CSE006
     C/COPY WNCPYSRC,SE0070C143
     C                     EXSR VALCHG                                    S01445
     C/COPY WNCPYSRC,SE0070C144
     C                     ELSE                            *X3            S01445
      *                                                                   S01445
     C                     ADD  1         EC                              S01445
     C                     MOVEA' 240'    ERR,EC                          S01445
     C                     MOVEA'111111'  *IN,70                          S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
     C*
     C* If action is 'A', movement type discerned from input must be
     C* same as on file - i.e. it can not be changed
     C*
     C           ACTN      IFEQ 'A'
     C           ACTNTP    ANDNEDPMV
     C                     ADD  1         EC
     C***********          MOVEA' 227'    ERR,EC                          S01176
     C***********          MOVEA' 232'    ERR,EC                   S01176 062720
     C                     MOVEA' 260'    ERR,EC                          062720
     C                     SETON                     414243               E13933
     C                     SETON                     44                   E13933
     C                     END
     C*
     C* Input mode - set up as movement type
     C*
     C           ACTN      IFEQ 'I'
     C                     MOVE ACTNTP    DPMV
     C                     END
     C*
     C** IF ACTION=D WITH ENTER PRESSED THEN ERROR                         -
     C*
     C                     ELSE
     C/COPY WNCPYSRC,SE0070C135
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,9     INFMSG
     C                     END
     C/COPY WNCPYSRC,SE0070C136
     C                     END
     C                     ELSE
     C*
     C** IF COMMAND 4 TAKEN
     C*
     C           AID       IFEQ '04'
     C*
     C** COMMAND 4 TAKEN CORRECTLY WHEN ACTION IS D-FORCE 'RECORD ADVANCE'
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVEL'RA'      AID
     C*
     C** COMMAND 4 TAKEN INCORRECTLY WHEN ACTION IS NOT D-HENCE ERROR
     C*
     C                     ELSE
     C                     MOVELINF,10    INFMSG
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*  (UNLESS ONLY W MSG & 2ND TIME WITH NO CHANGE)                    S01158
     C*
     C           EC        IFNE *ZERO
     C           WEC       IFEQ EC                                        S01158
     C           FIRST     ANDEQ'N'                                       S01158
     C           *IN19     ANDEQ'0'                                       S01158
     C                     ELSE                                           S01158
     C                     MOVELHI        ERRMSG
     C                     END                                            S01158
     C                     END
     C*
     C* Produce confirmation
     C*
     C                     MOVE 'Y'       DCFR
     C/COPY WNCPYSRC,SE0070C046
     C*
     C**                                                                  176510
     C*** PROFIT CENTRE DEFAULT MATRIX PROCESSING MOVED TO HERE           176510
     C**                                                                  176510
     C*                                                                   176510
     C*  PROFIT CENTRE IF USED                                            176510
     C*                                                                   176510
     C           *IN87     IFEQ '1'                                       176510
     C*                                                                   176510
     C*  IF BLANK FETCH DEFAULT                                           176510
     C*                                                                   176510
     C           SDPPC     IFEQ *BLANKS                                   176510
     C                     MOVEL*BLANKS   DPPC                            176510
     C                     SETOF                     33                   176510
     C*                                                                   176510
     C*  IF AMENDMENT TYPE IS A WALK IN OR A WALK OUT LOOK UP ON          176510
     C*  CUSTOMER POSITIONS PROFIT CENTRES FILE FOR DEFAULT               176510
     C*                                                                   176510
     C           ACTNTP    IFEQ 'WI'                                      176510
     C           ACTNTP    OREQ 'WO'                                      176510
     C           SEPCCK    CHAINSEPCCDF              33                   176510
     C           *IN33     IFEQ '0'                                       176510
     C                     MOVELPCCU      DPPC                            176510
     C                     MOVELPCCU      SDPPC                           176510
     C                     END                                            176510
     C                     END                                            176510
     C*                                                                   176510
     C*  IF NOT ONE OF THESE AMENDMENT TYPES OR RECORD NOT FOUND          176510
     C*  LOOK UP DEFAULT USING DEFAULT MATRIX IF PROFIT CENTRES           176510
     C*  DEFAULT USED IS YES ON SDGELRPD                                  176510
     C*                                                                   176510
     C           BKPCDU    IFEQ 'Y'                                       176510
     C           ACTNTP    IFNE 'WI'                                      176510
     C           ACTNTP    ANDNE'WO'                                      176510
     C           *IN33     OREQ '1'                                       176510
     C                     MOVELDPBN      @CNUM                           176510
     C                     CALL 'AOPRFMR0'                                176510
     C                     PARM *BLANKS   @RTC1   1                       176510
     C                     PARM DPBK      @BOOK   2                       176510
     C                     PARM *BLANKS   @TRTP   5                       176510
     C                     PARM *BLANKS   @SUTP   2                       176510
     C                     PARM DPBA      @BRAN   3                       176510
     C                     PARM *BLANKS   @DEPT   3                       176510
     C                     PARM USID      @USER  10                       176510
     C                     PARM           @ACOF   2                       176510
     C                     PARM           @CNUM   6                       176510
     C                     PARM *BLANKS   @PRFC   4                       176510
     C*                                                                   176510
     C           @RTC1     IFEQ '0'                                       176510
     C                     MOVEL@PRFC     DPPC                            176510
     C                     MOVEL@PRFC     SDPPC                           176510
     C                     END                                            176510
     C*                                                                   176510
     C                     END                                            176510
     C                     END                                            176510
      *                                                                   186484
     C           BGN0ST    IFEQ 'Y'                                       186484
     C           SDPPC     ANDEQ*BLANKS                                   186484
     C           *INU5     ANDEQ'1'                                       186484
     C                     CALL 'AOPCACR0'                                186484
     C                     PARM *BLANKS   WRTCD   7                       186484
     C                     PARM '*FIRST  'WOPTN   7                       186484
     C           SDPCAC    PARM SDPCAC    DSFDY                           186484
     C           WRTCD     IFEQ *BLANKS                                   186484
     C                     MOVELFTUAPC    DPPC                            186484
     C                     MOVELFTUAPC    SDPPC                           186484
     C                     ENDIF                                          186484
     C                     ENDIF                                          186484
     C*                                                                   176510
     C*   If Analytical Accounting is installed, profit centre is         176510
     C*   mandatory for Walk-In/Walk-out.                                 176510
     C*                                                                   176510
     C           BGN0ST    IFEQ 'Y'                                       176510
     C           SDPPC     ANDEQ*BLANKS                                   176510
     C*                                                                   176510
     C           ACTNTP    IFEQ 'WI'                                      176510
     C           ACTNTP    OREQ 'WO'                                      176510
     C                     ADD  1         EC         55                   176510
     C                     MOVEA' 311'    ERR,EC                          176510
     C                     ELSE                                           176510
     C                     MOVELBVSEPC    DPPC                            176510
     C                     MOVELBVSEPC    SDPPC                           176510
     C                     ENDIF                                          176510
     C*                                                                   176510
     C                     ENDIF                                          176510
     C*                                                                   176510
     C                     ELSE                                           176510
     C*                                                                   176510
     C*  ELSE VERIFY PROFIT CENTRE THAT WAS INPUT                         176510
     C*                                                                   176510
     C*                                                                   176510
     C*   If Analytical Accounting is installed, profit centre shoul      176510
     C*   be same as the customer profit centre for Walk-In/Walk-out      176510
     C*                                                                   176510
     C           BGN0ST    IFEQ 'Y'                                       176510
     C           ACTNTP    IFEQ 'WI'                                      176510
     C           ACTNTP    OREQ 'WO'                                      176510
     C           SEPCCK    CHAINSEPCCDF              37                   176510
     C           *IN37     IFEQ '0'                                       176510
     C           SDPPC     ANDNEPCCU                                      176510
     C                     ADD  1         EC         55                   176510
     C                     MOVEA' 312'    ERR,EC                          176510
     C                     ENDIF                                          176510
     C                     ENDIF                                          176510
     C                     ENDIF                                          176510
     C*                                                                   176510
     C                     CALL 'AOPRFCR0'                                176510
     C                     PARM *BLANKS   @RTCD                           176510
     C                     PARM '*KEY   ' @OPTN                           176510
     C                     PARM SDPPC     @PKEY   4                       176510
     C           SDPRFC    PARM SDPRFC    DSFDY                           176510
     C*                                                                   176510
     C           @RTCD     IFEQ *BLANKS                                   176510
     C                     MOVELSDPPC     DPPC                            176510
     C                     ELSE                                           176510
     C                     ADD  1         EC         55                   176510
     C                     MOVEA' 234'    ERR,EC                          176510
     C                     END                                            176510
     C*                                                                   176510
     C                     END                                            176510
     C                     END                                            176510
     C*                                                                   176510
     C*  If SAR CAC005 is installed, check if user book-profit centr      176510
     C*  combination is valid                                             176510
     C*                                                                   176510
     C           CAC005    IFEQ 'Y'                                       176510
     C           *IN46     ANDEQ*OFF                                      176510
     C           *IN55     ANDEQ*OFF                                      176510
     C*                                                                   176510
     C                     CALL 'AOBKPCR0'                                176510
     C                     PARM *BLANKS   PRTCD   7                       176510
     C                     PARM '*PSEUDO' POPTN   7                       176510
     C                     PARM DPBK      PBOOK   2                       176510
     C                     PARM DPPC      PPRFC   4                       176510
     C                     PARM           PPSCD   2                       176510
     C*                                                                   176510
     C           PRTCD     IFEQ *BLANKS                                   176510
     C                     MOVE PPSCD     DPBK                            176510
     C                     ELSE                                           176510
     C                     MOVE *ON       *IN55                           176510
     C                     ADD  1         EC                              176510
     C                     MOVEA' 463'    ERR,EC                          176510
     C                     ENDIF                                          176510
     C                     ENDIF                                          176510
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************   S01445
      *                                                               *   S01445
      *  VALCHG - Subroutine to Validate Charge fields.               *   S01445
      *                                                               *   S01445
      *  Called By: VALIDD                                            *   S01445
      *                                                               *   S01445
      *  Calls:     VALCAT                                            *   S01445
      *                                                               *   S01445
      *****************************************************************   S01445
     C           VALCHG    BEGSR                                       ** S01445
      *                                                                   S01445
      *** Validate Charge Currency                                        S01445
      *                                                                   S01445
     C           SCCE      IFEQ *BLANKS                    *B1            S01445
     C                     ADD  1         EC         71                   S01445
     C                     MOVEA' 243'    ERR,EC                          S01445
     C                     ELSE                            *X1            S01445
      *                                                                   S01445
     C                     CALL 'AOCURRR0'                                S01445
     C                     PARM *BLANKS   @RTCD                           S01445
     C                     PARM '*KEY'    @OPTN                           S01445
     C                     PARM SCCE      @CCY                            S01445
     C           SDCURR    PARM SDCURR    DSSDY                           S01445
      *                                                                   S01445
     C           @RTCD     IFNE *BLANK                     *B2            S01445
     C                     ADD  1         EC         71                   S01445
     C                     MOVEA' 244'    ERR,EC                          S01445
     C                     ELSE                            *X2            S01445
     C                     MOVE SCCE      DCCE                            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *** Validate Charge Code (only if charge currency is valid)         S01445
      *                                                                   S01445
     C           *IN71     IFEQ *OFF                       *B1            S01445
     C           SCHC      IFEQ *BLANKS                    *B2            S01445
     C                     ADD  1         EC         70                   S01445
     C                     MOVEA' 241'    ERR,EC                          S01445
     C                     ELSE                            *X2            S01445
      *                                                                   S01445
     C                     CALL 'AOCHGTR0'                                S01445
     C                     PARM *BLANKS   @RTCD                           S01445
     C                     PARM '*KEY'    @OPTN                           S01445
     C                     PARM SCCE      @CCY    3                       S01445
     C                     PARM SCHC      @CCOM   2                       S01445
     C           SECGT     PARM SECGT     DSFDY                           S01445
      *                                                                   S01445
     C           @RTCD     IFNE *BLANK                     *B3            S01445
     C                     ADD  1         EC         70                   S01445
     C                     MOVEA' 242'    ERR,EC                          S01445
     C                     ELSE                            *X3            S01445
     C                     MOVE SCHC      DCHC                            S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *** Validate Charge Amount (only if currency is valid)              S01445
      *                                                                   S01445
     C           *IN71     IFEQ *OFF                       *B1            S01445
     C           SCHA      IFEQ *BLANKS                    *B2            S01445
     C                     ADD  1         EC         72                   S01445
     C                     MOVEA' 245'    ERR,EC                          S01445
     C                     ELSE                            *X2            S01445
      *                                                                   S01445
     C                     MOVE *BLANKS   ZFIELD                          S01445
     C                     MOVE SCHA      ZFIELD                          S01445
     C                     Z-ADDA6NBDP    ZADEC            From SDCURR    S01445
     C           13        SUB  A6NBDP    ZADIG                           S01445
     C                     EXSR ZALIGN                                    S01445
      *                                                                   S01445
     C           *IN99     IFEQ '1'                        *B3            S01445
     C                     ADD  1         EC         72                   S01445
     C                     MOVEA' 246'    ERR,EC                          S01445
     C                     Z-ADD*ZEROS    DCHA                            S01445
     C                     ELSE                            *X3            S01445
     C                     MOVE ZFIELD    DCHA                            S01445
      *                                                                   S01445
     C           DCHA      IFEQ *ZEROS                     *B4            S01445
     C                     ADD  1         EC         72                   S01445
     C                     MOVEA' 246'    ERR,EC                          S01445
     C                     END                             *E4            S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *** Validate Charge Settlement Method:                              S01445
      ***  - Settlement methods 00 and 05 are valid                       S01445
      ***  - Settlement methods 04 and 14 are only valid if retail        S01445
      ***    module is switched on                                        S01445
      *                                                                   S01445
     C           SCSE      IFNE '00'                       *B1            S01445
     C           SCSE      ANDNE'05'                                      S01445
      *                                                                   S01445
     C           BGRTBN    IFEQ 'N'                        *B2            S01445
     C                     ADD  1         EC         73                   S01445
     C                     MOVEA' 247'    ERR,EC                          S01445
     C                     ELSE                            *X2            S01445
      *                                                                   S01445
     C           SCSE      IFNE '04'                       *B3            S01445
     C           SCSE      ANDNE'14'                                      S01445
     C                     ADD  1         EC         73                   S01445
     C                     MOVEA' 247'    ERR,EC                          S01445
     C                     ELSE                            *X3            S01445
     C                     MOVE SCSE      DCSE                            S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     ELSE                            *X1            S01445
     C                     MOVE SCSE      DCSE                            S01445
     C                     END                             *E1            S01445
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CVSF                                           S01408
     C*                                                                   S01408
      *                                                                   S01445
      *** Validate Charge Settlement Branch                               S01445
      ***   - if multi-branching off, set branch to default branch        S01445
      *                                                                   S01445
     C           MBIN      IFNE 'Y'                        *B1            S01445
     C                     MOVE DPBA      SCAB             FLD USED LATER S01445
     C                     MOVE SCAB      DCAB                            S01445
     C                     ELSE                            *X1            S01445
      *                                                                   S01445
     C                     MOVE SCAB      DCAB                            S01445
      *                                                                   S01445
     C           SCSE      IFNE '05'                       *B2            S01445
     C           SCAB      ANDNE*BLANKS                                   S01445
     C                     ADD  1         EC         75                   S01445
     C                     MOVEA' 248'    ERR,EC                          S01445
     C                     END                             *E2            S01445
      *                                                                   S01445
     C           SCSE      IFEQ '05'                       *B2            S01445
     C           SCAB      IFEQ *BLANKS                    *B3            S01445
     C                     ADD  1         EC         75                   S01445
     C                     MOVEA' 249'    ERR,EC                          S01445
     C                     ELSE                            *X3            S01445
      *                                                                   S01445
     C**********           CALL 'AOBRCHR0'                                             S01445 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01445
     C                     PARM '*KEY   ' @OPTN   7                       S01445
     C                     PARM SCAB      @DSNB   3                       S01445
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01445 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01445
      ***  Invalid Branch                                                 S01445
     C           @RTCD     IFNE *BLANKS                    *B4            S01445
     C                     ADD  1         EC         75                   S01445
     C                     MOVEA' 250'    ERR,EC                          S01445
     C                     END                             *E4            S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *** Only go on to validate settlement account if both settlement    S01445
      *** method and branch are valid.                                    S01445
     C           *IN73     IFEQ *OFF                       *B1            S01445
     C           *IN75     ANDEQ*OFF                                      S01445
     C                     EXSR VALCAT                                    S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
     C                     ENDSR                                          S01445
      *****************************************************************   S01445
      /EJECT                                                              S01445
      *****************************************************************   S01445
      *                                                               *   S01445
      *  VALCAT - Subroutine to validate settlement account           *   S01445
      *                                                               *   S01445
      *  Called By: VALCHG                                            *   S01445
      *  Calls:     None.                                             *   S01445
      *                                                               *   S01445
      *****************************************************************   S01445
     C           VALCAT    BEGSR                                       ** S01445
      *                                                                   S01445
      *** Initialise database field                                       S01445
      *                                                                   S01445
     C                     MOVE SCAT      DCAT                            S01445
      *                                                                   S01445
      *** Charge Settlement method  = 00                                  S01445
      *                                                                   S01445
     C           SCSE      IFEQ '00'                       *B1            S01445
     C           SCAT      IFNE *BLANKS                    *B2            S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 251'    ERR,EC                          S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *** Charge Settlement method  = 04                                  S01445
      *                                                                   S01445
     C           SCSE      IFEQ '04'                       *B1            S01445
     C           SCAT      IFNE *BLANKS                    *B2            S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 251'    ERR,EC                          S01445
     C                     ELSE                            *X2            S01445
      *                                                                   S01445
     C                     MOVELDPBN      @CNUM                           S01445
     C                     CALL 'AOACCTR0'                                S01445
     C                     PARM *BLANKS   @RTCD                           S01445
     C                     PARM '*KEY   ' @OPTN                           S01445
     C                     PARM *BLANKS   @RETL  10                       S01445
     C                     PARM           @CNUM                           S01445
     C                     PARM SCCE      @CUCD   3                       S01445
     C**********           PARM BMACCD    @ACCD   4                                    S01445 CGL029
     C                     PARM BMACCD    @ACCD  10                                           CGL029
     C                     PARM '01'      @ACSQ   2                       S01445
     C                     PARM DPBA      @BRCA   3                       S01445
     C           ACCNT     PARM ACCNT     DSSDY                           S01445
      *                                                                   S01445
     C           @RTCD     IFNE *BLANKS                    *B3            S01445
     C           @RTCD     OREQ *BLANKS                                   S01445
     C           RECI2     ANDNE'D'                                       S01445
     C                     ADD  1         EC                              S01445
     C                     SETON                     7374                 S01445
     C                     MOVEA' 252'    ERR,EC                          S01445
     C                     ELSE                            *X3            S01445
     C                     MOVE BRCA      UHCAB   3                       S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *** Charge Settlement method  = 05                                  S01445
      *                                                                   S01445
     C           SCSE      IFEQ '05'                       *B1            S01445
     C           DIGITS    CHECKSCAT                     90               S01445
     C           *IN90     IFEQ *ON                        *B2            S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 253'    ERR,EC                          S01445
     C                     ELSE                            *X2            S01445
      *                                                                   S01445
     C           6         SUBSTSCAT:1    UHCNUM  6                       S01445
     C********** 4         SUBSTSCAT:7    UHACCD  4                                    S01445 CGL029
     C********** 2         SUBSTSCAT:11   UHACSQ  2                                    S01445 CGL029
     C           10        SUBSTSCAT:7    UHACCD 10                                           CGL029
     C           2         SUBSTSCAT:17   UHACSQ  2                                           CGL029
      *                                                                   S01445
     C                     CALL 'AOACCTR0'                                S01445
     C                     PARM *BLANKS   @RTCD                           S01445
     C                     PARM '*KEY   ' @OPTN                           S01445
     C                     PARM *BLANKS   @RETL                           S01445
     C                     PARM UHCNUM    @CNUM                           S01445
     C                     PARM SCCE      @CUCD                           S01445
     C                     PARM UHACCD    @ACCD                           S01445
     C                     PARM UHACSQ    @ACSQ                           S01445
     C                     PARM SCAB      @BRCA                           S01445
     C           ACCNT     PARM ACCNT     DSSDY                           S01445
      *                                                                   S01445
     C           @RTCD     IFNE *BLANKS                    *B3            S01445
     C           @RTCD     OREQ *BLANKS                                   S01445
     C           RECI2     ANDNE'D'                                       S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 254'    ERR,EC                          S01445
     C                     ELSE                            *X3            S01445
     C                     MOVE SCAT      DCAT                            S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *** Charge Settlement method  = 14                                  S01445
      *                                                                   S01445
     C           SCSE      IFEQ '14'                       *B1            S01445
      *                                                                   S01445
     C           10        SUBSTSCAT:1    UHRETL 10                       S01445
     C********** 2         SUBSTSCAT:11   UHEND   2        10 DIGIT ?                  S01445 CGL029
     C           2         SUBSTSCAT:17   UHEND   2                                           CGL029
     C           UHEND     IFEQ *BLANKS                    *B2            S01445
     C           DIGITS    CHECKUHRETL                   90 NUMERIC ?     S01445
     C                     END                             *E2            S01445
      *                                                                   S01445
     C           UHEND     IFNE *BLANKS                    *B2            S01445
     C           *IN90     OREQ *ON                                       S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 255'    ERR,EC                          S01445
     C                     ELSE                            *X2            S01445
      *                                                                   S01445
     C                     CALL 'AOACCTR0'                                S01445
     C                     PARM *BLANKS   @RTCD                           S01445
     C                     PARM '*KEY   ' @OPTN                           S01445
     C                     PARM UHRETL    @RETL                           S01445
     C                     PARM *BLANKS   @CNUM                           S01445
     C                     PARM *BLANKS   @CUCD                           S01445
     C                     PARM *BLANKS   @ACCD                           S01445
     C                     PARM *BLANKS   @ACSQ                           S01445
     C                     PARM *BLANKS   @BRCA                           S01445
     C           ACCNT     PARM ACCNT     DSSDY                           S01445
      *                                                                   S01445
     C           @RTCD     IFNE *BLANKS                    *B3            S01445
     C           @RTCD     OREQ *BLANKS                                   S01445
     C           RECI2     ANDNE'D'                                       S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 255'    ERR,EC                          S01445
     C                     ELSE                            *X3            S01445
      *                                                                   S01445
      **  Check currency of Account is correct                            S01445
      *                                                                   S01445
     C           CCY2      IFNE SCCE                       *B4            S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 256'    ERR,EC                          S01445
     C                     ELSE                            *X4            S01445
      *                                                                   S01445
     C                     MOVE SCAT      DCAT                            S01445
     C                     MOVE BRCA      UHCAB                           S01445
     C                     END                             *E4            S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *                                                                   S01445
      *** If settlement method = 04, 05, or 14 then if                    S01445
      *** date account opened is greater than movement date in OR         S01445
      *** account status is 'C' then error                                S01445
      *                                                                   S01445
     C           *IN74     IFEQ '0'                        *B1            S01445
     C           *IN73     ANDEQ'0'                                       S01445
     C           SCSE      IFEQ '04'                       *B2            S01445
     C           SCSE      OREQ '05'                                      S01445
     C           SCSE      OREQ '14'                                      S01445
      *                                                                   S01445
      *** Get date for walk-in/walk-out                                   S01445
      *                                                                   S01445
     C           DPMD      IFNE *ZERO                      *B3            S01445
     C                     Z-ADDDPMD      MVTDTE  60                      S01445
     C                     ELSE                            *X3            S01445
     C                     Z-ADDDPDO      MVTDTE                          S01445
     C                     END                             *E3            S01445
      *                                                                   S01445
      *** If account opened date is greater than walk-in/out date,        S01445
      *** error or Account Status is 'C' (closed) then Error              S01445
      *                                                                   S01445
     C           DACO      IFGT MVTDTE                     *B3            S01445
     C           ACST      OREQ 'C'                                       S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 257'    ERR,EC                          S01445
     C                     END                             *E3            S01445
      *                                                                   S01445
      ** If 2nd bit is ON, Error - account is blocked for money leaving   S01445
      *                                                                   S01445
     C                     TESTB'2'       RETB       99                   S01445
     C           *IN99     IFEQ '0'                        *B3            S01445
     C                     ADD  1         EC         74                   S01445
     C                     MOVEA' 258'    ERR,EC                          S01445
     C                     END                             *E3            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CVS1                                           S01408
     C*                                                                   S01408
      *                                                                   S01445
     C                     ENDSR                                          S01445
      *****************************************************************   S01445
      /EJECT                                                              S01445
      *****************************************************************
      *                                                               *
      *  INITRC - Subroutine to Initialise all File fields.           *
      *                                                               *
      *  Called By: UPDATE                                            *
      *             UPDFLS                                            *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           INITRC    BEGSR                           *** INITRC ***
     C*
     C** INITIALIZE ALL DATA ON RECORD DEFINED IN DETREC (KEY EXCLUDED)
     C*
     C                     MOVEL*BLANK    DETREC
     C                     Z-ADD*ZERO     DPMD
     C                     Z-ADD*ZERO     DPDO
     C************         Z-ADD*ZERO     DPBC                            S01117
     C                     MOVE *BLANKS   DPBA                            S01117
     C                     Z-ADD*ZERO     ORED
     C                     Z-ADD*ZERO     LCD
     C                     Z-ADD*ZERO     TNLU
     C*                                                                   102060
     C** Initialize PM field for output on DPTMVD                         102060
     C*                                                                   102060
     C                     Z-ADD0         CYLD                            102060
      *
      ** Initialize new CSE006 fields on DPTMVD                           CSE006
     C                     Z-ADD0         DVIN                            CSE006
     C                     Z-ADD0         DMIN                            CSE006
     C                     Z-ADD0         DEXRT                           CSE006
     C                     MOVE *BLANKS   DFROM                           CSE006
      *                                                                   CSE006
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  TRSFS  - Subroutine to Format record fields for Screen.      *
      *                                                               *
      *  Called By: UPDATE                                            *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           TRSFS     BEGSR                           *** TRSFS  ***
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C* In depot
     C*
     C                     MOVE *BLANKS   SDPID
     C********** DPID      IFNE *ZEROS                                                        CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C                     MOVELDPID      SDPID
     C                     END
     C/COPY WNCPYSRC,SE0070C170
     C*
     C* In date
     C*
     C                     MOVE *BLANKS   SDPMD
     C           DPMD      IFNE *ZEROS
     C           DPMD      IFNE 99999
     C                     Z-ADDDPMD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDPMD
     C                     ELSE
     C                     MOVE '999999'  SDPMD
     C                     END
     C                     END
     C*
     C* Out depot
     C*
     C                     MOVE *BLANKS   SDPOD
     C********** DPOD      IFNE *ZEROS                                                        CSD027
     C           DPOD      IFNE *BLANKS                                                       CSD027
     C                     MOVELDPOD      SDPOD
     C                     END
     C/COPY WNCPYSRC,SE0070C171
     C*
     C* Out date
     C*
     C                     MOVE *BLANKS   SDPDO
     C           DPDO      IFNE *ZEROS
     C           DPDO      IFNE 99999
     C                     Z-ADDDPDO      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SDPDO
     C                     ELSE
     C                     MOVE '999999'  SDPDO
     C                     END
     C                     END
     C*
     C* Branch code
     C*
     C***********DPBC      IFNE *ZEROS                                    S01117
     C***********          MOVE DPBC      SDPBC                           S01117
     C           DPBA      IFNE *BLANKS                                   S01117
     C                     MOVE DPBA      SDPBA                           S01117
     C                     ELSE
     C***********          MOVE '   '     SDPBC                           S01117
     C                     MOVE '   '     SDPBA                           S01117
     C                     END
     C*                                                                   S01117
     C* Originating Branch code                                           S01117
     C*                                                                   S01117
     C           ORBR      IFNE *BLANKS                                   S01117
     C                     MOVELORBR      SORBR                           S01117
     C                     ELSE                                           S01117
     C                     MOVE '   '     SORBR                           S01117
     C                     END                                            S01117
     C*
     C* Book code
     C*
     C                     MOVE DPBK      SDPBK
      *                                                                   CAC005
      ** If CAC005 is installed, retrieve the user book                   CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD                           CAC005
     C                     PARM '*USER  ' POPTN                           CAC005
     C                     PARM           PBOKC   2                       CAC005
     C                     PARM           PPRFC   4                       CAC005
     C                     PARM DPBK      PPSBK   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE PBOKC     SDPBK                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
     C*
     C* Beneficial customer
     C*
     C                     MOVE *BLANKS   SDPBN
     C********** DPBN      IFNE *ZEROS                                                        CSD027
     C           DPBN      IFNE *BLANKS                                                       CSD027
     C                     MOVELDPBN      SDPBN
     C/COPY WNCPYSRC,SE0070C260
     C                     END
     C*
     C* Nominal amount
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE DPNA      ZFIELD
     C           DPSS      CHAINSECTYDF              33
     C                     Z-ADDNMDP      ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SDPNA
     C*
     C* Narrative
     C*
     C                     MOVE DPNR      SDPNR
     C*
     C* Market price
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MKTP      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SDPMP
     C*
     C**
     C**Associated*deal*number*****************************************   S01176
     C***********                                                         S01176
     C***********DPAD      IFNE *ZEROS                                    S01176
     C***********          MOVE DPAD      SDPAD                           S01176
     C***********          ELSE                                           S01176
     C***********          MOVE *BLANKS   SDPAD                           S01176
     C***********          END                                            S01176
     C*                                                                   S01176
     C***  If switch U2 is off (i.e. Deals module is not present)         S01176
     C***  protect & non-display the following fields.                    S01176
     C*                                                                   S01176
     C           *INU2     IFEQ '0'                                       S01176
     C                     MOVE '1'       *IN07                           S01176
     C                     MOVE '1'       *IN08                           S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     MOVE '0'       *IN07                           S01176
     C                     MOVE '0'       *IN08                           S01176
     C* Associated deal number                                            S01176
     C*                                                                   S01176
     C           DPAD      IFNE *ZEROS                                    S01176
     C                     MOVE DPAD      SDPAD                           S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   SDPAD                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Switch Reference                                                  S01176
     C*                                                                   S01176
     C                     MOVE SWRF      SSWRF                           S01176
     C*                                                                   S01176
     C* Repo/Pledge Indicator                                             S01176
     C*                                                                   S01176
     C                     MOVE *BLANK    SRPIN                           103853
     C*                                                                   103853
     C           DPMV      IFEQ 'RR'                                      S01176
     C           DPMV      OREQ 'RP'                                      S01176
     C                     MOVE 'R'       SRPIN                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           DPMV      IFEQ 'PD'                                      S01176
     C           DPMV      OREQ 'PL'                                      S01176
     C                     MOVE 'P'       SRPIN                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Switch In/Out Indicator                                           S01176
     C*                                                                   S01176
     C                     MOVE SIOI      SSIOI                           S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01486
     C** IS BENEFICIARY CUSTOMER A PORTFOLIO CUSTOMER ?                   S01486
     C*                                                                   S01486
     C                     MOVE 'N'       WWPLCS                          CPB001
     C           *INU4     IFEQ '1'                                       S01486
     C********** DPBN      ANDNE0                                                      S01486 CSD027
     C           DPBN      ANDNE*BLANKS                                                       CSD027
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C                     MOVEL*BLANKS   WWCLIN                          S01486
     C                     MOVELDPBN      WWCLIN                          S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM '*MSG   ' WWRTCD  7                       S01486
     C                     PARM '*VERIFY' WWOPTN  7                       S01486
     C                     PARM WWCLIN    WWKY10 10                       S01486
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01486
     C           WWRTCD    IFEQ *BLANKS                                   S01486
     C                     MOVE 'Y'       WWPLCS  1                       S01486
     C                     ELSE                                           080673
     C                     MOVE 'N'       WWPLCS                          080673
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   CPB001
     C** Is beneficiary customer a Private Banking Customer?              CPB001
     C*                                                                   CPB001
     C                     MOVE 'N'       WWPBCS  1                       CPB001
     C           *INU4     IFEQ '1'                                       CPB001
     C********** DPBN      ANDNE0                                                      CPB001 CSD027
     C           DPBN      ANDNE*BLANKS                                                       CSD027
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C*                                                                   CPB001
     C                     MOVEL*BLANKS   WWCLIN                          CPB001
     C                     MOVELDPBN      WWCLIN                          CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM WWCLIN    @KEY1  10                       CPB001
     C                     PARM *BLANKS   @KYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPB001
     C           @RTCD     IFEQ *BLANKS                                   CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVE 'Y'       WWPBCS                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C                     MOVE CWDI      SCWDI                           063760
     C*                                                                   S01486
     C* PORTFOLIO MODULE IS ON                                            S01486
     C* AND BENEFICIARY CUSTOMER IS PORTFOLIO CUSTOMER                    S01486
     C           *INU4     IFEQ '1'                        1              S01486
     C           WWPLCS    ANDEQ'Y'                                       S01486
     C           *INU4     OREQ '1'                        1              CPB001
     C           WWPBCS    ANDEQ'Y'                                       CPB001
     C**********           MOVE '0'       *IN13                    S01486 CPB001
     C*                                                                   S01486
     C* PORTFOLIO REFERENCE                                               S01486
     C           PTFR      IFEQ '9997'                     B2             S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    SPTFR                           S01486
     C                     ELSE                            X2             S01486
     C                     MOVE PTFR      SPTFR                           S01486
     C                     END                             E2             S01486
     C*                                                                   056990
     C***********          MOVE CWDI      SCWDI                    056990 063760
     C*                                                                   S01486
     C**   FX RATE                                                        S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C           SPXR      IFEQ 0                          B2             S01486
     C                     MOVE *BLANK    SSPXR                           S01486
     C                     ELSE                            X2             S01486
     C                     MOVE *BLANK    ZFLD15                          S01486
     C                     MOVE SPXR      ZFLD15                          S01486
     C                     Z-ADD8         ZDECS                           S01486
     C                     MOVE *BLANK    ZECODE                          S01486
     C                     EXSR ZSEDIT                                    S01486
     C                     MOVE ZOUT21    SSPXR                           S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C**   MULTIPLY/DIVIDE INDICATOR                                      S01486
     C                     MOVE SPMD      SSPMD                           S01486
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C**   AVERAGE YIELD RATE                                             S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C           CYLD      IFEQ 0                          B2             S01486
     C                     MOVE *BLANK    SCYLD                           S01486
     C                     ELSE                            X2             S01486
     C                     MOVE *BLANK    ZFLD15                          S01486
     C                     MOVE CYLD      ZFLD15                          S01486
     C                     Z-ADD7         ZDECS                           S01486
     C                     MOVE *BLANK    ZECODE                          S01486
     C                     EXSR ZSEDIT                                    S01486
     C                     MOVE ZOUT21    WWFL13 13                       S01486
     C                     MOVELWWFL13    SCYLD                           S01486
     C                     END                             E2             S01486
     C                     ENDIF                                          CPB001
     C                     ELSE                            X1             S01486
     C**********           MOVE '1'       *IN13                    S01486 CPB001
     C                     MOVE 'N'       WWPLCS                          S01486
     C                     END                             E1             S01486
     C*                                                                   CPB001
     C* PURCHASED INTEREST, MOUVEMENT SUBTYPE, ACCRUED INDICATOR          CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C*                                                                   CPB001
     C                     CALL 'AOCURRR0'                                CPB001
     C                     PARM '*DBERR  '@RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM NMCY      @AJCD   3                       CPB001
     C           SDCURR    PARM SDCURR    DSSDY                           CPB001
     C*                                                                   CPB001
     C                     Z-ADDA6NBDP    NOMDP                           CPB001
     C                     MOVE MSTP      SMSTP                           CPB001
     C                     MOVE ACIN      SACIN                           CPB001
      *                                                                   CPB001
     C           PINT      IFNE *ZEROS                                    CPB001
     C                     MOVE *BLANKS   ZFLD15                          CPB001
     C                     MOVE PINT      ZFLD15                          CPB001
     C                     Z-ADDNOMDP     ZDECS                           CPB001
     C                     MOVE *BLANK    ZECODE                          CPB001
     C                     EXSR ZSEDIT                                    CPB001
     C                     MOVE ZOUT21    SPINT                           CPB001
     C                     MOVE *HIVAL    SAPINT                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *BLANKS   SPINT                           CPB001
     C                     MOVE *BLANKS   SAPINT                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C           *INU4     IFEQ '1'                                       CPB001
     C           WWPLCS    ANDEQ'Y'                                       CPB001
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WWPBCS    ANDEQ'Y'                                       CPB001
     C                     MOVE *OFF      *IN13                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *ON       *IN13                           CPB001
     C                     ENDIF                                          CPB001
     C*
     C* PROFIT CENTRE                                                     S01117
     C*                                                                   S01117
     C                     MOVELDPPC      SDPPC                           S01117
      *                                                                   S01445
      *** Output new charge fields only if autocharge and S01445 are ON   S01445
      *                                                                   S01445
     C           *IN09     IFEQ '0'                        *B1            S01445
     C                     MOVE DCHC      SCHC             Charge Code    S01445
     C                     MOVE DCCE      SCCE             Charge Ccy     S01445
      *                                                                   S01445
     C           DCCE      IFNE *BLANKS                    *B2            S01445
     C                     CALL 'AOCURRR0'                                S01445
     C                     PARM '*DBERR'  @RTCD                           S01445
     C                     PARM '*KEY'    @OPTN                           S01445
     C                     PARM DCCE      @CCY                            S01445
     C           SDCURR    PARM SDCURR    DSSDY                           S01445
      *                                                                   S01445
     C                     MOVE *BLANKS   ZFIELD                          S01445
     C                     MOVE DCHA      ZFIELD           Charge Amt     S01445
     C                     Z-ADDA6NBDP    ZADEC            From SDCURR    S01445
     C                     EXSR ZEDIT                                     S01445
     C                     MOVE ZFIELD    SCHA                            S01445
     C                     ELSE                            *X2            S01445
     C                     MOVE *BLANKS   SCHA                            S01445
     C                     END                             *E2            S01445
     C*                                                                   S01445
      *** If Settlement type = zero, and depot movement is a walk-in/     S01445
      *** out, then output '00' rather than spaces                        S01445
      *                                                                   S01445
     C           DCSE      IFEQ *ZERO                      *B2            S01445
     C           DPMV      IFEQ 'WI'                       *B3            S01445
     C           DCHA      ANDNE*ZERO                                     S01445
     C           DPMV      OREQ 'WO'                                      S01445
     C           DCHA      ANDNE*ZERO                                     S01445
     C                     MOVE '00'      SCSE             Stl Type       S01445
     C                     ELSE                            *X3            S01445
     C                     MOVE *BLANKS   SCSE                            S01445
     C                     END                             *E3            S01445
      *                                                                   S01445
     C                     ELSE                            *X2            S01445
     C                     MOVE DCSE      SCSE                            S01445
     C                     END                             *E2            S01445
     C*                                                                   S01445
     C           DCSE      IFEQ 4                          *B2            S01445
     C           DCSE      OREQ 14                                        S01445
     C                     MOVE *BLANKS   SCAB                            S01445
     C                     ELSE                            *X2            S01445
     C                     MOVE DCAB      SCAB             Stl Branch     S01445
     C                     END                             *E2            S01445
      *                                                                   S01445
     C                     MOVE DCAT      SCAT             Stl Acct       S01445
      *                                                                   S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      ***  If Private Banking Module is Active                            CPB001
      ***  Check new fields Purchase interest, Accrued Indicator          CPB001
      ***  and Movement SubType                                           CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C*                                                                   CPB001
     C                     CALL 'AOCURRR0'                                CPB001
     C                     PARM '*DBERR  '@RTCD   7                       CPB001
     C                     PARM '*KEY   ' @OPTN   7                       CPB001
     C                     PARM NMCY      @AJCD   3                       CPB001
     C           SDCURR    PARM SDCURR    DSSDY                           CPB001
     C*                                                                   CPB001
     C                     Z-ADDA6NBDP    NOMDP                           CPB001
     C                     MOVE MSTP      SMSTP                           CPB001
     C                     MOVE ACIN      SACIN                           CPB001
      *                                                                   CPB001
     C           PINT      IFNE *ZEROS                                    CPB001
     C                     MOVE *BLANKS   ZFLD15                          CPB001
     C                     MOVE PINT      ZFLD15                          CPB001
     C                     Z-ADDNOMDP     ZDECS                           CPB001
     C                     MOVE *BLANK    ZECODE                          CPB001
     C                     EXSR ZSEDIT                                    CPB001
     C                     MOVE ZOUT21    SPINT                           CPB001
     C                     MOVE *HIVAL    SAPINT                          CPB001
     C                     ELSE                                           CPB001
     C                     MOVE *BLANKS   SPINT                           CPB001
     C                     MOVE *BLANKS   SAPINT                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDFLS - Subroutine to Update File Records.                  *
      *                                                               *
      *  Called By: UPDATE                                            *
      *  Calls:     INITRC                                            *
      *             ZTNLU1                                            *
      *             INFSR                                             *
      *                                                               *
      *****************************************************************
      *
     C           UPDFLS    BEGSR                           *** UPDFLS ***
     C/COPY WNCPYSRC,SE0070C048
     C*
     C** U P D A T E   F I L E S
     C*
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C                     EXSR INITRC
     C/COPY WNCPYSRC,SE0070C263
     C*
     C** RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C                     EXSR ZTNLU1
     C*
     C** INITIALISE ERROR BAND
     C*
     C                     MOVEL*BLANK    INFMSG
      *                                                                   S01401
      ** Set UPDDPT to indicate if an update to the main file             S01401
      ** has occurred.                                                    S01401
     C                     MOVEL'N'       UPDDPT  1                       S01401
     C*
     C**               I  N  S  E  R  T  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'I'
     C/COPY WNCPYSRC,SE0070C239
     C           DPTMVK    CHAINDPTMVDF              60    *
     C/COPY WNCPYSRC,SE0070C240
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*                                                                   S01511
     C** If S01511 is installed, and the market has changed or market     S01511
     C** migration is ongoing, display error message and bypass update    S01511
     C*                                                                   S01511
     C           S01511    IFEQ 'Y'                                       S01511
     C           DPSS      CHAINSECTYDF              33                   S01511
     C           SMKTI     IFNE MKTI                                      S01511
     C           SMAI      OREQ 'Y'                                       S01511
     C                     ROLBK                                          S01511
     C                     MOVEA'001'     *IN,10                          S01511
     C                     MOVELINF,14    INFMSG                          S01511
     C                     GOTO XTUPDF                                    S01511
     C                     END                                            S01511
     C                     END                                            S01511
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C/COPY WNCPYSRC,SE0070C039
      *                                                                   S01445
     C                     EXSR UPDCHG                                    S01445
      *                                                                   S01445
     C*                                                                   S01158
     C** CLEAR ERRMSG TO IGNORE ANY WARNING MESSAGES                      S01158
     C*                                                                   S01158
     C                     MOVE *BLANK    ERRMSG                          S01158
     C*
     C* PICK UP MARKET INDICATOR FROM SECURITY FILE FOR USE IN FILE KEYS
     C*
     C           DPSS      CHAINSECTYDF              33
     C                     MOVE MKTI      MARKET
     C*
     C* Default Beneficial customer to Branch if blank and movement type
     C* 'DT'
     C*
     C           DPMV      IFEQ 'DT'
     C********** DPBN      ANDEQ*ZEROS                                                        CSD027
     C           DPBN      ANDEQ*BLANKS                                                       CSD027
     C**********           Z-ADDBICN      DPBN                            S01117
     C                     MOVELA8BICN    DPBN                            S01117
     C                     END
     C*
     C                     MOVE MARKET    DPMK
     C                     MOVEL'D'       RECI
     C                     Z-ADDRUND      ORED
     C                     Z-ADDRUND      LCD
     C                     MOVEL'I'       CHTP
     C                     MOVELNATN      TNLU
     C                     BITOF'01'      TACI
     C                     BITOF'0'       DPMS                            E16929
     C                     END
     C*                                                                   S01515
     C** Updating correctly the value date in DPTMVD file                 S01515
     C*                                                                   S01515
     C                     Z-ADD0         DPVD                            S01515
     C           DPMV      IFEQ 'DT'                                      S01515
     C           DPMV      OREQ 'WI'                                      S01515
     C           DPMV      OREQ 'BB'                                      S01515
     C           DPMV      OREQ 'RR'                                      S01515
     C                     Z-ADDDPMD      DPVD                            S01515
     C                     END                                            S01515
     C           DPMV      IFEQ 'WO'                                      S01515
     C           DPMV      OREQ 'BL'                                      S01515
     C           DPMV      OREQ 'RP'                                      S01515
     C                     Z-ADDDPDO      DPVD                            S01515
     C                     END                                            S01515
     C*                                                                   S01271
     C*  Set Pay/Receive processed indicators to N                        S01271
     C*                                                                   S01271
     C                     MOVE 'N'       DPR1                            S01271
     C                     MOVE 'N'       DPR2                            S01271
     C                     MOVEASTAMP,1   DMTMST           Default Timestamp                  CPK015
      *                                                                                       207006
     C           CSE029    IFEQ 'Y'                                                           207006
     C                     MOVE DPBN      CPTY                                                207006
     C                     MOVE SMCC      MRKT                                                207006
     C                     ENDIF                                                              207006
     C*                                                                   S01271
     C/COPY WNCPYSRC,SE0070C142
      *                                                                                       CSD015
      ** Clear working variables of old values of Watch List Fields                           CSD015
      *                                                                                       CSD015
     C**********           Z-ADD0         WDPIDF                                       CSD015 CSD027
     C**********           Z-ADD0         WDPODF                                       CSD015 CSD027
     C                     MOVE *BLANKS   WDPIDF                                              CSD027
     C                     MOVE *BLANKS   WDPODF                                              CSD027
      *                                                                                       CSD015
      ** If enhancement CSD015 is installed and W1EWLC = 'Y'                                  CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If user is in the main system                                                        CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
      *                                                                                       CSD015
      ** If any of the watch list fields has been entered                                     CSD015
      *                                                                                       CSD015
     C********** DPID      IFNE *ZERO                                                  CSD015 CSD027
     C********** DPOD      ORNE *ZERO                                                  CSD015 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C           DPOD      ORNE *BLANKS                                                       CSD027
     C           PMCWL     ORNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
      ** Initialize Hit Unconfirmed Flag since it will not be used in                         CSD015
      ** Insert and will retain its value after an Ammend transaction                         CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WUNCF1                                              CSD015
      *                                                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C   60                WRITEDPTMVDF                15  *
     C/COPY WNCPYSRC,SE0070C241
     C*
     C** TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN15     IFEQ '1'
     C           STATUS    ANDEQ01021
     C/COPY WNCPYSRC,SE0070C242
     C           DPTMVK    CHAINDPTMVX               15
     C/COPY WNCPYSRC,SE0070C243
     C           *IN15     IFEQ '0'
     C                     EXSR UPDOWS
     C                     GOTO XTUPDF
     C                     END
     C                     END
      *
     C           *IN15     IFEQ '1'
     C                     EXSR INFSR
     C                     END
     C/COPY WNCPYSRC,SE0070C244
     C*
     C  N60                UPDATDPTMVDF
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C/COPY WNCPYSRC,SE0070C089
     C                     MOVEL'Y'       UPDDPT                          S01401
     C                     ELSE
     C*
     C**               I  N  S  E  R  T  S                 -  E N D
     C*
     C**               A  M  E  N  D  S                    -  S T A R T
     C*
     C           ACTN      IFEQ 'A'
     C/COPY WNCPYSRC,SE0070C245
     C           DPTMVK    CHAINDPTMVDF              60
      *                                                                                       CSD015
      ** Store previous values of watch list fields for comparison                            CSD015
      *                                                                                       CSD015
     C**********           Z-ADDDPID      WDPIDF  60                                   CSD015 CSD027
     C**********           Z-ADDDPOD      WDPODF  60                                   CSD015 CSD027
     C                     MOVE DPID      WDPIDF  6                                           CSD027
     C                     MOVE DPOD      WDPODF  6                                           CSD027
      *                                                                                       CSD015
     C/COPY WNCPYSRC,SE0070C246
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*                                                                   S01511
     C** If S01511 is installed, and the market has changed or market     S01511
     C** migration is ongoing, display error message and bypass update    S01511
     C*                                                                   S01511
     C           S01511    IFEQ 'Y'                                       S01511
     C           DPSS      CHAINSECTYDF              33                   S01511
     C           SMKTI     IFNE MKTI                                      S01511
     C           SMAI      OREQ 'Y'                                       S01511
     C                     ROLBK                                          S01511
     C                     MOVEA'001'     *IN,10                          S01511
     C                     MOVELINF,14    INFMSG                          S01511
     C                     GOTO XTUPDF                                    S01511
     C                     END                                            S01511
     C                     END                                            S01511
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
      *                                                                   S01445
     C/COPY WNCPYSRC,SE0070C040
     C                     EXSR UPDCHG                                    S01445
      *                                                                   S01445
     C*
     C* Default Beneficial customer to Branch if blank and movement type
     C* 'DT'
     C*
     C           DPMV      IFEQ 'DT'
     C********** DPBN      ANDEQ*ZEROS                                                        CSD027
     C           DPBN      ANDEQ*BLANKS                                                       CSD027
     C**********           Z-ADDBICN      DPBN                            S01117
     C                     MOVELA8BICN    DPBN                            S01117
     C                     END
     C*
     C* PICK UP MARKET INDICATOR FROM SECURITY FILE FOR USE IN FILE KEYS
     C*
     C           DPSS      CHAINSECTYDF              33
     C                     MOVE MKTI      MARKET
     C*
     C                     MOVE MARKET    DPMK
     C                     Z-ADDRUND      LCD
     C                     MOVEL'A'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C*                                                                   S01515
     C** Updating correctly the value date in DPTMVD file                 S01515
     C*                                                                   S01515
     C           DPMV      IFEQ 'DT'                                      S01515
     C           DPMV      OREQ 'WI'                                      S01515
     C           DPMV      OREQ 'BB'                                      S01515
     C           DPMV      OREQ 'RR'                                      S01515
     C                     Z-ADDDPMD      DPVD                            S01515
     C                     END                                            S01515
     C           DPMV      IFEQ 'WO'                                      S01515
     C           DPMV      OREQ 'BL'                                      S01515
     C           DPMV      OREQ 'RP'                                      S01515
     C                     Z-ADDDPDO      DPVD                            S01515
     C                     END                                            S01515
     C/COPY WNCPYSRC,SE0070C194
     C*                                                                   S01515
      *                                                                                       207006
     C           CSE029    IFEQ 'Y'                                                           207006
     C                     MOVE DPBN      CPTY                                                207006
     C                     MOVE SMCC      MRKT                                                207006
     C                     ENDIF                                                              207006
      *                                                                                       CSD015
      ** If CSD015 is installed and watch list checking applied                               CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If user is in the main system                                                        CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
      *                                                                                       CSD015
      ** Access SDCWHTPD to verify Hit Unconfirmed Flag                                       CSD015
      *                                                                                       CSD015
     C                     MOVEL'DPTMVD'  KFUNT                                               CSD015
     C                     MOVELDPRN      KIDEN                                               CSD015
     C                     MOVELDPBA      KBRCH                                               CSD015
      *                                                                                       CSD015
      ** Move blanks to Hit Unconfirmed Flag if record is not found                           CSD015
      *                                                                                       CSD015
     C           KCWHTL    CHAINSDCWHTL1             18                                       CSD015
     C           *IN18     IFEQ '1'                                                           CSD015
     C                     MOVE *BLANKS   WUNCF1  1                                           CSD015
     C                     ELSE                                                               CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'Y'       WUNCF1                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If any of the watch list fields has changed or                                       CSD015
      ** Hit Unconfirmed Flag is 'Y'                                                          CSD015
      *                                                                                       CSD015
     C           WDPIDF    IFNE DPID                                                          CSD015
     C           WDPODF    ORNE DPOD                                                          CSD015
     C           PMCWL     ORNE *BLANKS                                                       CSD015
     C           WUNCF1    OREQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C  N60                UPDATDPTMVDF
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           *IN60     ANDEQ'0'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C/COPY WNCPYSRC,SE0070C195
     C                     MOVEL'Y'       UPDDPT                          S01401
     C                     ELSE
     C*
     C**               A  M  E  N  D  S                    -  E N D
     C*
     C**               D  E  L  E  T  E  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'D'
     C/COPY WNCPYSRC,SE0070C247
     C           DPTMVK    CHAINDPTMVDF              60
     C/COPY WNCPYSRC,SE0070C248
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C* PICK UP MARKET INDICATOR FROM SECURITY FILE FOR USE IN FILE KEYS
     C*
     C           DPSS      CHAINSECTYDF              33
     C                     MOVE MKTI      MARKET
     C*                                                                   S01511
     C** If S01511 is installed, and the market has changed or market     S01511
     C** migration is ongoing, display error message and bypass update    S01511
     C*                                                                   S01511
     C           S01511    IFEQ 'Y'                                       S01511
     C           SMKTI     IFNE MKTI                                      S01511
     C           SMAI      OREQ 'Y'                                       S01511
     C                     ROLBK                                          S01511
     C                     MOVEA'001'     *IN,10                          S01511
     C                     MOVELINF,14    INFMSG                          S01511
     C                     GOTO XTUPDF                                    S01511
     C                     END                                            S01511
     C                     END                                            S01511
     C*
     C                     MOVEL'*'       RECI
     C*                                                                   046800
     C           ORED      IFLT RUND                                      046800
     C           DPMV      IFEQ 'RP'                                      046800
     C           DPMV      OREQ 'RR'                                      046800
     C           DPMV      OREQ 'BB'                                      046800
     C           DPMV      OREQ 'BL'                                      046800
     C           DPMV      OREQ 'PD'                                      046800
     C           DPMV      OREQ 'PL'                                      046800
     C           DPMV      OREQ 'WI'                                      CSE018
     C           CSE018    ANDEQ'Y'                                       CSE018
     C           DPMV      OREQ 'WO'                                      CSE018
     C           CSE018    ANDEQ'Y'                                       CSE018
     C/COPY WNCPYSRC,SE0070C193
     C                     MOVEL'R'       RECI                            046800
     C                     END                                            046800
     C                     END                                            046800
     C*                                                                   046800
     C                     Z-ADDRUND      LCD
     C                     MOVEL'D'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C*                                                                   S01515
     C** Updating correctly the value date in DPTMVD file                 S01515
     C*                                                                   S01515
     C           DPMV      IFEQ 'DT'                                      S01515
     C           DPMV      OREQ 'WI'                                      S01515
     C           DPMV      OREQ 'BB'                                      S01515
     C           DPMV      OREQ 'RR'                                      S01515
     C                     Z-ADDDPMD      DPVD                            S01515
     C                     END                                            S01515
     C           DPMV      IFEQ 'WO'                                      S01515
     C           DPMV      OREQ 'BL'                                      S01515
     C           DPMV      OREQ 'RP'                                      S01515
     C                     Z-ADDDPDO      DPVD                            S01515
     C                     END                                            S01515
     C*                                                                   S01271
     C*  Set Pay/Receive processed indicators to N if Other Settlement    S01271
     C*  record already printed.                                          S01271
     C*                                                                   S01271
     C           DPR1      IFEQ 'Y'                                       S01271
     C                     MOVE 'N'       DPR1                            S01271
     C                     ELSE                                           S01271
     C                     MOVE 'Y'       DPR1                            S01271
     C                     END                                            S01271
     C*                                                                   S01271
     C           DPR2      IFEQ 'Y'                                       S01271
     C                     MOVE 'N'       DPR2                            S01271
     C                     ELSE                                           S01271
     C                     MOVE 'Y'       DPR2                            S01271
     C                     END                                            S01271
     C*                                                                   103926
     C                     TESTB'0'       DPMS           99               103926
     C           *IN99     IFEQ '0'                                       103926
     C                     MOVE 'N'       DCFR                            103926
     C                     ELSE                                           103926
     C                     MOVE 'Y'       DCFR                            103926
     C                     END                                            103926
     C/COPY WNCPYSRC,SE0070C249
     C*                                                                   S01271
     C  N60                UPDATDPTMVDF
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           *IN60     ANDEQ'0'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C/COPY WNCPYSRC,SE0070C250
     C                     MOVEL'Y'       UPDDPT                          S01401
     C/COPY WNCPYSRC,SE0070C251
     C                     END
     C*
     C**               D  E  L  E  T  E  S                 -  E N D
     C*
     C                     END
     C                     END
      *                                                                   S01401
      ***  If MT5xx Feature present, then if a Depot Movement has been    S01401
      ***  Inserted/Amended/Deleted, Update the Extension to indicate     S01401
      ***  that a new S.W.I.F.T. Settlement Message may be required.      S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C           UPDDPT    ANDEQ'Y'                                       S01401
     C           DPTMVK    CHAINDPTMVDY1             33                   S01401
     C           *IN33     IFEQ *OFF                                      S01401
     C                     MOVEL'Y'       DPSCMG                          S01401
     C                     UPDATDPTMVDD1                                  S01401
     C           DPWHEN    IFEQ 'M'                                       CSW003
     C                     MOVE 'S'       DPWHEN                          CSW003
     C           DPTMK1    CHAINDPTMVDY1             33                   CSW003
     C           *IN33     IFEQ *OFF                                      CSW003
     C                     MOVEL'Y'       DPSCMG                          CSW003
     C                     UPDATDPTMVDD1                                  CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          S01401
     C                     ENDIF                                          S01401
     C*
     C** GET AUDIT RECORD
     C*
     C           1         CHAINDPTMVAF              99
     C*
     C** UPDATE AUDIT RECORD IF FOUND
     C*
     C           *IN99     IFEQ '0'
     C/COPY WNCPYSRC,SE0070C252
      *
      ***  For Insert, Update Live Records Inserted Today and Number
      ***  of Live Records.
      *
     C           ACTN      IFEQ 'I'
     C                     ADD  1         SINS
     C                     ADD  1         NORE
     C                     END
     C*
     C** FOR AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY
     C*
     C           ACTN      IFEQ 'A'
     C                     ADD  1         SAMD
     C                     END
     C*
     C** FOR DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS
     C*
     C           ACTN      IFEQ 'D'
     C                     ADD  1         SDEL
     C                     SUB  1         NORE
     C                     END
     C/COPY WNCPYSRC,SE0070C253
     C*
     C** FORMAT COMIT TEXT
     C*
     C                     TIME           MTIME
     C                     MOVELACTN      ACTNX
     C                     MOVEASCRCTL    DET,01
     C                     MOVEADETS      DET,19
     C*
     C** UPDATE AUDIT RECORD
     C*
     C                     MOVELNATN      TNLU
     C                     UPDATDPTMVAF
     C*
R134 C* If movement type is 'WI', 'WO', 'BL' or 'BB' - update Book
R134 C* positions    - NB STIL REQ'D FOR R134 (TO CALC VALUE & XVALUE)
R134 C*
R134 C           DPMV      IFEQ 'WI'
R134 C           DPMV      OREQ 'WO'
R134 C           DPMV      OREQ 'BL'
R134 C           DPMV      OREQ 'BB'
R134 C                     EXSR UPDPOS
R134 C                     END
     C*
     C* Update Client/User depot positions
     C*
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'D'
     C                     EXSR DEPREV
     C                     END
     C*
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'I'
     C                     EXSR DEPPOS
     C                     END
     C*
     C** C  O  M  I  T
     C*
     C/COPY WNCPYSRC,SE0070C041
     C           CMTTXT    COMIT
     C/COPY WNCPYSRC,SE0070C042
     C                     MOVE *BLANKS   ERRMSG                          S01158
     C*
     C** AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C                     ELSE
     C*
     C                     SETON                     U7U8  **DB*ERROR*04**E20651
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'04'      DBASE            ***************E20651
     C**********           MOVEL'11'      DBASE      * DB ERROR 11 *E20651S01117
     C                     Z-ADD11        DBASE            * DB ERROR 11 *S01117
     C                     MOVEL'DPTMV'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     END
     C*
     C/COPY WNCPYSRC,SE0070C049
     C           XTUPDF    ENDSR
     C/COPY WNCPYSRC,SE0070C050
      *
      *****************************************************************
      /EJECT                                                              S01445
      *****************************************************************   S01445
      *                                                               *   S01445
      *  UPDCHG - Subroutine to Update charge fields on mvmt file     *   S01445
      *                                                               *   S01445
      *  Called By: UPDFLS                                            *   S01445
      *  Calls:     None.                                             *   S01445
      *                                                               *   S01445
      *****************************************************************   S01445
      *                                                                   S01445
     C           UPDCHG    BEGSR                                       ** S01445
      *                                                                   S01445
      *** If Movement type is not Walk in/Walk out, Set default values    S01445
      *** Otherwise, if settlement method is 04/14, then set settle-      S01445
      *** branch to branch of settlement account.                         S01445
      *                                                                   S01445
     C           DPMV      IFNE 'WI'                       *B1            S01445
     C           DPMV      ANDNE'WO'                                      S01445
      *                                                                   CSE006
      *  If CSE006 is on, Charges can be defined for Bond borrowing       CSE006
      *       lending                                                     CSE006
     C           CSE006    IFNE 'Y'                        *B2            CSE006
     C           DPMV      ORNE 'BB'                                      CSE006
     C           DPMV      ANDNE'BL'                                      CSE006
     C                     MOVE *BLANKS   DCHC                            S01445
     C                     MOVE *BLANKS   DCCE                            S01445
     C                     Z-ADD*ZERO     DCHA                            S01445
     C                     Z-ADD*ZERO     DCSE                            S01445
     C                     MOVE *BLANKS   DCAB                            S01445
     C                     MOVE *BLANKS   DCAT                            S01445
     C                     END                             *E2            CSE006
     C                     ELSE                            *X1            S01445
      *                                                                   S01445
     C           SCSE      IFEQ '04'                       *B2            S01445
     C           SCSE      OREQ '14'                                      S01445
     C                     MOVE UHCAB     DCAB                            S01445
     C                     ELSE                            *X2            S01445
     C                     MOVE SCAB      DCAB                            S01445
     C                     END                             *E2            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
     C                     ENDSR                                          S01445
      *****************************************************************   S01445
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDOWS - Subroutine to process Update by Another Workstation.*
      *                                                               *
      *  Called By: UPDFLS                                            *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           UPDOWS    BEGSR                           *** UPDOWS ***
     C**
     C                     ROLBK
     C**
     C**   SET UP NEXT SCREEN TO BE DISPLAYED:
     C**   IF RECORD IS LIVE, ALLOW AMEND PROCESSING;
     C**
     C           RECI      IFEQ 'D'
     C           ACTN      IFEQ 'I'
     C**********           Z-ADDDPID      XDPID                                               CSD027
     C                     MOVE DPID      XDPID                                               CSD027
     C                     Z-ADDDPMD      XDPMD
     C**********           Z-ADDDPOD      XDPOD                                               CSD027
     C                     MOVE DPOD      XDPOD                                               CSD027
     C                     Z-ADDDPDO      XDPDO
     C***********          Z-ADDDPBC      XDPBC                           S01117
     C                     MOVELDPBA      XDPBA                           S01117
     C                     MOVE DPBK      XDPBK
     C**********           Z-ADDDPBN      XDPBN                                               CSD027
     C                     MOVE DPBN      XDPBN                                               CSD027
     C                     Z-ADDDPNA      XDPNA
     C                     Z-ADDMKTP      XMKTP
     C                     MOVELDPPC      XDPPC                           S01117
     C                     MOVELORBR      XORBR                           S01117
     C                     END
     C                     MOVEL'A'       ACTN
     C                     ELSE
     C**
     C**   IF RECORD HAS BEEN DELETED, ALLOW ENQUIRY
     C**
     C                     MOVEL'E'       ACTN
     C                     END
     C**
     C**   SET SCREEN PROCESSOR TO UPDATE AND MOVE UPDATE MESSAGE TO ERROR
     C**
     C                     MOVEA'001'     *IN,10
     C                     MOVELINF,11    INFMSG
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INFSR  - File Exception/Error Handling Subroutine.           *
      *                                                               *
      *  Called By: File Error.                                       *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           INFSR     BEGSR                           *** INFSR  ***
     C**
     C** ROLL BACK CHANGES AND CANCEL PROGRAM
     C**
     C                     ROLBK
     C                     MOVE '*CANCL'  EXTTAG  6
     C**
     C                     ENDSREXTTAG
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  DEPPOS - Subroutine to Update Depot Position Files - Insert. *
      *                                                               *
      *****************************************************************
      *
     C           DEPPOS    BEGSR                           *** DEPPOS ***
     C*
     C* Movement date for 'DT'
     C*
     C           DPMV      IFEQ 'DT'
     C                     Z-ADDDPMD      MOVDAT  50
     C                     END
     C*
     C* If Portfolio Customer movement
     C*
     C           DPMV      IFEQ 'WI'
     C           DPMV      OREQ 'WO'
     C*
     C* Access Customer depot file
     C*
     C           DPMV      IFEQ 'WI'
     C                     MOVE DPID      DEPOT
     C                     ELSE
     C                     MOVE DPOD      DEPOT
     C                     END
     C/COPY WNCPYSRC,SE0070C069
     C           CDEPKA    CHAINCDEPPDF              33
     C  N33      RECI      COMP '*'                      34
     C*
     C* Not found, set up record
     C*
     C   33
     CORN33 34             DO
     C                     MOVE 'D'       RECI
     C***********          MOVE DPBC      CDBR                            S01117
     C                     MOVE DPBA      CDPA                            S01117
     C                     MOVE DPBN      CDCN
     C                     MOVE DPSS      CDSN
     C                     MOVE DEPOT     CDPT
     C                     MOVE MARKET    CDMK
     C*********************Z-ADDRUND      DDTE                      S01158102855
     C*                                                                   102855
     C           DPMV      IFEQ 'WI'                                      102855
     C                     Z-ADDDPMD      DDTE                            102855
     C                     ELSE                                           102855
     C                     Z-ADDDPDO      DDTE                            102855
     C                     END                                            102855
     C*                                                                   102855
     C***********          Z-ADD*ZEROS    DDTE                            S01158
     C                     Z-ADD*ZEROS    CECN
     C                     Z-ADD*ZEROS    CDNT
     C                     Z-ADD*ZEROS    CDNV
     C                     Z-ADD*ZEROS    SNPT
     C                     Z-ADD*ZEROS    CDST
     C                     Z-ADD*ZEROS    CDNS
     C                     Z-ADD*ZEROS    SAPP
     C                     Z-ADD*ZEROS    SAPS
     C                     Z-ADD*ZEROS    CNPV
     C                     Z-ADD*ZEROS    CNSV
     C                     Z-ADD*ZEROS    SAPV
     C                     Z-ADD*ZEROS    SPSV
     C                     Z-ADD*ZEROS    CNSI                            S01158
     C                     END
     C*
     C           DPMV      IFEQ 'WI'
     C                     ADD  DPNA      CDST
     C                     ADD  VALUE     SAPS
     C                     Z-ADDDPMD      MOVDAT
      *
     C           DPMD      IFLE RUND
     C                     ADD  DPNA      CNSV
     C                     ADD  VALUE     SPSV
     C                     ADD  DPNA      CNSI                            E13788
     C                     END
      *
     C                     ELSE
     C                     SUB  DPNA      SNPT
     C                     ADD  VALUE     SAPP
     C                     Z-ADDDPDO      MOVDAT
      *
     C           DPDO      IFLE RUND
     C                     SUB  DPNA      CNPV
     C                     ADD  VALUE     SAPV
     C                     SUB  DPNA      CNSI                            E13788
     C                     END
      *
     C                     END
     C*
     C                     MOVELNATN      TNLU
     C   33                WRITECDEPPDF
     C  N33                UPDATCDEPPDF
     C*
     C* Update audit file
     C*
     C           *IN33     IFEQ '1'
     C/COPY WNCPYSRC,SE0070C070
     C           1         CHAINCDEPPAF              U8
     C           *INU8     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7    **DB*ERROR*07**E20651
     C***********          MOVEL'07'      DBASE            ***************E20651
     C**********           MOVEL'12'      DBASE      * DB ERROR 12 *E20651S01117
     C                     Z-ADD12        DBASE            * DB ERROR 12 *S01117
     C                     MOVEL'CDEPP'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     SETON                     LR
     C                     RETRN
     C                     ELSE
     C*
     C                     ADD  1         NORE
     C                     MOVELNATN      TNLU
     C                     UPDATCDEPPAF
     C                     END
     C                     END
     C*
     C* If movement date LT date, update Customer position
     C*
     C***********MOVDAT    IFLT DDTE                                      E15253
     C           MOVDAT    IFLE DDTE                                      E15253
     C/COPY WNCPYSRC,SE0070C051
     C           CPOSKA    CHAINCPOSNDF              33
     C  N33      RECI      COMP '*'                      34
     C*
     C* If no record found, create new
     C*
     C           *IN33     IFEQ '1'
     C                     MOVE 'D'       RECI
     C***********          MOVE DPBC      CSBR                            S01117
     C                     MOVE DPBA      CSBA                            S01117
     C                     MOVE DPSS      CSSC
     C                     MOVE DPBN      CSCN
     C                     Z-ADDMOVDAT    CSDA
     C                     Z-ADD*ZEROS    CSNT
     C                     Z-ADD*ZEROS    CSNV
     C                     Z-ADD*ZEROS    CSNS
     C                     Z-ADD*ZEROS    CSEX
     C                     Z-ADD*ZEROS    CSPT
     C                     Z-ADD*ZEROS    CSPV
     C                     MOVE 'N'       CSBT
     C                     MOVE 'N'       CSBV
     C                     Z-ADD*ZEROS    CSCT
     C                     Z-ADD*ZEROS    CSCV
     C                     MOVELNATN      TNLU
     C                     WRITECPOSNDF
     C*
     C* Update audit file
     C*
     C/COPY WNCPYSRC,SE0070C052
     C           1         CHAINCPOSNAF              U8
     C           *INU8     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7    ***************
     C**********           MOVEL'08'      DBASE            * DB ERROR 08 *S01117
     C                     Z-ADD08        DBASE            * DB ERROR 08 *S01117
     C                     MOVEL'CPOSN'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C/COPY WNCPYSRC,SE0070C053
     C                     SETON                     LR
     C                     RETRN
     C                     ELSE
     C*
     C                     ADD  1         NORE
     C                     MOVELNATN      TNLU
     C                     UPDATCPOSNAF
     C                     END
     C                     ELSE
     C*
     C* If movement date before either Last Position Change date,
     C* update corresponding flag
     C*
     C           MOVDAT    IFLT CSCT
     C   34                MOVE 'D'       RECI
     C                     MOVE 'Y'       CSBT
     C                     MOVELNATN      TNLU
     C                     END
     C*
     C           MOVDAT    IFLT CSCV
     C   34                MOVE 'D'       RECI
     C                     MOVE 'Y'       CSBV
     C                     MOVELNATN      TNLU
     C                     END
     C*
     C***********          Z-ADDMOVDAT    CSDA                            S01158
     C*
     C                     UPDATCPOSNDF
     C                     END
     C/COPY WNCPYSRC,SE0070C054
     C                     END
     C*                                                                   S01117
     C** IF NO RECORD ON CUSTOMER POSITIONS PROFIT CENTRE FILE            S01117
     C** NEED TO ADD ONE AND AMEND THE AUDIT FILE                         S01117
     C*                                                                   S01117
     C           *IN87     IFEQ '1'                                       S01117
     C***********DPPC      ANDNE*BLANKS                             S01117087371
     C           SEPCCK    CHAINSEPCCD               33                   S01117
     C           *IN33     IFEQ '1'                                       S01117
     C                     MOVEL'D'       RECI                            S01117
     C                     MOVELDPBN      CNUM                            S01117
     C                     MOVELDPBA      BRCA                            S01117
     C                     MOVELDPSS      SESN                            S01117
     C                     MOVELDPPC      PCCU                            S01117
     C                     MOVELRUND      LCD                             S01117
     C                     MOVEL'I'       CHTP                            S01117
     C                     MOVELNATN      TNLU                            S01117
     C                     MOVELPTFR      YYPTFR                          136798
     C                     WRITESEPCCDF                                   S01117
     C*                                                                   S01117
     C           1         CHAINSEPCAF               33                   S01117
     C           *IN33     IFEQ '1'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD14        DBASE                           S01117
     C                     MOVEL'SEPCA'   DBFILE                          S01117
     C                     MOVEL'AUDIT'   DBKEY                           S01117
     C                     OUT  LDA                                       S01117
     C                     RETRN                                          S01117
     C                     ELSE                                           S01117
     C                     ADD  1         NORE                            S01117
     C                     ADD  1         SINS                            S01117
     C                     UPDATSEPCAF                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C* else if not Portfolio Customer movement
     C*
     C                     ELSE
     C*
     C* Update User In depot - value fields only updated if movement date
     C* not after run date
     C*
     C                     MOVE DPID      DEPOT
     C/COPY WNCPYSRC,SE0070C055
     C           UDEPKA    CHAINUDEPPDF              33
     C  N33      RECI      COMP '*'                      34
     C*
     C* Not found, create new record
     C*
     C   33
     CORN33 34             DO
     C                     MOVE 'D'       RECI
     C***********          MOVE DPBC      UDBR                            S01117
     C                     MOVE DPBA      UDBA                            S01117
     C                     MOVE DPSS      UDSN
     C                     MOVE DPID      UDPT
     C                     MOVE DPBK      UDBK
     C                     MOVE MARKET    UDMK
     C***********          Z-ADD*ZEROS    UDDT                            S01158
     C                     Z-ADDRUND      UDDT                            S01158
     C                     Z-ADD*ZEROS    UECN
     C                     Z-ADD*ZEROS    UDNT
     C                     Z-ADD*ZEROS    UDNV
     C                     Z-ADD*ZEROS    UDNS
     C                     Z-ADD*ZEROS    UNRT
     C                     Z-ADD*ZEROS    UNRV
     C                     Z-ADD*ZEROS    UDTP
     C                     Z-ADD*ZEROS    UDPV
     C                     Z-ADD*ZEROS    UDTS
     C                     Z-ADD*ZEROS    UDSV
     C                     Z-ADD*ZEROS    USNT
     C                     Z-ADD*ZEROS    USNR
     C                     Z-ADD*ZEROS    USNV
     C                     Z-ADD*ZEROS    USRV
     C                     Z-ADD*ZEROS    UNSI                            S01158
     C                     END
     C*
     C           DPMV      IFEQ 'DT'
     C***********DPMV      OREQ 'BL'                                      E23561
     C***********DPMV      OREQ 'BB'                                      E23561
     C                     ADD  DPNA      UDTP
     C           MOVDAT    IFLE RUND
     C                     ADD  DPNA      UNSI                            E25477
     C                     ADD  DPNA      UDPV
     C                     END
     C                     END
     C*
     C           DPMV      IFEQ 'RP'
     C           DPMD      ANDGTRUND                                      E13934
     C           DPMV      OREQ 'PD'                                      S01176
     C           DPMD      ANDGTRUND                                      E13934
     C           DPMV      OREQ 'BL'                                      E23561
     C           DPMD      ANDGTRUND                                      E23561
     C*********************ADD  DPNA      USNT                            E23561
     C                     SUB  DPNA      USNT                            E23561
     C           DPDO      IFLE RUND
     C*********************ADD  DPNA      USNV                            E23561
     C                     SUB  DPNA      USNV                            E23561
     C                     END
     C                     END
     C*
     C           DPMV      IFEQ 'RR'
     C           DPDO      ANDGTRUND                                      E13934
     C           DPMV      OREQ 'PL'                                      S01176
     C           DPDO      ANDGTRUND                                      E13934
     C           DPMV      OREQ 'BB'                                      E23561
     C           DPDO      ANDGTRUND                                      E23561
     C                     ADD  DPNA      USNR
     C           DPMD      IFLE RUND
     C                     ADD  DPNA      USRV
     C                     END
     C                     END
     C                     MOVELNATN      TNLU
     C*
     C           *IN33     IFEQ '1'
     C                     WRITEUDEPPDF
     C*
     C* Update audit record
     C*
     C/COPY WNCPYSRC,SE0070C056
     C           1         CHAINUDEPPAF              U8
     C           *INU8     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7    ***************
     C**********           MOVEL'09'      DBASE            * DB ERROR 09 *S01117
     C                     Z-ADD09        DBASE            * DB ERROR 09 *S01117
     C                     MOVEL'UDEPP'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C/COPY WNCPYSRC,SE0070C057
     C                     SETON                     LR
     C                     RETRN
     C                     ELSE
     C*
     C                     ADD  1         NORE
     C                     MOVELNATN      TNLU
     C                     UPDATUDEPPAF
     C                     END
     C                     ELSE
     C*
     C                     UPDATUDEPPDF
     C                     END
     C*                                                                   E21066
     C* Update User Out depot - value fields only updated if movement     E21066
     C* date not after run date.                                          E21066
     C*                                                                   E21066
     C/COPY WNCPYSRC,SE0070C058
     C           DPMV      IFEQ 'DT'                                      E21066
     C                     MOVE DPOD      DEPOT                           E21066
     C           UDEPKA    CHAINUDEPPDF              33                   E21066
     C  N33      RECI      COMP '*'                      34               E21066
     C*                                                                   E21066
     C* Not found, create new record                                      E21066
     C*                                                                   E21066
     C   33                                                               E21066
     CORN33 34             DO                                             E21066
     C                     MOVE 'D'       RECI                            E21066
     C***********          MOVE DPBC      UDBR                     E21066 S01117
     C                     MOVE DPBA      UDBA                            S01117
     C                     MOVE DPSS      UDSN                            E21066
     C                     MOVE DPOD      UDPT                            E21066
     C                     MOVE DPBK      UDBK                            E21066
     C                     MOVE MARKET    UDMK                            E21066
     C                     Z-ADDRUND      UDDT                            E21066
     C                     Z-ADD*ZEROS    UDDT                            E21066
     C                     Z-ADD*ZEROS    UECN                            E21066
     C                     Z-ADD*ZEROS    UDNT                            E21066
     C                     Z-ADD*ZEROS    UDNV                            E21066
     C                     Z-ADD*ZEROS    UDNS                            E21066
     C                     Z-ADD*ZEROS    UNRT                            E21066
     C                     Z-ADD*ZEROS    UNRV                            E21066
     C                     Z-ADD*ZEROS    UDTP                            E21066
     C                     Z-ADD*ZEROS    UDPV                            E21066
     C                     Z-ADD*ZEROS    UDTS                            E21066
     C                     Z-ADD*ZEROS    UDSV                            E21066
     C                     Z-ADD*ZEROS    USNT                            E21066
     C                     Z-ADD*ZEROS    USNR                            E21066
     C                     Z-ADD*ZEROS    USNV                            E21066
     C                     Z-ADD*ZEROS    USRV                            E21066
     C                     Z-ADD*ZEROS    UNSI                            E21066
     C                     END                                            E21066
     C*                                                                   E21066
     C                     SUB  DPNA      UDTS                            E21066
     C           MOVDAT    IFLE RUND                                      E21066
     C                     SUB  DPNA      UNSI                            E25477
     C                     SUB  DPNA      UDSV                            E21066
     C                     END                                            E21066
     C*                                                                   E21066
     C                     MOVELNATN      TNLU                            E21066
     C*                                                                   E21066
     C           *IN33     IFEQ '1'                                       E21066
     C                     WRITEUDEPPDF                                   E21066
     C*                                                                   E21066
     C* Update audit record                                               E21066
     C*                                                                   E21066
     C           1         CHAINUDEPPAF              U8                   E21066
     C           *INU8     IFEQ '1'                                       E21066
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7    ***************E21066
     C**********           MOVEL'09'      DBASE      * DB ERROR 09 *E21066S01117
     C                     Z-ADD09        DBASE            * DB ERROR 09 *S01117
     C                     MOVEL'UDEPP'   DBFILE           ***************E21066
     C                     MOVEL'AUDIT'   DBKEY                           E21066
     C                     OUT  LDA                                       S01117
     C/COPY WNCPYSRC,SE0070C059
     C                     SETON                     LR                   E21066
     C                     RETRN                                          E21066
     C                     ELSE                                           E21066
     C*                                                                   E21066
     C                     ADD  1         NORE                            E21066
     C                     MOVELNATN      TNLU                            E21066
     C                     UPDATUDEPPAF                                   E21066
     C                     END                                            E21066
     C                     ELSE                                           E21066
     C*                                                                   E21066
     C                     UPDATUDEPPDF                                   E21066
     C                     END                                            E21066
     C                     END                                            E21066
     C/COPY WNCPYSRC,SE0070C060
     C***********                                                         E13934
     C**Update*User*Out*depot*-*value*fields*only*updated*if*movement**   E13934
     C**date*not*after*run*date.***************************************   E13934
     C***********                                                         E13934
     C***********          MOVE DPOD      DEPOT                           E13934
     C***********UDEPKA    CHAINUDEPPDF              33                   E13934
     C**N33******RECI      COMP '*'                      34               E13934
     C***********                                                         E13934
     C**Not*found,*create*new*record***********************************   E13934
     C***********                                                         E13934
     C***33                                                               E13934
     C**ORN33*34*            DO                                           E13934
     C***********          MOVE 'D'       RECI                            E13934
     C***********          MOVE DPBC      UDBR                            E13934
     C***********          MOVE DPSS      UDSN                            E13934
     C***********          MOVE DPOD      UDPT                            E13934
     C***********          MOVE DPBK      UDBK                            E13934
     C***********          MOVE MARKET    UDMK                            E13934
     C***********          Z-ADDRUND      UDDT                     S01158 E13934
     C***********          Z-ADD*ZEROS    UDDT                     S01158 E13934
     C***********          Z-ADD*ZEROS    UECN                            E13934
     C***********          Z-ADD*ZEROS    UDNT                            E13934
     C***********          Z-ADD*ZEROS    UDNV                            E13934
     C***********          Z-ADD*ZEROS    UDNS                            E13934
     C***********          Z-ADD*ZEROS    UNRT                            E13934
     C***********          Z-ADD*ZEROS    UNRV                            E13934
     C***********          Z-ADD*ZEROS    UDTP                            E13934
     C***********          Z-ADD*ZEROS    UDPV                            E13934
     C***********          Z-ADD*ZEROS    UDTS                            E13934
     C***********          Z-ADD*ZEROS    UDSV                            E13934
     C***********          Z-ADD*ZEROS    USNT                            E13934
     C***********          Z-ADD*ZEROS    USNR                            E13934
     C***********          Z-ADD*ZEROS    USNV                            E13934
     C***********          Z-ADD*ZEROS    USRV                            E13934
     C***********          Z-ADD*ZEROS    UNSI                     S01158 E13934
     C***********          END                                            E13934
     C***********                                                         E13934
     C***********DPMV      IFEQ 'DT'                                      E13934
     C***********DPMV      OREQ 'BL'                                      E13934
     C***********DPMV      OREQ 'BB'                                      E13934
     C***********          SUB  DPNA      UDTS                            E13934
     C***********MOVDAT    IFLE RUND                                      E13934
     C***********          SUB  DPNA      UDSV                            E13934
     C***********          END                                            E13934
     C***********          END                                            E13934
     C***********                                                         E13934
     C***********DPMV      IFEQ 'RP'                                      E13934
     C***********          SUB  DPNA      USNT                            E13934
     C***********DPDO      IFLE RUND                                      E13934
     C***********          SUB  DPNA      USNV                            E13934
     C***********          END                                            E13934
     C***********          END                                            E13934
     C***********                                                         E13934
     C***********DPMV      IFEQ 'RR'                                      E13934
     C***********          SUB  DPNA      USNR                            E13934
     C***********DPMD      IFLE RUND                                      E13934
     C***********          SUB  DPNA      USRV                            E13934
     C***********          END                                            E13934
     C***********          END                                            E13934
     C***********          MOVELNATN      TNLU                            E13934
     C***********                                                         E13934
     C************IN33     IFEQ '1'                                       E13934
     C***********          WRITEUDEPPDF                                   E13934
     C***********                                                         E13934
     C**Update*audit*record********************************************   E13934
     C***********                                                         E13934
     C***********1         CHAINUDEPPAF              U8                   E13934
     C************INU8     IFEQ '1'                                       E13934
     C***********          SETON                     U7    ***************E13934
     C***********          MOVEL'09'      DBASE            * DB ERROR 09 *E13934
     C***********          MOVEL'UDEPP'   DBFILE           ***************E13934
     C***********          MOVEL'AUDIT'   DBKEY                           E13934
     C***********          SETON                     LR                   E13934
     C***********          RETRN                                          E13934
     C***********          ELSE                                           E13934
     C***********                                                         E13934
     C***********          ADD  1         NORE                            E13934
     C***********          MOVELNATN      TNLU                            E13934
     C***********          UPDATUDEPPAF                                   E13934
     C***********          END                                            E13934
     C***********          ELSE                                           E13934
     C***********                                                         E13934
     C***********          UPDATUDEPPDF                                   E13934
     C***********          END                                            E13934
     C*
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  DEPREV - Subroutine to Update Depot Position Files - Delete  *
      *                                                       Amend   *   S01158
      *                                                               *
      *****************************************************************
      *
     C           DEPREV    BEGSR                           *** DEPREV ***
     C*
     C* Movement date for 'DT'
     C*
     C           DPMV      IFEQ 'DT'
     C                     Z-ADDXDPMD     MOVDAT
     C                     END
     C*
     C* If Porfolio customer movement
     C*
     C           DPMV      IFEQ 'WI'
     C           DPMV      OREQ 'WO'
     C*
     C* Update customer depot file
     C*
     C           DPMV      IFEQ 'WI'
     C                     MOVE XDPID     DEPOT
     C                     Z-ADDXDPMD     MOVDAT
     C                     ELSE
     C                     MOVE XDPOD     DEPOT
     C                     Z-ADDXDPDO     MOVDAT
     C                     END
     C/COPY WNCPYSRC,SE0070C061
     C           CDEPKB    CHAINCDEPPDF              33
     C*                                                                   S01158
     C  N33      RECI      COMP '*'                      34               S01158
     C*                                                                   S01158
     C* Not found, set up record                                          S01158
     C*                                                                   S01158
     C   33                                                               S01158
     CORN33 34             DO                                             S01158
     C                     MOVE 'D'       RECI                            S01158
     C***********          MOVE DPBC      CDBR                     S01158 S01117
     C                     MOVE DPBA      CDPA                            S01117
     C                     MOVE DPBN      CDCN                            S01158
     C                     MOVE DPSS      CDSN                            S01158
     C                     MOVE DEPOT     CDPT                            S01158
     C                     MOVE MARKET    CDMK                            S01158
     C                     Z-ADDRUND      DDTE                            S01158
     C                     Z-ADD*ZEROS    CECN                            S01158
     C                     Z-ADD*ZEROS    CDNT                            S01158
     C                     Z-ADD*ZEROS    CDNV                            S01158
     C                     Z-ADD*ZEROS    SNPT                            S01158
     C                     Z-ADD*ZEROS    CDST                            S01158
     C                     Z-ADD*ZEROS    CDNS                            S01158
     C                     Z-ADD*ZEROS    SAPP                            S01158
     C                     Z-ADD*ZEROS    SAPS                            S01158
     C                     Z-ADD*ZEROS    CNPV                            S01158
     C                     Z-ADD*ZEROS    CNSV                            S01158
     C                     Z-ADD*ZEROS    SAPV                            S01158
     C                     Z-ADD*ZEROS    SPSV                            S01158
     C                     Z-ADD*ZEROS    CNSI                            S01158
     C                     END                                            S01158
     C*
     C           DPMV      IFEQ 'WI'
     C                     SUB  XDPNA     CDST
     C                     SUB  XVALUE    SAPS
     C           XDPMD     IFLE RUND
     C                     SUB  XDPNA     CNSV
     C                     SUB  XVALUE    SPSV
     C                     SUB  XDPNA     CNSI                            E13788
     C                     END
     C                     ELSE
     C                     ADD  XDPNA     SNPT
     C                     SUB  XVALUE    SAPP
     C           XDPDO     IFLE RUND
     C                     ADD  XDPNA     CNPV
     C                     SUB  XVALUE    SAPV
     C                     ADD  XDPNA     CNSI                            E13788
     C                     END
     C                     END
     C*
     C                     MOVELNATN      TNLU
     C   33                WRITECDEPPDF                                   S01158
     C  N33                UPDATCDEPPDF                                   S01158
     C*                                                                   S01158
     C** If a new record has been written then increment audit            S01158
     c** file record no. of recs on file by 1                             S01158
     c*                                                                   S01158
     C/COPY WNCPYSRC,SE0070C062
     C           *IN33     IFEQ '1'                                       S01158
     C           1         CHAINCDEPPAF              U8                   S01158
     C           *INU8     IFEQ '1'                                       S01158
     C                     SETON                     U7    DBERROR07S01158E20651
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'07'      DBASE            *********S01158E20651
     C**********           MOVEL'13'      DBASE      * DB ERROR 13 *E20651S01117
     C                     Z-ADD13        DBASE            * DB ERROR 13 *S01117
     C                     MOVEL'CDEPP'   DBFILE           ***************S01158
     C                     MOVEL'AUDIT'   DBKEY                           S01158
     C                     OUT  LDA                                       S01117
     C/COPY WNCPYSRC,SE0070C063
     C                     SETON                     LR                   S01158
     C                     RETRN                                          S01158
     C                     ELSE                                           S01158
     C*                                                                   S01158
     C                     ADD  1         NORE                            S01158
     C                     MOVELNATN      TNLU                            S01158
     C                     UPDATCDEPPAF                                   S01158
     C                     END                                            S01158
     C                     END                                            S01158
     C***********          UPDATCDEPPDF                                   S01158
     C/COPY WNCPYSRC,SE0070C064
     C*
     C* If movement date LT date, update Customer position
     C*
     C***********MOVDAT    IFLT DDTE                                      E15253
     C           MOVDAT    IFLE DDTE                                      E15253
     C/COPY WNCPYSRC,SE0070C065
     C           CPOSKB    CHAINCPOSNDF              33
     C*
     C* If movement date before either Last Position Change date, update
     C* corresponding flag
     C*
     C           MOVDAT    IFLT CSCT
     C                     MOVE 'Y'       CSBT
     C                     MOVELNATN      TNLU
     C                     END
     C*
     C           MOVDAT    IFLT CSCV
     C                     MOVE 'Y'       CSBV
     C                     MOVELNATN      TNLU
     C                     END
     C*
     C***********          Z-ADDMOVDAT    CSDA                            E20032
     C*
     C                     UPDATCPOSNDF
     C                     END
     C/COPY WNCPYSRC,SE0070C066
     C*
     C* else if not Portfolio Customer movement
     C*
     C                     ELSE
     C/COPY WNCPYSRC,SE0070C067
     C*
     C* Update User In depot record
     C*
     C                     MOVE XDPID     DEPOT
     C           UDEPKB    CHAINUDEPPDF              33
     C*
     C           DPMV      IFEQ 'DT'
     C***********DPMV      OREQ 'BL'                                      E23561
     C***********DPMV      OREQ 'BB'                                      E23561
     C                     SUB  XDPNA     UDTP
     C           MOVDAT    IFLE RUND
     C                     SUB  XDPNA     UDPV
     C                     SUB  XDPNA     UNSI                            115651
     C                     END
     C                     END
     C*
     C           DPMV      IFEQ 'RP'
     C           XDPMD     ANDGTRUND                                      E21066
     C           DPMV      OREQ 'PD'                                      E16929
     C           XDPMD     ANDGTRUND                                      E13934
     C           DPMV      OREQ 'BL'                                      E23561
     C           XDPMD     ANDGTRUND                                      E23561
     C***********          SUB  XDPNA     USNT                            E32482
     C                     ADD  XDPNA     USNT                            E32482
     C           XDPDO     IFLE RUND
     C***********          SUB  XDPNA     USNV                            E32482
     C                     ADD  XDPNA     USNV                            E32482
     C                     ADD  XDPNA     UNSI                            115651
     C                     END
     C                     END
     C*
     C           DPMV      IFEQ 'RR'
     C           XDPDO     ANDGTRUND                                      E21066
     C           DPMV      OREQ 'PL'                                      E16929
     C           XDPDO     ANDGTRUND                                      E13934
     C           DPMV      OREQ 'BB'                                      E23561
     C           XDPDO     ANDGTRUND                                      E23561
     C*********************SUB  XDPNA     USNR                            E23561
     C***********          ADD  XDPNA     USNR                     E23561 E32482
     C                     SUB  XDPNA     USNR                            E32482
     C           XDPMD     IFLE RUND
     C*********************SUB  XDPNA     USRV                            E23561
     C***********          ADD  XDPNA     USRV                     E23561 E32482
     C                     SUB  XDPNA     USRV                            E32482
     C                     SUB  XDPNA     UNSI                            115651
     C                     END
     C                     END
     C*
     C                     MOVELNATN      TNLU
     C                     UPDATUDEPPDF
     C***********                                                         E13934
     C**Update*User*Out*depot*record***********************************   E13934
     C***********                                                         E13934
     C***********          MOVE XDPOD     DEPOT                           E13934
     C***********UDEPKB    CHAINUDEPPDF              33                   E13934
     C***********                                                         E13934
     C***********DPMV      IFEQ 'DT'                                      E13934
     C***********DPMV      OREQ 'BL'                                      E13934
     C***********DPMV      OREQ 'BB'                                      E13934
     C***********          ADD  XDPNA     UDTS                            E13934
     C***********MOVDAT    IFLE RUND                                      E13934
     C***********          ADD  XDPNA     UDSV                            E13934
     C***********          END                                            E13934
     C***********          END                                            E13934
     C***********                                                         E13934
     C***********DPMV      IFEQ 'RP'                                      E13934
     C***********          ADD  XDPNA     USNT                            E13934
     C***********XDPDO     IFLE RUND                                      E13934
     C***********          ADD  XDPNA     USNV                            E13934
     C***********          END                                            E13934
     C***********          END                                            E13934
     C***********                                                         E13934
     C***********DPMV      IFEQ 'RR'                                      E13934
     C***********          ADD  XDPNA     USNR                            E13934
     C***********XDPMD     IFLE RUND                                      E13934
     C***********          ADD  XDPNA     USRV                            E13934
     C***********          END                                            E13934
     C***********          END                                            E13934
     C***********                                                         E13934
     C***********          MOVELNATN      TNLU                            E13934
     C***********          UPDATUDEPPDF                                   E13934
     C*
     C* Update User Out depot record                                      E21066
     C*                                                                   E21066
     C           DPMV      IFEQ 'DT'                                      E21066
     C                     MOVE XDPOD     DEPOT                           E21066
     C           UDEPKB    CHAINUDEPPDF              33                   E21066
     C*                                                                   E21066
     C                     ADD  XDPNA     UDTS                            E21066
     C           MOVDAT    IFLE RUND                                      E21066
     C                     ADD  XDPNA     UDSV                            E21066
     C                     ADD  XDPNA     UNSI                            115651
     C                     END                                            E21066
     C*                                                                   E21066
     C                     MOVELNATN      TNLU                            E21066
     C                     UPDATUDEPPDF                                   E21066
     C                     END                                            E21066
     C                     END
     C/COPY WNCPYSRC,SE0070C068
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDPOS - Subroutine to calculate Book Position values.       *
      *                                                               *
      *****************************************************************
      *
R134 C           UPDPOS    BEGSR                           *** UPDPOS ***
R134 C*
     C* Delete or amend mode
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'A'
     C*
     C* Calculate old Consideration - Fetch Security
     C*
     C           DPSS      CHAINSECTYDF              33
     C*
     C* Fetch Nominal currency details
     C*
     C***********          MOVEL*BLANKS   KEY12  12                       S01117
     C***********          MOVEL'20'      KEY12                           S01117
     C***********          MOVE '1'       WFLD4   4                       S01117
     C***********          MOVELNMCY      WFLD4                           S01117
     C***********          MOVE WFLD4     KEY12                           S01117
     C***********KEY12     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*
     C* Fetch investment type details
     C*
     C           INVKA     CHAININVTPDF              33
     C*
     C**Initialise*and*fetch*correct*work*field*for*result*************   E21216
     C*
     C***********          Z-ADD*ZEROS    XCONS  150                      E21216
     C***********          Z-ADD*ZEROS    XCONS0 150                      E21216
     C***********          Z-ADD*ZEROS    XCONS1 151                      E21216
     C***********          Z-ADD*ZEROS    XCONS2 152                      E21216
     C***********          Z-ADD*ZEROS    XCONS3 153                      E21216
     C***********          MOVEA'0000'    *IN,25                          E21216
     C***********25        ADD  CDP       J       20                      E21216
     C***********          MOVEA'1'       *IN,J                           E21216
     C***********                                                         E21216
     C***Calculate*consideration/reallowance/charges/commission********   E21216
     C***********                                                         E21216
     C***25******XMKTP     MULT XDPNA     XCONS0    H                     E21216
     C***26******XMKTP     MULT XDPNA     XCONS1    H                     E21216
     C***27******XMKTP     MULT XDPNA     XCONS2    H                     E21216
     C***28******XMKTP     MULT XDPNA     XCONS3    H                     E21216
     C***********                                                         E21216
     C**Remember*Countervalue******************************************   E21216
     C***********                                                         E21216
     C***25******          MOVE XCONS0    XVALUE 150                      E21216
     C***26******          MOVE XCONS1    XVALUE                          E21216
     C***27******          MOVE XCONS2    XVALUE                          E21216
     C***28******          MOVE XCONS3    XVALUE                          E21216
     C***********                                                  S01176 E21216
     C***********5         SUB  NMDP      DC      10               S01176 E21216
     C***********          MULT POWER8,DC VALUE     H              S01176 E21216
     C***********                                                  S01176 E21216
     C***********SPBS      IFEQ 'P'                                S01176 E21216
     C***********          DIV  100       VALUE     H              S01176 E21216
     C***********          END                                     S01176 E21216
     C*                                                                   S01176
     C*  CALCULATE CONSIDERATION FOR AP NUMERATOR                         E21216
     C*                                                                   E21216
     C                     Z-ADDXDPNA     ZNOML                           E21216
     C***********          Z-ADDXMKTP     ZPRC                     E21216 E21480
     C                     Z-ADDXMKTP     ZPRCIN                          E21480
     C                     Z-ADDXDPMD     ZFDATE                          E21480
     C*                                                                   E21480
     C*     Set up parameters for Australian Yields mod                   E21480
     C*                                                                   E21480
     C           STBS      IFEQ 'Y'                                       E21480
     C           SYBS      ANDEQ'AU'                                      E21480
     C                     Z-ADDXDPMD     ZECD                            E21480
     C                     EXSR ZLCD                                      E21480
     C                     Z-ADDXDPMD     ECD                             E21480
     C                     EXSR ZNCD                                      E21480
     C                     Z-ADDZZLCD     ZDCSDT                          E21480
     C                     Z-ADDXDPMD     ZDCEDT                          E21480
     C                     Z-ADDZNOML     ZAMT                            E21480
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZACCZ                                     E21480
     C                     Z-ADDXDPMD     WRKD    50                      E21480
     C           ZDCINT    DIV  ZNOML     WRKPI                           E21480
     C                     EXSR ZYCE                                      E21480
     C*                                                                   E21480
     C*          IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST    E21480
     C*          TILL NCD AND IS NEGATIVE                                 E21480
     C*                                                                   E21480
     C           SCUMEX    IFEQ 'X'                                       E21480
     C                     Z-ADDZZLCD     ZDCSDT                          E21480
     C                     Z-ADDNCD       ZDCEDT                          E21480
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZACCZ                                     E21480
     C           ZDCINT    DIV  ZNOML     WKWPI  159                      E21480
     C           WRKPI     SUB  WKWPI     WRKPI                           E21480
     C                     END                                            E21480
     C                     ELSE                                           E21480
     C                     MOVE 'C'       SCUMEX  1                       E21480
     C                     Z-ADD0         WRKPI                           E21480
     C                     END                                            E21480
     C*                                                                   E21480
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP7                                           S01408
     C*                                                                   S01408
      *                                                                                       CSE035
      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     EXSR ZPRCI                                     E21480
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP8                                           S01408
     C*                                                                   S01408
     C                     Z-ADDZPRCOT    ZPRC                            E21480
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZCNSD                                     E21216
     C                     Z-ADDZCONS     XVALUE 150                      E21216
     C*                                                                   E21216
     C           PROT      IFEQ '8'                                       S01176
     C***********          MULT CFCT      VALUE     H              S01176 E21216
     C                     MULT CFCT      XVALUE    H                     E21216
     C                     END                                            S01176
     C/COPY WNCPYSRC,SE0070C085
     C*
     C**Price*basis*-*divide*by*100************************************   E21216
     C***********                                                         E21216
     C***********SPBS      IFEQ 'P'                                E15326 E21216
     C***25******          DIV  100       XVALUE                   E15326 E21216
     C***26******          DIV  100       XVALUE                   E15326 E21216
     C***27******          DIV  100       XVALUE                   E15326 E21216
     C***28******          DIV  100       XVALUE                   E15326 E21216
     C***********          END                                     E15326 E21216
     C*
     C                     END
     C*
     C* Insert or amend mode
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C*
     C* Calculate Consideration - Fetch Security
     C*
     C           DPSS      CHAINSECTYDF              33
     C*
     C* Fetch Nominal currency details
     C*
     C***********          MOVEL*BLANKS   KEY12  12                       S01117
     C***********          MOVEL'20'      KEY12                           S01117
     C***********          MOVE '1'       WFLD4   4                       S01117
     C***********          MOVELNMCY      WFLD4                           S01117
     C***********          MOVE WFLD4     KEY12                           S01117
     C***********KEY12     CHAINTABTG10F             33                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM NMCY      @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*
     C* Fetch investment type details
     C*
     C           INVKA     CHAININVTPDF              33
     C*
     C**Initialise*and*fetch*correct*work*field*for*result****************E21216
     C***********                                                         E21216
     C***********          Z-ADD*ZEROS    CONS   150                      E21216
     C***********          Z-ADD*ZEROS    CONS0  150                      E21216
     C***********          Z-ADD*ZEROS    CONS1  151                      E21216
     C***********          Z-ADD*ZEROS    CONS2  152                      E21216
     C***********          Z-ADD*ZEROS    CONS3  153                      E21216
     C***********          MOVEA'0000'    *IN,25                          E21216
     C***********25        ADD  CDP       J                               E21216
     C***********          MOVEA'1'       *IN,J                           E21216
     C***********                                                         E21216
     C***Calculate*consideration/reallowance/charges/commission********   E21216
     C***********                                                         E21216
     C***25******MKTP      MULT DPNA      CONS0     H                     E21216
     C***26******MKTP      MULT DPNA      CONS1     H                     E21216
     C***27******MKTP      MULT DPNA      CONS2     H                     E21216
     C***28******MKTP      MULT DPNA      CONS3     H                     E21216
     C*
     C**Remember*Countervalue*********************************************E21216
     C***********                                                         E21216
     C***25******          MOVE CONS0     VALUE  150                      E21216
     C***26******          MOVE CONS1     VALUE                           E21216
     C***27******          MOVE CONS2     VALUE                           E21216
     C***28******          MOVE CONS3     VALUE                           E21216
     C***********                                                  S01176 E21216
     C***********5         SUB  NMDP      DC                       S01176 E21216
     C***********          MULT POWER8,DC VALUE     H              S01176 E21216
     C***********                                                  E16929 E21216
     C***********SPBS      IFEQ 'P'                                E16929 E21216
     C***********          DIV  100       VALUE     H              E16929 E21216
     C***********          END                                     E16929 E21216
     C*                                                                   E16929
     C*  CALCULATE CONSIDERATION FOR AP NUMERATOR                         E21216
     C*                                                                   E21216
     C                     Z-ADDDPNA      ZNOML                           E21216
     C***********          Z-ADDMKTP      ZPRC                     E21216 E21480
     C                     Z-ADDMKTP      ZPRCIN                          E21480
     C                     Z-ADDDPMD      ZFDATE                          E21480
     C*                                                                   E21480
     C*     Set up parameters for Australian Yields mod                   E21480
     C*                                                                   E21480
     C           STBS      IFEQ 'Y'                                       E21480
     C           SYBS      ANDEQ'AU'                                      E21480
     C                     Z-ADDDPMD      ZECD                            E21480
     C                     EXSR ZLCD                                      E21480
     C                     Z-ADDDPMD      ECD                             E21480
     C                     EXSR ZNCD                                      E21480
     C                     Z-ADDZZLCD     ZDCSDT                          E21480
     C                     Z-ADDDPMD      ZDCEDT                          E21480
     C                     Z-ADDZNOML     ZAMT                            E21480
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZACCZ                                     E21480
     C                     Z-ADDDPMD      WRKD    50                      E21480
     C           ZDCINT    DIV  ZNOML     WRKPI                           E21480
     C                     EXSR ZYCE                                      E21480
     C*                                                                   E21480
     C*          IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST    E21480
     C*          TILL NCD AND IS NEGATIVE                                 E21480
     C*                                                                   E21480
     C           SCUMEX    IFEQ 'X'                                       E21480
     C                     Z-ADDZZLCD     ZDCSDT                          E21480
     C                     Z-ADDNCD       ZDCEDT                          E21480
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZACCZ                                     E21480
     C           ZDCINT    DIV  ZNOML     WKWPI  159                      E21480
     C           WRKPI     SUB  WKWPI     WRKPI                           E21480
     C                     END                                            E21480
     C                     ELSE                                           E21480
     C                     MOVE 'C'       SCUMEX  1                       E21480
     C                     Z-ADD0         WRKPI                           E21480
     C                     END                                            E21480
     C*                                                                   E21480
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP9                                           S01408
     C*                                                                   S01408
     C                     EXSR ZPRCI                                     E21480
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CP10                                           S01408
     C*                                                                   S01408
      *                                                                                       CSE035
      ** ADJUST NUMBER OF DECIMAL PLACES FOR PRICE                                            CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     Z-ADDZPRCOT    ZPRC                            E21480
     C                     Z-ADDA6NBDP    ZCDP                            S01117
     C                     EXSR ZCNSD                                     E21216
     C                     Z-ADDZCONS     VALUE  150                      E21216
     C*                                                                   E21216
     C           PROT      IFEQ '8'                                       E16929
     C                     MULT CFCT      VALUE     H                     E16929
     C                     END                                            E16929
     C/COPY WNCPYSRC,SE0070C086
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE0070CCP5                                           S01408
     C*                                                                   S01408
      /EJECT                                                              S01232
      *****************************************************************   S01117
      **                                                              *   S01117
      ** *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS       *   S01117
      ** CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                 *   S01117
      ** CALLS: NOTHING                                               *   S01117
      **                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01445
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
     C*****************************************************************   S01117
     C**                                                              *   S01117
     C** CHKSEL - SUBROUTINE TO CHECK FOR SELECTION ON DETAIL SCREEN  *   S01117
     C** CALLED FROM: UPDATE                                          *   S01117
     C** CALLS: AOSECSR0,AOBRCHR0,AOBOOKR0,AOPRFCR0                   *   S01117
     C**                                                              *   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           CHKSEL    BEGSR                           ** CHKSEL **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C                     MOVELSDPID     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSDPID     @AENB                           S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @AENB                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SDPID                           S01117
     C                     SETOF                     41                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBFCUST    SDPID                           S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE0070C172
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSDPOD     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSDPOD     @AENB                           S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @AENB                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SDPOD                           S01117
     C                     SETOF                     43                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBFCUST    SDPOD                           S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE0070C173
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSDPBA     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSDPBA     @DSNB                           S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     MOVE *BLANKS   SDPBA                           S01117
     C                     SETOF                     45                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA8BRCD    SDPBA                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSORBR     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSORBR     @DSNB                           S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     MOVE *BLANKS   SORBR                           S01117
     C                     SETOF                     54                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA8BRCD    SORBR                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSDPBK     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSDPBK     @BKEY                           S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @BKEY                           S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SDPBK                           S01117
     C                     SETOF                     46                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBDBKCD    SDPBK                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSDPBN     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSDPBN     @AENB                           S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @AENB                           S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SDPBN                           S01117
     C                     SETOF                     47                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBFCUST    SDPBN                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSDPPC     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SDPPC     @PKEY                           S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SDPPC                           S01117
     C                     SETOF                     55                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELDSPCCD    SDPPC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** CHKSEL **   S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
     C********************************************************************S01496
     C*                                                                   S01496
     C* SR70XA - SR to test price within % tolerance of market price      S01496
     C*                                                                   S01496
      **  WWPSSN   : SECURITY SHORTNAME                                   S01496
      **  WWTDDT   : TRADE DATE                                           S01496
      **  WWPPRC   : (OUT) MARKET PRICE FOUND                             S01496
      **  RES70X   : (OUT) 'Y'=DO THE CHECK                               S01496
      **                   'N'=DO NOT THE CHECK, PRICE NOT FOUND          S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
     C           SR70XA    BEGSR                           ** SR70XA **   S01496
     C*                                                                   S01496
      ** KLIST FOR PRICES FILE                                            S01496
     C           KPRICN    KLIST                                          S01496
     C                     KFLD           WWPSSN 10                       S01496
     C                     KFLD           WWTDDT  50                      S01496
      *                                                                   S01496
      ** FIND MARKET PRICE WITH CORRECT DATE                              S01496
     C                     MOVE 'N'       RES70X  1                       S01496
      *                                                                   S01496
     C           KPRICN    SETGTPRICM                                     S01496
     C                     READPPRICM                    44               S01496
     C*                                                                   S01496
     C** IF RECORD FOUND USE THIS PRICE                                   S01496
     C           *IN44     IFEQ '0'                        B1             S01496
     C           PSSN      ANDEQWWPSSN                                    S01496
     C                     MOVE 'Y'       RES70X                          S01496
     C*                                                                   S01496
     C** ..OTHERWISE CHECK FOR CURRENT PRICE                              S01496
     C                     ELSE                            X1             S01496
     C                     Z-ADD*HIVAL    WWTDDT                          S01496
      *                                                                   S01496
     C           KPRICN    SETGTPRICM                                     S01496
     C                     READPPRICM                    44               S01496
     C*                                                                   S01496
     C** IF RECORD FOUND USE THIS PRICE                                   S01496
     C           *IN44     IFEQ '0'                        B2             S01496
     C           PSSN      ANDEQWWPSSN                                    S01496
     C                     MOVE 'Y'       RES70X                          S01496
     C                     END                             E2             S01496
     C                     END                             E1             S01496
      *                                                                   S01496
     C           RES70X    IFEQ 'N'                                       S01496
     C                     Z-ADD0         WWPPRC 158                      S01496
     C                     ELSE                                           S01496
     C                     Z-ADDPPRC      WWPPRC                          S01496
     C                     ENDIF                                          S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C********************************************************************S01496
     C*                                                                   S01496
     C* SR70YA - SR to test trade making short position                   S01496
      *                                                                   S01496
      **  WWBRCH   : BRANCH NO                                            S01496
      **  WWSESN   : SECURITY SHORTNAME                                   S01496
      **  WWCNUM   : CUSTOMER NO                                          S01496
      **  WWNOML   : NOMINAL                                              S01496
      **  RES70Y   : (OUT) '0'= O.K.                                      S01496
      **                   '1'= SHORT POSITION                            S01496
      *                                                                   S01496
     C********************************************************************S01496
     C           SR70YA    BEGSR                           ** SR70YA **   S01496
     C*                                                                   S01496
      ** KLIST FOR CPOSC                                                  S01496
     C           KCPOSC    KLIST                                          S01496
     C                     KFLD           WWBRCH  3                       S01496
     C**********           KFLD           WWCNUM  60                                   S01496 CSD027
     C                     KFLD           WWCNUM  6                                           CSD027
     C                     KFLD           WWSESN 10                       S01496
      *                                                                   S01496
      ** INITIALIZATION                                                   S01496
     C                     Z-ADDWWNOML    WWNOML 150                      S01496
     C           *LIKE     DEFN WWNOML    WWPOS                           S01496
     C                     MOVE '0'       RES70Y  1                       S01496
      *                                                                   S01496
      ** FIND CUSTOMER POSITION PREV. DAY                                 S01496
     C           KCPOSC    CHAINCPOSNDF1             44                   S01496
     C           *IN44     IFEQ '1'                                       S01496
     C                     MOVE '1'       RES70Y                          S01496
     C                     END                                            S01496
      *                                                                   S01496
      ** TEST NOMINAL VS. CURRENT POSITION                                S01496
     C           CSNT      IFGT 0                                         S01496
     C           WWNOML    IFGT CSNT                                      S01496
     C                     MOVE '1'       RES70Y                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C** ...OTHERWISE IF POSITION ALREADY SHORT OUTPUT ERROR SHOWING      S01496
     C** THAT POSITION WILL GO EVEN SHORTER                               S01496
     C                     ELSE                                           S01496
     C                     MOVE '1'       RES70Y                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C********************************************************************S01496
     C/EJECT                                                              S01496
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRWTCH - Subroutine that will call the watch list checking    *                       CSD015
      *          engine.                                              *                       CSD015
      * Called by: UPDFLS (Insert and Amend Part)                     *                       CSD015
      * Calls    : SRFMT                                              *                       CSD015
      *            SREXST                                             *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Set-up first parameter                                                               CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PDSWLT                                              CSD015
     C                     MOVEL'SEDPOT'  W4ITEM                                              CSD015
     C                     MOVELDPRN      W4IDEN                                              CSD015
     C                     MOVELDPBA      W4BRCH                                              CSD015
     C                     MOVEL'DPTMVD'  W4FUNT                                              CSD015
     C                     MOVELDPSS      W4DEN1                                              CSD015
      *                                                                                       CSD015
      ** Format Dates                                                                         CSD015
      *                                                                                       CSD015
     C                     Z-ADDDMTD      WWDDAT  50                                          CSD015
     C                     MOVE WWDDAT    W4DDAT                                              CSD015
     C                     Z-ADDDPVD      WWVDAT  50                                          CSD015
     C                     MOVE WWVDAT    W4VDAT                                              CSD015
     C                     Z-ADD0         WWMDAT  50                                          CSD015
     C                     MOVE WWMDAT    W4MDAT                                              CSD015
      *                                                                                       CSD015
      ** Format Amounts                                                                       CSD015
      *                                                                                       CSD015
     C                     Z-ADDDPNA      W4AMT1                                              CSD015
     C                     Z-ADD0         W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Get System Prefix from SC24X7 if CSC011 is installed                                 CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVE S1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Else, get System Prefix from SDSTAT                                                  CSD015
      *                                                                                       CSD015
     C                     MOVE LIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SDCUSTPD using Benificial Customer for Counter Party                          CSD015
      *                                                                                       CSD015
     C                     MOVE DPBN      W4CNUM                                              CSD015
     C                     MOVE DPBN      WDPBN  10                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY'    POPTN                                               CSD015
     C                     PARM WDPBN     PCUST  10                                           CSD015
     C                     PARM *BLANKS   PSTKEY  7                                           CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVELBBCRNM    W4CUST                                              CSD015
     C                     MOVE BBCRTN    W4CUST                                              CSD015
      *                                                                                       CSD015
      ** Get counterparty type depending on CCF001                                            CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANKS                                                       CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Set-up second parameter (Converted Depot in)                                         CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PDSXML                                              CSD015
     C                     MOVE *BLANKS   WDEPOT 35                                           CSD015
     C                     MOVELPNMCY     WPNMCY  3                                           CSD015
     C           WDPIDF    IFNE DPID                                                          CSD015
     C           WUNCF1    OREQ 'Y'                                                           CSD015
     C********** DPID      IFNE *ZERO                                                  CSD015 CSD027
     C           DPID      IFNE *BLANKS                                                       CSD027
     C                     MOVELDPID      WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  OPNTAG,1:0PDSXML                                              CSD015
     C                     CAT  POUTPT:0  PDSXML                                              CSD015
     C                     CAT  CLSTAG,1:0PDSXML                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Set-up second parameter (Converted Depot out)                                        CSD015
      *                                                                                       CSD015
     C           WDPODF    IFNE DPOD                                                          CSD015
     C           WUNCF1    OREQ 'Y'                                                           CSD015
     C********** DPOD      IFNE *ZERO                                                  CSD015 CSD027
     C           DPOD      IFNE *BLANKS                                                       CSD027
     C                     MOVELDPOD      WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  OPNTAG,2:0PDSXML                                              CSD015
     C                     CAT  POUTPT:0  PDSXML                                              CSD015
     C                     CAT  CLSTAG,2:0PDSXML                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Set-up other extended settlements field done in SE1808                               CSD015
      *                                                                                       CSD015
     C           WUNCF1    IFEQ 'Y'                                                           CSD015
     C           ACTN      ANDEQ'A'                                                           CSD015
     C           PMCWL     ANDEQ*BLANKS                                                       CSD015
     C                     EXSR SREXST                                                        CSD015
     C                     CAT  PMCWL:0   PDSXML                                              CSD015
     C                     ELSE                                                               CSD015
     C                     CAT  PMCWL:0   PDSXML                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Call Watch List Engine Program                                                       CSD015
      *                                                                                       CSD015
     C           PDSXML    IFNE *BLANKS                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           PDSWLT                                              CSD015
     C                     PARM           PDSXML                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
     C/EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRFMT  - Convert Settlement details to Customer               *                       CSD015
      *          name and address by calling 'SDCWLFMT'               *                       CSD015
      * Called by: SRWTCH                                             *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRFMT     BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialize parameter to be pass to 'SDCWLFMT'                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUTPT216                                           CSD015
     C                     MOVE *BLANKS   POUTP2  6                                           CSD015
     C                     MOVE *BLANKS   PINPT1 35                                           CSD015
      *                                                                                       CSD015
      ** Call 'SDCWLFMT' to convert watch list fields                                         CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM WDEPOT    PINPT1 35                                           CSD015
     C                     PARM           PINPT2 35                                           CSD015
     C                     PARM           PINPT3 35                                           CSD015
     C                     PARM           PINPT4 35                                           CSD015
     C                     PARM           PINPT5 35                                           CSD015
     C                     PARM           PINPT6 35                                           CSD015
     C                     PARM WPNMCY    PICCY   3                                           CSD015
     C                     PARM           POUTPT                                              CSD015
     C                     PARM           POUTP2                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WDEPOT                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
     C/EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SREXST - Get the extended settlement details directly         *                       CSD015
      *          from file if Hit Unconfirmed Flag is 'Y'             *                       CSD015
      * Called by: SRWTCH                                             *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SREXST    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PMCWL                                               CSD015
     C                     MOVE *BLANKS   WPNMCY                                              CSD015
      *                                                                                       CSD015
      ** Set pointer to first record with key value equal to DPRN                             CSD015
      *                                                                                       CSD015
     C           DPRN      SETLLDPMVEX2                  24                                   CSD015
      *                                                                                       CSD015
      ** Retrieve extended settlements if record is found                                     CSD015
      *                                                                                       CSD015
     C           *IN24     IFEQ '1'                                                           CSD015
     C                     READ DPMVEX2                  31                                   CSD015
      *                                                                                       CSD015
      ** If not end of file and record equal to key is still found                            CSD015
      *                                                                                       CSD015
     C           *IN31     DOWEQ'0'                                                           CSD015
      *                                                                                       CSD015
      ** Format and concatinate extended settlement fields and their                          CSD015
      ** corresponding tags to PMCWL if they are not blank                                    CSD015
      *                                                                                       CSD015
     C                     Z-ADD1         WX      20                                          CSD015
     C           D2AFPN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2AFPN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2AWIN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2AWIN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2BOFN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2BOFN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2IPYN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IPYN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2CTYN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2CTYN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2SKAN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2SKAN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2DCTL    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2DCTL    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2RSSN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2RSSN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2DSSN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2DSSN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2BSSN    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2BSSN    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           D2INVE    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2INVE    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     EXSR SRCAT                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      **  Settlement Party Intermediary 1 - 9                                                 CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PMCWL1                                              CSD015
     C           D2IMD1    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD1    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMD2    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD2    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMD3    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD3    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMD4    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD4    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMD5    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD5    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMD6    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD6    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMD7    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD7    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMD8    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD8    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMD9    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMD9    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           PMCWL1    IFNE *BLANKS                                                       CSD015
     C                     CAT  EXTG1,WX:0PMCWL                                               CSD015
     C                     CAT  PMCWL1:0  PMCWL                                               CSD015
     C                     CAT  EXTG2,WX:0PMCWL                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      **  Safekeeping Account Intermediary 1 - 9                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PMCWL1                                              CSD015
     C           D2IMS1    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS1    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMS2    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS2    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMS3    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS3    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMS4    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS4    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMS5    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS5    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMS6    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS6    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMS7    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS7    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMS8    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS8    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           D2IMS9    IFNE *BLANKS                                                       CSD015
     C                     MOVELD2IMS9    WDEPOT                                              CSD015
     C                     EXSR SRFMT                                                         CSD015
     C                     CAT  POUTPT:0  PMCWL1                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ADD  1         WX                                                  CSD015
     C           PMCWL1    IFNE *BLANKS                                                       CSD015
     C                     CAT  EXTG1,WX:0PMCWL                                               CSD015
     C                     CAT  PMCWL1:0  PMCWL                                               CSD015
     C                     CAT  EXTG2,WX:0PMCWL                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Read next record with key value still equal to DPRN                                  CSD015
      *                                                                                       CSD015
     C           DPRN      READEDPMVEX2                  31                                   CSD015
      *                                                                                       CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
     C/EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRCAT  - Concatinate the tags with the converted extended     *                       CSD015
      *          settlement details to create the XML format          *                       CSD015
      * Called by: SREXST                                             *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRCAT     BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     CAT  EXTG1,WX:0PMCWL                                               CSD015
     C                     CAT  POUTPT:0  PMCWL                                               CSD015
     C                     CAT  EXTG2,WX:0PMCWL                                               CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      *  SRIDXT - Handles the advice index of the current             *                       CRE020
      *           transaction.                                        *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
     C           SRIDXT    BEGSR                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE *BLANKS   KREFNO                                              CRE020
     C                     MOVELDPRN      KREFNO                                              CRE020
      *                                                                                       CRE020
     C                     OPEN READVCL1                                                      CRE020
     C           KADVC     CHAINREADVCL1             69                                       CRE020
      *                                                                                       CRE020
     C           *IN69     IFEQ *ON                                                           CRE020
     C                     MOVE *BLANKS   RREFNO                                              CRE020
     C                     MOVELDPRN      RREFNO                                              CRE020
     C                     MOVE *BLANKS   RPRGMN                                              CRE020
     C                     MOVEL'SE0070'  RPRGMN                                              CRE020
     C                     MOVE *BLANKS   RSEQNO                                              CRE020
     C                     MOVE DPMV      RTRTYP                                              CRE020
     C                     MOVE CHTP      RCHTYP                                              CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     MOVE *BLANKS   RENARR                                              CRE020
     C                     WRITEREADVCD0                                                      CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
      ** Check first if this is a new record.                                                 CRE020
      *                                                                                       CRE020
     C           RCHTYP    IFEQ 'I'                                                           CRE020
     C           RSAPIN    ANDEQ'N'                                                           CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'D'                                                           CRE020
     C                     MOVE 'D'       RCHTYP                                              CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     UPDATREADVCD0                                                      CRE020
     C                     GOTO EIDXT                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           CHTP      IFEQ 'A'                                                           CRE020
     C                     MOVE 'I'       RCHTYP                                              CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE CHTP      RCHTYP                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE CHTP      RCHTYP                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     UPDATREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     CLOSEREADVCL1                                                      CRE020
      *                                                                                       CRE020
     C           EIDXT     ENDSR                                                              CRE020
      *****************************************************************                       CRE020
      /EJECT                                                                                  CSD015
     C/COPY WNCPYSRC,SE0070C073
     C/COPY ZSRSRC,ZSDESCZ3                                               CSE016
     C*/COPY*ZSRSRC,XDATE3Z1****************************************S01232S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCRZ1                                                S01232
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZACCZZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT                                                              039495
     C/COPY ZSRSRC,ZCALCD                                                 039495
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT                                                              E21216
     C/COPY ZSRSRC,ZCNSDZ1                                                E21216
      /EJECT
     C/COPY ZSRSRC,ZCOLLVZ1
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C***/COPY*ZSRSRC,ZDATE6Z2***                                         S01176
     C*/COPY*ZSRSRC,ZDATE5Z2****************************************S01176S01195
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C*COPY*ZSRSRC,ZICD2Z1**                                              S01117
      *EJECT                                                              S01117
     C*COPY*ZSRSRC,ZICDSEZ1**                                             S01117
      *EJECT                                                              S01117
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT
     C/COPY ZSRSRC,ZPRCIZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZRATEZ1                                                S01232
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT                                                              S01232
     C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT
     C/COPY ZSRSRC,ZYLDIZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT                                                              S01486
     C/COPY ZSRSRC,ZSEDITZ31                                              S01486
     C/COPY ZSRSRC,ZCCYCN                                                 S01486
      /EJECT                                                              CPB001
     C/COPY ZSRSRC,ZASIGNZ2                                               CPB001
      /EJECT                                                              CPB001
     C/COPY ZSRSRC,ZPCINTZ1                                               CPB001
      /EJECT
      ***
     C/COPY WNCPYSRC,SE0070C090
      **  13TH ELEMENT ADDED TO INF.                                      S01401
      * /112563/
      *INF,6  DELETION F3:F10 to delete this record:F12:Rollup:Rolldown:Help
      *INF,9  F10 is required
      *INF,10 F10 is not required
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
** INF
 Enter:Action Code I,A,D,E and selection:Review from point:F3:Help
 Enter:Review from point:Action Code A,D,E:F3:F12:Rollup:Rolldown:Help
 INSERTION Enter:F3:F12:Help
 AMENDMENT Enter:F3:F12:Rollup:Rolldown:Help
 ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help
 DELETION F3:F10=Delete record:F12:Rollup:Rolldown:Help
 Rollup is not possible
 Rolldown is not possible
 F10=Confirm

 Record has been updated by another workstation
      *END PROGRAM SPECIFICATIONS:COMPILE TIME ARRAYS******************
 Return file not updated
 FILE NOT UPDATED - MARKET MIGRATION IS ACTIVE
**   TABTYP/TABDSC - Movement types/Descriptions
WIWALK IN
WOWALK OUT
DTDEPOT TRANSFER
BLBOND LENDING
BBBOND BORROWING
RPREPO
RRREVERSE REPO
PDPLEDGED DEPOSIT
PLPLEDGED LOAN
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER8 - ARRAY OF POWERS FOR NOMINAL DP TO CURRENCY DP CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  CPY@
(c) Finastra International Limited 2001
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
     X/COPY WNCPYSRC,SE0070X001
**  OPNTAG                                                                                    CSD015
<Depot In>                                                                                    CSD015
<Depot Out>                                                                                   CSD015
**  CLSTAG                                                                                    CSD015
</Depot In>                                                                                   CSD015
</Depot Out>                                                                                  CSD015
**  EXTG1 - Arrays containing the open tags of extended settlements                           CSD015
<Account for Payment>                                                                         CSD015
<A/C with Institution>                                                                        CSD015
<Beneficiary>                                                                                 CSD015
<Instructing Party>                                                                           CSD015
<Counterparty>                                                                                CSD015
<Safekeeping Account>                                                                         CSD015
<Deliverr Instrctg Prty>                                                                      CSD015
<Receivers of Securties>                                                                      CSD015
<Deliverrs of Securties>                                                                      CSD015
<Benfciary of Securties>                                                                      CSD015
<Investor>                                                                                    CSD015
<Sttlmnt Prty Intmdiary>                                                                      CSD015
<Safkeepg A/C Intmdiary>                                                                      CSD015
**  EXTG2 - Arrays containing the open tags of extended settlements                           CSD015
</Account for Payment>                                                                        CSD015
</A/C with Institution>                                                                       CSD015
</Beneficiary>                                                                                CSD015
</Instructing Party>                                                                          CSD015
</Counterparty>                                                                               CSD015
</Safekeeping Account>                                                                        CSD015
</Deliverr Instrctg Prty>                                                                     CSD015
</Receivers of Securties>                                                                     CSD015
</Deliverrs of Securties>                                                                     CSD015
</Benfciary of Securties>                                                                     CSD015
</Investor>                                                                                   CSD015
</Sttlmnt Prty Intmdiary>                                                                     CSD015
</Safkeepg A/C Intmdiary>                                                                     CSD015
