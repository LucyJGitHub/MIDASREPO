     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Prices input')
/*OVRF*: OVRDBF FILE(PRICEX) TOFILE(PRICE) SHARE(*NO)               : *
/*OVRF*: OVRDBF FILE(EXVALDX) TOFILE(EXVALD) SHARE(*NO)             : *   S01169
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                        *
     F*                                                               *
     F*  SE0080 - PRICES INPUT                                        *
     F*                                                               *
     F*  Function: This program processes the input of Prices for     *
     F*   (I/C)    valuation of Unrealised Profit, Mark to Market     *
     F*            Revaluation and the overriding of system           *
     F*            calculated Prices.                                 *
     F*                                                               *
     F*  Called By: SEC02 - Input Cycle Processing                    *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD031             Date 10Apr06               *
      *  Prev Amend No. CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 210760             Date 22Oct02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 01Jul02               *
      *                 CSD010             Date 03May02               *
      *                 188670             Date 22Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 176905             Date 14Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 14May01               *
      *                 CAP060             Date 14May01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 138641             Date  1Dec99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE006             Date 19May99               *
      *                 CPB001             DATE 14Sep99               *
      *                 154861             Date 28Oct99               *
      *                 164740             Date 23Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 23Nov98               *
      *                 104633             Date 07Nov96               *
      *                 104058             Date 01Nov96               *
     F*                 101019 (JB3181)    DATE 28AUG96               *
     F*                 076512 (JB2834)    DATE 08AUG96               *
     F*                 095551             DATE 17JAN96               *
     F*                 094836             DATE 02NOV95               *
     F*                 S01486             DATE 24NOV94               *
     F*                 075685             DATE 04NOV94               *
     F*                 052254             DATE 06JAN94               *
     F*                 051284             DATE 23NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E41611             DATE 28JUN92               *
     F*                 E24419             DATE 23JAN91               *
     F*                 S01220             DATE 12NOV90               *
     F*                 S01117             DATE 29OCT90               *
     F*                 S01269             DATE 18OCT90               *
     F*                 E22913             DATE 31JUL90               *
     F*                 E20651             DATE 10JAN90               *
     F*                 S01199             DATE 01AUG89               *
     F*                 E17998             DATE 10JUL89               *
     F*                 E17100             DATE 28/02/89              *
     F*                 S01179             DATE 21/10/88              *
     F*                 E16079             DATE 21/11/88              *
     F*                 S01169             DATE 10/06/88              *
     F*                 E14837             DATE 17/09/88              *
     F*                 E14277             DATE 27/07/88              *
     F*                 E13911             DATE 29/06/88              *
     F*                 E13580             DATE 17/06/88              *
     F*                 S01158             DATE 05/05/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  210760 - Data mapping error on PRICE file. Time stamp error. *
      *           Initialise a default time stamp. Complete the fix   *
      *           CPK015.                                             *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  CSD010 - Collateralised Lending (Securities and FX Pricing)  *
      *           (Recompile)                                         *
      *  188670 - Message error issued by system during input of      *
      *           price was due to incosistency of PF/PRICED and      *
      *           PF/SEPRICPD.  Fix is to update SEPRICPD everytime   *
      *           PRICED is being updated.                            *
     F*  176905 - Manage correctly the fields FX rates and mult/div   *
     F*           indicator. Fill them when needed by default.        *
     F*           Includes changes for 183291.                        *
      *  CSD006 - Market Data Feed (recompile)                        *
      *  CAP060 - Midas APIs. Security Prices Full API (recompile)    *
     F*  138641 - Prevent the creation of duplicate rec. on PRICED.   *
     F*  CSE006 - Validation added to ensure that books will not      *
     F*           be accepted with Buy-Sell indicators equal 'Y'.     *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  154861 - Review display of field PTFR when it's the none     *
     F*           Portfolio Reference ('9997')                        *
     F*  164740 - Display Branch even MBIN 'N'                        *
     F*           Otherwise user cannot input CV/CT price with        *
     F*           Portf Ref  '   '.                                   *
     F*           As branch is displayed by 88. Seton 88 in all cases *
     F*           without check of MBIN, and change test where 88 is  *
     F*           used to know if MultiBranching is on or not by test *
     F*           of MBIN.                                            *
      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
     F*  104633 - GUI Amendments to DSPF with non-standard footers    *
     F*  104058 - Defaulting of PTFR incorrect                        *
     F*  101019 - Remove database error 03. Instead, issue an error   *
     F*           message if there is no corresponding record in      *
     F*           EXVALD (and EXTEL interface exists). Allow enquiry  *
     F*           even if EXVALD Record Id is no longer 'D'.          *
     F*         - Also, check if the security exists during Amend     *
     F*           mode, and Price Type 'V' is specified. If security  *
     F*           does not exist anymore, send error code '104'.      *
     F*         - Also, allow deletion even if Security no longer     *
     F*           exist.                                              *
     F*  076512 - need to blank positions 7-10 of client if short name*
     F*           entered that is longer than 6 characters .          *
     F*  095551 - If price is %, mult current price X 100             *
     F*  094836 - Branch must be blank when portfolio ref. entered    *
     F*  S01486 - Incorporation of PM Enhancement (S01235)            *
     F*           Fixes 47719 & R0657 have been included.             *
     F*  075685 - BRANCH MUST BE BLANK WHEN PRICE TYPE IS 'V'         *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  051284 - If RECI = '*', flag the record as 'ACTIONED', not   *
     F*           'DELETED'.                                          *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*         - Recompiled due to changes to files.                 *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*         - Recompiled due to changes to files.                 *
     F*  E41611 - Wrong Current Price displayed.                      *
     F*         - Multiply by 100 if Price Basis  = 'P' (%).          *
     F*  E24419 - Should check to see if record exists on Enquiry.    *
     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
     F*           Recompiled over changed PF/SECTYD                   *
     F*  S01117 - MULTIBRANCHING                                      *
     F*  S01269 - Trade authorisation: recompiled for change to file  *
     F*           TABSE                                               *
     F*  E22913 - W01 DISPLAYED EVEN IF PRICE WITHIN 10% OF OLD PRICE *   E22913
     F*  E20651 - DB Error Numbers used in more than one place.       *   E20651
     F*           New Error Numbers as follows:                       *   E20651
     F*           DB ERROR 04 -> 05.                                  *   E20651
     F*           DB ERROR 04 -> 06.                                  *   E20651
     F*           DB ERROR 04 -> 07.                                  *   E20651
     F*  S01199 -  HELP SYSTEM.                                    *   S01199
     F*  E17998 - Value Date must not be prior to Back Value Period.  *   E17998
     F*  E17100 - Unable to exit program.                             *   E17100
     F*  S01179   ****** AS400 CONVERSION ******                      *   S01179
     F*                                                               *   S01179
     F*     The keyword RTGAID is no longer supported on the AS400    *   S01179
     F*     and command keys and indicators have been used to replace *   S01179
     F*     this in the display file. To disrupt the structure of the *   S01179
     F*     program as little as possible a new subroutine - ASCHGS - *   S01179
     F*     has been coded. This moves the values which would have    *   S01179
     F*     been passed to the program (via RTGAID) into the AID      *   S01179
     F*     field depending on which function key has been pressed.   *   S01179
     F*  E16079 - 1) H Spec was missing - DUMP would not work         *   E16079
     F*           2) E Spec for array INF did not match data          *   E16079
     F*  S01169 - SECURITIES TRADING 3.1 (BAER INCORPORATION)         *   S01169
     F*  E14837 - Allow for nominal and currency decimal places       *   E14837
     F*           when calculating current price and ensure that      *   E14837
     F*           a negative price is not passed to ZEDIT for         *   E14837
     F*           amends or enquiries                                 *   E14837
     F*  E14277 - ERROR IN USE OF HELP KEY AND THE DISPLAY OF         *   E14277
     F*           INSTRUCTIONS AT THE BOTTOM OF THE SCREEN.           *   E14277
     F*  E13911 - POST INCORPORATION DEVELOPMENT FIX - ZEDIT DOES NOT *   E13911
     F*           CATER FOR NEGATIVE NUMBERS.                         *   E13911
     F*  E13580 - DISPLAY PREVIOUS SCREEN FOR 'ROLLBACK' KEY INSTEAD  *   E13580
     F*           OF FIRST SCREEN.                                    *   E13580
     F*  S01158 - SE POST INCORPORATION DEVELOPMENT ERROR FIX         *   S01158
     F*                                                               *
     F*****************************************************************
      *
     FSE0080DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        RRN   KSFILE SUBFLREC
     FPRICE   UF  E           K        DISK         KCOMIT       A
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FSEPRICPDUF  E           K        DISK         KCOMIT       A        CAC005
     F                                              KINFSR INFSR          CAC005
     FPRICEX  IF  E           K        DISK
     F            PRICEDF                           KRENAMEPRICEDFX
     FPRICEA  UF  E                    DISK         KCOMIT
     FBKPHD   IF  E           K        DISK
     FCPOSN   IF  E           K        DISK
     FSECTY   IF  E           K        DISK
     F*BOOKD***IF  E           K        DISK                        S01158S01117
     F*SNAME***IF  E           K        DISK                              S01117
     FEXVALD  UF  E           K        DISK         KCOMIT            U3  S01169
     F                                              KINFDS EXVLDS         S01169
     F                                              KINFSR EXVLSR         S01169
     FEXVALDX IF  E           K        DISK                           U3  S01169
     F            EXVALDF                           KRENAMEEXVALDFX       S01169
     F*TABSE***IF  E           K        DISK                              S01117
     F**********  TABLETAF                          KIGNORE               S01117
     F**ICD*1*****TABTB10F                          KIGNORE               S01117
     F**********  TABTB10F                          KIGNORE               S01117
     F**********  TABTB11F                          KIGNORE               S01117
     F* ICD SE    TABTB36F                          KIGNORE               S01169
     F**********  TABTB40F                          KIGNORE               S01117
     F**********  TABTE10F                          KIGNORE               S01117
     F**********  TABTE20F                          KIGNORE               S01117
     F* CCY 1     TABTG10F                          KIGNORE
     F**********  TABTG20F                          KIGNORE               S01117
     F**********  TABLETHF                          KIGNORE               S01117
     F**********  TABLETKF                          KIGNORE               S01117
     F*********** TABLETJF                          KIGNORE               S01117
     F**********  TABLETLF                          KIGNORE               S01117
     F**********  TABLETNF                          KIGNORE               S01117
     F**********  TABLETPF                          KIGNORE               S01117
     F**********  TABLETRF                          KIGNORE               S01117
     F**********  TABLETXF                          KIGNORE               S01117
     F**********  TABLET2F                          KIGNORE               S01117
     F**********  TABLET3F                          KIGNORE               S01117
     F**********  TABLET5F                          KIGNORE               S01117
     FPMHSEXPDIF  E           K        DISK                           U4  S01486
     FPMPORTPDIF  E           K        DISK                           U4  S01486
     FPMAPOSLLIF  E           K        DISK                           U4  S01486
     F/COPY WNCPYSRC,SE0080F001
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01  - S/SUBFLCTL  SFLDSP                                    *
     F*   02  - S/SUBFLCTL  SFLDSPCTL                                 *
     F*   03  - S/SUBFLCTL  SFLEND                                    *
     F*   04  - S/SUBFLCTL  ROLLDOWN not allowed                      *
     F*   05  - S/KEYINPUT  Protect/Non-Display on location           *
     F*   06  - S/RECDETLS  Protect fields                            *
     F*                                                               *
     F*   10  - Start  Screen                                         *
     F*   11  - Review Screen                                         *
     F*   12  - Update Screen                                         *
     F*                                                               *
     F*   15  - Used on Write/Update to condition call of INFSR       *
     F*   20  - VLDCMDKY Indicator for Display File                   *   S01179
     F*                                                               *
     F*   21  - S/KEYINPUT  ERROR-ACTN                                *
     F*   22  - S/KEYINPUT  ERROR-PSSN                                *
     F*   23  - S/KEYINPUT  ERROR-PCNM                                *
     F*   24  - S/KEYINPUT  ERROR-PMKT                                *
     F****25**-*S/KEYINPUT**ERROR-PBRC************************        *   S01117
     F*   25  - S/KEYINPUT  ERROR-PBRA                                *   S01117
     F*   26  - S/KEYINPUT  ERROR-PBOK                                *
     F*   27  - S/KEYINPUT  ERROR-PPRT                                *
      *   29 - S/Keyinput Error - PFCT                                *   CAC005
     F*                                                               *
     F*   30  - S/RECDETLS  POSITION CURSOR                           *
     F*   31  - S/RECDETLS  ERROR-PPRC                                *
     F*   32  - S/RECDETLS  ERROR-PVDT                                *
     F*                                                               *
     F*   33  - GENERAL WORK INDICATOR                                *
     F*                                                               *
      *   40 - Display Profit Centre Field if CAC005 is on            *   CAC005
     F*   60  - ADD RECORD                                            *
     F*                                                               *
     F*   65  - ROLLUP                                                *   S01179
     F*   66  - ROLLDOWN                                              *   S01179
     F*   67  - HELP                                                  *   S01179
     F*                                                               *   S01179
     F*   70  - RECORD NOT FOUND ON PF/EXVALD.                        *   S01169
     F*   71  - EXTEL Option Indicator
     F*   72  - DO NOT DISPLAY DETAILS FROM PF/EXVALD.                *   S01169
     F*   73  - ERROR ON SCREEN ENTRY FOR AUTO PRICE INDICATOR        *   S01169
     F*   74  - ERROR ON SCREEN ENTRY FOR LOWER PRICE BNDY            *   S01169
     F*   75  - ERROR ON SCREEN ENTRY FOR UPPER PRICE BNDY            *   S01169
     F*   76  - ERROR ON SCREEN ENTRY FOR PERCENTAGE ALLOWABLE        *   S01169
     F*                                                               *
     F*   80  - EXTEL Price Validation Details is already purged      *   101019
     F*         and Action is Enquiry.                                *   101019
     F*                                                               *   101019
     F*   88  - MBIN = Y                                              *   S01117
     F*   97  - WORK                                                  *
     F*   98  - DATF = MMDDYY                                         *
     F*   99  - WORK                                                  *
     F*                                                               *
     F*   U3  - EXTEL OPTION INSTALLED                                *   S01169
     F*   U4  - Portfolio Management present                          *   S01486
     F*         Or Private Banking module present                     *   CPB001
     F*   U7  - Database Error                                        *
     F*   U8  - Program Error                                         *
     F*                                                               *
     F*   'AID' Values used                                           *
     F*                                                               *
     F*   01  - CA3                                                   *
     F*   04  - CA10                                                  *
     F*   05  - CA12                                                  *
     F*   RA  - ENTER Pressed                                         *
     F*   UP  - ROLLUP                                                *
     F*   DN  - ROLLDOWN                                              *
     F*   HP  - HELP Pressed                                          *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - First time only processing                          *
     F*  START  - Process Initial (Key input) screen                  *
     F*  REVIEW - Process Subfile display of all prices               *
     F*  UPDATE - Process detail screen                               *
     F*  VALIDK - Validate entries made on key input screen           *
     F*  VALIDD - Validate entries made on detail screen              *
     F*  INITRC - Initialise/clear detail fields before input         *
     F*  TRSFS  - Translate record details from file to screen format *
     F*  UPDFLS - Update database files                               *
     F*  UPDOWS - Perform 'Record updated by another workstation'     *
     F*           process                                             *
     F*  EXDET  - Transfer details from PF/EXVALD to screen format.   *   S01169
     F*  EXUPD  - Update PF/EXVALD.                                   *   S01169
     F*  EXVLSR - Exception error handling for PF/EXVALD.             *   S01169
     F*  *PSSR  - PROGRAM EXCEPTION/ERROR SUBROUTINE.                 *   S01169
     F*  INFSR  - File exception/error processing                     *
     F*                                                               *
     F*  ZALIGN - Validate and right-align numeric fields             *
     F*  ZDATE1 - DATE - DAYNO conversion                             *
     F*  ZDATE2 - DAYNO - DATE conversion                             *
     F*  ZEDIT  - Insert a decimal point into a numeric field and blan*
     F*  ZTNLU1 - Fetch next available transaction number             *
     F*  ERROR  - ERROR HANDLING SUBROUTINE                           *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    DET       256  1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZPOWER8Z1                                              E14837
     E                    ERR        19  4
     E**********          INF     1  13 76                                E16079
     E********************INF     1  11 76                         E16079 101019
     E                    INF     1  12 76                                101019
     E                    POWER   1   7  7 3             POWER ARRAY      S01486
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
      /EJECT
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     ISCRCTL      DS
     I*
     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I*
     I                                        1   1 REVW
     I                                        2   2 ACTN
     I*************************************   3 030 INPK                  S01486
     I***********                             3 034 INPK           S01486 CAC005
     I                                        3 038 INPK                  CAC005
     I                                        3 012 SPSSN
     I                                      013 022 SPCNM
     I                                      023 023 SPMKT
     I                                      024 026 SPBRC
     I                                      027 028 SPBOK
     I                                      029 032 SPFCT                 CAC005
     I                                      033 034 SPPRT                 CAC005
     I                                      035 038 SPTFR                 CAC005
     I***********                           029 030 SPPRT                 CAC005
     I***********                           031 034 SPTFR          S01486 CAC005
     I************************************* 031 058 PAGK                  S01486
     I************************************* 031 040 PPSSN                 S01486
     I************************************* 041 050 PPCNM                 S01486
     I************************************* 051 051 PPMKT                 S01486
     I************************************* 052 054 PPBRC                 S01486
     I************************************* 055 056 PPBOK                 S01486
     I************************************* 057 058 PPPRT                 S01486
     I***********                           035 066 PAGK           S01486 CAC005
     I***********                           035 044 PPSSN          S01486 CAC005
     I***********                           045 054 PPCNM          S01486 CAC005
     I***********                           055 055 PPMKT          S01486 CAC005
     I***********                           056 058 PPBRC          S01486 CAC005
     I***********                           059 060 PPBOK          S01486 CAC005
     I***********                           061 062 PPPRT          S01486 CAC005
     I***********                           063 066 PPTFR          S01486 CAC005
     I                                      039 074 PAGK                  CAC005
     I                                      039 048 PPSSN                 CAC005
     I                                      049 058 PPCNM                 CAC005
     I                                      059 059 PPMKT                 CAC005
     I                                      060 062 PPBRC                 CAC005
     I                                      063 064 PPBOK                 CAC005
     I                                      065 068 PPFCT                 CAC005
     I                                      069 070 PPPRT                 CAC005
     I                                      071 074 PPTFR                 CAC005
     I*
     IDETREC    E DSPRICED
     I*
     I** DATA STRUCTURE FOR INITIALISING A RECORD
     I*
     I              PSSN                            PSSNX
     I              PCNM                            PCNMX
     I              PMKT                            PMKTX
     I***********   PBRC                            PBRCX                 S01117
     I              PBRA                            PBRAX                 S01117
     I              PBOK                            PBOKX
     I              PPRT                            PPRTX
     I              PTFR                            PTFRX                 S01486
     I*
     I***DETS***E DSSE0080DF                                              S01179
     IDETS        DS                                                      S01179
     I                                        1  16 SPPRC                 S01179
     I                                       17  51 SPNTV                 S01179
     I                                       52  57 SPVDT                 S01179
     I*************************************  58  58 APIND          S01179 S01486
     I*************************************  59  74 LPRICE         S01179 S01486
     I*************************************  75  90 UPRICE         S01179 S01486
     I*************************************  91 100 PCENT          S01179 S01486
     I                                       58  71 SNPXR                 S01486
     I                                       72  72 SNPMD                 S01486
     I                                       73  73 APIND                 S01486
     I                                       74  89 LPRICE                S01486
     I                                       90 105 UPRICE                S01486
     I                                      106 115 PCENT                 S01486
     I*
     I*
     I** DATA STRUCTURE FOR SCREEN DETAIL OUTPUT TO CMTTXT
     I*
     ISCRMSG      DS                          1 152
     I*
     I** DATA STRUCTURE FOR ERROR MESSAGES TO SCREEN
     I*
     I                                        1  76 ERR
     I                                        1  76 ERRMSG
     I                                       77 152 INFMSG
     I*
     ISCRDS       DS
     I*
     I** DISPLAY FORMAT STATUS DATA STRUCTURE
     I*
     I                                      287 288 AID
     IINFDS       DS
     I*
     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     I                                     *STATUS  STATUS
      *                                                                   S01169
     IEXVLDS      DS                            366                       S01169
      *                                                                   S01169
      ** File information data structure for PF/EXVALD.                   S01169
      *                                                                   S01169
      *                                                                   S01169
     IEPFDS       DS                                                      S01169
      *                                                                   S01169
      ** File information data structure used by error processing.        S01169
      *                                                                   S01169
     I                                        1 256 EPFDS1                S01169
     I                                      257 366 EPFDS2                S01169
      *                                                                   S01169
     I*
     I*DA********UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I*
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     ICMTTXT      DS
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 306 DET
     I*
     IPSDS       SDS
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     I                                        1  10 EPPP                  S01169
     I                                       81  90 EPPPL                 S01169
     I                                        1 253 EPPDS1                S01169
     I                                      254 429 EPPDS2                S01169
     I                                      244 246 WSID
     I                                      254 263 USID
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I**                                                                  S01117
     IZMUSER      DS                             17                       S01117
      ** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
     I/COPY WNCPYSRC,SE0080I001
     I**                                                                  S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
     I** Book Details                                                     S01117
     I**                                                                  S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I** Branch Details                                                   S01117
     I**                                                                  S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I              QQDFAC                          #DFAC1                                    CGL029
     I** Customer Details                                                 S01117
     I**                                                                  S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I** Currency Details                                                 S01117
     I**                                                                  S01117
     ISDGELR    E DSSDGELRPD                                              176905
     I** General ledger details                                           176905
     I**                                                                  176905
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I** Security Trading Detail                                          S01117
     I**                                                                  S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     I**                                                                  S01117
     IDSSDY     E DSDSSDY                                                 S01117
     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01117
     I**                                                                  S01117
     ISDPORT    E DSSDPORTPD                                              S01486
      *  PORTFOLIO MANAGEMENT ICD                                         S01486
      **                                                                  S01486
     ISDMOD     E DSSDMMODPD                                              S01486
      *   EXTERNAL DS FOR WHICH MODULES INSTALLED                         S01486
      **                                                                  S01486
     ISDBANK    E DSSDBANKPD                                              S01486
      *  BANK     DETAILS                                                 S01486
      **                                                                  S01486
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *                                                                   S01486
      *** Copyright Statement                                             S01486
     C                     MOVEACPY@      ACT@   80                       S01486
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO PRICE FILE
     C*
     C           PRICEK    KLIST
     C                     KFLD           PSSN
     C                     KFLD           PCNM
     C                     KFLD           PMKT
     C***********          KFLD           PBRC                            S01117
     C                     KFLD           PBRA                            S01117
     C                     KFLD           PBOK
     C                     KFLD           PPRT
     C                     KFLD           PTFR                            S01486
     C*
     C**  DEFINE KEY LIST FOR BOOK POSITION HEADER FILE
     C*
     C           BKPHDK    KLIST
     C                     KFLD           SPSSN
     C***********          KFLD           PBRC                            S01117
     C                     KFLD           PBRA                            S01117
     C***********          KFLD           SPBOK                           CAC005
     C                     KFLD           KPBOK   2                       CAC005
     C                     KFLD           SPMKT
     C                     KFLD           BASIS   1
     C*
     C**  DEFINE KEY LIST FOR CUSTOMER POSITION FILE
     C*
     C           CPOSNK    KLIST
     C***********          KFLD           PBRC                            S01117
     C                     KFLD           PBRA                            S01117
     C                     KFLD           SPSSN
     C                     KFLD           PCNM
     C*                                                                   S01486
     C**  DEFINE KEY LIST FOR CHAINING TO PMPORTPD                        S01486
     C*                                                                   S01486
     C           PORKEY    KLIST                                          S01486
     C                     KFLD           PCNM                            S01486
     C                     KFLD           SPTFR                           S01486
     C*                                                                   S01486
     C**  DEFINE KEY LIST FOR CHAINING TO PMAPOSLL                        S01486
     C*                                                                   S01486
     C           POSKEY    KLIST                                          S01486
     C                     KFLD           PCNM                            S01486
     C                     KFLD           WPTFR                           S01486
     C                     KFLD           SPSSN                           S01486
     C                     KFLD           WTVDA   1                       S01486
     C                     KFLD           PVDT                            S01486
      *                                                                   CAC005
     C           KEY1      KLIST                                          CAC005
     C                     KFLD           PSSN                            CAC005
     C                     KFLD           PCNM                            CAC005
     C                     KFLD           PMKT                            CAC005
     C                     KFLD           PBRA                            CAC005
     C                     KFLD           PBCD                            CAC005
     C                     KFLD           PRFC    4                       CAC005
     C                     KFLD           PPRT                            CAC005
     C                     KFLD           PTFR                            CAC005
     C*
     C           *LIKE     DEFN PPRC      HPPRC
     C           *LIKE     DEFN RRN       SAVRRN                          E13580
     C*
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR INIT
      *
      ***  DO UNTIL CF/3 or Error
      *
     C                     Z-ADD1         RRN     40                      E13580
     C           AID       DOUEQ'01'
     C           *INU7     OREQ '1'
     C*
     C           *IN10     CASEQ'1'       START
     C           *IN11     CASEQ'1'       REVIEW
     C           *IN12     CASEQ'1'       UPDATE
     C*
     C                     END
     C                     END
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C/COPY WNCPYSRC,SE0080C014
     C                     SETON                         LR
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  INIT   - Subroutine to Initialise static fields and access   *
      *           Standing Data.                                      *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR                           ***  INIT  ***
      *                                                                   S01486
     C           HSEXKY    KLIST                                          S01486
     C                     KFLD           HSEXCY  3                       S01486
     C                     KFLD           PVDT                            S01486
     C*
     C** PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE0080'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C** PREPARE COMIT TEXT
     C*
     C                     MOVEL'SE'      MDID
     C                     MOVEL'SE0080'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*
     C***HELP*PROGRAM*PARAMETER****************************************   S01199
     C***********                                                         S01199
     C***********          MOVEL'SE0080'  HBPGM   8        *FOR CALL MHELPS01199
     C                     MOVEL*BLANK    WBLNK   1
     C*
     C** FOR HIGH INTENSITY SCREEN ATTRIBUTE
     C*
     C                     BITOF'01234567'HI      1
     C                     BITON'267'     HI
     C                     MOVELHI        INF,7
     C                     MOVELHI        INF,8
     C                     MOVELHI        INF,9
     C                     MOVELHI        INF,10
     C                     MOVELHI        INF,11
     C*
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1***************************S01117
     C***********                                                         S01117
     C***********          READ TABTB10F                 99*              S01117
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01117
     C************IN99     IFEQ '0'                                       S01117
     C**                                                                  S01117
     C** IN THE DATAAREA ZMUSER                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C*                                                                   S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C/COPY WNCPYSRC,SE0080C015
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     88                   S01117
     C                     END                                            S01117
     C* Seton 88 to have branch displayed in SE0080DF in all cases        164740
     C                     SETON                     88                   164740
     C*
     C** IF FOUND CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
     C*
     C           DATF      COMP 'M'                      98
     C*
     C***********          ELSE                                           S01117
     C***********                                                         S01117
     C***OTHERWISE*DB*ERROR***********************************************S01117
     C***********                                                         S01117
     C***********          SETON                     U7U8  ***************S01117
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVEL'01'      ZTABKY 12                       S01117
     C***********          MOVE '10'      ZTABKY                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          END                             *IN99=0        S01117
      **********                                                          S01117
     C***GET*INSTALLATION CONTROL DATA RECORD FOR SECURITIES TRADINGS01169S01117
     C**********                                                    S01169S01117
     C**********           MOVEL'01      'ZTABKY 12                 S01169S01117
     C**********           MOVE '  36'    ZTABKY                    S01169S01117
     C**********                                                    S01169S01117
     C********** ZTABKY    CHAINTABTB36F             99             S01169S01117
      **ERROR*IF NO RECORD FOUND OR IF IT IS DELETED                S01169S01117
     C********** *IN99     IFEQ '1'                                 S01169S01117
     C********** RECI      ORNE 'D'                                 S01169S01117
     C***********          MOVE '04'      DBASE            ***************E20651
     C***********          MOVEL'TABSE'   DBFILE           **DB*ERROR*04**E20651
     C********** *LOCK     IN   LDA                                       S01117
     C***********          MOVE '05'      DBASE            *********E20651S01117
     C**********           Z-ADD5         DBASE            ***************S01117
     C**********           MOVEL'TABSE'   DBFILE     * DB ERROR 05 *E20651S01117
     C**********           MOVELZTABKY    DBKEY            *********S01169S01117
     C**********           OUT  LDA                                       S01117
     C**********           SETON                     U7U8           S01169S01117
     C**********           EXSR ERROR                                     S01117
     C**********           END                                      S01169S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*                                                                   S01169
     C** IF THE EXTEL OPTION INDICATOR PRESENT SETON INDICATOR            S01169
     C*                                                                   S01169
     C********** EXMO      IFEQ 'Y'                                 S01169S01117
     C           BVEXOP    IFEQ 'Y'                                       S01117
     C                     SETON                     71                   S01169
     C                     ELSE                                           S01169
     C                     SETOF                     71                   S01169
     C                     END                                            S01169
      *                                                                   101019
     C                     SETOF                     80                   101019
      *                                                                   CPB001
      ***  Access Retail details if retail module is ON                   CPB001
      *                                                                   CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM '*DBERR ' @RTCD                           CPB001
     C                     PARM '*FIRST ' @OPTN                           CPB001
     C           SDMOD     PARM SDMOD     DSFDY                           CPB001
      *                                                                   S01486
     C** PORTFOLIO MANAGEMENT MODULE                                      S01486
     C*                                                                   S01486
     C           *INU4     IFEQ '0'                                       S01486
     C                     MOVE '1'       *IN13                           S01486
     C*                                                                   S01486
     C**  Access PM I.C.D.                                                S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST ' P@OPTN  7                       S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD8         DBASE            ***************S01486
     C                     MOVEL'SDPORTL0'DBFILE           * DB ERROR 08 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     SETON                     U7U8                 S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR ERROR                                     S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   P@RTCD  7                       S01486
     C                     PARM '*FIRST ' P@OPTN  7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C*                                                                   S01486
     C           P@RTCD    IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD8         DBASE            ***************S01486
     C                     MOVEL'SDBANKL0'DBFILE           * DB ERROR 08 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     SETON                     U7U8                 S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR ERROR                                     S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
      *                                                                   S01486
     C                     END                                            S01486
     C/COPY WNCPYSRC,SE0080C003
     C*
     C**********           CALL 'AOGELRR0'                                176905              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       176905
     C                     PARM '*FIRST ' @OPTN   7                       176905
     C********** SDGELR    PARM SDGELR    DSFDY                           176905              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   176905
     C** PROCEED TO START SCREEN UNLESS DATABASE ERRPR
     C*
     C           *INU7     IFNE '1'
     C                     MOVEA'1'       *IN,10
     C                     END
      *                                                                   CAC005
      ***  Check if CAC005 is on                                          CAC005
      *                                                                   CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*VERIFY' POPTN   7                       CAC005
     C                     PARM 'CAC005'  PSARD   6                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE 'Y'       CAC005  1                       CAC005
     C                     MOVE *ON       *IN40                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVE 'N'       CAC005                          CAC005
     C                     MOVE *OFF      *IN40                           CAC005
     C                     ENDIF                                          CAC005
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  START  - Subroutine to Output and process Key Fields Screen. *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls:     VALIDK - To Validate Key fields, if entered.      *
      *                                                               *
      *****************************************************************
      *
     C           START     BEGSR                           *** START  ***
     C*
     C** INITIALISE SCREEN DATA
     C*
     C                     MOVEA'0'       *IN,10
     C           *IN80     IFEQ '0'                                       101019
     C                     MOVEA'0000'    *IN,21
     C                     MOVEL*BLANK    SCRCTL
     C                     MOVELINF,1     INFMSG
     C*
     C** CLEAR WHOLE SCREEN
     C*
     C                     WRITECLSCREEN
     C                     MOVE *BLANK    ACTN
     C                     MOVE *BLANKS   SPSSN
     C                     MOVE *BLANKS   SPCNM
     C                     MOVE *BLANK    SPMKT
     C                     MOVE *BLANKS   SPBRC
     C                     MOVE *BLANKS   SPBOK
     C                     MOVE *BLANKS   SPPRT
     C                     MOVE *BLANKS   SPFCT                           CAC005
     C/COPY WNCPYSRC,SE0080C001
     C                     MOVE *BLANKS   SPTFR                           S01486
     C                     MOVE *BLANKS   PPSSN
     C                     MOVE *BLANKS   PPCNM
     C                     MOVE *BLANK    PPMKT
     C                     MOVE *BLANKS   PPBRC
     C                     MOVE *BLANKS   PPBOK
     C                     MOVE *BLANKS   PPPRT
     C                     MOVE *BLANKS   PPTFR                           S01486
     C                     MOVE *BLANKS   PPFCT                           CAC005
     C                     END                                            101019
      *                                                                   101019
     C                     SETOF                     80                   101019
      *
      ***  Do Until Change of Screen
      *
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Start Screen Output
      *
     C                     MOVELINF,1     INFMSG                          E14277
     C                     WRITEMESSAGES
     C                     EXFMTKEYINPUT
     C                     MOVELERRMSG    HERCD 160
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
      *
      ***  Check for CF/3 or ENTER pressed
      *
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP*-*CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                             *ERR,1         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** ENTER TAKEN VALIDATE KEY INPUT
     C*
     C                     ELSE
     C           AID       IFNE '05'
     C                     EXSR CHKSEL                                    S01117
     C           @SEL      IFEQ 'N'                                       S01117
     C                     EXSR VALIDK
     C*
     C** IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           SCRMSG    IFEQ *BLANK
     C*
     C**  - IF KEY FIELD IS BLANK, NEXT SCREEN IS REVIEW SCREEN
     C*
     C           PSSN      IFEQ *BLANK
     C                     MOVEA'1'       *IN,11
     C*
     C**  - OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C***********          ELSE
     C***********          MOVELINF,1     INFMSG
     C                     END                                            S01117
     C                     END
     C*                                                                   E14277
      ***  Else, AID = '05'                                               E14277
     C                     ELSE                                           E14277
     C*                                                                   E14277
     C                     MOVEA'0000000' *IN,21                          E14277
     C***********          MOVE '0'       *IN28                    S01486 CAC005
     C                     MOVEA'00'      *IN,28                          CAC005
     C                     MOVE *BLANK    ACTN                            E14277
     C                     MOVE *BLANKS   SPSSN                           E14277
     C                     MOVE *BLANKS   SPCNM                           E14277
     C                     MOVE *BLANK    SPMKT                           E14277
     C                     MOVE *BLANKS   SPBRC                           E14277
     C                     MOVE *BLANKS   SPBOK                           E14277
     C                     MOVE *BLANKS   SPPRT                           E14277
     C                     MOVE *BLANKS   SPFCT                           CAC005
     C/COPY WNCPYSRC,SE0080C002
     C                     MOVE *BLANKS   SPTFR                           S01486
     C                     MOVE *BLANKS   PPSSN                           E14277
     C                     MOVE *BLANKS   PPCNM                           E14277
     C                     MOVE *BLANK    PPMKT                           E14277
     C                     MOVE *BLANKS   PPBRC                           E14277
     C                     MOVE *BLANKS   PPBOK                           E14277
     C                     MOVE *BLANKS   PPPRT                           E14277
     C                     MOVE *BLANKS   PPTFR                           S01486
     C                     MOVE *BLANKS   PPFCT                           CAC005
     C*                                                                   E14277
     C                     END
     C*
     C***********          END                                            S01199
      ***  End of If/Else AID = '01'
     C                     END
     C*
      ***  End of Do Until Change of Screen
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  REVIEW - Subroutine to process Subfile Selection Screen.     *
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls:     VALIDK - To Validate Key fields, if Subfile       *
      *                      record selected.                         *
      *                                                               *
      *****************************************************************
      *
     C           REVIEW    BEGSR                           *** REVIEW ***
     C*
     C                     MOVEA'0'       *IN,11
     C*
     C** SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C                     MOVEL'RA'      AID
      *
      ***  Do Until Change of Screen
      *
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Check for ROLLUP, ROLLDOWN or ENTER pressed
      *
      ***  Rebuild subfile, if required, unless Error found.
      *
     C           SCRMSG    IFEQ *BLANKS
     C*
     C           AID       IFEQ 'DN'
     C           AID       OREQ 'UP'
     C           AID       OREQ 'RA'
     C*
     C** WRITE CONTROL RECORD
     C*
     C***********          MOVEA'000'     *IN,1                           E13580
     C                     MOVEA'00'      *IN,1                           E13580
     C***********15        SUB  RRN       SAVRRN                          E13580
     C           17        SUB  RRN       SAVRRN                          E13580
     C                     Z-ADD*ZERO     RRN
     C                     WRITESUBFLCTL
     C                     MOVEA'1'       *IN,4
     C*
     C** SET FILE POINTER - PAGE BACK
     C*
     C           AID       IFEQ 'DN'
     C***********          MOVEL*BLANK    PSSN                            E13580
     C***********          MOVEL*BLANK    PCNM                            E13580
     C***********          MOVEL*BLANK    PMKT                            E13580
     C***********          MOVEL*BLANK    PBRC                            E13580
     C***********          MOVEL*BLANK    PBOK                            E13580
     C***********          MOVEL*BLANK    PPRT                            E13580
     C***********          MOVEL*BLANK    PPAGK 021                       E13580
     C           CAC005    IFEQ 'Y'                                       CAC005
     C   03      *HIVAL    SETGTSEPRICD0                                  CAC005
     C                     ELSE                                           CAC005
     C   03      *HIVAL    SETGTPRICEDFX                                  E13580
     C                     ENDIF                                          CAC005
     C                     DO   33                                        E13580
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     READPSEPRICD0                 33               CAC005
     C                     ELSE                                           CAC005
     C                     READPPRICEDFX                 33               E13580
     C                     ENDIF                                          CAC005
     C                     END                                            E13580
     C           *IN03     IFEQ '1'                                       E13580
     C                     DO   SAVRRN                                    E13580
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     READ SEPRICD0                 33               CAC005
     C                     ELSE                                           CAC005
     C                     READ PRICEDFX                 33               E13580
     C                     ENDIF                                          CAC005
     C                     END                                            E13580
     C                     SETOF                     03                   E13580
     C                     END                                            E13580
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           KEY1      SETLLSEPRICD0                                  CAC005
     C                     ELSE                                           CAC005
     C           PRICEK    SETLLPRICEDFX
     C                     ENDIF                                          CAC005
     C*
     C** OTHERWISE        - PAGE FORWARD
     C*
     C                     ELSE
     C                     MOVELPPSSN     PSSN
     C*
     C* If Client shortname entered, fetch number
     C*
     C********** PPCNM     CHAINCLINTCBF             33                   S01117
     C                     MOVELPPCNM     @KEYC  10                       S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C**********           Z-ADDCNUM      PCNM                            S01117
     C**********           MOVELBBCUST    PPCNM                     S01117076512
     C                     MOVELBBCUST    PPCNM     P                     076512
     C                     MOVELBBCUST    PCNM                            S01117
     C                     ELSE
     C                     MOVELPPCNM     PCNM
     C                     END
     C                     MOVELPPMKT     PMKT
     C***********          MOVELPPBRC     PBRC                            S01117
     C                     MOVELPPBRC     PBRA                            S01117
     C                     MOVELPPBOK     PBOK
     C                     MOVELPPBOK     PBCD                            CAC005
     C                     MOVELPPFCT     PRFC                            CAC005
     C                     MOVELPPPRT     PPRT
     C                     MOVELPPTFR     PTFR                            S01486
     C***********          MOVELPAGK      PPAGK                           E13580
     C                     MOVELPAGK      PPAGK  21                       E13580
      *
      ***  ROLLUP
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           KEY1      SETLLSEPRICD0                                  CAC005
     C                     ELSE                                           CAC005
     C           PRICEK    SETLLPRICEDFX
     C                     ENDIF                                          CAC005
     C                     END
     C*
     C** READ IN DETAILS-FILL UP SUBFILE
     C*
     C           RRN       DOUEQ17
     C           *IN,03    OREQ '1'
     C*
     C** READ DETAILS UNTIL SUBFILE PAGE IS FULL
     C*
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     READ SEPRICD0                 03               CAC005
     C                     ELSE                                           CAC005
     C                     READ PRICEDFX                 03
     C                     ENDIF                                          CAC005
     C           *IN,03    IFEQ '0'
     C*                                                                   S01117
     C** CHECK USER HAS AUTHORITY TO BRANCH IF MULTIBRANCHING             S01117
     C** AND PRICE TYPE IS NOT 'V'                                        S01117
     C*                                                                   S01117
     C************IN88     IFEQ '1'                                S01117 164740
     C           MBIN      IFEQ 'Y'                                       164740
     C           PPRT      ANDNE'V'                                       S01117
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM PBRA      ZBRCDX  3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     GOTO BYPASS                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C***IF*RECORD*IS*DELETED,*FLAG*IT*AS*SO*ON*SCREEN*****************   051284
      ***  If record has been Actioned, flag it on the screen.            051284
     C*
     C           RECI      IFEQ '*'
     C***********          MOVEL'D'       STAT    1                       051284
     C                     MOVEL'*'       STAT    1                       051284
     C                     ELSE
     C                     MOVEL*BLANK    STAT
     C                     END
     C*
     C                     MOVELPSSN      SPSSN
     C********** PCNM      IFNE *ZEROS                                                        CSD027
     C           PCNM      IFNE *BLANKS                                                       CSD027
     C                     MOVELPCNM      SPCNM
     C                     ELSE
     C                     MOVE *BLANKS   SPCNM
     C                     END
      *
     C                     MOVELPMKT      SPMKT
     C***********PBRC      IFNE *ZEROS                                    S01117
     C           PBRA      IFNE *BLANKS                                   S01117
     C**********           MOVELPBRC      SPBRC                           S01117
     C                     MOVELPBRA      SPBRC                           S01117
     C                     ELSE
     C                     MOVE *BLANKS   SPBRC
     C                     END
      *
     C                     MOVELPBOK      SPBOK
     C                     MOVELPPRT      SPPRT
     C           PTFR      IFEQ '9997'                                    154861
     C                     MOVE FCR997    SPTFR                           154861
     C                     ELSE                                           154861
     C                     MOVELPTFR      SPTFR                           S01486
     C                     ENDIF                                          154861
     C                     MOVELPRFC      SPFCT                           CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELPBCD      SPBOK                           CAC005
     C                     ENDIF                                          CAC005
     C                     ADD  1         RRN     40     04
     C*
     C                     WRITESUBFLREC
     C           BYPASS    TAG                                            S01117
     C*
     C** RECORD NOW WRITTEN TO SUBFILE
     C*
     C                     END
     C*
     C** PAGE NOW FULL (OR EOF)
     C*
      ***  End of Do Until Subfile full
     C                     END
     C*
     C** READ ONE MORE RECORD FOR NEXT SCREEN
     C*
     C           *IN,03    IFEQ '0'
     C           CAC005    IFEQ 'Y'                                      CAC005
     C                     READ SEPRICD0                 03              CAC005
     C                     ELSE                                          CAC005
     C                     READ PRICEDFX                 03
     C                     ENDIF                                         CAC005
     C                     END
     C*
     C** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C           *IN,03    IFEQ '0'
     C                     MOVELINPK      PAGK
     C                     ELSE
     C                     MOVEL*BLANK    PAGK
     C                     END
     C*
     C** FOR SUBFILE CONTROL
     C*
     C           *IN,4     IFEQ '1'
     C                     MOVEA'010'     *IN,1
     C                     ELSE
     C                     MOVEA'11'      *IN,1
     C                     END
      *
      ***  End of Do Until ROLLUP, ROLLDOWN, ENTER pressed
     C                     END
     C*
      ***  End of Do Until Change of Screen
     C                     END
      *
      ***  Review Screen Output
      *
     C***********          Z-ADD1         RRN                             E13580
     C                     MOVELINF,2     INFMSG
     C                     WRITEMESSAGES
     C                     EXFMTSUBFLCTL
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C                     MOVEL*BLANK    REVW
     C                     MOVEA'0000000' *IN,21
     C***********          MOVE '0'       *IN28                    S01486 CAC005
     C                     MOVEA'00'      *IN,28                          CAC005
     C                     Z-ADD*ZERO     EC      40
     C                     MOVE *BLANKS   ERRMSG
      *
      ***  Check for CF/3, CF/12 or Record Select
      *
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,11
     C*
     C** CK12- INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP*-*CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                             *ERR,1         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,99
     C           *IN,04    IFEQ '0'
     C                     READCSUBFLREC                 99
     C                     END
      *
      ***  Validate Record Selection
      *
     C           *IN99     IFEQ '0'
     C                     EXSR CHKSEL                                    S01117
     C           @SEL      IFEQ 'N'                                       S01117
     C                     EXSR VALIDK
     C*
     C** NO ERRORS, UPDATE SCREEN CAN BE PROCESSED NEXT
     C*
     C           SCRMSG    IFEQ *BLANK
     C                     MOVEA'1'       *IN,12
     C                     MOVEL'Y'       REVW
     C                     END
     C                     END                                            S01117
     C                     UPDATSUBFLREC
     C                     END
     C*
     C***********          END                                            S01199
      *
      ***  End of AID = 05, 01
     C                     END
     C                     END
      *
      ***  End of Do Until Change of Screen
      *
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDATE - Subroutine to process Detail Screen and Update File.*
      *                                                               *
      *  Called By: Main Processing.                                  *
      *  Calls:     VALIDK                                            *
      *             UPDFLS                                            *
      *             INITRC                                            *
      *             TRSFS                                             *
      *                                                               *
      *****************************************************************
      *
     C           UPDATE    BEGSR                           *** UPDATE ***
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     MOVEA'1'       *IN,5
     C                     MOVEA'0'       *IN,12
     C                     MOVEA'100'     *IN,30
     C                     MOVEA'0000'    *IN,73                          S01169
     C*
     C** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
     C** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
     C*
     C                     Z-ADD*ZERO     STNLU   50
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           KEY1      CHAINSEPRICD0             99                   CAC005
     C                     ELSE                                           CAC005
     C           PRICEK    CHAINPRICEDFX             99
     C                     ENDIF                                          CAC005
     C           *IN,99    IFEQ '0'
     C                     Z-ADDTNLU      STNLU
     C                     END
     C*
     C** IF INSERT (NEW OR OVER DELETED RECORD)
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C           ACTN      IFEQ 'I'
     C                     EXSR INITRC
     C                     MOVE *BLANKS   SPPRC
     C                     MOVE *BLANKS   DELT
     C                     MOVE *BLANKS   SPNTV
     C                     MOVE *BLANKS   SPVDT
     C                     MOVE *BLANKS   SNPXR                           S01486
     C                     MOVE *BLANKS   SNPMD                           S01486
     C                     END
     C*
     C***IF*DELETED*RECORD-ENQUIRY*ONLY*(RECI*IS*SET*TO*BLANK*FOR*INSERTS)051284
      ***  Actioned record may have a new Insert or else Action must be   051284
      ***  Enquiry. If so, flag record on the screen.                     051284
     C*
     C           ACTN      IFNE 'I'
     C           RECI      ANDEQ'*'
     C                     MOVEL'E'       ACTN
     C***********          MOVEL'DELETED' DELT    7                       051284
     C                     MOVE 'ACTIONED'DELT    8                       051284
     C                     ELSE
     C                     MOVEL*BLANK    DELT
     C                     END
      *                                                                   S01169
     C*                                                                   S01169
      ** For Current price, obtain details from PF/EXVALD.                S01169
      *                                                                   S01169
     C           PPRT      IFEQ 'V '                                      S01169
     C           *IN71     ANDEQ'1 '                                      S01169
     C                     SETOF                     72                   S01169
     C                     EXSR EXDET                                     S01169
     C           *IN80     IFEQ '1'                                       101019
     C                     GOTO ENDUPD                                    101019
     C                     END                                            101019
     C                     ELSE                                           S01169
     C                     SETON                     72                   S01169
     C                     END                                            S01169
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C           ACTN      IFNE 'I'
     C                     EXSR TRSFS
     C                     END
     C*
     C** IF DELETE/ENQUIRY PROTECT FIELD INPUT ON S/RECDETLS
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'E'
     C                     MOVEA'1'       *IN,6
     C                     MOVEA'0'       *IN,30
     C                     END
      *
      ***  Do Until Change of Screen
      *
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
      *
      ***  Load up Infomessages
      *
     C           INFMSG    IFEQ *BLANK
     C           ACTN      IFEQ 'I'
     C                     MOVELINF,3     INFMSG
     C                     MOVEA'1'       *IN,30
     C                     END
     C           ACTN      IFEQ 'A'
     C                     MOVELINF,4     INFMSG
     C                     END
     C           ACTN      IFEQ 'E'
     C                     MOVELINF,5     INFMSG
     C                     END
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,6     INFMSG
     C                     END
     C                     END
      *
      ***  Detail Screen Output
      *
     C                     WRITEKEYINPUT
     C                     WRITEMESSAGES
     C                     EXFMTRECDETLS
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
      *
      ***  Check for CF/3, CF/12, ROLLUP, ROLLDOWN
      *
     C** Call S/R to move values into AID                                 E17100
     C*                                                                   E17100
     C                     EXSR ASCHGS                                    E17100
     C*                                                                   E17100
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,12
     C*
     C** CK12- INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP*-*CALL*HELP*PROGRAM**************************************   S01199
     C***********                                                         S01199
     C***********          ELSE                                           S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                             *ERR,1         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*
     C** PAGE FORWARD TAKEN, READ NEXT RECORD
     C** Roll up is only allowed in Enquiry Mode.                         S01158
     C*
     C                     ELSE
     C           AID       IFEQ 'UP'
     C***********ACTN      ANDNE'I'                                       S01158
     C           ACTN      ANDEQ'E'                                       S01158
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     READ SEPRICD0                 12               CAC005
     C                     ELSE                                           CAC005
     C                     READ PRICEX                   12*
     C                     ENDIF                                          CAC005
     C*
     C** CHANGE MESSAGE IF END OF FILE REACHED - NO ROLL FWD
     C*
     C           *IN,12    IFEQ '1'
      *
      ***  No Roll Forward
     C                     MOVELINF,7     INFMSG
     C                     ELSE
     C                     MOVELPSSN      SPSSN
     C********** PCNM      IFNE *ZEROS                                                        CSD027
     C           PCNM      IFNE *BLANKS                                                       CSD027
     C                     MOVELPCNM      SPCNM
     C                     ELSE
     C                     MOVE *BLANKS   SPCNM
     C                     END
     C                     MOVELPMKT      SPMKT
     C***********PBRC      IFNE *ZEROS                                    S01117
     C           PBRA      IFNE *BLANKS                                   S01117
     C**********           MOVELPBRC      SPBRC                           S01117
     C                     MOVELPBRA      SPBRC                           S01117
     C                     ELSE
     C                     MOVE *BLANKS   SPBRC
     C                     END
     C                     MOVELPBOK      SPBOK
     C                     MOVELPPRT      SPPRT
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELPBCD      SPBOK                           CAC005
     C                     MOVELPRFC      SPFCT                           CAC005
     C                     ENDIF                                          CAC005
     C           PTFR      IFEQ '9997'                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    SPTFR                           S01486
     C                     ELSE                                           S01486
     C                     MOVELPTFR      SPTFR                           S01486
     C                     END                                            S01486
     C*
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C** PAGE BACK TAKEN, READ PREVIOUS RECORD
     c** Roll down is only allowed in Enquiry Mode.                       S01158
     C*
     C                     ELSE
     C           AID       IFEQ 'DN'
     C***********ACTN      ANDNE'I'                                       S01158
     C           ACTN      ANDEQ'E'                                       S01158
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     READPSEPRICD0                 12               CAC005
     C                     ELSE                                           CAC005
     C                     READPPRICEX                   12
     C                     ENDIF                                          CAC005
     C*
     C** CHANGE MESSAGE IF BEGINNING OF FILE REACHED - NO ROLL BACK
     C*
     C           *IN,12    IFEQ '1'
      *
      ***  No Roll Back
     C                     MOVELINF,8     INFMSG
     C                     ELSE
     C                     MOVELPSSN      SPSSN
     C********** PCNM      IFNE *ZEROS                                                        CSD027
     C           PCNM      IFNE *BLANKS                                                       CSD027
     C                     MOVELPCNM      SPCNM
     C                     ELSE
     C                     MOVE *BLANKS   SPCNM
     C                     END
     C                     MOVELPMKT      SPMKT
     C***********PBRC      IFNE *ZEROS                                    S01117
     C           PBRA      IFNE *BLANKS                                   S01117
     C**********           MOVELPBRC      SPBRC                           S01117
     C                     MOVELPBRA      SPBRC                           S01117
     C                     ELSE
     C                     MOVE *BLANKS   SPBRC
     C                     END
     C                     MOVELPBOK      SPBOK
     C                     MOVELPPRT      SPPRT
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELPBCD      SPBOK                           CAC005
     C                     MOVELPRFC      SPFCT                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   S01486
     C           PTFR      IFEQ '9997'                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    SPTFR                           S01486
     C                     ELSE                                           S01486
     C                     MOVELPTFR      SPTFR                           S01486
     C                     END                                            S01486
     C*
     C                     MOVEA'1'       *IN,12
     C                     END
      *
      ***  Not CF/3, CF/12, ROLLUP, ROLLDOWN
      *
     C                     ELSE
      *
      ***  Validate Detail Screen Input
      *
     C                     EXSR VALIDD
      *
      ***  If no Detail Screen Errors,
      *
     C           SCRMSG    IFEQ *BLANK
     C           AID       ANDEQ'RA'
      *
      ***  For Record Advance, determine which Screen to return to
      *
     C           REVW      IFEQ 'Y'
     C                     MOVELPPAGK     PAGK
     C                     MOVEA'1'       *IN,11
     C                     ELSE
     C                     MOVEA'1'       *IN,10
     C                     END
      *
      ***  Update Files
      *
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C           ACTN      OREQ 'D'
     C                     EXSR UPDFLS
     C                     END
      *
      ***  End of No Detail Screen Errors
     C                     END
      *
      ***  End of If/Else ROLLDOWN, ROLLUP, CF/12, CF/3
      *
     C                     END
     C                     END
     C***********          END                             *AID=HP        S01199
     C                     END
     C                     END
      *
      ***  End of Do Until Change of Screen
      *
     C                     END
      *                                                                   101019
     C           ENDUPD    TAG                                            101019
     C*
     C** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVEA'00'      *IN,5
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              S01179
      *****************************************************************   S01179
      *                                                               *   S01179
      *  ASCHGS - Subroutine to move appropriate value into field AID,*   S01179
      *           depending on which Function Key has been pressed.   *   S01179
      *                                                               *   S01179
      *  Called By: UPDATE                                            *   S01179
      *  Calls:     None.                                             *   S01179
      *                                                               *   S01179
      *****************************************************************   S01179
      *                                                                   S01179
     C           ASCHGS    BEGSR                           *** ASCHGS *** S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN20     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F10                                                            S01179
     C*                                                                   S01179
     C           *INKJ     IFEQ '1'                                       S01179
     C                     MOVE '04'      AID                             S01179
     C                     MOVE '0'       *INKJ                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN65     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN65                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLDOWN pressed                                               S01179
     C*                                                                   S01179
     C           *IN66     IFEQ '1'                                       S01179
     C                     MOVE 'DN'      AID                             S01179
     C                     MOVE '0'       *IN66                           S01179
     C                     END                                            S01179
     C*                                                                   S01486
     C** IF PORTFOLIO REFERENCE BLANK SET ON INDICATOR TO                 S01486
     C** PROTECT FX RATE AND MULTIPLY / DIVIDE INDICATOR                  S01486
     C*                                                                   S01486
     C           ERR,1     IFEQ *BLANKS                                   S01486
     C           SPTFR     IFEQ *BLANKS                                   S01486
     C**********           MOVE '1'       *IN16                    S01486 176905
     C                     ELSE                                           S01486
     C                     MOVE '0'       *IN16                           S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01179
     C**If*HELP*key*pressed*************************************** S01179 S01199
     C***********                                                  S01179 S01199
     C************IN67     IFEQ '1'                                S01179 S01199
     C***********          MOVE 'HP'      AID                      S01179 S01199
     C***********          MOVE '0'       *IN67                    S01179 S01199
     C***********          END                                     S01179 S01199
     C***********                                                         S01179
     C                     ENDSR                                          S01179
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VALIDK - Subroutine to Validate Key fields.                  *
      *                                                               *
      *  Called By: START                                             *
      *             REVIEW                                            *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           VALIDK    BEGSR                           *** VALIDK ***
     C*
     C** RESET ERROR INDICATORS
     C** SET ERROR ARRAY COUNTER TO ZERO
     C*
     C                     MOVEA'0000000' *IN,21
     C***********          MOVE '0'       *IN28                    S01486 CAC005
     C                     MOVEA'00'      *IN,28                          CAC005
     C                     Z-ADD*ZERO     EC      40
     C                     MOVE *BLANKS   ERRMSG
     C                     Z-ADD*ZEROS    HPPRC
      *
      ***  Action Code must be blank, I, A, E or D,
      ***  -  If security shortname entered
      *
     C           SPSSN     IFNE *BLANKS
     C           ACTN      ANDNE'I'
     C           ACTN      ANDNE'A'
     C           ACTN      ANDNE'E'
     C           ACTN      ANDNE'D'
     C                     ADD  1         EC         21
     C                     MOVEL' 100'    ERR,EC
     C                     END
     C*
     C           SPSSN     IFEQ *BLANKS
     C           ACTN      ANDNE*BLANK
     C                     ADD  1         EC         21
     C                     MOVEL' 100'    ERR,EC
     C                     END
      *
     C* IF BRANCH IS NOT ENTERED, USE DEFAULT BRANCH TO CHECK AUTHORITY   S01117
     C* OF USER                                                           S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C           SPBRC     IFEQ *BLANKS                                   S01117
     C                     MOVE USRBCH    BRCH    3                       S01117
     C*                                                                   S01117
     C* IF PRICE TYPE NOT 'V' AND BRANCH NOT ENTERED, SET BRANCH TO       S01117
     C* DEFAULT BRANCH                                                    S01117
     C*                                                                   S01117
     C           SPPRT     IFNE 'V'                                       S01117
     C           SPTFR     ANDEQ*BLANKS                                   094836
     C                     MOVE USRBCH    SPBRC                           S01117
     C                     ELSE                                           075685
     C                     MOVE *BLANKS   SPBRC                           075685
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C* OTHERWISE, VALIDATE THE BRANCH ENTERED AND CHECK SPF AUTHORITY    S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SPBRC     @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVE A8BRCD    SPBRC                           S01117
     C                     MOVE SPBRC     BRCH                            S01117
     C                     ELSE                                           S01117
     C                     ADD  1         EC         25                   S01117
     C                     MOVEL' 110'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** VALIDATE SPF - USER'S AUTHORITY TO BRANCH                        S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   VALIDATE SPF-ACTION FOR THIS USER                              S01117
     C*                                                                   S01117
     C           ACTN      IFEQ 'I'                                       S01117
     C           ACTN      OREQ 'A'                                       S01117
     C           ACTN      OREQ 'E'                                       S01117
     C           ACTN      OREQ 'D'                                       S01117
     C*                                                                   S01117
     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         EC         21                   S01117
     C                     MOVE ' 302'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   IF MULTIBRANCHING ENVIRONMENT                                  S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM BRCH      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     ADD  1         EC         21                   S01117
     C                     MOVE ' 303'    ERR,EC                          S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     ADD  1         EC         21                   S01117
     C                     MOVE ' 304'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     MOVELSPSSN     PSSN
     C*
     C* If Client shortname entered, fetch number
     C*
     C********** SPCNM     CHAINCLINTCBF             33                   S01117
     C                     MOVELSPCNM     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C**********           Z-ADDCNUM      PCNM                            S01117
     C**********           MOVELBBCUST    SPCNM                     S01117076512
     C                     MOVELBBCUST    SPCNM     P                     076512
     C                     MOVELBBCUST    PCNM                            S01117
     C                     ELSE
     C                     MOVELSPCNM     PCNM
     C                     END
      *
     C                     MOVELSPMKT     PMKT
     C**********           MOVELSPBRC     PBRC                            S01117
     C                     MOVELSPBRC     PBRA                            S01117
     C                     MOVELSPBOK     PBOK
     C                     MOVELSPPRT     PPRT
     C                     MOVELSPBOK     KPBOK                           CAC005
     C                     MOVELSPBOK     PBCD                            CAC005
     C                     MOVELSPFCT     PRFC                            CAC005
      *                                                                   CAC005
      ** If CAC005 is on, validate the profit centre                      CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
      *                                                                   CAC005
     C           SPPRT     IFEQ 'DT'                                      CAC005
     C           SPFCT     ANDEQ*BLANKS                                   CAC005
     C           SPPRT     OREQ 'DV'                                      CAC005
     C           SPFCT     ANDEQ*BLANKS                                   CAC005
     C                     ADD  1         EC                              CAC005
     C                     MOVEL' 624'    ERR,EC                          CAC005
     C                     MOVE *ON       *IN29                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           SPBOK     IFNE *BLANKS                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*PSEUDO' POPTN   7                       CAC005
     C                     PARM SPBOK     PBOOK   2                       CAC005
     C                     PARM SPFCT     PPRFC   4                       CAC005
     C                     PARM           PPSCD   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPPSCD     KPBOK                           CAC005
     C                     MOVELPPSCD     PBOK                            CAC005
     C                     MOVE *OFF      *IN29                           CAC005
     C                     ELSE                                           CAC005
     C                     ADD  1         EC                              CAC005
     C                     MOVEL' 615'    ERR,EC                          CAC005
     C                     MOVE *ON       *IN29                           CAC005
     C                     MOVE *ON       *IN26                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
      *                                                                   S01486
     C           *INU4     IFEQ '1'                                       138641
     C           SPTFR     IFEQ FCR997                                    S01486
     C           FCPORS    ANDNE'B'                                       104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0080C011
     C           FCPORS    OREQ 'B'                                       104058
     C           SPTFR     ANDNE*BLANKS                                   104058
     C           SPTFR     ANDEQFCR997                                    104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0080C004
     C                     MOVE '9997'    PTFR                            S01486
     C/COPY WNCPYSRC,SE0080C005
     C                     ELSE                                           S01486
     C                     MOVELSPTFR     PTFR                            S01486
     C                     END                                            S01486
     C                     ELSE                                           138641
     C                     MOVEL*BLANKS   PTFR                            138641
     C                     END                                            138641
      *                                                                   S01486
     C           PRICEK    CHAINPRICEDFX             33
      *
      ***  If Action = Input, Price should not already exist. For all
      ***  other Actions, record should be on file.
      *
     C           ACTN      IFEQ 'I'
     C           *IN33     IFEQ '0'
     C           RECI      IFNE '*'
     C                     ADD  1         EC         21
     C                     MOVEL' 101'    ERR,EC
     C                     END
     C                     END
     C*
     C                     ELSE
     C           ACTN      IFNE ' '
     C***********ACTN      ANDNE'E'                                S01158 E24419
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC         21
     C                     MOVEL' 101'    ERR,EC
     C                     ELSE
     C*
      **  IF PRICE TYPE NOT CT OR CV, PRICE RECI MUST BE D
     C*
     C           SPPRT     IFNE 'CT'
     C           SPPRT     ANDNE'CV'
     C           RECI      ANDNE'D'
     C           ACTN      ANDNE'E'                                       E24419
     C                     ADD  1         EC         21
     C                     MOVEL' 101'    ERR,EC
     C                     ELSE
      *
      **  IF AMEND, RECI MUST BE D
      *
     C           ACTN      IFEQ 'A'
     C           RECI      ANDNE'D'
     C                     ADD  1         EC         21
     C                     MOVEL' 101'    ERR,EC
     C                     ELSE
      *
      **  IF DELETE, RECI MUST BE D OR A
      *
     C           ACTN      IFEQ 'D'
     C           RECI      ANDNE'D'
     C           RECI      ANDNE'A'
     C                     ADD  1         EC         21
     C                     MOVEL' 101'    ERR,EC
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      *
      ***  If Action Code Input, check Key fields.
      *
     C           *IN,21    IFNE '1'
     C           *IN,25    ANDNE'1'                                       S01117
      *
      ***  The following IF is unnecessary
     C           ACTN      IFNE *BLANK
      *                                                                   101019
      * Security shortname must reference an active security record       101019
      * if action is Amend, and Current Price specified.                  101019
      *                                                                   101019
     C           ACTN      IFEQ 'A'                                       101019
      *                                                                   101019
     C           SPPRT     IFEQ 'V '                                      101019
     C           SPSSN     CHAINSECTYDF              33                   101019
     C           *IN33     IFEQ '1'                                       101019
     C           RECI      ORNE 'D'                                       101019
     C                     ADD  1         EC                              101019
     C                     MOVEA' 104'    ERR,EC                          101019
     C                     SETON                     2227                 101019
     C                     END                                            101019
     C                     END                                            101019
      *                                                                   101019
     C                     END                                            101019
     C*
     C* Check Price Type field (in input mode)
     C*
     C           ACTN      IFEQ 'I'
      *
     C           SPPRT     IFNE 'V '
     C           SPPRT     ANDNE'DT'
     C           SPPRT     ANDNE'DV'
     C           SPPRT     ANDNE'CT'
     C           SPPRT     ANDNE'CV'
     C                     ADD  1         EC
     C                     MOVEA' 102'    ERR,EC
     C                     SETON                     27
     C                     END
     C*
     C* Price type 'V ' - No Customer, Market, Branch or Book entry
     C* allowed
     C*
     C           SPPRT     IFEQ 'V '
     C           SPCNM     IFNE *BLANKS
     C           SPMKT     ORNE *BLANKS
     C           SPBRC     ORNE *BLANKS
     C           SPBOK     ORNE *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 103'    ERR,EC
     C                     MOVEA'11111'   *IN,23
     C                     END
     C*
     C* Security shortname must reference an active security record
     C*
     C           SPSSN     CHAINSECTYDF              33
     C  N33      RECI      COMP 'D'                  3333
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 104'    ERR,EC
     C                     SETON                     2227
     C*
     C* Else translate Market price to Current price
     C*
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MKPR      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CURRP
     C                     END
     C*
     C                     END
     C*
     C* Price type 'DT' or 'DV'
     C*
     C           SPPRT     IFEQ 'DT'
     C           SPPRT     OREQ 'DV'
     C*
     C* No customer entry allowed
     C*
     C           SPCNM     IFNE *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 105'    ERR,EC
     C                     SETON                     2327
     C                     END
     C*                                                                   S01158
     C* Must reference an active Book file record                         S01158
     C*                                                                   S01158
     C********** SPBOK     CHAINBOOKD                33             S01158S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM SPBOK     @BKEY   2                       S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C********** *IN33     IFEQ '1'                                 S01158S01117
     C********** RECI      OREQ '*'                                 S01158S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC                              S01158
     C                     MOVEA' 109'    ERR,EC                          S01158
     C                     SETON                     26                   S01158
     C                     END                                            S01158
     C*
     C* Must reference an active Book position header record
     C*
     C**********           MOVE SPBRC     PBRC                            S01117
     C                     MOVE SPBRC     PBRA                            S01117
     C                     MOVE SPPRT     BASIS
      *                                                                   CAC005
      ** Convert to pseudo book                                           CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*PSEUDO' POPTN   7                       CAC005
     C                     PARM SPBOK     PBOOK   2                       CAC005
     C                     PARM SPFCT     PPRFC   4                       CAC005
     C                     PARM           PPSCD   2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPPSCD     KPBOK                           CAC005
     C                     MOVELPPSCD     PBOK                            CAC005
     C                     ELSE                                           CAC005
     C                     MOVE *BLANKS   PBOK                            CAC005
     C                     MOVE *BLANKS   KPBOK                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           BKPHDK    CHAINBKPHDDF              33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 106'    ERR,EC
     C                     SETON                     222425
     C                     SETON                     2627
     C*
     C                     ELSE
     C           RECI      IFNE 'D'
     C                     ADD  1         EC
     C                     MOVEA' 106'    ERR,EC
     C                     SETON                     222425
     C                     SETON                     2627
     C*
     C* Else translate Latest average price to Current price
     C*
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE LAVP      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CURRP
     C                     END
     C                     END
     C*
      ***  End of Price Type = 'DT' or 'DV'.
     C                     END
     C*
     C* Price type 'CT' or 'CV'
     C*
     C           SPPRT     IFEQ 'CT'
     C           SPPRT     OREQ 'CV'
     C*
     C* Book entry not allowed
     C*
     C           SPBOK     IFNE *BLANKS
     C                     ADD  1         EC
     C                     MOVEA' 107'    ERR,EC
     C                     MOVEA'11'      *IN,26
     C                     END
     C*
     C* Must reference an active Customer position
     C*
     C***********          MOVE SPBRC     PBRC                            S01117
     C                     MOVE SPBRC     PBRA                            S01117
     C*
     C* If Client shortname entered, fetch number
     C*
     C********** SPCNM     CHAINCLINTCBF             33                   S01117
     C                     MOVELSPCNM     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C********** *IN33     IFEQ '0'                                       S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C**********           Z-ADDCNUM      PCNM                            S01117
     C**********           MOVELBBCUST    SPCNM                     S01117076512
     C                     MOVELBBCUST    SPCNM     P                     076512
     C                     MOVELBBCUST    PCNM                            S01117
     C                     ELSE
     C                     MOVELSPCNM     PCNM
     C                     END
      *
     C           SPBRC     IFNE *BLANKS                                   S01486
     C           CPOSNK    CHAINCPOSNDF              33
     C           *IN33     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 108'    ERR,EC
     C                     MOVEA'1111'    *IN,22
     C                     SETON                     27
     C*
     C                     ELSE
     C           RECI      IFNE 'D'
     C                     ADD  1         EC
     C                     MOVEA' 108'    ERR,EC
     C                     MOVEA'1111'    *IN,22
     C                     SETON                     27
     C*
     C* Else translate Customer position price to Current price
     C*
     C                     ELSE
     C*                                                                   E14837
     C* Fetch nominal security details                                    E14837
     C*                                                                   E14837
     C           SPSSN     CHAINSECTYDF              33                   E14837
     C*                                                                   E14837
     C* Fetch nominal currency decimal places                             E14837
     C*                                                                   E14837
     C**********           MOVEL'20      'TKEY   12                 E14837S01117
     C**********           MOVELNMCY      ZWK4    4                 E14837S01117
     C**********           MOVE 1         ZWK4                      E14837S01117
     C**********           MOVE ZWK4      TKEY                      E14837S01117
     C********** TKEY      CHAINTABTG10F             33             E14837S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM NMCY      @CKEY   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C**N33***** RECI      COMP 'D'                  3333           E14837S01117
     C********** *IN33     IFEQ '1'                                 E14837S01117
     C********** *LOCK     IN   LDA                                       S01117
     C**********           MOVEL'SE0080'  DBPGM      ************   E14837S01117
     C**********           MOVELTKEY      DBKEY      * DATABASE *   E14837S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*04**   E20651
     C***********          MOVEL'04'      DBASE            ***************E20651
     C**********           MOVE 'TABLE'   DBFILE     * DB ERROR 06 *E20651S01117
     C***********          MOVEL'06'      DBASE            *********E20651S01117
     C**********           Z-ADD6         DBASE            ***************S01117
     C**********           OUT  LDA                                       S01117
     C**********           SETON                       U7U8         E14837S01117
     C**********           EXSR ERROR                                     S01117
     C**********           RETRN                                    E14837S01117
     C**********           END                                      E14837S01117
     C*                                                                   E14837
     C                     Z-ADD*ZEROS    WK15N8
     C           SPPRT     IFEQ 'CT'                                      E13911
      *
     C           CSNT      IFNE *ZEROS
     C           CSNT      IFLT 0                                         E13911
     C                     Z-SUBCSNT      CSNT                            E13911
     C                     END                                            E13911
     C           CSPT      DIV  CSNT      WK15N8
     C                     END                                            E13911
      *
     C                     ELSE
     C           CSNV      IFNE *ZEROS
     C           CSNV      IFLT 0                                         E13911
     C                     Z-SUBCSNV      CSNV                            E13911
     C                     END                                            E13911
     C           CSPV      DIV  CSNV      WK15N8
     C           SPBS      IFEQ 'P'                                       095551
     C                     MULT 100       WK15N8                          095551
     C                     END                                            095551
     C                     END
      *
     C                     END
      *
     C           5         SUB  NMDP      DC      10                      E14837
     C**********           ADD  CDP       DC                        E14837S01117
     C                     ADD  A6NBDP    DC                              S01117
     C                     DIV  POWER8,DC WK15N8                          E14837
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE WK15N8    ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CURRP
      *
      ***  End of RECI If/Else NOT= 'D'.
     C                     END
      ***  End of CPOSND record.
     C                     END
      ***  End of Price Type = 'CT' or 'CV'.
     C                     END
      *                                                                   S01486
     C** Branch code and Portfolio ref. may not be entered together       S01486
     C*                                                                   S01486
     C           SPTFR     IFNE *BLANKS                                   S01486
     C           SPBRC     ANDNE*BLANKS                                   S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 207'    ERR,EC                          S01486
     C                     MOVE '1'       *IN25                           S01486
     C                     MOVE '1'       *IN28                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** Either Branch code or Portfolio ref. must be entered             S01486
     C*                                                                   S01486
     C           SPTFR     IFEQ *BLANKS                                   S01486
     C           SPBRC     ANDEQ*BLANKS                                   S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 212'    ERR,EC                          S01486
     C                     MOVE '1'       *IN25                           S01486
     C                     MOVE '1'       *IN28                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           SPTFR     IFNE *BLANKS                                   S01486
     C           SPBRC     ANDEQ*BLANKS                                   S01486
     C*                                                                   S01486
     C* Must reference a current Portfolio position and must be greater   S01486
     C* than or equal to the date when the position was set up.           S01486
     C*                                                                   S01486
     C           SPPRT     IFEQ 'CT'                                      S01486
     C                     MOVE 'T'       WTVDA                           S01486
     C                     ELSE                                           S01486
     C                     MOVE 'V'       WTVDA                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** FORMAT PORTFOLIO REFERENCE BEFORE CHAINING PMAPOSPD              S01486
     C           SPTFR     IFEQ FCR997                                    S01486
     C           FCPORS    ANDNE'B'                                       104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0080C012
     C           FCPORS    OREQ 'B'                                       104058
     C           SPTFR     ANDNE*BLANKS                                   104058
     C           SPTFR     ANDEQFCR997                                    104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0080C006
     C                     MOVE '9997'    WPTFR   4                       S01486
     C/COPY WNCPYSRC,SE0080C007
     C                     ELSE                                           S01486
     C                     MOVE SPTFR     WPTFR                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     MOVE *HIVAL    PVDT                            S01486
     C*                                                                   S01486
     C           POSKEY    SETGTPMAPOSLL                                  S01486
     C                     READPPMAPOSLL                 33               S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                                       S01486
     C           QACNUM    ORNE PCNM                                      S01486
     C           QAPTFR    ORNE WPTFR                                     S01486
     C           QATDSS    ORNE SPSSN                                     S01486
     C           QATVDA    ORNE WTVDA                                     S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 208'    ERR,EC                          S01486
     C                     MOVE '1'       *IN22                           S01486
     C                     MOVE '1'       *IN23                           S01486
     C                     MOVE '1'       *IN28                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** VALIDATE PORTFOLIO REFERENCE                                     S01486
     C*                                                                   S01486
     C           *INU4     IFEQ '1'                                       S01486
     C           SPTFR     ANDNEFCR997                                    S01486
     C           SPTFR     ANDNE*BLANKS                                   S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           SPTFR     ANDNE*BLANKS                                   CPB001
     C           PORKEY    CHAINPMPORTPD             33                   S01486
     C*                                                                   S01486
     C** Must be a valid Portfolio Reference for Customer                 S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                                       S01486
     C           PNRECI    OREQ '*'                                       S01486
     C                     MOVE '1'       *IN28                           S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 209'    ERR,EC                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** Warning if selected Portfolio has been flagged for closure       S01486
     C*                                                                   S01486
     C           *IN28     IFEQ '0'                                       S01486
     C           SPTFR     ANDNEWPTFR                                     S01486
     C           PNDPCL    ANDNE0                                         S01486
     C                     ADD  1         EC                              S01486
     C                     MOVE '1'       *IN28                           S01486
     C                     MOVEA' W05'    ERR,EC                          S01486
     C                     MOVE SPTFR     WPTFR   4                       S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
      ***  End of Action = 'I'
     C                     END
     C                     END
     C                     END
      *                                                                   CSE006
      ***  If Book code is entered then must validate Buy- sell field     CSE006
      ***  If BYSL is 'Y' then user shall not be allowed to enter         CSE006
      ***  a book.                                                        CSE006
      ** Access book details file SDBOOKPD via access object program      CSE006
      *                                                                   CSE006
     C           SPBOK     IFNE *BLANKS                                   CSE006
     C                     CALL 'AOBOOKR0'                                CSE006
     C                     PARM *BLANKS   @RTCD   7                       CSE006
     C                     PARM '*KEY   ' @OPTN   7                       CSE006
     C                     PARM SPBOK     @BKCD   2                       CSE006
     C           SDBOOK    PARM SDBOOK    DSFDY                           CSE006
      *                                                                   CSE006
     C           BDBYSL    IFEQ 'Y'                                       CSE006
     C                     ADD  1         EC                              CSE006
     C                     MOVEA' 115'    ERR,EC                          CSE006
     C                     SETON                     26                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C                     MOVELHI        ERRMSG
     C                     MOVEL*BLANK    AID
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  VALIDD - Subroutine to Validate Detail Screen.               *
      *                                                               *
      *  Called By: UPDATE                                            *
      *  Calls:     ZEDIT                                             *
      *             ZALIGN                                            *
      *                                                               *
      *****************************************************************
      *
     C           VALIDD    BEGSR                           *** VALIDD ***
     C*
     C** RESET SCREEN ERROR INDICATORS
     C*
     C                     MOVEA'00'      *IN,31
     C                     MOVE '0'       *IN34                           S01486
     C                     MOVE '0'       *IN35                           S01486
     C                     MOVEA'0000'    *IN,73                          S01169
     C/COPY WNCPYSRC,SE0080C016
     C*
     C** SET ERROR COUNT TO ZERO
     C*
     C                     Z-ADD*ZERO     EC
     C*
     C** ENTER KEY PRESSSED
     C*
     C           AID       IFEQ 'RA'
     C*
     C** ACTION = I OR A
     C** VALIDATION OF FIELDS FOR INSERT/AMEND
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
      *                                                                   S01169
      ** If price type is 'V ' (current price), then validate fields      S01169
      **   for output to PF/EXVALD.                                       S01169
      *                                                                   S01169
     C           PPRT      IFEQ 'V '                                      S01169
     C           *IN71     ANDEQ'1 '                                      S01169
      *                                                                   S01169
      ** Move price source into output field.                             S01169
      *                                                                   S01169
     C                     MOVE 'S'       PSRC                            S01169
      *                                                                   S01169
      ** Auto price indicator is mandatory and must be 'Y' or 'N'.        S01169
      *                                                                   S01169
     C           APIND     IFEQ *BLANK                                    S01169
     C           APIND     ORNE 'Y'                                       S01169
     C           APIND     ANDNE'N'                                       S01169
     C                     SETON                     73                   S01169
     C                     ELSE                                           S01169
     C                     MOVE APIND     JEXAP   1                       S01169
     C                     END                                            S01169
      *                                                                   S01169
      ** Lower price boundary is mandatory and must be validated as       S01169
      **   a 13,8 numeric field.                                          S01169
      *                                                                   S01169
     C           LPRICE    IFEQ *BLANKS                                   S01169
     C                     SETON                     74                   S01169
      *                                                                   S01169
     C                     ELSE                                           S01169
      *                                                                   S01169
     C                     MOVE *BLANKS   ZFIELD                          S01169
     C                     MOVE LPRICE    ZFIELD                          S01169
     C                     Z-ADD7         ZADIG                           S01169
     C                     Z-ADD8         ZADEC                           S01169
     C                     EXSR ZALIGN                                    S01169
      *                                                                   S01169
      ** If field in error set up error code and indicator.               S01169
      *                                                                   S01169
     C           *IN99     IFEQ '1'                                       S01169
     C                     SETON                     74                   S01169
     C                     ELSE                                           S01169
      *                                                                   S01169
      ** If field is OK move to numeric output field.                     S01169
      *                                                                   S01169
     C                     MOVE ZFIELD    JLPBD  158                      S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     END                                            S01169
      *                                                                   S01169
      ** Upper price boundary is mandatory and must be validated as       S01169
      **   a 13,8 numeric field.                                          S01169
      *                                                                   S01169
     C           UPRICE    IFEQ *BLANKS                                   S01169
     C                     SETON                     75                   S01169
     C                     ELSE                                           S01169
      *                                                                   S01169
     C                     MOVE *BLANKS   ZFIELD                          S01169
     C                     MOVE UPRICE    ZFIELD                          S01169
     C                     Z-ADD7         ZADIG                           S01169
     C                     Z-ADD8         ZADEC                           S01169
     C                     EXSR ZALIGN                                    S01169
      *                                                                   S01169
      ** If field in error set up error code and indicator.               S01169
      *                                                                   S01169
     C           *IN99     IFEQ '1'                                       S01169
     C                     SETON                     75                   S01169
     C                     ELSE                                           S01169
      *                                                                   S01169
      ** If field is OK move to numeric output field and check that       S01169
      **   it is greater or equal to the lower price boundary.            S01169
      *                                                                   S01169
     C                     MOVE ZFIELD    JUPBD  158                      S01169
      *                                                                   S01169
     C           *IN74     IFEQ '0'                                       S01169
     C           JUPBD     ANDLTJLPBD                                     S01169
     C                     SETON                     75                   S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     END                                            S01169
      *                                                                   S01169
      ** Percentage allowable is mandatory and must be validated as       S01169
      **   a 9,6 numeric field.                                           S01169
      *                                                                   S01169
     C           PCENT     IFEQ *BLANKS                                   S01169
     C                     SETON                     76                   S01169
     C                     ELSE                                           S01169
      *                                                                   S01169
     C                     MOVE *BLANKS   ZFIELD                          S01169
     C                     MOVE PCENT     ZFIELD                          S01169
     C                     Z-ADD3         ZADIG                           S01169
     C                     Z-ADD6         ZADEC                           S01169
     C                     EXSR ZALIGN                                    S01169
      *                                                                   S01169
      ** If field in error set up error code and indicator.               S01169
      *                                                                   S01169
     C           *IN99     IFEQ '1'                                       S01169
     C           PCENT     OREQ *BLANKS                                   S01169
     C                     SETON                     76                   S01169
     C                     ELSE                                           S01169
      *                                                                   S01169
      ** If field is OK move to numeric output field.                     S01169
      *                                                                   S01169
     C                     MOVE ZFIELD    JPMOV   96                      S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     END                                            S01169
      ***  If Price Type = 'V' AND EXTEL                                  S01169
     C                     END                                            S01169
     C*
     C** Price field - mandatory entry as valid number
     C*
     C           SPPRC     IFEQ *BLANKS
     C           SNPXR     IFEQ *BLANKS                                   S01486
     C                     ADD  1         EC
     C*********************MOVEA' 200'    ERR,EC                          S01486
     C                     MOVEA' 213'    ERR,EC                          S01486
     C                     SETON                     31
     C                     SETON                     34                   S01486
     C                     END                                            S01486
     C                     ELSE
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SPPRC     ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 200'    ERR,EC
     C                     SETON                     31
     C                     ELSE
     C                     MOVE ZFIELD    PPRC
     C*
     C* Fetch 10% + or - of Current price for comparison
     C*    ** WARNING ERROR ONLY - ACCEPT IF UNCHANGED **
     C*
     C           PPRC      IFNE HPPRC
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CURRP     ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    CURPRC 158
      *                                                                   S01169
      ** If price type is 'V ', (current price), use value entered        S01169
      ** (ie. do not use if blanks)                                       E22913
      **   as percentage allowable otherwise use 10%.                     S01169
      *                                                                   S01169
     C           PPRT      IFEQ 'V '                                      S01169
     C           JPMOV     ANDNE0                                         E22913
     C           JPMOV     DIV  100       WK158  158H                     S01169
     C           CURPRC    MULT WK158     WK158                           S01169
     C                     ELSE                                           S01169
     C/COPY WNCPYSRC,SE0080C017
     C           CURPRC    DIV  10        WK158  158H
     C/COPY WNCPYSRC,SE0080C018
     C                     END                                            S01169
     C           CURPRC    ADD  WK158     CURPRP 158
     C           CURPRC    SUB  WK158     CURPRL 158
     C           PPRC      IFGT CURPRP
     C/COPY WNCPYSRC,SE0080C019
     C                     ADD  1         EC
     C                     MOVEA' W01'    ERR,EC
     C                     SETON                     31
     C                     MOVE 'Y'       PPPWN   1                       S01169
     C                     ELSE
     C           PPRC      IFLT CURPRL
     C/COPY WNCPYSRC,SE0080C020
     C                     ADD  1         EC
     C                     MOVEA' W01'    ERR,EC
     C                     SETON                     31
     C                     MOVE 'Y'       PPPWN                           S01169
     C                     ELSE                                           S01169
     C                     MOVE 'N'       PPPWN                           S01169
     C                     END                                            S01169
     C                     END                                            S01169
      *                                                                   S01169
     C           *IN71     IFEQ '1'                                       S01169
     C*                                                                   S01169
      ** If price type is 'V ' (current price) and the upper and          S01169
      **   lower boundaries are not zero, the price must be               S01169
      **   within these boundaries.                                       S01169
      *                                                                   S01169
     C*    ** WARNING ERROR ONLY - ACCEPT IF UNCHANGED **                 S01169
      *                                                                   S01169
     C           PPRT      IFEQ 'V '                                      S01169
     C           JLPBD     ANDNE0                                         S01169
     C           PPRT      OREQ 'V '                                      S01169
     C           JUPBD     ANDNE0                                         S01169
      *                                                                   S01169
     C           PPRC      IFGT JUPBD                                     S01169
     C           PPRC      ORLT JLPBD                                     S01169
     C                     ADD  1         EC                              S01169
     C                     MOVEA' W02'    ERR,EC                          S01169
     C                     SETON                     31                   S01169
     C                     MOVE 'Y'       PPBWN   1                       S01169
     C                     ELSE                                           S01169
     C                     MOVE 'N'       PPBWN                           S01169
     C                     END                                            S01169
     C                     END
     C                     END
     C                     Z-ADDPPRC      HPPRC
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* Narrative field
     C*
     C                     MOVE SPNTV     PNTV
     C*
     C* Value date field
     C*
     C           SPVDT     IFNE *BLANKS
     C*
     C* Check valid date
     C*
     C                     MOVE SPVDT     DATEN   60
     C                     MOVE DATEN     DATEA   6
     C           SPVDT     IFNE DATEA
     C                     ADD  1         EC
     C                     MOVEA' 201'    ERR,EC
     C                     SETON                     32
     C                     ELSE
     C*
     C                     MOVE SPVDT     ZDATE
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC
     C                     MOVEA' 201'    ERR,EC
     C                     SETON                     32
     C                     ELSE
     C*
     C* Check date is not prior to Back Value Period                      E17998
     C*                                                                   E17998
     C********** RUND      SUB  BKVP      WBKVP   60                E17998S01117
     C           RUND      SUB  BVBVP     WBKVP   60                      S01117
     C           ZDAYNO    IFLT WBKVP                                     E17998
     C                     ADD  1         EC                              E17998
     C                     MOVEA' 203'    ERR,EC                          E17998
     C                     SETON                     32                   E17998
     C                     ELSE                                           E17998
     C*
     C* Check not after run date
     C*
     C           ZDAYNO    IFGT RUND
     C                     ADD  1         EC
     C                     MOVEA' 202'    ERR,EC
     C                     SETON                     32
     C                     ELSE
     C                     Z-ADDZDAYNO    PVDT
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
     C* Else default to run date
     C*
     C                     ELSE
     C                     Z-ADDRUND      PVDT
     C                     END
      *                                                                   S01486
     C           *INU4     IFEQ '1'                        B1             S01486
     C*                                                                   S01486
     C** CHECK DATE ENTERED AFTER A POSITION HAS BEEN ESTABLISHED FOR     S01486
     C** THE SECURITY                                                     S01486
     C*                                                                   S01486
     C           SPTFR     IFNE *BLANKS                                   S01486
     C*                                                                   S01486
     C** FORMAT DETAILS FOR CHECKING POSITION EXISTS                      S01486
     C*                                                                   S01486
     C           SPPRT     IFEQ 'CT'                                      S01486
     C                     MOVE 'T'       WTVDA                           S01486
     C                     ELSE                                           S01486
     C                     MOVE 'V'       WTVDA                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** FORMAT PORTFOLIO REFERENCE BEFORE CHAINING PMAPOSPD              S01486
     C*                                                                   S01486
     C           SPTFR     IFEQ FCR997                                    S01486
     C           FCPORS    ANDNE'B'                                       104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0080C013
     C           FCPORS    OREQ 'B'                                       104058
     C           SPTFR     ANDNE*BLANKS                                   104058
     C           SPTFR     ANDEQFCR997                                    104058
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C/COPY WNCPYSRC,SE0080C008
     C                     MOVE '9997'    WPTFR   4                       S01486
     C/COPY WNCPYSRC,SE0080C009
     C                     ELSE                                           S01486
     C                     MOVE SPTFR     WPTFR                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** CHECK WHETHER POSITION ALREADY EXISTED ON PMAPOSLL BEFORE        S01486
     C** PRICE CHANGE INPUT. IF NOT ERROR ON VALUE DATE                   S01486
     C*                                                                   S01486
     C           POSKEY    SETGTPMAPOSLL                                  S01486
     C                     READPPMAPOSLL                 33               S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                                       S01486
     C           QACNUM    ORNE PCNM                                      S01486
     C           QAPTFR    ORNE WPTFR                                     S01486
     C           QATDSS    ORNE SPSSN                                     S01486
     C           QATVDA    ORNE WTVDA                                     S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 202'    ERR,EC                          S01486
     C                     SETON                     32                   S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** FX RATE AND MULTIPLY/DIVIDE INDICATOR MAY NOT BE ENTERED         S01486
     C** IF REFERENCE FOR '9997' PORTFOLIO HAS BEEN INPUT                 S01486
     C*                                                                   S01486
     C           SPTFR     IFEQ FCR997                                    S01486
     C*                                                                   S01486
     C           SNPXR     IFNE *BLANKS                                   S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 210'    ERR,EC                          S01486
     C                     MOVE '1'       *IN34                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           SNPMD     IFNE *BLANKS                                   S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 211'    ERR,EC                          S01486
     C                     MOVE '1'       *IN35                           S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** FX Rate must be entered if M/D indicator is entered              S01486
     C*                                                                   S01486
     C           SNPXR     IFEQ *BLANKS                    B2             S01486
     C           SNPMD     ANDNE*BLANKS                                   S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 210'    ERR,EC                          S01486
     C                     MOVE '1'       *IN34                           S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C** FX Rate must be entered if M/D indicator is entered              S01486
     C*                                                                   S01486
     C           SNPXR     IFNE *BLANKS                    B2             S01486
     C           SNPMD     ANDEQ*BLANKS                                   S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 210'    ERR,EC                          S01486
     C                     MOVE '1'       *IN34                           S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C** Check that valid FX rate input                                   S01486
     C*                                                                   S01486
     C           *IN34     IFEQ '0'                        B2             S01486
     C           SNPXR     ANDNE*BLANKS                                   S01486
     C                     MOVE *BLANKS   ZFIELD                          S01486
     C                     MOVE SNPXR     ZFIELD                          S01486
     C                     Z-ADD5         ZADIG                           S01486
     C                     Z-ADD8         ZADEC                           S01486
     C                     EXSR ZALIGN                                    S01486
     C                     MOVE ZFIELD    WNPXR  138                      S01486
     C           *IN99     IFEQ '1'                        B3             S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 210'    ERR,EC                          S01486
     C                     MOVE '1'       *IN34                           S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C** Format amount for output to screen                               S01486
     C                     MOVE *BLANKS   ZFIELD                          S01486
     C                     MOVE WNPXR     ZFIELD                          S01486
     C                     Z-ADD8         ZADEC                           S01486
     C                     EXSR ZEDIT                                     S01486
     C                     MOVE ZFIELD    SNPXR                           S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C** If details valid calculate FX cross rate on price date between   S01486
     C** security nominal currency and portfolio currency                 S01486
     C** if portfolio reference is entered                                176905
     C           SPTFR     IFNE '    '                                    176905
     C           *IN34     IFEQ '0'                        B2             S01486
     C*                                                                   S01486
     C** If settlement currency and portfolio currency are the same       S01486
     C** set cross rate to 1 and multiply/divide indicator to 'M'         S01486
     C** and skip straight to amount validation                           S01486
     C           QATNMC    IFEQ QAPTCY                     B3             S01486
     C                     MOVE 'M'       ZCRSMD                          S01486
     C                     Z-ADD1         ZCRSRT                          S01486
     C                     GOTO AMCHK                                     S01486
     C                     END                             E3             S01486
     C*                                                                   176905
     C* Get Euro rates                                                    176905
     C*                                                                   176905
     C                     CALL 'AOCURRR0'                                176905
     C                     PARM '*DBERR'  @RTCD   7                       176905
     C                     PARM '*KEY   ' @OPTN   7                       176905
     C                     PARM QATNMC    @AJCD   3                       176905
     C           SDCURR    PARM SDCURR    DSSDY                           176905
     C*                                                                   176905
     C                     Z-ADDA6EUER    ZRATE1 138                      176905
     C                     MOVE A6INCY    ZINCY1  1                       176905
     C                     MOVE A6EUMD    ZEUMD1  1                       176905
     C                     Z-ADDA6NBDP    ZCDP1   10                      176905
     C*                                                                   176905
     C                     CALL 'AOCURRR0'                                176905
     C                     PARM '*DBERR'  @RTCD   7                       176905
     C                     PARM '*KEY   ' @OPTN   7                       176905
     C                     PARM QAPTCY    @AJCD   3                       176905
     C           SDCURR    PARM SDCURR    DSSDY                           176905
     C*                                                                   176905
     C                     Z-ADDA6EUER    ZRATE2 138                      176905
     C                     MOVE A6INCY    ZINCY2  1                       176905
     C                     MOVE A6EUMD    ZEUMD2  1                       176905
     C                     Z-ADDA6NBDP    ZCDP2   10                      176905
     C           QATNMC    IFEQ BKEURO                     B3             176905
     C           ZINCY2    ANDEQ'Y'                                       176905
     C           QAPTCY    OREQ BKEURO                                    176905
     C           ZINCY1    ANDEQ'Y'                                       176905
     C           ZINCY1    OREQ 'Y'                                       176905
     C           ZINCY2    ANDEQ'Y'                                       176905
     C*                                                                   176905
     C*                                                                   176905
     C           QAPTCY    IFEQ BKEURO                     B4             176905
     C                     MOVE ZEUMD1    ZCRSMD                          176905
     C                     Z-ADDZRATE1    ZCRSRT                          176905
     C                     GOTO AMCHK                                     176905
     C                     END                             E4             176905
     C*                                                                   176905
     C           QATNMC    IFEQ BKEURO                     B4             176905
     C           ZEUMD2    IFEQ 'M'                        B5             176905
     C                     MOVE 'D'       ZCRSMD                          176905
     C                     ELSE                            X5             176905
     C                     MOVE 'M'       ZCRSMD                          176905
     C                     END                             E5             176905
     C                     Z-ADDZRATE2    ZCRSRT                          176905
     C                     GOTO AMCHK                                     176905
     C                     END                             E4             176905
     C                     END                             E3             176905
     C*                                                                   S01486
     C**  OBTAIN FX RATE FOR TRADE DATE BETWEEN SETTLEMENT CURRENCY       S01486
     C**  AND BASE CURRENCY FOR ACCOUNTING                                S01486
     C                     MOVE QATNMC    HSEXCY  3                       S01486
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 33               S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                        B3             S01486
     C           QATNMC    ORNE Q8CCY                                     S01486
     C*                                                                   S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 33               S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                        B4             S01486
     C           QATNMC    ORNE Q8CCY                                     S01486
     C                     SETON                     U7U8LR               S01486
     C                     MOVE '35'      DBASE             ************  S01486
     C                     MOVEL'HSEXPD'  DBFILE            * DATABASE *  S01486
     C                     MOVELQATNMC    DBKEY             * ERROR 35 *  S01486
     C                     MOVE PVDT      DBKEY             ************  S01486
     C                     RETRN                                          S01486
     C                     END                             E4             S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C**  SET UP SR/ZCCYCN WITH 'FROM' DETAILS FOR SETTLEMENT CURRENCY    S01486
     C                     Z-ADDQ8SPOT    ZRATEF                          S01486
     C                     MOVE Q8MDV1    ZMDINF                          S01486
     C                     Z-ADDQ8CDP     ZCDPF                           S01486
     C                     MOVE QATNMC    ZCCYF                           S01486
     C*                                                                   S01486
     C**  OBTAIN FX RATE FOR TRADE DATE BETWEEN PORTFOLIO CURRENCY        S01486
     C**  AND BASE CURRENCY FOR ACCOUNTING                                S01486
     C                     MOVE QAPTCY    HSEXCY                          S01486
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 33               S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                        B3             S01486
     C           QAPTCY    ORNE Q8CCY                                     S01486
     C*                                                                   S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 33               S01486
     C*                                                                   S01486
     C           *IN33     IFEQ '1'                        B4             S01486
     C           QAPTCY    ORNE Q8CCY                                     S01486
     C                     SETON                     U7U8LR               S01486
     C                     MOVE '36'      DBASE             ************  S01486
     C                     MOVEL'HSEXPD'  DBFILE            * DATABASE *  S01486
     C                     MOVELQAPTCY    DBKEY             * ERROR 36 *  S01486
     C                     MOVE PVDT      DBKEY             ************  S01486
     C                     RETRN                                          S01486
     C                     END                             E4             S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C**  SET UP SR/ZCCYCN WITH 'TO' DETAILS FOR PORTFOLIO CURRENCY       S01486
     C                     Z-ADDQ8SPOT    ZRATET                          S01486
     C                     MOVE Q8MDV1    ZMDINT                          S01486
     C                     Z-ADDQ8CDP     ZCDPT                           S01486
     C                     MOVE QAPTCY    ZCCYT                           S01486
     C*                                                                   S01486
     C**  CALCULATE CROSS RATE BETWEEN SETTLEMENT CURRENCY AND PORTFOLIO  S01486
     C**  CURRENCY USING STANDARD SUBROUTINE SR/ZCCYCN                    S01486
     C                     Z-ADD0         ZAMTF                           S01486
     C                     EXSR ZCCYCN                                    S01486
     C*                                                                   S01486
     C****IF*CROSS MULTIPLY / DIVIDE INDICATOR ENTERED ON SCREEN   S01486 176905
     C****DIFFERENT TO THAT RETURNED FROM SR/ZCCYCN TAKE INVERSE OFS01486 176905
     C****ENTERED RATE                                             S01486 176905
     C********** SNPMD     IFNE ZCRSMD                     B4      S01486 176905
     C********** 1         DIV  ZCRSRT    ZCRSRT                   S01486 176905
     C**********           END                             E4      S01486 176905
     C*                                                                   S01486
     C**  IF FX RATE DETAILS BLANK OUTPUT DEFAULT RATE CALCULATED IN      S01486
     C**  SR/ZCCYCN TO SCREEN WITH WARNING ERROR                          S01486
     C           AMCHK     TAG                                            S01486
     C*                                                                   176905
     C** If no FX rate entered, setup by the calculated value and         176905
     C** Format amount for output to screen                               176905
     C           WNPXR     IFEQ 0                          B4             176905
     C                     Z-ADDZCRSRT    WNPXR                           176905
     C                     END                             E4             176905
     C           SNPMD     IFEQ ' '                        B4             176905
     C                     MOVE ZCRSMD    SNPMD                           176905
     C                     END                             E4             176905
     C                     MOVE *BLANKS   ZFIELD                          176905
     C                     MOVE WNPXR     ZFIELD                          176905
     C                     Z-ADD8         ZADEC                           176905
     C                     EXSR ZEDIT                                     176905
     C                     MOVE ZFIELD    SNPXR                           176905
     C*                                                                   S01486
     C**  IF FX RATE DETAILS INPUT ON SCREEN CHECK THAT DETAILS ENTERED   S01486
     C**  FOR TRADE DATE WITHIN 10% OF CROSS RATE ON THAT DAY             S01486
     C**  CALCULATE RANGE OF ACCEPTABLE VALUES                            S01486
     C           ZCRSRT    DIV  10        WWRT10 138                      S01486
     C           ZCRSRT    ADD  WWRT10    WWRTPS 138                      S01486
     C           ZCRSRT    SUB  WWRT10    WWRTMS 138                      S01486
     C*                                                                   S01486
     C** Warning if FX Rate is not within +- 10%                          S01486
     C** of the nominal to Portfolio currency rate                        S01486
     C*                                                                   S01486
     C           WNPXR     IFGT WWRTPS                     B4             S01486
     C           WNPXR     ANDNEWWNPXR                                    S01486
     C           WNPXR     ORLT WWRTMS                                    S01486
     C           WNPXR     ANDNEWWNPXR                                    S01486
     C                     ADD  1         EC                              S01486
     C                     MOVE '1'       *IN34                           S01486
     C                     MOVEA' W06'    ERR,EC                          S01486
     C                     Z-ADDWNPXR     WWNPXR 138                      S01486
     C                     END                             E4             S01486
     C*                                                                   S01486
     C                     END                             E3             S01486
     C*                                                                   176905
     C* If PTFR = *blanks, NPMD and NPXR must be blank                    176905
     C*                                                                   176905
     C                     ELSE                                           176905
     C                     MOVE *BLANKS   SNPMD                           176905
     C                     MOVE *BLANKS   SNPXR                           176905
     C                     MOVE ' '       NPMD                            176905
     C                     Z-ADD0         NPXR                            176905
     C                     END                                            176905
     C*                                                                   S01486
     C** M/D indicator must be 'M' or 'D' if FX Rate is entered           S01486
     C*                                                                   S01486
     C           SNPXR     IFNE *BLANKS                    B2             S01486
     C           SNPMD     ANDNE'M'                                       S01486
     C           SNPMD     ANDNE'D'                                       S01486
     C                     ADD  1         EC                              S01486
     C                     MOVEA' 211'    ERR,EC                          S01486
     C                     MOVE '1'       *IN35                           S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C           *IN34     IFEQ '0'                        B2             S01486
     C           *IN35     ANDEQ'0'                                       S01486
     C                     MOVE SNPMD     NPMD                            S01486
     C*                                                                   S01486
     C           SNPXR     IFEQ *BLANKS                    B3             S01486
     C                     Z-ADD0         NPXR                            S01486
     C                     ELSE                            X3             S01486
     C                     Z-ADDWNPXR     NPXR                            S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C           SPPRC     IFEQ *BLANKS                    B3             S01486
     C                     Z-ADD0         PPRC                            S01486
     C                     END                             X3             S01486
     C*                                                                   S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C                     END                             E1             S01486
     C/COPY WNCPYSRC,SE0080C010
      *                                                                   S01486
      ** If price type is 'V ' (currrent price).                          S01169
      *                                                                   S01169
     C           PPRT      IFEQ 'V '                                      S01169
      *                                                                   S01169
      ** Move error codes into array to maintain top-down screen          S01169
      **   error code order.                                              S01169
      *                                                                   S01169
      ** Auto price.                                                      S01169
      *                                                                   S01169
     C           *IN73     IFEQ '1'                                       S01169
     C                     ADD  1         EC                              S01169
     C                     MOVEA' 203'    ERR,EC                          S01169
     C                     END                                            S01169
      *                                                                   S01169
      ** Lower price.                                                     S01169
      *                                                                   S01169
     C           *IN74     IFEQ '1'                                       S01169
     C                     ADD  1         EC                              S01169
     C                     MOVEA' 204'    ERR,EC                          S01169
     C                     END                                            S01169
      *                                                                   S01169
      ** Upper price.                                                     S01169
      *                                                                   S01169
     C           *IN75     IFEQ '1'                                       S01169
     C                     ADD  1         EC                              S01169
     C                     MOVEA' 205'    ERR,EC                          S01169
     C                     END                                            S01169
      *                                                                   S01169
      ** Percentage allowable.                                            S01169
      *                                                                   S01169
     C           *IN76     IFEQ '1'                                       S01169
     C                     ADD  1         EC                              S01169
     C                     MOVEA' 206'    ERR,EC                          S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     END                                            S01169
     C*
     C                     ELSE
     C*
     C** IF ACTION=D WITH ENTER PRESSED THEN ERROR
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,9     INFMSG
     C                     END
     C                     END
     C                     ELSE
     C*
     C** IF COMMAND 4 TAKEN
     C*
     C           AID       IFEQ '04'
     C*
     C** COMMAND 4 TAKEN CORRECTLY WHEN ACTION IS D-FORCE 'RECORD ADVANCE'
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVEL'RA'      AID
     C*
     C** COMMAND 4 TAKEN INCORRECTLY WHEN ACTION IS NOT D-HENCE ERROR
     C*
     C                     ELSE
     C                     MOVELINF,10    INFMSG
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C                     MOVELHI        ERRMSG
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INITRC - Subroutine to Initialise all File fields.           *
      *                                                               *
      *  Called By: UPDATE                                            *
      *             UPDFLS                                            *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           INITRC    BEGSR                           *** INITRC ***
     C*
     C** INITIALIZE ALL DATA ON RECORD DEFINED IN DETREC (KEY EXCLUDED)
     C*
     C                     MOVEL*BLANK    DETREC
     C                     Z-ADD*ZERO     PVDT
     C                     Z-ADD*ZERO     LCD
     C                     Z-ADD*ZERO     TNLU
     C                     Z-ADD*ZERO     PRDFTS                                              CSD006
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  TRSFS  - Subroutine to Format record fields for Screen.      *
      *                                                               *
      *  Called By: UPDATE                                            *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           TRSFS     BEGSR                           *** TRSFS  ***
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C* Price
      *                                                                   S01169
      ** Do not display details from PF/EXVALD if deleted record.         S01169
      *                                                                   S01169
     C           RECI      IFEQ '*'                                       S01169
     C           PPRT      ORNE 'V '                                      S01169
     C                     SETON                     72                   S01169
     C                     ELSE                                           S01169
     C                     SETOF                     72                   S01169
     C                     END                                            S01169
      *                                                                   S01169
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE PPRC      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SPPRC
     C*
     C* In amend mode, remember current price to not perform warning error
     C* check unless price changes.
     C*
     C                     Z-ADDPPRC      HPPRC
     C*
     C* Current price (display only)
     C*
     C           PPRT      IFEQ 'V'
     C*
     C* Fetch market price
     C*
     C           PSSN      CHAINSECTYDF              33
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MKPR      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CURRP
     C                     ELSE
     C*
     C           PPRT      IFEQ 'DT'
     C           PPRT      OREQ 'DV'
     C*
     C* Fetch latest average price
     C*
     C                     MOVE PPRT      BASIS
     C           BKPHDK    CHAINBKPHDDF              33
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE LAVP      ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CURRP
     C                     ELSE
     C*
     C           PPRT      IFEQ 'CT'
     C           PPRT      OREQ 'CV'
     C*                                                                   E14837
     C* Fetch nominal security details                                    E14837
     C*                                                                   E14837
     C           SPSSN     CHAINSECTYDF              33                   E14837
     C*                                                                   E14837
     C* Fetch nominal currency decimal places                             E14837
     C*                                                                   E14837
     C**********           MOVEL'20      'TKEY   12                 E14837S01117
     C**********           MOVELNMCY      ZWK4    4                 E14837S01117
     C**********           MOVE 1         ZWK4                      E14837S01117
     C**********           MOVE ZWK4      TKEY                      E14837S01117
     C********** TKEY      CHAINTABTG10F             33             E14837S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR ' @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM NMCY      @CKEY   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C**N33***** RECI      COMP 'D'                  3333           E14837S01117
     C********** *IN33     IFEQ '1'                                 E14837S01117
     C********** *LOCK     IN   LDA                                       S01117
     C**********           MOVEL'SE0080'  DBPGM      ************   E14837S01117
     C**********           MOVELTKEY      DBKEY      * DATABASE *   E14837S01117
     C***********          MOVE 'TABLE'   DBFILE           **ERROR*04**   E20651
     C***********          MOVEL'04'      DBASE            ***************E20651
     C**********           MOVE 'TABLE'   DBFILE     * DB ERROR 07 *E20651S01117
     C***********          MOVEL'07'      DBASE            *********E20651S01117
     C**********           Z-ADD7         DBASE            ***************S01117
     C**********           OUT  LDA                                       S01117
     C**********           SETON                       U7U8         E14837S01117
     C**********           EXSR ERROR                                     S01117
     C**********           RETRN                                    E14837S01117
     C**********           END                                      E14837S01117
     C*
     C* Fetch Customer position
     C*
     C           CPOSNK    CHAINCPOSNDF              33
     C*
     C                     Z-ADD*ZEROS    WK15N8 158
     C           CSNT      IFNE *ZEROS
     C           CSPT      DIV  CSNT      WK15N8
     C                     ELSE
     C           CSNV      IFNE *ZEROS
     C           CSPV      DIV  CSNV      WK15N8
     C                     END
     C                     END
     C           5         SUB  NMDP      DC      10                      E14837
     C**********           ADD  CDP       DC                        E14837S01117
     C                     ADD  A6NBDP    DC                              S01117
     C                     DIV  POWER8,DC WK15N8                          E14837
      *                                                                   E41611
      **  If price basis is 'P' then multiply by 100 to display percen-   E41611
      **  tage amount                                                     E41611
      *                                                                   E41611
     C           SPBS      IFEQ 'P'                                       E41611
     C                     MULT 100       WK15N8                          E41611
     C                     END                                            E41611
      *                                                                   E41611
     C           WK15N8    IFLT *ZEROS                                    E14837
     C                     Z-SUBWK15N8    WK15N8                          E14837
     C                     END                                            E14837
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE WK15N8    ZFIELD
     C                     Z-ADD8         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    CURRP
     C                     END
     C                     END
     C                     END
     C*
     C* Narrative
     C*
     C                     MOVE PNTV      SPNTV
     C*
     C* Value date
     C*
     C                     Z-ADDPVDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SPVDT
      *                                                                   S01486
     C           *INU4     IFEQ '1'                                       S01486
     C           PTFR      ANDNE*BLANKS                                   S01486
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           NPXR      IFNE 0                                         S01486
     C                     MOVE NPMD      SNPMD                           S01486
     C                     MOVE *BLANKS   ZFIELD                          S01486
     C                     MOVE NPXR      ZFIELD                          S01486
     C                     Z-ADD8         ZADEC                           S01486
     C                     EXSR ZEDIT                                     S01486
     C                     MOVE ZFIELD    SNPXR                           S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANKS   SNPXR                           S01486
     C                     END                                            S01486
     C                     END                                            S01486
      *                                                                   S01169
      ** Obtain details from PF/EXVALD for current price only and not     S01169
      **   a deleted price record.                                        S01169
      *                                                                   S01169
     C           *IN72     IFEQ '0'                                       S01169
     C                     EXSR EXDET                                     S01169
     C                     END                                            S01169
      *                                                                   S01169
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDFLS - Subroutine to Update File Records.                  *
      *                                                               *
      *  Called By: UPDATE                                            *
      *  Calls:     INITRC                                            *
      *             ZTNLU1                                            *
      *             INFSR                                             *
      *                                                               *
      *****************************************************************
      *
     C           UPDFLS    BEGSR                           *** UPDFLS ***
     C*
     C** U P D A T E   F I L E S
     C*
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C                     EXSR INITRC
     C*
     C** RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C                     EXSR ZTNLU1
     C*
     C** INITIALISE ERROR BAND
     C*
     C                     MOVEL*BLANK    INFMSG
     C*
     C**               I  N  S  E  R  T  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'I'
     C           PRICEK    CHAINPRICEDF              60    *
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
      *                                                                   S01169
      ** Move boundary and percentage warnings to file.                   S01169
      *                                                                   S01169
     C                     MOVE PPPWN     PPWN                            S01169
     C                     MOVE PPBWN     PBWN                            S01169
      *                                                                   S01169
     C                     MOVEL'D'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'I'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C                     MOVEASTAMP,1   PRTMST           Default Timestamp                  210760
     C   60                WRITEPRICEDF                15  *
      *                                                                   CAC005
      ** If CAC005 is installed, add the same record to SEPRICPD          CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           *IN60     ANDEQ'1'                                       CAC005
     C                     MOVELSPBOK     PBCD                            CAC005
     C                     MOVELSPFCT     PRFC                            CAC005
     C**********           WRITESEPRICD0                           CAC005 188670
     C           *IN60     IFEQ '1'                                       188670
     C                     MOVEASTAMP,1   PRTMST           Default Timestamp                  CPK015
     C                     WRITESEPRICD0               14  *              188670
     C                     ENDIF                                          188670
     C                     ENDIF                                          CAC005
      *                                                                   S01169
      ** Update PF/EXVALD for current price..                             S01169
      *                                                                   S01169
     C           PPRT      IFEQ 'V '                                      S01169
     C           *IN71     ANDEQ'1 '                                      S01169
     C                     EXSR EXUPD                                     S01169
     C                     END                                            S01169
     C*
     C** TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN15     IFEQ '1'
     C           STATUS    ANDEQ01021
     C           PRICEK    CHAINPRICEDFX             15
     C           *IN15     IFEQ '0'
     C                     EXSR UPDOWS
     C                     GOTO XTUPDF
     C                     END
     C                     END
      *
      ***  If no record, End Program
     C           *IN15     IFEQ '1'
     C                     EXSR INFSR
     C                     END
     C*
     C                     MOVEASTAMP,1   PRTMST           Default Timestamp                  210760
     C  N60                UPDATPRICEDF
      *                                                                   188670
     C           CAC005    IFEQ 'Y'                                       188670
     C           *IN60     ANDEQ'0'                                       188670
     C                     Z-ADDPVDT      WPVDT   50                      188670
     C                     Z-ADDPPRC      WPPRC  158                      188670
     C                     MOVELPNTV      WPNTV  35                       188670
     C                     MOVELPSRC      WPSRC   1                       188670
     C                     Z-ADDNPXR      WNPXR  138                      188670
     C                     MOVELNPMD      WNPMD   1                       188670
     C           KEY1      CHAINSEPRICD0             61                   188670
     C                     Z-ADDWPVDT     PVDT                            188670
     C                     Z-ADDWPPRC     PPRC                            188670
     C                     MOVELWPNTV     PNTV                            188670
     C                     Z-ADDRUND      LCD                             188670
     C                     MOVEL'I'       CHTP                            188670
     C                     MOVEL'D'       RECI                            188670
     C                     MOVELNATN      TNLU                            188670
     C                     MOVELWPSRC     PSRC                            188670
     C                     MOVE PPPWN     PPWN                            188670
     C                     MOVELPPBWN     PBWN                            188670
     C                     Z-ADDWNPXR     NPXR                            188670
     C                     MOVELWNPMD     NPMD                            188670
     C                     MOVEASTAMP,1   PRTMST           Default Timestamp                  210760
     C                     UPDATSEPRICD0                                  188670
     C                     ENDIF                                          188670
      *                                                                   188670
     C                     ELSE
     C*
     C**               I  N  S  E  R  T  S                 -  E N D
     C*
     C**               A  M  E  N  D  S                    -  S T A R T
     C*
     C           ACTN      IFEQ 'A'
     C           PRICEK    CHAINPRICEDF              60    *
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
      *                                                                   S01169
     C                     MOVE PPPWN     PPWN                            S01169
     C                     MOVE PPBWN     PBWN                            S01169
      *                                                                   S01169
     C                     Z-ADDRUND      LCD
     C                     MOVEL'A'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C           *IN71     IFEQ '1 '                                      S01169
      *                                                                   S01169
      ** Update PF/EXVALD for current price.                              S01169
      *                                                                   S01169
     C           PPRT      IFEQ 'V '                                      S01169
     C                     EXSR EXUPD                                     S01169
     C                     END                                            S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     MOVEASTAMP,1   PRTMST           Default Timestamp                  210760
     C  N60                UPDATPRICEDF
      *                                                                   CAC005
      ** If CAC005 is installed, update record in SEPRICPD                CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     Z-ADDPVDT      WPVDT   50                      CAC005
     C                     Z-ADDPPRC      WPPRC  158                      CAC005
     C                     MOVELPNTV      WPNTV  35                       CAC005
     C                     MOVELPSRC      WPSRC   1                       CAC005
     C                     Z-ADDNPXR      WNPXR  138                      CAC005
     C                     MOVELNPMD      WNPMD   1                       CAC005
     C           KEY1      CHAINSEPRICD0             61                   CAC005
     C                     Z-ADDWPVDT     PVDT                            CAC005
     C                     Z-ADDWPPRC     PPRC                            CAC005
     C                     MOVELWPNTV     PNTV                            CAC005
     C                     Z-ADDRUND      LCD                             CAC005
     C                     MOVEL'A'       CHTP                            CAC005
     C                     MOVELNATN      TNLU                            CAC005
     C                     MOVELWPSRC     PSRC                            CAC005
     C                     MOVE PPPWN     PPWN                            CAC005
     C                     MOVELPPBWN     PBWN                            CAC005
     C                     Z-ADDWNPXR     NPXR                            CAC005
     C                     MOVELWNPMD     NPMD                            CAC005
     C                     UPDATSEPRICD0                                  CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ELSE
     C*
     C**               A  M  E  N  D  S                    -  E N D
     C*
     C**               D  E  L  E  T  E  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'D'
     C           PRICEK    CHAINPRICEDF              60
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C                     MOVEL'*'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'D'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C  N60                UPDATPRICEDF
      *                                                                   CAC005
      ** If CAC005 is installed, delete record fron SEPRICPD              CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           KEY1      CHAINSEPRICD0             61                   CAC005
     C                     MOVEL'*'       RECI                            CAC005
     C                     Z-ADDRUND      LCD                             CAC005
     C                     MOVEL'D'       CHTP                            CAC005
     C                     MOVELNATN      TNLU                            CAC005
     C                     UPDATSEPRICD0                                  CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     END
     C*
     C**               D  E  L  E  T  E  S                 -  E N D
     C*
     C                     END
     C                     END
     C*
     C** GET AUDIT RECORD
     C*
     C           1         CHAINPRICEAF              99
     C*
     C** UPDATE AUDIT RECORD IF FOUND
     C*
     C           *IN99     IFEQ '0'
     C*
     C** FOR INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF LIVE
     C** RECORDS
     C*
     C           ACTN      IFEQ 'I'
     C                     ADD  1         SINS
     C                     ADD  1         NORE
     C                     END
     C*
     C** FOR AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY
     C*
     C           ACTN      IFEQ 'A'
     C                     ADD  1         SAMD
     C                     END
     C*
     C** FOR DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS
     C*
     C           ACTN      IFEQ 'D'
     C                     ADD  1         SDEL
     C                     SUB  1         NORE                            E13911
     C                     END
     C*
     C** FORMAT COMIT TEXT
     C*
     C                     TIME           MTIME
     C                     MOVELACTN      ACTNX
     C                     MOVEASCRCTL    DET,01
     C                     MOVEADETS      DET,24
     C*
     C** UPDATE AUDIT RECORD
     C*
     C                     UPDATPRICEAF
     C/COPY WNCPYSRC,SE0080C021
     C*
     C** C  O  M  I  T
     C*
     C           CMTTXT    COMIT
     C*
     C** AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C                     ELSE
     C*
     C                     SETON                     U7U8  ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'02'      DBASE            * DB ERROR 02 *S01117
     C                     Z-ADD2         DBASE            * DB ERROR 02 *S01117
     C                     MOVEL'PRICE'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR ERROR                                     S01117
     C                     END
     C*
     C           XTUPDF    ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UPDOWS - Subroutine to process Update by Another Workstation.*
      *                                                               *
      *  Called By: UPDFLS                                            *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           UPDOWS    BEGSR                           *** UPDOWS ***
     C**
     C                     ROLBK
     C**
     C**   SET UP NEXT SCREEN TO BE DISPLAYED:
     C**   IF RECORD IS LIVE, ALLOW AMEND PROCESSING;
     C**
     C           RECI      IFEQ 'D'
     C                     MOVEL'A'       ACTN
     C                     ELSE
     C**
     C**   IF RECORD HAS BEEN DELETED, ALLOW ENQUIRY
     C**
     C                     MOVEL'E'       ACTN
     C                     END
     C**
     C**   SET SCREEN PROCESSOR TO UPDATE AND MOVE UPDATE MESSAGE TO ERROR
     C**
     C                     MOVEA'001'     *IN,10
     C                     MOVELINF,11    INFMSG
     C**
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  INFSR  - File Exception/Error Handling Subroutine.           *
      *                                                               *
      *  Called By: File Error.                                       *
      *  Calls:     None.                                             *
      *                                                               *
      *****************************************************************
      *
     C           INFSR     BEGSR                           *** INFSR  ***
     C**
     C** ROLL BACK CHANGES AND CANCEL PROGRAM
     C**
     C                     ROLBK
     C                     MOVE '*CANCL'  EXTTAG  6
     C**
     C                     ENDSREXTTAG
      *
      *****************************************************************
      /EJECT                                                              S01169
      *****************************************************************   S01169
      *                                                               *   S01169
      *  EXDET  - Subroutine to Load details from PF/EXVALD.          *   S01169
      *                                                               *   S01169
      *  FIELDS IN   : PSSN   - Security shortname.                   *   S01169
      *              : ACTN   - Action.                               *   S01169
      *              : PSRC   - Price source.                         *   S01169
      *                                                               *   S01169
      *  FIELDS OUT  : DBFILE - Database file in error.               *   S01169
      *              : DBKEY  - Database file key.                    *   S01169
      *              : DBASE  - Database error number.                *   S01169
      *              : ORIGIN - Price source.                         *   S01169
      *              : APIND  - Auto price indicator.                 *   S01169
      *              : LPRICE - Lower price boundary.                 *   S01169
      *              : UPRICE - Upper price boundary.                 *   S01169
      *              : PCENT  - Percentage allowable.                 *   S01169
      *                                                               *   S01169
      *  Called By: TRSFS                                             *   S01169
      *  Calls    : None.                                             *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           EXDET     BEGSR                                          S01169
      *                                                                   S01169
      ** Obtain record from PF/EXVALD using the security shortname.       S01169
      *                                                                   S01169
     C***********PSSN      CHAINEXVALDF              70            S01169 S01169
     C           PSSN      CHAINEXVALDFX             70                   S01169
      *                                                                   S01169
      ***If*the*record*is*not*found,*perform*db*error*processing** S01169 101019
      *                                                                   101019
      *  If the record is already purged and Enquiry requested,           101019
      *  then display error message and deny the request.                 101019
      *                                                                   S01169
     C           *IN70     IFEQ '1'                                       S01169
      ***********RECI      ORNE 'D'                                S01169 101019
     C           ACTN      IFEQ 'E'                                       101019
     C                     MOVEA*BLANKS   ERR,1                           101019
     C                     MOVEAINF,12    ERR,1                           101019
     C                     MOVELHI        ERRMSG                          101019
     C                     SETON                     102280               101019
     C                     SETOF                     1112                 101019
     C                     END                                            101019
      *                                                                   101019
      ***********          SETON              U7U8LR***************S01169 101019
      ************LOCK     IN   LDA                                S01117 101019
     C***********          MOVEL'03'      DBASE            **DB ERR S01169S01117
      ***********          Z-ADD3         DBASE     **DB ERROR 03**S01117 101019
      ***********          MOVEL'EXVAL'   DBFILE    ***************S01169 101019
      ***********          MOVELPSSN      DBKEY                    S01169 101019
      ***********          OUT  LDA                                S01117 101019
      ***********          EXSR ERROR                              S01117 101019
      ***********          RETRN                                   S01169 101019
      *                                                                   S01169
     C                     ELSE                                           S01169
      *                                                                   S01169
     C                     MOVE PSRC      ORIGIN                          S01169
      *                                                                   S01169
      ** Move the auto price indicator from PF/EXVALD to the              S01169
      **   screen field.                                                  S01169
      *                                                                   S01169
     C                     MOVE EXAP      APIND                           S01169
      *                                                                   S01169
      ** Reformat the lower price boundary from PF/EXVALD for             S01169
      **   output to the screen.                                          S01169
      *                                                                   S01169
     C                     MOVE *BLANKS   ZFIELD                          S01169
     C                     MOVE LPBD      ZFIELD                          S01169
     C                     Z-ADD8         ZADEC                           S01169
     C                     EXSR ZEDIT                                     S01169
     C                     MOVE ZFIELD    LPRICE                          S01169
      *                                                                   S01169
      ** Reformat the upper price boundary from PF/EXVALD for             S01169
      **   output to the screen.                                          S01169
      *                                                                   S01169
     C                     MOVE *BLANKS   ZFIELD                          S01169
     C                     MOVE UPBD      ZFIELD                          S01169
     C                     Z-ADD8         ZADEC                           S01169
     C                     EXSR ZEDIT                                     S01169
     C                     MOVE ZFIELD    UPRICE                          S01169
      *                                                                   S01169
      ** Reformat the percentage allowable from PF/EXVALD for             S01169
      **   output to the screen.                                          S01169
      *                                                                   S01169
     C                     MOVE *BLANKS   ZFIELD                          S01169
     C                     MOVE PMOV      ZFIELD                          S01169
     C                     Z-ADD6         ZADEC                           S01169
     C                     EXSR ZEDIT                                     S01169
     C                     MOVE ZFIELD    PCENT                           S01169
      *                                                                   S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      /EJECT                                                              S01169
      *****************************************************************   S01169
      *                                                               *   S01169
      *  EXUPD   - Subroutine to Update PF/EXVALD.                    *   S01169
      *                                                               *   S01169
      *  FIELDS IN   : PSSN   - Security shortname.                   *   S01169
      *              : APIND  - Auto price indicator.                 *   S01169
      *              : LPRICE - Lower price boundary.                 *   S01169
      *              : UPRICE - Upper price boundary.                 *   S01169
      *              : PCENT  - Percentage allowable.                 *   S01169
      *              : RUND   - Run date.                             *   S01169
      *              : FNATN  - Percentage allowable.                 *   S01169
      *                                                               *   S01169
      *  FIELDS OUT  : None.                                          *   S01169
      *                                                               *   S01169
      *  Called By: UPDFLS                                            *   S01169
      *  Calls    : None.                                             *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           EXUPD     BEGSR                           *** EXUPD  *** S01169
      *                                                                   S01169
      ** Move screen fields into external field names.                    S01169
      *                                                                   S01169
     C           PSSN      CHAINEXVALDF              70                   S01169
      *                                                                   S01169
      ** Update PF/EXVALD if it is a 'live' record.                       S01169
      *                                                                   S01169
     C           *IN70     IFEQ '0'                                       S01169
     C           RECI      ANDEQ'D'                                       S01169
      *                                                                   S01169
     C                     MOVE 'D'       RECI                            S01169
     C                     MOVE PSSN      SESN                            S01169
     C                     MOVE JEXAP     EXAP                            S01169
     C                     Z-ADDJLPBD     LPBD                            S01169
     C                     Z-ADDJUPBD     UPBD                            S01169
     C                     Z-ADDJPMOV     PMOV                            S01169
     C                     Z-ADDRUND      LCD                             S01169
     C                     MOVEL'A'       CHTP                            S01169
     C                     Z-ADDFNATN     TNLU                            S01169
      *                                                                   S01169
      ** Update PF/EXVALD record with details entered from screen.        S01169
      *                                                                   S01169
     C                     UPDATEXVALDF                                   S01169
      *                                                                   S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      /EJECT                                                              S01169
      *****************************************************************   S01169
      *                                                               *   S01169
      *  EXVLSR   - PF/EXVALD  Exception Error Subroutine.            *   S01169
      *                                                               *   S01169
      *  FIELDS IN   : EXVLDS - File information DS for PF/EXVALD.    *   S01169
      *                                                               *   S01169
      *  FIELDS OUT  : EPFDS  - File information data structure.      *   S01169
      *              : EPFLAG - Error processing type flag.           *   S01169
      *                                                               *   S01169
      *  Called By : EXUPD                                            *   S01169
      *  Calls     : *PSSR                                            *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           EXVLSR    BEGSR                           *** EXVLSR *** S01169
      *                                                                   S01169
      ** Move file information DS to DS used in SR.                       S01169
      **   Set indicator to file error.                                   S01169
      *                                                                   S01169
     C                     MOVE EXVLDS    EPFDS                           S01169
     C                     MOVE 'F'       EPFLAG  1                       S01169
      *                                                                   S01169
      ** Perform exception error handling subroutine.                     S01169
      *                                                                   S01169
     C                     EXSR *PSSR                                     S01169
      *                                                                   S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************   S01169
      /EJECT                                                              S01169
      *****************************************************************   S01169
      *                                                               *   S01169
      *  *PSSR   - Program Exception Error Subroutine.                *   S01169
      *                                                               *   S01169
      *            Calls programs to handle exception errors.         *   S01169
      *                                                               *   S01169
      *  FIELDS IN   : EPFDS  - File information data structure.      *   S01169
      *              : EPFLAG - Exception error type flag.            *   S01169
      *                                                               *   S01169
      *  FIELDS OUT  : None.                                          *   S01169
      *                                                               *   S01169
      *  CALLED FROM : EXVLSR.                                        *   S01169
      *  CALLS       : Programs - SDC2505, SDC2500.                   *   S01169
      *                                                               *   S01169
      *****************************************************************   S01169
      *                                                                   S01169
     C           *PSSR     BEGSR                           *** *PSSR  *** S01169
      *                                                                   S01169
     C           EPSW      IFNE '1'                                       S01169
     C                     MOVE '1'       EPSW    1                       S01169
      *                                                                   S01169
      ** If exception error is on a file call SDC2505.                    S01169
      *                                                                   S01169
     C           EPFLAG    IFNE 'F'                                       S01169
     C                     CALL 'SDC2505'                                 S01169
     C                     PARM           EPPDS1                          S01169
     C                     PARM           EPPDS2                          S01169
      *                                                                   S01169
      ** If exception error is not on a file call SDC2500.                S01169
      *                                                                   S01169
     C                     ELSE                                           S01169
      *                                                                   S01169
     C                     CALL 'SDC2500'                                 S01169
     C                     PARM           EPFDS1                          S01169
     C                     PARM           EPFDS2                          S01169
     C                     PARM           EPPP                            S01169
     C                     PARM           EPPPL                           S01169
      *                                                                   S01169
     C                     END                                            S01169
      *                                                                   S01169
     C                     DUMP                                           S01169
      *                                                                   S01169
     C                     END                                            S01169
      *                                                                   S01169
      ** Rollback entry if in commitment control.                         S01169
      *                                                                   S01169
     C                     ROLBK                                          S01169
      *                                                                   S01169
     C                     SETON                     LR                   S01169
     C                     RETRN                                          S01169
      *                                                                   S01169
     C                     ENDSR                                          S01169
      *                                                                   S01169
      *****************************************************************
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT                                                              S01486
     C/COPY ZSRSRC,ZCCYCN                                                 S01486
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
     C********************************************************************S01117
      /EJECT
     C********************************************************************S01117
     C*                                                                   S01117
     C* ERROR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS            S01117
     C*                                                                   S01117
     C* CALLED FROM : AFTER ABNORMAL OPERATION OCCURS                     S01117
     C*                                                                   S01117
     C* CALLS : NOTHING                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C           ERROR     BEGSR                           ** ERROR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
      /EJECT
     C********************************************************************S01117
     C*                                                                   S01117
     C* CHKSEL - SUBROUTINE TO CHECK WHETHER A SELECTION HAS BEEN         S01117
     C*          REQUESTED                                                S01117
     C*                                                                   S01117
     C* CALLED FROM : START,REVIEW                                        S01117
     C*                                                                   S01117
     C* CALLS : NOTHING                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           CHKSEL    BEGSR                           ** CHKSEL **   S01117
     C*                                                                   S01117
     C                     MOVE 'N'       @SEL    1                       S01117
     C*                                                                   S01117
     C                     MOVELSPBRC     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSPBRC     @DSNB                           S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @DSNB                           S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     MOVE *BLANKS   SPBRC                           S01117
     C                     SETOF                     25                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELA8BRCD    SPBRC                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSPCNM     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSPCNM     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SPCNM                           S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCUST    SPCNM                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELSPBOK     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELSPBOK     @BKEY                           S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @BKEY                           S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SPBOK                           S01117
     C                     SETOF                     26                   S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBDBKCD    SPBOK                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELPPCNM     @STP    1                       S01117
     C           @STP      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       @SEL                            S01117
     C                     MOVELPPCNM     @KEYC                           S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN                           S01117
     C                     PARM           @KEYC                           S01117
     C                     PARM *BLANKS   @KYST                           S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   PPCNM                           S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCUST    PPCNM                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
      ***
      * /104633/
      *INF,6  DELETION F3:F10 to delete this record:F12:Rollup:Rolldown:Help
      *INF,9  F10 is required
      *INF,10 F10 is not required
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION                      E14837
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
** INF
 Enter:Action Code I,A,D,E and selection:Review from point:F3:Help
 Enter:Review from point:Action Code A,D,E:F3:F12:Rollup:Rolldown:Help
 INSERTION Enter:F3:F12:Help
 AMENDMENT Enter:F3:F12:Rollup:Rolldown:Help
 ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help
 DELETION F3:F10=Delete record:F12:Rollup:Rolldown:Help
 Rollup is not possible
 Rolldown is not possible
 F10=Confirm
 
 Record has been updated by another workstation
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
